<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Incoding Framework - Get started</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="disclaimer: This article is a step-by-step tutorial that will help you become familiar with the main features of the Incoding Framework . Following th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Incoding Framework - Get started</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://incframework.com/"><img src="https://habrastorage.org/getpro/habr/post_images/001/77f/d8e/00177fd8e91cac6509c2a30562a0dd50.png" alt="IncFramework-logo" width="920" height="398"></a> <br><br>  <em><strong>disclaimer:</strong> This article is a step-by-step tutorial that will help you become familiar with the main features of the <strong>Incoding Framework</strong> .</em>  <em>Following this guide will result in a unit-covered <a href="https://github.com/IncodingSoftware/get-started">application</a> that implements working with the database (CRUD + data filters).</em>  <em>About the Incoding framework, there have already been articles on habrahabr, but they reveal separate parts of the tool.</em> <br><br><h1>  Part 0. Introduction </h1><br>  To begin, we give a brief description of the framework <strong>.</strong>  <strong>Incoding</strong> <strong>Framework</strong> consists of three packages: Incoding framework - the back-end of the project, Incoding Meta Language - the front-end of the project and Incoding tests helpers - unit tests for the back-end.  These packages are installed independently of each other, which allows you to integrate the framework into the project in parts: you can connect only the client or only the server part (the tests are very strongly connected with the server part, so they can be positioned as an addition). <br>  In projects written in the <strong>Incoding Framework</strong> , <strong>&nbsp;</strong>  <a title="Martin Fowler: CQRS" href="http://martinfowler.com/bliki/CQRS.html">CQRS is</a> used as the server architecture.  <a title="Habrahabr: Incoding rapid development framework" href="http://habrahabr.ru/post/209734/">Incoding Meta Language is</a> used as the main tool for building the client part.  In general, the <strong>Incoding Framework</strong> covers the entire application development cycle. <br>  A typical solution created using the <strong>Incoding Framework</strong> has 3 projects: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  <b>Domain ( <em>class library)</em></b> <em>- is</em> responsible for business logic and work with the database. </li><li>  <b>UI ( <em>ASP.NET MVC project</em> )</b> <b><i>&nbsp;</i></b>  <i>-</i> client part based on ASP.NET MVC. </li><li>  <strong>UnitTests ( <em>class library</em> )</strong> - unit tests for Domain. </li></ol><br><a name="habracut"></a><br><h3>  Domain </h3><br>  After installing the <a title="Nuget: Incoding framework" href="https://www.nuget.org/packages/Incoding.Framework/">Incoding framework</a> package via Nuget, in addition to the necessary dlls, the Bootstrapper.cs file is installed.  The main task of this file is to initialize the application: initialize logging, register IoC, set up Ajax requests, etc. The <a title="StructureMap docs" href="http://docs.structuremap.net/">StructureMap is</a> set as the IoC framework by default, but there is a provider for Ninject, and you can also write your implementations. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Example.Domain</span></span> { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> &lt;&lt; Using &gt;&gt; using System; using System.Configuration; using System.IO; using System.Linq; using System.Web.Mvc; using FluentNHibernate.Cfg; using FluentNHibernate.Cfg.Db; using FluentValidation; using FluentValidation.Mvc; using Incoding.Block.IoC; using Incoding.Block.Logging; using Incoding.CQRS; using Incoding.Data; using Incoding.EventBroker; using Incoding.Extensions; using Incoding.MvcContrib; using NHibernate.Tool.hbm2ddl; using StructureMap.Graph; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> public static class Bootstrapper { public static void Start() { //Initialize LoggingFactory LoggingFactory.Instance.Initialize(logging =&gt; { string path = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "Log"); logging.WithPolicy(policy =&gt; policy.For(LogType.Debug).Use(FileLogger.WithAtOnceReplace(path, () =&gt; "Debug_{0}.txt".F(DateTime.Now.ToString("yyyyMMdd"))))); }); //Initialize IoCFactory IoCFactory.Instance.Initialize(init =&gt; init.WithProvider(new StructureMapIoCProvider(registry =&gt; { registry.For&lt;IDispatcher&gt;().Use&lt;DefaultDispatcher&gt;(); registry.For&lt;IEventBroker&gt;().Use&lt;DefaultEventBroker&gt;(); registry.For&lt;ITemplateFactory&gt;().Singleton().Use&lt;TemplateHandlebarsFactory&gt;(); //Configure FluentlyNhibernate var configure = Fluently .Configure() .Database(MsSqlConfiguration.MsSql2008 .ConnectionString(ConfigurationManager.ConnectionStrings["Example"].ConnectionString)) .Mappings(configuration =&gt; configuration.FluentMappings .AddFromAssembly(typeof(Bootstrapper).Assembly)) .ExposeConfiguration(cfg =&gt; new SchemaUpdate(cfg).Execute(false, true)) .CurrentSessionContext&lt;NhibernateSessionContext&gt;(); registry.For&lt;INhibernateSessionFactory&gt;() .Singleton() .Use(() =&gt; new NhibernateSessionFactory(configure)); registry.For&lt;IUnitOfWorkFactory&gt;().Use&lt;NhibernateUnitOfWorkFactory&gt;(); registry.For&lt;IRepository&gt;().Use&lt;NhibernateRepository&gt;(); //Scan currenlty Assembly and registrations all Validators and Event Subscribers registry.Scan(r =&gt; { r.TheCallingAssembly(); r.WithDefaultConventions(); r.ConnectImplementationsToTypesClosing(typeof(AbstractValidator&lt;&gt;)); r.ConnectImplementationsToTypesClosing(typeof(IEventSubscriber&lt;&gt;)); r.AddAllTypesOf&lt;ISetUp&gt;(); }); }))); ModelValidatorProviders.Providers .Add(new FluentValidationModelValidatorProvider(new IncValidatorFactory())); FluentValidationModelValidatorProvider.Configure(); //Execute all SetUp foreach (var setUp in IoCFactory.Instance.ResolveAll&lt;ISetUp&gt;().OrderBy(r =&gt; r.GetOrder())) { setUp.Execute(); } var ajaxDef = JqueryAjaxOptions.Default; ajaxDef.Cache = false; //Disable Ajax cache } } }</span></span></code> </pre> <br>  Next, in the <strong>Domain,</strong> commands (Command) and queries (Query) are added that perform operations with the database or some other actions related to the business logic of the application. <br><br><h3>  Ui </h3><br>  The <a title="Nuget: Incoding Meta Language" href="https://www.nuget.org/packages/Incoding.MetaLanguage/">Incoding Meta Language</a> package during installation adds the necessary dll to the project, as well as the IncodingStart.cs and DispatcherController.cs files (part of the <a title="Habrahabr: Model View Dispatcher (cqrs over mvc)" href="http://habrahabr.ru/post/221585/">MVD</a> ) necessary for working with Domain. <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">IncodingStart</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> source </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Bootstrapper.Start(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DispatcherController(); <span class="hljs-comment"><span class="hljs-comment">// init routes } }</span></span></code> </pre> <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DispatcherController</span></span> : <span class="hljs-title"><span class="hljs-title">DispatcherControllerBase</span></span> { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> Constructors public DispatcherController() : base(typeof(Bootstrapper).Assembly) { } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> }</span></span></code> </pre> <br>  After installation, client logic is added to the <strong>UI</strong> using <a title="Habrahabr: Incoding rapid development framework" href="http://habrahabr.ru/post/209734/">IML</a> . <br><br><h3>  UnitTests </h3><br>  When you install the <a title="Nuget: Incoding tests helpers" href="https://www.nuget.org/packages/Incoding.MSpecContrib/">Incoding tests helpers, the MSpecAssemblyContext.cs</a> file is added to the project, which configures the connection to the test database. <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> MSpecAssemblyContext : IAssemblyContext { #region IAssemblyContext Members <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> OnAssemblyStart() { //     var configure = Fluently .Configure() .<span class="hljs-keyword"><span class="hljs-keyword">Database</span></span>(MsSqlConfiguration.MsSql2008 .ConnectionString(ConfigurationManager.ConnectionStrings["Example_Test"].ConnectionString) .ShowSql()) .Mappings(<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>.FluentMappings.AddFromAssembly(typeof(Bootstrapper).Assembly)); PleasureForData.StartNhibernate(configure, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> OnAssemblyComplete() { } #endregion }</code> </pre> <br><br><h2>  Part 1. Installation </h2><br>  So, we will start implementation of the task set in the <em>disclamer</em> - we will start writing our application.  The first step in creating an application is to create the structure of the project‚Äôs solution and add projects to it.  The project's solution will be named <strong>Example</strong> and, as already mentioned in the introduction, will have three projects.  Let's start with the project, which will be responsible for the business logic of the application - with <strong>Domain.</strong> <br>  We create class library <strong>Domain</strong> . <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/251/c4b/394/251c4b3943ef65e1612dcc1e0ac7ade6.png" alt="Domain" width="800" height="553"></a> <br>  Next, let's move on to the client side ‚Äî create and install an ASP.NET Web Application <b>UI</b> empty project with links to MVC packages. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a88/baf/d25/a88bafd253a237e4e15d767eb24080a3.png" alt="UI1" width="800" height="553"></a> <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/ba6/ea0/034/ba6ea0034a9722c33ca19faa73c2652c.png" alt="UI2" width="770" height="540"></a> <br>  Finally, add the class library <strong>UnitTests, which is</strong> responsible for unit testing. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/902/05f/7ea/90205f7eae7496b7c85c92f1ea456564.png" alt="UnitTests" width="800" height="553"></a> <br>  <em><strong>Attention:</strong> although unit tests are not a mandatory part of the application, we recommend that you always cover the code with tests, as this will allow you to avoid many problems with errors in the code by automating testing in the future.</em> <br><br>  After performing all the above actions, you should get the following Solution: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/6d5/457/c3c/6d5457c3cb3f8af01bcd2a9b4f6020c7.png" alt="Solution" width="664" height="547"></a> <br>  After creating the Solution structure, you must install the <strong>Incoding Framework</strong> packages from Nuget into the appropriate projects. <br>  Installation takes place through Nuget.  For all projects, the installation algorithm is one: <br><br><ol><li>  Right-click on the project and select <strong>Manage Nuget Packages</strong> in the context menu <strong>...</strong> </li><li>  In the search enter <strong>incoding</strong> </li><li>  Select the package you need and install it. </li></ol><br>  First install the <a title="Incoding framework" href="https://www.nuget.org/packages/Incoding.Framework/">Incoding framework</a> in <strong>Domain</strong> . <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/c48/b02/a19/c48b02a19609fdd5d8ec0fd31b19e819.png" alt="Incoding_framework_1" width="800" height="539"></a> <br>  Next, add a link to StructureMap.Graph to the <strong>Domain -&gt; Infrastructure -&gt; Bootstrapper.cs</strong> file. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/55a/150/966/55a150966b3de3fb21a922369659771d.png" alt="StructureMap_ref" width="800" height="63"></a> <br><br>  You need to install two packages in the <strong>UI</strong> : <br><ol><li>  <a title="Nuget: Incoding Meta Language" href="https://www.nuget.org/packages/Incoding.MetaLanguage/">Incoding Meta Language</a> </li><li>  <a title="Nuget: Incoding Meta Language Contrib" href="https://www.nuget.org/packages/Incoding.MetaLanguage.Contrib/">Incoding Meta Language Contrib</a> </li></ol><br> <strong><img src="https://habrastorage.org/getpro/habr/post_images/0f8/bc7/5a0/0f8bc75a081ff4ba275d77a3d3b5cc85.png" alt="Incoding_Meta_Languge" width="800" height="539"></strong> <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a5a/5d0/99f/a5a5d099f97ad1efe2ee0d6fe3c48c34.png" alt="MetaLanguageContrib_install" width="800" height="539"></a> <br>  <b><i>Attention:</i></b> <i>make sure that for References -&gt; System.Web.Mvc.dll property ‚ÄúCopy Local‚Äù is set to ‚Äútrue‚Äù</i> <br>  Now, <strong>modify the</strong> file <strong>Example.UI -&gt; Views -&gt; Shared -&gt; _Layout.cshtml</strong> so that it looks like this: <br><br><pre> <code class="hljs xml">@using Incoding.MvcContrib <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scripts</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jquery-1.9.1.min.js</span></span></span><span class="hljs-tag">")"&gt;</span></span><span class="undefined"><span class="undefined"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scripts</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jquery-ui-1.10.2.min.js</span></span></span><span class="hljs-tag">")"&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scripts</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">underscore.min.js</span></span></span><span class="hljs-tag">")"&gt;</span></span><span class="undefined"><span class="undefined"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scripts</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jquery.form.min.js</span></span></span><span class="hljs-tag">")"&gt;</span></span><span class="undefined"><span class="undefined"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scripts</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jquery.history.js</span></span></span><span class="hljs-tag">")"&gt;</span></span><span class="undefined"><span class="undefined"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scripts</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jquery.validate.min.js</span></span></span><span class="hljs-tag">")"&gt;</span></span><span class="undefined"><span class="undefined"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scripts</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jquery.validate.unobtrusive.min.js</span></span></span><span class="hljs-tag">")"&gt;</span></span><span class="undefined"><span class="undefined"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scripts</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">handlebars-1.1.2.js</span></span></span><span class="hljs-tag">")"&gt;</span></span><span class="undefined"><span class="undefined"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scripts</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">incoding.framework.min.js</span></span></span><span class="hljs-tag">")"&gt;</span></span><span class="undefined"><span class="undefined"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scripts</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">incoding.meta.language.contrib.js</span></span></span><span class="hljs-tag">")"&gt;</span></span><span class="undefined"><span class="undefined"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scripts</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bootstrap.min.js</span></span></span><span class="hljs-tag">")"&gt;</span></span><span class="undefined"><span class="undefined"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bootstrap.min.css</span></span></span><span class="hljs-tag">")"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">themes</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">base</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jquery.ui.core.css</span></span></span><span class="hljs-tag">")"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">themes</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">base</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jquery.ui.datepicker.css</span></span></span><span class="hljs-tag">")"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">themes</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">base</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jquery.ui.dialog.css</span></span></span><span class="hljs-tag">")"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">themes</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">base</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jquery.ui.theme.css</span></span></span><span class="hljs-tag">")"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">themes</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">base</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jquery.ui.menu.css</span></span></span><span class="hljs-tag">")"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> TemplateFactory.Version = </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'@Guid.NewGuid().ToString()'</span></span></span><span class="actionscript">; </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.Incoding().RenderDropDownTemplate() <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> @RenderBody() <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  It remains to add a link to Bootstrapper.cs in the files <b>Example.UI -&gt; App_Start -&gt; IncodingStart.cs</b> and <strong>Example.UI -&gt; Controllers -&gt; DispatcherController.cs</strong> . <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/161/ce7/62e/161ce762e1c6224f7b6247b2fa9fc2c6.png" alt="IncodingStart_bootstrapper" width="400" height="240"></a> <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/563/6aa/323/5636aa323758eb5505795b8866d190cf.png" alt="DispatcherController_bootstrapper" width="712" height="185"></a> <br>  <em><strong>Note:</strong> if you are using MVC5, then for the framework to work, you need to add the following code to the Web.config file</em> <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependentAssembly</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">assemblyIdentity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"System.Web.Mvc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">publicKeyToken</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"31bf3856ad364e35"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">culture</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"neutral"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bindingRedirect</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">oldVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.0.0.0-5.0.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">newVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5.0.0.0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependentAssembly</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  It remains to install the <a title="Nuget: Incoding tests helpers" href="https://www.nuget.org/packages/Incoding.MSpecContrib/">Incoding tests helpers</a> in <strong>UnitTests</strong> and add a link to Bootstrapper.cs in <strong>Example.UnitTests -&gt; MSpecAssemblyContext.cs.</strong> <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/4a1/af4/b4e/4a1af4b4e1201a548550d17fe9fdb7a3.png" alt="Incoding_tests_helpers" width="800" height="539"></a> <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f75/a49/6ef/f75a496ef3f0535b0e149f27b9334e13.png" alt="MSpecAssemblyContext_bootstrapper" width="800" height="116"></a> <br>  The last stage of preparing projects for work is to create a folder structure for projects. <br>  Add the following folders to the <strong>Example.Domain</strong> project <strong>:</strong> <br><br><ol><li>  Operations - command and query project </li><li>  Persistences - entities for database mapping </li><li>  Specifications - where and order specifications for filtering data on queries </li></ol><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a7c/df9/48c/a7cdf948c8a4af2357ad97314e25104b.png" alt="Example.Domain_folders" width="350" height="154"></a> <br>  In the <strong>Example.UnitTests</strong> project <strong>,</strong> create the same folder structure as in <strong>Example.Domain.</strong> <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/c66/207/d0e/c66207d0e4961fdc3ae05e4391c53e98.png" alt="UnitTests_folders" width="310" height="172"></a> <br><br><h1>  Part 2. Setting up a DB connection </h1><br>  To begin, create a database with which we will work.  Open SQL Managment Studio and create two databases: Example and Example_test. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/c79/af4/457/c79af445757c11c285fc0b4112b97e0a.png" alt="add_DB" width="525" height="291"></a> <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/649/c97/66f/649c9766fd95462d8a38313c4efca04d.png" alt="example_db" width="525" height="471"></a> <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/86e/ac0/102/86eac01029dfe8feb89c0b91969ccd57.png" alt="example_test_db" width="525" height="471"></a> <br>  In order to work with the database you need to configure the connection.  Add to the files <strong>Example.UI -&gt; Web.config</strong> and <strong>Example.UnitTests -&gt; app.config</strong> connection string to the database: <br><br><pre> <code class="hljs pgsql"> &lt;connectionStrings&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>="Example" connectionString="Data Source=INCODING-PC\SQLEXsource SS;Database=Example;Integrated Security=false; User Id=sa;Password=1" providerName="System.Data.SqlClient" /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>="Example_Test" connectionString="Data Source=INCODING-PC\SQLEXsource SS;Database=Example_Test;Integrated Security=true" providerName="System.Data.SqlClient" /&gt; &lt;/connectionStrings&gt;</code> </pre> <br>  In the <strong>Example.Domain -&gt; Infrastructure -&gt; Bootstrapper.cs</strong> file, register the corresponding connection string using the "Example" key: <br><br><pre> <code class="hljs pgsql">//Configure FluentlyNhibernate var configure = Fluently .Configure() .<span class="hljs-keyword"><span class="hljs-keyword">Database</span></span>(MsSqlConfiguration.MsSql2008.ConnectionString(ConfigurationManager .ConnectionStrings["Example"].ConnectionString)) .Mappings(<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>.FluentMappings .AddFromAssembly(typeof(Bootstrapper).Assembly)) .ExposeConfiguration(cfg =&gt; <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SchemaUpdate(cfg).<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)) .CurrentSessionContext(); //Configure data base</code> </pre><br>  In the file <strong>Example.UnitTests -&gt; MSpecAssemblyContext.cs,</strong> register the test database connection string using the "Example_Test" key: <br><br><pre> <code class="hljs pgsql">//Configure <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Test data base var configure = Fluently .Configure() .<span class="hljs-keyword"><span class="hljs-keyword">Database</span></span>(MsSqlConfiguration.MsSql2008 .ConnectionString(ConfigurationManager.ConnectionStrings["Example_Test"].ConnectionString) .ShowSql()) .Mappings(<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>.FluentMappings .AddFromAssembly(typeof(Bootstrapper).Assembly));</code> </pre><br>  <em><strong>Note:</strong> the Example and Example_Test databases must exist.</em> <br><br><h1>  Part 3. CRUD </h1><br>  After performing all the above steps, we come to the most interesting part - writing code that implements the <strong>C</strong> reate <strong>R</strong> ead <strong>U</strong> pdate <strong>D</strong> elete-functional application.  First you need to create an entity class that will map to the database.  In our case, this will be Human.cs, which we add to the <strong>Example.Domain -&gt; Persistences</strong> folder <strong>.</strong> <br><br><h6>  Human.cs </h6><br><pre> <code class="hljs pgsql">namespace Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span> { #region <span class="hljs-symbol"><span class="hljs-symbol">&lt;&lt; Using &gt;&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.Data; #endregion <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Human : IncEntityBase { #region Properties <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual DateTime Birthday { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual string FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual string Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual string LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual Sex Sex { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } #endregion #region Nested Classes <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Map : NHibernateEntityMap&lt;Human&gt; { #region Constructors protected Map() { IdGenerateByGuid(r =&gt; r.Id); MapEscaping(r =&gt; r.FirstName); MapEscaping(r =&gt; r.LastName); MapEscaping(r =&gt; r.Birthday); MapEscaping(r =&gt; r.Sex); } #endregion } #endregion } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> enum Sex { Male = <span class="hljs-number"><span class="hljs-number">1</span></span>, Female = <span class="hljs-number"><span class="hljs-number">2</span></span> } }</code> </pre> <br>  Our class contains several fields in which we will write data, and a nested mapping <i>class</i> ( <i>class Map).</i> <br>  <em><strong>Note:</strong> after creating the <strong>Human</strong> class, you no longer need to perform any actions (adding xml mapping) thanks to <a title="Fluent nhibernate" href="http://www.fluentnhibernate.org/">FluentNhibernate</a> .</em> <br>  Now add commands (Command) and queries (Query), which will be responsible for the implementation of CRUD operations.  The first command will be responsible for adding a new or modifying an existing Human record.  The command is quite simple: we either get an entity from the Repository by key (Id), or, if there is no such entity, we create a new one.  In both cases, the entity receives the values ‚Äã‚Äãthat are specified in the properties of the AddOrEditHumanCommand class.  Add the <strong>Example.Domain -&gt; Operations -&gt; AddOrEditHumanCommand.cs file</strong> to the project. <br><br><h6>  AddOrEditHumanCommand.cs </h6><br><pre> <code class="hljs pgsql">namespace Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span> { #region <span class="hljs-symbol"><span class="hljs-symbol">&lt;&lt; Using &gt;&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> FluentValidation; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.CQRS; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.Extensions; #endregion <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> AddOrEditHumanCommand : CommandBase { #region Properties <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> DateTime BirthDay { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Sex Sex { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } #endregion <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> override <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>() { var human = Repository.GetById&lt;Human&gt;(Id) ?? <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Human(); human.FirstName = FirstName; human.LastName = LastName; human.Birthday = BirthDay; human.Sex = Sex; Repository.SaveOrUpdate(human); } } }</code> </pre> <br>  The next part of CRUD - Read is a request to read entities from the database.  Add the <strong>Example.Domain -&gt; Operations -&gt; GetPeopleQuery.cs file.</strong> <br><br><h6>  GetPeopleQuery.cs </h6><br><pre> <code class="hljs pgsql">namespace Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span> { #region <span class="hljs-symbol"><span class="hljs-symbol">&lt;&lt; Using &gt;&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.CQRS; #endregion <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> GetPeopleQuery : QueryBase&lt;List&lt;GetPeopleQuery.Response&gt;&gt; { #region Properties <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string Keyword { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } #endregion #region Nested Classes <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Response { #region Properties <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string Birthday { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string Sex { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } #endregion } #endregion protected override List&lt;Response&gt; ExecuteResult() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Repository.Query&lt;Human&gt;().<span class="hljs-keyword"><span class="hljs-keyword">Select</span></span>(human =&gt; <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Response { Id = human.Id, Birthday = human.Birthday.ToShortDateString(), FirstName = human.FirstName, LastName = human.LastName, Sex = human.Sex.ToString() }).ToList(); } } }</code> </pre> <br>  And the rest of the functionality is Delete - deleting records from the database by key (Id).  Add the <strong>Example.Domain</strong> file <strong>-&gt; Operations -&gt; DeleteHumanCommand.cs.</strong> <br><br><h6>  DeleteHumanCommand.cs </h6><br><pre> <code class="hljs pgsql">namespace Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span> { #region <span class="hljs-symbol"><span class="hljs-symbol">&lt;&lt; Using &gt;&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.CQRS; #endregion <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> DeleteHumanCommand : CommandBase { #region Properties <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string HumanId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } #endregion <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> override <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>() { Repository.<span class="hljs-keyword"><span class="hljs-keyword">Delete</span></span>&lt;Human&gt;(HumanId); } } }</code> </pre> <br>  In order to fill the database with initial data, add the file <strong>Example.Domain -&gt; InitPeople.cs</strong> - this file is inherited from the ISetUp interface. <br><br><h6>  ISetup </h6><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Incoding.CQRS</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ISetUp</span></span> : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOrder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } }</code> </pre> <br>  All instances of classes inherited from ISetUp are registered via IoC in Bootstrapper.cs (was given in the introduction).  After registration, they are launched for execution (public void Execute ()) in order (public int GetOrder ()). <br><br><h6>  InitPeople.cs </h6><br><pre> <code class="hljs pgsql">namespace Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span> { #region <span class="hljs-symbol"><span class="hljs-symbol">&lt;&lt; Using &gt;&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.Block.IoC; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.CQRS; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> NHibernate.Util; #endregion <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> InitPeople : ISetUp { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> Dispose() { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> GetOrder() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>() { // Dispatcher   Query  Command var dispatcher = IoCFactory.Instance.TryResolve&lt;IDispatcher&gt;(); //  ,         <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dispatcher.Query(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> GetEntitiesQuery&lt;Human&gt;()).<span class="hljs-keyword"><span class="hljs-keyword">Any</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; //  dispatcher.Push(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AddOrEditHumanCommand { FirstName = "Hellen", LastName = "Jonson", BirthDay = Convert.ToDateTime("06/05/1985"), Sex = Sex.Female }); dispatcher.Push(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AddOrEditHumanCommand { FirstName = "John", LastName = "Carlson", BirthDay = Convert.ToDateTime("06/07/1985"), Sex = Sex.Male }); } } }</code> </pre> <br>  Back-end CRUD implementation is ready.  Now you need to add client code.  As in the case of the server part, let's start the implementation from the part of creating / editing a record.  Add the <strong>Example.UI</strong> file <strong>-&gt; Views -&gt; Home -&gt; AddOrEditHuman.cshtml.</strong>  The presented IML code creates a standard html form and works with the AddOrEditHumanCommand command, sending the corresponding Ajax request to the server. <br><br><h6>  AddOrEditHuman.cshtml </h6><br><pre> <code class="hljs javascript">@using Example.Domain @using Incoding.MetaLanguageContrib @using Incoding.MvcContrib @model Example.Domain.AddOrEditHumanCommand @*   Ajax-   AddOrEditHumanCommand*@ @using (Html.When(JqueryBind.Submit) @*        Ajax*@ .PreventDefault() .Submit() .OnSuccess(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dsl</span></span></span><span class="hljs-function"> =&gt;</span></span> { dsl.WithId(<span class="hljs-string"><span class="hljs-string">"PeopleTable"</span></span>).Core().Trigger.Incoding(); dsl.WithId(<span class="hljs-string"><span class="hljs-string">"dialog"</span></span>).JqueryUI().Dialog.Close(); }) .OnError(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dsl</span></span></span><span class="hljs-function"> =&gt;</span></span> dsl.Self().Core().Form.Validation.Refresh()) .AsHtmlAttributes(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { action = Url.Dispatcher().Push(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AddOrEditHumanCommand()), enctype = <span class="hljs-string"><span class="hljs-string">"multipart/form-data"</span></span>, method = <span class="hljs-string"><span class="hljs-string">"POST"</span></span> }) .ToBeginTag(Html, HtmlTag.Form)) { &lt;div&gt; @Html.HiddenFor(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.Id) @Html.ForGroup(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.FirstName).TextBox(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">control</span></span></span><span class="hljs-function"> =&gt;</span></span> control.Label.Name = <span class="hljs-string"><span class="hljs-string">"First name"</span></span>) &lt;br/&gt; @Html.ForGroup(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.LastName).TextBox(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">control</span></span></span><span class="hljs-function"> =&gt;</span></span> control.Label.Name = <span class="hljs-string"><span class="hljs-string">"Last name"</span></span>) &lt;br/&gt; @Html.ForGroup(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.BirthDay).TextBox(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">control</span></span></span><span class="hljs-function"> =&gt;</span></span> control.Label.Name = <span class="hljs-string"><span class="hljs-string">"Birthday"</span></span>) &lt;br/&gt; @Html.ForGroup(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.Sex).DropDown(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">control</span></span></span><span class="hljs-function"> =&gt;</span></span> control.Input.Data = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Sex).ToSelectList()) &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; &lt;div&gt; &lt;input type="submit" value="Save"/</span></span>&gt; @* *@ @(Html.When(JqueryBind.Click) .PreventDefault() .StopPropagation() .Direct() .OnSuccess(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dsl</span></span></span><span class="hljs-function"> =&gt;</span></span> { dsl.WithId(<span class="hljs-string"><span class="hljs-string">"dialog"</span></span>).JqueryUI().Dialog.Close(); }) .AsHtmlAttributes() .ToButton(<span class="hljs-string"><span class="hljs-string">"Cancel"</span></span>)) &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; }</span></span></code> </pre> <br>  This is followed by the template, which is a template for loading data received from GetPeopleQuery.  It describes a table that will be responsible not only for data output, but also for deleting and editing individual records: add the file <strong>Example.UI -&gt; Views -&gt; Home -&gt; HumanTmpl.cshtml.</strong> <br><br><h6>  HumanTmpl.cshtml </h6><br><pre> <code class="hljs javascript">@using Example.Domain @using Incoding.MetaLanguageContrib @using Incoding.MvcContrib @{ using (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> template = Html.Incoding().Template&lt;GetPeopleQuery.Response&gt;()) { &lt;table <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"table"</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">th</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> First name </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">th</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">th</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Last name </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">th</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">th</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Birthday </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">th</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">th</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Sex </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">th</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">th</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">th</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;tbody&gt; @using (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> each = template.ForEach()) { &lt;tr&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> @each.For(r =&gt; r.FirstName) </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;td&gt; @each.For(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.LastName) &lt;<span class="hljs-regexp"><span class="hljs-regexp">/td&gt; &lt;td&gt; @each.For(r =&gt; r.Birthday) &lt;/</span></span>td&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> @each.For(r =&gt; r.Sex) </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;td&gt; @*    *@ @(Html.When(JqueryBind.Click) .AjaxGet(Url.Dispatcher().Model&lt;AddOrEditHumanCommand&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { Id = each.For(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.Id), FirstName = each.For(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.FirstName), LastName = each.For(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.LastName), BirthDay = each.For(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.Birthday), Sex = each.For(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.Sex) }) .AsView(<span class="hljs-string"><span class="hljs-string">"~/Views/Home/AddOrEditHuman.cshtml"</span></span>)) .OnSuccess(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dsl</span></span></span><span class="hljs-function"> =&gt;</span></span> dsl.WithId(<span class="hljs-string"><span class="hljs-string">"dialog"</span></span>).Behaviors(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">inDsl</span></span></span><span class="hljs-function"> =&gt;</span></span> { inDsl.Core().Insert.Html(); inDsl.JqueryUI().Dialog.Open(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">option</span></span></span><span class="hljs-function"> =&gt;</span></span> { option.Resizable = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; option.Title = <span class="hljs-string"><span class="hljs-string">"Edit human"</span></span>; }); })) .AsHtmlAttributes() .ToButton(<span class="hljs-string"><span class="hljs-string">"Edit"</span></span>)) @*  *@ @(Html.When(JqueryBind.Click) .AjaxPost(Url.Dispatcher().Push(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DeleteHumanCommand() { HumanId = each.For(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.Id) })) .OnSuccess(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dsl</span></span></span><span class="hljs-function"> =&gt;</span></span> dsl.WithId(<span class="hljs-string"><span class="hljs-string">"PeopleTable"</span></span>).Core().Trigger.Incoding()) .AsHtmlAttributes() .ToButton(<span class="hljs-string"><span class="hljs-string">"Delete"</span></span>)) &lt;<span class="hljs-regexp"><span class="hljs-regexp">/td&gt; &lt;/</span></span>tr&gt; } &lt;<span class="hljs-regexp"><span class="hljs-regexp">/tbody&gt; &lt;/</span></span>table&gt; } }</code> </pre> <br>  The task of opening a dialog box is quite common, so the code responsible for this action can be transferred to an <a title="Blog: Extensions" href="http://blog.incframework.com/ru/extensions/">extension</a> . <br><br>  The last part is changing the start page so that when it is loaded, an Ajax request is sent to the server to get data from GetPeopleQuery and display it through HumanTmpl: change the <strong>Example.UI</strong> file <strong>-&gt; Views -&gt; Home -&gt; Index.cshtml</strong> so that it matches the code below. <br><h6>  Index.cshtml </h6><br><pre> <code class="hljs pgsql">@<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.MetaLanguageContrib @<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.MvcContrib @{ Layout = "~/Views/Shared/_Layout.cshtml"; } &lt;div id="dialog"&gt;&lt;/div&gt; @* ,   GetPeopleQuery,  HumanTmpl*@ @(Html.<span class="hljs-keyword"><span class="hljs-keyword">When</span></span>(JqueryBind.InitIncoding) .AjaxGet(Url.Dispatcher().Query(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> GetPeopleQuery()).AsJson()) .OnSuccess(dsl =&gt; dsl.Self().Core().<span class="hljs-keyword"><span class="hljs-keyword">Insert</span></span>.WithTemplateByUrl(Url.Dispatcher().AsView("~/Views/Home/HumanTmpl.cshtml")).Html()) .AsHtmlAttributes(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> { id = "PeopleTable" }) .ToDiv()) @*   *@ @(Html.<span class="hljs-keyword"><span class="hljs-keyword">When</span></span>(JqueryBind.Click) .AjaxGet(Url.Dispatcher().AsView("~/Views/Home/AddOrEditHuman.cshtml")) .OnSuccess(dsl =&gt; dsl.WithId("dialog").Behaviors(inDsl =&gt; { inDsl.Core().<span class="hljs-keyword"><span class="hljs-keyword">Insert</span></span>.Html(); inDsl.JqueryUI().Dialog.<span class="hljs-keyword"><span class="hljs-keyword">Open</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">option</span></span> =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">option</span></span>.Resizable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">option</span></span>.Title = "Add human"; }); })) .AsHtmlAttributes() .ToButton("Add new human"))</code> </pre> <br>  In real-world applications, validation of entered form data is one of the most frequent tasks.  Therefore, we will add data validation to the Human entity add / edit form.  The first part is adding server code. <strong>&nbsp;</strong>  Add the following code in AddOrEditHumanCommand as the nested class: <br><br><pre> <code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> Nested Classes public class Validator : AbstractValidator { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> Constructors public Validator() { RuleFor(r =&gt; r.FirstName).NotEmpty(); RuleFor(r =&gt; r.LastName).NotEmpty(); } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span></span></code> </pre> <br>  On the form AddOrEditHuman.cshtml we used constructions of the form: &lt; <br><br><pre> <code class="hljs css">@<span class="hljs-keyword"><span class="hljs-keyword">Html</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">ForGroup</span></span>()</code> </pre> <br>  Therefore, there is no need to add <br><br><pre> <code class="hljs css">@<span class="hljs-keyword"><span class="hljs-keyword">Html</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">ValidationMessageFor</span></span>()</code> </pre> <br>  for fields - <a title="Hints and Tips" href="http://blog.incframework.com/ru/tips-and-trick/">ForGroup ()</a> will do it for us. <br>  Thus, we have written application code that implements the CRUD functionality for a single database entity. <br><br><h1>  Part 4. Specifications - data filtering </h1><br>  Another of the tasks that are often found in real projects is filtering the requested data.  In the Incoding Framework, for the convenience of writing code and following the principle of encapsulation, WhereSpecifications are used to filter the data obtained in Query.  Let's add to the written code the ability to filter the data received in GetPeopleQuery by FirstName and LastName.  First, we add two specification.Remain <strong>-&gt; Specifications -&gt; HumanByFirstNameWhereSpec.cs</strong> and <strong>Example.UI -&gt; Specifications -&gt; HumanByLastNameWhereSpec.cs specification files.</strong> <br><br><h6>  HumanByFirstNameWhereSpec.cs </h6><br><pre> <code class="hljs pgsql">namespace Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span> { #region <span class="hljs-symbol"><span class="hljs-symbol">&lt;&lt; Using &gt;&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Linq.Exsource ssions; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding; #endregion <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> HumanByFirstNameWhereSpec : Specification { #region Fields readonly string firstName; #endregion #region Constructors <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> HumanByFirstNameWhereSpec(string firstName) { this.firstName = firstName; } #endregion <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> override Exsource ssion&lt;Func&lt;Human, <span class="hljs-type"><span class="hljs-type">bool</span></span>&gt;&gt; IsSatisfiedBy() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (string.IsNullOrEmpty(this.firstName)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> human =&gt; human.FirstName.ToLower().Contains(this.firstName.ToLower()); } } }</code> </pre> <br><h6>  HumanByLastNameWhereSpec.cs </h6><br><pre> <code class="hljs pgsql">namespace Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span> { #region <span class="hljs-symbol"><span class="hljs-symbol">&lt;&lt; Using &gt;&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Linq.Exsource ssions; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding; #endregion <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> HumanByLastNameWhereSpec : Specification { #region Fields readonly string lastName; #endregion #region Constructors <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> HumanByLastNameWhereSpec(string lastName) { this.lastName = lastName.ToLower(); } #endregion <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> override Exsource ssion&lt;Func&lt;Human, <span class="hljs-type"><span class="hljs-type">bool</span></span>&gt;&gt; IsSatisfiedBy() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (string.IsNullOrEmpty(this.lastName)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> human =&gt; human.LastName.ToLower().Contains(this.lastName); } } }</code> </pre> <br>  Now we use the written specifications in the GetPeopleQuery request.  With the help of the bundles. Or () /. And (), atomic specifications can be combined into more complex ones, which helps to use created specifications many times and with their help fine-tune the necessary data filters (in our example, we use the bundle. Or ()). <br><br><h6>  GetPeopleQuery.cs </h6><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Example.Domain</span></span> { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> &lt;&lt; Using &gt;&gt; using System.Collections.Generic; using System.Linq; using Incoding.CQRS; using Incoding.Extensions; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> public class GetPeopleQuery : QueryBase&lt;List&lt;GetPeopleQuery.Response&gt;&gt; { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> Properties public string Keyword { get; set; } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> Nested Classes public class Response { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> Properties public string Birthday { get; set; } public string FirstName { get; set; } public string Id { get; set; } public string LastName { get; set; } public string Sex { get; set; } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> protected override List&lt;Response&gt; ExecuteResult() { return Repository.Query(whereSpecification:new HumanByFirstNameWhereSpec(Keyword) .Or(new HumanByLastNameWhereSpec(Keyword))) .Select(human =&gt; new Response { Id = human.Id, Birthday = human.Birthday.ToShortDateString(), FirstName = human.FirstName, LastName = human.LastName, Sex = human.Sex.ToString() }) .ToList(); } } }</span></span></code> </pre><br><br>  Finally, it remains to modify Index.cshtml a bit to add a search string that, when requested, includes a Keyword field for filtering data. <br><br><h6>  Index.cshtml </h6><br><pre> <code class="hljs pgsql">@<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.MetaLanguageContrib @<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.MvcContrib @{ Layout = "~/Views/Shared/_Layout.cshtml"; } &lt;div id="dialog"&gt;&lt;/div&gt; @*   Find   InitIncoding  PeopleTable   GetPeopleQuery   Keyword*@ &lt;div&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>="text" id="Keyword"/&gt; @(Html.<span class="hljs-keyword"><span class="hljs-keyword">When</span></span>(JqueryBind.Click) .Direct() .OnSuccess(dsl =&gt; dsl.WithId("PeopleTable").Core().<span class="hljs-keyword"><span class="hljs-keyword">Trigger</span></span>.Incoding()) .AsHtmlAttributes() .ToButton("Find")) &lt;/div&gt; @(Html.<span class="hljs-keyword"><span class="hljs-keyword">When</span></span>(JqueryBind.InitIncoding) .AjaxGet(Url.Dispatcher().Query(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> GetPeopleQuery { Keyword = Selector.Jquery.Id("Keyword") }).AsJson()) .OnSuccess(dsl =&gt; dsl.Self().Core().<span class="hljs-keyword"><span class="hljs-keyword">Insert</span></span>.WithTemplateByUrl(Url.Dispatcher().AsView("~/Views/Home/HumanTmpl.cshtml")).Html()) .AsHtmlAttributes(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> { id = "PeopleTable" }) .ToDiv()) @(Html.<span class="hljs-keyword"><span class="hljs-keyword">When</span></span>(JqueryBind.Click) .AjaxGet(Url.Dispatcher().AsView("~/Views/Home/AddOrEditHuman.cshtml")) .OnSuccess(dsl =&gt; dsl.WithId("dialog").Behaviors(inDsl =&gt; { inDsl.Core().<span class="hljs-keyword"><span class="hljs-keyword">Insert</span></span>.Html(); inDsl.JqueryUI().Dialog.<span class="hljs-keyword"><span class="hljs-keyword">Open</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">option</span></span> =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">option</span></span>.Resizable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">option</span></span>.Title = "Add human"; }); })) .AsHtmlAttributes() .ToButton("Add new human"))</code> </pre> <br><h1>  Part 5. Unit tests. </h1><br>  We will cut the written code with tests.  The first test is responsible for checking the mapping of the Human entity.  The When_save_Human.cs file will be added to the Persisteces folder of the UnitTests project. <br><br><h6>  <b>When_save_Human.cs</b> </h6><br><pre> <code class="hljs pgsql">namespace Example.UnitTests.Persistences { #region <span class="hljs-symbol"><span class="hljs-symbol">&lt;&lt; Using &gt;&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.MSpecContrib; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Machine.Specifications; #endregion [Subject(typeof(Human))] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> When_save_Human : SpecWithPersistenceSpecification { #region Fields It should_be_verify = () =&gt; persistenceSpecification.VerifyMappingAndSchema(); #endregion } }</code> </pre><br>  This test works with a test database (Example_test): it creates an instance of the Human class with automatically filled fields, saves it to the database, and then retrieves and compares it with the created instance. <br>  Now add the tests for WhereSpecifications to the Specifications folder. <br><br><h6>  <strong>When_human_by_first_name.cs</strong> </h6><br><pre> <code class="hljs pgsql">namespace Example.UnitTests.Specifications { #region <span class="hljs-symbol"><span class="hljs-symbol">&lt;&lt; Using &gt;&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.MSpecContrib; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Machine.Specifications; #endregion [Subject(typeof(HumanByFirstNameWhereSpec))] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> When_human_by_first_name { #region Fields Establish establish = () =&gt; { Func&lt;string, Human&gt; createEntity = (firstName) =&gt; Pleasure.MockStrictAsObject(mock =&gt; mock.SetupGet(r =&gt; r.FirstName).<span class="hljs-keyword"><span class="hljs-keyword">Returns</span></span>(firstName)); fakeCollection = Pleasure.ToQueryable(createEntity(Pleasure.Generator.TheSameString()), createEntity(Pleasure.Generator.String())); }; Because <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> = () =&gt; { filterCollection = fakeCollection .<span class="hljs-keyword"><span class="hljs-keyword">Where</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HumanByFirstNameWhereSpec(Pleasure.Generator.TheSameString()).IsSatisfiedBy()) .ToList(); }; It should_be_filter = () =&gt; { filterCollection.Count.ShouldEqual(<span class="hljs-number"><span class="hljs-number">1</span></span>); filterCollection[<span class="hljs-number"><span class="hljs-number">0</span></span>].FirstName.ShouldBeTheSameString(); }; #endregion #region Establish <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> static IQueryable fakeCollection; static List filterCollection; #endregion } }</code> </pre><br><h6>  <strong>When_human_by_last_name.cs</strong> </h6><br><pre> <code class="hljs pgsql">namespace Example.UnitTests.Specifications { #region <span class="hljs-symbol"><span class="hljs-symbol">&lt;&lt; Using &gt;&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.MSpecContrib; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Machine.Specifications; #endregion [Subject(typeof(HumanByLastNameWhereSpec))] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> When_human_by_last_name { #region Fields Establish establish = () =&gt; { Func&lt;string, Human&gt; createEntity = (lastName) =&gt; Pleasure.MockStrictAsObject(mock =&gt;mock.SetupGet(r =&gt; r.LastName).<span class="hljs-keyword"><span class="hljs-keyword">Returns</span></span>(lastName)); fakeCollection = Pleasure.ToQueryable(createEntity(Pleasure.Generator.TheSameString()), createEntity(Pleasure.Generator.String())); }; Because <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> = () =&gt; { filterCollection = fakeCollection .<span class="hljs-keyword"><span class="hljs-keyword">Where</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HumanByLastNameWhereSpec(Pleasure.Generator.TheSameString()).IsSatisfiedBy()) .ToList(); }; It should_be_filter = () =&gt; { filterCollection.Count.ShouldEqual(<span class="hljs-number"><span class="hljs-number">1</span></span>); filterCollection[<span class="hljs-number"><span class="hljs-number">0</span></span>].LastName.ShouldBeTheSameString(); }; #endregion #region Establish <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> static IQueryable fakeCollection; static List filterCollection; #endregion } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now it remains to add tests for the team and the query (Operations folder), and for the team you need to add two tests: one to check the creation of a new entity and the second to check the editing of an existing entity. </font></font><br><br><h6> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When_get_people_query.cs</font></font></strong> </h6><br><pre> <code class="hljs pgsql">namespace Example.UnitTests.Operations { #region <span class="hljs-symbol"><span class="hljs-symbol">&lt;&lt; Using &gt;&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.Extensions; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.MSpecContrib; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Machine.Specifications; #endregion [Subject(typeof(GetPeopleQuery))] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> When_get_people { #region Fields Establish establish = () =&gt; { var query = Pleasure.Generator.Invent&lt;GetPeopleQuery&gt;(); //<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span> entity <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> test <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> auto-generate human = Pleasure.Generator.Invent&lt;Human&gt;(); expected = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;GetPeopleQuery.Response&gt;(); mockQuery = MockQuery&lt;GetPeopleQuery, List&lt;GetPeopleQuery.Response&gt;&gt; .<span class="hljs-keyword"><span class="hljs-keyword">When</span></span>(query) //"Stub" <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> query <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> repository .StubQuery(whereSpecification: <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HumanByFirstNameWhereSpec(query.Keyword) .<span class="hljs-keyword"><span class="hljs-keyword">Or</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HumanByLastNameWhereSpec(query.Keyword)), entities: human); }; Because <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> = () =&gt; mockQuery.Original.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(); // Compare result It should_be_result = () =&gt; mockQuery .ShouldBeIsResult(list =&gt; list.ShouldEqualWeakEach(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Human&gt;() { human }, (dsl, i) =&gt; dsl.ForwardToValue(r =&gt; r.Birthday, human.Birthday.ToShortDateString()) .ForwardToValue(r =&gt; r.Sex, human.Sex.ToString()))); #endregion #region Establish <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> static MockMessage&lt;GetPeopleQuery, List&lt;GetPeopleQuery.Response&gt;&gt; mockQuery; static List&lt;GetPeopleQuery.Response&gt; expected; static Human human; #endregion } }</code> </pre><br><br><h6> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When_add_human.cs</font></font></strong> </h6><br><pre> <code class="hljs pgsql">namespace Example.UnitTests.Operations { #region <span class="hljs-symbol"><span class="hljs-symbol">&lt;&lt; Using &gt;&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.MSpecContrib; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Machine.Specifications; #endregion [Subject(typeof(AddOrEditHumanCommand))] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> When_add_human { #region Fields Establish establish = () =&gt; { var command = Pleasure.Generator.Invent&lt;AddOrEditHumanCommand&gt;(); mockCommand = MockCommand&lt;AddOrEditHumanCommand&gt; .<span class="hljs-keyword"><span class="hljs-keyword">When</span></span>(command) //"Stub" <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> repository .StubGetById&lt;Human&gt;(command.Id, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); }; Because <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> = () =&gt; mockCommand.Original.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(); It should_be_saved = () =&gt; mockCommand .ShouldBeSaveOrUpdate&lt;Human&gt;(human =&gt; human.ShouldEqualWeak(mockCommand.Original)); #endregion #region Establish <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> static MockMessage&lt;AddOrEditHumanCommand, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; mockCommand; #endregion } }</code> </pre><br><h6> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When_edit_human.cs</font></font></strong> </h6><br><pre> <code class="hljs pgsql">namespace Example.UnitTests.Operations { #region <span class="hljs-symbol"><span class="hljs-symbol">&lt;&lt; Using &gt;&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Example.<span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Incoding.MSpecContrib; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Machine.Specifications; #endregion [Subject(typeof(AddOrEditHumanCommand))] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> When_edit_human { #region Fields Establish establish = () =&gt; { var command = Pleasure.Generator.Invent&lt;AddOrEditHumanCommand&gt;(); human = Pleasure.Generator.Invent&lt;Human&gt;(); mockCommand = MockCommand&lt;AddOrEditHumanCommand&gt; .<span class="hljs-keyword"><span class="hljs-keyword">When</span></span>(command) //"Stub" <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> repository .StubGetById(command.Id, human); }; Because <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> = () =&gt; mockCommand.Original.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(); It should_be_saved = () =&gt; mockCommand .ShouldBeSaveOrUpdate&lt;Human&gt;(human =&gt; human.ShouldEqualWeak(mockCommand.Original)); #endregion #region Establish <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> static MockMessage&lt;AddOrEditHumanCommand, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; mockCommand; static Human human; #endregion } }</code> </pre><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> List of materials for study </font></font></h1><br><ol><li> <a title="Blog: CQRS" href="http://habrahabr.ru/post/211206/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CQRS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - server architecture</font></font></li><li> <a title="Blog: MVD" href="http://habrahabr.ru/post/221585/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MVD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äî Description of Model View Dispatcher Pattern</font></font></li><li> <a title="Blog: IML" href="http://habrahabr.ru/post/209734/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iml introduction</font></font></a> </li><li> <a title="Blog: IML" href="http://habrahabr.ru/post/214963/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IML TODO MVC</font></font></a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/266609/">https://habr.com/ru/post/266609/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266597/index.html">Bash script to create an archive of data</a></li>
<li><a href="../266599/index.html">How to estimate the depth of the game mechanics. Part two</a></li>
<li><a href="../266601/index.html">Settings in the tab and other little things in the weekly assembly Vivaldi 1.0.270.16</a></li>
<li><a href="../266603/index.html">PYCON RUSSIA 2015: the final program</a></li>
<li><a href="../266607/index.html">Energy Efficiency Data Center: Water and Refrigerants</a></li>
<li><a href="../266611/index.html">Layout letters: What is "kinetic email"</a></li>
<li><a href="../266613/index.html">Duck stories: duck looking for bugs</a></li>
<li><a href="../266615/index.html">Asynchronous execution of PHP script on subprocesses</a></li>
<li><a href="../266617/index.html">Free realtime list of online users (Parse.com + Pubnub)</a></li>
<li><a href="../266619/index.html">Overview of alternatives Proof of Work. Part 2. Proof of Activity, Proof of Burn, Proof of Capacity and Generals</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>