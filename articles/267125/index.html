<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hexagonal architecture</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At a recent Laracon NYC, I read a report on hexagonal architecture. Despite the fact that I received a positive reaction from the listeners, it seems ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hexagonal architecture</h1><div class="post__text post__text-html js-mediator-article"><img width="50%" src="https://habrastorage.org/getpro/habr/post_images/37d/e53/247/37de53247446ce2b56455f4744f030e9.jpg" align="right">  At a recent Laracon NYC, I read a report on hexagonal architecture.  Despite the fact that I received a positive reaction from the listeners, it seems to me that there are still people who would like to get a little more complete idea of ‚Äã‚Äãwhat it is.  Of course, with examples.  This is my attempt to expand that report. <br><br><ol><li>  <a href="http://userscape.com/laracon/2014/chrisfidao.html">Video from the report</a> </li><li>  <a href="https://speakerdeck.com/fideloper/hexagonal-architecture">Slides</a> </li></ol><br><br><p>  In my opinion, this architecture is an excellent example of how an application structure should be built.  Moreover, when I wrote my projects on Laravel, I, even without knowing it, often used the ideas underlying the hexagonal architecture. </p>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>  Being one of the variants of a layered architecture, hexagonal implies the division of an application into separate conceptual layers having different areas of responsibility, and also regulates how they are related to each other.  Dealing with this type of architecture, we can also understand how, why, and why when designing an application, interfaces are used. </p><br><br><p>  Hexagonal architecture is by no means a <strong>new</strong> approach to development using frameworks.  On the contrary, this is just a summary of the "best practices" - the practices of new and old ones.  I wrapped these words in quotes so that people would not take them quite literally.  The best practices that work for me may not work for you - it all depends on the task and the goals pursued. </p><br><br><p>  This type of architecture adheres to the classic ideas that developers come to when designing applications: separating application code from the framework.  Let our application be formed by itself, and not on the basis of the framework, using the latter only as a tool for solving some problems of our application. </p><br><a name="habracut"></a><br><h2>  Introduction </h2><br><p>  The term ‚ÄúHexagonal architecture‚Äù was introduced (as far as I know) by Alistair Cobern.  He perfectly <a href="http://alistair.cockburn.us/Hexagonal%2Barchitecture">described the basic principles of</a> this architecture on his website. </p><br><br><p>  The main purpose of this architecture is: </p><br><blockquote><p>  Allows you to interact with the application as a user, and programs, automated tests, batch processing scripts.  Also allows you to develop and test the application without any additional devices or databases. </p><br></blockquote><br><br><h3>  Why Hexagon </h3><br><p>  Despite the fact that the architecture is called hexagonal, which should indicate a figure with a certain number of faces, the basic idea is that there are many faces.  Each face represents a ‚Äúport‚Äù of access to our application or its connection with the outside world. </p><br><br><p>  The port can be represented as any conductor of incoming requests (or data) to our application.  For example, HTTP requests (which are converted into commands for an application) come through the HTTP port (browser requests, API).  Similarly, various queue managers or anything that interacts with an application using a message transfer protocol (for example, AMQP) can act.  All this is only a port through which we can ask the application to do some kind of action.  These faces make up a lot of ‚Äúincoming ports‚Äù.  Other ports can be used to access data from the application side, such as a database port. </p><br><br><h2>  Architecture </h2><br><p>  Why do we even talk about architecture?  And all because we want our application to have two indicators: </p><br><br><ul><li>  high maintenance </li><li>  low technical debt </li></ul><br><br><p>  Actually, both of these indicators express the same thing, we want it to be convenient to work with the application, and also it should allow you to quickly make changes in the future. </p><br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e1b/9d5/25e/e1b9d525ed5996b2ae89f63861b223c8.jpg"></p><br><br><h3>  Maintainability </h3><br><p>  Sustainability is determined by the absence (or minimization) of technical debt.  Supported will be the application, if you change which we will receive the lowest possible level of technical debt. </p><br><br><p>  Sustainability is a concept designed for long periods of time.  In the early stages of development, it is easy to work with the application - it is not yet fully formed and the developers form it based on their initial decisions.  At this stage, adding new functionality or libraries is easy and fast. </p><br><br><p>  However, over time, it becomes more and more difficult to work with the application.  Adding new functionality may conflict with existing ones.  Bugs may indicate a more general problem, the solution of which will require large changes in the code (as well as simplifying difficult code sections). </p><br><br><p>  By laying a good architecture in the early stages, we can prevent these problems. </p><br><br><p>  So what kind of support do we want?  What metrics can tell us that we have high support for our application? </p><br><br><ol><li>  Changes in one part of the application should affect as few other parts as possible; </li><li>  Adding new functionality should not require any major changes in the code; </li><li>  The organization of a new interface for interacting with the application should lead to the smallest possible changes to the application; </li><li>  Debugging should include as few as possible temporary solutions and hacks; </li><li>  Testing should be relatively easy; </li><li>  Since there is no perfect code, the word "should" should be taken as something to strive for but no more.  We try to make our application easier to maintain, while attempts to make it ‚Äúperfect‚Äù will lead to a waste of time and mental energy. </li></ol><br><br><blockquote><p>  If you think that you have turned away from the ‚Äúright path‚Äù when solving a problem, just finish it.  Go back to it later, or leave it in the ‚Äúdon't touch‚Äù state.  There are no applications with perfectly written source code in the world. </p><br></blockquote><br><br><h3>  Technical duty </h3><br><p>  Technical debt is a debt that we have to pay for our (bad) decisions.  And we pay this debt with time and frustration. </p><br><blockquote><p>  All applications include the initial level of technical debt.  We have to work within the framework and taking into account the limitations of the data storage mechanisms, programming languages, frameworks, teams and organizations we have chosen! </p><br></blockquote><br><p>  Bad architectural decisions made in the early stages of development in the aggregate will result in more and more problems. </p><br><br><p>  Every bad decision usually leads to crutches and hacks.  Moreover, the fact that the decision is bad is not always obvious - we can simply make a class that ‚Äúdoes too much‚Äù, or accidentally mix solutions to several problems. </p><br><br><p>  Minor but poor decisions made during development can also lead to problems.  Fortunately, this usually does not lead to large-scale problems that can be caused by design errors in the early design stages.  A good foundation reduces the growth rate of technical debt! </p><br><br><p>  So, we want to minimize the number of bad decisions, especially in the early stages of the project. </p><br><blockquote><p>  We are discussing architecture so that we can focus on increasing sustainability and reducing technical debt. </p><br></blockquote><br><p>  How can we make our application supported? </p><br><br><p>  We simplify making changes to the application. </p><br><br><p>  What can we do to simplify application changes?  We can identify those parts of the application that can change and separate them from what remains unchanged. </p><br><br><p>  We will return to this statement a couple of times. </p><br><br><h2>  Interfaces and Implementation </h2><br><p>  Let's digress for a while and discuss something simple (as it may seem) from the world of OOP: Interfaces. </p><br><blockquote><p>  Not all languages ‚Äã‚Äã(such as JavaScript, Python, and Ruby) have explicit interfaces, but from a conceptual point of view, goals that pursue the use of these can be easily achieved in these languages. </p><br></blockquote><br><p>  You can understand by interface a contract that governs what the application needs.  If an application can or must contain several implementations, then we can apply interfaces. </p><br><br><p>  In other words, we use interfaces whenever we plan several <em>implementations of the</em> same <em>interface</em> . </p><br><br><p>  For example, if our application has the ability to send notifications to the user, then we can make an SES notifier using Amazon SES, a Mandrill notifier using Mandrill, or other implementations using different services to send mail. </p><br><blockquote><p>  The interface ensures that specific methods are available for use in our application, regardless of the underlying implementation. </p><br></blockquote><br><p>  For example, the interface of our notifier might look like this: </p><br><br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Notifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Message $message)</span></span></span></span>; }</code> </pre> <br><br><p>  We know that any implementation of this interface <strong>must</strong> contain the <code>notify</code> method.  This allows us to define dependencies on this interface in other parts of our application. </p><br><br><p>  Application no matter what implementation it uses.  It is important to him that we have a <code>notify</code> method and we can use it. </p><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Notifier $notifier)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;notifier = $notifier; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doStuff</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $to = <span class="hljs-string"><span class="hljs-string">'some@email.com'</span></span>; $body = <span class="hljs-string"><span class="hljs-string">'This is a message'</span></span>; $message = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message($to, $body); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;notifier-&gt;notify($message); } }</code> </pre><br><br><p>  In this example, the implementation of the class <code>SomeClass</code> does not depend on the specific implementation, but only requires the presence of a subclass of <code>Notifier</code> .  This allows us to use SES, Mandrill, or any other implementation. </p><br><br><p>  Thus, interfaces are a convenient tool for increasing the support of your application.  Interfaces allow us to easily change the way we send notifications - for this we just need to add another implementation and that's it. </p><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SesNotifier</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Notifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SesClient $client)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;client = $client; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Message $message)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;client-&gt;send([ <span class="hljs-string"><span class="hljs-string">'to'</span></span> =&gt; $message-&gt;to, <span class="hljs-string"><span class="hljs-string">'body'</span></span> =&gt; $message-&gt;body]); } }</code> </pre><br><br><p>  In the example above, we used an implementation using a service from Amazon called Simple Email Service (SES).  But what if we still want to use Mandrill to send notifications?  And if we want to send notifications via SMS via Twilio? </p><br><br><p>  As we showed earlier, we can easily add another implementation and switch between them according to our whim. </p><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//  SES Notifier $sesNotifier = new SesNotifier(...); $someClass = new SomeClass($sesNotifier); //     MandrillNotifier $mandrillNotifier = new MandrillNotifier(...); $someClass = new SomeClass($mandrillNotifier); //         ,    $someClass-&gt;doStuff();</span></span></code> </pre><br><br><p>  By the same principle, our frameworks use interfaces.  In essence, frameworks are useful for us precisely because they can contain as many implementations as developers need.  For example, various SQL servers, email sending systems, drivers for caching and other services. </p><br><br><p>  Frameworks use interfaces because it allows us to increase support for frameworks ‚Äî it‚Äôs easier to add new features, it‚Äôs easier for us to extend the framework depending on our needs. </p><br><br><p>  Using interfaces helps us properly <strong>encapsulate changes</strong> .  We can simply add the implementation that we need now! </p><br><br><h3>  Go ahead </h3><br><p>  But what if we suddenly want to add additional functionality within a separate implementation (and maybe all)?  For example, we may need to log the work of the implementation of our SES notifier, for example, to debug some problem that we occasionally have. </p><br><br><p>  The most obvious way, of course, is to fix the code right in the implementation: </p><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SesNotifier</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Notifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SesClient $client, Logger $logger)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;logger = $logger; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;client = $client; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Message $message)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;logger-&gt;logMessage($message); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;client-&gt;send([...]); } }</code> </pre><br><br><p>  Using logging directly in a specific implementation may be a normal solution, but now this implementation does two things instead of one ‚Äî we mix responsibilities.  Moreover, what if we need to add logging to all implementations of our notifier?  As a result, we get a similar code for each implementation, which contradicts the principle of DRY.  If we need to change the way of logging, then we will have to change the code of all implementations.  Is there an easier way to add this functionality so as to keep the code supported?  Yes! </p><br><blockquote><p>  Do you recognize any of the SOLID principles that are affected by this chapter? </p><br></blockquote><br><p>  To make the code cleaner, we can use one of my favorite design patterns ‚Äî <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D0%25BA%25D0%25BE%25D1%2580%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580_(%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">Decorator</a> .  This template uses interfaces to ‚Äúwrap‚Äù our implementation to add new functionality.  Let's take an example. </p><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//      class NotifierLogger implements Notifier { public function __construct(Notifier $next, Logger $logger) { $this-&gt;next = $next; $this-&gt;logger = $logger; } public function notify(Message $message) { $this-&gt;logger-&gt;logMessage($message); return $this-&gt;next-&gt;notify($message); } }</span></span></code> </pre><br><br><p>  Just like our other notifier implementations, the <code>NotifierLogger</code> class implements the <code>Notifier</code> interface.  However, as you may have noticed, he does not even think of sending notifications to someone.  Instead, it takes a different implementation of the Notifier interface in the constructor.  When we ask the notifier to notify someone of something, our <code>NotifierLogger</code> will add these messages to the log and then ask to send the notification to the real implementation of our notifier. </p><br><br><p>  As you can see, our decorator logs the messages and sends them further to the notifier so that he actually sends something.  You can also expand the order so that logging will be performed after sending the message.  In this way, we will be able to add to the log not only the message we were going to send, but also the result of sending. </p><br><br><p>  So, <code>NotifierLogger</code> decorates our notifier, introducing logging functionality. </p><br><br><p>  The convenience here lies in the fact that our client code (in our case, <code>SomeClass</code> from the example above) does not care that we gave it a decorated object.  The decorator implements the same interface on which our <code>SomeClass</code> depends. </p><br><br><p>  We can also combine several decorators in one chain.  For example, we can wrap an email notifier with an SMS implementation to duplicate messages.  In this case, we add additional functionality (SMS) on top of sending emails. </p><br><br><p>  As the logger example shows, we are not limited to adding specific implementations of the notifier.  For example, we can organize an update of the database, or collect some metrics.  The possibilities are endless! </p><br><br><p>  Now we have the opportunity to add additional behavior, while maintaining the responsibility of each class without overloading it with unnecessary work.  We can also freely add additional functional implementations, which gives us additional flexibility.  Changing such a code becomes much easier! </p><br><blockquote><p>  Decorator is just one of many design patterns that uses interfaces to encapsulate changes.  In fact, almost all classic design patterns use interfaces. </p><br><br><p>  Moreover, almost all design patterns are designed to simplify changes.  And this is no coincidence.  The study of design patterns (as well as where and when to apply them) is a rather important step towards making good architectural decisions.  As an aid to learning design patterns, I recommend the book <a href="http://shop.oreilly.com/product/9780596007126.do">Head First Design Patterns</a> . </p><br></blockquote><br><p>  I repeat: Interfaces are the main way to encapsulate changes.  We can add functionality by creating a new implementation, or we can add behavior to an existing implementation.  And all this will not affect the rest of the code! </p><br><br><p>  By providing good encapsulation, the functionality may be easier to change.  Simplifying code changes increases application support (they are easier to change) and reduces technical debt (we invest less time to make changes). </p><br><br><p>  Perhaps about the interfaces enough.  I hope this has helped clarify some of why we need interfaces, as well as trying out some design patterns that we used to increase application support. </p><br><br><h2>  Ports and Adapters </h2><br><p>  Well, finally, we can begin to get acquainted with the hexagonal architecture. </p><br><br><p>  Hexagonal architecture is a layered architecture, also sometimes called a port and adapter architecture.  They call it so because within this architecture there is the concept of various ports that can be used (adapted) for use with other layers. </p><br><br><p>  For example, our framework uses ‚Äúports‚Äù to work with SQL for any number of different SQL servers with which our application can work.  Similarly, we can implement interfaces for some key things, and implement them in other layers of the application.  This allows us to have several implementations of these interfaces, depending on our needs or for testing needs.  Interfaces will be our main tool for reducing code connectivity between layers. </p><br><blockquote><p>  For parts of the application that may change, create an interface.  So we encapsulate the changes.  We can create a new implementation or add additional functionality over the existing one. </p><br></blockquote><br><p>  Before getting acquainted with the concept of ports and adapters, let's look at the layers that exist within the Hexagonal Architecture. </p><br><br><p><img src="https://habrastorage.org/getpro/habr/comment_images/441/ea3/05d/441ea305d6a821eda634dd9d9bea5a9c.jpg"></p><br><br><h2>  Layers: Code </h2><br><p>  As I said, within the framework of the hexagonal architecture, the application is divided into several layers. </p><br><br><p>  The purpose of such an application as separate layers is the ability to divide the application into different areas of responsibility. </p><br><br><p>  The code within the layers (and on their boundaries) should describe how their interaction should occur.  Since layers act as ports and adapters for other layers surrounding them, it is important to have rules of interaction between them. </p><br><br><p>  Layers interact with each other using interfaces (ports) and implementations of these interfaces (adapters). </p><br><br><p>  Each layer consists of two elements: </p><br><br><p>  By <strong>code</strong> here, we understand exactly what you might think.  It's just some kind of code with which we do things.  Quite often, this code acts only as an adapter for other layers, but it can be just some useful code (business logic, some services). </p><br><br><p>  Each layer also has a <strong>border</strong> that separates it from its neighboring layers.  At the border, we can find our "ports".  As we have said, ports are nothing more than interfaces, which tell other layers how the interaction will take place.  We will consider the question of the interaction of layers a little later, for a start we need to get acquainted with the layers we have. </p><br><br><h3>  Domain Layer </h3><br><p>  At the very center of our application is the domain layer.  This layer contains the business logic implementation and defines how the external layers can interact with it. </p><br><br><p>  Business logic is the heart of our application.  It can be described by the word "charter" - the rules that your code must obey. </p><br><br><p>  The domain layer and the business logic implemented in it define the behavior and constraints of your application.  This is what distinguishes your application from others, what gives value to an application. </p><br><br><p>  If your application contains complex business logic, various behaviors, then you get a rich layer of the subject area.  If your application is a small add-on above the database (and many applications are such), then this layer will be ‚Äúthinner‚Äù. </p><br><br><p>  In addition to business logic (core domain or core domain), additional logic can often be found in the domain layer, such as domain events (domain events, events thrown at key points of business logic) and ‚Äúuse cases‚Äù or use- cases (defining what our application should do). </p><br><br><p>  What the domain layer contains is the theme for a whole book (or a series of books) - especially if you are interested in domain-specific design (DDD).  This methodology describes in much more detail the ways in which we can implement an application as close as possible to the terms of the subject area, and therefore to the business processes that we want to transfer to the code. </p><br><br><p>  Consider a small example of ‚Äúcore‚Äù logic from the core of the domain: </p><br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Hex</span></span>\<span class="hljs-title"><span class="hljs-title">Tickets</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ticket</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assignStaffer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Staffer $staffer)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ! $staffer-&gt;categories-&gt;contains( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category ) ) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DomainException(<span class="hljs-string"><span class="hljs-string">"Staffer can't be assigned to "</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;staffer()-&gt;associate($staffer); <span class="hljs-comment"><span class="hljs-comment">// Set Relationship return $this; } public function setCategory(Category $category) { if( $this-&gt;staffer instanceof Staffer &amp;&amp; ! $this-&gt;staffer-&gt;categories-&gt;contains( $category ) ) { //  ,   //            $this-&gt;staffer = null; } $this-&gt;category()-&gt;associate($category); //    return $this; } }</span></span></code> </pre><br><br><p>  In the example above, we can see the <strong>restriction</strong> in the <code>assignStaffer</code> method.  If the employee (Stuffer) is not assigned to the same category (Category) as our application (Ticket), we throw an exception. </p><br><br><p>  We can also see certain <strong>behavior</strong> .  If we need to change the category of the application, for which some employee has already been assigned, we again try to assign it to him.  If this does not work, then we simply detach the wither from the employee.  We do not throw an exception, instead we give the opportunity to assign to the request of another employee when changing categories. </p><br><br><p>  We looked at both business logic examples.  In one scenario, we added a restriction, in the case of non-compliance with which we throw an exception.  In the other - they provided a certain behavior - as soon as we change the category, we must leave the opportunity to assign the application to the employee who can process applications from the new category. </p><br><br><p>  As we have said, the domain layer can also contain supporting business logic: </p><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegisterUserCommand</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $email; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $password; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($email, $password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   email/password } public function getEmail() { ... } //  $email public function getPassword() { ... } //  $password } class UserCreatedEvent { public function __construct(User $user) { ... } }</span></span></code> </pre><br><br><p>  Above, we have auxiliary (but very important) domain logic.  The first class is a kind of command (use case in UML terminology) that determines how our application can be used.  In our case, this command simply takes the necessary data in order to register a new user.  How exactly?  We will come back to this later. </p><br><br><p>  The second class is an example of a domain event (Domain Event), which our application can put into processing after it creates a user.  It is important to note that those things that can occur within our subject area belong to the subject area layer.  These are not system events, such as <code>pre-dispatch</code> hooks, which are often used by frameworks to expand their capabilities. </p><br><br><h3>  Application Layer </h3><br><p>  Immediately behind the domain layer sits our application layer.  This layer deals exclusively with the orchestration of actions performed on entities from the domain layer.  Also this layer is an adapter of requests from the framework layer and separates it from the domain layer. </p><br><br><p>  For example, this layer may contain a handler class that performs some kind of juz-case.  This class handler accepts incoming data that came to it from the framework layer, and will perform on them some actions that are required to run our juz-case. </p><br><br><p>  It can also send event processing (domain events) that occurred in the domain layer. </p><br><br><p>  This is the outermost layer of code that makes up our application. </p><br><br><p>  Of course, you might have noticed that outside the application layer there is also a ‚Äúframework layer‚Äù.  This layer contains the auxiliary code of our application (perhaps accepting HTTP requests, or sending emails), but it is <strong>not</strong> the application itself. </p><br><br><h3>  Framework Layer Layer </h3><br><p>  Our application is wrapped in a framework layer (it is also called the infrastructure layer, infrastructure layer).  As mentioned above, this layer contains the code that your application uses, but at the same time it is not part of the application itself.  Usually this layer is represented by your framework, but of course it can include any third-party libraries, SDK and any other code.  Recall all the libraries that you have connected via composer (suppose we still write in PHP).  They are not part of your framework, but they are still combined in one layer.  This whole layer is only needed for one thing - to perform various tasks to meet the needs of our application. </p><br><br><p>  In this layer, services are implemented whose interfaces are declared in the inner layers.  For example, the <code>Notificator</code> interface for sending notifications via email or SMS can be implemented here.  Our application just wants to send notifications to users, it does not need to know exactly how this happens (via email or via SMS or in any other way). </p><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SesEmailNotifier</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Notifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SesClient $client)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Message $message)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;client-&gt;sendEmail([ ... ]); <span class="hljs-comment"><span class="hljs-comment">// Send email with SES particulars } }</span></span></code> </pre><br><br><p>  Another example is the <em>event dispatcher</em> .  In the level layer of the framework, the interface can be implemented, declared in the application layer.  Again, the application may need to handle some events, but why write your own event dispatcher?  Most likely your framework already has a ready implementation.  Well, or as a last resort, we can connect a ready-made library, and use it as a basis for implementing our event dispatcher interface. </p><br><br><p>  Our framework level layer can also act as an HTTP request adapter to our application.  For example, we can put on his shoulders the receipt of HTTP requests, the collection of incoming data and the marshutization of the request / data to the appropriate controller.  Further, the controller can already launch a specific usage scenario from the application level layer (instead of processing everything directly in the controller). </p><br><br><p>  Thus, this layer separates our application from all external requests (for example, made from a browser).  This layer is an application request adapter. </p><br><br><h2>  The interaction of layers: the border </h2><br><p>  Now that we have dealt with what is on this or that layer, let's talk about how they interact with each other. </p><br><br><p>  As mentioned above, each layer regulates how other layers can interact with it.  ,       ,          . </p><br><br><p>      . <strong>      </strong> .       ,     . </p><br><br><p>              . </p><br><br><p> ,       (  ),     .         ,    . </p><br><br><p>      ,        . </p><br><br><h3>    </h3><br><p>        ,       ( ). </p><br><br><p> ,        ( ).       <code>RegisterUserCommand</code> ( ).    ,       DTO (Data Transfer Object). </p><br><br><p> ,      ,    .       ‚Äú    ‚Äù.            - . ,       .          ,        ( )     . </p><br><br><p>       ,         .        , ‚Äú ‚Äù       : </p><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommandBus</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($command)</span></span></span></span>; }</code> </pre><br><br><p>        ,  ‚Äú‚Äù     ( <code>CommandBus</code> ).      ‚Äî      <code>execute</code> ,       . </p><br><br><p> ,    <code>CommandBus</code>     ,         . ,   ,        . </p><br><br><p> ,    : </p><br><br><ul><li>          </li><li>    ,          </li><li>    ,    ,       ,    (   )      (         ,     ). </li><li>           .          . </li></ul><br><br><h3>   </h3><br><p> ,        .       ,     ()   .      ,        . </p><br><br><p>     -    . ,  ,        ?    ,          .          email-,         SMS.            . </p><br><br><p> ,       .      ? !    : </p><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Notifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Message $message)</span></span></span></span>; }</code> </pre><br><br><p>          .  ,   ,     ,        .  ()    ()         .         . </p><br><br><p>   ‚Äú ‚Äù          . </p><br><blockquote><p>   ,      -  .      ‚Äú              ‚Äù,   . </p><br><br><p>   ,             ,   .        .   ,         ‚Äú‚Äù  -     . </p><br><br><p>       (:    ,    ),     /   .       - .   ‚Äú ‚Äù . :    .     ,     . </p><br><br><p>        <a href="https://groups.google.com/forum/">      </a> ,         . </p><br></blockquote><br><br><h3>   </h3><br><p> -        .      ,     .       .   ‚Äî   .      ? </p><br><br><p>   , !  ,   .    - ,   TCP (  HTTP/HTTPS).       (    ).       ,         . </p><br><br><p>           ?     (   )! </p><br><br><p>     ,       . ,   HTTP ,   SQL ,    email  .. </p><br><br><p>  ,                .    ,      . </p><br><br><p>      .         ,             . </p><br><br><p>        -    ,    . ,    API   ,       HTTP.    <a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> , HTTP , <a href="https://en.wikipedia.org/wiki/HATEOAS">HATEOAS</a>      HTTP  .         ,          . </p><br><br><h2>  / </h2><br><p>      ‚Äú ‚Äù  ‚Äú‚Äù.     . </p><br><br><p>             (,    ).         -. </p><br><blockquote><p>          (        ). </p><br></blockquote><br><br><p>     ,        .      ‚Äú ‚Äù (    ‚Äú‚Äù).   - ,     ,    . ,   <code>RegisterUserCommand</code> ,     .  <code>UpdateBillingCommand</code> ,   ,       . </p><br><blockquote><p>   (),   ,      . </p><br></blockquote><br><br><p>         . ,   ,    ‚Äú‚Äù,     .     ,    .           .      ,     ,   -         .            . </p><br><br><h3>     ? </h3><br><p>      ‚Äî     - ,    .    ‚Äú‚Äù (Command).       ‚Äú ‚Äù (Command Bus)  ,    ‚Äú‚Äù (Handler).            . </p><br><br><p> ,         : </p><br><br><ul><li>  Team </li><li>   </li><li>  </li></ul><br><br><p>           <code>execute</code> .    ,   -  ,      .  ,    <code>handle</code> ,      . </p><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommandBus</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommandBus</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      public function execute($command) { return $this-&gt;resolveHandler($command)-&gt;handle($command); } }</span></span></code> </pre><br><br><p>  ,       ,       .  ,        ,            (  ).              (CLI, API-  ..). </p><br><br><p>       ( web, http api, cli,  )       . </p><br><br><p>  , ,     WEB, HTTP  CLI      . </p><br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleSomeRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $registerUserCommand = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RegisterUserCommand( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;username, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;email, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;password ); $result = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commandBus-&gt;execute($registerUserCommand); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Redirect::to(<span class="hljs-string"><span class="hljs-string">'/account'</span></span>)-&gt;with([ <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'success'</span></span> ]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>( \<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Redirect::to(<span class="hljs-string"><span class="hljs-string">'/user/add'</span></span>)-&gt;with( [ <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; $e-&gt;getMessage() ] ); } }</code> </pre><br><br><p>       ,          ,     .   ,    .    ,     WEB-,  HTTP API   -. </p><br><br><p> ,      .       ,        (HTTP, CLI, API, AMQP     )!             .            (    ). </p><br><br><p>            -  . , ,  ,      ,     .      ,       . </p><br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/67b/3a7/aff/67b3a7affa107cb16ef99095b4696d3a.jpg"></p><br><br><p>         .          (   ..)   ,   ,  . </p><br><br><p>    ,           . ,     <strong>      </strong> .    ,        .    ,          -     . </p><br><br><h2>  ,      </h2><br><p>  ,    . ,   ,    .  ,   ,       . </p><br><br><p>        .    .      ,      . ,   ,    ,   ,   - .       .    (     )  DTO (Data Transfer Object). </p><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegisterUserCommand</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($username, $email, $password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    } //   }</span></span></code> </pre><br><br><p> ,        .           . </p><br><br><p>     .    ,       ,   .        .         ,   ,   .     ‚ÄúOK‚Äù,     ,      . </p><br><br><p>     DTO (  ),     ,    . ,    ,           . </p><br><br><p>           ,        .       ,         . </p><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Handler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($command)</span></span></span></span>; }</code> </pre><br><br><p>     <code>handle</code> ,   ,   ,        .    ,       <code>RegisterUserCommand</code> : </p><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegisterUserHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($command)</span></span></span><span class="hljs-function"> </span></span>{ $user = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User; $user-&gt;username = $command-&gt;username; $user-&gt;email = $command-&gt;email; $user-&gt;password = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;auth-&gt;hash($command-&gt;password); $user-&gt;save(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;dispatcher-&gt;dispatch( $user-&gt;flushEvents() ); <span class="hljs-comment"><span class="hljs-comment">//   ,    DTO, //  ,      //     "" (   ) //       . //        return $user-&gt;toArray(); } }</span></span></code> </pre><br><br><p>   ,        ,  ,    ,        (      - ). </p><br><blockquote><p>       ,            ,  ,             . </p><br></blockquote><br><br><p> ,        ‚Äî   (Command Bus). </p><br><br><p>        . ,       (    ).       ,        ,    .          ,                . </p><br><br><p>     ,      : </p><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommandBus</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($command)</span></span></span></span>; }</code> </pre><br><br><p>       .   : </p><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommandBus</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommandBus</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Container $container, CommandInflector $inflector)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;container = $container; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;inflector = $inflector; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($command)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;resolveHandler($command)-&gt;handle($command); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolveHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($command)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;container-&gt;make( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;inflector-&gt;getHandlerClass($command) ); } }</code> </pre><br><br><p>     <code>CommandInflector</code> ,     ,      . ,    <code>str_replace('Command', 'Handler', get_class($command));</code>  .       ,            (   PSR- ).     ,  .         . </p><br><br><p>     ,    ‚Äú‚Äù,    ?           ( <code>SynchronousCommandBus</code> ),       .   ,   .   ,         ( <code>AsynchronousCommandBus</code> ).     ,              ,    . </p><br><br><p>     ,          . ,               . </p><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ValidationCommandBus</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommandBus</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CommandBus $bus, Container $container, CommandInflector $inflector)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($command)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;validate($command); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;bus-&gt;execute($command); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($command)</span></span></span><span class="hljs-function"> </span></span>{ $validator = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;container-&gt;make(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;inflector-&gt;getValidatorClass($command)); $validator-&gt;validate($command); <span class="hljs-comment"><span class="hljs-comment">//       } }</span></span></code> </pre><br><br><p>  <code>ValidationCommandBus</code>  .   ‚Äî          ,   .       (  ?    ),    ,     . </p><br><br><p> ,       ,         ,           ( )! </p><br><br><p>           .    ( )   ,     . ,    ,    . </p><br><br><h2>  </h2><br><p> -      .         :  .    ( )      .         ,     .        ,     . </p><br><br><p>   ,       .    ,       ,       .     ,        .  . </p><br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/10c/5f4/def/10c5f4defb48f85ed93c30f5fcc7e0a4.jpg"></p><br><br><h3> :   </h3><br><p>       / ‚Äú‚Äù.     HTTP ,     - ,   ,    . ,  HTTP      ,     .          ,   ,     -   .       .        .       ,     .      ,      .    ,  ( )    ,    . </p><br><br><p>      ,  ,   ,     .     ,          .     ,         .       .        . </p><br><br><h3> :   (DI) </h3><br><p>    ,    .  ,        - ,         .  : </p><br><br><p>            ,    .       -  . </p><br><br><p>      -     .    email-   ,      AWS SES,    ,         SES    . </p><br><br><p>    ,         ,    !      ? </p><br><br><p>     ‚Äú‚Äù.        <strong>Dependency Inversion</strong>    c.  <strong>D</strong>  SOLID.         . </p><br><br><p>     .      ,     .             .            ,    .     . </p><br><br><p>          .           (     ).    ,    ,          .           ,          ( ,        ). </p><br><br><p>   ( )  .       ,    -   .       <code>Notifier</code> .    ,       .        .  ,   <code>Notifier</code>            .      ,   .         .        ,     ,    . </p><br><br><p> ,  .           .      ,     .      ,      ! </p><br><br><h2>  Conclusion </h2><br><p>     !         .      ,    .       ,       ‚Äú  !‚Äù. </p><br><br><p>  ,    ‚Äú‚Äù   .   -      .      ,   ,    ,    . </p><br><br><p>            ,         . </p><br><br> <b><i>       (- , ,    )  .   .</i></b> </div><p>Source: <a href="https://habr.com/ru/post/267125/">https://habr.com/ru/post/267125/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267115/index.html">Back to basics</a></li>
<li><a href="../267117/index.html">Security Week 38: Attack on Cisco routers, bug in AirDrop, arrest of cryptobarg</a></li>
<li><a href="../267119/index.html">Practice IronScheme</a></li>
<li><a href="../267121/index.html">Links search - getting data about Portmone and Fidobank clients</a></li>
<li><a href="../267123/index.html">Histogram and box with a mustache on the fingers</a></li>
<li><a href="../267127/index.html">Airbnb pricing algorithm secrets</a></li>
<li><a href="../267131/index.html">Application for pumping. How to speed up loading C # / XAML Windows Store apps</a></li>
<li><a href="../267135/index.html">Testing sites using builds: what it is and how it works</a></li>
<li><a href="../267141/index.html">SYNful Knock backdoor to attack routers: what's the problem and how to defend</a></li>
<li><a href="../267149/index.html">Forwarding DLNA to a remote network</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>