<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a bonus system in Unity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What would Sonic The Hedgehog be like without gold rings and high-speed boots, Super Mario without mushrooms, or Pac-Man without flashing dots? All th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a bonus system in Unity</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c8b/51e/6b6/c8b51e6b609056a7482f84c689740da7.png" alt="image"></div><br>  What would Sonic The Hedgehog be like without gold rings and high-speed boots, Super Mario without mushrooms, or Pac-Man without flashing dots?  All these games would be much more boring! <br><br>  <em>Power-ups</em> are an essential component of the gameplay, because they add new levels of complexity and strategy, prompting the player to act. <br><br>  In this tutorial you will learn the following: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Design and build a bonus system with the possibility of repeated use in other games. </li><li>  Use a message-based communication system in the game. </li><li>  Implement it all in a top view game using your own bonuses! </li></ul><a name="habracut"></a><br><blockquote>  <em>Note:</em> this tutorial assumes that you are familiar with Unity and have at least an average knowledge of C #.  If you need to refresh your knowledge, then study our other <a href="https://www.raywenderlich.com/category/unity">tutorials on Unity</a> . </blockquote><br>  To repeat the tutorial's actions, you will need Unity 2017.1 or a newer version, so upgrade your version of Unity if you have not done so yet. <br><br><div class="spoiler">  <b class="spoiler_title">4MB GIF</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/28f/094/b9d/28f094b9d3f436ec4642b3ff04e4a0d8.gif" alt="image"></div></div></div><br><h2>  Getting Started </h2><br>  The game on which we will work is a two-dimensional arcade with a view from above, where the player tries to dodge enemies;  it is a bit like Geometry Wars, but without shooting (and without commercial success).  Our hero in the helmet must dodge enemies in order to reach the exit;  when faced with enemies, his health decreases.  When health ends, the game over comes. <br><br>  Download the <a href="">project template</a> for this tutorial and extract it to the desired folder.  Open the project in Unity and examine the project folders: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/021/469/caf/021469cafb20755cf41b19a8f4f6bbcd.png"></div><br><ul><li>  <em>Audio</em> : contains game sound effect files. </li><li>  <em>Materials</em> : game materials. </li><li>  <em>Prefabs</em> : contains prefabs of the game, including the playing field, player, enemies, particles and bonuses. </li><li>  <em>Scenes</em> : here is the main scene of the game. </li><li>  <em>Scripts</em> : contains scripts of the C # game with detailed comments.  You can explore these scripts if you want to get better at them before starting. </li><li>  <em>Textures</em> : source images used for the game and screen saver. </li></ul><br>  Open the scene called <em>main</em> and click on the <em>Play</em> button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d47/4a6/c2a/d474a6c2ab375da85895bad177594354.png"></div><br>  You will see that there are no bonuses in the game yet.  Therefore, the level is difficult to pass and the game seems a bit boring.  Our task is to add bonuses and liven up the game.  When a player picks up a bonus, a quote from a famous movie series appears on the screen.  See if you can recognize her.  The answer will be at the end of the tutorial! <br><br><h2>  Bonus life cycle </h2><br>  A bonus has <em>a life cycle</em> consisting of several separate states: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/854/baf/6e3/854baf6e3be8d60e131e4abda1514daa.png"></div><br><ul><li>  The first stage is the <em>creation</em> that is performed in the game process or at the development stage, when you manually place GameObject bonuses in the scene. </li><li>  Next comes the <em>mode of attracting attention</em> , when bonuses can become animated or otherwise attract the attention of the player. </li><li>  The <em>collection</em> stage is a pick-up action that triggers sounds, particle systems, or other special effects. </li><li>  The selection of the bonus leads to the performance of the <em>payload</em> , in which the bonus ‚Äúdoes its job‚Äù.  Anything can be a payload, from a modest increase in health to giving a player some amazing superpowers.  The payload stage also triggers <em>an expiration check</em> .  You can set up a bonus so that it ceases to act after a certain time, after the player is touched by the enemy, after several applications or after the fulfillment of any other condition of the game process. </li><li>  The validity check leads to the <em>completion</em> stage.  The completion stage destroys the bonus and becomes the end of the cycle. </li></ul><br>  The above life cycle contains elements that should be used in any game, and elements that relate only to a particular game.  For example, checking a player‚Äôs selection of a bonus should be used in each game, but a certain payload that makes a player invisible may be used only in this game.  It is important to take this into account when creating a script logic design. <br><br><h2>  Create a simple star bonus </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43d/756/e57/43d756e5762815424b3dfcb4e2e0d10b.png" height="50%" width="50%"></div><br>  Most likely, you are familiar with the bonuses of the "entry level", which are gold coins, stars or rings, giving points or an increase in health.  Now we will create a bonus star in the scene, which gives the player an instant health boost and increases the hero‚Äôs chances of passing the level alive. <br><br>  To escape from the level, it will not be enough to count only on the stars, so that later we will add other bonuses that give our hero advantages in battle. <br><br>  Create a new <em>Sprite</em> , name it <em>PowerUpStar</em> and position it directly above the hero at <em>(X: 6, Y: -1.3)</em> .  To make the scene orderly, make the sprite a child of an empty GameObject <em>PowerUps</em> in the scene: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a5/92f/55d/9a592f55de651c247f643eed2d35181d.png"></div><br>  Now we will set the appearance of the sprite.  Enter values ‚Äã‚Äãfor <em>Transform Scale</em> <em>(X: 0.7, Y: 0.7)</em> , in the <em>Sprite Renderer</em> component, assign a star to the <em>Sprite</em> slot, and for Pale <em>color,</em> select a pale brown color <em>(R: 211, G: 221, B: 200)</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e2f/35c/031/e2f35c031a00caf6d6f764c536545408.png"></div><br>  Add the <em>Box Collider 2D</em> component, check the <em>Is Trigger</em> checkbox and change the <em>Size</em> to <em>(X: 0.2, Y: 0.2)</em> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/274/329/8ad/2743298ad8eb4698184168ccb0eb7ee4.png"></div><br>  We just created the first bonus!  Run the game to make sure everything looks good.  The bonus appears, but when you try to raise it, nothing happens.  To fix this, we need scripts. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a12/32e/95c/a1232e95c5f02143b50d0d070e2ff571.png"></div><br><h3>  Separate game logic from class hierarchy </h3><br>  Being responsible developers, we want to spend our time optimally and reuse elements from previous projects.  To apply this to the bonus system, we need to create its design with a <em>class hierarchy</em> .  The class hierarchy divides the logic of bonuses into a reusable part of the engine and a part related only to a specific game.  If you don‚Äôt know the idea of ‚Äã‚Äãclass and inheritance hierarchies, then <a href="https://videos.raywenderlich.com/courses/47-beginning-c/lessons/24">we have a video explaining all these concepts</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f1c/7f8/29e/f1c7f829e4c119caf29509ea1fb07007.png"></div><br>  The diagram above shows the <code>PowerUp</code> class as the parent class.  It contains game-independent logic, so we can reuse it ‚Äúas is‚Äù in almost any other project.  There is already a parent class in the tutorial project.  The parent class controls the bonus life cycle, the various states that a bonus may have, it handles collisions, picking up a bonus, payloads, messages, and the termination of the bonus. <br><br>  The parent class implements a simple finite automaton that tracks the bonus life cycle.  <i>We</i> need to implement a subclass and inspector values ‚Äã‚Äãfor each new bonus, and that‚Äôs it! <br><br><h3>  Bonus Coding Checklist </h3><br>  <em>Note:</em> to create a bonus script, we must create a subclass of the <em>PowerUp</em> class and ensure that all list items are executed.  In the tutorial, we will refer to this list several times, so keep it handy! <br><br><ol><li>  Implement <code>PowerUpPayload</code> to run the payload. </li><li>  Optional: implement <code>PowerUpHasExpired</code> to remove the payload from the previous step. </li><li>  Call <code>PowerUpHasExpired</code> when the bonus expires.  If the validity expires immediately, check the <em>ExpiresImmediately</em> checkbox in the inspector, because in this case there is no need to call <code>PowerUpHasExpired</code> . </li></ol><br>  Let's think about what the bonus star does: it just gives a small boost to health.  To do this, a small script is enough. <br><br><h3>  Create the first script for the bonus </h3><br>  Add a new script to the <i>PowerOpStar</i> GameObject, name it <em>PowerUpStar</em> and open it in the editor. <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bef/232/a9d/bef232a9dd998b3a4be55debe2939fc4.gif"></div></div></div><br>  Add the following code, replace most of the initial Unity boilerplate code, leaving only the <code>using</code> constructs at the beginning. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PowerUpStar</span></span> : <span class="hljs-title"><span class="hljs-title">PowerUp</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> healthBonus = <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PowerUpPayload</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//  1   { base.PowerUpPayload(); //       playerBrain.SetHealthAdjustment(healthBonus); } }</span></span></span></span></code> </pre><br>  The code is rather short, but it is enough to implement the logic of the star!  The script matches all items in the checklist: <br><br><ol><li>  <code>PowerUpPayload</code> gives the player some health, <br>  calling <code>playerBrain.SetHealthAdjustment</code> .  The parent class <code>PowerUp</code> has already taken care of getting the link to <code>playerBrain</code> .  The fact that we have a parent class means that we have to call <code>base.PowerUpPayload</code> to ensure that all the underlying logic is executed before our code. </li><li>  We do not need to implement <code>PowerUpHasExpired</code> , because the addition of health is not canceled. </li><li>  This bonus expires immediately, so we don‚Äôt need to write anything again;  it is enough to put the <em>ExpiresImmediately</em> flag in the inspector.  The time has come to save the method and return to Unity to make changes to the inspector. </li></ol><br><h3>  Creating the first bonus in the scene </h3><br>  After saving and returning to Unity GameObject, <em>StarPowerUp</em> will look like this in the inspector: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d29/a79/792/d29a79792a4d54a21d05f33545cd0e53.png"></div><br>  Enter the inspector values ‚Äã‚Äãas follows: <br><br><ul><li>  <em>Power Up Name</em> : Star </li><li>  <em>Explanation</em> : Recovered some health ... </li><li>  <em>Power Up Quote</em> : (I will probably not imagine) </li><li>  <em>Expires Immediately</em> : Checked </li><li>  <em>Special Effect</em> : drag the prefab from the <em>Prefabs / Power Ups / ParticlesCollected</em> project folder </li><li>  <em>Sound Effect</em> : drag a sound clip from the <em>Audio / power_up_collect_01</em> project folder </li><li>  <em>Health Bonus</em> : 40 </li></ul><br>  After you do this, the bonus will look like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dfa/ab7/900/dfaab790081fca011668bce5ffd01875.png"></div><br>  After completing the PowerUpStar options, drag it to the <em>Prefabs / Power Ups</em> project tree folder to create the prefab. <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08a/831/50a/08a83150a886120c78501490bedf74cf.gif"></div></div></div><br>  Use the new prefab to add a few stars on the right side of the scene. <br><br>  Launch the scene and guide the hero to the first bonus.  The selection of the bonus will be accompanied by wonderful sound effects and particles.  Fine! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70c/55e/2f6/70c55e2f63bf43caf175b3ecc8630c57.png"></div><br><h2>  Message Based Communication </h2><br>  The next bonus we create requires background information.  To get this information, we need GameObjects to learn how to exchange data with each other. <br><br>  For example, when we select a bonus, the UI needs to know what information to display.  When a player‚Äôs health changes, the energy bar should know what the updated level of health has become.  This can be implemented in a number of ways, but <a href="https://docs.unity3d.com/410/Documentation/ScriptReference/index.Accessing_Other_Game_Objects.html">several mechanisms are listed in the Unity manual</a> . <br><br>  Each method of communication has its pros and cons, and you can not pick one that is suitable for all occasions.  In our game, we implement <em>communications based on messages</em> , as described in <a href="https://docs.unity3d.com/Manual/MessagingSystem.html">the Unity manual</a> . <br><br>  We can do GameObjects by <em>sending messages</em> , <em>receiving messages</em> , or both: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/760/fa0/d21/760fa0d21e5debf36226383d9fefb985.png"></div><br>  In the left part of the above scheme, <em>the message transmitters are</em> presented.  You can consider them objects, ‚Äúscreaming‚Äù when something interesting happens.  For example, if a player sends the message "I was touched."  The right side of the diagram shows the <em>message listeners</em> .  As the name implies, they listen to messages.  Listeners are not required to listen to <i>all</i> messages;  they only listen to messages they want to respond to. <br><br>  Message transmitters can also be listeners.  For example, the bonus sends messages, but also listens to the player's messages.  A good example here can be a bonus, which expires when a player is hit by enemies. <br><br>  It can be understood that in the presence of multiple transmitters and multiple listeners, there must be a plurality of intersecting lines between the left and right sides.  To make our lives easier, Unity has an <em>EventSystem</em> component that sits in the middle: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cbe/fb7/914/cbefb7914977bd033a3f64a4980f5ed1.png"></div><br>  Unity uses the extensible <em>EventSystem</em> component to process input.  Also, this component controls most of the send and receive event logic. <br><br>  Yes, a lot of theory, but to summarize: the message system will allow bonuses to conveniently listen to the gameplay and reduce the number of hard connections between objects.  This will simplify the addition of new bonuses, especially in the later stages of development, because most of the messages will already be transmitted. <br><br><h3>  Stages of creating a communication based on messages </h3><br>  Before we start creating, we need a bit of theory.  To broadcast a message, we need to perform the following steps: <br><br><ul><li>  Transmitters define the message they want to transmit as the C # interface. </li><li>  The transmitters then transmit messages to listeners stored in the listener list. </li></ul><br>  See <a href="https://videos.raywenderlich.com/courses/47-beginning-c/lessons/29">this video about C # interfaces</a> if you need to refresh your knowledge. <br><br>  In short, the interface defines the method signatures.  Any class that <em>implements the</em> interface promises to provide functionality to these methods. <br><br>  This can be seen more clearly with an example.  Look at the code in the <em>IPlayerEvents.cs</em> file: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IPlayerEvents</span></span> : <span class="hljs-title"><span class="hljs-title">IEventSystemHandler</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPlayerHurt</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newHealth</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPlayerReachedExit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameObject exit</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br>  This C # interface has methods for <code>OnPlayerHurt</code> and <code>OnPlayerReachedExit</code> .  These are messages that a player can send.  Now look at the <code>SendPlayerHurtMessages</code> method in the <code>SendPlayerHurtMessages</code> file.  The lines labeled with numbers in the following code snippet are described below: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendPlayerHurtMessages</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     foreach (GameObject go in EventSystemListeners.main.listeners) // 1 { ExecuteEvents.Execute&lt;IPlayerEvents&gt; // 2 (go, null, // 3 (x, y) =&gt; x.OnPlayerHurt(playerHitPoints) // 4 ); } }</span></span></code> </pre> <br>  The above method handles sending an <code>OnPlayerHurt</code> message.  The <code>foreach</code> bypasses all listeners stored in the <code>EventSystemListeners.main.listeners</code> list and calls <code>ExecuteEvents.Execute</code> for each listener that sends messages. <br><br>  Lets go over comments with numbers: <br><br><ol><li>  <code>EventSystemListeners.main.listeners</code> is a GameObjects list that is globally visible in the <code>EventSystemListeners</code> singleton object.  Any GameObject that wants to listen to all messages should be on this list.  You can add GameObjects to this list by assigning a <code>Listener</code> to a GameObject in the inspector or by calling <code>EventSystemListeners.main.AddListener</code> . </li><li>  <code>ExecuteEvents.Execute</code> is a method provided by Unity that sends a GameObject message.  The type in angle brackets is the name of the interface containing the message we want to send. </li><li>  This defines a GameObject to which to send a message and <code>null</code> for additional event information in accordance with the <a href="https://docs.unity3d.com/Manual/MessagingSystem.html">syntax example from the Unity manual</a> . </li><li>  <em>Lambda expression</em>  This is a <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/statements-expressions-operators/lambda-expressions">complex C # concept</a> that we will not cover in this tutorial.  In short, a lambda expression allows you to pass code to a method as a parameter.  In our case, the code contains the message we want to send ( <code>OnPlayerHurt</code> ) along with the parameters ( <code>playerHitPoints</code> ) it <code>playerHitPoints</code> . </li></ol><br>  The project is already configured to send all the necessary messages.  Some of them may be useful if you want to expand the project and add your own bonuses.  By default, all interface names begin with the letter I: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a6/195/c76/8a6195c76bc34a8f87578a748ddd80e6.png"></div><br><ul><li>  <code>IPlayerEvents</code> : used for messages when a player is touched or he gets to the exit. </li><li>  <code>IPowerUpEvents</code> : used for messages when a bonus is selected or its action ends. </li><li>  <code>IMainGameEvents</code> : used for messages when the player wins or loses. </li></ul><br>  All these interfaces are commented out in detail, so you can study them.  It is not necessary to deal with them in this tutorial, if you want, you can move on. <br><br><h2>  Speed ‚Äã‚ÄãBonus </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb5/2bf/bab/bb52bfbab213d786ca43c09f42240b9f.png" width="50%" height="50%"></div><br>  Now that we know about communication based on messages, we will use it and listen to the message! <br><br>  We will create a bonus, which gives the player extra speed until the moment he collides with something.  The bonus will recognize the player‚Äôs collision by ‚Äúlistening‚Äù to the gameplay.  More specifically, the bonus will be listened to by the player sending the message ‚ÄúI am hurt‚Äù <br><br>  To listen to the message, we need to perform the following steps: <br><br><ol><li>  Implement the appropriate C # interface to specify what the listener of the GameObject should listen to. </li><li>  Make it so that the listener for GameObjects is in the <code>EventSystemListeners.main.listeners</code> list. </li></ol><br>  Create a new Sprite, name it <code>PowerUpSpeed</code> and place it somewhere in the upper left corner of the arena above the player.  Set its <em>Scale</em> values <em>(X: 0.6, Y: 0.6)</em> .  This GameObject will be a listener, so select the <em>Listener</em> label in the inspector. <br><br>  Add a <em>Box Collider 2D</em> and change its <em>Size</em> to <em>(X: 0.2, Y: 0.2)</em> .  In the <em>Sprite Renderer</em> component, assign the value <em>fast</em> to the <em>Sprite</em> and change its color as we did with the star.  Do not forget to check the <em>Is Trigger</em> box.  After this, the GameObject should look something like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/de9/5e5/8f3/de95e58f334a8b8a54d481827eec2d39.png"></div><br>  Add this PowerObject a new <em>PowerUpSpeed</em> script and paste the following code into the script: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PowerUpSpeed</span></span> : <span class="hljs-title"><span class="hljs-title">PowerUp</span></span> { [Range(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">4.0f</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speedMultiplier = <span class="hljs-number"><span class="hljs-number">2.0f</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PowerUpPayload</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//  1   { base.PowerUpPayload(); playerBrain.SetSpeedBoostOn(speedMultiplier); } protected override void PowerUpHasExpired() //  2   { playerBrain.SetSpeedBoostOff(); base.PowerUpHasExpired(); } }</span></span></span></span></code> </pre> <br>  Check the checklist items.  The script performs each of the points as follows: <br><br><ol><li>  <code>PowerUpPayload</code> .  Calls the <code>base</code> method to provide a call to the parent class, then gives the player an acceleration.  Note that the parent class defines <code>playerBrain</code> , which contains a link to the player who collected the bonus. </li><li> <code>PowerUpHasExpired.</code>  We need to remove the acceleration given to the player, and then call the <code>base</code> method. </li><li>  The last item on the checklist is to call <code>PowerUpHasExpired</code> after the expiration of the bonus.  Later we will implement this by listening to the player's messages. </li></ol><br>  Modify the class declaration to implement an interface for player posts: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PowerUpSpeed</span></span> : <span class="hljs-title"><span class="hljs-title">PowerUp</span></span>, <span class="hljs-title"><span class="hljs-title">IPlayerEvents</span></span></code> </pre> <br><blockquote>  <em>Note:</em> If you are working in Visual Studio, you can <code>IPlayerEvents</code> mouse over the <code>IPlayerEvents</code> element after entering it and select the <em>Implement interface explicitly</em> menu option.  This will create a blank method. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/38f/b1d/ace/38fb1dacedfc295ced7240500c0770e1.png"></blockquote><br>  Add or modify methods until they look like this, and make sure they are still part of the <em>PowerUpSpeed</em> class: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IPlayerEvents.OnPlayerHurt(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newHealth) { <span class="hljs-comment"><span class="hljs-comment">//        if (powerUpState != PowerUpState.IsCollected) { return; } //   ,    PowerUpHasExpired(); //  3   } /// &lt;summary&gt; ///      IPlayerEvents,         /// &lt;/summary&gt; void IPlayerEvents.OnPlayerReachedExit(GameObject exit) { }</span></span></code> </pre> <br>  The <code>IPlayerEvents.OnPlayerHurt</code> method <code>IPlayerEvents.OnPlayerHurt</code> called each time a player takes damage.  This is part of ‚Äúlistening to broadcast messages.‚Äù  In this method, we first make sure that the bonus responds only after selection.  The code then calls <code>PowerUpHasExpired</code> in the parent class, which will handle the expiration logic. <br><br>  Save this method and return to Unity to make the necessary changes to the inspector. <br><br><h3>  Creating a speed increase bonus in a scene </h3><br>  GameObject <i>SpeedPowerUp</i> will now look like this in the inspector: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e54/e16/d10/e54e16d10a47faed92298fe778ff1c94.png"></div><br>  Enter the following values ‚Äã‚Äãin the inspector: <br><br><ul><li>  <em>Power Up Name</em> : Speed </li><li>  <em>Explanation</em> : Super fast movement until enemy contact </li><li>  <em>Power Up Quote</em> : (Make the Kessel run in less than 12 parsecs) </li><li>  <em>Expires Immediately</em> : uncheck </li><li>  <em>Special Effect</em> : ParticlesCollected (same as star) </li><li>  <em>Sound Effect</em> power_up_collect_01 (same as star) </li><li>  <em>Speed ‚Äã‚ÄãMultiplier</em> : 2 </li></ul><br>  After this bonus will look like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dae/3be/0f1/dae3be0f1c4daf30af062330d3f7cf5e.png"></div><br>  After adjusting the parameters of the <em>Speed</em> bonus in the way you want, drag it to the <em>Prefabs / Power Ups</em> project tree folder to create a prefab.  We will not use it in the demo project, but for completeness it is worth doing it. <br><br>  Launch the scene and move the hero to collect the speed bonus, after which he will receive additional speed, which will be maintained until contact with the enemy. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b46/0e5/8e6/b460e58e6064e08dbab6d3c41abc49f4.png"></div><br><br><h2>  Repulsive bonus </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b7/9ab/a92/7b79aba92a348cf31427f06175176354.png" width="50%" height="50%"></div><br>  The next bonus allows the player to push objects away from his path by pressing the <em>P</em> key;  the number of its applications is limited.  You are already familiar with the stages of creating a bonus, so in order not to clutter the text, I will consider only the most interesting parts of the code, and then create a prefab.  This bonus does not need to listen to any messages. <br><br>  Find and study the prefab of <em>PowerUpPush</em> in the project hierarchy.  Open its script called <em>PowerUpPush</em> and examine the code. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7af/20d/29a/7af20d29a78b9aac43d874928aec4657.png"></div><br>  You will see familiar methods that we have already considered.  All interesting actions of the repulsive bonus occur in the <em>Update</em> method: <br><br><pre> <code class="hljs pgsql"> private <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Update</span></span> () { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (powerUpState == PowerUpState.IsCollected &amp;&amp; //<span class="hljs-number"><span class="hljs-number">1</span></span> numberOfUsesRemaining &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) //<span class="hljs-number"><span class="hljs-number">2</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.GetKeyDown ("p")) //<span class="hljs-number"><span class="hljs-number">3</span></span> { PushSpecialEffects (); //<span class="hljs-number"><span class="hljs-number">4</span></span> PushPhysics (); //<span class="hljs-number"><span class="hljs-number">5</span></span> numberOfUsesRemaining<span class="hljs-comment"><span class="hljs-comment">--; if (numberOfUsesRemaining &lt;= 0) { PowerUpHasExpired (); //7 } } } }</span></span></code> </pre> <br>  This is what happens in this code: <br><br><ol><li>  The script should be executed only for collected bonuses. </li><li>  The script should be executed only if the number of uses is left. </li><li>  The script should be executed only when the player clicks P. </li><li>  The script starts the execution of a beautiful particle effect around the player. </li><li>  The script repels enemies from the player. </li><li>  The bonus is used again. </li><li>  If the number of uses has expired, then the bonus expires. </li></ol><br>  The repulsive bonus is very interesting to use, so it is worthwhile to place a couple in suitable places of the scene.  Run the scene again and play with the new bonus. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c8b/51e/6b6/c8b51e6b609056a7482f84c689740da7.png"></div><br><h2>  Additional quest: Invulnerability Bonus </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/db2/bb5/f0f/db2bb5f0fda8d214790ca8ce0575a906.png" width="50%" height="50%"></div><br>  This section is optional, but quite interesting.  Armed with the knowledge gained, create a bonus that makes the player invulnerable for a while. <br><br>  Tips and tricks for this assignment: <br><br><ol><li>  <em>Sprite</em> : locate the sprite in the <em>Textures / shield</em> project folder </li><li>  <em>Power Up Name</em> : Invulnerable </li><li>  <em>Power Up Explanation</em> : You are Invulnerable for a time </li><li>  <em>Power Up Quote</em> : (Great kid, don't get cocky) </li><li>  <em>Coding</em> : Go through the same checklist that we used for the star bonus and speed increase.  You will need a timer controlling the expiration date of the bonus.  The <em>SetInvulnerability</em> method in <em>PlayerBrain</em> will enable and disable invulnerability. </li><li>  <em>Effects</em> : the project contains a particle effect for a beautiful ripple effect around the player, while he remains invulnerable.  The prefab is in <em>Prefabs / Power Ups / Particles Invuln</em> .  You can make it a child instance of the player, while it is invulnerable. </li></ol><br>  Do you need a complete solution or do you want to compare your solution with ours?  Then here it is: <br><br><div class="spoiler">  <b class="spoiler_title">Solution inside</b> <div class="spoiler_text">  Create a new Sprite, name it <em>PowerUpInvuln</em> and place it in <em>(X: -0.76, Y: 1.29)</em> .  For <em>Scale,</em> set the values <em>X: 0.7, Y: 0.7</em> .  This GameObject will not listen to anyone, its validity will simply expire after a specified time, so there is no need to give it a tag in the inspector. <br><br>  Add a <em>Box Collider 2D</em> and change the <em>Size</em> to X = 0.2, Y = 0.2.  In the <em>Sprite Renderer</em> component, set the <em>Sprite</em> value to <em>shield</em> and select a color, as we used to do with other bonuses.  Make sure the <em>Is Trigger</em> checkbox is checked.  After this, the GameObject should look something like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/46f/72f/37c/46f72f37c69835e091d1c676f6f12c30.png"></div><br>  Add to this GameObject a new <em>PowerUpInvuln</em> script and paste the following code into it: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> PowerUpInvuln : PowerUp { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> invulnDurationSeconds = <span class="hljs-number"><span class="hljs-number">5</span></span>f; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> GameObject invulnParticles; private GameObject invulnParticlesInstance; protected override <span class="hljs-type"><span class="hljs-type">void</span></span> PowerUpPayload () //  <span class="hljs-number"><span class="hljs-number">1</span></span>   { base.PowerUpPayload (); playerBrain.SetInvulnerability (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (invulnParticles != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { invulnParticlesInstance = Instantiate (invulnParticles, playerBrain.gameObject.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.position, playerBrain.gameObject.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.rotation, <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>); } } protected override <span class="hljs-type"><span class="hljs-type">void</span></span> PowerUpHasExpired () //  <span class="hljs-number"><span class="hljs-number">2</span></span>   { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (powerUpState == PowerUpState.IsExpiring) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } playerBrain.SetInvulnerability (<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (invulnParticlesInstance != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { Destroy (invulnParticlesInstance); } base.PowerUpHasExpired (); } private <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Update</span></span> () //  <span class="hljs-number"><span class="hljs-number">3</span></span>   { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (powerUpState == PowerUpState.IsCollected) { invulnDurationSeconds -= <span class="hljs-type"><span class="hljs-type">Time</span></span>.deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (invulnDurationSeconds &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { PowerUpHasExpired (); } } } }</code> </pre> <br>  Check the checklist items again.  The script performs these clauses as follows: <br><br><ol><li>  <code>PowerUpPayload</code> : calls the <code>base</code> method to call the parent class, then gives the player an invulnerability bonus.  Also adds the pulsating effect of particles. </li><li>  <code>PowerUpHasExpired</code> : you must remove the received invulnerability bonus and then call the <code>base</code> method. </li><li>  The last item on the checklist is to call <code>PowerUpHasExpired</code> when the bonus expires.  In our case, we use <code>Update()</code> to count down the past tense. </li></ol><br>  Save the script, return to Unity and start the game.  Now you can make your way through attacking enemies, not paying attention to health and safety, until the bonus expires! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0d5/7af/39d/0d57af39dff6cd5c49cb0cd5954cecfa.gif"></div></div></div><br>  I hope you tried to solve the task before you looked at the solution! <br><br><h2>  Where to go next? </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fa/5a2/67e/8fa5a267e7dd90cccf63ed5ce2173533.png"></div><br>  The finished project for this tutorial can be downloaded <a href="">here</a> . <br><br>  If you want to further develop the project, you can do the following: <br><br><ul><li>  Add more bonuses.  How about a bonus shooting rays killing enemies? </li><li>  Create a factory class for randomly creating bonuses in the arena during the game. </li><li>  If you want to further explore Unity, then check out the <a href="https://store.raywenderlich.com/products/unity-games-by-tutorials">Unity Games by Tutorials book</a> from our store. </li></ul><br>  You still do not understand from which series of films these phrases?  The answer is under the spoiler: <br><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text">  Hooray!  You are probably the only person on the Internet who has clicked here!  Answer: these are quotes from the Star Wars series. </div></div></div><p>Source: <a href="https://habr.com/ru/post/348328/">https://habr.com/ru/post/348328/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348312/index.html">How to "learn to learn" - tips, advice and research</a></li>
<li><a href="../348314/index.html">Parsers, word processing. Just about the complicated. CFG, BNF, LL (k), LR (k), PEG and other scary words</a></li>
<li><a href="../348320/index.html">As I prepared a visual novel</a></li>
<li><a href="../348324/index.html">In defense of swap [in Linux]: common misconceptions</a></li>
<li><a href="../348326/index.html">Big Migration: How we raised a private cloud at RISC</a></li>
<li><a href="../348330/index.html">AI @ MIPT: ‚ÄúNeuromorphic computations and brain mechanisms‚Äù</a></li>
<li><a href="../348332/index.html">Bored mail or how to send messages from the site to Telegram via Node.js (Express)</a></li>
<li><a href="../348334/index.html">Game design to life. An example of the analysis of the mechanics of the game</a></li>
<li><a href="../348336/index.html">Animations in Android on the shelves (Part 2. Complex animations)</a></li>
<li><a href="../348338/index.html">Implementing a parallel quick sort using ForkJoinPool</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>