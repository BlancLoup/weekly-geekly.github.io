<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>My Exercise2. PaintUp - coloring multi-colored sketches online</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago I wrote about my android application coloring book and an online gallery for publishing sketches and paintings from the application. The...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>My Exercise2. PaintUp - coloring multi-colored sketches online</h1><div class="post__text post__text-html js-mediator-article"><img src="http://radikal.ua/data/upload/4efc3/6895e/ab913a0605.jpg" alt="image" align="left"><br>  Some time ago I <a href="http://habrahabr.ru/blogs/android_development/126238/">wrote</a> about my <a href="https://market.android.com/details%3Fid%3Dcom.PaintUp">android application</a> coloring book and an <a href="http://paintup.net/">online gallery</a> for publishing sketches and paintings from the application.  The idea of ‚Äã‚Äãa browser-based online coloring is quite logical, but somehow there was no incentive to sit down and do it.  It was obvious that I would have to use technologies that I didn‚Äôt work with and it didn‚Äôt inspire much.  But somehow there was time and I decided to try.  Looking ahead to say that in the process revealed quite obscure properties of browsers.  It turned out that there are online compilers (in particular, with ++) that produce executable files for windows and linux.  And besides, I had to install Linux for the first time (Ubuntu). <br><a name="habracut"></a><br>  So, the main wish was to try to hide the coloring algorithm itself.  As a consequence, the implementation of the algorithm on JS disappears.  It remains either to use a different browser technology, or to leave the browser only drawing, and the coloring "read" on the server. <br><br>  The first thing that comes to mind is flash.  To some extent, it allows you to protect the code and, at the same time, you can combine drawing and coloring in one application.  But I never worked with a flash.  I installed the adobe flash trial, downloaded a similar example and ... somehow I didn‚Äôt work with a flash.  I had to postpone this option and try something else. <br><br>  The next option was a Java browser application.  But it was dropped because of the need for the application to run additional software. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So I smoothly approached the option of browser drawing and server account. <br><br>  Browser drawing is canvas or svg.  But it turns out a very bad feature of browsers from the point of view of the coloring algorithm.  When drawing lines, non-switchable antialiasing is used.  At first there were attempts to combat this software replacement of all at least some transparent pixels with the background color.  But as it turned out, transparency is not everything.  Smoothing occurs not only with the help of transparency - but also by color.  That is, a drawn and ‚Äúopaque‚Äù monochrome line contains pixels differing in one or several RGB components by up to 5 units.  In my case, this is a serious problem, since the algorithm should get all the pixels of the same color for a single-color line.  And it is solved in two ways.  Either by preprocessing with artificial replacement of ‚Äúsimilar‚Äù pixels by pixels of the desired color, or by pixel-by-pixel drawing.  The second way was chosen - drawing via putImageData.  It was necessary, however, to write a search function for a pixel ‚Äústraight line‚Äù connecting two points. <br><br>  Ok, with drawing in the first approximation everything is clear.  To transfer the image to the server use jquery.  Now server solver. <br><br>  First, I ported the coloring algorithm from C ++ to PHP.  It turned out very expensive - even a small image (200x300) with two color lines is painted for about 40 seconds.  We do not need such hockey.  Therefore, I start to think in the direction of a C ++ application that either spins on the server as a service, or it is started by a PHP controller.  Here the difficulties were already organizational.  First of all, to start the service, besides having a dedicated server with root-rights, you also need to be able to administer it.  And I, unfortunately, do not possess the necessary skills.  Here I was very lucky for the first time.  On one of my ‚Äúregular‚Äù hosting sites, it was possible to run PHP exec in PHP.  The case remained behind the utility build under linux.  Unfortunately, even here I didn‚Äôt have enough experience, so I spent some time searching for online compilers.  Found only one <a href="http://www.onlinecompiler.net/">www.onlinecompiler.net</a> , and then without the ability to compile multi-file projects.  But it was enough for tests (it was possible to call the http script-controller, which ran an empty program and returned the value). <br><br>  It was too late to retreat, and I decided to try ubuntu.  I downloaded the image, launched it through vmware and started reading the literature on ‚Äúthe topic of compiling projects in Linux‚Äù :) I was lucky here a second time, because I managed to compile my project into an executable file from almost half a kick. <br><br>  If you, the username, have ever folded puzzles, then you will remember the feeling when you already have several assembled large but separate pieces on the table and then, finally, they begin to connect with each other.  Yes, after successfully assembling the executable file, I felt about the same thing. <br><br>  It was a small matter.  Put on the server index.php with the drawing on js, put solver.php on which the browser sends the ‚Äútask‚Äù and gets the coloring, lay out and set the execution flags for the a.out executable and so on to the little things. <br><br>  And the chain came to life. <br>  As a result, JS allows you to draw a task and sends it as a PNG file using AJAX to a server-side PHP controller.  The controller accepts a PNG, opens it, does some preprocessing, stores the result in a temporary BMP, and sets the ./a.out on it.  He opens the BMP, does the coloring, saves the result to the new BMP and transfers control back to the PHP controller.  The controller opens the result, presses it in JPEG, deletes all intermediate files and gives the HTTP request the address of the JPEG picture to the pending answer.  Client JS, receiving the address of the picture, creates a tag and shows the result of the entire work to the user in the browser. <br><br>  This scheme is certainly far from ideal.  And it‚Äôs not even the fact that a decent part of file manipulations can be transferred to the C ++ side.  In an amicable way, the application should turn around.  Well, or in extreme cases, be used as a php extension.  But this does not prevent to feel the feeling of the complete gestalt :) <br><br>  PS: For those who wish to try out - a <a href="http://adsite.com.ua/images/paint/">test version of the assembly</a> .  To reduce the load (and this is a common shared hosting), the size of the ‚Äútask‚Äù is limited to 250x350 pixels, and the number of colors is 15 tons.  Draw at least two color lines, press PaintUp and get coloring.  Please do not abuse :) <br><br>  PPS: Coloring will be deleted, so if you want to save it to memory, save it locally. </div><p>Source: <a href="https://habr.com/ru/post/126808/">https://habr.com/ru/post/126808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126802/index.html">Something about how javascript include javascript</a></li>
<li><a href="../126803/index.html">VHDL delay element. Another look</a></li>
<li><a href="../126804/index.html">Non-standard use of Get and Set in Javascript</a></li>
<li><a href="../126805/index.html">WAART with joint forces</a></li>
<li><a href="../126806/index.html">Interception of smartphone keystrokes using an accelerometer</a></li>
<li><a href="../126810/index.html">Introduction to Multivariate Analysis</a></li>
<li><a href="../126811/index.html">Our projects: SMS payments "for the lazy"</a></li>
<li><a href="../126812/index.html">Are frameworks making developers stupid?</a></li>
<li><a href="../126813/index.html">10 useful tools for working with VMware</a></li>
<li><a href="../126814/index.html">Development on a laptop. Laptop monitor size you program at home</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>