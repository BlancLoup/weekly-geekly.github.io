<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>C ++ nested functions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings to the community! 

 I came across the opportunity to do something in C ++ that resembles the declaration of functions inside functions. It ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>C ++ nested functions</h1><div class="post__text post__text-html js-mediator-article">  Greetings to the community! <br><br>  I came across the opportunity to do something in C ++ that resembles the declaration of functions inside functions.  It looks like this: <br><br><pre><code class="hljs mel">#include &lt;iostream&gt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> main() { inline_function(std::<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> s) { std::cout &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Hello, "</span></span> &lt;&lt; s &lt;&lt; <span class="hljs-string"><span class="hljs-string">"!\n"</span></span>; } with_name(make_hello); make_hello(<span class="hljs-string"><span class="hljs-string">"Vasiliy Pupkin!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the example above, a nested ‚Äúmethod‚Äù is made inside the main method with the name make_hello and then called with the ‚ÄúVasiliy Pupkin‚Äù parameter.  Of course, <code>Hello, Vasiliy Pupkin!</code> will be displayed on the screen <code>Hello, Vasiliy Pupkin!</code>  . <br><br>  Unfortunately, I didn‚Äôt manage to drag the name up. <br><br><a name="habracut"></a><br><br>  This is done, of course, on macros. <br><br><h2>  Examples of the same without macros </h2><br><br>  In C ++, there are still <i>no</i> nested functions, so we will have to emulate their syntax with something else.  Therefore, let us ask another question: what exactly looks like the function, but not the function? <br><br>  There are two answers: first, a call to the class constructor without creating an object ‚Äúinto emptiness‚Äù: <br><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><span class="hljs-meta"> int main() { //        class inline_function { public: //          inline_function() { printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello, hell!\n"</span></span></span><span class="hljs-meta">); } }; //      inline_function(); return 0; }</span></span></code> </pre><br><br>  Unfortunately, there are two significant "but", which do not allow to use this example in practice: <br><br>  1. We create one new object for each function call, which is not good.  Well, how do I cycle for a lot of calls?  Overhead can be tolerated on the fact of the declaration of such a thing, but not for use. <br><br>  2. Visual Studio with compiler optimization enabled will simply cut the creation of inline_function () as useless.  The logic of the compiler is clear (nobody will use this created object anyway, so why create it?) But it is dangerous. <br><br>  However, there is another thing called ‚Äúredefinition of operators‚Äù - and we can redefine double parentheses (by a cleverly redefined operator () is called a ‚Äúfunctor‚Äù, how): <br><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><span class="hljs-meta"> int main() { //        class inline_function_class { public: void operator()() { printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello, world!\n"</span></span></span><span class="hljs-meta">); } }; //       --   ! inline_function_class inline_function; //    inline_function(); return 0; }</span></span></code> </pre><br><br>  In this example, almost everything is fine, except that the class can also be made anonymous, so as not to <code>inline_function_class</code> name of the form <code>inline_function_class</code> <br><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><span class="hljs-meta"> int main() { //        class { public: void operator()() { printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello, world!\n"</span></span></span><span class="hljs-meta">); } } inline_function; //       //    inline_function(); return 0; }</span></span></code> </pre><br><br><h2>  We write macros </h2><br>  So, the goal - in principle - has been achieved: we have a way to isolate a piece of code inside one method so as not to spoil the external visibility zone.  But there is one drawback: in all these examples - for my taste - too many letters.  Therefore, we divide our code into three parts: <br><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><span class="hljs-meta"> int main() { //        /**   --   ,   ,     : **/ class { public: void operator()(/*       */) { /**  -- ,  ,     **/ printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello, world!\n"</span></span></span><span class="hljs-meta">); /**   --    **/ } } inline_function; //       /** =============================== **/ //    inline_function(); return 0; }</span></span></code> </pre><br><br>  The first and second parts can be crammed into two macros, giving them some beautiful names.  For example, <br><pre> <code class="hljs swift">#define inline_function(params) \ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> \ </span></span>{ \ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: void <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>() (params)\ {\ #define with_name(value) \ }\ } value; #define with_params(...) __VA_ARGS__ <span class="hljs-comment"><span class="hljs-comment">//  -  ?  .</span></span></code> </pre><br><br>  Using these macros, the code of the ‚Äúnested function‚Äù is much simpler in appearance (although it does not look in the C ++ style): <br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">int</span></span> main() { inline_function(<span class="hljs-type"><span class="hljs-type">char</span></span> * <span class="hljs-type"><span class="hljs-type">name</span></span>) { printf("Hello, %s!\n",<span class="hljs-type"><span class="hljs-type">name</span></span>); } with_name(hello) hello("Pupkin"); }</code> </pre><br><br>  Unfortunately, everything deteriorates if you try to set not one parameter of the function, but at least two.  In this case, the compiler is clicked, they say, in the inline_function macro of the entire ONE parameter and bast.  The problem can be solved by using the __VA_ARGS__ macro (which, although not included in the standard, is supported by all actually used compilers). <br><br>  A little more complicated, but a function with two parameters will still look acceptable: <br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> main() { inline_function (with_params(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b)) { <span class="hljs-keyword"><span class="hljs-keyword">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%d+%d=%d\n"</span></span>,a,b,a+b); } with_name(plus); plus(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre><br><br>  In conclusion, I note that <i>these</i> macros do not provide a return value.  Of course, it can and very simply "forward up", so I leave it to the readers. <br><br>  PS In fact, the technique of making nested classes is as old as the world, and I, of course, did not discover anything new.  Nevertheless, it seems to me that such an article is useful in an educational sense and has some aesthetic completeness. </div><p>Source: <a href="https://habr.com/ru/post/149513/">https://habr.com/ru/post/149513/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149507/index.html">The Ministry of Communications proposes to cancel domestic roaming in Russia</a></li>
<li><a href="../149508/index.html">Designing interfaces for mobile devices: portrait and landscape orientation</a></li>
<li><a href="../149509/index.html">MaskJS, let's talk about the template engine, or a new bike</a></li>
<li><a href="../149510/index.html">IBM PC is 31 years old</a></li>
<li><a href="../149511/index.html">Google unveiled plans for Motorola Mobility</a></li>
<li><a href="../149514/index.html">Library datef - date formatting</a></li>
<li><a href="../149515/index.html">Differences between WP 7.8 and WP 8</a></li>
<li><a href="../149516/index.html">The javascript this keyword is learning to define the context in practice.</a></li>
<li><a href="../149517/index.html">Voluntary contribution instead of prepayment</a></li>
<li><a href="../149518/index.html">HTML5 Audio is a state of affairs. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>