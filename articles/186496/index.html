<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Human parser on Selenium WD</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Start 
 And now it was my turn to buy a car. How do the guys from work, I saw. They go to the site and follow the proposals, well, someone who is a li...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Human parser on Selenium WD</h1><div class="post__text post__text-html js-mediator-article"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/oTeEpKMtwQM%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700190,15700253&amp;usg=ALkJrhjgBwTXboEhR1vGbHwKQ-5bYz4CWg" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Start </h4><br>  And now it was my turn to buy a car.  How do the guys from work, I saw.  They go to the site and follow the proposals, well, someone who is a little older buys a newspaper and looks through ads.  All this is monotonous and did not want to be distracted by the seat, research and clicking on the links.  I just wanted someone to do it for me, there were no such people.  So it was necessary to make the computer do it all. <a name="habracut"></a><br><br><h4>  Formulation of the problem </h4><br>  As I saw the solution to this problem, write a parser, write a mailing script.  The parser should collect ad data from the site (the site I chose ‚Äúfrom hand to hand‚Äù), and the newsletter should send me e-mail messages about the new lot.  The message text should contain: <br><ul><li>  link to the announcement </li><li>  short ad text </li><li>  car price </li><li>  car sale place </li></ul>  The parser should work every N-minutes.  And after it is working out messages should come.  The results of the parsing are recorded in the database, and after sending the message to the mail, mark each advertisement as sent.  I don‚Äôt want to see the same thing a thousand times. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Parser </h4><br>  It was the most difficult step.  I remember, a long time ago, I wrote a parser for classmates.  In PHP.  At first I had to figure out the most social.  network and understand how magically it works.  Then it was necessary to remember all these sessions, cookies and the sequence of clicking on links.  And turning all these thoughts into code?  Oh God.  How I wished that everything would happen clearly.  How I wanted not to think about what the browser has long been able to do.  I wanted my beloved Natasha to finally understand and most importantly see the results of the work, and not the white text on the black background of the command line. <br>  That's why I just wanted to control the browser, which would be understandable and visible.  And here, <b>Selenium WebDriver</b> enters the scene.  With the help of which you can control the browser, being able only to correctly select selectors (css, XPath).  The logic of the parser becomes transparent.  Press the button, wait, enter the data, press the button and that's it.  And no cookies.  Hooray!  And most importantly, I will see everything alive, and not in the logs. <br><br><h4>  Preparatory work </h4><br>  And so we need to install: <br><ul><li>  <a href="http://www.java.com/ru/download/index.jsp">Java</a> - to run Seleniuma. </li><li>  <a href="">Selenium</a> - <a href="">Selenium</a> itself. </li><li>  <a href="http://nodejs.org/download/">Node.JS</a> - everything will be written on js, so without a node in any way. </li><li>  <a href="http://www.mongodb.org/downloads">Mongo DB</a> - a database. </li></ul><br>  Next, in the project folder you will need to install several modules for Node. <br><ul><li>  wd - to work with Seleium. </li><li>  async - to reduce the nesting of our code. </li><li>  mongoose - to work with the base. </li><li>  swig - to generate html files that are sent to the mail </li><li>  emailjs - to send emails </li><li>  cron - to run our scripts every N-minutes (seconds) </li></ul><br>  Let me remind you that the installation of modules looks like this: <pre><code class="javascript hljs">npm install <span class="hljs-string"><span class="hljs-string">" "</span></span></code> </pre> <br>  Now let's run our selenium <br><pre> <code class="javascript hljs">java -jar <span class="hljs-string"><span class="hljs-string">"    selenium'"</span></span></code> </pre><br>  And the database server <br><pre> <code class="javascript hljs">mongod --dbpath <span class="hljs-string"><span class="hljs-string">"    "</span></span></code> </pre><br><br><h4>  We write a parser </h4><br>  Source chose as already said - "From hand to hand."  Now the sequence of actions: <br>  Clear all cookies <br><pre> <code class="javascript hljs">browser.deleteAllCookies();</code> </pre><br>  Choose a region <br><br><img src="https://habrastorage.org/storage2/d5c/aaf/700/d5caaf7004da94759c7ac2e18158aa87.jpg" alt="image"><br>  Here in this field we enter the region that interests us.  The region as well as all other parameters are described in the object, which will be indicated below.  Entering the region and pressing can be described by the following pseudocode: <pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//     browser.elementByCss(LOCATOR.cssPath) .then(function(el){ //  return el.type(OPTION.region); }) .then(function(){ //       LOCATOR.className = ''; LOCATOR.cssPath = '.b-searchRegion &gt; ul:nth-child(1) &gt; li:nth-child(1)'; return browser.elementByXPath('//span[contains(text(), "' + OPTION.region + '")]'); }) .then(function(el){ //    el.click(); });</span></span></code> </pre><br><br>  Next, select the section (I need "Cars") <br><br><img src="https://habrastorage.org/storage2/974/6ec/f11/9746ecf11a881126599b7f3ed1d5796a.jpg" alt="image"><br><br>  You can describe it simply by clicking on a link containing specific text. <pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   browser.waitForVisibleByPartialLinkText(OPTION.category,OPTION.elWait) .then(function(){ //    return browser.elementByPartialLinkText(OPTION.category); }) .then(function(el){ //    el.click(); })</span></span></code> </pre><br><br>  Now the final part of setting the parameters for the search is to click on the ‚Äúmore parameters‚Äù button, enter the price, year of production and other parameters.  All this can be viewed in the video. <br>  As you can see everything is very easy to find the item, find out its unique locator and click, enter or leave it alone. <br>  Actually, it is now necessary to collect data.  Click on the <b>"Show"</b> button, and parsim data.  Getting the text looks easy <pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//    browser.elementByXPathOrNull(locationXPath) .then(function(el){ if(el) { //  return el.text(); } else{ cb('   - ' + locationXPath); } })</span></span></code> </pre><br>  The stop signal for data collection is the absence of a blue right arrow on the results page: <br><img src="https://habrastorage.org/storage2/a32/a26/b09/a32a26b0926ba2591f62e8dd1f3bfa10.jpg" alt="image"><br>  After collecting the data we record their base.  And close the browser. <br>  By the way, here is the object that describes the parameters for finding a car. <pre> <code class="javascript hljs">OPTION = { <span class="hljs-attr"><span class="hljs-attr">region</span></span> : <span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-comment"><span class="hljs-comment">//  category: ' ',//  price : {from : 0 , to : 1800000},// cy : 'RUR',// releaseYear : {from : 2010, to : 2013},//  mileage : {from : 0 , to : 99000 },// mark : ['BMW','', 'Audi','Hyundai'],//  model : ['X1', 'X3', 'X5'],//  carcass : ['', ''],//  transmisson : ['', ''],// motor : [''],//  gear : ['','',' ',' '],// photo : false,//  video : false,//  district : ['',''],//jrheuf area : ['', '', ''],// metro : { lines : ['', ''], //  station : [' .', ' .']//  }, source : [''],//  submitted : ['  '],//   ajaxWaitMilisec : 2000,//  ajax . elWait : 3000//   . },</span></span></code> </pre><br><br><h4>  Work with base </h4><br>  The base structure is as follows <br><pre> <code class="javascript hljs">MONGODBSCHEMA : { <span class="hljs-attr"><span class="hljs-attr">title</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   link : {type : String , unique : true},//   price : String,//  location : String,//   phone : String,//   * text : String, //  * images : Array,//  * sms : {type : Boolean, default : false }, //      * email : {type : Boolean, default : false }//     e-mail    }</span></span></code> </pre><br>  * - the fields that were planned to be used are marked, but I decided to abandon them.  In the future may be needed. <br><br><h4>  We send notifications by mail </h4><br>  This is the easiest moment.  We use for this the emailjs module.  Select all documents from the database in which the "email" field is set to "false".  Sent to my mailbox.  Change the ‚Äúemail‚Äù property to ‚Äútrue‚Äù for sent ones.  Open the phone application that displays our letters and study suitable ones. <br><br><h4>  We do everything every N-minutes. </h4><br>  We use the cron module for this.  We start every 20 minutes first the parser, and then the distribution of letters. <br><br><h4>  That's all </h4><br>  Now I follow the sale of cars when I have a phone at my side.  And there is no unpleasant sediment from a broken brain that stores in itself the entire sequence of magical actions, as before with PHP (the language itself has nothing to do with it).  And there is a feeling that I will write the next parser in about 60 minutes just by recognizing the element locators.  All code is <a href="https://github.com/imschved/humanParser">here</a> . <br>  And I also want to say a huge thank you to my future wife Natasha, for the fact that she is not against all these crazy ideas of mine with home programming, and for the fact that she has such an invigorating and sweet laugh. </div><p>Source: <a href="https://habr.com/ru/post/186496/">https://habr.com/ru/post/186496/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../186486/index.html">The simplest implementation of cross-platform multiplayer on the example of the evolution of a single .NET game</a></li>
<li><a href="../186488/index.html">MikroTik + port knocking over ICMP</a></li>
<li><a href="../186490/index.html">Roskomnadzor plans to block resources with information about blocked resources</a></li>
<li><a href="../186492/index.html">Again on bioinformatics: the assembly of bacterial genomes</a></li>
<li><a href="../186494/index.html">Dune 2 The Building of A Dynasty</a></li>
<li><a href="../186498/index.html">cPanel :: Feature Request :: FastCGI Process Manager (FPM) SAPI</a></li>
<li><a href="../186502/index.html">Overview of the home weather station La Crosse WS9257</a></li>
<li><a href="../186504/index.html">Results of the online conference ruHaxe 2</a></li>
<li><a href="../186506/index.html">Observations and Science</a></li>
<li><a href="../186512/index.html">End of an era, melancholy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>