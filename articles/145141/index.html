<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with isometric matrices. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Isometry is a thing as old as computer games. 
 Now is the time when the Internet and games began to be combined in the browser (flash does not count)...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with isometric matrices. Part 1</h1><div class="post__text post__text-html js-mediator-article">  Isometry is a thing as old as computer games. <br>  Now is the time when the Internet and games began to be combined in the browser (flash does not count). <br>  There are many examples of browser games, most of them are casual games, but for geeks action, RTS and RPG genres are more interesting, and for developers, their implementation. <br><br><img src="https://habrastorage.org/storage2/291/402/7f8/2914027f811d636af0e0f689697e38e6.jpg"><br><br>  For the genre of RTS, RPG and step-by-step strategies, the matrix is ‚Äã‚Äãthe main mechanism for moving units, drawing textures and more.  But when you try to combine the matrix and isometric textures, you will go to hell, from which you will not come out until you write a layer for controlling and influencing this matrix. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Under the cut, I will tell: <br><ol><li>  How to draw an isometric matrix </li><li>  How to draw a fullscreen isometric matrix </li></ol><br><a name="habracut"></a><br><h2>  Introduction </h2><br><br>  It is quite simple to draw an ordinary square matrix, it is symmetric, the search for coordinates is generally not a difficult task, but isometric matrices introduce 2 corrections to the work: <br><ol><li>  Drawing the matrix should occur from the center of the canvas. </li><li>  Visual deception of rendering. </li></ol><br><img src="https://habrastorage.org/storage2/ae9/314/38d/ae931438d31b9d683820dd3b3810da15.jpg"><br><br>  All these problems must be taken into account during implementation. <br><br><h2>  Matrix rendering </h2><br>  As mentioned in the first paragraph of the features of the isometric matrix, the drawing should come from the center of the canvas.  So we need the middle of the canvas. <br><br>  In the second paragraph you should pay attention to the visual deception.  The brain, looking at the image, wants to draw it horizontally, but it needs to be done diagonally, as shown in the next image. <br><img src="https://habrastorage.org/storage2/258/459/893/2584598937fa35b9285a9f74525cf46e.jpg"><br><br>  We have already examined the most basic problems, let's look at the implementation. <br><br>  Everything is commented out, there is a working example, so you can see everything yourself. <br><br><h3>  Drawing implementation </h3><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> element = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); element.width = <span class="hljs-number"><span class="hljs-number">1024</span></span>; element.height = <span class="hljs-number"><span class="hljs-number">512</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ctx = element.getContext(<span class="hljs-string"><span class="hljs-string">'2d'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> image = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Image(); image.src = <span class="hljs-string"><span class="hljs-string">'http://habrastorage.org/storage2/e61/42d/5b2/e6142d5b26d171611d60d5941e390398.png'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     var width = 128; var height = 64; image.onload = function() { function draw(x, y) { ctx.drawImage(image, x - width / 2, y - height / 2, width, height); } //    X  Y   . //         ,     //     ,      . var Xo = 0; var Yo = 0; //    var C = Math.floor(element.width / 2); //    X,     //    Y var Xc = 0; var matrixHeight = 8; var matrixWidth = 8; for(var y = 0; y &lt; matrixHeight; y++) { //  ,       Yo = (height / 2) * y; //        . Xc = C - (width / 2 * y); for(var x = 0; x &lt; matrixWidth; x++) { //     X     . //       ,   . //     Xo = Xc + (x * (width / 2)); //     Y. //     X,     //     X,      Y. Yo += height / 2; draw(Xo, Yo); } } }</span></span></code> </pre> <br>  Here is a finished <a href="http://forum-game.org/examples/habr/canvas/0.html">example.</a> <br><br><h2>  Drawing fullscreen matrix </h2><br>  Well, we were able to draw an isometric matrix, now we need to draw it in fullscreen. <br>  With her a little more complicated, but rather: <br><ol><li>  Calculate the total height of the shift matrix </li><li>  It is necessary to calculate the additional height and width of the matrix, with which the empty area will be filled. </li><li>  Put restrictions on rendering invisible areas </li></ol><br><br><h3>  Theory and practice of calculating the total shear height of the matrix </h3><br>  In practice, when drawing the standard matrix, we get an empty area in the form of a triangle, <br>  which means we can calculate the unknown side and make a shift along its height so that there are no holes left. <br><br>  We know the length of one leg and we can easily find out the length of the hypotinuse. <br><br>  Side A is the known length of the leg (the width of the entire drawing area divided by 2).  Those.  1024px / 2 = 512px, leg length A <br>  side B - we do not know this leg, it will need to be calculated. <br>  side C - Hypotenuse, to find out its length, we need to calculate the length of one of the sides of our small diamond. <br><br>  To do this, take half of the width and half of the height of the rhombus, put them in a square and sum it up, and calculate the square root of the result. <br><pre> <code class="javascript hljs"> ... var width = <span class="hljs-number"><span class="hljs-number">128</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> height = <span class="hljs-number"><span class="hljs-number">64</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> grainLength = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sqrt((width / <span class="hljs-number"><span class="hljs-number">2</span></span>) * (width / <span class="hljs-number"><span class="hljs-number">2</span></span>) + (height / <span class="hljs-number"><span class="hljs-number">2</span></span>) * (height / <span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//   71.554 //  ,    64px   128px image.onload = function() { ...</span></span></code> </pre><br>  Once we have calculated the length of one face of a rhombus, we must take half the width of the canvas, divide it by 32 and multiply the result by the length of the face of the rhombus. <br><br><pre> <code class="javascript hljs"> ... var grainLength = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sqrt((width / <span class="hljs-number"><span class="hljs-number">2</span></span>) * (width / <span class="hljs-number"><span class="hljs-number">2</span></span>) + (height / <span class="hljs-number"><span class="hljs-number">2</span></span>) * (height / <span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> center = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(element.width / <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hypotenuse = center / (width / <span class="hljs-number"><span class="hljs-number">2</span></span>) * grainLength; image.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ ...</code> </pre><br><br>  Next, we give the well-known leg and the hypotenuse squared.  We take away the leg from the hypotenuse, and calculate the square root of the result. <br><pre> <code class="javascript hljs"> ... var hypotenuse = center / (width / <span class="hljs-number"><span class="hljs-number">2</span></span>) * grainLength; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> catheusA = center * center; hypotenuse *= hypotenuse; <span class="hljs-comment"><span class="hljs-comment">//       ,    . var catheusB = Math.sqrt(hypotenyse - catheusA); image.onload = function() { ...</span></span></code> </pre><br><br>  Everything, the equation is solved, it now remains to apply the result in the calculations of the drawing. <br><br><pre> <code class="javascript hljs"> ... for(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; matrixHeight; y++) { Yo = (height / <span class="hljs-number"><span class="hljs-number">2</span></span>) * y; Xc = C - (<span class="hljs-number"><span class="hljs-number">64</span></span> * y); ...</code> </pre><br><br>  As you can see from this <a href="http://forum-game.org/examples/habr/canvas/1.html">example</a> , now we draw a rhombus so that there is no hole on top. <br>  But now there was a problem number 2.  It is necessary to calculate the additional height and width of the area. <br><br>  This is not difficult to do, but now we abandon the static width or height of the matrix. <br>  If the width is greater than the height, then the width must be divided by 32, otherwise the height <br><pre> <code class="javascript hljs"> ... var matrixHeight = (element.width &gt; element.height ? element.width : element.height) / <span class="hljs-number"><span class="hljs-number">32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> matrixWidth = (element.width &gt; element.height ? element.width : element.height) / <span class="hljs-number"><span class="hljs-number">32</span></span>; ...</code> </pre><br>  Well, as I said, we have a third problem.  We are trying to draw areas that are outside the canvas. <br>  This can be limited to the usual condition for the width and height of the canvas, but with an additional increase in the width and height of the image, <br>  so that there are no empty areas. <br><br><pre> <code class="javascript hljs"> ... Xo = Xc + (x * <span class="hljs-number"><span class="hljs-number">64</span></span>); Yo += <span class="hljs-number"><span class="hljs-number">32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Xo &lt; (width / <span class="hljs-number"><span class="hljs-number">-1</span></span>) || Xo &gt; element.width + width || Yo &lt; (height / <span class="hljs-number"><span class="hljs-number">-1</span></span>) || Yo &gt; element.height + height) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; draw(Xo, Yo); ...</code> </pre><br><br>  That's all.  Here is a complete <a href="http://forum-game.org/examples/habr/canvas/2.html">example</a> .  Now you have learned how to draw full-fledged isometric matrices, but this is only half the battle. <br><br>  It will be harder to find entries in the matrix, i.e.  calculate which coordinate of the matrix was clicked and, in the case of calling the coordinate, calculate exactly where the center of this coordinate is.  But more about that in the next article. </div><p>Source: <a href="https://habr.com/ru/post/145141/">https://habr.com/ru/post/145141/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145136/index.html">Class for implementing UNIX daemons in PHP</a></li>
<li><a href="../145137/index.html">Overview of Runet DDoS Attacks: 9: 1 in favor of the primitive</a></li>
<li><a href="../145138/index.html">Groovy as a scripting language and DSL for Java</a></li>
<li><a href="../145139/index.html">3D printing: nylon, ice, chocolate and others</a></li>
<li><a href="../145140/index.html">Windows Sockets, IOCP and Delphi</a></li>
<li><a href="../145142/index.html">Sergey Brin showed Google Glass in a TV interview</a></li>
<li><a href="../145143/index.html">Twitter Bootstrap 2.0.4 Release</a></li>
<li><a href="../145145/index.html">String collections are read-only: we save on matches</a></li>
<li><a href="../145147/index.html">3D printers: even cheaper, more original</a></li>
<li><a href="../145148/index.html">Level Table for System Administrator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>