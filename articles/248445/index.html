<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Deploy an OpenVPN server with an InfoboxCloud control panel in the cloud and set up access for clients</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The process of setting up and managing VPN on a Linux server usually takes a lot of time. And if you can set it up once and forget it, then it is nece...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Deploy an OpenVPN server with an InfoboxCloud control panel in the cloud and set up access for clients</h1><div class="post__text post__text-html js-mediator-article">  The process of setting up and managing VPN on a Linux server usually takes a lot of time.  And if you can set it up once and forget it, then it is necessary to manage VPN users periodically and it would be good if an ordinary employee of the company could do this without access rights to the server and SSH in general.  Often, a scenario is used where a VPN provides access to the internal cloud network for connecting virtual servers to the company's corporate network.  Even for yourself to quickly raise a VPN is useful. <br><br>  In this article, we will literally set up an OpenVPN server in just a few minutes with the ability to easily manage VPN servers, users and organizations, and run it all in <a href="http://infoboxcloud.ru/">InfoboxCloud</a> .  This cloud is present in the Moscow and Amsterdam regions, so you can use VPNs for both corporate purposes and to introduce yourself as a resident of the Netherlands on the network (for example, to use services that are not available in your country). <br><img src="https://habrastorage.org/getpro/habr/post_images/9b4/a60/c62/9b4a60c62f6efe2066e70c80b5c20ba1.png" width="400"><br>  On the server, we will use the <a href="https://pritunl.com/">Pritunl</a> project, which is a control panel that automates the management of OpenVPN configurations.  The pritunl source code is open and available on the <a href="https://github.com/pritunl/pritunl">githab</a> .  The free version is more than enough to use.  Paid allows you to send data for access by email or configure automatic service fault tolerance (which is not very important for InfoboxCloud, since the cloud itself works in a failover cluster) and manage load balancing between multiple servers. <br><a name="habracut"></a><br>  In the very near future, a server template with Pritunl pre-installed will appear in InfoboxCloud and you can create a VPN server in one click. <br><br><h4>  <b>What we need to configure</b> </h4><br><ul><li>  We hope that you already have an account on <a href="http://infoboxcloud.ru/">InfoboxCloud</a> .  If not yet, <a href="http://help.sandbox.infoboxcloud.ru/content/ru/cloud_infrastructure/order_cloud/order_cloud.html">create it</a> . <br>  Then <strong>create a cloud server with Ubuntu 14.04 in the control panel</strong> (do not forget to allocate 1 public IP address to the server and set the required channel speed - up to gigabit).  <strong>When creating a server, you need to set the checkbox "allow OS kernel management".</strong>  After the server has been created, you will receive your access data to the server.  <a href="https://helpdesk.infobox.ru/Knowledgebase/Article/View/400/"><strong>Connect to the server via SSH</strong></a> . </li><li>  We also need a <a href="http://infobox.ru/domains/">domain</a> or subdomain to organize the point of entry into the VPN.  A domain's record A should be sent to the ip ‚Äì address of the created cloud server. </li></ul><br><h4>  <b>Install Pritunl</b> </h4><br>  Having connected to the server from Ubuntu 14.04 via SSH, execute the command: <br><pre><code class="bash hljs">apt-key update &amp;&amp; apt-get update &amp;&amp; apt-get -y upgrade &amp;&amp; apt-get -y install python-software-properties &amp;&amp; apt-get -y install software-properties-common &amp;&amp; add-apt-repository -y ppa:pritunl &amp;&amp; apt-get update &amp;&amp; apt-get -y install pritunl</code> </pre> <br><h4>  <b>Configure the VPN server in the web interface</b> </h4><br>  Open in browser <br><pre> <code class="html hljs xml">https://____:9700</code> </pre><br>  This article uses a test address. <pre> <code class="html hljs xml">https://vpn.trukhin.com:9700</code> </pre><br>  It is proposed to configure the path to the database. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/439/641/a28/439641a286d197d96b01c830f4060430.jpg" width="400"><br><br>  Just click ‚ÄúSave‚Äù.  A login window will open. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/818/782/8bc/8187828bc6d3666424dfe9ea2602b621.jpg" width="300"><br><br>  Use: <br><ul><li>  Login: pritunl </li><li>  Password: pritunl </li></ul><br>  After logging in, you will be prompted to change the password (which is highly recommended), specify the SMTP server data for sending emails (optional) and display the API key for software-based VPN management.  <a href="https://pritunl.com/api.html">Detailed API documentation is here</a> .  If you leave the ip ‚Äì address as it is - the VPN will work through the public Infobox network (great for using the Internet from the Netherlands). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e4c/76b/148/e4c76b148d9f3bbfe498c51774ed4c55.jpg" width="600"><br><br>  After filling out the form you will be taken to the control panel.  So far, there are no VPN users in the system. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/780/50e/8b2/78050e8b215efd293057812cc4648a4d.jpg" width="800"><br><br>  Go to the "Users" section. <br><img src="https://habrastorage.org/getpro/habr/post_images/7b0/ea8/5bc/7b0ea85bca446425661ed64642b2d0e8.jpg" width="800"><br><br>  Add organization. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/602/652/68e/60265268e1dae07c6f96774503012c49.jpg" width="500"><br><br>  Now add a user. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a32/1d7/c23/a321d7c23c763db7fa386ccbc50b72ed.jpg" width="500"><br><br>  It's time to finally create our VPN server.  Click on the "Servers" button. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/797/1ab/9cb/7971ab9cb679686e6c34f345e80d0ffa.jpg" width="800"><br><br>  Click ‚ÄúAdd server‚Äù. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/494/c95/d60/494c95d6070ab6acc3082e676f200190.jpg" width="800"><br><br>  Specify the name of the VPN server ( <strong>must match the domain directed to the VPN server!</strong> ).  You can configure DNS, choose how to use VPN, allow multiple devices to connect at the same time, and even use two-factor authentication with Google Authenticator. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/274/471/aeb/274471aeb1c4b609cbc5b3acbfb1c4d6.jpg" width="600"><br><br>  Now attach the organization (with all users) to the VPN server by clicking ‚ÄúAttach Organization‚Äù. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c4d/e46/fc9/c4de46fc9d9e9e9b41ce0c80657c294b.jpg" width="800"><br><br>  We are already offered our organization and VPN server.  Just hit "Attach". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/782/08a/1bb/78208a1bb693e39108f91b113f123c7f.jpg" width="500"><br><br>  All is ready!  Click ‚ÄúStart server‚Äù to start the VPN server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a1/9e4/f86/2a19e4f8682389e1fc0c49d444d4e1f1.jpg" width="800"><br><br>  Our VPN server has been successfully launched! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ef0/b73/997/ef0b739975d4954cb6a0d63b95a5f7e7.jpg" width="800"><br><br>  Now it remains only to download the OpenVPN configuration file for the user. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0cb/f5a/9d3/0cbf5a9d3030583d81cabc7ef2fc47d9.jpg" width="800"><br><br><h4>  <b>Features of connecting to the internal network InfoboxCloud</b> </h4><br>  This is a very common scenario used by companies.  Servers other than the VPN server and the web server are not assigned a public ip ‚Äì address and they do not have access to the external network.  The user connects via VPN and enters the company's internal network in the cloud. <br><br>  In order for this script to work, first look at <a href="https://panel.infobox.ru/">the</a> InfoboxCloud <a href="https://panel.infobox.ru/">control panel for the</a> private ip ‚Äì addresses of the servers to which you need access. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/403/94f/757/40394f7575fe6195880346997b1166b3.jpg" width="800"><br><br>  When creating a VPN server in pritunl, select the ‚ÄúLocal Traffic Only‚Äù server mode and set the cidr subnet as shown in the screenshot. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e90/931/e59/e90931e59d387e147b3581946594ba83.jpg" width="500"><br><br>  After this, as before, add the company to the VPN server, re-download the settings for connecting the user and connect to the VPN.  Now you can connect to servers that are accessible only from the InfoboxCloud private network. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f7d/0f5/f61/f7d0f5f612cb6e8920fcf144010aab5b.jpg" width="600"><br><br><h4>  <b>Configuring OpenVPN Clients</b> </h4><br>  You can use any OpenVPN client to connect, including setting up a connection from a router, if it supports OpenVPN (for example, Mikrotik).  We will look at ways to connect from the desktop. <br><br><h5>  <b>Setting up an OpenVPN client on Windows</b> </h5><br>  <a href="">Download</a> the OpenVPN client for Windows from <a href="http://openvpn.net/index.php/open-source/downloads.html">here</a> . <br><br>  Install the client with default settings.  In the process, agree to install the OpenVPN driver. <br><br>  Then download the OpenVPN configuration file from the users section of your VPN server: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b43/50f/668/b4350f6689f75b54d7ca4e461485a295.jpg" width="800"><br><br>  Install <a href="http://www.7-zip.org/">7zip</a> and unzip the downloaded tar file. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/462/533/994/46253399476d7a98e7598b1d94f50c9a.jpg" width="800"><br><br>  Copy the <strong>.ovpn</strong> file to the directory <br><pre> <code class="bash hljs">C:\Program files\OpenVPN\config</code> </pre><br>  Launch from the desktop with OpenVPN Gui admin rights (in the properties of the shortcut, you can set the launch with admin rights permanently). <br><br>  In the system tray, right-click on the OpenVPN shortcut and select "Connect". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4b3/b3b/d52/4b3b3bd52f425951ccb99f6bcef30924.jpg" width="300"><br><br>  The connection is successful. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/809/b00/e4c/809b00e4c8b346673cca1b082c7b40e3.jpg" width="500"><br><br><h5>  <b>Setting up an OpenVPN client on OS X</b> </h5><br>  <a href="https://sourceforge.net/projects/tunnelblick/files/All%2520files/Tunnelblick_3.4.3_build_4055.4198.dmg/download">Download</a> Tunnelblick <a href="https://code.google.com/p/tunnelblick/wiki/DownloadsEntry">from here</a> and install it. <br><br>  Download the OpenVPN configuration file from the users section of your VPN server: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b43/50f/668/b4350f6689f75b54d7ca4e461485a295.jpg" width="800"><br><br>  Install <a href="https://itunes.apple.com/ru/app/the-unarchiver/id425424353%3Fmt%3D12">The Unarchiver</a> to unpack the tar file without opening the terminal. <br><br>  Unzip the tar file.  Then double-click the .ovpn configuration file.  Allow the use of the configuration file only for yourself or for all users (optional). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b6a/5c0/c77/b6a5c0c778952d33c32e5c73324bdb75.jpg" width="400"><br><br>  Enter the administrator password. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/af6/34d/746/af634d74692ca7117baf073f3a689b7e.jpg" width="400"><br><br>  In the menu bar, click on the Tunnelblick icon and select ‚ÄúConnect‚Äù. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b5/9f6/a03/8b59f6a03b96ebbd1c72b09f1702473e.jpg" width="400"><br><br>  The connection is successful. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d0c/e32/d86/d0ce32d86c4c585a6127e4cd171d7ea0.jpg" width="400"><br><br><h5>  <b>Setting up an OpenVPN client on Ubuntu Desktop</b> </h5><br>  Open a terminal and enter the following command: <br><pre> <code class="bash hljs">sudo apt-get install network-manager-openvpn</code> </pre><br>  Download the OpenVPN configuration file from the users section of your VPN server: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b43/50f/668/b4350f6689f75b54d7ca4e461485a295.jpg" width="800"><br><br>  The tar file is loaded.  Go to the terminal in the directory where the file was downloaded: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Downloads/</code> </pre><br>  Unzip the file (the file name will match the username): <br><pre> <code class="bash hljs">tar -xvf trukhinyuri.tar</code> </pre><br><br>  Due to an <a href="https://bugs.launchpad.net/ubuntu/%2Bsource/network-manager-openvpn/%2Bbug/606365">error</a> in the Network Manager, we cannot import the ovpn file directly.  But there is a temporary solution: <br><ul><li>  Create the folder "OpenVPN" and copy there the ovpn configuration file that you unpacked earlier from the archive. </li><li>  Open the ovpn configuration file from the ‚ÄúOpenVPN‚Äù folder in a text editor. </li><li>  Create a ca.crt file in the ‚ÄúOpenVPN‚Äù folder: copy the text between it <pre> <code class="bash hljs">&lt;ca&gt;  &lt;/ca&gt;</code> </pre>  from the ovpn configuration file. </li><li>  Create a client.crt file in the ‚ÄúOpenVPN‚Äù folder: copy the text between it <pre> <code class="bash hljs">&lt;cert&gt;  &lt;/cert&gt;</code> </pre>  from the ovpn configuration file. </li><li>  Create a client.key file in the ‚ÄúOpenVPN‚Äù folder: copy the text between it <pre> <code class="bash hljs">&lt;key&gt;  &lt;/key&gt;</code> </pre>  from the ovpn configuration file. </li><li>  Create a ta.key file in the ‚ÄúOpenVPN‚Äù folder: copy the text between it <pre> <code class="bash hljs">&lt;tls-auth&gt;  &lt;/tls-auth&gt;</code> </pre>  from the ovpn configuration file. </li><li>  Open the ovpn configuration file from the ‚ÄúOpenVPN‚Äù folder and edit it: delete the section <pre> <code class="bash hljs">&lt;ca&gt;</code> </pre>  and lower and add to the end: <br><pre> <code class="bash hljs">ca ca.crt cert client.crt key client.key tls-auth ta.key</code> </pre><br></li></ul><br>  Click on the Network Manager icon and select ‚ÄúEdit connections‚Äù: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e19/af8/04a/e19af804a8467967402f0a09516b9432.png" width="400"><br><br>  In the Network manager, click Add and select ‚ÄúImport a saved vpn configuration‚Äù and click ‚Äúcreate‚Äù: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/968/8b5/d3d/9688b5d3d1361116ba1fccdbe986bbc7.jpg" width="800"><br><br>  Select the modified ovpn configuration file from the ‚ÄúOpenVPN‚Äù folder and click ‚ÄúOpen‚Äù: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/466/32a/f27/46632af274d0e3fedf5e02fbd9765c8d.jpg" width="600"><br><br>  Enter ‚ÄúAdvanced‚Äù -&gt; ‚ÄúTLS Authentication‚Äù and set the ‚ÄúKey Direction‚Äù to the same value as the ‚Äúkey-direction‚Äù in the original ovpn configuration file.  In our case, this is "1." <br><br><img src="https://habrastorage.org/getpro/habr/post_images/56c/694/5ac/56c6945ac9e00729efa3d12ff8c35aba.jpg" width="800"><br><br>  Click ‚ÄúSave‚Äù and close all windows network manager.  Connect to the VPN server, as shown in the screenshot below: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/05c/7dd/806/05c7dd806489e248dbe3c36fbe0f4cf2.jpg" width="600"><br><br>  You have successfully connected to a VPN from Ubuntu Desktop. <br><br><h4>  Conclusion </h4><br>  In this article, we learned how to quickly deploy a VPN server with a web interface in <a href="http://infoboxcloud.ru/">InfoboxCloud</a> .  If you want to try the cloud server - <a href="">send us</a> your email and we will provide a free trial version of the cloud for 15 days. <br><br>  If you cannot write comments, ask a question in the <a href="https://infoboxcloud.ru/community/blog/iaas/225.html">InfoboxCloud Community</a> .  In case you find an error in the article, the author will gladly correct it.  Please write in the LAN or <a href="">in the mail</a> about it. <br><br>  Successful work! </div><p>Source: <a href="https://habr.com/ru/post/248445/">https://habr.com/ru/post/248445/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248431/index.html">New game development bugs</a></li>
<li><a href="../248435/index.html">NSA Curious Look: What is the War for Internet Security (Part 1)</a></li>
<li><a href="../248439/index.html">Mobile App Distribution Services for iOS. Part 1: TestFlight</a></li>
<li><a href="../248441/index.html">8 varieties of muda in your web studio</a></li>
<li><a href="../248443/index.html">Simple solutions. We pump pictures</a></li>
<li><a href="../248449/index.html">(Kiev) from 3 to 6 February, the course "Advanced Switch Operation, Configuration and Management"</a></li>
<li><a href="../248451/index.html">(Belarus) Foundation for data center: Juniper MetaFabric architecture</a></li>
<li><a href="../248453/index.html">Automated testing of services using the MQ protocol using JMeter</a></li>
<li><a href="../248455/index.html">CrystaX NDK 10.1 release</a></li>
<li><a href="../248457/index.html">Introduction to the development of web-applications on PSGI / Plack. Part 4. Asynchrony</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>