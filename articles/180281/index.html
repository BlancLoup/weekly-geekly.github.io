<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automation of operations of the same type when setting up switches via telnet without programming</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Good day dear habrazhiteli! 

 The method described below will help reduce the amount of routine work when setting up switches (for exa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automation of operations of the same type when setting up switches via telnet without programming</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Good day dear habrazhiteli! <br><br>  The method described below will help reduce the amount of routine work when setting up switches (for example, Planet, D-Link, etc.) in cases when you need to perform several dozen - hundreds of similar operations, such as declaring Vilan, adding them to interfaces, exporting configuration files to a tftp server.  Of course, the solution is far from optimal and rational, but I hope it has the right to life. <br>  Setup is performed via a telnet connection.  Alas, in spite of the fact that modern switches support ssh and snmp, many old pieces of iron understand only telnet.  The method is suitable for the average Windows user, not a programmer, because  only a notebook and batch bat files are used (please do not breathe evenly to Paralympic games of programmers not to read further). <br><a name="habracut"></a><br>  The main problem was to find a program that would allow connecting to the switch via telnet to automatically pass authorization, and then transfer the necessary commands.  A long search on the problem yielded two types of results: a code on a 15-year-old delphi and a proposal to master the telnet client on python, which, I confess, was not part of my plans. <br>  A bit later, the notorious <a href="http://habrahabr.ru/post/76098/">Kitty</a> was found.  Documentation on the program that the cat wept and the main part is on the <a href="http://www.9bis.net/kitty/%3Fpage%3DWelcome%26zone%3Dru">site</a> and <a href="http://www.9bis.net/kitty/%3Faction%3Dforum%26id%3D0079%26zone%3Dru">forum</a> without searching.  Bribed by the presence of the following functions: Kitty can run saved sessions, where you can register a login and password for authorization, a line with commands for auto execution, as well as the path to the file with the script.  The script will be executed after authorization, its size must be less than 4096 bytes or about 100 not long lines. <br><br><h4>  Training </h4><br>  By default, the Kitty settings are stored in the registry, which is not very convenient.  Create a <b>kitty.ini</b> with the following content: <br><pre><code class="dos hljs">[KiTTY] savemode=<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> initdelay=<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> commanddelay=<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> bcdelay=<span class="hljs-number"><span class="hljs-number">5</span></span> KittyPath=C:\Windows\System32\putty.exe</code> </pre> <br>  Where savemode = dir makes Kitty store sessions in the Sessions folder.  In my case, the delays do not differ much from the standard ones, they can also be tightened up, as long as the teams have time to go and work out. <br>  Copy <b>putty.exe</b> , <b>kitty.exe</b> and <b>kitty.ini</b> to System32 and execute: <br><pre> <code class="dos hljs">kitty.exe -<span class="hljs-built_in"><span class="hljs-built_in">convert</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span></code> </pre><br>  After that, the settings begin to pull up from kitty.ini, and the sessions are saved in C: \ Windows \ System32 \ Sessions. <br>  Run <b>kitty.exe</b> or <b>kitty.exe -launcher</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Create a session </h4><br>  Before creating a session, I recommend that you save the settings that are optimal for yourself in the <b>Default Settings</b> session, in particular, select the <b>UTF-8</b> encoding in the <b>Window - Translation</b> section. <br>  The session itself is created and saved as usual in Putty, only with a lot of options.  In the <b>Session</b> section, select telnet, register the host or ip address.  In the section <b>Connection - Data we</b> register login and the password for authorization.  This can be done either in special fields or in the Command line or directly in the script file.  As you like, I tried all the options.  In this example, I will describe the case of authorization through the string Command.  Syntax: <br><pre> <code class="dos hljs">\n   \p    ,      \s05   ,   <span class="hljs-number"><span class="hljs-number">10</span></span>,    </code> </pre><br>  It all depends on the switch model and the delays specified in the kitty.ini, was chosen empirically: <br><pre> <code class="dos hljs">\s05LOGIN\n\pPASSWORD\n\p</code> </pre><br>  In the line Login script file specify the path to the script file, for example <b>C: \ scripts \ script.txt</b> <br>  We return to the Session section, register the name of the session, for example <b>testsession</b> and save. <br><br><h4>  We write a script </h4><br>  In the folder with the script file, create a plain text document and save, for example, as <b>script.bat</b> .  Open it in your favorite text editor and write (and do not forget to comment): <br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">setlocal</span></span> enableextensions enabledelayedexpansion <span class="hljs-built_in"><span class="hljs-built_in">chcp</span></span> <span class="hljs-number"><span class="hljs-number">1251</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>         D-Link ::--------------------------------------------------- ::    @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> null&gt;&gt;script.txt <span class="hljs-built_in"><span class="hljs-built_in">DEL</span></span> script.txt ::--------------------------------------------------- <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> /L <span class="hljs-variable"><span class="hljs-variable">%%i</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">105</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DO</span></span> ( @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> # @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> create vlan <span class="hljs-variable"><span class="hljs-variable">%%i</span></span> tag <span class="hljs-variable"><span class="hljs-variable">%%i</span></span> )&gt;&gt;script.txt @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> #&gt;&gt;script.txt @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> logout&gt;&gt;script.txt ::--------------------------------------------------- ::  <span class="hljs-built_in"><span class="hljs-built_in">start</span></span> /wait kitty.exe -load "testsession" <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span></code> </pre><br>  The first part of the script allows you to display comments in Russian.  The truth is to start in the properties of the command line you need to set the font <b>Lucida Console</b> .  <b>echo</b> displays comments when executing a batch file, <b>::</b> double colon ‚Äî comments in the code (do not use them in cycles). <br>  In the second part, we clean the existing or non-existing file, then write the script into it.  Anything for the soul and the task. <br>  In the third part, we run Kitty with the <b>-load "session_name"</b> parameter, where <b>/ wait</b> determines that the command file will wait for Kitty to complete, and <b>pause</b> allows you to see if the execution has completed with an error or everything is fine. <br>  The contents of the resulting text file: <br><pre> <code class="dos hljs"># create vlan <span class="hljs-number"><span class="hljs-number">100</span></span> tag <span class="hljs-number"><span class="hljs-number">100</span></span> # create vlan <span class="hljs-number"><span class="hljs-number">101</span></span> tag <span class="hljs-number"><span class="hljs-number">101</span></span> # create vlan <span class="hljs-number"><span class="hljs-number">102</span></span> tag <span class="hljs-number"><span class="hljs-number">102</span></span> # create vlan <span class="hljs-number"><span class="hljs-number">103</span></span> tag <span class="hljs-number"><span class="hljs-number">103</span></span> # create vlan <span class="hljs-number"><span class="hljs-number">104</span></span> tag <span class="hljs-number"><span class="hljs-number">104</span></span> # create vlan <span class="hljs-number"><span class="hljs-number">105</span></span> tag <span class="hljs-number"><span class="hljs-number">105</span></span> # logout</code> </pre><br>  As you might guess, when executing the script, Kitty <a href="http://www.9bis.net/kitty/%3Fpage%3DLogon%2520script%26zone%3Dru">expects a line</a> ending in # (or any other ending, example below) and sends the following line in reply, etc. <br><pre> <code class="dos hljs">::    Planet @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> #&gt;&gt;testscript2.txt @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> running-config startup-config&gt;&gt;testscript2.txt @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> :&gt;&gt;testscript2.txt @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Y&gt;&gt;testscript2.txt @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> #&gt;&gt;testscript2.txt @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>&gt;&gt;testscript2.txt</code> </pre><br>  You can transfer the authorization step to the script, and before the logout, for example, add saving and exporting the configuration file. <br><br><h4>  Conclusion </h4><br>  Thus, it is possible to form quite voluminous scripts and execute them relatively quickly.  The disadvantage, of course, is that they will have to be performed in parts, but this is the Kitty limitation.  Surely there are many other ways to solve such problems - from downloading the finished config to the switch, to using specialized software.  Thanks for attention. <br><br><h4>  PS </h4><br>  It is also convenient to execute commands of the following kind (since they can be quickly stamped with both a script and as trite in Excel): <br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">start</span></span> kitty -telnet LOGIN@<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">100</span></span> -pass PASSWORD -<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> "&lt; - &gt;\n\psave\n\plogout" <span class="hljs-built_in"><span class="hljs-built_in">start</span></span> kitty -ssh root@<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> -pass PASSWORD -<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> "reboot"</code> </pre><br><br><h4>  Pps </h4><br>  Example script with expect: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/expect -f set timeout -1 spawn ssh -o PubkeyAuthentication=no LOGIN@IPADDRESS expect -exact "password: " sleep 1 send -- "PASSWORD\r" expect -exact "admin#" sleep 1 send -- "COMMAND\r" expect -exact "admin#" sleep 1 send -- "logout\r" expect {\$\s*} { interact }</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/180281/">https://habr.com/ru/post/180281/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../180271/index.html">The effect of film film projector in digital video technology</a></li>
<li><a href="../180273/index.html">Low automation, or how to send two bytes</a></li>
<li><a href="../180275/index.html">The effect of slides on the site. Version two, supplemented and corrected</a></li>
<li><a href="../180277/index.html">Time management and organizers</a></li>
<li><a href="../180279/index.html">JQuery validate plugin work from inside</a></li>
<li><a href="../180283/index.html">Creating custom virtual machines and images in Windows Azure</a></li>
<li><a href="../180287/index.html">PHDays Everywhere: participate in the forum from anywhere in the world</a></li>
<li><a href="../180289/index.html">Video review tablet Lenovo ThinkPad Tablet 2</a></li>
<li><a href="../180291/index.html">IT park of the Astrakhan period</a></li>
<li><a href="../180295/index.html">Small experiment network independence</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>