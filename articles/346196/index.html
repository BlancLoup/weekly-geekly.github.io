<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vim: Search Javascript documentation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I usually work at Kate or Geany. But sometimes, like all people, I want to learn Vim. And each time, approximately in the second minute of ‚Äúmastering,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Vim: Search Javascript documentation</h1><div class="post__text post__text-html js-mediator-article"><p>  I usually work at Kate or Geany.  But sometimes, like all people, I want to learn Vim.  And each time, approximately in the second minute of ‚Äúmastering,‚Äù some completely stupid question arises.  For example, why when you press the arrows (or jk keys) the cursor jumps right through all the lines of a paragraph? </p><br><p>  No matter how hard I tried to formulate my questions, the search gives me about the same one hundred sites each with titles like ‚Äú100 Most Useful Vim Commands‚Äù.  And whatever website I choose, it will always lack the ‚Äúteam‚Äù that I need right now. </p><br><p>  I thought how to find not a hundred, but in general all the Wim teams.  And I found the same page on the network, which was called ‚ÄúAll Vim teams‚Äù.  And there really was a very large list - about six hundred words.  But it was not stated that these commands do, - just a list of terms.  I was so angry with this joke that I finally decided to <strong>read the documentation</strong> and once and for all make my own list of ‚Äúall Vim commands‚Äù.  Result on the screen.  Details below. </p><br><p><img src="https://habrastorage.org/webt/hy/qj/y-/hyqjy-1c-a8r7rrsi-kphttnneq.png"></p><br><a name="habracut"></a><p>  On the official site I was sent to study the documentation on the page <a href="http://vimdoc.sourceforge.net/">vimdoc.sourceforge.net</a> .  There are more than a hundred links to different files on this page;  the description of tasks in them often overlaps: for example, for me <em>editing.html, motion.html, insert.html</em> - all this is as if one continuous ‚Äúediting‚Äù.  Some files are not needed at all for finding a solution ‚Äî for example, comparing versions like <em>version5.html</em> .  Some are like a textbook ( <em>usr_NN.html</em> ). </p><br><p>  I chose everything more or less related to ‚Äúreference‚Äù, downloaded and decided to somehow organize search-filtering on all the material at once.  After processing with sed and bonding, a file of 3.5 megabytes is obtained.  The ‚Äúteams‚Äù there turned out to be not 600, but six thousand (with all the pseudonyms and variants - which fit in about four thousand ‚Äúarticles‚Äù or ‚Äúparagraphs‚Äù).  They managed to find and select everything, because the author of the documentation, Bram Moolenaar, carefully concluded them all in the tags " <strong>a name</strong> ". </p><br><p>  It is by this principle that I divided the entire text of the documentation: one ‚Äúkeyword‚Äù (or a group of synonymous terms) is one segment of the text.  I wanted to organize ‚Äúend-to-end‚Äù filtering in order to see fragments from different documentation files when searching for an arbitrary word.  And not to lose the standard documentation option - when you click on a term or ‚Äútag‚Äù, jump to the text with the definition (or description) of this term. </p><br><p>  To do this, all the material was placed in one large html-table, and then it was organized in a search using Javascript. </p><br><p>  Everyone knows that such a large table - 4000 lines, 3.5 megabytes - will barely toggle in the browser.  But the eyes are afraid, the hands are doing.  Javascript in modern browsers is a very fast language.  Much more time is spent on text output on the screen.  Therefore, it is not necessary to show the entire table at once. </p><br><p> This is the first simple technique that gives the greatest loading acceleration for a large page ‚Äî specify the <code>display:none;</code> rule for the table <code>display:none;</code>  .  An invisible table loads an order of magnitude faster, after which you can slowly create all the necessary indexes.  And later, when the user starts the search, we will display only a small part of the table.  Sometimes, of course, even more if you enter just one letter in the search field. </p><br><p>  To beat the user (that is, first of all, himself) from a long wait, we <code>_Table.tx = 2</code> two parameters in the filtering script: <code>_Table.tx = 2</code> - we start searching only if the user has entered at least two letters;  <code>_Table.vrows = 100</code> - show only the first 100 search results (not more). </p><br><p>  In Vim, of course, there are commands of two letters, and even of one letter.  According to them, it is almost impossible to filter the necessary text, because many common words will be found.  So that when searching for the letter of the sought-for terms, they did not mix with ‚Äúordinary letters‚Äù, we concluded all the ‚Äúterms‚Äù in asterisks (or rather, left these asterisks, as in the source files).  To find, for example, the description of the command ‚ÄúB‚Äù (capital Latin B), you must enter the letter directly with asterisks in the search field: </p><br><p><img src="https://habrastorage.org/webt/rn/qd/ec/rnqdecrgvo1iteoohydzyge5t_o.png"></p><br><p>  It is assumed that with the number of results, for example, 200, a reasonable user will continue filtering to reduce the number of rows found ‚Äî for example, adding letters to the search field of another column.  But if you really want to see all 4000 lines found, you can click the "Show hidden" checkbox. </p><br><p>  You can also search for terms and hotkeys using the usual <code>Ctrl+f</code> - all keywords are completely displayed on the page in a separate list on the right, almost like on the site where "all commands are Vim".  Only on our page for any word you can click and see the detailed text from the documentation.  By <code>Ctrl+f</code> in the list on the right, you can also find commands consisting of one letter - there they are also surrounded by asterisks. </p><br><p>  This is the second method of acceleration - the organization of the search for individual lists, and not for all the solid text - for this you need a table with several columns, and, perhaps, a couple of columns outside the table. </p><br><p>  The third trick is to not touch the DOM.  A search for Javascript is always better to conduct on specially prepared arrays, and not on real DOM nodes. </p><br><p>  The fourth technique is ‚Äúindexing.‚Äù  We associate a word from the list directly with a specific element of the array by its number.  This is something like the <strong>primary key</strong> .  Then when you click on such a word, you can display the necessary information almost instantly - this is how the list of terms on the right works.  We can associate a link with several elements of the array, then the search is also accelerated, because there is no search - just strings associated with a set of array elements (something like a <em>one-to-many</em> relationship) are output.  This is how the list of ‚Äúcategories‚Äù on the left works ‚Äî there are the names of the source files of the documentation: <em>options, editing, motion</em> ... True, the ‚Äúacceleration‚Äù is not very noticeable when you click, for example, on the <em>vim.eval</em> link, because there are more than five hundred items in this section (lines tables), and they are displayed on the screen for quite a long time (if you, of course, put a tick "Show hidden"). </p><br><p>  We search for text in Javascript using the <code>indexOf()</code> function ‚Äî all values ‚Äã‚Äãin the array are searched and compared with the letters entered for the search.  Usually, to search using this method, all values ‚Äã‚Äãin the search arrays should be reduced to lowercase.  But in our case gg is not the same as GG, so the search is made case-sensitive. </p><br><h3>  *** </h3><p>  The documentation in each paragraph contains many links.  Of course, these links were not created by hand, and sometimes quite strange things can be found in the files.  So, I had to completely delete the links to the motion.as command - because there were more than a thousand such links in the final file (in statements like " <em>same as: map</em> ").  I have already decided, the trouble has passed;  but suddenly I saw the next set of ‚Äúnoise‚Äù links - with the word ‚Äúdo‚Äù. </p><br><p>  Then I stopped to think that looking for the ‚Äúfreshest‚Äù html documentation files is such a good idea.  Suppose my Vim is not the most recent, but the documentation still does not change every day.  So why, instead of ‚Äúwget ...‚Äù, write <code>cp -R /usr/share/vim/vim74/doc ~/Downloads/vim7/source</code> in the console.  And go for the source files far away. </p><br><p>  In my vim74 / doc folder there were also more <strong>.rux</strong> files - translations into Russian.  There are a lot of files, and even with different extensions.  And in general, the choice of files for search began to be defined a little differently: not ‚Äúchoose everything that looks like a reference‚Äù, but remove the obviously non-reference: <code>rm -R usr_*; rm -R version*; rm -R todo*</code> <code>rm -R usr_*; rm -R version*; rm -R todo*</code>  <code>rm -R usr_*; rm -R version*; rm -R todo*</code> . </p><br><p>  The number of ‚Äúvim commands‚Äù or tags in the right list has increased to 9000. More precisely, it has become even ‚Äúover 9000‚Äù.  And some of the tags were not connected with one segment of the text, but with two - English and Russian (if there is a translation).  Worse, in my opinion, this is not.  True, the number of rows of the table also increased - to "over 8000".  But the difference in the speed of the search between a table of 4,000 lines and a table with 8,000 lines to the naked eye is not noticeable. </p><br><h3>  Vim tags </h3><p>  Looking at the documentation files, I found a "list of Wim commands" in the tags file, but I could not use it in Javascript - I did not understand what could be gained.  It can be used earlier when generating html, as the vim2html.pl script in the same folder does, in order to highlight keywords and mark them with html tags <strong>a name</strong> .  But for a search in Javascript it is not exactly ‚Äúa name‚Äù that is needed, any conditional labels are enough (we chose <strong>&lt;b&gt;</strong> ).  And you don‚Äôt need such a complex tool like vim2html.pl, - you can place labels using ordinary re-exams, sed'om (the code is given at the end of the article). </p><br><h3>  Returning to Vim hjkl </h3><p>  While I was unhurriedly sawing in Kate Javascript filtering for Vim's docks, I simultaneously typed this text in Vim.  And I received the answer to my first question about jk-navigation only at the very end of work, in five days.  In the first approximation, the answer was found quickly - in one of the articles right here on Habr√©: for the cursor to move along the on-screen lines, not paragraphs, you need to change the key assignment using the map instruction in the ~ / .vimrc file: <code>map k gk</code> , <code>map j gj</code> . </p><br><p>  But it was the smallest part of the problem.  The big turned out to be in ideology.  The <strong>hjkl</strong> keys, used instead of arrows, are designed to increase the convenience of navigation: do not take your hand away from the main keys - to the arrows.  Well, I moved to the right place in the text, pressed <strong>i</strong> , typed a letter.  And then what?  How to move further with these jk?  If I click on them, they will simply be printed. </p><br><p>  We must somehow switch back to the ‚Äúnormal‚Äù mode - that is, we must still divert one of the hands from the main keys to the Esc key.  It, of course, is easier to click than to move the arrows.  But the very fact of frequent switching of modes for minor edits is annoying - any profit is lost. </p><br><p>  A wise thought about "map k gk" suggested the next step: <code>imap &lt;Cj&gt; &lt;Esc&gt;gji</code> .  And it worked perfectly for almost all four areas.  Besides <strong>&lt;Cl&gt;</strong> , when pressed, Vim for some reason stubbornly refused to do anything.  A fresh search for documentation has shown that this default combination is not used anywhere.  I went through several options, including all sorts of tricks: </p><br><pre> <code class="hljs xml">imap <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cl</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Esc</span></span></span><span class="hljs-tag">&gt;</span></span>l map <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cl</span></span></span><span class="hljs-tag">&gt;</span></span> li</code> </pre><br><p>  And in this last, I suddenly noticed that the keys work somehow through time.  <em>Having observed a</em> little more about the behavior of the <em>patient</em> , I found some strange solution that inexplicably turned out to be a worker: </p><pre> <code class="hljs xml">imap <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cl</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Esc</span></span></span><span class="hljs-tag">&gt;</span></span>lli</code> </pre><br><h3>  *** </h3><p>  You can talk a lot about the inner beauty of Javascript and the intricacies of working with tables like <code>table-layout: fixed;</code>  , but I'm starting to feel Linus' reproachful look behind me: ‚ÄúShow me the code already!‚Äù Here it is, the code for processing the source documentation files: </p><br><div class="spoiler">  <b class="spoiler_title">The code for generating the html table from the Vim documentation files</b> <div class="spoiler_text"><pre> <code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> rm -R usr_* rm -R version* rm -R todo* <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> *.txt; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> n=$(<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$f</span></span></span><span class="hljs-string">"</span></span> | sed -r <span class="hljs-string"><span class="hljs-string">'s/\.\w+//'</span></span>); perl -pe <span class="hljs-string"><span class="hljs-string">'s/&lt;/&amp;lt;/g'</span></span> &lt;<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$f</span></span></span><span class="hljs-string">"</span></span>&gt;<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$n</span></span></span><span class="hljs-string">"</span></span>.html; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> *.rux; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> n=$(<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$f</span></span></span><span class="hljs-string">"</span></span> | sed -r <span class="hljs-string"><span class="hljs-string">'s/\.\w+//'</span></span>); perl -pe <span class="hljs-string"><span class="hljs-string">'s/&lt;/&amp;lt;/g'</span></span> &lt;<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$f</span></span></span><span class="hljs-string">"</span></span>&gt;<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$n</span></span></span><span class="hljs-string">"</span></span>-ru.html; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> *.html; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> n=$(<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$f</span></span></span><span class="hljs-string">"</span></span> | sed -r <span class="hljs-string"><span class="hljs-string">'s/\.\w+//'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ((i=0; i &lt; 3; i++)); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> sed -i -r <span class="hljs-string"><span class="hljs-string">"s:\|([^\t ]+)\|:&lt;u&gt;\1&lt;/u&gt;:g; s:(^|\t| )(\*[^\t ]+\*)(\t| |$):\1&lt;b&gt;\2&lt;/b&gt;\3:g"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$n</span></span></span><span class="hljs-string">"</span></span>.html; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>; sed -i <span class="hljs-string"><span class="hljs-string">"/&lt;b&gt;/i&lt;\/pre&gt;&lt;\/td&gt;&lt;\/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;u&gt;vim.</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$n</span></span></span><span class="hljs-string">&lt;\/u&gt;&lt;\/td&gt;&lt;td&gt;&lt;pre&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$n</span></span></span><span class="hljs-string">"</span></span>.html; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>; cat *.html &gt; ../table.htm <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .. sed -i <span class="hljs-string"><span class="hljs-string">'/vim:tw=78:ts=8:ft=help:norl/d'</span></span> table.htm cat htm00.htm table.htm endhtm.htm &gt;vim.html</code> </pre><br></div></div><br><p>  First we encode in html all opening tags in the text.  And at the same time copy the source code to files with a different extension.  Then we look for all the words with asterisks and enclose them in tags <strong>&lt;b&gt;</strong> .  The difficulty is not to hook the occurrences of the form ": autocmd BufRead * / doc / *. Txt set tw = 78" - asterisks without keywords.  Because of the difficult condition, the search has to be repeated several times, because some contexts overlap.  When all the keywords are found and marked, relying on them, it is already possible to divide the future html-table into lines. </p><br><p>  Then the files are glued into one, added <code>!DOCTYPE</code> with meta tags, 300 lines of js and 40 lines of css, which can be viewed right inside the final file.  Result: <a href="http://nichtig.ru/vim.html">Vim docs</a> </p><br><p>  PS While modifying the description, I added something to Javascript: 1) double-clicking with the mouse starts the search for the selected word;  2) you can select a few words with the mouse and click to search for F2.  3) Ctrl + Left returns to the previous search result (Ctrl + Right - on the contrary). </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/346196/">https://habr.com/ru/post/346196/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346184/index.html">Bioinformatic Pipeline with Docker</a></li>
<li><a href="../346186/index.html">Practice writing tests. Yandex lecture</a></li>
<li><a href="../346188/index.html">Web messengers and the event 'beforeunload': how to save a million messages when you close the page</a></li>
<li><a href="../346190/index.html">Choosing a data center in St. Petersburg, practical experience of choice</a></li>
<li><a href="../346194/index.html">How to identify and develop talents in IT</a></li>
<li><a href="../346198/index.html">How I Parsil Habr, Part 1: Trends</a></li>
<li><a href="../346200/index.html">What's wrong with Telegram or 5 controversial UX / UI solutions that can be fixed in it</a></li>
<li><a href="../346202/index.html">Tuning toolchain for Arduino for continuing</a></li>
<li><a href="../346204/index.html">Oracle upgrade experience 11.2.0.4 to 12c</a></li>
<li><a href="../346206/index.html">Clustering and visualization of textual information</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>