<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating audio plugin, part 6</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All posts series: 
 Part 1. Introduction and setup 
 Part 2. Learning Code 
 Part 3. VST and AU 
 Part 4. Digital Distortion 
 Part 5. Presets and GUI...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating audio plugin, part 6</h1><div class="post__text post__text-html js-mediator-article">  All posts series: <br>  <a href="http://habrahabr.ru/post/224911/">Part 1. Introduction and setup</a> <br>  <a href="http://habrahabr.ru/post/225019/">Part 2. Learning Code</a> <br>  <a href="http://habrahabr.ru/post/225457/">Part 3. VST and AU</a> <br>  <a href="http://habrahabr.ru/post/225751/">Part 4. Digital Distortion</a> <br>  <a href="http://habrahabr.ru/post/225755/">Part 5. Presets and GUI</a> <br>  <a href="http://habrahabr.ru/post/226439/">Part 6. Signal synthesis</a> <br>  <a href="http://habrahabr.ru/post/226573/">Part 7. Receive MIDI Messages</a> <br>  <a href="http://habrahabr.ru/post/226823/">Part 8. Virtual Keyboard</a> <br>  <a href="http://habrahabr.ru/post/227475/">Part 9. Envelopes</a> <br>  <a href="http://habrahabr.ru/post/227601/">Part 10. Refinement GUI</a> <br>  <a href="http://habrahabr.ru/post/227791/">Part 11. Filter</a> <br>  <a href="http://habrahabr.ru/post/227827/">Part 12. Low-frequency oscillator</a> <br>  <a href="http://habrahabr.ru/post/228267/">Part 13. Redesign</a> <br>  <a href="http://habrahabr.ru/post/231513/">Part 14. Polyphony 1</a> <br>  <a href="http://habrahabr.ru/post/231923/">Part 15. Polyphony 2</a> <br>  <a href="http://habrahabr.ru/post/232153/">Part 16. Antialiasing</a> <br><hr><br><br>  After the interface improvements, it‚Äôs time to do some programming.  In this post we will generate a classic sine, saw, triangle and meander. <br><br><a name="habracut"></a>  Let's start by copying the previous project with the duplicate script: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>./duplicate.py DigitalDistortion/ Synthesis YourName</code> <br> <br>  Xcode again has to make changes to <i>‚ÄúRun‚Äù</i> ( <i>Product ‚Üí Scheme ‚Üí Edit Scheme ...</i> ) so that the build starts with the REAPER project, as <a href="http://habrahabr.ru/post/225457/">described earlier</a> .  If he complains that he cannot find an AU, he will need to change the names and IDs in <i>resource.h</i> or remove <i>DigitalDistortion.component</i> . <br><br><h2>  Oscillator class </h2><br><br>  The material in this article is entirely related to the DSP topic.  We will not just write all the new code inside the <code>ProcessDoubleReplacing</code> function.  Instead, create an <code>Oscillator</code> class, call its functions from <code>ProcessDoubleReplacing</code> , and it will fill the output buffer with <code>double</code> values ‚Äã‚Äãto create a waveform.  First, we use an intuitive approach.  Later, faced with the shortcomings of this approach, we will find a way to achieve a better sound. <br><br>  Let's create a new class.  On Mac File ‚Üí New ‚Üí File ...: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f11/193/aeb/f11193aebd9e5ede1bb64be8a52478c9.jpg"><br><br>  On Windows, right-click on the project, Add ‚Üí Class: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7cd/363/5d0/7cd3635d0533bb638fe6a6e6eca2e5a2.png"><br><br>  Let's call it <i>Oscillator</i> .  Make sure <i>Oscillator.cpp is</i> compiled.  In Xcode on AU, click on <i>Build Phases</i> .  Click on the plus under <i>Compile Sources</i> and add a <i>.cpp</i> file (this will need to be done for each target): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fb0/433/78f/fb043378f960abedd69876a1d4e304e4.png"><br><br>  Let's write a headline.  Paste the following code between <code>#define</code> and <code>#endif</code> in <i>Oscillator.h</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;math.h&gt; enum OscillatorMode { OSCILLATOR_MODE_SINE, OSCILLATOR_MODE_SAW, OSCILLATOR_MODE_SQUARE, OSCILLATOR_MODE_TRIANGLE }; class Oscillator { private: OscillatorMode mOscillatorMode; const double mPI; double mFrequency; double mPhase; double mSampleRate; double mPhaseIncrement; void updateIncrement(); public: void setMode(OscillatorMode mode); void setFrequency(double frequency); void setSampleRate(double sampleRate); void generate(double* buffer, int nFrames); Oscillator() : mOscillatorMode(OSCILLATOR_MODE_SINE), mPI(2*acos(0.0)), mFrequency(440.0), mPhase(0.0), mSampleRate(44100.0) { updateIncrement(); }; };</span></span></span></span></code> </pre><br><br>  To indicate which waveform our oscillator will generate, we use <code>enum</code> .  Now the default sine will be generated, but this can be changed using the member function of the <code>setMode</code> class. <br>  The class object stores the frequency, phase, and sampling frequency.  The value of the phase will constantly change, since it contains information about the moment in which the oscillator waveform generation cycle is.  The phase increment is carried out by each sample.  For simplicity, imagine that a complete cycle of a single wave is a circle.  The value of the current sample is the point on the circle.  Connect this point with the center of the circle: the angle formed by this segment and the x axis is the value of the phase.  And the angle to which this segment will be rotated in the next moment is the phase increment. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c7b/dae/527/c7bdae527baf62a86a6cd5714da6725e.png"><br><br>  The class has different functions for setting parameter values ‚Äã‚Äã(for frequency and sampling frequency, for example).  But the most important function is <code>generate</code> .  This is the very function that fills the output buffer with values. <br><br>  Let's add the implementation of these functions to <i>Oscillator.cpp</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Oscillator::setMode(OscillatorMode mode) { mOscillatorMode = mode; } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Oscillator::setFrequency(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> frequency) { mFrequency = frequency; updateIncrement(); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Oscillator::setSampleRate(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> sampleRate) { mSampleRate = sampleRate; updateIncrement(); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Oscillator::updateIncrement() { mPhaseIncrement = mFrequency * <span class="hljs-number"><span class="hljs-number">2</span></span> * mPI / mSampleRate; }</code> </pre><br><br>  The phase increment of <code>mPhaseIncrement</code> depends on <code>mFrequency</code> and <code>mSampleRate</code> , so that it is updated each time one of these two parameters changes.  We could calculate it each sample in <code>ProcessDoubleReplacing</code> , but it‚Äôs much better to do it here. <br>  The <code>generate</code> function at the moment looks like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Oscillator::generate(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>* buffer, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nFrames) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> twoPI = <span class="hljs-number"><span class="hljs-number">2</span></span> * mPI; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (mOscillatorMode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> OSCILLATOR_MODE_SINE: <span class="hljs-comment"><span class="hljs-comment">// ... break; case OSCILLATOR_MODE_SAW: // ... break; case OSCILLATOR_MODE_SQUARE: // ... break; case OSCILLATOR_MODE_TRIANGLE: // ... break; } }</span></span></code> </pre><br><br>  This function will be called every time <code>ProcessDoubleReplacing</code> is <code>ProcessDoubleReplacing</code> .  <code>Switch</code> used so that the appropriate code is executed depending on the desired waveform. <br><br><h2>  Waveform generation </h2><br><br>  For sine, it's simple: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> OSCILLATOR_MODE_SINE: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; nFrames; i++) { buffer[i] = <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(mPhase); mPhase += mPhaseIncrement; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (mPhase &gt;= twoPI) { mPhase -= twoPI; } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre><br><br>  Note that we do not use <code>mFrequency</code> and <code>mSampleRate</code> .  We increment the <code>mPhase</code> and limit it to between <code>0</code> and <code>twoPI</code> .  The only "difficult" operation here is the function call <code>sin()</code> , which is performed at the hardware level on most systems. <br><br>  It looks like a saw: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> OSCILLATOR_MODE_SAW: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; nFrames; i++) { buffer[i] = <span class="hljs-number"><span class="hljs-number">1.0</span></span> - (<span class="hljs-number"><span class="hljs-number">2.0</span></span> * mPhase / twoPI); mPhase += mPhaseIncrement; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (mPhase &gt;= twoPI) { mPhase -= twoPI; } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre><br><br>  Again, an interesting point with writing to the buffer.  When I see such calculations, it is convenient for me to break them into pieces: <br><ul><li>  <code>mPhase</code> increases from <code>0</code> and jumps back to zero when the <code>twoPI</code> value is <code>twoPI</code> . </li><li>  Further, <code>(mPhase / twoPI)</code> increases from <code>0</code> to <code>1</code> and jumps back to zero. </li><li>  This means that <code>(2.0 * mPhase / twoPI)</code> increases from <code>0</code> , and jumps back as soon as it reaches two. </li><li>  When <code>mPhase</code> is <code>0</code> , the expression <code>1.0 - (2.0 * mPhase / twoPI)</code> is <code>1</code> .  As <code>mPhase</code> rises, the value of this expression drops and, as soon as it reaches <code>-1</code> , jumps to <code>1</code> . </li></ul><br>  Well, we have a downward ("left") saw! <br>  The <code>while</code> condition would seem redundant - it will occur in each <code>case</code> .  But if you do otherwise, then you have to turn on the <code>switch</code> in the loop.  So we even get rid of the excess <code>for</code> , but then the <code>switch</code> will be executed more often than necessary. <br>  Often in programming we prefer concise and readable performance code.  But DSP code that runs 44100 (or even 96000) once a second can be an exception to this rule.  In addition, do not forget that the compiler optimizes a lot of things without your knowledge, and what may seem like a "bunch of work" for a programmer can be an elementary thing in comparison with those processes that you do not even think about. <br><br>  Next in line is the meander: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> OSCILLATOR_MODE_SQUARE: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; nFrames; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mPhase &lt;= mPI) { buffer[i] = <span class="hljs-number"><span class="hljs-number">1.0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { buffer[i] = <span class="hljs-number"><span class="hljs-number">-1.0</span></span>; } mPhase += mPhaseIncrement; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (mPhase &gt;= twoPI) { mPhase -= twoPI; } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre><br><br>  The second half of this code is already known to you.  Each cycle is <code>twoPI</code> .  The body of the <code>if</code> sets the first half of the cycle to <code>1</code> , the second to <code>-1</code> .  When <code>mPhase</code> becomes larger than <code>mPI</code> , a sharp jump appears in the wave form.  It looks like a meander. <br><br>  The triangle is a bit more complicated: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> OSCILLATOR_MODE_TRIANGLE: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; nFrames; i++) { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> value = <span class="hljs-number"><span class="hljs-number">-1.0</span></span> + (<span class="hljs-number"><span class="hljs-number">2.0</span></span> * mPhase / twoPI); buffer[i] = <span class="hljs-number"><span class="hljs-number">2.0</span></span> * (<span class="hljs-built_in"><span class="hljs-built_in">fabs</span></span>(value) - <span class="hljs-number"><span class="hljs-number">0.5</span></span>); mPhase += mPhaseIncrement; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (mPhase &gt;= twoPI) { mPhase -= twoPI; } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre><br><br>  If you <code>-1.0 + (2.0 * mPhase / twoPI)</code> in parts, as I did before, you will see that this is the opposite of a saw.  The absolute value ( <code>fabs</code> ) of the ascending saw means that all values ‚Äã‚Äãbelow 0 will be inverted (inverted relative to the x axis). <br>  This means that the resulting value will first increase and then decrease.  A subtraction of <code>0.5</code> aligns the waveform with respect to zero.  Multiplying by <code>2.0</code> scales the value, and it changes from <code>-1</code> to <code>1</code> .  Here is a triangle. <br><br>  Let's use our oscillator!  Enable <i>Oscillator.h</i> and add the <code>Oscillator</code> member to the <code>Synthesis</code> class: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// ... #include "Oscillator.h" class Synthesis : public IPlug { // ... private: double mFrequency; void CreatePresets(); Oscillator mOscillator; };</span></span></code> </pre><br><br>  We also need to rename <code>mThreshold</code> to <code>mFrequency</code> . <br>  Now change the initialization parameters in the constructor: <br><br><pre> <code class="cpp hljs">GetParam(kFrequency)-&gt;InitDouble(<span class="hljs-string"><span class="hljs-string">"Frequency"</span></span>, <span class="hljs-number"><span class="hljs-number">440.0</span></span>, <span class="hljs-number"><span class="hljs-number">50.0</span></span>, <span class="hljs-number"><span class="hljs-number">20000.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.01</span></span>, <span class="hljs-string"><span class="hljs-string">"Hz"</span></span>); GetParam(kFrequency)-&gt;SetShape(<span class="hljs-number"><span class="hljs-number">2.0</span></span>);</code> </pre><br><br>  Twist the handle, test the class.  We will change the oscillator frequency from 50 Hz to 20 kHz (by default, we set 440). <br>  Change the <code>createPresets</code> function: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Synthesis::CreatePresets() { MakePreset(<span class="hljs-string"><span class="hljs-string">"clean"</span></span>, <span class="hljs-number"><span class="hljs-number">440.0</span></span>); }</code> </pre><br><br>  We need to transfer to the oscillator what sampling frequency is currently used.  This must be done in the <code>Reset</code> function: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Synthesis::Reset() { TRACE; <span class="hljs-function"><span class="hljs-function">IMutexLock </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; mOscillator.setSampleRate(GetSampleRate()); }</code> </pre><br><br>  If we do not do this and the sampling frequency is incorrectly set for the oscillator, it will generate the same waveforms, but the frequencies will be wrong, because the wrong phase increment will be calculated.  The member function <code>GetSampleRate</code> inherited from the <code>IPlugBase</code> class. <br><br>  <code>OnParamChange</code> also needs to be edited so that you can change the frequency with the pen: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Synthesis::OnParamChange(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> paramIdx) { <span class="hljs-function"><span class="hljs-function">IMutexLock </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (paramIdx) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> kFrequency: mOscillator.setFrequency(GetParam(kFrequency)-&gt;Value()); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br><br>  Finally, use the oscillator in <code>ProcessDoubleReplacing</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Synthesis::ProcessDoubleReplacing(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>** inputs, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>** outputs, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nFrames) { <span class="hljs-comment"><span class="hljs-comment">// Mutex is already locked for us. double *leftOutput = outputs[0]; double *rightOutput = outputs[1]; mOscillator.generate(leftOutput, nFrames); // Copy left buffer into right buffer: for (int s = 0; s &lt; nFrames; ++s) { rightOutput[s] = leftOutput[s]; } }</span></span></code> </pre><br><br>  In fact, <code>mOscillator</code> fills the left channel buffer, and we simply copy these values ‚Äã‚Äãinto the right buffer. <br>  Let's hear how it sounds!  Launch.  If linker errors occur in Xcode, check whether you have added <i>Oscillator.cpp</i> to the <i>Compile Sources</i> .  When our craft starts, it will be heard even tone.  Twist the knob and the frequency should change. <br>  Now change the <code>mOscillatorMode</code> in <i>Oscillator.h</i> during the initialization phase in the constructor: <br><br><pre> <code class="cpp hljs">Oscillator() : mOscillatorMode(OSCILLATOR_MODE_SAW), mPI(<span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">acos</span></span>(<span class="hljs-number"><span class="hljs-number">0.0</span></span>)), mFrequency(<span class="hljs-number"><span class="hljs-number">440.0</span></span>), mPhase(<span class="hljs-number"><span class="hljs-number">0.0</span></span>), mSampleRate(<span class="hljs-number"><span class="hljs-number">44100.0</span></span>) { updateIncrement(); };</code> </pre><br><br>  Restart the code, and now there will be a sharper sound.  Play around with <code>OSCILLATOR_MODE_SQUARE</code> and <code>OSCILLATOR_MODE_TRIANGLE</code> , they have different timbres. <br>  With all waveforms except sine, it can be seen that strange noises appear at high frequencies.  Additional tones appear even below the fundamental frequency.  They sound inharmonious, and when you twist the knob up and down, these tones shift in opposite directions o_O <br><br><h2>  Aliasing </h2><br><br>  As we have already seen in the meander code, when the phase rises to a value greater than two pi, an instantaneous jump from a positive maximum in the current sample to a negative one in the next occurs in the wave form.  The opposite jump occurs when <code>mPhase</code> is subtracted from <code>twoPI</code> and the value of the expression again becomes less than the <code>mPI</code> .  The basic idea is that abrupt signal jumps mean that it contains many high-frequency components. <br>  Imagine that you were asked to collect this jump using only sinusoidal waves.  Given that they are smooth, you will need a lot of high frequency sines.  In general, to create the perfect jump, theoretically, an infinite number of high-frequency components will be needed, each with an ever increasing frequency.  That's the same thing when generating a meander, saw and triangle. <br><br>  But in computing everything is finite.  The RAM and hard disk have a finite volume, so the computer can use only a finite number of values ‚Äã‚Äãto save one second of sound to save that second.  This number (sampling frequency) can be any number, but the standards are 44,100, 48,000 and 96,000 samples per second.  Less commonly, 176400 and 192000 are used. The signal represented by a finite number of samples is called discrete. <br>  To describe a signal jumping between -1 and 1, you will need at least two samples per cycle: one for -1, the other for 1. So, if sampled at a frequency of 44,100 times per second, the highest correctly recorded frequency would be 22050 Hz (read about <a href="http://ru.wikipedia.org/wiki/%25D0%25A7%25D0%25B0%25D1%2581%25D1%2582%25D0%25BE%25D1%2582%25D0%25B0_%25D0%259D%25D0%25B0%25D0%25B9%25D0%25BA%25D0%25B2%25D0%25B8%25D1%2581%25D1%2582%25D0%25B0">Nyquist frequency</a> ) <br>  So a discrete signal to describe the ideal meander, saw or triangle is impossible.  If we still try to do this, we will very soon encounter the effect of <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B8%25D0%25B0%25D1%2581%25D0%25B8%25D0%25BD%25D0%25B3">aliasing</a> .  You can read more <a href="http://www.dspguide.com/ch3/2.htm">here</a> . <br><br>  So how can we generate the best waveform for a given sample rate without aliasing effects?  <i>‚ÄúBest‚Äù</i> in this case means <i>‚Äúclosest to the one we described above</i> . <i>‚Äù</i>  The Nyquist frequency is some limitation in the frequency range.  This restriction does not mean that the signal should not have peaks steeper than X, but that <i>there should not be any frequencies above X Hz in the signal</i> .  So we need to switch to the frequency representation of the signal to solve such problems.  We will do this a little later, but for now - in the next post - we have to figure out how to read MIDI. <br><br>  The code from this post can be downloaded <a href="">here</a> . <br><br>  Original article: <br>  <a href="http://martin-finke.de/blog/articles/audio-plugins-008-synthesizing-waveforms/">martin-finke.de/blog/articles/audio-plugins-008-synthesizing-waveforms</a> </div><p>Source: <a href="https://habr.com/ru/post/226439/">https://habr.com/ru/post/226439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../226427/index.html">The evolution of Microsoft web frameworks. ASP.NET vNext</a></li>
<li><a href="../226429/index.html">Amateur astronomy: a view from the inside of the community on hobbies and newcomers' rakes</a></li>
<li><a href="../226431/index.html">Wi-Fi networks: penetration and protection. 3) WPA. OpenCL / CUDA. Pick statistics</a></li>
<li><a href="../226433/index.html">The digest of interesting news and materials from the world of PHP No. 42 (June 1 - 16, 2014)</a></li>
<li><a href="../226437/index.html">Nissan and BMW will join Tesla's plans to develop electric stations</a></li>
<li><a href="../226441/index.html">Service Locator and Branch By Abstraction - a super potion</a></li>
<li><a href="../226443/index.html">Paypal comes to Belarus and Moldova</a></li>
<li><a href="../226445/index.html">Modernization of the Chinese F & D speaker system (SVEN) SPS-828</a></li>
<li><a href="../226449/index.html">Cue: medical diagnostics at home</a></li>
<li><a href="../226451/index.html">MobileOptimized - mobile weekend in Minsk with facebook, google and other developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>