<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>On the performance of named pipes in multi-process applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In an article about the features of the new version of Visual Studio, one of the main innovations (from my point of view) was the division of the prev...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>On the performance of named pipes in multi-process applications</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/6f7/2e4/eb1/6f72e4eb12af48d0822d9bf3b9c6b63e.jpg" align="right">  In an article about the <a href="https://habrahabr.ru/company/infopulse/blog/312198/">features of the new version of Visual Studio,</a> one of the main innovations (from my point of view) was the division of the previously monolithic development environment process (devenv.exe) into components that will work in separate processes.  This has already been done for the version control system (moving from libgit to git.exe) and some plug-ins, and in the future other parts of VS will be moved to sub-processes.  In this regard, in the comments, the question arose: ‚ÄúBut will this not slow down the work, because the exchange of data between processes requires the use of IPC ( <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D0%25B6%25D0%25BF%25D1%2580%25D0%25BE%25D1%2586%25D0%25B5%25D1%2581%25D1%2581%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25B2%25D0%25B7%25D0%25B0%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25B4%25D0%25B5%25D0%25B9%25D1%2581%25D1%2582%25D0%25B2%25D0%25B8%25D0%25B5">Inter Process Communications</a> )?‚Äù <br><br>  No, not slow.  And that's why. <br><a name="habracut"></a><br><h3>  Speed </h3><br>  For the organization of communication between processes in Windows, there are various technologies: sockets, named pipes, shared memory, messaging.  Since I don‚Äôt want to write a full-fledged benchmark of all of the above, let's quickly look for something similar to Habr√© and find <a href="https://habrahabr.ru/post/81067/">an article 6 years ago</a> in which <a href="https://habrahabr.ru/users/adontz/" class="user_link">adontz</a> compared the performance of sockets and named pipes.  Results: Sockets - 160 megabytes per second, named pipes - 755 megabytes per second.  At the same time, it is necessary to make a correction for the 6-year-old iron and the .NET platform used for the tests.  Those.  we can safely say that on modern hardware with code, for example, in C, we get several gigabytes per second.  At the same time, as Wikipedia <a href="https://ru.wikipedia.org/wiki/DDR3_SDRAM">suggests</a> , the speed, for example, of DDR3 memory operation, is, depending on the frequency, from 6400 to 19200 MB / s - and this is in fact ideal MB / s in vacuum, in practice it will always be less. <br><br>  <b>Conclusion 1</b> : the speed of the payp is only several times less than the maximum possible speed of the RAM.  Not a thousand times smaller, not an order of magnitude, but only several times.  Modern OSs do their job well. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Data volumes </h3><br>  Let's take the same 755 MB / s from the paragraph above, as the speed of the named pipes.  Is it a lot or a little?  Well, if you, for example, wrote an application that would receive from the named channel uncompressed FullHD video at 60 frames per second and did something with it (encoded or streamed), then 355 MB / with.  Those.  even for such a very costly operation, the speed of the named channel would be enough with a margin of more than two times.  What does Visual Studio use in communicating with its components?  Well, for example, commands for git.exe and data from his answer.  This is a few kilobytes, in very rare cases - megabytes.  Data exchange with plug-ins can hardly be accurately assessed (plug-ins are very different).  But in any case, not a single plugin I‚Äôve seen needs hundreds of megabytes per second. <br><br>  <b>Conclusion 2</b> : taking into account the specifics of the data processed by Visual Studio (text, code, resources, pictures), the speed of the named pipes is enough with multiple reserves. <br><br><h3>  Latency </h3><br>  Well, ok, you say, speed-speed, but there is also latency.  Each operation will require some kind of synchronization overhead.  Yes, it will.  And about this I recently published <a href="https://habrahabr.ru/company/infopulse/blog/311134/">an article</a> .  People overestimate the overhead of blocking and synchronization.  The trouble is not in the locks themselves (they take nanoseconds), but in the fact that people write bad synchronous code, allow deadlocks, <a href="http://stackoverflow.com/questions/6155951/whats-the-difference-between-deadlock-and-livelock">live blocks</a> , races and damage to shared memory.  Fortunately, in the case of named pipes, the <a href="https://msdn.microsoft.com/ru-ru/library/windows/desktop/aa365150(v%3Dvs.85).aspx">API</a> itself hints at the advantages of the asynchronous approach and it is not that difficult to write correctly working code. <br><br>  <b>Conclusion 3</b> : so far there are no bugs in asynchronous / multithreaded code - it works quite fast, even with locks. <br><br><h3>  Practical example </h3><br>  Well, ok, you say, enough theory, you need practical proof!  And we have it.  This is one of the most popular desktop applications in the world - Google Chrome browser.  Originally created in the form of several interacting processes, Chrome immediately showed the advantages of this approach - one tab stopped hanging the rest, the death of the plug-in did not mean a drop in the browser anymore, the load in drawing the content in one window no longer guaranteed the brakes in the other, etc.  Chrome, if simplified, runs one main process, separate processes for rendering tabs, interactions with GPUs, plug-ins (in fact, the rules are a little trickier there, Chrome can optimize the number of child processes depending on different circumstances, but this is not very important now). <br><br>  You can read about Chrome architecture in their <a href="https://www.chromium.org/developers/design-documents/multi-process-architecture">documentation</a> , but here is a simplified picture for you: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd4/f8a/3f9/fd4f8a3f91c5bf4d8829d9278b5431b5.png" alt="image"><br><br>  What on this picture hides under the line with the coloring of "zebra" and the inscription IPC?  But just named pipes and hiding.  You can see them, for example, using the <b>Process Hacker</b> application (Handles tab): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/39d/32c/0d1/39d32c0d10b3409e8a31d3cff10216ff.png"></div><br>  Well, or using <b>Api Monitor</b> : <br><br><img src="https://habrastorage.org/files/f8e/20f/2af/f8e20f2af2174bb58e79d4804fa1ec54.png"><br><br>  How much do named pipes inhibit Chrome?  You yourself know the answer to this question: no matter how much.  The multi-process architecture speeds up the browser, allowing you to better distribute the load between the cores, better control the performance of processes, and more efficient use of memory.  Let's, for example, estimate how much data Chrome drives through its named channels when playing one minute of video from Youtube.  To do this, you can use the good IO Ninja utility (normally, the data stream on the pipe, to their shame, does not show Wireshark, API Monitor, or Sysinternals utilities - shame!): <br><br><img src="https://habrastorage.org/files/f4e/1f0/5b7/f4e1f05b7b414e73804e58d515724e52.png"><br><br>  The measurement showed that in 1 minute of playing the Youtube video, Chrome transmits 76 MB of data through the named channels.  At the same time, there were 79,715 individual read / write operations.  As you can see, even such a serious program like Chrome, even on a nonweak website like Youtube, didn‚Äôt confuse the named pipes.  So Visual Studio has every chance to benefit from the separation of a monolithic IDE into subprocesses. </div><p>Source: <a href="https://habr.com/ru/post/313638/">https://habr.com/ru/post/313638/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313626/index.html">A large list of valuable tips President Y Combinator</a></li>
<li><a href="../313628/index.html">Made in MIT: Gitless version control system</a></li>
<li><a href="../313630/index.html">Macaw - convenient library for vector graphics in Cocoa</a></li>
<li><a href="../313632/index.html">GitLab on open source project management policy</a></li>
<li><a href="../313636/index.html">Linux print server with AD integration</a></li>
<li><a href="../313640/index.html">‚ÄúMonitoring .NET application performance: approaches and tools,‚Äù an interview with Dina Goldstein</a></li>
<li><a href="../313642/index.html">Microsoft unveiled an update to its Cognitive Toolkit.</a></li>
<li><a href="../313644/index.html">Familiarity with the Ceph repository in pictures</a></li>
<li><a href="../313646/index.html">List of free transactional, hosting and marketing email-providers</a></li>
<li><a href="../313648/index.html">Machine Learning and Intel Xeon: Tencent In-Game Purchasing Advisory System</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>