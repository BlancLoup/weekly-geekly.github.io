<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WPF: Binding without trivial converters</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! 

 Every time when I started writing a new project on WPF, I was tormented by the idea: why in order to attach to the negation of a Boolean ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WPF: Binding without trivial converters</h1><div class="post__text post__text-html js-mediator-article">  Good day! <br><br>  Every time when I started writing a new project on WPF, I was tormented by the idea: why in order to attach to the negation of a Boolean variable or convert a Boolean variable to the Visibility type, do I need to write my own converter, which then later must be specified in each Binding?  And if we need to display the sum of two numbers, or just divide the number by 2, we need to write so much code that we don‚Äôt want to add and divide anything. <br><br>  To solve this problem, once and for all, I wrote an analogue of standard binding, allowing you to bind to any expression from one or more sources of binding.  About how it works and how to use it, I want to tell you more. <br><a name="habracut"></a><br>  Compare, the same binding performed using standard Binding and new Binding (c: Binding): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Before:</b> <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Label.Content</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MultiBinding</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Conveter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{x:StaticResource</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">MyCustomConverter2</span></span></span><span class="hljs-tag">}&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Binding</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">A</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Binding</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">B</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Binding</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">C</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MultiBinding</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Label.Content</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Label</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  <b>After:</b> <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding A+B+C }"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  <b>Before:</b> <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Visibility</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding IsChecked Converter={x:StaticResource NegativeBoolToVisibilityConveter}}"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  <b>After:</b> <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Visibility</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding !IsChecked}"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  As you can see from these examples, the new Binding can take in the Path property any expression from one or more Source Property.  All basic arithmetic and logical operations are supported, as well as string addition operations and the ternary operator. <br><br><h3>  Other examples: </h3><br>  <b>Mathematical operations:</b> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding A+B+C}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding ABC}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding A*(B+C)}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding 2*AB*0.5}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding A/B, StringFormat={}{0:n2} --StringFormat is used}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding A%B}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding '(A == 1) ? 10 : 20'}"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  <b>Logical operations:</b> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CheckBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!IsChecked"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IsChecked</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding !IsChecked}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding 'IsChecked and IsFull'}"</span></span></span><span class="hljs-tag">/&gt;</span></span> {'and'  '&amp;&amp;' . } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding '!IsChecked or (A &gt; B)'}"</span></span></span><span class="hljs-tag">/&gt;</span></span> {'or'  '||',    '||'} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding '(A == 1) and (B less= 5)'}"</span></span></span><span class="hljs-tag">/&gt;</span></span> {'less='  '<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">='</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">.</span></span></span><span class="hljs-tag"> } &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding (IsChecked || !IsFull)}"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  <b>Working with bool and visibility:</b> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TargetButton"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Visibility</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding HasPrivileges, FalseToVisibility=Collapsed}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TargetButton"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Visibility</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding !HasPrivileges}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TargetButton"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Visibility</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding !HasPrivileges, FalseToVisibility=Hidden}"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  <b>Work with strings:</b> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding (Name + \' \' + Surname)}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding (IsMan?\'Mr\':\'Ms\') + \' \' + Surname + \' \' + Name}"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  <b>Work with the Math class</b> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding Math.Sin(A*Math.PI/180), StringFormat={}{0:n5}}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding A*Math.PI}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding 'Math.Sin(Math.Cos(A))'}"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br><h3>  Opportunities </h3><br>  Listed below are all the features of the new Binding that are currently available: <br><br><table><tbody><tr><th>  Opportunity </th><th>  Read more </th><th>  Example </th></tr><tr><td>  Arithmetic operations </td><td>  + - / *% </td><td>  &lt;Label Content = "{c: Binding A * 0.5 + (B / C - B% C)}" /&gt; </td></tr><tr><td>  Logical operations </td><td>  !  &amp;&amp; ||  ==! =, &lt;,&gt;, &lt;=,&gt; = </td><td>  &lt;TextBox Text = "{c: Binding (IsChecked ||! IsFull)}" /&gt; </td></tr><tr><td>  Working with strings </td><td>  + </td><td>  &lt;TextBox Text = "{c: Binding (Name + \ '\' + Surname)}" /&gt; </td></tr><tr><td>  Ternary operator </td><td>  ? </td><td>  &lt;TextBox Text = "{c: Binding '(A == 1)? 10: 20'}" /&gt; </td></tr><tr><td>  Automatic translation from bool to Visibility </td><td>  FalseToVisibility determines how to display false </td><td>  &lt;Button Visibility = "{c: Binding! IsChecked}" /&gt; </td></tr><tr><td>  Math class support </td><td>  All methods and constants </td><td>  &lt;TextBox Text = "{c: Binding Math.Sin (A * Math.PI / 180)}" /&gt; </td></tr></tbody></table><br><table><tbody><tr><td>  Automatic calculation of inverse function and reverse linking </td><td>  If the expression can build the opposite, then it will be done automatically and the binding will become bidirectional </td></tr><tr><td>  0% loss in work speed </td><td>  The original Path is compiled into an anonymous function only 1 time, which is then constantly substituted for the modified property values. </td></tr></tbody></table><br><h3>  Bool to visibility </h3><br>  The new Binding automatically converts the bool type to the Visibility type if properties are associated with such types.  By default, it is assumed that false is translated to Visibility.Collapsed, but this behavior can be changed by setting the optional property FalseToVisibility (Collapsed or Hidden): <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Visibility</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding IsChecked, FalseToVisibility=Hidden}"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br><h3>  How is CalcBinding inside </h3><br>  For those who first learned about the possibility of expanding xaml, I will make a small digression.  Everything we refer to from xaml using curly brackets is quite ordinary classes written in C #, but necessarily inherited from the MarkupExtension class.  Such classes are called - Markup Extension (markup extension).  WPF allows you to add a custom set of standard Markup Extension.  A number of articles are devoted to writing such additions, for example <a href="https://habr.com/ru/post/248197/">[1]</a> and it is really easy to write them. <br><br>  When I began to study the Binding class (which of course is the Markup Extension), my first thought was to inherit from it, and in certain places to change the binding behavior.  But, unfortunately, it turned out that the ProvideValue method, whose behavior was to be changed, is marked as sealed (declared with the sealed keyword) still in the parent class BindingBase.  This arrangement of affairs forced me to create a new empty Markup Extension and copy into it all the properties used in standard Binding and MultiBinding.  Of course, such a solution requires modifying the class with any change in Binding and MultiBinding, but if we recall that WPF has not been developing for a long time, I think it does not threaten me. <br><br>  How does CalcBinding work?  At the beginning of the ProvideValue method, the Path property is analyzed and if the Path contains one variable, a Binding is created, otherwise a MultiBinding is created that contains one Binding for each variable.  In the created Binding or MultiBinding, the values ‚Äã‚Äãof all CalcBinding properties are skipped, and my converter, which implements the IConverter and IMultiConverter interfaces and performs the work of compiling the Path and launching the resulting anonymous function, is passed as a converter.  The resulting Binding or MultiBinding method is called ProvideValue and the result of the work is returned as the result of the work of the external ProvideValue.  In this way, WPF works with its standard binding classes, and my class acts as a kind of factory. <br><br>  As mentioned above, in order for the new solution not to lose in speed to the old, the original expression specified in the Path property is compiled only once, when you first call the Convert or ConvertBack converter methods.  As a result of the compilation, an anonymous function is obtained that takes as parameters the source property, to which the target property is attached.  If any of the source property changes, the resulting function is called with the new parameters and accordingly returns the new value. <br><br>  Parsing a string expression occurs in two stages: on the first of the string, an expression tree is built (System.Linq.Expressions.Expression), on the second, the resulting expression is compiled using standard methods.  To create an Expression from a string, there is a parser from Microsoft, which is located in the DynamicExpression library <a href="https://habr.com/ru/post/248197/">[2]</a> .  Unfortunately, it showed problems that did not allow using this solution in an unchanged form, for example, a bug <a href="https://habr.com/ru/post/248197/">[3]</a> .  Fortunately, the parser was laid out in opensource, and I used its fork called DynamicExpresso <a href="https://habr.com/ru/post/248197/">[4]</a> , which solved this and several other problems, and also expanded the list of supported types. <br><br>  Omitting the details, you can imagine the logic of the Convert method of the converter as follows: <br><br><pre> <code class="hljs pgsql">private Lambda compiledExpression; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Convert(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> targetType, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> parameter, CultureInfo culture) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (compiledExpression == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { var expressionTemplate = (string)parameter; compiledExpression = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Interpreter().Parse(expressionTemplate, <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Select</span></span>(v =&gt; getParameter(v)).ToList()); } var result = compiledExpression.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">values</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre><br><br><h3>  Reverse binding </h3><br>  After the linking away from the sources to the target property was successfully tested, I wanted to be able to automatically search for the inverse function and linking in the opposite direction. <br><br>  It is clear that in order to be able to construct an inverse function, it is required that it have only one argument and this argument has been encountered exactly 1 time.  These are necessary but not sufficient conditions.  From the school mathematics course, we remember that if Y = F (X) is a complex function, represented as Y = F <sub>1</sub> (F <sub>2</sub> (F <sub>3</sub> ... (F <sub>N</sub> (X)))), then X = F <sup>-1</sup> ( Y) = F <sub>N</sub> <sup>-1</sup> (F <sub>N-1</sub> <sup>-1</sup> (F <sub>N-2</sub> <sup>-1</sup> (... (F <sub>1</sub> <sup>-1</sup> (Y))))) <br><br>  Thus, in order to construct a complex inverse function, we need to find the inverse functions of all the functions constituting this function and apply them in the reverse order. <br><br>  Let's go back to programming.  From a programmatic point of view, we need to build an expression tree that implements the inverse function using a well-known expression tree that implements a direct function.  The restrictions imposed on Expression are such that it is impossible to modify the generated expression tree, so you have to build new ones. <br><br>  Let's look at an example of what we need to do for this.  For example, the original function looks like this: <br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">Path</span></span> = <span class="hljs-number"><span class="hljs-number">10</span></span> + (<span class="hljs-number"><span class="hljs-number">6</span></span>+<span class="hljs-number"><span class="hljs-number">5</span></span>)*(<span class="hljs-number"><span class="hljs-number">3</span></span>+X) - Math.Sin(<span class="hljs-number"><span class="hljs-number">6</span></span>*<span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre><br><br>  According to this expression will build the following tree: <br><br><img src="https://habrastorage.org/files/3c5/981/85d/3c598185d75b4e80972f83e38ede8fb6.jpg"><br><br>  Imagine it in such a way that the path from the sheet containing X to the top of the Path was straight, and the remaining nodes are located above and below: <br><br><img src="https://habrastorage.org/files/4d5/48b/956/4d548b956a3c4a63baacf04d92063a78.jpg"><br><br>  In this picture, it becomes clear that in order to build an inverse expression tree, it is necessary to replace all functions standing in the nodes on the path from the sheet with variable X to the root with the Path result to inverse, and then change the order of their application to the reverse: <br><br><img src="https://habrastorage.org/files/323/6ac/efa/3236acefa9594a1f82de50efc0379730.jpg"><br><br>  Branches that calculate fixed values ‚Äã‚Äãdo not need to be inverted.  As a result, we obtain the inverse expression tree, from which the inverse function is obtained: <br><pre> <code class="hljs pgsql">X = ((<span class="hljs-type"><span class="hljs-type">Path</span></span> - <span class="hljs-number"><span class="hljs-number">10</span></span>) + Math.Sin(<span class="hljs-number"><span class="hljs-number">6</span></span>*<span class="hljs-number"><span class="hljs-number">5</span></span>)) / (<span class="hljs-number"><span class="hljs-number">6</span></span> + <span class="hljs-number"><span class="hljs-number">5</span></span>) - <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre><br>  Variable search, validation and construction of the inverse tree is performed with just one recursive function. <br><br>  Currently the following list of functions is supported, for which the inverse are automatically defined: <br><ul><li>  +, -, *, / </li><li>  ! </li><li>  Math.Sin, Math.ASin </li><li>  Math.Cos, Math.ACos </li><li>  Math.Tan, Math.ATan </li><li>  Math.Pow </li><li>  Math.Log </li></ul><br>  The resulting tree of expressions is calculated and compiled into an anonymous function also only 1 time, when the first binding operation is triggered. <br><br><h3>  Disadvantages of the solution </h3><br>  Like any other, this solution has a number of limitations and disadvantages.  The deficiencies identified are listed below. <br><br>  1.) If one of the sourceProperty is null, then it becomes impossible for it to determine the type at the stage of the creation of the Expression, since typeof (null) returns nothing.  This makes it impossible to correctly handle for example such an expression: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{c:Binding Path = (A == null) ? 3 : 4}"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  Unfortunately, it is not directly possible to find the source property type from the Binding class, so the only possible solution is to recognize the source property type through reflection, but in this case you will have to implement half of the Binding functionality for Source (RelativeSource, ElementName, etc.) search.  Perhaps there are alternative solutions to this problem, so I will welcome your suggestions on this topic. <br><br>  2.) Since the xaml markup is xml markup, it prohibits a number of characters, such as an opening tag or an ampersand icon, meaning also more and more logical AND signs.  In order to escape from forbidden characters, Path uses a series of substitutions for these operators, presented below: <br><br><table><tbody><tr><th>  Operator </th><th>  Replacing in Path </th><th>  Note </th></tr><tr><td>  &amp;&amp; </td><td>  and </td></tr><tr><td>  || </td><td>  or </td><td>  Permitted for symmetry, optional </td></tr><tr><td>  &lt; </td><td>  less </td></tr><tr><td>  &lt;= </td><td>  less = </td></tr></tbody></table><br><br>  3.) You cannot set your own converter in CalcBinding.  I did not come up with a script that would require such an opportunity, so if you have any suggestions, I will be glad to read them. <br><br><h3>  Links to the project: </h3><br>  The library is available on <a href="https://github.com/Alex141/CalcBinding">github</a> .  The project contains the source code of the library, a full-fledged example of the use of all features and tests.  The library has created a nuget package available at: <br>  <a href="https://www.nuget.org/packages/CalcBinding/">www.nuget.org/packages/CalcBinding</a> <br><br><h3>  References to the sources used: </h3><br><a name="1"></a>  [1] <a href="http://10rem.net/blog/2011/03/09/creating-a-custom-markup-extension-in-wpf-and-soon-silverlight">10rem.net/blog/2011/03/09/creating-a-custom-markup-extension-in-wpf-and-soon-silverlight</a> <br><a name="2"></a>  [2] <a href="http://weblogs.asp.net/scottgu/dynamic-linq-part-1-using-the-linq-dynamic-query-library">weblogs.asp.net/scottgu/dynamic-linq-part-1-using-the-linq-dynamic-query-library</a> Article <br>  <a href="http://msdn.microsoft.com/en-us/vstudio/bb894665.aspx">msdn.microsoft.com/en-us/vstudio/bb894665.aspx</a> Download Link <br><a name="3"></a>  [3] <a href="https://connect.microsoft.com/VisualStudio/feedback/details/677766/system-linq-dynamic-culture-related-floating-point-parsing-error">connect.microsoft.com/VisualStudio/feedback/details/677766/system-linq-dynamic-culture-related-floating-point-parsing-error</a> <br><a name="4"></a>  [4] <a href="https://github.com/davideicardi/DynamicExpresso">github.com/davideicardi/DynamicExpresso</a> </div><p>Source: <a href="https://habr.com/ru/post/248197/">https://habr.com/ru/post/248197/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248181/index.html">Home Raspberry shooting gallery</a></li>
<li><a href="../248185/index.html">Car Tutorial Guide (Unity3d) part 2 of 3</a></li>
<li><a href="../248187/index.html">What's new in CSS 4th level selectors?</a></li>
<li><a href="../248189/index.html">Create an environment for PyQt5 in Linux MInt (Ubuntu)</a></li>
<li><a href="../248193/index.html">Deploying CUCM with VMware Workstation 10.0.3 and GNS3</a></li>
<li><a href="../248199/index.html">7 secrets of successful trading on Amazon</a></li>
<li><a href="../248201/index.html">Cisco information security in 2014: a brief summary</a></li>
<li><a href="../248203/index.html">Test Automation with Ruby and WATIR</a></li>
<li><a href="../248205/index.html">PHDays V: Botnet Detection, NFC Stunts, and ‚ÄúSocial Engineers‚Äù Competitions</a></li>
<li><a href="../248207/index.html">Xargs: a variety of use cases</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>