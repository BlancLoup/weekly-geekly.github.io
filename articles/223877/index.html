<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How Host-tracker helped to quickly detect malicious code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Our site monitoring service, in addition to the availability of servers, also allows you to monitor site content . For example, if you need to receive...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How Host-tracker helped to quickly detect malicious code</h1><div class="post__text post__text-html js-mediator-article">  Our site monitoring service, in addition to the availability of servers, also allows you to <a href="http://www.host-tracker.com/Glossary/ContentCheck">monitor site content</a> .  For example, if you need to receive notifications that a certain keyword has appeared on the site, or vice versa, if it is missing. <br>  Today we want to tell how using the Host-tracker our client struggled with detecting malicious code so as not to fall into the ban of Yandex. <br><img src="https://habrastorage.org/getpro/habr/post_images/594/490/74d/59449074d5531f08e16c047f249e9713.jpg" alt="image"><br><a name="habracut"></a><br>  Presentation on behalf of the client: <br><br><h5>  The site hit the ban of Yandex </h5><br>  One day, while trying to access the mysite ***. Com site, a warning appeared that the site could threaten the security of the computer. <br>  And also a letter came from Yandex: A potentially dangerous code was found on the site: <br>  <i>A code has been found on the pages of your mysite ***. Com site that could be dangerous for visitors.</i>  <i>Execution of this code when visiting the site may lead to undesirable consequences for the user: computer infection by malware, unauthorized use of its resources, damage or theft of personal data.</i> <i><br></i>  <i>The site is currently displayed in search results labeled "This site may threaten the security of your computer."</i> <i><br></i>  <i>Yandex does not evaluate the content of the site and warns users that the site could be infected without the knowledge of its owners.</i> <i><br></i>  <i>Please remove the malicious code.</i>  <i>If during the new check the code is not found, the mark in the search results will be removed.</i>  <i>In order to remove the mark as quickly as possible, immediately after removing the code, you can request a re-check of the site.</i> <br><br>  In the Yandex webmaster panel there was a message: <br>  <i>Random check result</i> <i><br></i>  <i>Last inspection date</i> <i><br></i>  <i>Page mysite ***. Html</i> <i><br></i>  <i>Verdict Behavioral analysis.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Malware Detection </h5><br>  Naturally, the site was immediately checked by various online antiviruses, but no threats were detected.  After that, I thought it was some kind of misunderstanding and wrote a letter in support of Yandex, asking to clarify the situation, indicating that the online antiviruses did not find any threats.  They replied that one of the files, common.js, was infected on the site.  I also noticed that links to some "left" sites appeared from the main page.  I suppose some kind of link exchange found a good method to sell links of unsuspecting owners.  Opening the file, I actually found malicious code in it: <br> <code>/&gt;...</code> <br> <br><h5>  Anti-malware </h5><br>  Overjoyed with such an easy solution to the problem, I took the file from the old backup, uploaded it to the server, and wrote to Yandex, that I had fixed everything, you can remove it from the ban. <br>  Yandex really removed the site from the ban, and in the webmaster‚Äôs panel it was indicated that everything was OK.  But a couple of days passed and the picture repeated.  I immediately checked the file that was infected earlier, made sure that the malicious code was there, and replaced it with a file from backup. <br>  I immediately wrote to the hoster that I had such a problem.  They replied that only I have a problem, but they are fine, they advised me to change passwords for the admin panel, ftp and to the database.  I did it all, put a clean file from backup, but it was literally a couple of hours and the file was again infected. <br><br>  I also decided to check my neighbors by IP.  Randomly opened 5 sites, and not how many was not surprised that they also have external links from the main one, using an iframe.  Naturally, I immediately wrote to the hoster about this, and received the answer that everything is OK, no more than 5% of client accounts are infected and there are no alleged problems.  He answered them that for nonsense he argued that there was a problem, then they gave a more detailed answer with a proposal to restore the backup.  Also recommended to put access to files 444 and 555 directories, which I did.  But it was literally a day, access was returned to 644 and 755, respectively, and the malicious code in the file. <br><br>  Found on the forums a description of the same problem.  The people described the same symptoms and the same methods of struggle.  Moreover, one of the victims suggested that the hoster change all its passwords for a couple of days so that he does not know them, and make sure that the malicious code appears.  In a word, the hoster admitted that there is a problem on their side and they are trying to solve it. <br><br>  The deadlines for solving the problem were not announced, and the site constantly got into the ban of Yandex and, accordingly, during this time has already lost its position in the issue. <br><br><h5>  Content Search </h5><br>  For specific files that knew that they were infected almost every couple of hours, they used the Host-tracker function - <a href="http://www.host-tracker.com/Glossary/ContentCheck">search by content</a> .  I chose Http check, I registered the URL: the path to the mysite *** / common.js file, which was constantly infected, I registered to monitor by the keyword ‚Äúiframe‚Äù, which was present in the enemy code, I chose: <i>all keywords should be absent on the checked page</i> .  Now, when the enemy code appeared, I received an SMS and a notification to an e-mail in just a minute (I chose a polling interval of 1 min). <br><img src="https://habrastorage.org/getpro/habr/post_images/d19/b92/150/d19b921505979823e3599f95b23aa8cf.jpg"><br>  At first, I had to promptly correct it myself, so that Yandex did not ban.  Then I noticed that a notification is coming that common.js contains malicious code, and literally in a couple of minutes the files are already without malicious code.  The hoster finally began to self-healing files.  This lasted for another couple of days, until the infection reports stopped coming. <br><br><h5>  Checksum check </h5><br>  For myself, I have additionally implemented a simple method for controlling changes to * .js files: <br>  Files must be of any enemy code.  For example, in the morning, we save the checksum of files with the necessary extension .js, .php, etc. <br> <code>find . -type f -name "*.js" -exec md5sum {} \; &gt; file-js1.txt</code> <br>  and repeat the procedure in the evening <br> <code>find . -type f -name "*.js" -exec md5sum {} \; &gt; file-js2.txt</code> <br>  then I compare these two files for discrepancies in checksums: <br> <code>diff -u file-js1.txt file-js2.txt.</code> <br>  If something has changed, check the reason for changing the files. <br><br>  After this incident, I found several automated solutions that allow you to track changes for certain types of files, and use them. <br></div><p>Source: <a href="https://habr.com/ru/post/223877/">https://habr.com/ru/post/223877/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../223861/index.html">GOkey: data cable, battery, USB flash drive and key detector in one bottle</a></li>
<li><a href="../223863/index.html">Comparing Azure Queues and Service Bus Queues services</a></li>
<li><a href="../223867/index.html">Vibrating Insoles - wearable technology that you did not expect. (concept)</a></li>
<li><a href="../223869/index.html">MBLOK Wireless Storage on Kickstarter</a></li>
<li><a href="../223873/index.html">Distribution of scientific software. Is free</a></li>
<li><a href="../223883/index.html">Electric for regular airlines</a></li>
<li><a href="../223885/index.html">DevConf 2014: Andrei Aksenov, author of Sphinx - will tell you how the repositories are arranged inside NoSQL</a></li>
<li><a href="../223887/index.html">We write the script interpreter and stack machine</a></li>
<li><a href="../223889/index.html">Why does business need a cloud: an overview of real IaaS usage scenarios</a></li>
<li><a href="../223893/index.html">Web Layer Layer Modes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>