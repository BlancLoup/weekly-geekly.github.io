<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Getting started with the graph database Neo4j</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The following task arose in our project - there is a base with a large number of goods, at the level of hundreds of thousands. Each product has hundre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Getting started with the graph database Neo4j</h1><div class="post__text post__text-html js-mediator-article">  The following task arose in our project - there is a base with a large number of goods, at the level of hundreds of thousands.  Each product has hundreds of dynamically generated characteristics.  It is necessary to provide fast filtering by goods for a set of different characteristics.  Response generation time should be no more than 0.3 seconds, you need to maintain sophisticated logic in style. <br><br><pre><code class="hljs vbscript">(<span class="hljs-number"><span class="hljs-number">1</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span> &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (<span class="hljs-number"><span class="hljs-number">3</span></span> &gt; <span class="hljs-number"><span class="hljs-number">17</span></span>)) ...     <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">OR</span></span></code> </pre> <br><br>  A typical example of such a functional is <a href="http://hotline.ua/computer/myshi-klaviatury/">hotline.ua/computer/myshi-klaviatury</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/11f/5eb/62c/11f5eb62cd8d0b0719f563bfff8d7b6d.png" alt="Example of functionality"><br><br>  Everything is implemented within MySQL + Symfony2 / Doctrine, the speed is unsatisfactory - the answers are formed within 1-10 seconds.  My attempts to optimize all this economy - under cat. <br><a name="habracut"></a><br><br><h4>  Terminology of the task of filtering goods (in simplified form) </h4><br><ul><li>  <b>characteristic</b> - a certain property of the goods.  For example, the amount of memory. </li><li>  <b>product template</b> - a set of all possible characteristics of the same type of goods, for example - a list of possible characteristics of computer mice.  When adding a new product, the administrator can select the characteristics within the template.  It is impossible to add a new characteristic for one product - you need to add a characteristic to the template for this product.  At the same time, this feature will be available for all products using this template. </li><li>  <b>product group</b> - products based on a single template.  For example, computer mice.  Filtering is done only for products from one group. </li><li>  <b>criterion</b> - a logical rule that consists of a set of formal requirements for the characteristics of the goods.  For example, a ‚Äúgaming mouse‚Äù is a set of performance requirements (size not miniature) AND (laser sensor) AND (sensor resolution not less than 1500) </li><li>  <b>filter</b> - a group of criteria for the same type of goods.  Depending on the criteria, they can be combined via AND or OR </li></ul><br>  The hotline has a more advanced version implemented - with a hint how many goods will remain after the activation of the criterion.  For example, if you select the ‚ÄúBluetooth‚Äù filter, then after loading the page next to the ‚ÄúMouse Sensor Type - Optical‚Äù filter there will be the number 17. In fact, for such an implementation it is necessary not only to select the criteria, but also to count the number of items for each remaining filter beforehand. its activation. <br><br>  To solve this problem, I decided to try out the graph database <a href="http://neo4j.org/">Neo4j</a> .  For superficial reference, I recommend reading <a href="http://habrahabr.ru/post/152079/">this post</a> . <br><br><h4>  Terminology of Neo4j and graph databases in general. </h4><br><ul><li>  <b>graph database</b> , <b><a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D1%2580%25D0%25B0%25D1%2584_(%25D0%25BC%25D0%25B0%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0%25D1%2582%25D0%25B8%25D0%25BA%25D0%25B0)">graph</a> database</b> - a database built on graphs - nodes and links between them </li><li>  <a href="http://www.neo4j.org/learn/cypher"><b>Cypher</b></a> is a language for writing queries to the Neo4j database (approximately, like SQL in MYSQL) </li><li>  <b>node</b> , <b>node</b> - an object in the database, a graph node.  The number of nodes is limited to 2 to the extent of 35 ~ 34 billion </li><li>  <b>node label</b> , <b>node label</b> - is used as a conditional ‚Äúnode type‚Äù.  For example, movie nodes can be associated with actor nodes.  The node labels <b>are case-sensitive</b> , and Cypher produces no errors if you type the wrong name in the register. </li><li>  <b>relation</b> , a <b>connection</b> is a connection between two nodes, a graph edge.  The number of links is limited to 2 to the extent of 35 ~ 34 billion </li><li>  <b>relation identirfier</b> , the <b>type of connection</b> is in Neo4j for connections.  The maximum number of link types is 32767 </li><li>  <b>properties</b> , <b>node properties</b> - a set of data that can be assigned to a node.  For example, if a node is a product, then in the properties of the node, you can store the product id from the MySQL database. </li><li>  <b>node ID</b> , <b>node ID</b> <b>- the node</b> 's unique identifier.  By default, it is this ID that is displayed when viewing the result.  How to use it in Cypher queries I did not find </li></ul><br><br><h4>  Problem Solving Scheme </h4><br>  For each product, create a separate node; in the node properties, store the product id in the MySQL database.  For each criterion to create its own node, in the properties store the id of the criterion.  Next, associate all the nodes of the goods with criteria nodes that are suitable for the product.  When changing the characteristics of the product or the properties of the criteria to update the connection between the nodes. <br><br><h4>  The first solution is with Neo4j </h4><br>  Considering that I never worked with graph databases - I decided to deploy Neo4j locally, examine Cypher at a basic level and try to implement the required logic.  If everything works out - test the speed of work for the base of 1 million products, each has 500 characteristics. <br><br>  Deploying the system is quite simple - download the <a href="http://www.neo4j.org/download">distribution</a> and install it. <br><br>  The Neo4j server has RestAPI, for php there is a <a href="https://github.com/jadell/neo4jphp">neo4jphp</a> library.  There is also a bundle for integration with <a href="https://github.com/klaussilveira/neo4j-ogm-bundle">symfony2</a> - <a href="https://github.com/klaussilveira/neo4j-ogm-bundle">klaussilveira / neo4j-ogm-bundle</a> . <br><br>  The distribution kit includes a web server and an application for working with it, by default <a href="http://localhost:7474/">http: // localhost: 7474 /</a> <br>  There is also <a href="http://localhost:7474/webadmin/">an old version of the client</a> , with different functionality. <br><br>  As documentation it is convenient to use <a href="http://docs.neo4j.org/refcard/2.0/"><b>short documentation</b></a> .  <a href="https://github.com/neo4j-contrib/graphgist/wiki"><b>Code examples</b></a> are in graphgist.  In theory, they should be executed there online, but now it does not work.  To view the code, follow the link from the <a href="https://github.com/neo4j-contrib/graphgist/wiki">graphgist</a> (for example, <a href="http://gist.neo4j.org/%3F8167705">here</a> ) and click the Page Source button. <br><br>  For experiments with Neo4j, it is very convenient to use the <a href="http://localhost:7474/browser/">built-in web client.</a> There you can perform Cypher requests and view the response to requests along with connections and characteristics of the nodes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/579/9bc/927/5799bc927b1fafc66de32a4cbe73e010.png" alt="Node4j embedded client"><br><br>  <b>Simple Cypher Team</b> <br><br>  <b>Creating a node with a label</b> <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">create</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ware</span></span> {<span class="hljs-attribute"><span class="hljs-attribute">wareId</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>});</code> </pre> <br>  <b>Select all nodes</b> <br><pre> <code class="hljs lisp">MATCH (<span class="hljs-name"><span class="hljs-name">n</span></span>) RETURN n<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br>  <b>Counter</b> <br><pre> <code class="hljs lisp">MATCH (<span class="hljs-name"><span class="hljs-name">n</span></span><span class="hljs-symbol"><span class="hljs-symbol">:Ware</span></span> {wareId:<span class="hljs-number"><span class="hljs-number">1</span></span>}) RETURN <span class="hljs-string"><span class="hljs-string">"Our graph have "</span></span>+count(<span class="hljs-name"><span class="hljs-name">*</span></span>)+<span class="hljs-string"><span class="hljs-string">" Nodes with label Ware and wareId=1"</span></span> as counter<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br>  <b>Create 2 related nodes</b> <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">CREATE</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">wareId</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>})<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[r:SUIT]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">m</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">criteriaId</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>})</code> </pre> <br>  <b>Link 2 existing nodes</b> <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">MATCH</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> {<span class="hljs-attribute"><span class="hljs-attribute">wareId</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}), (<span class="hljs-selector-tag"><span class="hljs-selector-tag">b</span></span> {<span class="hljs-attribute"><span class="hljs-attribute">criteriaId</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>}) <span class="hljs-selector-tag"><span class="hljs-selector-tag">MERGE</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span>)<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[r:SUIT]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">b</span></span>)</code> </pre> <br>  <b>Delete all related nodes</b> <br><pre> <code class="hljs sql">match (n)-[r]-() <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> n,r;</code> </pre> <br>  <b>Delete all unbound nodes</b> - if you try to run this command in the database where there are related nodes, it will not work.  It is necessary to delete the connected nodes first. <br><pre> <code class="hljs sql">match n <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> n;</code> </pre> <br>  <b>Choose products suitable for criterion 3</b> <br><pre> <code class="hljs lisp">MATCH (<span class="hljs-name"><span class="hljs-name">a</span></span><span class="hljs-symbol"><span class="hljs-symbol">:Ware</span></span>)--&gt;(<span class="hljs-name"><span class="hljs-name">b</span></span><span class="hljs-symbol"><span class="hljs-symbol">:Criteria</span></span> {criteriaId: <span class="hljs-number"><span class="hljs-number">3</span></span>}) RETURN a<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br>  Immediately several Cypher commands the web client can not perform.  They say that the <a href="http://localhost:7474/webadmin/">old client</a> can do this, but I have not found such an opportunity.  Therefore, you need to copy 1 line. <br><br>  You can create a set of nodes with connections by one command, you need to give different names to the nodes, you can give names to the links <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">CREATE</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">w1</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ware</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">wareId</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>})<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[:SUIT]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">c1</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Criteria</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">criteriaId</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>}), (<span class="hljs-selector-tag"><span class="hljs-selector-tag">w2</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ware</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">wareId</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>})<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[:SUIT]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">c2</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Criteria</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">criteriaId</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>}), (<span class="hljs-selector-tag"><span class="hljs-selector-tag">w3</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ware</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">wareId</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>})<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[:SUIT]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">c3</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Criteria</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">criteriaId</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>}), (<span class="hljs-selector-tag"><span class="hljs-selector-tag">w4</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ware</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">wareId</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>})<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[:SUIT]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">c1</span></span>), (<span class="hljs-selector-tag"><span class="hljs-selector-tag">w5</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ware</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">wareId</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>})<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[:SUIT]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">c1</span></span>), (<span class="hljs-selector-tag"><span class="hljs-selector-tag">w4</span></span>)<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[:SUIT]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">c2</span></span>), (<span class="hljs-selector-tag"><span class="hljs-selector-tag">w5</span></span>)<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[:SUIT]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">c3</span></span>);</code> </pre><br>  Get this structure.  If you look less clear, you can rearrange the node with the mouse. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f9c/56c/e2b/f9c56ce2b4037985c326c305391e51a8.png" alt="Test structure"><br><br><h4>  Intermediate speed tests Neo4j </h4><br>  It's time to test the speed of filling the base and simple samples from a large base. <br><br>  To do this, we clone neo4jphp <br><pre> <code class="hljs php">git <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> https:<span class="hljs-comment"><span class="hljs-comment">//github.com/jadell/neo4jphp.git</span></span></code> </pre> <br>  The basic description of this library is in <a href="http://habrahabr.ru/post/152079/">this post</a> , so I will immediately lay out the code to fill out the test database samples / test_fill_1.php <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Index</span></span>\<span class="hljs-title"><span class="hljs-title">NodeIndex</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Relationship</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Node</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Cypher</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'example_bootstrap.php'</span></span>; $neoClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Client(); $neoWares = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NodeIndex($neoClient, <span class="hljs-string"><span class="hljs-string">'Ware'</span></span>); $neoCriterias = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NodeIndex($neoClient, <span class="hljs-string"><span class="hljs-string">'Criteria'</span></span>); $neoWareLabel = $neoClient-&gt;makeLabel(<span class="hljs-string"><span class="hljs-string">'Ware'</span></span>); $neoCriteriaLabel = $neoClient-&gt;makeLabel(<span class="hljs-string"><span class="hljs-string">'Criteria'</span></span>); $wareTemplatesCount = <span class="hljs-number"><span class="hljs-number">200</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    $criteriasCount = 500; //   $waresCount = 10000; //   $commitWares = 100; //  ,     1 batch $minRelations = 200; //       $maxRelations = 400; //       $time = time(); for($wareTemplateId = 0;$wareTemplateId&lt;$wareTemplatesCount;$wareTemplateId++) { $neoClient-&gt;startBatch(); print $wareTemplateId." (".$criteriasCount." criterias, ".$waresCount." wares with rand(".$minRelations.",".$maxRelations.") ..."; $criterias = array(); //   for($criteriaId = 1;$criteriaId &lt;=$criteriasCount;$criteriaId++) { $c = $neoClient-&gt;makeNode()-&gt;setProperty('criteriaId', $wareTemplateId * $criteriasCount + $criteriaId)-&gt;save(); // -&gt;addLabels(array($neoCriteriaLabel)) -    commitBatch $neoCriterias-&gt;add($c, 'criteriaId', $wareTemplateId * $wareTemplatesCount + $criteriaId); // -&gt;save()    $criterias[] = $c; } //   for($wareId = 1;$wareId &lt;=$waresCount;$wareId++) { $w = $neoClient-&gt;makeNode()-&gt;setProperty('wareId', $wareTemplateId * $waresCount + $wareId)-&gt;save(); // -&gt;addLabels(array($neoWareLabel)) -    commitBatch $neoWares-&gt;add($c, 'wareId', $wareTemplateId * $waresCount + $criteriaId); //        for($i = 1;$i&lt;=rand($minRelations,$maxRelations);$i++) { $w-&gt;relateTo($criterias[array_rand($criterias)], "SUIT")-&gt;save(); } if(($wareId % $commitWares) == 0) { // ,     Neo4j  $neoClient-&gt;commitBatch(); print " [commit ".$commitWares." ".(time() - $time)." sec]"; $time = time(); $neoClient-&gt;startBatch(); } } $neoClient-&gt;commitBatch(); print " done in ".(time() - $time)." seconds\n"; $time = time(); }</span></span></code> </pre><br><br>  I left the base filling script for the night.  After about 4 hours, the script stopped adding data and the Neo4j service started loading the server 100%.  In the morning, as a result of the work, 78300 products from 8 categories of goods were inserted. <br>  The results of the test fill database - about 20 products per second with 200-400 links.  Not a very good result - Mysql and Cassandra gave out about 10-20 thousand inserts per second (10 fields, 1 primary index, 1 index).  But the insertion speed is not critical for us - we can update the data graph in the background after editing the product.  But the speed of data sampling is critical. <br><br>  The size of the test database on the disk is 1781 megabytes.  It holds 78300 products, 4000 criteria, 15660000-31320000 links.  The total number of objects (nodes and connections) is less than 32 million - an average of 55 bytes per entity.  Too much, as for me, but the main requirement is still the speed of the samples, and not the size of the base. <br><br>  The first attempt to test the sampling rate failed - the Neo4j server again ‚Äúwent away‚Äù to the 100% processor load mode and in a few minutes it did not respond to the request. <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">MATCH</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">c</span></span> {<span class="hljs-attribute"><span class="hljs-attribute">criteriaId</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>})&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">--</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span>)<span class="hljs-selector-tag"><span class="hljs-selector-tag">--</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">b</span></span> {<span class="hljs-attribute"><span class="hljs-attribute">criteriaId</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>}) <span class="hljs-selector-tag"><span class="hljs-selector-tag">RETURN</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wareId</span></span>;</code> </pre> <br>  To move on, you need to figure out how to optimize the query in Neo4j.  At first, I wanted to limit the starter set of nodes in the sample using the START instruction. <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">START</span></span> n=node:nodeIndexName(<span class="hljs-keyword"><span class="hljs-keyword">key</span></span>={<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">MATCH</span></span> (c)&lt;<span class="hljs-comment"><span class="hljs-comment">--(a)--&gt;(b) RETURN a.wareId;</span></span></code> </pre><br>  For this, you need to have indexes in the database.  In Neo4j, I did not find a command to view the list of current indexes, but in <a href="http://localhost:7474/browser/">the Neo4j web application</a> you can type a command <br><pre> <code class="hljs pgsql">:<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span></code> </pre> <br>  <b>You</b> can <b>add indexes with the</b> command <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> :Criteria(criteriaId)</code> </pre> <br>  <b>You</b> can create a <b>unique index with the</b> command <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> (n:Criteria) <span class="hljs-keyword"><span class="hljs-keyword">ASSERT</span></span> n.criteriaId <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span>;</code> </pre> <br>  Indices added by the commands above cannot be used in the START directive.  They say that they can only be used in where <br><blockquote>  The STARTED START clause.  The START clause index is a non-Cypher APIs. <br><br>  In order to use the user index, you can do this: <br><br>  match n: user <br>  where n.name = "aapo" <br>  return n; </blockquote><br>  If I understand the <a href="http://docs.neo4j.org/chunked/milestone/query-schema-index.html">documentation</a> correctly, you can safely use WHERE instead of START. <br><blockquote>  START is optional.  If you‚Äôre trying to do so, you can‚Äôt give it a try.  This is done.  See Chapter 14, Schema for more information.  In general, the START clause is only really needed when using legacy indexes. </blockquote><br>  Thus was born the first working request <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">MATCH</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ware)--</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">c1</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Criteria</span></span> {<span class="hljs-attribute"><span class="hljs-attribute">criteriaId</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>}),(<span class="hljs-selector-tag"><span class="hljs-selector-tag">c2</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Criteria</span></span> {<span class="hljs-attribute"><span class="hljs-attribute">criteriaId</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}),(<span class="hljs-selector-tag"><span class="hljs-selector-tag">c3</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Criteria</span></span> {<span class="hljs-attribute"><span class="hljs-attribute">criteriaId</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>}) <span class="hljs-selector-tag"><span class="hljs-selector-tag">WHERE</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span>)<span class="hljs-selector-tag"><span class="hljs-selector-tag">--</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">c2</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">AND</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span>)<span class="hljs-selector-tag"><span class="hljs-selector-tag">--</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">c3</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">RETURN</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span>;</code> </pre><br>  No indices were found in our test database, so we will create another database for the test in another way.  I did not find the ability to create independent data sets (an analogue of the database in MySQL) in Neo4j.  Therefore, for testing, I simply changed the path to the data storage in the Neo4j Community settings (Database location) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6e0/847/ee8/6e0847ee838855913a509e7a45d4a9a4.png" alt="Use in Neo4j done by changing the path to the repository."><br><br>  Attentive readers may have found a couple of comments in the test_fill_1.php code, namely <br><pre> <code class="hljs ruby"> $c = $neoClient-&gt;makeNode()-&gt;setProperty(<span class="hljs-string"><span class="hljs-string">'criteriaId'</span></span>, $wareTemplateId * $criteriasCount + $criteriaId)-&gt;save(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> -&gt;addLabels(array($neoCriteriaLabel)) -    commitBatch $neoCriterias-&gt;add($c, <span class="hljs-string"><span class="hljs-string">'criteriaId'</span></span>, $wareTemplateId * $wareTemplatesCount + $criteriaId); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> -&gt;save()   </code> </pre><br>  In batch mode in Neo4jphp, I could not add tags to the nodes, and for some reason the indices were not preserved.  Considering that Cypher ceased to be a Chinese diploma for me, I decided to fill the base hardcore - on pure Cypher.  So test_fill_2.php <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Index</span></span>\<span class="hljs-title"><span class="hljs-title">NodeIndex</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Relationship</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Node</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Cypher</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'example_bootstrap.php'</span></span>; $neoClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Client(); $wareTemplatesCount = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    $criteriasCount = 50; //   $waresCount = 250; //   $minRelations = 20; //       $maxRelations = 40; //       if($maxRelations &gt; $criteriasCount) { throw new \Exception("maxRelations[".$maxRelations."] should be bigger, that criteriasCount[".$criteriasCount."]"); } $query = new Cypher\Query($neoClient, "CREATE CONSTRAINT ON (n:Criteria) ASSERT n.criteriaId IS UNIQUE;", array()); $result = $query-&gt;getResultSet(); $query = new Cypher\Query($neoClient, "CREATE CONSTRAINT ON (n:Ware) ASSERT n.wareId IS UNIQUE;", array()); $result = $query-&gt;getResultSet(); for($wareTemplateId = 0;$wareTemplateId&lt;$wareTemplatesCount;$wareTemplateId++) { $time = time(); $queryTemplate = "CREATE "; print $wareTemplateId." (".$criteriasCount." criterias, ".$waresCount." wares with rand(".$minRelations.",".$maxRelations.") ..."; $criterias = array(); for($criteriaId = 1;$criteriaId &lt;=$criteriasCount;$criteriaId++) { //      (w1:Ware{wareId:1}) $cId = $criteriaId + $criteriasCount*$wareTemplateId; $queryTemplate .= "(c".$cId.":Criteria{criteriaId:".$cId."}), "; $criterias[] = $cId; } for($wareId = 1;$wareId &lt;=$waresCount;$wareId++) { $wId = $wareId + $waresCount*$wareTemplateId; //      (w1:Ware{wareId:1}) $queryTemplate .= "(w".$wId.":Ware{wareId:".$wId."}), "; //       (w1)-[:SUIT]-&gt;(c1) $possibleLinks = array_merge(array(), $criterias); // clone $criterias   for($i = 1;$i&lt;=rand($minRelations,$maxRelations);$i++) { $linkId = $possibleLinks[array_rand($possibleLinks)]; unset($possibleLinks[$linkId]); $queryTemplate .= "w".$wId."-[:SUIT]-&gt;c".$linkId.", "; } } $queryTemplate = substr($queryTemplate,0,-2); //   ", " $build = time(); $query = new Cypher\Query($neoClient, $queryTemplate, array()); // $queryTemplate    42   10000 , 500 , 200-400   - $result = $query-&gt;getResultSet(); print " Query build in ".($build - $time)." seconds, executed in ".(time() - $build)." seconds\n"; // die(); }</span></span></code> </pre><br>  The speed of adding data was predictably higher than in the first version. <br>  A test script with the addition of 30,000 nodes and 500,000 - 1,000,000 connections on cypher worked in 140 seconds, the base took 62 megabytes on disk.  When I tried to run the script with c $ waresCount = 1000 (not to mention 10000 products), I received the error ‚ÄúStack overflow error‚Äù.  I rewrote the script using. <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">MATCH</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> {<span class="hljs-attribute"><span class="hljs-attribute">wareId</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}), (<span class="hljs-selector-tag"><span class="hljs-selector-tag">b</span></span> {<span class="hljs-attribute"><span class="hljs-attribute">criteriaId</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>}) <span class="hljs-selector-tag"><span class="hljs-selector-tag">MERGE</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span>)<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[r:SUIT]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">b</span></span>)</code> </pre><br>  This led to a catastrophic drop in the speed of work, the modified script worked for about an hour.  I decided to test <b>the sampling rate according to several criteria</b> and return to the question of quick data insertion later. <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Index</span></span>\<span class="hljs-title"><span class="hljs-title">NodeIndex</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Relationship</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Node</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Cypher</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'example_bootstrap.php'</span></span>; $neoClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Client(); $time = microtime(); $query = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cypher\Query($neoClient, <span class="hljs-string"><span class="hljs-string">"MATCH (a:Ware)--&gt;(b:Criteria {criteriaId: 3}),(c:Criteria {criteriaId: 1}),(c2:Criteria {criteriaId: 2}) WHERE (a)--&gt;(c) AND (a)--&gt;(c2) RETURN a;"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>()); $result = $query-&gt;getResultSet(); <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Done in "</span></span>.(microtime() - $time).<span class="hljs-string"><span class="hljs-string">" seconds\n"</span></span>;</code> </pre><br>  The script above worked in 0.02 seconds.  In general, this is quite acceptable, but the problem of how to quickly maintain a large number of connections between nodes while updating product properties remains. <br><br><h4>  Alternative solution </h4><br>  I decided ‚Äúto clear my conscience‚Äù to try out MySQL as a repository.  Connections between nodes will be stored in a separate table without additional information. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`edges`</span></span> ( <span class="hljs-string"><span class="hljs-string">`criteriaId`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`wareId`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`criteriaId`</span></span> (<span class="hljs-string"><span class="hljs-string">`criteriaId`</span></span>,<span class="hljs-string"><span class="hljs-string">`wareId`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8;</code> </pre><br>  Test script to fill the base below <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> mysql_connect(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>, <span class="hljs-string"><span class="hljs-string">"root"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); mysql_select_db(<span class="hljs-string"><span class="hljs-string">"test_nodes"</span></span>); $wareTemplatesCount = <span class="hljs-number"><span class="hljs-number">100</span></span>; $criteriasCount = <span class="hljs-number"><span class="hljs-number">50</span></span>; $waresCount = <span class="hljs-number"><span class="hljs-number">250</span></span>; $minRelations = <span class="hljs-number"><span class="hljs-number">20</span></span>; $maxRelations = <span class="hljs-number"><span class="hljs-number">40</span></span>; $time = time(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($wareTemplateId = <span class="hljs-number"><span class="hljs-number">0</span></span>;$wareTemplateId&lt;$wareTemplatesCount;$wareTemplateId++) { $criterias = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($criteriaId = <span class="hljs-number"><span class="hljs-number">1</span></span>;$criteriaId &lt;=$criteriasCount;$criteriaId++) { $criterias[] = $wareTemplateId * $criteriasCount + $criteriaId; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($wareId = <span class="hljs-number"><span class="hljs-number">1</span></span>;$wareId &lt;=$waresCount;$wareId++) { $edges = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $wId = $wareTemplateId * $waresCount + $wareId; $links = array_rand($criterias,rand($minRelations,$maxRelations)); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($links <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $linkId) { $edges[] = <span class="hljs-string"><span class="hljs-string">"("</span></span>.$criterias[$linkId].<span class="hljs-string"><span class="hljs-string">","</span></span>.$wareId.<span class="hljs-string"><span class="hljs-string">")"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//        mysql_query("INSERT INTO edges VALUES ".implode(",",$edges)); } print "."; } print " [added ".$wareTemplatesCount." templates in ".(time() - $time)." sec]"; $time = time();</span></span></code> </pre><br>  Filling the base took 12 seconds.  The size of the table is 37 megabytes.  Search by 2 criteria takes 0.0007 seconds <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e1.wareId <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`edges`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> e1 <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> edges <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> e2 <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> e1.wareId = e2.wareId <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> e1.criteriaId =<span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> e2.criteriaId =<span class="hljs-number"><span class="hljs-number">31</span></span></code> </pre><br><br><h4>  Another option </h4><br>  Under mysql there is a full-fledged <a href="http://openquery.com.au/graph/doc">graph data storage</a> - but I did not test it.  Judging by the documentation, it is much more primitive than Neo4j. <br><br><h4>  findings </h4><br>  <b>Neo4j is a very cool thing</b> .  A query like ‚ÄúSelecting contacts of users who liked movie actors who starred in films that sounded soundtracks, which were written by musicians I put like‚Äù in Neo4j is trivial.  Like that <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">MATCH</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">me</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:User</span></span> {<span class="hljs-attribute"><span class="hljs-attribute">userId</span></span>:<span class="hljs-number"><span class="hljs-number">123</span></span>})<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[:Like]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">musicants</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:User)-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[:Author]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">s</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Soundtrack)-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[:Used]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>&gt;(<span class="hljs-selector-tag"><span class="hljs-selector-tag">f</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Film)</span></span>&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[:Starred]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">actor</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">User</span></span>)&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[:Like]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">u</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:User)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RETURN</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">u</span></span></code> </pre><br>  For SQL, this is much more troublesome. <br><br>  It is incorrect to compare a full graph database with a bare index table in MySQL, but <b>in the context of solving my problem, the use of Neo4j did not give any advantages</b> . <br><br>  <b>UPDATE</b> .  Changed url'y pictures, in theory should all be loaded. <br><br>  <b>UPDATE 2</b> .  They offered several options - MongoDB, elasticsearch, solr, sphinx, OrientDB.  I plan to test MongoDB, I'll post the test results right there. </div><p>Source: <a href="https://habr.com/ru/post/219441/">https://habr.com/ru/post/219441/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../219429/index.html">Platform for video service for a quarter</a></li>
<li><a href="../219431/index.html">Organization of multitasking in the OS kernel</a></li>
<li><a href="../219435/index.html">Filtering the blacklist of sites by URL</a></li>
<li><a href="../219437/index.html">The quality of transposing samples in Ableton Live 8 tools and free plugins</a></li>
<li><a href="../219439/index.html">Strange Analytical Beast Axiom</a></li>
<li><a href="../219443/index.html">10 Gbps Wi-Fi announced in 2015</a></li>
<li><a href="../219445/index.html">Where is our business logic for an idealist?</a></li>
<li><a href="../219447/index.html">Google has given itself the right to scan user letters.</a></li>
<li><a href="../219449/index.html">Computer that changed everything</a></li>
<li><a href="../219453/index.html">HP iLO 2 is vulnerable to Heartbleed - defend and upgrade!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>