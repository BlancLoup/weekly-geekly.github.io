<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Powerful four-channel dimmer for LEDs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will talk about the project of a powerful four-channel dimmer for LED strips and lamps (up to 200 watts total power, 50..100 watts p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Powerful four-channel dimmer for LEDs</h1><div class="post__text post__text-html js-mediator-article">  In this article I will talk about the project of a powerful four-channel dimmer for LED strips and lamps (up to 200 watts total power, 50..100 watts per channel) with high frequency PWM regulation (1 kilohertz with a color depth of 10 bits), for high-quality lighting .  In addition, it has a light sensor input, feedback functions (outputting information to the controller on the input supply voltage, the voltage at the measuring inputs, and so on), and even galvanic isolation of the serial control port. <br><br><img src="https://habrastorage.org/files/34a/40c/43c/34a40c43cea94d2c86d0a577633c5993.JPG"><br><a name="habracut"></a><br>  It so happened that I decided to change my profile and tackle microcontrollers and automation tightly, and after a few months I received a tempting offer to make a ‚Äúsmart home‚Äù in the Dominican Republic, and such that almost all aspects of the life of a fairly large villa of three large buildings, from lighting and climate, to garden robots and irrigation systems.  Since I was tired of snow and frost for a long time, it was impossible to reject such a proposal, especially since they helped me with the move and adaptation. <br><br>  Of course, one of the most important tasks is to control the lighting, both in a multitude of rooms and outside.  In order to save expensive electricity here - almost everywhere will be used LED strips and 12-volt lamps, which need to be controlled using dimmers.  Existing dimmer models were not very satisfactory in all respects (high enough control frequency, for the absence of flicker; power, for controlling bright long stripes or lamps / spotlights; closed exchange protocols, and so on).  So I decided to make my own dimmer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A very sensitive issue at the design stage was the choice of obtaining low-voltage power from 110 volts AC.  Even an exotic version with a transformerless step-down was immediately considered up to 12 volts, but due to electrical and fire safety considerations was rejected.  Ready-made power supplies 110-&gt; 12 turned out to be not that expensive ($ 20 for 120 watts and $ 40 for 200), although they are quite large.  But, fortunately, there was a lot of space for equipment placement, so I settled on this option. <br><br>  The circuit turned out to be relatively simple (except for the galvanic decoupling node of the serial port on four optocouplers) - the STM32F030F4P6 microcontroller, two ADP3624 MOSFET drivers and IRLB8748 key transistors selected with a large margin (with a load of 100 watts per channel - they were barely warm) , plus a ready-made Chinese module pulsed step-down at 3.3 volts.  The selected drivers allow you to control at frequencies up to megahertz, which gives the frequency of the output voltage in kilohertz, with a PWM step of one microsecond.  In practice, even a PWM mode of eight kilohertz and 125 nanosecond increments was tested, but in practice such a high adjustment frequency threatens with some instability at the output ‚Äî transistors may simply not have time to close so quickly and the quality of adjustment will ‚Äúfloat‚Äù. <br><br> <a href=""><img src="https://habrastorage.org/files/066/0b3/8bb/0660b38bbd6f408894a90839f6ce3407.png" width="900"></a> <br><br>  The layout of the board for such large currents was a rather difficult challenge for me, I had never encountered such tasks before.  It was decided to make as wide as possible (a conductor with a minimum width of 10 mm on a layer of 70 Œºm copper), and where it is impossible to use the second layer, merging them with a large number of vias.  I removed the mask from the high-loaded conductors so that, if necessary, it was possible to put a copper bus on top (but this was not needed, even with a maximum load of 200 watts - the board heats up to only 40 degrees in a closed case). <br><br>  The exchange protocol, due to the lack of flash memory, was chosen extremely simple, the commands are transmitted line by line, in the form of text "0: 512" (zero channel, PWM 512), the output data is transmitted in the same way (power supply, data from the first photoresistor, data from the second photoresistor, input voltage on the ADC3 input, input voltage on the ADC5 input, controller supply voltage, chip temperature).  It would be more correct to use the MQTT protocol, but I was afraid that it would not fit into the flash (the kilobyte of free space remained out of 16). <br><br>  ‚Üí <a href="https://github.com/vasimv/StmDimmer-4ch">Githab Source Code</a> <br><br>  The dimmer is stitched through the same control port (you need to feed the unit to the 4th pin, then the pulse to the 5th, after which the microcontroller can be loaded using the standard serial protocol STM32. To control the dimmer already flashed, three wires are enough, + 3.3 / + 5V on the first pin, data on the third, on the sixth - the ground. The settings of the control port in the firmware are 38400 baud, 8n1. <br><br>  Of course, the first version of the dimmer was not without flaws.  It turned out that one capacitor 470 microfarad at 12 volts is not enough, under heavy load it heats up too much (especially if the wires to the power supply are too thin for such currents), you need to add a couple more powerful ones (at the maximum permissible current).  The Chinese power supply module also turned out to be an unsuccessful solution, one of the modules failed during tests for no apparent reason at all, I will replace it with a converter for TPS62177, additionally also add another optional converter for AP1501 (24-&gt; 12), for the case of dimmer power from 24 volts  Well, you will need a 120-mm fan control circuit for the power supply (in cases where the load is close to the maximum), with thermal control and smooth adjustment.  I also decided to replace the complex scheme of galvanic isolation of the control port with the SI8641 chip. <br><br>  There are problems in the software part - sometimes reading from the serial port hangs, blocking control (the experience with STM32 is not very big for me yet), and the protocol turned out to be too idiotic, I can try to shove a normal MQTT there. <br><br>  Here is an example of using a dimmer on a test stand (my front door), in conjunction with an IR distance sensor (the color and brightness of the RGBW strips are adjusted, depending on the distance, through openhab): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/knXuq3a6p4M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  In the next article I will talk about the four-channel switching unit of eight-kilowatt AC loads with bistable relays (to reduce the energy consumed in vain) by measuring the current consumption on each channel. <br><br>  Well, finish on a positive note.  As it turned out, in the Dominican Republic there is no 99% isopropyl or ethyl alcohol for flushing the boards (and also for pure gasoline).  You can find 70%, mixed obviously not with distilled water, leaving stains.  And it is still easy to find 99.6% methyl (I don‚Äôt know why they sell it at all, but it's terrible to use it as a solvent - you can breathe in pairs).  I decided to try to rinse the first dimmer board with distilled water purchased at the household goods store.  The idea to check the quality of the distillate to the taste I, fortunately, did not bring to life.  But I really didn‚Äôt like the board and the galvanized sink when I poured battery electrolyte on them (the water bottles were on the shelf with it, apparently I grabbed the wrong one when I put it in the basket) ... <br></div><p>Source: <a href="https://habr.com/ru/post/402155/">https://habr.com/ru/post/402155/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../402145/index.html">Continuing the theme of ‚ÄúCancer. What to do with him..."</a></li>
<li><a href="../402147/index.html">IBM has written a bit of information in one atom</a></li>
<li><a href="../402149/index.html">Intel XMM 7560 - gigabit over the air</a></li>
<li><a href="../402151/index.html">Digital notary on the blockchain: Emercoin DPO Antifake</a></li>
<li><a href="../402153/index.html">"We disassemble" the printed house</a></li>
<li><a href="../402157/index.html">Chris Kaspersky died. The memory of this hacker is dedicated</a></li>
<li><a href="../402159/index.html">February ranking of the most media scientific developments</a></li>
<li><a href="../402161/index.html">Software manufacturers massively close the vulnerabilities enjoyed by the CIA</a></li>
<li><a href="../402163/index.html">Steve Jobs updated story</a></li>
<li><a href="../402165/index.html">The greatest "Dome" of science from Istra</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>