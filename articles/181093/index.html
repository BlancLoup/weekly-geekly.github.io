<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Django: Using QR codes to quickly enter the site from mobile devices</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you have a website that is often used from mobile devices (such as phones and tablet PCs), then you may have wondered how to implement quick login ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Django: Using QR codes to quickly enter the site from mobile devices</h1><div class="post__text post__text-html js-mediator-article">  If you have a website that is often used from mobile devices (such as phones and tablet PCs), then you may have wondered how to implement quick login - so that the user does not need to enter either the website address, or the login and password ( or E-mail and password). <br><br>  On some sites you may have seen the ability to send an SMS with a quick access link - this is essentially the same thing.  The main difference of the approach described in this note is that instead of sending an SMS, we will generate a QR code that contains a link that allows you to enter the site without entering authorization data. <br><br><img src="https://habrastorage.org/storage2/f10/0c9/fd3/f100c9fd39a545ad4e8c856f6a842e12.png" alt="Screenshot from mobile screen">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      By the way, the whole process of writing the application, which is given below, can be viewed in the screencast (available <a href="http://www.youtube.com/watch%3Fv%3D6ob3oR_Frhk">on YouTube</a> , or in higher quality as an <a href="">MPEG2 file in 1080p</a> ). <br><a name="habracut"></a><br>  Before you start implementing this authorization option, let's consider how it differs from the option with sending an SMS message: <br><br><ul><li>  The SMS message is a little safer: on the one hand, we pass the link through third parties (in particular, SMS gate, cellular operator), but on the other hand, first, the link will not be available via JS (and, accordingly, even if the site has XSS, then the attacker will not be able to get the link from the SMS message - but from the QR code you can get it), and secondly you can get physical access to the computer with a browser in which the user is authorized on the site, in general easier than accessing a computer and, at the same time, accessing the body  user background </li><li>  An SMS message, at the same time, is not so universal: it will not work, if for some reason there is no cellular connection, or the mobile device used by the user does not at all imply the ability to work in cellular networks (but has a camera and Internet connection, and an application for scanning QR codes on it is or easy to install) </li><li>  Sending SMS messages costs money, generating QR codes is absolutely free </li><li>  SMS messages in some situations may significantly decrease the speed and reliability indicators (that is, the message may come with a significant delay, or may not even come at all), and scanning of QR codes is predictable and usually works well (at least, if with the camera is all right) </li><li>  To send SMS messages, the site needs a user's phone number, but not all users like the idea of ‚Äã‚Äãentering their phone number anywhere on the Internet. </li></ul><br>  It turns out that the option with QR codes is quite good.  And even if high security is important to us, then theoretically no one bothers to send a QR code by e-mail, or, for example, to request a password each time (once again, enter the password on a convenient large computer keyboard, it seems to me much easier than typing the site address + login / email address + password on the virtual keyboard of the mobile device).  Nevertheless, now I propose to implement the simplest, basic version of a quick entry using QR codes, the implementation of which we will need a minimum of time. <br><br>  The text below, like the screencast, explains the various features of the implementation.  If you want to quickly add an application to the site, then you can install it through pip: <br><br> <code>pip install django-qrauth</code> <br> <br>  In this case, you will only have to include the urls scheme of the application in your main urls.py, as well as add templates.  Installation instructions as well as the source code can be found on <a href="https://github.com/aruseni/django-qrauth">Github</a> . <br><br>  Below is described how you can build the application yourself - as relevant, for example, if you immediately want to edit something in it. <br><br>  So, first of all, let's move to the working directory of the Django project, in which we want to add such authorization, and create a new application.  Let's call it, for example, qrauth: <br><br> <code>python manage.py startapp qrauth</code> <br> <br>  In the directory that appears, create a file qr.py: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PIL <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image, ImageDraw <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ImportError: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image, ImageDraw <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> qrcode.image.base <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> qrcode.image.pil <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PilImage</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(qrcode.image.pil.PilImage)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, border, width, box_size)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Image <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> ImageDraw <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> NotImplementedError(<span class="hljs-string"><span class="hljs-string">"PIL not available"</span></span>) qrcode.image.base.BaseImage.__init__(self, border, width, box_size) self.kind = <span class="hljs-string"><span class="hljs-string">"PNG"</span></span> pixelsize = (self.width + self.border * <span class="hljs-number"><span class="hljs-number">2</span></span>) * self.box_size self._img = Image.new(<span class="hljs-string"><span class="hljs-string">"RGBA"</span></span>, (pixelsize, pixelsize)) self._idr = ImageDraw.Draw(self._img) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_qr_code</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> qrcode.make(string, box_size=<span class="hljs-number"><span class="hljs-number">10</span></span>, border=<span class="hljs-number"><span class="hljs-number">1</span></span>, image_factory=PilImage)</code> </pre><br>  It uses the <a href="https://github.com/lincolnloop/python-qrcode">python-qrcode module</a> .  You can install it using pip: <br><br> <code>pip install qrcode</code> <br> <br>  In order to get pictures with a transparent (rather than white) background, we specifically use our class to create pictures, inheriting it from qrcode.image.pil.PilImage.  If you are satisfied with pictures with a white background, then it will be enough to write this: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> qrcode <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_qr_code</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> qrcode.make(string, box_size=<span class="hljs-number"><span class="hljs-number">10</span></span>, border=<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre><br>  It is worth noting that in this case, the pictures that qrcode.make returns (and, accordingly, the function make_qr_code) are not optimal in terms of size.  For example, using <a href="http://optipng.sourceforge.net/">optipng</a> their size can be reduced by about 70% (of course, without loss of quality).  However, in most cases this is unprincipled - in any case, their size is small (within a few kibibytes). <br><br>  Next, create the utils.py file and add functions that we will then use in views (views): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> string <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> hashlib <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> settings <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate_random_string</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(length, stringset=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">.join</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">( [string.ascii_letters+string.digits] )</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Returns a string with `length` characters chosen from `stringset` &gt;&gt;&gt; len(generate_random_string(20) == 20 """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>.join([stringset[i%len(stringset)] \ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [ord(x) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.urandom(length)]]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">salted_hash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hashlib.sha1(<span class="hljs-string"><span class="hljs-string">":)"</span></span>.join([ string, settings.SECRET_KEY, ])).hexdigest()</code> </pre><br>  The generate_random_string function generates a string of random characters of a given length.  By default, the string is composed of letters of the Latin alphabet (both lower and upper case) and numbers. <br><br>  The salted_hash function solos and hashes the string. <br><br>  Now open views.py and write the views: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> redis <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib.auth.decorators <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> login_required <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib.auth <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> login, get_backends <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib.sites.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_current_site <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.template <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RequestContext <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.shortcuts <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> render_to_response <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.http <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpResponse, HttpResponseRedirect, Http404 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.core.urlresolvers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reverse <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib.auth.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> User <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> privatemessages.context_processors <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> \ number_of_new_messages_processor <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> utils <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> generate_random_string, salted_hash <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> qr <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> make_qr_code @login_required <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">qr_code_page</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> r = redis.StrictRedis() auth_code = generate_random_string(<span class="hljs-number"><span class="hljs-number">50</span></span>) auth_code_hash = salted_hash(auth_code) r.setex(auth_code_hash, <span class="hljs-number"><span class="hljs-number">300</span></span>, request.user.id) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_to_response(<span class="hljs-string"><span class="hljs-string">"qrauth/page.html"</span></span>, {<span class="hljs-string"><span class="hljs-string">"auth_code"</span></span>: auth_code}, context_instance=RequestContext(request)) @login_required <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">qr_code_picture</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, auth_code)</span></span></span><span class="hljs-function">:</span></span> r = redis.StrictRedis() auth_code_hash = salted_hash(auth_code) user_id = r.get(auth_code_hash) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (user_id == <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (int(user_id) != request.user.id): <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> Http404(<span class="hljs-string"><span class="hljs-string">"No such auth code"</span></span>) current_site = get_current_site(request) scheme = request.is_secure() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-string"><span class="hljs-string">"https"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">"http"</span></span> login_link = <span class="hljs-string"><span class="hljs-string">""</span></span>.join([ scheme, <span class="hljs-string"><span class="hljs-string">"://"</span></span>, current_site.domain, reverse(<span class="hljs-string"><span class="hljs-string">"qr_code_login"</span></span>, args=(auth_code_hash,)), ]) img = make_qr_code(login_link) response = HttpResponse(mimetype=<span class="hljs-string"><span class="hljs-string">"image/png"</span></span>) img.save(response, <span class="hljs-string"><span class="hljs-string">"PNG"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login_view</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, auth_code_hash)</span></span></span><span class="hljs-function">:</span></span> r = redis.StrictRedis() user_id = r.get(auth_code_hash) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> user_id == <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HttpResponseRedirect(reverse(<span class="hljs-string"><span class="hljs-string">"invalid_auth_code"</span></span>)) r.delete(auth_code_hash) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: user = User.objects.get(id=user_id) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> User.DoesNotExist: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HttpResponseRedirect(reverse(<span class="hljs-string"><span class="hljs-string">"invalid_auth_code"</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># In lieu of a call to authenticate() backend = get_backends()[0] user.backend = "%s.%s" % (backend.__module__, backend.__class__.__name__) login(request, user) return HttpResponseRedirect(reverse("dating.views.index"))</span></span></code> </pre><br>  When accessing a page with a QR code (qr_code_page), a random string of 50 characters is generated.  Next, a new key-value pair is added to <a href="http://redis.io/download">Redis</a> (you can install the client with the help of <code>pip install redis</code> ), where the salted hash of the generated random string is set as the key, and the user ID is used as the value (this is necessary for the picture with the QR code , which is added to the page, was available only to this user).  This key is set to the expiration time, in the example specified 300 seconds (5 minutes). <br><br>  In the context of the template, a generated random string is specified: this string is then used in the address where the picture with the QR code is returned (but for authorization, a hash is used, and the address with the hash is included in the QR code: thus, even if someone else knows the address of the picture, then for authorization this will not be enough - for authorization you need to know the salted hash for the random string specified in the address of the picture). <br><br>  Further, when loading a picture (qr_code_picture), the random string contained in the picture address is again hashed, and then it is checked whether there is a corresponding key in Redis.  If there is such a key, and contains the identifier of the current user, then a QR code is created and returned containing an absolute link for instant authorization on the site.  Otherwise, error 404 is returned. <br><br><div class="spoiler">  <b class="spoiler_title">By the way, do you understand what can be easily improved here?</b> <div class="spoiler_text">  When performing <code>int(user_id) != request.user.id</code> ValueError may occur - if there is such a key in Redis, but its value is not suitable for conversion to a decimal integer.  It is solved using <a href="http://docs.python.org/2/tutorial/errors.html">try ... except</a> , or using the string <a href="http://docs.python.org/2/library/stdtypes.html">isdigit</a> method.  Alternatively, you can get a string from request.user.id and compare it with the received key value. <br>  You can also use not just a hash, but, for example, a hash with a prefix - especially important if similar keys are also created somewhere else. </div></div><br>  The domain is <a href="https://docs.djangoproject.com/en/dev/ref/contrib/sites/">obtained</a> here using <a href="https://docs.djangoproject.com/en/dev/ref/contrib/sites/">django.contrib.sites</a> .  You can specify the domain through the administrative interface (/ admin / sites / site /). <br><br>  If your server is behind a reverse proxy (for example, nginx), and you are using SSL, then make sure that information about this is included in requests to the upstream server ‚Äî this is necessary so that request.is_secure () gives the correct value (for this define in the settings <a href="https://docs.djangoproject.com/en/dev/ref/settings/">SECURE_PROXY_SSL_HEADER</a> , but keep in mind that you will need to set / remove this header on the proxy server side - otherwise, if, for example, your site is accessible via HTTP and HTTPS, the user who logs in via HTTP can set this header so that request.is_secure () will return  to True, and that is bad in terms of safety). <br><br>  And yes, starting with Python 2.6, instead of <code>request.is_secure() and "https" or "http"</code> you can write <code>"https" if request.is_secure() else "http"</code> . <br><br>  When clicking on the link for instant authorization, it is checked whether there is a key in Redis that corresponds to the hash specified in the link.  If not, the user is redirected to the page with the message that the QR code is invalid (in this example, this page does not require writing a separate presentation).  If there is, then the key is deleted in Redis, after which it is checked whether there is a user with such an identifier in the database.  If not, then again, it is redirected to the page with the message that the QR code is invalid.  If there is - then there is an authorization and the user is redirected to the main page of the site. <br><br>  Now add the urls.py file and define the application URL scheme in it: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf.urls <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> patterns, url <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.views.generic.simple <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> direct_to_template urlpatterns = patterns(<span class="hljs-string"><span class="hljs-string">'qrauth.views'</span></span>, url( <span class="hljs-string"><span class="hljs-string">r'^pic/(?P&lt;auth_code&gt;[a-zA-Z\d]{50})/$'</span></span>, <span class="hljs-string"><span class="hljs-string">'qr_code_picture'</span></span>, name=<span class="hljs-string"><span class="hljs-string">'auth_qr_code'</span></span> ), url( <span class="hljs-string"><span class="hljs-string">r'^(?P&lt;auth_code_hash&gt;[af\d]{40})/$'</span></span>, <span class="hljs-string"><span class="hljs-string">'login_view'</span></span>, name=<span class="hljs-string"><span class="hljs-string">'qr_code_login'</span></span> ), url( <span class="hljs-string"><span class="hljs-string">r'invalid_code/$'</span></span>, direct_to_template, {<span class="hljs-string"><span class="hljs-string">'template'</span></span>: <span class="hljs-string"><span class="hljs-string">'qrauth/invalid_code.html'</span></span>}, name=<span class="hljs-string"><span class="hljs-string">'invalid_auth_code'</span></span> ), url( <span class="hljs-string"><span class="hljs-string">r'^$'</span></span>, <span class="hljs-string"><span class="hljs-string">'qr_code_page'</span></span>, name=<span class="hljs-string"><span class="hljs-string">'qr_code_page'</span></span> ), )</code> </pre><br>  Also, do not forget to open your main urls.py (which is indicated in ROOT_URLCONF), and include urlpatterns from urls.py from the created application: <br><br><pre> <code class="python hljs">urlpatterns = patterns(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-comment"><span class="hljs-comment"># ‚Ä¶ url(r'^qr/', include('qrauth.urls')), # ‚Ä¶ )</span></span></code> </pre><br>  Now open the template directory and add the qrauth directory there. <br><br>  Example for invalid_code.html: <br><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">extends</span></span></span></span></span><span class="hljs-template-tag"> "base.html" %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> title %}</span></span><span class="xml"><span class="xml">QR- </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"error"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">QR- </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">QR-,     , . ,       QR-      .</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  Example for page.html: <br><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">extends</span></span></span></span></span><span class="hljs-template-tag"> "base.html" %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> title %}</span></span><span class="xml"><span class="xml">QR-  </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"qr_code"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">QR-  </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">        (,   )   QR-:</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">img</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">url</span></span></span></span></span><span class="hljs-template-tag"> auth_qr_code auth_code %}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"QR"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">  QR-       5 .     QR-,    </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">url</span></span></span></span></span><span class="hljs-template-tag"> qr_code_page %}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> .</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  Actually, it now remains to open the site in the browser and check.  If the QR code is successfully generated and displayed, try to scan it using a phone or something else with a camera and the Internet. <br><br>  If there are any questions or thoughts about what other options may be for quick and convenient authorization from mobile devices - I will be glad to comment. <br><br>  Good luck to everyone and enjoy programming! <br><br>  Happy summer!  :) <br></div><p>Source: <a href="https://habr.com/ru/post/181093/">https://habr.com/ru/post/181093/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../181081/index.html">Doom 3 BFG - source code review: Multithreading (part 2 of 4)</a></li>
<li><a href="../181083/index.html">LESS-Mix - a little about LESS-mixing</a></li>
<li><a href="../181085/index.html">For the suspect in the "piracy" of the Englishman came a whole train of police cars</a></li>
<li><a href="../181089/index.html">MTS asks the state to protect itself from Skype</a></li>
<li><a href="../181091/index.html">Will MySpace ever lose its monopoly?</a></li>
<li><a href="../181095/index.html">‚ÄúSingle-threaded Programmer‚Äù</a></li>
<li><a href="../181097/index.html">DevCon 2013: the first day of the conference, watch the live broadcast of the main program!</a></li>
<li><a href="../181099/index.html">DevCon 2013: the second day of the conference, watch the live broadcast of the main program!</a></li>
<li><a href="../181101/index.html">(Kiev) Free course on design solutions based on Cisco UCS and Nexus</a></li>
<li><a href="../181103/index.html">The option of managing a computer on Windows from under the Linux console</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>