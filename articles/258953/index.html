<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Let unit-testing begin (Objective-C)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article focuses on testing for Objective-C using Xcode 6. It discusses the standard testing library and the third-party OCMock library. Experienc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Let unit-testing begin (Objective-C)</h1><div class="post__text post__text-html js-mediator-article">  This article focuses on testing for Objective-C using Xcode 6. It discusses the standard testing library and the third-party <a href="http://ocmock.org/">OCMock</a> library.  Experienced developers may not find too useful information here, as well as those who have recently taken this path - the article will reveal the necessary basic knowledge of writing unit tests in Objective-C language. <br><br>  For basic testing, please contact <a href="http://www.e-uni.ee/e-kursused/eucip/arendus_vk/143__.html">here</a> . <br>  For the basics of unit testing <a href="http://habrahabr.ru/post/169381/">here</a> . <br><br>  And now we will begin the study of unit testing in Objective-C. <br><a name="habracut"></a><br><h2>  Step 1. Basics </h2><br>  Create a new iOS project. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Screenshots</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/30a/917/079/30a91707900c4725912d9d8075339b19.png"><br><img src="https://habrastorage.org/files/63d/bfa/a94/63dbfaa9420a49dabacd9c04b26624d1.png"><br><img src="https://habrastorage.org/files/8c8/fa6/9dc/8c8fa69dcc05413b89685602b59f8abb.png"><br></div></div><br>  Xcode, as we can see, he himself created for us a directory for tests DemoUnitTestingTests and the file DemoUnitTestingTests.m.  What we see here: <br><br>  Standard library for testing: <br><br><pre><code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;XCTest/XCTest.h&gt;</span></span></span></span></code> </pre> <br>  The fact that our class DemoUnitTestingTests is inherited from the class XCTestCase (we will not go into details). <br><br>  The method called before running each test: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)setUp { [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> setUp]; <span class="hljs-comment"><span class="hljs-comment">// Put setup code here. This method is called before the invocation of each test method in the class. }</span></span></code> </pre><br>  Method called after the result of each test: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)tearDown { <span class="hljs-comment"><span class="hljs-comment">// Put teardown code here. This method is called after the invocation of each test method in the class. [super tearDown]; }</span></span></code> </pre><br>  And directly 2 test.  The first is a demo test, the second is to demonstrate the performance test: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testExample { <span class="hljs-comment"><span class="hljs-comment">// This is an example of a functional test case. XCTAssert(YES, @"Pass"); } - (void)testPerformanceExample { // This is an example of a performance test case. [self measureBlock:^{ // Put the code you want to measure the time of here. }]; }</span></span></code> </pre><br>  As you can see, all tests begin with the word test and are automatically included in the test list. <br><br><h2>  Step 2. Information </h2><br>  Some rules and comments: <br><blockquote>  <u>All tests run independently.</u> <br>  <u>Do maximum class isolation</u> <br>  <u>The name of the test should reflect its purpose.</u> <br>  <u>The result of the test should not affect the main code</u> <br></blockquote><br>  <b>Please</b> do not think that writing tests will save your code from bugs once and for all.  Your test may not have been written correctly. <br><br><h2>  Step 3. Getting to the test </h2><br>  We select the following functions for testing from the standard library for testing XCTest, as well as write tests using them. <br><br><div class="spoiler">  <b class="spoiler_title">Always a mistake</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testAlwaysFailed { <span class="hljs-comment"><span class="hljs-comment">/* 1 -   */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">XCTFail</span></span>(<span class="hljs-string"><span class="hljs-string">@"always failed"</span></span>); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Equality of basic types</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testIsEqualPrimitive { <span class="hljs-comment"><span class="hljs-comment">/* 1 - 1 2 - 2  3 -    -       */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> primitive1 = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> primitive2 = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertEqual</span></span>(primitive1, primitive2, <span class="hljs-string"><span class="hljs-string">@"(%d) equal to (%d)"</span></span>, primitive1, primitive2); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Basic inequality</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testIsNotEqualPrimitive { <span class="hljs-comment"><span class="hljs-comment">/* 1 - 1 2 - 2  3 -    -       */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> primitive1 = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> primitive2 = <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertNotEqual</span></span>(primitive1, primitive2, <span class="hljs-string"><span class="hljs-string">@"(%d) not equal to (%d)"</span></span>, primitive1, primitive2); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Equality with an error of basic types</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testIsEqualWithAccuracyPrimitive { <span class="hljs-comment"><span class="hljs-comment">/* 1 - 1 2 - 2 3 -     4 -    -       */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> primitive1 = <span class="hljs-number"><span class="hljs-number">5.012</span></span>f; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> primitive2 = <span class="hljs-number"><span class="hljs-number">5.014</span></span>f; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> accuracy = <span class="hljs-number"><span class="hljs-number">0.005</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertEqualWithAccuracy</span></span>(primitive1, primitive2, accuracy, <span class="hljs-string"><span class="hljs-string">@"(%f) equal to (%f) with accuracy %f"</span></span>, primitive1, primitive2, accuracy); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Inequality with the error of the basic types</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testIsNotEqualWithAccuracyPrimitive { <span class="hljs-comment"><span class="hljs-comment">/* 1 - 1 2 - 2 3 -     4 -    -       */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> primitive1 = <span class="hljs-number"><span class="hljs-number">5.012</span></span>f; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> primitive2 = <span class="hljs-number"><span class="hljs-number">5.014</span></span>f; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> accuracy = <span class="hljs-number"><span class="hljs-number">0.001</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertNotEqualWithAccuracy</span></span>(primitive1, primitive2, accuracy, <span class="hljs-string"><span class="hljs-string">@"(%f) not equal to (%f) with accuracy %f"</span></span>, primitive1, primitive2, accuracy); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Check on BOOL YES</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testIsTrue { <span class="hljs-comment"><span class="hljs-comment">/* 1 - boolean    2 -    -      */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span> isTrue = <span class="hljs-literal"><span class="hljs-literal">YES</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertTrue</span></span>(isTrue); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Check for BOOL NO</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testIsFalse { <span class="hljs-comment"><span class="hljs-comment">/* 1 - boolean    2 -    -      */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span> isTrue = <span class="hljs-literal"><span class="hljs-literal">NO</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertFalse</span></span>(isTrue); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Check for nil</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testIsNil { <span class="hljs-comment"><span class="hljs-comment">/* 1 -   2 -    -      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> foo = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertNil</span></span>(foo, <span class="hljs-string"><span class="hljs-string">@"pointer:%p"</span></span>, foo); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Check for NOT nil</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testIsNotNil { <span class="hljs-comment"><span class="hljs-comment">/* 1 -   2 -    -      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> foo = <span class="hljs-string"><span class="hljs-string">@""</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertNotNil</span></span>(foo); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Comparing primitives by more (&gt;)</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testGreaterPrivitive { <span class="hljs-comment"><span class="hljs-comment">/* 1 - 1 2 - 2  3 -    -      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> privitive1 = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> privitive2 = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertGreaterThan</span></span>(privitive1, privitive2); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Comparing primitives for greater than or equal to (&gt; =)</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testGreaterOrEqualPrivitive { <span class="hljs-comment"><span class="hljs-comment">/* 1 - 1 2 - 2  3 -    -      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> privitive1 = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> privitive2 = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertGreaterThanOrEqual</span></span>(privitive1, privitive2); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Comparing primitives for less (&lt;)</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testLessPrivitive { <span class="hljs-comment"><span class="hljs-comment">/* 1 - 1 2 - 2  3 -    -      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> privitive1 = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> privitive2 = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertLessThan</span></span>(privitive1, privitive2); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Comparing primitives for less or equal (&lt;=)</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testLessOrEqualPrivitive { <span class="hljs-comment"><span class="hljs-comment">/* 1 - 1 2 - 2  3 -    -      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> privitive1 = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> privitive2 = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertLessThanOrEqual</span></span>(privitive1, privitive2); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Check for throwing an exception</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testThrowException { <span class="hljs-comment"><span class="hljs-comment">/* 1 - //  2 -    -      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^block)() = ^{ <span class="hljs-keyword"><span class="hljs-keyword">@throw</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">NSException</span></span> exceptionWithName:<span class="hljs-built_in"><span class="hljs-built_in">NSGenericException</span></span> reason:<span class="hljs-string"><span class="hljs-string">@"test throw"</span></span> userInfo:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; }; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertThrows</span></span>(block()); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Check for NOT throwing an exception</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testNoThrowException { <span class="hljs-comment"><span class="hljs-comment">/* 1 - //  2 -    -      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^block)() = ^{ }; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertNoThrow</span></span>(block()); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Check for throwing an exception by the exception class</b> <div class="spoiler_text">  Class MyException derived from NSException <br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyException</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSException</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyException</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testThrowExceptionClass { <span class="hljs-comment"><span class="hljs-comment">/* 1 - // 2 -    3 -    -      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^block)() = ^{ <span class="hljs-keyword"><span class="hljs-keyword">@throw</span></span> [MyException exceptionWithName:<span class="hljs-built_in"><span class="hljs-built_in">NSGenericException</span></span> reason:<span class="hljs-string"><span class="hljs-string">@"test throw"</span></span> userInfo:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; }; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertThrowsSpecific</span></span>(block(), MyException); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Check for throwing an exception EXCELLENT from the exception class</b> <div class="spoiler_text">  Class MyException derived from NSException <br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyException</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSException</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyException</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testNoThrowExceptionClass { <span class="hljs-comment"><span class="hljs-comment">/* 1 - // 2 -    3 -    -      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^block)() = ^{ <span class="hljs-keyword"><span class="hljs-keyword">@throw</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">NSException</span></span> exceptionWithName:<span class="hljs-built_in"><span class="hljs-built_in">NSGenericException</span></span> reason:<span class="hljs-string"><span class="hljs-string">@"test throw"</span></span> userInfo:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; }; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertNoThrowSpecific</span></span>(block(), MyException); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Check for throwing an exception by the exception class with the name</b> <div class="spoiler_text">  Class MyException derived from NSException <br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyException</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSException</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyException</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testThrowWithNamedExceptionClass { <span class="hljs-comment"><span class="hljs-comment">/* 1 - // 2 -   3 -    4 -    -      */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *nameException = <span class="hljs-string"><span class="hljs-string">@"name expection"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^block)() = ^{ <span class="hljs-keyword"><span class="hljs-keyword">@throw</span></span> [MyException exceptionWithName:nameException reason:<span class="hljs-string"><span class="hljs-string">@"test throw"</span></span> userInfo:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; }; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertThrowsSpecificNamed</span></span>(block(), MyException, nameException); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Check for throwing an exception EXCELLENT from the exception class named</b> <div class="spoiler_text">  Class MyException derived from NSException <br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyException</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSException</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyException</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testNoThrowWithNamedExceptionClass { <span class="hljs-comment"><span class="hljs-comment">/* 1 - // 2 -   3 -    4 -    -      */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *nameException = <span class="hljs-string"><span class="hljs-string">@"name expection"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^block)() = ^{ <span class="hljs-keyword"><span class="hljs-keyword">@throw</span></span> [MyException exceptionWithName:[nameException stringByAppendingString:<span class="hljs-string"><span class="hljs-string">@"123"</span></span>] reason:<span class="hljs-string"><span class="hljs-string">@"test throw"</span></span> userInfo:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; }; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertNoThrowSpecificNamed</span></span>(block(), MyException, nameException); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Equality of objects</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testEqualObject { <span class="hljs-comment"><span class="hljs-comment">/* 1 -   isEqual 2 -   isEqual  3 -    -      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> obj1 = @[]; <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> obj2 = @[]; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertEqualObjects</span></span>(obj1, obj2, <span class="hljs-string"><span class="hljs-string">@"obj1(%@) not equal to obj2(%@))"</span></span>, obj1, obj2); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Object Inequality</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testNoEqualObject { <span class="hljs-comment"><span class="hljs-comment">/* 1 -   isEqual 2 -   isEqual  3 -    -      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> obj1 = <span class="hljs-string"><span class="hljs-string">@"name"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> obj2 = @{}; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertNotEqualObjects</span></span>(obj1, obj2, <span class="hljs-string"><span class="hljs-string">@"obj1(%@) not equal to obj2(%@))"</span></span>, obj1, obj2); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Time delay check</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testAsync { <span class="hljs-comment"><span class="hljs-comment">/* 1.     (     ) 2.    3.   4.  fulfill     XCTestExpectation    fulfill     -     */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">XCTestExpectation</span></span> *expectation = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> expectationWithDescription:<span class="hljs-string"><span class="hljs-string">@"block not call"</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">NSTimeInterval</span></span> timeout = <span class="hljs-number"><span class="hljs-number">1.0</span></span>f; [expectation performSelector:<span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(fulfill) withObject:<span class="hljs-literal"><span class="hljs-literal">nil</span></span> afterDelay:<span class="hljs-number"><span class="hljs-number">0.3</span></span>f]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> waitForExpectationsWithTimeout:timeout handler:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; }</code> </pre><br></div></div><br><h2>  Step 4. Testing code with dependencies </h2><br>  Come to the most interesting part of the article.  If you carefully read the first 2 links, then you already know that for unit testing you need to isolate the class from dependencies.  You can write everything by hand, but we take ready.  Take the OCMock library. <br><br>  Install using <a href="https://cocoapods.org/">CocoaPods</a> : <br><blockquote>  pod 'OCMock', '~&gt; 3.1.2' </blockquote><br>  Consider the most frequent problems when writing tests, when there are dependencies, and see how to cope with them using the OCMock library.  Let's create for demonstration the classes ClassA and ClassB. <br><br><div class="spoiler">  <b class="spoiler_title">Dependence on another class</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testInit { <span class="hljs-comment"><span class="hljs-comment">/*  mock   ClassB     init  ClassA ,  classA.classB     ,   mockClassB */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> mockClassB = OCMClassMock([ClassB <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]); ClassA *classA = [[ClassA alloc] initWithClassB:mockClassB]; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertEqual</span></span>(classA.classB, mockClassB); }</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Data from another object</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testStub { <span class="hljs-comment"><span class="hljs-comment">/*  mock   ClassB   stub ,   .      ClassB    */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *expectedInfo = <span class="hljs-string"><span class="hljs-string">@"info"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> mockClassB = OCMClassMock([ClassB <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]); OCMStub([mockClassB info]).andReturn(expectedInfo); <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *info = [mockClassB info]; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertEqualObjects</span></span>(info, expectedInfo); }</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Data from another object depending on input data</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testStubWithArg { <span class="hljs-comment"><span class="hljs-comment">/*  mock   ClassB   stub ,        */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> mockClassB = OCMClassMock([ClassB <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]); <span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span> expectedFactorial3 = <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span> expectedFactorial5 = <span class="hljs-number"><span class="hljs-number">120</span></span>; OCMExpect([mockClassB factorial:<span class="hljs-number"><span class="hljs-number">3</span></span>]).andReturn(expectedFactorial3); OCMExpect([mockClassB factorial:<span class="hljs-number"><span class="hljs-number">5</span></span>]).andReturn(expectedFactorial5); <span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span> factorial3 = [mockClassB factorial:<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span> factorial5 = [mockClassB factorial:<span class="hljs-number"><span class="hljs-number">5</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertEqual</span></span>(factorial3, expectedFactorial3); <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertEqual</span></span>(factorial5, expectedFactorial5); }</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Notification from another object</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testNotification { <span class="hljs-comment"><span class="hljs-comment">/*  mock   ClassB   stub ,    mock observer        mock         mock observer */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> mockClassB = OCMClassMock([ClassB <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]); <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *notificationName = <span class="hljs-string"><span class="hljs-string">@"notification name"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">NSNotification</span></span> *notification = [<span class="hljs-built_in"><span class="hljs-built_in">NSNotification</span></span> notificationWithName:notificationName object:mockClassB]; OCMStub([mockClassB postNotification]).andPost(notification); <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> mockObserver = OCMObserverMock(); [[<span class="hljs-built_in"><span class="hljs-built_in">NSNotificationCenter</span></span> defaultCenter] addMockObserver:mockObserver name:notificationName object:mockClassB]; OCMExpect([mockObserver notificationWithName:notificationName object:mockClassB]); [mockClassB postNotification]; OCMVerifyAll(mockObserver); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Calling another object's method</b> <div class="spoiler_text">  It does not differ in logic from the example above.  We write expectations and check if they were caused. <br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testVerifyExpect { <span class="hljs-comment"><span class="hljs-comment">/*  mock   ClassB      info  postNotification        mock  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> mockClassB = OCMClassMock([ClassB <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]); OCMExpect([mockClassB info]); OCMExpect([mockClassB postNotification]); [mockClassB info]; [mockClassB postNotification]; OCMVerifyAll(mockClassB); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Dependencies on the current state of the object</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testPartialMockObject { <span class="hljs-comment"><span class="hljs-comment">/*    ClassA,      count.  count  readonly */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> classA = [[ClassA alloc] initWithCount:<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertEqual</span></span>([classA count], <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> partialMock = OCMPartialMock(classA); OCMStub([partialMock count]).andReturn(<span class="hljs-number"><span class="hljs-number">41</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertEqual</span></span>([classA count], <span class="hljs-number"><span class="hljs-number">41</span></span>); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Call at block object with delay</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testStubWithBlock { <span class="hljs-comment"><span class="hljs-comment">/*  mock   ClassB   stub ,       mock   ClassA      ,          */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^block)() = [OCMArg checkWithBlock:^<span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> value) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">YES</span></span>; }]; <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> mockClassB = OCMClassMock([ClassB <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]); OCMExpect([mockClassB setBlock:block]); <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> mockClassA = OCMClassMock([ClassA <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]); OCMStub([mockClassA useBlockInClassB]).andDo(^(<span class="hljs-built_in"><span class="hljs-built_in">NSInvocation</span></span> *invocation) { dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="hljs-number"><span class="hljs-number">1</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">NSEC_PER_SEC</span></span>)), dispatch_get_main_queue(), ^{ [mockClassB setBlock:^{ }]; }); }); [mockClassA useBlockInClassB]; OCMVerifyAllWithDelay(mockClassB, <span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre><br></div></div><br>  For most tasks this should be enough.  I propose to read more <a href="http://ocmock.org/reference">here</a> . <br><br><h2>  Step 5. Configuring the launch of logic tests </h2><br>  When running tests (for example, using the cmd + u combination), the main code is first run and only after that the tests.  This is bad.  Often there are situations when the program crashes when the main code is executed and the tests do not run.  Fix it. <br><br>  <u>Let's create another AppDelegate</u> (AppDelegateForTest), but to run the tests (when creating, choose to add to the main Target). <br><br><div class="spoiler">  <b class="spoiler_title">Change main.c</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> argc, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *argv[]) { <span class="hljs-keyword"><span class="hljs-keyword">@autoreleasepool</span></span> { Class appDelegateClass = (<span class="hljs-built_in"><span class="hljs-built_in">NSClassFromString</span></span>(<span class="hljs-string"><span class="hljs-string">@"XCTestCase"</span></span>) ? [TestingSAAppDelegate <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>] : [SAAppDelegate <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UIApplicationMain</span></span>(argc, argv, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">NSStringFromClass</span></span>(appDelegateClass)); } }</code> </pre><br></div></div><br>  Is done.  Now our tests run independently of our main code. <br><br>  I think this article can be finished.  Were considered functions for testing from the standard library, as well as the most necessary of the library OCMock.  The project source can be downloaded <a href="https://github.com/ajjnix/DemoUnitTesting">here</a> . <br><br>  Good luck with your testing! </div><p>Source: <a href="https://habr.com/ru/post/258953/">https://habr.com/ru/post/258953/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258941/index.html">An example of a multi-vendor WLAN access control solution</a></li>
<li><a href="../258943/index.html">Competition for designers from Mail.Ru Mail</a></li>
<li><a href="../258947/index.html">Upsource 2.0 came out with an IDE plug-in, Java code analysis in Gradle projects, JavaScript navigation and much more.</a></li>
<li><a href="../258949/index.html">Juniper emulator. VMware Virtual Lab</a></li>
<li><a href="../258951/index.html">Cross-compiling Qt5 for Linux for Win x32 / x64 / static / shared</a></li>
<li><a href="../258955/index.html">Master Tehnokub</a></li>
<li><a href="../258957/index.html">TypeScript: general impressions</a></li>
<li><a href="../258959/index.html">Serialization, sir! Today for dinner byte porridge, cooked from C ++ objects</a></li>
<li><a href="../258961/index.html">How to pass an elephant through the eye of a needle. Processing the maximum amount of data in the shortest time</a></li>
<li><a href="../258963/index.html">Krovi: Big Data - as dream. 10th series: Standard bummer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>