<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VMware Server :: manage your car park</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello ;) 

 Continuing ... (who missed a step back ) 
 I wonder how you manage virtual machines ?! 
 Every time you take a snapshot, pause or turn off...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VMware Server :: manage your car park</h1><div class="post__text post__text-html js-mediator-article"> Hello ;) <br><br>  Continuing ... (who missed a <a href="http://habrahabr.ru/blogs/i_am_clever/39110/">step back</a> ) <br>  I wonder how you manage virtual machines ?! <br>  Every time you take a snapshot, pause or turn off the machine (s), do you spend time on it ?! <br><br>  Then we go to you!  :) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  I will try to tell you how I personally automated the work with virtual machines. <br>  To many, this will seem utterly stupid, but this solution and IT were found by the hands of the user, not the developer. <br><br>  Let's start with the most painful, with the shutdown.  Why from him, but because usually there is never enough time for him, always somewhere late.  Well, or, for example, you leave it to a colleague, but he, by forgetfulness, does not turn it off. <br>  I do not know about the others, but it has been proved in my practice: if you put the machine into self-shutdown <i>mode</i> ( <i>On host shutdown mode - Shut down guest operating system</i> ), then the probability of incorrect shutdown is very high.  Vmware just does not have time to stop everything correctly. <br>  If someone has a desire, you can experience: we take a server, run several machines with the FreeBSD OS, run load tests on them, turn off the OS under which the VM is spinning.  We get fsck running on FreeBSD on new startup. <br>  Total: in such situations, I recommend VMware to pause.  When removing from a pause, you just have to synchronize time. <br><br>  <i>Do you know?!: With a dense load of physical servers by virtual machines, time is slowing down on each of them.</i> <br><br>  We turn to the most interesting. <br>  The implementation of the script to automatically switch to pause mode, all running machines. <br><br>  <i>Do you know?!: Under VMware, you can develop machine control scripts.</i> <i><br></i>  <i>More details can be found at <a href="http://www.vmware.com/support/pubs/server_pubs.html">http://www.vmware.com/support/pubs/server_pubs.html</a></i> <br><br>  Before you is a modified example script from the distribution of the VMware distribution (on which it is written it says it all): <br><br>  Primitive algorithm of work: <br>  1. Check all registered cars (defined in invetory). <br>  1.1.  The machine is working. <br>  1.1.1 pause <br>  1.1.2 Check whether it is up or not. <br><br>  check_vm.vbs - main script <br> <code><a href="http://source.virtser.net/"></a> <font color="black"><font color="#008000">'</font> <br> <font color="#008000">' VmCOM VBScript Sample Script (sample2)</font> <br> <font color="#008000">' Copyright 1998 VMware, Inc. All rights reserved. -- VMware Confidential</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' Permission is hereby granted, free of charge, to any person obtaining a</font> <br> <font color="#008000">' copy of the software in this file (the "Software"), to deal in the</font> <br> <font color="#008000">' Software without restriction, including without limitation the rights to</font> <br> <font color="#008000">' use, copy, modify, merge, publish, distribute, sublicense, and/or sell</font> <br> <font color="#008000">' copies of the Software, and to permit persons to whom the Software is</font> <br> <font color="#008000">' furnished to do so, subject to the following conditions:</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' The above copyright notice and this permission notice shall be included in</font> <br> <font color="#008000">' all copies or substantial portions of the Software.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' The names "VMware" and "VMware, Inc." must not be used to endorse or</font> <br> <font color="#008000">' promote products derived from the Software without the prior written</font> <br> <font color="#008000">' permission of VMware, Inc.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' Products derived from the Software may not be called "VMware", nor may</font> <br> <font color="#008000">' "VMware" appear in their name, without the prior written permission of</font> <br> <font color="#008000">' VMware, Inc.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</font> <br> <font color="#008000">' IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</font> <br> <font color="#008000">' FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</font> <br> <font color="#008000">' VMWARE,INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER</font> <br> <font color="#008000">' IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</font> <br> <font color="#008000">' CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' ------</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' This program is for educational purposes only.</font> <br> <font color="#008000">' It is not to be used in production environments.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' Description:</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' This script displays the virtual machines on the local server.</font> <br> <font color="#008000">' It prints the configuration file path and current execution</font> <br> <font color="#008000">' state of each VM. If a VM is in the stuck state, the current</font> <br> <font color="#008000">' question and its choices are also printed.</font> <br> <font color="#008000">' Additionally, if a VM is stuck on an undoable disk related</font> <br> <font color="#008000">' question, the script automatically answers 'Keep' on a power-off</font> <br> <font color="#008000">' and 'Append' on a power-on.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' NOTE: the question-answering logic used is language and product</font> <br> <font color="#008000">'    dependent, and is only provided for illustration purposes only!</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' Instructions for Windows 2000 and later operating systems:</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' - save the contents of this file to a file named 'sample2.vbs'</font> <br> <font color="#008000">'  unless it's already named that way</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' - there should be an accompanying file named 'sample2.wsf'</font> <br> <font color="#008000">'  It is placed in the same directory as this file during</font> <br> <font color="#008000">'  product installation. This file is responsible for setting</font> <br> <font color="#008000">'  up the Windows Script Host environment and loading the</font> <br> <font color="#008000">'  VmCOM type library, thereby enabling this script to</font> <br> <font color="#008000">'  reference symbolic constants such as vmExecutionState_On</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' - in a command line window, type:</font> <br> <font color="#008000">'  cscript //nologo sample2.wsf</font> <br> <font color="#008000">'</font> <br> <br> <font color="#0000ff">Set</font> cp = CreateObject( <font color="#A31515">"VmCOM.VmConnectParams"</font> ) <br> <font color="#0000ff">Set</font> server = CreateObject( <font color="#A31515">"VmCOM.VmServerCtl"</font> ) <br> <br> server.Connect cp <br> <font color="#0000ff">Set</font> vmCollection = server.RegisteredVmNames <br> <br> <font color="#0000ff">for</font> <font color="#0000ff">each</font> vmName <font color="#0000ff">in</font> vmCollection <br> <font color="#0000ff">Set</font> vm = CreateObject( <font color="#A31515">"VmCOM.VmCtl"</font> ) <br> s = <font color="#A31515">"path="</font> &amp; vmName <br> <font color="#0000ff">On</font> <font color="#0000ff">error</font> <font color="#0000ff">resume</font> <font color="#0000ff">next</font> <font color="#008000">' Clear error object</font> <br> vm.Connect cp,vmName <br> <font color="#0000ff">if</font> err.Number = vmErr_VMBUSY <font color="#0000ff">then</font> <br> s = s &amp; <font color="#A31515">" UNAVAILABLE (controlled by local console)"</font> <br> <font color="#0000ff">elseif</font> err.Number &lt;&gt; 0 <font color="#0000ff">then</font> <br> s = s &amp; <font color="#A31515">" ERROR CONNECTING desc='"</font> &amp; err.Description &amp; <font color="#A31515">"'"</font> <br> <font color="#0000ff">else</font> <br> <font color="#0000ff">On</font> <font color="#0000ff">error</font> <font color="#0000ff">goto</font> 0 <font color="#008000">'Make errors fatal past this point</font> <br> s = s &amp; <font color="#A31515">" state="</font> &amp; State2Str(vm) &amp; <font color="#A31515">" os="</font> &amp; vm.Config( <font color="#A31515">"guestos"</font> ) <br> <font color="#0000ff">if</font> vm.ExecutionState = vmExecutionState_Stuck <font color="#0000ff">then</font> <br> <font color="#0000ff">Set</font> q = vm.PendingQuestion <br> <font color="#0000ff">Set</font> choices = q.choices <br> s = s &amp; <font color="#A31515">" question= '"</font> &amp; q.text &amp; <font color="#A31515">"' choices="</font> <br> <font color="#0000ff">for</font> <font color="#0000ff">each</font> choice <font color="#0000ff">in</font> choices <br> s = s &amp; <font color="#A31515">"["</font> &amp; choice &amp; <font color="#A31515">"] "</font> <br> <font color="#0000ff">next</font> <br> <br> <font color="#008000">' If this looks like an undoable disk save question,</font> <br> <font color="#008000">' automatically answer 'Append' or 'Keep'</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' NOTE: this code makes alot of assumptions about the product</font> <br> <font color="#008000">'    and the language used, and may break under some environments.</font> <br> <font color="#008000">'    It is shown for illustration purposes only!</font> <br> <br> <font color="#0000ff">Set</font> r = <font color="#0000ff">new</font> RegExp <br> r.pattern = <font color="#A31515">"undoable disk"</font> <br> r.ignorecase = <font color="#0000ff">True</font> <br> <font color="#0000ff">Set</font> matches = r.Execute(q.text) <br> <br> <font color="#0000ff">if</font> matches.count &gt; 0 <font color="#0000ff">then</font> <br> <font color="#0000ff">for</font> i = 1 <font color="#0000ff">to</font> choices.count <br> <font color="#0000ff">if</font> choices(i) = <font color="#A31515">"Append"</font> <font color="#0000ff">or</font> choices(i) = <font color="#A31515">"Keep"</font> <font color="#0000ff">then</font> <br> WScript.Echo(s) <br> s = <font color="#A31515">"  --&gt; Automatically selecting '"</font> &amp; q.choices(i) &amp; <font color="#A31515">"' as answer"</font> <br> vm.AnswerQuestion q,i <br> <font color="#0000ff">exit</font> <font color="#0000ff">for</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> <font color="#0000ff">next</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> WScript.Echo(s) <br> Recheck(vm) <font color="#008000">'  </font> <br> <font color="#0000ff">next</font> <br> <br> <font color="#0000ff">function</font> State2Str(vm) <br> <font color="#0000ff">select</font> <font color="#0000ff">case</font> vm.ExecutionState <br> <font color="#0000ff">case</font> vmExecutionState_On <br> State2Str = <font color="#A31515">"ON"</font> <br> <font color="#0000ff">case</font> vmExecutionState_Off <br> State2Str = <font color="#A31515">"OFF"</font> <br> <font color="#0000ff">case</font> vmExecutionState_Suspended <br> State2Str = <font color="#A31515">"SUSPENDED"</font> <br> <font color="#0000ff">case</font> vmExecutionState_Stuck <br> State2Str = <font color="#A31515">"STUCK"</font> <br> <font color="#0000ff">case</font> <font color="#0000ff">else</font> <br> State2Str = <font color="#A31515">"UNKNOWN"</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">select</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">function</font> <br> <font color="#008000">'    ,         </font> <br> <font color="#0000ff">function</font> Recheck(vm) <br> <font color="#0000ff">if</font> vm.ExecutionState = vmExecutionState_On <font color="#0000ff">then</font> <font color="#008000">'  </font> <br> vm.Suspend (vmPowerOpMode_Hard) <font color="#008000">'  ,       (  )</font> <br> WScript.Echo <font color="#A31515">"Recheck this VM_machine state="</font> &amp; State2Str(vm) <font color="#008000">'    </font> <br> WScript.Sleep(10000) <font color="#008000">' ,    </font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> <font color="#0000ff">end</font> function</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br> <br></code> <blockquote> <code><a href="http://source.virtser.net/"></a> <font color="black"><font color="#008000">'</font> <br> <font color="#008000">' VmCOM VBScript Sample Script (sample2)</font> <br> <font color="#008000">' Copyright 1998 VMware, Inc. All rights reserved. -- VMware Confidential</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' Permission is hereby granted, free of charge, to any person obtaining a</font> <br> <font color="#008000">' copy of the software in this file (the "Software"), to deal in the</font> <br> <font color="#008000">' Software without restriction, including without limitation the rights to</font> <br> <font color="#008000">' use, copy, modify, merge, publish, distribute, sublicense, and/or sell</font> <br> <font color="#008000">' copies of the Software, and to permit persons to whom the Software is</font> <br> <font color="#008000">' furnished to do so, subject to the following conditions:</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' The above copyright notice and this permission notice shall be included in</font> <br> <font color="#008000">' all copies or substantial portions of the Software.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' The names "VMware" and "VMware, Inc." must not be used to endorse or</font> <br> <font color="#008000">' promote products derived from the Software without the prior written</font> <br> <font color="#008000">' permission of VMware, Inc.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' Products derived from the Software may not be called "VMware", nor may</font> <br> <font color="#008000">' "VMware" appear in their name, without the prior written permission of</font> <br> <font color="#008000">' VMware, Inc.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</font> <br> <font color="#008000">' IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</font> <br> <font color="#008000">' FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</font> <br> <font color="#008000">' VMWARE,INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER</font> <br> <font color="#008000">' IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</font> <br> <font color="#008000">' CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' ------</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' This program is for educational purposes only.</font> <br> <font color="#008000">' It is not to be used in production environments.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' Description:</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' This script displays the virtual machines on the local server.</font> <br> <font color="#008000">' It prints the configuration file path and current execution</font> <br> <font color="#008000">' state of each VM. If a VM is in the stuck state, the current</font> <br> <font color="#008000">' question and its choices are also printed.</font> <br> <font color="#008000">' Additionally, if a VM is stuck on an undoable disk related</font> <br> <font color="#008000">' question, the script automatically answers 'Keep' on a power-off</font> <br> <font color="#008000">' and 'Append' on a power-on.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' NOTE: the question-answering logic used is language and product</font> <br> <font color="#008000">'    dependent, and is only provided for illustration purposes only!</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' Instructions for Windows 2000 and later operating systems:</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' - save the contents of this file to a file named 'sample2.vbs'</font> <br> <font color="#008000">'  unless it's already named that way</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' - there should be an accompanying file named 'sample2.wsf'</font> <br> <font color="#008000">'  It is placed in the same directory as this file during</font> <br> <font color="#008000">'  product installation. This file is responsible for setting</font> <br> <font color="#008000">'  up the Windows Script Host environment and loading the</font> <br> <font color="#008000">'  VmCOM type library, thereby enabling this script to</font> <br> <font color="#008000">'  reference symbolic constants such as vmExecutionState_On</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' - in a command line window, type:</font> <br> <font color="#008000">'  cscript //nologo sample2.wsf</font> <br> <font color="#008000">'</font> <br> <br> <font color="#0000ff">Set</font> cp = CreateObject( <font color="#A31515">"VmCOM.VmConnectParams"</font> ) <br> <font color="#0000ff">Set</font> server = CreateObject( <font color="#A31515">"VmCOM.VmServerCtl"</font> ) <br> <br> server.Connect cp <br> <font color="#0000ff">Set</font> vmCollection = server.RegisteredVmNames <br> <br> <font color="#0000ff">for</font> <font color="#0000ff">each</font> vmName <font color="#0000ff">in</font> vmCollection <br> <font color="#0000ff">Set</font> vm = CreateObject( <font color="#A31515">"VmCOM.VmCtl"</font> ) <br> s = <font color="#A31515">"path="</font> &amp; vmName <br> <font color="#0000ff">On</font> <font color="#0000ff">error</font> <font color="#0000ff">resume</font> <font color="#0000ff">next</font> <font color="#008000">' Clear error object</font> <br> vm.Connect cp,vmName <br> <font color="#0000ff">if</font> err.Number = vmErr_VMBUSY <font color="#0000ff">then</font> <br> s = s &amp; <font color="#A31515">" UNAVAILABLE (controlled by local console)"</font> <br> <font color="#0000ff">elseif</font> err.Number &lt;&gt; 0 <font color="#0000ff">then</font> <br> s = s &amp; <font color="#A31515">" ERROR CONNECTING desc='"</font> &amp; err.Description &amp; <font color="#A31515">"'"</font> <br> <font color="#0000ff">else</font> <br> <font color="#0000ff">On</font> <font color="#0000ff">error</font> <font color="#0000ff">goto</font> 0 <font color="#008000">'Make errors fatal past this point</font> <br> s = s &amp; <font color="#A31515">" state="</font> &amp; State2Str(vm) &amp; <font color="#A31515">" os="</font> &amp; vm.Config( <font color="#A31515">"guestos"</font> ) <br> <font color="#0000ff">if</font> vm.ExecutionState = vmExecutionState_Stuck <font color="#0000ff">then</font> <br> <font color="#0000ff">Set</font> q = vm.PendingQuestion <br> <font color="#0000ff">Set</font> choices = q.choices <br> s = s &amp; <font color="#A31515">" question= '"</font> &amp; q.text &amp; <font color="#A31515">"' choices="</font> <br> <font color="#0000ff">for</font> <font color="#0000ff">each</font> choice <font color="#0000ff">in</font> choices <br> s = s &amp; <font color="#A31515">"["</font> &amp; choice &amp; <font color="#A31515">"] "</font> <br> <font color="#0000ff">next</font> <br> <br> <font color="#008000">' If this looks like an undoable disk save question,</font> <br> <font color="#008000">' automatically answer 'Append' or 'Keep'</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' NOTE: this code makes alot of assumptions about the product</font> <br> <font color="#008000">'    and the language used, and may break under some environments.</font> <br> <font color="#008000">'    It is shown for illustration purposes only!</font> <br> <br> <font color="#0000ff">Set</font> r = <font color="#0000ff">new</font> RegExp <br> r.pattern = <font color="#A31515">"undoable disk"</font> <br> r.ignorecase = <font color="#0000ff">True</font> <br> <font color="#0000ff">Set</font> matches = r.Execute(q.text) <br> <br> <font color="#0000ff">if</font> matches.count &gt; 0 <font color="#0000ff">then</font> <br> <font color="#0000ff">for</font> i = 1 <font color="#0000ff">to</font> choices.count <br> <font color="#0000ff">if</font> choices(i) = <font color="#A31515">"Append"</font> <font color="#0000ff">or</font> choices(i) = <font color="#A31515">"Keep"</font> <font color="#0000ff">then</font> <br> WScript.Echo(s) <br> s = <font color="#A31515">"  --&gt; Automatically selecting '"</font> &amp; q.choices(i) &amp; <font color="#A31515">"' as answer"</font> <br> vm.AnswerQuestion q,i <br> <font color="#0000ff">exit</font> <font color="#0000ff">for</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> <font color="#0000ff">next</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> WScript.Echo(s) <br> Recheck(vm) <font color="#008000">'  </font> <br> <font color="#0000ff">next</font> <br> <br> <font color="#0000ff">function</font> State2Str(vm) <br> <font color="#0000ff">select</font> <font color="#0000ff">case</font> vm.ExecutionState <br> <font color="#0000ff">case</font> vmExecutionState_On <br> State2Str = <font color="#A31515">"ON"</font> <br> <font color="#0000ff">case</font> vmExecutionState_Off <br> State2Str = <font color="#A31515">"OFF"</font> <br> <font color="#0000ff">case</font> vmExecutionState_Suspended <br> State2Str = <font color="#A31515">"SUSPENDED"</font> <br> <font color="#0000ff">case</font> vmExecutionState_Stuck <br> State2Str = <font color="#A31515">"STUCK"</font> <br> <font color="#0000ff">case</font> <font color="#0000ff">else</font> <br> State2Str = <font color="#A31515">"UNKNOWN"</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">select</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">function</font> <br> <font color="#008000">'    ,         </font> <br> <font color="#0000ff">function</font> Recheck(vm) <br> <font color="#0000ff">if</font> vm.ExecutionState = vmExecutionState_On <font color="#0000ff">then</font> <font color="#008000">'  </font> <br> vm.Suspend (vmPowerOpMode_Hard) <font color="#008000">'  ,       (  )</font> <br> WScript.Echo <font color="#A31515">"Recheck this VM_machine state="</font> &amp; State2Str(vm) <font color="#008000">'    </font> <br> WScript.Sleep(10000) <font color="#008000">' ,    </font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> <font color="#0000ff">end</font> function</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br> <br></code> </blockquote> <code><a href="http://source.virtser.net/"></a> <font color="black"><font color="#008000">'</font> <br> <font color="#008000">' VmCOM VBScript Sample Script (sample2)</font> <br> <font color="#008000">' Copyright 1998 VMware, Inc. All rights reserved. -- VMware Confidential</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' Permission is hereby granted, free of charge, to any person obtaining a</font> <br> <font color="#008000">' copy of the software in this file (the "Software"), to deal in the</font> <br> <font color="#008000">' Software without restriction, including without limitation the rights to</font> <br> <font color="#008000">' use, copy, modify, merge, publish, distribute, sublicense, and/or sell</font> <br> <font color="#008000">' copies of the Software, and to permit persons to whom the Software is</font> <br> <font color="#008000">' furnished to do so, subject to the following conditions:</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' The above copyright notice and this permission notice shall be included in</font> <br> <font color="#008000">' all copies or substantial portions of the Software.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' The names "VMware" and "VMware, Inc." must not be used to endorse or</font> <br> <font color="#008000">' promote products derived from the Software without the prior written</font> <br> <font color="#008000">' permission of VMware, Inc.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' Products derived from the Software may not be called "VMware", nor may</font> <br> <font color="#008000">' "VMware" appear in their name, without the prior written permission of</font> <br> <font color="#008000">' VMware, Inc.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</font> <br> <font color="#008000">' IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</font> <br> <font color="#008000">' FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</font> <br> <font color="#008000">' VMWARE,INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER</font> <br> <font color="#008000">' IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</font> <br> <font color="#008000">' CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' ------</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' This program is for educational purposes only.</font> <br> <font color="#008000">' It is not to be used in production environments.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' Description:</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' This script displays the virtual machines on the local server.</font> <br> <font color="#008000">' It prints the configuration file path and current execution</font> <br> <font color="#008000">' state of each VM. If a VM is in the stuck state, the current</font> <br> <font color="#008000">' question and its choices are also printed.</font> <br> <font color="#008000">' Additionally, if a VM is stuck on an undoable disk related</font> <br> <font color="#008000">' question, the script automatically answers 'Keep' on a power-off</font> <br> <font color="#008000">' and 'Append' on a power-on.</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' NOTE: the question-answering logic used is language and product</font> <br> <font color="#008000">'    dependent, and is only provided for illustration purposes only!</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' Instructions for Windows 2000 and later operating systems:</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' - save the contents of this file to a file named 'sample2.vbs'</font> <br> <font color="#008000">'  unless it's already named that way</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' - there should be an accompanying file named 'sample2.wsf'</font> <br> <font color="#008000">'  It is placed in the same directory as this file during</font> <br> <font color="#008000">'  product installation. This file is responsible for setting</font> <br> <font color="#008000">'  up the Windows Script Host environment and loading the</font> <br> <font color="#008000">'  VmCOM type library, thereby enabling this script to</font> <br> <font color="#008000">'  reference symbolic constants such as vmExecutionState_On</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' - in a command line window, type:</font> <br> <font color="#008000">'  cscript //nologo sample2.wsf</font> <br> <font color="#008000">'</font> <br> <br> <font color="#0000ff">Set</font> cp = CreateObject( <font color="#A31515">"VmCOM.VmConnectParams"</font> ) <br> <font color="#0000ff">Set</font> server = CreateObject( <font color="#A31515">"VmCOM.VmServerCtl"</font> ) <br> <br> server.Connect cp <br> <font color="#0000ff">Set</font> vmCollection = server.RegisteredVmNames <br> <br> <font color="#0000ff">for</font> <font color="#0000ff">each</font> vmName <font color="#0000ff">in</font> vmCollection <br> <font color="#0000ff">Set</font> vm = CreateObject( <font color="#A31515">"VmCOM.VmCtl"</font> ) <br> s = <font color="#A31515">"path="</font> &amp; vmName <br> <font color="#0000ff">On</font> <font color="#0000ff">error</font> <font color="#0000ff">resume</font> <font color="#0000ff">next</font> <font color="#008000">' Clear error object</font> <br> vm.Connect cp,vmName <br> <font color="#0000ff">if</font> err.Number = vmErr_VMBUSY <font color="#0000ff">then</font> <br> s = s &amp; <font color="#A31515">" UNAVAILABLE (controlled by local console)"</font> <br> <font color="#0000ff">elseif</font> err.Number &lt;&gt; 0 <font color="#0000ff">then</font> <br> s = s &amp; <font color="#A31515">" ERROR CONNECTING desc='"</font> &amp; err.Description &amp; <font color="#A31515">"'"</font> <br> <font color="#0000ff">else</font> <br> <font color="#0000ff">On</font> <font color="#0000ff">error</font> <font color="#0000ff">goto</font> 0 <font color="#008000">'Make errors fatal past this point</font> <br> s = s &amp; <font color="#A31515">" state="</font> &amp; State2Str(vm) &amp; <font color="#A31515">" os="</font> &amp; vm.Config( <font color="#A31515">"guestos"</font> ) <br> <font color="#0000ff">if</font> vm.ExecutionState = vmExecutionState_Stuck <font color="#0000ff">then</font> <br> <font color="#0000ff">Set</font> q = vm.PendingQuestion <br> <font color="#0000ff">Set</font> choices = q.choices <br> s = s &amp; <font color="#A31515">" question= '"</font> &amp; q.text &amp; <font color="#A31515">"' choices="</font> <br> <font color="#0000ff">for</font> <font color="#0000ff">each</font> choice <font color="#0000ff">in</font> choices <br> s = s &amp; <font color="#A31515">"["</font> &amp; choice &amp; <font color="#A31515">"] "</font> <br> <font color="#0000ff">next</font> <br> <br> <font color="#008000">' If this looks like an undoable disk save question,</font> <br> <font color="#008000">' automatically answer 'Append' or 'Keep'</font> <br> <font color="#008000">'</font> <br> <font color="#008000">' NOTE: this code makes alot of assumptions about the product</font> <br> <font color="#008000">'    and the language used, and may break under some environments.</font> <br> <font color="#008000">'    It is shown for illustration purposes only!</font> <br> <br> <font color="#0000ff">Set</font> r = <font color="#0000ff">new</font> RegExp <br> r.pattern = <font color="#A31515">"undoable disk"</font> <br> r.ignorecase = <font color="#0000ff">True</font> <br> <font color="#0000ff">Set</font> matches = r.Execute(q.text) <br> <br> <font color="#0000ff">if</font> matches.count &gt; 0 <font color="#0000ff">then</font> <br> <font color="#0000ff">for</font> i = 1 <font color="#0000ff">to</font> choices.count <br> <font color="#0000ff">if</font> choices(i) = <font color="#A31515">"Append"</font> <font color="#0000ff">or</font> choices(i) = <font color="#A31515">"Keep"</font> <font color="#0000ff">then</font> <br> WScript.Echo(s) <br> s = <font color="#A31515">"  --&gt; Automatically selecting '"</font> &amp; q.choices(i) &amp; <font color="#A31515">"' as answer"</font> <br> vm.AnswerQuestion q,i <br> <font color="#0000ff">exit</font> <font color="#0000ff">for</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> <font color="#0000ff">next</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> WScript.Echo(s) <br> Recheck(vm) <font color="#008000">'  </font> <br> <font color="#0000ff">next</font> <br> <br> <font color="#0000ff">function</font> State2Str(vm) <br> <font color="#0000ff">select</font> <font color="#0000ff">case</font> vm.ExecutionState <br> <font color="#0000ff">case</font> vmExecutionState_On <br> State2Str = <font color="#A31515">"ON"</font> <br> <font color="#0000ff">case</font> vmExecutionState_Off <br> State2Str = <font color="#A31515">"OFF"</font> <br> <font color="#0000ff">case</font> vmExecutionState_Suspended <br> State2Str = <font color="#A31515">"SUSPENDED"</font> <br> <font color="#0000ff">case</font> vmExecutionState_Stuck <br> State2Str = <font color="#A31515">"STUCK"</font> <br> <font color="#0000ff">case</font> <font color="#0000ff">else</font> <br> State2Str = <font color="#A31515">"UNKNOWN"</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">select</font> <br> <font color="#0000ff">end</font> <font color="#0000ff">function</font> <br> <font color="#008000">'    ,         </font> <br> <font color="#0000ff">function</font> Recheck(vm) <br> <font color="#0000ff">if</font> vm.ExecutionState = vmExecutionState_On <font color="#0000ff">then</font> <font color="#008000">'  </font> <br> vm.Suspend (vmPowerOpMode_Hard) <font color="#008000">'  ,       (  )</font> <br> WScript.Echo <font color="#A31515">"Recheck this VM_machine state="</font> &amp; State2Str(vm) <font color="#008000">'    </font> <br> WScript.Sleep(10000) <font color="#008000">' ,    </font> <br> <font color="#0000ff">end</font> <font color="#0000ff">if</font> <br> <font color="#0000ff">end</font> function</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br> <br></code> <br><br>  Next, run the <i>check_vm.wsf</i> script from which control is transferred to the main <i>check_vm.vbs</i> : <br><br> <code><a href="http://source.virtser.net/"></a> <font color="black">&lt;job id= <font color="#A31515">"Check_vm"</font> &gt; <br> &lt;reference <font color="#0000ff">object</font> = <font color="#A31515">"VmCOM.VmCtl"</font> /&gt; <br> &lt;script language= <font color="#A31515">"VBScript"</font> src= <font color="#A31515">"check_vm.vbs"</font> /&gt; <br> &lt;/job&gt; <br> <br></font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br> <br></code> <blockquote> <code><a href="http://source.virtser.net/"></a> <font color="black">&lt;job id= <font color="#A31515">"Check_vm"</font> &gt; <br> &lt;reference <font color="#0000ff">object</font> = <font color="#A31515">"VmCOM.VmCtl"</font> /&gt; <br> &lt;script language= <font color="#A31515">"VBScript"</font> src= <font color="#A31515">"check_vm.vbs"</font> /&gt; <br> &lt;/job&gt; <br> <br></font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br> <br></code> </blockquote> <code><a href="http://source.virtser.net/"></a> <font color="black">&lt;job id= <font color="#A31515">"Check_vm"</font> &gt; <br> &lt;reference <font color="#0000ff">object</font> = <font color="#A31515">"VmCOM.VmCtl"</font> /&gt; <br> &lt;script language= <font color="#A31515">"VBScript"</font> src= <font color="#A31515">"check_vm.vbs"</font> /&gt; <br> &lt;/job&gt; <br> <br></font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br> <br></code> <br><br>  Finally, a bat file that you can deliver, for example, 22 hours of work time.  With this use, no one will forget to properly turn off your favorite and beloved park. <br><br> <code>cscript check_vm.wsf &gt;&gt; log.txt <br> shutdown -s -f -t 100 <br></code> <br><br>  In bat, the script is called, with redirection to the log. <br>  Well shutdown, it's like tuning to shutdown.  You can try to play with the parameters. <br><br>  Example log: <br><br>  path = E: \ vmware \ Ubuntu \ Ubuntu.vmx state = ON os = ubuntu <br>  Recheck this VM_machine state = SUSPENDED <br>  path = E: \ vmware \ Ubuntu_Kde_4 \ Ubuntu.vmx state = OFF os = ubuntu <br>  path = E: \ development \ FreeBSD \ FreeBSD.vmx state = ON os = freebsd <br>  Recheck this VM_machine state = SUSPENDED <br><br>  That's all.  :) <br>  Uffff ... managed. <br>  Sleep well, and most importantly take care of your nerves. <br>  Until next article ... </div><p>Source: <a href="https://habr.com/ru/post/39130/">https://habr.com/ru/post/39130/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../391291/index.html">Raspberry Pi Alternatives</a></li>
<li><a href="../391293/index.html">Discussing the context of modern sound.</a></li>
<li><a href="../391295/index.html">The Wikimedia Foundation received 220 requests to delete / modify content. Satisfied - 0%</a></li>
<li><a href="../391297/index.html">Goodyear has shown the concept of spherical tires on magnetic levitation</a></li>
<li><a href="../391299/index.html">The number of requests to Google for the removal of "pirated links" has increased 5.5 million times since 2007</a></li>
<li><a href="../391301/index.html">Video: hacking the fingerprint sensor Samsung Galaxy S6 and Huawei Honor 7 using a regular printer</a></li>
<li><a href="../391305/index.html">Copyright fighter and musician Kanye West caught using The Pirate Bay</a></li>
<li><a href="../391307/index.html">What is the secret of the popularity of Mozart</a></li>
<li><a href="../39131/index.html">Larrabee in the new generation of Xbox?</a></li>
<li><a href="../391311/index.html">Measuring Harmony - Audio Spectrum Analyzer on STM32L4 Discovery</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>