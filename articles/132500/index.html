<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Typical cases of memory leak in java</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most developers know that the garbage collector in Java is not a universal mechanism that allows a programmer to completely forget about the rules for...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Typical cases of memory leak in java</h1><div class="post__text post__text-html js-mediator-article">  Most developers know that the garbage collector in Java is not a universal mechanism that allows a programmer to completely forget about the rules for using memory and when his work is performed.  The following are typical cases of memory leaks in java-applications that are ubiquitous. <br>  So, what should every java-programmer remember. <br><a name="habracut"></a><br>  Typical memory leak situation: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/368/7f2/075/3687f207555004e49369b5024605b578.png" alt="image"><br>  The garbage collector periodically collects unused objects, but we see that the heap usage schedule creeps up steadily and confidently. <br><br>  What can cause this situation? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  String operations </h5><br>  The most common situation is when memory leaks occur in Java applications. <br>  For understanding.  Because of what problems occur when working with strings, recall that in Java, when you perform operations such as calling the substring () method on a string, an instance of String is returned only by the changed values ‚Äã‚Äãof the length and offset variables, the length and offset of the char sequence.  At the same time, if we get a string 5000 characters long and just want to get its prefix using the substring () method, then 5000 characters will continue to be stored in memory. <br>  For systems that receive and process multiple messages, this can be a serious problem. <br>  In order to avoid this problem, you can use two options: <br><br> <code>String prefix = new String(longString.substring(0,5)); //  <br> String prefix = longString.substring(0,5).intern(); // </code> <br> <br>  An important note to the second variant with <a href="https://habrahabr.ru/users/zorkus/" class="user_link">internals</a> from <a href="https://habrahabr.ru/users/zorkus/" class="user_link">Zorkus</a> : interned strings are not stored in the heapspace, but in the permgen space.  Garbage collection in it occurs by separate rules, not as in heap-e / young / tenured memory pools. <br><br>  Similarly, we must remember that a similar problem occurs when using the split () method. <br><br><h5>  ObjectInputStream and ObjectOutputStream </h5><br>  The ObjectInputStream and ObjectOutputStream classes store references to all the objects they work with to pass them instead of copies.  This causes a memory leak during continuous use (for example, with network interaction). <br>  To solve this problem, you must periodically call the reset () method. <br><br><h5>  Threads and their stack </h5><br>  Each instance of the Thread class in Java allocates memory for its stack (by default, it is 512 KB; it is changed using the -Xss parameter).  Non-optimized applications that use multiple threads can lead to unreasonably high memory consumption. <br><br><h5>  Non-static inner classes </h5><br>  Every non-static inner class that you use stores a reference to an outer class.  This leads to the storage of a large object graph, which negatively affects memory usage.  In situations where you clearly do not need to use a reference to an external class, implement the inner classes as static. <br><br><h5>  Observer pattern and related threats </h5><br>  Often the situation with a memory leak occurs when using the Observer pattern.  As you know, Observer keeps a list of its listeners who are subscribed to alerts about certain actions.  In this case, if we no longer use a certain class that is a subscriber of this observer, then the GC will not be able to ‚Äúcollect‚Äù it, since the link to it is stored in the Observer instance itself. <br><br><h5>  Singleton </h5><br>  Once a singleton instance has been initialized, it remains in memory for the entire lifetime of the application.  As a result, this instance cannot be assembled by the assembler.  This pattern should be used only when it is justified by the real requirements for permanent storage in memory. <br><br><h5>  Threadlocal variables </h5><br>  The link to the ThreadLocal variable is used by the thread associated with it.  In most application servers, threads are reused in pools, therefore ThreadLocal data will not be collected by the GC.  If the application itself does not care about clearing these values, this will result in a serious memory leak. <br><br><h5>  Variable static objects </h5><br>  Also, frequent use of memory leaks in Java applications is the misuse of static.  A static variable is stored by its class, and as a result, by its loader (classloader).  Due to external use, the chance that the garbage collector does not collect this instance increases.  Also, information is often cached in static variables or the states used by several threads are stored.  A separate example is static collections.  A good tone for architectural design is the complete avoidance of variable static objects - there is often a better alternative. <br><br><h5>  Creating objects </h5><br>  Consider two cases. <br>  Case 1: <br><br> <code>Elem e; <br> e = new HeavyElem(); <br> e = new HeavyElem();</code> <br> <br>  Case 2: <br><br> <code>Elem e; <br> e = new HeavyElem(); <br> e = null; <br> e = new HeavyElem();</code> <br> <br>  The second case is more correct, since in most cases this will clearly indicate to the collector that the unused instance of the original HeavyElem is collected. <br><br><h5>  Class loaders </h5><br>  References to classes are used by their loaders and usually are not compiled by the GC until the classloader itself is compiled.  This will often occur, for example, in situations with the unloading of applications from the OSGi container.  It should also be remembered and take appropriate action. <br><br><h4>  How to avoid them? </h4><br>  And now for fixing a few tips on how to avoid problems with memory leaks: <br>  1. Use profilers.  The profiler helps to see which objects are located on the heap (and also to view them directly in instances), which will allow to catch leaks in the early stages. <br>  2. Be careful about using string operations, especially in cases when the program is working on processing a lot of text data. <br>  3. Always watch carefully if you need non-static inner classes, static variables. <br>  4. Clean up collections of objects after the data has been processed and do not need further use. <br><br>  Write a good code and do not forget about the rules for handling memory! </div><p>Source: <a href="https://habr.com/ru/post/132500/">https://habr.com/ru/post/132500/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132493/index.html">Universal NMEA 0183 Parser / Formatter on C # (+ port on JAVA)</a></li>
<li><a href="../132494/index.html">Using drivers in CodeIgniter</a></li>
<li><a href="../132495/index.html">Building ffmpeg on CentOS 6.0 x64 for Web video mp4, webm, ogv</a></li>
<li><a href="../132498/index.html">Fear has big eyes, or HDD cloning with MAC OS and Win XP in the classroom</a></li>
<li><a href="../132499/index.html">Russian translation of the official PHP documentation has become available again!</a></li>
<li><a href="../132501/index.html">Google Music may be officially opened next week.</a></li>
<li><a href="../132502/index.html">Tea Making Machine for Arduino</a></li>
<li><a href="../132504/index.html">Black Mirror Project: managing your phone with thought concentration</a></li>
<li><a href="../132507/index.html">Windows Phone - what to buy (today)</a></li>
<li><a href="../132508/index.html">ASUS Eee Slate Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>