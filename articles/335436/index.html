<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Autonomous way to bypass DPI and effective way to bypass site blocking by IP address</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Providers of the Russian Federation, for the most part, use the system of deep traffic analysis (DPI, Deep Packet Inspection) to block sites that are ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Autonomous way to bypass DPI and effective way to bypass site blocking by IP address</h1><div class="post__text post__text-html js-mediator-article">  Providers of the Russian Federation, for the most part, use the system of deep traffic analysis (DPI, Deep Packet Inspection) to block sites that are listed in the registry of prohibited.  There is no single standard on DPI, there is a large number of implementations from different suppliers of DPI solutions that differ in connection type and type of work. <br><br>  There are two common types of DPI connections: passive and active. <br><br><h2>  Passive DPI </h2>  Passive DPI - a DPI connected to the provider network in parallel (not in a section) either through a passive optical splitter or using traffic mirroring from users.  Such a connection does not slow down the speed of the provider‚Äôs network in case of insufficient DPI performance, which is why it is used by large providers.  A DPI with this type of connection can technically only detect an attempt to request prohibited content, but not suppress it.  To circumvent this restriction and block access to a banned site, the DPI sends the user who requests a blocked URL a specially crafted HTTP packet with redirection to the provider stub page, as if the response was sent by the requested resource itself (spoofing the sender's IP address and TCP sequence).  Due to the fact that DPI is physically located closer to the user than the requested site, the forged response reaches the user's device faster than the real response from the site. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Detect and block passive DPI packets </h3>  Fake packets generated by DPI can be easily detected by a traffic analyzer, for example, Wireshark. <br>  We try to enter the blocked site: <br><img src="https://habrastorage.org/getpro/habr/post_images/140/ae8/4e2/140ae84e2bc2c6965f2e896ef2cc5bb6.png" alt="Wireshark"><br><br>  We see that the packet comes first from DPI, with the HTTP redirect code 302, and then the real response from the site.  The response from the site is regarded as a retransmission and discarded by the operating system.  The browser follows the link specified in the DPI response, and we see the blocking page. <br><br>  Consider a package from DPI in more detail: <br><img src="https://habrastorage.org/getpro/habr/post_images/a59/be3/5db/a59be35dbd7c16dd386db5079d6beaea.png" alt="image"><br><br><pre><code>HTTP/1.1 302 Found
Connection: close
Location: http://warning.rt.ru/?id=17&amp;st=0&amp;dt=195.82.146.214&amp;rs=http%3A%2F%2Frutracker.org%2F</code></pre><br>
  DPI    ¬´Don't Fragment¬ª,    Identification  1.       ¬´Don't Fragment¬ª,       .           DPI,    ,      HTTP-  302,    iptables,  :<br>
<pre><code># iptables -A FORWARD -p tcp --sport 80 -m u32 --u32 "0x4=0x10000 &amp;&amp; 0x60=0x7761726e &amp;&amp; 0x64=0x696e672e &amp;&amp; 0x68=0x72742e72" -m comment --comment "Rostelecom HTTP" -j DROP</code></pre><br>
  ?  u32 iptables         4-   .   0x4  2-  Indentification,     1-  Flags  Fragment Offset.<br>
   0x60    (HTTP- Location).<br>
 Identification = 1, Flags = 0, Fragment Offset = 0, 0x60 = ¬´warn¬ª, 0x64 = ¬´ing.¬ª, 0x68 = ¬´rt.ru¬ª,   ,      .<br>
<br>
   HTTPS-, DPI  TCP Reset-,   Identification = 1  Flags = 0.<br>
<br>
<h2> DPI</h2> DPI ‚Äî DPI,      ,      .    ,  DPI       IP-  ,  DPI        .  DPI    ,    , ,    DPI      ,         .<br>
<br>
 DPI   ,       ,        ,      .<br>
<br>
<h3>  HTTP</h3> HTTP-      :<br>
<pre><code>GET / HTTP/1.1
Host: habrahabr.ru
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:49.0) Gecko/20100101 Firefox/50.0
Accept-Encoding: gzip, deflate, br
Connection: keep-alive</code></pre><br>
   HTTP-,    ,    ,    ,        CRLF.<br>
    ,     .<br>
<br>
      HTTP/1.1  2014 .  RFC 7230, HTTP-     ,         (    ).<br>
<pre><code>   Each header field consists of a case-insensitive field name followed
   by a colon (":"), optional leading whitespace, the field value, and
   optional trailing whitespace.

     header-field   = field-name ":" OWS field-value OWS

     field-name     = token
     field-value    = *( field-content / obs-fold )
     field-content  = field-vchar [ 1*( SP / HTAB ) field-vchar ]
     field-vchar    = VCHAR / obs-text

     obs-fold       = CRLF 1*( SP / HTAB )
                    ; obsolete line folding</code></pre><br>
OWS ‚Äî        , SP ‚Äî   , HTAB ‚Äî , CRLF ‚Äî      (\r\n).<br>
<br>
 ,      ,     -,  :<br>
<pre><code>GET / HTTP/1.1
hoSt:habrahabr.ru
user-agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:49.0) Gecko/20100101 Firefox/50.0
Accept-Encoding:           gzip, deflate, br
coNNecTion:	keep-alive      ‚Üê       </code></pre><br>
  ,  -       ,             ,   .<br>
<br>
 , RFC 2616,        -  ,           HTTP-     ,    :<br>
<blockquote>Clients SHOULD be tolerant in parsing the Status-Line and servers tolerant when parsing the Request-Line. In particular, they SHOULD accept any amount of SP or HT characters between fields, even though only a single SP is required.</blockquote>      -. -         .<br>
<br>
<h3>   TCP</h3> TCP   SYN-  SYN/ACK-.   ,   ,   TCP- (TCP Window Size) ‚Äî  ,       .     .     MTU 1500,     1460     TCP-.<br>
    TCP-  1460,       ,     .<br>
<br>
   TCP Window Size = 2  SYN/ACK- (         ),    HTTP-  :<br>
<br>
 1:<br>
<pre><code>GE</code></pre> 2:<pre><code>T / HTTP/1.1
Host: habrahabr.ru
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:49.0) Gecko/20100101 Firefox/50.0
Accept-Encoding: gzip, deflate, br
Connection: keep-alive</code></pre><br>
<br>
<h3>  HTTP  TCP    DPI</h3>  DPI      .<br>
      URI,    "<b>Host: </b>"   .    ¬´Host¬ª  ¬´hoSt¬ª     ,      .<br>
  DPI     . DPI     HTTP-    ,     TCP-   .   DPI  ¬´¬ª ,    TCP Window Size.<br>
<br>
  ,   DPI     ,     .  ,      DPI  ,      .        .<br>
<br>
<h3>   DPI</h3>     DPI  Windows: <a href="https://github.com/ValdikSS/GoodbyeDPI">GoodbyeDPI</a>.<br>
        DPI,  Host  hoSt,          Host, ¬´¬ª HTTP  HTTPS- ( TCP Window Size),      HTTP-  .<br>
     ,    :   ,   .<br>
<br>
   ,      ,     .    :<br>
<pre><code>goodbyedpi.exe -1 -a</code></pre>    , DPI    .<br>
     <code>-2</code>     HTTPS-.    ,   <code>-3</code>  <code>-4</code> ( ).<br>
 , ,   Yota,      HTTP,     .      <code>-3 -a</code><br>
<br>
<h2>      IP</h2>    IP-,       IP-  ,       .<br>
 <a href="https://reqrypt.org/reqrypt.html">ReQrypt</a>    -:        ReQrypt   ,  ReQrypt     <b>   IP-  </b>,     ,  ReQrypt.<br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/113/95c/b0b/11395cb0b075eea1b22804a9b669e8c6.png" alt="ReQrypt"><br>
<br>
     NAT,         ReQrypt     .   , ..   NAT      IP-.<br>
 ¬´¬ª NAT, ReQrypt     TCP-  ,   TTL = 3.     NAT- ,      .<br>
<br>
     - ,         .  IP-       DNS, NNTP   , -       .   -  ,     .  .<br>
<br>
<h2>  TL;DR</h2><a href="https://github.com/ValdikSS/GoodbyeDPI">GoodbyeDPI</a> ‚Äî   Windows,      DPI.     ,      .<br>
 Linux    ‚Äî <a href="https://github.com/bol-van/zapret">zapret</a>.<br>
<br>
   <a href="https://reqrypt.org/reqrypt.html">ReQrypt</a>,       IP-.<br>
<br>
      <a href="https://github.com/ValdikSS/blockcheck">Blockcheck</a>.    DPI  ,   ,    ¬´  DPI¬ª,  GoodbyeDPI  .  ,  ReQrypt.<br>
<br>
    <a href="https://rutracker.org/forum/viewtopic.php%3Ft%3D5403670"></a>  <a href="https://rutracker.org/forum/viewtopic.php%3Ft%3D5126394"></a>.</div><p>Source: <a href="https://habr.com/ru/post/335436/">https://habr.com/ru/post/335436/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335426/index.html">System prisoners</a></li>
<li><a href="../335428/index.html">Let's learn tcpdump with Julia Evans</a></li>
<li><a href="../335430/index.html">IT-school SAMSUNG on behalf of the student</a></li>
<li><a href="../335432/index.html">Timebug part 2: interesting solutions from EA Black Box</a></li>
<li><a href="../335434/index.html">Authentication in Node.js. Tutorials and possible mistakes</a></li>
<li><a href="../335438/index.html">Digest MBLTdev - fresh for iOS developers</a></li>
<li><a href="../335440/index.html">Backup mysql database and files to remote FTP - Python 3</a></li>
<li><a href="../335442/index.html">How to make websites more accessible for users with visual impairments</a></li>
<li><a href="../335444/index.html">We teach the robot to cook pizza. Part 1: Getting the Data</a></li>
<li><a href="../335446/index.html">How to set up teamwork and keep calm in the Telegram chat rooms, if everything is burning, and everything is in hell</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>