<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to stop being afraid and fall in love with mbed [Part 5]</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue a series of publications devoted to the use of the ARM mbed environment for creating a prototype measuring device. 

 Today I finally fini...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to stop being afraid and fall in love with mbed [Part 5]</h1><div class="post__text post__text-html js-mediator-article">  We continue a series of publications devoted to the use of the ARM mbed environment for creating a prototype measuring device. <br><br>  Today I finally finish the description of the program part - there are questions related to the output on the TFT-display of images and Cyrillic.  Let's make everything beautiful. <br><br><img src="https://habrastorage.org/files/085/1f9/418/0851f941893046448ac4b852289f49b4.png" height="300">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Content of the publication cycle: <br><ul><li>  <a href="https://habrahabr.ru/company/efo/blog/308440/">[Part 1] Overview of the used software and hardware solutions.</a> </li><li>  <a href="https://habrahabr.ru/company/efo/blog/309918/">[Part 2] Getting Started with the FT800 Graphics Controller.</a>  <a href="https://habrahabr.ru/company/efo/blog/309918/">Use of ready mbed-libraries for peripheral devices.</a> </li><li>  <a href="https://habrahabr.ru/company/efo/blog/310058/">[Part 3] Connecting the sensor HYT-271.</a>  <a href="https://habrahabr.ru/company/efo/blog/310058/">Create and publish in mbed your own library for peripherals.</a> </li><li>  <a href="https://habrahabr.ru/company/efo/blog/310720/">[Part 4] Application development: Program structure, working with a touch screen.</a> </li><li>  <b>[Part 5] Application development: Display images, Russification problems.</b> </li><li>  <a href="https://habrahabr.ru/company/efo/blog/312484/">[Part 6] Printing Body Parts</a> </li></ul><br><a name="habracut"></a><br>  Let me remind you that we are talking about the development of a prototype device with a touch screen, which serves for high-speed measurement of relative humidity and (at the same time) temperature.  For writing a program for the microcontroller, an online IDE mbed is used, which allows you to create iron-independent code that works equally well on debugging boards from SiLabs, Atmel, Wiznet, STM32, NXP and other manufacturers. <br><br><h1>  1. Display images on a TFT </h1><hr><br>  The general scheme for controlling a TFT display using an FTDI graphic controller has already been described in <a href="https://habrahabr.ru/company/efo/blog/309918/">previous</a> <a href="https://habrahabr.ru/company/efo/blog/308440/">articles</a> .  Like other drawing-related procedures, image output to a TFT display is hardware implemented on the FT801 graphics controller.  The controlling host controller is only required to transmit simple control commands and necessary data to the FT801. <br><br>  The FT8xx series graphics controllers allow you to work with .jpeg or .png images.  The image can not only be displayed on the screen, but also transformed - resized, rotated or moved around the screen, and also used as a screen saver.  All these operations are performed on the graphics controller by the arrival of the corresponding commands from the managing director MK. <br><br>  Speaking about loading images onto a graphics controller, you should immediately separate the two approaches to working with images. <br><br><img src="https://habrastorage.org/files/0bb/9ac/a8f/0bb9aca8f2934437abfff9052d46fa98.png" height="400"><br><br>  In the first case, the .jpeg file is taken from the memory of the managing director of the MC or from external media and is immediately recorded in the memory of the FT8xx graphics controller.  In this case, the CMD_LOADIMAGE command is used for loading.  After the image is loaded into the FT8xx memory, all functions for working with the image become available - image transformation and its display.  This approach is optimal if you have a place to store images, that is, using USB flash memory or an SD card. <br><br>  In the second case, the image is pre-compressed using the Deflate algorithm.  The bitmap obtained as a result of coding takes up much less space, so it can be stored not only on external media, but in the internal memory of the control MC.  The image is loaded onto the FT8xx graphics controller in a compressed form, and unpacking of data is already performed by the graphics controller.  To download a compressed image, use the CMD_INFLATE command.  After the image is unpacked, you can work with it in the same way as in the first case. <br><br>  Since my project does not assume the use of external memory, we will consider only the first case - working with compressed images stored in the memory of the control microcontroller.  As a result, I want to display three images: icons for temperature and relative humidity on the screen with the main menu and a photo of the HYT-271 sensor on the screen with a description of the sensor. <br><br><img src="https://habrastorage.org/files/6fe/7cf/0ec/6fe7cf0ec20647f5977127c91a17250d.png" height="300"><br><br><img src="https://habrastorage.org/files/992/c85/1fc/992c851fcf244e19bbf7c9a85737c42a.png" height="300"><br><br><h3>  1.1.  Image formatting, compression </h3><hr><br>  The Deflate algorithm was originally created for zip archives, but due to the absence of patents, it is successfully used for other purposes, including image compression.  Here, by the way, is <a href="https://habrahabr.ru/post/274825/">an excellent article</a> about Deflate and png. <br><br>  For image conversion, FTDI offers <a href="http://www.ftdichip.com/Support/Utilities.htm">several console utilities</a> , such as img_cvt.  Also available are graphical skins like <a href="http://www.ftdichip.com/Support/Utilities.htm">EVE Screen Editor</a> , which not only allow you to convert images, but also make life much easier when creating programs for a graphics controller.  In fact, EVE Screen Editor is a Riverdi TFT emulator. <br><br><img src="https://habrastorage.org/files/ec4/903/296/ec490329609645798c254eef5a3576b4.png"><br><br>  There is absolutely nothing unusual in the program interface - the future TFT screen is formed in the central window - a field to which you can drag the necessary images and other graphic elements. <br><br>  The FT801 controller used by me allows displaying images of nine formats on the TFT display: black and white L1, L4 and L8, as well as RGB332, ARGB2, ARGB4, RGB565, PALETTED and ARGB1555, you can read more about them in the manufacturer <a href="http://www.ftdichip.com/Support/Documents/AppNotes/AN_303%2520FT800%2520Image%2520File%2520Conversion.pdf">'s documentation</a> .  Different formats allow you to get a different ratio of image quality and size of the image file encoding a binary file. <br><br><img src="https://habrastorage.org/files/55b/837/102/55b837102b3c4e0b9bd24429c30bdbae.png"><br>  <i>(in the figure from left to right L1, L4, L8, RGB332, ARGB2, ARGB4, RGB565, PALETTED, ARGB1555)</i> <br><br>  In theory, the best quality can be obtained using the ARGB1555 format, but in practice it is better to try different options and choose the most suitable one.  The photo of the sensor really looks best after conversion to ARGB1555 or RGB565, but at some point I did not have enough internal memory MK and I had to abandon these formats in favor of RGB332.  It looks more or less decent, and takes 1865 bytes instead of 7067 and 7816 from ARGB1555 and RGB565, respectively. <br><br>  The icons turned out more interesting.  Source files are .png with a transparent background of 37x77 and 53x67 pixels.  The transparency of the icons can be saved only with ARGB encoding, i.e.  we have to choose from the formats ARGB2, ARGB4, and ARGB1555.  Of these, the most attractive smoothed image does not provide ARGB2, and, to my surprise, not ARGB1555, but ARGB4. <br><br><img src="https://habrastorage.org/files/f3b/b42/b2e/f3bb42b2e6964cac8bacb9364836b7ba.png"><br>  <i>(in the picture from left to right ARGB2, ARGB4, ARGB1555)</i> <br><br>  After selecting the appropriate format, you need to save the project in the Screen Editor.  In the folder where the Screen Editor has been installed, the images directory will appear, where for each of the used images a .binh file is created.  He then we need. <br><br><h3>  1.2.  Image upload to graphic controller memory </h3><hr><br>  Having received a binary representation of the image, we return from the Screen Editor to the mbed IDE, where in the program code we save all the received bitmap as arrays.  An icon for humidity, for example, looks like this. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> hum_icon[]={ <span class="hljs-number"><span class="hljs-number">120</span></span>,<span class="hljs-number"><span class="hljs-number">156</span></span>,<span class="hljs-number"><span class="hljs-number">165</span></span>,<span class="hljs-number"><span class="hljs-number">86</span></span>,<span class="hljs-number"><span class="hljs-number">203</span></span>,<span class="hljs-number"><span class="hljs-number">109</span></span>,<span class="hljs-number"><span class="hljs-number">195</span></span>,<span class="hljs-number"><span class="hljs-number">48</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">205</span></span>,<span class="hljs-number"><span class="hljs-number">177</span></span>,<span class="hljs-number"><span class="hljs-number">40</span></span>,<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">25</span></span>,<span class="hljs-number"><span class="hljs-number">193</span></span>,<span class="hljs-number"><span class="hljs-number">35</span></span>,<span class="hljs-number"><span class="hljs-number">120</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">141</span></span>,<span class="hljs-number"><span class="hljs-number">160</span></span>,<span class="hljs-number"><span class="hljs-number">17</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">130</span></span>,<span class="hljs-number"><span class="hljs-number">71</span></span>,<span class="hljs-number"><span class="hljs-number">200</span></span>,<span class="hljs-number"><span class="hljs-number">181</span></span>,<span class="hljs-number"><span class="hljs-number">55</span></span>,<span class="hljs-number"><span class="hljs-number">143</span></span>,<span class="hljs-number"><span class="hljs-number">224</span></span>,<span class="hljs-number"><span class="hljs-number">123</span></span>,<span class="hljs-number"><span class="hljs-number">46</span></span>,<span class="hljs-number"><span class="hljs-number">26</span></span>,<span class="hljs-number"><span class="hljs-number">193</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">208</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">133</span></span>,<span class="hljs-number"><span class="hljs-number">54</span></span>,<span class="hljs-number"><span class="hljs-number">168</span></span>,<span class="hljs-number"><span class="hljs-number">71</span></span>,<span class="hljs-number"><span class="hljs-number">96</span></span>,<span class="hljs-number"><span class="hljs-number">31</span></span>,<span class="hljs-number"><span class="hljs-number">165</span></span>,<span class="hljs-number"><span class="hljs-number">248</span></span>,<span class="hljs-number"><span class="hljs-number">43</span></span>,<span class="hljs-number"><span class="hljs-number">74</span></span>,<span class="hljs-number"><span class="hljs-number">145</span></span>,<span class="hljs-number"><span class="hljs-number">82</span></span>,<span class="hljs-number"><span class="hljs-number">18</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">138</span></span>,<span class="hljs-number"><span class="hljs-number">79</span></span>,<span class="hljs-number"><span class="hljs-number">228</span></span>,<span class="hljs-number"><span class="hljs-number">35</span></span>,<span class="hljs-number"><span class="hljs-number">41</span></span>,<span class="hljs-number"><span class="hljs-number">193</span></span>,<span class="hljs-number"><span class="hljs-number">244</span></span>,<span class="hljs-number"><span class="hljs-number">73</span></span>,<span class="hljs-number"><span class="hljs-number">117</span></span>,<span class="hljs-number"><span class="hljs-number">218</span></span>,<span class="hljs-number"><span class="hljs-number">86</span></span>,<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">175</span></span>,<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">251</span></span>,<span class="hljs-number"><span class="hljs-number">65</span></span>,<span class="hljs-number"><span class="hljs-number">243</span></span>,<span class="hljs-number"><span class="hljs-number">115</span></span>,<span class="hljs-number"><span class="hljs-number">200</span></span>,<span class="hljs-number"><span class="hljs-number">203</span></span>,<span class="hljs-number"><span class="hljs-number">133</span></span>,<span class="hljs-number"><span class="hljs-number">88</span></span>,<span class="hljs-number"><span class="hljs-number">236</span></span>,<span class="hljs-number"><span class="hljs-number">83</span></span>,<span class="hljs-number"><span class="hljs-number">232</span></span>,<span class="hljs-number"><span class="hljs-number">153</span></span>,<span class="hljs-number"><span class="hljs-number">130</span></span>,<span class="hljs-number"><span class="hljs-number">92</span></span>,<span class="hljs-number"><span class="hljs-number">171</span></span>,<span class="hljs-number"><span class="hljs-number">145</span></span>,<span class="hljs-number"><span class="hljs-number">29</span></span>,<span class="hljs-number"><span class="hljs-number">109</span></span>,<span class="hljs-number"><span class="hljs-number">82</span></span>,<span class="hljs-number"><span class="hljs-number">135</span></span>,<span class="hljs-number"><span class="hljs-number">108</span></span>,<span class="hljs-number"><span class="hljs-number">214</span></span>,<span class="hljs-number"><span class="hljs-number">168</span></span>,<span class="hljs-number"><span class="hljs-number">44</span></span>,<span class="hljs-number"><span class="hljs-number">117</span></span>,<span class="hljs-number"><span class="hljs-number">172</span></span>,<span class="hljs-number"><span class="hljs-number">29</span></span>,<span class="hljs-number"><span class="hljs-number">209</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">59</span></span>,<span class="hljs-number"><span class="hljs-number">22</span></span>,<span class="hljs-number"><span class="hljs-number">35</span></span>,<span class="hljs-number"><span class="hljs-number">21</span></span>,<span class="hljs-number"><span class="hljs-number">197</span></span>,<span class="hljs-number"><span class="hljs-number">82</span></span>,<span class="hljs-number"><span class="hljs-number">91</span></span>,<span class="hljs-number"><span class="hljs-number">165</span></span>,<span class="hljs-number"><span class="hljs-number">125</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">121</span></span>,<span class="hljs-number"><span class="hljs-number">254</span></span>,<span class="hljs-number"><span class="hljs-number">188</span></span>,<span class="hljs-number"><span class="hljs-number">147</span></span>,<span class="hljs-number"><span class="hljs-number">33</span></span>,<span class="hljs-number"><span class="hljs-number">131</span></span>,<span class="hljs-number"><span class="hljs-number">94</span></span>,<span class="hljs-number"><span class="hljs-number">110</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">17</span></span>,<span class="hljs-number"><span class="hljs-number">177</span></span>,<span class="hljs-number"><span class="hljs-number">52</span></span>,<span class="hljs-number"><span class="hljs-number">248</span></span>,<span class="hljs-number"><span class="hljs-number">189</span></span>,<span class="hljs-number"><span class="hljs-number">149</span></span>,<span class="hljs-number"><span class="hljs-number">209</span></span>,<span class="hljs-number"><span class="hljs-number">247</span></span>,<span class="hljs-number"><span class="hljs-number">155</span></span>,<span class="hljs-number"><span class="hljs-number">136</span></span>,<span class="hljs-number"><span class="hljs-number">85</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">82</span></span>,<span class="hljs-number"><span class="hljs-number">195</span></span>,<span class="hljs-number"><span class="hljs-number">238</span></span>,<span class="hljs-number"><span class="hljs-number">124</span></span>,<span class="hljs-number"><span class="hljs-number">109</span></span>,<span class="hljs-number"><span class="hljs-number">186</span></span>,<span class="hljs-number"><span class="hljs-number">213</span></span>,<span class="hljs-number"><span class="hljs-number">102</span></span>,<span class="hljs-number"><span class="hljs-number">132</span></span>,<span class="hljs-number"><span class="hljs-number">156</span></span>,<span class="hljs-number"><span class="hljs-number">83</span></span>,<span class="hljs-number"><span class="hljs-number">189</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">152</span></span>,<span class="hljs-number"><span class="hljs-number">91</span></span>,<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">111</span></span>,<span class="hljs-number"><span class="hljs-number">130</span></span>,<span class="hljs-number"><span class="hljs-number">213</span></span>,<span class="hljs-number"><span class="hljs-number">207</span></span>,<span class="hljs-number"><span class="hljs-number">226</span></span>,<span class="hljs-number"><span class="hljs-number">94</span></span>,<span class="hljs-number"><span class="hljs-number">92</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">93</span></span>,<span class="hljs-number"><span class="hljs-number">152</span></span>,<span class="hljs-number"><span class="hljs-number">186</span></span>,<span class="hljs-number"><span class="hljs-number">137</span></span>,<span class="hljs-number"><span class="hljs-number">150</span></span>,<span class="hljs-number"><span class="hljs-number">185</span></span>,<span class="hljs-number"><span class="hljs-number">185</span></span>,<span class="hljs-number"><span class="hljs-number">98</span></span>,<span class="hljs-number"><span class="hljs-number">53</span></span>,<span class="hljs-number"><span class="hljs-number">193</span></span>,<span class="hljs-number"><span class="hljs-number">178</span></span>,<span class="hljs-number"><span class="hljs-number">229</span></span>,<span class="hljs-number"><span class="hljs-number">51</span></span>,<span class="hljs-number"><span class="hljs-number">223</span></span>,<span class="hljs-number"><span class="hljs-number">53</span></span>,<span class="hljs-number"><span class="hljs-number">194</span></span>,<span class="hljs-number"><span class="hljs-number">121</span></span>,<span class="hljs-number"><span class="hljs-number">237</span></span>,<span class="hljs-number"><span class="hljs-number">217</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">235</span></span>,<span class="hljs-number"><span class="hljs-number">133</span></span>,<span class="hljs-number"><span class="hljs-number">215</span></span>,<span class="hljs-number"><span class="hljs-number">248</span></span>,<span class="hljs-number"><span class="hljs-number">229</span></span>,<span class="hljs-number"><span class="hljs-number">115</span></span>,<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">195</span></span>,<span class="hljs-number"><span class="hljs-number">126</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">109</span></span>,<span class="hljs-number"><span class="hljs-number">68</span></span>,<span class="hljs-number"><span class="hljs-number">228</span></span>,<span class="hljs-number"><span class="hljs-number">33</span></span>,<span class="hljs-number"><span class="hljs-number">79</span></span>,<span class="hljs-number"><span class="hljs-number">159</span></span>,<span class="hljs-number"><span class="hljs-number">63</span></span>,<span class="hljs-number"><span class="hljs-number">75</span></span>,<span class="hljs-number"><span class="hljs-number">251</span></span>,<span class="hljs-number"><span class="hljs-number">184</span></span>,<span class="hljs-number"><span class="hljs-number">135</span></span>,<span class="hljs-number"><span class="hljs-number">224</span></span>,<span class="hljs-number"><span class="hljs-number">228</span></span>,<span class="hljs-number"><span class="hljs-number">162</span></span>,<span class="hljs-number"><span class="hljs-number">202</span></span>,<span class="hljs-number"><span class="hljs-number">247</span></span>,<span class="hljs-number"><span class="hljs-number">167</span></span>,<span class="hljs-number"><span class="hljs-number">188</span></span>,<span class="hljs-number"><span class="hljs-number">83</span></span>,<span class="hljs-number"><span class="hljs-number">58</span></span>,<span class="hljs-number"><span class="hljs-number">238</span></span>,<span class="hljs-number"><span class="hljs-number">251</span></span>,<span class="hljs-number"><span class="hljs-number">178</span></span>,<span class="hljs-number"><span class="hljs-number">106</span></span>,<span class="hljs-number"><span class="hljs-number">156</span></span>,<span class="hljs-number"><span class="hljs-number">119</span></span>,<span class="hljs-number"><span class="hljs-number">162</span></span>,<span class="hljs-number"><span class="hljs-number">51</span></span>,<span class="hljs-number"><span class="hljs-number">219</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">36</span></span>,<span class="hljs-number"><span class="hljs-number">121</span></span>,<span class="hljs-number"><span class="hljs-number">164</span></span>,<span class="hljs-number"><span class="hljs-number">59</span></span>,<span class="hljs-number"><span class="hljs-number">35</span></span>,<span class="hljs-number"><span class="hljs-number">237</span></span>,<span class="hljs-number"><span class="hljs-number">113</span></span>,<span class="hljs-number"><span class="hljs-number">189</span></span>,<span class="hljs-number"><span class="hljs-number">77</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">107</span></span>,<span class="hljs-number"><span class="hljs-number">40</span></span>,<span class="hljs-number"><span class="hljs-number">121</span></span>,<span class="hljs-number"><span class="hljs-number">163</span></span>,<span class="hljs-number"><span class="hljs-number">49</span></span>,<span class="hljs-number"><span class="hljs-number">85</span></span>,<span class="hljs-number"><span class="hljs-number">46</span></span>,<span class="hljs-number"><span class="hljs-number">121</span></span>,<span class="hljs-number"><span class="hljs-number">110</span></span>,<span class="hljs-number"><span class="hljs-number">200</span></span>,<span class="hljs-number"><span class="hljs-number">215</span></span>,<span class="hljs-number"><span class="hljs-number">194</span></span>,<span class="hljs-number"><span class="hljs-number">39</span></span>,<span class="hljs-number"><span class="hljs-number">199</span></span>,<span class="hljs-number"><span class="hljs-number">199</span></span>,<span class="hljs-number"><span class="hljs-number">74</span></span>,<span class="hljs-number"><span class="hljs-number">59</span></span>,<span class="hljs-number"><span class="hljs-number">152</span></span>,<span class="hljs-number"><span class="hljs-number">116</span></span>,<span class="hljs-number"><span class="hljs-number">247</span></span>,<span class="hljs-number"><span class="hljs-number">176</span></span>,<span class="hljs-number"><span class="hljs-number">19</span></span>,<span class="hljs-number"><span class="hljs-number">83</span></span>,<span class="hljs-number"><span class="hljs-number">34</span></span>,<span class="hljs-number"><span class="hljs-number">242</span></span>,<span class="hljs-number"><span class="hljs-number">85</span></span>,<span class="hljs-number"><span class="hljs-number">172</span></span>,<span class="hljs-number"><span class="hljs-number">111</span></span>,<span class="hljs-number"><span class="hljs-number">28</span></span>,<span class="hljs-number"><span class="hljs-number">57</span></span>,<span class="hljs-number"><span class="hljs-number">226</span></span>,<span class="hljs-number"><span class="hljs-number">140</span></span>,<span class="hljs-number"><span class="hljs-number">76</span></span>,<span class="hljs-number"><span class="hljs-number">185</span></span>,<span class="hljs-number"><span class="hljs-number">74</span></span>,<span class="hljs-number"><span class="hljs-number">185</span></span>,<span class="hljs-number"><span class="hljs-number">58</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">117</span></span>,<span class="hljs-number"><span class="hljs-number">130</span></span>,<span class="hljs-number"><span class="hljs-number">151</span></span>,<span class="hljs-number"><span class="hljs-number">46</span></span>,<span class="hljs-number"><span class="hljs-number">136</span></span>,<span class="hljs-number"><span class="hljs-number">186</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">215</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">54</span></span>,<span class="hljs-number"><span class="hljs-number">93</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">85</span></span>,<span class="hljs-number"><span class="hljs-number">240</span></span>,<span class="hljs-number"><span class="hljs-number">27</span></span>,<span class="hljs-number"><span class="hljs-number">78</span></span>,<span class="hljs-number"><span class="hljs-number">182</span></span>,<span class="hljs-number"><span class="hljs-number">49</span></span>,<span class="hljs-number"><span class="hljs-number">83</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">189</span></span>,<span class="hljs-number"><span class="hljs-number">54</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">227</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">96</span></span>,<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-number"><span class="hljs-number">146</span></span>,<span class="hljs-number"><span class="hljs-number">106</span></span>,<span class="hljs-number"><span class="hljs-number">33</span></span>,<span class="hljs-number"><span class="hljs-number">103</span></span>,<span class="hljs-number"><span class="hljs-number">85</span></span>,<span class="hljs-number"><span class="hljs-number">88</span></span>,<span class="hljs-number"><span class="hljs-number">171</span></span>,<span class="hljs-number"><span class="hljs-number">49</span></span>,<span class="hljs-number"><span class="hljs-number">142</span></span>,<span class="hljs-number"><span class="hljs-number">113</span></span>,<span class="hljs-number"><span class="hljs-number">123</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">234</span></span>,<span class="hljs-number"><span class="hljs-number">145</span></span>,<span class="hljs-number"><span class="hljs-number">191</span></span>,<span class="hljs-number"><span class="hljs-number">17</span></span>,<span class="hljs-number"><span class="hljs-number">194</span></span>,<span class="hljs-number"><span class="hljs-number">228</span></span>,<span class="hljs-number"><span class="hljs-number">249</span></span>,<span class="hljs-number"><span class="hljs-number">59</span></span>,<span class="hljs-number"><span class="hljs-number">138</span></span>,<span class="hljs-number"><span class="hljs-number">233</span></span>,<span class="hljs-number"><span class="hljs-number">74</span></span>,<span class="hljs-number"><span class="hljs-number">34</span></span>,<span class="hljs-number"><span class="hljs-number">113</span></span>,<span class="hljs-number"><span class="hljs-number">187</span></span>,<span class="hljs-number"><span class="hljs-number">172</span></span>,<span class="hljs-number"><span class="hljs-number">204</span></span>,<span class="hljs-number"><span class="hljs-number">236</span></span>,<span class="hljs-number"><span class="hljs-number">254</span></span>,<span class="hljs-number"><span class="hljs-number">182</span></span>,<span class="hljs-number"><span class="hljs-number">76</span></span>,<span class="hljs-number"><span class="hljs-number">194</span></span>,<span class="hljs-number"><span class="hljs-number">253</span></span>,<span class="hljs-number"><span class="hljs-number">91</span></span>,<span class="hljs-number"><span class="hljs-number">170</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">211</span></span>,<span class="hljs-number"><span class="hljs-number">188</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">154</span></span>,<span class="hljs-number"><span class="hljs-number">252</span></span>,<span class="hljs-number"><span class="hljs-number">219</span></span>,<span class="hljs-number"><span class="hljs-number">167</span></span>,<span class="hljs-number"><span class="hljs-number">197</span></span>,<span class="hljs-number"><span class="hljs-number">26</span></span>,<span class="hljs-number"><span class="hljs-number">49</span></span>,<span class="hljs-number"><span class="hljs-number">39</span></span>,<span class="hljs-number"><span class="hljs-number">147</span></span>,<span class="hljs-number"><span class="hljs-number">190</span></span>,<span class="hljs-number"><span class="hljs-number">41</span></span>,<span class="hljs-number"><span class="hljs-number">216</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">239</span></span>,<span class="hljs-number"><span class="hljs-number">185</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">131</span></span>,<span class="hljs-number"><span class="hljs-number">150</span></span>,<span class="hljs-number"><span class="hljs-number">253</span></span>,<span class="hljs-number"><span class="hljs-number">192</span></span>,<span class="hljs-number"><span class="hljs-number">65</span></span>,<span class="hljs-number"><span class="hljs-number">161</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">206</span></span>,<span class="hljs-number"><span class="hljs-number">91</span></span>,<span class="hljs-number"><span class="hljs-number">135</span></span>,<span class="hljs-number"><span class="hljs-number">240</span></span>,<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">101</span></span>,<span class="hljs-number"><span class="hljs-number">84</span></span>,<span class="hljs-number"><span class="hljs-number">249</span></span>,<span class="hljs-number"><span class="hljs-number">232</span></span>,<span class="hljs-number"><span class="hljs-number">103</span></span>,<span class="hljs-number"><span class="hljs-number">49</span></span>,<span class="hljs-number"><span class="hljs-number">197</span></span>,<span class="hljs-number"><span class="hljs-number">95</span></span>,<span class="hljs-number"><span class="hljs-number">24</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>,<span class="hljs-number"><span class="hljs-number">226</span></span>,<span class="hljs-number"><span class="hljs-number">26</span></span>,<span class="hljs-number"><span class="hljs-number">68</span></span>,<span class="hljs-number"><span class="hljs-number">183</span></span>,<span class="hljs-number"><span class="hljs-number">56</span></span>,<span class="hljs-number"><span class="hljs-number">103</span></span>,<span class="hljs-number"><span class="hljs-number">196</span></span>,<span class="hljs-number"><span class="hljs-number">58</span></span>,<span class="hljs-number"><span class="hljs-number">91</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">63</span></span>,<span class="hljs-number"><span class="hljs-number">65</span></span>,<span class="hljs-number"><span class="hljs-number">221</span></span>,<span class="hljs-number"><span class="hljs-number">118</span></span>,<span class="hljs-number"><span class="hljs-number">198</span></span>, };</code> </pre> <br><br>  To load this image into the memory of the graphic controller FT801, you will need to send three commands from the managing director of the MC: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> IMAGE_ADDR_HUMIDITY 29696 ... (*_TFT).WrCmd32(CMD_INFLATE); (*_TFT).WrCmd32(IMAGE_ADDR_HUMIDITY); (*_TFT).WrCmdBufFromFlash(hum_icon, sizeof(hum_icon));</span></span></code> </pre><br>  CMD_INFLATE is a command informing FT801 that a compressed image will be written to its memory. <br>  IMAGE_ADDR_HUMIDITY - the starting address in the memory of the graphics controller RAM_G, which will be available image. <br>  hum_icon is an array storing an image. <br><br>  After such an operation, the ‚ÄúHumidity‚Äù icon will be available for display on the screen until the graphics controller memory is cleared programmatically or as a result of a reset. <br><br><h3>  1.3.  Image capture </h3><hr><br>  The next step after loading is to ‚Äúcapture‚Äù the image. <br><br><pre> <code class="cpp hljs">StartDL(); ... (*_TFT).DL(BITMAP_HANDLE(<span class="hljs-number"><span class="hljs-number">0</span></span>)); (*_TFT).DL(BITMAP_SOURCE(IMAGE_ADDR_HUMIDITY)); (*_TFT).DL(BITMAP_LAYOUT(ARGB4, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>)); (*_TFT).DL(BITMAP_SIZE(NEAREST, BORDER, BORDER, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>)); ... FinishDL();</code> </pre><br>  Using the BITMAP_HANDLE command, we assign to each image (a Bitmap object) a pointer ‚Äî a number from 0 to 31, which can be used to access the image in the future. <br>  The BITMAP_SOURCE command points to the address in the RAM_G memory of the FT8xx graphics controller (see p. Image Loading). <br>  The BITMAP_LAYOUT command tells the graphics controller the format of the image and its dimensions, and the BITMAP_SIZE command determines the size of the displayed image.  By changing its arguments, you can, for example, crop a picture to the right or left. <br><br>  Capturing an image, as well as loading it into the memory of the graphics controller, is enough to run once after initializing the FT8xx.  However, it is important to understand that image capture commands, unlike loading commands, are the so-called display list commands, that is, they can be used only after the start of the display list command and before the end of the display list command. <br>  <i>* The fact that such a display list and what it eats, you can read in the <a href="https://habrahabr.ru/company/efo/blog/30991%2520%25208/">second article of this cycle</a> .</i> <br><br><h3>  1.4.  Image output </h3><hr><br>  After the image has been loaded and captured, it can be displayed on a TFT display.  To do this, use the BITMAP group commands, for example, to display the ‚ÄúHumidity‚Äù icon on top of one of the main menu buttons, I execute three commands: <br><br><pre> <code class="cpp hljs">StartDL(); ... <span class="hljs-comment"><span class="hljs-comment">//   () ... (*_TFT).DL(BEGIN(BITMAPS)); (*_TFT).DL(VERTEX2II(12 + 255, 62 + 10, 0, 0)); (*_TFT).DL(END()); ... FinishDL();</span></span></code> </pre><br>  The first two arguments of the VERTEX2II command specify the coordinates for display on the screen, and the third argument is a pointer to the ‚ÄúHumidity‚Äù icon, which was specified in BITMAP_SOURCE and BITMAP_HANDLE - ‚Äú0‚Äù. <br><br><div class="spoiler">  <b class="spoiler_title">The output of the Temperature icon and sensor photos are performed in exactly the same</b> <div class="spoiler_text"><pre> <code class="cpp hljs">StartDL(); ... (*_TFT).DL(BEGIN(BITMAPS)); (*_TFT).DL(VERTEX2II(<span class="hljs-number"><span class="hljs-number">12</span></span> + <span class="hljs-number"><span class="hljs-number">260</span></span>, <span class="hljs-number"><span class="hljs-number">62</span></span> + <span class="hljs-number"><span class="hljs-number">93</span></span> + <span class="hljs-number"><span class="hljs-number">12</span></span> + <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); (*_TFT).DL(END()); ... FinishDL();</code> </pre><br><pre> <code class="cpp hljs">StartDL(); ... (*_TFT).DL(BEGIN(BITMAPS)); (*_TFT).DL(VERTEX2II(<span class="hljs-number"><span class="hljs-number">360</span></span>, <span class="hljs-number"><span class="hljs-number">140</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); (*_TFT).DL(END()); ... FinishDL();</code> </pre><br></div></div><br>  A link to the complete project source code is provided below. <br><br><h1>  Using custom fonts </h1><hr><br>  The <a href="https://habrahabr.ru/company/efo/blog/309918">article</a> on getting started with the FT8xx series graphic controller mentioned the support for standard widgets - procedures for outputting relatively complex graphic objects that are hardware implemented on FTDI graphics controllers.  Among the widgets there is a text line, in the mbed-library FT800_2, the Text () function corresponds to the display of a line. <br><br><pre> <code class="cpp hljs"> (*_TFT).Text(<span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">67</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"Current humidity (rH)"</span></span>);</code> </pre><br>  The arguments to the function are the coordinates of the first character of the line (22, 67), the number of the font used (27), additional options (0) and, in fact, a text line.  With coordinates everything is clear, additional options also apply only to the position of the line on the screen, so let's talk about fonts. <br><br>  The number of the font used is a number from 0 to 31, with the numbers from 0 to 15 reserved for user fonts, and the numbers from 16 to 31 correspond to the sixteen built-in fonts.  If in your application it is enough to display only the first 128 ASCII characters and the standard outline of these characters is enough for you, then you can stop at this place and not read the article further - just use fonts with numbers 16-31. <br><br><img src="https://habrastorage.org/files/449/051/eed/449051eedc1b48b58060b8d9b5fb3aa9.gif" height="70"><br><br>  If you need non-standard outlines of numbers and Latin characters or require the output of characters that go beyond the standard ASCII set (for example, Cyrillic), then you will have to deal with loading your own fonts. <br><br>  For FT8xx graphics controllers, user fonts are almost the same bitmap as images, so creating a new font in many ways repeats the process of displaying images. <br><br><h3>  2.1.  Font formatting, compression </h3><hr><br>  At the first stage, you need to download or create the necessary font (the .ttf format is fine) and get a binary file for downloading to the FT8xxx graphics controller.  To do this, you can use either a <a href="http://www.ftdichip.com/Support/Utilities.htm">console utility</a> or the same EVE Screen Editor. <br><br><img src="https://habrastorage.org/files/5f7/76a/bff/5f776abff63f4aa9925fc075b4af053e"><br><br>  In the Screen Editor, the font is imported in the same way as image files ‚Äî a font file is added to the Content window, and its compression parameters are set in the Properties window: format, size, and charset. <br><br>  The format is selected from three options - L1, L4 and L8.  The difference, as in the conversion of images, in the ratio of the quality of drawing and the size of the binary file.  The font size simply determines the width of characters in pixels, and the charset field deserves the most attention. <br><br>  For FTDI graphics controllers, the default fonts are 128 ASCII characters. <br><br><pre> <code class="hljs sql"> !"<span class="hljs-comment"><span class="hljs-comment">#$%&amp;'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~ //    ,   32- </span></span></code> </pre><br>  If you use only these characters and add a new font just to change their style - great, convert the font without changing the charset.  And if you need to add Cyrillic or some other non-ASCII character, you will have to replace the charset.  In my application, you will need all Cyrillic, numbers, some punctuation marks and mathematical symbols, degrees and percentages, as well as several Latin letters.  As a result, the modified charset looks like this: <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">0123456789</span></span>.,:-¬∞¬±%&lt;&gt;rHYTICS <span class="hljs-comment"><span class="hljs-comment">//    ,   32- </span></span></code> </pre><br>  Now, just like when working with an image, save the Screen Editor project, go to the folder where EVE Screen Editor is installed and find the binary .binh file in the / fonts directory. <br><br><h3>  2.2.  Download to the graphics controller memory </h3><hr><br>  Downloading a new font repeats the process of loading an image - we save the binary representation of the font as an array and load it on FT8xx at the predefined starting address in the memory of the graphics controller using the CMD_INFLATE command. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> FONT_ADDR_ROBOTO_REGULAR_30 16992 ... (*_TFT).WrCmd32(CMD_INFLATE); (*_TFT).WrCmd32(FONT_SET_ROBOTO_REGULAR_30); (*_TFT).WrCmdBufFromFlash(font_RobotoRegular30, sizeof(font_RobotoRegular30));</span></span></code> </pre><br><br><h3>  2.3.  Capture and install font </h3><hr><br>  The ‚Äúcapture‚Äù of the user font is performed by the same commands as the image capture, the difference is that after the BITMAP_HANDLE, BITMAP_SOURCE, BITMAP_LAYOUT and BITMAP_SIZE commands, you need to set a new font via the SetFont () call. <br><br><pre> <code class="cpp hljs"> (*_TFT).DL(BITMAP_HANDLE(<span class="hljs-number"><span class="hljs-number">3</span></span>)); (*_TFT).DL(BITMAP_SOURCE(FONT_ADDR_ROBOTO_REGULAR_30)); (*_TFT).DL(BITMAP_LAYOUT(L4, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">33</span></span>)); (*_TFT).DL(BITMAP_SIZE(NEAREST, BORDER, BORDER, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">33</span></span>)); (*_TFT).SetFont(<span class="hljs-number"><span class="hljs-number">3</span></span>, FONT_SET_ROBOTO_REGULAR_30);</code> </pre><br><h3>  2.4.  Use font </h3><hr><br>  Now, among the custom fonts, at number 3 is the Roboto Regular font that we downloaded.  If during the conversion the charset of this font was not changed, then to change the embedded font number 27 to Roboto Regular, you would only need to change <br><br><pre> <code class="cpp hljs"> (*_TFT).Text(<span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">67</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"Current humidity (rH)"</span></span>);</code> </pre><br>  on <br><br><pre> <code class="cpp hljs"> (*_TFT).Text(<span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">67</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"Current humidity (rH)"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    </span></span></code> </pre><br>  However, we are going to display characters that are not standard for the FT8xx controller, so instead of explicitly specifying the line (‚ÄúCurrent humidity (rH)‚Äù), we will have to sculpt this line from individual characters each time. <br><br>  Consider the line "Relative Humidity".  The task is to assign to each character of this line its number in the charset. <br><br>  If the compiler supports Cyrillic, then each character starting with uppercase letters <b>ABC</b> and ending with lowercase <b>letters</b> (with omission of letters <b></b> and <b></b> ) will correspond to a value from 0xC0 to 0xFF.  So in order to match the characters of the string with the numbers of these characters in the charset, you need to subtract a fixed value from the code of each character.  For example, if the letter <b>A</b> in the charlist occupies the 32nd position (0x20), and the letters following <b>A</b> are in the same order as in table CP1251, then the value of each character of the string ‚ÄúRelative humidity‚Äù (except the space) will be subtracted 0xA0. <br><br><div class="spoiler">  <b class="spoiler_title">Cyrillic encoding CP1251</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/223/073/07a/22307307aff96a9e7c39f50f6e5cb5cd.gif" alt="image"><br></div></div><br>  However, the compiler may not support Cyrillic, mbed-ovsky just does not support.  This means that the compiler does not perceive the Cyrillic alphabet as codes from 0xC0 to 0xFF, so I have no choice but to use Unicode, more precisely, UTF-8. <br><br>  Each character not included in the main ASCII table ‚Äî Cyrillic, ¬∞ and ¬± signs ‚Äî is represented as a two-byte UTF-8 code.  I take the code of each character and assign it to the corresponding number in my charset. <br><br>  For Latin letters that are also in the charlist, you also need to replace Unicode with a number in the charset, the only difference is that the code of Latin letters and other ASCII characters such as a period, comma and percentage consists of one, not two bytes. <br><table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td>  <b>Convertible string character</b> </td><td>  <b>UTF-8 code</b> </td><td>  <b>Order number in my charset</b> </td></tr><tr><td>  <b>ABC ... np</b> </td><td>  0xD090 ... 0xD0BF </td><td>  43 ... 90 </td></tr><tr><td>  <b>rst ... eyyu</b> </td><td>  0xD180 ... 0xD18F </td><td>  91 ... 96 </td></tr><tr><td>  <b>¬∞</b> </td><td>  0xC2B0 </td><td>  112 </td></tr><tr><td>  <b>¬±</b> </td><td>  0xC2B1 </td><td>  113 </td></tr><tr><td>  space </td><td>  0x20 </td><td>  32 </td></tr><tr><td>  <b>0 ... 9</b> </td><td>  0x30 ... 0x39 </td><td>  33 ... 43 </td></tr><tr><td>  <b>.</b> </td><td>  0x2E </td><td>  108 </td></tr><tr><td>  <b>,</b> </td><td>  0x2C </td><td>  109 </td></tr><tr><td>  <b>:</b> </td><td>  0x3A </td><td>  110 </td></tr><tr><td colspan="3">  and so on </td></tr></tbody></table><br>  To perform such a string conversion, a corresponding function has been created. <br><br><div class="spoiler">  <b class="spoiler_title">CreateStringRussian string conversion function</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Display::CreateStringRussian(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> rustext) { <span class="hljs-comment"><span class="hljs-comment">// CHANGED ASCII: // 0123456789.,:-¬∞¬±%&lt;&gt;rHYTICS int len = rustext.length(); int j = 0; for (int i = 0; i &lt; len; i ++) { uint16_t res = uint8_t(rustext[i]); if (res &gt; 0x7F) { res = res &lt;&lt; 8 | uint8_t(rustext[i + 1]); //  ...  if ((res &gt;= 0xD090) &amp;&amp; (res &lt;= 0xD0BF)) { char offset = (char)(res - 0xD090); russianStr[j] = 32 + 11 + offset; //  ...  } else if ((res &gt;= 0xD180) &amp;&amp; (res &lt;= 0xD18F)) { char offset = (char)(res - 0xD180); russianStr[j] = 32 + 59 + offset; } // Degree sign else if (res == 0xC2B0) { russianStr[j] = 32 + 79; } // Plus-minus sign else if (res == 0xC2B1) { russianStr[j] = 32 + 80; } i++; } else { // Space if (res == 0x20) { russianStr[j] = 32; } // Numbers else if (res &gt;= 0x30 &amp;&amp; res &lt;= 0x39) { russianStr[j] = 32 + 1 + (res - 0x30); } // . else if (res == 0x2E) { russianStr[j] = 32 + 75; } // , else if (res == 0x2C) { russianStr[j] = 32 + 76; } // : else if (res == 0x3A) { russianStr[j] = 32 + 77; } // - else if (res == 0x2D) { russianStr[j] = 32 + 78; } // % else if (res == 0x25) { russianStr[j] = 32 + 81; } // &lt; else if (res == 0x3C) { russianStr[j] = 32 + 82; } // &gt; else if (res == 0x3C) { russianStr[j] = 32 + 83; } // "r" else if (res == 0x72) { russianStr[j] = 32 + 84; } // "H" else if (res == 0x48) { russianStr[j] = 32 + 85; } // "Y" else if (res == 0x59) { russianStr[j] = 32 + 86; } // "T" else if (res == 0x54) { russianStr[j] = 32 + 87; } // "I" else if (res == 0x49) { russianStr[j] = 32 + 88; } // "C" else if (res == 0x43) { russianStr[j] = 32 + 89; } // "S" else if (res == 0x53) { russianStr[j] = 32 + 90; } } j++; } russianStr[j] = 0; }</span></span></code> </pre><br></div></div><br>  Thus, to display the string ‚ÄúRelative humidity‚Äù (or any other string in Russian) on the TFT display, you must first perform its conversion, and then use the standard output of the string, not forgetting to specify the font number as the third argument. <br><br><pre> <code class="cpp hljs"> CreateStringRussian(<span class="hljs-string"><span class="hljs-string">" "</span></span>); (*_TFT).Text(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, russianStr);</code> </pre><br><h1>  3. The final result </h1><hr><br>  The source code for the finished project is available on <a href="https://developer.mbed.org/users/Ksenia/code/Temp__RH_at_TFT_with_touchscreen-RUS/">developer.mbed.org</a> .  The topic of today's article includes the following project files: <br><br><ul><li>  /pictures.h - converted images and fonts </li><li>  /TFT/display.ImagesAndFonts.cpp - download and capture images and fonts, install fonts </li><li>  /TFT/display.StringsTransform.cpp - string transformations </li><li>  /TFT/display.Draw_MainMenu.cpp - the formation of the main menu screen, where the icons of Temperature and Humidity are displayed </li><li>  /TFT/display.Draw_AboutSensor.cpp - forming a screen with a description of the sensor, where his photo is displayed </li></ul><br>  Thus, I finally finish the description of creating a project in the online IDE ARM mbed.  We looked at everything from writing mbedov Hello Word to a rather voluminous program using two libraries of peripheral devices - HYT for the sensor of the same name and FT800_2 for the Riverdi TFT-module. <br><br>  The magic is that the resulting program can be compiled into a working firmware for any of the <a href="https://developer.mbed.org/platforms/">debug boards supported in mbed</a> . <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/nYildtT047Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  In the last article of this series I will share the story of the creation of the case for this device. <br><br><h1>  Conclusion </h1><hr><br>  In conclusion, I traditionally thank the reader for his attention and remind you that questions about the use of products, about which we write on Habr√©, you can safely ask by email, specified in my profile. </div><p>Source: <a href="https://habr.com/ru/post/311816/">https://habr.com/ru/post/311816/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311802/index.html">Service Desk - quick start. 3 part. Creating a single entry point</a></li>
<li><a href="../311804/index.html">Once again about the promises</a></li>
<li><a href="../311806/index.html">How the use of redundancy codes in SDS helps Yandex keep data cheaply and securely</a></li>
<li><a href="../311808/index.html">learnopengl. Lesson 1.4 - Hello Triangle</a></li>
<li><a href="../311812/index.html">Deep Learning Course Overview</a></li>
<li><a href="../311818/index.html">Barrier control with Arduino UNO and 433 MHz radio transmitter</a></li>
<li><a href="../311820/index.html">Meet the dictator! Small and kind</a></li>
<li><a href="../311822/index.html">Universal data management system based on scaffolding technology and the .NET Core platform</a></li>
<li><a href="../311824/index.html">Founder's advice. Evgeny Luchinin, Lokals</a></li>
<li><a href="../311826/index.html">Errors in the project of the data center that you feel only during the operation phase</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>