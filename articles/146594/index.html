<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Indicators of key information on sites for Firefox in a hurry</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many of us have in mind a set of sites that we periodically open not for attentive reading, but to quickly get acquainted with some small piece of inf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Indicators of key information on sites for Firefox in a hurry</h1><div class="post__text post__text-html js-mediator-article">  Many of us have in mind a set of sites that we periodically open not for attentive reading, but to quickly get acquainted with some small piece of information, see if there are any new articles or comments, check if any parameter has changed and etc.  Sites often provide rss or mailing for such needs, but this is not always the case.  I will try to describe one of the ways to automate such a routine. <br><br><a name="habracut"></a>  Most Firefox users are probably familiar with the extensions that signal updates on popular network resources (email, news aggregator, social network, weather site, and so on).  But on all sites and on all types of information extensions are not enough.  Fortunately, if you are a little familiar with JavaScript, you can create some simplified and flexible similarity of such extensions in a matter of minutes using the mediation extension: <a href="https://addons.mozilla.org/ru/firefox/addon/custom-buttons/">Custom Buttons</a> .  It allows you to quickly create buttons for toolbars that execute arbitrary code when they are pressed or can initiate a certain behavior when the browser is started.  Moreover, they can execute the code both in the context of the page (what the user scripts look like) and in the context of the browser (which is compared to full-fledged extensions). <br><br>  The purpose of this article does not include an explanation of how to work with Custom Buttons: by reference you can find enough links to documentation and forums.  However, everything is arranged quite simply: a button is created through the context menu of the toolbar, a code is entered in the new button dialog, some additional buns are selected, then the button is dragged to any convenient toolbar - and now it is ready to work (by the way, the extension introduces an additional protocol custombutton: // - it allows you to easily publish buttons on the web and share them in the same way we use regular links or bookmarklets). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will try to share some recipes of the code devoted to the mentioned indicators.  We will move from simple to more complex.  The sample code should work in Firefox, starting with the 12th version.  I realize that other elements of the code may seem differently stupid to different people, but the examples do not pretend to perfection: I only share my everyday experience with the help of amateur code and sincerely apologize that I can‚Äôt do it better. <br><br><h4>  1. A simple request for information. </h4><br><br>  It happens that we need from the whole site only a small part of the data.  And in order to obtain this key information, it is not at all necessary to load the entire page with heavy additional content (advertisements, pictures, flash, etc.) and resource-intensive scripts, and then search for the necessary section on the page.  You can get a clean lightweight html through Ajax (it doesn‚Äôt load or execute anything), convert it to DOM, automatically find the area of ‚Äã‚Äãinterest to us and provide only the necessary information. <br><br>  For example, take a not too tempting, but simple and bright case.  We will request the current number of articles in the English Wikipedia (which is now approaching four million).  To do this, insert the following code into the very first tab of the dialog for creating a button (the tab is called ‚ÄúCode‚Äù): <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://en.wikipedia.org/wiki/Main_Page"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body//div[@id='articlecount']"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgMain = <span class="hljs-string"><span class="hljs-string">"data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAEAgQAhIOEAMjHyABIR0gA6ejpAGlqaQCpqKkAKCgoAPz9/AAZGBkAmJiYANjZ2ABXWFcAent6ALm6uQA8OjwAiIiIiIiIiIiIiI4oiL6IiIiIgzuIV4iIiIhndo53KIiIiB/WvXoYiIiIfEZfWBSIiIEGi/foqoiIgzuL84i9iIjpGIoMiEHoiMkos3FojmiLlUipYliEWIF+iDe0GoRa7D6GPbjcu1yIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgMain; processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgMain; processDoc((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser()).parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgMain; alert(<span class="hljs-string"><span class="hljs-string">"Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgMain; alert(<span class="hljs-string"><span class="hljs-string">"HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { alert(keyElement.textContent); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { alert(<span class="hljs-string"><span class="hljs-string">"Parsing error"</span></span>); } } getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre> <br><br>  In the future, for another site and other information we will need to change just a few lines.  Let's try to figure out what the code does. <br><br>  The code of the buttons is executed through new Function (), so there is no need to somehow defend oneself from interfering in the namespace of the browser. <br><br>  The very first in the function are just those variables that need to be reassigned for other conditions.  First we set the address of the page, the second - the XPath of the key element containing the necessary information.  Next we set two embedded images: the first is the pulsator appearing on the button during the request (you do not need to be reassigned), the second is the site icon appearing on the button at the end of the request (you can set this icon as the default icon in the create dialog). <br><br>  The XPath key element is very easy to install with the extension <br>  <a href="https://addons.mozilla.org/ru/firefox/addon/xpather/">XPather</a> : it is not only embedded in the well-known DOM Inspector, but also adds its position to the context menu, which allows any element on the page to open in the window of this extension and get its XPath.  The extension gives the full address with all links and sometimes it can be shortened, relying, for example, on the id elements.  In our example, we just shortened the address (of course, when the key element has an id, you can not use XPath, but here we proceed from the universality of the code and use the method suitable for all cases). <br><br>  Forming XPath, you need to remember that XHR does not execute scripts of the loaded page.  Therefore, in the process of creating the code, you need to analyze the page with disabled JavaScript or primary html.  It so happens that the key element is formed by the script: then our method is no good and you need to apply a more complex approach with hidden background browsers, which we will not touch on in this article.  However, such cases are not so frequent. <br><br>  The button creation window has a handy tool for creating data: addresses for embedding resources; you can easily convert the addresses of site icons to base64 strings.  Of course, nothing prevents you from specifying a URL, just in this way we create a completely autonomous code and reduce network and local requests. <br><br>  Next, we assign a variable to the future for the button, which is first represented as this.  And we proceed to two subfunctions: one of them will receive the document code, the second will parse it and give the necessary information. <br><br>  At the beginning of the first subfunction, we start the pulsator, then create the XHR with its parameters: set the background request flag (so that the browser doesn‚Äôt bother us with messages designed for normal page loading), timeout boundaries and cache traversal flag just in case.  To force Firefox to send cookies with XHR, even when the user has prohibited cookies from third-party sites, set the flag to force sending (without this, cookies are not accepted or sent). <br><br>  Hoping for the best, we use xhr.responseType = "document" to immediately access the DOM.  However, with this approach, you can run into an error caused by an infrequent set of conditions and leading to <a href="http://habrahabr.ru/post/145953/">pseudo timeouts</a> ( <a href="http://habrahabr.ru/post/145953/">see the discussion with links to bugzilla</a> ).  Therefore, we insert a safety code: at the first timeout we try to re-request the page code and disassemble it using DOMParser - it is a bit more complicated and wasteful ( <s>DOMParser for some reason causes loading of some additional resources, although in theory it should only disassemble the code</s> - fixed for night builds, but whether this fix will be included in the 14th release, I don‚Äôt know), but it‚Äôs safer until the error with xhr.responseType = ‚Äúdocument‚Äù is fixed (possibly by the 16th release). <br><br>  As a result, we have several query outcomes: the first successful call (with argument pureXHR == true) with the direct receipt of the DOM leads to the call to the parse function of the document, the first timeout leads to a recursive repeated request for clean code (with the argument pureXHR == false) and then converted in the DOM and again by calling the document parsing function, a second timeout or a communication error leads to the corresponding failure messages. <br><br>  The subfunction of parsing a document is quite simple.  First we try to get the key element.  If the item is found, we provide the necessary information.  If the item is not there, we suspect that the site has given some kind of page that is not the same and report an error.  The reasons may be different: redirect (while XHR gets an empty document), authorization has flown and the site has issued another page for unauthorized users, the developers have changed the DOM structure - or something else.  Then you need to load the page in the browser, check the cause of the failure (including using extensions that examine HTTP activity) and make the necessary corrections. <br><br>  This is a simple way to economically request information for 50 lines of code with a trifle.  Now let's try to enrich a little tool. <br><br><h4>  2. News indicators with timer checks. </h4><br><br>  I would like the button itself to request information at intervals and display its status: there is news - no news - an error.  Such a button can be applied, for example, to forums that do not provide email notifications about new topics, comments, personal messages and similar events.  However, clear signs are added to the pages that such news has appeared (this can be a special element or a change in the attributes of an element). <br><br>  As an example, take a personal message on the site rutracker.org.  The extension will check the personal messages page (any other one can be, we will be interested in a header common to most pages; just a personal message page may be the most economical option), search for the desired element, check its properties and report the status by changing the icon on the button and in addition pop-up hint (you can add a sound alert or pop-up window above the tray, but in this article we will not talk about such difficulties). <br><br>  In this example, we will slightly change the principle of action: we will need not the first, but the second tab of the button creation dialog.  The code in this tab is executed not by pressing a button, but immediately after the launch of the browser.  This gives us the opportunity to assign the necessary variables and functions for the entire time of the timer requests, as well as to set handlers for different button presses for greater flexibility and convenience.  Next, we will only analyze changes in the code compared to the first option. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://pm.rutracker.org/forum/privmsg.php?folder=inbox"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/div[@id='body_container']/div[@id='page_container']/div[@id='page_header']/div[@id='main-nav']/table/tbody/tr/td[2]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOZAAPv/++Xh5THeANvf293Z3dXR1f4AOuvv66Ono6WhpZ2Zne3p7Zj/cwAQ+G1pbc3JzZOXk/Xx9TriACAs7zs/O9PX03t/e/P38/8HPP+rvk1JTY2JjbWxtVNXU/+XriAkUNnb/wES//8zWVn/GwkV/wAMoGNnY/8LRf8TSUtPS/9/nkf/C/8fUn7/S0RQ44T/X/+LpsvPy3T/QwAIYIWBhZGY//9HcQAM4DE9/xkq/3VxdQAOuKuvq6Gk/9r/w1Fd/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAEAALAAAAAAQABAAAAezgECCg4IVC4SIgwcAAEABB4mEFTA2jAADAYkDBxcsBgYYABYEiAEADyKfBhkaCpErBxAYBigqEIQEDC8yAgAIJxkAHgMchAACAhICLQAKFCYFCAOCpsoCDAAOMzsTLgUJggMAIwy9FB8lNw0934ILEQg8PtkTDQ0hAB0Pgt8KEDQRNAwgkeNHjQAFBB0gEIAAAiAbAuAAYalYIgIEClxI4UCHhUiDYmxIwDDAIZABHkxDFAgAOw=="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU1AP39/erq6pOTk5+fn+Xl5eTk5N7e3vHx8bu7u7q6ut/f36KiotjY2LS0tPDw8JycnK+vr5CQkKioqMrKym1tbfb29pSUlJ2dnaOjo3d3d6Wlpff398bGxoSEhH9/f+jo6KmpqbKystPT05aWlmlpab29vaurq8/Pz7i4uKamprGxsYuLi66urnt7e9bW1sPDw8HBwXl5ednZ2WNjY9zc3P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADUALAAAAAAQABAAAAajwJpwKFQ4iMjhAQCoBQ5JokKUYAIIgSThsDENBgvApYAMABih70CRaUQxB8hikDpBiIXJCyUAIDAKZwQcRAACAhYCCAANFCsGCARCZokCEwARMx0aLAYJQgQAIBN9FCQtAg80nkIOFQgwH5gaDw8DAB4MQp4NchUZBAsSJS4BBkIHBQEFCDUSASpLTIRJBQUGGzERIxdRQzISCcoBR94BDJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU6AP98fP+AgP/m5v/ExP+2tv+cnP9ycv/k5P8rK/88PP8CAv9AQP/v75MAAP9HR//y8v8uLv8QELUAAP+Tk/9OTnQAAP89Pf+xsf81Nf+trf/V1f9sbP9YWP9RUf+Li/96ev+Ojv/l5f9ubsAAAP9lZf+EhNwAAPMAAP+5uf+lpbkAAP8WFv+9vf9KSv8NDc0AAIYAAP9UVP8yMv/Bwf/Q0P8MDP/Y2P/9/f9mZv/MzP///wAAAAAAAAAAAAAAAAAAACH5BAEAADoALAAAAAAQABAAAAajQJ1wKBwciMih4HbT2QRJ4iADYN5otiRN8ODIZIkbJIe03Qiir2wgMUQXAlxC1krhiLkC6FO7BRYDZzQTRDc1NRE1ATcGDSczATRCZok1BTcKFSYOJDMAQjQ3MQV9DTAjLggsnkIHDAEeGpgOCAgYNy8EQp4GcgwSNBYdJRc2M0ICOTY5AToUNhshVoRJOTkzDyoKKxBRQygUAMo2R942BJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement.className.indexOf(<span class="hljs-string"><span class="hljs-string">"new-pm-link"</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) { btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Authentication or parsing error"</span></span>); } } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> gif; base64, R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv /////////////////////////////// yH / C05FVFNDQVBFMi4wAwEAAAAh + QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk / <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://pm.rutracker.org/forum/privmsg.php?folder=inbox"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/div[@id='body_container']/div[@id='page_container']/div[@id='page_header']/div[@id='main-nav']/table/tbody/tr/td[2]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOZAAPv/++Xh5THeANvf293Z3dXR1f4AOuvv66Ono6WhpZ2Zne3p7Zj/cwAQ+G1pbc3JzZOXk/Xx9TriACAs7zs/O9PX03t/e/P38/8HPP+rvk1JTY2JjbWxtVNXU/+XriAkUNnb/wES//8zWVn/GwkV/wAMoGNnY/8LRf8TSUtPS/9/nkf/C/8fUn7/S0RQ44T/X/+LpsvPy3T/QwAIYIWBhZGY//9HcQAM4DE9/xkq/3VxdQAOuKuvq6Gk/9r/w1Fd/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAEAALAAAAAAQABAAAAezgECCg4IVC4SIgwcAAEABB4mEFTA2jAADAYkDBxcsBgYYABYEiAEADyKfBhkaCpErBxAYBigqEIQEDC8yAgAIJxkAHgMchAACAhICLQAKFCYFCAOCpsoCDAAOMzsTLgUJggMAIwy9FB8lNw0934ILEQg8PtkTDQ0hAB0Pgt8KEDQRNAwgkeNHjQAFBB0gEIAAAiAbAuAAYalYIgIEClxI4UCHhUiDYmxIwDDAIZABHkxDFAgAOw=="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU1AP39/erq6pOTk5+fn+Xl5eTk5N7e3vHx8bu7u7q6ut/f36KiotjY2LS0tPDw8JycnK+vr5CQkKioqMrKym1tbfb29pSUlJ2dnaOjo3d3d6Wlpff398bGxoSEhH9/f+jo6KmpqbKystPT05aWlmlpab29vaurq8/Pz7i4uKamprGxsYuLi66urnt7e9bW1sPDw8HBwXl5ednZ2WNjY9zc3P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADUALAAAAAAQABAAAAajwJpwKFQ4iMjhAQCoBQ5JokKUYAIIgSThsDENBgvApYAMABih70CRaUQxB8hikDpBiIXJCyUAIDAKZwQcRAACAhYCCAANFCsGCARCZokCEwARMx0aLAYJQgQAIBN9FCQtAg80nkIOFQgwH5gaDw8DAB4MQp4NchUZBAsSJS4BBkIHBQEFCDUSASpLTIRJBQUGGzERIxdRQzISCcoBR94BDJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU6AP98fP+AgP/m5v/ExP+2tv+cnP9ycv/k5P8rK/88PP8CAv9AQP/v75MAAP9HR//y8v8uLv8QELUAAP+Tk/9OTnQAAP89Pf+xsf81Nf+trf/V1f9sbP9YWP9RUf+Li/96ev+Ojv/l5f9ubsAAAP9lZf+EhNwAAPMAAP+5uf+lpbkAAP8WFv+9vf9KSv8NDc0AAIYAAP9UVP8yMv/Bwf/Q0P8MDP/Y2P/9/f9mZv/MzP///wAAAAAAAAAAAAAAAAAAACH5BAEAADoALAAAAAAQABAAAAajQJ1wKBwciMih4HbT2QRJ4iADYN5otiRN8ODIZIkbJIe03Qiir2wgMUQXAlxC1krhiLkC6FO7BRYDZzQTRDc1NRE1ATcGDSczATRCZok1BTcKFSYOJDMAQjQ3MQV9DTAjLggsnkIHDAEeGpgOCAgYNy8EQp4GcgwSNBYdJRc2M0ICOTY5AToUNhshVoRJOTkzDyoKKxBRQygUAMo2R942BJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement.className.indexOf(<span class="hljs-string"><span class="hljs-string">"new-pm-link"</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) { btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Authentication or parsing error"</span></span>); } } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> QQBCgAPACwAAAAAEAAQAAAESPDJ + YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk / J8LqUPg + FRhV6z2q0VF94iJ9pOBAAh + QQBCgAPACwAAAAAEAAQAAAESPDJ + cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk / J8LqWPw + FRhV6z2q0VF94iJ9pOBAAh + QQBCgAPACwAAAAAEAAQAAAESPDJ + QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk / J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh + QQBCgAPACwAAAAAEAAQAAAESPDJ + UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk / J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh + QQBCgAPACwAAAAAEAAQAAAESPDJ + YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk / J8LqUPgeBRhV6 <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://pm.rutracker.org/forum/privmsg.php?folder=inbox"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/div[@id='body_container']/div[@id='page_container']/div[@id='page_header']/div[@id='main-nav']/table/tbody/tr/td[2]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOZAAPv/++Xh5THeANvf293Z3dXR1f4AOuvv66Ono6WhpZ2Zne3p7Zj/cwAQ+G1pbc3JzZOXk/Xx9TriACAs7zs/O9PX03t/e/P38/8HPP+rvk1JTY2JjbWxtVNXU/+XriAkUNnb/wES//8zWVn/GwkV/wAMoGNnY/8LRf8TSUtPS/9/nkf/C/8fUn7/S0RQ44T/X/+LpsvPy3T/QwAIYIWBhZGY//9HcQAM4DE9/xkq/3VxdQAOuKuvq6Gk/9r/w1Fd/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAEAALAAAAAAQABAAAAezgECCg4IVC4SIgwcAAEABB4mEFTA2jAADAYkDBxcsBgYYABYEiAEADyKfBhkaCpErBxAYBigqEIQEDC8yAgAIJxkAHgMchAACAhICLQAKFCYFCAOCpsoCDAAOMzsTLgUJggMAIwy9FB8lNw0934ILEQg8PtkTDQ0hAB0Pgt8KEDQRNAwgkeNHjQAFBB0gEIAAAiAbAuAAYalYIgIEClxI4UCHhUiDYmxIwDDAIZABHkxDFAgAOw=="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU1AP39/erq6pOTk5+fn+Xl5eTk5N7e3vHx8bu7u7q6ut/f36KiotjY2LS0tPDw8JycnK+vr5CQkKioqMrKym1tbfb29pSUlJ2dnaOjo3d3d6Wlpff398bGxoSEhH9/f+jo6KmpqbKystPT05aWlmlpab29vaurq8/Pz7i4uKamprGxsYuLi66urnt7e9bW1sPDw8HBwXl5ednZ2WNjY9zc3P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADUALAAAAAAQABAAAAajwJpwKFQ4iMjhAQCoBQ5JokKUYAIIgSThsDENBgvApYAMABih70CRaUQxB8hikDpBiIXJCyUAIDAKZwQcRAACAhYCCAANFCsGCARCZokCEwARMx0aLAYJQgQAIBN9FCQtAg80nkIOFQgwH5gaDw8DAB4MQp4NchUZBAsSJS4BBkIHBQEFCDUSASpLTIRJBQUGGzERIxdRQzISCcoBR94BDJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU6AP98fP+AgP/m5v/ExP+2tv+cnP9ycv/k5P8rK/88PP8CAv9AQP/v75MAAP9HR//y8v8uLv8QELUAAP+Tk/9OTnQAAP89Pf+xsf81Nf+trf/V1f9sbP9YWP9RUf+Li/96ev+Ojv/l5f9ubsAAAP9lZf+EhNwAAPMAAP+5uf+lpbkAAP8WFv+9vf9KSv8NDc0AAIYAAP9UVP8yMv/Bwf/Q0P8MDP/Y2P/9/f9mZv/MzP///wAAAAAAAAAAAAAAAAAAACH5BAEAADoALAAAAAAQABAAAAajQJ1wKBwciMih4HbT2QRJ4iADYN5otiRN8ODIZIkbJIe03Qiir2wgMUQXAlxC1krhiLkC6FO7BRYDZzQTRDc1NRE1ATcGDSczATRCZok1BTcKFSYOJDMAQjQ3MQV9DTAjLggsnkIHDAEeGpgOCAgYNy8EQp4GcgwSNBYdJRc2M0ICOTY5AToUNhshVoRJOTkzDyoKKxBRQygUAMo2R942BJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement.className.indexOf(<span class="hljs-string"><span class="hljs-string">"new-pm-link"</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) { btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Authentication or parsing error"</span></span>); } } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> gif; base64, R0lGODlhEAAQAOZAAPv / ++ Xh5THeANvf293Z3dXR1f4AOuvv66Ono6WhpZ2Zne3p7Zj / cwAQ + G1pbc3JzZOXk / Xx9TriACAs7zs / O9PX03t / e / P38 / 8HPP + rvk1JTY2JjbWxtVNXU / + XriAkUNnb / wES // 8zWVn / GwkV / wAMoGNnY / 8LRf8TSUtPS / <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://pm.rutracker.org/forum/privmsg.php?folder=inbox"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/div[@id='body_container']/div[@id='page_container']/div[@id='page_header']/div[@id='main-nav']/table/tbody/tr/td[2]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOZAAPv/++Xh5THeANvf293Z3dXR1f4AOuvv66Ono6WhpZ2Zne3p7Zj/cwAQ+G1pbc3JzZOXk/Xx9TriACAs7zs/O9PX03t/e/P38/8HPP+rvk1JTY2JjbWxtVNXU/+XriAkUNnb/wES//8zWVn/GwkV/wAMoGNnY/8LRf8TSUtPS/9/nkf/C/8fUn7/S0RQ44T/X/+LpsvPy3T/QwAIYIWBhZGY//9HcQAM4DE9/xkq/3VxdQAOuKuvq6Gk/9r/w1Fd/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAEAALAAAAAAQABAAAAezgECCg4IVC4SIgwcAAEABB4mEFTA2jAADAYkDBxcsBgYYABYEiAEADyKfBhkaCpErBxAYBigqEIQEDC8yAgAIJxkAHgMchAACAhICLQAKFCYFCAOCpsoCDAAOMzsTLgUJggMAIwy9FB8lNw0934ILEQg8PtkTDQ0hAB0Pgt8KEDQRNAwgkeNHjQAFBB0gEIAAAiAbAuAAYalYIgIEClxI4UCHhUiDYmxIwDDAIZABHkxDFAgAOw=="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU1AP39/erq6pOTk5+fn+Xl5eTk5N7e3vHx8bu7u7q6ut/f36KiotjY2LS0tPDw8JycnK+vr5CQkKioqMrKym1tbfb29pSUlJ2dnaOjo3d3d6Wlpff398bGxoSEhH9/f+jo6KmpqbKystPT05aWlmlpab29vaurq8/Pz7i4uKamprGxsYuLi66urnt7e9bW1sPDw8HBwXl5ednZ2WNjY9zc3P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADUALAAAAAAQABAAAAajwJpwKFQ4iMjhAQCoBQ5JokKUYAIIgSThsDENBgvApYAMABih70CRaUQxB8hikDpBiIXJCyUAIDAKZwQcRAACAhYCCAANFCsGCARCZokCEwARMx0aLAYJQgQAIBN9FCQtAg80nkIOFQgwH5gaDw8DAB4MQp4NchUZBAsSJS4BBkIHBQEFCDUSASpLTIRJBQUGGzERIxdRQzISCcoBR94BDJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU6AP98fP+AgP/m5v/ExP+2tv+cnP9ycv/k5P8rK/88PP8CAv9AQP/v75MAAP9HR//y8v8uLv8QELUAAP+Tk/9OTnQAAP89Pf+xsf81Nf+trf/V1f9sbP9YWP9RUf+Li/96ev+Ojv/l5f9ubsAAAP9lZf+EhNwAAPMAAP+5uf+lpbkAAP8WFv+9vf9KSv8NDc0AAIYAAP9UVP8yMv/Bwf/Q0P8MDP/Y2P/9/f9mZv/MzP///wAAAAAAAAAAAAAAAAAAACH5BAEAADoALAAAAAAQABAAAAajQJ1wKBwciMih4HbT2QRJ4iADYN5otiRN8ODIZIkbJIe03Qiir2wgMUQXAlxC1krhiLkC6FO7BRYDZzQTRDc1NRE1ATcGDSczATRCZok1BTcKFSYOJDMAQjQ3MQV9DTAjLggsnkIHDAEeGpgOCAgYNy8EQp4GcgwSNBYdJRc2M0ICOTY5AToUNhshVoRJOTkzDyoKKxBRQygUAMo2R942BJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement.className.indexOf(<span class="hljs-string"><span class="hljs-string">"new-pm-link"</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) { btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Authentication or parsing error"</span></span>); } } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> X / + LpsvPy3T / QwAIYIWBhZGY // 9HcQAM4DE9 / xkq / 3VxdQAOuKuvq6Gk / 9r / w1Fd ///// wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAEAALAAAAAAQABAAAAezgECCg4IVC4SIgwcAAEABB4mEFTA2jAADAYkDBxcsBgYYABYEiAEADyKfBhkaCpErBxAYBigqEIQEDC8yAgAIJxkAHgMchAACAhICLQAKFCYFCAOCpsoCDAAOMzsTLgUJggMAIwy9FB8lNw0934ILEQg8PtkTDQ0hAB0Pgt8KEDQRNAwgkeNHjQAFBB0gEIAAAiAbAuAAYalYIgIEClxI4UCHhUiDYmxIwDDAIZABHkxDFAgAOw == "; <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://pm.rutracker.org/forum/privmsg.php?folder=inbox"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/div[@id='body_container']/div[@id='page_container']/div[@id='page_header']/div[@id='main-nav']/table/tbody/tr/td[2]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOZAAPv/++Xh5THeANvf293Z3dXR1f4AOuvv66Ono6WhpZ2Zne3p7Zj/cwAQ+G1pbc3JzZOXk/Xx9TriACAs7zs/O9PX03t/e/P38/8HPP+rvk1JTY2JjbWxtVNXU/+XriAkUNnb/wES//8zWVn/GwkV/wAMoGNnY/8LRf8TSUtPS/9/nkf/C/8fUn7/S0RQ44T/X/+LpsvPy3T/QwAIYIWBhZGY//9HcQAM4DE9/xkq/3VxdQAOuKuvq6Gk/9r/w1Fd/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAEAALAAAAAAQABAAAAezgECCg4IVC4SIgwcAAEABB4mEFTA2jAADAYkDBxcsBgYYABYEiAEADyKfBhkaCpErBxAYBigqEIQEDC8yAgAIJxkAHgMchAACAhICLQAKFCYFCAOCpsoCDAAOMzsTLgUJggMAIwy9FB8lNw0934ILEQg8PtkTDQ0hAB0Pgt8KEDQRNAwgkeNHjQAFBB0gEIAAAiAbAuAAYalYIgIEClxI4UCHhUiDYmxIwDDAIZABHkxDFAgAOw=="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU1AP39/erq6pOTk5+fn+Xl5eTk5N7e3vHx8bu7u7q6ut/f36KiotjY2LS0tPDw8JycnK+vr5CQkKioqMrKym1tbfb29pSUlJ2dnaOjo3d3d6Wlpff398bGxoSEhH9/f+jo6KmpqbKystPT05aWlmlpab29vaurq8/Pz7i4uKamprGxsYuLi66urnt7e9bW1sPDw8HBwXl5ednZ2WNjY9zc3P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADUALAAAAAAQABAAAAajwJpwKFQ4iMjhAQCoBQ5JokKUYAIIgSThsDENBgvApYAMABih70CRaUQxB8hikDpBiIXJCyUAIDAKZwQcRAACAhYCCAANFCsGCARCZokCEwARMx0aLAYJQgQAIBN9FCQtAg80nkIOFQgwH5gaDw8DAB4MQp4NchUZBAsSJS4BBkIHBQEFCDUSASpLTIRJBQUGGzERIxdRQzISCcoBR94BDJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU6AP98fP+AgP/m5v/ExP+2tv+cnP9ycv/k5P8rK/88PP8CAv9AQP/v75MAAP9HR//y8v8uLv8QELUAAP+Tk/9OTnQAAP89Pf+xsf81Nf+trf/V1f9sbP9YWP9RUf+Li/96ev+Ojv/l5f9ubsAAAP9lZf+EhNwAAPMAAP+5uf+lpbkAAP8WFv+9vf9KSv8NDc0AAIYAAP9UVP8yMv/Bwf/Q0P8MDP/Y2P/9/f9mZv/MzP///wAAAAAAAAAAAAAAAAAAACH5BAEAADoALAAAAAAQABAAAAajQJ1wKBwciMih4HbT2QRJ4iADYN5otiRN8ODIZIkbJIe03Qiir2wgMUQXAlxC1krhiLkC6FO7BRYDZzQTRDc1NRE1ATcGDSczATRCZok1BTcKFSYOJDMAQjQ3MQV9DTAjLggsnkIHDAEeGpgOCAgYNy8EQp4GcgwSNBYdJRc2M0ICOTY5AToUNhshVoRJOTkzDyoKKxBRQygUAMo2R942BJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement.className.indexOf(<span class="hljs-string"><span class="hljs-string">"new-pm-link"</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) { btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Authentication or parsing error"</span></span>); } } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> gif; base64, R0lGODlhEAAQANU1AP39 / erq6pOTk5 + fn + Xl5eTk5N7e3vHx8bu7u7q6ut / f36KiotjY2LS0tPDw8JycnK + vr5CQkKioqMrKym1tbfb29pSUlJ2dnaOjo3d3d6Wlpff398bGxoSEhH9 / f + jo6KmpqbKystPT05aWlmlpab29vaurq8 / Pz7i4uKamprGxsYuLi66urnt7e9bW1sPDw8HBwXl5ednZ2WNjY9zc3P /// wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADUALAAAAAAQABAAAAajwJpwKFQ4iMjhAQCoBQ5JokKUYAIIgSThsDENBgvApYAMABih70CRaUQxB8hikDpBiIXJCyUAIDAKZwQcRAACAhYCCAANFCsGCARCZokCEwARMx0aLAYJQgQAIBN9FCQtAg80nkIOFQgwH5gaDw8DAB4MQp4NchUZBAsSJS4BBkIHBQEFCDUSASpLTIRJBQUGGzERIxdRQzISCcoBR94BDJJIQQA7"; <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://pm.rutracker.org/forum/privmsg.php?folder=inbox"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/div[@id='body_container']/div[@id='page_container']/div[@id='page_header']/div[@id='main-nav']/table/tbody/tr/td[2]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOZAAPv/++Xh5THeANvf293Z3dXR1f4AOuvv66Ono6WhpZ2Zne3p7Zj/cwAQ+G1pbc3JzZOXk/Xx9TriACAs7zs/O9PX03t/e/P38/8HPP+rvk1JTY2JjbWxtVNXU/+XriAkUNnb/wES//8zWVn/GwkV/wAMoGNnY/8LRf8TSUtPS/9/nkf/C/8fUn7/S0RQ44T/X/+LpsvPy3T/QwAIYIWBhZGY//9HcQAM4DE9/xkq/3VxdQAOuKuvq6Gk/9r/w1Fd/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAEAALAAAAAAQABAAAAezgECCg4IVC4SIgwcAAEABB4mEFTA2jAADAYkDBxcsBgYYABYEiAEADyKfBhkaCpErBxAYBigqEIQEDC8yAgAIJxkAHgMchAACAhICLQAKFCYFCAOCpsoCDAAOMzsTLgUJggMAIwy9FB8lNw0934ILEQg8PtkTDQ0hAB0Pgt8KEDQRNAwgkeNHjQAFBB0gEIAAAiAbAuAAYalYIgIEClxI4UCHhUiDYmxIwDDAIZABHkxDFAgAOw=="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU1AP39/erq6pOTk5+fn+Xl5eTk5N7e3vHx8bu7u7q6ut/f36KiotjY2LS0tPDw8JycnK+vr5CQkKioqMrKym1tbfb29pSUlJ2dnaOjo3d3d6Wlpff398bGxoSEhH9/f+jo6KmpqbKystPT05aWlmlpab29vaurq8/Pz7i4uKamprGxsYuLi66urnt7e9bW1sPDw8HBwXl5ednZ2WNjY9zc3P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADUALAAAAAAQABAAAAajwJpwKFQ4iMjhAQCoBQ5JokKUYAIIgSThsDENBgvApYAMABih70CRaUQxB8hikDpBiIXJCyUAIDAKZwQcRAACAhYCCAANFCsGCARCZokCEwARMx0aLAYJQgQAIBN9FCQtAg80nkIOFQgwH5gaDw8DAB4MQp4NchUZBAsSJS4BBkIHBQEFCDUSASpLTIRJBQUGGzERIxdRQzISCcoBR94BDJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU6AP98fP+AgP/m5v/ExP+2tv+cnP9ycv/k5P8rK/88PP8CAv9AQP/v75MAAP9HR//y8v8uLv8QELUAAP+Tk/9OTnQAAP89Pf+xsf81Nf+trf/V1f9sbP9YWP9RUf+Li/96ev+Ojv/l5f9ubsAAAP9lZf+EhNwAAPMAAP+5uf+lpbkAAP8WFv+9vf9KSv8NDc0AAIYAAP9UVP8yMv/Bwf/Q0P8MDP/Y2P/9/f9mZv/MzP///wAAAAAAAAAAAAAAAAAAACH5BAEAADoALAAAAAAQABAAAAajQJ1wKBwciMih4HbT2QRJ4iADYN5otiRN8ODIZIkbJIe03Qiir2wgMUQXAlxC1krhiLkC6FO7BRYDZzQTRDc1NRE1ATcGDSczATRCZok1BTcKFSYOJDMAQjQ3MQV9DTAjLggsnkIHDAEeGpgOCAgYNy8EQp4GcgwSNBYdJRc2M0ICOTY5AToUNhshVoRJOTkzDyoKKxBRQygUAMo2R942BJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement.className.indexOf(<span class="hljs-string"><span class="hljs-string">"new-pm-link"</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) { btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Authentication or parsing error"</span></span>); } } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> gif; base64, R0lGODlhEAAQANU6AP98fP + AgP / m5v / ExP + 2tv + cnP9ycv / k5P8rK / 88PP8CAv9AQP / v75MAAP9HR // y8v8uLv8QELUAAP + Tk / 9OTnQAAP89Pf + xsf81Nf + trf / V1f9sbP9YWP9RUf + Li / 96ev + Ojv / l5f9ubsAAAP9lZf <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://pm.rutracker.org/forum/privmsg.php?folder=inbox"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/div[@id='body_container']/div[@id='page_container']/div[@id='page_header']/div[@id='main-nav']/table/tbody/tr/td[2]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOZAAPv/++Xh5THeANvf293Z3dXR1f4AOuvv66Ono6WhpZ2Zne3p7Zj/cwAQ+G1pbc3JzZOXk/Xx9TriACAs7zs/O9PX03t/e/P38/8HPP+rvk1JTY2JjbWxtVNXU/+XriAkUNnb/wES//8zWVn/GwkV/wAMoGNnY/8LRf8TSUtPS/9/nkf/C/8fUn7/S0RQ44T/X/+LpsvPy3T/QwAIYIWBhZGY//9HcQAM4DE9/xkq/3VxdQAOuKuvq6Gk/9r/w1Fd/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAEAALAAAAAAQABAAAAezgECCg4IVC4SIgwcAAEABB4mEFTA2jAADAYkDBxcsBgYYABYEiAEADyKfBhkaCpErBxAYBigqEIQEDC8yAgAIJxkAHgMchAACAhICLQAKFCYFCAOCpsoCDAAOMzsTLgUJggMAIwy9FB8lNw0934ILEQg8PtkTDQ0hAB0Pgt8KEDQRNAwgkeNHjQAFBB0gEIAAAiAbAuAAYalYIgIEClxI4UCHhUiDYmxIwDDAIZABHkxDFAgAOw=="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU1AP39/erq6pOTk5+fn+Xl5eTk5N7e3vHx8bu7u7q6ut/f36KiotjY2LS0tPDw8JycnK+vr5CQkKioqMrKym1tbfb29pSUlJ2dnaOjo3d3d6Wlpff398bGxoSEhH9/f+jo6KmpqbKystPT05aWlmlpab29vaurq8/Pz7i4uKamprGxsYuLi66urnt7e9bW1sPDw8HBwXl5ednZ2WNjY9zc3P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADUALAAAAAAQABAAAAajwJpwKFQ4iMjhAQCoBQ5JokKUYAIIgSThsDENBgvApYAMABih70CRaUQxB8hikDpBiIXJCyUAIDAKZwQcRAACAhYCCAANFCsGCARCZokCEwARMx0aLAYJQgQAIBN9FCQtAg80nkIOFQgwH5gaDw8DAB4MQp4NchUZBAsSJS4BBkIHBQEFCDUSASpLTIRJBQUGGzERIxdRQzISCcoBR94BDJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU6AP98fP+AgP/m5v/ExP+2tv+cnP9ycv/k5P8rK/88PP8CAv9AQP/v75MAAP9HR//y8v8uLv8QELUAAP+Tk/9OTnQAAP89Pf+xsf81Nf+trf/V1f9sbP9YWP9RUf+Li/96ev+Ojv/l5f9ubsAAAP9lZf+EhNwAAPMAAP+5uf+lpbkAAP8WFv+9vf9KSv8NDc0AAIYAAP9UVP8yMv/Bwf/Q0P8MDP/Y2P/9/f9mZv/MzP///wAAAAAAAAAAAAAAAAAAACH5BAEAADoALAAAAAAQABAAAAajQJ1wKBwciMih4HbT2QRJ4iADYN5otiRN8ODIZIkbJIe03Qiir2wgMUQXAlxC1krhiLkC6FO7BRYDZzQTRDc1NRE1ATcGDSczATRCZok1BTcKFSYOJDMAQjQ3MQV9DTAjLggsnkIHDAEeGpgOCAgYNy8EQp4GcgwSNBYdJRc2M0ICOTY5AToUNhshVoRJOTkzDyoKKxBRQygUAMo2R942BJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement.className.indexOf(<span class="hljs-string"><span class="hljs-string">"new-pm-link"</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) { btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Authentication or parsing error"</span></span>); } } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> / Bwf / Q0P8MDP / Y2P / <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://pm.rutracker.org/forum/privmsg.php?folder=inbox"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/div[@id='body_container']/div[@id='page_container']/div[@id='page_header']/div[@id='main-nav']/table/tbody/tr/td[2]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOZAAPv/++Xh5THeANvf293Z3dXR1f4AOuvv66Ono6WhpZ2Zne3p7Zj/cwAQ+G1pbc3JzZOXk/Xx9TriACAs7zs/O9PX03t/e/P38/8HPP+rvk1JTY2JjbWxtVNXU/+XriAkUNnb/wES//8zWVn/GwkV/wAMoGNnY/8LRf8TSUtPS/9/nkf/C/8fUn7/S0RQ44T/X/+LpsvPy3T/QwAIYIWBhZGY//9HcQAM4DE9/xkq/3VxdQAOuKuvq6Gk/9r/w1Fd/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAEAALAAAAAAQABAAAAezgECCg4IVC4SIgwcAAEABB4mEFTA2jAADAYkDBxcsBgYYABYEiAEADyKfBhkaCpErBxAYBigqEIQEDC8yAgAIJxkAHgMchAACAhICLQAKFCYFCAOCpsoCDAAOMzsTLgUJggMAIwy9FB8lNw0934ILEQg8PtkTDQ0hAB0Pgt8KEDQRNAwgkeNHjQAFBB0gEIAAAiAbAuAAYalYIgIEClxI4UCHhUiDYmxIwDDAIZABHkxDFAgAOw=="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU1AP39/erq6pOTk5+fn+Xl5eTk5N7e3vHx8bu7u7q6ut/f36KiotjY2LS0tPDw8JycnK+vr5CQkKioqMrKym1tbfb29pSUlJ2dnaOjo3d3d6Wlpff398bGxoSEhH9/f+jo6KmpqbKystPT05aWlmlpab29vaurq8/Pz7i4uKamprGxsYuLi66urnt7e9bW1sPDw8HBwXl5ednZ2WNjY9zc3P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADUALAAAAAAQABAAAAajwJpwKFQ4iMjhAQCoBQ5JokKUYAIIgSThsDENBgvApYAMABih70CRaUQxB8hikDpBiIXJCyUAIDAKZwQcRAACAhYCCAANFCsGCARCZokCEwARMx0aLAYJQgQAIBN9FCQtAg80nkIOFQgwH5gaDw8DAB4MQp4NchUZBAsSJS4BBkIHBQEFCDUSASpLTIRJBQUGGzERIxdRQzISCcoBR94BDJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQANU6AP98fP+AgP/m5v/ExP+2tv+cnP9ycv/k5P8rK/88PP8CAv9AQP/v75MAAP9HR//y8v8uLv8QELUAAP+Tk/9OTnQAAP89Pf+xsf81Nf+trf/V1f9sbP9YWP9RUf+Li/96ev+Ojv/l5f9ubsAAAP9lZf+EhNwAAPMAAP+5uf+lpbkAAP8WFv+9vf9KSv8NDc0AAIYAAP9UVP8yMv/Bwf/Q0P8MDP/Y2P/9/f9mZv/MzP///wAAAAAAAAAAAAAAAAAAACH5BAEAADoALAAAAAAQABAAAAajQJ1wKBwciMih4HbT2QRJ4iADYN5otiRN8ODIZIkbJIe03Qiir2wgMUQXAlxC1krhiLkC6FO7BRYDZzQTRDc1NRE1ATcGDSczATRCZok1BTcKFSYOJDMAQjQ3MQV9DTAjLggsnkIHDAEeGpgOCAgYNy8EQp4GcgwSNBYdJRc2M0ICOTY5AToUNhshVoRJOTkzDyoKKxBRQygUAMo2R942BJJIQQA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement.className.indexOf(<span class="hljs-string"><span class="hljs-string">"new-pm-link"</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) { btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Authentication or parsing error"</span></span>); } } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre><br><br>  Two more parameters were added to the pair of initial parameters: delay (the number of seconds between the launch of the browser and the first timer request) and interval (intervals between further requests in minutes).  In our example, this is ten seconds and an hour, respectively. <br><br>  Now we have not two, but four icons: an indicator of a fulfilling request, indicators of news availability and absence, as well as an icon for errors. <br><br>  We also create a special variable for the security object DOMParser, so as not to recreate it again with each request. <br><br>  Then we add a button handler on the button with the mouse.  Pressing the left and middle mouse button will be enough for us.  When you first click, we will initiate an extraordinary request (the timer will restart), and when you click the middle button, we will open the page you need in the browser to get acquainted with the news in more detail.  The middle button handler will check the current tab and, if it is empty and hasn‚Äôt started loading anything into it, will open the page in it, otherwise in a new tab.  Also, with this opening, we will restart the timer and reset the news indicator to the next request, meaning that opening the page is equal to an extraordinary request and will still lead to reading (that is, reset) the news on the site. <br><br>  The XHR result handlers in this example do not give out alerts, but change the icons and tooltips (the latter includes the time of the request and a summary of the result). <br><br>  If there are new messages, the server adds an attribute of a certain class to the key element (link to the inbox in the upper right corner of the page).  We will check it.  If the authorization on the site flies, the server issues a redirect to the login page: in this case, XHR receives an empty document, the element is not found, and we get an error common to other cases of changes in the DOM. <br><br>  After defining variables and functions, we bind the click handler to the button, call the first pending request, and start the timer. <br><br>  By the way, in Custom Buttons there is a small bug with event handlers: if you do not add a handler removal via onDestroy, the handlers are layered (duplicated) every time you call the toolbar settings (open and close the tool palette). <br><br><h4>  3. News indicators with timer checks and state saving between browser sessions. </h4><br><br>  In the previous example, it was enough for us to load the page in order to understand whether there was news: the server took care of remembering what the user had read and what time the unread news had been counted.  However, not all sites have such news indicators. <br><br>  I will give an example.  Recently, subtitle tools have been replenished with one great program - Subtitle Edit.  The <a href="http://www.nikse.dk/">developer‚Äôs site has</a> communicated with users who report bugs and request new features.  The site has rss for the new posts of the author, including with messages about new versions of the program.  However, in the comments to the last post, a discussion of the new version usually takes place, and the author often puts out links to assemblies with current fixes.  To keep abreast of such intermediate changes, you have to periodically open the main page and look at the link of the last post, if there were any comments added. <br><br>  There are no subscriptions to post comments.  Similarly, there are no obvious signs on the site that there are unread comments.  We need to remember the previous number of comments and check if the number in the top link has increased.  Here we will overload this comparison on the button.  She will memorize the link to the last post and the number of comments in it.  If the top post changes or comments are added to it, the button will report the news. <br><br>  Resetting news will also change a bit.  In the second example, the user read new messages on the site and their site indicator was reset.  Resetting the button just anticipated it.  In our third example, the site itself does not change after we read the new comments.  Therefore, we will introduce an additional variable-flag for the presence / absence of news: as soon as news appears, the variable changes and remains in this state for the duration of all requests, until the user responds and opening the site through a button does not reset this flag. <br><br>  Now about the additions in the code. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://www.nikse.dk/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/table/tbody/tr/td[2]/table/tbody/tr[1]/td[3]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">20</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJKSURBVHjalJI/axRRFMXvve/NzO7M7oaQNe5uig2aSExIiPgRFBttkhCihfkCYmNjY6NgYyWIlYWFVjFFIKRIHwNCMIkiZCF/Vth1dl1IMjtmd17ezFyLkQhq4+0u/A73nMsB+M9BAJBZ2XetL11OA/+LEEgWtVZb/iefI0aZk6PPR4uzRY4ZAJAw4ZIVGDhmYOCQdx7u1N/UZe5Kzr5oVx5V/M8+mYQSySQUCPRbjAKz49nCdKG12pJWwfI2PG/Dy1/PZ8ezKPH4w7FyVelO6cyVu+D2XO0J6oFIC0KBsYpTpVT5XjmoB8pVl55cQolzN+ZUU6mmUg2FAs3zJiAAggT+FQsQgloQtsP62zpZ1Ib26fdTjlkfaTTw7BpxxIAQfAsai42BuwNjL8dYM0qchMnCTKE4W8yMZFDgWR4ZBzEAyJwEhP1n+5SiqVdTyw+W12Ct+qKaPAoSmBOBjpGQLCrMFFIDKTKp0qlwzBMwsT69nnDuOzfxDAzCGXLsC7b30evsdYAh9MPmUjPqRNvedngchl6oDzUZNH9zfnN7s7nUlLGKhSNY80nlpFvtUorIJDKpvdW2Sla6nHaGnPJEeaWz0lptRSeR1EfaGXb6b/XrQ525nLGH7NxkbiQ3YoPtgXegDoJasPd+r/a65i64HDKa58zS7dLw42Gj14g6kT7S0Y8oVjFKFLZAAxuLjd2nu6xZexoYEADMvGn0GlbRGrw/iAaKtOh+7ba32v4Xv1vtqobiiDnkP1tLFiVfMvOmsAVKRIF/l/fnAIYyDbro6Ua2AAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAI4SURBVHjalJK/aipREMbPnDNn/YMYdGWJgiLRIqWVhYqB1PoG1nkKX8E3ECysEtLZGUgKt14RQiAoKiKI/3YXXNTsuntusVzhkupON/Ab5vu+GUL+s4AQEgqFCoWCoihCiN8EpZRzrmnabDbzPA/C4fDT01OlUvFpAPA5vxV/y3XdTqfz/v6OuVwumUx2u935fI6IjDFEpJRSSq/DlNJsNlsqlTRNw1gsNh6Px+NxoVDIZrOMse/vb13XHx4erqoGg0E+n9/v95IkUUqp4zjxeLxWq+33e13XG40GY6xer5umaZqmYRiU0lgsBgAAgEII3xYA7Ha74/H48fHBObdt2zRNIYRlWYh43Yae5wGAruuqqj4+PmYymX6/zxhLJBLlcpkQ8vn5OZlMrn7Qtm1CSDgcBoDX11dJkprNZqvVWq1WvV7PD8qn/dzQdV0A4JyXy2VZlhFxu90KIWRZLpVKPqeqqq9ZCIH+nGEYLy8viqJwzkejkeM47XbbP4vneYqiFIvFr68vy7LQcZxgMHi5XJbL5Xq9liQJERFxOp3KsqwoSjKZvL+/n0wmmqadz2e0LCuVShWLxcPhkE6nU6nU3d3d7e0tItq2bRjGbrcbDodvb2+DwcB1Xbi5ualWq41GIxKJ/Pz8WJZ1Op0cx2GMBQIBRFRV9fn5+XK5HI9HIQQQQqLRaCQSicfj9XodESVJ2mw20+l0sVis12vDMDzPc13336cF4Jz7KUWj0UAgwBijlP5+3j8DAOp7HGipYoAdAAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJtSURBVHjalFLPSxRxHP18f8zMOuu67JCLm4m2omzMIthhQaxDXjwKHuzSRZEgQoigg9AtqINIV+nSHyCJhyAMBGXNX2yoyIqJG26u6+gqszUzzszuzPfbYVUKuvRuH3iP93mPB/CfQAAQFsXBeLwjHOb/YhCE6iidzuVWNM3nHEUk6UN//4PeXuAcAAChS2Lt5BwYA87B817Mzr7d2qL3YjFVUd7MzKyfnkqECBhLhBCECEL4SkwxTkWjI4nEdC5HbwWDi8XiYrE4GI+nolGRkPlC4YdpPk0mr7+aymbvx2IHhiFTiinGju+3hkKP+/oODCNvGGNDQwLGbcPDR5Z1ZFmHpkkQaqmvxwhhhCjjvBYLEPr+65fuuvL8fIAQsO2CaXKAkm1LhFy7UZ9zjFDeMD6trT3r6sKq+nluTsAYWloedncDQHpvL318DFcaeuF5ABCRJIzQ8+VleX399fj4xuQk7O9PpNMAwDivZWecAwCt+D4CCBDSn0q1hUISIZDPM86huXkkkQAADvBuZwdEESPEOCeqotyJRL5oWkHTGOc/K5WPGxtmtSptb587ju66JccRMVZHR/Orq+93d6nteQ2i6Pr+5tnZt3JZplQiRMR4WdNuNzR0hMOqopCeHshkpnM5o1qlZ46TVJRHnZ0nFxd3GxuTihJNJKC9HQQBbBs0DQ4PzxcWJjY3p7LZKmPoZjD4RFVfDgyAooBlga6DYfiVCqEUZBkEYSaTGVtacn1fd93LAppk+UYg0BoKvUqlJEJkSvfK5ZWTk6+l0q6uFyzLY6zK2F+TxAjVUVprqUmW6wVBwJhcD/EP/B4AKOgP3B2vzLEAAAAASUVORK5CYII="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefService = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/preferences-service;1"</span></span>].getService(Components.interfaces.nsIPrefService); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefBranch = prefService.getBranch(<span class="hljs-string"><span class="hljs-string">"cb_storage."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> supportsString = Components.interfaces.nsISupportsString; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uStr = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/supports-string;1"</span></span>].createInstance(supportsString); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + previousStat.commentsInfo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousStat.pageURL != keyElement.href || previousStat.commentsInfo != keyElement.textContent || previousStat.isNew) { previousStat.pageURL = keyElement.href; previousStat.commentsInfo = keyElement.textContent; previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News: "</span></span> + keyElement.textContent); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + keyElement.textContent); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Parsing error"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!prefBranch.prefHasUserValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>)) { uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({<span class="hljs-string"><span class="hljs-string">"pageURL"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"commentsInfo"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"isNew"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> gif; base64, R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv /////////////////////////////// yH / C05FVFNDQVBFMi4wAwEAAAAh + QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk / <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://www.nikse.dk/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/table/tbody/tr/td[2]/table/tbody/tr[1]/td[3]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">20</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJKSURBVHjalJI/axRRFMXvve/NzO7M7oaQNe5uig2aSExIiPgRFBttkhCihfkCYmNjY6NgYyWIlYWFVjFFIKRIHwNCMIkiZCF/Vth1dl1IMjtmd17ezFyLkQhq4+0u/A73nMsB+M9BAJBZ2XetL11OA/+LEEgWtVZb/iefI0aZk6PPR4uzRY4ZAJAw4ZIVGDhmYOCQdx7u1N/UZe5Kzr5oVx5V/M8+mYQSySQUCPRbjAKz49nCdKG12pJWwfI2PG/Dy1/PZ8ezKPH4w7FyVelO6cyVu+D2XO0J6oFIC0KBsYpTpVT5XjmoB8pVl55cQolzN+ZUU6mmUg2FAs3zJiAAggT+FQsQgloQtsP62zpZ1Ib26fdTjlkfaTTw7BpxxIAQfAsai42BuwNjL8dYM0qchMnCTKE4W8yMZFDgWR4ZBzEAyJwEhP1n+5SiqVdTyw+W12Ct+qKaPAoSmBOBjpGQLCrMFFIDKTKp0qlwzBMwsT69nnDuOzfxDAzCGXLsC7b30evsdYAh9MPmUjPqRNvedngchl6oDzUZNH9zfnN7s7nUlLGKhSNY80nlpFvtUorIJDKpvdW2Sla6nHaGnPJEeaWz0lptRSeR1EfaGXb6b/XrQ525nLGH7NxkbiQ3YoPtgXegDoJasPd+r/a65i64HDKa58zS7dLw42Gj14g6kT7S0Y8oVjFKFLZAAxuLjd2nu6xZexoYEADMvGn0GlbRGrw/iAaKtOh+7ba32v4Xv1vtqobiiDnkP1tLFiVfMvOmsAVKRIF/l/fnAIYyDbro6Ua2AAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAI4SURBVHjalJK/aipREMbPnDNn/YMYdGWJgiLRIqWVhYqB1PoG1nkKX8E3ECysEtLZGUgKt14RQiAoKiKI/3YXXNTsuntusVzhkupON/Ab5vu+GUL+s4AQEgqFCoWCoihCiN8EpZRzrmnabDbzPA/C4fDT01OlUvFpAPA5vxV/y3XdTqfz/v6OuVwumUx2u935fI6IjDFEpJRSSq/DlNJsNlsqlTRNw1gsNh6Px+NxoVDIZrOMse/vb13XHx4erqoGg0E+n9/v95IkUUqp4zjxeLxWq+33e13XG40GY6xer5umaZqmYRiU0lgsBgAAgEII3xYA7Ha74/H48fHBObdt2zRNIYRlWYh43Yae5wGAruuqqj4+PmYymX6/zxhLJBLlcpkQ8vn5OZlMrn7Qtm1CSDgcBoDX11dJkprNZqvVWq1WvV7PD8qn/dzQdV0A4JyXy2VZlhFxu90KIWRZLpVKPqeqqq9ZCIH+nGEYLy8viqJwzkejkeM47XbbP4vneYqiFIvFr68vy7LQcZxgMHi5XJbL5Xq9liQJERFxOp3KsqwoSjKZvL+/n0wmmqadz2e0LCuVShWLxcPhkE6nU6nU3d3d7e0tItq2bRjGbrcbDodvb2+DwcB1Xbi5ualWq41GIxKJ/Pz8WJZ1Op0cx2GMBQIBRFRV9fn5+XK5HI9HIQQQQqLRaCQSicfj9XodESVJ2mw20+l0sVis12vDMDzPc13336cF4Jz7KUWj0UAgwBijlP5+3j8DAOp7HGipYoAdAAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJtSURBVHjalFLPSxRxHP18f8zMOuu67JCLm4m2omzMIthhQaxDXjwKHuzSRZEgQoigg9AtqINIV+nSHyCJhyAMBGXNX2yoyIqJG26u6+gqszUzzszuzPfbYVUKuvRuH3iP93mPB/CfQAAQFsXBeLwjHOb/YhCE6iidzuVWNM3nHEUk6UN//4PeXuAcAAChS2Lt5BwYA87B817Mzr7d2qL3YjFVUd7MzKyfnkqECBhLhBCECEL4SkwxTkWjI4nEdC5HbwWDi8XiYrE4GI+nolGRkPlC4YdpPk0mr7+aymbvx2IHhiFTiinGju+3hkKP+/oODCNvGGNDQwLGbcPDR5Z1ZFmHpkkQaqmvxwhhhCjjvBYLEPr+65fuuvL8fIAQsO2CaXKAkm1LhFy7UZ9zjFDeMD6trT3r6sKq+nluTsAYWloedncDQHpvL318DFcaeuF5ABCRJIzQ8+VleX399fj4xuQk7O9PpNMAwDivZWecAwCt+D4CCBDSn0q1hUISIZDPM86huXkkkQAADvBuZwdEESPEOCeqotyJRL5oWkHTGOc/K5WPGxtmtSptb587ju66JccRMVZHR/Orq+93d6nteQ2i6Pr+5tnZt3JZplQiRMR4WdNuNzR0hMOqopCeHshkpnM5o1qlZ46TVJRHnZ0nFxd3GxuTihJNJKC9HQQBbBs0DQ4PzxcWJjY3p7LZKmPoZjD4RFVfDgyAooBlga6DYfiVCqEUZBkEYSaTGVtacn1fd93LAppk+UYg0BoKvUqlJEJkSvfK5ZWTk6+l0q6uFyzLY6zK2F+TxAjVUVprqUmW6wVBwJhcD/EP/B4AKOgP3B2vzLEAAAAASUVORK5CYII="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefService = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/preferences-service;1"</span></span>].getService(Components.interfaces.nsIPrefService); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefBranch = prefService.getBranch(<span class="hljs-string"><span class="hljs-string">"cb_storage."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> supportsString = Components.interfaces.nsISupportsString; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uStr = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/supports-string;1"</span></span>].createInstance(supportsString); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + previousStat.commentsInfo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousStat.pageURL != keyElement.href || previousStat.commentsInfo != keyElement.textContent || previousStat.isNew) { previousStat.pageURL = keyElement.href; previousStat.commentsInfo = keyElement.textContent; previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News: "</span></span> + keyElement.textContent); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + keyElement.textContent); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Parsing error"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!prefBranch.prefHasUserValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>)) { uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({<span class="hljs-string"><span class="hljs-string">"pageURL"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"commentsInfo"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"isNew"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> QQBCgAPACwAAAAAEAAQAAAESPDJ + YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk / J8LqUPg + FRhV6z2q0VF94iJ9pOBAAh + QQBCgAPACwAAAAAEAAQAAAESPDJ + cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk / J8LqWPw + FRhV6z2q0VF94iJ9pOBAAh + QQBCgAPACwAAAAAEAAQAAAESPDJ + QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk / J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh + QQBCgAPACwAAAAAEAAQAAAESPDJ + UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk / J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh + QQBCgAPACwAAAAAEAAQAAAESPDJ + YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk / J8LqUPgeBRhV6 <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://www.nikse.dk/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/table/tbody/tr/td[2]/table/tbody/tr[1]/td[3]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">20</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJKSURBVHjalJI/axRRFMXvve/NzO7M7oaQNe5uig2aSExIiPgRFBttkhCihfkCYmNjY6NgYyWIlYWFVjFFIKRIHwNCMIkiZCF/Vth1dl1IMjtmd17ezFyLkQhq4+0u/A73nMsB+M9BAJBZ2XetL11OA/+LEEgWtVZb/iefI0aZk6PPR4uzRY4ZAJAw4ZIVGDhmYOCQdx7u1N/UZe5Kzr5oVx5V/M8+mYQSySQUCPRbjAKz49nCdKG12pJWwfI2PG/Dy1/PZ8ezKPH4w7FyVelO6cyVu+D2XO0J6oFIC0KBsYpTpVT5XjmoB8pVl55cQolzN+ZUU6mmUg2FAs3zJiAAggT+FQsQgloQtsP62zpZ1Ib26fdTjlkfaTTw7BpxxIAQfAsai42BuwNjL8dYM0qchMnCTKE4W8yMZFDgWR4ZBzEAyJwEhP1n+5SiqVdTyw+W12Ct+qKaPAoSmBOBjpGQLCrMFFIDKTKp0qlwzBMwsT69nnDuOzfxDAzCGXLsC7b30evsdYAh9MPmUjPqRNvedngchl6oDzUZNH9zfnN7s7nUlLGKhSNY80nlpFvtUorIJDKpvdW2Sla6nHaGnPJEeaWz0lptRSeR1EfaGXb6b/XrQ525nLGH7NxkbiQ3YoPtgXegDoJasPd+r/a65i64HDKa58zS7dLw42Gj14g6kT7S0Y8oVjFKFLZAAxuLjd2nu6xZexoYEADMvGn0GlbRGrw/iAaKtOh+7ba32v4Xv1vtqobiiDnkP1tLFiVfMvOmsAVKRIF/l/fnAIYyDbro6Ua2AAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAI4SURBVHjalJK/aipREMbPnDNn/YMYdGWJgiLRIqWVhYqB1PoG1nkKX8E3ECysEtLZGUgKt14RQiAoKiKI/3YXXNTsuntusVzhkupON/Ab5vu+GUL+s4AQEgqFCoWCoihCiN8EpZRzrmnabDbzPA/C4fDT01OlUvFpAPA5vxV/y3XdTqfz/v6OuVwumUx2u935fI6IjDFEpJRSSq/DlNJsNlsqlTRNw1gsNh6Px+NxoVDIZrOMse/vb13XHx4erqoGg0E+n9/v95IkUUqp4zjxeLxWq+33e13XG40GY6xer5umaZqmYRiU0lgsBgAAgEII3xYA7Ha74/H48fHBObdt2zRNIYRlWYh43Yae5wGAruuqqj4+PmYymX6/zxhLJBLlcpkQ8vn5OZlMrn7Qtm1CSDgcBoDX11dJkprNZqvVWq1WvV7PD8qn/dzQdV0A4JyXy2VZlhFxu90KIWRZLpVKPqeqqq9ZCIH+nGEYLy8viqJwzkejkeM47XbbP4vneYqiFIvFr68vy7LQcZxgMHi5XJbL5Xq9liQJERFxOp3KsqwoSjKZvL+/n0wmmqadz2e0LCuVShWLxcPhkE6nU6nU3d3d7e0tItq2bRjGbrcbDodvb2+DwcB1Xbi5ualWq41GIxKJ/Pz8WJZ1Op0cx2GMBQIBRFRV9fn5+XK5HI9HIQQQQqLRaCQSicfj9XodESVJ2mw20+l0sVis12vDMDzPc13336cF4Jz7KUWj0UAgwBijlP5+3j8DAOp7HGipYoAdAAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJtSURBVHjalFLPSxRxHP18f8zMOuu67JCLm4m2omzMIthhQaxDXjwKHuzSRZEgQoigg9AtqINIV+nSHyCJhyAMBGXNX2yoyIqJG26u6+gqszUzzszuzPfbYVUKuvRuH3iP93mPB/CfQAAQFsXBeLwjHOb/YhCE6iidzuVWNM3nHEUk6UN//4PeXuAcAAChS2Lt5BwYA87B817Mzr7d2qL3YjFVUd7MzKyfnkqECBhLhBCECEL4SkwxTkWjI4nEdC5HbwWDi8XiYrE4GI+nolGRkPlC4YdpPk0mr7+aymbvx2IHhiFTiinGju+3hkKP+/oODCNvGGNDQwLGbcPDR5Z1ZFmHpkkQaqmvxwhhhCjjvBYLEPr+65fuuvL8fIAQsO2CaXKAkm1LhFy7UZ9zjFDeMD6trT3r6sKq+nluTsAYWloedncDQHpvL318DFcaeuF5ABCRJIzQ8+VleX399fj4xuQk7O9PpNMAwDivZWecAwCt+D4CCBDSn0q1hUISIZDPM86huXkkkQAADvBuZwdEESPEOCeqotyJRL5oWkHTGOc/K5WPGxtmtSptb587ju66JccRMVZHR/Orq+93d6nteQ2i6Pr+5tnZt3JZplQiRMR4WdNuNzR0hMOqopCeHshkpnM5o1qlZ46TVJRHnZ0nFxd3GxuTihJNJKC9HQQBbBs0DQ4PzxcWJjY3p7LZKmPoZjD4RFVfDgyAooBlga6DYfiVCqEUZBkEYSaTGVtacn1fd93LAppk+UYg0BoKvUqlJEJkSvfK5ZWTk6+l0q6uFyzLY6zK2F+TxAjVUVprqUmW6wVBwJhcD/EP/B4AKOgP3B2vzLEAAAAASUVORK5CYII="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefService = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/preferences-service;1"</span></span>].getService(Components.interfaces.nsIPrefService); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefBranch = prefService.getBranch(<span class="hljs-string"><span class="hljs-string">"cb_storage."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> supportsString = Components.interfaces.nsISupportsString; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uStr = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/supports-string;1"</span></span>].createInstance(supportsString); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + previousStat.commentsInfo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousStat.pageURL != keyElement.href || previousStat.commentsInfo != keyElement.textContent || previousStat.isNew) { previousStat.pageURL = keyElement.href; previousStat.commentsInfo = keyElement.textContent; previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News: "</span></span> + keyElement.textContent); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + keyElement.textContent); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Parsing error"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!prefBranch.prefHasUserValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>)) { uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({<span class="hljs-string"><span class="hljs-string">"pageURL"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"commentsInfo"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"isNew"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> png; base64, iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA + f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJKSURBVHjalJI / axRRFMXvve / NzO7M7oaQNe5uig2aSExIiPgRFBttkhCihfkCYmNjY6NgYyWIlYWFVjFFIKRIHwNCMIkiZCF / Vth1dl1IMjtmd17ezFyLkQhq4 + 0u / A73nMsB + M9BAJBZ2XetL11OA / + LEEgWtVZb / iefI0aZk6PPR4uzRY4ZAJAw4ZIVGDhmYOCQdx7u1N / UZe5Kzr5oVx5V / M8 + mYQSySQUCPRbjAKz49nCdKG12pJWwfI2PG / Dy1 / PZ8ezKPH4w7FyVelO6cyVu + D2XO0J6oFIC0KBsYpTpVT5XjmoB8pVl55cQolzN + ZUU6mmUg2FAs3zJiAAggT + FQsQgloQtsP62zpZ1Ib26fdTjlkfaTTw7BpxxIAQfAsai42BuwNjL8dYM0qchMnCTKE4W8yMZFDgWR4ZBzEAyJwEhP1n + 5SiqVdTyw <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://www.nikse.dk/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/table/tbody/tr/td[2]/table/tbody/tr[1]/td[3]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">20</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJKSURBVHjalJI/axRRFMXvve/NzO7M7oaQNe5uig2aSExIiPgRFBttkhCihfkCYmNjY6NgYyWIlYWFVjFFIKRIHwNCMIkiZCF/Vth1dl1IMjtmd17ezFyLkQhq4+0u/A73nMsB+M9BAJBZ2XetL11OA/+LEEgWtVZb/iefI0aZk6PPR4uzRY4ZAJAw4ZIVGDhmYOCQdx7u1N/UZe5Kzr5oVx5V/M8+mYQSySQUCPRbjAKz49nCdKG12pJWwfI2PG/Dy1/PZ8ezKPH4w7FyVelO6cyVu+D2XO0J6oFIC0KBsYpTpVT5XjmoB8pVl55cQolzN+ZUU6mmUg2FAs3zJiAAggT+FQsQgloQtsP62zpZ1Ib26fdTjlkfaTTw7BpxxIAQfAsai42BuwNjL8dYM0qchMnCTKE4W8yMZFDgWR4ZBzEAyJwEhP1n+5SiqVdTyw+W12Ct+qKaPAoSmBOBjpGQLCrMFFIDKTKp0qlwzBMwsT69nnDuOzfxDAzCGXLsC7b30evsdYAh9MPmUjPqRNvedngchl6oDzUZNH9zfnN7s7nUlLGKhSNY80nlpFvtUorIJDKpvdW2Sla6nHaGnPJEeaWz0lptRSeR1EfaGXb6b/XrQ525nLGH7NxkbiQ3YoPtgXegDoJasPd+r/a65i64HDKa58zS7dLw42Gj14g6kT7S0Y8oVjFKFLZAAxuLjd2nu6xZexoYEADMvGn0GlbRGrw/iAaKtOh+7ba32v4Xv1vtqobiiDnkP1tLFiVfMvOmsAVKRIF/l/fnAIYyDbro6Ua2AAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAI4SURBVHjalJK/aipREMbPnDNn/YMYdGWJgiLRIqWVhYqB1PoG1nkKX8E3ECysEtLZGUgKt14RQiAoKiKI/3YXXNTsuntusVzhkupON/Ab5vu+GUL+s4AQEgqFCoWCoihCiN8EpZRzrmnabDbzPA/C4fDT01OlUvFpAPA5vxV/y3XdTqfz/v6OuVwumUx2u935fI6IjDFEpJRSSq/DlNJsNlsqlTRNw1gsNh6Px+NxoVDIZrOMse/vb13XHx4erqoGg0E+n9/v95IkUUqp4zjxeLxWq+33e13XG40GY6xer5umaZqmYRiU0lgsBgAAgEII3xYA7Ha74/H48fHBObdt2zRNIYRlWYh43Yae5wGAruuqqj4+PmYymX6/zxhLJBLlcpkQ8vn5OZlMrn7Qtm1CSDgcBoDX11dJkprNZqvVWq1WvV7PD8qn/dzQdV0A4JyXy2VZlhFxu90KIWRZLpVKPqeqqq9ZCIH+nGEYLy8viqJwzkejkeM47XbbP4vneYqiFIvFr68vy7LQcZxgMHi5XJbL5Xq9liQJERFxOp3KsqwoSjKZvL+/n0wmmqadz2e0LCuVShWLxcPhkE6nU6nU3d3d7e0tItq2bRjGbrcbDodvb2+DwcB1Xbi5ualWq41GIxKJ/Pz8WJZ1Op0cx2GMBQIBRFRV9fn5+XK5HI9HIQQQQqLRaCQSicfj9XodESVJ2mw20+l0sVis12vDMDzPc13336cF4Jz7KUWj0UAgwBijlP5+3j8DAOp7HGipYoAdAAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJtSURBVHjalFLPSxRxHP18f8zMOuu67JCLm4m2omzMIthhQaxDXjwKHuzSRZEgQoigg9AtqINIV+nSHyCJhyAMBGXNX2yoyIqJG26u6+gqszUzzszuzPfbYVUKuvRuH3iP93mPB/CfQAAQFsXBeLwjHOb/YhCE6iidzuVWNM3nHEUk6UN//4PeXuAcAAChS2Lt5BwYA87B817Mzr7d2qL3YjFVUd7MzKyfnkqECBhLhBCECEL4SkwxTkWjI4nEdC5HbwWDi8XiYrE4GI+nolGRkPlC4YdpPk0mr7+aymbvx2IHhiFTiinGju+3hkKP+/oODCNvGGNDQwLGbcPDR5Z1ZFmHpkkQaqmvxwhhhCjjvBYLEPr+65fuuvL8fIAQsO2CaXKAkm1LhFy7UZ9zjFDeMD6trT3r6sKq+nluTsAYWloedncDQHpvL318DFcaeuF5ABCRJIzQ8+VleX399fj4xuQk7O9PpNMAwDivZWecAwCt+D4CCBDSn0q1hUISIZDPM86huXkkkQAADvBuZwdEESPEOCeqotyJRL5oWkHTGOc/K5WPGxtmtSptb587ju66JccRMVZHR/Orq+93d6nteQ2i6Pr+5tnZt3JZplQiRMR4WdNuNzR0hMOqopCeHshkpnM5o1qlZ46TVJRHnZ0nFxd3GxuTihJNJKC9HQQBbBs0DQ4PzxcWJjY3p7LZKmPoZjD4RFVfDgyAooBlga6DYfiVCqEUZBkEYSaTGVtacn1fd93LAppk+UYg0BoKvUqlJEJkSvfK5ZWTk6+l0q6uFyzLY6zK2F+TxAjVUVprqUmW6wVBwJhcD/EP/B4AKOgP3B2vzLEAAAAASUVORK5CYII="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefService = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/preferences-service;1"</span></span>].getService(Components.interfaces.nsIPrefService); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefBranch = prefService.getBranch(<span class="hljs-string"><span class="hljs-string">"cb_storage."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> supportsString = Components.interfaces.nsISupportsString; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uStr = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/supports-string;1"</span></span>].createInstance(supportsString); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + previousStat.commentsInfo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousStat.pageURL != keyElement.href || previousStat.commentsInfo != keyElement.textContent || previousStat.isNew) { previousStat.pageURL = keyElement.href; previousStat.commentsInfo = keyElement.textContent; previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News: "</span></span> + keyElement.textContent); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + keyElement.textContent); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Parsing error"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!prefBranch.prefHasUserValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>)) { uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({<span class="hljs-string"><span class="hljs-string">"pageURL"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"commentsInfo"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"isNew"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> / a65i64HDKa58zS7dLw42Gj14g6kT7S0Y8oVjFKFLZAAxuLjd2nu6xZexoYEADMvGn0GlbRGrw / iAaKtOh + 7ba32v4Xv1vtqobiiDnkP1tLFiVfMvOmsAVKRIF / l / fnAIYyDbro6Ua2AAAAAElFTkSuQmCC "; <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://www.nikse.dk/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/table/tbody/tr/td[2]/table/tbody/tr[1]/td[3]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">20</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJKSURBVHjalJI/axRRFMXvve/NzO7M7oaQNe5uig2aSExIiPgRFBttkhCihfkCYmNjY6NgYyWIlYWFVjFFIKRIHwNCMIkiZCF/Vth1dl1IMjtmd17ezFyLkQhq4+0u/A73nMsB+M9BAJBZ2XetL11OA/+LEEgWtVZb/iefI0aZk6PPR4uzRY4ZAJAw4ZIVGDhmYOCQdx7u1N/UZe5Kzr5oVx5V/M8+mYQSySQUCPRbjAKz49nCdKG12pJWwfI2PG/Dy1/PZ8ezKPH4w7FyVelO6cyVu+D2XO0J6oFIC0KBsYpTpVT5XjmoB8pVl55cQolzN+ZUU6mmUg2FAs3zJiAAggT+FQsQgloQtsP62zpZ1Ib26fdTjlkfaTTw7BpxxIAQfAsai42BuwNjL8dYM0qchMnCTKE4W8yMZFDgWR4ZBzEAyJwEhP1n+5SiqVdTyw+W12Ct+qKaPAoSmBOBjpGQLCrMFFIDKTKp0qlwzBMwsT69nnDuOzfxDAzCGXLsC7b30evsdYAh9MPmUjPqRNvedngchl6oDzUZNH9zfnN7s7nUlLGKhSNY80nlpFvtUorIJDKpvdW2Sla6nHaGnPJEeaWz0lptRSeR1EfaGXb6b/XrQ525nLGH7NxkbiQ3YoPtgXegDoJasPd+r/a65i64HDKa58zS7dLw42Gj14g6kT7S0Y8oVjFKFLZAAxuLjd2nu6xZexoYEADMvGn0GlbRGrw/iAaKtOh+7ba32v4Xv1vtqobiiDnkP1tLFiVfMvOmsAVKRIF/l/fnAIYyDbro6Ua2AAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAI4SURBVHjalJK/aipREMbPnDNn/YMYdGWJgiLRIqWVhYqB1PoG1nkKX8E3ECysEtLZGUgKt14RQiAoKiKI/3YXXNTsuntusVzhkupON/Ab5vu+GUL+s4AQEgqFCoWCoihCiN8EpZRzrmnabDbzPA/C4fDT01OlUvFpAPA5vxV/y3XdTqfz/v6OuVwumUx2u935fI6IjDFEpJRSSq/DlNJsNlsqlTRNw1gsNh6Px+NxoVDIZrOMse/vb13XHx4erqoGg0E+n9/v95IkUUqp4zjxeLxWq+33e13XG40GY6xer5umaZqmYRiU0lgsBgAAgEII3xYA7Ha74/H48fHBObdt2zRNIYRlWYh43Yae5wGAruuqqj4+PmYymX6/zxhLJBLlcpkQ8vn5OZlMrn7Qtm1CSDgcBoDX11dJkprNZqvVWq1WvV7PD8qn/dzQdV0A4JyXy2VZlhFxu90KIWRZLpVKPqeqqq9ZCIH+nGEYLy8viqJwzkejkeM47XbbP4vneYqiFIvFr68vy7LQcZxgMHi5XJbL5Xq9liQJERFxOp3KsqwoSjKZvL+/n0wmmqadz2e0LCuVShWLxcPhkE6nU6nU3d3d7e0tItq2bRjGbrcbDodvb2+DwcB1Xbi5ualWq41GIxKJ/Pz8WJZ1Op0cx2GMBQIBRFRV9fn5+XK5HI9HIQQQQqLRaCQSicfj9XodESVJ2mw20+l0sVis12vDMDzPc13336cF4Jz7KUWj0UAgwBijlP5+3j8DAOp7HGipYoAdAAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJtSURBVHjalFLPSxRxHP18f8zMOuu67JCLm4m2omzMIthhQaxDXjwKHuzSRZEgQoigg9AtqINIV+nSHyCJhyAMBGXNX2yoyIqJG26u6+gqszUzzszuzPfbYVUKuvRuH3iP93mPB/CfQAAQFsXBeLwjHOb/YhCE6iidzuVWNM3nHEUk6UN//4PeXuAcAAChS2Lt5BwYA87B817Mzr7d2qL3YjFVUd7MzKyfnkqECBhLhBCECEL4SkwxTkWjI4nEdC5HbwWDi8XiYrE4GI+nolGRkPlC4YdpPk0mr7+aymbvx2IHhiFTiinGju+3hkKP+/oODCNvGGNDQwLGbcPDR5Z1ZFmHpkkQaqmvxwhhhCjjvBYLEPr+65fuuvL8fIAQsO2CaXKAkm1LhFy7UZ9zjFDeMD6trT3r6sKq+nluTsAYWloedncDQHpvL318DFcaeuF5ABCRJIzQ8+VleX399fj4xuQk7O9PpNMAwDivZWecAwCt+D4CCBDSn0q1hUISIZDPM86huXkkkQAADvBuZwdEESPEOCeqotyJRL5oWkHTGOc/K5WPGxtmtSptb587ju66JccRMVZHR/Orq+93d6nteQ2i6Pr+5tnZt3JZplQiRMR4WdNuNzR0hMOqopCeHshkpnM5o1qlZ46TVJRHnZ0nFxd3GxuTihJNJKC9HQQBbBs0DQ4PzxcWJjY3p7LZKmPoZjD4RFVfDgyAooBlga6DYfiVCqEUZBkEYSaTGVtacn1fd93LAppk+UYg0BoKvUqlJEJkSvfK5ZWTk6+l0q6uFyzLY6zK2F+TxAjVUVprqUmW6wVBwJhcD/EP/B4AKOgP3B2vzLEAAAAASUVORK5CYII="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefService = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/preferences-service;1"</span></span>].getService(Components.interfaces.nsIPrefService); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefBranch = prefService.getBranch(<span class="hljs-string"><span class="hljs-string">"cb_storage."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> supportsString = Components.interfaces.nsISupportsString; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uStr = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/supports-string;1"</span></span>].createInstance(supportsString); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + previousStat.commentsInfo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousStat.pageURL != keyElement.href || previousStat.commentsInfo != keyElement.textContent || previousStat.isNew) { previousStat.pageURL = keyElement.href; previousStat.commentsInfo = keyElement.textContent; previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News: "</span></span> + keyElement.textContent); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + keyElement.textContent); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Parsing error"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!prefBranch.prefHasUserValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>)) { uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({<span class="hljs-string"><span class="hljs-string">"pageURL"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"commentsInfo"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"isNew"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> png; base64, iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA + f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAI4SURBVHjalJK / aipREMbPnDNn / YMYdGWJgiLRIqWVhYqB1PoG1nkKX8E3ECysEtLZGUgKt14RQiAoKiKI / 3YXXNTsuntusVzhkupON / Ab5vu + GUL + s4AQEgqFCoWCoihCiN8EpZRzrmnabDbzPA / C4fDT01OlUvFpAPA5vxV / y3XdTqfz / v6OuVwumUx2u935fI6IjDFEpJRSSq / DlNJsNlsqlTRNw1gsNh6Px + NxoVDIZrOMse / vb13XHx4erqoGg0E + n9 / v95IkUUqp4zjxeLxWq + 33e13XG40GY6xer5umaZqmYRiU0lgsBgAAgEII3xYA7Ha74 / H48fHBObdt2zRNIYRlWYh43Yae5wGAruuqqj4 + PmYymX6 / <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://www.nikse.dk/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/table/tbody/tr/td[2]/table/tbody/tr[1]/td[3]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">20</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJKSURBVHjalJI/axRRFMXvve/NzO7M7oaQNe5uig2aSExIiPgRFBttkhCihfkCYmNjY6NgYyWIlYWFVjFFIKRIHwNCMIkiZCF/Vth1dl1IMjtmd17ezFyLkQhq4+0u/A73nMsB+M9BAJBZ2XetL11OA/+LEEgWtVZb/iefI0aZk6PPR4uzRY4ZAJAw4ZIVGDhmYOCQdx7u1N/UZe5Kzr5oVx5V/M8+mYQSySQUCPRbjAKz49nCdKG12pJWwfI2PG/Dy1/PZ8ezKPH4w7FyVelO6cyVu+D2XO0J6oFIC0KBsYpTpVT5XjmoB8pVl55cQolzN+ZUU6mmUg2FAs3zJiAAggT+FQsQgloQtsP62zpZ1Ib26fdTjlkfaTTw7BpxxIAQfAsai42BuwNjL8dYM0qchMnCTKE4W8yMZFDgWR4ZBzEAyJwEhP1n+5SiqVdTyw+W12Ct+qKaPAoSmBOBjpGQLCrMFFIDKTKp0qlwzBMwsT69nnDuOzfxDAzCGXLsC7b30evsdYAh9MPmUjPqRNvedngchl6oDzUZNH9zfnN7s7nUlLGKhSNY80nlpFvtUorIJDKpvdW2Sla6nHaGnPJEeaWz0lptRSeR1EfaGXb6b/XrQ525nLGH7NxkbiQ3YoPtgXegDoJasPd+r/a65i64HDKa58zS7dLw42Gj14g6kT7S0Y8oVjFKFLZAAxuLjd2nu6xZexoYEADMvGn0GlbRGrw/iAaKtOh+7ba32v4Xv1vtqobiiDnkP1tLFiVfMvOmsAVKRIF/l/fnAIYyDbro6Ua2AAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAI4SURBVHjalJK/aipREMbPnDNn/YMYdGWJgiLRIqWVhYqB1PoG1nkKX8E3ECysEtLZGUgKt14RQiAoKiKI/3YXXNTsuntusVzhkupON/Ab5vu+GUL+s4AQEgqFCoWCoihCiN8EpZRzrmnabDbzPA/C4fDT01OlUvFpAPA5vxV/y3XdTqfz/v6OuVwumUx2u935fI6IjDFEpJRSSq/DlNJsNlsqlTRNw1gsNh6Px+NxoVDIZrOMse/vb13XHx4erqoGg0E+n9/v95IkUUqp4zjxeLxWq+33e13XG40GY6xer5umaZqmYRiU0lgsBgAAgEII3xYA7Ha74/H48fHBObdt2zRNIYRlWYh43Yae5wGAruuqqj4+PmYymX6/zxhLJBLlcpkQ8vn5OZlMrn7Qtm1CSDgcBoDX11dJkprNZqvVWq1WvV7PD8qn/dzQdV0A4JyXy2VZlhFxu90KIWRZLpVKPqeqqq9ZCIH+nGEYLy8viqJwzkejkeM47XbbP4vneYqiFIvFr68vy7LQcZxgMHi5XJbL5Xq9liQJERFxOp3KsqwoSjKZvL+/n0wmmqadz2e0LCuVShWLxcPhkE6nU6nU3d3d7e0tItq2bRjGbrcbDodvb2+DwcB1Xbi5ualWq41GIxKJ/Pz8WJZ1Op0cx2GMBQIBRFRV9fn5+XK5HI9HIQQQQqLRaCQSicfj9XodESVJ2mw20+l0sVis12vDMDzPc13336cF4Jz7KUWj0UAgwBijlP5+3j8DAOp7HGipYoAdAAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJtSURBVHjalFLPSxRxHP18f8zMOuu67JCLm4m2omzMIthhQaxDXjwKHuzSRZEgQoigg9AtqINIV+nSHyCJhyAMBGXNX2yoyIqJG26u6+gqszUzzszuzPfbYVUKuvRuH3iP93mPB/CfQAAQFsXBeLwjHOb/YhCE6iidzuVWNM3nHEUk6UN//4PeXuAcAAChS2Lt5BwYA87B817Mzr7d2qL3YjFVUd7MzKyfnkqECBhLhBCECEL4SkwxTkWjI4nEdC5HbwWDi8XiYrE4GI+nolGRkPlC4YdpPk0mr7+aymbvx2IHhiFTiinGju+3hkKP+/oODCNvGGNDQwLGbcPDR5Z1ZFmHpkkQaqmvxwhhhCjjvBYLEPr+65fuuvL8fIAQsO2CaXKAkm1LhFy7UZ9zjFDeMD6trT3r6sKq+nluTsAYWloedncDQHpvL318DFcaeuF5ABCRJIzQ8+VleX399fj4xuQk7O9PpNMAwDivZWecAwCt+D4CCBDSn0q1hUISIZDPM86huXkkkQAADvBuZwdEESPEOCeqotyJRL5oWkHTGOc/K5WPGxtmtSptb587ju66JccRMVZHR/Orq+93d6nteQ2i6Pr+5tnZt3JZplQiRMR4WdNuNzR0hMOqopCeHshkpnM5o1qlZ46TVJRHnZ0nFxd3GxuTihJNJKC9HQQBbBs0DQ4PzxcWJjY3p7LZKmPoZjD4RFVfDgyAooBlga6DYfiVCqEUZBkEYSaTGVtacn1fd93LAppk+UYg0BoKvUqlJEJkSvfK5ZWTk6+l0q6uFyzLY6zK2F+TxAjVUVprqUmW6wVBwJhcD/EP/B4AKOgP3B2vzLEAAAAASUVORK5CYII="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefService = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/preferences-service;1"</span></span>].getService(Components.interfaces.nsIPrefService); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefBranch = prefService.getBranch(<span class="hljs-string"><span class="hljs-string">"cb_storage."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> supportsString = Components.interfaces.nsISupportsString; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uStr = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/supports-string;1"</span></span>].createInstance(supportsString); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + previousStat.commentsInfo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousStat.pageURL != keyElement.href || previousStat.commentsInfo != keyElement.textContent || previousStat.isNew) { previousStat.pageURL = keyElement.href; previousStat.commentsInfo = keyElement.textContent; previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News: "</span></span> + keyElement.textContent); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + keyElement.textContent); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Parsing error"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!prefBranch.prefHasUserValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>)) { uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({<span class="hljs-string"><span class="hljs-string">"pageURL"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"commentsInfo"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"isNew"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> + DwcB1Xbi5ualWq41GIxKJ / Pz8WJZ1Op0cx2GMBQIBRFRV9fn5 + XK5HI9HIQQQQqLRaCQSicfj9XodESVJ2mw20 + l0sVis12vDMDzPc13336cF4Jz7KUWj0UAgwBijlP5 + 3j8DAOp7HGipYoAdAAAAAElFTkSuQmCC "; <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://www.nikse.dk/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/table/tbody/tr/td[2]/table/tbody/tr[1]/td[3]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">20</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJKSURBVHjalJI/axRRFMXvve/NzO7M7oaQNe5uig2aSExIiPgRFBttkhCihfkCYmNjY6NgYyWIlYWFVjFFIKRIHwNCMIkiZCF/Vth1dl1IMjtmd17ezFyLkQhq4+0u/A73nMsB+M9BAJBZ2XetL11OA/+LEEgWtVZb/iefI0aZk6PPR4uzRY4ZAJAw4ZIVGDhmYOCQdx7u1N/UZe5Kzr5oVx5V/M8+mYQSySQUCPRbjAKz49nCdKG12pJWwfI2PG/Dy1/PZ8ezKPH4w7FyVelO6cyVu+D2XO0J6oFIC0KBsYpTpVT5XjmoB8pVl55cQolzN+ZUU6mmUg2FAs3zJiAAggT+FQsQgloQtsP62zpZ1Ib26fdTjlkfaTTw7BpxxIAQfAsai42BuwNjL8dYM0qchMnCTKE4W8yMZFDgWR4ZBzEAyJwEhP1n+5SiqVdTyw+W12Ct+qKaPAoSmBOBjpGQLCrMFFIDKTKp0qlwzBMwsT69nnDuOzfxDAzCGXLsC7b30evsdYAh9MPmUjPqRNvedngchl6oDzUZNH9zfnN7s7nUlLGKhSNY80nlpFvtUorIJDKpvdW2Sla6nHaGnPJEeaWz0lptRSeR1EfaGXb6b/XrQ525nLGH7NxkbiQ3YoPtgXegDoJasPd+r/a65i64HDKa58zS7dLw42Gj14g6kT7S0Y8oVjFKFLZAAxuLjd2nu6xZexoYEADMvGn0GlbRGrw/iAaKtOh+7ba32v4Xv1vtqobiiDnkP1tLFiVfMvOmsAVKRIF/l/fnAIYyDbro6Ua2AAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAI4SURBVHjalJK/aipREMbPnDNn/YMYdGWJgiLRIqWVhYqB1PoG1nkKX8E3ECysEtLZGUgKt14RQiAoKiKI/3YXXNTsuntusVzhkupON/Ab5vu+GUL+s4AQEgqFCoWCoihCiN8EpZRzrmnabDbzPA/C4fDT01OlUvFpAPA5vxV/y3XdTqfz/v6OuVwumUx2u935fI6IjDFEpJRSSq/DlNJsNlsqlTRNw1gsNh6Px+NxoVDIZrOMse/vb13XHx4erqoGg0E+n9/v95IkUUqp4zjxeLxWq+33e13XG40GY6xer5umaZqmYRiU0lgsBgAAgEII3xYA7Ha74/H48fHBObdt2zRNIYRlWYh43Yae5wGAruuqqj4+PmYymX6/zxhLJBLlcpkQ8vn5OZlMrn7Qtm1CSDgcBoDX11dJkprNZqvVWq1WvV7PD8qn/dzQdV0A4JyXy2VZlhFxu90KIWRZLpVKPqeqqq9ZCIH+nGEYLy8viqJwzkejkeM47XbbP4vneYqiFIvFr68vy7LQcZxgMHi5XJbL5Xq9liQJERFxOp3KsqwoSjKZvL+/n0wmmqadz2e0LCuVShWLxcPhkE6nU6nU3d3d7e0tItq2bRjGbrcbDodvb2+DwcB1Xbi5ualWq41GIxKJ/Pz8WJZ1Op0cx2GMBQIBRFRV9fn5+XK5HI9HIQQQQqLRaCQSicfj9XodESVJ2mw20+l0sVis12vDMDzPc13336cF4Jz7KUWj0UAgwBijlP5+3j8DAOp7HGipYoAdAAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJtSURBVHjalFLPSxRxHP18f8zMOuu67JCLm4m2omzMIthhQaxDXjwKHuzSRZEgQoigg9AtqINIV+nSHyCJhyAMBGXNX2yoyIqJG26u6+gqszUzzszuzPfbYVUKuvRuH3iP93mPB/CfQAAQFsXBeLwjHOb/YhCE6iidzuVWNM3nHEUk6UN//4PeXuAcAAChS2Lt5BwYA87B817Mzr7d2qL3YjFVUd7MzKyfnkqECBhLhBCECEL4SkwxTkWjI4nEdC5HbwWDi8XiYrE4GI+nolGRkPlC4YdpPk0mr7+aymbvx2IHhiFTiinGju+3hkKP+/oODCNvGGNDQwLGbcPDR5Z1ZFmHpkkQaqmvxwhhhCjjvBYLEPr+65fuuvL8fIAQsO2CaXKAkm1LhFy7UZ9zjFDeMD6trT3r6sKq+nluTsAYWloedncDQHpvL318DFcaeuF5ABCRJIzQ8+VleX399fj4xuQk7O9PpNMAwDivZWecAwCt+D4CCBDSn0q1hUISIZDPM86huXkkkQAADvBuZwdEESPEOCeqotyJRL5oWkHTGOc/K5WPGxtmtSptb587ju66JccRMVZHR/Orq+93d6nteQ2i6Pr+5tnZt3JZplQiRMR4WdNuNzR0hMOqopCeHshkpnM5o1qlZ46TVJRHnZ0nFxd3GxuTihJNJKC9HQQBbBs0DQ4PzxcWJjY3p7LZKmPoZjD4RFVfDgyAooBlga6DYfiVCqEUZBkEYSaTGVtacn1fd93LAppk+UYg0BoKvUqlJEJkSvfK5ZWTk6+l0q6uFyzLY6zK2F+TxAjVUVprqUmW6wVBwJhcD/EP/B4AKOgP3B2vzLEAAAAASUVORK5CYII="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefService = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/preferences-service;1"</span></span>].getService(Components.interfaces.nsIPrefService); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefBranch = prefService.getBranch(<span class="hljs-string"><span class="hljs-string">"cb_storage."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> supportsString = Components.interfaces.nsISupportsString; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uStr = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/supports-string;1"</span></span>].createInstance(supportsString); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + previousStat.commentsInfo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousStat.pageURL != keyElement.href || previousStat.commentsInfo != keyElement.textContent || previousStat.isNew) { previousStat.pageURL = keyElement.href; previousStat.commentsInfo = keyElement.textContent; previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News: "</span></span> + keyElement.textContent); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + keyElement.textContent); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Parsing error"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!prefBranch.prefHasUserValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>)) { uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({<span class="hljs-string"><span class="hljs-string">"pageURL"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"commentsInfo"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"isNew"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> png; base64, iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA + f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJtSURBVHjalFLPSxRxHP18f8zMOuu67JCLm4m2omzMIthhQaxDXjwKHuzSRZEgQoigg9AtqINIV + nSHyCJhyAMBGXNX2yoyIqJG26u6 + gqszUzzszuzPfbYVUKuvRuH3iP93mPB / CfQAAQFsXBeLwjHOb / YhCE6iidzuVWNM3nHEUk6UN // 4PeXuAcAAChS2Lt5BwYA87B817Mzr7d2qL3YjFVUd7MzKyfnkqECBhLhBCECEL4SkwxTkWjI4nEdC5HbwWDi8XiYrE4GI + nolGRkPlC4YdpPk0mr7 + aymbvx2IHhiFTiinGju + 3hkKP + / oODCNvGGNDQwLGbcPDR5Z1ZFmHpkkQaqmvxwhhhCjjvBYLEPr + 65fuuvL8fIAQsO2CaXKAkm1LhFy7UZ9zjFDeMD6trT3r6sKq + nluTsAYWloedncDQHpvL318DFcaeuF5ABCRJIzQ8 + VleX399fj4xuQk7O9PpNMAwDivZWecAwCt + D4CCBDSn0q1hUISIZDPM86huXkkkQAADvBuZwdEESPEOCeqotyJRL5oWkHTGOc / K5WPGxtmtSptb587ju66JccRMVZHR / Orq + 93d6nteQ2i6Pr + 5tnZt3JZplQiRMR4WdNuNzR0hMOqopCeHshkpnM5o1qlZ46TVJRHnZ0nFxd3GxuTihJNJKC9HQQBbBs0DQ4PzxcWJjY3p7LZKmPoZjD4RFVfDgyAooBlga6DYfiVCqEUZBkEYSaTGVtacn1fd93LAppk <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://www.nikse.dk/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElementXPath = <span class="hljs-string"><span class="hljs-string">"/html/body/table/tbody/tr/td[2]/table/tbody/tr[1]/td[3]/a"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">20</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgThrobber = <span class="hljs-string"><span class="hljs-string">"data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJKSURBVHjalJI/axRRFMXvve/NzO7M7oaQNe5uig2aSExIiPgRFBttkhCihfkCYmNjY6NgYyWIlYWFVjFFIKRIHwNCMIkiZCF/Vth1dl1IMjtmd17ezFyLkQhq4+0u/A73nMsB+M9BAJBZ2XetL11OA/+LEEgWtVZb/iefI0aZk6PPR4uzRY4ZAJAw4ZIVGDhmYOCQdx7u1N/UZe5Kzr5oVx5V/M8+mYQSySQUCPRbjAKz49nCdKG12pJWwfI2PG/Dy1/PZ8ezKPH4w7FyVelO6cyVu+D2XO0J6oFIC0KBsYpTpVT5XjmoB8pVl55cQolzN+ZUU6mmUg2FAs3zJiAAggT+FQsQgloQtsP62zpZ1Ib26fdTjlkfaTTw7BpxxIAQfAsai42BuwNjL8dYM0qchMnCTKE4W8yMZFDgWR4ZBzEAyJwEhP1n+5SiqVdTyw+W12Ct+qKaPAoSmBOBjpGQLCrMFFIDKTKp0qlwzBMwsT69nnDuOzfxDAzCGXLsC7b30evsdYAh9MPmUjPqRNvedngchl6oDzUZNH9zfnN7s7nUlLGKhSNY80nlpFvtUorIJDKpvdW2Sla6nHaGnPJEeaWz0lptRSeR1EfaGXb6b/XrQ525nLGH7NxkbiQ3YoPtgXegDoJasPd+r/a65i64HDKa58zS7dLw42Gj14g6kT7S0Y8oVjFKFLZAAxuLjd2nu6xZexoYEADMvGn0GlbRGrw/iAaKtOh+7ba32v4Xv1vtqobiiDnkP1tLFiVfMvOmsAVKRIF/l/fnAIYyDbro6Ua2AAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgNoNews = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAI4SURBVHjalJK/aipREMbPnDNn/YMYdGWJgiLRIqWVhYqB1PoG1nkKX8E3ECysEtLZGUgKt14RQiAoKiKI/3YXXNTsuntusVzhkupON/Ab5vu+GUL+s4AQEgqFCoWCoihCiN8EpZRzrmnabDbzPA/C4fDT01OlUvFpAPA5vxV/y3XdTqfz/v6OuVwumUx2u935fI6IjDFEpJRSSq/DlNJsNlsqlTRNw1gsNh6Px+NxoVDIZrOMse/vb13XHx4erqoGg0E+n9/v95IkUUqp4zjxeLxWq+33e13XG40GY6xer5umaZqmYRiU0lgsBgAAgEII3xYA7Ha74/H48fHBObdt2zRNIYRlWYh43Yae5wGAruuqqj4+PmYymX6/zxhLJBLlcpkQ8vn5OZlMrn7Qtm1CSDgcBoDX11dJkprNZqvVWq1WvV7PD8qn/dzQdV0A4JyXy2VZlhFxu90KIWRZLpVKPqeqqq9ZCIH+nGEYLy8viqJwzkejkeM47XbbP4vneYqiFIvFr68vy7LQcZxgMHi5XJbL5Xq9liQJERFxOp3KsqwoSjKZvL+/n0wmmqadz2e0LCuVShWLxcPhkE6nU6nU3d3d7e0tItq2bRjGbrcbDodvb2+DwcB1Xbi5ualWq41GIxKJ/Pz8WJZ1Op0cx2GMBQIBRFRV9fn5+XK5HI9HIQQQQqLRaCQSicfj9XodESVJ2mw20+l0sVis12vDMDzPc13336cF4Jz7KUWj0UAgwBijlP5+3j8DAOp7HGipYoAdAAAAAElFTkSuQmCC"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgErrorOrTimeout = <span class="hljs-string"><span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJtSURBVHjalFLPSxRxHP18f8zMOuu67JCLm4m2omzMIthhQaxDXjwKHuzSRZEgQoigg9AtqINIV+nSHyCJhyAMBGXNX2yoyIqJG26u6+gqszUzzszuzPfbYVUKuvRuH3iP93mPB/CfQAAQFsXBeLwjHOb/YhCE6iidzuVWNM3nHEUk6UN//4PeXuAcAAChS2Lt5BwYA87B817Mzr7d2qL3YjFVUd7MzKyfnkqECBhLhBCECEL4SkwxTkWjI4nEdC5HbwWDi8XiYrE4GI+nolGRkPlC4YdpPk0mr7+aymbvx2IHhiFTiinGju+3hkKP+/oODCNvGGNDQwLGbcPDR5Z1ZFmHpkkQaqmvxwhhhCjjvBYLEPr+65fuuvL8fIAQsO2CaXKAkm1LhFy7UZ9zjFDeMD6trT3r6sKq+nluTsAYWloedncDQHpvL318DFcaeuF5ABCRJIzQ8+VleX399fj4xuQk7O9PpNMAwDivZWecAwCt+D4CCBDSn0q1hUISIZDPM86huXkkkQAADvBuZwdEESPEOCeqotyJRL5oWkHTGOc/K5WPGxtmtSptb587ju66JccRMVZHR/Orq+93d6nteQ2i6Pr+5tnZt3JZplQiRMR4WdNuNzR0hMOqopCeHshkpnM5o1qlZ46TVJRHnZ0nFxd3GxuTihJNJKC9HQQBbBs0DQ4PzxcWJjY3p7LZKmPoZjD4RFVfDgyAooBlga6DYfiVCqEUZBkEYSaTGVtacn1fd93LAppk+UYg0BoKvUqlJEJkSvfK5ZWTk6+l0q6uFyzLY6zK2F+TxAjVUVprqUmW6wVBwJhcD/EP/B4AKOgP3B2vzLEAAAAASUVORK5CYII="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> btn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMParser(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefService = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/preferences-service;1"</span></span>].getService(Components.interfaces.nsIPrefService); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prefBranch = prefService.getBranch(<span class="hljs-string"><span class="hljs-string">"cb_storage."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> supportsString = Components.interfaces.nsISupportsString; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uStr = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/supports-string;1"</span></span>].createInstance(supportsString); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickBtn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">0</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.button == <span class="hljs-number"><span class="hljs-number">1</span></span>) { event.preventDefault(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(checker); checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + previousStat.commentsInfo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gBrowser.selectedBrowser.currentURI.spec == <span class="hljs-string"><span class="hljs-string">"about:blank"</span></span> &amp;&amp; !gBrowser.selectedBrowser.webProgress.isLoadingDocument) { gBrowser.selectedBrowser.loadURI(pageURL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gBrowser.selectedTab = gBrowser.addTab(pageURL); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pageURL, pureXHR</span></span></span><span class="hljs-function">) </span></span>{ btn.image = imgThrobber; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.mozBackgroundRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.timeout = <span class="hljs-number"><span class="hljs-number">3000</span></span>; xhr.channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE; xhr.channel.QueryInterface(Components.interfaces.nsIHttpChannelInternal) .forceAllowThirdPartyCookie = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pureXHR) { xhr.responseType = <span class="hljs-string"><span class="hljs-string">"document"</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseXML); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getDoc(pageURL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ processDoc(parser.parseFromString(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>)); } xhr.ontimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Timeout"</span></span>); } } xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" HTTP error"</span></span>); } xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyElement = doc.evaluate(keyElementXPath, doc, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, XPathResult.FIRST_ORDERED_NODE_TYPE, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).singleNodeValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyElement) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousStat = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(prefBranch.getComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString).data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousStat.pageURL != keyElement.href || previousStat.commentsInfo != keyElement.textContent || previousStat.isNew) { previousStat.pageURL = keyElement.href; previousStat.commentsInfo = keyElement.textContent; previousStat.isNew = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(previousStat); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); btn.image = imgNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" News: "</span></span> + keyElement.textContent); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgNoNews; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" No news: "</span></span> + keyElement.textContent); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { btn.image = imgErrorOrTimeout; btn.tooltipText = ((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).toLocaleString() + <span class="hljs-string"><span class="hljs-string">" Parsing error"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!prefBranch.prefHasUserValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>)) { uStr.data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({<span class="hljs-string"><span class="hljs-string">"pageURL"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"commentsInfo"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"isNew"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}); prefBranch.setComplexValue(<span class="hljs-string"><span class="hljs-string">"Subtitle_Edit"</span></span>, supportsString, uStr); prefService.savePrefFile(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } btn.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); btn.onDestroy = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ btn.removeEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, clickBtn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(getDoc, delay, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> checker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(getDoc, interval, pageURL, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre><br><br>   ,      :         .       ,    (         ,    ).         (***ComplexValue),         . <br><br>            (    ,      JSON,  ,           ). <br><br>       .    ,            (   ,            :           ,      ,           ).           ,            .     ,         ,     ,            . <br><br>         ,          : ,          .        (    ),   ,              . <br><br> ,  -,     .           XPath  .              .               ,          . <br><br>      :     ,      ,       (,        )   .         Firefox          Custom Buttons. <br><br>  ,  .    ) </div><p>Source: <a href="https://habr.com/ru/post/146594/">https://habr.com/ru/post/146594/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146589/index.html">Yii: Dynamic change of validation rules (scripts)</a></li>
<li><a href="../146590/index.html">Overview of Android applications for creating panoramic images</a></li>
<li><a href="../146591/index.html">Storing passwords in Ozon.ru</a></li>
<li><a href="../146592/index.html">MySQL is a million times faster than MemSQL</a></li>
<li><a href="../146593/index.html">Atlassian Office in San Francisco</a></li>
<li><a href="../146595/index.html">Split testing: how it works for us</a></li>
<li><a href="../146596/index.html">C11 corrects errors C99</a></li>
<li><a href="../146597/index.html">Sypex Geo - quick city identification by IP</a></li>
<li><a href="../146598/index.html">VK :: App - a module for creating client applications in vk.com</a></li>
<li><a href="../146601/index.html">How we develop programs for Android in Parcsis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>