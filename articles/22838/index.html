<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Background upload files to server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All those who use GMail and Habrahabr's regulars noticed that attached files are slowly uploaded to the server after several seconds of inactivity, an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Background upload files to server</h1><div class="post__text post__text-html js-mediator-article">  All those who use GMail and Habrahabr's regulars noticed that attached files are slowly uploaded to the server after several seconds of inactivity, and then the fields with file names are replaced with checkboxes. <br><br>  I implemented similar functionality in a single Django project using JQuery. <br>  When a user chooses a logo for a business card, the logo file is transparently uploaded to the server, processed and then "given" to the browser.  and the user sees that in the layout the logo has changed to the one he chooses. <br><a name="habracut"></a><br>  <strong>Implementation</strong> <br><br>  After the page loads, a periodic call to the <strong>LoadLogotype ()</strong> function is <strong>launched.</strong> <br><blockquote>  var previous_logo = ""; 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      // ------------------------------------------------ ----------------------------- <br>  function LoadLogotype () { <br>  var card_logo = $ ("# card_logo"). val (); <br>  if ((card_logo! = "") &amp;&amp; (previous_logo! = card_logo)) { <br>  previous_logo = card_logo; <br>  $ ("# uploadphoto"). submit (); <br>  } <br>  } <br>  // ------------------------------------------------ ----------------------------- <br>  $ (function () { <br>  setInterval ("LoadLogotype ()", 1000); <br>  }); <br></blockquote><br>  The LoadLogotype () function checks whether the logo file is selected or changed and, if so, sends <strong>the uploadphoto</strong> form to the server. <br><br>  The form has the parameter <strong>target = ‚Äúupload_frame‚Äù</strong> , that is, it will not initiate the transition to another page.  All changes will only affect the hidden frame.  After sending the form in this frame, load the result returned by the server. <br><blockquote>  ... <br>  form id = "uploadphoto" target = "upload_frame" enctype = "multipart / form-data" action = "/ upload_logo /" method = "post"&gt; <br>  Logo: / form&gt; <br>  ... <br>  iframe id = "upload_frame" name = "upload_frame" style = "display: none"&gt; <br>  ... <br><br>  The server load logo processing function saves the file in the user's folder.  Also the downloaded file is checked according to the list allowed_files - protection against the user downloading unauthorized files. <br>  As a result, the function gives the URL to the file. <br><blockquote>  # ------------------------------------------------- ----------------------------- <br>  def upload_logo (request): <br>  'Handles upload of logo images' <br><br>  alloved_files = ('.jpg', '.jpeg', '.png', '.gif') <br><br>  id = request.session ['our_id'] <br>  path = settings.MEDIA_ROOT + 'uploads /% s /'% id <br>  if not os.path.isdir (path): <br>  try: <br>  os.makedirs (path) <br>  except: <br>  return "Error: couldn‚Äôt create directory to upload files!" <br>  for image_file in request.FILES: <br>  filename = request.FILES [image_file] ['filename'] <br>  name, ext = os.path.splitext (filename) <br>  if ext not in alloved_files: <br>  continue <br>  if filename == '': <br>  continue <br>  content = request.FILES [image_file] ['content'] <br>  f = open (path + filename, 'wb') <br>  try: <br>  f.write (content) <br>  finally: <br>  f.close () <br><br>  content = { <br>  "Image": "/ appmedia / uploads /% s /% s"% (id, filename), <br>  } <br>  return render_to_response ("done.html", content, context_instance = RequestContext (request)) <br></blockquote><br>  The result of rendering the <strong>done.html</strong> template will fall into the invisible IFRAME <strong>‚Äúupload_frame‚Äù</strong> .  The script finds the <strong>card_logotype</strong> element in the parent document and replaces the URL of the image with the one sent by the server. <br><blockquote>  html&gt; <br>  head&gt; <br>  script language = "JavaScript" type = "text / javascript"&gt; <br>  parent.document.getElementById ('card_logotype'). src = "{{image}}" <br>  / script&gt; <br>  / head&gt; <br>  body&gt; <br>  / body&gt; <br>  / html&gt; <br></blockquote><br>  As a result, the user sees a change in the logo on the selected picture.  The whole process takes place without a full page refresh.  Only the contents of the hidden frame and the logo image are changed. <br><br>  You can see how it works here: <a href="http://bicards.pythondevside.com/">http://bicards.pythondevside.com/</a> <br></blockquote><br>  <a href="http://konkursof.blogspot.com/2008/04/blog-post_03.html">Original post</a> </div><p>Source: <a href="https://habr.com/ru/post/22838/">https://habr.com/ru/post/22838/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../228371/index.html">Link Doctrine Entity and Doctrine Document on the form in the Sonata Admin Bundle</a></li>
<li><a href="../228373/index.html">The eight queen problem on Oracle SQL (another solution)</a></li>
<li><a href="../228375/index.html">Effective or effective? Master class on creating a site design</a></li>
<li><a href="../228377/index.html">Feature # 3 - Podcast on entrepreneurs and current trends in the IT ecosystem</a></li>
<li><a href="../228379/index.html">The practice of programming games in python: life</a></li>
<li><a href="../228383/index.html">Serious design of a serious store. Part 3. Card product and not only</a></li>
<li><a href="../228385/index.html">9 things that I learned as a programmer, and that I would like to know when I entered the magistracy</a></li>
<li><a href="../228389/index.html">Elliptics from Yandex. How to use it to create your fault-tolerant storage</a></li>
<li><a href="../228391/index.html">Wind generator energetically pays off in 5-7 months</a></li>
<li><a href="../228393/index.html">Annual online conference MegaIndex.tv 2014</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>