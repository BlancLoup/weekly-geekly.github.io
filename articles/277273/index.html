<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Java rake</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, in our company, among developers, there was a competition for knowledge of the pitfalls of the Java language. The winners received honors an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Java rake</h1><div class="post__text post__text-html js-mediator-article"><img height="150" src="https://habrastorage.org/files/176/b18/5c8/176b185c82f940469e0b2ae33c18c24b.jpg" align="left">  Recently, in our company, among developers, there was a competition for knowledge of the pitfalls of the Java language.  The winners received honors and prizes, all received a lot of positive, as well as reasons for reflection and discussion.  Hot on the heels we hurry to share the most interesting questions sounded on the quiz with habrew sociality.  If you are new to Java or professional, but want to brush up on the dark side of the language, welcome under cat.  There you are waiting for 4 tricky questions with answers, rationales and conclusions. <br><a name="habracut"></a><br><br>  Let's start with the classic <s>accordion</s> about the packaging of primitives. <br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(Byte.valueOf((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">48</span></span>) == Byte.valueOf((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">48</span></span>)); System.out.println(Byte.valueOf((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">248</span></span>) == Byte.valueOf((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">248</span></span>)); System.out.println(Integer.valueOf(<span class="hljs-number"><span class="hljs-number">48</span></span>) == Integer.valueOf(<span class="hljs-number"><span class="hljs-number">48</span></span>)); System.out.println(Integer.valueOf(<span class="hljs-number"><span class="hljs-number">248</span></span>) == Integer.valueOf(<span class="hljs-number"><span class="hljs-number">248</span></span>)); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Answer:</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><br>  Flick dust off a book called the Java Language Specification (JLS).  Clause <a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-5.html">5.1.7.</a>  guarantees the return of <i>the same</i> object during boxing byte.  When boxing int too.  But only for the range -128..127.  Our JVM, strictly following the specification, in the first three cases returns the same object for both parts of the equality, and in the latter - two different. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>UPD:</b> As <a href="https://habrahabr.ru/users/senia/" class="user_link">senia</a> correctly noted in the comments, according to JLS, int caching outside this range is -128..127 possible, but not necessary. <br><br>  <b>Moral:</b> Boxing is hard. <br>  <b>Another moral:</b> In order not to get confused, any objects should be compared through <i>equals ()</i> and not through <i>==</i> .  Except for the case when we need to explicitly determine that two links point to the same instance. <br></div></div><br><br>  Moving on.  A simple example of complex initialization.  What will this code output? <br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TrickyClass</span></span></span><span class="hljs-class"> </span></span>{ { value = <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value = <span class="hljs-number"><span class="hljs-number">20</span></span>; { value = <span class="hljs-number"><span class="hljs-number">30</span></span>;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TrickyClass().getValue()); } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Answer:</b> <div class="spoiler_text"><pre> <code class="hljs">30</code> </pre> <br>  Let's look at paragraph <a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-12.html">12.5.</a>  Jls.  The order of initialization of the object is as follows: <br><ol><li>  Perform initialization of the parent class. </li><li>  Execute the field initializers and instance initializers (and the strange parts of the code in curly brackets are what they are) <i>in order</i> . </li><li>  Execution of the class constructor. </li></ol><br><br>  In our case, the initializer <i>{value = 30;}</i> will be executed last, and this value will remain in the field. <br></div></div><br><br>  Another question about initialization.  What will this code output? <br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Base</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(getName()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Base"</span></span>;} } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Derived</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Base</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name = <span class="hljs-string"><span class="hljs-string">"Derived"</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Derived(); } }</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text"><pre> <code class="hljs cs"> <span class="hljs-literal"><span class="hljs-literal">null</span></span></code> </pre> <br>  According to the already familiar point <a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-12.html">12.5.</a>  , there are no special rules for overloaded methods when calling them from the constructor.  In our particular case, the method of the child class Derived, which honestly tries to return the value of the name field to its parent constructor, is twitching.  Unfortunately, the initialization of this field has not yet occurred, because  field initializers are executed after calling the parent constructor.  Therefore, the name contains a valid <i>null</i> . <br><br>  <b>Moral</b> : Never call non-final methods in constructors.  But if you have a final class, then you can. <br></div></div><br><br>  And for dessert, a little serialization <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String name; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readResolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User(<span class="hljs-string"><span class="hljs-string">"Darth Vader"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ User user = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User(<span class="hljs-string"><span class="hljs-string">"Anakin Skywalker"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Serialize user ByteArrayOutputStream outputStream = new ByteArrayOutputStream(); new ObjectOutputStream(outputStream).writeObject(user); // Deserialize user ByteArrayInputStream inputStreamStream = new ByteArrayInputStream(outputStream.toByteArray()); User readUser = (User) new ObjectInputStream(inputStreamStream).readObject(); System.out.println(readUser.name); } }</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Answer:</b> <div class="spoiler_text"><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">Darth</span></span> Vader</code> </pre> <br><br>  Serialization in Java is so extensive and dark subject that <s>the devil himself will break a leg</s> for her there is a separate specification <a href="https://docs.oracle.com/javase/7/docs/platform/serialization/spec/serialTOC.html">Java Object Serialization Specification</a> .  Clause <a href="https://docs.oracle.com/javase/7/docs/platform/serialization/spec/input.html">3.7</a> states that if the readResolve method is declared on the object being deserialized, this method will be called after reading the object from the stream.  And the result of this particular method is considered the result of deserialization.  A typical example of using this trick is serialization / deserialization of singletons.  Using readResolve along with other special methods readObject, writeObject, writeReplace allows very flexible control over the process of object serialization. <br><br>  <b>Moral:</b> The process of serialization of objects in Java must be approached very carefully and provide for various options for its use.  If the problem can be solved without a serialization mechanism, then it is better to do so. </div></div><br><br>  In general, Java is a well-designed language.  There is little rake here, it is difficult to advance.  But their knowledge may one day save you a cloud of nerves and hours of debugging code. </div><p>Source: <a href="https://habr.com/ru/post/277273/">https://habr.com/ru/post/277273/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277259/index.html">Opinion: Why spam is so hard to beat</a></li>
<li><a href="../277261/index.html">How ill-conceived compiler warnings help to spoil completely correct code.</a></li>
<li><a href="../277265/index.html">Zabbix 3.0 released</a></li>
<li><a href="../277267/index.html">In-depth training in the garage - Data Brotherhood</a></li>
<li><a href="../277269/index.html">I'm sitting in the cloud, working</a></li>
<li><a href="../277275/index.html">Finger Math: Least Squares</a></li>
<li><a href="../277279/index.html">Safety means of security: ACS</a></li>
<li><a href="../277283/index.html">Meeting report Moscow CocoaHeads January 29</a></li>
<li><a href="../277285/index.html">HPE Smart Cache: are you already speeding up?</a></li>
<li><a href="../277289/index.html">Arguments against the use of fragments in Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>