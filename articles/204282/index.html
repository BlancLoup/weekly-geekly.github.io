<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Architecture of Yandex Search. Lecture for the Small ShAD</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this lecture, on the example of Yandex, the basic components necessary for organizing an Internet search engine will be considered. We will talk ab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Architecture of Yandex Search. Lecture for the Small ShAD</h1><div class="post__text post__text-html js-mediator-article">  In this lecture, on the example of Yandex, the basic components necessary for organizing an Internet search engine will be considered.  We will talk about how these components interact and what features they have.  You will also learn what document ranking is and how search quality is measured. <br><br>  <a href="http://tech.yandex.ru/education/m/shad/talks/1411/">The lecture is</a> designed for high school students - students of the Small ShAD, but adults can learn from it a lot about the search engine device. <br><br><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://video.yandex.ru/iframe/e1coyot/mz24oys75c.7204/&amp;xid=25657,15700022,15700043,15700186,15700191,15700253,15700256&amp;usg=ALkJrhhJFvPh0lPoSrvvZou5VX3ux3C6ag" width="450" height="147" frameborder="0" scrolling="no" allowfullscreen="1"></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://video.yandex.ru/iframe/e1coyot/fnjga65xpx.7618/&amp;xid=25657,15700022,15700043,15700186,15700191,15700253,15700256&amp;usg=ALkJrhgT-N8MzSE7h-IlJbUF9gkcePgzJw" width="450" height="147" frameborder="0" scrolling="no" allowfullscreen="1"></iframe><br><br>  The first component of our search engine is Spider.  He walks on the Internet and tries to download as much information as possible.  The robot processes documents in such a way that it is easier to search by them.  It is not very convenient to search for simple html files.  They are very big, there is a lot of excess.  The robot cuts off all unnecessary and makes it convenient to search through documents.  Well, directly search, which receives requests and gives answers. <br><a name="habracut"></a><br><br><img src="https://habrastorage.org/getpro/habr/post_images/328/c8f/c7a/328c8fc7a4cfa417cf81a672e04a91df.png" alt="image"><br><br><h5>  Spider </h5><br>  How to understand how well Spider works?  First metric - what percentage of sites we saw.  The second metric is how quickly we can notice changes. <br>  Runet: <br><ul><li>  Rocking servers: 300; </li><li>  Load: 20,000 documents per second; </li><li>  Traffic: 400 MB / s (3200 Mbit / s). </li></ul><br>  Together: <br><ul><li>  Rocking servers: 700; </li><li>  Load: 35,000 documents per second; </li><li>  Traffic: 700 MB / s (5600 Mbit / s). </li></ul><br>  If the entire Spider starts downloading one site with all its servers, you will get a fairly powerful DDoS attack.  To prevent such situations, the Zora component is provided.  He coordinates downloads, knows which sites have been cached recently, and which ones should be spent in the near future. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a10/a07/60e/a10a0760e00f04a67f37a9ce99eeccbb.png" alt="image"><br><br>  The spider should be able to look at the page from different points to make sure that, for example, from Russia and from the USA the pages look the same.  If there are different pages for different regions, he should take into account and process this information. <br><br><h5>  Robot </h5><br>  Spider-downloaded pages go to a robot that processes them and makes them searchable.  First of all, the entire html markup is deleted, important sections are determined. <br>  Robot consists of three components.  First, it is MapReduce distributed computing system, which allows you to calculate the properties for each document that Spider has downloaded.  The second component is a cluster of servers that build a search index.  Well, the third component is an archive containing several versions of the search base. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7cf/32a/3d8/7cf32a3d8ca9c7c182c87b2d38650601.png" alt="image"><br><br>  We mentioned document properties.  What do we mean by this concept?  Suppose we downloaded an html file, and we need to collect as much data as possible about its content.  MapReduce carries out calculations and puts labels on the document, which will later be used as ranking factors: document language, subject matter, commercial orientation, etc. <br>  Factors are of two types: fast and slow.  Slow factors are counted only once and are assigned exclusively to the document.  Quick are calculated for the document along with the search query. <br>  Even if you do not take into account the MapReduce server (they can be used for other tasks), the Robot represents more than two thousand servers. <br>  Russian base: <br><ul><li>  Factor Cluster: 650; </li><li>  Cooking search database: 169; </li><li>  Test servers: 878; </li><li>  Archive: 172. </li></ul><br>  World Base: <br><ul><li>  Factor Cluster: 301; </li><li>  Cooking search database: 120; </li><li>  Test servers: ???; </li><li>  Archive: 60. </li></ul><br>  The database contains about 25 billion documents (214 TB), twice a week it is completely recalculated. <br><br>  Search index device <br>  Suppose we have three very simple documents containing short texts: <br><ul><li>  Mom washed the frame </li><li>  Rama in Moscow buy </li><li>  Moscow for moms </li></ul><br>  It‚Äôs ineffective to look through all these documents every time a request comes in searching for the words it contains.  Therefore, an inverted index is created: we write out all the words from the three documents (excluding word forms) and indicate where they occur. <br><br>  Mom (1, 3) <br>  Wash (1) <br>  Frame (1, 2) <br>  Moscow (2, 3) <br>  Buy (2) <br>  AT 2) <br>  For (3) <br><br>  Now if we receive a search query [mother], we will already have a ready answer.  It will be enough for us to glance once in the table to find out in which documents this word is found.  If the request contains more than one word (for example, [Mama Moscow]), in the same table the Robot will be able to find documents in which both of these words appear.  In our case, this is the third document. <br>  As we have said, the size of our real search index is 214 TB.  For Search to work with sufficient speed and efficiency, all this data must be stored in RAM.  Now we have servers in which from 24 to 128 GB of memory are installed.  To optimize, we divide the search base into ranges (from the English. Tier - level).  With their help, we divide documents by language and other features.  Therefore, when we receive a request in Russian, we are able to conduct a search only on the relevant documents.  We have a total of over ten such galleries.  Tyra are divided into shards of 32 gigabytes: the amount of data that can be stored in the memory of a physical machine.  Now we have about 6,700 shards. <br><br><h5>  Work with query </h5><br>  The search flow to Yandex can reach 36,000 hits per second.  Just getting such traffic is a serious task.  To solve it there are several levels of balancing.  DNS is used as the first level.  L3 balancer is responsible for distributing packets, and http balancer is responsible for processing their contents.  First of all, requests from robots are cut off.  Then corrected typos and analysis of the request.  The result is a "query tree" containing the possible spellings of the query and the likely meanings.  After all this processing, the request is sent to the frontend, and the search begins directly.  In addition to the main search in all the documents contained in the database, there are many more small searches with certain parameters.  For example, by pictures, video, poster, etc.  If these searches give relevant results, they will be mixed into the main search results. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e5f/a59/bc4/e5fa59bc46b0c523466a66795fed133c.png" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/204282/">https://habr.com/ru/post/204282/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../204264/index.html">STM32 + Visual Studio</a></li>
<li><a href="../204266/index.html">Methods of anonymity online. Part 4. Tor & VPN. Whonix</a></li>
<li><a href="../204274/index.html">Wireshark - taming a shark</a></li>
<li><a href="../204276/index.html">How to use pirates to your advantage</a></li>
<li><a href="../204278/index.html">Errors in the certification of the application in the Windows Store</a></li>
<li><a href="../204284/index.html">Why do developers constantly make mistakes when assessing deadlines by a factor of 2-3?</a></li>
<li><a href="../204286/index.html">Cross-platform GUI on C # and web technologies</a></li>
<li><a href="../204288/index.html">OCZ pleaded bankrupt</a></li>
<li><a href="../204292/index.html">Parallels Cloud Server Automated Testing</a></li>
<li><a href="../204294/index.html">Useful books on online trading and marketing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>