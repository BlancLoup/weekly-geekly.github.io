<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Restoring another PDP-11/04</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Translation of the article on the restoration of another PDP-11/04. The last trilogy can be read here - part 1 (PDP-11/04 itself), part 2 (TU60 tape s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Restoring another PDP-11/04</h1><div class="post__text post__text-html js-mediator-article">  <i>Translation of the article on the restoration of another PDP-11/04.</i>  <i>The last trilogy can be read here - <a href="https://geektimes.ru/post/258890/">part 1</a> (PDP-11/04 itself), <a href="https://geektimes.ru/post/258892/">part 2</a> (TU60 tape station), <a href="https://geektimes.ru/post/258894/">part 3</a> (terminal LA30).</i>  <i>Italic my comments.</i> <br><br><h3>  PDP-11/04, sent by Gunnar </h3><br>  We received this device from Gunnar Barbro, and with him came a bunch of different goodies for the PDP-11.  But the state of the computer itself was far from perfect.  There was a shortage of processor and memory boards, the power switch was replaced by a new version, and everything was terribly dusty.  A KY11-LB, XY11 programming console board (a <i>module for controlling a plotter, for example IBM 1627, which was delivered with DEC machines, and was canonical CalComp 565</i> ), KW11-P ( <i>a programmable RTC module, yes</i> ) were connected to the backplane. <i>yes, there was a whole board under the RTC!</i> ), the main board RK11-D with a set of modules (a <i>controller for magnetic disk drives, it was a set of cards (3 or 4 pieces) combined with a common board</i> ), and DR11-B (a <i>DMA controller, which , again, consisted of several boards: M7194, M971, M5916, M7820, ...</i> ), also with all modules. <br><br><img src="https://habrastorage.org/files/492/fc7/5ac/492fc75ac289468382fab8c4aec39b56.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Cleaning </h3><br>  We disassembled the computer into parts and gently washed them with soap, and then blew the compressor dry.  After drying, they are collected in a single unit.  During these procedures, rust spots were found here and there. <br><a name="habracut"></a><br><h3>  Build and validate </h3><br>  Of course, nothing worked even when we connected the processor and memory boards taken from our stocks!  The console was dead.  If at first we could dial digital codes, and they were displayed on the console (a <i>seven-segment six-digit indicator</i> ), then after some time the situation worsened, and this opportunity was gone. <br><br><h3>  KY11-LB </h3><br>  <a href="http://bitsavers.informatik.uni-stuttgart.de/pdf/dec/pdp11/1134/KY11-LB_MaintMan.pdf">The KY11-LB</a> is a very interesting option available for the PDP-11/04 and PDP-11/34.  You can not only turn on and off the CPU, debug the code, view and change the memory, thus bringing programs and data into the machine, but also use the service mode, in which step-by-step debugging of the processor's microcode is available!  This feature is provided by connecting a pair of loops to the processor module.  But if the processor is missing or frozen, KY11-LB allows you to work with Unibus (a <i>bus connecting modules in many DEC computers</i> ) without CPU involvement.  This is realized due to the presence of its own microprocessor i8008.  In the photo below I circled it in red.  And this is great news if you need to check the performance of the bus itself or to conduct simple tests of memory and I / O boards.  When a non-existing destination is requested, the BUS ERR light comes on.  J√∂rg Hoppe wrote an excellent <a href="http://www.retrocmp.com/tools/pdp-1134-programmers-console">document</a> on the use of KY11-LB. <br><br><img src="https://habrastorage.org/files/60c/cb1/b55/60ccb1b556774f6aaedaf3135fd73877.png"><br><br>  Having connected the logic analyzer, I checked that the 8008 on the M7859 (KY11-LB) is working normally and is running the recorded program correctly.  But the code believed that no one presses any keys ... It turned out that all CLR signals ( <i>clear, signal to clear the register</i> ) for the output registers were active.  The unibus bus controller that processed the DCLO signal (the <i>signal on the Unibus bus that informs that the DC voltage is too low</i> ) is buggy.  Several open-collector buffer drivers and register microcircuits were faulty.  As soon as I replaced them, the console came to life!  But again there was a failure after starting the processor and testing the diagnostics of its functionality.  And twice.  The first is an error in the M9301 boot boot.  The 8th bit on the data bus was the last available for the bus driver.  He could not read enough data from the bus.  The second time the processor simply hung.  Nothing was put on the address bus, and studying the microcode showed that the plug-in happened while trying to capture the bus.  The processor started working only after I took out the M7859 ( <i>KY11-LB</i> ).  It turned out that the M7859 generated a 9 MHz signal BBSY on the Unibus bus ( <i>Bus Busy, in the active state it signals that the signals D0-D15 (the requested data was being sent) were used by someone</i> ).  Why?  One trigger 7474 broke and oscillated like crazy.  After its replacement, diagnostics of the processor and memory was successful! <br><br><h3>  M9301-YB </h3><br>  In the PDP-11/04, the <a href="">M9301-YB</a> is a primary load module and terminator.  The PROM of the board stores the console emulator and boot code for several common devices.  In order for the processor to start execution right away from the boot area in the PROM, the module generates a special address 0173000 on the bus ( <i>300ms pulse using multivibrator 9602</i> ) ( <i>often the octal number system is used for pdp, so the zeros at the beginning of the numbers are not CC</i> ), and the processor requests the address of the resumption of work after a power failure, putting on the Unibus-bus address 024/026 ( <i>at the first address MMIO-register, which is a PC, on the second - PSW, processor status word, various flags and processor status</i> ) .  As a result, there is a request for data on the bus at addresses 0173024 and 0173026. For cell 0173024, M9301 finds a correspondence between the set of values ‚Äã‚Äãof microswitches ( <i>in the photo - 10 central units on the right in the center</i> ) and the data in the PROM.  These switches, in fact, determine from which address in space 0173xxx the processor will begin execution.  I dumped four PROM chips - <a href="">23-038A9</a> , <a href="">23-039A9</a> , <a href="">23-040A9</a> and <a href="">23-041A9</a> .  Since M9301-YB inverts some bits to support the possibility of disjunction of the board switches with external signals ( <i>in the photo are contacts TP1 / TP2 / TP3, their OR values ‚Äã‚Äãare with the values ‚Äã‚Äãof microswitches on the board, for example, TP1 is associated with S1 and S2</i> ), a small <a href="">program</a> that combines these four files into a single <a href="">binary</a> .  Having done only the initial analysis of the disassembled listing, I, nevertheless, have already noticed that the code is very similar to the PROM from M9301-YA, except that the code blocks are scattered at different addresses. <br><br><img src="https://habrastorage.org/files/b3e/d36/adc/b3ed36adc2c34fb0a3c85bde8286fb35.png"><br><br><h3>  Launch RT11SJ and XXDP V2.2 </h3><br><br>  To run each of these programs need the appropriate procedure in the code of the primary loader.  Usually, such procedures are carried out in a separate PROM chip, the execution of the code from which occurs when certain characters are typed in the console emulator.  But this machine is equipped with the M9201-YB board, which does not contain the primary DU loader ( <i>DEC has very informative names, DU is a bootloader from media through MSCP (MSCP is a communication protocol with drives, such as ATAPI)</i> ).  Therefore, I had to hammer this bootloader manually (the <i>console emulator, which is part of this module, supports 4 functions - loading address L, reading memory at address E, writing at address D, starting execution S, and this allows you to enter the code manually. Sequence teams of type L 016000, D XXXXXX, D XXXXXX, ..., S 16002</i> ).  It was not easy to find a suitable working bootloader, but I still got one in the source code of SimH ( <i>emulator of various ancient systems</i> ).  With the help of <a href="http://www.retrocmp.com/tools/pdp11gui">PDP11GUI</a> , I threw a small <a href="">file</a> into the memory of the machine.  And it works (at least in most cases). <br><br>  Dump this MSCP bootloader: <br><pre><code class="hljs">0016000 042125 012706 016000 012700 000000 012701 172150 012704 0016020 016162 012705 004000 010102 005022 005712 100001 000000 0016040 030512 001773 012412 006305 100370 105714 001434 012702 0016060 007000 005022 020227 007204 103774 112437 007100 110037 0016100 007110 112437 007114 112437 007121 012722 007004 010522 0016020 012722 007104 010512 024242 005711 005712 100776 005737 0016040 007016 001743 000000 005011 005003 012704 016020 005005 0016060 005007 100000 007204 000000 000001 004420 020000 001041 0016200 000000</code> </pre> <br>  Start filling the memory with 016000, and execution with 016002 ( <i>0x4455 - magic word</i> ). <br><br><img src="https://habrastorage.org/files/761/7a3/97f/7617a397f1c7428c8246121031eb13d2.png"><br><br>  After that, I tried to run a disk image with XXDP v2.2.  But, alas, there was no success.  The XXDP command line appeared, but any commands that worked on the disk, such as "D" ( <i>get the list of files on the loaded media</i> ), ended with an error in the console "? RD ERR".  It looks as if the program can not access the disk.  Therefore, I checked a small RT11 distribution ( <i>real-time operating system for PDP-11</i> ).  Created a disk image with version 5.3 and tried to run.  And everything went great!  You can play Adventure or program on BASIC'e! </div><p>Source: <a href="https://habr.com/ru/post/390793/">https://habr.com/ru/post/390793/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../390783/index.html">Radio signal as an alternative to wall chipping, trenches and trailing wires</a></li>
<li><a href="../390785/index.html">The Russian company ELVIS-NeoTek has updated the Perekrestok system - now violations of 18 traffic rules of DD are recognized</a></li>
<li><a href="../390787/index.html">7 of the strangest things that electronics hypermarkets offer for February 23</a></li>
<li><a href="../390789/index.html">Crowdfunding allowed New Zealand residents to buy the beach from a businessman, making it public</a></li>
<li><a href="../390791/index.html">The Public Chamber proposes to prohibit social networks at work, the Ministry of Labor against</a></li>
<li><a href="../390795/index.html">Samsung showed video with a new smartphone from the Galaxy line</a></li>
<li><a href="../390797/index.html">Tesla Motors: GM is lobbying a bill banning us from selling electric cars in Indiana</a></li>
<li><a href="../390803/index.html">"Civilization" is 25 years old: 33 million copies of the game are sold, 1 billion game hours, 66 versions of the game</a></li>
<li><a href="../390805/index.html">Virtual, augmented and mixed reality: the essence of concepts and the history of development</a></li>
<li><a href="../390807/index.html">How to travel using virtual reality technology</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>