<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>FloatingActionMode - contextual action panel for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Contextual actions with list items are widely used with Android applications. It is rather convenient to select several elements or all elements of th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>FloatingActionMode - contextual action panel for Android</h1><div class="post__text post__text-html js-mediator-article"><p>  Contextual actions with list items are widely used with Android applications.  It is rather convenient to select several elements or all elements of the list and apply some action to all selected elements at once.  Delete, for example. </p><br><p> In Android applications, this can be used <code>ActionMode</code> , which allows you to display the available actions on the selected items on top of the <code>Toolbar</code> .  You can also show the user how many items are currently selected or other useful information.  This is convenient and looks good, but in some cases the information displayed on the <code>Toolbar</code> itself may be important and would not be desirable to hide it.  For example, there may be the name and photo of the user, the list of messages with which is displayed in the list.  When selecting some messages, it would be useful to see the name of the user to whom these messages are addressed. </p><br><p>  In this case, you can display a context action panel with list items on top of the list itself, without blocking the <code>Toolbar</code> .  I will discuss the creation of such a panel of contextual actions in this article. </p><br><p>  Developed by CustomView - the contextual action panel I called <code>FloatingActionMode</code> or simply <code>FAM</code> . </p><br><p><img src="https://habrastorage.org/files/cbe/ba0/8da/cbeba08dad864082848702cf72d2e1c1.png" alt="Art"><br>  <em><code>FloatingActionMode</code> while running (fixed below)</em> </p><br><h3 id="video---primer-raboty-s-floatingactionmode-zafiksirovan-snizuhttpswwwyoutubecomwatchv1tn0mqv0zrq">  <a href="https://www.youtube.com/watch%3Fv%3D1tn0MQV0ZrQ">Video - an example of working with FloatingActionMode (fixed below)</a> </h3><a name="habracut"></a><br><p>  The comments indicated that it may not be very convenient for the user to drag the panel across the screen, so it can be fixed at the bottom of the screen, as shown in the screenshots and video above.  (To do this, specify the attributes <code>android:layout_gravity="bottom"</code> and <code>app:fam_can_drag="false"</code> ). </p><br><p>  At the same time, it is possible to allow the user to move the <code>FAM</code> around the screen, as shown in the following screens and videos. </p><br><p><img src="https://habrastorage.org/files/ffe/08a/56d/ffe08a56d3d143f48a24413fa4d9ed1b.png" alt="Art"><br>  <em><code>FloatingActionMode</code> while running</em> </p><br><h3 id="video---primer-raboty-s-floatingactionmode-peretaskivaniehttpswwwyoutubecomwatchvpbq8n7pwgt4">  <a href="https://www.youtube.com/watch%3Fv%3DPbQ8N7pWGt4">Video - an example of working with FloatingActionMode (Drag and Drop)</a> </h3><br><p>  By default, the <code>FAM</code> does not have a <code>background</code> , so you can use whatever you need.  Also, the <code>android:translationZ="8dp"</code> attribute can be used to create shadows on devices with API&gt; = 21 <code>android:translationZ="8dp"</code> </p><br><h3 id="xml-atributy">  XML attributes </h3><br><p>  To configure the <code>FAM</code> through a markup file, several special attributes are defined for it, which can also be changed programmatically: </p><br><ul><li><p>  <code>fam_opened</code> determines whether the <code>FAM</code> open upon creation.  ( <code>false</code> by default) </p><br></li><li><p>  <code>fam_content_res</code> is <code>LayoutRes</code> , which represents <code>FAM</code> content (several buttons, for example).  <code>View</code> created from <code>fam_content_res</code> added to the <code>FAM</code> as a child <code>View</code> .  The content can be changed programmatically while the application is running, therefore the <code>FAM</code> attribute can be specified <code>android:animateLayoutChanges="true"</code> for animated content changes.  (no content by default) </p><br></li><li><p>  <code>fam_can_close</code> determines whether the <code>FAM</code> have a button for closing.  ( <code>true</code> by default) </p><br></li><li><p>  <code>fam_close_icon</code> is a <code>DrawableRes</code> close button.  (default is a cross) </p><br></li><li><p>  <code>fam_can_drag</code> determines whether the <code>FAM</code> have a drag button.  ( <code>true</code> by default) </p><br></li><li><p>  <code>fam_drag_icon</code> is a <code>fam_drag_icon</code> <code>DrawableRes</code> button.  (there is a default value) </p><br></li><li><p>  <code>fam_can_dismiss</code> determines whether the <code>FAM</code> close if the user drags him far enough horizontally ( <code>true</code> by default) </p><br></li><li><p>  <code>fam_dismiss_threshold</code> is the horizontal shift threshold starting at which the <code>FAM</code> will be closed when the user <code>fam_drag_button</code> .  That is, if ( <code>getTranslationX</code> / <code>getWidth</code> )&gt; <code>dismissThreshold</code> , then the <code>FAM</code> will be closed.  ( <code>0.4f</code> by default) </p><br></li><li><p>  <code>fam_minimize_direction</code> determines the direction in which the <code>FAM</code> will move when collapsed.  This attribute can have the following values ‚Äã‚Äã( <code>nearest</code> default): </p><br><ul><li>  <code>top</code> - the <code>FAM</code> will move to the upper bound of the parent (excluding indents) during folding. </li><li>  <code>bottom</code> - the <code>FAM</code> will move to the lower border of the parent (excluding indents) during folding. </li><li>  <code>nearest</code> - <code>FAM</code> will move to the nearest (upper or lower) border of the parent (excluding indents) while folding </li></ul><br></li><li>  <code>fam_animation_duration</code> determines the duration of the folding / <code>fam_animation_duration</code> animation.  ( <code>400</code> ms by default) </li></ul><br><p>  <code>FAM</code> also has <code>OnCloseListener</code> , which allows you to perform a specific action when the <code>FAM</code> closed by the user (deselect items from the list, for example). </p><br><h3 id="osnovnye-deystviya">  Basic actions </h3><br><p>  The main actions with <code>FAM</code> are opening / closing and folding / unfolding.  When opened, it appears and turns around, and when closed it collapses and disappears. </p><br><p>  Expanding a <code>FAM</code> accompanied by an animation, during which it moves from the top or bottom edge of the parent <code>ViewGroup</code> (this edge is set by the <code>fam_minimize_direction</code> attribute) to its position specified by the markup file.  Animation is set as follows: </p><br><pre> <code class="java hljs">animate() .scaleY(<span class="hljs-number"><span class="hljs-number">1f</span></span>) .scaleX(<span class="hljs-number"><span class="hljs-number">1f</span></span>) .translationY(calculateArrangeTranslationY()) .alpha(<span class="hljs-number"><span class="hljs-number">1f</span></span>)</code> </pre> <br><p>  When collapsing, the animation is performed "in the opposite direction": </p><br><pre> <code class="java hljs">animate() .scaleY(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>) .scaleX(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>) .translationY(calculateMinimizeTranslationY()) .alpha(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>)</code> </pre> <br><p>  The <code>calculateArrangeTranslationY()</code> and <code>calculateMinimizeTranslationY()</code> methods allow you to calculate the <code>translationY</code> for the expanded and collapsed states, respectively, taking into account where the <code>FAM</code> user dragged the <code>fam_minimize_direction</code> attribute and the bottom and top indents, which will be discussed later. </p><br><h3 id="zakrytie-i-peretaskivanie">  Closing and dragging </h3><br><p>  For correct and beautiful work, <code>FAM</code> has buttons ( <code>ImageView</code> ) with the help of which the user can close the context actions mode or drag to another part of the screen vertically (if he is blocking the desired list item).  The <code>FAM</code> can also be closed by dragging it horizontally (swipe to dismiss). </p><br><p>  <code>FAM</code> is a <code>LinearLayout</code> , in which buttons are added during creation to close ( <code>fam_drag_button</code> ) and drag ( <code>fam_close_button</code> ).  The ability to close / drag <code>FAM</code> can be turned on / off while the application is running, so the <code>LinearLayout</code> containing these buttons has the <code>android:animateLayoutChanges="true"</code> attribute <code>android:animateLayoutChanges="true"</code> . </p><br><div class="spoiler">  <b class="spoiler_title">FAM Markup</b> <div class="spoiler_text"><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">merge</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?attr/actionBarSize"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:animateLayoutChanges</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center_vertical"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/fam_close_button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?attr/actionBarSize"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?attr/actionBarSize"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center_vertical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/fam_image_button_background"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:scaleType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/fam_ic_close_white_24dp"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/fam_drag_button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?attr/actionBarSize"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?attr/actionBarSize"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center_vertical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/fam_image_button_background"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:scaleType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/fam_ic_drag_white_24dp"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">merge</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><p>  The drag and drop mechanism is implemented using <code>OnTouchListener</code> , which remembers the starting point of the touch and sets <code>translationX</code> and <code>translationY</code> to the touch when moving.  When the user releases the drag button ( <code>fam_drag_button</code> ), the <code>FAM</code> returns to its original position horizontally, and if the user drags the <code>FAM</code> far enough horizontally, the method is called <code>this@FloatingActionMode.close()</code> . </p><br><div class="spoiler">  <b class="spoiler_title">OnTouchListener</b> <div class="spoiler_text"><pre> <code class="hljs kotlin">fam_drag_button.setOnTouchListener(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : OnTouchListener { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prevTransitionY = <span class="hljs-number"><span class="hljs-number">0f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> startRawX = <span class="hljs-number"><span class="hljs-number">0f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> startRawY = <span class="hljs-number"><span class="hljs-number">0f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(v: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, event: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MotionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-symbol"><span class="hljs-symbol">@FloatingActionMode</span></span>.canDrag) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> fractionX = Math.abs(event.rawX - startRawX) / <span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-symbol"><span class="hljs-symbol">@FloatingActionMode</span></span>.width <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (event.actionMasked) { MotionEvent.ACTION_DOWN -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-symbol"><span class="hljs-symbol">@FloatingActionMode</span></span>.fam_drag_button.isPressed = <span class="hljs-literal"><span class="hljs-literal">true</span></span> startRawX = event.rawX startRawY = event.rawY prevTransitionY = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-symbol"><span class="hljs-symbol">@FloatingActionMode</span></span>.translationY } MotionEvent.ACTION_MOVE -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-symbol"><span class="hljs-symbol">@FloatingActionMode</span></span>.maximizeTranslationY = prevTransitionY + event.rawY - startRawY translationX = event.rawX - startRawX <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (canDismiss) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> alpha = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fractionX &lt; dismissThreshold) <span class="hljs-number"><span class="hljs-number">1.0f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Math.pow(<span class="hljs-number"><span class="hljs-number">1.0</span></span> - (fractionX - dismissThreshold) / (<span class="hljs-number"><span class="hljs-number">1</span></span> - dismissThreshold), <span class="hljs-number"><span class="hljs-number">4.0</span></span>).toFloat() <span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-symbol"><span class="hljs-symbol">@FloatingActionMode</span></span>.alpha = alpha } } MotionEvent.ACTION_UP -&gt; { fam_drag_button.isPressed = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-symbol"><span class="hljs-symbol">@FloatingActionMode</span></span>.animate().translationX(<span class="hljs-number"><span class="hljs-number">0f</span></span>) .duration = animationDuration <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (canDismiss &amp;&amp; fractionX &gt; dismissThreshold) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-symbol"><span class="hljs-symbol">@FloatingActionMode</span></span>.close() } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } })</code> </pre> </div></div><br><h3 id="ispolzovanie-v-coordinatorlayout">  <code>CoordinatorLayout</code> Usage </h3><br><p>  As previously stated, the <code>calculateArrangeTranslationY()</code> and <code>calculateMinimizeTranslationY()</code> methods take into account the indents at the top and bottom to determine the correct position of the <code>FAM</code> .  These indents are calculated using <code>FloatingActionModeBehavior</code> ‚Äî the <code>CoordinatorLayout.Behavior</code> extensions, which <code>AppBarLayout</code> upper indent as the <code>AppBarLayout</code> height and the lower indent as the visible part of the <code>Snackbar.SnackbarLayout</code> . </p><br><p>  Also, <code>FloatingActionModeBehavior</code> allows the <code>FAM</code> respond to scrolling, turning when scrolling down and turning around when scrolling up (quick return pattern). </p><br><div class="spoiler">  <b class="spoiler_title">FloatingActionModeBehavior</b> <div class="spoiler_text"><pre> <code class="hljs kotlin"> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FloatingActionModeBehavior</span></span></span><span class="hljs-class"> </span><span class="hljs-meta"><span class="hljs-class"><span class="hljs-meta">@JvmOverloads</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>(context: Context? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, attrs: AttributeSet? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) : CoordinatorLayout.Behavior&lt;FloatingActionMode&gt;(context, attrs) { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">layoutDependsOn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CoordinatorLayout</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, child: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">FloatingActionMode</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, dependency: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dependency <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> AppBarLayout || dependency <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Snackbar.SnackbarLayout } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDependentViewChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CoordinatorLayout</span></span></span></span><span class="hljs-function"><span class="hljs-params">, child: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">FloatingActionMode</span></span></span></span><span class="hljs-function"><span class="hljs-params">, dependency: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (dependency) { <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> AppBarLayout -&gt; child.topOffset = dependency.bottom <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Snackbar.SnackbarLayout -&gt; child.bottomOffset = dependency.height - dependency.translationY.toInt() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStartNestedScroll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(coordinatorLayout: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CoordinatorLayout</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, child: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">FloatingActionMode</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, directTargetChild: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, target: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, nestedScrollAxes: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nestedScrollAxes == ViewCompat.SCROLL_AXIS_VERTICAL } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNestedScroll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(coordinatorLayout: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CoordinatorLayout</span></span></span></span><span class="hljs-function"><span class="hljs-params">, child: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">FloatingActionMode</span></span></span></span><span class="hljs-function"><span class="hljs-params">, target: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, dxConsumed: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, dyConsumed: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, dxUnconsumed: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, dyUnconsumed: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onNestedScroll(coordinatorLayout, child, target, dxConsumed, dyConsumed, dxUnconsumed, dyUnconsumed) <span class="hljs-comment"><span class="hljs-comment">// FAM        View. var parent = target.parent while (parent != coordinatorLayout) { if (parent == child) { return } parent = parent.parent } if (dyConsumed &gt; 0) { child.minimize(true) } else if (dyConsumed &lt; 0) { child.maximize(true) } } }</span></span></code> </pre> </div></div><br><p>  This is how a <code>FAM</code> might look like in a markup file: </p><br><pre> <code class="hljs ruby">&lt;android.support.design.widget.CoordinatorLayout&gt; &lt;android.support.design.widget.AppBarLayout&gt; ... &lt;<span class="hljs-regexp"><span class="hljs-regexp">/android.support.design.widget.AppBarLayout&gt; &lt;android.support.v7.widget.RecyclerView app:layout_behavior="@string/appbar</span></span>_scrolling_view_behavior<span class="hljs-string"><span class="hljs-string">"/&gt; &lt;com.qwert2603.floating_action_mode.FloatingActionMode android:id="</span></span>@+id/floating_action_mode<span class="hljs-string"><span class="hljs-string">" android:layout_width="</span></span>match_parent<span class="hljs-string"><span class="hljs-string">" android:layout_height="</span></span>wrap_content<span class="hljs-string"><span class="hljs-string">" android:layout_margin="</span></span>@dimen/action_mode_margin<span class="hljs-string"><span class="hljs-string">" android:animateLayoutChanges="</span></span><span class="hljs-literal"><span class="hljs-literal">true</span></span><span class="hljs-string"><span class="hljs-string">" android:background="</span></span>@drawable/action_mode_background<span class="hljs-string"><span class="hljs-string">" android:translationZ="</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>dp<span class="hljs-string"><span class="hljs-string">" app:fam_animation_duration="</span></span>@integer/action_mode_animation_duration<span class="hljs-string"><span class="hljs-string">" app:fam_can_dismiss="</span></span><span class="hljs-literal"><span class="hljs-literal">true</span></span><span class="hljs-string"><span class="hljs-string">" app:fam_can_drag="</span></span><span class="hljs-literal"><span class="hljs-literal">true</span></span><span class="hljs-string"><span class="hljs-string">" app:fam_content_res="</span></span>@layout/user_list_action_mode_2<span class="hljs-string"><span class="hljs-string">" app:fam_dismiss_threshold="</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">35</span></span><span class="hljs-string"><span class="hljs-string">" app:fam_drag_icon="</span></span>@drawable/ic_drag_white_24dp<span class="hljs-string"><span class="hljs-string">" app:fam_minimize_direction="</span></span>nearest<span class="hljs-string"><span class="hljs-string">"/&gt; &lt;/android.support.design.widget.CoordinatorLayout&gt;</span></span></code> </pre> <br><h3 id="ishodnyy-kod">  Source </h3><br><p>  The source code for <code>FloatingActionMode</code> is available on <a href="https://github.com/qwert2603/FloatingActionMode">GitHub</a> (the <em>library</em> directory).  There is also a demo application using <code>FAM</code> ( <em>app</em> directory). </p><br><p>  <code>FloatingActionMode</code> itself, as well as <code>FloatingActionModeBehavior</code> defined as <code>open</code> classes, so you can upgrade them as you need.  Key <code>FloatingActionMode</code> methods are also defined as <code>open</code> . </p><br><p>  Thanks for attention.  Happy coding! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/319238/">https://habr.com/ru/post/319238/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../319226/index.html">Simple and fast terrain generation algorithm</a></li>
<li><a href="../319228/index.html">Saving and loading the game in the Unreal Engine</a></li>
<li><a href="../319230/index.html">A little bit about programming trends in 2016: a series of conferences #ITsubbotnik</a></li>
<li><a href="../319232/index.html">The reverse side of Agile</a></li>
<li><a href="../319234/index.html">Browsers and app specific security mitigation. Part 3. Google Chrome</a></li>
<li><a href="../319240/index.html">iOS: Work with the gallery (Photos framework). Part 2</a></li>
<li><a href="../319242/index.html">Mobile OCR. How it all began (part 2)</a></li>
<li><a href="../319244/index.html">BLE under the microscope</a></li>
<li><a href="../319246/index.html">How can I save on taxes 13.3 times</a></li>
<li><a href="../319248/index.html">Skype Out vs Out vs Tviggo vs Signal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>