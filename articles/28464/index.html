<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Javascript Interface <==> PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Surprised that my habrayum habralyudi understand with difficulty, proceeded to write another interesting habratopik. :) 

 I want to offer one conveni...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Javascript Interface <==> PHP</h1><div class="post__text post__text-html js-mediator-article">  Surprised that <a href="http://habrahabr.ru/blog/exhaust/45782.html">my habrayum</a> habralyudi understand with difficulty, proceeded to write another interesting habratopik.  :) <br><br>  I want to offer one convenient method for interacting Javascript with PHP. <br><br>  You can add a class in PHP, with the ability to 'remote' start functions from there with parameters. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Parameter passing </h3>  What is the best way to pass functions to PHP input? <br>  The most suitable way is using an array. <br>  How to pass an array?  The simplest and most optimal method (considering that we are dealing with Javascript) is JSON.  Passing parameters to the launch will look, for example: <blockquote>  { <br>  "Init_timer": [], <br>  "Savedb": [200], <br>  "Check_timer": [] <br>  } <br>  which corresponds to: <br>  init_timer (); <br>  savedb (200); <br>  check_timer (); </blockquote>  You can convert this into an array on the PHP side very simply - using json_decode.  It remains only to parse the resulting array on the shelves, and output the result back as JSON to the client. <br><br><h3>  User interface </h3>  I implemented this using the PHP class UserInterface. <br><blockquote>  <font color="black"><font color="#0000ff">class</font> UserInterface {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">private</font> $ <font color="#0000ff">if</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">public</font> $ result = array ();</font> <font color="black"><br><br></font>  <font color="black">function add ($ groupname, $ <font color="#0000ff">if</font> ) {</font> <font color="black"><br></font>  <font color="black">$ <font color="#0000ff">this</font> -&gt; <font color="#0000ff">if</font> [$ groupname] [] = $ <font color="#0000ff">if</font> ;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black">function __call ($ name, $ args) {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (isset ($ <font color="#0000ff">this</font> -&gt; <font color="#0000ff">if</font> [$ name]))</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">foreach</font> ($ <font color="#0000ff">this</font> -&gt; <font color="#0000ff">if</font> [$ name] <font color="#0000ff">as</font> $ func)</font> <font color="black"><br></font>  <font color="black">! is_array ($ res = &amp; call_user_func_array ($ func, $ args)) ||</font> <font color="black"><br></font>  <font color="black">$ <font color="#0000ff">this</font> -&gt; result = array_merge_recursive ($ <font color="#0000ff">this</font> -&gt; result, $ res);</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black">function run ($ info) {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (is_array ($ info))</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">foreach</font> ($ info <font color="#0000ff">as</font> $ func =&gt; $ parameters)</font> <font color="black"><br></font>  <font color="black">! is_array ($ res = &amp; call_user_func_array (array (&amp; $ <font color="#0000ff">this</font> , $ func), $ parameters)) ||</font> <font color="black"><br></font>  <font color="black">$ <font color="#0000ff">this</font> -&gt; result = array_merge_recursive ($ <font color="#0000ff">this</font> -&gt; result, $ res);</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> <font color="gray">* This source code was highlighted with <a href="http://poison.qsh.ru/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote> We will add new methods (functions) to this class, and then, with a little refinement, we will teach Javascript to ‚Äúsee‚Äù and launch them, getting the results of their work. <br><br>  The class has the following functions: <br>  - <i>$ this-&gt; add ({method name}, {function})</i> allows to add a new method.  If the method exists, adds another function to it. <br>  - <i>$ this -&gt; {method name} ({parameters})</i> there is a call of all added functions in the method. <br>  - <i>$ this-&gt; run ({array})</i> runs several methods sequentially for execution, using parameters from the array. <br><br>  Immediately make remarochku for non-professionals: <br> <code>!is_array($res=&amp;call_user_func_array($func,$args)) ||   $result=array_merge_recursive($result,$res);</code> <br>  tantamount to <br> <code>$res=&amp;call_user_func_array($func,$args); <br> if(is_array($res)) <br> $result=array_merge_recursive($result,$res);</code> <br> <br>  Example: <br>  It is necessary to create a database interface with receiving information. <br>  To begin, we initialize the interface that we will use: <blockquote>  <font color="black">$ UImethod = <font color="#0000ff">new</font> UserInterface ();</font> </blockquote>  Add a group that should add information to the database (savedb): <br><blockquote>  <font color="black"><font color="#0000ff">class</font> db {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">static</font> function save ($ num) {</font> <font color="black"><br></font>  <font color="black"><font color="#008000">// Function for writing to the database</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">// $ num -&gt; ...</font></font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">static</font> function load ($ num) {</font> <font color="black"><br></font>  <font color="black"><font color="#008000">// Function to load from DB</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">// $ db &lt;-...</font></font> <font color="black"><br></font>  <font color="black">return <font color="#0000FF">array</font> ("DBresult" =&gt; $ db);</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black">$ UImethod-&gt; add ( <font color="#A31515">'savedb'</font> , <font color="#A31515">'db :: save'</font> );</font> <font color="black"><br></font>  <font color="black">$ UImethod-&gt; add ( <font color="#A31515">'loaddb'</font> , <font color="#A31515">'db :: load'</font> );</font> </blockquote>  The launch will be carried out using the function: <blockquote>  <font color="black">$ UImethod-&gt; savedb ($ xxx);</font> </blockquote>  In this case, if we suddenly need to add a log generation module, then processing can be easily added to the same group: <blockquote>  <font color="black"><font color="#0000ff">class</font> log {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">static</font> function add_savelog ($ num) {</font> <font color="black"><br></font>  <font color="black"><font color="#008000">// Add new log</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">// ...</font></font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black">$ UImethod-&gt; add ( <font color="#A31515">'savedb'</font> , <font color="#A31515">'log :: add_savelog'</font> );</font> </blockquote>  Now both functions will be launched sequentially when the 'savedb' group is started. <br><br><h3>  Javascript work with UserInterface class </h3>  First I want to dwell a bit on the <i>run</i> method.  This will help us in borrowing. <br>  The <i>run</i> method allows you to run several groups with different parameters in sequence.  It takes the names of groups in the form of an array: <br><blockquote>  $ a = array ( <br>  "Savedb" =&gt; array (200) <br>  "Loaddb" =&gt; array (200) <br>  ) </blockquote>  Then, by running <i>$ UImethod-&gt; run ($ a);</i>  can be saved to the database - 200, then read it using <i>'loaddb'</i> . <br><br>  You may have noticed that <i>db :: load</i> returns the results as an array.  These results are encapsulated (added) or in simple words fall into the general array $ this-&gt; result.  As a result, we will use this array as a response to JavaScript for the request. <br><br>  Ie, for example, by running <i>loaddb (200) and loaddb (300)</i> - we will get an array with filled fields: 'DBresult' =&gt; ('200' =&gt; ... and '300' =&gt; ...). <br><br>  And now the most important thing is the implementation of decoding (as input) and coding (as output) JSON arrays in PHP, with the launch of methods called using Javascript: <blockquote>  <font color="black"><font color="#0000ff">if</font> (! isset ($ _ REQUEST [ <font color="#A31515">'method'</font> ]))</font> <font color="black"><br></font>  <font color="black">die ();</font> <font color="black"><br></font>  <font color="black">$ functions = json_decode ($ _ REQUEST [ <font color="#A31515">'method'</font> ], TRUE);</font> <font color="black"><br></font>  <font color="black">$ UImethod-&gt; run ($ functions);</font> <font color="black"><br></font>  <font color="black">echo json_encode ($ UImethod-&gt; result);</font> </blockquote><br><h3>  Running methods from javascript </h3>  Got to sweet. <br><blockquote>  <font color="black">&lt;html&gt; &lt;head&gt; &lt;/ head&gt; &lt;body&gt;</font> <font color="black"><br></font>  <font color="black">&lt;script type = <font color="#A31515">"text / javascript"</font> &gt;</font> <font color="black"><br></font>  <font color="black"><font color="#008000">// Function that implements the AJAX request to the server</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">// URL parameters, JS-function, additional parameters, [next URL, JS-func ...]</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">function</font> ajax_load (url, parcer, par, next) {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> req, ab, done = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">this</font> .request = <font color="#0000ff">function</font> () {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (window.XMLHttpRequest)</font> <font color="black"><br></font>  <font color="black">ajaxRequest = <font color="#0000ff">new</font> XMLHttpRequest ();</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">else</font> <font color="#0000ff">if</font> (window.ActiveXObject) {</font> <font color="black"><br></font>  <font color="black">ajaxRequest = <font color="#0000ff">new</font> ActiveXObject ( <font color="#A31515">"Msxml2.XMLHTTP"</font> );</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (! ajaxRequest)</font> <font color="black"><br></font>  <font color="black">ajaxRequest = <font color="#0000ff">new</font> ActiveXObject ( <font color="#A31515">"Microsoft.XMLHTTP"</font> );</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> ajaxRequest;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">this</font> .ReqStatus = <font color="#0000ff">function</font> () {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (req.readyState == 4) {</font> <font color="black"><br></font>  <font color="black">clearTimeout (ab);</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (req.status == 200) {</font> <font color="black"><br></font>  <font color="black">parcer (req, par);</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (next)</font> <font color="black"><br></font>  <font color="black">ajax_load (next [0], next [1], next [2], next [3]);</font> <font color="black"><br></font>  <font color="black">} <font color="#0000ff">else</font></font> <font color="black"><br></font>  <font color="black">alert ( <font color="#A31515">"AJAX Error: \ n"</font> + req.statusText + <font color="#A31515">"\ n"</font> + url);</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">if</font> (! url)</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> parcer (par);</font> <font color="black"><br><br></font>  <font color="black">req = <font color="#0000ff">this</font> .request ();</font> <font color="black"><br></font>  <font color="black">req.onreadystatechange = <font color="#0000ff">this</font> .ReqStatus;</font> <font color="black"><br></font>  <font color="black">req.open ( <font color="#A31515">"GET"</font> , url, <font color="#0000ff">true</font> );</font> <font color="black"><br></font>  <font color="black">req.send ( <font color="#0000ff">null</font> );</font> <font color="black"><br></font>  <font color="black">ab = window.setTimeout ( <font color="#0000ff">function</font> () {req.abort ();}, 10,000);</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> req;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">// Function that encodes the request in JSON format ( <i>func (param) -&gt; ‚Äúfunc‚Äù: [param]</i> ) and sends it to the server (making the request ‚ÄúJSON.php? Method = ...‚Äù)</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">function</font> server_eval (mod, ret) {</font> <font color="black"><br></font>  <font color="black">mod = mod.replace (/ \ s * ([\ w \ d _] +) \ s * \ (([\ w \ d_. \\, \ [\] <font color="#A31515">"] *) \) \ s *;? / gi, '"</font> $ 1 <font color="#A31515">": [$ 2],'). replace ("</font> <font color="#A31515">'",'</font> <font color="#A31515">"');</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">mod = '{' + mod.substr (0, mod.length-1) + '}';</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">ajax_load ("</font> JSON.php? method =" + mod, ret, <font color="#0000ff">null</font> );</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">// Request handler</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">function</font> time_result (res) {</font> <font color="black"><br></font>  <font color="black">db = eval ( <font color="#A31515">'('</font> + res.responseText + <font color="#A31515">')'</font> );</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">document</font> .write (db [ <font color="#A31515">'DBresult'</font> ]);</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">// Request to server with time_result response handler</font></font> <font color="black"><br></font>  <font color="black">server_eval ( <font color="#A31515">'savedb (200); loaddb (200); loaddb (300);'</font> , time_result);</font> <font color="black"><br></font>  <font color="black">&lt;/ script&gt;</font> <font color="black"><br></font>  <font color="black">&lt;/ body&gt; &lt;/ html&gt;</font> <font color="gray">This was the code highlighted with the <a href="http://poison.qsh.ru/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote>  Actually that's all. <br><br>  <i>server_eval</i> sends a request to the <i>UserInterface of the JSON.php</i> file and, when receiving a response, runs the <i>time_result</i> function, passing the response in the parameters.  In this case, it is possible to carry out completely different requests in the interface and process the results as your heart desires. <br><br><h3>  What can it be used for </h3><br>  At this stage of implementation, I had a problem - to make a universal library, in which it is possible to change, add new functions by several developers. <br><br>  Examples: <br>  1) Again, back to the development of a space game. <br>  The player chose a different target for the ship.  There is a transfer of a choice of purpose.  "Ship_new_target (180,320); return_space_objects (1220,1334);".  180 is a ship, and 320 is a new target. <br>  A new goal can be anything.  In case it is a ship, we will need to select it as an enemy.  If this is a station, we will select it as a station and automatically send the ship to fly to it.  If this is a planet, then we will not allocate it at all. <br>  At the same time, we can add any new type of object without changing the code, but simply by adding the necessary calls and how we need to respond to them when they are needed. <br>  By the way, the <i>ship_new_target</i> function <i>returns</i> nothing.  But the function <i>return_space_objects</i> is engaged in the fact that it creates in the general array an array of objects lying near the coordinates (1220.1334).  At the same time - again, they are processed, for example, portals and added to the array (using some rules).  Then, ships, stations, calling the functions of the <i>return_space_objects</i> method <i>sequentially</i> and adding the results of the DB samples to the common array. <br>  Thus, it is easier for me to communicate with all objects and my code is not scattered over php files, but each site lies in its place. <br><br>  2) Forum. <br>  A simple example - Each post has its own ID.  Each topic also has its own ID.  They do not intersect. <br>  For any answer, the function 'add_reply (12345, ‚Äúcomment‚Äù); return_topic (12345);' is called. <br>  There are several functions in add_reply - the function to add to the topic, the function to add to the comment. <br>  If the ID (12345) to which the message is attached is a new topic, then we use one function, adding this message as a topic.  If the ID is a user comment, then we use a completely different function that attaches a comment to it. <br>  Then, by simply adding a library, you can add comments to anything, such as pictures, to personal messages (if a friend has an ID that does not overlap with other topics, comments), and so on. <br>  The return_topic method also works the same.  If the topic ID is, then we return the topic with comments.  If this is a comment ID, then only a comment with its attachments.  The same can be done for the use of pictures, music and everything your heart desires. <br><br>  Returning errors, by the way, is also possible - using, for example, 'ERROR', to which you simply add errors.  With several errors, it will look something like this: <br>  {‚ÄúERROR‚Äù: [‚ÄúNot enough characters‚Äù, ‚ÄúNo title present‚Äù, etc]}. <br><br><h3>  PS </h3>  You can, of course, make <i>eval ($ _ REQUEST ['method'])</i> , but the method I considered is more reliable in terms of security.  :) </div><p>Source: <a href="https://habr.com/ru/post/28464/">https://habr.com/ru/post/28464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../284630/index.html">State Drug Control Department pursues Alizar</a></li>
<li><a href="../284632/index.html">Successes in the fight against SOPA</a></li>
<li><a href="../284634/index.html">Friday's pre-election positivchik</a></li>
<li><a href="../284636/index.html">From 01/01/2012, Ukrainian IT specialists-PE will pay a tax of 5% of income</a></li>
<li><a href="../284638/index.html">Nevada court decided to "withdraw" hundreds of sites from the Internet</a></li>
<li><a href="../284640/index.html">These nasty patent trolls</a></li>
<li><a href="../284642/index.html">Switzerland: music and movies can still be downloaded legally</a></li>
<li><a href="../284644/index.html">Head of the Bureau of Special Technical Events of the Ministry of Internal Affairs of Russia proposed to cancel the anonymity on the Internet</a></li>
<li><a href="../284646/index.html">Chinese court found that Apple has no rights to the brand of iPad</a></li>
<li><a href="../284648/index.html">Apple burns back with patents</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>