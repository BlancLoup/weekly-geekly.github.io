<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>UltraVNC as a replacement for TeamViewer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Warning: all arriving slippers will be sold, tomatoes - eaten, eggs - fried, spoiled - thrown out. Those who think that we garbage garbage - you guess...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>UltraVNC as a replacement for TeamViewer</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/f40/359/e3a/f40359e3afdf4dc5a89f39952d3dda73.jpg"><br><br>  Warning: all arriving slippers will be sold, tomatoes - eaten, eggs - fried, spoiled - thrown out.  Those who think that we garbage garbage - you guessed it, take a pie from the shelf.  The author does not urge to throw bags by a breast on an embrasure.  He does not call for anything at all - he is not a politician and not a citizen with an active citizenship.  But wishing to discuss - you are welcome.  Today I will tell you an interesting story about replacing Teamviewer with UltraVNC. <a name="habracut"></a><br><br>  Why do we need such troubles, because Teamviewer is so awesome?  In my case this is due to several reasons.  We needed a system to remotely manage users' servers and workstations, and we have&gt; 1000 support systems.  Teamviewer is controlled by a third-party company and it is not known what it does with traffic.  Teamviewer is not trusted by some of our customers.  We needed unique IDs for all users.  Well, its cost for a fairly large infrastructure is very decent, which also influenced the decision.  At the same time, we have sufficiently wide communication channels and there are no stringent requirements for speed of response, which eliminated the main drawback of UltraVNC, namely, a lower speed of work. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  How it works </h3><br>  The original architecture of the VNC protocol is weakly designed to work through global networks.  There are several reasons for this. <br><br><ul><li>  Lack of encryption of transmitted data. </li><li>  Short passwords (8 characters in the modern world? Are you serious?) </li><li>  No end-to-end server numbering, IP connectivity. </li><li>  Impossibility of work because of NAT. </li></ul><br>  I, of course, listed not all.  But these are the main drawbacks that prevented us from considering this decision seriously.  As a result, they were all overcome in one way or another.  The current work scheme looks like this: <br><br><img src="https://habrastorage.org/web/f23/170/c10/f23170c10bf74e1199d5635350a19aa3.png"><br><br>  The client UltraVNC server connects to our repeater, which with its own port (non-standard) looks on the Internet and accepts connections.  And we connect to the same server at the internal address from the inside and from there to the client.  Connections are encrypted with RSA2048 / AES256.  Since servers and clients cling to different ports, you can flexibly restrict who and from where has the right to connect without touching the possibility of UltraVNC servers to connect to the repeater. <br><br><h3>  Install UltraVNC Repeater </h3><br>  Since the repeater will be the only public service, its configuration should be given maximum attention.  Use non-standard ports, block suspicious activity, such as port scans, and tightly determine where Viewers can connect from.  But let's start with the simplest - installation and configuration.  The server is configured in the second mode, the third (via SSL) requires special assemblies of viewers and servers, so it was decided not to use it. <br><br>  So, we go to the server, which is destined to become the future repeater and start a witch.  Installation will be described for Ubuntu 16.04.  We put the necessary dependencies. <br><br><pre><code class="hljs sql">sudo apt-get <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> <span class="hljs-keyword"><span class="hljs-keyword">build</span></span>-essential</code> </pre> <br>  Create a user to start the repeater. <br><br><pre> <code class="hljs pgsql">sudo useradd -c <span class="hljs-string"><span class="hljs-string">'UltraVNC Repeater User'</span></span> -M -s /sbin/<span class="hljs-keyword"><span class="hljs-keyword">nologin</span></span> uvncrep</code> </pre> <br>  Download the source of the repeater. <br><br><pre> <code class="hljs objectivec">wget http:<span class="hljs-comment"><span class="hljs-comment">//www.wisdomsoftware.gr/download/uvncrep017-ws.tar.gz</span></span></code> </pre> <br>  Unpack the repeater and go inside the folder. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">tar</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-xzvf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">uvncrep017-ws</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.tar</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.gz</span></span> &amp;&amp; <span class="hljs-selector-tag"><span class="hljs-selector-tag">cd</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">uvncrep017-ws</span></span></code> </pre> <br>  We collect the repeater. <br><br><pre> <code class="hljs go"><span class="hljs-built_in"><span class="hljs-built_in">make</span></span></code> </pre> <br>  Install the repeater in the system. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sudo</span></span> ./install.sh</code> </pre> <br>  Everything is ready for a successful launch, but we need to slightly change the settings file.  Therefore, open the favorite editor /etc/uvnc/uvncrepeater.ini and bring the settings to the following form: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">viewerport</span></span> = <span class="hljs-number"><span class="hljs-number">5900</span></span></code> </pre> <br>  According to the author's strange whim, the port number is different from the standard one.  We will set up a non-standard port on the firewall. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">logginglevel</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  We slightly increase the logging level in order to see information about the ports bin and connections in the log. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">allowedmodes</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  We prohibit both modes, leaving only 2, because the first one works on a different principle and can create vulnerability for us. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">useeventinterface</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  Disable sending messages.  While we will not send anything to anyone.  Maybe later‚Ä¶ <br><br>  Save the file and test the correctness of its settings. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sudo</span></span> uvncrepeatersvc /etc/uvnc/uvncrepeater.ini</code> </pre> <br><pre> <code class="hljs pgsql">UltraVnc Linux Repeater <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-number"><span class="hljs-number">0.17</span></span> UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): viewerPort : <span class="hljs-number"><span class="hljs-number">5900</span></span> UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): serverPort : <span class="hljs-number"><span class="hljs-number">5500</span></span> UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): maxSessions: <span class="hljs-number"><span class="hljs-number">100</span></span> UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): loggingLevel: <span class="hljs-number"><span class="hljs-number">2</span></span> UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): ownIpAddress (<span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">listen</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> interfaces) : <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): runAsUser (<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> started <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> root) : uvncrep UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): Mode <span class="hljs-number"><span class="hljs-number">1</span></span> connections allowed : <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): Mode <span class="hljs-number"><span class="hljs-number">2</span></span> connections allowed : Yes UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): Mode <span class="hljs-number"><span class="hljs-number">1</span></span> allowed <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> port (<span class="hljs-number"><span class="hljs-number">0</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">All</span></span>) : <span class="hljs-number"><span class="hljs-number">0</span></span> UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): Mode <span class="hljs-number"><span class="hljs-number">1</span></span> requires listed addresses : <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): Mode <span class="hljs-number"><span class="hljs-number">2</span></span> requires listed ID numbers : <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): useEventInterface: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): eventListenerHost : localhost UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): eventListenerPort : <span class="hljs-number"><span class="hljs-number">2002</span></span> UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; listInitializationValues(): useHttpForEventListener : <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; dropRootPrivileges(): <span class="hljs-keyword"><span class="hljs-keyword">privileges</span></span> successfully dropped, now running <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> uvncrep UltraVnc Sat Feb <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> &gt; routeConnections(): starting <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>, terminate <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ctrl+c</code> </pre> <br>  All right, you can run as a standard service.  Stop the repeater with Ctrl + C and start it as a service. <br><br><pre> <code class="hljs pgsql">sudo systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> uvncrepeater</code> </pre> <br>  We check that the service has started. <br><br><pre> <code class="hljs perl">$ ps ax | <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> uvnc <span class="hljs-number"><span class="hljs-number">11168</span></span> ? S <span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> /usr/sbin/uvncrepeatersvc /etc/uvnc/uvncrepeater.ini <span class="hljs-number"><span class="hljs-number">11170</span></span> pts/<span class="hljs-number"><span class="hljs-number">0</span></span> S+ <span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> --color=auto uvnc</code> </pre> <br>  The log file can be viewed at /var/log/uvncrepeater.log. <br><br><h3>  Install and configure UltraVNC server </h3><br>  So, the first obstacle between us and nirvana collapsed with a bang.  Now we can connect to clients for NAT.  The next two queues are the lack of end-to-end numbering and encryption.  We configure the test UltraVNC server.  Since our main fleet of managed machines is Windows, the server and client installation will be scheduled for them. <br><br>  Download the necessary components from the links.  Components must have an architecture (x86 and x64) corresponding to the architecture of the computer on which the server is being installed. <br><br><ul><li>  <a href="http://www.uvnc.com/downloads/ultravnc/118-download-ultravnc-1212.html">UltraVNC Server</a> </li><li>  SecureVNC Plugin: <br><ul><li>  <a href="">x86</a> </li><li>  <a href="">x64</a> </li></ul></li><li>  <a href="http://www.uvnc.com/downloads/mirror-driver/85-mirror-driver-downloads.html">Mirror driver</a> </li></ul><br><img src="https://habrastorage.org/web/2e1/a78/6f3/2e1a786f3720464e92d6fe940fd8417e.png"><br><br>  Run the installer UltraVNC server.  Accept the terms of the agreement and click <b>Next&gt;</b> . <br><br><img src="https://habrastorage.org/web/044/f3b/3c2/044f3b3c21ae42c4b11f5b659e7025a9.png"><br><br>  We read with interest and <b>Next&gt;</b> . <br><br><img src="https://habrastorage.org/web/777/bfb/3c4/777bfb3c46b74708ad27b564480a1a7e.png"><br><br>  Select the folder to install.  It is not recommended to change without special need.  What to reap, I think, and so it is clear. <br><br><img src="https://habrastorage.org/web/cbf/b46/ae7/cbfb46ae78be45e0be6df127d8288c20.png"><br><br>  Select the installation only UltraVNC Server and click <b>Next&gt;</b> . <br><br><img src="https://habrastorage.org/web/e84/c53/b29/e84c53b29afb46b89ec0cb299f5a4fcf.png"><br><br>  Click <b>Next&gt;</b> and no nails. <br><br><img src="https://habrastorage.org/web/c49/2f0/283/c492f028341d4fcb809141d9e212f8a4.png"><br><br>  We put these checkboxes to install UltraVNC server as a system service and start it immediately after installation.  Click <b>Next&gt;</b> . <br><br><img src="https://habrastorage.org/web/f8b/7c8/1be/f8b7c81bed974f6e989f60909011c6d3.png"><br><br>  We look at this screen with a smart view, then click <b>Install</b> . <br><br><img src="https://habrastorage.org/web/13b/fb8/78a/13bfb878a1864b0c93157d5483afb30b.png"><br><br>  There is only one button to press.  We press on it. <br><br><img src="https://habrastorage.org/web/574/db7/d69/574db7d6967d44d4b54581a8d82be7ec.png"><br><br>  Remove the check mark in order not to watch any recent versions, and click <b>Finish</b> . <br><br><img src="https://habrastorage.org/web/0db/94e/daf/0db94edaf06e4a1c8735602ccd460385.png"><br><br>  The button part of the mission is over.  Now you need to install the necessary components and configure the server.  Copy the security plugin into the UltraVNC folder. <br><br><img src="https://habrastorage.org/web/165/94c/ff1/16594cff1d4d4c06b8f9729979857025.png"><br><br>  Unpack the folder with the driver. <br><br><img src="https://habrastorage.org/web/986/230/bd7/986230bd7e86433ba672b4e962f9a587.png"><br><br>  Go to the folder with the appropriate driver and install it by running install.bat. <br><br>  Attention!  Driver installation must be done with administrative rights.  Moreover, it will not be possible to run only install.bat as an administrator, because it starts another program and it will not work as an administrator.  Therefore, run the console from the administrator, go to the driver installation folder and run install.bat from there. <br><br>  I ran a test build on XP with administrator rights, so I did not need it. <br><br><img src="https://habrastorage.org/web/304/de6/d47/304de6d475e74f839597a15c96191926.png"><br><br>  Run the VNC server settings - uvnc_settings.exe. <br><br><img src="https://habrastorage.org/web/0dd/04b/090/0dd04b09042246c4b5c1d19a860bfc60.png"><br><br>  Go to the <b>Security</b> tab. <br><br><ul><li>  In the <b>Authentication</b> section, set two passwords.  Passwords must be the same, consist of <i>numbers and small and small Latin letters, no more than 8 characters in length</i> . </li><li>  In the <b>Encryption</b> section, tick the <b>Use</b> checkbox, select our plugin from the drop-down list, and click on the <b>Configuration</b> button. </li></ul><br><img src="https://habrastorage.org/web/3ad/d45/369/3add453698294ee88cbfc25a2fd7a179.png"><br><br>  Checkboxes should be as shown in the screenshot.  If everything is correct, close the window by clicking the <b>Close</b> button. <br><br><img src="https://habrastorage.org/web/a0b/b8e/37b/a0bb8e37bcc645f0910ab513fecf9366.png"><br><br>  Go to the <b>Connection</b> tab. <br><br><ul><li>  In the <b>Multiple connections</b> section, select <b>Keep existing connections</b> . </li><li>  In the <b>Disconnect</b> section, select <b>Do Nothing</b> . </li></ul><br><img src="https://habrastorage.org/web/22d/945/c1f/22d945c1feac477db1f5c288a632e8ab.png"><br><br>  Go to the <b>Screen Capture</b> tab. <br><ul><li>  In the <b>Advanced</b> section, select <b>Use system hookdll, Use mirror driver, Remove Aero while connected</b> and <b>Remove wallpaper while connected</b> . </li></ul><br><img src="https://habrastorage.org/web/2f9/233/bb0/2f9233bb0c7e47e98f26bc243d8bde60.png"><br><br>  Go to the tab <b>Misc / logging</b> . <br><br><ul><li>  In the field <b>Service command line we</b> drive in the most important line.  This line contains the ID and address and data of the repeater for the connection.  It looks like this: </li></ul><br>  -autoreconnect ID: XXXXXXXX -connect &lt;repeater_external_address&gt;: &lt;repeater_port&gt; <br>  The ID is obtained using the script as described below. <br><br><img src="https://habrastorage.org/web/575/6ea/5cd/5756ea5cdd464072b4dd00f7792afd9a.png"><br><br><img src="https://habrastorage.org/web/873/783/c44/873783c442a84bcd874d381146f89073.png"><br><br>  After all the actions done, click <b>OK</b> to save the settings.  Then run the settings again and go to the <b>Service</b> tab.  On it, by pressing the appropriate buttons, first stop, then start the service. <br><br><h3>  Generating a unique ID </h3><br>  Script for obtaining an 8-digit ID number.  Written in php, because it was the easiest.  Comments were used as a source of inspiration.  How it works, I think, no need to explain.  Why the generation script and why exactly by MAC?  Because the repeater will not allow two servers to connect with the same ID, and it was extremely lazy to keep logs with ID lists.  And since the MAC addresses are unique, we are almost guaranteed to get a unique number with a fairly low probability of a collision. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $mac = <span class="hljs-string"><span class="hljs-string">'B6-B6-13-18-FF-FF'</span></span>; $mac = str_split(str_replace([<span class="hljs-string"><span class="hljs-string">':'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>], <span class="hljs-string"><span class="hljs-string">''</span></span>, $mac)); $sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($mac <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $part) { $number = hexdec($part); $sum = (($sum * <span class="hljs-number"><span class="hljs-number">16</span></span>) + $number) % <span class="hljs-number"><span class="hljs-number">99999999</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($sum &lt; <span class="hljs-number"><span class="hljs-number">10000000</span></span>) $sum += <span class="hljs-number"><span class="hljs-number">10000000</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span>(<span class="hljs-string"><span class="hljs-string">"$sum\n"</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br>  It is important to remember that a collision can only be detected by the corresponding repeater logs.  The service will start as if nothing had happened.  Therefore, when adding a number, it is better to still look at the logs. <br><br><h3>  Installing and configuring UltraVNC Viewer </h3><br>  Download the necessary components from the links.  Components must have an architecture (x86 and x64) corresponding to the architecture of the computer on which the Viewer is installed. <br><br><ul><li>  <a href="http://www.uvnc.com/downloads/ultravnc/118-download-ultravnc-1212.html">UltraVNC Viewer</a> </li><li>  SecureVNC Plugin: <a href="">x86</a> , <a href="">x64</a> . </li></ul><br><br><img src="https://habrastorage.org/web/abc/666/868/abc666868ad64b6eb94811e651ffe0e1.jpg"><br><br>  We start the installation. <br><br><img src="https://habrastorage.org/web/357/2de/876/3572de8760e640ee854583c09bc6e881.jpg"><br><br>  Carefully read the strange and click <b>Next&gt;</b> . <br><br><img src="https://habrastorage.org/web/f1a/e71/0b8/f1ae710b8b864ef4b2fcea6f0b2572e4.jpg"><br><br>  Select the installation folder and click <b>Next&gt;</b> . <br><br><img src="https://habrastorage.org/web/4d7/0fb/0b2/4d70fb0b2bf346acb32115129d458f27.jpg"><br><br>  Select only the <b>UltraVNC Viewer</b> component and click <b>Next</b> &gt;. <br><br><img src="https://habrastorage.org/web/81c/17c/84d/81c17c84d17d4bf1978967025a2f0b58.jpg"><br><br>  We leave everything here as it is and just click <b>Next&gt;</b> . <br><br><img src="https://habrastorage.org/web/468/2b8/b3c/4682b8b3c497430da87bbaed0861fdf7.jpg"><br><br>  We tick the way you want and click <b>Next&gt;</b> . <br><br><img src="https://habrastorage.org/web/523/53c/372/52353c37290a41658ee9befd1966eb73.jpg"><br><br>  Turning off viewing the latest versions by unchecking the boxes and clicking the <b>Finish</b> button. <br><br>  Now download the plugin file using the link above and move it to the program folder.  After that, run the Viewer. <br><br><img src="https://habrastorage.org/web/36a/0d0/9b7/36a0d09b70b94697a1ebd443ebee7006.jpg"><br><br>  We set all the settings in the same way as on the screenshot.  Server ID to connect is entered in this format, that is, <b>ID: XXXXXXXX</b> .  The IP and port of the repeater are entered as they were assigned during the installation of the repeater. <br><br>  Everything, you can connect and enjoy life. <br><br><h3>  Usage Notes </h3><br><ul><li>  <b>Do not forget to install the security plugin when connecting</b> .  If it does not exist, the connection will still occur, only without encryption.  I have not managed to force UltraVNC Server to require encryption. </li><li>  <b>Tune out the service when installing the UltraVNC server</b> .  During use, it was noted that the server service sometimes falls.  In order not to lose contact with the machine at the right time, it is recommended to set its automatic restart in the service settings in the service settings. </li></ul><br><h3>  See you in the next episodes </h3><br>  Yes, UltraVNC, this is not for you.  In a sense, it is simpler in terms of functionality, it has all the hallmarks of free software, and indeed, wherever it has been seen ... But I think that as a tool, it fully has the right to life if it meets the requirements for security and the service provided.  In the future, I would like to screw Single Click to it, but so far this is enough. <br><br>  PS I hope someone will come in handy.  I will be glad to your comments. </div><p>Source: <a href="https://habr.com/ru/post/330450/">https://habr.com/ru/post/330450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330438/index.html">Polybius Bank: the most significant event of the year in the world of cryptocurrency</a></li>
<li><a href="../330440/index.html">Virtualization opportunities for IT savings</a></li>
<li><a href="../330444/index.html">Effective technical support tools</a></li>
<li><a href="../330446/index.html">Turla's cybercamping: updated Firefox extension uses Instagram</a></li>
<li><a href="../330448/index.html">Designer's blood, sweat and tears</a></li>
<li><a href="../330452/index.html">When docker-compose is missing</a></li>
<li><a href="../330454/index.html">10 rules for the organization of effective customer support</a></li>
<li><a href="../330456/index.html">Ecosystem: more participants - more profit! Why does Skyeng open API</a></li>
<li><a href="../330458/index.html">Roskomnadzor white list: conclusions and losses</a></li>
<li><a href="../330460/index.html">10 tools for startups and startups</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>