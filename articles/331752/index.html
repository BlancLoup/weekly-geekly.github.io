<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing or parsing sites with a dynamic home and more. Nightmare.js - he doesn't care</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will not contain a lot of lyricism, maral or introductory why and to whom it may be necessary. 

 In a nutshell: 
 1. The package can be ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing or parsing sites with a dynamic home and more. Nightmare.js - he doesn't care</h1><div class="post__text post__text-html js-mediator-article">  This article will not contain a lot of lyricism, maral or introductory why and to whom it may be necessary. <br><br><h4>  <b>In a nutshell:</b> </h4><br>  1. The package can be used to test sites. <br>  2. The package can be used to parse data. <br>  3. The package can be used to automate data entry to sites. <br><br><h4>  <b>Alternatives:</b> </h4><br>  Casper.js, phantom.js, watir and many more, Google is full of one and all.  Why am I behind nightmare.js: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Ease of use. </li><li>  Full html5 support, no conflicts with sites. </li><li>  Expandable through actions. </li></ol><br><h4>  <b>Library structure</b> </h4><br>  The Nightmare class uses the electron framework, for each page creating an object (BrowserWindow) that launches the browser shell Chromium. <br><br><h4>  <b>Principle of operation</b> </h4><br><ol><li>  Nightmare initializes a new electron application with a start page that needs to be further processed. </li><li>  Before loading the page under study, scripts are loaded that allow the programmer to maintain two-way interaction with the page through a series of emitters. </li><li>  Nightmare provides the programmer with a set of api (chains of actions), allowing to make any manipulations with the site and obtain the required data. </li></ol><a name="habracut"></a><br><h4>  <b>pros</b> </h4><br><ol><li>  The code on the client side and the site is written in the same language, no templating is required. </li><li>  The ability to expand the modules through the creation of action games.  The action can be created at the nightmare class level or at the nightmare class level and electron level (which in turn allows devapi Chromium to be used).  In npm, there are already enough ready-made extension modules that can be connected to your project (for example, realMouse fully emulates mouse hover or work with iframes, which is blocked by browser security). </li><li>  All commands are chains, each of which returns a promise; this allows you to write code in either the promise style or inside async functions or generators. </li><li>  A relatively small load on the processor and memory, you need to remember that comparing such a tool with simple get and post queries is not ethical, in terms of speed and memory browser parsers lose without options). </li><li>  Nightmare can work in two modes, the browser display mode and the background process mode. </li><li>  Supports proxy.  Installing user agent, setting browser extension. </li><li>  You can enable or disable the display of images, support for webGL and a whole bunch more. </li><li>  You can create preload scripts, which allows you to add your library functions to the page before loading.  As a particular example, you can rewrite the function addEventListener by making it the decorator for real + injecting analytic functions to check for that.  What does the site actually do when you are on it or to struggle with the finger print intrusiveness that everyone loved so much, forgetting about your ‚Äúanonymity‚Äù. </li></ol><br><h4>  <b>From emotion to business</b> </h4><br>  A classic example of using the module from the documentation: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Nightmare = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'nightmare'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nightmare = Nightmare({ <span class="hljs-attr"><span class="hljs-attr">show</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); nightmare .goto(<span class="hljs-string"><span class="hljs-string">'https://duckduckgo.com'</span></span>) .type(<span class="hljs-string"><span class="hljs-string">'#search_form_input_homepage'</span></span>, <span class="hljs-string"><span class="hljs-string">'github nightmare'</span></span>) .click(<span class="hljs-string"><span class="hljs-string">'#search_button_homepage'</span></span>) .wait(<span class="hljs-string"><span class="hljs-string">'#zero_click_wrapper .c-info__title a'</span></span>) .evaluate(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'#zero_click_wrapper .c-info__title a'</span></span>).href; }) .end() .then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(result); }) .catch(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">'Search failed:'</span></span>, error); });</code> </pre> <br><h4>  <b>In a nutshell about what is happening</b> </h4><br>  Connecting the library, creating an object with a visible browser mode.  Entering the page, searching for an element using the DSS selector, entering text, pressing a button, waiting for the new CSR to appear, performing the function on the browser side and returning it, after completing the task chain, then the result of the work will be transmitted or an exception will be triggered.  In my opinion, everything is simple and convenient, but as soon as the page crawl script becomes large, this command description becomes inconvenient, therefore I propose a good use case for async functions: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Nightmare = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'nightmare'</span></span>); <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">async</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span></span><span class="hljs-function">)=&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> nightmare; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { nightmare = Nightmare({ <span class="hljs-attr"><span class="hljs-attr">show</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> nightmare .goto(<span class="hljs-string"><span class="hljs-string">'https://duckduckgo.com'</span></span>) .type(<span class="hljs-string"><span class="hljs-string">'#search_form_input_homepage'</span></span>, <span class="hljs-string"><span class="hljs-string">'github nightmare'</span></span>) .click(<span class="hljs-string"><span class="hljs-string">'#search_button_homepage'</span></span>) .wait(<span class="hljs-string"><span class="hljs-string">'#zero_click_wrapper .c-info__title a'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> siteData = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> nightmare.evaluate(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'#zero_click_wrapper .c-info__title a'</span></span>).href; }); <span class="hljs-comment"><span class="hljs-comment">//     } catch (error) { console.error(error); throw error; } finally { await nightmare.end(); } })();</span></span></code> </pre> <br>  What are the advantages of such a variant of writing code?  You can receive as many times as you want from the site through evaluate, analyze them and apply various behavioral scripts, describing it in your script. <br><br>  You can go through the pages sequentially through await nightmare.goto (....), while Nightmare will wait for the download house. <br><br><h4>  <b>About documented features</b> </h4><br>  I consider it useless to describe all the functions in the examples, since all this is well indicated in the documentation.  Let me just say that the module can read any data, take screenshots, save html pages, pdf pages, transfer data to the site.  Through additional modules, uploading files to the server is available through the form input type = ‚Äùfile‚Äù.  Able to respond to alert, prompt, confirm, can broadcast in the form of events data from the console. <br><br><h4>  <b>What features should be considered when working with nightmare</b> </h4><br>  It is necessary to understand that each action will either be completed or an exception will be thrown, and therefore in places where there is no certainty that the code will pass 100% you need to wrap requests into try catch and process them accordingly.  As an example of wait (selector), this instruction will give the command to suspend the execution of the script until the html element appears with the corresponding css selector, but the module has a default timeout, it can be changed optionally, upon the occurrence of which an exception will be thrown, respectively -and or somehow react to it. <br><br><h4>  <b>Summary</b> </h4><br>  In my opinion, nightmare.js is a very serious library with good functionality.  Easy to learn, flexible, allows you to perform almost any task in testing sites and their analysis.  To strict critics I treat with understanding who will be interested in the topic, according to the comments I will gather ideas for the following articles. <br><br><h4>  <b>Links</b> </h4><br>  ‚Üí <a href="https://github.com/segmentio/nightmare">Nigthmare.js</a> <br>  ‚Üí <a href="https://github.com/electron/electron">Electron</a> <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/331752/">https://habr.com/ru/post/331752/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331740/index.html">How HBO did Not Hotdog for the Silicon Valley TV Show</a></li>
<li><a href="../331744/index.html">Postquantum reincarnation of the Diffie-Hellman algorithm: past and present</a></li>
<li><a href="../331746/index.html">Using Python and Excel to process and analyze data. Part 1: Import Data and Set Up Environment</a></li>
<li><a href="../331748/index.html">How to comply with FZ-152 ‚ÄúOn personal data‚Äù with ‚ÄúBitrix24‚Äù and ‚Äú1C-Bitrix‚Äù</a></li>
<li><a href="../331750/index.html">Speed ‚Äã‚Äãreading: does it work or not? Part 3: simple tips</a></li>
<li><a href="../331754/index.html">How we stalled and calibrated the coffee machine on the spectrophotometer</a></li>
<li><a href="../331758/index.html">Mark, Jack and Alisher! The world needs a new facebook - educational</a></li>
<li><a href="../331760/index.html">ArrayBuffer and SharedArrayBuffer in JavaScript, Part 2: Introduction to New Language Objects</a></li>
<li><a href="../331762/index.html">Ukraine has undergone the largest virus in the history of cyber attack Petya</a></li>
<li><a href="../331766/index.html">Building application management systems in a distributed cluster infrastructure based on MESOS technology</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>