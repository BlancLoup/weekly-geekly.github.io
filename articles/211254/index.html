<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cacti data queries</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A little more than a year ago it was necessary to solve the problem of obtaining and displaying a set of similar indicators from several servers, whil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cacti data queries</h1><div class="post__text post__text-html js-mediator-article"> A little more than a year ago it was necessary to solve the problem of obtaining and displaying a set of similar indicators from several servers, while the number of servers and the number of indicators removed from them could change over time.  <code>zabbix_agent</code> was installed on the nodes, user parameters were configured, templates were made, the data was successfully transferred to Zabbix.  For the second system - Cacti, the script found somewhere that <code>zabbix_get</code> data <code>zabbix_get</code> and used <i>Data Queries was</i> <code>zabbix_get</code> .  But something in this script soon broke down and Zabbix was left as the only working solution. <br><br>  To understand what <i>Data Queries is</i> and how to make it work, there was only time for the New Year holidays. <a name="habracut"></a><br><br>  I will repeat the common expression of pro-system administrators who want everything to work by itself.  In my case, so that for each monitored node it was possible to immediately add all the necessary graphs and when the number of indicators to be removed was changed, the necessary information was added, if not automatically, then as simply as possible.  I wanted to have a mechanism that not only receives and processes data, but also knows what data can be obtained.  This is exactly how the <i>Data Queries</i> method works, allowing you to collect values ‚Äã‚Äãas a <i>Data Input</i> and optionally return a list of all possible parameters. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In Cacti, this approach is built out of the box.  For nodes using the <i>Generic SNMP</i> template, you can see a list of all network interfaces, select the necessary ones, and build on them the necessary graphs associated with it <i>Data Queries SNMP - Interface Statistics</i> .  It would seem that it is easier to see how it works, read the documentation <a href="http://docs.cacti.net/manual:088:3a_advanced_topics.3d_script_data_query_walkthrough">here</a> and <a href="http://www.cacti.net/downloads/docs/html/data_queries.html">here</a> and redo it for yourself.  But it is painful, in my opinion, an unsuccessful and complex example of a script selected for description, which I figured out after I did everything.  Although the user component, where to click in the interface to earn questions does not cause. <br><br>  So, <i>Data Queries</i> is represented by three varieties: <i>Get SNMP Data</i> , <i>Get Script Server Data</i> , <i>Get Script Data</i> <br><ol><li>  <i><a href="http://www.cacti.net/downloads/docs/html/snmp_query_xml.html">Get SNMP Data</a></i> is represented only by XML, specifying which parameters to remove and from where, of course, using the SNMP protocol; </li><li>  The methods <i>Get Script Server Data</i> and <i>Get Script Data</i> are defined by the XML template and the associated script.  Only in the case of <i>Get Script Server Data</i> , the execution speed was optimized by using a common PHP process that requires the use of PHP.  <i>Get Script Data is the</i> most common approach, we will only consider it later. </li></ol><br>  From the side of Cacti, it looks like this.  The script operation parameters and the arguments to be displayed are read from the XML template.  After binding the <i>Data Queries</i> to the node, the script will be requested and stored a list of all possible elements (indices) for which it will return values.  If the data changes, it is necessary to reread them again by running the <i>Reload Data Query</i> interface for the associated method.  During the next survey, the same script should return the requested data for the specified index and argument.  Each time it will be a different script call, for all memorized indexes and for each of the displayed arguments.  After that, save to <i>Data Source</i> and draw on the chart. <br><br>  The task to be solved is to take <code>fping</code> polling results from the servers under control, where the remote node is specified as a parameter, for example, <code>ya.ru</code> or <code>habrahabr.ru</code> .  And the answer is the values ‚Äã‚Äãof delays and losses.  Accordingly, we can ping many other nodes from each server.  The list of nodes should receive automatically. <br><br><h2>  First create the XML template. </h2><br><h3>  Common parameters </h3><br>  <b><code>name</code></b> and <b><code>description</code></b> - what is it and what is it intended for in order not to get confused: <br><blockquote><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>Get fping stats<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Remote monitoring fping statistics<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </blockquote><br>  <b><code>&lt;script_path&gt;</code></b> - full path to the script file, you can use the variable <code>|path_cacti|</code>  : <br><blockquote><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script_path</span></span></span><span class="hljs-tag">&gt;</span></span>|path_cacti|/scripts/query-fping-stat.sh<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script_path</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </blockquote><br>  <b><code>&lt;arg_index&gt;</code></b> , <b><code>&lt;arg_num_indexes&gt;</code></b> , <b><code>&lt;arg_query&gt;</code></b> , <b><code>&lt;arg_get&gt;</code></b> - the values ‚Äã‚Äãof the parameters passed to the script, which determine its mode of operation and what values ‚Äã‚Äãit returns.  Only four modes, we do not invent anything complicated: <br><blockquote><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_index</span></span></span><span class="hljs-tag">&gt;</span></span>index<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_index</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_num_indexes</span></span></span><span class="hljs-tag">&gt;</span></span>num_indexes<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_num_indexes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_query</span></span></span><span class="hljs-tag">&gt;</span></span>query<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_query</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_get</span></span></span><span class="hljs-tag">&gt;</span></span>get<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_get</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </blockquote><br>  <b><code>&lt;arg_prepend&gt;</code></b> - parameters that will be transferred first in the script command line.  No other parameters will be automatically transferred to the script, except for those that determine its mode of operation, that is, we do not know for which server we perform our actions.  Required additional arguments are defined here.  It is also allowed to use <a href="http://www.cacti.net/downloads/docs/html/host_variables.html">variables</a> : <br><blockquote><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_prepend</span></span></span><span class="hljs-tag">&gt;</span></span>|host_hostname|<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_prepend</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </blockquote><br>  <b><code>&lt;output_delimeter&gt;</code></b> - the delimiter character in the returned values.  Nothing too convoluted - use a colon: <br><blockquote><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">output_delimeter</span></span></span><span class="hljs-tag">&gt;</span></span>:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">output_delimeter</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </blockquote><br>  For us, this is enough, the parameters are not so many, <a href="http://www.cacti.net/downloads/docs/html/script_query_xml.html">that's what's left</a> . <br><br><h3>  Data fields </h3><br>  Here we describe what data you need to get at the output.  Values ‚Äã‚Äãare divided into two types of <i>Input</i> and <i>Output</i> . <br><br>  The <i>Input</i> type is associated with the <i>Query</i> mode of operation and should return values ‚Äã‚Äãcharacterizing one or another index.  For example, for a network interface: a signature, a physical address, a type ‚Äî anything that will not change over time.  The data obtained in this way will be transferred to <i>Data Source</i> which in turn will connect it with the necessary index.  At least one <i>Input</i> element must be required, because it is associated with the <i>Data Source</i> . <br><br>  In addition, variables are generated <code>|query__|</code>  that can be used in graph labels and their values ‚Äã‚Äãwill be displayed in the general list of elements when you call <i>Create Graphs for this Host</i> as separate columns. <br><br>  <i>Output</i> type - fields whose data will be plotted on graphs. <br><br>  Directly the field is determined very simply: <br><br>  <b><code>name</code></b> - name, <b><code>query_name</code></b> - the value that will be passed to the script and <b><code>direction</code></b> - type is <i>Input</i> or <i>Output</i> . <br><br>  We have one <i>Input</i> field that returns the node name.  The variable to be created <code>|query_host|</code>  : <br><blockquote><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>host<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span>input<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span>host<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </blockquote><br>  And four <i>Output</i> fields, maximum, minimum, average response latency and packet loss percentages: <br><blockquote><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">avg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>avg<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span>output<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span>avg<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">avg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">max</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>max<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span>output<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span>max<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">max</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">min</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>min<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span>output<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span>min<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">min</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">loss</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>loss<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span>output<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span>loss<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">loss</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </blockquote><br><div class="spoiler">  <b class="spoiler_title">Full XML template</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interface</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>Get fping stats<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Remote monitoring fping statistics<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script_path</span></span></span><span class="hljs-tag">&gt;</span></span>|path_cacti|/scripts/query-fping-stat.sh<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script_path</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_index</span></span></span><span class="hljs-tag">&gt;</span></span>index<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_index</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_query</span></span></span><span class="hljs-tag">&gt;</span></span>query<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_query</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_get</span></span></span><span class="hljs-tag">&gt;</span></span>get<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_get</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_num_indexes</span></span></span><span class="hljs-tag">&gt;</span></span>num_indexes<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_num_indexes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_prepend</span></span></span><span class="hljs-tag">&gt;</span></span>|host_hostname|<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg_prepend</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">output_delimeter</span></span></span><span class="hljs-tag">&gt;</span></span>:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">output_delimeter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fields</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>host<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span>input<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span>host<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">avg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>avg<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span>output<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span>avg<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">avg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">max</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>max<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span>output<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span>max<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">max</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">min</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>min<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span>output<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span>min<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">min</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">loss</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>loss<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span>output<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">direction</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span>loss<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query_name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">loss</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fields</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interface</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><br><h2>  Script </h2><br>  The template we have already described everything that is needed.  There are four modes of operation, and therefore four modes of calling. <br><br><h3>  Index </h3><br><blockquote> <code>&lt;script_path&gt; &lt;arg_prepend&gt; &lt;arg_index&gt;</code> </blockquote> <br>  The output of all possible values ‚Äã‚Äãof the indices, each with a new line.  For a solvable problem, this is a list of all possible remote nodes that are monitored on the server under control.  All servers give the same set of data, so we define them directly in the script, this is the only place where we need to change something.  Of course, the data set can be different and can be taken directly from the server, if necessary.  For which server should we return the list we learn from the first parameter, which, <code>|host_hostname|</code> remind you, is specified in the template as <code>|host_hostname|</code>  : <br><blockquote><pre> <code class="bash hljs">hosts=<span class="hljs-string"><span class="hljs-string">"ya.ru habrahabr.ru"</span></span> zabbix=<span class="hljs-string"><span class="hljs-string">"/usr/local/bin/zabbix_get -s </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> index) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> host <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$hosts</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> ;; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span></code> </pre> </blockquote><br><h3>  Num_indexes </h3><br><blockquote> <code>&lt;script_path&gt; &lt;arg_prepend&gt; &lt;arg_num_indexes&gt;</code> </blockquote> <br>  The number of indexes from the first mode: <br><blockquote><pre> <code class="bash hljs">numhosts=`<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$hosts</span></span> | wc -w` <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> num_indexes) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$numhosts</span></span> ;; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span></code> </pre> </blockquote><br><h3>  Query </h3><br><blockquote> <code>&lt;script_path&gt; &lt;arg_prepend&gt; &lt;arg_query&gt; &lt;query_name&gt;</code> </blockquote> <br>  It is executed for all data fields defined as <i>Input</i> .  The output should receive an <code>index output_delimeter &lt;&gt;</code> for each index and the specified data field, each with a new row.  Since only one value is defined in the template, and our index is easily readable, so we use it as a result: <br><blockquote><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> query) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> host <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$hosts</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> host) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$host</span></span>:<span class="hljs-variable"><span class="hljs-variable">$host</span></span> ;; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> ;; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span></code> </pre> </blockquote><br>  All the listed modes are executed at the moment of forming the list of node elements.  The next mode is called each time the data is polled for each index and each argument. <br><br><h3>  Get </h3><br><blockquote> <code>&lt;script_path&gt; &lt;arg_prepend&gt; &lt;arg_get&gt; &lt;query_name&gt;</code> <br>  Called for all data fields defined as <i>Output</i> .  The output should be <code>&lt;&gt;</code> for the specified field and index.  What is simpler than in <i>Data Input</i> , where you need to output values ‚Äã‚Äãin a formatted string, everything here is already defined in the template: <br><blockquote><pre> <code class="bash hljs">zabbix=<span class="hljs-string"><span class="hljs-string">"/usr/local/bin/zabbix_get -s </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_ping</span></span></span></span> () { res=`<span class="hljs-variable"><span class="hljs-variable">$zabbix</span></span> -k ping[<span class="hljs-variable"><span class="hljs-variable">$1</span></span>,<span class="hljs-variable"><span class="hljs-variable">$2</span></span>]` <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-variable"><span class="hljs-variable">$res</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> res=-1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$res</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> get) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> $(get_ping <span class="hljs-variable"><span class="hljs-variable">$4</span></span> <span class="hljs-variable"><span class="hljs-variable">$3</span></span>) ;; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span></code> </pre> </blockquote><br><div class="spoiler">  <b class="spoiler_title">All code</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh hosts="ya.ru habrahabr.ru" numhosts=`echo $hosts | wc -w` zabbix="/usr/local/bin/zabbix_get -s $1" get_ping () { res=`$zabbix -k ping[$1,$2]` if [ -z $res ] then res=-1 fi echo $res } case $2 in index) for host in $hosts; do echo $host; done ;; num_indexes) echo $numhosts ;; query) for host in $hosts do case $3 in host) echo $host:$host ;; esac done ;; get) echo $(get_ping $4 $3) ;; esac exit 0</span></span></code> </pre> </div></div><br>  It remains to check - create <i>Data Queries</i> bind it to the site and perform a debug launch of <i>Verbose Query</i> . <br><br>  Template without errors: <br><blockquote><pre> <code class="hljs pgsql">+ <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> data query <span class="hljs-type"><span class="hljs-type">XML</span></span> file at <span class="hljs-string"><span class="hljs-string">'/usr/local/cacti/resource/script_queries/fping-stat.xml'</span></span> + <span class="hljs-type"><span class="hljs-type">XML</span></span> file parsed ok.</code> </pre> </blockquote><br>  <i>Num_indexes</i> mode, number of elements: <br><blockquote><pre> <code class="hljs pgsql">+ Executing script <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> num <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> indexes <span class="hljs-string"><span class="hljs-string">'/usr/local/cacti/scripts/query-fping-stat.sh server num_indexes'</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> indexes: <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> </blockquote><br>  <i>Index</i> mode, a list of all items: <br><blockquote><pre> <code class="hljs pgsql">+ Executing script <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> list <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> indexes <span class="hljs-string"><span class="hljs-string">'/usr/local/cacti/scripts/query-fping-stat.sh server index'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Index</span></span> Count: <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>: ya.ru + <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>: habrahabr.ru</code> </pre> </blockquote><br>  <i>Query</i> mode, <i>Output</i> values ‚Äã‚Äãof all arguments for all elements: <br><blockquote><pre> <code class="hljs pgsql">+ Executing script query <span class="hljs-string"><span class="hljs-string">'/usr/local/cacti/scripts/query-fping-stat.sh server query host'</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> item [host=<span class="hljs-string"><span class="hljs-string">'ya.ru'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>: ya.ru + <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> item [host=<span class="hljs-string"><span class="hljs-string">'habrahabr.ru'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>: habrahabr.ru</code> </pre> </blockquote><br>  If everything works, then we act as always in Cacti, <a href="http://docs.cacti.net/manual:088:3a_advanced_topics.3d_script_data_query_walkthrough">create a data</a> <a href="http://docs.cacti.net/manual:088:3a_advanced_topics.3d_script_data_query_walkthrough">template, graph templates</a> .  <a href="http://docs.cacti.net/manual:088:3a_advanced_topics.3d_script_data_query_walkthrough">We connect together</a> , it should be done directly in the created <i>Data Queries</i> .  After that, we should get a list of available parameters automatically when using <i>Create Graphs for this Host</i> . <br><br>  Now we create a graph, then a script call is added to <i>Poller</i> for each <i>Input</i> argument, each index and each node.  When viewing the <i>Poller Cache you</i> can see, among other things, with what parameters the script is called: <br><blockquote><pre> <code class="hljs pgsql">Script: /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/cacti/scripts/query-fping-stat.sh <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> avg ya.ru</code> </pre> </blockquote><br>  This means that you can enjoy the almost automatic addition of new graphs, and the sysadmin to continue to do more important things. <br><br><div class="spoiler">  <b class="spoiler_title">PS Did you fix what was broken?</b> <div class="spoiler_text">  When the text was completely ready, looking at the graphics, I realized that even a pretty altered last year's version does not fix the problem.  On many other graphs that use standard <i>Data Queries Script</i> , some time after re-introducing the solution described, data is not removed and displayed several times a day.  Perhaps a feature of the used infrastructure, or configuration errors.  In any case, this does not cancel the convenience of the <i>Data Queries</i> , but the reason ...: ‚ÄúWe will search‚Äù (c) </div></div></blockquote></div><p>Source: <a href="https://habr.com/ru/post/211254/">https://habr.com/ru/post/211254/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../211242/index.html">Saving on phones for Lync</a></li>
<li><a href="../211244/index.html">Notepad vs goal setting service</a></li>
<li><a href="../211246/index.html">What features does a student need in a mobile phone?</a></li>
<li><a href="../211248/index.html">Moto G Review: The Last True "Motor"</a></li>
<li><a href="../21125/index.html">Modding Ideas</a></li>
<li><a href="../211256/index.html">Baboom: Kim Dotcom New Project</a></li>
<li><a href="../211260/index.html">Example of jQuery UI + PHP and GD. Application of the image</a></li>
<li><a href="../211262/index.html">HP will pay a record $ 150K for an exploit at Pwn2Own 2014</a></li>
<li><a href="../211264/index.html">Counting Hamming distances on a large dataset</a></li>
<li><a href="../211266/index.html">Save health% username%: sports search engine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>