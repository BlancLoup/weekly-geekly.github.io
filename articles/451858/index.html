<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making a simple Spring-based Circuit Breaker</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is for those who use an effective cache in their application and simply want to add stability to the project, adding stability not only t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making a simple Spring-based Circuit Breaker</h1><div class="post__text post__text-html js-mediator-article">  This article is for those who use an effective cache in their application and simply want to add stability to the project, adding stability not only to the application, but to the whole environment. <br><br>  If you recognize yourself, read on. <br><br><h2>  What is Circuit Breaker </h2><br><img src="https://habrastorage.org/webt/w-/bn/xj/w-bnxjrhl9n7nnjby9grw571koa.png" alt="Frame from movie Back to the Future"><br><a name="habracut"></a><br>  The topic is hackneyed like the world and will not bore you by increasing entropy and repeating the same thing.  From my point of view, Martin Fowler spoke best about this <a href="https://martinfowler.com/bliki/CircuitBreaker.html">here</a> , but I will try to fit the definition into one sentence: <br>  <i>functionality that prevents inherently doomed requests to an unavailable service, allowing it to ‚Äúget up off its knees‚Äù and continue normal operation</i> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Ideally, by preventing fated requests, Circuit Breaker (hereinafter referred to as CB) should not break your application.  Instead, it is good practice to return, if not the most relevant data, but still relevant (‚Äúnot rotten‚Äù), or, if this is not possible, some default value. <br><br><h2>  Goals </h2><br>  Select the main thing: <br><br><ol><li>  It is necessary to allow the data source to recover by stopping requests to it for a while. </li><li>  In the case of stopping requests to the target service, you need to give, if not the most recent, but still relevant data </li><li>  In case the target service is unavailable and there is no relevant data, provide a behavior strategy (returning a default value or another strategy that is appropriate for a particular case) </li></ol><br><h2>  Implementation mechanism </h2><br><h3>  Case: service available (first request) </h3><br><ol><li>  We go to the cache.  By key (CRT see below).  We see that there is nothing in the cache </li><li>  We go to the target service.  Get the value </li><li>  We save the value in the cache, set the TTL to it, which will cover the maximum possible unavailability of the target service, but it should not exceed the validity period of the data that you are ready to give to the client in case of loss of communication with the target service </li><li>  We save to cache for the value from p.3. Cache Refresh Time (CRT) - the time after which you need to try to go to the target service and update the value </li><li>  We return the value from item 2 to the user. </li></ol><br><h3>  Case: CRT has not expired </h3><br><ol><li>  We go to the cache.  By key find CRT.  We see that it is relevant </li><li>  We get the value for it from the cache </li><li>  Return user value </li></ol><br><h3>  Case: CRT expired, target service available </h3><br><ol><li>  We go to the cache.  By key find CRT.  We see that it is irrelevant </li><li>  We go to the target service.  Get the value </li><li>  Update the value in the cache and its TTL </li><li>  Updating the CRT for it by adding the Cache Refresh Period (CRP) is the value that needs to be added to the CRT to get the next CRT </li><li>  Return user value </li></ol><br><h3>  Case: CRT expired, target service unavailable </h3><br><ol><li>  We go to the cache.  By key find CRT.  We see that it is irrelevant </li><li>  We go to the target service.  It is unavailable </li><li>  Get the value from the cache.  Not the freshest (with rotten CRT), but still relevant since its TTL has not yet expired </li><li>  We return it to the user. </li></ol><br><h3>  Case: CRT expired, target service unavailable, nothing in cache </h3><br><ol><li>  We go to the cache.  By key find CRT.  We see that it is irrelevant </li><li>  We go to the target service.  It is unavailable </li><li>  Get the value from the cache.  He is not </li><li>  We are trying to apply a special strategy for such cases.  For example, returning the default value for the specified field, or a special value of the type ‚ÄúCurrently this information is not available.‚Äù  In general, if this is possible, it is better to return something and not to break the application.  If this is not possible, then an exception exception and quick response strategy must be applied to the exception user. </li></ol><br><h2>  What will we use </h2><br>  I use Spring Boot 1.5 in my project, I still haven't found the time to upgrade to the second version. <br><br>  To prevent the article from getting 2 times longer, I will use Lombok. <br><br>  As Key-Value storage (hereinafter simply KV) I use Redis 5.0.3, but I am sure that Hazelcast or equivalent will work.  The main thing is to implement the interface CacheManager.  In my case, this is RedisCacheManager from spring-boot-starter-data-redis. <br><br><h2>  Implementation </h2><br>  Above, in the ‚ÄúImplementation Mechanism‚Äù section, two important definitions were heard: CRT and CRP.  I will write them again more deployed, because  they are very important for understanding the code that follows: <br><br>  Cache Refresh Time ( <b>CRT</b> ) is a separate entry in KV (key + postfix ‚Äú_crt‚Äù), which shows the time when it would be time to go to the target service for fresh data.  Unlike TTL, the CRT offensive does not mean that your data is ‚Äúrotten‚Äù, but just the fact that there is a chance to get fresher in the target service.  Got fresh - well, if not, and the current will go. <br><br>  Cache Refresh Period ( <b>CRP</b> ) is the value that is added to the CRT after polling the target service (whether successful or not).  Thanks to her, the remote service has the ability to ‚Äúcatch your breath‚Äù and restore your work in case of a fall. <br><br>  So, traditionally we start with the design of the main interface.  It is through him that you will need to work with the cache if you need the logic CB.  It should be as simple as possible: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CircuitBreakerService</span></span></span><span class="hljs-class"> </span></span>{ &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStableValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evictValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EvictValueParameter parameter)</span></span></span></span>; }</code> </pre> <br>  Interface options: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Getter</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StableValueParameter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String cachePrefix; <span class="hljs-comment"><span class="hljs-comment">//    private String objectCacheKey; private long crpInSeconds; // Cache Refresh Period private Supplier&lt;T&gt; targetServiceAction; //      private DisasterStrategy disasterStrategy; //   : CRT ,   ,     public StableValueParameter( String cachePrefix, String objectCacheKey, long crpInSeconds, Supplier&lt;T&gt; targetServiceAction ) { this.cachePrefix = cachePrefix; this.objectCacheKey = objectCacheKey; this.crpInSeconds = crpInSeconds; this.targetServiceAction = targetServiceAction; this.disasterStrategy = new ThrowExceptionDisasterStrategy(); } }</span></span></code> </pre><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Getter</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EvictValueParameter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String cachePrefix; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String objectCacheKey; }</code> </pre><br>  So we will use it: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> AccountDataResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAccount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String accountId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> StableValueParameter&lt;?&gt; parameter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StableValueParameter&lt;&gt;( ACCOUNT_CACHE_PREFIX, accountId, properties.getCrpInSeconds(), () -&gt; bankClient.findById(accountId) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> circuitBreakerService.getStableValue(parameter); }</code> </pre><br>  If you need to clear the cache, then: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evictAccount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String accountId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> EvictValueParameter parameter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EvictValueParameter( ACCOUNT_CACHE_PREFIX, accountId ); circuitBreakerService.evictValue(parameter); }</code> </pre><br>  Now the most interesting is the implementation (explained in the comments in the code): <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStableValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Cache cache = cacheManager.getCache(parameter.getCachePrefix()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cache == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> logAndThrowUnexpectedCacheMissing(parameter.getCachePrefix(), parameter.getObjectCacheKey()); } <span class="hljs-comment"><span class="hljs-comment">//   .   CRT final String crtKey = parameter.getObjectCacheKey() + CRT_CACHE_POSTFIX; //  CRT  ,    final LocalDateTime crt = Optional.ofNullable(cache.get(crtKey, LocalDateTime.class)) .orElseGet(() -&gt; DateTimeUtils.now().minusSeconds(1)); if (DateTimeUtils.now().isBefore(crt)) { //  CRT   ,     final Optional&lt;T&gt; valueFromCache = getFromCache(parameter, cache); if (valueFromCache.isPresent()) { return valueFromCache.get(); } } //  CRT  ,        return getFromTargetServiceAndUpdateCache(parameter, cache, crtKey, crt); } private static &lt;T&gt; Optional&lt;T&gt; getFromCache(StableValueParameter parameter, Cache cache) { return (Optional&lt;T&gt;) Optional.ofNullable(cache.get(parameter.getObjectCacheKey())) .map(Cache.ValueWrapper::get); }</span></span></code> </pre><br>  If the target service is unavailable, we try to retrieve still relevant data from the cache: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromTargetServiceAndUpdateCache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( StableValueParameter parameter, Cache cache, String crtKey, LocalDateTime crt )</span></span></span><span class="hljs-function"> </span></span>{ T result; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { result = getFromTargetService(parameter); } <span class="hljs-comment"><span class="hljs-comment">/* Circuit breaker exceptions */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (WebServiceIOException ex) { log.warn( <span class="hljs-string"><span class="hljs-string">"[CircuitBreaker] Service responded with error: {}. Try get from cache {}: {}"</span></span>, ex.getMessage(), parameter.getCachePrefix(), parameter.getObjectCacheKey()); result = getFromCacheOrDisasterStrategy(parameter, cache); } cache.put(parameter.getObjectCacheKey(), result); cache.put(crtKey, crt.plusSeconds(parameter.getCrpInSeconds())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromTargetService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) parameter.getTargetServiceAction().get(); }</code> </pre><br>  If there is no actual data in the cache (they were deleted by TTL, and the target service is still unavailable), then we use DisasterStrategy: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromCacheOrDisasterStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter, Cache cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) getFromCache(parameter, cache).orElseGet(() -&gt; parameter.getDisasterStrategy().getValue()); }</code> </pre><br>  There is nothing interesting in removing from the cache; I will bring it here only to complete the picture: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromCacheOrDisasterStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter, Cache cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) getFromCache(parameter, cache).orElseGet(() -&gt; parameter.getDisasterStrategy().getValue()); }</code> </pre><br>  There is nothing interesting in removing from the cache; I will bring it here only to complete the picture: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evictValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EvictValueParameter parameter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Cache cache = cacheManager.getCache(parameter.getCachePrefix()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cache == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { logAndThrowUnexpectedCacheMissing(parameter.getCachePrefix(), parameter.getObjectCacheKey()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String crtKey = parameter.getObjectCacheKey() + CRT_CACHE_POSTFIX; cache.evict(crtKey); }</code> </pre><br><h2>  Disaster strategy </h2><br><img src="https://habrastorage.org/webt/ka/fw/_0/kafw_0jvueyuguwcdbjz4eksnz8.png" alt="Frame from movie Back to the Future"><br><br>  This, in fact, is the logic that occurs, if the CRT has expired, the target service is unavailable, there is nothing in the cache. <br><br>  I wanted to describe this logic separately, because  many do not reach out to think and how to implement it.  But this is, in fact, what makes our system truly sustainable. <br><br>  Do not you want to experience that sense of pride in your child, when everything that can only fail, but your system still works.  Even in spite of the fact that, for example, in the ‚Äúprice‚Äù field, the actual value of the goods will not be displayed, but the inscription: ‚Äúis currently being clarified‚Äù, but how much better this is than the answer ‚Äú500 service is unavailable‚Äù.  After all, for example, the remaining 10 fields: product description, etc.  you returned.  How much does the quality of this service change? .. My call is to pay more attention to the details, making them more qualitative. <br><br>  I finish the lyrical digression.  So, the strategy interface will be as follows: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DisasterStrategy</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br>  You should select implementation depending on a specific case.  For example, if you can return some default value, you can do something like this: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultValueDisasterStrategy</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DisasterStrategy</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"   "</span></span>; } }</code> </pre><br>  Or, if in a specific case you don‚Äôt return anything at all, then you can throw an exception: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThrowExceptionDisasterStrategy</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DisasterStrategy</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Object</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CircuitBreakerNullValueException(<span class="hljs-string"><span class="hljs-string">"Ops! Service is down and there's null value in cache"</span></span>); } }</code> </pre><br>  In such a case, the CRT will not be incremented and the next request will follow the target service again. <br><br><h2>  Conclusion </h2><br>  I adhere to the following point of view - if you have the opportunity to use a ready-made solution, and not to fence, in fact, a simple, but nevertheless a bicycle, as in this article, do so.  Use this article to understand the principles of operation, and not as a guide to action. <br><br>  There are many ready-made solutions, especially if you are using Spring Boot 2, such as Hystrix. <br><br>  The most important thing to understand is that this decision is based on the cache and its efficiency is equal to the efficiency of the cache.  If the cache is inefficient (few hits, many misses), then this Circuit Breaker will be just as ineffective: every cache miss will be followed by going to the target service, which may be in agony and agony at this moment, trying to rise. <br><br>  Be sure, before applying this approach, measure the effectiveness of your cache.  This can be done by ‚ÄúCache Hit Rate‚Äù = hits / (hits + misses), should aim for 1, not 0. <br><br>  And yes, no one bothers you to keep several variants of CB in your project at once, applying the one that best solves a specific problem. </div><p>Source: <a href="https://habr.com/ru/post/451858/">https://habr.com/ru/post/451858/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451848/index.html">Automation of management of Let's Encrypt SSL certificates using DNS-01 challenge and AWS</a></li>
<li><a href="../451850/index.html">"HumHub" - Russian-language replica of the social network in I2P</a></li>
<li><a href="../451852/index.html">Remote execution of arbitrary code in the RDP protocol</a></li>
<li><a href="../451854/index.html">Interview - 10 questions about Swift. Part 1</a></li>
<li><a href="../451856/index.html">Install openmeetings 5.0.0-M1. WEB-conferences without Flash</a></li>
<li><a href="../45186/index.html">Subtlely beautiful user experience</a></li>
<li><a href="../451860/index.html">Mathematicians have discovered the perfect way to multiply numbers.</a></li>
<li><a href="../451862/index.html">Joe Diprima's musical lightning: a self-taught engineer makes Tesla coils for fun and money</a></li>
<li><a href="../451864/index.html">Critical EternalBlue RCE vulnerability detected in Windows</a></li>
<li><a href="../451866/index.html">Choose the closest nodes in the network</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>