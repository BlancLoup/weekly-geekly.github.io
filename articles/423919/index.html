<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to automate the collection of KPI for the month and leave users almost satisfied</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In many organizations, subdivisions are evaluated using KPI (Key Performance Indicators). In the organization where I work, such a system is called th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to automate the collection of KPI for the month and leave users almost satisfied</h1><div class="post__text post__text-html js-mediator-article">  In many organizations, subdivisions are evaluated using KPI (Key Performance Indicators).  In the organization where I work, such a system is called the ‚Äúperformance indicator system,‚Äù and in this article I want to talk about how we managed to automate part of the work with the indicators in a month.  With all this, our labor costs were not the greatest, but at the same time we tried to implement some of the old Wishlist.  In my story there will be no HYIP technologies or revelations (after all, the provincial development is harsh), but there will be some sketches on the topic that will help you understand where we started, what we did, and what thoughts we had on the results of the development.  If you have not yet become bored, please under the cat. <br><a name="habracut"></a><br><h3>  Prehistory </h3><br>  Back in 2006, we already introduced a system of performance indicators: fifteen evaluation criteria were developed, a method for calculating them, a quarterly periodicity for calculating these indicators was established.  The assessment was carried out for twenty-two branches of the organization located in all areas of our region.  And so that the indicators are achieved with great enthusiasm, the premium was attached to them - the higher the sum of the indicators, the higher the place in the rating, the higher the place in the rating, the higher the premium and so every quarter and every year. <br><br>  Over time, the composition of the criteria changed, each quarter new ones were added, then old ones were excluded.  At the peak, approximately in 2016, the number of indicators exceeded forty, and now there are only fourteen. <br><br>  However, all this time the process of their calculation was of the same type.  Each criterion is calculated by the responsible division of the head organization according to the algorithm approved for this criterion.  The calculation can be carried out using a simple formula, as well as a number of complex ones, it may require data collection from several systems, and it is very likely that the algorithm will change quite often.  And then everything is much simpler: the indicator calculated as a percentage is multiplied by its coefficient, thus, a score is obtained according to the criterion, then the scores are ranked and each division takes its place according to the score.  The same is done with the sum of points for the calculation of the final place. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      From the very beginning, in order to take into account and calculate all the above, Excel was used.  For many years, the final set of criteria and further calculation of points and places was made in a nice tablet, part of which is shown in the figure. <br><br><img src="https://habrastorage.org/webt/vg/wa/c6/vgwac6cdozzjztrpwhci_smaon4.png"><br><br>  I note only that in this pretty tablet, most of the columns are simply hidden, but in reality in the 4th quarter of 2016 it looked like this <br><br><img src="https://habrastorage.org/webt/ku/8s/ah/ku8sah_m9zrjx3ozezxqvz2w9xq.png"><br><br>  Agree, such a number of indicators and such a volume of the table do not add simplicity to it.  In addition, each of the criteria was calculated separately, and the girls from the general department made this summary table with their hands.  Considering that not only the composition of the criteria changed, but also the calculations could be redone several times (for many reasons), the last days of each quarter, to put it mildly, did not please.  We had to constantly change the data in the table, check and recheck them: you will forget to add a new column to the sum of points, or you will not update the coefficient, and because of this, someone will have a lower place, and with it a premium less.  Therefore, after the heroic information of the table, a no less heroic test began; all those who counted each criterion, managers, and even an organizational IT specialist, checked and agreed.  Considering that all the work was done manually, and calculations of indicators for the pivot table were sent to the post office, quite often there were situations when there were both formulas errors and data of irrelevant versions in the pivot table.  The captain of evidence reports that after identifying each error, the verification process was restarted. <br>  When all indicators were calculated, the tablet was approved and sent to the branches, it was rechecked there in the branches: what if the insidious Excel thought something was wrong?  I think it is obvious that drawing up an annual report on the criteria or analyzing historical data turned out to be no less exciting quest. <br><br>  However, from a managerial point of view, such a system is quite effective and allows, if necessary, to pull down subsiding areas of work, monitor and have an idea of ‚Äã‚Äãwhat is happening in each of the branches in one or another area of ‚Äã‚Äãwork.  In addition, the location of the branch, calculated by the criteria, was an integral indicator. <br><br><h3>  The system must change </h3><br>  Practice proved the necessity and importance of the evaluation system.  In early 2017, it became clear that the calculation of the criteria once a quarter allowed us to evaluate the work done, but here it was poorly allowed to monitor it.  Too much time.  In this regard, we decided that the calculation of indicators will be held once every two weeks, and the results will be summarized all the same quarterly.  An increase in the frequency of calculation allowed the branch managers to quickly respond to changes and increase control over the processes within their departments. <br><br>  Here, only in the head organization, few people were pleased with the prospect of carrying out the data collection process described above not quarterly, but every two weeks.  As it is not difficult to guess, they decided to automate the process.  The dates turned out to be tight: from the moment of the decision to switch to the new periodicity of the calculation to the actual transition, only a month had to pass.  During this period it was very desirable to come up with something better than a bunch of Excel for the set and calculation, and mail for collection and notification. <br><br>  At first, there was a rather hot discussion about the fact that it is very, very necessary to make automatic the calculation of indicators itself, taking into account all their formulas and data sources.  But given the tight deadlines, the complexity of such functionality and the need to maintain it up to date, we managed to come to the following system requirements: <br><br><ul><li>  There should be a reference book of criteria, preserving the history of their changes; </li><li>  It should be possible to enter and store the calculated indicators, as well as their conversion into points as in the plate itself; </li><li>  According to the values ‚Äã‚Äãof the indicators, a report should be made available to all interested parties; </li><li>  Naturally, all this should be provided with a web interface. </li></ul><br>  The functionality is quite small, but a little time. <br><br><h3>  Start of development </h3><br>  I have always been attracted to the rapid development and automatic generation of interfaces.  In those cases when it is necessary to implement the functionality of CRUD, the idea seems very tempting when the interface and part of the business logic will be provided out of the box, so to speak.  Of course, the interface will be unassuming and the logic is clumsy, but for many tasks this is enough. <br><br>  Driven by these ideas, I decided to try something like this.  There are Spring Roo, Cuba and other interesting tools, but the choice fell on OpenXava.  First of all, once I already did quite a simple application on it and was satisfied, and secondly, at that time this framework fit into our technological stack quite well.  In addition, the presence of a short tutorial in Russian is very pleased. <br><br>  A brief description of the features and capabilities of OpenXava can be read <a href="http://openxava.org/OpenXavaDoc/docs/reference_ru.html">here</a> .  OpenXava is a framework that implements the automatic construction of a web interface integrated with a database, based on JPA, and uses annotations to describe the rules of visualization.  The application is based on business components ‚Äî Java classes that contain the information necessary to create applications.  Such information includes data structure, validators, valid representations, mapping on database tables.  Operations on business components are carried out through controllers, out of the box who can CRUD, search, export to PDF, etc.  OpenXava application is a set of modules.  A module associates a business component with one or more controllers.  To display the interface, the views defined for each business component are used.  Nothing unusual, MVC with a bit of its atmosphere. <br><br><h3>  Data storage </h3><br>  In most applications, we use IBM DB2 DBMS.  A small database was created, storing reference books of criteria and criteria for evaluating branches, a directory of branches, and a label containing calculated criteria values.  Each criterion at a certain point in time is assigned a coefficient that will be used when calculating points.  Each branch, for each criterion, receives an estimate also for a specific date.  The data on the values ‚Äã‚Äãof the criteria are stored historically, that is, data that is relevant for any date will be those that were entered as of the nearest date in the past.  This approach, inspired by the registers of information from 1C: Enterprise, seems to me to be quite convenient: there is a story with editing / deleting issues as well. <br><br><div class="spoiler">  <b class="spoiler_title">Database structure</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.CLS_DEPART ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, PARENT_ID <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, IS_DELETED <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.CLS_CRITERIA ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, IS_DELETED <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.CLS_GROUP_CRITERIA ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, IS_DELETED <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.REG_STATE_CRITERIA ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, ID_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, ID_GROUP_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, TIME_BEGIN <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, TIME_END <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'9999-12-31-23.59.59.000000000000'</span></span>, TIME_CREATE <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, KOEFFICIENT <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_CRITERIA) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_CRITERIA(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_GROUP_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_GROUP_CRITERIA) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_GROUP_CRITERIA(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.REG_VALUE_CRITERIA ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, ID_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, ID_GROUP_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, ID_DEPART <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, DATE_REG <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, TIME_END <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'9999-12-31-23.59.59.000000000000'</span></span>, TIME_BEGIN <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">PERCENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), VAL <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_CRITERIA) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_CRITERIA(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_DEPART <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_DEPART) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_DEPART(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_GROUP_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_GROUP_CRITERIA) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_GROUP_CRITERIA(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT );</code> </pre> <br></div></div><br>  In order to get the coveted report on the indicators of the branches from the database, stored functions were created, the results of which are already distributed to the Java class.  Functions look like this. <br><div class="spoiler">  <b class="spoiler_title">First, we will get all the criteria valid on the date, as well as the actual coefficients of the criterion</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> SUMMAR.SLICE_STATE_ALL_CRITERIA ( PMAX_TIME <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> ( ID_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, ID_GROUP_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, TIME_BEGIN <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, TIME_END <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, TIME_CREATE <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, KOEFFICIENT <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> RSC.ID_CRITERIA, RSC.ID_GROUP_CRITERIA, RSC.TIME_BEGIN, RSC.TIME_END, RSC.TIME_CREATE, RSC.KOEFFICIENT <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> SUMMAR.REG_STATE_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> RSC <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ID_CRITERIA, <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(TIME_BEGIN) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> TIME_BEGIN <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> ID_CRITERIA, TIME_BEGIN <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> SUMMAR.REG_STATE_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> TIME_BEGIN &lt; PMAX_TIME <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> TIME_END &gt; PMAX_TIME ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SL <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> MAX_SLICE <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> RSC.ID_CRITERIA = MAX_SLICE.ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> RSC.TIME_BEGIN = MAX_SLICE.TIME_BEGIN ;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Now we will receive on the same date the values ‚Äã‚Äãof all criteria for all branches</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> SUMMAR.SLICE_VALUE_ACTUAL_ALL_CRITERIA_ALL_DEPART_WITH_NAMES ( PMAX_TIME <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> ( ID_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, ID_GROUP_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, ID_DEPART <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, DATE_REG <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">PERCENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), VAL <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), KOEFFICIENT <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), CRITERIA_NAME <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, CRITERIA_CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), GROUP_CRITERIA_NAME <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, GROUP_CRITERIA_CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), DEPART_NAME <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, DEPART_CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), DEPART_CODE_INT <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> CDEP.ID_CRITERIA, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.ID_GROUP_CRITERIA, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ID_GROUP_CRITERIA, CDEP.ID_DEPART, VALS.DATE_REG, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.PERCENT, <span class="hljs-number"><span class="hljs-number">0.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PERCENT</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.VAL, <span class="hljs-number"><span class="hljs-number">0.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> VAL, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.KOEFFICIENT, <span class="hljs-number"><span class="hljs-number">0.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> KOEFFICIENT, CDEP.CRITERIA_NAME, CDEP.CRITERIA_CODE, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.GROUP_CRITERIA_NAME, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> GROUP_CRITERIA_NAME, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.GROUP_CRITERIA_CODE, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> GROUP_CRITERIA_CODE, CDEP.DEPART_NAME, CDEP.DEPART_CODE, CDEP.DEPART_CODE_INT <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> CCRT.ID <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ID_CRITERIA, CCRT.<span class="hljs-string"><span class="hljs-string">"NAME"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CRITERIA_NAME, CCRT.CODE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CRITERIA_CODE, CDEP.ID <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ID_DEPART, CDEP.<span class="hljs-string"><span class="hljs-string">"NAME"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> DEPART_NAME, CDEP.CODE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> DEPART_CODE, <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span> (CDEP.CODE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> DEPART_CODE_INT <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> SUMMAR.CLS_DEPART <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CDEP, ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> SUMMAR.CLS_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CC <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span>(SUMMAR.SLICE_STATE_ALL_CRITERIA (PMAX_TIME)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ACTC <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> CC.ID = ACTC.ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> CC.IS_DELETED = <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CCRT <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> CDEP.IS_DELETED = <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CDEP <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> VALS.ID_CRITERIA, VALS.ID_GROUP_CRITERIA, VALS.ID_DEPART, VALS.DATE_REG, VALS.PERCENT, VALS.VAL, VALS.KOEFFICIENT, CGRT.<span class="hljs-string"><span class="hljs-string">"NAME"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> GROUP_CRITERIA_NAME, CGRT.CODE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> GROUP_CRITERIA_CODE <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span>(SUMMAR.SLICE_VALUE_ACTUAL_ALL_CRITERIA (PMAX_TIME)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> VALS <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> SUMMAR.CLS_GROUP_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CGRT <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> VALS.ID_GROUP_CRITERIA = CGRT.ID ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> VALS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> CDEP.ID_DEPART = VALS.ID_DEPART <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> CDEP.ID_CRITERIA = VALS.ID_CRITERIA ;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">In the final query, we will enumerate the values ‚Äã‚Äãof the indicators, rank them and find the minimum and maximum, this will be needed in order to calculate the places</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ROW_NUMBER() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ID_NUM, <span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> RATING, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) ) <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>() = <span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> MAX_RATING, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MIN</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) ) <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>() = <span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> MIN_RATING, VALS.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span>(SUMMAR.SLICE_VALUE_ACTUAL_ALL_CRITERIA_ALL_DEPART_WITH_NAMES (?)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> VALS <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> GROUP_CRITERIA_CODE, CRITERIA_CODE, DEPART_CODE_INT</code> </pre><br></div></div><br>  Transferring a part of business logic to a DBMS turns out to be quite justified, especially when it comes to preparing data for different reports.  Operations can be written in a more concise and natural form. In Java, such data manipulations would require more code and some effort to structure it.  Although relatively complex or non-trivial operations are still easier to program in Java.  Therefore, in our application for data sampling, an approach is used when joining data sets, clipping conditions and some operations that can be performed by window functions are performed in stored functions and procedures, and more complex logic is implemented in the application. <br><br><h3>  application </h3><br>  As I said before, OpenXava was used to implement the application.  To get a standard interface with it and CRUD out of the box, you must perform some actions. <br>  Let's start with the fact that in the web.xml it is necessary to describe a filter and a servlet from an addon navigating through the application: <br><br><div class="spoiler">  <b class="spoiler_title">web.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-app</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://java.sun.com/xml/ns/javaee"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-class</span></span></span><span class="hljs-tag">&gt;</span></span>com.openxava.naviox.web.NaviOXFilter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>*.jsp<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>/modules/*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dispatcher</span></span></span><span class="hljs-tag">&gt;</span></span>REQUEST<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dispatcher</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dispatcher</span></span></span><span class="hljs-tag">&gt;</span></span>FORWARD<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dispatcher</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>module<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-class</span></span></span><span class="hljs-tag">&gt;</span></span>com.openxava.naviox.web.NaviOXServlet<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>/m/*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-app</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Next, in the controllers.xml file, we define the controllers used in the application.  In our case, the simplest is enough: <br><br><div class="spoiler">  <b class="spoiler_title">controllers.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controllers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Typical_View"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extends</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Navigation"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extends</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CRUD"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extends</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ExtendedPrint"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controllers</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  In the given controller, the functions of the controllers included in OpenXava are combined by default, the functions of which are not difficult to guess from the names. <br><br>  And, finally, in the application.xml file, we associate the created controller and model.  Like that: <br><br><div class="spoiler">  <b class="spoiler_title">application.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"summar"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RegValueCriteria"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RegValueCriteria"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Typical_View"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  As mentioned above, the application is based on the business components that make up the application model.  For example, consider the RegValueCriteria component associated with the controller in application.xml.  This component describes the value of the criterion for the branch (for brevity, only the description of the class fields is left, and methods like getters and setters will be omitted): <br><br><div class="spoiler">  <b class="spoiler_title">Component class</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"REG_VALUE_CRITERIA"</span></span>, catalog = <span class="hljs-string"><span class="hljs-string">""</span></span>, schema = <span class="hljs-string"><span class="hljs-string">"SUMMAR"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-meta"><span class="hljs-meta">@Views</span></span>({ <span class="hljs-meta"><span class="hljs-meta">@View</span></span>(members = <span class="hljs-string"><span class="hljs-string">"idCriteria [idCriteria];"</span></span> + <span class="hljs-string"><span class="hljs-string">"idGroupCriteria [idGroupCriteria];"</span></span> + <span class="hljs-string"><span class="hljs-string">"idDepart [idDepart];"</span></span> + <span class="hljs-string"><span class="hljs-string">"data [dateReg, percent, val]"</span></span>), <span class="hljs-meta"><span class="hljs-meta">@View</span></span>(name=<span class="hljs-string"><span class="hljs-string">"massReg"</span></span>, members = <span class="hljs-string"><span class="hljs-string">"idDepart.name, percent, val"</span></span>) }) <span class="hljs-meta"><span class="hljs-meta">@Tab</span></span>(properties= <span class="hljs-string"><span class="hljs-string">"idDepart.name, idCriteria.name, idGroupCriteria.name, dateReg, percent, val"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegValueCriteria</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> serialVersionUID = <span class="hljs-number"><span class="hljs-number">1L</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.IDENTITY) <span class="hljs-meta"><span class="hljs-meta">@Basic</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@Basic</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"DATE_REG"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Temporal</span></span>(TemporalType.TIMESTAMP) <span class="hljs-meta"><span class="hljs-meta">@DefaultValueCalculator</span></span>(CurrentDateCalculator.class) <span class="hljs-meta"><span class="hljs-meta">@Stereotype</span></span>(<span class="hljs-string"><span class="hljs-string">"DATETIME"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Date dateReg; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"PERCENT"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@OnChange</span></span>(OnChangePercentAction.class) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal percent; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"VAL"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal val; <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID_CRITERIA"</span></span>, referencedColumnName = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@DescriptionsList</span></span>( descriptionProperties=<span class="hljs-string"><span class="hljs-string">"name"</span></span> ) <span class="hljs-meta"><span class="hljs-meta">@OnChange</span></span>(OnChangeClsCriteriaAction.class) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ClsCriteria idCriteria; <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID_GROUP_CRITERIA"</span></span>, referencedColumnName = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@DescriptionsList</span></span>( descriptionProperties=<span class="hljs-string"><span class="hljs-string">"name"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ClsGroupCriteria idGroupCriteria; <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID_DEPART"</span></span>, referencedColumnName = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@DescriptionsList</span></span>( descriptionProperties=<span class="hljs-string"><span class="hljs-string">"name"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ClsDepart idDepart; }</code> </pre> <br></div></div><br>  In addition to the usual annotations JPA.  You can see annotations and OpenXava.  They should be considered in more detail. <br><br>  The <code>@View</code> allows <code>@View</code> to control the presentation format of class fields, while using special syntax in the form of square brackets, fields can be combined into groups and arranged horizontally and vertically using the symbols <code>,</code> and <code>;</code>  .  If several displays need to be defined for a single component, the <code>@View</code> annotations are grouped using the <code>@View</code> annotation.  In our example, the properties were designed as follows: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@View</span></span>(members = <span class="hljs-string"><span class="hljs-string">"idCriteria [idCriteria];"</span></span> + <span class="hljs-string"><span class="hljs-string">"idGroupCriteria [idGroupCriteria];"</span></span> + <span class="hljs-string"><span class="hljs-string">"idDepart [idDepart];"</span></span> + <span class="hljs-string"><span class="hljs-string">"data [dateReg, percent, val]"</span></span>)</code> </pre> <br>  And it looks like this: <br><br><img src="https://habrastorage.org/webt/nh/5m/ss/nh5msssvc0-xft3prl99emnw1-e.png"><br><br>  Unlikely, but with a minimum of effort.  However, there are ways to "revive" the form a bit. <br>  In order for the registration date to be filled when creating the component, the <code>@DefaultValueCalculator</code> annotation is <code>@DefaultValueCalculator</code> , which calls a special calculator object.  Here, a calculator from OpenXava itself is used, but you can also make a custom one.  To display the date using the appropriate control, the <code>@Stereotype</code> annotation is <code>@Stereotype</code> . <br><br>  To configure drop-down lists containing related objects, use the <code>@DescriptionsList</code> annotation, in which you can specify which property will be displayed in the list. <br><br>  Using annotations, you can implement some business logic of the form itself.  For example, so that when the percentage changes, the value is calculated automatically, taking into account the criterion coefficient, you can apply the <code>@OnChange</code> annotation for the <code>BigDecimal val</code> field.  For the <code>@OnChange</code> annotation <code>@OnChange</code> work, it needs to point to the class implementing the <code>OnChangePropertyBaseAction</code> interface.  A single <code>execute()</code> method must be implemented in the class, in which the input data is taken from the view, the calculation is made and the calculated value is written back to the view: <br><br><div class="spoiler">  <b class="spoiler_title">Heir class OnChangePropertyBaseAction</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnChangePercentAction</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnChangePropertyBaseAction</span></span></span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ BigDecimal percent = (BigDecimal)getNewValue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (percent != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ Map value = (Map)getView().getValue(<span class="hljs-string"><span class="hljs-string">"idCriteria"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ Long idCriteria = (Long)value.get(<span class="hljs-string"><span class="hljs-string">"id"</span></span>); Query query = XPersistence.getManager().createNativeQuery( <span class="hljs-string"><span class="hljs-string">"SELECT KOEFFICIENT FROM SUMMAR.SLCLA_STATE_CRITERIA WHERE ID_CRITERIA = ?"</span></span>); query.setParameter(<span class="hljs-number"><span class="hljs-number">1</span></span>, idCriteria); List&lt;?&gt; list = query.getResultList(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (list != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; !list.isEmpty()){ BigDecimal koef = (BigDecimal) list.get(<span class="hljs-number"><span class="hljs-number">0</span></span>); BigDecimal vl = koef.multiply(percent); getView().setValue(<span class="hljs-string"><span class="hljs-string">"val"</span></span>, vl); } } } } }</code> </pre> <br></div></div><br>  For the tabular presentation of data, the <code>@Tab</code> annotation is <code>@Tab</code> , which allows listing the properties of objects that will be displayed in the tabular representation.  In our example, the abstract was framed as follows: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Tab</span></span>(properties= <span class="hljs-string"><span class="hljs-string">"idDepart.name, idCriteria.name, idGroupCriteria.name, dateReg, percent, val"</span></span> )</code> </pre> <br>  It will look like this. <br><br><img src="https://habrastorage.org/webt/hb/ps/vs/hbpsvs9i46ue1abfxabexohsnni.png"><br><br>  Pleases the presence of filters, pagination and export out of the box, but many details need to be improved by a file. <br><br>  The work with other components is similarly constructed.  Using OpenXava has dramatically reduced labor costs for the implementation of CRUD functions and most of the user interface.  Using actions from predefined controllers and annotations to build forms saves a lot of time if you don‚Äôt find fault with the details and try to implement something more complicated than a form with multiple events.  Although it may be a matter of experience. <br><br><h3>  That for which everything was started </h3><br>  Remember why the application was started?  Yes, in order for the table with indicators not to be heroically reduced in Excel, but created automatically on the basis of the entered data.  In the browser window, the pivot table looked like this: <br><br><img src="https://habrastorage.org/webt/sm/x_/v1/smx_v17og5oi-ube78ymyhosnie.png"><br><img src="https://habrastorage.org/webt/26/sz/45/26sz45etsyy1jldlfoqff7034zg.png"><br><br>  I will not give details of the implementation, since everything is not very good with it and the mixture of JSP with the HTML generated when requesting data is not something that should be shared with the general public.  At the same time, the data sampling itself was demonstrated above. <br><br>  However, I want to dwell on one interesting detail.  When the requirements for the application were collected, the management wanted very much that in addition to the summary report, the values ‚Äã‚Äãof a separate indicator could be displayed in the form of a map of the region, divided into districts, indicating the place and score of the respective branch.  Who on the map learned the region - that fellow =) <br><br><img src="https://habrastorage.org/webt/ip/8t/a-/ip8ta-wuufxirkycdn_kohxqqkc.png"><br><br>  On the one hand, the requirement was optional, but on the other hand, the picture promised to be vivid, and from the point of view of implementation it was interesting to try.  After some thought, the idea came to find the image of the region in the SVG format and make it an XSLT template. <br><br>  The resulting template is easily filled with data, and then converted to PNG. <br>  First, using the query described above, the data is sampled, the resulting data is converted to an object of this class: <br><br><div class="spoiler">  <b class="spoiler_title">Classes for data output to the map</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-meta"><span class="hljs-meta">@XmlAccessorType</span></span>(XmlAccessType.FIELD) <span class="hljs-meta"><span class="hljs-meta">@XmlType</span></span>(name = <span class="hljs-string"><span class="hljs-string">"VisualisedValuesCriteria"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VisualisedValuesCriteria</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> XMLGregorianCalendar date; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String criteriaName; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String koefficient; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;VisualizedValueCriteria&gt; departValues; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> XMLGregorianCalendar </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> date; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(XMLGregorianCalendar date)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.date = date; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCriteriaName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> criteriaName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCriteriaName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String criteriaName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.criteriaName = criteriaName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKoefficient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> koefficient; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setKoefficient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String koefficient)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.koefficient = koefficient; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;VisualizedValueCriteria&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDepartValues</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (departValues == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ departValues = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> departValues; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDepartValues</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;VisualizedValueCriteria&gt; departValues)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.departValues = departValues; } } <span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-meta"><span class="hljs-meta">@XmlAccessorType</span></span>(XmlAccessType.FIELD) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VisualizedValueCriteria</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String departName; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String departCode; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String value; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String percent; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String colorCode; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDepartName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> departName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDepartName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String departName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.departName = departName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDepartCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> departCode; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDepartCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String departCode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.departCode = departCode; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPercent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> percent; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPercent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String percent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.percent = percent; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getColorCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> colorCode; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setColorCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String colorCode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.colorCode = colorCode; } } }</code> </pre> <br></div></div><br>  Next, convert the object to XML; <br><br><div class="spoiler">  <b class="spoiler_title">Transformation</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Private String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">marshal</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(VisualisedValuesCriteria obj)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Marshaller marshaller = JAXBContext.newInstance(VisualisedValuesCriteria.class).createMarshaller(); marshaller.setEventHandler(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultValidationEventHandler()); marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); StringWriter writer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringWriter(); marshaller.marshal(obj, writer); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> writer.toString(); }</code> </pre> <br></div></div><br>  Now let's take the resulting XML, the prepared XSLT template, apply the transformation and get svg at the output: <br><br><div class="spoiler">  <b class="spoiler_title">Get svg</b> <div class="spoiler_text"><pre> <code class="java hljs"> String xml = marshal(obj); TransformerFactory factory = TransformerFactory.newInstance(); FileInputStream xsltFis = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(<span class="hljs-string"><span class="hljs-string">"C:\\TEMP\\map_xsl.svg"</span></span>); InputStreamReader xsltIn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(xsltFis, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); Source xslt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamSource(xsltIn); Transformer transformer = factory.newTransformer(xslt); InputStream xmlIn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayInputStream( xml.getBytes( <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span> ) ); Source text = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamSource(xmlIn); String filename = <span class="hljs-string"><span class="hljs-string">"map"</span></span> + System.currentTimeMillis() + <span class="hljs-string"><span class="hljs-string">".svg"</span></span>; String filePath = <span class="hljs-string"><span class="hljs-string">"C:\\TEMP\\"</span></span> + filename; transformer.transform(text, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamResult(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(filePath)));</code> </pre> <br></div></div><br>  In principle, this could be stopped, browsers display SVG without any problems.  But the described reports were also obtained via Telegram-bot, therefore SVG should be converted to some type of JPEG or PNG.  For this we use <a href="https://xmlgraphics.apache.org/batik/">Apache Batik</a> <br><br><div class="spoiler">  <b class="spoiler_title">Convert to PNG</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToPNG</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String svg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String filePath)</span></span></span></span>{ String png = filePath + filename + <span class="hljs-string"><span class="hljs-string">".png"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { PNGTranscoder trancoder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PNGTranscoder(); String svgURI = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(svg).toURL().toString(); TranscoderInput input = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TranscoderInput(svgURI); OutputStream ostream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOutputStream(png); TranscoderOutput output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TranscoderOutput(ostream); trancoder.transcode(input, output); ostream.flush(); ostream.close(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filename + <span class="hljs-string"><span class="hljs-string">".png"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (MalformedURLException ex) { Logger.getLogger(ActualCriteriaValueGraphicServlet.class.getName()).log(Level.SEVERE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, ex); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileNotFoundException | TranscoderException ex) { Logger.getLogger(ActualCriteriaValueGraphicServlet.class.getName()).log(Level.SEVERE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, ex); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException ex) { Logger.getLogger(ActualCriteriaValueGraphicServlet.class.getName()).log(Level.SEVERE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, ex); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br></div></div><br>  Report in the form of a map is ready.  It can also be viewed via the browser and requested from the telegram bot.  In my opinion not bad. <br><br><h3>  Conclusion </h3><br>  By the deadline, we had, and in March 2017, performance indicators instead of Excel began to be regularly recorded in the created system.  On the one hand, the maximum task was not solved, the most difficult part of the calculation of indicators is performed manually.  But on the other hand, the implementation of these calculations carried the risk of constant improvement.  In addition, even a simple data collection interface created removed a huge number of questions with constant changes, version control, and a set of Excel tables.  A large amount of manual work, checks and rechecks have been removed. <br><br>  It‚Äôs impossible not to say that the interface on Open Xav did not make the users too happy.  At first, there were many questions about its features.  At some point, users began to complain that it takes too much time to enter data and, in general, ‚Äúwe want, as in Excel, only the program‚Äù.  It was even necessary to monitor the input rate based on data on the time of creation of records.  This monitoring showed that even in the most severe cases, users did not spend more than 15 minutes on input, but usually fit into 5-7, despite the fact that they needed to enter data from 22 branches.  Such indicators seem quite acceptable. <br><br>  However, I want to note two things: <br><br><ol><li>  Open Xava has shown itself as a good tool to quickly create an interface.  I would even say a prototype interface.  Also its undoubted advantage is general orderliness and regularity.  All forms in the application are created according to uniform principles, which allows the developer not to invent bicycles where it is not necessary, and the user to deal with typical sets of forms.  However, attempts to implement more complex logic or change the controls for themselves prompted us to a number of problems that could not be solved in the allotted time.  Most likely, we simply did not understand, and the goal was to create a simple CRUD interface with a minimum of effort.  For myself, I conclude that Open Xav is an interesting tool, in which you simply do simple things, but if you need to do something complicated, I would prefer to spend more energy on creating the client side using ExtJS or React, but at the same time have more flexibility . </li><li>  Even confident users take the new interfaces hard.  This is certainly not a secret.  In my opinion, this is primarily due to the lack of understanding of the consistency of many interfaces.  For many, any application is a set of screens, each of which is unique and works according to its unknown principles: for example, there is a form with a list of objects / lines (a list form), but for very many users it‚Äôs not at all obvious that each such form in an application can have uniform filtering, pagination, sorting functions and, in general, the same behavior, complemented by specific functions.  This is aggravated by the fact that a large number of corporate software are almost spontaneous clutter of buttons and forms, seasoned with vague documentation in the style of "Click this button."  From this point of view, the interfaces created by the same Open Xav discipline the developers of users, create more order in the head.  True, with this approach, the magic buttons do not disappear anywhere, but become neatly arranged in shapes. </li></ol><br>  If we talk about the benefits for the organization as a whole, then after the introduction of the application, as expected, the degree of control increased.  Field managers received a performance monitoring tool with which they can influence work more quickly, compare indicators for different periods, without confusing in the stream of files sent.  The interest of managers in the constant and vigilant control of their branch was discovered by us in a very interesting way: looking at the Telegram-bot logs, we noticed that some reports were received at 4 or 5 am.  We immediately see who is interested in work. <br><br>  That's all.  I would appreciate constructive feedback! </div><p>Source: <a href="https://habr.com/ru/post/423919/">https://habr.com/ru/post/423919/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../423903/index.html">Immersion in AD: disassemble advanced attacks on Microsoft Active Directory and how to detect them</a></li>
<li><a href="../423905/index.html">The developers remained unknown. Yandex lecture</a></li>
<li><a href="../423909/index.html">On all computers in Russia they want to pre-install Russian antiviruses</a></li>
<li><a href="../423911/index.html">Silicon photonics stumbles at the last meter</a></li>
<li><a href="../423915/index.html">"Yandex" with the owners discuss the mechanism of pre-trial removal of pirated links from the search</a></li>
<li><a href="../423921/index.html">10 years of Android: remember everything</a></li>
<li><a href="../423923/index.html">SAP Leonardo Hackathon from velcom and SAP for developers from Belarus</a></li>
<li><a href="../423925/index.html">Open webinar ‚ÄúStrange recursive template‚Äù</a></li>
<li><a href="../423927/index.html">10 promising search engines to improve SEO</a></li>
<li><a href="../423931/index.html">How to bypass SMS-identification when connecting to public Wi-Fi networks?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>