<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mikrotik RoS 6.41: Big Changes in Bridging and VLAN</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="RoS developers have long ago announced changes in the operation of bridges (bridge), and included this new functionality in the Release Candidate bran...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mikrotik RoS 6.41: Big Changes in Bridging and VLAN</h1><div class="post__text post__text-html js-mediator-article">  RoS developers have long ago announced changes in the operation of bridges (bridge), and included this new functionality in the Release Candidate branch, and now they have added this to Current. <br><a name="habracut"></a><br><h2>  What's new? </h2><br>  Now, there is no need to do tricks like these: <a href="https://habrahabr.ru/post/313702/">Mikrotik: a little trick switch chip</a> . <br>  <b>ATTENTION!</b>  <b>Read the warning in the release notes !!!</b> <br><br>  Now you can configure VLAN directly in Bridge, while having hardware support, the switching chip will take over the work with VLAN and transfer traffic between ports (List of supported devices: <a href="https://wiki.mikrotik.com/wiki/Manual:Switch_Chip_Features">Bridge Hardware Offloading</a> ). <br><br><h3>  A bit of practice: </h3><br>  Referring to the <a href="https://wiki.mikrotik.com/wiki/Manual:Interface/Bridge">manual</a> and my previous article.  The task is to make a bridge for the Internet with a set-top box and the rest of the network. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Using tricks with VLANs on the switching chip made it possible to remove the load from the CPU router for sending packets within the same switching group (they emulated several groups using VLAN). <br>  But such a task is solved in principle now elementary, since the bridge supports hw-offload, and it all comes down to adding ports to the appropriate bridge, that's all! <br><br>  Therefore, we complicate the task.  In addition to RB951G, I use RBmAP2nD (both devices do not support hardware unloading), which in addition to the main WiFi also keeps a guest network.  Therefore, before him I will have the tagged traffic of the usual local and guest traffic. <br><br>  It all starts pretty obvious, we need three bridges: <br><br><pre><code class="bash hljs">/interface bridge add name=B-EXT pvid=2 vlan-filtering=no add comment=defconf name=B-LAN pvid=3 vlan-filtering=no add arp=reply-only name=B-WG</code> </pre> <br>  Pay attention to the vlan-filtering option, it should not be turned on until the rest of the settings are completed, otherwise the router will become unavailable.  The pvid option sets the default VLAN for the entire bridge. <br><br>  We set VLAN which will be serviced on bridges. <br><br><pre> <code class="bash hljs">/interface bridge vlan add bridge=B-EXT untagged=ether1,ether3 vlan-ids=2 add bridge=B-LAN tagged=ether2 untagged=ether4,ether5 vlan-ids=3 add bridge=B-LAN tagged=ether2 vlan-ids=4</code> </pre> <br>  Here you can see that we explicitly, directly in the bridge, indicate which ports to tag and which ones not to tag. <br><br>  And create a VLAN of the guest network: <br><br><pre> <code class="bash hljs">/interface vlan add interface=B-LAN name=V-GST vlan-id=4</code> </pre> <br>  Add the ports we need to the bridges: <br><br><pre> <code class="bash hljs">/interface bridge port add bridge=B-LAN comment=defconf interface=ether2 pvid=3 add bridge=B-EXT comment=defconf frame-types=admit-only-untagged-and-priority-tagged interface=ether3 pvid=2 add bridge=B-LAN comment=defconf frame-types=admit-only-untagged-and-priority-tagged interface=ether4 pvid=3 add bridge=B-LAN comment=defconf frame-types=admit-only-untagged-and-priority-tagged interface=ether5 pvid=3 add bridge=B-LAN comment=defconf frame-types=admit-only-untagged-and-priority-tagged interface=wl-2ghz pvid=3 add bridge=B-EXT frame-types=admit-only-untagged-and-priority-tagged interface=ether1 pvid=2 add bridge=B-WG interface=V-GST add bridge=B-WG interface=wlg-2ghz</code> </pre> <br>  Specifying the pvid option, we specify the default vlan for this port.  Also, using frame-types, we specify which packets we are going to receive on the port. <br><br>  Now turn on vlan-filtering = yes and everything works! <br><br>  For me, this configuration is clearer, since it does not require to go into the chip settings, and somehow ‚Äúcatch up‚Äù as they relate to the settings of interfaces and bridges, but is not supported in all home models. </div><p>Source: <a href="https://habr.com/ru/post/345374/">https://habr.com/ru/post/345374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345364/index.html">We include support for TLS v1.3 in Nginx using the example of Debian 9</a></li>
<li><a href="../345366/index.html">Richard Hamming: "There are thoughts you can't think about"</a></li>
<li><a href="../345368/index.html">A selection of tutorials on AR / VR</a></li>
<li><a href="../345370/index.html">POWA-like PostgreSQL Monitoring with Prometheus</a></li>
<li><a href="../345372/index.html">Dagger 2 for novice Android developers. Dagger 2. Advanced. Part 1</a></li>
<li><a href="../345376/index.html">Study Tuples in C # 7</a></li>
<li><a href="../345380/index.html">The complete guide to Splash Screen on Android</a></li>
<li><a href="../345382/index.html">Symfony Flex Private Recipes: Creating, Customizing, and Using</a></li>
<li><a href="../345384/index.html">The market for cryptocurrency caught up in terms of trading volume with the New York Stock Exchange</a></li>
<li><a href="../345386/index.html">How in TMemo to make vertical alignment, indents and TextHint</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>