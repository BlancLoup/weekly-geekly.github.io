<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Preparing to migrate vCenter Server to vSphere 6.0 Update 2m. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="VPS migration to the new version - often the ‚Äúheadache‚Äù of administrators, but the option ‚Äúnot to switch to the new version‚Äù can be fraught with probl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Preparing to migrate vCenter Server to vSphere 6.0 Update 2m. Part 2</h1><div class="post__text post__text-html js-mediator-article">  <i>VPS migration to the new version - often the ‚Äúheadache‚Äù of administrators, but the option ‚Äúnot to switch to the new version‚Äù can be fraught with problems in the future.</i>  <i>Therefore, we continue to publish useful reviews for everyone who wants to upgrade their virtual machines from 5.5 to 6 version of vSphere.</i> <br><br> <a href="https://habrahabr.ru/company/simnetworks/blog/313418/"><img src="https://habrastorage.org/files/773/593/2a0/7735932a074d4d67a29b8bac05bfbd1a.png"></a> <br><br>  In the <a href="https://habrahabr.ru/company/simnetworks/blog/312206/">first part,</a> we talked about preparing for migration for the vSphere Single Sign-On domain and for different vCenter deployment models.  Now let's pay attention to two more ‚Äústars of our show‚Äù - Windows vCenter Server and, of course, Windows vCenter Database. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When it comes to Windows vCenter Server, there are immediately a lot of things about the network, accounts, agents, different installed applications, and much more.  Like Windows vCenter Server, your data can be pre-evaluated (even before the migration process), how the migration process can take place, which depends on the deployment model (internal / external), and of course, the migration depends on the size of your data.  This post focuses on Windows vCenter Server, database and network. <br><br><a name="Network"></a><h1>  Network </h1><br>  The network is one of the most critical parts of the vCenter Server migration.  Before starting the migration, make sure that Windows vCenter Server has the correct DNS configuration and is in place of the forward and reverse lookup zones.  Ideally, the vCenter Server is configured as a static DNS, but if there is a need for DHCP support, vSphere 6.0 Update 2m supports this with a slight reservation. <br><br>  First, make sure your Windows vCenter Server does not use the same IP as your host.  In this case, you will not be able to migrate, because this configuration is not supported during the migration through the assistant, and will be blocked while preparing for the migration. <br><br>  Secondly, if your Windows vCenter Server uses a FQDN with a DHCP address, make sure that everything is reserved, otherwise the migration assistant also blocks this.  Also check that the Network Time Protocol (NTP) is enabled and correctly synchronized with the Windows vCenter Server. <br><br>  When we talk about network configuration when using the vCenter Server, we need to pay attention to user ports.  Whatever changes are made, by default, in the vCenter Server ports during the installation process, they will not be confirmed in the migration wizard. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/359/1ca/5dd/3591ca5dda81443da2a3a7c4867f2e14.png"></div><br>  Only configured ports that are supported in ESXi Dump Collector and Auto Deploy will be supported in vSphere web client.  Migration occurs through port 9123. If the port is already in use, the next free port will be used, or you can specify the port.  In the end, without the condition described below, the migration process will not be successful.  You must deploy a temporary IP address in the new vCenter Server Appliance 6.0 while Windows vCenter Server 5.5 is still available. <br><br>  When the Windows vCenter Server data is collected, the server will shut down and by virtue of the vCenter Server feature that includes the original IP Address - it also migrates.  The temporary IP address should be included in the routed network, which is available for our Windows vCenter Server <br><br><a name="Windows-Operating-System"></a><h1>  Windows settings </h1><br><img src="https://habrastorage.org/files/0b3/7fd/598/0b37fd59816f43bb968e5372844b3e32.png" align="left">  Windows vCenter Server is the main point during the migration process.  Now is the time to conduct a short review of what is already included in the Windows vCenter Server.  There may be other applications, parts of applications, agents, scripts, etc.  VMware or third-party vendors.  Look not only at what is installed on the vCenter Server, also pay attention to what your virtual server uses as the final application.  If we store our Windows vCenter Server and all related applications during the migration process, after the migration we will get the same virtual machine as before the migration.  There are some applications that may require updating the plug-in or in the case of backups may need some other changes (see below). <br><br>  In vCenter vSphere 6.0, only image-level backups are supported in both the Appliance Server and Windows.  Whether it will be able to migrate or not will depend on whether the vCenter Server is connected to the Active Directory domain, or whether the workgroup or not.  If the Windows vCenter Server is connected to an Active Directory domain, then users with credentials should update their accounts on the vCenter server.  This <a href="https://kb.vmware.com/selfservice/microsites/search.do%3Flanguage%3Den_US%26cmd%3DdisplayKC%26externalId%3D2146454">knowledge base</a> tells you what rights users must have in Active Directory in order to upgrade their vCenter Server.  Also, remember that since we switched from Windows to Linux, it means that local Windows users and groups do not migrate.  This is very important if you use accounts or groups for access rights in the vCenter Server. <br><br>  One thing needs to be noted: you need to have access to a local account in Windows vCenter Server so that, if necessary, it will be rolled back during the migration process (we will discuss the rollback aspect of migration in more detail in the next review). <br><br>  Summing up our story about what will NOT be transferred in the process of migration to the new version, I must say that it will NOT be transferred either: any installed agents, antiviruses, monitoring programs, backups, etc.  The vCenter Server Appliance doesn‚Äôt support anything either.  If the vCenter Server is running from under the service account and the account from which the migration is taking place (the migration assistant is running), then you need permission to use the ‚ÄúReplace a process level token‚Äù function from an account with Windows security rights.  These rights are required for the migration assistant to allow the imitating access token to pass. <br><br>  Let's look at the solutions that are already installed in the Windows vCenter Server.  These applications, authorship of VMware or third-party vendors, will not be available until Windows vCenter Server is turned off.  VMware Update Manager (VUM) already includes common applications for users who can install it in the vCenter Server.  The migration assistant will mark these installed applications and signal, but continue the migration process, if, of course, you want to continue it.  If you need these installed applications after the migration, we strongly recommend installing them on a separate server before the migration process begins. <br><br><img src="https://habrastorage.org/files/152/b98/85c/152b9885c9bf4ae185e1d0a7d7fab007.png"><br><br>  These migration <a href="http://pubs.vmware.com/vsphere-60/index.jsp%3Ftopic%3D%252Fcom.vmware.vsphere.migration.doc%252FGUID-B2642367-68BF-4EB8-81D4-F7791D501FD5.html">instructions</a> will tell you more about installing VUM on an external server. <br><br>  Another thing that needs to be said about, especially regarding VUM, these application plugins are needed for each individual installation for each user.  Make sure that the user who started the migration process has already installed all the plugins needed for the applications, otherwise the migration assistant will give an error.  For example, if you started the process of migrating them under a user account that does not have VUM plugins installed, you will get an error. <br><br>  As mentioned in the first part, we are not only migrating, but also updating.  Here are a few points to pay attention to. <br><br><ul><li>  If Linked Mode is configured, the configuration will be deleted even before the migration starts. </li><li>  During the migration process, the Windows vCenter Server and vCenter Server Appliance have equal parts at the migration endpoint. </li><li>  All vCenter Server certificates are also migrated. </li><li>  Any scripts that are stored in the Windows vCenter Server must be moved to another location before the migration begins. </li><li>  When the Windows vCenter Server migration is complete, we recommend disconnecting from the network adapter and making sure if the vCenter turns on for whatever reason so that there are no network conflicts. </li></ul><br><a name="vCenter-Server-Database"></a><h1>  vCenter Server Database </h1><br>  The vCenter Server database is the ‚Äúsecond wing‚Äù of Windows vCenter Server.  The migration tool supports all sorts of vSphere 5.5 data, from Microsoft SQL (local or remote) to Oracle.  The locally installed database will not be available and after migration, while Windows vCenter Server is turned off.  vCenter Server 6.0 Update 2m provides the ability to transfer event history and configuration.  Just keep in mind that this will increase the time of your migration.  To better assess how long a migration will take (with configurations, analytics, event history or, in the variant without them), use a <a href="https://kb.vmware.com/selfservice/microsites/search.do%3Flanguage%3Den_US%26cmd%3DdisplayKC%26externalId%3D2146420">special script</a> .  Depending on the size of the vCenter data, there are also options that help reduce the migration time, but we recommend running the migration assessment script first to see what can happen.  One thing will speed up your data in the vCenter Server - it's built-in statistics tools.  But they will not work after level 2 statistics, until the error is corrected.  <a href="https://kb.vmware.com/selfservice/microsites/search.do%3Flanguage%3Den_US%26cmd%3DdisplayKC%26externalId%3D2007388">It</a> explains how to use each level of statistics, and when and how they can be used. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/aec/f14/e98/aecf14e9843a40d8852bc93179f0ad17.png"></div><br>  If your data in the vCenter Server is a remote SQL or Oracle database, it would be nice to <a href="https://kb.vmware.com/selfservice/microsites/search.do%3Flanguage%3Den_US%26cmd%3DdisplayKC%26externalId%3D2012226">check if the rollback function works for you</a> and if it is running in the default settings.  We always talk about this to our customers who have large databases in the vCenter Server, and they don‚Äôt always know if this very necessary rollback function is working (started).  After this function is launched in the vCenter Server, their databases are significantly reduced.  The next option, which will also help you reduce and clean your database in the vCenter Server, but it is better to use it for very experienced administrators. <br><br>  If your vCenter Server has not been updated for a long time or has a large database, you may need to <a href="https://kb.vmware.com/selfservice/microsites/search.do%3Flanguage%3Den_US%26cmd%3DdisplayKC%26externalId%3D1025914">clean your old data</a> .  Before you do this, be sure to make sure that you have backed up all the data.  These tips may seem annoying, but I insist that all this is best done before the migration and upgrade begins. <br><br>  If you want to check whether your database is ready for migration, I recommend running the script that estimates the migration time of your data, in order to see not only the time, but also errors that may occur.  Also copy the folder with the migration assistant to the Windows vCenter Server and launch it.  The assistant can start the preliminary migration preparation and allow you to assess whether your Windows vCenter Server meets all the requirements for migration or whether you need to fix something else.  You also have a display of your potential changes - the migration process window. <br><br>  In the last post in this series, we will talk more about this rollback feature and tasks after the migration is complete. <br><br> <a href="https://www.sim-networks.com/protected-cloud%3Fpid%3D2449%26utm_source%3Dhabrahabr%26utm_campaign%3Dcontent%26utm_medium%3Dpostlink"><img src="https://habrastorage.org/files/c2e/22e/3bd/c2e22e3bd22c4a0985f83c601d0394f4.png"></a> <br><br><hr><br>  <a href="https://www.sim-networks.com/protected-cloud%3Fpid%3D2449%26utm_source%3Dhabrahabr%26utm_campaign%3Dcontent%26utm_medium%3Dpostlink">SIM-CLOUD - Fail-safe cloud in Germany</a> <br><br>  <a href="https://www.sim-networks.com/dedicated-custom%3Fpid%3D2449%26utm_source%3Dhabrahabr%26utm_campaign%3Dcontent%26utm_medium%3Dpostlink">Dedicated servers in reliable data centers in Germany!</a> <br>  Any configuration, quick build and free installation </div><p>Source: <a href="https://habr.com/ru/post/313418/">https://habr.com/ru/post/313418/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313402/index.html">The digest of fresh materials from the world of the frontend for the last week No. 233 (October 17‚Äì23, 2016)</a></li>
<li><a href="../313410/index.html">How to explain to granny what Agile is in 15 minutes with pictures</a></li>
<li><a href="../313412/index.html">Architecture and programming Philips Videopac (Magnavox Odyssey 2)</a></li>
<li><a href="../313414/index.html">Synergistic organizations. Part 0</a></li>
<li><a href="../313416/index.html">Android In-app Billing: from a mobile application to server validation and testing</a></li>
<li><a href="../313420/index.html">Procedural generation of planetary maps</a></li>
<li><a href="../313422/index.html">42 lines of code to exit the limb</a></li>
<li><a href="../313426/index.html">Home hosting sites with dynamic IP</a></li>
<li><a href="../313428/index.html">Donald Knut on the first steps in programming: How I spent the summer with a computer, not with girls (19,20,21,22 / 97)</a></li>
<li><a href="../313430/index.html">Gartner: VMware vs Citrix? Parse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>