<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sending statistics from a DataFrame to BigQuery using the example of Yandex Yandex Statistics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I‚Äôll talk about how I summarized statistics across the context in one place using BigQuery and Data Studio 

 I have a need to visuali...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sending statistics from a DataFrame to BigQuery using the example of Yandex Yandex Statistics</h1><div class="post__text post__text-html js-mediator-article">  In this article I‚Äôll talk about how I summarized statistics across the context in one place using BigQuery and Data Studio <br><br>  I have a need to visualize data on all traffic sources. <br><br>  For this task I use Data Studio.  Google Ads is pulled up there in the most beautiful way, but with Yandex Direct it is getting harder. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For myself, I chose a semi-manual method of aggregating statistics: receiving and sending statistics from my computer. <br><br>  Every day I get statics in various sections in the DataFrame. <br><br><img src="https://habrastorage.org/webt/tv/9y/ar/tv9yar4ruqupxyvj2nbqp6ylfr0.png"><br><br>  And that's great because pandas has a library called pandas_gbq, which can send a DataFrame to BigQuery. <br><a name="habracut"></a><br><h3>  What statistics to store in BigQuery </h3><br>  To begin with, let us define what sections of statistics we will send. <br>  Since we can store a lot of information in BigQuery, I have set aside statistics for myself in the context of days. <br><br>  You also need to take into account the fact that we need to receive statistics for at least a month to overwrite, as advertising systems update old statistics due to clicking. <br><br>  Therefore, for the time being I do not use statistics for myself in terms of keys, since it is often unnecessary. <br>  I will tell all on the example of daily statistics in the context of the Republic of Kazakhstan.  (columns: date and RC) <br><br>  Next, we will discuss how to modify the DataFrame so that it goes. <br><br><h3>  Modifying DataFrame </h3><br><br><h4>  Problem 1 </h4><br>  For some RCs we will get empty fields in behavioral factors and conversions. <br><br><img src="https://habrastorage.org/webt/lk/ec/wq/lkecwqgw_xt4yy9aarchkaipugu.png"><br><br>  To get around this problem, you need to replace the minuses with "0". <br><br><pre><code class="python hljs">f[<span class="hljs-string"><span class="hljs-string">'Conversions'</span></span>].replace([<span class="hljs-string"><span class="hljs-string">'--'</span></span>],[<span class="hljs-number"><span class="hljs-number">0</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) f[<span class="hljs-string"><span class="hljs-string">'CostPerConversion'</span></span>].replace([<span class="hljs-string"><span class="hljs-string">'--'</span></span>],[<span class="hljs-number"><span class="hljs-number">0</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) f[<span class="hljs-string"><span class="hljs-string">'ConversionRate'</span></span>].replace([<span class="hljs-string"><span class="hljs-string">'--'</span></span>],[<span class="hljs-number"><span class="hljs-number">0</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) f[<span class="hljs-string"><span class="hljs-string">'AvgPageviews'</span></span>].replace([<span class="hljs-string"><span class="hljs-string">'--'</span></span>],[<span class="hljs-number"><span class="hljs-number">0</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) f[<span class="hljs-string"><span class="hljs-string">'BounceRate'</span></span>].replace([<span class="hljs-string"><span class="hljs-string">'--'</span></span>],[<span class="hljs-number"><span class="hljs-number">0</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br>  And assign a numeric data type. <br><br><pre> <code class="python hljs">f[[<span class="hljs-string"><span class="hljs-string">"Conversions"</span></span>,<span class="hljs-string"><span class="hljs-string">"CostPerConversion"</span></span>,<span class="hljs-string"><span class="hljs-string">"ConversionRate"</span></span>,<span class="hljs-string"><span class="hljs-string">"AvgPageviews"</span></span>,<span class="hljs-string"><span class="hljs-string">"BounceRate"</span></span>]]=f[[<span class="hljs-string"><span class="hljs-string">"Conversions"</span></span>,<span class="hljs-string"><span class="hljs-string">"CostPerConversion"</span></span>,<span class="hljs-string"><span class="hljs-string">"ConversionRate"</span></span>,<span class="hljs-string"><span class="hljs-string">"AvgPageviews"</span></span>,<span class="hljs-string"><span class="hljs-string">"BounceRate"</span></span>]].apply(pd.to_numeric)</code> </pre><br><h4>  Problem 2 </h4><br>  Add a separate indexable column.  If we send such a DataFrame or look at the data type using dtipe, we see that there is no column with dates. <br><br>  To remedy the situation, create a column that will be equal to the indexed column. <br><br><pre> <code class="python hljs">f[<span class="hljs-string"><span class="hljs-string">'Date'</span></span>]=f.index</code> </pre><br><br>  <b>We receive the following DataFrame</b> <br><br><img src="https://habrastorage.org/webt/jk/f1/ng/jkf1ngd6yvonq4_l-niskqf8lpa.png"><br><br><h3>  We send DataFrame to BigQuery </h3><br><pre> <code class="python hljs">pandas_gbq.to_gbq(f,<span class="hljs-string"><span class="hljs-string">' .'</span></span>,project_id=<span class="hljs-string"><span class="hljs-string">' '</span></span>,if_exists=<span class="hljs-string"><span class="hljs-string">'replace'</span></span>)</code> </pre><br>  Specify the name of the DataFrame, the name of the dataset, the name of the file (it may not yet exist), the name of the project and how the file will be recorded (in our case there will be a complete overwriting of the file). <br><br>  We get the following in BigQuery: <br><br><img src="https://habrastorage.org/webt/ez/ge/cw/ezgecw6ua4pdpbejc000pdsfpne.png"><br><br>  It remains only to visualize the data in DataStudio.  End Code: <br><br><pre> <code class="python hljs">f[<span class="hljs-string"><span class="hljs-string">'Date'</span></span>]=f.index f[<span class="hljs-string"><span class="hljs-string">'Conversions'</span></span>].replace([<span class="hljs-string"><span class="hljs-string">'--'</span></span>],[<span class="hljs-number"><span class="hljs-number">0</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) f[<span class="hljs-string"><span class="hljs-string">'CostPerConversion'</span></span>].replace([<span class="hljs-string"><span class="hljs-string">'--'</span></span>],[<span class="hljs-number"><span class="hljs-number">0</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) f[<span class="hljs-string"><span class="hljs-string">'ConversionRate'</span></span>].replace([<span class="hljs-string"><span class="hljs-string">'--'</span></span>],[<span class="hljs-number"><span class="hljs-number">0</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) f[<span class="hljs-string"><span class="hljs-string">'AvgPageviews'</span></span>].replace([<span class="hljs-string"><span class="hljs-string">'--'</span></span>],[<span class="hljs-number"><span class="hljs-number">0</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) f[<span class="hljs-string"><span class="hljs-string">'BounceRate'</span></span>].replace([<span class="hljs-string"><span class="hljs-string">'--'</span></span>],[<span class="hljs-number"><span class="hljs-number">0</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) f[[<span class="hljs-string"><span class="hljs-string">"Conversions"</span></span>, <span class="hljs-string"><span class="hljs-string">"CostPerConversion"</span></span>,<span class="hljs-string"><span class="hljs-string">"ConversionRate"</span></span>,<span class="hljs-string"><span class="hljs-string">"AvgPageviews"</span></span>,<span class="hljs-string"><span class="hljs-string">"BounceRate"</span></span>]] = f[[<span class="hljs-string"><span class="hljs-string">"Conversions"</span></span>, <span class="hljs-string"><span class="hljs-string">"CostPerConversion"</span></span>,<span class="hljs-string"><span class="hljs-string">"ConversionRate"</span></span>,<span class="hljs-string"><span class="hljs-string">"AvgPageviews"</span></span>,<span class="hljs-string"><span class="hljs-string">"BounceRate"</span></span>]].apply(pd.to_numeric) pandas_gbq.to_gbq(f, <span class="hljs-string"><span class="hljs-string">'YD_Days.my_client_rk'</span></span>, project_id=<span class="hljs-string"><span class="hljs-string">'my_project'</span></span>,if_exists=<span class="hljs-string"><span class="hljs-string">'replace'</span></span>)</code> </pre><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/454172/">https://habr.com/ru/post/454172/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454164/index.html">How does A / B testing in Avito</a></li>
<li><a href="../454166/index.html">June 6 - VeeamON Forum in Moscow</a></li>
<li><a href="../454168/index.html">The main arena of the country. How were updated "Luzhniki" before the World Cup</a></li>
<li><a href="../45417/index.html">Project documentation or Mom told me ...</a></li>
<li><a href="../454170/index.html">Welcome to DroidHeads Meetup June 8</a></li>
<li><a href="../454176/index.html">Uibook - a tool for visual testing of React-components with media queries</a></li>
<li><a href="../454178/index.html">An example of calculating the pension IT-person from Moscow</a></li>
<li><a href="../45418/index.html">Do you use code autogeneration based on UML diagrams?</a></li>
<li><a href="../454180/index.html">Schr√∂dinger Cloud Backup</a></li>
<li><a href="../454182/index.html">Full interview with the dean of the Python faculty at GeekBrains - how and why to learn the language to beginners</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>