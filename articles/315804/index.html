<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Jenkins for Android on a clean system and without UI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√© already have similar articles on the theme of assembling an Android application using Jenkins. The key features / additions of the current wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Jenkins for Android on a clean system and without UI</h1><div class="post__text post__text-html js-mediator-article">  On Habr√© already have similar articles on the theme of assembling an Android application using Jenkins.  The key features / additions of the current will be the following: <br><br><ol><li>  We will install Jenkins on a remote Linux machine where there is no UI. </li><li>  We will build the application from the private repository. </li><li>  We will solve the problem of building an application from a branch whose name we do not know. </li><li>  After assembling the .apk files, we will send them to the Fabric and notify the testers. </li><li>  After sending to Fabric, we will publish the application on Google Play. </li><li>  Protect application publishing tasks from running by testers. </li></ol><a name="habracut"></a><br><h3>  Install jenkins </h3><br>  So, you got access to the server.  The UI is missing there, but this is not a problem at all. <br>  First, let's install the jenkins server itself. <br><br><pre><code class="bash hljs">$ wget -q -O - https://pkg.jenkins.io/debian/jenkins-ci.org.key | sudo apt-key add - $ sudo sh -c <span class="hljs-string"><span class="hljs-string">'echo deb http://pkg.jenkins.io/debian-stable binary/ &gt; /etc/apt/sources.list.d/jenkins.list'</span></span> $ sudo apt-get update $ sudo apt-get install jenkins</code> </pre> <br>  More details about what makes the installation of this package can be found in the <a href="https://wiki.jenkins-ci.org/display/JENKINS/Installing%2BJenkins%2Bon%2BUbuntu">official documentation</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After installation, Jenkins itself will be in the <code>/var/lib/jenkins</code> directory, project repositories and other files necessary for Jenkins to work.  Now you can log in to Jenkins via a browser and start configuring your CI server. <br><br>  However, before this you need to install everything you need to build an Android application. <br><br><h3>  Install Android SDK + JAVA </h3><br>  On the <a href="https://developer.android.com/studio/index.html">official website</a> below you can find links to the distribution kit that we need.  Usually it is installed together with Android Studio, but in our case, we do not need it, so we select the desired link and load the command line tools (Command Line Tools). <br><br>  At the time of this writing, the current version for Linux was: android-sdk_r24.4.1.  To install, execute the following commands: <br><br><pre> <code class="bash hljs">$ wget http://dl.google.com/android/android-sdk_r24.4.1-linux.tgz $ tar -xvf android-sdk_r24.4.1-linux.tgz</code> </pre><br>  Next, you need to download the Platform Tools, Build tools used in your project and the current API for which you are building the application.  To do this, look into the build.gradle file of your project (at the level of the application module).  For example, in my project, the part of interest to us is as follows: <br><br><pre> <code class="hljs cs">android { .... compileSdkVersion <span class="hljs-number"><span class="hljs-number">25</span></span> buildToolsVersion <span class="hljs-string"><span class="hljs-string">'25.0.0'</span></span> .... }</code> </pre><br>  This clearly shows which versions we need to download.  In order for us to download the components we need, we add the following parameters to the system variables: <br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ANDROID_HOME=~/android-sdk-linux <span class="hljs-comment"><span class="hljs-comment">#     SDK-Tools $ export PATH=$ANDROID_HOME/tools:$PATH $ export PATH=$ANDROID_HOME/platform-tools:$PATH</span></span></code> </pre><br>  Further, most guides suggest simply downloading all components using the command: <br><br><pre> <code class="bash hljs">$ android update sdk --no-ui --all</code> </pre><br>  But since we feel sorry for wasting space on the hard drive, we will download only what we need.  Run the command to find out exactly what we need to download: <br><br><pre> <code class="bash hljs">$ android list sdk --all</code> </pre><br>  The results are as follows: <br><br><img src="https://habrastorage.org/files/2ac/6e7/4b7/2ac6e74b724c4be58bfce4269fd83f63.png"><br><br>  Now we can install only what we need with the help of the command: <br><br><pre> <code class="bash hljs">$ android update sdk --no-ui --all --filter 1,2,163,164,168,169,170,171</code> </pre><br>  Now put JAVA with the command: <br><br><pre> <code class="bash hljs">$ sudo apt-get install openjdk-8-jdk</code> </pre><br>  Fine!  We put everything you need to build Jenkins and build the application.  Now go to setting up Jenkins. <br><br><h3>  Setting up access to a private repository </h3><br>  If your git repository is public or you decide to access it using your login and password, you can skip this block and go directly to the next one. <br><br>  So, we decided that we will do everything correctly and get access to the repository via SSH.  To do this, we need to generate an ssh key and put it in the /var/lib/jenkins/.ssh directory. <br><br>  When you installed jenkins, a user was automatically generated with the name jenkins on a unix machine.  In order for jenkins to use the key, the easiest way is to generate it from under the user's jenkins. <br><br><pre> <code class="bash hljs">$ sudo su jenkins -s /bin/bash $ ssh-keygen -t rsa -b 4096 -C <span class="hljs-string"><span class="hljs-string">"your_email@example.com"</span></span></code> </pre><br>  After that 2 files will be generated (with standard names id_rsa, id_rsa.pub).  The id_rsa file must be put in the /var/lib/jenkins/.ssh directory, then the Deploy Key must be added in the github settings of the repository (the contents of the id_rsa.pub file). <br><br>  It looks like this: <br><br><img src="https://habrastorage.org/files/80d/131/ce3/80d131ce37954b41a3d536f487d19b3e.png"><br><br>  Next, add the repository URL to the list of known ones.  To do this, try to access the repository and get a list of repository branches. <br><br><pre> <code class="bash hljs">$ sudo apt-get install git <span class="hljs-comment"><span class="hljs-comment">#  git $ sudo su jenkins -s /bin/bash $ git ls-remote -h git@github.com:[your_repo_url]</span></span></code> </pre><br>  And we agree to add github to the list of known hosts.  If you do not have access to the id_rsa file, it means that you created it not from under the user's jenkins, in which case you should give jenkins access to the user to work with this file: <br><br><pre> <code class="bash hljs">$ sudo chmod 700 /var/lib/jenkins/.ssh/id_rsa</code> </pre><br>  After completing these steps, we will be able to access our private repository for building an Android application. <br><br><h3>  Creating a task for building an application </h3><br>  Now let's go to jenkins.  By default, it will be available on port 8080. We will switch to this port in any browser.  After the first start, you will be able to log in using a password that is located in the / var / lib / jenkins / secrets / initialAdminPassword file.  After that you get to Jenkins panel.  First we need to configure the path to the ANDROID_HOME directory. <br><br>  Manage Jenkins (System Jenkins) ‚Üí System Configuration (System Configuration): <br><br><img src="https://habrastorage.org/files/338/21e/99f/33821e99f27343058db9905078e6b9a4.png"><br><br>  Also configure the paths to the JDK, the Gradle version and Git.  To do this, specify the directory where JAVA is stored, and add the gradle version required for the build. <br><br>  Manage Jenkins (Configure Jenkins) ‚Üí Global Tool Configuration: <br><br><img src="https://habrastorage.org/files/7f4/24a/125/7f424a125d4a49d79ba8fe428f465ade.png"><br><br><img src="https://habrastorage.org/files/629/ffd/410/629ffd41017d45409f2d113b95a9ccbb.png"><br><br>  Now we can create the first task to build the application.  Let's choose to create a task with a free configuration.  On the tab with the "Source Code Management" choose git.  Next, specify the url of the git repository for ssh access.  For the first task we will collect from the wizard branch.  That is the default and specified. <br><br>  Next, add the build step by running the gradle script.  Select the gradle version added earlier.  On all important fields are hints, why they are needed.  For example, if you have a non-standard project structure, then you need to specify the place where the root build.gradle project file and the file name are found, if it is different from build.gradle. <br><br><img src="https://habrastorage.org/files/ea0/dde/8b4/ea0dde8b460f49649dd8bf43feaa0e61.png"><br><br>  Next, archive the .apk files so that testers or someone else can download them later.  To do this, add a post-assembly task and specify the format, which files we want to save.  The first time I created a task, I assumed that the search for the desired file was performed using a regular expression format, but it turned out that Jenkins uses the <a href="http://stackoverflow.com/questions/2952196/learning-ant-path-style">Ant path style</a> to find files.  As a standard, it is proposed to save all files with the .apk extension, but most of them are not needed, so we will save only those that end in debug.apk and release.apk. <br><br><img src="https://habrastorage.org/files/cab/d6d/053/cabd6d053b4e4166b53d941dc965614e.png"><br><br><h3>  Build signed apk using build.gradle script </h3><br>  To publish an application on Google Play, the .apk file must be <a href="https://developer.android.com/studio/publish/app-signing.html">signed with a special key</a> .  If you signed using Android Studio, indicating the path to the file, then you need to learn how to do it from the build.gradle script.  Next, we look at the simplest example and ways to improve it.  It is enough to put the key under version control, and then refer to it from the build script.  Here is an example of how this can be implemented. <br><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">android</span></span> { <span class="hljs-section"><span class="hljs-section">signingConfigs</span></span> { <span class="hljs-section"><span class="hljs-section">release</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">keyAlias</span></span> <span class="hljs-string"><span class="hljs-string">'KEY_ALIAS'</span></span> keyPassword <span class="hljs-string"><span class="hljs-string">'KEY_PASSWORD'</span></span> storeFile file(<span class="hljs-string"><span class="hljs-string">'RELATIVE_PATH_TO_KEYSTORE'</span></span>) storePassword <span class="hljs-string"><span class="hljs-string">'STORE_PASSWORD'</span></span> } } ... buildTypes { <span class="hljs-section"><span class="hljs-section">release</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">signingConfig</span></span> signingConfigs.release } } }</code> </pre><br>  The disadvantage of the solution is that your private key is stored under version control, as is the password for building the release version of the application.  Pay attention to the fact that even if you remove the key in the future and correct the build.gradle script, then there is a possibility that someone, after digging into the commit history, will restore this information, so be careful.  A better solution would be to keep the property file, which is not under version control and lies, for example, in the ~ / home directory in which all the necessary parameters are written. <br><br>  For example, our project uses the following approach.  The file with the settings and the file for the signature are missing in the version control.  For developers, they are covered with hands.  Thus, we solve the problem that someone who does not follow this may sign your application.  Now you need to solve the problem so that Jenkins himself could sign the application.  To do this, we will check the presence of the file in two places when signing the application.  The first is the root directory of the project.  The second is a specific place on the server where it is expected that this file should be stored.  Then you enclose this file on the jenkins server and get the opportunity to collect signed versions of the application.  Here is an example gradle script, as it is implemented: <br><br><pre> <code class="hljs scala">android { ... signingConfigs { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rootProject.file(<span class="hljs-string"><span class="hljs-string">"release.properties"</span></span>).exists() || <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">File</span></span>(<span class="hljs-string"><span class="hljs-string">"/home/ubuntu/release.properties"</span></span>).exists()) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">properties</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Properties</span></span>() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileToLoad</span></span></span><span class="hljs-function"> </span></span>= rootProject.file(<span class="hljs-string"><span class="hljs-string">"release.properties"</span></span>).exists() ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">FileInputStream</span></span>(rootProject.file(<span class="hljs-string"><span class="hljs-string">"release.properties"</span></span>)) : <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">FileInputStream</span></span>(<span class="hljs-string"><span class="hljs-string">"/home/username/release.properties"</span></span>) properties.load(fileToLoad) release { keyAlias properties.keyAlias keyPassword properties.keyAliasPassword storePassword properties.keyStorePassword storeFile rootProject.file(<span class="hljs-symbol"><span class="hljs-symbol">'keystore</span></span>.jks') } } } ... buildTypes { release { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (signingConfigs.hasProperty(<span class="hljs-string"><span class="hljs-string">"release"</span></span>)) signingConfig signingConfigs.release } } }</code> </pre><br><h3>  Publishing test builds in Fabric and alerting testers </h3><br>  <a href="https://get.fabric.io/">Fabric</a> is a great system for building crash reports for your application.  If you are using standard Google analytics to build kreshy, then I highly recommend to look at the fabric or firebase.  To use Fabric, we need to install the jenkins plugin. <br><br>  Customize jenkins (Manage Jenkins) ‚Üí Manage Plugins (Manage Plugins) tab Available, enter the Fabric.  We are interested in <a href="https://wiki.jenkins-ci.org/display/JENKINS/Fabric%2BBeta%2BPublisher%2BPlugin">Fabric Beta Publisher</a> .  After installing it, let's return to the task description and add another one. <br><br><img src="https://habrastorage.org/files/a5c/d9f/735/a5cd9f735de6489992430ceb3894dfd0.png"><br><br><img src="https://habrastorage.org/files/bea/111/88c/bea11188caa74a00b75d9600297bf693.png"><br><br>  You need to specify Fabric_api_key, as well as secret_key, and specify the relative path to the .apk file of the application, which we will upload to testers.  You can view these values ‚Äã‚Äãin the personal account of the fabric.  Settings ‚Üí Organizations ‚Üí {Your_app_name} ‚Üí API_KEY, Build Secret. <br><br>  Further you can send notifications for your testers.  You can specify both email and testers group.  How to manage groups, you will know best yourself.  For example, we prefer to use 2 groups: dev, production.  All test application builds will notify the dev group of testers, and the assemblies that will be uploaded to Google Play will notify production of the testers group. <br><br>  Further, if our assemblies are somehow different from each other, then we need to specify this information in Build Notes for testers.  We do this through the Environment Variable and the script that will fill in this information. <br><br>  Our project adheres to the following approach.  When the time comes for release, a delivery_xx branch is created from the master branch, where xx is the sprint number.  Unfortunately, Jenkins by default does not know how to build assemblies from branches, where the name of the branch may change.  We have to teach him that ourselves. <br>  To do this we need to install another plugin - <a href="https://wiki.jenkins-ci.org/display/JENKINS/EnvInject%2BPlugin">EnvInject</a> .  After this, we return to the task view and set a new option - Prepare an environment for the run.  Thanks to this plugin, we can execute any groovy script, and then save all the necessary results in the environment variables. <br><br>  In our case, we need to get a list of branches from the repository and find a branch whose name begins with delivery.  Also, we need to set up build notes for testers, so that they know from which branch the application was built.  The script for this will look like this: <br><br><pre> <code class="hljs ruby"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gitURL</span></span></span><span class="hljs-function"> = "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">git</span></span></span><span class="hljs-function">@</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">github</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">com</span></span></span><span class="hljs-function">:[</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">your_repo_url</span></span></span><span class="hljs-function">]" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">command</span></span></span><span class="hljs-function"> = "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">git</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ls</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">-</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remote</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">-</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gitURL</span></span></span><span class="hljs-function">" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proc</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">command</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> proc.waitFor() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (proc.exitValue() != <span class="hljs-number"><span class="hljs-number">0</span></span>) { println <span class="hljs-string"><span class="hljs-string">"Error ${proc.err.text}"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">branch</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proc</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">text</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> .collect { it.replaceAll(<span class="hljs-regexp"><span class="hljs-regexp">/[a-z0-9]*\trefs\/heads\//</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>)} .find { it.startsWith(<span class="hljs-string"><span class="hljs-string">"delivery"</span></span>)} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (branch == null) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Thread</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>.executable build.doStop() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">map</span></span></span><span class="hljs-function"> = [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BRANCH</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">branch</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FABRIC_RELEASE_NOTES</span></span></span><span class="hljs-function">: "$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">branch</span></span></span><span class="hljs-function">"]</span></span></code> </pre><br>  Sure, here you can add any logic you need in your particular case. <br>  Next, correct the name of the branch from which to build. <br><br><img src="https://habrastorage.org/files/df0/90e/3e8/df090e3e897c4ac89e68351e9a56f0aa.png"><br><br>  And we will update the application publishing block in the fabric, as shown in the screenshot above. <br>  Now we can do almost all the points described at the beginning of the article, and all we have to do is learn how to publish the final build of the application in google play. <br><br><h3>  Publish to Google Play </h3><br>  For us, we have already prepared a plugin for publishing applications on Google Play using Jenkins.  Put it: <a href="https://wiki.jenkins-ci.org/display/JENKINS/Google%2BPlay%2BAndroid%2BPublisher%2BPlugin">Google Play Android Publisher Plugin</a> .  Next, we need to create a special service account that will be engaged in the publication of applications on Google Play.  To do this, follow these steps: <br><br><ol><li>  Go to the developer console under the account owner. </li><li>  Settings ‚Üí API access. </li><li>  Click "Create a project." </li><li>  Click "Create an application account." </li><li>  Follow the link. </li><li>  In the drop-down list, click "Edit" and change the name of the account to the required, for example "Jenkins". </li><li>  In the drop-down list, select ‚ÄúCreate key‚Äù and select the key type ‚ÄúJSON‚Äù. </li><li>  Click to create a key. </li><li>  A file will be automatically downloaded, which will later be used for authentication in the plugin developer console to publish the application. </li></ol><br>  The same in pictures: <br><br><img src="https://habrastorage.org/files/146/bb2/ce4/146bb2ce4eb4455b8e937b132849c6b1.png"><br><br><img src="https://habrastorage.org/files/56e/639/964/56e6399641554104afe5a3913901c9d2.png"><br><br><img src="https://habrastorage.org/files/d1d/917/050/d1d917050165409994920d4f414649f0.png"><br><br><img src="https://habrastorage.org/files/e82/1b4/7de/e821b47de0714166aa13521e3f5987ad.png"><br><br>  Next, you must issue the appropriate access in the developer console for the created service account and publish applications.  To do this, perform the following steps: <br><br><ol><li>  Return to the developer console </li><li>  For the created application account, click "Open Access" </li><li>  For the created application account, click "Open Access" </li><li>  You need to make sure that you have permissions to change the application and control information for the Production, Alpha and Beta versions of the application </li><li>  Click add </li></ol><br>  The same in pictures: <br><br><img src="https://habrastorage.org/files/307/c51/163/307c51163ec2410c8d3e95f9c415a941.png"><br><br><img src="https://habrastorage.org/files/dd8/f5a/dca/dd8f5adca5074a9b8fcc68121cd1051a.png"><br><br>  Now we can exit the developer console and proceed to setting up Jenkins to publish the application. <br><br><ol><li>  Go to Jenkins </li><li>  Select the menu item "Credentials" </li><li>  Select public access and click "Add Credentials" </li><li>  Select the type of access: "Google Service Account from private key" </li><li>  Enter the access name (it will be used later in the task setup), for example android-publish </li><li>  Choose the type "JSON key" </li><li>  Download the file that we previously downloaded the ‚ÄúJSON key‚Äù </li><li>  Click OK to create access. </li></ol><br>  The same in pictures: <br><br><img src="https://habrastorage.org/files/1b7/95f/8f7/1b795f8f71ec493f8826a0cf544da522.png"><br><br><img src="https://habrastorage.org/files/9ad/4bc/cd4/9ad4bccd434740eeb317ee5baee6d698.png"><br><br>  Next, go to the task view and add the Step after assembly - Upload Android APK to Google Play. <br>  You must specify the credentials for this step that we added earlier.  As well as the path to the apk file and information, what percentage of users need to be transferred to this version.  Probably initially it will be 100%.  You also need to specify which version of the .apk file you are uploading.  You can publish alpha, beta, production versions via jenkins.  After that, you can safely run the task, and go for tea yourself, while jenkins does all the routine work of assembling, signing the application and publishing for you. <br><br><img src="https://habrastorage.org/files/583/d6a/e08/583d6ae0843d476590a0bd8aafe9c510.png"><br><br><h3>  Protection of critical tasks </h3><br>  Now we are able to create tasks, we can give testers access, and they themselves will build application assemblies for themselves when they need it.  Naturally, we do not want our QA to randomly publish an application.  I propose to do the following. <br>  We will need to take out the publication of the application in a separate task and take access from QA to start this task. <br><br><ol><li>  Go to Settings Jenkins ‚Üí Configure Global Security </li><li>  ‚ÄúAuthorization‚Äù block ‚Üí choose the item ‚ÄúProject-based Matrix Authorization Strategy‚Äù </li><li>  <b>Immediately</b> add your username and set all items for yourself as available.  If you do not make this item, you will deny access to yourself from jenkins (if it still happened, see the solution <a href="http://stackoverflow.com/questions/22717773/jenkins-github-authentication-error-user-is-missing-the-overall-read-permission">here</a> ). </li><li>  Next, add the username QA, and set it permissions that you consider necessary.  For us it is important not to let him run tasks.  ‚ÄúTask‚Äù block, ‚ÄúBuild‚Äù item </li><li>  After that, go to the task, access for which we want to give QA, and give him the appropriate access. </li></ol><br><img src="https://habrastorage.org/files/342/6ac/fcc/3426acfccfa546378e01f8a93539da4f.png"><br><br>  Now our QA will not be able to accidentally publish the application on Google Play. <br><br>  Perhaps that's all.  We could continue to improve the automatic assembly and publication of applications, but this is beyond the scope of this tutorial. <br><br>  <b>PS</b> It would also be interesting to compare Jenkins with other CI servers and see how to implement similar items for building applications.  It is also interesting to try to arrange the task not in the form of a free configuration, but with the help of PipeLine, so that we can describe the entire configuration in a document that we put under version control and will be dynamically changed in the project. </div><p>Source: <a href="https://habr.com/ru/post/315804/">https://habr.com/ru/post/315804/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../315790/index.html">How are you zadolbali with their alerts</a></li>
<li><a href="../315792/index.html">Open Source Legislation</a></li>
<li><a href="../315798/index.html">The final version of Vivaldi 1.5</a></li>
<li><a href="../315800/index.html">Search for sound anomalies</a></li>
<li><a href="../315802/index.html">How to use HTTP headers to prevent vulnerabilities</a></li>
<li><a href="../315806/index.html">True lies optimistic interfaces</a></li>
<li><a href="../315808/index.html">The book "Design. Modern Creatif</a></li>
<li><a href="../315810/index.html">The best IT vacancies on My Circle in a week, October 31 - November 6</a></li>
<li><a href="../315812/index.html">WebRTC: Making a peer to peer javascript game</a></li>
<li><a href="../315816/index.html">Why ready-made methods do not work and what is needed instead</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>