<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>History of the study of one jar trojan</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An article about how to explore unfamiliar * .jar files. 
 I very often come to ICQ spam. As a rule, they offer to go to one of the fake "VKontakte" w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>History of the study of one jar trojan</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/2bc7d4c7/d3693cbf/26f0dd74/bf0a7c4a.jpg"><br><br>  An article about how to explore unfamiliar * .jar files. <br>  I very often come to ICQ spam.  As a rule, they offer to go to one of the fake "VKontakte" with a typo in the name.  But then they sent a request to authorize with a link to the photo.  The message is trite, nothing new, something like: ‚ÄúI want to meet you, look at the picture on the link ... .., it will be interesting for you to take a picture with me.‚Äù  The link did not lead to fake VK, but offered to download the foto.jar file. <br>  We check the antivirus - everything is OK. <br><a name="habracut"></a><br><h5>  Quick review </h5><br>  It becomes interesting.  We open the archive and begin to explore. <br>  The jar file contained the following files: <br><br><img src="https://habrastorage.org/storage/0950faf4/a23ac29d/1bdfd88f/d90c6dc5.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We are dealing with a Java application.  Most likely for mobile devices.  We look at the <b>main.class</b> file with any text file <b>editor</b> and see the confirmation - there are <b>MIDlet</b> calls in the program text. <br><br><img src="https://habrastorage.org/storage/3dc54999/e54a54e9/7872e496/8a6b2c5e.jpg"><br><br>  It remains to figure out what this program does.  Again, use a text editor.  View class files.  In the <b>a.class</b> file, <b>we</b> are looking for a hint for what this application does: <br><br><img src="https://habrastorage.org/storage/f1d5bd38/cbc2f38f/52a361ab/e1515378.jpg"><br><br>  ‚ÄúMessageConnection, javax.wireless.messaging.TextMessage, sms: //‚Äù - hints to us that the application sends an SMS. <br>  Usually you can stop at this.  The file that came with ICQ spam, which is called a photograph, actually turns out to be a program for mobile devices that sends SMS. <br>  In parallel, it was decided to see what this application does.  I load the emulator runtime.  The result is: <br><br><img src="https://habrastorage.org/storage/2bc7d4c7/d3693cbf/26f0dd74/bf0a7c4a.jpg"><br><br>  The form is loaded with a progress bar, click OK, the bar grows, at a certain moment, when it reaches a certain percentage - an SMS is sent. <br>  When we reach 100% - the application ‚Äúspoils‚Äù <br><br><h5>  Dive into code </h5><br><br>  Attempts to find the number to which the message is sent directly in the code of the classes were unsuccessful.  Became interesting. <br>  For more in-depth research, we decompile the sources.  Decompilation gave partial results.  One decompiler could not open the startApp () method, producing an error.  Therefore, after a brief search, an online decompiler was found that could open all the files, but only ‚Äúa‚Äù was substituted for the variable name.  But this was enough to understand the logic of the application. <br>  I will not give the whole result of decompilation, only the most significant fragments: <br>  Fragment of the <b>startApp ()</b> function of the <b>main.class</b> class: <br><br><pre><code class="java hljs">‚Ä¶‚Ä¶. <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.b = <span class="hljs-string"><span class="hljs-string">"http://ero.******.ws"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a = <span class="hljs-string"><span class="hljs-string">""</span></span>; ‚Ä¶‚Ä¶.. <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { b var1; (var1 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a).a = var1.getClass().getResourceAsStream(<span class="hljs-string"><span class="hljs-string">"/settings.xml"</span></span>); var1.a = var1.a.available(); var1.a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[var1.a]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> var2; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(var2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; var2 &lt; var1.a; ++var2) { var1.a[var2] = var1.a.read(); } ‚Ä¶‚Ä¶‚Ä¶</code> </pre> <br><br>  From this fragment you can see that the information is loaded from the <b>settings.xml</b> file.  And formed a string with the name of the site. <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">commandAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Command var1, Displayable var2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(var1 == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.d) { ++<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ab; ++<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ad; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.aa += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ac; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ad == <span class="hljs-number"><span class="hljs-number">17</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ad = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Sender(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ab == <span class="hljs-number"><span class="hljs-number">100</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.destroyApp(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a.repaint(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(var1 == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a.setCurrent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(var1 == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.c) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.notifyDestroyed(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(var1 == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.b) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.platformRequest(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.b); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ConnectionNotFoundException var3) { var3.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.notifyDestroyed(); } }</code> </pre><br>  When we reach 17%, we call <b>Sender ()</b> .  When we reach 100%, we call <b>destroyApp ()</b> to prevent the user from starting the application again.  We proceed to the procedure <b>Sender ()</b> . <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sender</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a.length) { a var1 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a; (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(var1)).start(); } }</code> </pre><br>  An instance of the class variable <b>a</b> is started in the new thread. <br>  Code snippet a. <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ‚Ä¶‚Ä¶.. <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a = <span class="hljs-string"><span class="hljs-string">"sms://"</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.aa[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.aa]; ‚Ä¶‚Ä¶.. <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a.send(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (SecurityException var1) { System.out.println(<span class="hljs-string"><span class="hljs-string">"!!!!!!!!!!!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception var2) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } ‚Ä¶‚Ä¶.. }</code> </pre><br>  So, let's summarize. <br><br>  This application is distributed via ICQ, hits mobile phones, tries to send an SMS to a number that is stored in the settings.xml file, the number by the way: <b>7781</b> . <br><br>  Check online antivirus again. <br><br><img src="http://habrastorage.org/storage/d9c57a49/97810a2e/8445c0c1/03c3545b.jpg"><br><br>  <b>UPD.</b>  <b>Thanks for the suggested links. MainNika</b> <br><br>  Undivided Trojans with a similar mechanism of operation: <br>  <a href="http://habrahabr.ru/blogs/java/112165/">habrahabr.ru/blogs/java/112165</a> <br>  <a href="http://habrahabr.ru/blogs/infosecurity/113017/">habrahabr.ru/blogs/infosecurity/113017</a> <br>  <a href="http://habrahabr.ru/blogs/personal/50072/">habrahabr.ru/blogs/personal/50072</a> <br><br>  Question about Java code of a similar Trojan, with an interesting discussion: <br>  <a href="http://habrahabr.ru/blogs/personal/75899/">habrahabr.ru/blogs/personal/75899</a> </div><p>Source: <a href="https://habr.com/ru/post/118422/">https://habr.com/ru/post/118422/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../118411/index.html">Sencha Touch Tutorial 2: Ext.Panel - Layouting</a></li>
<li><a href="../118413/index.html">Build Ubuntu 11.04 by NNLUG</a></li>
<li><a href="../118414/index.html">Military-smartphone for the US military</a></li>
<li><a href="../118417/index.html">Symfony2: Beta 1 is available!</a></li>
<li><a href="../118420/index.html">Create an application for Windows Phone 7 from start to finish. Part 11. Methods of storing data, using data access classes</a></li>
<li><a href="../118423/index.html">Obituary of the lost devices</a></li>
<li><a href="../118429/index.html">Pattern Magic or Factorial Calculation at Compile Stage</a></li>
<li><a href="../118430/index.html">The release of the popular store OpenCart v1.5.0 RC1</a></li>
<li><a href="../118432/index.html">Five of the best tweeters that are not people</a></li>
<li><a href="../118433/index.html">Competition for application developers with guaranteed prizes-smartphones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>