<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Adobe AIR + Starling + rasterizing vector graphics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time has passed since I started making games for iOS and Android on Adobe AIR. Today I want to share a way to create games for different screen r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Adobe AIR + Starling + rasterizing vector graphics</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b8e/767/a9d/b8e767a9d3ac436bb7646a42f5e898c0.png"><br><br>  Some time has passed since I started making games for iOS and Android on Adobe AIR.  Today I want to share a way to create games for different screen resolutions - I successfully apply this approach in my projects. <br><a name="habracut"></a><br>  As you know, there are several ways to prepare game graphics for different screen resolutions: <br><br><h3>  Use multiple packs with graphics. </h3><br>  The most popular approach to the formation of game graphics.  Allows for each permission to work out their own schedule.  For example, on small screens, the elaboration and detailing of various elements is reduced to a minimum, and some details are completely omitted.  But, such a set weighs quite a lot, and not at all resolutions, after texture scaling, it looks good.  After the appearance of retina displays with brutal screen resolutions, the developers had to add one more to the already existing three texture packs. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Draw pixel art </h3><br>  Allows you to use in the game pack of atlases with small textures for only one resolution of the screen, which can be mated to any size.  The square is square.  At least on sd, at least on xxxhd pixel art will look like pixel art.  Plus pixel art is relatively easy to draw. <br><br><h3>  Vector graphics </h3><br>  Allows you to use in the game one pack of atlases for the current screen resolution, weighs almost nothing, stretches to any resolution without loss of quality, looks very good and is quite simply drawn.  This is what I wanted. <br><br>  But not everything is so simple.  The fact is that all vector graphics are processed on the CPU, which means the game with such graphics on the phone is doomed to brake, and you don‚Äôt run away much (there are few objects on the screen and they should be simple without too much detail).  Although the first version of my game City 2048 was just that, and surprisingly worked quite well for me, gave out 25-40 fps.  When launching the test version of the game, I expected the phone to freeze right in my hands and melt from this, but no.  I can also say that another one of my games, Dots Tails, is still working using vector graphics, for good reason. <br><br>  To increase performance, it is necessary to draw all the game graphics on the GPU, for this we will use Stage3D and Starling.  It turns out that of the individual vector elements, you need to make raster sprititshite right size in the process of the application.  We will talk about how to implement this. <br><br>  Before use, vector graphics must be stretched to the desired size, decomposed into an atlas and baked.  For these purposes, I used a slightly modified class from <a href="https://github.com/emibap/Dynamic-Texture-Atlas-Generator">Emiliano Angelini "Dynamic Texture Atlas and Bitmap Font Generator"</a> , leaving him only to create a simple texture atlas without animations. <br><br>  <u>The principle of operation is as follows:</u> <br><br>  <b>1.</b> Draw art for playing in Adobe Flash Pro (or any other vector editor and transfer to Flash Pro) <br><br><img src="https://habrastorage.org/files/ef6/40b/657/ef640b6576774de6acf025dcad00e3bf.png"><br><br>  <b>2.</b> Create a sprite that will contain graphic elements, make it available for AS.  It is from him that we will make sprites. <br><br><img src="https://habrastorage.org/files/ff6/37d/a70/ff637da70d214408b4122303c4df5f95.png"><br><br>  <b>3.</b> We stuff the graphics we need into this sprite.  I tried to place the elements so that they fit in size 512x512.  This is necessary, since at the scale the size of the atlas should not be more than 4k.  For the design of the layout, I always use the size of 600x800, so the drawn and assembled elements look good and do not crawl over the size of 2k.  The same graphic elements should be arranged by subject, for example, in my games, the GUI layer lies above the game graphics, so I make two separate atlas with GUI and with game elements + if in a game there are several visually different levels, then it‚Äôs better to scatter these elements on different atlases.  This will help reduce the number of drawlins. <br><br><img src="https://habrastorage.org/files/a4d/643/76e/a4d64376edfc4e6880a24f462898b992.png"><br><br>  <b>4. We</b> do not forget to assign a name to each element in the atlas. <br><br><img src="https://habrastorage.org/files/881/d53/f02/881d53f0251d4f62a0933c91f67a0cde.png"><br><br>  <b>5.</b> Export .swc with resources and connect it to the project. <br><br><img src="https://habrastorage.org/files/5ed/4dc/5db/5ed4dc5dbce8431fbe221ca351b7ad57.png"><br><br>  <b>6.</b> Getting to the software part.  To begin with, we calculate the skele, on which we will pull resources: <br><br><pre><code class="actionscript hljs"><span class="hljs-comment"><span class="hljs-comment">//    ,   iPad2 var _stageWidth:Number = 768; var _stageHeight:Number = 1024; //  - var defaultScreenWidth:Number = 600; var defaultScreenHeight:Number = 800; //     ,     .     _scaleX = _stageWidth / defaultScreenWidth; _scaleY = _stageHeight / defaultScreenHeight; _minScale = Math.min(_scaleX, _scaleY);</span></span></code> </pre> <br>  <b>7.</b> Add the TextureManager.as class to the project and write atlas names from SWC in it <br><br><div class="spoiler">  <b class="spoiler_title">Content Class TextureManager</b> <div class="spoiler_text"><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Extension</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> avmplus.getQualifiedClassName;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> com.Event.GameActiveEvent;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> com.Module.EventBus;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> com.greensock.TweenNano;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> flash.display.Bitmap;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> flash.display.BitmapData;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> flash.display.DisplayObject;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> flash.display.Sprite;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> flash.display.StageQuality;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> flash.geom.Matrix;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> flash.geom.Rectangle;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> starling.display.Image;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> starling.display.Sprite;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> starling.textures.Texture;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> starling.textures.TextureAtlas;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TextureManager</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//         ,   PivotPoint   SWC private static var textureAdditionalData:Object = {}; //     private static var textureAtlases:Vector.&lt;TextureAtlas&gt; = new &lt;TextureAtlas&gt;[]; //      // !!! (      SWC  ) private static var toParse:Array = [ [guiAtlas, ScaleManager.minScale], [gameAtlas, ScaleManager.minScale] ]; //          public static function getSprite(textureName:String, smooth:String = "none"):starling.display.Sprite { if (textureAdditionalData.hasOwnProperty(textureName)) { var addition:Object = textureAdditionalData[textureName]; var image:Image = new Image(findTexture(textureName)); image.x = -addition["x"]; image.y = -addition["y"]; image.textureSmoothing = smooth; var result:starling.display.Sprite = new starling.display.Sprite(); result.addChild(image); return result; } throw new Error("[!!!] Texture '" + textureName + "' not found."); } //     public static function getTexture(textureName:String):Texture { return findTexture(textureName); } // ,      .   ,      . public static function createAtlases():void { if (!textureAtlases.length) { nextParseStep(); return; } throw new Error("[!!!] Texture atlases already."); } //    private static function nextParseStep():void { if (toParse.length) { var nextStep:Array = toParse.pop(); TweenNano.delayedCall(.15, TextureManager.createAtlas, nextStep); } else { //  ,      . EventBus.dispatcher.dispatchEvent(new GameActiveEvent(GameActiveEvent.GAME_START, true)); } } //      private static function findTexture(textureName:String):Texture { var result:Texture; for each (var atlas:TextureAtlas in textureAtlases) { result = atlas.getTexture(textureName); if (result) { return result; } } throw new Error("[!!!] Texture '" + textureName + "' not found."); } //      SWC    private static function createAtlas(swcPack:Class, scaleFactor:Number):void { var pack:flash.display.Sprite = (new swcPack()) as flash.display.Sprite; var itemsHolder:Array = []; var canvas:flash.display.Sprite = new flash.display.Sprite(); var children:uint = pack.numChildren; for (var i:uint = 0; i &lt; children; i++) { var selected:DisplayObject = pack.getChildAt(i); var realX:Number = selected.x; var realY:Number = selected.y; selected.scaleX *= scaleFactor; selected.scaleY *= scaleFactor; var bounds:Rectangle = selected.getBounds(selected.parent); bounds.x = Math.floor(bounds.x - 1); bounds.y = Math.floor(bounds.y - 1); bounds.height = Math.round(bounds.height + 2); bounds.width = Math.round(bounds.width + 2); var drawRect:Rectangle = new Rectangle(0, 0, bounds.width, bounds.height); var bData:BitmapData = new BitmapData(bounds.width, bounds.height, true, 0); var mat:Matrix = selected.transform.matrix; mat.translate(-bounds.x, -bounds.y); bData.drawWithQuality(selected, mat, null, null, drawRect, false, StageQuality.BEST); var pivotX:int = Math.round(realX - bounds.x); var pivotY:int = Math.round(realY - bounds.y); textureAdditionalData[selected.name] = {x:pivotX, y:pivotY}; var item:flash.display.Sprite = new flash.display.Sprite(); item.name = selected.name; item.addChild(new Bitmap(bData, "auto", false)); itemsHolder.push(item); canvas.addChild(item); } layoutChildren(); var canvasData:BitmapData = new BitmapData(canvas.width, canvas.height, true, 0x000000); canvasData.draw(canvas); var xml:XML = new XML(&lt;TextureAtlas&gt;&lt;/TextureAtlas&gt;); xml.@imagePath = (getQualifiedClassName(swcPack) + ".png"); var itemsLen:int = itemsHolder.length; for (var k:uint = 0; k &lt; itemsLen; k++) { var itm:flash.display.Sprite = itemsHolder[k]; var subText:XML = new XML(&lt;SubTexture /&gt;); subText.@name = itm.name; subText.@x = itm.x; subText.@y = itm.y; subText.@width = itm.width; subText.@height = itm.height; xml.appendChild(subText); } var texture:Texture = Texture.fromBitmapData(canvasData); var atlas:TextureAtlas = new TextureAtlas(texture, xml); textureAtlases.push(atlas); function layoutChildren():void { var xPos:Number = 0; var yPos:Number = 0; var maxY:Number = 0; var maxW:uint = 512 * ScaleManager.atlasSize; var len:int = itemsHolder.length; var itm:flash.display.Sprite; for (var i:uint = 0; i &lt; len; i++) { itm = itemsHolder[i]; if ((xPos + itm.width) &gt; maxW) { xPos = 0; yPos += maxY; maxY = 0; } if (itm.height + 1 &gt; maxY) { maxY = itm.height + 1; } itm.x = xPos; itm.y = yPos; xPos += itm.width + 1; } } nextParseStep(); } public function TextureManager() { throw new Error("[!!!] Used private class."); } } }</span></span></code> </pre></div></div><br>  A little more about what happens in the createAtlas method: <br><br>  <b>7.1.</b>  Each element in the atlas from SWC is a scale, save the coordinates for PivotPoint, draw in Bitmap and add to the canvas container. <br><br>  <b>7.2.</b>  We arrange the elements in the canvas container one after another, so that they fit into the desired size of the atlas <br><br>  " <b>7.3.</b>  Canvas container draw in BitmapData and .XML gene <br><br>  ¬ª <b>7.4.</b>  From the received BitmapData and .XML create a high-ranking TextureAtlas <br><br>  <b>7.5.</b>  The resulting atlas is added to the container textureAtlases <br><br>  <b>8.</b> At the start of the game we create atlases for starling <br><br><pre> <code class="actionscript hljs">TextureManager.createAtlases();</code> </pre> <br>  <b>9.</b> Add the sprite we need to the scene <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tileView:starling.display.Sprite = TextureManager.getSprite(<span class="hljs-string"><span class="hljs-string">"rotateView"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addChild(tileView);</code> </pre> <br>  What we get in the end?  Beautiful graphics, which weighs almost nothing, stretches to an arbitrarily large screen size without loss of quality.  At the same time the game works at a stable 60fps.  Well, for me personally, another plus is that in a vector it is enough just to draw, even though I am not an artist, but I can do something in a vector. <br><br><img src="https://habrastorage.org/files/911/5b2/179/9115b2179b294863919c6381273dee99.png"><br><br>  I use rasterization of vector graphics in my games City 2048, Quadtris and Placid Place.  Which can be found in the Apple App Store and Google Play, if you are interested to see this approach in action.  Unfortunately, direct links to applications can not be left. <br><br>  That's all.  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/307766/">https://habr.com/ru/post/307766/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307756/index.html">Container Virtualization: Standards Coming Soon</a></li>
<li><a href="../307758/index.html">Restore from backup using Veeam Agent for Linux</a></li>
<li><a href="../307760/index.html">How to plan and evaluate projects in Agile?</a></li>
<li><a href="../307762/index.html">Refactoring - power hidden in quality code</a></li>
<li><a href="../307764/index.html">Mitap Haskell programmers at Kaspersky Lab (in the sense of - waiting)</a></li>
<li><a href="../307768/index.html">The tale of virtualization-clustering and storage Fujitsu</a></li>
<li><a href="../307770/index.html">Secrets of cloud PBX: a few words about recording conversations</a></li>
<li><a href="../307774/index.html">Android application traffic analysis: certificate pinning bypass without reverse engineering</a></li>
<li><a href="../307776/index.html">Basics of game design: 20 board games. Part Six: Nuclear War, Paranoia, Call of Cthulhu</a></li>
<li><a href="../307778/index.html">Record time: how we increased the launch speed of Mail.Ru Mail application on iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>