<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Reflections on the binding of "Login through ..." to one account</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Formulation of the problem 
 Some time ago, as a duty of work, the question ‚ÄúHas it necessary to do authorization on a new project through third-party...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Reflections on the binding of "Login through ..." to one account</h1><div class="post__text post__text-html js-mediator-article"><h5>  Formulation of the problem </h5><br>  Some time ago, as a duty <s>of</s> work, the question ‚ÄúHas it necessary to do authorization on a new project through third-party services?‚Äù Came up for discussion.  The brain, agitated by beautiful pop-up windows, widgets and other decorations, appealingly demanding ‚ÄúEnter through me!‚Äù, Was of course with both hands, and modern web-dvololnye (and even, pah pahu, webtrinolnye, maybe?) The development trends of large portals , as it were, hinted.  However, I knowingly said that everything began with a discussion, for where there are disputes, there are also stumbling blocks.  We found such a stone here too. <br><br>  Suppose there is a beautiful socket on the site, such as <a href="http://loginza.ru/">loginses</a> , or simply separate authorization widgets, for example, through contact, twitter, facebook and their ilk.  Easy to log in?  Of course.  But at the same time, if a person enters immediately from all these accounts (at the same time or not, is not the point), for the system they will be different people, and consequently, clones of the same person, whose account, perhaps, doesn‚Äôt exist on the site . <br><br>  It would seem, what's the difference, register an account on the site, or enter through external resources? <br><a name="habracut"></a><br>  And here it all depends on the essence of our project.  If we have a very narrowly focused website, on which, for example, you can read any news and write off the <s>bastard</s> in the comments, we can be satisfied with external services.  And if every user on the site is a whole world, with its articles, ads, ratings, distilleries and aerospace shuttles? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Star Warriors - Attack of the Clones </h4><br>  <i>Immediately I warn you, this article is still only purely theoretical in nature, and was created with the aim to listen to the ideas and suggestions of all who have read it.</i> <br><br><h5>  Search for a solution </h5><br>  Skimming over available resources and examining the API of the most common services, it was found out (not in the sense, "Wow, damn it! And I did not know!", But in the sense of "Aha ... And here it is, and here, and even here, too "), that they all work on the same principle. <br><br>  A person sends a request through an external resource widget, which, in general, returns a user ID on this resource, some account data, and a secret key generated according to the algorithm available to developers.  And this data the same developer can use on the site in any way. <br><br>  After a very vague googling and analyzing the results, a method was invented that, in principle, solves the task of unambiguously establishing the identity of the user logged into the site - binding. <br><br><h5>  Cooking </h5><br>  I will try to describe the algorithms given below in general terms, but since I am currently working with the kohana framework, I can randomly describe the process in terms of this framework, so do not swear much. <br><br>  So first, we need <b>three tables in the database</b> . <br><br>  <b>The first table</b> will be called " <i>Users</i> " and, oddly enough, will include a list of users registered on our site.  Its structure can be any, but it must have required fields <br><br>  - User ID <br>  - Login (or any other field, unique, acting as a login) <br>  - Password (encrypted or not, decide for <a href="http://habrahabr.ru/blogs/mysql/116333/">yourself</a> ) <br><br>  <b>The second table</b> will include the <i>list of external resources allowed on our site</i> , such as contact, twitter, etc., it should look like this: <br><br>  - resource ID <br>  - The name of the resource (for example, "Vkontakte") <br>  - The machine name of the resource (for example, ‚Äúvkontakte‚Äù) <br>  - Place the user ID in the link (for example, "vkontakte.ru/{ ID}") <br>  - The key (ID) of the application (in our case, our site) on this resource <br><br>  And the <b>third table</b> , and, perhaps, the most important one, is the " <i>Links</i> ", which will include the correspondence of the user account on our site to the account on an external resource.  She looks like this: <br>  - ID of communication (classic, yes?) <br>  - resource ID <br>  - User ID on our site <br>  - ID (or ID) of the user on the external resource <br><br>  Also, in the future, for each of the resources provided on our site, we must have appropriate views (some popup windows and other wonders) that will display a particular widget, as well as functions (classes, helpers). , modules or whatever) that will calculate and check the corresponding API key, but more on that later. <br><br><h5>  Some algorithms </h5><br>  So now the action itself.  Let's start with the easiest! <br><br>  Suppose we have a website on which we see the traditional login / registration form, as well as a panel with some widgets of some external resources. <br><br>  When a person enters / registers on our website traditionally, after going through the final authorization procedure, he will get to our website or immediately to his panel, where he will see the settings section.  Having entered this section, he will see a panel there, for example, ‚ÄúProfiles on external resources‚Äù, where the fields created in our table of external resources will be. <br><br>  Suppose the user selected the "Vkontakte" field, and entered his ID there.  How the process starts - if you lose the focus of the input, or when you press a button, or thanks to a UFO - it does not matter to us, the consequences are important.  We run the appropriate authorization procedure for the corresponding widget (pop-up window, ajax-request for the desired script or something else). <br><br>  If the user is already authorized on an external resource, the necessary data will be returned to us, otherwise, the user will have to log in, and we will still receive long-awaited data.  And here begins the witch. <br><br>  The <b>key</b> returned from the resource is some kind of hash or, what's more terrible, from the aggregate of data, which, in particular, contains the user ID on the remote resource.  To begin, we use the key generation procedure created by us (here, for which we needed the machine name to call the corresponding procedures) for a specific resource, we create this key using the identifier entered by the user on our site.  Then we compare the key that came from the resource with ours. <br><br>  If the two keys match, and the entered identifier coincides with the received one in the open, it means that we are really the owner of the specified account.  In this case, we create a row in the table " <i>Links</i> ", and the entered identifier becomes unique, no one else can enter the same (as an option, in the case of an input attempt, show an error that someone already has such an ID, and output link to this person). <br><br>  In the case when the keys didn‚Äôt match, it‚Äôs worth scolding a person for trying to kidnap someone‚Äôs identifier, or politely ask again if he entered under his account, or, out of habit, climbed onto the page of his girlfriend / boyfriend. <br><br>  The above is true for any external resource, the ID of which the user wants to specify. <br><br>  The easiest option finished.  We proceed to the most difficult part - authorization through external control without registering on the site. <br><br>  In this case, in this method, there is no need to create a physical account.  As soon as a person makes an entry to the site, say, through the same contact, a session will open for him and a large warning message will appear to him, like: <br><br>  <i>This account <b>% resource name% is</b> not tied to any of the accounts registered on the site.</i>  <i>You can link it to <u>your</u> account right now, or register a <u>new one</u> .</i> <br><br>  Actually, everything will not be limited to the issuance of this window, because in order to motivate the user to bind themselves to any account, we will also cut the rights for him so that he can, for example, only watch content.  Well, or something else like that.  Of course, when a person clicks on one of the links in the warning, he will be able to calmly or enter his login password, and the identifier under which he currently entered the site will automatically link to his account, as in the case of registration. <br><br><h5>  findings </h5><br>  Say, severely limit the user without a real account on the site?  I agree. <br>  But, having passed a simple registration procedure, he will subsequently be able to log in with one click through various resources, and will always get into his account on the site, and the binding process from an existing account generally takes moments.  In any case, even a binding warning can be implemented in the best traditions of webbangles, so that it doesn‚Äôt particularly afflict the eyes, but also hints at the same time. <br><br>  Unfortunately, at the moment I don‚Äôt have time to implement the above algorithm, but if I do it, but first of all under the Kohana framework, now I‚Äôll be happy to hear constructive criticism and suggestions how and what can be improved here.  Thanks for attention </div><p>Source: <a href="https://habr.com/ru/post/116375/">https://habr.com/ru/post/116375/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116370/index.html">Mobile Form Design Principles</a></li>
<li><a href="../116371/index.html">Jack Dorsey will be back on Twitter</a></li>
<li><a href="../116372/index.html">Unit tests, we try to write correctly, so that later it would not be excruciatingly painful</a></li>
<li><a href="../116373/index.html">Young Entrepreneur Competition</a></li>
<li><a href="../116374/index.html">Image fill algorithms, popular with video</a></li>
<li><a href="../116376/index.html">Logging in Android applications</a></li>
<li><a href="../116378/index.html">American Express launches Paypal</a></li>
<li><a href="../116379/index.html">How to sell SaaS through hosters: the experience of the project "My Warehouse"</a></li>
<li><a href="../116380/index.html">Install video driver for SIS M671 / M672 family of video cards under Ubuntu 11.04</a></li>
<li><a href="../116381/index.html">Shatokua about testing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>