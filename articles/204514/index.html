<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We program under Pebble. Lesson two: Pebble giving answers, dice and sex cubes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The clock is nice, but the whole site is full of them. We need to do something more interesting. 

 Remember the ball from ‚Äúhighway 60‚Äù? Let's make it...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We program under Pebble. Lesson two: Pebble giving answers, dice and sex cubes</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/company/avi/blog/204338/">The clock</a> is nice, but the whole site is full of them.  We need to do something more interesting. <br><img src="https://habrastorage.org/getpro/habr/post_images/af1/e79/fdb/af1e79fdb0d5786ae2eb39819c4574fd.jpg" alt="image"><br>  Remember the ball from ‚Äúhighway 60‚Äù?  Let's make it an analogue - an application that answers the question. <br><a name="habracut"></a><br><br><h4>  <s>Ball</s> Pebble giving answers <br></h4>  Only we will have not a ball, but a pebble, that is, a Pebble :) <br>  What do we need for this?  List of answers and random number generator.  We will take the list of answers on <a href="http://ru.wikipedia.org/wiki/Magic_8_ball">Wikipedia</a> .  Create an array and fill it with answers: <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* messages[] = {<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">"    "</span></span>,<span class="hljs-string"><span class="hljs-string">"  - "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"  - "</span></span>,<span class="hljs-string"><span class="hljs-string">"  ,   "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">"     "</span></span>,<span class="hljs-string"><span class="hljs-string">"  "</span></span>,<span class="hljs-string"><span class="hljs-string">"   "</span></span>,<span class="hljs-string"><span class="hljs-string">"  "</span></span>,<span class="hljs-string"><span class="hljs-string">"  - "</span></span>,<span class="hljs-string"><span class="hljs-string">"  - "</span></span>,<span class="hljs-string"><span class="hljs-string">"   "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>,};</code> </pre>  The order is not important, they will still be chosen randomly from it. <br><br>  We create the main window of the program and the text layer in the same way as in the previous <a href="http://habrahabr.ru/company/avi/blog/204338/">lesson</a> , with the exception of a small difference - <a href="https://developer.getpebble.com/2/api-reference/group___window.html">using the window_set_fullscreen ()</a> function, we remove the top bar of the application.  It is called like this: <br><pre> <code class="cpp hljs"> window_set_fullscreen(window, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre>  The first argument is the name of the window, the second, respectively, true - full screen, false - with bar.  Subtlety - this function must be called <b>before</b> window_stack_push, otherwise the miracle will not happen. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now let's do a random number generator.  To do this, there is a <a href="https://developer.getpebble.com/2/api-reference/group___standard_math.html">rand ()</a> function that returns a random number with each call.  Like any RNG software, it needs to be initialized with a random number before starting work, otherwise the line of numbers will be repeated each time it is started.  This is done by the srand () function.  For example, in the SDK there is an example where it is initialized by the current time.  Since we do not know at what time the program will start, and this time is different every time - this is a sufficient source of entropy for our idea.  Do this like this: <br><pre> <code class="cpp hljs">srand(time(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>));</code> </pre><br>  True, the generator can now produce a fairly large number - obviously more than we have possible answers.  Therefore, using the following <b>messages [rand ()% 21]</b> construct.  % Is the remainder of an integer division.  Suppose the generator returns 456, they are divided by 21, and we use the remainder (456-21 * 21) - 15 as the answer number.  It can not be more than 21, because the remainder of the division will be equal to zero. <br><br>  We merge all of the above into one, and we get this function call: <pre> <code class="cpp hljs">text_layer_set_text(text_layer, messages[rand() % <span class="hljs-number"><span class="hljs-number">21</span></span>]);</code> </pre><br>  Here is the whole source: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"pebble.h"</span></span></span><span class="hljs-meta"> Window *window; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> TextLayer *text_layer; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*      */</span></span></span><span class="hljs-meta"> static const char* messages[] = {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"    "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  - "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  - "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  ,   "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"     "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"   "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  - "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  - "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"   "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">,}; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> int main(void) { window = window_create(); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> window_set_background_color(window, GColorBlack); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> window_set_fullscreen(window, true); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> window_stack_push(window, true); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> text_layer = text_layer_create(GRect(1, 47, 142, 77)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> text_layer_set_text_color(text_layer, GColorWhite); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> text_layer_set_background_color(text_layer, GColorClear); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> text_layer_set_font(text_layer, fonts_get_system_font(FONT_KEY_GOTHIC_24)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> text_layer_set_text_alignment(text_layer, GTextAlignmentCenter); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> layer_add_child(window_get_root_layer(window), text_layer_get_layer(text_layer)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*         */</span></span></span><span class="hljs-meta"> srand(time(NULL)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*       */</span></span></span><span class="hljs-meta"> text_layer_set_text(text_layer, messages[rand() % 21]); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*        */</span></span></span><span class="hljs-meta"> app_event_loop(); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*  - */</span></span></span><span class="hljs-meta"> text_layer_destroy(text_layer); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*  ,   */</span></span></span><span class="hljs-meta"> window_destroy(window); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*  ,   */</span></span></span><span class="hljs-meta"> }</span></span></code> </pre><br>  The program displays a message at startup and no longer does anything.  To show another message, restart the program: <br><img src="https://habrastorage.org/getpro/habr/post_images/a98/724/3c9/a987243c911737b972356fd2641b63a7.gif"><br><br>  The next step is to display the message when you click on the button. <br><br>  In the Pebble API, the term ‚Äúsubscription‚Äù is used to assign functions that will be launched not in the main loop, but after some actions - a timer tick, a button click, and so on.  Remember, in the last lesson, we subscribed to a timer that called the screen refresh function once a second?  There is something similar, we subscribe to a button click (and the API already has several ready-made options - a <a href="https://developer.getpebble.com/2/api-reference/group___window.html">single click</a> , <a href="https://developer.getpebble.com/2/api-reference/group___window.html">double click</a> , <a href="https://developer.getpebble.com/2/api-reference/group___window.html">hold,</a> and so on), after which we click the function we set will be started. <br><br>  The API says that we need to call the <b>window_set_click_config_provider ()</b> method, which takes as arguments the pointer to the window in which to click, and the name of the function that describes the subscriptions.  Please note, we will not subscribe to the buttons, but only in the function specified in <b>window_set_click_config_provider</b> .  This is done like this: <br><pre> <code class="cpp hljs">window_set_click_config_provider(window, WindowsClickConfigProvider);</code> </pre>  The window pointer is window, the function name is WindowsClickConfigProvider.  Create it: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WindowsClickConfigProvider</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *context)</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre><br>  And we add inside the <a href="https://developer.getpebble.com/2/api-reference/group___window.html">window_single_click_subscribe</a> methods that take the name of the button and the function to which the control will be passed as arguments: <br><pre> <code class="cpp hljs">window_single_click_subscribe(BUTTON_ID_UP, click);</code> </pre>  In this case, when you press the up button, we call click. <br>  The buttons (we have 3 of them) are called BUTTON_ID_UP, BUTTON_ID_SELECT, BUTTON_ID_DOWN, respectively.  You can subscribe to the "back" button, but it will always throw you out to the previous screen (in case the application has one screen - in the menu). <br><br>  Now the application looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/477/923/220/4779232202e450c1ce7c50658ff12881.gif"><br><br>  And its source: <pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"pebble.h"</span></span></span><span class="hljs-meta"> Window *window; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> TextLayer *text_layer; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*      */</span></span></span><span class="hljs-meta"> static const char* messages[] = {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" - "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"   "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  - "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  - "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  ,   "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"     "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"   "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  - "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  - "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"   "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">,}; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> void click(ClickRecognizerRef recognizer, void *context) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*        */</span></span></span><span class="hljs-meta"> { text_layer_set_text(text_layer, messages[rand() % 21]); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*        */</span></span></span><span class="hljs-meta"> } void WindowsClickConfigProvider(void *context) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ,        */</span></span></span><span class="hljs-meta"> { window_single_click_subscribe(BUTTON_ID_UP, click); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*       click */</span></span></span><span class="hljs-meta"> window_single_click_subscribe(BUTTON_ID_SELECT, click); window_single_click_subscribe(BUTTON_ID_DOWN, click); } int main(void) { window = window_create(); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> window_set_background_color(window, GColorBlack); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> window_set_fullscreen(window, true); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> window_stack_push(window, true); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> text_layer = text_layer_create(GRect(0, 7, 144, 168)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> text_layer_set_text_color(text_layer, GColorWhite); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> text_layer_set_background_color(text_layer, GColorClear); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> text_layer_set_font(text_layer, fonts_get_system_font(FONT_KEY_GOTHIC_24)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> text_layer_set_text_alignment(text_layer, GTextAlignmentCenter); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> layer_add_child(window_get_root_layer(window), text_layer_get_layer(text_layer)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*         */</span></span></span><span class="hljs-meta"> srand(time(NULL)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*       */</span></span></span><span class="hljs-meta"> window_set_click_config_provider(window, WindowsClickConfigProvider); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*  ,        */</span></span></span><span class="hljs-meta"> text_layer_set_text(text_layer, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Magic Pebble \n  ,     \"\"  \"\"    "</span></span></span><span class="hljs-meta">); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> app_event_loop(); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> text_layer_destroy(text_layer); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*  ,   */</span></span></span><span class="hljs-meta"> window_destroy(window); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*  ,   */</span></span></span><span class="hljs-meta"> }</span></span></code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/78d/dfd/b76/78ddfdb768e76565e6ec0d889e72aae7.jpg"><br>  Works!  You can assign version 0.1 :) <br>  But something is missing.  It would be nice to add some effects.  You can make an animation of changing the responses so that the clock responds not immediately when you press the button, but for a few seconds ‚Äúsorted out‚Äù options.  In quotes - because the answer will be random in any case, but in the first case the user will have more confidence in the application - we are all familiar with the random process of choosing cards from the bag or balls with numbers when playing the lottery. <br><br>  It will be even more beautiful if we add a little physics.  The fact is that people, without knowing it, are surrounded by processes proceeding along the reciprocal exponential - when the processes are ‚Äúfast‚Äù at the very beginning, they do not pass linearly, but they lose speed the more, the more time has passed since the beginning. <br>  It could be anything - for example, cooling hot tea on the table.  When the temperature difference between tea and ambient air is great, it cools much faster than when it is slightly warm.  Or bubbles in a glass of carbonated water.  At first, when the concentration of carbonic acid in water is high, it decomposes very actively, but after a while the concentration decreases, and with it the number of bubbles decreases. <br>  In this case, I would like to do something like a wheel of fortune - where the segments first replace each other quickly, slowly slowing down.  Here the friction is ‚Äúguilty‚Äù - the more speed, the more the wheel rubs against the axis and the more it loses energy, transferring it to heat and slowing down.  But with decreasing speed losses and friction are reduced - as a result, the wheel loses 50% of its speed in the first 20% of the time, and the remaining 50% in the remaining 70%. <br><br>  We will count time in milliseconds between shifts of messages.  By experiments, it was found that a good range of values ‚Äã‚Äã- from 0 to 300-400ms.  If the intervals are longer, there is a feeling that the already shown answer has suddenly changed. <br>  The simplest function that provides this behavior is something like x = x * 2.  But when multiplied by 2, the graph of the function rises too abruptly, with each iteration the delay time doubles.  We will get 256 (the maximum delay, since the next value - 512 already goes beyond the limits of convenience) already at step 8 with a duration of only 1 + 2 + 4 + 8 + 16 + 32 + 64 + 128 + 256 = 511ms.  Half a second is too fast. <br>  By experience, I realized that the multiplier should be around 1.08-1.2, then we get about 30 steps and a duration of about 3 seconds.  But I do not like the function x = x * y - it rises too hollow, and the flickering slows down too slowly (yes, I'm strange), I would like it to flash ‚Äúquickly‚Äù longer, and then abruptly stop. <br><br>  It could have been easier to do - to score the value of the delays in the array and <s>rub</s> them in, edit them, edit them until satisfaction, since there are not so many of them - 40 pieces.  Once multiplication does not suit us, try division.  Something like x = x / 0.7.  But by itself, it increases too sharply - 300 we get at the 18th step, and I would like a little more.  But it can be divided, for example, by 100. Or by 1000. Let's build graphs of all functions with an initial value of 1. The numbers above the graphs are the number of steps. <br><img src="https://habrastorage.org/getpro/habr/post_images/1f0/f30/97d/1f0f3097d4dc3d60594bf758aaba089a.png"><br>  Here, it means that y = y / 0.7 x = y / 100 is quite suitable for us, we can do. <br><br>  But first, let's fix one glitch:  information at startup and messages are displayed in the same layer, then messages are displayed at the top of the screen (unfortunately, there is no vertical alignment).  Yes, and small print, although they can be done and more - they are much shorter and fit in the screen.  I did not find a layer resizing method in the API, so we will have to delete the layer and create it again, but with different coordinates.  However, this will turn out ugly - a part of the code will be duplicated (layer settings after its creation) to prevent this from happening - we will move part of the code into a separate function. <br>  Create: <pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">config_text_layer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> h,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> w, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *font_key)</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre><br>  The first 4 parameters are the information about the layer ‚Äî the coordinates of the point and the dimensions; the fifth parameter is the font.  Accordingly, we rewrite the initialization functions to use these variables: <br><pre> <code class="cpp hljs">text_layer = text_layer_create(GRect(x, y, h, w)); text_layer_set_font(text_layer, fonts_get_system_font(font_key));</code> </pre><br>  And paste them into our function along with the rest of the layer setup code.  Now you can just do it in the right place like this: <br><pre> <code class="cpp hljs">text_layer_destroy(text_layer); config_text_layer(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">134</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>, FONT_KEY_GOTHIC_28);</code> </pre><br>  So let's do it in the click function, which is called by us when the button is pressed.  Yes, a layer will be created every time a button is pressed; this can be avoided by simply checking something like: <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> first_time=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (first_time == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { text_layer_destroy(text_layer); config_text_layer(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">134</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>, FONT_KEY_GOTHIC_28); first_time = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  But I did not bother.  Better deal with the timer.  An API search gave the <a href="https://developer.getpebble.com/2/api-reference/group___timer.html">app_timer_register ()</a> function, which takes as arguments the value in ms, through which the timer will work, the name of the function to be called when it is triggered, and a pointer to the data to be passed to this function.  Unfortunately, I didn‚Äôt figure out how to work with the pointer, so I‚Äôll have to spit on the beauty of the code and do it through a global variable: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> timer_delay=<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><br>  We create a function that will recursively call a timer at ever-increasing intervals. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timer_call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">/*       */</span></span></span><span class="hljs-function"> </span></span>{ text_layer_set_text(text_layer, messages[rand() % <span class="hljs-number"><span class="hljs-number">21</span></span>]); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timer_delay &lt; <span class="hljs-number"><span class="hljs-number">300</span></span>*<span class="hljs-number"><span class="hljs-number">100</span></span> ) <span class="hljs-comment"><span class="hljs-comment">/*      300... */</span></span> { timer_delay=timer_delay/<span class="hljs-number"><span class="hljs-number">0.7</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* ... ... */</span></span> app_timer_register(timer_delay/<span class="hljs-number"><span class="hljs-number">100</span></span>, timer_call, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* ...    */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     300... */</span></span> { timer_delay=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*       -     */</span></span> } }</code> </pre><br>  The center of the function is the variable floating point timer_delay.  It is divided by 0.7 until it reaches 30000. Each new value of the variable is divided by 100 and given as an argument to the delay of the app_timer_register function, which, when triggered, will call this function again. <br><br>  It remains only to add a call to this function in <b>click ()</b> : <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">click</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ClickRecognizerRef recognizer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *context)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">/* ,      */</span></span></span><span class="hljs-function"> </span></span>{ text_layer_destroy(text_layer); <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> config_text_layer(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">134</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>, FONT_KEY_GOTHIC_28); <span class="hljs-comment"><span class="hljs-comment">/*         */</span></span> timer_call(); <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> }</code> </pre><br>  And you can enjoy the result: <br><br>  If we think a bit about what we did, then it turns out that we have created a platform for simulating any pieces that are used in the real world as RNG.  The complex movement of a multifaceted figure in the fluid inside the ball is a process that cannot be predicted.  Just like the dice.  By the way, dice!  What is not an option for another application? <br>  I really wanted to look for pictures on the edges of the bones and came across ... no, well, these are also drawings.  And also on the dice.  Just dots.  In general, I stumbled upon this: <br><br><br>  And that's all.  What are there dice when there is such a great idea?  Come sell! <br><br><h4>  Sex Roulette <br></h4>  The logic of the program remains the same.  Change the messages array: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* messages[] = {<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">"  "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">"  "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">"  "</span></span>,};</code> </pre><br>  And a message at startup: <br><pre> <code class="cpp hljs">text_layer_set_text(text_layer, <span class="hljs-string"><span class="hljs-string">"Sex Roulette \n    ,      --&gt;"</span></span>);</code> </pre><br>  We create in memory to which the pointer points a graphic array, indicating coordinates.  The syntax is exactly the same as in text_layer_create: <br><pre> <code class="cpp hljs">image_layer = bitmap_layer_create(GRect(<span class="hljs-number"><span class="hljs-number">0</span></span> , <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">144</span></span>, <span class="hljs-number"><span class="hljs-number">144</span></span>));</code> </pre><br>  Make the layer created by the child of the main window layer.  Why do you need it?  This adjusts the ‚Äúheight‚Äù (in terms of css, if it is clearer to whom it is the z-index) of a layer with respect to other layers, it depends on how the layers overlap each other.  All children are above the parent and close it with their conclusion. <br><pre> <code class="cpp hljs">layer_add_child(window_get_root_layer(window), bitmap_layer_get_layer(image_layer));</code> </pre><br>  Customize blending mode.  Depending on this parameter, the picture will interact in different ways with the background. <br><pre> <code class="cpp hljs">bitmap_layer_set_compositing_mode(image_layer, GCompOpAssignInverted);</code> </pre><br>  All options can be described <a href="http://=">here</a> , or you can poke in the picture: <br><img src="https://developer.getpebble.com/2/api-reference/compops.png" alt="image"><br>  Source is in this case the graphics layer, and Destination is its parent, the main layer of the window.  As everything is simply and remarkably fit into 6 options when working with monochrome pictures ... <br><br>  Now we will deal with the display of random pictures.  We will look for suitable pictures in Google (two-color and small) for some kind of " <a href="https://www.google.ru/search%3Fq%3D%25D0%25B8%25D0%25BA%25D0%25BE%25D0%25BD%25D0%25BA%25D0%25B8%2B%25D0%25BF%25D0%25BE%25D0%25B7%25D1%258B%26espv%3D210%26es_sm%3D91%26source%3Dlnms%26tbm%3Disch%26sa%3DX%26ei%3D76GfUvT0JMHx4QSPoIHACA%26ved%3D0CAcQ_AUoAQ%26biw%3D1916%26bih%3D942">icon poses</a> ". <br>  <a href="http://ivan-off.com/vektornyj-klipart/1112-vektornye-ikonki-kamasutry.html">This</a> site found this: <br><br>  We download the vector, delete any borders, export it to PNG with a higher resolution, open it in some graphic editor. <br>  Select each picture, delete the unsuccessful and incomprehensible, fit it into a square, reduce it to 144 pixels, clean up the flaws.  The result of our work should be a folder with pictures: <br><br>  From one of the pictures we make a logo for the menu, 24x28 pixels in size: <br>  -&gt; <br><br>  Open the appinfo.json file in the project folder and add our created resources to it.  Unfortunately, I can‚Äôt tell you how this is done in CloudPebble - it suddenly stopped working for me, not accepting the password and holding the sources of all my projects.  So I set up the development environment for myself on the computer according to the <a href="https://developer.getpebble.com/2/getting-started/macosx/">instructions</a> from the official site, and write there. <br><br>  So, about appinfo.json.  It looks like this: <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"uuid"</span></span>: <span class="hljs-string"><span class="hljs-string">"0f7b8336-d72d-4806-9191-566ffd8f3a8c"</span></span>, <span class="hljs-string"><span class="hljs-string">"shortName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SexRoulette"</span></span>, <span class="hljs-string"><span class="hljs-string">"longName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SexRoulette"</span></span>, <span class="hljs-string"><span class="hljs-string">"companyName"</span></span>: <span class="hljs-string"><span class="hljs-string">"vvzvlad"</span></span>, <span class="hljs-string"><span class="hljs-string">"versionCode"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"versionLabel"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"watchapp"</span></span>: { <span class="hljs-string"><span class="hljs-string">"watchface"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-string"><span class="hljs-string">"appKeys"</span></span>: { <span class="hljs-string"><span class="hljs-string">"dummy"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">"resources"</span></span>: { <span class="hljs-string"><span class="hljs-string">"media"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"menuIcon"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"png"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"DEFAULT_MENU_ICON"</span></span>, <span class="hljs-string"><span class="hljs-string">"file"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/logo.png"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"png"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"POSE_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"file"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/1.png"</span></span> },</code> </pre>  At the beginning are familiar fields, the meaning of which is clear and without explanation, and then it describes all 32 pictures.  Please note that the structure should be exactly like this: <br><br><pre> <code class="javascript hljs"> { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"png"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"file"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/1.png"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"png"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"file"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/1.png"</span></span> }</code> </pre><br>  After the last bracket should not be a comma, as well as after specifying the file address.  And the fields should follow exactly in the order type, name, file. <br>  What the hell goes against the <a href="https://developer.getpebble.com/2/api-reference/group___resources.html">official documentation</a> : <br><br>  <s>Keyboard in the ass cram!</s>  I send rays of diarrhea to those who wrote this documentation, I was stupid for half an hour and wondered what he was cursing.  He even swears so indistinctly that one really does not understand what does not suit him: <br><pre> <code class="python hljs">Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"/Users/vvzvlad/Documents/PebbleSDK-2.0-BETA2/Pebble/.waf-1.7.11-478a7e7e9ed077304a8092741524bf8b/waflib/Scripting.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">351</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> execute <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> execute_method(self) File <span class="hljs-string"><span class="hljs-string">"/Users/vvzvlad/Documents/PebbleSDK-2.0-BETA2/Pebble/.waf-1.7.11-478a7e7e9ed077304a8092741524bf8b/waflib/Build.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">106</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> execute self.execute_build() File <span class="hljs-string"><span class="hljs-string">"/Users/vvzvlad/Documents/PebbleSDK-2.0-BETA2/Pebble/.waf-1.7.11-478a7e7e9ed077304a8092741524bf8b/waflib/Build.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">109</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> execute_build self.recurse([self.run_dir]) File <span class="hljs-string"><span class="hljs-string">"/Users/vvzvlad/Documents/PebbleSDK-2.0-BETA2/Pebble/.waf-1.7.11-478a7e7e9ed077304a8092741524bf8b/waflib/Context.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> recurse user_function(self) File <span class="hljs-string"><span class="hljs-string">"/Users/vvzvlad/Documents/PebbleSDK-2.0-BETA2/SexRoulette/wscript"</span></span>, line <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> build ctx.load(<span class="hljs-string"><span class="hljs-string">'pebble_sdk'</span></span>)</code> </pre>  Well, to hell with him.  As you already understood, the icon picture for the menu is marked with the <b>‚ÄúmenuIcon‚Äù</b> field <b>: true</b> , and you can also access it from the program. <br><br>  Let's return to our pictures.  Documentation suggests uploading a picture like this: <br><pre> <code class="cpp hljs">image = gbitmap_create_with_resource(RESOURCE_ID_POSE_1);</code> </pre><br>  What is not suitable for us.  Do not fence the same type of monstrous design <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">select </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> % 31 </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">case</span></span></span><span class="hljs-function"> 1 image </span></span>= gbitmap_create_with_resource(RESOURCE_ID_POSE_1); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> image = gbitmap_create_with_resource(RESOURCE_ID_POSE_2);</code> </pre><br>  It's not beautiful.  From the documentation, we understand that RESOURCE_ID_POSE_2 is just a variable of type uint32_t in which the resource number is stored. <br><br>  Create an array of the type we need: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> images[]</code> </pre><br>  And we list in it the resources we need: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> images[] = {RESOURCE_ID_POSE_1,RESOURCE_ID_POSE_2,RESOURCE_ID_POSE_3,RESOURCE_ID_POSE_4,RESOURCE_ID_POSE_5,RESOURCE_ID_POSE_6,RESOURCE_ID_POSE_7,RESOURCE_ID_POSE_8,RESOURCE_ID_POSE_9,RESOURCE_ID_POSE_10,RESOURCE_ID_POSE_11,RESOURCE_ID_POSE_12,RESOURCE_ID_POSE_13,RESOURCE_ID_POSE_14,RESOURCE_ID_POSE_15,RESOURCE_ID_POSE_16,RESOURCE_ID_POSE_17,RESOURCE_ID_POSE_18,RESOURCE_ID_POSE_19,RESOURCE_ID_POSE_20,RESOURCE_ID_POSE_21,RESOURCE_ID_POSE_22,RESOURCE_ID_POSE_23,RESOURCE_ID_POSE_24,RESOURCE_ID_POSE_25,RESOURCE_ID_POSE_26,RESOURCE_ID_POSE_27,RESOURCE_ID_POSE_28,RESOURCE_ID_POSE_29,RESOURCE_ID_POSE_30,RESOURCE_ID_POSE_31,RESOURCE_ID_POSE_32,};</code> </pre><br>  Now we can call a random image in the same way as the text: <br><pre> <code class="cpp hljs">image = gbitmap_create_with_resource(images[rand() % <span class="hljs-number"><span class="hljs-number">31</span></span>]);</code> </pre><br>  We called a picture from <s>nonexistence</s> from flash memory and placed it in the RAM.          bitmap_layer_set_bitmap,         . <br>    : <br><pre> <code class="cpp hljs">bitmap_layer_set_bitmap(image_layer, image);</code> </pre><br> <b>image_layer</b> ‚Äî       ,  <b>image</b> ‚Äî     . <br>  Look like that's it.  Run! <br><br>  ,  ,       Recovery   . <br> , ,       ,    .  ,   - ,   ,    . <br>  <s>spaaarta!</s> embeeeeedded!    . <br>  .   ,         . <br><pre> <code class="cpp hljs">gbitmap_destroy(image); image = gbitmap_create_with_resource(images[rand() % <span class="hljs-number"><span class="hljs-number">31</span></span>]); bitmap_layer_set_bitmap(image_layer, image);</code> </pre><br>          image  ,  gbitmap_destroy   . App Crashed‚Ä¶ <br>         ,    ,   - . ,      -  .  : <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> first_time=<span class="hljs-literal"><span class="hljs-literal">true</span></span>;</code> </pre><br>      ,  : <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timer_call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ first_time = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre><br><br>   <b>gbitmap_destroy</b> ‚Äî    first_time == false,  <b>text_layer_destroy</b>  <b>config_text_layer</b>   click ‚Äî ,    first_time == true: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timer_call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (first_time == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { gbitmap_destroy(image); bitmap_layer_destroy(image_layer); } first_time = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; ..... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">click</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ClickRecognizerRef recognizer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (first_time == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { text_layer_destroy(text_layer); config_text_layer(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">146</span></span>, <span class="hljs-number"><span class="hljs-number">144</span></span>, <span class="hljs-number"><span class="hljs-number">168</span></span><span class="hljs-number"><span class="hljs-number">-146</span></span>, FONT_KEY_GOTHIC_18); }</code> </pre><br>  Works! <br><br><br> , .       : <br><pre> <code class="cpp hljs"> text_layer_destroy(text_layer); window_destroy(window); gbitmap_destroy(image); bitmap_layer_destroy(image_layer);</code> </pre><br>      gbitmap.         ,    !    ,             ‚Äî  .   .         ‚Äî   ,    : <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (first_time == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { gbitmap_destroy(image); }</code> </pre><br>    . <br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"pebble.h"</span></span></span><span class="hljs-meta"> float timer_delay=1; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*        */</span></span></span><span class="hljs-meta"> Window *window; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> TextLayer *text_layer; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*      */</span></span></span><span class="hljs-meta"> static BitmapLayer *image_layer; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*      */</span></span></span><span class="hljs-meta"> static GBitmap *image; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*       */</span></span></span><span class="hljs-meta"> bool first_time=true; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> static const char* messages[] = {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"  "</span></span></span><span class="hljs-meta">,}; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> static const uint32_t images[] = {RESOURCE_ID_POSE_1,RESOURCE_ID_POSE_2,RESOURCE_ID_POSE_3,RESOURCE_ID_POSE_4,RESOURCE_ID_POSE_5,RESOURCE_ID_POSE_6,RESOURCE_ID_POSE_7,RESOURCE_ID_POSE_8,RESOURCE_ID_POSE_9,RESOURCE_ID_POSE_10,RESOURCE_ID_POSE_11,RESOURCE_ID_POSE_12,RESOURCE_ID_POSE_13,RESOURCE_ID_POSE_14,RESOURCE_ID_POSE_15,RESOURCE_ID_POSE_16,RESOURCE_ID_POSE_17,RESOURCE_ID_POSE_18,RESOURCE_ID_POSE_19,RESOURCE_ID_POSE_20,RESOURCE_ID_POSE_21,RESOURCE_ID_POSE_22,RESOURCE_ID_POSE_23,RESOURCE_ID_POSE_24,RESOURCE_ID_POSE_25,RESOURCE_ID_POSE_26,RESOURCE_ID_POSE_27,RESOURCE_ID_POSE_28,RESOURCE_ID_POSE_29,RESOURCE_ID_POSE_30,RESOURCE_ID_POSE_31,RESOURCE_ID_POSE_32,}; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> void timer_call() </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*       */</span></span></span><span class="hljs-meta"> { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (first_time == false) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*      ... */</span></span></span><span class="hljs-meta"> { bitmap_layer_destroy(image_layer); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ...   ... */</span></span></span><span class="hljs-meta"> gbitmap_destroy(image); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ..      */</span></span></span><span class="hljs-meta"> } first_time = false; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> image = gbitmap_create_with_resource(images[rand() % 31]); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*         */</span></span></span><span class="hljs-meta"> bitmap_layer_set_bitmap(image_layer, image); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*      */</span></span></span><span class="hljs-meta"> text_layer_set_text(text_layer, messages[rand() % 23]); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (timer_delay </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; 300*100 ) /*      300... */ { timer_delay=timer_delay/0.7; /* ... ... */ app_timer_register(timer_delay/100, timer_call, NULL); /* ...    */ } else /*     300... */ { timer_delay=1; /*       -        */ } } void config_text_layer(int16_t x,int16_t y,int16_t h,int16_t w, const char *font_key) /*    ,  ,       */ { text_layer = text_layer_create(GRect(x, y, h, w)); /*   ,     */ text_layer_set_text_color(text_layer, GColorWhite); /*    */ text_layer_set_background_color(text_layer, GColorClear); /*    */ text_layer_set_font(text_layer, fonts_get_system_font(font_key)); /*   */ text_layer_set_text_alignment(text_layer, GTextAlignmentCenter); /*     */ layer_add_child(window_get_root_layer(window), text_layer_get_layer(text_layer)); /*         */ } void click(ClickRecognizerRef recognizer, void *context) /* ,      */ { if (first_time == true) /*      ... */ { text_layer_destroy(text_layer); /* ...     ... */ config_text_layer(0, 146, 144, 168-146, FONT_KEY_GOTHIC_18); /* ...           */ } timer_call(); /*       */ } void WindowsClickConfigProvider(void *context) /* ,        */ { window_single_click_subscribe(BUTTON_ID_UP, click); /*       click */ window_single_click_subscribe(BUTTON_ID_SELECT, click); window_single_click_subscribe(BUTTON_ID_DOWN, click); } int main(void) { window = window_create(); /*   */ window_set_background_color(window, GColorBlack); /*    */ window_set_fullscreen(window, true); /*    */ window_stack_push(window, true); /*   */ srand(time(NULL)); /*       */ window_set_click_config_provider(window, WindowsClickConfigProvider); /*  ,        */ config_text_layer(0, 20, 144, 168, FONT_KEY_GOTHIC_24); /*        */ text_layer_set_text(text_layer, "Sex Roulette \n    ,      --&gt;"); /*     */ image_layer = bitmap_layer_create(GRect(0 , 0, 144, 144)); /*   ,     */ layer_add_child(window_get_root_layer(window), bitmap_layer_get_layer(image_layer)); /*         */ bitmap_layer_set_compositing_mode(image_layer, GCompOpAssignInverted); /*    */ app_event_loop(); /*   */ text_layer_destroy(text_layer); /*   ,   */ window_destroy(window); /*   ,   */ bitmap_layer_destroy(image_layer); /*   ,   */ if (first_time == false) /*      ... */ { gbitmap_destroy(image); /*     ,  ,  -  , ..     */ } }</span></span></span></span></code> </pre> </div></div>   ?!  . <br><br><h4>   <br></h4>     .     <a href="http://ru.wikipedia.org/wiki/%25D0%2598%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BA%25D0%25BE%25D1%2581%25D1%2582%25D1%258C"></a> .     7575    : <br><br>    appinfo.json,       ,      images: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> images[] = {RESOURCE_ID_DICE_1,RESOURCE_ID_DICE_2,RESOURCE_ID_DICE_3,RESOURCE_ID_DICE_4,RESOURCE_ID_DICE_5,RESOURCE_ID_DICE_6,};</code> </pre><br>     : <b>WindowsClickConfigProvider</b>  <b>click</b> .   ,   !   . <br><br>     : <br><pre> <code class="cpp hljs">accel_tap_service_subscribe(accel_int);</code> </pre> <br>  ,      : <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accel_int</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AccelAxisType axis, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> direction)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (first_time == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { text_layer_destroy(text_layer); } timer_call(); }</code> </pre><br>    :         (       ) ‚Äî  .   ‚Äî    :)      . <br><br>    <b>timer_call</b> .     (      ,     ‚Äî 144144,     ),       .      ‚Äî       .        <b>rand</b> .     7575    144168.           , ,       ,       0...69(144-75)  -,  0...93(168-75)  y-.    : <b>rand()%(144-75)</b>  <b>rand()%(168-75)</b> .       : <br><pre> <code class="cpp hljs">image_layer = bitmap_layer_create(GRect(rand()%(<span class="hljs-number"><span class="hljs-number">144</span></span><span class="hljs-number"><span class="hljs-number">-75</span></span>), rand()%(<span class="hljs-number"><span class="hljs-number">168</span></span><span class="hljs-number"><span class="hljs-number">-75</span></span>), <span class="hljs-number"><span class="hljs-number">75</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>));</code> </pre><br><br>     : <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timer_delay &lt; <span class="hljs-number"><span class="hljs-number">300</span></span>*<span class="hljs-number"><span class="hljs-number">1000</span></span> ) { timer_delay=timer_delay/<span class="hljs-number"><span class="hljs-number">0.7</span></span>; app_timer_register(timer_delay/<span class="hljs-number"><span class="hljs-number">1000</span></span>, timer_call, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); }</code> </pre>         100,    ‚Äî 1000.       .     ,        ,    .   ,      ‚Äî     ,    ,       ‚Äî   ,     . <br><br>    ,     .    :      ,   .      . ,    <a href="https://developer.getpebble.com/2/api-reference/group___light.html">API</a>  : <br><pre> <code class="cpp hljs">light_enable(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> enable) light_enable_interaction()</code> </pre><br>  Not much.   .        : l <b>ight_enable(true)</b>  <b>light_enable(false)</b> ,   ‚Äî  ,       (    ).        (   ,       ?),   .   -   <b>timer_call</b> . <br>   ‚Äî  <b>main</b>     : <br><pre> <code class="cpp hljs">text_layer_set_text(text_layer, <span class="hljs-string"><span class="hljs-string">"    "</span></span>);</code> </pre><br>              : <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (first_time == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { text_layer_destroy(text_layer); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { bitmap_layer_destroy(image_layer); gbitmap_destroy(image); } accel_tap_service_unsubscribe();</code> </pre>     .      ‚Äî   ,       .       ‚Äî  ,    ‚Äî          ,      ‚Äî         <b>accel_int</b> <br><br><div class="spoiler"> <b class="spoiler_title">     </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"pebble.h"</span></span></span><span class="hljs-meta"> float timer_delay=1; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*        */</span></span></span><span class="hljs-meta"> Window *window; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> TextLayer *text_layer; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*      */</span></span></span><span class="hljs-meta"> static BitmapLayer *image_layer; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*      */</span></span></span><span class="hljs-meta"> static GBitmap *image; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*       */</span></span></span><span class="hljs-meta"> bool first_time=true; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> static const uint32_t images[] = {RESOURCE_ID_DICE_1,RESOURCE_ID_DICE_2,RESOURCE_ID_DICE_3,RESOURCE_ID_DICE_4,RESOURCE_ID_DICE_5,RESOURCE_ID_DICE_6,}; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*      */</span></span></span><span class="hljs-meta"> void timer_call() </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*            */</span></span></span><span class="hljs-meta"> { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (first_time == false)</span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*      ... */</span></span></span><span class="hljs-meta"> { bitmap_layer_destroy(image_layer); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ...   ,     ... */</span></span></span><span class="hljs-meta"> gbitmap_destroy(image); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ...      */</span></span></span><span class="hljs-meta"> } first_time = false; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> image_layer = bitmap_layer_create(GRect(rand()%(144-75), rand()%(168-75), 75, 75)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     ,     */</span></span></span><span class="hljs-meta"> layer_add_child(window_get_root_layer(window), bitmap_layer_get_layer(image_layer)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> image = gbitmap_create_with_resource(images[rand() % 6]); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*         */</span></span></span><span class="hljs-meta"> bitmap_layer_set_bitmap(image_layer, image); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*      */</span></span></span><span class="hljs-meta"> light_enable_interaction(); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (timer_delay &lt; 300*1000 ) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*      300... */</span></span></span><span class="hljs-meta"> { timer_delay=timer_delay/0.7; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ... ... */</span></span></span><span class="hljs-meta"> app_timer_register(timer_delay/1000, timer_call, NULL); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ...    */</span></span></span><span class="hljs-meta"> } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     300... */</span></span></span><span class="hljs-meta"> { timer_delay=1; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*       -        */</span></span></span><span class="hljs-meta"> } } void accel_int(AccelAxisType axis, int32_t direction) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     ... */</span></span></span><span class="hljs-meta"> { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (first_time == true) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    ... */</span></span></span><span class="hljs-meta"> { text_layer_destroy(text_layer); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ...      */</span></span></span><span class="hljs-meta"> } timer_call(); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> } int main(void) { window = window_create(); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> window_set_background_color(window, GColorBlack); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> window_set_fullscreen(window, true); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> window_stack_push(window, true); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> srand(time(NULL)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*       */</span></span></span><span class="hljs-meta"> text_layer = text_layer_create(GRect(0 , 30, 144, 168)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   ,     */</span></span></span><span class="hljs-meta"> text_layer_set_text_color(text_layer, GColorWhite); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> text_layer_set_background_color(text_layer, GColorClear); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> text_layer_set_font(text_layer, fonts_get_system_font(FONT_KEY_GOTHIC_28)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> text_layer_set_text_alignment(text_layer, GTextAlignmentCenter); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> layer_add_child(window_get_root_layer(window), text_layer_get_layer(text_layer)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*         */</span></span></span><span class="hljs-meta"> text_layer_set_text(text_layer, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"    "</span></span></span><span class="hljs-meta">); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> accel_tap_service_subscribe(accel_int); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*      */</span></span></span><span class="hljs-meta"> app_event_loop(); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   */</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (first_time == true) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     ... */</span></span></span><span class="hljs-meta"> { text_layer_destroy(text_layer); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ...      */</span></span></span><span class="hljs-meta"> } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     ... */</span></span></span><span class="hljs-meta"> { bitmap_layer_destroy(image_layer); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ...   ... */</span></span></span><span class="hljs-meta"> gbitmap_destroy(image); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ...     ,       accel_int */</span></span></span><span class="hljs-meta"> } accel_tap_service_unsubscribe(); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     */</span></span></span><span class="hljs-meta"> window_destroy(window); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   ,   */</span></span></span><span class="hljs-meta"> }</span></span></code> </pre></div></div><br><br>  Works! <br><br><br> ,      : <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/WQGbYTGlFbk%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700191,15700253,15700256&amp;usg=ALkJrhg24ousCXuAo9qeOgA_fF7j2rUhMw" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Links <br></h4><img src="http://1450828301356612492765" alt="image"> <a href="http://www.mypebblefaces.com/apps/12451/7999/">  MagicPebble   mypebblefaces.com</a> <br><img src="http://1450828301356612492765" alt="image"> <a href="http://www.mypebblefaces.com/apps/12451/8000/">  -   mypebblefaces.com</a> <br><img src="http://1450828301356612492765" alt="image"> <a href="http://www.mypebblefaces.com/apps/12451/8001/">      mypebblefaces.com</a> <br><img src="http://1450828301895710915873" alt="image"> <a href="https://github.com/vvzvlad/Pebble-MagicPebble">  MagicPebble  github.com</a> <br><img src="http://1450828301895710915873" alt="image"> <a href="https://github.com/vvzvlad/Pebble-SexRoulette">  -  github.com</a> <br><img src="http://1450828301895710915873" alt="image"> <a href="https://github.com/vvzvlad/Pebble-Dice">     github.com</a> <br><img src="http://boxoverview.com/icon/sites/madrobots.png" alt="image"> <a href="http://madrobots.ru/catalog/23/53/">,     Pebble</a> ,    .            (   ¬´ pebble  ¬ª).       ,   ‚Äî     . <br><br> <a href="https://twitter.com/MadrobotsRu"><img src="//habrastorage.org/files/ac1/fc6/d2a/ac1fc6d2a19948c59791b0da6ab659df.gif"></a> <a href="http://vk.com/madrobots"><img src="//habrastorage.org/files/933/ac3/0b6/933ac30b6fd24ffd82218148c2fb0917.gif"></a> <a href="http://instagram.com/madrobotsru"><img src="//habrastorage.org/files/464/a82/e04/464a82e045a34bae81406fd0b640cf08.gif"></a> <a href="http://facebook.com/madrobotsrussia"><img src="//habrastorage.org/files/0b5/542/136/0b55421365064901acdf0ed58cc4a111.gif"></a> <br> <a href="http://madrobots.ru/"><img src="//habrastorage.org/files/63d/405/78e/63d40578ecbf48f28c62f57705c73eb6.gif"></a> </div><p>Source: <a href="https://habr.com/ru/post/204514/">https://habr.com/ru/post/204514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../204504/index.html">From version database migration to database change management</a></li>
<li><a href="../204506/index.html">kidomi: building DOM objects on the fly</a></li>
<li><a href="../204508/index.html">Optimal DDoS protection with netstat and iptables</a></li>
<li><a href="../204510/index.html">How we did the API for the social network (REST API for WEB)</a></li>
<li><a href="../204512/index.html">Introduction to Windows 8.1 Upgrade</a></li>
<li><a href="../204518/index.html">Win NPE hell in Java without using IntelliJ IDEA</a></li>
<li><a href="../204520/index.html">Acquaintance and date: ratings and reviews of users and users. (Comic ideas continue to be embodied on smartphones.)</a></li>
<li><a href="../204522/index.html">Percona service for creating optimal configuration of MySQL servers and analyzing SQL queries</a></li>
<li><a href="../204524/index.html">Enhance development convenience and efficiency with Alfred (OSX)</a></li>
<li><a href="../204526/index.html">Sending python packages to ppa without ‚Äúlife pain‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>