<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing the function of saving pictures to the SD card</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the process of writing an application for android, I had the task to save an arbitrary image to a file on a flash drive. In this article I will des...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing the function of saving pictures to the SD card</h1><div class="post__text post__text-html js-mediator-article">  In the process of writing an application for android, I had the task to save an arbitrary image to a file on a flash drive.  In this article I will describe how I solved this problem, what difficulties I encountered in the process, and how they were solved.  I would like to separately note that I am a .NET programmer, fate brought me to the Java world only because of the need to create small in size (therefore the monodroid is not immediately) and quite simple in terms of the interface of android applications.  This means that I also just learn, and therefore I will be happy with any advice and comments from professionals. <br><br><a name="habracut"></a><br>  So, suppose that we have an ImageView, which contains the image we need as a file.  The first question is where to save this picture? <br><br>  The most correct and approved approach by Google will save the image to a cache folder dedicated to your application. <br>  You can get the absolute path to it by calling the function: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="java hljs">context.getCacheDir();</code> </pre> <br><br>  This folder is cleared when the application is uninstalled, besides its size is monitored by the system, and if there is not enough space in the internal memory, the files from there will be automatically deleted by the android. <br><br>  There is a solution and disadvantages.  The most important - the application cache folder is contained in the internal memory of the device, which is always lacking.  It is recommended to save only temporary and not very large files there, saving a large number of heavy images is undesirable here. <br><br>  It is better to use the application cache folder on the SD card, the path to which can be obtained by the function: <br><br><pre> <code class="java hljs">context.getExternalCacheDir();</code> </pre><br><br>  This folder will also be cleared when the application is uninstalled, but its size is not monitored by the system, so before saving files there, it is advisable to check its status with the command: <br><br><pre> <code class="java hljs">Environment.getExternalStorageState();</code> </pre><br><br>  In my case, due to a combination of different factors, both standard solutions seemed to be suboptimal, so I just save the files in the root of the SD card, the path there can be obtained by the function: <br><br><pre> <code class="java hljs">Environment.getExternalStorageDirectory();</code> </pre><br><br>  Now about the saving procedure itself, its code is given below. <br><br><pre> <code class="java hljs">ImageView iv; <span class="hljs-comment"><span class="hljs-comment">// ImageView,  ,    String folderToSave = Environment.getExternalStorageDirectory().toString(); //   ,    -  SD- private String SavePicture(ImageView iv, String folderToSave) { OutputStream fOut = null; Time time = new Time(); time.setToNow(); try { File file = new File(folderToSave, Integer.toString(time.year) + Integer.toString(time.month) + Integer.toString(time.monthDay) + Integer.toString(time.hour) + Integer.toString(time.minute) + Integer.toString(time.second) +".jpg"); //          fOut = new FileOutputStream(file); Bitmap bitmap = (BitmapDrawable) iv.getDrawable().getBitmap(); bitmap.compress(Bitmap.CompressFormat.JPEG, 85, fOut); //    jpeg-  85% . fOut.flush(); fOut.close(); MediaStore.Images.Media.insertImage(getContentResolver(), file.getAbsolutePath(), file.getName(), file.getName()); //    } catch (Exception e) //        ,  Exception     { return e.getMessage(); } return ""; }</span></span></code> </pre><br><br>  A few explanations on the code. <br><br><pre> <code class="java hljs">File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(folderToSave, Integer.toString(time.year) + Integer.toString(time.month+<span class="hljs-number"><span class="hljs-number">1</span></span>) + Integer.toString(time.monthDay) + Integer.toString(time.hour) + Integer.toString(time.minute) + Integer.toString(time.second) +<span class="hljs-string"><span class="hljs-string">".jpg"</span></span>);</code> </pre><br><br>  Not very elegant, but simple as a pencil and really working solution to get a unique name for a file in a convenient sorting format - ‚Äú2011 11 17 20 31 49.jpg‚Äù <br>  There is only one little trick.  Notice <i>time.month + 1</i> ? <br>  The fact is that Java considers the months from scratch, and November is 10m, not 11m, as everyone is used to, the month.  Disorder. <br><br><pre> <code class="java hljs">bitmap.compress(Bitmap.CompressFormat.JPEG, <span class="hljs-number"><span class="hljs-number">85</span></span>, fOut);</code> </pre><br><br>  Here, too, everything is self-evident, disputes can arise only about the percentage of compression.  It seems to me that 85% is the best option, but everyone can have their own opinion and their own conditions of the problem. <br><br><pre> <code class="java hljs">MediaStore.Images.Media.insertImage(getContentResolver(), file.getAbsolutePath(), file.getName(), file.getName());</code> </pre><br><br>  An interesting trick, which many people forget.  Not all android users are advanced enough to find the files you have saved, even if you showed them the file system path.  But here about the application "Photo Album" they know exactly everything (this is where you can see photos that you just shot).  Add the above line to your code, and the picture will not only be saved in the correct directory, but also registered in the photo album, and the user will always find it without any problems. <br><br>  By the way, the above function is taken from a real running Random Pictures application, which shows random pictures from the Internet, and in the paid version of the program - it can save any picture to itself on a USB flash drive. <br><br>  Free version of Random Picture Free on the android market <img src="https://habrastorage.org/getpro/habr/post_images/a6e/c50/7ff/a6ec507ff0733641ca440d8f3d942f39.png" height="36" width="36">  <a href="http://market.android.com/details%3Fid%3Dcom.sly2soft.RandomPicturesFree">Random Pictures Free</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db1/01e/a1b/db101ea1ba89e7072ed7552dbaada167.png"><br><br>  The described file saving function works only in the paid version.  Its price is 45 rubles, but for the masters, of course, it is laid out for free.  (A good tradition, I must say!) Link from the author in the comments. </div><p>Source: <a href="https://habr.com/ru/post/132875/">https://habr.com/ru/post/132875/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132868/index.html">FreeSWITCH life example ...</a></li>
<li><a href="../132869/index.html">Depersonalization of the MySQL database. Interesting technique</a></li>
<li><a href="../132870/index.html">Manage dependencies in Android projects using Ivy</a></li>
<li><a href="../132871/index.html">HP: caveat emptor</a></li>
<li><a href="../132874/index.html">Social spam</a></li>
<li><a href="../132876/index.html">HTA Interactive Card</a></li>
<li><a href="../132880/index.html">Worst Passwords 2011</a></li>
<li><a href="../132881/index.html">Public transport routes in Saratov and Engels</a></li>
<li><a href="../132883/index.html">We fill nanoCAD subscriptions with buns - or is it possible to earn money for free?</a></li>
<li><a href="../132884/index.html">How does ConcurrentHashMap</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>