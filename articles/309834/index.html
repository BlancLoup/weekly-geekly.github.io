<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Understanding Go: the encoding package</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Translation of one of Ben Johnson's articles from the "Go Walkthrough" series on a more in-depth study of the standard Go library in the context of re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Understanding Go: the encoding package</h1><div class="post__text post__text-html js-mediator-article"><p>  <em>Translation of one of Ben Johnson's articles from the "Go Walkthrough" series on a more in-depth study of the standard Go library in the context of real-world tasks.</em> </p><br><p>  So far, we have considered working with streams and slices of bytes, but few of the programs just drive the bytes back and forth.  Bytes in themselves do not carry much meaning, but when we encode data structures using these bytes, then we can create really useful applications. </p><br><p>  This post is one of a series of articles on a more in-depth analysis of the standard library.  Despite the fact that standard documentation provides a lot of useful information, in the context of real-world tasks it can be difficult to figure out what to use and when.  This series of articles aims to show the use of standard library packages in the context of real-world applications.  If you have questions or comments, you can always email me on Twitter - <a href="https://twitter.com/benbjohnson">@benbjohnson</a> . </p><a name="habracut"></a><br><h2>  What is encoding? </h2><br><p>  Programming often uses simple words for simple concepts.  Even more than that - often for one concept, there are several muddled words.  <em>Encoding</em> is one of those words.  Sometimes it is called <em>serialization</em> ( <em>marshaling</em> ) - which means the same thing: adding a logical structure to the raw bytes. </p><br><p>  In the standard Go library, we use the terms <em>encoding</em> and <em>marshaling</em> for two different but related ideas.  <em>An encoder</em> in Go is an object that adds a logical structure to a stream of bytes, while <em>marshaling</em> works with a limited set of bytes in memory. </p><br><p>  For example, in the <em>encoding / json</em> package there are <a href="https://golang.org/pkg/encoding/json/">json.Encoder</a> and <a href="https://golang.org/pkg/encoding/json/">json.Decoder</a> for working with <a href="https://golang.org/pkg/io/">io.Writer</a> and <a href="https://golang.org/pkg/io/">io.Reader</a> threads, respectively.  And also in this package we see <a href="https://golang.org/pkg/encoding/json/">json.Marshaler</a> and <a href="https://golang.org/pkg/encoding/json/">json.Unmarshaler</a> for writing and reading bytes from a slice. </p><br><h2>  Two types of coding </h2><br><p>  There is one more important difference in coding.  Some packages for encoding operate on primitives - strings, integers, etc.  Strings are encoded with encodings like ASCII or <a href="https://golang.org/pkg/unicode/">Unicode</a> or <a href="https://godoc.org/golang.org/x/text">any other encodings</a> .  Integers can be encoded differently, depending on <a href="https://en.wikipedia.org/wiki/Endianness">endianness</a> or using integer coding with an arbitrary length.  Even the bytes themselves can often be encoded using schemes like <a href="https://golang.org/pkg/encoding/base64/">Base64</a> to turn them into printable characters. </p><br><p>  But more often, when we talk about coding, we think about coding objects.  This means turning complex structures in memory such as <em>structures, maps, and slices</em> into a set of bytes.  In this transformation, we have to deal with a lot of compromises and over many years, people have come up with <a href="https://en.wikipedia.org/wiki/Comparison_of_data_serialization_formats">many different ways of encoding</a> . </p><br><h2>  Making tradeoffs </h2><br><p>  Converting a logical structure to bytes may initially seem like a simple task - these structures are already in memory in the form of bytes.  Why not just use it? </p><br><p>  There are many reasons why the byte format in memory is not suitable for saving to disk or sending to the network.  First, compatibility.  The format of placing bytes in the memory of Go objects does not match the format of objects in Java, so it will be impossible for two systems written in different languages ‚Äã‚Äãto understand each other.  Also, sometimes we need compatibility not only with a different programming language, but also with a person.  <a href="https://en.wikipedia.org/wiki/Comma-separated_values">CSV</a> , <a href="http://www.json.org/">JSON</a> and <a href="https://en.wikipedia.org/wiki/XML">XML</a> are all examples of human readable formats that can be easily viewed and modified manually. </p><br><p>  However, the addition of human readability to the format puts us before a compromise.  Formats that are easy to read by humans are harder and longer to read by computer.  Integers are a good example.  People read numbers in decimal form, while the computer operates on numbers in binary form.  People also read numbers of various lengths, like 1 or 1000, while computers work with fixed-size numbers ‚Äî 32 or 64 bits.  The difference in performance may seem insignificant, but it will quickly become noticeable when parsing millions or millions of numbers. </p><br><p>  There is also a compromise that we usually do not think about at first.  Our data structures may change over time, but we must be able to work with data encoded many years ago.  Some encodings, such as <a href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a> , allow you to describe a scheme for your data and add a version to the fields ‚Äî old fields can be declared obsolete and new ones added.  The downside is that you need to know the definition of the circuit along with the data in order to be able to encode or decode the data.  Go's <a href="https://golang.org/pkg/encoding/gob/">own gob</a> format uses a different approach and saves the data schema right during encoding.  But here the disadvantage is that the size of the encoded data becomes quite large. </p><br><p>  Some formats generally bypass this moment and go without a scheme.  <a href="http://www.json.org/">JSON</a> and <a href="http://msgpack.org/index.html">MessagePack</a> allow you to encode structures on the fly, but do not provide any guarantees for safe decoding from older versions. </p><br><p>  We also use systems that do coding for us, but which we don‚Äôt think of as encoders.  For example, databases are also one of the ways to take our logical structures and save them as a set of bytes on the disk.  Most likely there will be a lot of things - network calls, SQL parsing, query scheduling, but, in fact, this is coding bytes. </p><br><p>  In the end, if speed is the most important thing to you, you can use the internal format of Go memory and save the data as is.  I even wrote a library for this called <a href="https://github.com/boltdb/raw">raw</a> .  The encoding and decoding time here is literally 0 seconds.  But it is better not to use it in production. </p><br><h2>  4 interfaces in encoding </h2><br><p>  If you are one of the few people who have looked into the <a href="https://golang.org/pkg/encoding/">encoding</a> package, you may be a little disappointed.  This is the second smallest package after <a href="https://golang.org/pkg/errors/">errors</a> and it contains only 4 interfaces. </p><br><p>  The first two are the interfaces <a href="https://golang.org/pkg/encoding/">BinaryMarshaler</a> and <a href="https://golang.org/pkg/encoding/">BinaryUnmarshaler</a> . </p><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> BinaryMarshaler <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { MarshalBinary() (data []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>, err error) } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> BinaryUnmarshaler <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { UnmarshalBinary(data []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) error }</code> </pre> <br><p>  They are intended for objects that provide a way to convert to and from a binary format.  These interfaces are used in several places in the standard library, for example, <a href="https://golang.org/pkg/time/">time.Time.MarshalBinary ()</a> .  You will not find them in many places, because there is usually no single way to convert data into binary form.  As we have seen, there are a huge number of different serialization formats. </p><br><p>  But at the application level, you will most likely choose one format for encoding.  For example, you can select Protocol Buffers for all data.  There is usually no point in supporting multiple binary formats in an application at once, so the <a href="https://golang.org/pkg/encoding/">BinaryMarshaler</a> implementation may make sense. </p><br><p>  The following two interfaces are <a href="https://golang.org/pkg/encoding/">TextMarshaler</a> and <a href="https://golang.org/pkg/encoding/">TextUnmarshaler</a> : </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> TextMarshaler <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { MarshalText() (text []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>, err error) } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> TextUnmarshaler <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { UnmarshalText(text []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) error }</code> </pre> <br><p>  These two interfaces are very similar to the previous ones, but they work with data in UTF-8 format. </p><br><p>  Some formats define their own marshaling interfaces, for example <a href="https://golang.org/pkg/encoding/json/">json.Marshaler</a> , and they follow the same name logic. </p><br><h2>  Encoding package overview </h2><br><p>  The standard library has many useful packages for encoding data.  We will look at them in more detail in the following articles, but here I would like to make a brief overview.  Some of the packages are in encoding /, and some are in other places. </p><br><h3>  Basic type encodings </h3><br><p>  Most likely, the first package you used when you first met Go was the <a href="https://golang.org/pkg/fmt/">fmt</a> package (pronounced "fumpt").  It uses the C-style <a href="http://pubs.opengroup.org/onlinepubs/009695399/functions/fprintf.html">printf ()</a> format to encode and decode numbers, strings, bytes, and even has the basic coding capabilities of objects.  The <a href="https://golang.org/pkg/fmt/">fmt</a> package is a great and easy way to create human-readable strings based on templates, but template parsing may not be very fast. </p><br><p>  If you need better performance, you can get away from printf templates and use the <a href="https://golang.org/pkg/strconv/">strconv</a> package.  This is a low-level package for basic formatting and scanning strings, integers and fractional numbers, logical values, and in general it is quite fast. </p><br><p>  These packages, like Go himself, imply that you work with strings in UTF-8.  The almost complete lack of support for non-Unicode encodings in the standard library is most likely due to the fact that the Internet in recent years has very quickly agreed that everything should be in UTF-8, and possibly also because <a href="https://en.wikipedia.org/wiki/Rob_Pike">Rob Pike</a> has invented Go, and UTF-8, who knows.  I was probably lucky and did not have to deal with non-UTF-8 encodings in Go, but, however, there are such packages as <a href="https://golang.org/pkg/unicode/utf16/">unicode / utf16</a> , <a href="https://golang.org/pkg/encoding/ascii85/">encoding / ascii85</a> and the whole <a href="https://godoc.org/golang.org/x/text">golang.org/x/text</a> branch.  This thread contains a large number of excellent packages that are part of the Go project, but do not fall under the <a href="https://golang.org/doc/go1compat">guarantees of Go 1 backward compatibility</a> . </p><br><p>  For encoding numbers, the encoding / binary package provides big endian and little endian encoding, as well as encoding numbers of variable length.  Endianness - means the order in which the bytes go one by one.  For example, the uint16 representation of the number 1000 (0x03e8 in hexadecimal form) consists of two bytes - 03 and e8.  In the big endian form, these bytes are written in this order - "03 e8".  In little endian, the reverse order is "e8 03".  Many popular CPU architectures are little endian.  But big endian is usually used to send data over the network.  He even called that - network byte order. </p><br><p>  In conclusion, there are a couple of packets for directly encoding the bytes themselves.  Typically, byte encoding is used to translate them into a printable format.  For example, the encoding / hex packet is used to represent data in hexadecimal form.  I personally used it only for debugging purposes.  On the other hand, sometimes you need printable characters because you want to send data through protocols in which, for historical reasons, there is limited support for binary data (email, for example).  The encoding / base32 and encoding / base64 packages are good examples.  Another example is the encoding / pem package, which is used to encode TLS certificates. </p><br><h2>  Object coding </h2><br><p>  For encoding objects in the standard library, there are slightly fewer packages.  But, in practice, these packages are more than enough. </p><br><p>  If you haven‚Äôt spent the last 10 years in a tank, you‚Äôve probably noticed that <a href="http://www.json.org/">JSON has</a> become the format for encoding objects by default.  As mentioned earlier, JSON has its drawbacks, but it is very easy to use and its implementation is available in almost all languages, therefore, it is very popular.  The <a href="https://golang.org/pkg/encoding/json/">encoding / json</a> package provides excellent support for this format, and also Go has third-party, faster, parser implementations, such as <a href="https://github.com/pquerna/ffjson">ffjson</a> . </p><br><p>  And although JSON has become the dominant exchange protocol between machines, the CSV format is still popular for exporting data to people.  The <a href="https://golang.org/pkg/encoding/csv/">encoding / csv</a> package provides a good interface for working with tabular data in this format. </p><br><p>  If you work with systems written around the 2000s, you will probably need to work with <a href="https://en.wikipedia.org/wiki/XML">XML</a> .  The <a href="https://golang.org/pkg/encoding/xml/">encoding / xml</a> package provides an interface in the <a href="https://en.wikipedia.org/wiki/Simple_API_for_XML">SAX</a> style for additional tag-based encoding / decoding, similar to a similar package for <a href="https://golang.org/pkg/encoding/json/">json</a> .  If you need more complex manipulations and things like DOM, XPath, XSD and XSLT, then you probably need to use <a href="http://xmlsoft.org/">libxml2</a> via cgo. </p><br><p>  Go also has its own streaming encoding format, <a href="https://golang.org/pkg/encoding/gob/">gob</a> .  This package is used in <a href="https://golang.org/pkg/net/rpc/">net / rpc</a> to implement remote procedure calls between Go services.  Gob is easy to use, but it is not supported in other languages.  <a href="http://www.grpc.io/">gRPC</a> looks like a more popular alternative if you need a cross-language tool. </p><br><p>  Finally, there is the <a href="https://golang.org/pkg/encoding/asn1/">encoding / asn1 package</a> .  Documentation on it is modest and the only link leads to a 25 page wall of the text - an <a href="http://luca.ntop.org/Teaching/Appunti/asn1.html">introduction for newcomers to ASN.1</a> .  ASN.1 is a complex encryption scheme that is used mainly by X.509 SSL / TLS certificates. </p><br><h1>  Conclusion </h1><br><p>  Encoding provides the foundation for giving a logical structure to raw bytes.  Without it, we would have no lines, no data structure, no databases, or at least some useful applications.  What seems like a simple concept actually has a rich history of implementations and a huge set of trade-offs. </p><br><p>  In this article, we examined various implementations of the encodings implemented in the standard library and some of their trade-offs.  We saw how these packages for working with base types and objects are built on our understanding of working with bytes and byte streams in Go.  In the following articles, we will look deeper into these packages and see how to use them in the context of real-world applications. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/309834/">https://habr.com/ru/post/309834/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309822/index.html">Demand analysis: by what criteria do virtual servers select</a></li>
<li><a href="../309826/index.html">NIO: between Scylla and Charybdis?</a></li>
<li><a href="../309828/index.html">17% of the websites of Ukrainian schools are hosted in Germany, and 20% in Russia</a></li>
<li><a href="../309830/index.html">JetBrains Night in Moscow on September 29</a></li>
<li><a href="../309832/index.html">Blue-green warm</a></li>
<li><a href="../309836/index.html">Setting and using speed limit for Open vSwitch with DPDK</a></li>
<li><a href="../309840/index.html">Android Dev: continued podcasts about professional development for Android</a></li>
<li><a href="../309842/index.html">Exit "in the field": How we made a mobile application to increase the efficiency of field workers</a></li>
<li><a href="../309844/index.html">How to render the frame of the new Doom</a></li>
<li><a href="../309846/index.html">Using blocks in iOS. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>