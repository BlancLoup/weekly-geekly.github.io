<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Telegram-bot as a gift</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! Today I want to talk about how to write Telegram-bot, but not simple, but gift. I ask for those who find this story funny, as well as those ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Telegram-bot as a gift</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  Today I want to talk about how to write Telegram-bot, but not simple, but gift.  I ask for those who find this story funny, as well as those who are trying to write their Telegram bots in Java.  Perhaps my little experience will be somewhat useful. <br><a name="habracut"></a><br><h3>  Brief background </h3><br>  I work as a programmer for a little more than six years, I write mostly in Java and 1C, I don‚Äôt grab stars from the sky, but I perform the tasks I‚Äôve set. <br><br>  In the spring of 2017, I was interested in creating bots for various instant messengers.  At first it seemed like a good idea to create a bot in Viber.  In Siberia, it is the most popular, almost all acquaintances are sitting in it, corporate chats are also conducted in it.  Also inspired by <a href="https://habrahabr.ru/post/321246/">this article</a> .  However, the creation of a public account was not such a simple task - all requests received terse refusals. <br><br>  Having suffered from Vayber for about a week, I noticed Telegram, it turned out that registering a bot there is very easy, and the life of a Java programmer is facilitated by the presence of the <a href="https://github.com/rubenlagus/TelegramBots">TelegramBots</a> library.  As a first attempt at writing, a bot was written that allows you to receive some reports from corporate systems, then there was a bot with reference information, and in the fall I already tried to make a bot for pre-recording to a beauty salon.  All these were interesting crafts that were liked by others, and even the first two bots were actually used in their work.  Due to this, thoughts constantly rotated in my head about how else one can apply bots in everyday life and the national economy. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Now it is necessary to make a digression to talk about who the gift was made for (those who are interested only in technical details can easily skip).</b> <div class="spoiler_text">  When I work as a programmer on 1C, I have a lot to communicate and work together with a very nice colleague, a colleague, besides being pretty, is also smart, and sometimes (when the mood is good), he goes deep enough into development issues (and, if he wishes, he can program anything) and generally has a systemic mindset.  A system of thinking - the crown of female attractiveness, who would argue.  So, with such an attractive colleague, we often discuss all sorts of whistlers for 1C (we discuss it on my head, as they later fall into the next requirements for the system being developed), various new technologies and near-topic topics.  By the way, my first bot, I showed it to this colleague and then received a good feedback and impetus to the study of the topic. <br><br>  It should be noted here that a colleague had a birthday planned at the very beginning of December, and of course it was impossible not to congratulate her.  It is quite obvious that colleagues with systems thinking as gifts can count not only on sweets, flowers and other nishtyaki, but also on something that pretends to wit.  So in 2016, as a gift, the main page of the system that we do together was registered as a gift, and on the day of birth instead of the standard screensaver, a colleague met with greetings.  It seems to be a trifle, but in our organization no one was so congratulated and the gift, as they say, went in, and so went in that the colleague considered this congratulation the best that day (I hope it was so).  After such achievements, it was clear that in 2017 it was necessary to develop the theme and again supplement the standard congratulatory set with something IT.  In my head there were vague thoughts that ‚Äúsomething IT-related‚Äù could be connected with bots, but there was no clear idea, and I almost resigned myself to the idea that nothing original could be invented.  Time passed, until the day of birth remained 5 days ... <br><br>  I was returning home from work, the traffic jam was sluggish, and I could go deep into my thoughts: development plans, technical solutions, automation with the help of bots, anticipation of Friday beer, in general, standard porridge.  Suddenly, the thought flashed through my head that a colleague still needed to be given a bot, even if it was quite unpretentious, for example, issuing various memorable photos for a colleague.  The thought seemed completely stale, but I began to figure out which photos could be used.  At the same time there was a lot of photos, but the circumstances in which they were made were remembered with difficulty.  It was then that the idea of ‚Äã‚Äãa gift bot appeared: a comic quiz in which each question would be accompanied by photos of a colleague and several answers, while the bot would give some funny comment to each answer.  On the one hand, I considered this idea quite original, and on the other, feasible in the time remaining before the birthday. <br></div></div><br><h3>  Preparation and creation of a database of questions </h3><br>  There were only 4 days left to complete all the work, or more precisely, 4 pm, and even then incomplete.  At hand, there were the sources of three other bots that can be used as ‚Äúspare parts‚Äù, and it was clear that there was a fascinating rally on a bicycle with crutches ahead. <br>  Java was chosen as the programming language, TelegramBots was used as a library for working with the Telegram API, and the <a href="http://www.h2database.com/html/main.html">H2</a> database was used to store the database of questions. <br><br>  The first task was to create a database of questions.  For this, we had to do a lot of work on collecting photos from the phone, work and home computers and social networks.  The photographs were structured in such a way that it turned out 26 questions, each of which included from 2 to 4 photos and 4 possible answers.  At the same time, deliberately correct answers were not provided for, and the answer to each question was simply accompanied by a comment.  I also wanted to save the history of the selected answer options, but at the last moment I just forgot to fasten this feature. <br><br>  The layout of the photos and the invention of the questions turned out to be a very laborious process, and they spent one and a half evening. <br><br>  Next was implemented the database storing the questions.  Below are descriptions of the database tables and the DDL script. <br><br><ul><li> <code>CLS_QUEST</code> - a table containing the texts of the questions </li><li>  <code>CLS_QUEST_PHOTO</code> - a table containing relative paths to photos that are associated with the question being asked;  the photos themselves are in the file system in folders corresponding to the issue. </li><li>  <code>CLS_ANSWER</code> - a table containing answers to a question, as well as comments for each answer. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SCHEMA</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> QUE; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SCHEMA</span></span> QUE; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> QUE.CLS_QUEST( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, IS_DELETED <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, QUEST_TEXT <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> QUE.CLS_QUEST_PHOTO( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, ID_QUEST <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, IS_DELETED <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, REL_FILE_PATH <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, PHOTO_TEXT <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(ID_QUEST) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> CLS_QUEST(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> QUE.CLS_ANSWER( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, ID_QUEST <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, IS_DELETED <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, ANSWER_TEXT <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, ANSWER_COMMENT <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(ID_QUEST) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> CLS_QUEST(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) );</code> </pre> <br></div></div><br>  After creation, the database was filled with data manually, the benefit of Netbeans, which I use as a development environment, is a fairly convenient SQL script editor. <br><br>  After two days the base of questions and photos was ready, there was very little time left, it was time to move on to creating the bot itself. <br><br><h3>  Bot frame </h3><br>  Let me remind you that in order to create a bot in Telegram, you need to write @BotFather, using the / newbot command to enter the display name and user name for the bot.  After completing these steps, a token will be received to access the Telegram API.  It looks like this. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/91/ot/xr/91otxrvq4l_i7o9ew7qkwislb28.png"></div><br>  For beauty, add a profile photo using / setuserpic. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/up/gg/ej/upggej05ebnnswwb8cfs3syp2xq.png"></div><br>  Now let's move on to creating the bot itself using TelegramBots.  Let me remind you that Telegram allows you to create bots working with Webhooks and LongPolling bots.  The second option was chosen.  To create a LongPolling bot, you must implement your own class that inherits the <code>org.telegram.telegrambots.bots.TelegramLongPollingBot</code> class. <br><br><div class="spoiler">  <b class="spoiler_title">Class source code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bot</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TelegramLongPollingBot</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String TOKEN = <span class="hljs-string"><span class="hljs-string">"TOKEN"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String USERNAME = <span class="hljs-string"><span class="hljs-string">"USERNAME"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Bot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Bot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DefaultBotOptions options)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(options); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBotToken</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TOKEN; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBotUsername</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> USERNAME; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUpdateReceived</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Update update)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (update.hasMessage() &amp;&amp; update.getMessage().hasText()) { processCommand(update); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (update.hasCallbackQuery()) { processCallbackQuery(update); } } }</code> </pre> <br></div></div><br>  <code>TOKEN</code> - a token for access to the Telegram API, obtained at the stage of bot registration. <br>  <code>USERNAME</code> is the bot name obtained at the bot registration stage. <br>  The <code>onUpdateReceived</code> method <code>onUpdateReceived</code> called when the bot <code>onUpdateReceived</code> <a href="https://core.telegram.org/bots/api">‚Äúinbound updates‚Äù</a> .  In our bot, we are interested in processing text commands (to be honest, only the / start commands) and processing <a href="https://core.telegram.org/bots/api">callbacks (callbacks)</a> that occur when you click on the <a href="https://core.telegram.org/bots/api">buttons of the</a> <a href="https://core.telegram.org/bots/api">inline keyboard</a> (located in the message area). <br><br>  The bot checks whether the incoming update is a text message <code>update.hasMessage() &amp;&amp; update.getMessage().hasText()</code> or the callback <code>update.hasCallbackQuery()</code> , and then calls the appropriate methods for processing.  We will talk about the contents of these methods a little later. <br><br>  The created bot is a regular console application and its launch is as follows: <br><br><div class="spoiler">  <b class="spoiler_title">Source code of main class</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ ApiContextInitializer.init(); TelegramBotsApi botsApi = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TelegramBotsApi(); Runnable r = () -&gt; { Bot bot = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; HttpHost proxy = AppEnv.getContext().getProxy(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (proxy == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { bot = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bot(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { DefaultBotOptions instance = ApiContext .getInstance(DefaultBotOptions.class); RequestConfig rc = RequestConfig.custom() .setProxy(proxy).build(); instance.setRequestConfig(rc); bot = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bot(instance); } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { botsApi.registerBot(bot); AppEnv.getContext().getMenuManager().setBot(bot); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (TelegramApiRequestException ex) { Logger.getLogger(Main.class.getName()) .log(Level.SEVERE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, ex); } }; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(r).start() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Thread.sleep(<span class="hljs-number"><span class="hljs-number">80000L</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InterruptedException ex) { Logger.getLogger(Main.class.getName()) .log(Level.SEVERE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, ex); } } } }</code> </pre></div></div><br>  There is nothing difficult in the bot initialization, but I want to note that it is important to provide an opportunity to specify the bot proxy.  In our case, the proxy settings are stored in the usual properties file, from which they are read when the program starts.  Also note that the application uses its own bad bike in the form of some semblance of the global context <code>AppEnv.getContext()</code> .  At the time of writing this bot, there was no time to correct it, but in the new ‚Äúcrafts‚Äù it was possible to get rid of this bike and use Google Guice instead. <br><br><h3>  Welcome message </h3><br>  Bot operation naturally begins with processing the / start command.  As it was written above, this command is processed by the <code>processCommand</code> method. <br>  At the beginning of the method we will declare smiles that will be used in the text of the greeting message. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String smiling_face_with_heart_eyes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(Character.toChars(<span class="hljs-number"><span class="hljs-number">0x1F60D</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String winking_face = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(Character.toChars(<span class="hljs-number"><span class="hljs-number">0x1F609</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String bouquet = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(Character.toChars(<span class="hljs-number"><span class="hljs-number">0x1F490</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String party_popper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(Character.toChars(<span class="hljs-number"><span class="hljs-number">0x1F389</span></span>));</code> </pre> <br>  Next, it checks the entered command and if it is a / start command, then a response <code>answerMessage</code> .  The message is set to the text <code>setText()</code> , it turns on support for some <code>setParseMode("HTML")</code> <a href="https://core.telegram.org/bots/api">html tags,</a> and the chat ID is set to which the message will be sent to <code>setChatId(update.getMessage().getChatId())</code> .  It remains only to add the "Start" button.  To do this, create an inline keyboard and add it to the answer: <br><br><pre> <code class="java hljs">SendMessage answerMessage = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; String text = update.getMessage().getText(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"/start"</span></span>.equalsIgnoreCase(text)) { answerMessage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendMessage(); answerMessage.setText(<span class="hljs-string"><span class="hljs-string">"&lt;b&gt;!"</span></span> + smiling_face_with_heart_eyes + <span class="hljs-string"><span class="hljs-string">"\n-   !"</span></span> + bouquet + bouquet + bouquet + party_popper + <span class="hljs-string"><span class="hljs-string">"  -,      ?&lt;/b&gt;"</span></span>); answerMessage.setParseMode(<span class="hljs-string"><span class="hljs-string">"HTML"</span></span>); answerMessage.setChatId(update.getMessage().getChatId()); InlineKeyboardMarkup markup = keyboard(update); answerMessage.setReplyMarkup(markup); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">The source code of the keyboard is shown below:</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> InlineKeyboardMarkup </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">keyboard</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Update update)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> InlineKeyboardMarkup markup = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InlineKeyboardMarkup(); List&lt;List&lt;InlineKeyboardButton&gt;&gt; keyboard = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); keyboard.add(Arrays.asList(buttonMain())); markup.setKeyboard(keyboard); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> markup; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> InlineKeyboardButton </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buttonMain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String OPEN_MAIN = <span class="hljs-string"><span class="hljs-string">"OM"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String winking_face = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(Character.toChars(<span class="hljs-number"><span class="hljs-number">0x1F609</span></span>)); InlineKeyboardButton button = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InlineKeyboardButtonBuilder() .setText(<span class="hljs-string"><span class="hljs-string">"!"</span></span> + winking_face) .setCallbackData(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActionBuilder(marshaller) .setName(OPEN_MAIN) .asString()) .build(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> button; }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">InlineKeyboardButtonBuilder</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InlineKeyboardButtonBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> InlineKeyboardButton button; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InlineKeyboardButtonBuilder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.button = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InlineKeyboardButton(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> InlineKeyboardButtonBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String text)</span></span></span></span>{ button.setText(text); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> InlineKeyboardButtonBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCallbackData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String callbackData)</span></span></span></span>{ button.setCallbackData(callbackData); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> InlineKeyboardButton </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> button; } }</code> </pre><br></div></div><br>  An interesting point is the installation of callback data.  This data can be used when processing the pressing of buttons.  In our case, the object serialized into JSON is written to the callback data.  This method is heavyweight for this task, but it allows you to work with the return data without unnecessary problems for the conversion.  Return data is generated in a special ActionBuilder <code>ActionBuilder</code> . <br><br><div class="spoiler">  <b class="spoiler_title">ActionBuilder source code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> String name = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> String id = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> String value = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = value; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> DocumentMarshaller marshaller; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Action action = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Action(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ActionBuilder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DocumentMarshaller marshaller)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>. marshaller = marshaller; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ action.setName(name); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ action.setValue(name); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> marshaller.&lt;Action&gt;marshal(action, <span class="hljs-string"><span class="hljs-string">"Action"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Action </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Action </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Update update)</span></span></span><span class="hljs-function"> </span></span>{ String data = update.getCallbackQuery().getData(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } action = marshaller.&lt;Action&gt;unmarshal(data, <span class="hljs-string"><span class="hljs-string">"Action"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action; } }</code> </pre> <br></div></div><br>  In order for <code>ActionBuilder</code> to return JSON, it needs to pass a marshaller to it.  Hereinafter, when the marshaller variable is mentioned, it is assumed that it is an object of a class that implements the <code>DocumentMarshaller</code> interface. <br><br><div class="spoiler">  <b class="spoiler_title">DocumentMarshaller source code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DocumentMarshaller</span></span></span><span class="hljs-class"> </span></span>{ &lt;T&gt; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">marshal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T document)</span></span></span></span>; &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unmarshal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span></span>; &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unmarshal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str, Class clazz)</span></span></span></span>; }</code> </pre> <br></div></div><br>  Marshalller, which is used in <code>ActionBuilder</code> , is implemented using <a href="https://github.com/FasterXML/jackson">Jackson</a> . <br><br>  Finally, the message is sent: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (answerMessage != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { execute(answerMessage); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (TelegramApiException ex) { Logger.getLogger(Bot.class.getName()) .log(Level.SEVERE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, ex); }</code> </pre> <br>  As a result, the welcome message looks like this. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mw/gf/e5/mwgfe5q0idrcyfi0reouedlv-6s.png"></div><br><h3>  Asking questions </h3><br>  It remained to do the most interesting thing - to implement the logic of the bot. <br>  JPA was used to work with the database of questions.  I will give the code of the entity classes. <br><br><div class="spoiler">  <b class="spoiler_title">Source Code for Entity Classes</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Classifier</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> serialVersionUID = <span class="hljs-number"><span class="hljs-number">1L</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Classifier</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIsDeleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setIsDeleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer isDeleted)</span></span></span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"CLS_ANSWER"</span></span>, catalog = <span class="hljs-string"><span class="hljs-string">"QUEB"</span></span>, schema = <span class="hljs-string"><span class="hljs-string">"QUE"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClsAnswer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Classifier</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> serialVersionUID = <span class="hljs-number"><span class="hljs-number">1L</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.IDENTITY) <span class="hljs-meta"><span class="hljs-meta">@Basic</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"IS_DELETED"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Integer isDeleted; <span class="hljs-meta"><span class="hljs-meta">@Lob</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ANSWER_TEXT"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String answerText; <span class="hljs-meta"><span class="hljs-meta">@Lob</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ANSWER_COMMENT"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String answerComment; <span class="hljs-meta"><span class="hljs-meta">@OneToMany</span></span>(cascade = CascadeType.ALL, mappedBy = <span class="hljs-string"><span class="hljs-string">"idAnswer"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Collection&lt;RegQuestAnswer&gt; regQuestAnswerCollection; <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID_QUEST"</span></span>, referencedColumnName = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ClsQuest idQuest; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClsAnswer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClsAnswer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIsDeleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isDeleted; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setIsDeleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer isDeleted)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isDeleted = isDeleted; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAnswerText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> answerText; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAnswerText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String answerText)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.answerText = answerText; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAnswerComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> answerComment; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAnswerComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String answerComment)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.answerComment = answerComment; } <span class="hljs-meta"><span class="hljs-meta">@XmlTransient</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Collection&lt;RegQuestAnswer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRegQuestAnswerCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> regQuestAnswerCollection; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setRegQuestAnswerCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;RegQuestAnswer&gt; regQuestAnswerCollection)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.regQuestAnswerCollection = regQuestAnswerCollection; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ClsQuest </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdQuest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> idQuest; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setIdQuest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ClsQuest idQuest)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.idQuest = idQuest; } } <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"CLS_QUEST"</span></span>, catalog = <span class="hljs-string"><span class="hljs-string">"QUEB"</span></span>, schema = <span class="hljs-string"><span class="hljs-string">"QUE"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClsQuest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Classifier</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> serialVersionUID = <span class="hljs-number"><span class="hljs-number">1L</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.IDENTITY) <span class="hljs-meta"><span class="hljs-meta">@Basic</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"IS_DELETED"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Integer isDeleted; <span class="hljs-meta"><span class="hljs-meta">@Lob</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"QUEST_TEXT"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String questText; <span class="hljs-meta"><span class="hljs-meta">@OneToMany</span></span>(cascade = CascadeType.ALL, mappedBy = <span class="hljs-string"><span class="hljs-string">"idQuest"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Collection&lt;RegQuestAnswer&gt; regQuestAnswerCollection; <span class="hljs-meta"><span class="hljs-meta">@OneToMany</span></span>(cascade = CascadeType.ALL, mappedBy = <span class="hljs-string"><span class="hljs-string">"idQuest"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Collection&lt;ClsAnswer&gt; clsAnswerCollection; <span class="hljs-meta"><span class="hljs-meta">@OneToMany</span></span>(cascade = CascadeType.ALL, mappedBy = <span class="hljs-string"><span class="hljs-string">"idQuest"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Collection&lt;ClsQuestPhoto&gt; clsQuestPhotoCollection; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClsQuest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClsQuest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIsDeleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isDeleted; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setIsDeleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer isDeleted)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isDeleted = isDeleted; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getQuestText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> questText; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setQuestText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String questText)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.questText = questText; } <span class="hljs-meta"><span class="hljs-meta">@XmlTransient</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Collection&lt;RegQuestAnswer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRegQuestAnswerCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> regQuestAnswerCollection; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setRegQuestAnswerCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;RegQuestAnswer&gt; regQuestAnswerCollection)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.regQuestAnswerCollection = regQuestAnswerCollection; } <span class="hljs-meta"><span class="hljs-meta">@XmlTransient</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Collection&lt;ClsAnswer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getClsAnswerCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> clsAnswerCollection; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setClsAnswerCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;ClsAnswer&gt; clsAnswerCollection)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clsAnswerCollection = clsAnswerCollection; } <span class="hljs-meta"><span class="hljs-meta">@XmlTransient</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Collection&lt;ClsQuestPhoto&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getClsQuestPhotoCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> clsQuestPhotoCollection; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setClsQuestPhotoCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;ClsQuestPhoto&gt; clsQuestPhotoCollection)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clsQuestPhotoCollection = clsQuestPhotoCollection; } } <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"CLS_QUEST_PHOTO"</span></span>, catalog = <span class="hljs-string"><span class="hljs-string">"QUEB"</span></span>, schema = <span class="hljs-string"><span class="hljs-string">"QUE"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClsQuestPhoto</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Classifier</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> serialVersionUID = <span class="hljs-number"><span class="hljs-number">1L</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.IDENTITY) <span class="hljs-meta"><span class="hljs-meta">@Basic</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"IS_DELETED"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Integer isDeleted; <span class="hljs-meta"><span class="hljs-meta">@Lob</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"REL_FILE_PATH"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String relFilePath; <span class="hljs-meta"><span class="hljs-meta">@Lob</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"PHOTO_TEXT"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String photoText; <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID_QUEST"</span></span>, referencedColumnName = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ClsQuest idQuest; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClsQuestPhoto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClsQuestPhoto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIsDeleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isDeleted; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setIsDeleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer isDeleted)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isDeleted = isDeleted; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRelFilePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> relFilePath; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setRelFilePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String relFilePath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.relFilePath = relFilePath; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPhotoText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> photoText; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPhotoText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String photoText)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.photoText = photoText; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ClsQuest </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdQuest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> idQuest; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setIdQuest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ClsQuest idQuest)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.idQuest = idQuest; } }</code> </pre> <br></div></div><br>  Also note that hereinafter, an object that implements the <code>ClassifierRepository</code> interface is used to access data, and when the <code>classifierRepository</code> variable is mentioned, it is implied that it is an object of the class that implements the <code>ClassifierRepository</code> interface <br><br><div class="spoiler">  <b class="spoiler_title">Source Code ClassifierRepository</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassifierRepository</span></span></span><span class="hljs-class"> </span></span>{ &lt;T extends Classifier&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T classifier)</span></span></span></span>; &lt;T extends Classifier&gt; <span class="hljs-function"><span class="hljs-function">List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;T&gt; clazz)</span></span></span></span>; &lt;T extends Classifier&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;T&gt; clazz, Long id)</span></span></span></span>; &lt;T extends Classifier&gt; <span class="hljs-function"><span class="hljs-function">List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;T&gt; clazz, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isDeleted)</span></span></span></span>; &lt;T extends Classifier&gt; <span class="hljs-function"><span class="hljs-function">List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;T&gt; clazz)</span></span></span></span>; &lt;T extends Classifier&gt; <span class="hljs-function"><span class="hljs-function">List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;T&gt; clazz, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isDeleted)</span></span></span></span>; }</code> </pre> <br></div></div><br>  Now let's move on to the moment when the ‚ÄúStart!‚Äù Button is pressed.  At this very moment, the bot processes the next piece of incoming information and calls the previously mentioned method <code>processCallbackQuery()</code> .  At the beginning of the method, the incoming update is processed, and the callback data is also retrieved.  Based on the callback data, it is determined whether the button ‚ÄúStart!‚Äù <code>OPEN_MAIN.equals(action.getName()</code> , or the button to answer another question was pressed. <code>GET_ANSWER.equals(action.getName())</code> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String OPEN_MAIN = <span class="hljs-string"><span class="hljs-string">"OM"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String GET_ANSWER = <span class="hljs-string"><span class="hljs-string">"GA"</span></span>; Action action = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActionBuilder(marshaller).buld(update); String data = update.getCallbackQuery().getData(); Long chatId = update.getCallbackQuery().getMessage().getChatId();</code> </pre><br>  If the quiz has just begun, then you need to initialize the list of questions and ask the first question. <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (OPEN_MAIN.equals(action.getName())) { initQuests(update); sendQuest(update); }</code> </pre> <br>  Now consider initialization of the <code>initQuests()</code> list of questions: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initQuests</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Update update)</span></span></span><span class="hljs-function"> </span></span>{ QuestStateHolder questStateHolder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QuestStateHolder(); List&lt;ClsQuest&gt; q = classifierRepository.find(ClsQuest.class, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); Collections.shuffle(q); questStateHolder.put(update, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QuestEnumeration(q)); }</code> </pre> <br>  In the <code>initQuests</code> method, <code>initQuests</code> first get all 26 questions, and then mix in random order.  After that, we put the questions in <code>QuestEnumeration</code> , from where we will receive them one by one, until all 26 questions are received.  <code>QuestEnumeration</code> we add to the object a special class <code>QuestStateHolder</code> , which stores the correspondence of the user and his current session of questions.  The code for the <code>QuestStateHolder</code> and <code>QuestEnumeration</code> below. <br><br><div class="spoiler">  <b class="spoiler_title">QuestStateHolder and QuestEnumeration Source Code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QuestStateHolder</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Map&lt;Integer, QuestEnumeration&gt; questStates = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> QuestEnumeration </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(User user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> questStates.get(user.getId()) == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : questStates.get(user.getId()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> QuestEnumeration </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Update update)</span></span></span><span class="hljs-function"> </span></span>{ User u = getUserFromUpdate(update); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> get(u); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">put</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Update update, QuestEnumeration questEnumeration)</span></span></span><span class="hljs-function"> </span></span>{ User u = getUserFromUpdate(update); put(u, questEnumeration); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">put</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(User user, QuestEnumeration questEnumeration)</span></span></span><span class="hljs-function"> </span></span>{ questStates.put(user.getId(), questEnumeration); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> User </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserFromUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Update update)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> update.getMessage() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? update.getMessage().getFrom() : update.getCallbackQuery().getFrom(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QuestEnumeration</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enumeration</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClsQuest</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;ClsQuest&gt; quests = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Integer currentQuest = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">QuestEnumeration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;ClsQuest&gt; quests)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.quests.addAll(quests); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasMoreElements</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> currentQuest &lt; quests.size(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ClsQuest </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nextElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ClsQuest q = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasMoreElements()){ q = quests.get(currentQuest); currentQuest++; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> q; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCurrentQuest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> currentQuest; } }</code> </pre><br></div></div><br>  After initialization, the first question is asked.  But let's talk about this a little later.  In the meantime, consider the situation when an answer came to an already asked question and the bot needs to send a comment relating to this answer.  Everything is quite simple here, first we look for the answer in the database (the unique identifier of the answer option is stored in the <code>CallbackData</code> button that was clicked): <br><br><pre> <code class="java hljs">Long answId = Long.parseLong(action.getValue()); ClsAnswer answ = classifierRepository.find(ClsAnswer.class, answId);</code> </pre> <br>  Then we prepare a message based on the answer found and send it: <br><pre> <code class="java hljs">SendMessage comment = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendMessage(); comment.setParseMode(<span class="hljs-string"><span class="hljs-string">"HTML"</span></span>); comment.setText(<span class="hljs-string"><span class="hljs-string">"&lt;b&gt; :&lt;/b&gt; "</span></span> + answ.getAnswerText() + <span class="hljs-string"><span class="hljs-string">"\n&lt;b&gt;  :&lt;/b&gt; "</span></span> + answ.getAnswerComment() + <span class="hljs-string"><span class="hljs-string">"\n"</span></span>); comment.setChatId(chatId); execute(comment);</code> </pre> <br>  Now consider the <code>sendQuest</code> method, which sends the next question.  It all starts with the receipt of the next question: <br><br><pre> <code class="java hljs">QuestEnumeration qe = questStateHolder.get(update); ClsQuest nextQuest = qe.nextElement();</code> </pre> <br>  If the Enumeration still contains elements, then we are preparing a question for sending, otherwise it is time to display a message about the end of the quiz.  We send the question itself: <br><pre> <code class="java hljs">Long chatId = update.getCallbackQuery().getMessage().getChatId(); SendMessage quest = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendMessage(); quest.setParseMode(<span class="hljs-string"><span class="hljs-string">"HTML"</span></span>); quest.setText(<span class="hljs-string"><span class="hljs-string">"&lt;b&gt; "</span></span> + qe.getCurrentQuest() + <span class="hljs-string"><span class="hljs-string">":&lt;/b&gt; "</span></span> + nextQuest.getQuestText()); quest.setChatId(chatId); execute(quest);</code> </pre> <br>  Now send photos related to this issue: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (ClsQuestPhoto clsQuestPhoto : nextQuest.getClsQuestPhotoCollection()) { SendPhoto sendPhoto = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendPhoto(); sendPhoto.setChatId(chatId); sendPhoto.setNewPhoto(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"\\photo"</span></span> + clsQuestPhoto.getRelFilePath())); sendPhoto(sendPhoto); }</code> </pre> <br>  And finally, the answer options: <br><br><pre> <code class="java hljs">SendMessage answers = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendMessage(); answers.setParseMode(<span class="hljs-string"><span class="hljs-string">"HTML"</span></span>); answers.setText(<span class="hljs-string"><span class="hljs-string">"&lt;b&gt; :&lt;/b&gt;"</span></span>); answers.setChatId(chatId); answers.setReplyMarkup(keyboardAnswer(update, nextQuest)); execute(answers);</code> </pre> <br>  Keyboard with answer options is formed as follows <br><br><div class="spoiler">  <b class="spoiler_title">Source</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> InlineKeyboardMarkup </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">keyboardAnswer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Update update, ClsQuest quest)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> InlineKeyboardMarkup markup = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InlineKeyboardMarkup(); List&lt;List&lt;InlineKeyboardButton&gt;&gt; keyboard = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (ClsAnswer clsAnswer : quest.getClsAnswerCollection()) { keyboard.add(Arrays.asList(buttonAnswer(clsAnswer))); } markup.setKeyboard(keyboard); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> markup; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> InlineKeyboardButton </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buttonAnswer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ClsAnswer clsAnswer)</span></span></span><span class="hljs-function"> </span></span>{ InlineKeyboardButton button = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InlineKeyboardButtonBuilder() .setText(clsAnswer.getAnswerText()) .setCallbackData(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActionBuilder(marshaller) .setName(GET_ANSWER) .setValue(clsAnswer.getId().toString()) .asString()) .build(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> button; }</code> </pre> </div></div><br>  The question has been sent.  It will look something like this (the photos are a bit blurred so as not to embarrass anyone). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zi/au/c0/ziauc08snt-hyyvqj-irbohnc8s.png"></div><br>  At that moment, when the questions are over, a message about the end of the quiz will be generated: <br><br><pre> <code class="java hljs">SendMessage answers = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendMessage(); answers.setParseMode(<span class="hljs-string"><span class="hljs-string">"HTML"</span></span>); answers.setText(<span class="hljs-string"><span class="hljs-string">"&lt;b&gt;   !    &lt;/b&gt; \n "</span></span> + <span class="hljs-string"><span class="hljs-string">"      ''   /start"</span></span>); answers.setChatId(chatId); execute(answers);</code> </pre> <br>  And at the very end we will send a funny sticker: <br><br><pre> <code class="java hljs">SendSticker sticker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendSticker(); sticker.setChatId(chatId); File stikerFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"\\photo\\stiker.png"</span></span>); sticker.setNewSticker(stikerFile); sendSticker(sticker);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wt/bh/rd/wtbhrdapjhci9zvcazyk9ckh3ok.png"></div><br>  This completes the bot's work. <br><br>  The work on all the described functionality was completed somewhere at 11 o'clock in the evening of the day preceding day X. I note that with some peculiarities in mind, I understood that the bot must be started at exactly 12 nights.  In this regard, I experienced some time trouble (why I forgot about the history of the answers).  In addition, a colleague needed to somehow inform about this quiz.  For several reasons, I couldn‚Äôt just drop the link, so I trusted the alert to another bot (since during testing, the user ID was saved and the bot was free to write).  At this the story of writing the bot ends. <br><br><h3>  Conclusion </h3><br>  There will be no deep conclusions from this story.  The bot itself was accepted with interest and liked, so I tried for a reason.  If we proceed to the technical part of the question, then the work on the bot allowed us to think about the fact that it is time to get rid of some crutches and bicycles, which I tried to do in the next bot. <br><br>  I also want to note that the idea of ‚Äã‚Äãbots is very promising.  There are many everyday tasks from ordering pizza to calling a taxi, which are proposed to be solved through mobile applications, websites and their mobile versions or phone calls to the operator.  On the one hand, all these methods have proven their effectiveness, are convenient and are unlikely to change in the near future.  On the other hand, applications for mobile devices, although rich in functionality, require installation, updating and studying their interface, and still tend to eat battery.  Sites and their mobile versions require the user to at least switch to the browser and work with the new interface, which is not always convenient, especially on mobile devices.  Telephone interaction is convenient for many, but does not imply any visualization in principle, and besides, the operator will always be a bottleneck of the system.  When solving the same tasks, bots do not require installation of anything other than the messenger, do not require studying new interfaces, and allow the user to work asynchronously (as opposed to a phone call) in a relatively familiar messenger interface.  The messenger in this case provides some kind of environment for client-server interaction, where the bot acts as the server, and the client part is implemented by means of the messenger.  Of course, when working with bots, the user also faces various difficulties, somewhat similar to the difficulties of working with text interfaces, and in some ways due to the limitations of the instant messengers themselves.  But still, bots that are focused on solving small everyday tasks (or on entertainment, like the bot described in this article) seem promising. <br><br>  This is my first post, I would appreciate constructive feedback! <br><br>  <b>UPD:</b> Filled the project on GitHub <a href="https://github.com/altmf/questbot">github.com/altmf/questbot</a> </div><p>Source: <a href="https://habr.com/ru/post/346112/">https://habr.com/ru/post/346112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346098/index.html">Compile a DNS query manually</a></li>
<li><a href="../346102/index.html">Fresh utilities, plugins and productivity tools for the designer. Issue number 4</a></li>
<li><a href="../346106/index.html">Release Rust 1.23</a></li>
<li><a href="../346108/index.html">Weapon system through components in Unreal Engine 4</a></li>
<li><a href="../346110/index.html">How to build a geographic dashboard with real-time data</a></li>
<li><a href="../346114/index.html">Meltdown: not only affects performance</a></li>
<li><a href="../346116/index.html">Restate - or how to turn a Redux log into a tree</a></li>
<li><a href="../346118/index.html">MPS 2017.3 released</a></li>
<li><a href="../346120/index.html">Ok google get me a car</a></li>
<li><a href="../346126/index.html">Tachometer or speedometer: The flow of thoughts about measuring the frequency in the Arduino</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>