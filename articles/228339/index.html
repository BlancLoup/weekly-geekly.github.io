<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configuring ModSecurity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuing Web Application Firewall (ModSecurity) in action 
 1.1 The concept of regular expressions 
 Regular Expression is a mini programming langua...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configuring ModSecurity</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/9a8/e7d/f8a/9a8e7df8a2d96bc7f23c9a98dacaabbe.jpg"><br>  Continuing <a href="http://habrahabr.ru/post/228103/">Web Application Firewall (ModSecurity) in action</a> <br><h4>  1.1 The concept of regular expressions </h4><br><a name="habracut"></a>  Regular Expression is a mini programming language designed to search for pattern matching. <br>  Comment.  Apache 1.x and Apache 2.x use various regular expression tools.  In Apache 2.x, regular expression processing is compatible with Perl.  In Apache 1.x, regular expression processing is compatible with POSIX. <br>  Regular expressions use special characters.  We present a brief semantics of some of them in Table 1.1. <br><br>  Table 1.1 - Semantics of special characters used in regular expressions. <br><img src="https://habrastorage.org/getpro/habr/post_images/5fa/3ca/1a1/5fa3ca1a1ccf42ec56ef87dc2cd6338c.jpg"><br><br><h4>  1.2 Configuration </h4><br><habracut>  Configuration directives ModSecurity are directly added to the configuration file (usually httpd.conf).  If it is not known in advance whether this module is included, the directives should be enclosed in a tag.  This will allow Apache to ignore the configuration directives when the module is not active. <br><img src="https://habrastorage.org/getpro/habr/post_images/7d4/bd5/2cd/7d4bd52cdf69bdade1b851fecb790c8a.jpg"><br>  Since Apache allows configuration data to be located in more than one file, it is possible to group configuration directives into one file (for example, modsecurity.conf) and include it in httpd.conf using the Include directive. <br>  Include conf / modsecurity.conf 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  1.3 Enabling Filtering </h4><br><habracut>  By default, filtering is turned off.  In order for the module to start analyzing requests, you should add the SecRuleEngine On configuration file. <br>  The syntax of this command is shown below. <br>  SecRuleEngine On | Off | DetectionOnly <br>  Possible parameter values: <br>  On - analyze each request; <br>  Off - do nothing; <br>  DetectionOnly - analyze each request, but do not take any active actions (such as blocking the request). <br><br><h4>  1.4 Scanning the contents of the request body </h4><br><habracut>  Scanning the contents of the request body is disabled by default.  To scan the contents of requests, you must specify: <br>  SeqRequestBodyAccess On <br>  Syntax: SeqRequestBodyAccess On | Off <br><br><h4>  1.5 List of default actions </h4><br>  Whenever a request matches a rule, one or more actions are performed.  Each filter can have its own actions, but you can define many default actions for all filters.  If you wish, you can always specify an action for each rule. <br>  For example, logging each rule for which a match is made is configured as follows, and the request is rejected with status code 404: <br>  SecDefaultAction "phase: 2, deny, log, status: 404" <br>  The syntax of this command is: SecDefaultAction. Default values ‚Äã‚Äãare "phase: 2, log, auditlog, pass" <br>  The SecDefaultAction directive has only one parameter ‚Äî a comma-separated list of actions.  Actions will be performed for each filter for which compliance is performed, with the exception of rules that have their own lists of actions. <br>  Comment.  If a non-fatal default list of actions is specified (a list that does not cause a situation in which the request can be rejected, for example, log, pass), then such a list of actions will be ignored during the initialization phase.  The initialization phase is intended to obtain information about the request.  Allowing non-fatal actions will result in some parts of the request being skipped.  Since this information is required for internal processing, such actions cannot be resolved.  If ModSecurity is to be performed in the ‚Äúdetect-only‚Äù mode, it is necessary to disable all implicit validations (validation of the URL representation, validation of the Unicode representation, validation of the cookie format) [1]. <br>  Comment.  Actions on metadata (id, rev, msg, severity) and actions that control the sequence of rules (skip / skipAfter, chain) cannot appear in the SecFilterDefaultAction directive. <br><br><h4>  1.6 Rules </h4><br><habracut>  When filtering is enabled, each incoming request is analyzed before it is sent to its destination.  The analysis begins with a series of built-in checks designed to check the validity of the request format.  These checks can be controlled using configuration directives.  At the second stage, the request passes through a series of user-defined filters, for which the request is checked.  Whenever a match exists, actions defined in the rules are performed. <br>  The development team led by Ivan Ristik focuses on improving the ModSecurity code, leaving the creation of rules to users, so the original configuration file has only a few rules.  There are several subprojects (for example, OWASP ModSecurity Core Rule), the purpose of which is to create and test rules.  To use them, you need to download and connect the required rules file in the ModSecurity configuration file with the Include directive.  Some of the rules require editing, in addition, you should consider the features of rexec and PCRE, so the rules created for Apache 2.x may not work correctly with the first version of the server.  In addition, there are special scripts that transform the rules of intrusion detection systems and security scanners into rules for ModSecurity.  For example, the snort2modsec.pl script, which converts IDS Snort rules into ModSecurity rules and the nessus2modsec.pl script, designed to convert the NASL Nessus / GNessUs security scanner rules.  Basic filtering rules protect the Web server from a wide range of attacks, but they cannot be considered absolute protection for a specific Web application. <br><br><h4>  1.7 Easy filtering </h4><br><habracut>  The simplest form of filtering is as follows: <br>  SecRule SecRule is a directive used to create rules in ModSecurity. <br>  For each simple filter, ModSecurity searches for operators in variables and performs the actions specified in the actions. <br>  Variables locates the search string.  A regular expression, IP address, name, identifiers, including CGI variables can be used here. <br>  Server variables are accessed through keywords, for example, REQUEST_LINE, REQUEST_PROTOCOL, REQUEST_METHOD, etc. <br>  Access to variables from the query is carried out through keywords, for example, QUERY_STRING, as well as to an array of ARGS variables. <br>  The variable parameter can consist of a set of identifiers separated by a vertical bar. <br><br>  The list of variables available for use when writing rules. <br><img src="https://habrastorage.org/getpro/habr/post_images/966/117/fb7/966117fb7131308919605f952c8b73cb.jpg"><br><br>  The names of most of them describe themselves.  (for acquaintance with others refer to the documentation). <br>  For filtering, you can specify the inverse of some variable.  For example: <br>  SecRule ¬´ARGS |  ! ARG_param ¬ªAll arguments will be searched, except for the named parameter. <br>  Operators define the methods and data of the comparison.  By default, if other operators are not defined, the @rx operator is used.  This means that the string following the statement will be interpreted as a regular expression.  This string will be searched in the corresponding variable. <br><br><h4>  1.8 Actions </h4><br><habracut> There are several types of actions. <br>  The primary action decides whether to continue processing the request or not.  There can be only one primary action.  If several primary actions are specified in the parameter, the last action will be executed.  The primary actions are deny, pass and redirect. <br>  Secondary actions will be performed if the request matches the filter, regardless of the decision made by the primary actions.  There may be any number of secondary actions.  For example, exec is one of the secondary actions. <br>  Flow actions can change the sequence of rules, forcing them to switch to another rule or skipping one or more rules.  The flow actions are chain and skipAfter. <br>  Parameters are not actions, but a way of attaching parameters to filters.  Some of these parameters can be used in real actions.  For example, status adds a response code to the primary action deny. <br>  Let us consider in more detail the syntax of actions in table 1.2. <br><br>  Table 1.2 - Actions performed when a query matches <br><img src="https://habrastorage.org/getpro/habr/post_images/f5a/c1a/ffe/f5ac1affe3bc2e184f804f2d5c7bc579.jpg"><br><img src="https://habrastorage.org/getpro/habr/post_images/d7c/7f2/ead/d7c7f2ead573de5c7566e6d180a2a48c.jpg"><br><img src="https://habrastorage.org/getpro/habr/post_images/1c5/4cb/33e/1c54cb33e617fbe27d4f61416cf2a211.jpg"><br><img src="https://habrastorage.org/getpro/habr/post_images/829/afb/9b0/829afb9b00850e016a018734fff0fa6f.jpg"><br><br><h4>  1.9 Phases and Rules Implementation </h4><br><habracut>  It is important to understand on which phase the ModSecurity applies the rules.  This will be convenient for you when creating new rules and will allow you to avoid situations in which actions were unexpectedly blocked or, on the contrary, allowed, while your expectations were opposite. <br>  The operation logic of ModSecurity divides requests into 5 phases: <br>  1. REQUEST_HEADERS (phase 1); <br>  2. REQUEST_BODY (phase 2); <br>  3. RESPONSE_HEADERS (phase 3); <br>  4. RESPONSE_BODY (phase 4); <br>  5. LOGGING (phase 5). <br>  The rules are executed sequentially in each phase, which means that ModSecurity first evaluates all the rules in phase 1 (‚Äúrequest headers‚Äù), then resumes at phase 2 - 5 (if the rules do not force to stop processing the request). <br><br><h4>  1.10 Normalization Functions </h4><br><habracut>  ModSecurity provides support for multiple normalization functions.  These transformations are done before any rules begin to apply.  Normalization functions are useful for a variety of purposes.  These functions allow you to detect and prevent many types of attacks, such as cross-site scripting, injection of JavaScript code, regardless of their location. <br>  The documentation for ModSecurity 2.x describes the following normalization functions: <br><img src="https://habrastorage.org/getpro/habr/post_images/795/914/5ef/7959145efffdb20fa7854889af1d6051.jpg"><br><br>  The names of most of them describe themselves.  (for acquaintance with others refer to the documentation).  By default ModSecurity 2.x for the incoming stream performs the functions lowercase, replaceNulls and compressWhitespace.  If you need other actions, you can customize them using the new ‚Äút‚Äù action.  As before, to set a list of default actions for all rules, you can use SecDefaultAction, for example: <br>  SecDefaultAction log, auditlog, deny, status: 403, phase: 2, t: lowercase, t: replaceNulls, t: compressWhitespace <br>  This example is taken from the standard configuration.  You can also set actions for each rule separately, either by specifying them completely, or by adding or removing them from the standard configuration.  Here is an example where the compressWhitespace action has been removed and replaceComments has been added: <br>  SecRule t: -compressWhitespace, t: replaceComments <br>  To completely remove all normalizing functions, simply add the special word: none. <br>  SecRule t: none, t: normalisePathWin <br>  And if the built-in normalization functions are not enough for you, then in this case you can use the new API, which allows you to add new normalization functions without changing the source code [4]. <br><br><h4>  1.11 Scan the contents of the response body </h4><br><habracut>  ModSecurity supports outbound filtering for Apache 2. By default, it is disabled.  To use outbound filtering, use the directive <br>  SecResponseBodyAccess On <br>  Syntax: SecResponseBodyAccess On | Off <br>  If scanning the contents of the response body is enabled, this allows the response body to be analyzed according to the rules using the RESPONSE_BODY argument. <br>  It should be noted that although it is possible to mix the output and input filters, they are not executed simultaneously.  Input filters are executed before the Apache request is processed, while the output filters are executed after Apache has completed processing the request. <br>  The skipAfter and chain actions do not work with output filters. <br>  Output filtering is used only for output in plain-text and HTML.  Applying regular expressions to binary data (for example, to images) will heavily load the server.  By default, ModSecurity scans the output in responses that do not specify a Content Type or Content Type is text / plan or text / html.  This can be changed using the SecResponseBodyMimeType directive: <br>  SecResponseBodyMimeType (null) text / html text / plain <br>  Syntax: SecResponseBodyMimeType In this configuration, ModSecurity will apply output filters to plain-text files, HTML files and files whose MIME type is not specified. <br>  When using buffering, ModSecurity keeps the entire page in memory, regardless of page size. <br>  Outgoing monitoring is a useful feature under certain circumstances.  It should ensure that it can not be circumvented.  If the attacker has full control over the processing of the request, he can bypass the outgoing monitoring in two ways. <br>  ‚Ä¢ Use Content-Type that is not viewable.  For performance reasons, it is not possible to view all content types. <br>  ‚Ä¢ Some way to transcode the output.  Even the simplest transcoding can fool monitoring. <br><br><h4>  1.12 Implicit validation check </h4><br><habracut>  Implicit validation of the request (if configured) is performed only at the beginning of the processing of the request.  This check consists of checks for the query string and headers. <br>  Comment.  Unicode validation check does not apply to the contents of the Referer header as part of the initial implicit validation request.  This is done because this header often contains information about other Web sites, and their coding is usually different from the coding used on the protected Web site. <br><br><h4>  1.13 Filter Inheritance </h4><br><habracut>  Filters defined in parent directories are usually inherited in nested Apache contexts.  This behavior is acceptable (and required) in most cases, but not always.  Sometimes it is necessary to weaken the checks for some part of the site.  Using the SecRuleInheritance Off directive, you can specify ModSecurity to ignore the parent filters, thereby starting the rules again.  This directive only affects the rules.  The configuration is always inherited from the parent context, but it can be overridden using the appropriate configuration directives. <br>  Comment.  By default, configuration and rules inheritance is always performed.  If the context is below the one in which inheritance is allowed, you should explicitly prohibit inheritance again when necessary. <br><br><h4>  1.14 Cookies </h4><br><habracut>  ModSecurity provides full support for cookies.  By default, cookies are processed as version 0 format. However, version 1 cookies (as defined in RFC 2109) are also supported.  In order to enable support for cookie version 1, you need to use the following directive: <br>  SecCookieFormat 1 <br>  The syntax of this command is: SecCookieFormat 0 | 1 <br><br><h4>  1.15 ModSecurity interaction with packet filter </h4><br><habracut>  In some cases, after finding a particular dangerous attack or series of attacks, you may want to prevent further attacks from a particular source.  This can be done by modifying the firewall so that it rejects all traffic coming from a specific IP address [3]. <br>  This method can be very dangerous, as its result can be a DoS attack.  For example, an attacker can use a proxy to launch attacks.  Rejecting all requests from the proxy server can be very dangerous, since it will also affect all legitimate users. <br>  Since most proxies send information describing the source client, you can try to determine the real IP address.  Consider the following scenario. <br>  The attacker wants to get direct access to the application, but tries to act as a proxy, indicating a random (or valid) IP address as the real IP address of the source.  If we start rejecting requests based on this received information, the attacker can simply change the IP address and continue the attack.  As a result, access for legitimate users may be denied, while the attacker may continue to search for vulnerabilities in the application. <br>  Therefore, this method can be used only when access to the application through a proxy is not allowed or access is only allowed through those proxies that are trusted. <br>  If, however, there is a need to deny requests based on IP addresses, you must use a script that will be executed when the query matches the filter.  The script must extract the attacker's IP address from environment variables and then call a packet filter to deny access from this IP address. <br><br><h4>  1.16 Special Features </h4><br>  File upload support <br><habracut>  ModSecurity has the ability to intercept files that are loaded using POST requests and multipart / form-data encoding or using PUT requests. <br>  ModSecurity always uploads files to a temporary directory.  This can be changed using the SecUploadDir directive: <br>  SecUploadDir / tmp <br>  To store files, it is better to use a directory to which only users of the Web server are allowed.  Otherwise, other server users can also access files uploaded through the web server. <br><br>  Store downloaded files <br><habracut>  It is possible to upload files via a web server.  To do this, simply add the following line to the configuration <br>  SecUploadKeepFiles On <br>  The directory in which files are stored is determined using the directive SecUploadDir. <br><br>  Hiding server identification <br><habracut>  One of the technologies that allows attackers to be confused is the change in the identification of the Web server.  Web servers typically send their identification on each HTTP response in the Server header. <br>  To change the identity of the Web server, you can find its name (for example, ‚ÄúApache‚Äù) in the source code, replace it and recompile the server.  The same result can be obtained using the SecServerSignature directive: <br>  SecServerSignature "Microsoft-IIS / 5.0" <br>  SecServerSignature "Apache / 2.2.4 (Fedora)" <br>  It should be noted that, although this procedure works quite well, qualified attackers (and tools) can use other technologies to obtain the ‚Äúfingerprint‚Äù of the Web server.  For example, the default files, the error message, the sequence of headers in the response, the way the server responds to certain requests, and the like - all this can give the correct identification. <br>  Chroot support <br>  Standard approach <br><habracut>  ModSecurity includes support for Apache file system isolation or chroot.  After the chroot operation is completed, the application cannot access outside the specified directory. <br>  Unfortunately, it is not always easy to do.  The problem is that applications usually require shared libraries and various other files to function correctly. <br>  ModSecurity approach <br><habracut>  A special directive has been added to ModSecurity that allows you to successfully chroot. <br>  SecChrootDir / chroot / apache <br>  In addition to simplicity, this approach has other advantages.  Unlike the execution of an external chroot, when running chroot ModSecurity it is not required that there are additional files in the specified directory.  A chroot call is made after the Web server is initialized, but before performing a fork.  As a result, all shared libraries are already loaded, all modules of the Web server are initialized and log files are open.  In the specified directory must be only data. <br>  Nevertheless, there are several cases when additional files should be placed in this directory.  This is necessary if execution of CGI scripts or other systems is required. <br><br><h4>  1.17 Solving Common Security Problems </h4><br><habracut>  ModSecurity features can be used to identify and prevent the most common security issues.  In more detail, protection against attacks on Web applications is discussed in the specialized literature [4, 5].  Consider some of them. <br><br><h5>  1.17.1 Navigating the Directory </h5><br><habracut>  If some script should have access to the file system, then you should pay attention to some metacharacters and constructs.  For example, a combination of ../ characters in the path means moving one level up in the directory.  Such a sequence of characters should not occur in requests and should be prohibited using the following filter: <br>  SecRule REQUEST_URI "... /" "t: urlDecode, deny" <br><br><h5>  1.17.2 Normalization of the path </h5><br><habracut>  Filters do not apply to the original request data ‚Äî first they are normalized.  This is done because an attacker can use various techniques to hide a certain sequence of characters to avoid attack detection.  ModSecurity can automatically apply the following transformations: <br>  converts to Windows in /; <br>  lowers /./ to /; <br>  lowers // to /; <br>  decodes URL characters. <br>  Two functions are used to normalize the path: normalizePath and normalisePathWin. <br>  This rule demonstrates the ability of ModSecurity to normalize the path. <br>  SecRule REQUEST_URI "pass, t: - normalisePathWin‚Äû <br><br><h5>  1.17.3 Prevent null byte attacks </h5><br><habracut>  Attacks of null byte are trying to deceive software written in C / C ++, forcing him to believe that the line ends earlier than it actually is.  This type of attack is usually prevented by the normalize function removeNulls and replaceNulls.  If you do not filter out null byte, then this may affect subsequent filtering.  Possible syntax of the null byte filtering command: <br>  SecDefaultAction ‚Äúphase: 2, deny, log, status: 403, t: removeNulls¬ª <br>  SecRule ARGS: data "pass, t: -removeNulls" <br><br><h4>  1.18 Event Logging </h4><br><habracut>  If your server is being attacked, it is very important to get a picture of what the attacker is trying to do.  Does he use a pre-packaged script to try to log in to your server?  Or is someone trying to hack your server using SQL injection through a foreign proxy server? <br>  Viewing ModSecurity audit logs on a regular basis is important to have information about what actions they are trying to take against your server.  In some cases, based on this data, you can discover new vulnerabilities of your server and take necessary measures to protect against these actions. <br>  Standard Apache audit logs can not give more information about events than the time and date of the request, its type (Post or Get).  ModSecurity enters audit logs that allow the server to log much more detailed information about the requests addressed to your server.  Using audit logs, you can get information about the headers and body of the request, as well as information about the headers and body of the answer and all the rules that apply to the request. <br><br><h5>  1.18.1 Enable the event logging mechanism </h5><br><habracut>  Event logging is disabled by default.  You can enable the event logging mechanism by placing the SecAuditEngine directive in the ModSecurity configuration file.  Here are the possible values ‚Äã‚Äãfor the SecAuditEngine directive. <br>  1) SecAuditEngine On <br>  Enables event logging for all operations. <br>  2) SecAuditEngine Off <br>  Turns off event logging. <br>  3) SecAuditEngine RelevantOnly <br>  Includes logging of only events that match the rule or that have a status code that matches the regular expression generated via the SecAuditLogRelevantStatus directive. <br>  In most cases, it is best to use the SecAuditEngine RelevantOnly directive to register transactions that are actually considered relevant (i.e., those that comply with the ModSecurity rules and have the corresponding HTTP status code).  Using the directive SecAuditEngine On allows you to record all operations, but it will consume a lot of disk space and load the server. <br>  The SecAuditLogRelevantStatus directive takes as its parameter a regular expression that is matched against the HTTP response code for the operation.  So for registering operations that produce an HTTP error (status code 400-599), you can use the following: <br>  SecAuditEngine RelevantOnly <br>  SecAuditLogRelevantStatus ^ [1] <br><br><h5>  1.18.2 Registration Format </h5><br><habracut>  There are two types of control registration formats that can be used: serial (serial) and parallel (concurrent).  Sequential registration registers all control events in a single file, parallel event registration places registration data for each request into a separate file.  The type of registration format is formed through the directive SecAuditLogType.  There are advantages to each registration format.  With parallel logging, system log files are placed in separate logs corresponding to the time of event logging.  Using a parallel logging format, we need to form a directory where ModSecurity will create separate log files.  This is done using the SecAuditLogStorageDir directive. <br>  With a parallel event logging format, ModSecurity creates a specific directory structure in which separate audit log files are placed.  The directory structure is as follows. <br>  / logs / data / <br>  | - 20090331 <br>  |  | - 20090331-1530 <br>  |  |  | - 20090331-153030-Cei44F5MziQAAFKTAIcAAAAA <br>  |  |  | - 20090331-153030-Cei5115MziQAAFKUAM0AAAAB <br>  |  |  | - 20090331-153030-CgEmHV5MziQAAFKVAS0AAAAC <br>  |  |  | - 20090331-153054-C1JA815MziQAAFKoBfIAAAAV <br>  |  |  `- 20090331-153054-C1JIqV5MziQAAFKVAS4AAAAC <br>  |  | - 20090331-1531 <br>  |  |  | - 20090331-153100-C6skpV5MziQAAFKUAM4AAAAB <br>  |  |  | - 20090331-153105-C @ gA6F5MziQAAFKgBD0AAAAN <br>  |  |  | - 20090331-153109-DBTxLV5MziQAAFKhBKAAAAAO <br>  |  |  `- 20090331-153118-DLyqv15MziQAAFKeA8AAAAAL <br>  |  | - 20090331-1532 <br>  | - 20090401 <br>  |  | - 20090401-0208 <br>  |  |  | - 20090401-020802-8H1Ox15MziQAAFPGEv4AAAAI <br>  |  |  | - 20090401-020802-8esmr15MziQAAF0tGXAAAAAD <br>  |  |  | - 20090401-020805-8RWbIF5MziQAAFNbCN8AAAAy <br>  ... <br>  ModSecurity produces a new directory for each day (for example, the magazine named 20090331 contains audit log files produced on March 31st, 2009).  Each of these logs contains separate subdirectories with event logs made at a specific time (for example, the log named 20090331-1530 contains all audit log files for queries made at 3:30 in the afternoon of March 31st). <br><br><h6> 1.18.3  SecAuditLogParts </h6><br><habracut>  SecAuditLogParts ,        .    ,    1.3. <br> : SecAuditLogParts &lt;&gt; <br> : SecAuditLog ABCFHZ <br><br>  1.3 ‚Äì    SecAuditLogParts <br><img src="https://habrastorage.org/getpro/habr/post_images/f03/909/383/f0390938332168a10af2ee164d349cb7.jpg"><br><img src="https://habrastorage.org/getpro/habr/post_images/17e/d50/a3e/17ed50a3e44595b215d74cd48518b97d.jpg"><br><br><h5> 1.18.4     </h5><br><habracut>     ,        . <br> SecAuditEngine RelevantOnly <br> SecAuditLogRelevantStatus "^(?:5|4\d[^4])" <br> SecAuditLogType Concurrent <br> SecAuditLogParts ABCDEFHZ <br> SecAuditLogStorageDir logs/data/ <br> SecAuditLog bin/mlogc.exe <br> SecAuditLog "|bin/mlogc.exe bin/mlogc.conf" <br><br><h5> 1.18.5   </h5><br><habracut> ,    ,     .        . <br> --ae720000-A-- <br> [11/Nov/2011:14:19:17 +0500] TrzolcCoCgIAAAsYBPwAAAD5 192.168.10.5 65004 192.168.10.2 80 <br> --ae720000-B-- <br> GET /webgoat/images/buttons/hint.jpg HTTP/1.1 <br> Host: 192.168.10.2 <br>  Connection: keep-alive <br> Referer: <a href="http://192.168.10.2/webgoat/attack">192.168.10.2/webgoat/attack</a> <br> Authorization: Basic Z3Vlc3Q6Z3Vlc3Q= <br> User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/13.0.782.112 Safari/535.1 <br> Accept: */* <br> Accept-Encoding: gzip,deflate,sdch <br>  Accept-Language: ru-RU, ru; q = 0.8, en-US; q = 0.6, en; q = 0.4 <br> Accept-Charset: windows-1251,utf-8;q=0.7,*;q=0.3 <br> Cookie: JSESSIONID=CD7576D71A7DD34291918F65FD215FCD <br> If-None-Match: W/¬´563-1257685080000¬ª <br> If-Modified-Since: Sun, 08 Nov 2009 12:58:00 GMT <br> --ae720000-F-- <br> HTTP/1.1 304 Not Modified <br> Pragma: No-cache <br>  Cache-Control: no-cache <br> Expires: Thu, 01 Jan 1970 05:00:00 GMT <br> ETag: W/¬´563-1257685080000¬ª <br> Content-Length: 0 <br> Keep-Alive: timeout=5, max=98 <br>  Connection: Keep-Alive <br> Content-Type: text/plain <br> --ae720000-E-- <br> --ae720000-H-- <br> Message: Warning. Pattern match "^[\\d.:]+$" at REQUEST_HEADERS:Host. [file ¬´C:/Apache2/conf/rules/base_rules/modsecurity_crs_21_protocol_anomalies.conf¬ª] [line ¬´98¬ª] [id ¬´960017¬ª] [rev ¬´2.2.2¬ª] [msg ¬´Host header is a numeric IP address¬ª] [severity ¬´CRITICAL¬ª] [tag ¬´PROTOCOL_VIOLATION/IP_HOST¬ª] [tag ¬´WASCTC/WASC-21¬ª] [tag ¬´OWASP_TOP_10/A7¬ª] [tag ¬´PCI/6.5.10¬ª] [tag ¬´ <a href="http://technet.microsoft.com/en-us/magazine/2005.01.hackerbasher.aspx">technet.microsoft.com/en-us/magazine/2005.01.hackerbasher.aspx</a> ¬ª] <br> Message: Warning. Operator LT matched 5 at TX:inbound_anomaly_score. [file ¬´C:/Apache2/conf/rules/base_rules/modsecurity_crs_60_correlation.conf¬ª] [line ¬´33¬ª] [id ¬´981203¬ª] [msg ¬´Inbound Anomaly Score (Total Inbound Score: 2, SQLi=, XSS=): Host header is a numeric IP address¬ª] <br> Apache-Handler: proxy-server <br> Stopwatch: 1321003157121875 31250 (- ‚Äî -) <br> Stopwatch2: 1321003157121875 31250; combined=0, p1=0, p2=0, p3=0, p4=0, p5=0, sr=0, sw=0, l=0, gc=0 <br> Response-Body-Transformed: Dechunked <br> Producer: ModSecurity for Apache/2.6.2 (http://www.modsecurity.org/); core ruleset/2.2.2. <br> Server: Apache/2.2.21 (Win32) proxy_html/3.1.2 <br> --ae720000-Z-- <br>            --ae720000-A--.     .          SecAuditLogParts. <br>      ,   ,    192.168.10.5,   ModSecurity,      ¬´C:/Apache2/conf/rules/base_rules/modsecurity_crs_21_protocol_anomalies.conf ‚Äî ¬ªPROTOCOL_VIOLATION/IP_HOST"  ¬´C:/Apache2/conf/rules/base_rules/modsecurity_crs_60_correlation.conf¬ª ¬´Inbound Anomaly Score (Total Inbound Score: 2, SQLi=, XSS=): Host header is a numeric IP address¬ª] <br>   modsec_debug.log         . <br> 11/Nov/2011:11:21:34 +0500] [192.168.10.2/sid#5e5148][rid#4aec970][/webgoat/attack][2] Warning. Found 1 byte(s) in ARGS:Screen outside range: 1-255. [file ¬´C:/Apache2/conf/rules/base_rules/modsecurity_crs_20_protocol_violations.conf¬ª] [line ¬´353¬ª] [id ¬´960901¬ª] [rev ¬´2.2.2¬ª] [msg ¬´Invalid character in request¬ª] [severity ¬´WARNING¬ª] [tag ¬´PROTOCOL_VIOLATION/EVASION¬ª] [tag ¬´WASCTC/WASC-28¬ª] [tag ¬´OWASP_TOP_10/A1¬ª] [tag ¬´OWASP_AppSensor/RE8¬ª] [tag ¬´PCI/6.5.2¬ª] [tag ¬´ <a href="http://i-technica.com/whitestuff/asciichart.html">i-technica.com/whitestuff/asciichart.html</a> ¬ª] <br> [11/Nov/2011:11:21:34 +0500] [192.168.10.2/sid#5e5148][rid#4aec970][/webgoat/attack][2] Warning. Pattern match "^[\\d.:]+$" at REQUEST_HEADERS:Host. [file ¬´C:/Apache2/conf/rules/base_rules/modsecurity_crs_21_protocol_anomalies.conf¬ª] [line ¬´98¬ª] [id ¬´960017¬ª] [rev ¬´2.2.2¬ª] [msg ¬´Host header is a numeric IP address¬ª] [severity ¬´CRITICAL¬ª] [tag ¬´PROTOCOL_VIOLATION/IP_HOST¬ª] [tag ¬´WASCTC/WASC-21¬ª] [tag ¬´OWASP_TOP_10/A7¬ª] [tag ¬´PCI/6.5.10¬ª] [tag ¬´ <a href="http://technet.microsoft.com/en-us/magazine/2005.01.hackerbasher.aspx">technet.microsoft.com/en-us/magazine/2005.01.hackerbasher.aspx</a> ¬ª] <br><br>        c  Web- ErrorLog. <br> [Tue Nov 29 16:57:03 2011] [error] [client 192.168.10.5] ModSecurity: Warning. Pattern match "\\\\bacunetix-product\\\\b" at REQUEST_HEADERS_NAMES:Acunetix-Product. [file ¬´C:/Apache2/conf/rules/base_rules/modsecurity_crs_35_bad_robots.conf¬ª] [line ¬´22¬ª] [id ¬´990901¬ª] [rev ¬´2.2.2¬ª] [msg ¬´Request Indicates a Security Scanner Scanned the Site¬ª] [severity ¬´WARNING¬ª] [tag ¬´AUTOMATION/SECURITY_SCANNER¬ª] [tag ¬´WASCTC/WASC-21¬ª] [tag ¬´OWASP_TOP_10/A7¬ª] [tag ¬´PCI/6.5.10¬ª] [hostname ¬´192.168.10.2¬ª] [uri "/lessons/RoleBasedAccessControl/images/"] [unique_id ¬´TtTIj8CoCgIAAAgcQw8AAADj¬ª] <br> [Tue Nov 29 16:57:03 2011] [error] [client 192.168.10.5] ModSecurity: Warning. Operator GE matched 5 at TX:inbound_anomaly_score. [file ¬´C:/Apache2/conf/rules/base_rules/modsecurity_crs_60_correlation.conf¬ª] [line ¬´37¬ª] [id ¬´981204¬ª] [msg ¬´Inbound Anomaly Score Exceeded (Total Inbound Score: 5, SQLi=, XSS=): Request Indicates a Security Scanner Scanned the Site¬ª] [hostname ¬´192.168.10.2¬ª] [uri "/lessons/RoleBasedAccessControl/images/"] [unique_id ¬´TtTIj8CoCgIAAAgcQw8AAADj¬ª] <br><br><h4>    </h4><br><br> 1. Barnett, Ryan C. Preventing Web Attacks with Apache. USA: Addison-Wesley Publishing, 2006. 240 . <br> 2. Magnus Mischel ModSecurity 2.5.Securing your Apache installation and web applications. England: Published by Packt Publishing, 2009. 280 c. <br> 3. ModSecurity Reference Manual // <a href="http://www.modsecurity.org/documentation/modsecurity-apache/2.2.4/modsecurity-manual.html">www.modsecurity.org/documentation/modsecurity-apache/2.2.4/modsecurity-manual.html</a> <br> 4. Ryan Barnett Center for Internet Security Benchmark for Apache Web Server v2.1. USA: The Center for Internet Security (CIS), 2009. 50c. <br> 5. Securing WebGoat Using ModSecurity. USA: OWASP Foundation, 2008. 130 c. </habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/228339/">https://habr.com/ru/post/228339/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../228325/index.html">FnDelay awaiting function</a></li>
<li><a href="../228327/index.html">We parse ACID in NoSQL</a></li>
<li><a href="../228331/index.html">Building your own communication network over I2P</a></li>
<li><a href="../228335/index.html">Installing the Eucalyptus 4.0 cloud system</a></li>
<li><a href="../228337/index.html">Jekyll 2 is coming on Github!</a></li>
<li><a href="../228341/index.html">Substitution of the parent page on the example of ask.fm</a></li>
<li><a href="../228343/index.html">Started the production of wireless sensors nooLite PM111 and PT111</a></li>
<li><a href="../228345/index.html">Laser Cube: laser engraving at home</a></li>
<li><a href="../228347/index.html">Stock market and saving finances: How to buy gold bars</a></li>
<li><a href="../228349/index.html">Orion spacecraft successfully passed the landing test.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>