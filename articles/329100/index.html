<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>EVPN Multihoming</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In an article on EVPN, I touched on the topic of multihoming. Many are interested in this topic and therefore in the continuation of the previous arti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>EVPN Multihoming</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/023/f0c/ec9/023f0cec93074a319320b89b4fdd78bb.jpg"><br><br>  In an article on EVPN, I touched on the topic of multihoming.  Many are interested in this topic and therefore in the continuation of the previous article today we will look at what is EVPN multihoming and how it works. <br><br>  EVPN multihoming works in two modes: Single-Active and Active-Active.  Today we mainly focus on a more complex and interesting variant: Active-Active, since Single-Active is essentially a very simplified version of Active-Active. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This article is intended for those who already have general knowledge about EVPN: the basic principles of work, differences from VPLS, etc. Otherwise, it will be difficult to understand the content of the article. <a name="habracut"></a><br><blockquote>  Note: I assembled the laboratory bench in EVE-NG using vMX: both the P-router and the switches are started by the vMX version 14.1, as by the PE routers of the vMX 16.1, as the final host of 5 Linux machines.  Unlike the previous labs, which I collected on a laptop, this lab is too demanding on resources.  The fact is that vMX 16.1 runs on two virtual machines and requires a total of 4 CPUs and 8GB of RAM.  As a result, for the labs presented in the article, you need about 35GB of RAM on the server, but I want to note that in working condition the entire lab occupied slightly more than 23Gb of RAM (this must be borne in mind if you suddenly want to raise this lab at home). </blockquote><br>  We will consider this topology: <br><br><img src="https://habrastorage.org/web/f23/a32/b5d/f23a32b5db884e789ba27c903253d67c.jpg"><br>  In the configuration I will use the vlan-aware method, that is, through a virtual switch, since this method is the most flexible and interesting, at least for me.  Each PE router has three EVPN instances (abbreviated EVI - EVPN Instance), the configuration of which on all three PEs is about the same - the differences are only in RD, RT, and Vlan numbers.  Two other instances have been added just to demonstrate some of the features of EVPN Multihoming clearly. <br><br>  EVPN instances configuration looks like this: <br><br><pre><code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show configuration routing-instances vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> instance-type virtual-<span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>; interface ae3<span class="hljs-number"><span class="hljs-number">.777</span></span>; route-distinguisher <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>; vrf-target target:<span class="hljs-number"><span class="hljs-number">42000</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>; protocols { evpn { extended-vlan-list <span class="hljs-number"><span class="hljs-number">777</span></span>; } } bridge-domains { BRIDGE<span class="hljs-number"><span class="hljs-number">-777</span></span> { vlan-id <span class="hljs-number"><span class="hljs-number">777</span></span>; } }</code> </pre> <br>  Nothing complicated: an instance with the type of virtual switch, RT, RD and just one bridge domain with vlan-id 777. The same vlan is listed in the extended list of evpn protocol vlans.  For testing, we do not need anything else. <br><br>  We now turn to the interface configuration.  On RZN-PE-3, everything is simple and trite: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-3</span></span>&gt; show configuration interfaces ae0 description <span class="hljs-string"><span class="hljs-string">"RZN-SW-3 | ae0"</span></span>; flexible-vlan-tagging; encapsulation flexible-ethernet-services; aggregated-ether-options { lacp { active; periodic fast; } } unit <span class="hljs-number"><span class="hljs-number">777</span></span> { description eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span>; encapsulation vlan-bridge; family bridge { interface-mode trunk; vlan-id-list <span class="hljs-number"><span class="hljs-number">777</span></span>; } }</code> </pre> <br>  A simple unit that works as a trunk interface, in which only 777 vlan are allowed. <br><br>  But on PE1 and PE2, the config is somewhat different from PE3, since the PE data is multihomed to RZN-SW-1: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show configuration interfaces ae3 description <span class="hljs-string"><span class="hljs-string">"RZN-SW-1 | ge-0/0/0 | ae3&lt;&lt;&gt;&gt;ae0 "</span></span>; flexible-vlan-tagging; mtu <span class="hljs-number"><span class="hljs-number">1600</span></span>; encapsulation flexible-ethernet-services; esi { <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>; all-active; } aggregated-ether-options { lacp { active; periodic fast; system-id <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>; } } unit <span class="hljs-number"><span class="hljs-number">777</span></span> { description eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span>; encapsulation vlan-bridge; family bridge { interface-mode trunk; vlan-id-list <span class="hljs-number"><span class="hljs-number">777</span></span>; } }</code> </pre><br>  Here we are interested in the appeared identifier ESI.  Let me remind for those who have forgotten (or did not know) - this identifier must be assigned manually (when using MC-LAG it can be automatically generated), and all interfaces connected to the same segment should have the same identifier. <br><blockquote>  Note: for what purpose the system-id is specified here will be described at the end of the article </blockquote><br>  In our case, I chose a simple identifier 00: 00: 00: 00: 00: 00: 00: 00: 00: 01, since its value does not play a big role for us, the main thing is that it is different from the reserved values ‚Äã‚Äã(all zeros and all units) and did not overlap with the value of already configured ESI values ‚Äã‚Äãin other segments.  That is, roughly speaking, ESI should be unique for the entire network where EVPN is running.  For non-multihoming segments, this identifier does not play any role at all and is automatically set to 0-l.  Naturally, even for non-multihoming PE routers, you can handle and set a non-zero ESI value on the links, and this will only entail the generation of extra routes - that is, in fact, there will be no problems as such.  But if this ESI value given by the handles coincides with the value of the ESI already configured on another or other junctions, then you will start having problems. <br><br>  There are 5 types of routes in EVPN (I did not consider type 5 last time, but I will try to touch on this topic in an article on EVPN / VxLAN): <br><br>  Type 2 is the MAC / IP route.  This route tells the PE router where and with what label to send unicast packets to the specific MAC address specified in the route.  Essentially analogous to the announcement of the vpnv4 prefix in L3VPN.  The route may also contain the ip address of the host. <br><br>  Type 3 is the Inclusive Multicast route.  This route tells the PE router where and with what label to send BUM traffic. <br><br>  Type 1 and 4 are the main routes that provide us with EVPN Multihoming functionality.  We will consider them further. <br><br>  So, at the 0th time point, as soon as we started EVPN, routers start sending each other type 3 routes, so that we can exchange BUM traffic.  This is true for a non-multihoming script.  Since in our segment two routers look into the same segment, then we have routes like 1 and 4. Why do we need route 3 you should already know, so then we will focus on routes 1 and 4. <br><br>  As I wrote above, we just launched EVPN and so far there was no traffic exchange between the hosts, as indicated by the lack of MAC addresses in the forwarding table of the vSwitch-eVPN-1 instance: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show evpn instance vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> brief Intfs IRB intfs MH MAC addresses Instance Total Up Total Up Nbrs ESIs Local Remote vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>  In the presented output, it is clear that we have a multihomed segment.  To find out information about this segment, we will review the extensive output of the previous command: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show evpn instance vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> extensive Instance: vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> Route Distinguisher: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> Per-instance MAC route label: <span class="hljs-number"><span class="hljs-number">299792</span></span> Per-instance multicast route label: <span class="hljs-number"><span class="hljs-number">299776</span></span> MAC database status Local Remote MAC advertisements: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> MAC+IP advertisements: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> Default gateway MAC advertisements: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> local interfaces: <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> up) Interface name ESI Mode Status ae3<span class="hljs-number"><span class="hljs-number">.777</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> all-active Up <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> IRB interfaces: <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> up) <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> bridge domains: <span class="hljs-number"><span class="hljs-number">1</span></span> VLAN Domain ID Intfs / up IRB intf Mode MAC sync IM route label <span class="hljs-number"><span class="hljs-number">777</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Extended Enabled <span class="hljs-number"><span class="hljs-number">299776</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> neighbors: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> Received routes MAC address advertisement: <span class="hljs-number"><span class="hljs-number">0</span></span> MAC+IP address advertisement: <span class="hljs-number"><span class="hljs-number">0</span></span> Inclusive multicast: <span class="hljs-number"><span class="hljs-number">1</span></span> Ethernet auto-discovery: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> Received routes MAC address advertisement: <span class="hljs-number"><span class="hljs-number">0</span></span> MAC+IP address advertisement: <span class="hljs-number"><span class="hljs-number">0</span></span> Inclusive multicast: <span class="hljs-number"><span class="hljs-number">1</span></span> Ethernet auto-discovery: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> ethernet segments: <span class="hljs-number"><span class="hljs-number">1</span></span> ESI: <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> Status: Resolved by IFL ae3<span class="hljs-number"><span class="hljs-number">.777</span></span> Local interface: ae3<span class="hljs-number"><span class="hljs-number">.777</span></span>, <span class="hljs-attr"><span class="hljs-attr">Status</span></span>: Up/Forwarding <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> remote PEs connected: <span class="hljs-number"><span class="hljs-number">1</span></span> Remote PE MAC label Aliasing label Mode <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> <span class="hljs-number"><span class="hljs-number">300208</span></span> <span class="hljs-number"><span class="hljs-number">300208</span></span> all-active Designated forwarder: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> Backup forwarder: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> Last designated forwarder update: May <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">19</span></span> Advertised MAC label: <span class="hljs-number"><span class="hljs-number">300112</span></span> Advertised aliasing label: <span class="hljs-number"><span class="hljs-number">300112</span></span> Advertised split horizon label: <span class="hljs-number"><span class="hljs-number">302752</span></span></code> </pre> <br>  This output gives us full information on our EVPN instance.  Some of the fields should be clear to you.  According to this conclusion, we have ESI 00: 00: 00: 00: 00: 00: 00: 00: 00: 01, which works in Active-Active mode: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> local interfaces: <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> up) Interface name ESI Mode Status ae3<span class="hljs-number"><span class="hljs-number">.777</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> all-active Up</code> </pre> <br>  The output below provides information on each PE router participating in this EVPN domain: <br><br><pre> <code class="javascript hljs"> <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> neighbors: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> Received routes MAC address advertisement: <span class="hljs-number"><span class="hljs-number">0</span></span> MAC+IP address advertisement: <span class="hljs-number"><span class="hljs-number">0</span></span> Inclusive multicast: <span class="hljs-number"><span class="hljs-number">1</span></span> Ethernet auto-discovery: <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  Judging by the information above from RZN-PE-2, we get one type 3 route and two type 1 routes. The truth is not quite so.  In addition to these routes, RZN-PE-2 gives us another type 4 route, but why it is not shown here, we will see later. <br><br>  But from RZN-PE-3 at the moment we get only one type 3 route and that‚Äôs all: <br><br><pre> <code class="javascript hljs"><span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> Received routes MAC address advertisement: <span class="hljs-number"><span class="hljs-number">0</span></span> MAC+IP address advertisement: <span class="hljs-number"><span class="hljs-number">0</span></span> Inclusive multicast: <span class="hljs-number"><span class="hljs-number">1</span></span> Ethernet auto-discovery: <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>  This is logical, since this PE router is not multihomed and so far all we need to know from it is type 3 route. Further as you study poppies, this router will start sending type 2 announcements, but so far it has not learned any poppies.  If we had configured default gateways, we would have type 2 routes (depending on the number of irb interfaces added to the instance). <br><br>  In addition to the information described above for our EVI, the output indicates that for the segment with ESI 00: 00: 00: 00: 00: 00: 00: 00: 00: 01, Designated forwarder is selected and the Aliasing label is indicated: <br><br><pre> <code class="javascript hljs"> <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> ethernet segments: <span class="hljs-number"><span class="hljs-number">1</span></span> ESI: <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> Status: Resolved by IFL ae3<span class="hljs-number"><span class="hljs-number">.777</span></span> Local interface: ae3<span class="hljs-number"><span class="hljs-number">.777</span></span>, <span class="hljs-attr"><span class="hljs-attr">Status</span></span>: Up/Forwarding <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> remote PEs connected: <span class="hljs-number"><span class="hljs-number">1</span></span> Remote PE MAC label Aliasing label Mode <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> <span class="hljs-number"><span class="hljs-number">300208</span></span> <span class="hljs-number"><span class="hljs-number">300208</span></span> all-active Designated forwarder: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> Backup forwarder: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span></code> </pre> <br>  At the moment, many of the findings are not clear.  To understand the principles of EVPN Multihoming, we need to understand at least the following questions: <br><br>  1. Why does the Multihomed PE router begin to announce additional routes of type 1 and 4, what is their purpose; <br>  2. What is DF and how are its choices made; <br>  3. Why are there two type 1 routes? <br>  4. What is the Aliasing label in the output above. <br><br>  But these and some other questions I will try to answer further. <br><br><h3>  Multihoming-ha problems. </h3><br>  To begin, let us indicate what problems we have if we turn on Multihoming in Active-Active mode.  Naturally, the most acute problem will be loops (well, or cycles, as you like), since EVPN is still L2VPN.  In fact, if you overcome this problem, the technology will already be better than the same VPLS, which in All-Active mode does not know how to work at all.  Another important problem will be traffic balancing, since not all multihomed PE routers will learn Macs from the client.  Other problems are less critical, let's say more precisely - although there are other problems, but their presence does not make the technology unviable. <br><br>  Let's look at how these problems are solved in EVPN. <br><br>  Fighting loops has a whole range of measures.  The first naturally split horizon - a frame received from other PE routers (that is, from the kernel) is not sent again to the kernel.  But of course this is not enough, since the main place of the network where a loop may occur is connecting the multihomed CE of the switch to several PE routers.  To eliminate loops in this segment, Designated Forwarder and Split Horizon Label are used, But first things first. <br><br><h3>  What is DF and why is it needed? </h3><br>  The first scenario of a loop: imagine that a remote PE router receives BUM traffic from CE (for example, a banal arp request) and sends it to all other PEs (suppose it is PE3).  Since the two PE routers (PE1 and PE2) look in the same segment and they both receive BUM traffic from PE3, it turns out that two copies of traffic will fly to this segment, which will then start to wind across all networks, including the core: <br><br><img src="https://habrastorage.org/web/bcf/b02/ac6/bcfb02ac64a6445a936cda4e2cf262cd.gif"><br><br>  To combat this phenomenon, a Designated Forwarder is chosen for each multihomed segment in EVPN - the node responsible for forwarding BUM traffic towards a specific segment in a particular plane.  All other routers, no matter how many of them are in the segment, I have no right to send BUM traffic towards the CE of the router / switch (in this ESI in this vlan). <br><br>  DF Selection Algorithm: <br><br>  1. First, all PE routers must understand how many more routers are connected to the specified segment and what addresses they have (lupbacks); <br><br>  2. After the timer expires (3 seconds by default), a list of all PE routers participating in the DF selection is formed, starting with the smallest address and ending with the largest one.  The address list is numbered from 0 to; <br><br>  3. According to the formula V mod N = i, DF is calculated for this segment and vlan; <br><br>  4. The router selected by the DF will unblock BUM traffic towards CE, and all other non-DF routers continue to block BUM traffic towards the CE of a router / switch in this segment in the given plane. <br><br>  In theory, everything is simple, but let's order. <br><br>  First, we will answer the question of how routers understand who else has a link in the same segment (and are there any such routers at all)?  For this, there is a route of type 4. Look at this route: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show route table vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span> match-prefix *<span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>* vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span> destinations, <span class="hljs-number"><span class="hljs-number">9</span></span> routes (<span class="hljs-number"><span class="hljs-number">9</span></span> active, <span class="hljs-number"><span class="hljs-number">0</span></span> holddown, <span class="hljs-number"><span class="hljs-number">0</span></span> hidden)</code> </pre> <br>  In the routing table of our EVPN instance there are no such routes.  The fact is that only those routes fall into this table, the extended community of which corresponds to the import configured in the instance.  For example, for vSwitch-eVPN-1 is: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show configuration routing-instances vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> vrf-target target:<span class="hljs-number"><span class="hljs-number">42000</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  It turns out that the type 4 route has some other route than the one configured for the import community.  This is due to the fact that the routes in evpn can be generated in two ways - per-EVI and per-ESI. <br><br>  <b>per-EVI</b> - this route is generated by a specific instance <br><br>  <b>per-ESI</b> - this route is not generated by any specific instance, but by the router for all insatns who have a link in this ESI.  The same segment can be included in several evpn instances (for example, the ae3.777 interface has been added to the EVPN1 instance, and the ae3.778 interface has been added to EVPN2, although these are different units, the ESI is configured for the entire interface, which means for the data interfaces will be the same ESI, although they are in different EVI). <br><br>  Routes generated by per-EVI should have native RT and RD instances, from which these routes are announced (or some other RT, if they are additionally attached by export policy - that is, they are added manually by administrators).  Type 2 and 3 routes are always generated by per-EVI, which means that they always have a native RD and RT instance as part of the route, from which these routes are announced.  But for the routes generated by per-ESI, everything is somewhat more complicated and depends on the type of route. <br><br>  But let's continue to deal with the type 4 route. <br><br>  This route is always generated by per-esi.  The RD of this route will be generated automatically by the router from the router-id (if specified) or the loopback address (since this route is not related to any of the EVPN instances).  RT is also not specified manually, but is generated from ESI and only those routers that have the same ESI import this route.  That is why in the conclusion, considered earlier at the beginning of the article, we do not see that the multihomed neighbor announces a type 4 route to us. <br><blockquote>  Note: it‚Äôs not quite true at all, since only part of the ESI bits are taken for RT and all PEs that have the same ESI bits used to generate the RT will import this route. </blockquote><br><blockquote>  Note: JunOS generates RD for per-ESI routes using a zero value in the second part of RD: 62.0.0.1: <b>0</b> . </blockquote><br>  So where to look for our type 4 route?  JunOS has several routing tables.  EVPN routes first enter the bgp.evpn.0 table and are already imported from it into some other routing tables (secondary tables).  Therefore, this route can be found in the bgp.evpn.0 table, from which it is exported to the __ default_evpn __. Evpn.0 table: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show route table __default_evpn__.evpn<span class="hljs-number"><span class="hljs-number">.0</span></span> match-prefix *<span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>* __default_evpn__.evpn<span class="hljs-number"><span class="hljs-number">.0</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> destinations, <span class="hljs-number"><span class="hljs-number">3</span></span> routes (<span class="hljs-number"><span class="hljs-number">3</span></span> active, <span class="hljs-number"><span class="hljs-number">0</span></span> holddown, <span class="hljs-number"><span class="hljs-number">0</span></span> hidden) + = Active Route, - = Last Active, * = Both <span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>::<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">304</span></span> ES *[EVPN/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span>:<span class="hljs-number"><span class="hljs-number">15</span></span> Indirect <span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>::<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">304</span></span> ES *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>, localpref <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span> AS path: I, validation-state: unverified &gt; to <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> via ae0<span class="hljs-number"><span class="hljs-number">.1</span></span></code> </pre> <br>  As I said, the RD is automatically generated by the router: 62.0.0.1 in the route from RZN-PE-1 (next-hop indirect, since the route is local to this router) and 62.0.0.2 in the route from RZN-PE- 2  There is no route from RZN-PE-3, as this PE router is not multihomed.  Moreover, since there is no such ESI on PE-3, these routes are not imported by this router, although the reflector faithfully gives them to it: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-3</span></span>&gt; show route table __default_evpn__.evpn<span class="hljs-number"><span class="hljs-number">.0</span></span> bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-3</span></span>&gt;</code> </pre> <br><pre> <code class="javascript hljs">bormoglotx@RZN-P<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show route advertising-protocol bgp <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> | match <span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">62</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>::<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">304</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>::<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">304</span></span></code> </pre> <br>  Now we will analyze this route in more detail: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show route table __default_evpn__.evpn<span class="hljs-number"><span class="hljs-number">.0</span></span> match-prefix *<span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>* next-hop <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> detail __default_evpn__.evpn<span class="hljs-number"><span class="hljs-number">.0</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> destinations, <span class="hljs-number"><span class="hljs-number">3</span></span> routes (<span class="hljs-number"><span class="hljs-number">3</span></span> active, <span class="hljs-number"><span class="hljs-number">0</span></span> holddown, <span class="hljs-number"><span class="hljs-number">0</span></span> hidden) <span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>::<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">304</span></span> ES (<span class="hljs-number"><span class="hljs-number">1</span></span> entry, <span class="hljs-number"><span class="hljs-number">1</span></span> announced) *BGP Preference: <span class="hljs-number"><span class="hljs-number">170</span></span>/<span class="hljs-number"><span class="hljs-number">-101</span></span> Route Distinguisher: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span> Next hop type: Indirect, Next hop index: <span class="hljs-number"><span class="hljs-number">0</span></span> Address: <span class="hljs-number"><span class="hljs-number">0xb1e55f0</span></span> Next-hop reference count: <span class="hljs-number"><span class="hljs-number">20</span></span> Source: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span> Protocol next hop: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> Indirect next hop: <span class="hljs-number"><span class="hljs-number">0x2</span></span> no-forward INH Session ID: <span class="hljs-number"><span class="hljs-number">0x0</span></span> State: <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Secondary</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Active</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Int</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Ext</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Local AS: 42000.62 Peer AS: 42000.62 Age: 2:58:04 Metric2: 1 Validation State: unverified Task: BGP_42000.62.62.0.0.100 Announcement bits (1): 0-__default_evpn__-evpn AS path: I (Originator) Cluster list: 62.0.0.100 Originator ID: 62.0.0.2 Communities: es-import-target:0-0-0-0-0-0 Import Accepted Localpref: 100 Router ID: 62.0.0.100 Primary Routing Table bgp.evpn.0</span></span></code> </pre> <br>  Especially nothing criminal - most of the fields are peculiar to the BGP route.  But here in the community line we are usually used to seeing for example the domain-id, origin or target community.  Immediately completely different community. <br><br>  This is specifically reserved for the EVPN community.  As I wrote above, this route is generated exclusively by per-ESI and only those PE routers that need this route should receive it.  And it is needed only for those PEs who have a link in the same ESI as the sender of the route.  Therefore, the community of this route is generated based on ESI and has the form es-import-target: 0-0-0-0-0-0. <br><br><img src="https://habrastorage.org/web/ff0/ce2/74b/ff0ce274b0584ab9a6325e670b40c92b.gif"><br><br>  In our case, all zeros, and I specifically took such an ESI to show that this community can contain only zeros in its second part (the first part is reserved and equal to 0x06 (type) and 0x02 (sub type), who are interested in reading the <a href="https://tools.ietf.org/html/rfc7153">RFC</a> ) and This does not affect the performance of EVPN.  As a result, in our laboratory network only RZN-PE-1 and RZN-PE-2 import this route. <br><br>  And where is ESI, you ask?  The identifier is directly in the route itself: 4: 62.0.0.2: 0 :: <b>01</b> : 62.0.0.2/304 ES, just empty octets (zeros) are omitted (like ipv6).  And it‚Äôs not hard to guess if two routers will have links in different segments, but their identifiers will be 00: 00: 00: 00: 00: 00: 00: 00: <b>01</b> for the first and <b>10</b> : 00: 00: 00 : 00: 00: 00: 00: 00: <b>01</b> from the second one, then the routes will be imported by both routers.  According to the community, only the initial filtering occurs - the route itself will be used only if the ESI specified in the route matches the ESI on the router itself, which this route received, otherwise the route will be discarded. <br><br>  As soon as the router understands that it is multihomed (it understands this by the non-zero value of ESI in the interface configuration), it begins to send a type 4 route so that all neighboring routers are aware of its presence on the network. <br><br>  After the routes have spread over the network, the RZN-PE-1 and RZN-PE-2 will know that they are connected to the same ESI.  Both routers wait for 3 seconds (by default) type 4 routes from other PE routers, after which, based on the type 4 routes received from neighbors, they make a list of all nodes connected to this segment, and on all nodes this list will be the same our case is this: <br><blockquote>  62.0.0.1 i = 0 <br>  62.0.0.2 i = 1 </blockquote><br>  After that, the routers begin to calculate who DF will be according to the formula V mod N = i, where V is the number of the vlan, and N is the number of PE routers in the segment.  The PE router whose number will be the result of the calculation and becomes the DF of this segment in the given plane.  As you understand, each VF will have its own DF - it turns out some balancing of BUM traffic. <br><br><img src="https://habrastorage.org/web/791/91d/cfa/79191dcfa6f847b6ba3fd7e44046a83b.gif"><br><br>  There are three EVPN instances configured in the laboratory, one instance corresponds to each instance, I used 777, 778 and 779 Vlans. Since we have 2 multihomed PE-ek, the number of nodes is 2. We get that in this segment DF-ohm for Vlan 777 and 779 will be chosen RZN-PE-2, and for 778 - RZN-PE-1, which is easy to check: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show configuration routing-instances | display set | match interface set routing-instances vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> interface ae3<span class="hljs-number"><span class="hljs-number">.777</span></span> set routing-instances vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-2</span></span> interface ae3<span class="hljs-number"><span class="hljs-number">.778</span></span> set routing-instances vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-3</span></span> interface ae3<span class="hljs-number"><span class="hljs-number">.779</span></span></code> </pre> <br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show configuration interfaces ae3 | display set | match vlan-id set interfaces ae3 unit <span class="hljs-number"><span class="hljs-number">777</span></span> family bridge vlan-id-list <span class="hljs-number"><span class="hljs-number">777</span></span> set interfaces ae3 unit <span class="hljs-number"><span class="hljs-number">778</span></span> family bridge vlan-id-list <span class="hljs-number"><span class="hljs-number">778</span></span> set interfaces ae3 unit <span class="hljs-number"><span class="hljs-number">779</span></span> family bridge vlan-id-list <span class="hljs-number"><span class="hljs-number">779</span></span></code> </pre> <br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show evpn instance vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> designated-forwarder Instance: vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> ethernet segments: <span class="hljs-number"><span class="hljs-number">1</span></span> ESI: <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> Designated forwarder: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span></code> </pre> <br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show evpn instance vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-2</span></span> designated-forwarder Instance: vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> ethernet segments: <span class="hljs-number"><span class="hljs-number">1</span></span> ESI: <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> Designated forwarder: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span></code> </pre> <br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show evpn instance vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-3</span></span> designated-forwarder Instance: vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-3</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> ethernet segments: <span class="hljs-number"><span class="hljs-number">1</span></span> ESI: <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> Designated forwarder: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span></code> </pre> <br>  This scheme has its pros and cons.  The most obvious disadvantage is the DF selection mechanism itself.  As soon as a new router appears in the segment that has a link in the direction of ESI X or a link drops / restores on the router in the direction of ESI X, the DF is recalculated for this segment.  And the worst situation will be the disappearance of the link in the direction of ESI X on the DF router.  Since the rest of the routers block BUM traffic transmission to the device CE side, for the time of detecting the fall of the DF and calculating the new DF, the BUM traffic will be dropped by all the PE routers of the segment, since at this point in time they will all be non-DF.  But now there is a draft <a href="https://tools.ietf.org/html/draft-ietf-bess-evpn-df-election-02">RFC</a> that describes the new DF selection procedure.  But so far everything works as described. <br><br>  It is worth mentioning that the choice of DF for vlan-aware and vlan-bundle methods is slightly different.        -,   DF         ,     ,        .        30,778  779.  ,         ‚Äî 30,  DF-      PE1 ‚Äî 62.0.0.1: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show evpn instance vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> extensive | match <span class="hljs-string"><span class="hljs-string">"domain|extended|forwarder"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> bridge domains: <span class="hljs-number"><span class="hljs-number">4</span></span> VLAN Domain ID Intfs / up IRB intf Mode MAC sync IM route label <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Extended Enabled <span class="hljs-number"><span class="hljs-number">300384</span></span> <span class="hljs-number"><span class="hljs-number">777</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> irb<span class="hljs-number"><span class="hljs-number">.1</span></span> Extended Enabled <span class="hljs-number"><span class="hljs-number">300384</span></span> <span class="hljs-number"><span class="hljs-number">778</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Extended Enabled <span class="hljs-number"><span class="hljs-number">300384</span></span> <span class="hljs-number"><span class="hljs-number">779</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Extended Enabled <span class="hljs-number"><span class="hljs-number">300384</span></span> Designated forwarder: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> Backup forwarder: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> Last designated forwarder update: May <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">13</span></span></code> </pre> <br>    30- .      777,    DF-   PE2 ‚Äî 62.0.0.2: <br><br><pre> <code class="javascript hljs"> bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show evpn instance vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> extensive | match <span class="hljs-string"><span class="hljs-string">"domain|extended|forwarder"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> bridge domains: <span class="hljs-number"><span class="hljs-number">4</span></span> VLAN Domain ID Intfs / up IRB intf Mode MAC sync IM route label <span class="hljs-number"><span class="hljs-number">777</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> irb<span class="hljs-number"><span class="hljs-number">.1</span></span> Extended Enabled <span class="hljs-number"><span class="hljs-number">300384</span></span> <span class="hljs-number"><span class="hljs-number">778</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Extended Enabled <span class="hljs-number"><span class="hljs-number">300384</span></span> <span class="hljs-number"><span class="hljs-number">779</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Extended Enabled <span class="hljs-number"><span class="hljs-number">300384</span></span> Designated forwarder: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> Backup forwarder: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> Last designated forwarder update: May <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span></code> </pre> <br><blockquote> :   ,       Backup forwarder  Backup Designated forwarder (BDF). BDF      non-DF .  EVPN    (   OSPF DR  BDR) ‚Äî DF  ,   non-DF  BDF.                  DF. </blockquote><br>        4    . <br><br>   DF      .        CE      non-DF .  ,  RZN-PE-1,  non-DF  BUM   RZN-SW-1    ,  : RZN-PE-1,  BUM   CE,       PE-,  RZN-PE-2. RZN-PE-2,  DF   ,         RZN-SW-1,    .    : <br><br><img src="https://habrastorage.org/web/597/734/252/5977342527b54fcd92d0692f24290189.gif"><br><br>           -. <br><br>        1,    per-ESI. <br><br>       4,    1,   per-ESI,  per-EVI   community    ,     ( ,    ): <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show route table vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span> match-prefix *<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>* vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span> destinations, <span class="hljs-number"><span class="hljs-number">9</span></span> routes (<span class="hljs-number"><span class="hljs-number">9</span></span> active, <span class="hljs-number"><span class="hljs-number">0</span></span> holddown, <span class="hljs-number"><span class="hljs-number">0</span></span> hidden) + = Active Route, - = Last Active, * = Both <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-number"><span class="hljs-number">01</span></span>::<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">304</span></span> AD/EVI *[EVPN/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">1</span></span>d <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> Indirect <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>::<span class="hljs-number"><span class="hljs-number">01</span></span>::FFFF:FFFF/<span class="hljs-number"><span class="hljs-number">304</span></span> AD/ESI *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">03</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, localpref <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span> AS path: I, validation-state: unverified &gt; to <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> via ae0<span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-number"><span class="hljs-number">01</span></span>::<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">304</span></span> AD/EVI *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">1</span></span>d <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>, localpref <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span> AS path: I, validation-state: unverified &gt; to <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> via ae0<span class="hljs-number"><span class="hljs-number">.1</span></span></code> </pre> <br><h3>     1 per-ESI? </h3><br>   1   . <br><br>  per-ESI   1     community    mpls ,  split horizon label: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show route table vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span> match-prefix *FFFF* detail vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span> destinations, <span class="hljs-number"><span class="hljs-number">9</span></span> routes (<span class="hljs-number"><span class="hljs-number">9</span></span> active, <span class="hljs-number"><span class="hljs-number">0</span></span> holddown, <span class="hljs-number"><span class="hljs-number">0</span></span> hidden) <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>::<span class="hljs-number"><span class="hljs-number">01</span></span>::FFFF:FFFF/<span class="hljs-number"><span class="hljs-number">304</span></span> AD/ESI (<span class="hljs-number"><span class="hljs-number">1</span></span> entry, <span class="hljs-number"><span class="hljs-number">1</span></span> announced) *BGP Preference: <span class="hljs-number"><span class="hljs-number">170</span></span>/<span class="hljs-number"><span class="hljs-number">-101</span></span> Route Distinguisher: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span> Next hop type: Indirect, Next hop index: <span class="hljs-number"><span class="hljs-number">0</span></span> Address: <span class="hljs-number"><span class="hljs-number">0xb1e55f0</span></span> Next-hop reference count: <span class="hljs-number"><span class="hljs-number">20</span></span> Source: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span> Protocol next hop: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> Indirect next hop: <span class="hljs-number"><span class="hljs-number">0x2</span></span> no-forward INH Session ID: <span class="hljs-number"><span class="hljs-number">0x0</span></span> State: <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Secondary</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Active</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Int</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Ext</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Local AS: 42000.62 Peer AS: 42000.62 Age: 3:20:48 Metric2: 1 Validation State: unverified Task: BGP_42000.62.62.0.0.100 Announcement bits (1): 0-vSwitch-eVPN-1-evpn AS path: I (Originator) Cluster list: 62.0.0.100 Originator ID: 62.0.0.2 Communities: target:42000:1 target:42000:2 target:42000:3 esi-label:all-active (label 302656) Import Accepted Localpref: 100 Router ID: 62.0.0.100 Primary Routing Table bgp.evpn.0</span></span></code> </pre> <br>    : <br><br><pre> <code class="javascript hljs">Communities: target:<span class="hljs-number"><span class="hljs-number">42000</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> target:<span class="hljs-number"><span class="hljs-number">42000</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span> target:<span class="hljs-number"><span class="hljs-number">42000</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span> esi-label:all-active (label <span class="hljs-number"><span class="hljs-number">302656</span></span>)</code> </pre> <br>        ? , non-DF ,  BUM    DF-,       ,    community.     : PE   BUM     ESI X,     non-DF .         PE-  EVPN ,    PE-,    ESI X.  PE-     ‚Äî   IM ,   ,   DF-   ESI X,    Split horizon     IM .    DF   ,      ESI X         . ,         ,      DF ,   non-DF          ESI X. <br><br><img src="https://habrastorage.org/web/527/daf/e53/527dafe534d9444783636a93ae111390.gif"><br><br>   DF    : <br><br>      IM   S=1 (        ‚Äî   ),         CE-/   EVPN . <br><br>       IM   S=0 (    ‚Äî    ),        mpls lookup.   lookup   Split Horizon   S=1.          CE /,   ,      ,     . <br><br>  ,     per-ESI,       4   community  (      )?   ,         split horizon label.      community esi-label: <b>all-active</b> (label 302656),  ,     all-active  single-active.     PE-,   ‚Äî       PE-   (    )    Aliasing label. <br><br>       ‚Äî   .         CE ,         ,     .      ,    PE-   ,       withdraw ,   MAC/IP    ,        ESI,       .      ?     withdraw      1,     PE  ,    PE      .   MAC Mass Withdraw.        ,     ,   MAC-     . <br><br><img src="https://habrastorage.org/web/f9d/632/24d/f9d63224d1a54ef0b55abac32a1f83a5.gif"><br><br>   ,       (-) community ‚Äî    PE3   ESI 00:00:00:00:00:00:00:00:00:01   community ,     4,  PE-3    ,   community. <br><br> :       1,  per-ESI,     : 1:62.0.0.2:0::01:: <b>FFFF:FFFF</b> /304 AD/ESI.    Juniper,    RFC ‚Äî    1,    per-ESI   tag-id       (    32-),  mpls    0. <br><br>   EVPN        .          ,      2   1.    ?  ,    1     per-EVI. <br><br><h3>     1,  per-EVI? </h3><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show route table vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span> match-prefix *<span class="hljs-number"><span class="hljs-number">01</span></span>::<span class="hljs-number"><span class="hljs-number">0</span></span>* vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span>: <span class="hljs-number"><span class="hljs-number">8</span></span> destinations, <span class="hljs-number"><span class="hljs-number">8</span></span> routes (<span class="hljs-number"><span class="hljs-number">8</span></span> active, <span class="hljs-number"><span class="hljs-number">0</span></span> holddown, <span class="hljs-number"><span class="hljs-number">0</span></span> hidden) + = Active Route, - = Last Active, * = Both <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-number"><span class="hljs-number">01</span></span>::<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">304</span></span> AD/EVI *[EVPN/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">1</span></span>d <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span> Indirect <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-number"><span class="hljs-number">01</span></span>::<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">304</span></span> AD/EVI *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">1</span></span>d <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>, localpref <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span> AS path: I, validation-state: unverified &gt; to <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> via ae0<span class="hljs-number"><span class="hljs-number">.1</span></span></code> </pre> <br>      aliasing label: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show route table vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span> match-prefix *<span class="hljs-number"><span class="hljs-number">01</span></span>::<span class="hljs-number"><span class="hljs-number">0</span></span>* detail next-hop <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span>: <span class="hljs-number"><span class="hljs-number">8</span></span> destinations, <span class="hljs-number"><span class="hljs-number">8</span></span> routes (<span class="hljs-number"><span class="hljs-number">8</span></span> active, <span class="hljs-number"><span class="hljs-number">0</span></span> holddown, <span class="hljs-number"><span class="hljs-number">0</span></span> hidden) <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-number"><span class="hljs-number">01</span></span>::<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">304</span></span> AD/EVI (<span class="hljs-number"><span class="hljs-number">1</span></span> entry, <span class="hljs-number"><span class="hljs-number">1</span></span> announced) *BGP Preference: <span class="hljs-number"><span class="hljs-number">170</span></span>/<span class="hljs-number"><span class="hljs-number">-101</span></span> Route Distinguisher: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> Next hop type: Indirect, Next hop index: <span class="hljs-number"><span class="hljs-number">0</span></span> Address: <span class="hljs-number"><span class="hljs-number">0xb1e55f0</span></span> Next-hop reference count: <span class="hljs-number"><span class="hljs-number">20</span></span> Source: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span> Protocol next hop: <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> Indirect next hop: <span class="hljs-number"><span class="hljs-number">0x2</span></span> no-forward INH Session ID: <span class="hljs-number"><span class="hljs-number">0x0</span></span> State: <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Secondary</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Active</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Int</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Ext</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Local AS: 42000.62 Peer AS: 42000.62 Age: 1d 0:20:26 Metric2: 1 Validation State: unverified Task: BGP_42000.62.62.0.0.100 Announcement bits (1): 0-vSwitch-eVPN-1-evpn AS path: I (Originator) Cluster list: 62.0.0.100 Originator ID: 62.0.0.2 Communities: target:42000:1 Import Accepted Route Label: 300208 Localpref: 100 Router ID: 62.0.0.100 Primary Routing Table bgp.evpn.0</span></span></code> </pre> <br> Route Label: 300208 ‚Äî  aliasing ,     ,     2     .      ,            2?   ,     EVPN   L2VPN ‚Äî             ,    .    ,  PE-    MAC-  data plane.     ,  multihomed CE         PE- (    ‚Äî         ).       MAC   CE /    MAC/IP: <br><br>    ,  ,   MAC-  RZN-PE-2 (  DF     777 ),   data plane (     ): <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-2</span></span>&gt; show bridge mac-table MAC flags (S -<span class="hljs-keyword"><span class="hljs-keyword">static</span></span> MAC, D -dynamic MAC, L -locally learned, C -Control MAC O -OVSDB MAC, SE -Statistics enabled, NM -Non configured MAC, R -Remote PE MAC) Routing instance : vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> Bridging domain : BRIDGE<span class="hljs-number"><span class="hljs-number">-777</span></span>, <span class="hljs-attr"><span class="hljs-attr">VLAN</span></span> : <span class="hljs-number"><span class="hljs-number">777</span></span> MAC MAC Logical NH RTR addresssss flags interface Index ID <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">86</span></span>:<span class="hljs-number"><span class="hljs-number">71</span></span>:<span class="hljs-number"><span class="hljs-number">87</span></span>:c0 DC <span class="hljs-number"><span class="hljs-number">1048585</span></span> <span class="hljs-number"><span class="hljs-number">1048585</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">86</span></span>:<span class="hljs-number"><span class="hljs-number">71</span></span>:<span class="hljs-number"><span class="hljs-number">87</span></span>:f0 D ae3<span class="hljs-number"><span class="hljs-number">.777</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">79</span></span>:<span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">68</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>c D ae3<span class="hljs-number"><span class="hljs-number">.777</span></span> &lt;&lt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">00:50:79:66:68:0d</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">D</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ae3.777</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">00:50:79:66:68:0e</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">D</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ae3.777</span></span></span></span></span></span></code> </pre> <br>      MAC-  RZN-PE-1    data plane: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show bridge mac-table MAC flags (S -<span class="hljs-keyword"><span class="hljs-keyword">static</span></span> MAC, D -dynamic MAC, L -locally learned, C -Control MAC O -OVSDB MAC, SE -Statistics enabled, NM -Non configured MAC, R -Remote PE MAC) Routing instance : vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> Bridging domain : BRIDGE<span class="hljs-number"><span class="hljs-number">-777</span></span>, <span class="hljs-attr"><span class="hljs-attr">VLAN</span></span> : <span class="hljs-number"><span class="hljs-number">777</span></span> MAC MAC Logical NH RTR addresssss flags interface Index ID <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">86</span></span>:<span class="hljs-number"><span class="hljs-number">71</span></span>:<span class="hljs-number"><span class="hljs-number">87</span></span>:c0 DC <span class="hljs-number"><span class="hljs-number">1048586</span></span> <span class="hljs-number"><span class="hljs-number">1048586</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">86</span></span>:<span class="hljs-number"><span class="hljs-number">71</span></span>:<span class="hljs-number"><span class="hljs-number">87</span></span>:f0 D ae3<span class="hljs-number"><span class="hljs-number">.777</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">79</span></span>:<span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">68</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>c DRC ae3<span class="hljs-number"><span class="hljs-number">.777</span></span> &lt;&lt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">00:50:79:66:68:0d</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">DRC</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ae3.777</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">00:50:79:66:68:0e</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">D</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ae3.777</span></span></span></span></span></span></code> </pre> <br>    ?  ,   RZN-PE-2  MAC      RZN-SW-1   MAC/IP ,    (       ).       RZN-PE-3,       ,   control plane: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-3</span></span>&gt; show bridge mac-table MAC flags (S -<span class="hljs-keyword"><span class="hljs-keyword">static</span></span> MAC, D -dynamic MAC, L -locally learned, C -Control MAC O -OVSDB MAC, SE -Statistics enabled, NM -Non configured MAC, R -Remote PE MAC) Routing instance : vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> Bridging domain : BRIDGE<span class="hljs-number"><span class="hljs-number">-777</span></span>, <span class="hljs-attr"><span class="hljs-attr">VLAN</span></span> : <span class="hljs-number"><span class="hljs-number">777</span></span> MAC MAC Logical NH RTR addresssss flags interface Index ID <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">86</span></span>:<span class="hljs-number"><span class="hljs-number">71</span></span>:<span class="hljs-number"><span class="hljs-number">87</span></span>:c0 D ae0<span class="hljs-number"><span class="hljs-number">.777</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">86</span></span>:<span class="hljs-number"><span class="hljs-number">71</span></span>:<span class="hljs-number"><span class="hljs-number">87</span></span>:f0 DC <span class="hljs-number"><span class="hljs-number">1048580</span></span> <span class="hljs-number"><span class="hljs-number">1048580</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">79</span></span>:<span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">68</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>c DC <span class="hljs-number"><span class="hljs-number">1048580</span></span> <span class="hljs-number"><span class="hljs-number">1048580</span></span> &lt;&lt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">00:50:79:66:68:0d</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">DC</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1048580</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1048580</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">00:50:79:66:68:0e</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">DC</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1048580</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1048580</span></span></span></span></span></span></code> </pre> <br>         RZN-PE-3,   ,    RZN-PE-1  RZN-PE-2  .  ,   RZN-PE-1: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-3</span></span>&gt; show route table vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span> match-prefix *<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>* next-hop <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span>: <span class="hljs-number"><span class="hljs-number">14</span></span> destinations, <span class="hljs-number"><span class="hljs-number">14</span></span> routes (<span class="hljs-number"><span class="hljs-number">14</span></span> active, <span class="hljs-number"><span class="hljs-number">0</span></span> holddown, <span class="hljs-number"><span class="hljs-number">0</span></span> hidden) + = Active Route, - = Last Active, * = Both <span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-number"><span class="hljs-number">777</span></span>::<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">86</span></span>:<span class="hljs-number"><span class="hljs-number">71</span></span>:<span class="hljs-number"><span class="hljs-number">87</span></span>:f0/<span class="hljs-number"><span class="hljs-number">304</span></span> MAC/IP *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span>, localpref <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span> AS path: I, validation-state: unverified &gt; to <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> via ae3<span class="hljs-number"><span class="hljs-number">.0</span></span>, Push <span class="hljs-number"><span class="hljs-number">299824</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-number"><span class="hljs-number">777</span></span>::<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">79</span></span>:<span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">68</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>e/<span class="hljs-number"><span class="hljs-number">304</span></span> MAC/IP *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span>, localpref <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span> AS path: I, validation-state: unverified &gt; to <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> via ae3<span class="hljs-number"><span class="hljs-number">.0</span></span>, Push <span class="hljs-number"><span class="hljs-number">299824</span></span></code> </pre> <br>   ,  RZN-PE-2: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-3</span></span>&gt; show route table vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span> match-prefix *<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>* next-hop <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span>: <span class="hljs-number"><span class="hljs-number">14</span></span> destinations, <span class="hljs-number"><span class="hljs-number">14</span></span> routes (<span class="hljs-number"><span class="hljs-number">14</span></span> active, <span class="hljs-number"><span class="hljs-number">0</span></span> holddown, <span class="hljs-number"><span class="hljs-number">0</span></span> hidden) + = Active Route, - = Last Active, * = Both <span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-number"><span class="hljs-number">777</span></span>::<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">86</span></span>:<span class="hljs-number"><span class="hljs-number">71</span></span>:<span class="hljs-number"><span class="hljs-number">87</span></span>:f0/<span class="hljs-number"><span class="hljs-number">304</span></span> MAC/IP *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>, localpref <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span> AS path: I, validation-state: unverified &gt; to <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> via ae3<span class="hljs-number"><span class="hljs-number">.0</span></span>, Push <span class="hljs-number"><span class="hljs-number">299840</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-number"><span class="hljs-number">777</span></span>::<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">79</span></span>:<span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">68</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>c/<span class="hljs-number"><span class="hljs-number">304</span></span> MAC/IP &lt;&lt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; *[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">BGP</span></span></span></span><span class="xml"><span class="hljs-tag">/</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">170</span></span></span></span><span class="xml"><span class="hljs-tag">] </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">00:01:32</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">localpref</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">100</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">from</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">62.0.0.100</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">AS</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">I</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">validation-state:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">unverified</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="xml"> to 10.0.3.0 via ae3.0, Push 299840 2:62.0.0.2:1::777::00:50:79:66:68:0d/304 MAC/IP </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; *[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">BGP</span></span></span></span><span class="xml"><span class="hljs-tag">/</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">170</span></span></span></span><span class="xml"><span class="hljs-tag">] </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">00:01:36</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">localpref</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">100</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">from</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">62.0.0.100</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">AS</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">I</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">validation-state:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">unverified</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="xml"> to 10.0.3.0 via ae3.0, Push 299840 2:62.0.0.2:1::777::00:50:79:66:68:0e/304 MAC/IP *[BGP/170] 00:01:27, localpref 100, from 62.0.0.100 AS path: I, validation-state: unverified &gt; to 10.0.3.0 via ae3.0, Push 299840</span></span></code> </pre> <br>  ,      RZN-PE-2.   RZN-PE-3    ,   RZN-PE-1     RZN-PE-2   MAC. ,  RZN-PE-1         RZN-PE-2.     ,   EVPN       .    2 (MAC/IP)   ESI,     MAC-. RZN-PE-1,    2, ,  MAC   ,     .  RZN-PE-1  next-hop-    RZN-PE-2,      ESI: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show bridge mac-table MAC flags (S -<span class="hljs-keyword"><span class="hljs-keyword">static</span></span> MAC, D -dynamic MAC, L -locally learned, C -Control MAC O -OVSDB MAC, SE -Statistics enabled, NM -Non configured MAC, R -Remote PE MAC) Routing instance : vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> Bridging domain : BRIDGE<span class="hljs-number"><span class="hljs-number">-777</span></span>, <span class="hljs-attr"><span class="hljs-attr">VLAN</span></span> : <span class="hljs-number"><span class="hljs-number">777</span></span> MAC MAC Logical NH RTR addresssss flags interface Index ID <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">86</span></span>:<span class="hljs-number"><span class="hljs-number">71</span></span>:<span class="hljs-number"><span class="hljs-number">87</span></span>:c0 DC <span class="hljs-number"><span class="hljs-number">1048586</span></span> <span class="hljs-number"><span class="hljs-number">1048586</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">86</span></span>:<span class="hljs-number"><span class="hljs-number">71</span></span>:<span class="hljs-number"><span class="hljs-number">87</span></span>:f0 D ae3<span class="hljs-number"><span class="hljs-number">.777</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">79</span></span>:<span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">68</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>c DRC ae3<span class="hljs-number"><span class="hljs-number">.777</span></span> &lt;&lt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">00:50:79:66:68:0d</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">DRC</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ae3.777</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">00:50:79:66:68:0e</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">D</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ae3.777</span></span></span></span></span></span></code> </pre> <br>    ,  MAC      ae3.777,   ,  ,      control plane   PE-.  ,  RZN-PE-1     MAC   data plane,      RZN-SW-1     . <br><br>     ‚Äî   RZN-PE-3  MAC    RZN-PE-2,   RZN-PE-1    MAC/IP   MAC ,    RZN-PE-3         RZN-PE-1?     aliasing label. <br><br> RZN-PE-3  (   1,  per-ESI),  RZN-PE-1  RZN-PE-2            Active-Active.      , RZN-PE-3   aliasing label,      .   RZN-PE-3   ,     RZN- SW-1  RZN-PE-2,  ,     2,    RZN-PE-1,  aliasing label   ,      1. <br><br><img src="https://habrastorage.org/web/0b7/5c6/5f0/0b75c65f01d94855864dc24fc0fc736d.gif"><br><br> Aliacing label    multihomed    ,    RZN-PE-3: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-3</span></span>&gt; show evpn instance vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> extensive | find <span class="hljs-string"><span class="hljs-string">"ESI: "</span></span> ESI: <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> Status: Resolved by NH <span class="hljs-number"><span class="hljs-number">1048580</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> remote PEs connected: <span class="hljs-number"><span class="hljs-number">2</span></span> Remote PE MAC label Aliasing label Mode <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-number"><span class="hljs-number">300112</span></span> <span class="hljs-number"><span class="hljs-number">300112</span></span> all-active <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> <span class="hljs-number"><span class="hljs-number">300208</span></span> <span class="hljs-number"><span class="hljs-number">300208</span></span> all-active</code> </pre> <br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-3</span></span>&gt; show evpn instance vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-2</span></span> extensive | find <span class="hljs-string"><span class="hljs-string">"ESI: "</span></span> ESI: <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> Status: Resolved by NH <span class="hljs-number"><span class="hljs-number">1048583</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> remote PEs connected: <span class="hljs-number"><span class="hljs-number">2</span></span> Remote PE MAC label Aliasing label Mode <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">302240</span></span> all-active <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">302272</span></span> all-active</code> </pre> <br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-3</span></span>&gt; show evpn instance vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-3</span></span> extensive | find <span class="hljs-string"><span class="hljs-string">"ESI: "</span></span> ESI: <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> Status: Resolved by NH <span class="hljs-number"><span class="hljs-number">1048588</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> remote PEs connected: <span class="hljs-number"><span class="hljs-number">2</span></span> Remote PE MAC label Aliasing label Mode <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">302624</span></span> all-active <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">302560</span></span> all-active</code> </pre> <br>   mpls.0      Ingress-Aliasing: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show route table mpls<span class="hljs-number"><span class="hljs-number">.0</span></span> label <span class="hljs-number"><span class="hljs-number">302560</span></span> mpls<span class="hljs-number"><span class="hljs-number">.0</span></span>: <span class="hljs-number"><span class="hljs-number">32</span></span> destinations, <span class="hljs-number"><span class="hljs-number">33</span></span> routes (<span class="hljs-number"><span class="hljs-number">32</span></span> active, <span class="hljs-number"><span class="hljs-number">0</span></span> holddown, <span class="hljs-number"><span class="hljs-number">0</span></span> hidden) + = Active Route, - = Last Active, * = Both <span class="hljs-number"><span class="hljs-number">302560</span></span> *[EVPN/<span class="hljs-number"><span class="hljs-number">7</span></span>] <span class="hljs-number"><span class="hljs-number">03</span></span>:<span class="hljs-number"><span class="hljs-number">49</span></span>:<span class="hljs-number"><span class="hljs-number">28</span></span>, routing-instance vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-3</span></span>, route-type Ingress-Aliasing to table vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-3.</span></span>evpn-mac<span class="hljs-number"><span class="hljs-number">.0</span></span></code> </pre> <br>  ,   Juniper       MAC/IP  per-EVI (     ).    ,  aliasing label       mac-label.      : <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-3</span></span>&gt; show evpn instance vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1</span></span> extensive | find <span class="hljs-string"><span class="hljs-string">"ESI: "</span></span> ESI: <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> Status: Resolved by NH <span class="hljs-number"><span class="hljs-number">1048580</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> remote PEs connected: <span class="hljs-number"><span class="hljs-number">2</span></span> Remote PE MAC label Aliasing label Mode <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-number"><span class="hljs-number">300112</span></span> <span class="hljs-number"><span class="hljs-number">300112</span></span> all-active <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> <span class="hljs-number"><span class="hljs-number">300208</span></span> <span class="hljs-number"><span class="hljs-number">300208</span></span> all-active</code> </pre><br>  , MAC label = Aliasing label. ,  JunOS    MAC  per-EVI   : <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-3</span></span>&gt; show route table vSwitch-eVPN<span class="hljs-number"><span class="hljs-number">-1.</span></span>evpn<span class="hljs-number"><span class="hljs-number">.0</span></span> next-hop <span class="hljs-number"><span class="hljs-number">62.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> match-prefix *<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>* detail | match label Route Label: <span class="hljs-number"><span class="hljs-number">300112</span></span> Route Label: <span class="hljs-number"><span class="hljs-number">300112</span></span> Route Label: <span class="hljs-number"><span class="hljs-number">300112</span></span> Route Label: <span class="hljs-number"><span class="hljs-number">300112</span></span></code> </pre> <br>  RZN-PE-1     2,        .    ,      aliasing label,    mac label?   ,     Juniper,   ‚Äî Cisco, Brocade, Huawei  ALu ‚Äî            . <br><br>  ,        aliasing ?   .  RZN-PE-3    1 per-EVI  RZN-PE-1  RZN-PE-2,    aliasing    .     1 per-ESI  RZN-PE-3  . ,   RZN-PE-3      aliasing ,    ,   multihomed      Single-Active   ,    ,   .    RZN-PE-3    ,          .  How to be?        RFC ‚Äî       1,  per-ESI     multihoming-,           aliasing ,     1 per-EVI. <br><br>       Single-Active .           multihomed PE-,        ,        . <br><br><h3>     MC-LAG  EVPN? </h3><br>      multihomed CE  PE-   LAG.   PE-     ,   ,     CE-  LAG,        PE-,      MC-LAG,    CE /  ,                .       : <br><br>   RZN-SW-1   LAG : <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-SW<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show configuration interfaces ae0 description <span class="hljs-string"><span class="hljs-string">"LAG to RZN-PE-1/2 | ae0&lt;&lt;&gt;&gt;ae3"</span></span>; flexible-vlan-tagging; mtu <span class="hljs-number"><span class="hljs-number">1600</span></span>; encapsulation flexible-ethernet-services; aggregated-ether-options { lacp { active; periodic fast;</code> </pre> <br>        PE-: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-SW<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show configuration interfaces ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> description <span class="hljs-string"><span class="hljs-string">"RZN-PE-1 | ae1&lt;&lt;&gt;&gt;ae3"</span></span>; gigether-options { <span class="hljs-number"><span class="hljs-number">802.3</span></span>ad ae0; } bormoglotx@RZN-SW<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show configuration interfaces ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> description <span class="hljs-string"><span class="hljs-string">"RZN-PE-2 | ae2&lt;&lt;&gt;&gt;ae3"</span></span>; gigether-options { <span class="hljs-number"><span class="hljs-number">802.3</span></span>ad ae0; }</code> </pre> <br>   PE-        MC-LAG,   EVPN/MPLS    .  PE-  LAG   CE       system-id,  MAC  PE-   CE   ( CE    MAC-): <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show configuration interfaces ae3 description <span class="hljs-string"><span class="hljs-string">"RZN-SW-1 | ge-0/0/0 | ae3&lt;&lt;&gt;&gt;ae0 "</span></span>; flexible-vlan-tagging; mtu <span class="hljs-number"><span class="hljs-number">1600</span></span>; encapsulation flexible-ethernet-services; esi { <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>; all-active; } aggregated-ether-options { lacp { active; periodic fast; system-id <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>;</code> </pre> <br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-2</span></span>&gt; show configuration interfaces ae3 description <span class="hljs-string"><span class="hljs-string">"RZN-SW-1 | ae3&lt;&lt;&gt;&gt;ae0 | MC-LAG with RZN-PE-2"</span></span>; flexible-vlan-tagging; mtu <span class="hljs-number"><span class="hljs-number">1600</span></span>; encapsulation flexible-ethernet-services; esi { <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>; all-active; } aggregated-ether-options { lacp { active; periodic fast; system-id <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>;</code> </pre> <br> ,    . <br><br>   RZN-SW-1: <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-SW<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show lacp interfaces ae0 Aggregated interface: ae0 LACP state: Role Exp Def Dist Col Syn Aggr Timeout Activity ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> Actor No No Yes Yes Yes Yes Fast Active ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> Partner No No Yes Yes Yes Yes Fast Active ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> Actor No No Yes Yes Yes Yes Fast Active ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> Partner No No Yes Yes Yes Yes Fast Active LACP protocol: Receive State Transmit State Mux State ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> Current Fast periodic Collecting distributing ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> Current Fast periodic Collecting distributing</code> </pre> <br>   PE : <br><br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt; show lacp interfaces ae3 Aggregated interface: ae3 LACP state: Role Exp Def Dist Col Syn Aggr Timeout Activity ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> Actor No No Yes Yes Yes Yes Fast Active ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> Partner No No Yes Yes Yes Yes Fast Active LACP protocol: Receive State Transmit State Mux State ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> Current Fast periodic Collecting distributing</code> </pre> <br><pre> <code class="javascript hljs">bormoglotx@RZN-PE<span class="hljs-number"><span class="hljs-number">-2</span></span>&gt; show lacp interfaces ae3 Aggregated interface: ae3 LACP state: Role Exp Def Dist Col Syn Aggr Timeout Activity ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> Actor No No Yes Yes Yes Yes Fast Active ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> Partner No No Yes Yes Yes Yes Fast Active LACP protocol: Receive State Transmit State Mux State ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> Current Fast periodic Collecting distributing</code> </pre> <br>  ,    PE-    ,     CE ‚Äî   LAG ( LACP). <br><br>      ‚Äî   MC-LAG    (ICCP, ICL).   ,       .   EVPN/MPLS  MC-LAG     ,   ,  MC-LAG  All-Active     ICL,  ,  MC-LAG         (    ). <br><br>   EVPN  MC-LAG   ,   EVPN           (   VPLS     L2CKT    ‚Äî      EVPN).       ,   MC-LAG  2-  (EVPN multihoming   2- PE-   Active-Active);     PE-,    (   MC-LAG)         . <br><br>   ,   EVPN    multihoming,     VPLS.      EVPN Active-Active multihoming       .      100Mbps       50Mbos,         ,        ,        ,         .       L2VPN multihoming  Active-Active? <br><br>   ,       ,      . <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/329100/">https://habr.com/ru/post/329100/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329090/index.html">Evil lives in comparison functions.</a></li>
<li><a href="../329092/index.html">Telephony to the office for a stick of sausage</a></li>
<li><a href="../329094/index.html">Textures and RGB channels in Unreal Engine 4</a></li>
<li><a href="../329096/index.html">Who needs these SMS?</a></li>
<li><a href="../329098/index.html">Security Week 20: Fake WannaCry, HP has keylogger on firewood, Chrome downloads extra</a></li>
<li><a href="../329102/index.html">.NET Core: version numbers and global.json</a></li>
<li><a href="../329106/index.html">Fluent Design (not) shifting paradigms</a></li>
<li><a href="../329108/index.html">7 ways to display video from an RTSP IP camera on a webpage and 2 in a mobile application</a></li>
<li><a href="../329110/index.html">Terminology. Fight against complexity</a></li>
<li><a href="../329118/index.html">3CX technical support responds: how to get the credentials of the 3CX user portal and how to change the FQDN of the PBX server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>