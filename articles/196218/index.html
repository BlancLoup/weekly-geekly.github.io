<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We monitor everything: the expansion of Windows and Linux agents using scripts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If we need to monitor the status of servers and other computerized workstations using Zabbix, then this can be done in two ways. 

 The first way is w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We monitor everything: the expansion of Windows and Linux agents using scripts</h1><div class="post__text post__text-html js-mediator-article">  If we need to monitor the status of servers and other computerized workstations using Zabbix, then this can be done in two ways. <br><br>  The first way is with the help of SNMP requests, which Zabbix does wonderfully with sending.  So you can pull out and load network interfaces, and CPU, memory.  On top of this, server manufacturers can give us a lot of information about the state of iron via SNMP. <br><br>  The second is to use <a title="Zabbix agent" href="https://www.zabbix.com/documentation/ru/2.0/manual/concepts/agent">Zabbix agent</a> , which we will run on the monitored system.  <a title="List" href="https://www.zabbix.com/documentation/ru/2.0/manual/config/items/itemtypes/zabbix_agent">The list of</a> monitored parameters includes such simple things as CPU usage, memory usage, and more cunning ones, such as reading text log files with rotation support or tracking the fact that any file has changed.  You can even use the output of any arbitrary command on the system as a parameter.  Zabbix agent capabilities are growing from version to version. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage3/8b0/20b/72e/8b020b72e971bb264f40271e7629dd9a.png" alt="image"><br><br>  What to do if what we want to control via Zabbix is ‚Äã‚Äãnot in the list of features of Zabbix agent?  Wait until it is implemented by the developers in the next release?  Not necessary. <br><a name="habracut"></a><br>  We were left with a few standard interfaces in order to expand the capabilities of Zabbiks for monitoring servers as much as our imagination and the availability of free time to write scripts will allow us.  The interfaces are these <a title="UserParameter" href="https://www.zabbix.com/documentation/ru/2.0/manual/config/items/userparameters">UserParameter</a> and zabbix_sender.  We will talk about the first one, and as examples we will show how you can collect the status of SMART hard drives and monitor when someone uninstalls or installs new programs on their Windows machine. <br><br><h4>  Little materiel </h4><br>  If you have already configured Zabbix agent on the server at least once, then it will not be difficult to start using <strong>UserParameter</strong> .  To add a new parameter you need to do several things: <br><br><ul><li>  Add a line at the end of the <strong>zabbix_agentd.conf</strong> configuration file </li></ul><br><pre><code class="hljs xml">UserParameter=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span><span class="hljs-tag">&gt;</span></span>,<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  Where: <br><br>  <strong>&lt;key&gt;</strong> is a unique name that we invent ourselves.  We will use it when setting up a <a title="data item" href="https://www.zabbix.com/documentation/ru/2.0/manual/config/items">data item</a> in Zabbix. <br>  <strong>&lt;command&gt;</strong> is the command to be executed on the monitored <a title="host" href="https://www.zabbix.com/documentation/ru/2.0/manual/config/hosts">host</a> . <br><br>  But at once a very simple example that lies in every standard Linux config: <br><br><pre> <code class="hljs pgsql">UserParameter=<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>.test,who|wc -l</code> </pre> <br>  So, the <strong>key</strong> is <strong>system.test</strong> , and we execute the command <strong>who |</strong>  <strong>wc -l</strong> , which returns us the number of open sessions in the system.  Add (or uncomment this line if you already have), go ahead. <br><br><ul><li>  In Zabbix Web Console, create a new <strong>data item</strong> with the key that we used; if we take the example above, it is system.test. </li></ul><br>  To do this, click "Create a data item" <br><img src="https://habrastorage.org/storage3/d3a/9c3/bed/d3a9c3bedc0c532a262722ed82d6057a.png" alt="image"><br><br>  and then set the <strong>key</strong> the same as indicated in the config file, and the <strong>type of</strong> Zabbix agent: <br><br><img src="https://habrastorage.org/storage3/8b6/2b6/483/8b62b6483acb03fcba642be079deec17.png" alt="image"><br><ul><li>  Reboot the Zabbix agent to make changes in the config file take effect. </li></ul><br>  Observe the result in the <strong>latest data</strong> : <br><br><img src="https://habrastorage.org/storage3/514/0b3/ad0/5140b3ad0e6d36fcc651bbd77d62478e.png" alt="image"><br><br><h4>  SMART monitoring via UserParameter </h4><br>  The example above has little practical use, given that the standard <strong>system.users.num</strong> key already exists, which does exactly the same thing. <br><br>  So now we will consider an example which already will look more like a realistic one. <br><br>  If we are interested in monitoring the moment when it is time to change hard drives according to plan, then there are two options: <br><br><ol><li>  If the disks are behind a hardware RAID controller, then, as a rule, the operating system does not see the disks themselves.  Therefore, we are looking for ways to get information about the status of hard drives through utilities or SNMP-subagent, which we kindly provided (or did not provide) the manufacturer of the RAID controller.  For each separate series of controllers, your path to this information. </li><li>  If we are talking about just workstations, servers with software-based RAID, etc., then the disks can be accessed from the operating system, and we are free to use various utilities to read their status.  In the case of Zabbix, the <strong>smartctl</strong> utility <strong>comes</strong> from the <strong>SMARTMONTOOLS</strong> package <strong>.</strong> </li></ol><br>  In Debian, installing SMARTMONTOOLS comes down to: <br><br><pre> <code class="bash hljs">sudo apt-get install smartmontools</code> </pre> <br>  and the utility is ready to use. <br><br>  For each disk that is in the system, first verify that SMART is enabled: <br><br><pre> <code class="bash hljs">sudo smartctl -i /dev/sda | grep SMART SMART support is: Available - device has SMART capability. SMART support is: Enabled</code> </pre> <br>  if suddenly SMART is supported by a disk, but turned off, then activate it: <br><br><pre> <code class="bash hljs">sudo smartctl -s on -S on -o on /dev/sda smartctl version 5.37 [i686-pc-linux-gnu] Copyright (C) 2002-6 Bruce Allen Home page is http://smartmontools.sourceforge.net/ === START OF ENABLE/DISABLE COMMANDS SECTION === SMART Enabled. SMART Attribute Autosave Enabled. SMART Automatic Offline Testing Enabled every four hours.</code> </pre> <br>  Now we can check the SMART status with the command: <br><br><pre> <code class="bash hljs">sudo smartctl -H /dev/sda |grep <span class="hljs-string"><span class="hljs-string">"test"</span></span>| cut -f2 -d: |tr -d <span class="hljs-string"><span class="hljs-string">" "</span></span></code> </pre> <br>  This is the <strong>command that</strong> we will write to our <strong>zabbix_agentd.conf:</strong> <br><br><pre> <code class="xml hljs">UserParameter=uHDD.health,sudo smartctl -H /dev/sda |grep "test"| cut -f2 -d: |tr -d " "</code> </pre> <br>  where uHDD.health is the <strong>key.</strong> <br><br><h4>  SMART monitoring via Flexible UserParameter </h4><br>  This raises a reasonable question, how to be if there are two disks.  The easiest way to solve this problem is the <a title="ability" href="https://www.zabbix.com/documentation/ru/2.0/manual/config/items/userparameters">ability of the</a> <strong>UserParameter to</strong> pass parameters to the agent, about which we have not yet mentioned.  But everything is done very simply, just an example: <br><br><pre> <code class="xml hljs">UserParameter=uHDD.health.[*],sudo smartctl -H /dev/$1 |grep "test"| cut -f2 -d: |tr -d " "</code> </pre> <br>  In the Zabbix web interface in the key, we will substitute the parameters in square brackets instead of *.  For example, for one <strong>data element</strong> we write <strong>sda</strong> , and for another one <strong>sdb</strong> .  In the command, this parameter will be reflected where the <strong>$ 1</strong> variable is <strong>.</strong> <br><br><img src="https://habrastorage.org/storage3/b40/660/fbf/b40660fbf5dae842dde1b18fc3fc4d86.png" alt="image"><br><br>  Let's create <strong>an item</strong> for the second disk: <br><br><img src="https://habrastorage.org/storage3/213/fce/6a9/213fce6a91aaba78ecc883327861db2d.png" alt="image"><br><br>  And after some time we will be able to observe the result in the <strong>latest data:</strong> <br><br><img src="https://habrastorage.org/storage3/f24/b19/b71/f24b19b717496d06f05d7daad05d1ac2.png" alt="image"><br><br><h4>  SMART monitoring via Flexible UserParameter with Low-level Discovery </h4><br>  Everything worked out.  But then there is a reasonable question, how to be if the disks are not two but twenty two.  And here we have a great <a title="low level detection" href="https://www.zabbix.com/documentation/ru/2.0/manual/discovery/low_level_discovery">low-level detection</a> (LLD) feature that we <a href="http://habrahabr.ru/company/zabbix/blog/193460/">already talked about</a> . <br><br>  <strong>Low-level detection</strong> allows the monitoring system to detect how many elements of the same type are present on a <strong>network node</strong> and dynamically create the necessary <strong>data elements, triggers</strong> and <strong>graphs</strong> for these elements using a template.  Out of the box, the system is able to find file systems, network interfaces, and SNMP OIDs.  However, here too, the developers left the opportunity to supplement the standard features; you just need to transfer to the system information about which elements were found in the JSON format.  We will use this. <br><br>  Create a small perl script, <strong>smartctl-disks-discovery.pl</strong> .  It will find all disks in the system and display this information in JSON, passing also information whether the SMART disk is enabled or not, and also tries to enable SMART itself if it is turned off: <br><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl #must be run as root $first = 1; print "{\n"; print "\t\"data\":[\n\n"; for (`ls -l /dev/disk/by-id/ | cut -d"/" -f3 | sort -n | uniq -w 3`) { #DISK LOOP $smart_avail=0; $smart_enabled=0; $smart_enable_tried=0; #next when total 0 at output if ($_ eq "total 0\n") { next; } print "\t,\n" if not $first; $first = 0; $disk =$_; chomp($disk); #SMART STATUS LOOP foreach(`smartctl -i /dev/$disk | grep SMART`) { $line=$_; # if SMART available -&gt; continue if ($line = /Available/){ $smart_avail=1; next; } #if SMART is disabled then try to enable it (also offline tests etc) if ($line = /Disabled/ &amp; $smart_enable_tried == 0){ foreach(`smartctl -i /dev/$disk -s on -o on -S on | grep SMART`) { if (/SMART Enabled/){ $smart_enabled=1; next; } } $smart_enable_tried=1; } if ($line = /Enabled/){ $smart_enabled=1; } } print "\t{\n"; print "\t\t\"{#DISKNAME}\":\"$disk\",\n"; print "\t\t\"{#SMART_ENABLED}\":\"$smart_enabled\"\n"; print "\t}\n"; } print "\n\t]\n"; print "}\n";</span></span></code> </pre> <br><br>  When you run the script gives: <br><pre> <code class="bash hljs">$ /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/smartctl-disks-discovery.pl</code> </pre> <br><pre> <code class="xml hljs">{ "data":[ { "{#DISKNAME}":"md0", "{#SMART_ENABLED}":"0" }, { "{#DISKNAME}":"md1", "{#SMART_ENABLED}":"0" }, { "{#DISKNAME}":"sda", "{#SMART_ENABLED}":"1" }, { "{#DISKNAME}":"sdb", "{#SMART_ENABLED}":"1" }] }</code> </pre> <br>  Now, in order for the script to be automatically launched by Zabbix, simply add another <strong>UserParameter</strong> to the <strong>zabbix_agentd.conf</strong> : <br><br><pre> <code class="hljs pgsql">UserParameter=uHDD.discovery,sudo /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/bin/smartctl-disks-discovery.pl</code> </pre> <br>  Having finished configuring the configuration, go to the web interface, where we create a new <strong>detection rule</strong> for smartctl: <br><br><img src="https://habrastorage.org/storage3/357/5d3/327/3575d3327d7df5b3a9da10dc05fface4.png" alt="image"><br><br>  Pay attention to the <strong>key</strong> and <strong>filter</strong> , ({#SMART_ENABLED} = 1) thanks to the latter, only those detected disks that support SMART will be added.  Now we can rewrite our two <strong>data elements</strong> for sda and sdb disks into one <strong>prototype of data elements,</strong> simply replacing the disk name with the macro {#DISKNAME}: <br><br><img src="https://habrastorage.org/storage3/f12/b49/f15/f12b49f154f4e8e4975fda559b81d1f0.png" alt="image"><br><br>  Last, before Zabbix can run the commands that we have registered in <strong>zabbix_agentd.conf</strong> as root and monitor SMART, you need to add permissions for its user to run this command without entering a password, for this we add the following line to / etc / sudoers: <br><br><pre> <code class="bash hljs">zabbix ALL= (ALL) NOPASSWD: /usr/sbin/smartctl,/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/smartctl-disks-discovery.pl</code> </pre> <br>  A ready-made template for monitoring SMART with the rest of the data elements, I attach triggers, as well as the config file configured for it. <br><br><h4>  Monitoring the installation of new programs on Windows </h4><br>  Zabbix agent installed on Windows can also be extended via <strong>UserParameter</strong> , but the commands will be different.  Although, for example, smartctl is a cross-platform utility, and you can also use it to control hard drives in Windows. <br><br>  Briefly consider another example.  The task is to receive a notification each time a user uninstalls or installs programs. <br>  For this we will use our vbs-script: <br><br><div class="spoiler">  <b class="spoiler_title">uDiffPrograms.vbs</b> <div class="spoiler_text"><pre> <code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'KNOWN ISSUE: If Application name conatins '-' symbol then e-mail alert containing software list will be sent all on one line instead of each packet on a single line variable=InstalledApplications(".") 'WScript.Echo strConvert(variable,"Windows-1251","cp866") Const ForReading = 1 zabbix_dir="C:\zabbix\" Set objFSO = CreateObject("Scripting.FileSystemObject") 'Create old file if does not exist If objFSO.FileExists(zabbix_dir&amp;"uDiffPrograms_old.txt")=0 Then Set objFile4 = objFSO.CreateTextFile(zabbix_dir&amp;"uDiffPrograms_old.txt") objFile4.WriteLine variable objFile4.Close Call ConvertCharsetFile("0x0") WScript.Quit End if 'Create 'new' file Set objFile3 = objFSO.CreateTextFile(zabbix_dir&amp;"uDiffPrograms_new.txt") objFile3.WriteLine variable objFile3.Close 'Compare old and new files Set objArgs = Wscript.Arguments Set objFile5= objFSO.GetFile(zabbix_dir&amp;"uDiffPrograms_new.txt") Set objFile6 = objFSO.GetFile(zabbix_dir&amp;"uDiffPrograms_old.txt") If objFile5.Size &lt;&gt; objFile6.Size Then ' Wscript.Echo "The file is different." Else 'Wscript.Echo "They are the same." objFSO.DeleteFile zabbix_dir&amp;"uDiffPrograms_new.txt" Call ConvertCharsetFile("0x0") WScript.Quit End If 'Search for removed applications Set objFile2 = objFSO.OpenTextFile(zabbix_dir&amp;"uDiffPrograms_old.txt", ForReading) Do Until objFile2.AtEndOfStream strAddress2 = objFile2.ReadLine If InStr(variable, strAddress2&amp;vbCrLf) = 0 Then strNotCurrent2 = strNotCurrent2 &amp; strAddress2 &amp; vbCrLf End If Loop objFile2.Close 'Search for installed applications Set objFile1 = objFSO.OpenTextFile(zabbix_dir&amp;"uDiffPrograms_old.txt", ForReading) oldvar = objFile1.ReadAll objFile1.Close objFSO.DeleteFile zabbix_dir&amp;"uDiffPrograms_old.txt" Set objFile2 = objFSO.OpenTextFile(zabbix_dir&amp;"uDiffPrograms_new.txt", ForReading) Do Until objFile2.AtEndOfStream strAddress = objFile2.ReadLine If InStr(oldvar, strAddress&amp;vbCrLf) = 0 Then strNotCurrent = strNotCurrent &amp; strAddress &amp; vbCrLf End If Loop objFile2.Close 'Rename C:\zabbix\uDiffPrograms_new.txt to C:\zabbix\uDiffPrograms_old.txt objFSO.MoveFile zabbix_dir&amp;"uDiffPrograms_new.txt" , zabbix_dir&amp;"uDiffPrograms_old.txt" 'Output if strNotCurrent &lt;&gt; "" and strNotCurrent2 &lt;&gt; "" then Call ConvertCharsetFile("   :" &amp; vbCrLf &amp; strNotCurrent &amp; vbCrLf &amp; "   :" &amp; vbCrLf &amp; strNotCurrent2) Wscript.Quit End if if strNotCurrent &lt;&gt; "" then Call ConvertCharsetFile("   :" &amp; vbCrLf &amp; strNotCurrent) End if if strNotCurrent2 &lt;&gt; "" then Call ConvertCharsetFile("   :" &amp; vbCrLf &amp; strNotCurrent2) End If Function InstalledApplications(node) '''with Versions Const HKLM = &amp;H80000002 'HKEY_LOCAL_MACHINE Set oRegistry = GetObject("winmgmts://" _ &amp; node &amp; "/root/default:StdRegProv") sBaseKey = _ "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\" iRC = oRegistry.EnumKey(HKLM, sBaseKey, arSubKeys) For Each sKey In arSubKeys iRC = oRegistry.GetStringValue( _ HKLM, sBaseKey &amp; sKey, "DisplayName", sValue) If iRC &lt;&gt; 0 Then oRegistry.GetStringValue _ HKLM, sBaseKey &amp; sKey, "QuietDisplayName", sValue End If If sValue &lt;&gt; "" and instr(sValue, "KB")=0 Then 'instr(sValue, "KB")=0 - to exlude KB-indexed Microsoft Patches If instr(InstalledApplications, sValue&amp;vbCrLf)=0 then 'and instr(InstalledApplications, sValue&amp;vbCrLf)=0 - to exlude possible dublicates InstalledApplications = _ InstalledApplications &amp; sValue &amp; vbCrLf End If End If Next End Function Function ConvertCharsetFile(input) Const adTypeBinary = 1 Const adTypeText = 2 Const bOverwrite = True Const bAsASCII = False 'Write to temp file Set objFSO = CreateObject("Scripting.FileSystemObject") If objFSO.FileExists( zabbix_dir&amp;"uDiffPrograms_temp.txt" ) Then objFSO.DeleteFile zabbix_dir&amp;"uDiffPrograms_temp.txt" Set objFile3 = objFSO.CreateTextFile(zabbix_dir&amp;"uDiffPrograms_temp.txt") objFile3.WriteLine input objFile3.Close Dim oFS : Set oFS = CreateObject( "Scripting.FileSystemObject" ) Dim sFFSpec : sFFSpec = oFS.GetAbsolutePathName( zabbix_dir&amp;"uDiffPrograms_temp.txt" ) Dim oFrom : Set oFrom = CreateObject( "ADODB.Stream" ) Dim sFrom : sFrom = "windows-1251" Dim oTo : Set oTo = CreateObject( "ADODB.Stream" ) Dim sTo : sTo = "utf-8" oFrom.Type = adTypeText oFrom.Charset = sFrom oFrom.Open oFrom.LoadFromFile sFFSpec oTo.Type = adTypeText oTo.Charset = sTo oTo.Open oTo.WriteText oFrom.ReadText oFrom.Close If oFS.FileExists( sFFSpec ) Then oFS.DeleteFile sFFSpec oTo.SaveToFile sFFSpec oTo.Close End Function '=============================================================================</span></span></code> </pre> </div></div><br><br>  To integrate it with Zabbix, add a <strong>UserParameter</strong> to the config file: <br><br><pre> <code class="hljs tex">UserParameter=uDiffPrograms, cscript.exe /nologo "C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">zabbix</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uDiffPrograms</span></span></span></span>.vbs" &amp; type C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">zabbix</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uDiffPrograms</span></span></span></span>_temp.txt</code> </pre> <br>  Add <strong>a data item</strong> to the template for Windows: <br><br><img src="https://habrastorage.org/storage3/1a6/766/ed1/1a6766ed13dbd39cd2eadae3822e7231.png" alt="image"><br><br>  Add a <strong>trigger</strong> : <br><br><img src="https://habrastorage.org/storage3/1a2/700/fed/1a2700fed2ccf5a8699740bb3cf18b13.png" alt="image"><br><br>  and the <strong>action</strong> that will send an email notification: <br><br><img src="https://habrastorage.org/storage3/45e/de8/0df/45ede80dfd9d26655b0312bdba2cbd2f.png" alt="image"><br><br>  The whole monitoring process looks like this: every hour the Zabbix script is started by the agent that compares two lists of programs: the current and the previous one.  Then the script writes all the changes to a separate file.  If there are no changes, then <strong>0x0</strong> is written to the file. <br><br>  The content of the file goes to the Zabbix server, where the <strong>trigger is</strong> raised if the value <strong>of the</strong> uDiffProgramms <strong>data element is</strong> different from <strong>0x0.</strong>  Then a separate action sends a notification by mail with a list of what was installed or deleted on this computer: <br><br><img src="https://habrastorage.org/storage3/4e8/fb2/d6e/4e8fb2d6eadc1503a66ae43abe1e9b28.png"><br><br><h4>  Eventually </h4><br>  <strong>UserParameter is a</strong> great and easy way to expand the functionality of the system yourself.  It is worth mentioning the alternatives: <strong>zabbix_sender,</strong> which, for example, is suitable for those cases when you need to send data to Zabbix not on a schedule, (as the <strong>UserParameter</strong> does), but on some event;  and <strong>system.run []</strong> , which is similar to <strong>UserParameter</strong> , but it is more convenient because you do not need to make changes to all configs of agents, it is enough just to add this data element to the template.  Moreover, in the next major release of Zabbix 2.2, another new way of expanding agent capabilities awaits us ‚Äî <a title="plug-ins" href="https://www.zabbix.com/documentation/2.2/manual/config/items/loadablemodules">plug-ins</a> .  Look forward to! <br><br>  So, consider that if you can learn something about the system with a script or a command, it means that you can always transfer it to Zabbix. </div><p>Source: <a href="https://habr.com/ru/post/196218/">https://habr.com/ru/post/196218/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196204/index.html">Responsive design: now it's not about screen size</a></li>
<li><a href="../196206/index.html">01 Collector: Friday Content</a></li>
<li><a href="../196208/index.html">Mobile app development with Dropbox Datastore API</a></li>
<li><a href="../196212/index.html">SDK from Yandex.Disk</a></li>
<li><a href="../196214/index.html">Fell off Github.com</a></li>
<li><a href="../196220/index.html">How to achieve a balance between work and life</a></li>
<li><a href="../196222/index.html">Marine robot Scout sailed independently over 1600 kilometers</a></li>
<li><a href="../196224/index.html">Customization of transitional animations between the Activity in Android OS</a></li>
<li><a href="../196226/index.html">Introduction to the analysis of the complexity of algorithms (part 4)</a></li>
<li><a href="../196228/index.html">We are building a stand to prepare for the CCIE with the help of the IOU Web Interface</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>