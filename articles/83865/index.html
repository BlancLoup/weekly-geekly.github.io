<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>nodeJS and nonblocking I / O</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good evening, dear readers, 
 On Habr√© recently there were a few mentions of node, a fast platform for creating web applications in javascript, which ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>nodeJS and nonblocking I / O</h1><div class="post__text post__text-html js-mediator-article"><h3>  Good evening, dear readers, </h3><br>  On Habr√© recently there were a few mentions of node, a fast platform for creating web applications in javascript, which has a rather unique to date feature, non-blocking I / O (input / output). <br><br><h3>  To begin with about nodeJS: </h3><br>  1) JavaScript is used as a language. <br>  2) To execute JavaScript, the V8 engine from Google is used, which works fairly quickly due to compiling into machine code before execution. <br>  3) To implement non-blocking I / O, libev and libeio are used (libev shows better results than libevent) <br>  4) The commonJS syntax is selected to implement the library connection. <br>  5) It is possible to write modules also in C / C ++, while they are connected in exactly the same way as js modules, this will allow you, for example, to rewrite any bottleneck in your application in C ++ without any difficulties. <br><br>  In the process of studying this moment, which eventually led to the writing of this article, I managed to play pretty well with this particular feature.  And I can say that non-blocking I / O has a very, very positive effect on performance and resistance to stress. <br><a name="habracut"></a><br><img src="http://nodejs.ru/wp-content/uploads/2010/02/Rhino-run.jpg" title="Rhino-run">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Consider three schemes: </h4><br>  1) Multiprocessor models (For each user in the process) <br>  2) Single Process Event-Loop <br>  3) Single Process Event-Loop with Non-Blocking I / O (NodeJS) <br><br>  Suppose there is only one processor with one core in our system (If there are more cores, we can simply run several instances of our application) <br><br>  And now about each one more specifically: <br><br><h5>  1) Multi-process application </h5>  With large loads (large number of connections) it will show very bad results, since each user will be assigned a separate process, as a result, a lot of RAM will be consumed, and the processor will be overloaded, as a change of processes is a rather expensive operation <br><br><h5>  2) Single Process Event-Loop </h5>  On the one hand, such an approach would be better to behave under loads, because the process is only one, which means that unnecessary random access memory and extra calculations for changing processes are not required, but everything is not so simple, because every time we read a file in our application, or we make a request to the database, the entire event loop stops and waits for a response from the hard disk or server, while the processor does nothing at this time, the efficiency drops seriously <br><br><h5>  3) Single Process Event-Loop with Non-Blocking I / O </h5>  This approach combines the advantages of the first two, we do not spend extra memory, do not do unnecessary calculations to change processes, but the application does not stand idle while we read the file, we turn to DB, etc. ... However, this method has one serious drawback.  Developing such applications is very difficult.  It was!  But now there is a nodeJS! <br><br>  Here is the simplest example from the official site: <br><blockquote><code><a href="http://127.0.0.1/"></a> <font color="black"><font color="#003366"><b>var</b></font> sys <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'sys'</font> <font color="#009900">)</font> <font color="#339933">,</font> http <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'http'</font> <font color="#009900">)</font> <font color="#339933">;</font> http. <font color="#660066">createServer</font> <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> req <font color="#339933">,</font> res <font color="#009900">)</font> <font color="#009900">{</font> setTimeout <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> res. <font color="#660066">sendHeader</font> <font color="#009900">(</font> <font color="#CC0000">200</font> <font color="#339933">,</font> <font color="#009900">{</font> <font color="#3366CC">'Content-Type'</font> <font color="#339933">:</font> <font color="#3366CC">'text/plain'</font> <font color="#009900">}</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">sendBody</font> <font color="#009900">(</font> <font color="#3366CC">'Hello World'</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">finish</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#339933">,</font> <font color="#CC0000">2000</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">)</font> . <font color="#660066">listen</font> <font color="#009900">(</font> <font color="#CC0000">8000</font> <font color="#009900">)</font> <font color="#339933">;</font> sys. <font color="#660066">puts</font> <font color="#009900">(</font> <font color="#3366CC">'Server running at 127.0.0.1:8000/'</font> <font color="#009900">)</font> <font color="#339933">;</font></font></code> <ol><li> <code><font color="black"><a href="http://127.0.0.1/"></a> <font color="#003366"><b>var</b></font> sys <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'sys'</font> <font color="#009900">)</font> <font color="#339933">,</font> http <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'http'</font> <font color="#009900">)</font> <font color="#339933">;</font> http. <font color="#660066">createServer</font> <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> req <font color="#339933">,</font> res <font color="#009900">)</font> <font color="#009900">{</font> setTimeout <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> res. <font color="#660066">sendHeader</font> <font color="#009900">(</font> <font color="#CC0000">200</font> <font color="#339933">,</font> <font color="#009900">{</font> <font color="#3366CC">'Content-Type'</font> <font color="#339933">:</font> <font color="#3366CC">'text/plain'</font> <font color="#009900">}</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">sendBody</font> <font color="#009900">(</font> <font color="#3366CC">'Hello World'</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">finish</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#339933">,</font> <font color="#CC0000">2000</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">)</font> . <font color="#660066">listen</font> <font color="#009900">(</font> <font color="#CC0000">8000</font> <font color="#009900">)</font> <font color="#339933">;</font> sys. <font color="#660066">puts</font> <font color="#009900">(</font> <font color="#3366CC">'Server running at 127.0.0.1:8000/'</font> <font color="#009900">)</font> <font color="#339933">;</font></font></code> </li> <li> <code><font color="black"><a href="http://127.0.0.1/"></a> <font color="#003366"><b>var</b></font> sys <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'sys'</font> <font color="#009900">)</font> <font color="#339933">,</font> http <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'http'</font> <font color="#009900">)</font> <font color="#339933">;</font> http. <font color="#660066">createServer</font> <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> req <font color="#339933">,</font> res <font color="#009900">)</font> <font color="#009900">{</font> setTimeout <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> res. <font color="#660066">sendHeader</font> <font color="#009900">(</font> <font color="#CC0000">200</font> <font color="#339933">,</font> <font color="#009900">{</font> <font color="#3366CC">'Content-Type'</font> <font color="#339933">:</font> <font color="#3366CC">'text/plain'</font> <font color="#009900">}</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">sendBody</font> <font color="#009900">(</font> <font color="#3366CC">'Hello World'</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">finish</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#339933">,</font> <font color="#CC0000">2000</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">)</font> . <font color="#660066">listen</font> <font color="#009900">(</font> <font color="#CC0000">8000</font> <font color="#009900">)</font> <font color="#339933">;</font> sys. <font color="#660066">puts</font> <font color="#009900">(</font> <font color="#3366CC">'Server running at 127.0.0.1:8000/'</font> <font color="#009900">)</font> <font color="#339933">;</font></font></code> </li> <li> <code><font color="black"><a href="http://127.0.0.1/"></a> <font color="#003366"><b>var</b></font> sys <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'sys'</font> <font color="#009900">)</font> <font color="#339933">,</font> http <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'http'</font> <font color="#009900">)</font> <font color="#339933">;</font> http. <font color="#660066">createServer</font> <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> req <font color="#339933">,</font> res <font color="#009900">)</font> <font color="#009900">{</font> setTimeout <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> res. <font color="#660066">sendHeader</font> <font color="#009900">(</font> <font color="#CC0000">200</font> <font color="#339933">,</font> <font color="#009900">{</font> <font color="#3366CC">'Content-Type'</font> <font color="#339933">:</font> <font color="#3366CC">'text/plain'</font> <font color="#009900">}</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">sendBody</font> <font color="#009900">(</font> <font color="#3366CC">'Hello World'</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">finish</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#339933">,</font> <font color="#CC0000">2000</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">)</font> . <font color="#660066">listen</font> <font color="#009900">(</font> <font color="#CC0000">8000</font> <font color="#009900">)</font> <font color="#339933">;</font> sys. <font color="#660066">puts</font> <font color="#009900">(</font> <font color="#3366CC">'Server running at 127.0.0.1:8000/'</font> <font color="#009900">)</font> <font color="#339933">;</font></font></code> </li> <li> <code><font color="black"><a href="http://127.0.0.1/"></a> <font color="#003366"><b>var</b></font> sys <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'sys'</font> <font color="#009900">)</font> <font color="#339933">,</font> http <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'http'</font> <font color="#009900">)</font> <font color="#339933">;</font> http. <font color="#660066">createServer</font> <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> req <font color="#339933">,</font> res <font color="#009900">)</font> <font color="#009900">{</font> setTimeout <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> res. <font color="#660066">sendHeader</font> <font color="#009900">(</font> <font color="#CC0000">200</font> <font color="#339933">,</font> <font color="#009900">{</font> <font color="#3366CC">'Content-Type'</font> <font color="#339933">:</font> <font color="#3366CC">'text/plain'</font> <font color="#009900">}</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">sendBody</font> <font color="#009900">(</font> <font color="#3366CC">'Hello World'</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">finish</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#339933">,</font> <font color="#CC0000">2000</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">)</font> . <font color="#660066">listen</font> <font color="#009900">(</font> <font color="#CC0000">8000</font> <font color="#009900">)</font> <font color="#339933">;</font> sys. <font color="#660066">puts</font> <font color="#009900">(</font> <font color="#3366CC">'Server running at 127.0.0.1:8000/'</font> <font color="#009900">)</font> <font color="#339933">;</font></font></code> </li> <li> <code><font color="black"><a href="http://127.0.0.1/"></a> <font color="#003366"><b>var</b></font> sys <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'sys'</font> <font color="#009900">)</font> <font color="#339933">,</font> http <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'http'</font> <font color="#009900">)</font> <font color="#339933">;</font> http. <font color="#660066">createServer</font> <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> req <font color="#339933">,</font> res <font color="#009900">)</font> <font color="#009900">{</font> setTimeout <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> res. <font color="#660066">sendHeader</font> <font color="#009900">(</font> <font color="#CC0000">200</font> <font color="#339933">,</font> <font color="#009900">{</font> <font color="#3366CC">'Content-Type'</font> <font color="#339933">:</font> <font color="#3366CC">'text/plain'</font> <font color="#009900">}</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">sendBody</font> <font color="#009900">(</font> <font color="#3366CC">'Hello World'</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">finish</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#339933">,</font> <font color="#CC0000">2000</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">)</font> . <font color="#660066">listen</font> <font color="#009900">(</font> <font color="#CC0000">8000</font> <font color="#009900">)</font> <font color="#339933">;</font> sys. <font color="#660066">puts</font> <font color="#009900">(</font> <font color="#3366CC">'Server running at 127.0.0.1:8000/'</font> <font color="#009900">)</font> <font color="#339933">;</font></font></code> </li> <li> <code><font color="black"><a href="http://127.0.0.1/"></a> <font color="#003366"><b>var</b></font> sys <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'sys'</font> <font color="#009900">)</font> <font color="#339933">,</font> http <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'http'</font> <font color="#009900">)</font> <font color="#339933">;</font> http. <font color="#660066">createServer</font> <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> req <font color="#339933">,</font> res <font color="#009900">)</font> <font color="#009900">{</font> setTimeout <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> res. <font color="#660066">sendHeader</font> <font color="#009900">(</font> <font color="#CC0000">200</font> <font color="#339933">,</font> <font color="#009900">{</font> <font color="#3366CC">'Content-Type'</font> <font color="#339933">:</font> <font color="#3366CC">'text/plain'</font> <font color="#009900">}</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">sendBody</font> <font color="#009900">(</font> <font color="#3366CC">'Hello World'</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">finish</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#339933">,</font> <font color="#CC0000">2000</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">)</font> . <font color="#660066">listen</font> <font color="#009900">(</font> <font color="#CC0000">8000</font> <font color="#009900">)</font> <font color="#339933">;</font> sys. <font color="#660066">puts</font> <font color="#009900">(</font> <font color="#3366CC">'Server running at 127.0.0.1:8000/'</font> <font color="#009900">)</font> <font color="#339933">;</font></font></code> </li> <li> <code><font color="black"><a href="http://127.0.0.1/"></a> <font color="#003366"><b>var</b></font> sys <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'sys'</font> <font color="#009900">)</font> <font color="#339933">,</font> http <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'http'</font> <font color="#009900">)</font> <font color="#339933">;</font> http. <font color="#660066">createServer</font> <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> req <font color="#339933">,</font> res <font color="#009900">)</font> <font color="#009900">{</font> setTimeout <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> res. <font color="#660066">sendHeader</font> <font color="#009900">(</font> <font color="#CC0000">200</font> <font color="#339933">,</font> <font color="#009900">{</font> <font color="#3366CC">'Content-Type'</font> <font color="#339933">:</font> <font color="#3366CC">'text/plain'</font> <font color="#009900">}</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">sendBody</font> <font color="#009900">(</font> <font color="#3366CC">'Hello World'</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">finish</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#339933">,</font> <font color="#CC0000">2000</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">)</font> . <font color="#660066">listen</font> <font color="#009900">(</font> <font color="#CC0000">8000</font> <font color="#009900">)</font> <font color="#339933">;</font> sys. <font color="#660066">puts</font> <font color="#009900">(</font> <font color="#3366CC">'Server running at 127.0.0.1:8000/'</font> <font color="#009900">)</font> <font color="#339933">;</font></font></code> </li> <li> <code><font color="black"><a href="http://127.0.0.1/"></a> <font color="#003366"><b>var</b></font> sys <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'sys'</font> <font color="#009900">)</font> <font color="#339933">,</font> http <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'http'</font> <font color="#009900">)</font> <font color="#339933">;</font> http. <font color="#660066">createServer</font> <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> req <font color="#339933">,</font> res <font color="#009900">)</font> <font color="#009900">{</font> setTimeout <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> res. <font color="#660066">sendHeader</font> <font color="#009900">(</font> <font color="#CC0000">200</font> <font color="#339933">,</font> <font color="#009900">{</font> <font color="#3366CC">'Content-Type'</font> <font color="#339933">:</font> <font color="#3366CC">'text/plain'</font> <font color="#009900">}</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">sendBody</font> <font color="#009900">(</font> <font color="#3366CC">'Hello World'</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">finish</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#339933">,</font> <font color="#CC0000">2000</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">)</font> . <font color="#660066">listen</font> <font color="#009900">(</font> <font color="#CC0000">8000</font> <font color="#009900">)</font> <font color="#339933">;</font> sys. <font color="#660066">puts</font> <font color="#009900">(</font> <font color="#3366CC">'Server running at 127.0.0.1:8000/'</font> <font color="#009900">)</font> <font color="#339933">;</font></font></code> </li> <li> <code><font color="black"><a href="http://127.0.0.1/"></a> <font color="#003366"><b>var</b></font> sys <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'sys'</font> <font color="#009900">)</font> <font color="#339933">,</font> http <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'http'</font> <font color="#009900">)</font> <font color="#339933">;</font> http. <font color="#660066">createServer</font> <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> req <font color="#339933">,</font> res <font color="#009900">)</font> <font color="#009900">{</font> setTimeout <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> res. <font color="#660066">sendHeader</font> <font color="#009900">(</font> <font color="#CC0000">200</font> <font color="#339933">,</font> <font color="#009900">{</font> <font color="#3366CC">'Content-Type'</font> <font color="#339933">:</font> <font color="#3366CC">'text/plain'</font> <font color="#009900">}</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">sendBody</font> <font color="#009900">(</font> <font color="#3366CC">'Hello World'</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">finish</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#339933">,</font> <font color="#CC0000">2000</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">)</font> . <font color="#660066">listen</font> <font color="#009900">(</font> <font color="#CC0000">8000</font> <font color="#009900">)</font> <font color="#339933">;</font> sys. <font color="#660066">puts</font> <font color="#009900">(</font> <font color="#3366CC">'Server running at 127.0.0.1:8000/'</font> <font color="#009900">)</font> <font color="#339933">;</font></font></code> </li> <li> <code><font color="black"><a href="http://127.0.0.1/"></a> <font color="#003366"><b>var</b></font> sys <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'sys'</font> <font color="#009900">)</font> <font color="#339933">,</font> http <font color="#339933">=</font> require <font color="#009900">(</font> <font color="#3366CC">'http'</font> <font color="#009900">)</font> <font color="#339933">;</font> http. <font color="#660066">createServer</font> <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> req <font color="#339933">,</font> res <font color="#009900">)</font> <font color="#009900">{</font> setTimeout <font color="#009900">(</font> <font color="#003366"><b>function</b></font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> res. <font color="#660066">sendHeader</font> <font color="#009900">(</font> <font color="#CC0000">200</font> <font color="#339933">,</font> <font color="#009900">{</font> <font color="#3366CC">'Content-Type'</font> <font color="#339933">:</font> <font color="#3366CC">'text/plain'</font> <font color="#009900">}</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">sendBody</font> <font color="#009900">(</font> <font color="#3366CC">'Hello World'</font> <font color="#009900">)</font> <font color="#339933">;</font> res. <font color="#660066">finish</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#339933">,</font> <font color="#CC0000">2000</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">)</font> . <font color="#660066">listen</font> <font color="#009900">(</font> <font color="#CC0000">8000</font> <font color="#009900">)</font> <font color="#339933">;</font> sys. <font color="#660066">puts</font> <font color="#009900">(</font> <font color="#3366CC">'Server running at 127.0.0.1:8000/'</font> <font color="#009900">)</font> <font color="#339933">;</font></font></code> </li> </ol></blockquote><br>  It's simple, the script waits 2 seconds and sends you Hello World.  It would seem a very simple task, but let's write for example in python. <br>  Take a well-proven library, tornado (most likely the fastest to date) and write: <br><br><blockquote> <code><a href="http://s-c.me/5366/s"></a> <a href="http://s-c.me/5366/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  #! / usr / bin / env python </li><li>  import tornado.httpserver </li><li>  import tornado.ioloop </li><li>  import tornado.web </li><li>  import <font color="#0000ff">time</font> </li><li></li><li>  <font color="#0000ff">class</font> MainHandler (tornado.web.RequestHandler): </li><li>  def <font color="#0000ff">get</font> (self): </li><li>  <font color="#0000ff">time</font> .sleep (2) </li><li>  self.  <font color="#0000ff">write</font> ("Hello World") </li><li></li><li>  application = tornado.web.Application ([ </li><li>  (r "/", MainHandler), </li><li>  ]) </li><li></li><li>  <font color="#0000ff">if</font> __name__ == "__main__": </li><li>  http_server = tornado.httpserver.HTTPServer (application) </li><li>  http_server.listen (8888) </li><li>  tornado.ioloop.IOLoop.instance ().  <font color="#0000ff">start</font> () </li></ol></blockquote><br><br>  It turned out also quite short and elegant. <br><br>  We are testing (10 users suddenly turned to our web server, it can be more, but ApacheBench is not as patient as I ..): <br><br><h3>  Python, Tornado </h3><br><pre> ab -n 10 -c 10 http://127.0.0.1:8888/
 Time taken for tests: 20.078 seconds
</pre><br><br><h3>  nodeJS </h3><br><pre> ab -n 10 -c 10 http://127.0.0.1:8000/
 Time taken for tests: 2.007 seconds
</pre><br><br><blockquote>  I didn‚Äôt want to offend Python, because the whole thing is that time.sleep is a blocking function, that is, it blocks the entire event loop, just as the event loop in python is blocked by almost everything related to input and output, and only advanced programmers know how to do it. or another action without blocking the interpreter, and often davolno solutions for this rather cumbersome and ugly. </blockquote><br><br>  Of course, two examples are absolutely not equivalent, but writing an asynchronous code on Python will require more effort than a node simply because all standard calls are asynchronous to the node ... And even a novice will write fast code on it. <br><br>  I think everything became clear ... And I have no doubt that the Python programmer will quickly rewrite my example using threads, so that it works as it should, only the code will be 2 times larger, and then raise the hands of those who each file request The system or the database draws in a separate thread! <br><br><h3>  Instead of completion </h3><br>  Non-blocking I / O is part of the nodeJS philosophy.  Working with files, working with TCP, HTTP, DNS, communicating with the system, communicating with other processes, all this does not block input and output.  And I realized the beauty of it when I wrote my <a href="http://github.com/brainfucker/hashlib">hashlib</a> library for node.  While doing the non-blocking function md5_file, I spent a little experiment.  The fact is that taking md5 from a file is a very slow procedure, for example, a movie is considered 5‚Äì15 minutes (depending on its size) and as it turned out 80% of the time is spent not on calculating md5, but on reading the file, respectively using my library extract md5 from 5 films at the same time, for the same time for which you extract only one using standard tools. <br><br>  You can find a lot of useful <a href="http://nodejs.ru/">stuff</a> here: <a href="http://nodejs.ru/">nodejs</a> </div><p>Source: <a href="https://habr.com/ru/post/83865/">https://habr.com/ru/post/83865/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../83849/index.html">"Improve your ... Google?"</a></li>
<li><a href="../83850/index.html">Timelance.ru - exchange of services and goods: the launch of the beta version</a></li>
<li><a href="../83853/index.html">Gamers are transplanted to the "seven"</a></li>
<li><a href="../83860/index.html">Making a simple web application on the Spring Framework MVC</a></li>
<li><a href="../83864/index.html">Base stations disconnect</a></li>
<li><a href="../83869/index.html">Virtual Metro Walk</a></li>
<li><a href="../83870/index.html">Idea for google buzz script</a></li>
<li><a href="../83871/index.html">‚ÄúScartel‚Äù (‚ÄúYota‚Äù) cancels the release of VoIP-mobile phones ‚ÄúYota Cosmos‚Äù scheduled for 2010</a></li>
<li><a href="../83874/index.html">Zeroing karma</a></li>
<li><a href="../83884/index.html">Is it time to embed the ‚ÄúBuzz This‚Äù buttons in the news and blogs?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>