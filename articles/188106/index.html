<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Django development server and HTTPS testing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello dear community, 

 Having chosen the Django framework for developing a corporate website, I was faced with the problem of testing its work using...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Django development server and HTTPS testing</h1><div class="post__text post__text-html js-mediator-article"> Hello dear community, <br><br>  Having chosen the Django framework for developing a corporate website, I was faced with the problem of testing its work using <a href="http://en.wikipedia.org/wiki/HTTP_Secure">the HTTPS protocol</a> when using the embedded web server.  Despite the <a href="&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhir3cQpNsn-LLjYU0So1-vXDYPzSQ#ssl-">support for</a> working with secure connections in Django, the bundled web server does not serve HTTPS requests. <br><br>  The first thing that came to mind was to raise a full-fledged web server (for example, <a href="https://docs.djangoproject.com/en/1.5/topics/install/">Apache</a> ) for development and testing, but what if you didn't want to give up the convenience and ease of use of the Django embedded web server? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A search on the Internet for ‚Äúdjango + https‚Äù issued several articles dated <a href="https-djangos-development-server">2009</a> and <a href="https/">2012</a> , in which it is proposed to use <a href="https://www.stunnel.org/">stunnel</a> for HTTPS testing. <br><br>  This article is an instruction obtained as a result of setting up <code>stunnel</code> under the Django development environment on Ubuntu 12.04.1 LTS x64. <br><a name="habracut"></a><br><br><h4>  Software environment </h4><br><ul><li>  Ubuntu 12.04.1 LTS (x64) </li><li>  OpenSSL 1.0.1 Mar 14 2012 </li><li>  Python 2.7.3 </li><li>  virtualenv 1.8.4 </li><li>  Django 1.5.1 </li></ul><br><br><h4>  Install and configure stunnel </h4><br>  First you need to install <code>stunnel</code> (version 4.x, branch 3.x is no longer supported): <br><br><pre> <code class="bash hljs">$ sudo apt-get install stunnel4</code> </pre> <br>  The basic <code>stunnel</code> settings are in the <code>/etc/default/stunnel4</code> : <br><br><pre> <code class="hljs pgsql"># /etc/<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>/stunnel # Julien LEMOINE &lt;speedblue@debian.org&gt; # September <span class="hljs-number"><span class="hljs-number">2003</span></span> # Change <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> one <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> stunnel automatic startup ENABLED=<span class="hljs-number"><span class="hljs-number">0</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">Configuration</span></span> file loacation mask FILES="/etc/stunnel/*.conf" <span class="hljs-keyword"><span class="hljs-keyword">OPTIONS</span></span>="" # Change <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> one <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> ppp <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> scripts PPP_RESTART=<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>  In our case, there is no need to make changes, as the <code>stunnel</code> will be used only in conjunction with the Django web server at the time of development and testing. <br><br>  But what you need is a X.509 certificate. <br><br><h4>  Certificate Generation </h4><br>  The stunnel manual contains the following certificate requirements: <br><blockquote>  ...  Each SSL enabled daemon needs a valid X.509 certificate to the peer.  It also needs to enter the incoming data.  OpenSSL package ... <br><br>  ... The order of contents of the .pem file is important.  It should contain the unencrypted private key first, then a signed certificate (not certificate request).  There should be also empty lines after certificate and private key.  Plaintext certificate information appended should not be discarded.  So the file should look like this: <br><br>  ----- BEGIN RSA PRIVATE KEY ----- <br>  [encoded key] <br>  ----- END RSA PRIVATE KEY ----- <br>  [empty line] <br>  ----- BEGIN CERTIFICATE ----- <br>  [encoded certificate] <br>  ----- END CERTIFICATE ----- <br>  [empty line] </blockquote><br>  To generate a private key and certificate, we will use OpenSSL (must be present in Ubuntu 04/12/1): <br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~ $ openssl genrsa -out private.key $ openssl req -new -x509 -key private.key -out stunnel.cert -days 365</code> </pre> <br>  <i>During generation, you must enter the owner information ( <a href="http://countrycode.org/">country codes</a> for convenience).</i> <br><br>  At the output we get two files <code>private.key</code> and <code>stunnel.cert</code> , which need to be merged and add empty lines according to the template: <br><br><pre> <code class="bash hljs">$ (cat private.key ; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ; cat stunnel.cert ; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>) &gt; stunnel.pem</code> </pre> <br>  Now create a configuration file for the tunnel. <br><br><h4>  configuration file </h4><br>  An example of the <code>stunnel.conf-sample</code> configuration file is located in <code>/usr/share/doc/stunnel4/examples/</code> , and the description of the parameters can be found in <code>man stunel4</code> or in the <a href="https://www.stunnel.org/static/stunnel.html">documentation</a> .  Plus, the <a href="https://www.stunnel.org/faq.html">FAQ</a> section on the program‚Äôs website contains some useful tips. <br><br>  Create a configuration file in the home directory: <br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~ $ vim stunnel.conf</code> </pre> <br>  In our case, it has the following contents: <br><br><pre> <code class="hljs vhdl">; Certificate &amp; Key cert = ./stunnel.pem ; <span class="hljs-keyword"><span class="hljs-keyword">Use</span></span> SSL version <span class="hljs-number"><span class="hljs-number">3</span></span>, which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> more secure sslVersion = SSLv3 ; <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> argument <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> empty, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> no pid <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> will be created pid = ; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'yes</span></span>' stay <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> foreground (don<span class="hljs-symbol"><span class="hljs-symbol">'t</span></span> fork) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> log <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> stderr instead <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> via syslog foreground = no ; Performance tweak from FAQ (https://www.stunnel.org/faq.html) socket = l:TCP_NODELAY=<span class="hljs-number"><span class="hljs-number">1</span></span> socket = r:TCP_NODELAY=<span class="hljs-number"><span class="hljs-number">1</span></span> ; Enable compression compression = zlib ; Debugging - emerg (<span class="hljs-number"><span class="hljs-number">0</span></span>), alert (<span class="hljs-number"><span class="hljs-number">1</span></span>), crit (<span class="hljs-number"><span class="hljs-number">2</span></span>), err (<span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-literal"><span class="hljs-literal">warning</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span>), notice (<span class="hljs-number"><span class="hljs-number">5</span></span>), info (<span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> debug (<span class="hljs-number"><span class="hljs-number">7</span></span>) debug = <span class="hljs-number"><span class="hljs-number">7</span></span> output = /var/log/stunnel4/stunnel.log ; HTTPS service section [https] ; <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> listen incoming client connections accept = <span class="hljs-number"><span class="hljs-number">8443</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span> which Django development server listens <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> connect = <span class="hljs-number"><span class="hljs-number">8000</span></span> ; Tweak <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> MSIE (see FAQ <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> manual) TIMEOUTclose = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>  Let's check what happened? <br><br><h4>  Creating a tunnel and starting a web server </h4><br>  Run <code>stunnel</code> and the built-in Django web server for the test project (empty project, immediately after <code>django-admin.py startproject</code> ): <br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~ $ stunnel4 stunnel.conf $ <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> django/bin/activate (django)$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> django/projects (django)$ django-admin.py startproject testone (django)$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> testone/ (djanho)$ HTTPS=on python manage.py runserver</code> </pre> <br>  <em>The HTTPS = on environment variable is required for a proper HTTPS simulation in Django, without it the request.is_secure () method will return False.</em> <br><br>  Check the ‚Äúlistening‚Äù ports: <br><pre> <code class="bash hljs">$ netstat ‚Äìan</code> </pre> <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Active</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Internet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">connections</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">servers</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">and</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">established</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">Proto</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Recv-Q</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Send-Q</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Local</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Address</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Foreign</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Address</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">State</span></span> ... <span class="hljs-selector-tag"><span class="hljs-selector-tag">tcp</span></span> 0 0 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8443</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>:* <span class="hljs-selector-tag"><span class="hljs-selector-tag">LISTEN</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tcp</span></span> 0 0 127<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8000</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>:* <span class="hljs-selector-tag"><span class="hljs-selector-tag">LISTEN</span></span> ...</code> </pre> <br>  The tunnel was successfully created - <code>stunnel</code> listens on all external interfaces port 8443, and the web server local connections on port 8000. <br><br>  To kill a tunnel, the <code>killall</code> command will work: <br><br><pre> <code class="bash hljs">$ ps -e | grep stunnel4</code> </pre> <br><pre> <code class="hljs">12530 pts/1 00:00:00 stunnel4 12531 pts/1 00:00:00 stunnel4 12532 pts/1 00:00:00 stunnel4 12533 pts/1 00:00:00 stunnel4 12534 pts/1 00:00:00 stunnel4 12535 ? 00:00:00 stunnel4</code> </pre> <br><pre> <code class="bash hljs">$ killall stunnel4</code> </pre> <br><br><h4>  Operation check </h4><br>  Open any existing URL in the browser using <code>https://</code> instead of <code>http://</code> .  At the first request, we should see warnings about an unreliable certificate, since  It was signed by us personally, and not by an accredited center (Certificate Authority).  After confirming the security exception, we will see the requested page received via the HTTPS protocol. <br><br><img src="https://habrastorage.org/storage2/7a8/863/1ab/7a88631abe386c890e618019342f1d62.png"><br>  <i>It was</i> <br><br><img src="https://habrastorage.org/storage2/848/fe1/fc9/848fe1fc973cb0a41ac442dd5bf5f666.png"><br>  <i>It became</i> <br><br><h4>  Conclusion </h4><br>  As a result, we get the ability to debug a Django project using HTTPS without having to keep a full-fledged web server. <br><br>  I want to note that there is a version for <a href="">Windows</a> and <a href="">Android</a> on the site <code>stunnel</code> , so you can try to build a similar scheme on these operating systems. <br><br>  Thank you all for your attention and I hope that this information will be useful to someone. <br><br>  At the end I will list the advantages and disadvantages that I have noted for myself, and also provide a list of links. <br><br><h5>  Benefits </h5><br>  + installation of a full-fledged web server is not required; <br>  + ability to build tunnels for several Django web servers; <br>  + use the benefits of the embedded web server. <br><br><h5>  disadvantages </h5><br>  - this is not a full-fledged HTTPS-enabled web server; <br>  - the need to install and configure additional software; <br>  - in fact, the Django web server handles HTTP requests (see logs below). <br><br><div class="spoiler">  <b class="spoiler_title">Web server logs</b> <div class="spoiler_text">  Validating models ... <br><br>  0 errors found <br>  July 26, 2013 - 10:06:33 <br>  Django version 1.5.1, using settings 'testone.settings' <br>  Development server is running at <a href="http://127.0.0.1/">127.0.0.1</a> : 8000 / <br>  Quit the server with CONTROL-C. <br>  ... <br>  [26 / Jul / 2013 10:07:25] GET / HTTP / 1.1 200 1955 <br>  [26 / Jul / 2013 10:07:30] GET / HTTP / 1.1 200 1955 <br>  ... <br></div></div><br><br><h4>  Materials </h4><br><ol><li>  <a href="https://docs.djangoproject.com/en/1.5/topics/security/">Security in django</a> </li><li>  <a href="https-djangos-development-server">Testing HTTPS with Django's Development Server</a> </li><li>  <a href="https://www.stunnel.org/static/stunnel.html">stunnel manual</a> </li><li>  <a href="https/">Running a Django (or any other) dev instance over HTTPS</a> </li><li>  <a href="http://blog.trebacz.com/2012/03/installing-stunnel-to-enable-ssl.html">Installing Stunnel to Enable SSL Connections in Pan Newsreader</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/188106/">https://habr.com/ru/post/188106/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188094/index.html">Order in the photo and video archives using the technique and a pair of scripts</a></li>
<li><a href="../188096/index.html">Failover Master-Slave Cluster on PostgreSQL</a></li>
<li><a href="../188098/index.html">Relations enikeyschika and people in work</a></li>
<li><a href="../188102/index.html">Simple client and server authorization of an Ajax site user using the VKontakte API</a></li>
<li><a href="../188104/index.html">Configuring WebSVN on Windows for integration into Jira with support for SVN authorization and Delphi source encoding</a></li>
<li><a href="../188108/index.html">Articles about a portable Linux server for newbies - are they needed?</a></li>
<li><a href="../188110/index.html">ExtJs as a maven dependency</a></li>
<li><a href="../188114/index.html">A real multi-threaded web server in assembler for Linux</a></li>
<li><a href="../188116/index.html">Automatic update of Adobe Flash Player & Java RE in the Windows / AD domain</a></li>
<li><a href="../188118/index.html">Generating the tree menu of the Nested Sets view model</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>