<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fractals, Fortran and OpenMP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once upon a time I decided to ‚Äútouch‚Äù Fortran. The only task I came up with was generating fractals (at the same time, OpenMP in Fortran could be trie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fractals, Fortran and OpenMP</h1><div class="post__text post__text-html js-mediator-article">  Once upon a time I decided to ‚Äútouch‚Äù Fortran.  The only task I came up with was generating fractals (at the same time, OpenMP in Fortran could be tried).  In the process of writing, I often encountered problems that had to be thought out myself (for example, on the Internet there are not many examples of using double-precision numbers or binary writing to a file).  But sooner or later, all the problems were solved, and I want to write this text, which perhaps will help someone. <br><br>  I will write in the Fortran 90 dialect, but with GNU extensions (the same double precision numbers). <br><a name="habracut"></a><br><br><h4>  <b>A bit of fractal theory</b> </h4><br>  <b>Fractal</b> ( <i>fractus</i> - crushed, broken, broken) - in the narrow sense, a complex geometric shape that has the property of self-similarity, that is, composed of several parts, each of which is similar to the entire figure as a whole. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There is a large group of fractals - algebraic fractals.  This name derives from the principle of constructing such fractals.  For their construction use recursive functions.  For example, algebraic fractals are: Julia set, Mandelbrot set, Newton's pool (fractal). <br><br><h4>  <b>Construction of algebraic fractals</b> </h4><br>  One construction method is an iterative calculation. <img src="https://habrastorage.org/getpro/habr/post_images/b1f/d49/fe6/b1fd49fe60a9287b96f2ad8bd793fd9d.png" alt="image">  where <img src="https://habrastorage.org/getpro/habr/post_images/03a/dbf/c04/03adbfc04c8d9197e779f2e7c7f31f8a.png" alt="image">  , but <img src="https://habrastorage.org/getpro/habr/post_images/775/353/db1/775353db1b9a318f415d9c46dff67d0c.png" alt="image">  some function.  The calculation of this function continues until a certain condition is met.  When this condition is fulfilled, a dot is displayed on the screen. <br><br>  The behavior of the function for different points of the complex plane may have different behavior: <br><ul><li>  Striving for infinity </li><li>  Aims to 0 </li><li>  Accepts several fixed values ‚Äã‚Äãand does not go beyond them. </li><li>  Chaotic behavior.  No trends </li></ul><br>  One of the simplest (both for understanding and implementation) algorithms for constructing algebraic fractals is known as the ‚Äú <b>escape time algorithm</b> ‚Äù.  In short, an iterative calculation of the number is made for each point of the complex plane. <br><br>  It has been proven that if <img src="https://habrastorage.org/getpro/habr/post_images/633/2b5/b3a/6332b5b3a32487f47a7f1455b27f020a.png" alt="image">  it turns out more <b>bailout</b> , then the sequence <img src="https://habrastorage.org/getpro/habr/post_images/bef/a20/69e/befa2069e61fc591798f29abdce04fb7.png" alt="image">  .  Comparison <img src="https://habrastorage.org/getpro/habr/post_images/633/2b5/b3a/6332b5b3a32487f47a7f1455b27f020a.png" alt="image">  with <b>bailout</b> allows you to find points lying outside the set.  For points outside the set, the sequence <img src="https://habrastorage.org/getpro/habr/post_images/417/a43/cfc/417a43cfcb704add00794380c1d2b35b.png" alt="image">  will not tend to infinity, so never reach <b>bailout</b> . <br><br>  I will look at two simple fractals - Julia set and Mandelbrot set.  They are calculated by the same function, and differ only in a constant, where Julia has a constant, and in Mandelbrob the constant depends on the point of the complex plane. <br><br><h4>  <b>Building Julia Set</b> </h4><br>  The beginning and end of the program is simple and trivial: <br><pre><code class="hljs delphi"><span class="hljs-keyword"><span class="hljs-keyword">program</span></span> frac <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  Next we need to enter several constants: <br><pre> <code class="hljs vhdl"> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: iterations = <span class="hljs-number"><span class="hljs-number">2048</span></span> ! .  ,      REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: mag_ratio = <span class="hljs-number"><span class="hljs-number">1.0_8</span></span> ! REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: x0 = <span class="hljs-number"><span class="hljs-number">0.0_8</span></span> !   REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: y0 = <span class="hljs-number"><span class="hljs-number">0.0_8</span></span> ! <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: resox = <span class="hljs-number"><span class="hljs-number">1024</span></span> !   <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: resoy = resox REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: xshift = (-<span class="hljs-number"><span class="hljs-number">1.5_8</span></span> / mag_ratio) + x0 !     REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: yshift = (-<span class="hljs-number"><span class="hljs-number">1.5_8</span></span> / mag_ratio) + y0 !  REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: CXmin = -<span class="hljs-number"><span class="hljs-number">1.5_8</span></span> / mag_ratio !   REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: CXmax = <span class="hljs-number"><span class="hljs-number">1.5_8</span></span> / mag_ratio !    resox x resoy REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: CXshag = (DABS(CXmin) + DABS(CXmax)) / resox !         REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: CYmin = -<span class="hljs-number"><span class="hljs-number">1.5_8</span></span> / mag_ratio REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: CYmax = <span class="hljs-number"><span class="hljs-number">1.5_8</span></span> / mag_ratio REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: CYshag = (DABS(CYmin) + DABS(CYmax)) / resoy COMPLEX(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: c = DCMPLX(<span class="hljs-number"><span class="hljs-number">0.285_8</span></span>, <span class="hljs-number"><span class="hljs-number">0.01_8</span></span>) !  </code> </pre><br>  And here you need to explain something.  <b>REAL</b> and <b>COMPLEX</b> is a single-precision floating-point number and a complex number consisting of two <b>REALs</b> .  <b>REAL (8)</b> is a double precision number, and <b>COMPLEX (8)</b> , respectively, is a complex number consisting of two <b>REAL (8)</b> .  Also, the letter <b>D is</b> added to the standard functions (as is the case with <b>ABS</b> ), which indicates the use of double precision numbers. <br><br>  Next we need to enter a few variables: <br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">CHARACTER</span></span>, DIMENSION(:), ALLOCATABLE :: matrix !  COMPLEX(<span class="hljs-number"><span class="hljs-number">8</span></span>) :: z <span class="hljs-type"><span class="hljs-type">INTEGER</span></span> :: x, y, iter <span class="hljs-type"><span class="hljs-type">REAL</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>) :: iter2 !    ALLOCATE(matrix(<span class="hljs-number"><span class="hljs-number">0</span></span> : resox * resoy * <span class="hljs-number"><span class="hljs-number">3</span></span>))</code> </pre><br>  Using ALLOCATABLE is a must!  Since  otherwise: <br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">CHARACTER</span></span>, DIMENSION(<span class="hljs-number"><span class="hljs-number">0</span></span>:resox * resoy * <span class="hljs-number"><span class="hljs-number">3</span></span>) :: matrix ! </code> </pre><br>  The memory will be allocated on the stack, and this is not acceptable when used in multiple threads.  Therefore, we allocate memory on the heap. <br><br>  So I do not use two-dimensional arrays, because  when selected on the heap, the array will take up more space, and it will be more difficult to write it to the file. <br><br>  Next we need to specify the number of threads generated by OpenMP: <br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> omp_set_num_threads(<span class="hljs-number"><span class="hljs-number">16</span></span>)</code> </pre><br>  And here the calculations begin.  In Fortran, OpenMP directives are specified via comments (in C / C ++, there is a special #pragma macro for this). <br><pre> <code class="hljs sql"> !$OMP PARALLEL <span class="hljs-keyword"><span class="hljs-keyword">DO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRIVATE</span></span>(iter, iter2, z) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>, resox<span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>, resoy<span class="hljs-number"><span class="hljs-number">-1</span></span> iter = <span class="hljs-number"><span class="hljs-number">0</span></span> !   z = DCMPLX(x * CXshag + xshift, y * CYshag + yshift) ! Z   <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((iter .le. iterations) .and. (CDABS(z) .le. <span class="hljs-number"><span class="hljs-number">4.0</span></span>_8)) !  bailout  <span class="hljs-number"><span class="hljs-number">2</span></span>,    <span class="hljs-number"><span class="hljs-number">4</span></span>, ..    z = z**<span class="hljs-number"><span class="hljs-number">2</span></span> + c iter = iter + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> iter2 = DFLOAT(iter) - DLOG(DLOG(CDABS(z))) / DLOG(<span class="hljs-number"><span class="hljs-number">2.0</span></span>_8) !   iter-<span class="hljs-keyword"><span class="hljs-keyword">log2</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ln</span></span>(|Z|)) matrix((x + y * resox) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>) = <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(NINT(DMOD(iter2 * <span class="hljs-number"><span class="hljs-number">7.0</span></span>_8, <span class="hljs-number"><span class="hljs-number">256.0</span></span>_8))) !    matrix((x + y * resox) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>) = <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(NINT(DMOD(iter2 * <span class="hljs-number"><span class="hljs-number">14.0</span></span>_8, <span class="hljs-number"><span class="hljs-number">256.0</span></span>_8))) matrix((x + y * resox) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>) = <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(NINT(DMOD(iter2 * <span class="hljs-number"><span class="hljs-number">2.0</span></span>_8, <span class="hljs-number"><span class="hljs-number">256.0</span></span>_8))) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> !$OMP <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PARALLEL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DO</span></span></code> </pre><br>  The most time consuming part is over.  Next, it remains for us to display information in a convenient form for perception - the image.  I will use the PNM format, since  This is the easiest image format. <br><br>  PNM consists of several sections: <br><pre> <code class="bash hljs">P6 <span class="hljs-comment"><span class="hljs-comment"># 1024 1024 255</span></span></code> </pre><br>  The first line is an indication of the format of recording information about pixels: <br><ul><li>  P1 / P4 - black and white image </li><li>  P2 / P5 - gray image </li><li>  P3 / P6 - color image </li></ul><br>  The first P is an option where the color of a pixel is recorded with an ASCII character, and the second P allows you to record the color of a pixel in binary form (which saves disk space). <br><br>  The next line is a comment, then the image resolution and the number of colors per pixel.  After the number of colors is directly information about the pixels. <br><br>  Start writing the image to the file: <br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span>(unit=<span class="hljs-number"><span class="hljs-number">8</span></span>, status = <span class="hljs-string"><span class="hljs-string">'replace'</span></span>, file = trim("test.pnm")) <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'(a)'</span></span>) "P6" !(a)    <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'(a)'</span></span>) "" <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'(I0, a, I0)'</span></span>) resox, <span class="hljs-string"><span class="hljs-string">' '</span></span>, resoy <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'(I0)'</span></span>) <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>, *) matrix <span class="hljs-keyword"><span class="hljs-keyword">close</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEALLOCATE</span></span>(matrix)</code> </pre><br>  <b>DEALLOCATE</b> we perform for decency, because when you exit the program, the OS will still return the occupied memory to the system. <br><br>  You can use the GNU compiler compiler to build the program: <br><pre> <code class="bash hljs">gfortran -std=gnu frac.f90 -o frac.run -fopenmp</code> </pre><br>  You should get the following image: <br><div class="spoiler">  <b class="spoiler_title">1024x1024</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/9ab/0a0/c7d/9ab0a0c7d86a4b6bbe2cd8a24cd7273f.png"></div></div><br><br><h4>  <b>How to generate a Mandelbrot Set</b> </h4><br>  It is easy to do, it is enough to replace <b>c</b> and change several constants.  In this case, remove the constant <b>c</b> and add the variable <b>c</b> : <br><pre> <code class="hljs swift"> <span class="hljs-type"><span class="hljs-type">COMPLEX</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>) :: z, <span class="hljs-built_in"><span class="hljs-built_in">c</span></span></code> </pre><br><pre> <code class="hljs swift"> z = <span class="hljs-type"><span class="hljs-type">DCMPLX</span></span>(x * <span class="hljs-type"><span class="hljs-type">CXshag</span></span> + xshift, y * <span class="hljs-type"><span class="hljs-type">CYshag</span></span> + yshift) ! <span class="hljs-type"><span class="hljs-type">Z</span></span>   <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = z</code> </pre><br>  And we also change the old constants: <br><pre> <code class="hljs vhdl"> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: MAIN_RES = <span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: resox = (MAIN_RES / <span class="hljs-number"><span class="hljs-number">3</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: resoy = (resox * <span class="hljs-number"><span class="hljs-number">2</span></span>) / <span class="hljs-number"><span class="hljs-number">3</span></span> REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: xshift = (-<span class="hljs-number"><span class="hljs-number">2.0_8</span></span> / mag_ratio) + x0 REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: yshift = (-<span class="hljs-number"><span class="hljs-number">1.0_8</span></span> / mag_ratio) + y0 REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: CXmin = -<span class="hljs-number"><span class="hljs-number">2.0_8</span></span> / mag_ratio REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: CXmax = <span class="hljs-number"><span class="hljs-number">1.0_8</span></span> / mag_ratio REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: CXshag = (DABS(CXmin) + DABS(CXmax)) / resox REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: CYmin = -<span class="hljs-number"><span class="hljs-number">1.0_8</span></span> / mag_ratio REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: CYmax = <span class="hljs-number"><span class="hljs-number">1.0_8</span></span> / mag_ratio REAL(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">PARAMETER</span></span> :: CYshag = (DABS(CYmin) + DABS(CYmax)) / resoy</code> </pre><br>  You should get the following image: <br><div class="spoiler">  <b class="spoiler_title">1023x682</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/409/c33/624/409c33624d804cd69cecc2dbad99100c.png"></div></div><br><br>  <b>upd</b> <br>  After I worked in Ada, I found one mistake - where I used <b>Mod</b> .  This function played my role as a crutch, since  we have one color channel takes values ‚Äã‚Äãfrom 0 to 255, it turned out that I did <b>Mod</b> 'so that the value was not higher than the maximum.  As you can see in the images, this leads to sharp transitions in colors. <br>  I will fix this with this formula: <img src="https://habrastorage.org/getpro/habr/post_images/706/15b/00d/70615b00d24fccb895746d4b8ed2898e.png" alt="image">  .  It turns out a variation of linear interpolation in a linear space. <br>  To make it easier to use, we will write the following function: <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> myround(a) result(ret) <span class="hljs-type"><span class="hljs-type">REAL</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>), intent(<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>) :: a <span class="hljs-type"><span class="hljs-type">INTEGER</span></span> :: ret !     b  <span class="hljs-number"><span class="hljs-number">255</span></span>,    <span class="hljs-type"><span class="hljs-type">INTEGER</span></span>   . ret = ABS(<span class="hljs-type"><span class="hljs-type">INT</span></span>(a - <span class="hljs-number"><span class="hljs-number">255.0</span></span>_8 * NINT(a / <span class="hljs-number"><span class="hljs-number">255.0</span></span>_8))) !NINT()    round()  C, ..     <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> myround program frac <span class="hljs-type"><span class="hljs-type">INTEGER</span></span> :: myround</code> </pre><br>  And we replace the color assignment to dots: <br><pre> <code class="hljs lisp"> matrix((<span class="hljs-name"><span class="hljs-name">x</span></span> + y * resox) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>) = CHAR(<span class="hljs-name"><span class="hljs-name">myround</span></span>(<span class="hljs-name"><span class="hljs-name">iter2</span></span> * 7.0_8)) matrix((x + y * resox) * 3 + 1) = CHAR(myround(iter2 * <span class="hljs-number"><span class="hljs-number">14.0</span></span>_8)) matrix((<span class="hljs-name"><span class="hljs-name">x</span></span> + y * resox) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>) = CHAR(<span class="hljs-name"><span class="hljs-name">myround</span></span>(<span class="hljs-name"><span class="hljs-name">iter2</span></span> * 2.0_8))</code> </pre><br>  It turns out the following image: <br><div class="spoiler">  <b class="spoiler_title">1024x1024</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/de4/2dd/a09/de42dda09d3b48c3a2821d5a7f55b914.png"></div></div><br><br>  <b>upd2</b> <br>  Since  in Fortran, as in Ada, EOL is automatically selected, then under non-Unix systems, PNM is incorrect.  To avoid this, you will have to use the following bike: <br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'(a, a, $)'</span></span>) "P6", <span class="hljs-type"><span class="hljs-type">char</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'(a,$)'</span></span>) <span class="hljs-type"><span class="hljs-type">char</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'(I0, a, I0, a, $)'</span></span>) resox, <span class="hljs-string"><span class="hljs-string">' '</span></span>, resoy, <span class="hljs-type"><span class="hljs-type">char</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'(I0, a, $)'</span></span>) <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-type"><span class="hljs-type">char</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>, *) matrix</code> </pre><br><br><h4>  <b>Used Books</b> </h4><br>  <a href="http://en.wikipedia.org/wiki/Fractal">en.wikipedia.org/wiki/Fractal</a> <br>  <a href="http://en.wikipedia.org/wiki/Julia_set">en.wikipedia.org/wiki/Julia_set</a> <br>  <a href="http://en.wikipedia.org/wiki/Mandelbrot_set">en.wikipedia.org/wiki/Mandelbrot_set</a> <br>  <a href="http://en.wikipedia.org/wiki/OpenMP">en.wikipedia.org/wiki/OpenMP</a> <br>  <a href="http://openmp.org/wp/openmp-specifications/">openmp.org/wp/openmp-specifications</a> <br>  <a href="https://gcc.gnu.org/onlinedocs/gfortran/">gcc.gnu.org/onlinedocs/gfortran</a> </div><p>Source: <a href="https://habr.com/ru/post/242221/">https://habr.com/ru/post/242221/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242209/index.html">Writing plugins with AppDomain is fun</a></li>
<li><a href="../242211/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ132 (October 27 - November 2, 2014)</a></li>
<li><a href="../242213/index.html">Backing up virtual machines in a QEMU / KVM hypervisor environment</a></li>
<li><a href="../242217/index.html">IceCash 1.3. Linux workplace cashier on php, with the driver Shtrih-M</a></li>
<li><a href="../242219/index.html">Create your own Debian LiveCD boot disk</a></li>
<li><a href="../242225/index.html">ActiveRecord a little about rakes, Relations and indices</a></li>
<li><a href="../242229/index.html">Sync with Opera for Android and updated Opera Coast</a></li>
<li><a href="../242231/index.html">Visual Studio extension for rendering custom classes in debug mode</a></li>
<li><a href="../242233/index.html">How to restore a retro sound? The work of audio archaeologists from Southampton</a></li>
<li><a href="../242235/index.html">As a formal management, the whole department ruined.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>