<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>100 lines on canvas: part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Preface I would like to congratulate a habrauser on his birthday. Grow big, be smart, and at last your finished Graphics2D canvas framework has finish...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>100 lines on canvas: part 1</h1><div class="post__text post__text-html js-mediator-article">  <sub><font color="#666"><i>Preface I would like to congratulate a habrauser on his birthday.</i></font></sub>  <sub><font color="#666"><i>Grow big, be smart, and at last your finished <a href="http://habrahabr.ru/post/239261/">Graphics2D</a> canvas framework has <a href="http://habrahabr.ru/post/239261/">finished</a> to the state that you consider acceptable.</i></font></sub> <sub><font color="#666"><i><br></i></font></sub>  <sub><font color="#666"><i><b>Happy Birthday.</b></i></font></sub>  <sub><font color="#666"><i>: P</i></font></sub> <br><br>  This summer, an interesting thought occurred to me: if I wrote a 100-line microblib library for the canvas, what would I fit in there? .. You can write the most detailed answer in 1 evening.  And then came the idea of ‚Äã‚Äãthis article. <br><br>  I propose to implement OOP, events and animation on canvas - the most often necessary (IMHO) things ... and all this in 100 lines.  Part one. <br><a name="habracut"></a><br>  <font color="red">Disclaimer:</font> here you are (sometimes) waiting for completely unnecessary perversions to save a couple of characters of code.  The author (and this is me) believes that this is possible in microbiblikotekh, and very often done.  If this does not violate the performance, of course. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <font color="#4682b4">Glad to see you under the cut;)</font> </h4><br>  Let's start with the idea (and first of all - the PLO).  3 main objects: paths, images, text.  There is no need to implement, for example, rectangles and circles in the mini-library: they are easily created through the path.  Like sprites - through the pictures.  Etc. <br>  The first argument of the object is its content. <br>  The second is the styles that are set on the canvas before drawing. <br><br>  I will call it Rat: P <br><pre><code class="javascript hljs">Rat = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">context</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context = context; };</code> </pre> <br><br><h4>  <font color="#4682b4">Paths</font> </h4><br>  Somehow it will be nice: <br><img src="https://habrastorage.org/getpro/habr/post_images/9b8/a96/58f/9b8a9658fc6d7199be19c9dcd2337a75.png" align="right"><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> path = rat.path([ [<span class="hljs-string"><span class="hljs-string">'moveTo'</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>], [<span class="hljs-string"><span class="hljs-string">'lineTo'</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>], [<span class="hljs-string"><span class="hljs-string">'lineTo'</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>], [<span class="hljs-string"><span class="hljs-string">'closePath'</span></span>] ], { <span class="hljs-attr"><span class="hljs-attr">fillStyle</span></span>: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, <span class="hljs-attr"><span class="hljs-attr">strokeStyle</span></span>: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, <span class="hljs-attr"><span class="hljs-attr">lineWidth</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> });</code> </pre><br><br>  All 3 objects need to be set with a context property, an object for styles, etc.‚Ä¶ So: <br><pre> <code class="javascript hljs">Rat.init = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cls, arg</span></span></span><span class="hljs-function">)</span></span>{ cls.opt = arg[<span class="hljs-number"><span class="hljs-number">0</span></span>]; cls.style = arg[<span class="hljs-number"><span class="hljs-number">1</span></span>] || {}; cls.context = arg[<span class="hljs-number"><span class="hljs-number">2</span></span>]; cls.draw(arg[<span class="hljs-number"><span class="hljs-number">2</span></span>].context); };</code> </pre><br>  It seems to be all clear?  Each object has 3 properties: opt (1 argument), style (2nd) and context (context), as well as the draw (ctx) function, which paints this object. <br><br>  Our class: <br><pre> <code class="javascript hljs">Rat.Path = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">opt, style, context</span></span></span><span class="hljs-function">)</span></span>{ Rat.init(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); };</code> </pre><br>  Yes, oddly enough, the designer is everything. <br><br>  Most importantly: drawing: <br><pre> <code class="javascript hljs">Rat.Path.prototype = { <span class="hljs-attr"><span class="hljs-attr">draw</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.process(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.style.fillStyle) ctx.fill(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.style.strokeStyle) ctx.stroke(); }, ctx); }, <span class="hljs-attr"><span class="hljs-attr">process</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback, ctx</span></span></span><span class="hljs-function">)</span></span>{ ctx = ctx || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context.context; Rat.style(ctx, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.style); ctx.beginPath(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.opt.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">func</span></span></span><span class="hljs-function">)</span></span>{ ctx[func[<span class="hljs-number"><span class="hljs-number">0</span></span>]].apply(ctx, func.slice(<span class="hljs-number"><span class="hljs-number">1</span></span>)); }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = callback.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, ctx); ctx.restore(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } };</code> </pre><br>  The process function is not for nothing at all: it will be needed somewhere else: <br><pre> <code class="javascript hljs"> isPointIn: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x,y, ctx</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.process(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ctx.isPointInPath(x, y); }, ctx); }</code> </pre><br>  Why callback?  Hmm ... for beauty. <br><br>  The <b>Rat.style</b> function, also common to all 3 objects, simply transfers the properties to the canvas.  Do not forget that we also want transformations: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     ,       //  Rat.notStyle = "translate0rotate0transform0scale".split(0); Rat.style = function(ctx, style){ ctx.save(); style.origin &amp;&amp; ctx.translate.apply(ctx, style.origin); style.rotate &amp;&amp; ctx.rotate(style.rotate); style.scale &amp;&amp; ctx.scale.apply(ctx, style.scale); style.origin &amp;&amp; ctx.translate(-style.origin[0], -style.origin[1]); style.translate &amp;&amp; ctx.translate.apply(ctx, style.translate); // ,      origin? style.transform &amp;&amp; ctx.transform.apply(ctx, style.transform); Object.keys(style).forEach(function(key){ if(!~Rat.notStyle.indexOf(key)) ctx[key] = style[key]; }); };</span></span></code> </pre><br><br>  Ay, do not hit, I'll explain everything.  <code>!~Rat.notStyle.indexOf(key)</code> - the same as <code>Rat.notStyle.indexOf(key) != -1</code> .  This is a micro library though. <br><br>  And finally, the context function that creates and returns an instance of our class: <br><pre> <code class="javascript hljs">Rat.prototype = { <span class="hljs-attr"><span class="hljs-attr">path</span></span> : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">opt, style</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rat.Path(opt, style, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, };</code> </pre><br><br>  Everything, you can draw a path.  Hooray! <br><br>  And, in addition to the main styles, there are, as you can see in Rat.style, transformations: <br><img src="https://habrastorage.org/getpro/habr/post_images/cc8/6bd/f18/cc86bdf18c959c0025b7a8a5460315d3.png" align="right"><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> path = rat.path([ [<span class="hljs-string"><span class="hljs-string">'moveTo'</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>], [<span class="hljs-string"><span class="hljs-string">'lineTo'</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>], [<span class="hljs-string"><span class="hljs-string">'lineTo'</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>], [<span class="hljs-string"><span class="hljs-string">'closePath'</span></span>] ], { <span class="hljs-attr"><span class="hljs-attr">fillStyle</span></span>: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, <span class="hljs-attr"><span class="hljs-attr">strokeStyle</span></span>: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, <span class="hljs-attr"><span class="hljs-attr">lineWidth</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">rotate</span></span>: <span class="hljs-number"><span class="hljs-number">45</span></span> / <span class="hljs-number"><span class="hljs-number">180</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, <span class="hljs-attr"><span class="hljs-attr">origin</span></span>: [<span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-number"><span class="hljs-number">55</span></span>] });</code> </pre>  <sup><i>The picture is cropped because</i></sup>  <sup><i>drawn in zero coordinates.</i></sup> <br><br><h4>  <font color="#4682b4">Pictures</font> </h4><br>  Following further the principle of 2 arguments, we want a class like this: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> img = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Image(); img.src = <span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span>; img.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ rat.image(img); }</code> </pre><br>  In addition, in styles you can pass the parameters <b>width</b> , <b>height</b> and <b>crop</b> (an array of 4 numbers).  Everything is the same as in the original <u>drawImage</u> CanvasRendering2DContext. <br><br>  Again class constructor: <br><pre> <code class="javascript hljs">Rat.Image = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">opt, style, context</span></span></span><span class="hljs-function">)</span></span>{ Rat.init(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); };</code> </pre><br><br>  Drawing looks something like this: <br><pre> <code class="javascript hljs">Rat.Image.prototype.draw = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx</span></span></span><span class="hljs-function">)</span></span>{ Rat.style(ctx, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.style); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.style.crop) ctx.drawImage.apply(ctx, [<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.opt, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>].concat(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.style.crop)); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ctx.drawImage(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.opt, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.style.width || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.opt.width, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.style.height || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.opt.height); ctx.restore(); };</code> </pre><br>  Everything seems to be simple. <br><br>  And last, of course: <br><pre> <code class="javascript hljs">Rat.prototype = { ... image : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">opt, style</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rat.Image(opt, style, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, };</code> </pre><br><br>  Hooray, and there are pictures. <br><br><h4>  <font color="#4682b4">Text</font> </h4><br>  3rd global object: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = rat.text(<span class="hljs-string"><span class="hljs-string">"Hello, world!"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">fillStyle</span></span>: <span class="hljs-string"><span class="hljs-string">'blue'</span></span> });</code> </pre>  <sub>There is also a maxWidth property.</sub> <br><br>  Constructor: <br><pre> <code class="javascript hljs">Rat.Text = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ Rat.init(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); };</code> </pre><br><br>  Drawing is very simple.  And the solution, as always, is not very clean, but it works). <br><pre> <code class="javascript hljs">Rat.Text.prototype.draw = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx</span></span></span><span class="hljs-function">)</span></span>{ Rat.style(ctx, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.style); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.style.fillStyle) ctx.fillText(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.opt, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.style.maxWidth || <span class="hljs-number"><span class="hljs-number">999999999999999</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.style.strokeStyle) ctx.strokeText(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.opt, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.style.maxWidth || <span class="hljs-number"><span class="hljs-number">9999999999999999</span></span>); ctx.restore(); };</code> </pre><br><br>  And the text on the canvas can be measured.  Width, yes.  Height is determined by the size of the font. <br><pre> <code class="javascript hljs">Rat.Text.prototype.measure = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ctx = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context.context; Rat.style(ctx, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.style); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> w = ctx.measureText(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.opt).width; ctx.restore(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> w; };</code> </pre><br><br>  Do not forget: <br><pre> <code class="javascript hljs">Rat.prototype = { ... image : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">opt, style</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rat.Image(opt, style, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, };</code> </pre><br><br><h4>  <font color="#4682b4">Trivia</font> </h4><br>  Sometimes you need to forgive, forget, throw everything out and start from scratch.  For such cases, there is a clear function: <br><pre> <code class="javascript hljs">Rat.prototype = { ... clear: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cnv = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context.canvas; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context.clearRect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, cnv.width, cnv.height); } };</code> </pre><br>  For everything else, there is <b>draw</b> , which draws all the objects from the array: <br><pre> <code class="javascript hljs">Rat.prototype = { ... draw: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">elements</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ctx = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context; elements.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">element</span></span></span><span class="hljs-function">)</span></span>{ element.draw(ctx); }); } };</code> </pre><br><br><h4>  <font color="#4682b4">Examples:</font> </h4><br>  Well, now ... Let's, for example, let's assign a button to the canvas (the simplest thing that came up): <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  var path = rat.path([ ['moveTo', 10, 10], ['lineTo', 100, 10], ['lineTo', 100, 40], ['lineTo', 10, 40], ['closePath'] ], { fillStyle: '#eee', strokeStyle: '#aaa', lineWidth: 2 }); //  var text = rat.text("Hello, world", { translate: [55, 28], textAlign: 'center', fillStyle: 'black' });</span></span></code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/171/a7b/aaf/171a7baaf5200844c1667fcbe04a7a71.png" width="117" height="52"><br><br>  And put ... When you hover the mouse, it is highlighted: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bounds = ctx.canvas.getBoundingClientRect(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hover = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; ctx.canvas.addEventListener(<span class="hljs-string"><span class="hljs-string">'mousemove'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = e.clientX - bounds.left, y = e.clientY - bounds.top; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(x &gt; <span class="hljs-number"><span class="hljs-number">10</span></span> &amp;&amp; x &lt; <span class="hljs-number"><span class="hljs-number">100</span></span> &amp;&amp; y &gt; <span class="hljs-number"><span class="hljs-number">10</span></span> &amp;&amp; y &lt; <span class="hljs-number"><span class="hljs-number">40</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(hover) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; hover = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; path.style.fillStyle = <span class="hljs-string"><span class="hljs-string">'#ccc'</span></span>; rat.clear(); rat.draw([path, text]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(hover){ hover = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; path.style.fillStyle = <span class="hljs-string"><span class="hljs-string">'#eee'</span></span>; rat.clear(); rat.draw([path, text]); } });</code> </pre><br><img src="http://i.imgur.com/x4Qc2DY.png"><br><br><h4>  <font color="#4682b4">What for?</font> </h4><br>  The most interesting thing is that on basic canvas, you can code about the same with about the same amount of code. <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  var path = { fill: '#eee', draw: function(){ ctx.moveTo(10, 10); ctx.lineTo(100, 10); ctx.lineTo(100, 40); ctx.lineTo(10, 40); ctx.closePath(); ctx.fillStyle = this.fill; ctx.strokeStyle = '#aaa'; ctx.lineWidth = 2; ctx.fill(); ctx.stroke(); } }; //  var text = { draw: function(){ ctx.textAlign = 'center'; ctx.fillStyle = 'black'; ctx.fillText("Hello, world", 55, 28); } }; path.draw(); text.draw(); var bounds = ctx.canvas.getBoundingClientRect(); var hover = false; ctx.canvas.addEventListener('mousemove', function(e){ var x = e.clientX - bounds.left, y = e.clientY - bounds.top; if(x &gt; 10 &amp;&amp; x &lt; 100 &amp;&amp; y &gt; 10 &amp;&amp; y &lt; 40){ if(hover) return; hover = true; path.fill = '#ccc'; ctx.clearRect(0, 0, 800, 400); path.draw(); text.draw(); } else if(hover){ hover = false; path.fill = '#eee'; ctx.clearRect(0, 0, 800, 400); path.draw(); text.draw(); } });</span></span></code> </pre></div></div><br>  But it became obvious only after 100 lines were written ... <br>  <a href="">github.com/keyten/Rat.js/blob/master/rat.js</a> <br><br>  Well ... In the next part (if this topic is interesting for the habrahabra), I will show the implementation of the mouse processing, and the third part is the animation.  Everything is again in 100 lines (see if it works). <br>  I'm going to celebrate a birthday. <br><br><h4>  <font color="#4682b4">All interesting code!</font> </h4></div><p>Source: <a href="https://habr.com/ru/post/270255/">https://habr.com/ru/post/270255/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270245/index.html">Smooth scroll on AngularJS using requestAnimationFrame + style tips</a></li>
<li><a href="../270247/index.html">SWAPY with a new code generator</a></li>
<li><a href="../270249/index.html">New Intercepter-NG released [Android Edition] 1.6</a></li>
<li><a href="../270251/index.html">‚ÄúStored Procedures‚Äù in Redis</a></li>
<li><a href="../270253/index.html">What's new in Fedora 23 Workstation</a></li>
<li><a href="../270257/index.html">Mozilla Firefox 42 Web browser released</a></li>
<li><a href="../270259/index.html">About the role of technical</a></li>
<li><a href="../270261/index.html">Two providers simultaneously or Dual ISP with VRF on Cisco</a></li>
<li><a href="../270263/index.html">Flexible logging system on Go</a></li>
<li><a href="../270265/index.html">How WiFi breaks loose, or Without wires and leads</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>