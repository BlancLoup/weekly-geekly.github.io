<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Recovery PDP 11/04. Tape station TU60</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuation of the translation of the article on the restoration of one old interesting machine. In the first part, we adjusted the main board unit. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Recovery PDP 11/04. Tape station TU60</h1><div class="post__text post__text-html js-mediator-article">  <i>Continuation of the translation of the article on the restoration of one old interesting machine.</i>  <i>In the <a href="http://habrahabr.ru/post/243551/">first</a> part, we adjusted the main board unit.</i>  <i>Many heavy pictures.</i>  <i>Italic my comments.</i> <br><br><h3>  Streamer TU60 and controller TA11 </h3><br>  In the 70s, DEC created a simple replacement for punched tapes, which was based on a variety of simple audio cassettes.  The TU60 accommodates two blocks of streamers.  50 meter tape could store up to 100Kb: <br><br><img src="https://habrastorage.org/files/562/fb8/22c/562fb822ccfc4da9adfec6d5c58e95ed.png"><br><a name="habracut"></a><br>  All the drive logic is contained in 2x six-contact boards ( <i>I wrote about this earlier, unification is good</i> ): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/76d/9b9/ccd/76d9b9ccd9514d0ca3c4181b9b182a6d.png"><br><br>  In the top view, you can see a board with analog logic, which controls the motors and reads data from the magnetic heads.  Unlike conventional audio cassettes, the drives in the TU60 do not use a tension drum to control the speed of the tape passage.  Instead, two independent motors are used.  One to rewind the tape and to keep it in tension.  The second one, controlled by servo, serves to pull the tape forward ( <i>in fact, this is a hell of a scheme. When the cassette is played or just pauses, the first motor is also turned on. Let's say one of them tries to wind back 100 revolutions, and the second - forward at 110. And then the stronger wins, but, of course, the magnetic tape does not really like it, so it is not even recommended to keep this station turned on for a long time.</i> ).  The rotation speed of the second motor is constant ( <i>not quite correctly stated, it is constant when reading the tape, but the server is the same! And the speed changes depending on the tasks. For example, when the tape is idle, this motor paired with the first, reverse, motor provides tension, there is its speed lower than during broaching</i> ), the bitrate on the tape is also, so the information density varies throughout the length of the tape.  The TU60 uses a Manchester code to encode the data. <br><br>  The TA11 controller module is represented by the four-contact Unibus M7892 board ( <i>I also wrote about the different names of one board in the last article</i> ): <br><br><img src="https://habrastorage.org/files/495/eea/a2c/495eeaa2c7cd4ebba1beea2891ba9f3f.png"><br><br>  The controller provides a simple interface from two registers: command-status ( <i>despite frequent practice, give the register for reading in one format and accept for writing in the other, everything is wrong here. This is a complete register, but in which some fields are read-only , the others are write-only, but there are also mixed read-write.</i> ), available at 0177500, and a data buffer, located on 0177502. The board is not just an intermediary between TU60 and PDP-11, but also contains additional logic - a work circuit interrupt and address decoder <i>(it is necessary to catch the reference to Regis</i>  <i>frames).</i> <br><br>  When I started playing with this device, I immediately ran into a problem.  The rewind button seemed to work fine.  But then, suddenly, she broke down.  It was clear that the triangular thing that connected the motor axis and the cassette fell from the axis.  According to the drawings, there should be an installation screw # 2-56 1/8 "( <i>inch size</i> ). But it was not there! And it was not clear how he could disappear. The second drive had the same problem (this kind of installation screws is extremely difficult to find in Sweden, for we use the metric system.) I looked more closely at the scheme, and noticed ‚Äúloctite‚Äù on the other lower triangular coupling instead of ‚Äúset screw‚Äù ( <i>Loctite produces glue and other chemistry</i> ). Perhaps they just used Loctite for both linkages ? Anyway, I bought glue and, you know what, it worked.  just great! <br><br>  However, the Maindec ZTAA diagnostic test did not pass.  The first problem I discovered was the DEC8881 driver located on the control board, which prevented the EOT and BOT signals from passing.  I replaced it with 7439, which I bought in China for about $ 3 / piece.  The interesting thing is that when I unsoldered the DEC8881, it was labeled 7439 below!  After this, the diagnosis began to take place on the second streamer, but not on the first one.  Broach forward did not work at all.  Step by step, I tracked the faulty open collector driver 75452. Finally, both drives passed ZTAA.  But not ZTAB ... <br><br>  In order to find out what happens when writing data to a tape, I wrote a small program in assembler, which continuously wrote a sequence of bytes from 0 to 255 throughout the tape.  The program worked, so I modified it the same way to read data from the tape.  By connecting the logic analyzer to the data buffer, I received a constant stream of bytes 00, 01, 02, ... FD, FE, FF, 00, 01. Reading and writing worked! <br><br><h3>  Launch CAPS-11 </h3><br>  I received images of tapes with the CAPS-11 operating system.  The boot cassette contained the file CTLOAD.SYS, which provided the initial load of the CAPS-11 OS itself.  Well, maybe the ‚Äúoperating system‚Äù is too loud, the CAPS-11 is a fairly simple command line parser with the functions of loading and saving files to a cassette.  The system itself was in the CAPS11.S8K file, and was linked to work in an environment with 8 kilograms of memory ( <i>memory in the PDP was measured in processor words. By the way, this was a good octal system that was used to set numbers, mainly addresses</i> ) <i>.</i> .  The boot process of this OS is quite complicated.  The boot area (located at 01000) is called CBOOT.  It skips the first 32 bytes of the CTLOAD.SYS file (which must be first on the tape).  It then reads the next 128 bytes into memory at address 0. This part of CTLOAD.SYS is called PRELDR.  PRELDR finds out the size of available memory and loads the entire CTLOAD.SYS into memory at the highest possible address.  The unit to be loaded contains CABLDR and CBOOT (mirror).  CABLDR is Cassette Absolute Loader, but, despite the name, the format of the files read is the same as for punched tapes.  It follows that CAPS11.S8K has a punched tape format, and can be easily downloaded via PDP11GUI ( <i>read about this program in the last article</i> ).  However, since CABLDR uses the switch register, which the programming console provides, to determine what and how to load ( <i>in this register, for example, it was possible to set the system relocation address and load it to the user address</i> ), and since I have no, CABLDR stops the machine with the exception of non-existent memory. <br><br>  Using the PDP11GUI with a starting address of 021510, allows you to see the CAPS-11 prompt.  The system from the beginning of the 70s was launched in 2014. 40 years: <br><br><img src="https://habrastorage.org/files/e64/b72/d9f/e64b72d9f8674053969fc1a4255d674e.png"><br><br>  Undoubtedly, the TU60 does not work very well. <br><br><h3>  Running C-code on a bare system </h3><br>  In order to deal with the problem of TU60, it is necessary that this device could simply repeat the recorded sequence of operations in the desired order.  Alas, the work with diagnostics in the XXDP is rather unpredictable.  They can print the same error code for both read and write operations.  At least I can‚Äôt pinpoint what‚Äôs going wrong.  In addition, when using a logic analyzer, I can carry out the same measurements over and over again, only slightly changing the test points for research.  I decided that the best way to move on is to write my own simple test program.  Before that, I wrote a tiny assembler code that read and wrote data on tape.  But even with a small increase in the amount of code, more and more effort was needed to debug, because I am not a very experienced assembler programmer for PDP-11.  I love C. <br><br>  What do you need to write C programs?  Of course, the cross compiler!  Page <a href="http://www.diane-neisius.de/pdp11/index_E.html">Diane Neisus</a> inspired me.  I downloaded Binutils 2.24 with GCC 4.8.2 and compiled them. <br><br>  Binutils: <br><pre><code class="hljs go">src/configure --target=pdp11-aout --disable-nls <span class="hljs-built_in"><span class="hljs-built_in">make</span></span> all sudo <span class="hljs-built_in"><span class="hljs-built_in">make</span></span> install</code> </pre> <br>  GCC: <br><pre> <code class="hljs bash">src/configure --target=pdp11-aout --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-nls --without-headers --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-languages=c make all-gcc sudo make install-gcc</code> </pre><br>  Then I needed a file with an entry point for CRT - crt0.s.  I just wrote a minimal version that worked: <br><pre> <code class="hljs pgsql"> .text .globl _main, ___main, _start _start: mov <span class="hljs-meta"><span class="hljs-meta">$400</span></span>,sp jsr pc, _main halt ___main: rts pc</code> </pre><br>  Since the formatted line output is quite a useful thing, I looked for and found a <a href="http://www.sparetimelabs.com/tinyprintf/tinyprintf.php">tiny printf implementation for embedded development</a> that completely satisfied me.  Compiling the library and trying to link it, I received a packet of messages that many functions were not found - ___mulhi3, ___udivhi3 and others.  Functions were used by gcc instead of the native instructions of the PDP-11 assembler.  I had to write my own versions of these simple functions that performed multiplication, division, and taking the remainder. <br><br>  Now, at compile time using the -m10 flag used to create a PDP-11/10 compatible output file, the compiler crashed while generating code to convert short to long.  The only solution I found is to compile under the PDP-11/40 and then manually replace those instructions that are not supported by the PDP-11/04, like SXT or ASHC. <br><br>  After that, I was ready to write a real Hello world: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">pdp11-aout-gcc</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-m10</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-Ttext</span></span> 1000 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-msoft-float</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-nostartfiles</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-nodefaultlibs</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-nostdlib</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">crt0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.s</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">printf</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.c</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.c</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">divmulmod</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.s</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pdp11-aout-objcopy</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-O</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">binary</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">hello</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.dmp</span></span></code> </pre><br>  I told the linker that I had to relocate the code to the address 0x1000 or 010000, and then I used objdump to convert the objektnik to a pure binary file. <br><br>  At first I tried to run this file in the E11 emulator, before turning on the real hardware.  But here is a screenshot of the launch via PDP11GUI on a real machine: <br><br><img src="https://habrastorage.org/files/744/763/5d1/7447635d1ec6434fb5a3d5f873a1a9dc.png"><br><br>  Excellent!  Formatted output works as expected.  Multiplication, division and taking the remainder also give the correct result (Well, in fact, not quite. It turned out that the function of taking the remainder contains a bug, which I had to fix).  Now I had an easy way to write my own C test programs that would load my old TU60.  In the end, I think I can write a program that reads files through the serial port and sends them to the TU60, thus creating boot cartridges.  In any case, I have to patch CABLDR inside CTLOAD.SYS so that it does not try to read the switch register, which certainly results in an exception being thrown.  (The machine does not have a programming console). <br><br><h3>  TU60EXERCISER </h3><br>  I spent a few hours writing a small program, which I called the <a href="">TU60EXERCISER</a> : <br><br><img src="https://habrastorage.org/files/5f8/40b/2c1/5f840b2c12c84ab3a7f48ed6a71cb7d7.png"><br><br>  Now I can perform any operations on the drive in an easier way than using standard ZTA ** programs.  Testing team READ revealed a problem on the driver with an open collector DEC8881 ( <i>this is the next DEC8881, and not the one that was replaced earlier</i> ), which I did not notice earlier when I connected the logic analyzer directly to the TU60 data buffer.  The problem was that the CRC generation or, conversely, the CRC check failed.  I always got a CRC error when reading the data, even when they were read correctly. <br><br>  The TU60EXERCISER'a source can be found <a href="https://github.com/MattisLind/tu60tools">here</a> . <br><br><h3>  Search for errors in the logic of working with CRC </h3><br>  Below are four photos showing what happens when we write ‚ÄúAB‚Äù characters to tape, and a 16-bit checksum is generated.  The data LSB is written first, and the WRITED signal is set to the active-low level. <br><br>  The clue is that the CRC is generated by a shift register with feedback from the input signal passing through the XOR gates for bits 15, 13 and 0. <br><br><img src="https://habrastorage.org/files/555/043/a32/555043a32ef444698f45cfa6ff7aeade.png"><br><br>  Is the error obvious?  I did not immediately notice her, but after a few hours I studied the photo again and found it! <br><br>  Bit 5 is stuck at a high level.  But not always, as sharp-eyed comrades can correct me.  At the beginning, all bits are zero.  That's right, but the entire shift register is in a reset state due to the fact that it was given a clear signal ( <i>at 8271, like many others, there is a state clearing pin</i> ).  In this case, the output is correct, but, when sequential data is entered into the shift register, it produces an incorrect result.  He always moves one.  The element is implemented by the Signetics N8271 chip, similar to Texas Instruments SN74179. <br><br>  I ordered a new one from Bulgaria (!). <br><br><h3>  One step forward and two (three?) Back </h3><br>  I had several failures.  After I finally got 74179 from Bulgaria and soldered it, and my TU60EXERCISER program, with the appropriate emulator setup, tested in E11, the tapes began to fail.  This was manifested in the fact that the friction between the head and the tape was so great that the streamer could not rewind them correctly.  In addition, this led to a situation where the drive could not write or count anything due to the fact that the movement of the tape was intermittent. <br><br>  It turned out that this is a common <a href="http://library.stanford.edu/blogs/digital-library-blog/2013/08/playback-squeaky-cassettes-stanford-media-preservation-lab">problem of</a> old tapes.  I did not have at hand Deoxit D5 (a <i>special lubricant for electro-mechanical connections, used in the article by reference</i> ).  I tried the CRC silicone spray, but it did not give any noticeable effect. <br><br>  Therefore, you need to look for new tapes.  I tried to convert standard audio tapes with a soldering iron.  In some way it worked, but for some reason it was sometimes not detected that the rewind reached the beginning of the tape.  The streamer just kept rewinding at high speed. <br><br>  But then I, nevertheless, found a guy with Ebay from Germany, who sold me 10 Verbatim cassettes from a thermopolymer for 1 euro each. <br><br>  When they arrived, I immediately rushed to test them, but it turned out that the computer no longer gives me the command line of the console emulator.  What happened?  Having connected the logic analyzer, I found that the machine stops after trying to execute the instruction ‚Äúmov‚Äù on the 83rd line. <br><pre> <code class="hljs objectivec"> <span class="hljs-number"><span class="hljs-number">77</span></span> <span class="hljs-number"><span class="hljs-number">165046</span></span> <span class="hljs-number"><span class="hljs-number">005503</span></span> adc r3 ; R3=<span class="hljs-number"><span class="hljs-number">000000</span></span> C=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">78</span></span> <span class="hljs-number"><span class="hljs-number">165050</span></span> <span class="hljs-number"><span class="hljs-number">000303</span></span> swab r3 ; R3=<span class="hljs-number"><span class="hljs-number">000000</span></span> C=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">79</span></span> <span class="hljs-number"><span class="hljs-number">165052</span></span> <span class="hljs-number"><span class="hljs-number">001377</span></span> bne . ; br . <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FAIL <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">81</span></span> ; ----------------------------------------- <span class="hljs-number"><span class="hljs-number">82</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span> <span class="hljs-number"><span class="hljs-number">165054</span></span> <span class="hljs-number"><span class="hljs-number">012702</span></span> <span class="hljs-number"><span class="hljs-number">165000</span></span> T2: mov <span class="hljs-meta"><span class="hljs-meta">#data0,r2 ; R2=165000 84 165060 011203 mov (r2),r3 ; R2=165000 R3=165000</span></span></code> </pre><br><br>  Connecting the probes to the micro address bus showed that, after the sampling step, the processor jumps to the micro instruction at address 60 instead of 62 (source mode 2 handler ( <i>when decoding the instructions, there are 8 operand addressing modes, a la register, the immediate value, etc. For some reason, mode 0 was considered here, instead of mode 2. The mode itself is encoded directly in the instructions.</i> )).  It seems that the E88 does not work, as its output is always 1, regardless of the input.  But it is possible that there is also a problem with the E77, since it controls the micro address bus.  In any case, I have neither 7427 nor 74H01.  A fellow collector from Sweden sent me 7427 for verification. <br><br>  But, while this chip is on the way, I can use a spare processor board for testing, so as not to waste time. <br><br>  I started checking new cassettes using ZTAA diagnostics, which went perfectly well.  Then I launched ZTAB, which should also be successful, since I fixed the CRC check.  I started the test and left for half an hour.  When I returned, the sound made by the streamer was different, unusual, and the console was full of endless heaps of errors.  The second drive rotated very slowly.  It turned out that rubber or plastic on the spindle turned into some amorphous glue. <br><br><img src="https://habrastorage.org/files/9b9/6be/f33/9b96bef33b96448d870393dc69be7390.png"><br><br>  I was looking for any replacement for this elastic band, but I could not find anything that would fit snoop-snoop.  I tried two layers of bicycle tire chamber.  I was not sure that this type of rubber is soft enough.  But, in any case, I had to use good glue in order to glue the rubber on the spindle wheel, because the gum on the bad glue quickly flew off.  The second problem was that the thickness of the bicycle chamber was not constant over the entire cut circle.  It may or may not interfere.  Let's see. <br><br>  I went and asked the plumbers if they had anything suitable, but, unfortunately, they could not help me. <br><br><h3>  New rubber pad on the spindle </h3><br>  By the way, at that moment I received 7427 to replace the chip in the E88 position, and the processor was working!  Through the Swedish electronics forum, I contacted the person who sent me a spindle gum.  I was able to remove the old one and paste a new one on the super glue. <br><br>  Now the majority of diagnostics pass on both drives, with the exception of ZTAE, which doesn‚Äôt check anything special? <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs vhdl">@ <span class="hljs-number"><span class="hljs-number">007574</span></span> <span class="hljs-number"><span class="hljs-number">006574</span></span> <span class="hljs-number"><span class="hljs-number">006774</span></span> <span class="hljs-number"><span class="hljs-number">170617</span></span> @DD CLEARING MEMORY CHMDDA0 XXDP+ DD MONITOR <span class="hljs-number"><span class="hljs-number">8</span></span>K BOOTED VIA UNIT <span class="hljs-number"><span class="hljs-number">0</span></span> ENTER DATE (DD-MMM-YY): RESTART ADDR:<span class="hljs-number"><span class="hljs-number">033726</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> HZ? NY LSI? N THIS <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> XXDP+. <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> <span class="hljs-string"><span class="hljs-string">"H"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-string"><span class="hljs-string">"H/L"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> DETAILS .D ENTRY# FILNAM.EXT DATE LENGTH START <span class="hljs-number"><span class="hljs-number">000001</span></span> HMDDA1.SYS <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR-<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">000050</span></span> <span class="hljs-number"><span class="hljs-number">000002</span></span> HDDDA1.SYS <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR-<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">000071</span></span> <span class="hljs-number"><span class="hljs-number">000003</span></span> HUDIA0.SYS <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR-<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">000074</span></span> <span class="hljs-number"><span class="hljs-number">000004</span></span> UPD1 .BIN <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR-<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">000102</span></span> <span class="hljs-number"><span class="hljs-number">000005</span></span> UPD2 .BIN <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR-<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">000116</span></span> <span class="hljs-number"><span class="hljs-number">000006</span></span> HELP .TXT <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR-<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">000136</span></span> <span class="hljs-number"><span class="hljs-number">000007</span></span> HSAAA0.SYS <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR-<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">000170</span></span> <span class="hljs-number"><span class="hljs-number">000010</span></span> SETUP .BIN <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR-<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">000220</span></span> <span class="hljs-number"><span class="hljs-number">000011</span></span> GKAAA0.BIC <span class="hljs-number"><span class="hljs-number">1</span></span>-MAR-<span class="hljs-number"><span class="hljs-number">89</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">000252</span></span> <span class="hljs-number"><span class="hljs-number">000012</span></span> GKABC0.BIC <span class="hljs-number"><span class="hljs-number">1</span></span>-MAR-<span class="hljs-number"><span class="hljs-number">89</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">000270</span></span> <span class="hljs-number"><span class="hljs-number">000013</span></span> ZTAAC0.BIN <span class="hljs-number"><span class="hljs-number">11</span></span>-AUG-<span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">000307</span></span> <span class="hljs-number"><span class="hljs-number">000014</span></span> ZTABC0.BIN <span class="hljs-number"><span class="hljs-number">11</span></span>-AUG-<span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">000327</span></span> <span class="hljs-number"><span class="hljs-number">000015</span></span> ZTACC0.BIN <span class="hljs-number"><span class="hljs-number">11</span></span>-AUG-<span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">000350</span></span> <span class="hljs-number"><span class="hljs-number">000016</span></span> ZTADC0.BIN <span class="hljs-number"><span class="hljs-number">11</span></span>-AUG-<span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">000365</span></span> <span class="hljs-number"><span class="hljs-number">000017</span></span> ZTAEB0.BIN <span class="hljs-number"><span class="hljs-number">11</span></span>-AUG-<span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">000405</span></span> <span class="hljs-number"><span class="hljs-number">000020</span></span> ZTAFC0.BIN <span class="hljs-number"><span class="hljs-number">11</span></span>-AUG-<span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">000422</span></span> <span class="hljs-number"><span class="hljs-number">000021</span></span> ZTAHA0.BIN <span class="hljs-number"><span class="hljs-number">11</span></span>-AUG-<span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">000424</span></span> <span class="hljs-number"><span class="hljs-number">000022</span></span> ZKLAE0.BIC <span class="hljs-number"><span class="hljs-number">11</span></span>-AUG-<span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">000432</span></span> <span class="hljs-number"><span class="hljs-number">000023</span></span> ZDLAF1.BIN <span class="hljs-number"><span class="hljs-number">12</span></span>-MAR-<span class="hljs-number"><span class="hljs-number">77</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">000450</span></span> <span class="hljs-number"><span class="hljs-number">000024</span></span> ZDLBB0.BIN <span class="hljs-number"><span class="hljs-number">11</span></span>-AUG-<span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">000471</span></span> <span class="hljs-number"><span class="hljs-number">000025</span></span> ZDLCA0.BIC <span class="hljs-number"><span class="hljs-number">11</span></span>-AUG-<span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">000511</span></span> <span class="hljs-number"><span class="hljs-number">000026</span></span> ZDLDA1.BIC <span class="hljs-number"><span class="hljs-number">29</span></span>-JAN-<span class="hljs-number"><span class="hljs-number">77</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">000534</span></span> <span class="hljs-number"><span class="hljs-number">000027</span></span> ZDLOC0.BIN <span class="hljs-number"><span class="hljs-number">17</span></span>-AUG-<span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">000557</span></span> <span class="hljs-number"><span class="hljs-number">000030</span></span> ZKWKA1.BIC <span class="hljs-number"><span class="hljs-number">29</span></span>-JAN-<span class="hljs-number"><span class="hljs-number">77</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">000563</span></span> .R ZTABC0 MAINDEC-<span class="hljs-number"><span class="hljs-number">11</span></span>-DZTAB-C SWR = <span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> = TESTING DRIVE A | <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> PASS TESTING DRIVE B ` <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> PASS TESTING DRIVE A ` DATA PROBLEM PC TACS EXPECT RCV<span class="hljs-symbol"><span class="hljs-symbol">'D</span></span> <span class="hljs-number"><span class="hljs-number">010470</span></span> <span class="hljs-number"><span class="hljs-number">000004</span></span> <span class="hljs-number"><span class="hljs-number">000377</span></span> <span class="hljs-number"><span class="hljs-number">000122</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> PASS TESTING DRIVE B ` <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> PASS TESTING DRIVE A ` <span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-number"><span class="hljs-number">177500</span></span> <span class="hljs-number"><span class="hljs-number">001056</span></span> <span class="hljs-number"><span class="hljs-number">016632</span></span> @DD CLEARING MEMORY CHMDDA0 XXDP+ DD MONITOR <span class="hljs-number"><span class="hljs-number">8</span></span>K BOOTED VIA UNIT <span class="hljs-number"><span class="hljs-number">0</span></span> ENTER DATE (DD-MMM-YY): RESTART ADDR:<span class="hljs-number"><span class="hljs-number">033726</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> HZ? NY LSI? N THIS <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> XXDP+. <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> <span class="hljs-string"><span class="hljs-string">"H"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-string"><span class="hljs-string">"H/L"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> DETAILS .R ZTAEB0 MAINDEC-<span class="hljs-number"><span class="hljs-number">11</span></span>-DZTAE-B SWR = <span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> = DRIVE A <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> DRIVE B WILL BE TESTED *** FORMAT *** DRIVE A <span class="hljs-number"><span class="hljs-number">001612</span></span> <span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-number"><span class="hljs-number">001056</span></span> <span class="hljs-number"><span class="hljs-number">011646</span></span> @DD CLEARING MEMORY CHMDDA0 XXDP+ DD MONITOR <span class="hljs-number"><span class="hljs-number">8</span></span>K BOOTED VIA UNIT <span class="hljs-number"><span class="hljs-number">0</span></span> ENTER DATE (DD-MMM-YY): RESTART ADDR:<span class="hljs-number"><span class="hljs-number">033726</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> HZ? NY LSI? N THIS <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> XXDP+. <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> <span class="hljs-string"><span class="hljs-string">"H"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-string"><span class="hljs-string">"H/L"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> DETAILS .R ZTADC0 MAINDEC-<span class="hljs-number"><span class="hljs-number">11</span></span>-DZTAD-C SWR = <span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> = TESTING DRIVE A <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> DRIVE B WRITE-<span class="hljs-keyword"><span class="hljs-keyword">FILE</span></span>-GAP IMPROPER FLAG OCCURRED TEST <span class="hljs-literal"><span class="hljs-literal">ERROR</span></span> PC PC TACS TADB <span class="hljs-number"><span class="hljs-number">005636</span></span> <span class="hljs-number"><span class="hljs-number">010562</span></span> <span class="hljs-number"><span class="hljs-number">120140</span></span> <span class="hljs-number"><span class="hljs-number">000017</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> PASS TESTING DRIVE B <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> DRIVE A READ SHORT <span class="hljs-keyword"><span class="hljs-keyword">RECORD</span></span> TEST <span class="hljs-literal"><span class="hljs-literal">ERROR</span></span> BYTES PC PC TACS TADB LEFT <span class="hljs-number"><span class="hljs-number">004742</span></span> <span class="hljs-number"><span class="hljs-number">011204</span></span> <span class="hljs-number"><span class="hljs-number">140144</span></span> <span class="hljs-number"><span class="hljs-number">000350</span></span> <span class="hljs-number"><span class="hljs-number">000006</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BUFFER</span></span> COMPARE BAD DATA READ TEST <span class="hljs-literal"><span class="hljs-literal">ERROR</span></span> EXPT<span class="hljs-symbol"><span class="hljs-symbol">'D</span></span> RCV<span class="hljs-symbol"><span class="hljs-symbol">'D</span></span> BYTE PC PC TACS DATA DATA NUMBER <span class="hljs-number"><span class="hljs-number">004746</span></span> <span class="hljs-number"><span class="hljs-number">010512</span></span> <span class="hljs-number"><span class="hljs-number">140144</span></span> <span class="hljs-number"><span class="hljs-number">000314</span></span> <span class="hljs-number"><span class="hljs-number">000357</span></span> <span class="hljs-number"><span class="hljs-number">000001</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> PASS TESTING DRIVE A <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> DRIVE B <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> PASS TESTING DRIVE B <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> DRIVE A <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> PASS TESTING DRIVE A <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> DRIVE B <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> PASS TESTING DRIVE B <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> DRIVE A <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> PASS TESTING DRIVE A <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> DRIVE B <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> PASS TESTING DRIVE B <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> DRIVE A</code> </pre><br></div></div><br><br>  The next question was to choose the right carrier.  I only had 2 original tapes from DEC.  Later I got some NCR tapes from a guy from Morocco.  Apparently, they were stored in the desert for a long time, because all the grease evaporated.  Verbatim cassettes from a guy from Germany look pretty good.  Although I had problems with a pressure device made from something like foam, which wears out over time.  Finally, I have Maxell cassettes that fail almost continuously.  It seems that the tape can not withstand the tension created by the drive, it breaks after just a few rewinds ( <i>which, by the way, I wrote about earlier</i> ). <br><br><img src="https://habrastorage.org/files/5a7/fd7/a11/5a7fd7a1127c4148808d9649f64c829a.png"><br><br>  I also tried to convert ordinary audio cassettes, but with varying success.  Some worked, some did not. <br><br>  The next step is to record CAPS-11 on the tape and run it!  Just need a little <a href="https://github.com/MattisLind/tu60tools">refinement TU60EXERCISER</a> . <br><br><h3>  Finally loading from the cassette </h3><br>  After several rounds of debugging TU60EXERCISER (now renamed to 60tools), I finally got the option that allowed me to write data to tape.  Now, I wonder if the PDP-11 will load from the cassette? <br><br>  After typing "CT" in the console emulator, the tape drive first wrapped the tape for a short moment, but then just stopped.  I began to reread the manual for CAPS-11 and noticed the following: <br><blockquote>  PRELDR should be the first entry in the first file on the system tape.  This preloader is a small program written in accordance with the ‚ÄúCBOOT Loader Format‚Äù, which is sufficiently advanced to determine the size of the memory and load subsequent programs into the upper memory addresses.  CBOOT links, loads into memory at address 0 and starts it automatically.  CAPS-11, at this stage of loading, is depicted in Figure E-3 as Memory Map # 2. <br></blockquote><br>  Does PRELDR rely on the fact that CBOOT, judging by the scheme, is located at 01000?  I, of course, boot from the PROM. <br><br>  <b>EDIT: The</b> real source of the problem is found thanks to a collector-friend: CBOOT places the TA11 CSR ( <i>command-and-status register of the tape drive controller</i> ) in R0 ( <i>user processor register</i> ), while the M9312 CT ( <i>M9312 is a console emulator, CT is the command of this emulator, but At the same time, this is the name of the EPROM chip, which contains the boot code from the tape. The command only runs the code of this EPROM, but it automatically tries to boot even when the system starts.</i> ) When loaded, it inserts TA11 CSR in R1 (and the number of the tape measure in R0).  PRELDR expects to see precisely in R0 the value of register TA11.  I have to patch PRELDR so that it can boot directly from the CT-ROM. <br><br>  I used E11 to build CBOOT from sources and wrote the result in the <a href="">CBOOT.BIN</a> file.  After that, I loaded it into memory via pdp11gui and ran it from the address 01000. Yes!  The tape began to play for about half a minute, and then a single "." Appeared.  I launched CAPS-11! <br><pre> <code class="hljs objectivec">.DI -- <span class="hljs-built_in"><span class="hljs-built_in">CTLOAP</span></span> SYS <span class="hljs-number"><span class="hljs-number">19</span></span>-FEB<span class="hljs-number"><span class="hljs-number">-14</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CAPS11</span></span> S8K <span class="hljs-number"><span class="hljs-number">25</span></span>-NOV<span class="hljs-number"><span class="hljs-number">-13</span></span> DEMO PAL <span class="hljs-number"><span class="hljs-number">25</span></span>-NOV<span class="hljs-number"><span class="hljs-number">-13</span></span> EDIT SLG <span class="hljs-number"><span class="hljs-number">25</span></span>-NOV<span class="hljs-number"><span class="hljs-number">-13</span></span> LINK SRU <span class="hljs-number"><span class="hljs-number">25</span></span>-NOV<span class="hljs-number"><span class="hljs-number">-13</span></span> ODT SLG <span class="hljs-number"><span class="hljs-number">25</span></span>-NOV<span class="hljs-number"><span class="hljs-number">-13</span></span> PAL SRU <span class="hljs-number"><span class="hljs-number">25</span></span>-NOV<span class="hljs-number"><span class="hljs-number">-13</span></span> PIP SRU <span class="hljs-number"><span class="hljs-number">25</span></span>-NOV<span class="hljs-number"><span class="hljs-number">-13</span></span> ?<span class="hljs-literal"><span class="hljs-literal">NO</span></span> SENTINEL FILE ?SYNTAX ERROR .</code> </pre><br>  My program, for writing to tape, did not write the closing file, which should be the last on the tape.  However, it worked and so!  CTLOAP.SYS is the patched version of CTLOAD.SYS, from which all references to the switch register have been removed so that the program can work on machines only with the operator console. <br><br><h3>  Archeology of old cassettes </h3><br>  For starters, I patched CTLOAD.SYS to boot directly from the CT EPROM to the M9312, which is extremely convenient.  No more swearing when typing commands or when uploading a file ( <i>9600bps, sadly it all</i> ) boot loader.  Just turn on the INIT toggle switch and the streamer starts working.  Fine.  It turned out that not only PRELDR needs to be modified, but we also need to add the BR instruction ( <i>unconditional short transition, -128 .. + 127</i> ) in order to skip the initialization of the R0 register in the depths of CABLDR.  <a href="">Here is the</a> patched version, if anyone needs it. <br><br>  After downloading the CAPS-11, I was interested in what is actually stored on those two old DEC cassettes.  Photos of one of them are above, it is marked as ‚ÄúS LMS 2 KOP‚Äù.  ‚ÄúKOP‚Äù may mean ‚ÄúKOPIA‚Äù, COPY.  But besides that, I can't make out what the other characters mean.  It contains some files: <br><pre> <code class="hljs objectivec"><span class="hljs-number"><span class="hljs-number">010000</span></span> <span class="hljs-number"><span class="hljs-number">051415</span></span> <span class="hljs-number"><span class="hljs-number">177714</span></span> <span class="hljs-number"><span class="hljs-number">000002</span></span> @CT <span class="hljs-built_in"><span class="hljs-built_in">CAPS</span></span><span class="hljs-number"><span class="hljs-number">-11</span></span> V01<span class="hljs-number"><span class="hljs-number">-02</span></span> .DA <span class="hljs-number"><span class="hljs-number">27</span></span>-MAR<span class="hljs-number"><span class="hljs-number">-14</span></span> .DI <span class="hljs-built_in"><span class="hljs-built_in">CT1</span></span>: <span class="hljs-number"><span class="hljs-number">27</span></span>-MAR<span class="hljs-number"><span class="hljs-number">-14</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CTLOAD</span></span> SYS <span class="hljs-number"><span class="hljs-number">07</span></span>-JAN<span class="hljs-number"><span class="hljs-number">-75</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CAPS11</span></span> S8K <span class="hljs-number"><span class="hljs-number">07</span></span>-JAN<span class="hljs-number"><span class="hljs-number">-75</span></span> PIP SRU <span class="hljs-number"><span class="hljs-number">07</span></span>-JAN<span class="hljs-number"><span class="hljs-number">-75</span></span> EDIT SLG <span class="hljs-number"><span class="hljs-number">07</span></span>-JAN<span class="hljs-number"><span class="hljs-number">-75</span></span> LINK SRU <span class="hljs-number"><span class="hljs-number">07</span></span>-JAN<span class="hljs-number"><span class="hljs-number">-75</span></span> ODT SLG <span class="hljs-number"><span class="hljs-number">07</span></span>-JAN<span class="hljs-number"><span class="hljs-number">-75</span></span> PAL SRU <span class="hljs-number"><span class="hljs-number">07</span></span>-JAN<span class="hljs-number"><span class="hljs-number">-75</span></span> BASIC LDA <span class="hljs-number"><span class="hljs-number">07</span></span>-JAN<span class="hljs-number"><span class="hljs-number">-75</span></span> .</code> </pre><br><br>  In the CAPS-11 system, the cassette is dated January 1975.  Files almost 40 years old.  I made a copy and used my patched bootloader to run it.  She started.  But there was no command line.  It is possible that the software was configured for a different version of hardware, different from mine. <br><br>  It would be interesting to extract the contents of the cassette.  I continued to work on <a href="https://github.com/MattisLind/tu60tools">tu60tools</a> .  Again, long debugging when running on bare metal.  There are no nice stack traces when there is a problem with pointers.  Finally, the TU60read was ready to read files from a cassette, and, it seems, even worked.  At the very least, she correctly read the file that I recorded on the tape.  I used it for a copy cassette made earlier and received the following files: <br><br>  <a href="">CTLOAD.SYS</a> <br>  <a href="">CAPS11.S8K</a> <br>  <a href="">PIP.SRU</a> <br>  <a href="">EDIT.SLG</a> <br>  <a href="">LINK.SRU</a> <br>  <a href="">ODT.SLG</a> <br>  <a href="">PAL.SRU</a> <br>  <a href="">BASIC.LDA</a> <br><br>  I studied the CTLOAD.SYS binary.  It occupies 896 bytes (7 blocks) instead of 1024. But it looks full.  Disassembling shows that most of the code is identical to CTLOAD.SYS, coming with CAPS-11. <br><br>  BASIC.LDA is like a copy of a punched tape with BASIC.  Running strings over this binary, I got ‚ÄúPDP-11 BASIC, VERSION 007A‚Äù.  Similarly, for "CAPS11.S8K" gives "CAPS-11 V01-02".  Therefore, I think that this tape is only slightly different from the original. <br><br>  After that, I tried to do the same study of the second tape, but the file system on it was damaged.  I managed to dig out only this piece of code for the PDP-8: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs sql">TO +1 IF HIGH TEST DCA TEST TAD TABNO AND P777 DCA TABNO /SAVE TABLE NUMBER TAD LTAB DCA TCORE /<span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> CORE ADDRESS CLL CIF JMS I <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">READ</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLES</span></span> TABNO, <span class="hljs-number"><span class="hljs-number">0</span></span> TCORE, <span class="hljs-number"><span class="hljs-number">0</span></span> CLA CLL CDF TAD I BAND1 /<span class="hljs-keyword"><span class="hljs-keyword">FETCH</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> DCA B1 /CHANNELS <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> MEM0 TAD I BAND2 DCA B2 JMS I RSETDF IAC JMS COMWRD /<span class="hljs-keyword"><span class="hljs-keyword">FETCH</span></span> BATCH TRAIN <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> SPA CLA /<span class="hljs-keyword"><span class="hljs-keyword">RELOCATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> BAND? JMP <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> DCA CHNO /YES - <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:ST CHANNEL <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span> TAD B1 /<span class="hljs-keyword"><span class="hljs-keyword">FETCH</span></span> CHANNEL COUNTER JMP <span class="hljs-keyword"><span class="hljs-keyword">BOTH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span>, TAD B1 /CALCULATE <span class="hljs-keyword"><span class="hljs-keyword">FIRST</span></span> CHANNEL <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> CIA DCA CHNO TAD B2 /<span class="hljs-keyword"><span class="hljs-keyword">FETCH</span></span> CHANNEL COUNTER <span class="hljs-keyword"><span class="hljs-keyword">BOTH</span></span>, DCA CHCNT /<span class="hljs-keyword"><span class="hljs-keyword">SAVE</span></span> COUNTER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> PAGE ZERO TAD P5 JMS COMWRD /<span class="hljs-keyword"><span class="hljs-keyword">FETCH</span></span> CHANNEL <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span> SNA /ZERO? JMP ALL /YES - <span class="hljs-keyword"><span class="hljs-keyword">TEST</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ONE BAND TAD M1 /<span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">SAVE</span></span> CORRECT DCA CHNO /CHANNELNUMBER TAD M1 DCA CHCNT /<span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> COUNTER <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span> SKP SINGLE, CLA IAC /<span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> AC <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> ALL, TAD P10 /<span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> AC <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> JMP I RELO /<span class="hljs-keyword"><span class="hljs-keyword">RELOCATE</span></span> ACLEAR, DCA I TEMP /<span class="hljs-keyword"><span class="hljs-keyword">CLEAR</span></span> RCLEAR <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> COMMAND BUFFER ISZ TADDR /<span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> POINTER <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> CORRECT CDF /<span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> TERM <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> TBTAB DCA I TADDR /ZERO <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> TERM JMS I RSETDF /<span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATA</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FIELD</span></span> NOP CMA DCA QCPFEL JMS I DCWAIT TAD QCP /INDICATE READY CIF CLL JMS I MONDSC /<span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> QCP HLT /<span class="hljs-keyword"><span class="hljs-keyword">SECURITY</span></span> HALT COMWRD, <span class="hljs-number"><span class="hljs-number">0</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> TERM <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> AC TAD COMAND DCA TEMP /ADDR <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> COMAND BUFFER TAD I TEMP /<span class="hljs-keyword"><span class="hljs-keyword">FETCH</span></span> COMAND WORD JMP I COMWRD /<span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> AC <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> /CONSTANTS: BAND1, <span class="hljs-number"><span class="hljs-number">66</span></span> /PAGE0, MEM0 BAND2, <span class="hljs-number"><span class="hljs-number">67</span></span> / <span class="hljs-string"><span class="hljs-string">" "</span></span> B1, <span class="hljs-number"><span class="hljs-number">0</span></span> B2, <span class="hljs-number"><span class="hljs-number">0</span></span> TEMP, <span class="hljs-number"><span class="hljs-number">0</span></span> P3, <span class="hljs-number"><span class="hljs-number">3</span></span> P4, <span class="hljs-number"><span class="hljs-number">4</span></span> P5, <span class="hljs-number"><span class="hljs-number">5</span></span> P10, <span class="hljs-number"><span class="hljs-number">10</span></span> P50, <span class="hljs-number"><span class="hljs-number">50</span></span> P51, <span class="hljs-number"><span class="hljs-number">51</span></span> P52, <span class="hljs-number"><span class="hljs-number">52</span></span> P54, <span class="hljs-number"><span class="hljs-number">54</span></span> P55, <span class="hljs-number"><span class="hljs-number">55</span></span> P77, <span class="hljs-number"><span class="hljs-number">77</span></span> P777, <span class="hljs-number"><span class="hljs-number">777</span></span> P3777, <span class="hljs-number"><span class="hljs-number">3777</span></span> P6000, <span class="hljs-number"><span class="hljs-number">6000</span></span> M1, <span class="hljs-number"><span class="hljs-number">-1</span></span> M2, <span class="hljs-number"><span class="hljs-number">-2</span></span> M2001D, <span class="hljs-number"><span class="hljs-number">-3721</span></span> QCP, <span class="hljs-number"><span class="hljs-number">4023</span></span> /AUT OSTART QCP $</code> </pre><br></div></div><br><br>  Okay.  Now that the machine is running as it should, I will begin the final stage of this PDP-11 recovery project: revitalize the LA30 Decwriter and launch it in conjunction with the PDP-11. <br><br>  <i>In the <a href="http://habrahabr.ru/post/243555/">third</a> part of the article, we repair the LA30 Decwriter terminal.</i> </div><p>Source: <a href="https://habr.com/ru/post/243553/">https://habr.com/ru/post/243553/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243541/index.html">Reveal for everyone!</a></li>
<li><a href="../243543/index.html">High-quality interface JIRA-plugin using the AUI Framework</a></li>
<li><a href="../243545/index.html">SPA-architecture for CRM-systems: part 1</a></li>
<li><a href="../243547/index.html">Python Meetup 10/31/14: asynchrony and soft skills</a></li>
<li><a href="../243551/index.html">PDP Recovery 11/04</a></li>
<li><a href="../243555/index.html">Recovery PDP 11/04. Terminal LA30 Decwriter</a></li>
<li><a href="../243557/index.html">How we united the brand book of partners from Kamchatka to Kaliningrad (Part 2)</a></li>
<li><a href="../243559/index.html">Google will mark mobile sites in search results</a></li>
<li><a href="../243561/index.html">How the cloud makes life easier for startups</a></li>
<li><a href="../243563/index.html">Theoretical minimum * nix-based-systems for WebDev-padawan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>