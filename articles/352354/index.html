<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fluttering bikes. What to do with state saving in Flutter?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(* one of the meanings of the word flutter - flutter) 


 We understand, is there  a life  state saving in Flutter application. What happens if the OS...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fluttering bikes. What to do with state saving in Flutter?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/6w/c7/nm/6wc7nmnesdauxlfetkefpgo5hso.png"><br><p>  <sub><sup>(* one of the meanings of the word flutter - flutter)</sup></sub> </p><br><p>  <em>We understand, is there</em> <del>  a life </del>  state saving in Flutter application.  What happens if the OS decides to restart it.  Where does user input and navigation go, and how to handle it. </p><br><p>  <strong>Disclaimers:</strong> </p><br><ul><li>  for understanding you need to have starting knowledge about Flutter; </li><li>  I think from the point of view of Android, about iOS - this is not for me; </li><li>  I am not an expert in Flutter / Dart, I come up from a position of a beginner; </li><li>  I omit minor points in some places (for example, the implementation of auxiliary functions), the missing can be found in the <a href="https://github.com/TouchInstinct/flutter_save_state">full code of the project</a> . </li></ul><a name="habracut"></a><br><h2 id="chto-takoe-flutter">  What is Flutter </h2><br><p>  <a href="https://flutter.io/">Flutter</a> , a framework for cross-platform development of mobile applications, was announced on Google I / O 17. </p><br><p>  Flutter is made in C and C ++, it implements its 2D rendering engine (WebView is not used).  Something similar to React, development is conducted in the language of <a href="https://www.dartlang.org/">Dart</a> .  The code is written once, and at assembly it is compiled in native for each platform. </p><br><h2 id="pochemu-flutter">  Why Flutter? </h2><br><p>  Flutter (hereinafter referred to as flutter) beckons with a list of advantages: </p><br><ul><li>  <strong>cross-platform</strong> : spend less time on development due to re-use of the code; </li><li>  <strong>speed of work</strong> : AOT compilation to native code; </li><li>  <strong>component set</strong> : there are many sample widgets in the Material Design and Cupertino styles; </li><li>  <strong>hot reload</strong> : save time again. </li></ul><br><p>  In order to avoid the Crusades, the pros and cons: Of course, you cannot choose one tool that will be suitable for solving absolutely all problems, each tool is good for its context.  It seems to me that it would be convenient to use flutter for small projects with conditionally ‚Äútypical‚Äù interfaces and use cases.  In this case, he would seriously shorten the process and get rid of the routine work (writing the same code for two platforms + trying to make it ‚Äúon android like on ios‚Äù). </p><br><h2 id="tak-beri-flutter-i-polzuysya-v-chem-problema">  So take Flutter and use, what's the problem? </h2><br><p>  I‚Äôm worried about a few moments.  They need to be clarified before rushing to do something for production: </p><br><ul><li>  life cycle; </li><li>  architecture; </li><li>  Is it really that fast? </li></ul><br><p>  Let's start in order.  In this article we will deal with life cycle issues.  Perhaps I have a typical paranoia android developer.  The first thing that comes to my mind when I find out about a new solution is ‚ÄúDoes it ensure the preservation of the state?  What happens if the activation dies?  And if the application process dies? ‚Äù </p><br><h2 id="posmotrim-chto-delaet-flutter-s-sohraneniem-sostoyaniya">  Let's see what Flutter does with state saving. </h2><br><p>  Well, check it out!  I create a small demo project from the <a href="https://flutter.io/get-started/codelab/">Kodlab</a> .  This is an application that lists randomly generated words in the list.  As you scroll, new words are added, so the list is conditionally endless.  You can also add these words to your favorites and view your favorites on a separate screen. </p><br><p><img src="https://habrastorage.org/webt/1p/ka/ac/1pkaac4txtx538fjnqkqhl04oa8.png" width="60%" align="left">  I put the flag ‚Äúdo not keep activities‚Äù, launch, minimize, deploy, and ... bingo!  Well, that is quite the opposite, but the pessimist in me says ‚ÄúI warned you‚Äù and rubs his hands. </p><br><p>  What's happening: </p><br><ol><li>  the word list is re-created; </li><li>  "Favorites" is reset; </li><li>  scroll position is not saved; </li><li>  the navigation is not saved (it was on the second screen, when unfolded, it throws it out on the first one) </li></ol><br><p><br>  <strong>On the first two points (the list of words is created anew, the ‚Äúfavorites‚Äù is reset)</strong> everything is in order - this is about business logic, no one expects such things from the framework.  If I want the words to be saved until the user restarts the application, then save them somewhere, at least just in shared preferences. </p><br><p>  <strong>On the third point (the position of the scroll</strong> is <strong>not saved)</strong> - it seems to be normal.  You never know what happens to the data when you restart, you can save here and not necessary.  And RecyclerView would not save the scroll position automatically either. </p><br><p>  For the sake of interest, I checked what is happening with TextField (analogous to EditText).  It turned out that the user input from it in such a situation disappears, which seems to be quite bad.  Then I went to look at other widgets that allow you to do input: Slider, Switcher, CheckBox, etc. <br>  It turned out that here, in principle, the logic of input organization is slightly different (different from Androids).  In general, widgets do not store user input.  That is, if you poke into the checkbox, there will not be a tick.  For it to appear, you need to have a separate field for this, transfer it to the widget, and change the field to a click event.  The field changes -&gt; the drawing changes. </p><br><p>  If we build the chain further, the loss of values ‚Äã‚Äãof these fields with the state will mean resetting user input. </p><br><p>  And the bad news: if you store these fields somewhere in the in-memory cache, they will be lost if the process is restarted.  Moreover, if you store them somewhere in the Dart (in the field of any class, even if it is singleton), they will be lost even if the activation is restarted. <br>  <em>But when you change the orientation, everything will be fine.</em>  <em>Because inside the flutter - one view in one activit, on which the whole drawing takes place.</em>  <em>And when you change the orientation of this activity is not recreated.</em> </p><br><p>  <strong>On the fourth point (navigation</strong> is <strong>not saved)</strong> - very disappointing.  Android saves navigation, but no flutter. </p><br><p>  I'm going to google and find out that: <br>  a) I was not the only one who asked this question, people are <a href="https://github.com/flutter/flutter/issues/6827">actively discussing it</a> on a githaba; <br>  b) the authors of flutter do not yet do anything to save the navigation / state.  Provide developers to handle this on their own. </p><br><p>  To quote their answers: </p><br><blockquote>  We don't currently do anything to make this easy.  We haven't studied this problem in detail yet.  For now you need to save the app. </blockquote><p>  Total of troubles: </p><br><ul><li>  You need to set up the state of the widgets somewhere so that it is restored between restarts of activation; </li><li>  need to somehow save the navigation. </li></ul><br><h2 id="probuem-sohranyat-sostoyanie">  We try to save the state </h2><br><p>  See if there is an inexpensive way to solve this.  I need a proof-of-concept.  Hello bikes! </p><br><p> As an example, I will continue to torment that demo application from the Kodlab.  Task: save navigation and user input.  In this case, let the user input be a scroll position, so as not to complicate.  Plus, I will save the generated words and ‚Äúfavorites‚Äù in shared preferences, but this does not apply to the topic - I will not describe it. </p><br><p>  I changed the demo a little to make it easier to deal with it: I took the widget with random words into a separate file, replaced WordPair with lines, and even little things. <br>  + Everything that is well described in the codebook, I will not repeat here.  About the basic principles, the structure of the application, the tree of widgets, the logic of forming a list of words, see there. </p><br><p>  I want to save user input and navigation in a bundle (remember that there is only one activity).  Obviously, you will need communication between Dart and Android.  Let's figure out how to fix it ( <a href="https://flutter.io/platform-channels/">documentation</a> ).  On the flutter side, you need to create a MethodChannel: </p><br><pre><code class="plaintext hljs">save(String key) async { const platform = const MethodChannel('app.channel.shared.data'); platform.invokeMethod("save", /*     */); }</code> </pre> <br><p>  And on the side of the android create MethodChannel with the same name: </p><br><pre> <code class="kotlin hljs">MethodChannel(getFlutterView(), <span class="hljs-string"><span class="hljs-string">"app.channel.shared.data"</span></span>) .setMethodCallHandler { call, result -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (call.method.contentEquals(<span class="hljs-string"><span class="hljs-string">"save"</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">//    } }</span></span></code> </pre> <br><p>  In what format to save / transfer data?  On the Dart side, this can be anything, and any type can be passed through the MethodChannel.  But on the android side, I want to deal with something uniform that I will put in the Bundle.  To begin with I will try the data (whatever it may be) in json, json in strings, strings in a bundle. </p><br><h3 id="sohranyaem-vvod">  Save input </h3><br><p>  First, let's deal with user input.  Let's get an abstract class that will store state data in itself: </p><br><pre> <code class="plaintext hljs">abstract class Restorable { save(String key); Future&lt;Restorable&gt; restore(String key); }</code> </pre> <br><p>  The key argument is required to associate a specific Restorable with a specific widget.  That is, when creating widgets you will need to give them unique keys. <br>  The implementation to save the position of the scroll will look like this: </p><br><pre> <code class="plaintext hljs">class RandomWordsInput implements Restorable { double scrollPosition = -1.0; RandomWordsInput(); save(String key) async { String json = JSON.encode(this); const platform = const MethodChannel('app.channel.shared.data'); platform.invokeMethod("saveInput", {"key": key, "value": json}); } Future&lt;RandomWordsInput&gt; restore(String key) async { const platform = const MethodChannel('app.channel.shared.data'); String s = await platform.invokeMethod("readInput", {"key" : key}); if (s != null) { var restoredModel = new RandomWordsInput.fromJson(JSON.decode(s)); scrollPosition = restoredModel.scrollPosition; } else { _empty(); } return this; } _empty() { scrollPosition = 0.0; } }</code> </pre> <br><p>  In order not to write serialization with my hands, I use the json_annotation library.  How to use is described <a href="https://flutter.io/json/">on the flutter website</a> . </p><br><p>  On the side of the android in the activit we will create a field for data storage: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> savedFromFlutter: MutableMap&lt;String, String&gt; = mutableMapOf()</code> </pre> <br><p>  In onCreate, we forward the methods: </p><br><pre> <code class="kotlin hljs">MethodChannel(getFlutterView(), <span class="hljs-string"><span class="hljs-string">"app.channel.shared.data"</span></span>).setMethodCallHandler { call, result -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (call.method.contentEquals(<span class="hljs-string"><span class="hljs-string">"save"</span></span>)) { savedModels.put(call.argument&lt;String&gt;(<span class="hljs-string"><span class="hljs-string">"key"</span></span>), call.argument&lt;String&gt;(<span class="hljs-string"><span class="hljs-string">"value"</span></span>)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (call.method.contentEquals(<span class="hljs-string"><span class="hljs-string">"read"</span></span>)) { result.success(savedModels.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(call.argument&lt;String&gt;(<span class="hljs-string"><span class="hljs-string">"key"</span></span>))) } }</code> </pre> <br><p>  And do the save / restore: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSaveInstanceState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(outState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onSaveInstanceState(outState) outState.putParcelable(<span class="hljs-string"><span class="hljs-string">"savedFromFlutter"</span></span>, toBundle(savedModels)); } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRestoreInstanceState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onRestoreInstanceState(savedInstanceState) savedModels = fromBundle(savedInstanceState.getParcelable&lt;Bundle&gt;(<span class="hljs-string"><span class="hljs-string">"savedFromFlutter"</span></span>)) }</code> </pre> <br><p>  Now you need to teach the widget to be saved and restored using Restorable.  In our example, there is a RandomWords widget: </p><br><pre> <code class="plaintext hljs">class RandomWords extends StatefulWidget { @override createState() =&gt; new RandomWordsState(); }</code> </pre> <br><p>  And his condition looks like this: </p><br><pre> <code class="plaintext hljs">class RandomWordsState extends State&lt;RandomWords&gt; { final _suggestions = &lt;WordPair&gt;[]; Widget _buildSuggestions() { return new ListView.builder( padding: const EdgeInsets.all(16.0), itemBuilder: (context, i) { if (i.isOdd) return new Divider(); final index = i ~/ 2; // If you've reached the end of the available word pairings... if (index &gt;= _suggestions.length) { // ...then generate 10 more and add them to the suggestions list. _suggestions.addAll(generateWordPairs().take(10)); } return _buildRow(_suggestions[index]); } ); } }</code> </pre> <br><p>  When creating a widget, we will pass on the key to it: </p><br><pre> <code class="plaintext hljs">class RandomWords extends StatefulWidget { final String stateKey; RandomWords(this.stateKey); @override createState() =&gt; new RandomWordsState(); }</code> </pre> <br><p>  In the RandomWordsState, we set the field to the state: </p><br><pre> <code class="plaintext hljs">class RandomWordsState extends State&lt;RandomWords&gt; { RandomWordsInput input = new RandomWordsInput(); RandomWordsState() { _init(); } // ‚Ä¶ }</code> </pre> <br><p>  To control the scrolling position, you need a ScrollController: </p><br><pre> <code class="plaintext hljs">final ScrollController scrollController = new ScrollController();</code> </pre> <br><p>  The _init () function will read the saved state and move the scroll to the position: </p><br><pre> <code class="plaintext hljs">_init() async { RandomWordsInput newInput = await model.read(widget.stateKey); setState(() { input = newInput; scrollController.jumpTo(input.scrollPosition); }); }</code> </pre> <br><p>  The function for building the widget changes as follows: </p><br><pre> <code class="plaintext hljs">Widget _buildSuggestions() { return new NotificationListener( onNotification: _onNotification, child: new ListView.builder( padding: const EdgeInsets.all(16.0), controller: scrollController, itemBuilder: (context, i) { // ‚Ä¶ } ),); }</code> </pre> <br><p>  The _onNotification function updates the scroll position: </p><br><pre> <code class="plaintext hljs">_onNotification(Notification n) { input.scrollPosition = scrollController.position.pixels; input.save(widget.modelKey); }</code> </pre> <br><p>  This widget is now created with the key: </p><br><pre> <code class="plaintext hljs">class _MyHomePageState extends State&lt;MyHomePage&gt; { @override Widget build(BuildContext context) { return new Scaffold( appBar: new AppBar( title: new Text(widget.title), ), body: new RandomWords("list"), ); } }</code> </pre> <br><p>  Now the position of the scroll is saved between restarts of activation, cheers. </p><br><h3 id="sohranyaem-navigaciyu">  Save the navigation </h3><br><p>  To begin with, let's rewrite the transition to another screen in our example, we will use named routes (described in the <a href="https://docs.flutter.io/flutter/widgets/Navigator-class.html">documentation</a> ). <br>  We list the routes (we have only one) when creating the application: </p><br><pre> <code class="plaintext hljs">class MyApp extends StatelessWidget { @override Widget build(BuildContext context) { return new MaterialApp( title: 'Flutter Demo', theme: new ThemeData( primarySwatch: Colors.blue, ), home: new MyHomePage(title: 'Startup Name Generator'), routes: &lt;String, WidgetBuilder&gt;{ '/saved': (BuildContext context) =&gt; new SavedPage(title: 'Saved Suggestions'), }, ); } }</code> </pre> <br><p>  Let's start a class that will save the history of transitions: </p><br><pre> <code class="plaintext hljs">class Routes { static Queue&lt;String&gt; routes = new Queue&lt;String&gt;(); static var _firstTime = true; }</code> </pre> <br><p>  As in Restorable, let's create methods for saving and restoring: </p><br><pre> <code class="plaintext hljs">static save() async { const platform = const MethodChannel('app.channel.shared.data'); platform.invokeMethod( "saveInput", {"key": "routes", "value": JSON.encode(routes.toList())}); } static restore(BuildContext context) async { if (!_firstTime) { return; } const platform = const MethodChannel('app.channel.shared.data'); String s = await platform.invokeMethod("readInput", {"key": "routes"}); if (s != null) { routes = new Queue&lt;String&gt;(); routes.addAll(JSON.decode(s)); } _firstTime = false; for (String route in routes) { Navigator.of(context).pushNamed(route); } }</code> </pre> <br><p>  That is, when restoring, we simply take all the saved routes and restore the chain of screens. </p><br><p>  It remains when you go to the screen with your favorites to save the route, and when you go back to remove it.  With the transition, everything is simple, edit the function that does it: </p><br><pre> <code class="plaintext hljs">void _pushSaved() async { Routes.routes.addLast('/saved'); await Routes.save(); Navigator.of(context).pushNamed('/saved'); }</code> </pre> <br><p>  Welcome back a little trickier.  To catch the moment when the user clicks "Back", you need to wrap the widget on the screen with the "favorites" in WillPopScope.  And also start a function (here _onWillPop), which will handle pressing the ‚ÄúBack‚Äù button: </p><br><pre> <code class="plaintext hljs">class _SavedPageState extends State&lt;SavedPage&gt; { @override Widget build(BuildContext context) { // ‚Ä¶ return new Scaffold( appBar: new AppBar( title: new Text('Saved Suggestions'), ), body: new WillPopScope( onWillPop: _onWillPop, child: new ListView(children: divided),), ); } Future&lt;bool&gt; _onWillPop() async { Routes.routes.removeLast(); await Routes.save(); return true; } }</code> </pre> <br><p>  And you need to restore the conversion history.  Do this on the main screen: </p><br><pre> <code class="plaintext hljs">class _MyHomePageState extends State&lt;MyHomePage&gt; { @override Widget build(BuildContext context) { Routes.restore(context); // ‚Ä¶ } // ‚Ä¶ }</code> </pre> <br><p>  It's all!  Now both navigation and scroll position are saved. </p><br><h2 id="ispolzovat-li-flutter">  Whether to use flutter </h2><br><p>  It seems to me that the lack of saving navigation out of the box is very strange.  With saving user input, you can still argue.  Suddenly, someone believes that he is quite satisfied with the preservation of the device during the coup and the loss of the activation during the destruction.  It does not suit me. </p><br><p>  Whether the flutter developers will decide anything on this is not yet clear, but on their githubs there are very active verbal battles. </p><br><p>  At the moment, it is quite possible to make the preservation of the state independently.  Although, of course, it looks like too much boilerplate. </p><br><p>  So far I have a desire to study the flutter further, and to see if my remaining doubts will dissolve.  And then decide about its applicability. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/352354/">https://habr.com/ru/post/352354/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352344/index.html">Scales in action. How trade scales turn into a marketing tool</a></li>
<li><a href="../352346/index.html">Streaming service Spotify will hold a direct placement of shares instead of IPO</a></li>
<li><a href="../352348/index.html">The first year of my life as an indie developer</a></li>
<li><a href="../352350/index.html">Introducing the cloud: how static traffic distribution methods work</a></li>
<li><a href="../352352/index.html">Not by Dagger</a></li>
<li><a href="../352358/index.html">SecaaS as a type of cloud services and other standards of the GOST project ‚ÄúInformation protection when using cloud technologies‚Äù</a></li>
<li><a href="../352362/index.html">Pumping C # Performance with Federico Luis</a></li>
<li><a href="../352364/index.html">DotNext 2018 Piter program overview</a></li>
<li><a href="../352366/index.html">Smart face control: machine learning algorithms for efficient data caching on SSD</a></li>
<li><a href="../352368/index.html">MEPhI invites to the information security competition</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>