<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple XML Framework - we write API for working with diagrams DIA</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dia Diagram Editor 

 Simple XML framework is well-known to many, with its simplicity, it is able to contend with the possibilities with a large ‚Äúinte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple XML Framework - we write API for working with diagrams DIA</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/1ba/7a8/f9d/1ba7a8f9da672bb76c90356a0cfe7cd6.png" alt="Simple Xml Framework" height="70"><img src="https://habrastorage.org/getpro/habr/post_images/ca6/14d/7de/ca614d7de210e61c484529bf9a532a05.png" alt="Dia Diagram Editor">  <b>Dia Diagram Editor</b> <br><br>  <a href="http://simple.sourceforge.net/">Simple XML</a> framework is well-known to many, with its simplicity, it is able to contend with the possibilities with a large ‚Äúinterfacing‚Äù JAXB, and at the same time it is compatible with Android. <br><br>  Articles on its use is not "in bulk", but enough.  Frejmfork <a href="https://habrahabr.ru/post/116830/">was mentioned on Habr√©</a> , there is <a href="http://www.ibm.com/developerworks/library/x-simplexobjs/">an article on developerworks ibm</a> , after all, there are good <a href="http://simple.sourceforge.net/download/stream/doc/examples/examples.php">examples</a> and a <a href="http://simple.sourceforge.net/download/stream/doc/tutorial/tutorial.php">guide</a> on the official website. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In general, how to use the framework is clear.  But it happens that there are structures for which there are already not enough methods described in manuals and tutorials.  It was this XML structure that I discovered when I began to understand how DIA stores its diagrams. <br><br>  This article will explain how to teach Simple Framework to work in this situation.  We will create our own "strategy" for the Simple Framework;  we will follow the TreeStrategy class and describe the ‚Äútricky logic‚Äù of how to map the elements of the DIA xml file to the Java classes. <br><br>  And yes, I assume that the reader is familiar with the basics of using the Simple XML Framework. <br><a name="habracut"></a><br><h2>  A few words about the DIA and the beginning of the story </h2><br>  I think the DIA diagram editor is known to almost everyone.  In a way, it is a ‚Äúclassic of the genre‚Äù. <br><br>  It was created a long time ago, but there is no more or less clear and complete description of the file format.  It is known that the .dia file is a zip-archive of the xml-file with the .dia extension (by the way, the diagram editor can work with uncompressed files, you can activate saving without compression in the settings). <br><br>  And then ... further, they say, "figure it out yourself, it's not difficult there." <br><br>  A couple of years ago, in the mailing list, references to some more or less related descriptions were mentioned, but now they are dead. <br><br>  About the presence of any software interface for generating or editing diagrams, speech either.  There is a list of diagram editors that can export to the Dia format, but I haven‚Äôt found anything suitable for myself. <br><br>  ‚ÄúPrograms are good,‚Äù I thought, ‚Äúbut I need an API.  Ready to use.  Preferably in Java. <br><br>  In the end, I decided to make my <i>bike</i> .  Comfortable to me, a form under my seat, <br>  with the wheel under the shape of my hands, with wheels in the shape of the pothole trails, which I walk. <br><br><h2>  Dia chart storage format and its features </h2><br>  We are not going to completely disassemble the entire structure, but go straight to the "problematic features." <br><br>  In .dia, the storage structure of any element of the diagram is unified: it is an object tag that ‚Äúframes‚Äù the list of attribute tags, which describe all the characteristics of an object. <br><br><div class="spoiler">  <b class="spoiler_title">For example, this is how the line element from the DIA basic palette is described.</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:object</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Standard - Line"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"O10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"obj_pos"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:point</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2.99224,32.237"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:attribute</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"obj_bb"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:rectangle</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2.92606,32.1708;7.37558,34.382"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:attribute</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"conn_endpoints"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:point</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2.99224,32.237"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:point</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"7.3094,34.1931"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:attribute</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"numcp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:int</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:attribute</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"end_arrow"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:enum</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:attribute</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"end_arrow_length"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:real</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.5"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:attribute</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"end_arrow_width"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:real</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.5"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:attribute</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:object</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br>  The main problem here is that all types of elements are described by one tag. <br>  As a result, it is not clear how to tell Simple Framework that <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:object</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Standard - Line"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"O10"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  - Must be parsed into an object of the class Line, and <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dia:object</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Standard - Box"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"O0"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  - to the Box class object.  In the standard Simple Framework toolkit I did not find how to solve this problem.  That is why the ‚Äústrategy‚Äù of DiaTreeStrategy was described, the creation history of which is given below. <br><br><div class="spoiler">  <b class="spoiler_title">By the way, since we are talking about the minimalism of the Simple Framework applicable to the parsing of the .dia format, it is worth mentioning the @Xpath annotation and its limitations.</b> <div class="spoiler_text">  The problem lies in the fact that the composition of the attributes of the diagram object that Dia stores in xml is not constant and depends on what properties you have changed for this object. <br><br>  Because of this, when parsing xml structures in .dia, you cannot use the @Xpath annotation with an indication of the index to match the property of the class and the object attribute described in xml.  If the name and attribute values ‚Äã‚Äãcould be specified in @Xpath, as we can do in an xpath query, this would make the task easier, but alas, only the path and the index can be specified in @Xpath.  These circumstances led to the appearance in my code of not the most convenient mechanism for filling in class properties from an attribute array, but about this another time. </div></div><br><h2>  ‚ÄúStrategy‚Äù in the Simple Framework, we start to write DiaTreeStrategy </h2><br>  A class implementing ‚Äústrategy‚Äù (implementing the Strategy interface) in Simple Framework is concerned with defining the mapping between XML nodes and classes in Java. <br><br>  This interface has only 2 methods - read () and write ().  The first one deals with the fact that using the passed xml-node it tries to understand which class we will fill now, and the second creates an xml-node into which we will fill the properties of the object. <br><br>  Writing a strategy from scratch - ‚Äúit‚Äôs not a lordly affair,‚Äù especially since the usual TreeStrategy in all other respects (except for not knowing how to correctly compare classes and nodes of the object type) works quite well.  Because we just fix it.  Inherit and correct. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiaTreeStrategy</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TreeStrategy</span></span></span></span></code> </pre> <br>  The reader probably already guessed that ‚Äúeverything‚Äù, what we need is to teach the ‚Äústrategy‚Äù to read the type property of the object tag, and from somewhere to understand that ‚ÄúUML - Class‚Äù corresponds to the class diaXML.shapes.uml.UmlClass, and ‚Äú Standard Box - class diaXML.shapes.standart.StdBox. <br><br>  I decided to store information about the mapping (type + version =&gt; class name) in a regular ArrayList: <br><br><pre> <code class="java hljs">ArrayList&lt;DiaObjToClassMapRecord&gt; diaObj2ClassMap;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Initialize the mapping right below the ad.</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ArrayList&lt;DiaObjToClassMapRecord&gt; diaObj2ClassMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;DiaObjToClassMapRecord&gt;(); { <span class="hljs-comment"><span class="hljs-comment">//default base mapping - object type name and version mapped to java class name. //use "*" for 'any class' or 'any version' diaObj2ClassMap.add(new DiaObjToClassMapRecord("UML - Class", "0", "diaXML.shapes.uml.UmlClass" )); diaObj2ClassMap.add(new DiaObjToClassMapRecord("UML - Association", "2", "diaXML.shapes.uml.UmlAssociation" )); diaObj2ClassMap.add(new DiaObjToClassMapRecord("Standard - Box", "0", "diaXML.shapes.standart.StdBox" )); diaObj2ClassMap.add(new DiaObjToClassMapRecord("Standard - Text", "1", "diaXML.shapes.standart.StdText" )); diaObj2ClassMap.add(new DiaObjToClassMapRecord("Standard - ZigZagLine", "1", "diaXML.shapes.standart.StdZigZagLine" )); diaObj2ClassMap.add(new DiaObjToClassMapRecord("Standard - BezierLine", "*", "diaXML.shapes.standart.StdBezierLine" )); //universal diaObj2ClassMap.add(new DiaObjToClassMapRecord("*", "*", "diaXML.shapes.UncknownShapeObject" )); }</span></span></code> </pre> </div></div><br>  As you can see, everything is quite transparent.  Mapping can be extended with your own classes (if someone writes their own class for another chart element) as soon as an instance of DiaTreeStrategy is created.  So far, five classes (POJOs) have been described that can initialize their properties from the attributes of a diagram object, and one universal class, UncknownShapeObject, includes all unknown objects to it;  it does not initialize anything, and keeps an array of attributes unchanged. <br><br><div class="spoiler">  <b class="spoiler_title">The search mechanism in this array of mappings I rendered into a separate function</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Class </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readValueAdv</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Type type, NodeMap node)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// we need here catch only &lt;object&gt; tag if( !"object".equals(node.getName()) ) return null; Node entry_type = node.get("type"); Node entry_version = node.get("version"); if( entry_type == null || entry_version==null) { return null; }; String name_type = entry_type.getValue(); String name_version = entry_version.getValue(); String className=null; Class expect=null; for (DiaObjToClassMapRecord crec: diaObj2ClassMap) { if ( ( crec.diaType!=null &amp;&amp; (crec.diaType.equals(name_type) || !crec.diaType.isEmpty() &amp;&amp; crec.diaType.equals("*") ) ) &amp;&amp; ( crec.diaVersion!=null &amp;&amp; ( crec.diaVersion.equals(name_version) || !crec.diaVersion.isEmpty() &amp;&amp; crec.diaVersion.equals("*") ) ) ) { className = crec.javaClassName; break; } } if (className !=null) { expect = loader.load(className); Node entry = node.remove(label); } return expect; }</span></span></code> </pre></div></div><br>  Now all that's left is to fix the read method. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiaTreeStrategy</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TreeStrategy</span></span></span><span class="hljs-class"> ... @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Override</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">public</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Value</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">read</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeMap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">node</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Map</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">map</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">throws</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Exception</span></span></span><span class="hljs-class"> </span></span>{ Class actualDeclaredByDia = readValueAdv(type, node); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (actualDeclaredByDia==<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.read(type, node, map); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObjectValue(actualDeclaredByDia); }</code> </pre> <br>  This is almost everything.  Rather, it was a "cornerstone stumbling block" that did not allow parsing the files generated by DIA using the Simple Framework. <br><br>  Naturally, in addition to what is described in the article, a lot of other work was done related to class annotation, research on how Simple XML annotations work as events in the process of serializing and parsing XML, creating service classes and so on.  and so on. But this is another conversation. <br><br><h2>  What is it all for and how to use it? </h2><br>  In the end I would like to give a couple of examples of how to use the "DiaXML API".  Without DiaTreeStrategy, it would not work.  And do not forget to connect to the project diaXmlApi.jar (take <a href="">here</a> ) before building. <br><br><div class="spoiler">  <b class="spoiler_title">How to read .dia</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.File; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.simpleframework.xml.strategy.DiaTreeStrategy; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> diaXML.Diagram; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> diaXML.shapes.standart.StdText; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Strategy strategy = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DiaTreeStrategy(); Serializer serializer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Persister(strategy); File source = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"path/to/dia/file/to/read.dia"</span></span>); Diagram probeDia=<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { probeDia = serializer.read(Diagram.class, source); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { e.printStackTrace(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ;} System.out.println(<span class="hljs-string"><span class="hljs-string">" File readed. Here is list of objects at layer 0 :"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (IDiaObject cObj: probeDia.layers.get(<span class="hljs-number"><span class="hljs-number">0</span></span>).objects ) { System.out.println(<span class="hljs-string"><span class="hljs-string">" dia type ["</span></span>+cObj.getObjectType()+<span class="hljs-string"><span class="hljs-string">"]ver.["</span></span>+cObj.getObjectTypeVersion()+<span class="hljs-string"><span class="hljs-string">"] objId:["</span></span>+cObj.getId()+<span class="hljs-string"><span class="hljs-string">"] name:["</span></span>+cObj.getName()+<span class="hljs-string"><span class="hljs-string">"]"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( StdText.TYPENAME.equals(cObj.getObjectType()) ) { System.out.println(<span class="hljs-string"><span class="hljs-string">" text value is:["</span></span>+((StdText)cObj).textValue+<span class="hljs-string"><span class="hljs-string">"]"</span></span>); }; } }</code> </pre> </div></div><div class="spoiler">  <b class="spoiler_title">How to create .dia</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.File; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.simpleframework.xml.strategy.DiaTreeStrategy; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> diaXML.Diagram; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> diaXML.shapes.standart.StdText; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Strategy strategy = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DiaTreeStrategy(); Serializer serializer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Persister(strategy); StdText cText= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StdText(); cText.textValue=<span class="hljs-string"><span class="hljs-string">"this is a demo \n of creating DIA-file"</span></span>; cText.obj_pos.moveTo(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); Diagram probeDia=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Diagram().initWithDefaults(); probeDia.layers.get(<span class="hljs-number"><span class="hljs-number">0</span></span>).objects.add(cText); File resultFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"path/to/dia/file/to/write.dia"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { serializer.write(probeDia, resultFile); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { e.printStackTrace(); } }</code> </pre> </div></div><br>  A couple more examples can be found in the source code of the project ( <a href="https://v2.pikacode.com/tachikoma/diaxml_api/src/4608c1ef4696ed8d9990b54a8e3f419c184b2d31/DiaXML_API/src/jse_diaxmlapi_examples">here</a> ). <br><br><h2>  Conclusion </h2><br>  In this article, I wanted to talk about what ‚Äústrategy‚Äù is in the Simple XML Framework and how to use it in a situation when staff means are not enough and about some of the limitations of the Simple Framework (for example, the fact that in the @ Xpath annotation use expressions for the names and values ‚Äã‚Äãof attributes, as we can do in @ Xpath queries). <br><br>  Solving these issues has allowed us to successfully implement the key classes of the DiaXML API project with the least possible efforts.  The full text of the source code can be found in the project repository. <br><br><h2>  Links </h2><br><ul><li>  <a href="https://v2.pikacode.com/tachikoma/diaxml_api">DiaXML API project</a> </li><li>  <a href="http://simple.sourceforge.net/">Simple XML Framework project</a> </li><li>  <a href="http://dia-installer.de/">Dia Diagram Editor</a> </li></ul><br>  <b>PS:</b> Using the developed API, a utility was developed that draws a database schema (or updates a previously created one) to DIA.  As a data source, a database schema in Turbine XML format is used, which <a href="http://db.apache.org/ddlutils/">Apache DDL Utils</a> can create. </div><p>Source: <a href="https://habr.com/ru/post/318898/">https://habr.com/ru/post/318898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318886/index.html">Comparison of signal recognition methods. Neural networks against matched filter</a></li>
<li><a href="../318890/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ243 (December 26 - January 1, 2017)</a></li>
<li><a href="../318892/index.html">Pebble for lazy programmers</a></li>
<li><a href="../318894/index.html">How fake programmers design</a></li>
<li><a href="../318896/index.html">Truly live code reload in golang</a></li>
<li><a href="../318900/index.html">Sovereign Internet. Why it will not be in 2017</a></li>
<li><a href="../318904/index.html">How I uploaded base in GIT</a></li>
<li><a href="../318906/index.html">How IT professionals work. Anton Karpov, Head of Security at Yandex</a></li>
<li><a href="../318908/index.html">Stretching the OP on the PLO</a></li>
<li><a href="../318910/index.html">Information technology in the New Year musical "The Magicians"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>