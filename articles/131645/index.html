<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MemCache for iOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The prehistory of the MemCache class is trivial. There is a project in development that most of the time is busy loading small amounts of data from th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MemCache for iOS</h1><div class="post__text post__text-html js-mediator-article">  The prehistory of the MemCache class is trivial.  There is a project in development that most of the time is busy loading small amounts of data from the network.  Basically JSON data and small images.  In each controller, an NSMutableDictionary was declared in which the results of the queries were saved.  But with the increase in the number of controllers, two problems arose - duplication of code and loss of caching results when popViewController was called. <br><br>  Under the cut the solution to these problems. <br><a name="habracut"></a><br>  It was decided to refactor the project as a result of which the MemCache singleton class was born and two categories, one each for NSString and NSObject. <br><br>  The MemCache class was supposed to perform caching for a short time (in this project it was enough two minutes), to self-clear the memory when MemoryWarning occurs, as well as when the application goes into the background. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Link to the source at the end of the article, but for now I will tell you about the main stages of implementation. <br><br>  In the init method we subscribe to notifications about memory warnings and activity loss. <br><pre><code class="cpp hljs">- (id) init { self = [super init]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self != nil) { NSNotificationCenter *center = [NSNotificationCenter defaultCenter]; [center addObserver:self selector:@selector(clearCache) name:UIApplicationDidReceiveMemoryWarningNotification object:nil]; [center addObserver:self selector:@selector(clearCache) name:UIApplicationWillResignActiveNotification object:nil]; _lifeTime = <span class="hljs-number"><span class="hljs-number">60.0f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self; }</code> </pre> <br>  Do not forget to unsubscribe from notifications in dealloc. <br><pre> <code class="cpp hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)dealloc { NSNotificationCenter *center = [NSNotificationCenter defaultCenter]; [center removeObserver:self name:UIApplicationDidReceiveMemoryWarningNotification object:nil]; [center removeObserver:self name:UIApplicationWillResignActiveNotification object:nil]; }</code> </pre><br>  Since the cache can be cleared at any time by request or upon the occurrence of the events described above, when writing a new item, you need to check whether there is actually where to write.  For each item, when adding, we launch a deferred call to remove it from the cache. <br><pre> <code class="cpp hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)setValue:(id)value forKey:(NSString *)key { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_cache) { _cache = [[NSMutableDictionary alloc] init]; } [_cache setValue:value forKey:key]; [NSObject cancelPreviousPerformRequestsWithTarget:_cache selector:@selector(removeObjectForKey:) object:key]; [_cache performSelector:@selector(removeObjectForKey:) withObject:key afterDelay:_lifeTime]; }</code> </pre><br>  For ease of use used categories.  Now, to put an object in the cache, just write something like: <br><pre> <code class="cpp hljs">[jsonValue setMemCacheValueForKey:[[[connection originalRequest] URL] absoluteString]];</code> </pre><br>  And you can get the object like this: <br><pre> <code class="cpp hljs">id val = [[url absoluteString] memCacheValue];</code> </pre><br>  Repository link - <a href="https://github.com/eltiren/MemCahce-IOS">github.com/eltiren/MemCahce-IOS</a> <br><br>  PS Compiled with ARC enabled. </div><p>Source: <a href="https://habr.com/ru/post/131645/">https://habr.com/ru/post/131645/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131640/index.html">Storming the AppStore: The Unfinished Story of the ‚ÄúSpread‚Äù Puzzle</a></li>
<li><a href="../131641/index.html">Does your company have a black salary?</a></li>
<li><a href="../131642/index.html">Zen-mode work with the tree comments</a></li>
<li><a href="../131643/index.html">Android 4.0 Ice Cream Sandwich video review on Google Nexus S</a></li>
<li><a href="../131644/index.html">Where did the PDA go?</a></li>
<li><a href="../131646/index.html">LiveKniga.Ru, or a story about a blog with stories about stories</a></li>
<li><a href="../131647/index.html">We make a macro flash from the built-in flash</a></li>
<li><a href="../131648/index.html">PHP library for working with the Yandex.Money API</a></li>
<li><a href="../131649/index.html">We write our auto-update service</a></li>
<li><a href="../131650/index.html">We write a math reference book for Android, we connect the Begun ad</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>