<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Jenkins for Android build using Docker</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 I work as an android developer, and not so long ago we faced some routine tasks on our project that we would like to automate. For example, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Jenkins for Android build using Docker</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  I work as an android developer, and not so long ago we faced some routine tasks on our project that we would like to automate.  For example, we have 5 different flavor, for each of which you need to upload your build to the fabric, sometimes for different tasks several times a day.  Yes, this task can be done with the help of gradle task, but I would like not to start this process on the developer's machine, but to do it in a centralized way.  Or, for example, automatically upload a google play build to beta.  Well, I just wanted to pick the CI system.  What came out of it, and how we set it up, why there is a Docker, further in the article. <br><br><img src="https://habrastorage.org/webt/at/pi/_v/atpi_veqcyb-lryxth_ia4m0uag.png"><br><a name="habracut"></a><br>  In my understanding, the whole task was divided into about two stages: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Install and configure Jenkins yourself with the Android SDK </li><li>  Customize tasks inside Jenkins </li></ol><br>  In this article I want to touch on the first point, and if this is interesting to anyone, then in the next article I will describe the process of setting tasks for the assembly in Jenkins itself. <br><br><h2>  So, the point is the first installation and configuration of Jenkins system </h2><br>  <i>On Habr√© there is already a wonderful <a href="https://habr.com/ru/post/315804/">article</a> on this topic, but she‚Äôs already a couple of years old, and some things in her are slightly outdated (for example, sdkmanager), although she helped me a lot in the initial stages of what and how to do.</i> <br><br>  If you look at the official Jenkins installation <a href="https://jenkins.io/doc/book/installing/">documentation</a> , you will see three different ways to do it: run a ready docker image, download and run the war file, and also install the jenkins into the system (for example, <code>apt-get install jenkins</code> using ubuntu as an example).  The first option is the most correct, because it does not carry any unnecessary settings and dependencies to our host system, and at any moment, even if something goes wrong, it is easy and simple to delete everything and start anew.  But the standard docker image for jenkins contains some data that we do not need (for example, blueocean plugin) and do not contain the fact that we definitely need (for example, android sdk).  It was decided to create our own docker image that will inside itself download and launch the war file, download and install android sdk, and also configure all the other settings that we need.  In order to start it later, we will need a host system with docker installed.  I suggest not to reinvent the wheel here and take advantage of DigitalOcean. <br><br><h4>  Create and configure a virtual machine </h4><br>  To begin with, if there is someone else not registered, I suggest <a href="https://cloud.digitalocean.com/registrations/new">registering</a> (here at the time of writing this article there was a referral link, but after reading the rules I threw it out).  After registration, you can google a promo code on the Internet, and get about 10 bucks to start. <br><br>  After we need to start a new droplet.  Select Droplets, and then <b>Create Droplet</b> . <br><br><img src="https://habrastorage.org/webt/gx/5m/th/gx5mthmcjzw-okm6ktxpfekimn8.png" alt="image"><br><br>  Host system leave Ubuntu 18.04.  It would be possible to choose an image with an already installed and configured Docker, but we will do everything ourselves.  Since the build of android builds is still a resource-intensive business, we need to select a configuration for at least 20 bucks so that the builds are assembled normally and relatively quickly. <br><br><img src="https://habrastorage.org/webt/1e/y_/z1/1ey_z1uyjffbqocqz6i4ef8ium8.png" alt="image"><br><br>  Choose a location closer to yourself (for example in Germany).  Further two options as we will be connected to our virtual server.  We can add ssh key or do without it.  If in this place we do not indicate which key to use, then we will receive a password for the user root as an email. <br><br><img src="https://habrastorage.org/webt/eg/qd/hu/egqdhuamgiddwijvsfidcxu7ieq.png" alt="image"><br><br>  Here we can change the server name, and complete the creation by clicking the <b>Create</b> button. <br><br><img src="https://habrastorage.org/webt/ad/mw/6w/admw6wwv2zyontaxpzx-fgp-rfg.png" alt="image"><br><br>  Now we go into the created droplet, and copy the ip address for yourself, for further connection and setup. <br><br><img src="https://habrastorage.org/webt/q7/th/yv/q7thyvgm-hppvgrured6dogeqva.png" alt="image"><br><br>  We need an ssh client.  If you are working from under the Mac, then you can use the standard terminal, if from under Windows then we can use putty to <a href="https://www.putty.org/">work</a> or use <a href="https://ru.wikipedia.org/wiki/Windows_Subsystem_for_Linux">the Linux subsystem</a> (only for Windows 10).  I personally use the latter option, and it completely suits me. <br><br>  Connect to our server with the following command <br><br><pre> <code class="bash hljs">ssh root@YOUR_IP_ADDRESS</code> </pre> <br>  The console will offer you to save the key, agree with this.  After connecting, create a new user for yourself, add it to the superuser (and give him the opportunity to use sudo without a password), copy him the key for ssh access and say that he is the owner of these files (otherwise it will not work).  The <b>username is</b> changed to any convenient for you. <br><br><pre> <code class="bash hljs">useradd -m -s /bin/bash username \ &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'username ALL=(ALL) NOPASSWD:ALL'</span></span> &gt;&gt; /etc/sudoers \ &amp;&amp; mkdir /home/username/.ssh \ &amp;&amp; cp /root/.ssh/authorized_keys /home/username/.ssh/authorized_keys \ &amp;&amp; chown username:username -R /home/username/.ssh</code> </pre><br>  Disconnect from the root user with the command <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br>  And we will connect again with the help of the created new user. <br><br><pre> <code class="bash hljs">ssh username@YOUR_IP_ADDRESS</code> </pre> <br>  After updating the system, and rebooting our server (if during the upgrade the system will ask you something, it is enough in this case to always choose default values). <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt full-upgrade -y &amp;&amp; sudo apt autoremove -y &amp;&amp; sudo reboot</code> </pre> <br>  The basic setup is complete.  From the point of view of the combat system, it is not very secure, but as part of this, the article is completely appropriate. <br><br><h4>  Install Docker. </h4><br>  To install Docker in our system we will use the <a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">official documentation</a> .  Since we have a newly installed system, we will skip this item, and if you have a system on which something has been running for a long time, on the recommendation of the Docker guys, delete possible old versions <br><br><pre> <code class="bash hljs">sudo apt-get remove docker docker-engine docker.io containerd runc</code> </pre> <br>  Do not forget to first connect back via ssh to our server.  The Docker installation itself is described in great detail in the documentation, I will give general commands to make it easier for you.  What they do can be read there.  First add the repository. <br><br><pre> <code class="bash hljs">sudo apt update \ &amp;&amp; sudo apt install -y apt-transport-https ca-certificates \ curl gnupg-agent software-properties-common \ &amp;&amp; curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - \ &amp;&amp; sudo apt-key fingerprint 0EBFCD88 \ &amp;&amp; sudo add-apt-repository <span class="hljs-string"><span class="hljs-string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(lsb_release -cs)</span></span></span><span class="hljs-string"> stable"</span></span></code> </pre> <br>  And then install Docker itself: <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt install -y docker-ce docker-ce-cli containerd.io</code> </pre> <br>  So that in the future we could call the docker commands without sudo prefix we will execute the following command (which is also carefully described in the <a href="https://docs.docker.com/install/linux/linux-postinstall/">instructions</a> ). <br><br><pre> <code class="bash hljs">sudo usermod -aG docker username</code> </pre> <br>  After you need to restart (using the exit command and reconnecting to the server) in order for this to work. <br><br>  Docker itself is installed, which we can check with the command <br><br><pre> <code class="bash hljs">docker run hello-world</code> </pre> <br>  It loads a test image, runs it in a container.  Container after launch prints an informational message and exits. <br><br>  Congratulations, we finished the server preparation phase for work! <br><br><h4>  Creating your own docker image </h4><br>  We will create a Docker image by writing your own Dockerfile.  There are examples of how to do this correctly on the Internet a car and a small truck, I will show <a href="https://github.com/osipovaleks/docker-jenkins-android/blob/master/Dockerfile">my</a> ready-made version, and I will try to comment on it as much as possible.  There is also a docker article with <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">instructions</a> on how to dockerfile correctly and canonically. <br><br>  Create and open your Dockerfile for editing. <br><br><pre> <code class="bash hljs">touch Dockerfile &amp;&amp; nano Dockerfile</code> </pre> <br>  In it for an example, we will place contents of my Dockerfile <br><br><div class="spoiler">  <b class="spoiler_title">My complete Dockerfile with comments</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    . FROM ubuntu:18.04 #      LABEL author="osipovaleks" LABEL maintainer="osipov.aleks.kr@gmail.com" LABEL version="1.0" LABEL description="Docker image for Jenkins with Android SDK" #  ,  Jenkins    ENV TZ=Europe/Kiev RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone # i386    ia32-libs RUN dpkg --add-architecture i386 #      RUN apt-get update &amp;&amp; apt-get install -y git \ wget \ unzip \ sudo \ tzdata \ locales\ openjdk-8-jdk \ libncurses5:i386 \ libstdc++6:i386 \ zlib1g:i386 #  ,       RUN apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists /var/cache/apt #  RUN locale-gen en_US.UTF-8 ENV LANG en_US.UTF-8 ENV LANGUAGE en_US:en ENV LC_ALL en_US.UTF-8 #   Android Sdk     ARG android_home_dir=/var/lib/android-sdk/ ARG sdk_tools_zip_file=sdk-tools-linux-4333796.zip RUN mkdir $android_home_dir RUN wget https://dl.google.com/android/repository/$sdk_tools_zip_file -P $android_home_dir -nv RUN unzip $android_home_dir$sdk_tools_zip_file -d $android_home_dir RUN rm $android_home_dir$sdk_tools_zip_file &amp;&amp; chmod 777 -R $android_home_dir # environment    ENV ANDROID_HOME=$android_home_dir ENV PATH="${PATH}:$android_home_dir/tools/bin:$android_home_dir/platform-tools" ENV JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64/ #   Android SDK RUN yes | sdkmanager --licenses #    Jenkins ENV JENKINS_HOME=/var/lib/jenkins RUN mkdir $JENKINS_HOME &amp;&amp; chmod 777 $JENKINS_HOME #     jenkins,   ,         RUN useradd -m jenkins &amp;&amp; echo 'jenkins ALL=(ALL) NOPASSWD:ALL' &gt;&gt; /etc/sudoers USER jenkins WORKDIR /home/jenkins #   war     Jenkins RUN wget http://mirrors.jenkins.io/war-stable/latest/jenkins.war -nv CMD java -jar jenkins.war #      EXPOSE 8080/tcp</span></span></code> </pre><br></div></div><br>  A few clarifications: <br><br><ul><li>  In the beginning, there was a desire to use a more lightweight alpine instead of ubuntu, but there is no support for <a href="https://github.com/gliderlabs/docker-alpine/issues/169">ia32-libs</a> , which is required for building projects using the Android SDK. </li><li>  We install openjdk-8-jdk, and not the more lightweight openjdk-8-jdk-headless due to the fact that some Jenkins functions just need a complete system (for example, displaying the results of unit tests). </li><li>  It is necessary to set the locales, because on some projects, without them, the gradle assembly crashes without any clear errors and logs, and I spent a few days to get to the bottom of this reason (on the usual ubuntu which is not in docker, all the locales are filled by default) . </li><li>  We need to immediately accept all licenses from the Android SDK, so that during the build process Jenkins can independently install the components he needs (for example, the SDKs he needs for different versions of api).  If necessary, later on inside the docker of the container you can manage the SDK using sdkmanager, for example, <code>sdkmanager --list</code> allows <code>sdkmanager --list</code> to view all available and all installed components, and <code>sdkmanager --install "platforms;android-26"</code> installs the SDK for version 26 of api. </li><li>  In general, it was possible not to start the user jenkins, and remain with the user root, but this is somehow not entirely correct, it was also possible for him not to give the superuser rights, but this is done in terms of convenience, if suddenly you need to install something at the stage of adjustment and debag. </li><li>  The basic image size turned out rather big (almost 800 mb), but in general I came to the conclusion that for me it is not very critical, and it is easier for me to download it in this form than to spend time searching for and removing packages that I don‚Äôt need. </li></ul><br>  After the end of the writing of the Dockerfile, we need to turn it into a ready-made image for Docker, on the basis of which the containers will be created.  This is done simply by the team. <br><br><pre> <code class="bash hljs">docker build -t jenkins-image</code> </pre> <br>  where the <code>-t jenkins-image</code> parameter is responsible for the name of your image, and the dot at the end of the command, says that the Dockerfile for the assembly should be searched inside this directory.  The build process itself takes some time, and after the build in the console there should be a similar message. <br><blockquote>  Successfully built 9fd8f5545c27 <br>  Successfully tagged jenkins-image: latest </blockquote>  Which tells us that our image has been successfully assembled, and we can proceed to the next step, namely the launch of our container <br><br><h4>  Docker Hub and Ready Images </h4><br>  Yes, of course, we can use our ready-made image to launch the container, but if we need to do this on more than several devices, each time creating the Dockerfile and collecting the finished image from it will not be very convenient.  And if we also update the contents of our Dockerfile, then it will be inconvenient to roll out changes across all the nodes.  For these purposes, there is a public repository of <a href="https://hub.docker.com/">Docker Hub</a> images.  It allows you not to collect an image each time, on each node, but simply download it from the public repository and use it equally on all machines.  For example, the image that served as an example for this article is available in the repository by the name of <a href="https://cloud.docker.com/u/osipovaleks/repository/docker/osipovaleks/docker-jenkins-android">osipovaleks / docker-jenkins-android</a> , and further in the article we will work with it. <br><br>  This article does not imply a detailed study of Docker Hub, we will not understand how to fill in our images there (although this is not very difficult) and what can be done with them further there, we will not understand that there may still be their own private or private repositories, In this all can be figured out on their own if needed. <br><br><h4>  Container run </h4><br>  You can launch the container in two ways. <br><br><ol><li>  The first way is simple, using the <code>docker run</code> , allows you to do this easily and quickly in the following way. <br><br><pre> <code class="bash hljs">docker run --name jenkins -d -it -v jenkins-data:/var/lib/jenkins -v jenkins-home:/home/jenkins -p 8080:8080 --restart unless-stopped osipovaleks/docker-jenkins-android</code> </pre> <br>  where the <code>run</code> command has the following parameters <br><br><ul><li>  <code>--name jenkins</code> is the name of the future container </li><li>  <code>-d</code> - run container in background </li><li>  <code>-it</code> - flags for working with STDIN and tty </li><li>  <code>-v jenkins-data:/var/lib/jenkins</code> and <code>-v jenkins-home:/home/jenkins</code> ‚Äî create (if not created) and patch special volume files onto the internal sections of the container, which will allow us to save our customized Jenkins even after re-creating container </li><li>  <code>-p 8080:8080</code> - we will zapapim the port of the host on the port of the container, so that we have access to the web interface (yes, this is the port that we specified in the Dockerfile) </li><li>  <code>--restart unless-stopped</code> - the option sets the container auto <code>--restart unless-stopped</code> policy after the host is rebooted (in this case, auto-start if the container was not manually turned off) </li><li>  <code>osipovaleks/docker-jenkins-android</code> is an image to deploy. </li></ul><br>  At the exit to the Docker console, we should display the id of the created container, as well as show information about how the image is loaded into the system (of course, if it is not loaded yet), something like this <br><blockquote>  Unable to find image 'osipovaleks / docker-jenkins-android: latest' locally <br>  latest: Pulling from osipovaleks / docker-jenkins-android <br>  6cf436f81810: Pull complete <br>  987088a85b96: pull complete <br>  b4624b3efe06: Pull complete <br>  d42beb8ded59: Pull complete <br>  b3896048bb8c: Pull complete <br>  8eeace4c3d64: Pull complete <br>  d9b74624442c: Pull complete <br>  36bb3b7da419: Pull complete <br>  31361bd508cb: Pull complete <br>  cee49ae4c825: Pull complete <br>  868ddf54d4c1: Pull complete <br>  361bd7573dd0: Pull complete <br>  bb7b15e36ae8: Pull complete <br>  97f19daace79: Pull complete <br>  1f5eb3850f3e: Pull complete <br>  651e7bbedad2: Pull complete <br>  a52705a2ded7: Pull complete <br>  Digest: sha256: 321453e2f2142e433817cc9559443387e9f680bb091d6369bbcbc1e0201be1c5 <br>  Status: Downloaded newer image for osipovaleks / docker-jenkins-android: latest <br>  ef9e5512581da66d66103d9f6ea6ccd74e5bdb3776747441ce6a88a98a12b5a4 </blockquote></li><li>  The second launch method involves writing a special compose file, where the run command is simply described using the <a href="https://ru.wikipedia.org/wiki/YAML">YAML</a> language, and launched using the Docker Compose. <br><br>  For this we need to install it: <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt install -y docker-compose</code> </pre> <br>  Next, create a directory for the project (this is important if you don‚Äôt care what the automatically created volumes for the container will be called) and go into it <br><br><pre> <code class="bash hljs">mkdir jenkinsProject &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> jenkinsProject</code> </pre> <br>  and inside we create the compose file ourselves and go into edit mode <br><br><pre> <code class="bash hljs">touch docker-compose.yml &amp;&amp; nano docker-compose.yml</code> </pre> <br>  and put the following content into it <br><br><pre> <code class="markdown hljs">version: '3' services: jenkins: container_name: jenkins image: osipovaleks/docker-jenkins-android ports: - "8080:8080" restart: unless-stopped volumes: - "jenkins-data:/var/lib/jenkins" - "jenkins-home:/home/jenkins" volumes: jenkins-data: jenkins-home:</code> </pre> <br>  In it, perhaps, only the first line raises questions ( <code>version: '3'</code> ) which indicates the <a href="https://docs.docker.com/compose/compose-file/compose-versioning/">version of the</a> compose capabilities of the file, as well as a section with the <code>volumes</code> block which lists those used in this container <br><br>  Run your container with the command: <br><br><pre> <code class="bash hljs">docker-compose up -d</code> </pre> <br>  where the <code>-d</code> flag also indicates that the creation and launch of the container will be performed in the background.  As a result, Docker should show something like the following: <br><blockquote>  Creating volume "jenkinsproject_jenkins-data" with default driver <br>  Creating volume "jenkinsproject_jenkins-home" with default driver <br>  Pulling jenkins (osipovaleks / docker-jenkins-android: latest) ... <br>  latest: Pulling from osipovaleks / docker-jenkins-android <br>  6cf436f81810: Pull complete <br>  987088a85b96: pull complete <br>  b4624b3efe06: Pull complete <br>  d42beb8ded59: Pull complete <br>  b3896048bb8c: Pull complete <br>  8eeace4c3d64: Pull complete <br>  d9b74624442c: Pull complete <br>  36bb3b7da419: Pull complete <br>  31361bd508cb: Pull complete <br>  cee49ae4c825: Pull complete <br>  868ddf54d4c1: Pull complete <br>  361bd7573dd0: Pull complete <br>  bb7b15e36ae8: Pull complete <br>  97f19daace79: Pull complete <br>  1f5eb3850f3e: Pull complete <br>  651e7bbedad2: Pull complete <br>  a52705a2ded7: Pull complete <br>  Digest: sha256: 321453e2f2142e433817cc9559443387e9f680bb091d6369bbcbc1e0201be1c5 <br>  Status: Downloaded newer image for osipovaleks / docker-jenkins-android: latest <br>  Creating jenkins ... <br>  Creating jenkins ... done </blockquote>  Remember I said that the name of the created volumes will depend on the name of the project?  Run the command: <br><br><pre> <code class="bash hljs">docker volume ls</code> </pre> <br>  and we get this output <br><blockquote>  DRIVER VOLUME NAME <br>  local jenkinsproject_jenkins-data <br>  local jenkinsproject_jenkins-home </blockquote>  where we will see that despite the fact that the name for the volume was chosen <code>jenkins-home</code> , in reality the prefix was stuck to it from the name of the project and the name of the volume was <code><b>jenkinsproject</b> _jenkins-home</code> </li></ol><br><br>  Which startup option to use?  Here you can choose your own, it is believed that Docker Compose is more like a tool to launch several containers at once, which are tied to each other, and if you need to run only one container, you can use just the <code>docker run</code> . <br><br>  Now, after these sub-steps to start and configure the server, as well as launch the container with Jenkins, we can proceed to its initial setup <br><br><h4>  Initial Jenkins Setup </h4><br>  Take the ip address of our server, add to it the port 8080 specified by us and follow this link in the browser. <br><br> <code>http://YOUR_IP_ADDRESS:8080/</code> <br> <br>  If before that everything was configured and started correctly, then we will see the following picture <br><br><img src="https://habrastorage.org/webt/za/a5/bi/zaa5bi-5vkvscc-ww7gd2ouxjte.png"><br><br>  For the first setup, we need to enter the password that the system generated during installation.  To do this, we just need to look at the contents of the file <code>/var/lib/jenkins/secrets/initialAdminPassword</code> .  But this file is located inside our running container, and in order to read it, we need to attach to the container using the following command: <br><br><pre> <code class="bash hljs">docker <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> -it jenkins /bin/bash</code> </pre> <br>  where the <code>-it</code> parameter is the same as when starting <code>docker run</code> , <code>jenkins</code> is the name of our container, and <code>/bin/bash</code> will launch <code>/bin/bash</code> for us in the container and give access to it.  After that we can see the initial password for Jenkins: <br><br><pre> <code class="bash hljs">cat /var/lib/jenkins/secrets/initialAdminPassword</code> </pre> <br>  in the console show about the following <br><blockquote>  91092b18d6ca4492a2759b1903241d2a </blockquote>  This is the password. <br><br>  <i>The user <a href="https://habr.com/ru/users/alexhha/" class="user_link">ALexhha</a> suggested a simpler option to read this password, without connecting to the container itself.</i>  <i>The fact is that at the time of the launch of Jenkins itself, this password is shown in the logs.</i>  <i>It turns out that all we need is to read the container logs.</i>  <i>In our case, this is done with the following command:</i> <br><br><pre> <code class="bash hljs">docker logs jenkins</code> </pre> <br><br>  <i>where</i> <code>jenkins</code> <i>name of our container, and in the logs you can see the following:</i> <br><br><blockquote>  ************************************************** *********** <br>  ************************************************** *********** <br>  ************************************************** *********** <br><br>  Jenkins initial setup is required.  An admin user has been created and a password generated. <br>  Please use the following password to proceed to installation: <br><br>  91092b18d6ca4492a2759b1903241d2a <br><br>  This may also be found at: / var / lib / jenkins / secrets / initialAdminPassword <br><br>  ************************************************** *********** <br>  ************************************************** *********** </blockquote><br>  ************************************************** *********** <br><br>  <i>This option is a little easier and faster.</i> <br><br>  Copy it, paste it into the <b>Administrator password</b> field in the web interface and click <b>Continue</b> .  On the next screen, select <b>Install suggested plugins</b> and install a set of default plug-ins. <br><br><img src="https://habrastorage.org/webt/bs/9d/xs/bs9dxsxd6-cddmut2bww9utxjw4.png"><br><br><img src="https://habrastorage.org/webt/r5/-m/u-/r5-mu-bgyaqswxcqnyrpds0qhic.png"><br><br>  After installing the plugins, create a user and click on <b>Save and Finish</b> <br><br><img src="https://habrastorage.org/webt/iy/ap/jd/iyapjd__vdbys6jsjiinvzcp58q.png"><br><br>  We agree with the section Instance Configuration, where we are offered to fill in the URL on which Jenkins will work (in our case we leave everything as it is) <br><br><img src="https://habrastorage.org/webt/4v/w1/ie/4vw1ieq0o_tm5bkrgn4sb-m__kk.png"><br><br>  And on the next screen, click the cherished <b>Start using Jenkins</b> <br><br><img src="https://habrastorage.org/webt/4a/iw/yq/4aiwyqwkzbxjdkjwyzowxyvsktc.png"><br><br>  So, we installed and launched Jenkins! <br><br><img src="https://habrastorage.org/webt/9a/4z/tu/9a4ztunwk1gxuc8rsho2ql9-tou.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is already quite possible to work with him, but in order to build our Android builds you will need to configure a few more items. Localization of Jenkins is associated with the chosen language of your browser, and of course the Russian translation is not completely finished, and we get a hell of a mixture of Russian and English. If you did exactly the same, and it makes you angry, then you can use a special </font></font><a href="https://wiki.jenkins.io/display/JENKINS/Locale%2BPlugin"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plugin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and install the default interface language. Well, or switch your browser to the English interface. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's go to the Jenkins settings and select the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System Configuration</font></font></b> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> item. </font></font><br><br><img src="https://habrastorage.org/webt/pk/xo/1d/pkxo1diloanswc7tciicxhaiidq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Environment variables</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> box and enter the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ANDROID_HOME</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> name in the field </font><font style="vertical-align: inherit;">, and specify the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ var / lib / android-sdk /</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(We indicated this data as a home directory for Android SDK storage in the Dockerfile). </font></font><br><br><img src="https://habrastorage.org/webt/on/af/4j/onaf4jfhel5_ys078k5ohrxwxuu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Click on the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Save</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> button </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">exit the </font><font style="vertical-align: inherit;">settings section and go to the section called </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration of global tools</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/webt/b9/3i/zx/b93izxlndc-utyrnewgv5kluug0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's set up a section with </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JDK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (where the JAVA_HOME variable was also filled in by us in the Dockerfile, and we can use its value here </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ usr / lib / jvm / java-8-openjdk-amd64 /</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><img src="https://habrastorage.org/webt/0l/wn/2p/0lwn2prv62virmofscvskc5e6_8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also here we still need to fill out the section with </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gradle</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. We select and install the Gradle version which is used in the projects that you will build using this CI system. You can have multiple versions. It is also possible not to set the Gradle variable at all if, for example, you have a gradlew in the repository, and you can collect it using it. </font></font><br><br><img src="https://habrastorage.org/webt/0q/fe/wj/0qfewj73fbwr3vzudpk8woyrsmy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With this we can finish our first stage. The Jenkins system is fully operational and we can proceed to customize the build tasks themselves. Please note that the system has been customized for our needs and here it may not be what you need - for example, there is no android emulator for testing and NDK.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If this article will interest someone, then I will continue in the second part on the example of one or two tasks, I will describe the integration of Jenkins and Bitbucket (it is he, not Github, because there is easier with free private repositories, and articles on the Internet it is smaller, and probably more jokes), I will tell you how to make ssh the key of our container to make friends with the repository, about email notifications, as well as a few other features. </font><font style="vertical-align: inherit;">In general, about everything that we have configured. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Please do not kick much, this is my first article on Habr. </font><font style="vertical-align: inherit;">All good!</font></font></i> </div><p>Source: <a href="https://habr.com/ru/post/443606/">https://habr.com/ru/post/443606/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443594/index.html">Crossing Testing and Architecture: An Interview with Neil Ford</a></li>
<li><a href="../443596/index.html">The Federation Council passed laws on contempt of government and fake news</a></li>
<li><a href="../443598/index.html">There is a massive revocation of TLS certificates from a variety of CAs, mistakenly generated on a 63-bit RNG instead of 64-bit</a></li>
<li><a href="../443600/index.html">Best and worst trends MWC 2019</a></li>
<li><a href="../443602/index.html">What is Strict Aliasing and why should we care? Part 2</a></li>
<li><a href="../443610/index.html">A record was set for the Rubik's cube assembly ... with feet</a></li>
<li><a href="../443612/index.html">We use old HDD with badami</a></li>
<li><a href="../443616/index.html">35% stock returns on alternative data</a></li>
<li><a href="../443618/index.html">80's computer emulator in browser</a></li>
<li><a href="../443620/index.html">Our dependency problem</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>