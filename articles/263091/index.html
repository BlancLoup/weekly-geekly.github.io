<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pacemaker-based HA-Cluster for LXC and Docker container virtualization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I will describe the installation and configuration of an Active / Active cluster based on Pacemaker, Corosync 2.x and CLVM using shar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pacemaker-based HA-Cluster for LXC and Docker container virtualization</h1><div class="post__text post__text-html js-mediator-article">  In this article, I will describe the installation and configuration of an Active / Active cluster based on Pacemaker, Corosync 2.x and CLVM using shared storage.  I will show you how to adapt this cluster to work with LXC and Docker containers.  I will describe the team to work with the cluster.  And I remember those rakes into which I plunged, which, I hope, will facilitate the fate of the next rogues. <br><br>  As server distributions I will use CentOS 7 + epel and the current versions of the packages in them.  The basic tool for working with Pacemaker will be the PCS (pacemaker / corosync configuration system). <br><br><img src="https://habrastorage.org/files/c26/72b/d5b/c2672bd5b53045b09bbe6e5e7db04dbb.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><ol><li>  <a href="https://habr.com/ru/post/263091/">Server Preparation</a> </li><li>  <a href="http://habrahabr.ru/post/263091/">Installation and basic configuration of Pacemaker and CLVM</a> </li><li>  <a href="http://habrahabr.ru/post/263091/">Working with LXC in a cluster</a> </li><li>  <a href="http://habrahabr.ru/post/263091/">Transfer OpenVZ Container to LXC</a> </li><li>  <a href="http://habrahabr.ru/post/263091/">Work with Docker in a cluster</a> </li><li>  <a href="http://habrahabr.ru/post/263091/">Crib</a> </li><li>  <a href="http://habrahabr.ru/post/263091/">Links</a> </li></ol><br><br><h2>  Server Preparation </h2><br>  I used the configuration of two nodes, but their number can be increased as needed.  Servers have shared shared storage connected via SAS.  If this is not on hand, then you can use the store FC or iSCSI plugin.  You will need two volumes, one for general needs, the other for Docker.  It is possible to break one volume into two sections. <br>  Install CentOS 7, epel repository and set up a network.  Using bonding for network interfaces and multipath for SAS are desirable.  To work with different vlans, we configure the appropriate bridges br0.VID, to which we will later tie the LXC container.  I will not describe the details - everything is standard. <br><br>  For LXC and Docker <a href="https://access.redhat.com/articles/881893" title="https://access.redhat.com/articles/881893">to</a> work, <a href="https://access.redhat.com/articles/881893" title="https://access.redhat.com/articles/881893">you need to</a> disable the regular firewald. <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># systemctl stop firewalld.service # systemctl disable firewalld.service # setenforce Permissive</span></span></code> </pre>  We also translate selinux into <b>permissive</b> mode, for ease of setup and bold experiments.  Later, when we debug, switch back, maybe. <br><br>  Immediately enter the required addresses and names in <b>/ etc / hosts</b> on all nodes: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#nodes, vlan 10 10.1.0.1 cluster-1 10.1.0.2 cluster-2 #nodes ipmi, vlan 314 10.1.15.1 ipmi-1 10.1.15.2 ipmi-2 #docker, vlan 12 10.1.2.10 docker 10.1.2.11 dregistry</span></span></code> </pre><br><br>  The work will require the STONITH mechanism (‚ÄúShoot The Other Node In The Head‚Äù), for which ipmi is used.  Configure using <b>ipmitool</b> : <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ipmitool shell impitool&gt; user set name 2 admin impitool&gt; user set password 2 '  ' # &lt;uid&gt; &lt; privilege level&gt; &lt;channel number&gt;) impitool&gt; user priv 2 4 1</span></span></code> </pre>  We get admin user (id = 2) and give him administrator rights (livel = 4) on the channel associated with the network interface (channel = 1). <br><br>  It is desirable to bring the network for ipmi into a separate vlan, firstly it will allow it to isolate, secondly there will be no connectivity problems if the IPMI BMC (baseboard management controller) shares the network interface with the server. <br><pre> <code class="bash hljs">impitool&gt; lan <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> 1 ipsrc static impitool&gt; lan <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> 1 ipaddr 10.1.15.1 impitool&gt; lan <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> 1 netmask 255.255.255.0 impitool&gt; lan <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> 1 defgw ipaddr 10.1.15.254 impitool&gt; lan <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> 1 vlan id 314 <span class="hljs-comment"><span class="hljs-comment">#  : impitool&gt; lan set 1 access on impitool&gt; lan set 1 auth ADMIN MD5 ipmitool&gt; channel setaccess 1 2 callin=on ipmi=on link=on privilege=4</span></span></code> </pre>  On the other nodes is similar, only the IP is different. <br><br>  Check the connectivity as follows: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ipmitool -I lan -U admin -P '  ' -H 10.1.15.1 bmc info</span></span></code> </pre><br><h2>  Installation and basic configuration of Pacemaker and CLVM </h2><br>  If you do not know what Pacemaker is, then it is advisable to read about it first.  Well and in Russian about Pacemaker <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, theory">written here</a> . <br>  Install the packages from the epel repository on all nodes: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum install pacemaker pcs resource-agents fence-agents-all</span></span></code> </pre><br>  On all nodes we set a password for the hacluster cluster administrator.  <b>PCS</b> works under this user, as well as a web-based management interface. <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> CHANGEME | passwd --stdin hacluster</code> </pre><br><br>  Further operations are performed on a single node. <br>  Configure authentication: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs cluster auth cluster-1 cluster-2 -u hacluster -p CHANGEME --force</span></span></code> </pre><br>  Create and run a cluster ‚ÄúCluster‚Äù of two nodes: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs cluster setup --force --name Cluster cluster-1 cluster-2 # pcs cluster start --all</span></span></code> </pre><br>  See the result: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs cluster status Cluster Status: Last updated: Wed Jul 8 14:16:32 2015 Last change: Wed Jul 8 10:01:20 2015 Stack: corosync Current DC: cluster-1 (1) - partition with quorum Version: 1.1.12-a14efad 2 Nodes configured 17 Resources configured (  ) PCSD Status: cluster-1: Online cluster-2: Online</span></span></code> </pre><br>  There is one caveat, if https_proxy is set in the environment variables, <b>pcs</b> can lie about the status of the nodes, apparently trying to use a proxy. <br><br>  We start and prescribe the <b>pcsd</b> daemon into autoload: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># systemctl start pcsd # systemctl enable pcsd</span></span></code> </pre><br>  After that, the web-based cluster management interface is available at the address <code>"https://ip_:2224"</code> <br><img src="https://habrastorage.org/files/4ff/db1/3f1/4ffdb13f1d9e435b80b43ff20a268ff9.png"><br><br>  The interface allows you to view the status of the cluster, add or change its parameters.  Trifle, but nice. <br><br>  Since we have only two nodes, we will not have a quorum, so we need to disable this policy: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs property set no-quorum-policy=ignore</span></span></code> </pre><br>  To auto-start cluster nodes, just add <b>pacemaker</b> to autoload: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># systemctl enable pacemaker</span></span></code> </pre><br><br>  CLVM and GFS2 require DLM (Distributed Lock Manager).  Both CLVM and DLM in RHEL7 (CentOS 7) as independent daemons are missing and are cluster resources.  At the same time, DLM requires STONITH to work, otherwise the corresponding cluster resource will not start.  Customize: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs property set stonith-enabled=true # pcs stonith create cluster-1.stonith fence_ipmilan ipaddr="ipmi-1" passwd="  ipmi" login="admin" action="reboot" method="cycle" pcmk_host_list=cluster-1 pcmk_host_check=static-list stonith-timeout=10s op monitor interval=10s # pcs stonith create cluster-2.stonith fence_ipmilan ipaddr="ipmi-2" passwd="  ipmi" login="admin" action="reboot" method="cycle" pcmk_host_list=cluster-2 pcmk_host_check=static-list stonith-timeout=10s op monitor interval=10s # pcs constraint location cluster-1.stonith avoids cluster-1=INFINITY # pcs constraint location cluster-2.stonith avoids cluster-2=INFINITY</span></span></code> </pre><br>  Why so, <a href="http://habrahabr.ru/post/200348/" title="pacemaker: how to finish off lying">well described here</a> .  In short, we start two stonith resources, each responsible for its own node and prohibit them from working on the node that they must shoot. <br><br>  Configure additional global options. <br>  For experiments, it is useful to configure the resource migration after the first failure: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs resource defaults migration-threshold=1</span></span></code> </pre><br>  To ensure that a resource that has migrated to another node as a result of a failure does not come back, we will set up after restoring the node: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs resource defaults resource-stickiness=100</span></span></code> </pre>  Where ‚Äú100‚Äù is a certain weight, on the basis of which Pacemaker calculates the behavior of the resource. <br><br>  So that in the midst of bold experiments the nodes do not shoot each other, I recommend explicitly setting a policy for resource failure: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs resource op defaults on-fail=restart</span></span></code> </pre>  Otherwise, stonith will work on the most interesting place, which by default is on the failure of the ‚Äústop‚Äù command. <br><br>  Install CLVM on each node: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum install lvm2 lvm2-cluster</span></span></code> </pre><br>  We configure LVM to work in a cluster on each node: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># lvmconf --enable-cluster</span></span></code> </pre><br>  We get the resources <b>dlm</b> and <b>clvmd</b> in the cluster: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs resource create dlm ocf:pacemaker:controld op monitor interval=30s on-fail=fence clone interleave=true ordered=true # pcs resource create clvmd ocf:heartbeat:clvm op monitor interval=30s on-fail=fence clone interleave=true ordered=true</span></span></code> </pre>  These are critical resources for our cluster, therefore for the situation of failure we explicitly set the stonith policy ( <b>on-fail = fence</b> ).  The resource must be running on all nodes of the cluster, because it is declared cloned ( <b>clone</b> ).  We start resources in turn, but not in parallel ( <b>ordered = true</b> ).  If the resource depends on other clone-resources, then we do not wait for the launch of all resource samples on all nodes, but are content with the local one ( <b>interleave = true</b> ).  Pay attention to the last two parameters, they can significantly affect the work of the cluster as a whole, and we still have clone-resources. <br><br>  We set the order of resource startup, in which <b>clvmd is</b> launched only after <b>dlm</b> .  The commands already use the service name <b>* -clone</b> , which denotes a resource on a specific node: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs constraint order start dlm-clone then clvmd-clone # pcs constraint colocation add clvmd-clone with dlm-clone</span></span></code> </pre>  We also commit to run the <b>clvmd-clone</b> resource along with <b>dlm-clone</b> on the same node.  In our case of two nodes, this seems redundant, but in the general case <b>* -clone</b> resources may be less than the number of nodes and then co-location becomes critical. <br><br>  As soon as resources are created, they are launched on all nodes, and if all is well, then we can start creating shared logical volumes and file systems.  clvmd will monitor the integrity of the metadata and notify all nodes of changes, so we perform the operation on one node. <br>  Initialize sections for use in LVM: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pvcreate /dev/mapper/mpatha1 # pvcreate /dev/mapper/mpatha2</span></span></code> </pre><br>  In general, working with a clustered LVM is almost the same as working with a regular LVM, with the only difference that if the volume group (VG) is marked as cluster, then its metadata is controlled by clvmd.  Create volume groups: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vgcreate --clustered y shared_vg /dev/mapper/mpatha1 # vgcreate --clustered y shared_vg-ex /dev/mapper/mpatha2</span></span></code> </pre><br>  The overall configuration of the cluster is completed, we will continue to fill it with resources.  Resource from the point of view of Pacemaker, is any service, process, ip-address of which can be controlled by scripts.  The resource scripts themselves are similar to init scripts and also perform a set of functions start, stop, monitor, and so on.  The basic principle that we will follow is that the data needed by a resource running on one node is placed in the logical partition of the shared_vg group and any file system at will;  The data that is needed on both nodes at the same time is put on GFS2.  The integrity of the data in the first case will trace Pacemaker, which controls the number and location of running resources, including the used file systems.  In the second case, the internal mechanisms of GFS2.  The shared_vg-ex group will be completely dedicated to the logical partition for Docker.  The fact is that Docker creates a sparse volume (thin provisioned), which can only be active in exclusive mode on a single node.  And to place this volume in a separate group is convenient for further work and configuration. <br><br><h2>  Working with LXC in a cluster </h2><br>  We will work using the lxc- * utilities that are included in the <b>lxc</b> package.  We put: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum install lxc lxc-templates</span></span></code> </pre><br>  We set default parameters for future containers: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cat /etc/lxc/default.conf lxc.start.auto = 0 lxc.network.type = veth lxc.network.link = br0.10 lxc.network.flags = up # memory and swap lxc.cgroup.memory.limit_in_bytes = 256M lxc.cgroup.memory.memsw.limit_in_bytes = 256M</span></span></code> </pre>  The type of network will be <b>veth</b> - inside the container interface eth0, outside the container it will be attached to the bridge <b>br0.10</b> .  Of the limitations we have in the course of memory only, we specify them.  If you wish, you can write any, supported by the kernel, on the principle <b>lxc.cgroup.state-object-name = value</b> .  They can also be changed on the fly using <b>lxc-cgroup</b> .  On the file system, these parameters are represented by the path <code>/sys/fs/cgroup/TYPE/lxc/CT-NAME/object-name</code> .  An important point about the restrictions: the parameter <b>memory.limit_in_bytes</b> must be specified before <b>memory.memsw.limit_in_bytes</b> .  And also, the second parameter is the sum of memory and swap, and must be greater than or equal to the first.  Otherwise, the machine will start without memory limits. <br>  Placement, start and stop of containers will be controlled by Pacemaker, because we turn off autoloading of containers explicitly. <br><br>  Each LXC container will live in its shared_vg logical volume.  Set the default VG name: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cat /etc/lxc/lxc.conf lxc.bdev.lvm.vg = shared_vg</span></span></code> </pre><br>  This placement will allow the container to run on any node in the cluster.  Container configuration files should also be shared, so we will create a common file system and configure its use on all nodes: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># lvcreate -L 500M -n lxc_ct shared_vg # mkfs.gfs2 -p lock_dlm -j 2 -t Cluster:lxc_ct /dev/shared_vg/lxc_ct</span></span></code> </pre>  We select the <b>lock_dlm</b> lock <b>protocol</b> , since the storage is shared.  We get two magazines, by the number of nodes ( <b>-j2</b> ).  We configure the name in the lock table, where <b>Cluster</b> is the name of our cluster. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs resource create fs-lxc_ct Filesystem fstype=gfs2 device=/dev/shared_vg/lxc_ct directory=/var/lib/lxc clone ordered=true interleave=true # pcs constraint order start clvmd-clone then fs-lxc_ct-clone</span></span></code> </pre>  We get another clone-resource, such as <b>Filesystem</b> , the <b>device</b> and <b>directory</b> fields are required and describe what to mount and where.  And we specify the order of resource startup, because without clvmd, the file system will not mount.  After that, on all nodes, the directory where LXC stores container settings is mounted. <br><br>  Create the first container: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># lxc-create -n lxc-racktables -t oracle -B lvm --fssize 2G --fstype ext4 --vgname shared_vg -- -R 6.6</span></span></code> </pre>  Here <b>lxc-racktables</b> is the name of the container, <b>oracle</b> is the template used.  <b>-B</b> specifies the type of storage used and the parameters.  <b>lxc-create</b> will create an LVM partition and deploy the base system there, according to the template.  After the "-" indicates the parameters of the template, in my case - version. <br>  At the time of this writing, the template from the centos package did not work for lvm, but the oracle also suited me. <br>  If you need to deploy a system based on deb packages, you must first install the <b>debootstrap</b> utility.  The prepared system is first deployed to <code>/var/cache/lxc/</code> and each time it starts up, lxc-create updates the system packages to the current versions.  For yourself it is convenient to assemble your own template, with all the necessary presets.  Standard templates are located here: <code>/usr/share/lxc/templates</code> . <br>  You can also use the special " <b>download</b> " template, which downloads already prepared system archives from the repository. <br><br>  The container is ready.  Containers can be managed with lxc- * utilities.  Run in the background, see its state, stop: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># lxc-start -n lxc-racktables -d # lxc-info -n lxc-racktables Name: lxc-racktables State: RUNNING PID: 9364 CPU use: 0.04 seconds BlkIO use: 0 bytes Memory use: 1.19 MiB KMem use: 0 bytes Link: vethS7U8J1 TX bytes: 90 bytes RX bytes: 90 bytes Total bytes: 180 bytes # lxc-stop -n lxc-racktables</span></span></code> </pre><br>  We configure additional container parameters either in its console using <b>lxc-console</b> , or by mounting the lvm section of the container somewhere. <br><br>  Now you can give control to Pacemaker.  But first, take a fresh resource management file from <b>GitHub</b> : <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># wget -O /usr/lib/ocf/resource.d/heartbeat/lxc https://raw.githubusercontent.com/ClusterLabs/resource-agents/master/heartbeat/lxc # chmod +x /usr/lib/ocf/resource.d/heartbeat/lxc</span></span></code> </pre><br>  The <code>/usr/lib/ocf/resource.d/</code> directory contains resource management files in the provider / type hierarchy.  See the entire resource list with the <code>pcs resource list</code> command.  View a description of a specific resource - <code>pcs resource describe &lt;standard:provider:type|type&gt;</code> . <br><div class="spoiler">  <b class="spoiler_title">Example:</b> <div class="spoiler_text"><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment"># pcs resource describe ocf:heartbeat:lxc ocf:heartbeat:lxc - Manages LXC containers Allows LXC containers to be managed by the cluster. If the container is running "init" it will also perform an orderly shutdown. It is 'assumed' that the 'init' system will do an orderly shudown if presented with a 'kill -PWR' signal. On a 'sysvinit' this would require the container to have an inittab file containing "p0::powerfail:/sbin/init 0" I have absolutly no idea how this is done with 'upstart' or 'systemd', YMMV if your container is using one of them. Resource options: container (required): The unique name for this 'Container Instance' eg 'test1'. config (required): Absolute path to the file holding the specific configuration for this container eg '/etc/lxc/test1/config'. log: Absolute path to the container log file use_screen: Provides the option of capturing the 'root console' from the container and showing it on a separate screen. To see the screen output run 'screen -r {container name}' The default value is set to 'false', change to 'true' to activate this option</span></span></code> </pre><br></div></div><br>  So, we add a new resource to our cluster: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs resource create lxc-racktables lxc container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config # pcs constraint order start fs-lxc_ct-clone then lxc-racktables</span></span></code> </pre>  And indicate the order of launch. <br>  The resource will immediately start and its status can be found with the command <code>pcs status</code> .  If the launch fails, then there will be a possible reason.  The <code>pcs resource debug-start &lt;resource id&gt;</code> command allows you to start the resource with the result displayed on the screen: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs resource debug-start lxc-racktables Operation start for lxc-racktables (ocf:heartbeat:lxc) returned 0 &gt; stderr: DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment"> State of lxc-racktables: State: STOPPED &gt; stderr: INFO: Starting lxc-racktables &gt; stderr: DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment"> State of lxc-racktables: State: RUNNING &gt; stderr: DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment"> lxc-racktables start : 0</span></span></code> </pre><br>  But you need to be careful with it, it ignores the cluster settings for resource allocation and runs it on the current node.  And if the resource is already running on another node, then there may be surprises.  The modifier <code>"--full"</code> will give a lot of additional information. <br>  Although he manages the Pacemaker container, but you can still work with it with all the <b>lxc- *</b> utilities, of course, only on the node on which he is currently working and with an eye on Pacemaker. <br><br>  The resulting resource container can be transferred to another node by executing: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs resource move &lt;resource id&gt; [destination node]</span></span></code> </pre>  In this case, the container will shut down correctly on one node, and start on the other. <br><br>  Unfortunately, LXC does not have a decent live migration tool, but when it does, it will be possible to set up a migration.  To do this, you will need to create another shared partition on GFS2, where the dumps will be placed and modify the lxc script resource, so that it will work out the migrate_to and migrate_from functions. <br>  I looked at the <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a> project, but I could not achieve work on CentOS 7. <br><br><h3>  Transfer OpenVZ Container to LXC </h3><br>  Create a new logical partition and transfer data there from the OpenVZ container (turned off): <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># lvcreate -L 2G -n lxc-openvz shared_vg # mkfs.ext4 /dev/shared_vg/lxc-openvz # mount /dev/shared_vg/lxc-openvz /mnt/lxc-openvz # rsync -avh --numeric-ids -e 'ssh' openvz:/vz/private/&lt;containerid&gt;/ /mnt/lxc-openvz/</span></span></code> </pre><br>  Create a configuration file for the new container by copying and changing the contents of lxc-racktables: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mkdir /var/lib/lxc/lxc-openvz # cp /var/lib/lxc/lxc-racktables/config /var/lib/lxc/lxc-openvz/</span></span></code> </pre><br>  In the configuration file, you must change the fields: <br><pre> <code class="bash hljs">lxc.rootfs = /dev/shared_vg/lxc-openvz lxc.utsname = openvz <span class="hljs-comment"><span class="hljs-comment">#lxc.network.hwaddr</span></span></code> </pre><br>  If necessary, adjust the restrictions and the desired network bridge.  Also in the container, you need to change the network settings by rewriting them to the <b>eth0</b> interface and correct the file <code>etc/sysconfig/network</code> . <br><br>  In principle, after that the container can already be launched, but for better compatibility with LXC it is necessary to modify the contents.  As an example, I used a template to create a centos container ( <code>/usr/share/lxc/templates/lxc-centos</code> ), namely the contents of the <code>configure_centos</code> and <code>configure_centos_init</code> functions with a slight refinement.  Pay special attention to the creation of the <code>etc/init/power-status-changed.conf</code> script, without it the container will not be able to shut down correctly.  Or the container <b>inittab</b> should contain a rule of the form: <code>"p0::powerfail:/sbin/init 0"</code> (depends on the distribution kit). <br><div class="spoiler">  <b class="spoiler_title">/etc/init/power-status-changed.conf</b> <div class="spoiler_text">  # power-status-changed - shutdown on SIGPWR <br>  # <br>  start on power-status-changed <br><br>  exec / sbin / shutdown -h now "SIGPWR received" </div></div><br>  If someone is too lazy to understand himself (but in vain), then you can use <a href="">mine</a> (at your own peril and risk).  The MAC address of the container is best recorded in the configuration file. <br>  <code>lxc-console</code> containers may have problems with the console - it can not be obtained using <code>lxc-console</code> .  I solve this problem using a <b><code>agetty</code></b> using <b><code>agetty</code></b> (alternative Linux getty), which was included in the portable container.  And with the <b><code>init</code></b> settings, which starts the processes of the form: <br><pre> <code class="bash hljs">/sbin/agetty -8 38400 /dev/console /sbin/agetty -8 38400 /dev/tty1</code> </pre>  The recipe and scripts <code>/etc/init/</code> were borrowed from the newly created clean container and were converted to <code>agetty</code> . <br><div class="spoiler">  <b class="spoiler_title">/etc/init/start-ttys.conf</b> <div class="spoiler_text">  # <br>  This service starts the configured number of gettys. <br>  # <br>  # Do not edit this file directly.  If you want to change the behavior, <br>  # please create a file start-ttys.override and put your changes there. <br><br>  start to stop rc RUNLEVEL = [2345] <br><br>  env ACTIVE_CONSOLES = / dev / tty [1-6] <br>  env X_TTY = / dev / tty1 <br>  task <br>  script <br>  .  / etc / sysconfig / init <br>  for tty in $ (echo $ ACTIVE_CONSOLES);  do <br>  ["$ RUNLEVEL" = "5" -a "$ tty" = "$ X_TTY"] &amp;&amp; continue <br>  initctl start tty tty = $ tty <br>  done <br>  end script </div></div><br><div class="spoiler">  <b class="spoiler_title">/etc/init/console.conf</b> <div class="spoiler_text">  # console - getty <br>  # <br>  This is a service from <br>  # started while it is shut down again. <br><br>  start to stop rc RUNLEVEL = [2345] <br>  stop on runlevel [! 2345] <br>  env container <br><br>  respawn <br>  #exec / sbin / mingetty --nohangup --noclear / dev / console <br>  exec / sbin / agetty -8 38400 / dev / console </div></div><br><div class="spoiler">  <b class="spoiler_title">/etc/init/tty.conf</b> <div class="spoiler_text">  # tty - getty <br>  # <br>  This service maintains a getty on the specified device. <br>  # <br>  # Do not edit this file directly.  If you want to change the behavior, <br>  # please create a file tty.override and put your changes there. <br><br>  stop on runlevel [S016] <br><br>  respawn <br>  instance $ tty <br>  #exec / sbin / mingetty --nohangup $ TTY <br>  exec / sbin / agetty -8 38400 $ TTY <br>  usage 'tty tty = / dev / ttyX - where X is console id' </div></div>  I tried to use <code>mingetty</code> in a <code>mingetty</code> container from CentOS 6.6, but it refused to work with an error in the logs: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /sbin/mingetty --nohangup /dev/console console: no controlling tty: Operation not permitted</span></span></code> </pre><br><br>  You can work with LXC via <b><code>libvrt</code></b> using the <a href="http://libvirt.org/drvlxc.html" title="http://libvirt.org/drvlxc.html">lxc: ///</a> driver, but this method is dangerous and RedHat <a href="https://access.redhat.com/articles/1365153" title="https://access.redhat.com/articles/1365153">threatens to</a> remove its support from the distribution. <br>  For managing via <code>libvrt</code> in Pacemaker, there is a script resource <code>ocf:heartbeat:VirtualDomain</code> that can manage any VM, depending on the driver.  Features include live migration for KVM.  I think using Pacemaker to manage KVM would be the same, but it wasn‚Äôt necessary for me. <br><br><h2>  Work with Docker in a cluster </h2><br>  Configuring Pacemaker for working with Docker is similar to configuring LXC, but there are some design differences. <br>  To begin with, we will install Docker, since it is included in the RHEL / CentOS 7 distribution, there will be no problems. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum install docker</span></span></code> </pre><br>  Let's teach Docker to work with LVM.  To do this, create the file <code>/etc/sysconfig/docker-storage-setup</code> with the contents: <br><pre> <code class="bash hljs">VG=shared_vg-ex</code> </pre>  Where we specify in which group of Docker volumes to create our pool.  Here you can also set additional parameters ( <code>man docker-storage-setup</code> ). <br><br>  Run <code>docker-storage-setup</code> : <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># docker-storage-setup Rounding up size to full physical extent 716.00 MiB Logical volume "docker-poolmeta" created. Logical volume "docker-pool" created. WARNING: Converting logical volume shared_vg-ex/docker-pool and shared_vg-ex/docker-poolmeta to pools data and metadata volumes. THIS WILL DESTROY CONTENT OF LOGICAL VOLUME (filesystem etc.) Converted shared_vg-ex/docker-pool to thin pool. Logical volume "docker-pool" changed. # lvs | grep docker-pool docker-pool shared_vg-ex twi-aot--- 17.98g 14.41 2.54</span></span></code> </pre><br>  Docker uses a sparse volume (thin provisioned), this imposes a restriction on use in a cluster.  Such a volume cannot be active on multiple nodes at the same time.  Configure LVM so that the volumes in the shared_vg-ex group are not automatically activated.  To do this, you must explicitly specify the groups (or volumes separately) that will be activated automatically in the <code>/etc/lvm/lvm.conf</code> file (on all nodes): <br><pre> <code class="bash hljs"> auto_activation_volume_list = [ <span class="hljs-string"><span class="hljs-string">"shared_vg"</span></span> ]</code> </pre><br>  Let us transfer control of this volume to Pacemaker: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs resource create lvm-docker-pool LVM volgrpname=shared_vg-ex exclusive=yes # pcs constraint order start clvmd-clone then lvm-docker-pool # pcs constraint colocation add lvm-docker-pool with clvmd-clone</span></span></code> </pre>  Now the <b>shared_vg-ex</b> group <b>volumes</b> will be activated on the node where the <b>lvm-docker-pool</b> resource is <b>running</b> . <br><br>  Docker will use dedicated IP for NAT from containers from the external network.  Fix it in the configuration: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cat /etc/sysconfig/docker-network DOCKER_NETWORK_OPTIONS="--ip=10.1.2.10 ‚Äîfixed-cidr=172.17.0.0/16"</span></span></code> </pre>  We will not configure a separate bridge, let it use <b>docker0</b> by default, just fix the network for the containers.  I tried to point out to me a convenient network for containers, but came across some unclear errors.  Google suggested that I was not alone, so I was satisfied by simply fixing the network that Docker had chosen for himself.  Docker also does not stop the bridge when it is turned off and does not remove the ip address, but since the bridge is not connected to any physical interface, this is not a problem.  In other configurations, this must be taken into account. <br><br>  In order for Docker to go to the Internet through a proxy server, we will set up environment variables for him.  To do this, create a directory and the <code>/etc/systemd/system/docker.service.d/http-proxy.conf</code> file with the contents: <br><pre> <code class="bash hljs">[Service] Environment=<span class="hljs-string"><span class="hljs-string">"http_proxy=http://ip_proxy:port"</span></span> <span class="hljs-string"><span class="hljs-string">"https_proxy=http://ip_proxy:port"</span></span> <span class="hljs-string"><span class="hljs-string">"NO_PROXY=localhost,127.0.0.0/8,dregistry"</span></span></code> </pre><br><br>  The basic configuration is completed, we will fill the cluster with the appropriate resources.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since a set of resources will be responsible for Docker, it is convenient to put them into a group. </font><font style="vertical-align: inherit;">All group resources are launched on the same node and run sequentially according to the order in the group. </font><font style="vertical-align: inherit;">But keep in mind that when one of the group's resources fails, the whole group will gather to migrate to another node. </font><font style="vertical-align: inherit;">And also, when you turn off any resource group, all subsequent resources also turn off. </font><font style="vertical-align: inherit;">The first resource of the group will be the created LVM volume:</font></font><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs resource group add docker lvm-docker-pool</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create a resource - the IP address issued by Docker: </font></font><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs resource create dockerIP IPaddr2 --group docker --after lvm-docker-pool ip=10.1.2.10 cidr_netmask=24 nic=br0.12</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition to LVM volumes, Docker also uses the file system to store its data. </font><font style="vertical-align: inherit;">For this you need to start another section running Pacemaker. </font><font style="vertical-align: inherit;">Since this data is only needed by a running Dokcer, the resource will be normal.</font></font><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># lvcreate -L 500M -n docker-db shared_vg # mkfs.xfs /dev/shared_vg/docker-db # pcs resource create fs-docker-db Filesystem fstype=xfs device=/dev/shared_vg/docker-db directory=/var/lib/docker --group docker --after dockerIP</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now you can add the Docker daemon itself: </font></font><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs resource create dockerd systemd:docker --group docker --after fs-docker-db</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> After the successful launch of the group's resources, on the node where Docker settled we look at its status and make sure that everything is fine. </font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker info:</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># docker info Containers: 5 Images: 42 Storage Driver: devicemapper Pool Name: shared_vg--ex-docker--pool Pool Blocksize: 524.3 kB Backing Filesystem: xfs Data file: Metadata file: Data Space Used: 2.781 GB Data Space Total: 19.3 GB Data Space Available: 16.52 GB Metadata Space Used: 852 kB Metadata Space Total: 33.55 MB Metadata Space Available: 32.7 MB Udev Sync Supported: true Library Version: 1.02.93-RHEL7 (2015-01-28) Execution Driver: native-0.2 Kernel Version: 3.10.0-229.7.2.el7.x86_64 Operating System: CentOS Linux 7 (Core) CPUs: 4 Total Memory: 3.703 GiB Name: cluster-2</span></span></code> </pre><br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can already work with Docker in the usual manner. </font><font style="vertical-align: inherit;">But for the sake of completeness, we will enter and place in our cluster the Docker-registry. </font><font style="vertical-align: inherit;">For the registry, we will use a separate IP and the name 10.1.2.11 (dregistry), and we will move the image file storage into a separate section.</font></font><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># lvcreate -L 10G -n docker-registry shared_vg # mkfs.ext4 /dev/shared_vg/docker-registry # mkdir /mnt/docker-registry # pcs resource create docker-registry Filesystem fstype=ext4 device=/dev/shared_vg/docker-registry directory=/mnt/docker-registry --group=docker ‚Äìafter=dockerd # pcs resource create registryIP IPaddr2 --group docker --after docker-registry ip=10.1.2.11 cidr_netmask=24 nic=br0.12</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create a container registry on the node where Docker is running: </font></font><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># docker create -p 10.1.2.11:80:5000 -e REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY=/var/lib/registry -v /mnt/docker-registry:/var/lib/registry -h dregistry --name=dregistry registry:2</span></span></code> </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We set port forwarding to the container (10.1.2.11:80 ‚Üí 5000). </font><font style="vertical-align: inherit;">Plugin directory </font></font><code>/mnt/docker-registry</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Host name and container name. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The output </font></font><code>docker ps -a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will show the created container, ready to run. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's give control to them Pacemaker. </font><font style="vertical-align: inherit;">First, download the latest resource script:</font></font><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># wget -O /usr/lib/ocf/resource.d/heartbeat/docker https://raw.githubusercontent.com/ClusterLabs/resource-agents/master/heartbeat/docker # chmod +x /usr/lib/ocf/resource.d/heartbeat/docker</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is important to monitor the identity of the resource scripts on all nodes, and then there may be surprises. The docker resource script can create the required containers with the specified parameters by downloading them from the registry. Therefore, you can simply use Docker's constantly running on cluster nodes with a common registry and personal vaults. And Pacemaker only controls individual containers, but this is not so interesting, and it is redundant. I have not yet figured out what to do with one of the Docker. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, we will hand over the management of the finished container to Pacemaker.</font></font><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs resource create dregistry docker reuse=true image="docker.io/registry:2" --group docker --after registryIP</span></span></code> </pre> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reuse = true</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is an important parameter, otherwise the container will be deleted after stopping. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image You</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> must specify the full coordinates of the container, including the registry and tag. The resource script will pick up the finished container named </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dregistry</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and launch it. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's write our local registry to the Docker configuration on the cluster nodes ( </font></font><code>/etc/sysconfig/docker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br><pre> <code class="bash hljs">ADD_REGISTRY=<span class="hljs-string"><span class="hljs-string">'--add-registry dregistry'</span></span> INSECURE_REGISTRY=<span class="hljs-string"><span class="hljs-string">'--insecure-registry dregistry'</span></span></code> </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We do not need HTTPS, so we disable it for the local registry. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After this, we restart the Docker service </font></font><code>systemctl restart docker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on the node where it lives or </font></font><code>pcs resource restart dockerd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on any node of the cluster. </font><font style="vertical-align: inherit;">And we can use the capabilities of our personal registry at 10.1.2.11 (dregistry). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now, using the example of Docker containers, I will show you how to work with templates in Pacemaker. </font><font style="vertical-align: inherit;">Unfortunately, the utility features </font></font><b><code>pcs</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here are very limited. </font><font style="vertical-align: inherit;">Templates as such, it does not know how to do it at all, and for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">constraint</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> it allows you to create some joins, but working with them is </font></font><b><code>pcs</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not convenient. </font><font style="vertical-align: inherit;">Fortunately, the ability to edit the cluster configuration directly in the xml file comes to the rescue:</font></font><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pcs cluster cib &gt; /tmp/cluster.xml # ,   # pcs cluster cib-push /tmp/cluster.xml</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Docker-resources should meet the following requirements: </font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is on the same node with docker group resources </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> run after all docker group resources </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> container must be independent of each other‚Äôs status </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, this can be achieved by hanging dependencies on each container using </font></font><b><code>pcs constraint</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but the configuration is cumbersome and difficult to read. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To begin with, we will create three experimental containers, which I used as a container with Nginx. </font><font style="vertical-align: inherit;">The container is pre-downloaded and uploaded to the local registry:</font></font><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># docker pull nginx:latest # docker push nginx:latest # pcs resource create doc-test3 docker reuse=false image="dregistry/nginx:latest" --disabled # pcs resource create doc-test2 docker reuse=true image="dregistry/nginx:latest" --disabled # pcs resource create doc-test docker reuse=true image="dregistry/nginx:latest" --disabled</span></span></code> </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resources are created off, otherwise they will try to start and then as lucky with the node. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the newly uploaded xml add a pool of resources. </font><font style="vertical-align: inherit;">Defining co-location (section</font></font><pre> <code class="hljs vbscript"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code><code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code><code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <ul><li> <code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code><code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> <li> <code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code><code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> <li> <code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code><code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> </ul> <code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code><code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code class="xml"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> &lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code><code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code><code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code class="bash"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col) <br> <br>       .    LXC  (  <code><code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code><code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code><code class="xml"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  ): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt; <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code><code class="xml"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> &lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt; <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code><code class="bash"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> # pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <div class="spoiler"> <code><code><b class="spoiler_title"><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> # pcs status Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></b></code></code> <div class="spoiler_text"> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </div> </div> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <div class="spoiler"> <code><code><b class="spoiler_title"><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> # pcs constraint Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></b></code></code> <div class="spoiler_text"> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </div> </div> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <h2> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </h2> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code><code class="bash"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> # pcs resource show &lt;resource id&gt; <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code><code class="bash"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> # pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code><code class="bash"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> # pcs resource restart &lt;resource id&gt; [node]    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code><code class="bash"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> # pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code><code class="bash"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> # pcs resource cleanup [&lt;resource id&gt;]    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code><code class="bash"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> # pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code><code class="bash"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> # pcs resource move &lt;resource id&gt; [destination node]  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code><code class="bash"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker) c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code><code class="bash"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> # pcs constraint ‚Äìfull <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code><code class="bash"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> # pcs constraint remove &lt;constraint id&gt; <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <pre> <code class="hljs vbscript"><code><code class="bash"><code class="xml">): <br> &lt;rsc_colocation id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span> score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> , <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col"</span></span></code></b> )        ( <b><code>score=<span class="hljs-string"><span class="hljs-string">"INFINITY"</span></span></code></b> ).    ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-0"</span></span></code></b> )  : <br>    ( <b><code>sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )        ( <b><code>require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code></b> )   ( <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role=<span class="hljs-string"><span class="hljs-string">"Started"</span></span></code></b> . <br>     ( <b><code>id=<span class="hljs-string"><span class="hljs-string">"docker-col-1"</span></span></code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></i> ,    : <br> <code class="xml">&lt;rsc_order id=<span class="hljs-string"><span class="hljs-string">"order_doc"</span></span>&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-0"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"docker"</span></span>/&gt; &lt;/resource_set&gt; &lt;resource_set id=<span class="hljs-string"><span class="hljs-string">"order_doc-1"</span></span> require-all=<span class="hljs-string"><span class="hljs-string">"false"</span></span> sequential=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test2"</span></span>/&gt; &lt;resource_ref id=<span class="hljs-string"><span class="hljs-string">"doc-test3"</span></span>/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:order_doc<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:order_doc<span class="hljs-number"><span class="hljs-number">-1</span></span>) (id:order_doc) Resource Sets: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> (id:docker-col<span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker (id:docker-col<span class="hljs-number"><span class="hljs-number">-1</span></span>) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"ocf"</span></span> provider=<span class="hljs-string"><span class="hljs-string">"heartbeat"</span></span> type=<span class="hljs-string"><span class="hljs-string">"lxc"</span></span>&gt; &lt;meta_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-template-meta_attributes-allow-migrate"</span></span> name=<span class="hljs-string"><span class="hljs-string">"use_screen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-monitor-30s"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"30s"</span></span> name=<span class="hljs-string"><span class="hljs-string">"monitor"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-start-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"20s"</span></span>/&gt; &lt;op id=<span class="hljs-string"><span class="hljs-string">"lxc-template-stop-0"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"0"</span></span> name=<span class="hljs-string"><span class="hljs-string">"start"</span></span> timeout=<span class="hljs-string"><span class="hljs-string">"90s"</span></span>/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span> template=<span class="hljs-string"><span class="hljs-string">"lxc-template"</span></span>&gt; &lt;instance_attributes id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes"</span></span>&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-container"</span></span> name=<span class="hljs-string"><span class="hljs-string">"container"</span></span> value=<span class="hljs-string"><span class="hljs-string">"lxc-racktables"</span></span>/&gt; &lt;nvpair id=<span class="hljs-string"><span class="hljs-string">"lxc-racktables-instance_attributes-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"config"</span></span> value=<span class="hljs-string"><span class="hljs-string">"/var/lib/lxc/lxc-racktables/config"</span></span>/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Last change: Thu Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> <br> Stack: corosync <br> Current DC: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) - partition <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> quorum <br> Version: <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>-a14efad <br> <span class="hljs-number"><span class="hljs-number">2</span></span> Nodes configured <br> <span class="hljs-number"><span class="hljs-number">19</span></span> Resources configured <br> <br> Online: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> <br> Full list of resources: <br> <br> cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith (stonith:fence_ipmilan): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: dlm-clone [dlm] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: clvmd-clone [clvmd] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> Clone <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dockerd (systemd:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> dregistry (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test2 (ocf::heartbeat:docker): Started cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster<span class="hljs-number"><span class="hljs-number">-1</span></span>: Online <br> cluster<span class="hljs-number"><span class="hljs-number">-2</span></span>: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-1.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-1</span></span> (score:-INFINITY) <br> Resource: cluster<span class="hljs-number"><span class="hljs-number">-2.</span></span>stonith <br> Disabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:-INFINITY) <br> Resource: doc-test <br> Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start clvmd-clone (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lxc-racktables (kind:Mandatory) <br> start clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <br> Colocation Constraints: <br> clvmd-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> lvm-docker-pool <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> clvmd-clone (score:INFINITY) <br> Resource Sets: <br> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc-test doc-test2 doc-test3 role=Started sequential=<span class="hljs-literal"><span class="hljs-literal">false</span></span> require-all=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay=<span class="hljs-string"><span class="hljs-string">"3s"</span></span> interval=<span class="hljs-number"><span class="hljs-number">0</span></span>s timeout=<span class="hljs-number"><span class="hljs-number">90</span></span></code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: cluster<span class="hljs-number"><span class="hljs-number">-2</span></span> (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> # pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang=<span class="hljs-string"><span class="hljs-string">"bash"</span></span>&gt; <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-<span class="hljs-keyword"><span class="hljs-keyword">On</span></span> Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Docker Formatted Container Images <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC <span class="hljs-number"><span class="hljs-number">1.0</span></span>.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code></code> </pre> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <h2> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </h2> <code><code><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> <ul><li> <code><code><a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, "><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  </a><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> Pacemaker,  <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> <li> <code><code><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch"><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  </a><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> Clusters from Scratch <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> <li> <code><code><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html"><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  </a><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> Configuration Explained <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> <li> <code><code><a href="http://habrahabr.ru/post/200348/"><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  </a><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> Pacemaker:    <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> <li> <code><code><a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html"><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  </a><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> Creating LVM Volumes in a Cluster <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> <li> <code><code><a href="https://access.redhat.com/articles/1365153"><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  </a><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> Linux Containers with libvirt-lxc (deprecated) <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> <li> <code><code><a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html"><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  </a><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> High Availability Add-On Reference <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> <li> <code><code><a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html"><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  </a><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> High Availability Add-On Administration <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> <li> <code><code><a href="https://docs.docker.com/"><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  </a><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> Docker Docs <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> <li> <code><code><a href="https://access.redhat.com/articles/881893"><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  </a><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> Get Started with Docker Formatted Container Images on Red Hat Systems <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> <li> <code><code><a href="http://vasilisc.com/lxc-1-0-blog-post-series"><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  </a><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> LXC 1.0. <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> <li> <code><code><a href="https://github.com/ClusterLabs"><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  </a><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> GitHub ClusterLabs <a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page">CRIU</a></code></code> </li> <li> <code><code><a href="http://criu.org/Main_Page" title="http://criu.org/Main_Page"><code class="xml">): <br> &lt;rsc_colocation id="docker-col" score="INFINITY"&gt; &lt;resource_set id="docker-col-0" require-all="false" role="Started" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;resource_set id="docker-col-1"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;/rsc_colocation&gt;</code>     ( <i>colocation set</i> , <b><code>id="docker-col"</code></b> )        ( <b><code>score="INFINITY"</code></b> ).    ( <b><code>id="docker-col-0"</code></b> )  : <br>    ( <b><code>sequential="false"</code></b> )        ( <b><code>require-all="false"</code></b> )   ( <b><code>role="Started"</code></b> ) <br>  <b>resource_ref</b>     ,      .  <b><code>role="Started"</code></b> . <br>     ( <b><code>id="docker-col-1"</code></b> ),      <b><code>docker</code></b> . <br>        <b>role</b>   ,  </a><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html" title="12.2. Referencing Templates in Constraints">   </a> ( ). <br> <br> <i>Ordering set</i> ,    : <br> <code class="xml">&lt;rsc_order id="order_doc"&gt; &lt;resource_set id="order_doc-0"&gt; &lt;resource_ref id="docker"/&gt; &lt;/resource_set&gt; &lt;resource_set id="order_doc-1" require-all="false" sequential="false"&gt; &lt;resource_ref id="doc-test"/&gt; &lt;resource_ref id="doc-test2"/&gt; &lt;resource_ref id="doc-test3"/&gt; &lt;/resource_set&gt; &lt;/rsc_order&gt;</code>  ,     <b><code>docker</code></b> ,       . <br> <br>    ,    /  .       .             ,    - .   <b><code>pcs</code></b>     : <br> <code class="bash"> # pcs constraint --full | grep -i set Resource Sets: set docker (id:order_doc-0) set doc-test doc-test2 doc-test3 sequential=false require-all=false (id:order_doc-1) (id:order_doc) Resource Sets: set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false (id:docker-col-0) set docker (id:docker-col-1) setoptions score=INFINITY (id:docker-col)</code> <br> <br>       .    LXC  (  <code class="xml">): <br> &lt;template id="lxc-template" class="ocf" provider="heartbeat" type="lxc"&gt; &lt;meta_attributes id="lxc-template-meta_attributes"&gt; &lt;nvpair id="lxc-template-meta_attributes-allow-migrate" name="use_screen" value="false"/&gt; &lt;/meta_attributes&gt; &lt;operations&gt; &lt;op id="lxc-template-monitor-30s" interval="30s" name="monitor" timeout="20s"/&gt; &lt;op id="lxc-template-start-0" interval="0" name="start" timeout="20s"/&gt; &lt;op id="lxc-template-stop-0" interval="0" name="start" timeout="90s"/&gt; &lt;/operations&gt; &lt;/template&gt;</code> <br>      .        : <br> <code class="xml">&lt;primitive id="lxc-racktables" template="lxc-template"&gt; &lt;instance_attributes id="lxc-racktables-instance_attributes"&gt; &lt;nvpair id="lxc-racktables-instance_attributes-container" name="container" value="lxc-racktables"/&gt; &lt;nvpair id="lxc-racktables-instance_attributes-config" name="config" value="/var/lib/lxc/lxc-racktables/config"/&gt; &lt;/instance_attributes&gt; &lt;/primitive&gt;</code> <br>         : <br> <code class="bash"># pcs resource show lxc-racktables Resource: lxc-racktables (template=lxc-template) Attributes: container=lxc-racktables config=/var/lib/lxc/lxc-racktables/config</code> <br>      <code>pcs</code>      . <br>      LXC  ,   Docker-. <br> <br>   Pacemaker-    <b><code>crmsh</code></b>   <a href="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/" title="http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/">opensuse.org</a> , , ,    . <br> <br>    : <br> <b class="spoiler_title"># pcs status</b> Cluster name: Cluster <br> Last updated: Thu Jul 16 12:29:33 2015 <br> Last change: Thu Jul 16 10:23:40 2015 <br> Stack: corosync <br> Current DC: cluster-1 (1) - partition with quorum <br> Version: 1.1.12-a14efad <br> 2 Nodes configured <br> 19 Resources configured <br> <br> Online: [ cluster-1 cluster-2 ] <br> <br> Full list of resources: <br> <br> cluster-1.stonith (stonith:fence_ipmilan): Started cluster-2 <br> cluster-2.stonith (stonith:fence_ipmilan): Started cluster-1 <br> Clone Set: dlm-clone [dlm] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: clvmd-clone [clvmd] <br> Started: [ cluster-1 cluster-2 ] <br> Clone Set: fs-lxc_ct-clone [fs-lxc_ct] <br> Started: [ cluster-1 cluster-2 ] <br> lxc-racktables (ocf::heartbeat:lxc): Started cluster-1 <br> Resource Group: docker <br> lvm-docker-pool (ocf::heartbeat:LVM): Started cluster-2 <br> dockerIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> fs-docker-db (ocf::heartbeat:Filesystem): Started cluster-2 <br> dockerd (systemd:docker): Started cluster-2 <br> docker-registry (ocf::heartbeat:Filesystem): Started cluster-2 <br> registryIP (ocf::heartbeat:IPaddr2): Started cluster-2 <br> dregistry (ocf::heartbeat:docker): Started cluster-2 <br> doc-test (ocf::heartbeat:docker): Started cluster-2 <br> doc-test2 (ocf::heartbeat:docker): Started cluster-2 <br> doc-test3 (ocf::heartbeat:docker): Stopped <br> <br> PCSD Status: <br> cluster-1: Online <br> cluster-2: Online <br> <br> Daemon Status: <br> corosync: active/disabled <br> pacemaker: active/enabled <br> pcsd: active/enabled <br> <b class="spoiler_title"># pcs constraint</b> Location Constraints: <br> Resource: cluster-1.stonith <br> Disabled on: cluster-1 (score:-INFINITY) <br> Resource: cluster-2.stonith <br> Disabled on: cluster-2 (score:-INFINITY) <br> Resource: doc-test <br> Enabled on: cluster-2 (score:INFINITY) (role: Started) <br> Ordering Constraints: <br> start dlm-clone then start clvmd-clone (kind:Mandatory) <br> start clvmd-clone then start fs-lxc_ct-clone (kind:Mandatory) <br> start fs-lxc_ct-clone then start lxc-racktables (kind:Mandatory) <br> start clvmd-clone then start lvm-docker-pool (kind:Mandatory) <br> Resource Sets: <br> set docker set doc-test doc-test2 doc-test3 sequential=false require-all=false <br> Colocation Constraints: <br> clvmd-clone with dlm-clone (score:INFINITY) <br> fs-lxc_ct-clone with clvmd-clone (score:INFINITY) <br> lvm-docker-pool with clvmd-clone (score:INFINITY) <br> Resource Sets: <br> set doc-test doc-test2 doc-test3 role=Started sequential=false require-all=false set docker setoptions score=INFINITY <br> <br>   . <br> <br>  <br>    : <br> <code class="bash"># pcs resource show &lt;resource id&gt;</code> <br>     , : <br> <code class="bash"># pcs resource update &lt;resource id&gt; op start start-delay="3s" interval=0s timeout=90</code>        ,  ,   update  . <br> <br>   <br> <code class="bash"># pcs resource restart &lt;resource id&gt; [node]</code>    clone-    ,  ,  . <br> <br>        : <br> <code class="bash"># pcs resource failcount show &lt;resource id&gt; [node] # pcs resource failcount reset &lt;resource id&gt; [node]</code>   ,        Pacemaker    -     . <br> <br>      : <br> <code class="bash"># pcs resource cleanup [&lt;resource id&gt;]</code>    Pacemaker    . <br> <br> / - : <br> <code class="bash"># pcs resource disable [&lt;resource id&gt;] # pcs resource enable [&lt;resource id&gt;]</code>    /  ,   . <br> <br>     : <br> <code class="bash"># pcs resource move &lt;resource id&gt; [destination node]</code>  -    ,             .      ,     ,    .  ,  constraint   : <br> <code class="bash"> Resource: docker Enabled on: cluster-2 (score:INFINITY) (role: Started) (id:cli-prefer-docker)</code> c   .       . <br> <br>      : <br> <code class="bash"># pcs constraint ‚Äìfull</code> <br>  -   id,  : <br> <code class="bash"># pcs constraint remove &lt;constraint id&gt;</code> <br>      : <br> <code class="bash"># pcs cluster cib &gt; /tmp/cluster.xml # pcs cluster cib-push /tmp/cluster.xml&lt;source lang="bash"&gt;</code> <br> <br> C <br> <a href="http://wiki.525.su/doku.php%3Fid%3Dpacemaker_theory" title="Pacemaker, ">Pacemaker, </a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html/Clusters_from_Scratch/index.html" title="Clusters from Scratch">Clusters from Scratch</a> <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-pcs/html-single/Pacemaker_Explained/index.html">Configuration Explained</a> <a href="http://habrahabr.ru/post/200348/">Pacemaker:   </a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Logical_Volume_Manager_Administration/LVM_administration.html">Creating LVM Volumes in a Cluster</a> <a href="https://access.redhat.com/articles/1365153">Linux Containers with libvirt-lxc (deprecated)</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html">High Availability Add-On Reference</a> <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Administration/ch-startup-HAAA.html">High Availability Add-On Administration</a> <a href="https://docs.docker.com/">Docker Docs</a> <a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a> <a href="http://vasilisc.com/lxc-1-0-blog-post-series">LXC 1.0.</a> <a href="https://github.com/ClusterLabs">GitHub ClusterLabs</a> CRIU</code></code> </li> </ul></div><p>Source: <a href="https://habr.com/ru/post/263091/">https://habr.com/ru/post/263091/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263081/index.html">We clean the home Internet from very annoying ads (Ad's blocker for OpenWRT)</a></li>
<li><a href="../263083/index.html">Build docker containers with docker containers</a></li>
<li><a href="../263085/index.html">Site security audit through the eyes of the customer</a></li>
<li><a href="../263087/index.html">IOS development testing</a></li>
<li><a href="../263089/index.html">Automatic search for routers with standard passwords</a></li>
<li><a href="../263093/index.html">Crackme Chiwaka1 study</a></li>
<li><a href="../263097/index.html">Event-oriented Python backtesting step by step. Part 1</a></li>
<li><a href="../263099/index.html">Skype turned to people?</a></li>
<li><a href="../263101/index.html">Work with passwords: how to protect your accounts (expert opinion)</a></li>
<li><a href="../263103/index.html">Unobvious performance problems in Doctrine related to the hydration of objects</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>