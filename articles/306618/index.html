<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>World of Warcraft: one line of code to lose everything</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imagine the situation: in the game, a character who introduced himself as a member of one of the popular and famous guilds, comes up to you and promis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>World of Warcraft: one line of code to lose everything</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/557/543/f88/557543f887f24ca49432fbe431077546.png"><br><br>  Imagine the situation: in the game, a character who introduced himself as a member of one of the popular and famous guilds, comes up to you and promises rare cool elements, rare animals (on which you can travel) weapons, etc.  Most likely such a Persian has neither rare elements nor special codes for them.  As a result, the victim does not receive the correct code or any rare item.  The attacker was able to convince the unsuspecting player to enter just one command in the dialog box. <a name="habracut"></a><br><br><pre><code class="lua hljs">/run RemoveExtraSpaces=RunScript</code> </pre> <br>  The WoW interface (for example, the menu bar, the chat window, and other 2D graphic elements) and also add-ons are written in the Lua language.  Both sides of the string are RemoveExtraSpaces and also RunScript are legal functions and are part of the WoW Lua API.  But the introduction of this line of code in the dialog box changes the behavior of the WoW interface. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  What does this team really do? </h4><br>  <code>/run</code> - a command to interpret the following text as a Lua script. <br>  <code>RemoveExtraSpaces</code> is a built-in function that removes unwanted spaces from text. <br>  <code>RunScript</code> is a function that executes text as Lua code (similar to the <code>/run</code> command) <br><br><h4>  Why is this dangerous? </h4><br>  The RemoveExtraSpaces function is called every time a player receives a new message.  The <code>/run</code> command above replaces the <code>RemoveExtraSpaces</code> function with a <code>RemoveExtraSpaces</code> function that originally exists in the software.  After the original function is rewritten, each new chat message is interpreted as Lua code and immediately executed.  The script is as follows. <br><br>  A reckless player enters a maliciously crafted line of code in his dialog box because he was convinced by the words of the attacker.  But instead of receiving rare items, he becomes a victim. <br><br><img src="https://habrastorage.org/files/dea/5bc/4db/dea5bc4dbff84c17a761bee8eafcbd74.png"><br>  <i>Unsuspecting player is about to send a malicious code line.</i> <br><br><img src="https://habrastorage.org/files/ed6/b98/6fd/ed6b986fdce4421ea6dcb65b97cdc203.png"><br>  <i>The attacker sends a chat message to the victim</i> <br><br><img src="https://habrastorage.org/files/700/dcb/74f/700dcb74f56746eba86a6c81e069d1ed.png"><br>  <i>The received message is interpreted as Lua code and then executed.</i> <br><br>  What has been shown above is a fairly harmless example of this vulnerability, proof of concept.  But actually - this means that the attacker can now remotely control the victim's interface.  This is very similar to the behavior of Trojans, who pretend to be something useful and then perform their malicious function.  In the real case, instead of creating messages with the text ‚ÄúTest‚Äù, the attackers launch another script, an example of which will be given below. <br><br><h4>  Temporarily hide and save a command </h4><br>  After the victim has opened the backdoor to his interface, the attacker sends the following message: <br><br><img src="https://habrastorage.org/files/2a1/7ed/75c/2a17ed75c18447b3b676c50bfe8fe65c.png"><br>  <i>The attacker establishes a new data channel</i> <br><br>  In case the command was executed, the message that is shown above will not be visible to the victim, but will be executed immediately.  The fact that the chat feature is no longer working may seem suspicious and the victim may try to restart the game.  The attacker acts quickly enough to solve this problem.  By sending the command shown above, which establishes a new communication channel, they again restore normal chat operation without arousing suspicion. <br><br>  In order to understand the purpose of this command, you need to know that WoW has the ability to communicate using a hidden channel (locally and remotely).  This channel is established through the use of ‚ÄúCHAT_MSG_ADDON‚Äù events. <br><br><img src="https://habrastorage.org/files/033/8a8/abe/0338a8abeaf445908d297015a5457ce9.png"><br><br>  The script creates a frame (line 2) to which you can set various properties.  The script logs CHAT_MSG_ADDON events with a specific prefix (lines 6 and 25).  Only those who know the selected prefix can secretly control the victim's interface.  It's like a password for backdoor. <br><br>  Each time a hijacked interface receives a CHAT_MSG_ADDON event with a secret prefix, the code will run silently and without the knowledge of the victim. <br><br>  Conclusion: until the attacker decides to show you what is happening, you, unfortunately, will not know about it. <br><br>  Even though we are talking about add-ons that can communicate through a covert channel, the victim does not need to have add-ons in order for the attack to succeed. <br><br><h4>  What harm can be done? </h4><br>  Since the attacker will have full access to the victim‚Äôs interface, he can gather complete information about him.  But the burglar will not be able to collect any detailed information about other players.  In WoW, players have the opportunity to share / sell items to each other.  If the attacker knows the location of the victim‚Äôs character and is within reach, he can open the trade window remotely and transfer gold, objects and everything that can be transferred to him.  Virtually rob the victim. <br><br>  The described scenario demonstrates a social attack along with a technical one.  Now a hacker can send a convincing message to friends, colleagues and other players with whom the character communicates with the help of the victim, thereby increasing the number of captured characters. <br><br><h4>  How can you protect yourself? </h4><br>  The answer is simple and obvious: you do not need to enter this kind of command or any other command that will be offered even to you by a long-standing friend. <br><br>  In this example, we talked about the attacking character in the game, who belonged to the popular guild.  But in fact he did not belong to this guild.  He chose a famous guild and copied the name, replacing ‚ÄúL‚Äù with ‚ÄúI‚Äù.  You may already be familiar with this method of phishing attacks. <br><br>  In addition, be careful when downloading add-ons use protected and popular websites, save your add-ons so that they can be replaced at any time.  It is possible that some of these updates may already contain malicious code.  A similar problem was noticed in 2014, when the so-called ‚ÄúElvUI Backdoor‚Äù was discovered in one of the add-ons. <br><br>  The glitch itself can only be fixed by Blizzard.  They must ensure that such a function cannot be rewritten in the future.  Blizzard has already released a pre-release for the upcoming Legion expansion.  In this supplement, they took into account the scenario discussed here and added a warning before sending a message that contains a malicious character. <br><br><img src="https://habrastorage.org/files/790/991/026/79099102677348da80d8fca59b7fb489.png"><br><br>  Selecting ‚ÄúYes‚Äù disables the message permanently, even a restart will not return it - for this reason the issue cannot be considered resolved.  To reactivate this message, you must manually delete one line of code in the config file. <br><br>  Code to be removed: <code>SET AllowDangerousScripts "1"</code> <br>  File: c <code>onfig-cache.wtf</code> <br>  Path: <code>World of Warcraft\WTF\Account\\</code> </div><p>Source: <a href="https://habr.com/ru/post/306618/">https://habr.com/ru/post/306618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306604/index.html">The less the better - about the possibilities of programming languages</a></li>
<li><a href="../306606/index.html">Full Disk Encryption (FDE)</a></li>
<li><a href="../306608/index.html">Yota support service online</a></li>
<li><a href="../306612/index.html">How to mark your TODO, FIXME and ERROR in Xcode</a></li>
<li><a href="../306616/index.html">Terms of Reference for revision: 10 rules and a little tediousness</a></li>
<li><a href="../306622/index.html">Web application vulnerabilities: users hit</a></li>
<li><a href="../306624/index.html">The creators of the film Zero Days shed light on the authors of Stuxnet</a></li>
<li><a href="../306626/index.html">Graphical user interface as a reflection of the real world: the shadows and the rise of elements</a></li>
<li><a href="../306628/index.html">Updated Cisco CCNA Certification Program</a></li>
<li><a href="../306632/index.html">Big Data analytics and supply chain evolution</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>