<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Gamecube - file system device</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, habrovchane! In the last topic, I told you how we and the team produced (and continue to produce) the rhomming of a game like Xenoblade Chronicles...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Gamecube - file system device</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/a27/a1e/55d/a27a1e55d0cb4008ac3d18203b0a2af6.jpg"><br><br>  Hi, habrovchane!  In the last topic, I told you how we and the team produced (and continue to produce) the rhomming of a game like <b>Xenoblade Chronicles</b> on the <b>Nintendo Wii</b> .  I would like to talk about a less simple but interesting topic - the storage system of the file system in the <b>Nintendo GameCube</b> .  It just so happened that I fell in love with this console and could not miss the chance to talk about its technical side, albeit small.  We will not delay, let's start! <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  As is clear from the title of the topic, the discussion will focus on how the <b>Nintendo GameCube</b> file system <b>works</b> , or more precisely, how the disk file system works.  Let's talk about what all of these drives were used on the <b>Nintendo GameCube</b> .  I ask you to leave the house in the garage, sit in <b>DeLorean</b> and go to the beginning of zero.  In the courtyard of 2001, the <b>Sony PlayStation 2</b> has been dominating the gaming console market for a year now and it is <b>Nintendo GameCube</b> .  More powerful stuffing, more potential, but why sales are not as high as those of the <b>PlayStation 2</b> ?  Let us shout ‚ÄúThank you!‚Äù To <i><b>Nintendo</b></i> and their policies from piracy and the monster that they decided to use in their console as a carrier of information - the miniDVD disk itself.  What he was and why he was able to destroy such a potential console, you ask?  And I will answer, he was half the size of a DVD, but the problem was a small amount of 1.5 GB (as opposed to 4.7 GB for a DVD on a <b>PlayStation 2</b> ).  This is purely my personal opinion, but it was this disk that ruined the sales of this console.  We can talk a lot about this, but still we will return to the main topic.  Yes, <i><b>Nintendo</b></i> invented for the <b>GameCube</b> its own 1.5GB disk, which was absolutely not enough for large games, which is why they were divided into several disks (hello 90th).  I had to use a bunch of different compression algorithms, somehow reduce the game, so that they climbed onto the disk.  Okay, enough about the sad, it's time to return to the main topic. <br><br><h2>  Technical component </h2><br>  As I said above, the disk had a volume of 1.5 GB.  With such a volume, it was obviously unprofitable to use the established ISO9660 or its modification.  <i>Nintendo</i> went the other way - they developed their file system description technology, the basis of which was the FST (FileStringTable) block.  This unit is compact and stores all the necessary information about the files, I will tell you more about it, but more on that later. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The whole game image can be divided into 6 blocks: <br><br><ol><li>  Basic Information (boot.bin) </li><li>  Supplement to basic information (bi2.bin) </li><li>  Apploader (apploader.img) </li><li>  FileStringTable (fst.bin) </li><li>  DOL (main.dol) </li><li>  Basic data </li></ol><br>  I propose to consider each block separately.  For example, the first disc of the European version of <b>Resident Evil Code Veronica X</b> (GCDP08) was used. <br><br><h2>  Basic information block boot.bin </h2><br><img src="https://habrastorage.org/web/aac/ac5/7e8/aacac57e8ace40d2bb31bc56c262e5be.png"><br><br>  This block is located at the very beginning of the file and contains information that allows you to identify what kind of disk it is and what to do with it next.  It has a fixed size of 0x440 bytes.  There are bytes, the values ‚Äã‚Äãof which are still not clear to me, but we will not touch them, I will tell only what is more important: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">gcmBoot</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> gameCode; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> makerCode; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> diskID; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> version; <span class="hljs-comment"><span class="hljs-comment">//seek to 0x1C public uint DVDMagicWord; //0xC2339F3D public string gameName; //seek to 0x420 public uint offsetMainDol; public uint offsetFST; public uint sizeFST; }</span></span></code> </pre> <br>  As can be seen from the code above, this block contains the disc code, its number (used when the game contains several discs), the name of the game, the pointer to the DOL block, the pointer and the size to the FST block.  There are other data in this block, but they are used for the debug mode, which is not used in civil mode at all. <br><br><h2>  Supplement to basic information, block bi2.bin </h2><br>  This block, like the last one, has a fixed size, though this time its size is 0x2000 bytes, and it begins strictly after boot.bin (0x440).  I have nothing to say about him, it contains information for debug mode. <br><br><h2>  Apploader </h2><br><img src="https://habrastorage.org/web/a7a/6db/877/a7a6db877f8b4361ba88bcd8859cdd96.png"><br><br>  This block, as the name implies, is responsible for loading the image, parsing the FST, initializing the modules, running the DOL file.  I don‚Äôt have anything to tell about it, as well as about bi2.bin, so go ahead. <br><br><h2>  FileStringTable, fst.bin block </h2><br><img src="https://habrastorage.org/web/907/6b7/74e/9076b774e5414f0bb1dc38136811f0a7.png"><br><br>  So we got to the most interesting, this block contains the markup of all the files in the image: the names of files and folders, their offset and size.  It starts with the address gcmBoot&gt; offsetFST and has the size gcmBoot&gt; sizeFST. <br><br>  Its structure is as follows: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">gcmFST</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> flags; <span class="hljs-comment"><span class="hljs-comment">// 0: File; 1: Dir; public uint offsetName;//Real size 3 byte //if flags = 0 public uint fileOffset; public uint fileSize; //if flags = 1 public uint dirParent; public uint dirNext; }</span></span></code> </pre><br>  I will try to clarify easier: <br><br>  1 byte is used to determine whether the file or folder information is being sent.  The 3 remaining bytes are intended for a pointer to a line with the name of a file or folder (the pointer starts from the beginning of the block with the names of the files \ folders, and not from the beginning of the FST block). <br><br>  If the first byte is 0 (file), then the next 8 bytes means: <br><br><ol><li>  4 bytes - a pointer to the file in the image </li><li>  4 bytes - file size </li></ol><br>  If the first byte is 1 (folder), then the next 8 bytes means: <br><br><ol><li>  4 bytes - the folder number in which this folder is located </li><li>  4 bytes - the number of the element on which the elements in this folder end </li></ol><br>  With files, everything is simple and clear, but not with folders.  But, I'm here to explain everything to you.  For example, the folder is in the root of the disk, has the name habr, dirParent is 0 (because at the root of the disk), but dirNext has the value 6. The folder itself is 3 elements in the FST block, therefore, all subsequent elements are exactly 6 the item will be in the habr folder, that is, item 4 and 5. <br><br>  The most important thing I forgot to say, so the 0 block (that is, the first one) is a link to the disk root, it does not have a name in the block with the names of the elements, although it does have a pointer.  It just needs to be considered and nothing more. <br><br>  As you can see, thanks to this structure, it has a very small size (when compared with ISO9660 and its modifications). <br><br><h2>  Dol </h2><br><img src="https://habrastorage.org/web/497/0dc/191/4970dc1918d347199550bdd0fe98d813.png"><br><br>  As they say, the heart of the game.  Like <b>Windows</b> - EXE, and <b>GameCube</b> - DOL.  Block with the main executable file.  Of course, there were games where a different executable file was used, stored with the main game files, but, more often, no one was perverted like that, thank God. <br><br>  Well, can you talk about it?  A simple executable file divided into sections: <br><br><ol><li>  Seven TEXT sections (code) </li><li>  Eleven DATA sections (data) </li></ol><br><h2>  Basic data </h2><br>  And the last block, which tells its essence by name.  This block goes to the end of the file and contains all files aligned to 2048 bytes.  There is a legend that to save space, you can align these files not by 2,048 bytes, but by 4 bytes.  And it will even work, on the emulator so accurately.  But to kill the laser in this way you just will not be difficult. <br><br><h2>  Conclusion </h2><br>  In this topic, I tried to reveal how <i><b>Nintendo</b></i> sent everyone far away and developed a simple, but still interesting and compact file system.  Of course, it is not suitable for use on home <b>PCs</b> because of its file storage features.  This file system does not store any flags except for File \ Dir, does not store the file creation time, EDC \ ECC of each sector, etc., which is contained in ISO9660.  But she is not needed here.  <i><b>Nintendo has</b></i> developed such a compact file system to provide more space for game data.  After all, why should a disk with a gaming system keep the time of file creation, etc.? <br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/334042/">https://habr.com/ru/post/334042/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334028/index.html">GHC 8.2 released</a></li>
<li><a href="../334030/index.html">Is an asynchronous processor possible?</a></li>
<li><a href="../334032/index.html">Experience of using business notebook FUJITSU LIFEBOOK E746: home instead of office, Linux instead of Windows</a></li>
<li><a href="../334034/index.html">Testing in Badoo ‚Äúfrom the height of bird flight‚Äù</a></li>
<li><a href="../334038/index.html">Configure push notifications for your service</a></li>
<li><a href="../334044/index.html">Comparison of Russian cloud service operators</a></li>
<li><a href="../334046/index.html">How to teach your neural network to generate poems</a></li>
<li><a href="../334048/index.html">Selenium: for apple lovers</a></li>
<li><a href="../334050/index.html">How do we in 1C: Enterprise work with data models (or ‚ÄúWhy do we not work with tables?‚Äù)</a></li>
<li><a href="../334052/index.html">1.Check Point to the maximum. The human factor in information security</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>