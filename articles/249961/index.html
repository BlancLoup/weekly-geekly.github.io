<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flickr API in Android App. Authorization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, habra people! 

 I want to share with you a little experience of using the Flickr API in Android applications and tell you about the authorization...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Flickr API in Android App. Authorization</h1><div class="post__text post__text-html js-mediator-article">  Hi, habra people! <br><br>  I want to share with you a little experience of using the Flickr API in Android applications and tell you about the authorization of the Flickr user.  Which in the future can be used for example to display a list of albums and images. <br><a name="habracut"></a><br><h4>  Application registration </h4><br>  First of all, we need to get an API Key, we will use applications not for commercial purposes, for registration we follow the link <a href="https://www.flickr.com/services/apps/create/noncommercial/%3F">Create an App</a> . <br><br><img src="https://habrastorage.org/files/ad4/d77/7ae/ad4d777aed3e4e59a0629c6306a4e12a.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We are asked to enter ‚ÄúName‚Äù, ‚ÄúPurpose‚Äù and ‚ÄúRights Agreements‚Äù, we send our data and as a result we get API Key and API Secret.  We need them in the future to form a request to the server. <br><br><img src="https://habrastorage.org/files/52f/499/9dd/52f4999dd727413fbfc854abfcff8d0f.jpg"><br><br>  After that we need to edit some data, in the same window we go to <a href="https://www.flickr.com/services/apps/72157650173683580/auth">Edit auth flow for this app</a> . <br><br><img src="https://habrastorage.org/files/a86/160/4b5/a861604b5dd0473bb9bcad1d69cd5ac9.jpg"><br><br>  Descriptions and logo are not interesting to us, you can enter at will.  In the Callback URL field, we definitely need to specify a callback address, which we will use to return to our Activity.  In my case, I ask <b>appforflickr: // callback</b> .  In <i>&lt;intent-filter&gt;</i> this will look like this: <br><pre><code class="xml hljs">... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:scheme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"appforflickr"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:host</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"callback"</span></span></span><span class="hljs-tag">/&gt;</span></span> ...</code> </pre>  App Type - select the Web Application and Save the changes. <br><br>  Next, go directly to the construction of the application itself. <br><br>  In the application manifest, we add <i>‚Äúandroid.permission.INTERNET‚Äù</i> and the <i>&lt;intent-filter&gt;</i> block as a result we get: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"test.testflickrapi"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.INTERNET"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:allowBackup</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/ic_launcher"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/app_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/AppTheme"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".ui.activities.MainActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/app_name"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.MAIN"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.LAUNCHER"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.VIEW"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.DEFAULT"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.BROWSABLE"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:scheme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"appforflickr"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:host</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"callback"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h4>  Creating a link to authorize the user </h4><br>  To authorize users in the application, we will launch the Activity from the WebView.  But first, we will create the login address.  The template looks like this: <pre> <code class="html hljs xml">http://flickr.com/services/auth/?api_key=[api_key]&amp;perms=[perms]&amp;api_sig=[api_sig]</code> </pre>  [api_key] is our key obtained when registering the application.  [perms] - account access level, can have the following values: <br><ul><li>  read - permissions to read personal information </li><li>  write - permissions to add and edit photos and information (includes 'read') </li><li>  delete - permissions to delete photos (includes 'read' and 'write') </li></ul><br>  [api_sig] - the signature, it includes the <i>Secret</i> obtained when registering the application and the list of arguments in alphabetical order, name and value. <br>  In our case, the API Key: <i>5744fadec815a7e8142d03901065c97b</i> , API Secret: <i>8b2c12e80b67970b</i> , <i>write</i> access rights, the signature is a string of: <pre> <code class="html hljs xml">secret + 'api_key' + [api_key] + 'perms' + [perms]</code> </pre>  , that is, we have: <i>8b2c12e80b67970bapi_key5744fadec815a7e8142d03901065c97bpermswrite</i> and now we need to encrypt this string in MD5.  To do this, use the following method: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">md5SumOfString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String s)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { MessageDigest digest = java.security.MessageDigest.getInstance(<span class="hljs-string"><span class="hljs-string">"MD5"</span></span>); digest.update(s.getBytes()); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> messageDigest[] = digest.digest(); StringBuffer hexString = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; messageDigest.length; i++) hexString.append(Integer.toHexString(<span class="hljs-number"><span class="hljs-number">0xFF</span></span> &amp; messageDigest[i])); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hexString.toString(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (NoSuchAlgorithmException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; }</code> </pre><br>  and get the values ‚Äã‚Äã[api_sig]. <br><br>  As a result, the address for user authorization will be as follows: <br><br><pre> <code class="html hljs xml">http://www.flickr.com/services/auth/?api_key=9a0554259914a86fb9e7eb014e4e5d52&amp;perms=write&amp;api_sig=b8d7c1ae026d5f86f1f44944f5257f3</code> </pre>  Add to onCreate () <pre> <code class="java hljs">startActivity(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(Intent.ACTION_VIEW, Uri.parse(url)));</code> </pre>  where url is the above address.  After launching the application, we open a web page to specify a username and password.  If the entered data is correct, the <i>Callback URL</i> will automatically redirect us to our application.  The <i>frob</i> parameter of the values ‚Äã‚Äãis added to the url, that is, in our case it looks like this: <br><br><pre> <code class="html hljs xml">appforflickr://callback?frob=72157650137623777-b09eae52121bf8ad-130818926</code> </pre>  <i>Frob is</i> needed to get <i>Access token</i> . <br>  Add conditions to onCreate () to get a <i>frob:</i> <br><br><pre> <code class="java hljs">Uri uri = getIntent().getData(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uri != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { String frob = uri.getQueryParameter(<span class="hljs-string"><span class="hljs-string">"frob"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> startActivity(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(Intent.ACTION_VIEW, Uri.parse(url)));</code> </pre><br>  After processing, we call the <a href="https://www.flickr.com/services/api/flickr.auth.getToken.html">flickr.auth.getToken</a> method from the <a href="https://www.flickr.com/services/api/">API</a> to get the <i>token</i> and <i>nsid</i> , which will be needed for further requests, as well as the <i>username</i> and <i>fullname of the</i> user. <br><br>  To send requests, create a class HttpRequest: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpRequest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsyncTask</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String TAG = HttpRequest.class.getSimpleName(); <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPreExecute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Log.d(TAG, <span class="hljs-string"><span class="hljs-string">"START"</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInBackground</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String... params)</span></span></span><span class="hljs-function"> </span></span>{ String result = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String uri = params[<span class="hljs-number"><span class="hljs-number">0</span></span>]; HttpGet httpGet = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpGet(uri); HttpResponse response = HttpClientHelper.getHttpClient().execute(httpGet); HttpEntity entity = response.getEntity(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { InputStream inStream = entity.getContent(); result = InputStreamConverter.convertStreamToString(inStream); inStream.close(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IllegalStateException e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ClientProtocolException e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPostExecute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String result)</span></span></span><span class="hljs-function"> </span></span>{ Log.d(TAG, <span class="hljs-string"><span class="hljs-string">"STOP"</span></span>); } }</code> </pre><br><br>  Class HttpClientHelper to get the HttpClient: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpClientHelper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> HttpClient httpClient = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> REGISTRATION_TIMEOUT = <span class="hljs-number"><span class="hljs-number">30</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> WAIT_TIMEOUT = <span class="hljs-number"><span class="hljs-number">30</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HttpClientHelper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> HttpClient </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHttpClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (httpClient == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { HttpParams params = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicHttpParams(); HttpProtocolParams.setVersion(params, HttpVersion.HTTP_1_1); HttpProtocolParams.setContentCharset(params, HTTP.DEFAULT_CONTENT_CHARSET); HttpProtocolParams.setUseExpectContinue(params, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); ConnManagerParams.setTimeout(params, WAIT_TIMEOUT); HttpConnectionParams.setConnectionTimeout(params, REGISTRATION_TIMEOUT); HttpConnectionParams.setSoTimeout(params, WAIT_TIMEOUT); SchemeRegistry schemeReg = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemeRegistry(); schemeReg.register(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Scheme(<span class="hljs-string"><span class="hljs-string">"http"</span></span>, PlainSocketFactory.getSocketFactory(), <span class="hljs-number"><span class="hljs-number">80</span></span>)); schemeReg.register(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Scheme(<span class="hljs-string"><span class="hljs-string">"https"</span></span>, SSLSocketFactory.getSocketFactory(), <span class="hljs-number"><span class="hljs-number">443</span></span>)); ClientConnectionManager connectionMgr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ThreadSafeClientConnManager(params, schemeReg); httpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultHttpClient(connectionMgr, params); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> httpClient; } }</code> </pre><br><br>  Class InputStreamConverter to convert an InputStream to String: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputStreamConverter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InputStreamConverter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertStreamToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InputStream inputStream)</span></span></span><span class="hljs-function"> </span></span>{ BufferedReader reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BufferedReader(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader( inputStream)); StringBuilder builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); String line = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((line = reader.readLine()) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { builder.append(line + <span class="hljs-string"><span class="hljs-string">"\n"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { inputStream.close(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { e.printStackTrace(); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> builder.toString(); } }</code> </pre><br><br>  Address to get token: <br><br><pre> <code class="html hljs xml">https://api.flickr.com/services/rest/?method=flickr.auth.getToken&amp;api_key=9a0554259914a86fb9e7eb014e4e5d52&amp;frob=72157650137623777-b09eae52121bf8ad-130818926&amp;format=json&amp;nojsoncallback=1&amp;perms=write&amp;api_sig=8fd09b55f670ec9a4ba07c076e520ae8</code> </pre>  so that the answer comes in the form of json, we added parameters from the values <i>format = json</i> and <i>nojsoncallback = 1</i> <br><br>  We make another change to onCreate () to send the request: <br><br><pre> <code class="java hljs">Uri uri = getIntent().getData(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uri != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { String frob = uri.getQueryParameter(<span class="hljs-string"><span class="hljs-string">"frob"</span></span>); String url = <span class="hljs-string"><span class="hljs-string">"..."</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      token String response = ""; HttpRequest httpRequest = new HttpRequest(this); httpRequest.execute(url); try { response = httpRequest.get(); } catch (InterruptedException | ExecutionException e) { e.printStackTrace(); } } else startActivity(new Intent(Intent.ACTION_VIEW, Uri.parse(url)));</span></span></code> </pre><br><br>  Further, the answer is: <pre> <code class="xml hljs">{"auth":{"token":{"_content":"12134650097774510-014feda8303a4a64"},"perms":{"_content":"write"},"user":{"nsid":"230211065@N05","username":"user","fullname":"User Alex"}},"stat":"ok"}</code> </pre>  you can get the desired <b>token</b> and <b>nsid</b> using libraries like <a href="https://code.google.com/p/google-gson/">gson</a> or <a href="http://jackson.codehaus.org/">jackson</a> is already an amateur. <br><br>  I hope my article will be useful to someone. <br><br>  Ps.  This is my first post on Habr√©, so sorry for the few words and do not judge strictly. </div><p>Source: <a href="https://habr.com/ru/post/249961/">https://habr.com/ru/post/249961/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249951/index.html">TheRole 3. Authorization for Ruby on Rails</a></li>
<li><a href="../249953/index.html">Freeloot: is freelance free?</a></li>
<li><a href="../249955/index.html">Survey online courses in mathematics</a></li>
<li><a href="../249957/index.html">HTTP / 2 (h2-14, spdy4) in Google Chrome 40</a></li>
<li><a href="../249959/index.html">Snapshot Hunter Snapshot Detector - Veeam Backup & Replication v8 integrated functionality</a></li>
<li><a href="../249963/index.html">Writing a cross-platform library in Python</a></li>
<li><a href="../249965/index.html">Unreal Engine 4 for the development of their abilities</a></li>
<li><a href="../249967/index.html">How to recover incorrectly exposed fyuzy in ATtiny</a></li>
<li><a href="../249969/index.html">JavaScript bulletproof tests</a></li>
<li><a href="../249971/index.html">Restoring hours "Electronics 7"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>