<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating ASP.NET AJAX control with the ability to communicate with the server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr! 

 I want to share my experience solving the problem, the answer to which I am difficult to find on the Internet (Russian-speaking - for ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating ASP.NET AJAX control with the ability to communicate with the server</h1><div class="post__text post__text-html js-mediator-article">  Hello, Habr! <br><br>  I want to share my experience solving the problem, the answer to which I am difficult to find on the Internet (Russian-speaking - for sure). <br><br>  I recently met with the fact that I was instructed to write ASP.NET AJAX control server side.  This is such a control that is available when editing an ASP.NET page in a designer (toolbox), part of its logic is on the server, and part is on the client, the interaction occurs ayaksovo.  The essence of my control is a simple ComboBox, which would receive data <u>dynamically</u> from the server (it is assumed that there is so much data that you can‚Äôt download them all at once), and also filter the list based on the characters entered in the text field.  This is almost implemented in the AJAX Control Toolkit, only the list is loaded there entirely. <br>  There are quite a few different articles and blogs on the Internet about creating their own controls, however, oddly enough, they are all limited to simple examples in which there is no description of the mechanism of interaction between the client and server.  Most sources quote from standard microsoftov textbooks, where the ajax is that when you hover the mouse over the button, it changes its picture (det. Garden).  I also needed the data from the list that was stored on the server to be added to the list on the client (it could just be a list, some ORM and in general everything that happens to be IEnumerable). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Just want to say that here you will not find a manual for creating your own control from scratch, the benefit of this part of the documentation is <a title="ASP.NET AJAX Control" href="http://tinyurl.com/ASP-NET-AJAX-development">enough</a> .  I will describe how to make sure that the client part and its server half can freely exchange information in asynchronous mode. <br><a name="habracut"></a><br>  Go to the point.  In order for a client to asynchronously request data from a server, there are several ways in ASP.NET.  The most convenient of them is interaction through a web-service.  This approach allows you to transfer data back and forth in any convenient form for you, from the line to the full-fledged objects (including composite ones).  ASP.NET does all the serialization for you.  However, with all its attractiveness, such an approach could not be applied to my task, since it required control with all the ‚Äúout of the box‚Äù functionality.  That is, added it to the page, indicated the source of the data, and that‚Äôs all - he will do the rest for you.  The Web service cannot be included in the component assembly, and accordingly, on subsequent pages that use it.  To do this, programmers-users of my control would need to add an extra service, which they could well do without. <br><br>  The second method is the implementation of the <em>ICallbackEventHandler</em> interface.  This interface is used to indicate that the control implementing it can be the target of a client-side callback event (MSDN).  This interface provides two methods: <em>RaiseCallbackEvent</em> , which accepts event data from the browser in a string parameter, and <em>GetCallbackResult</em> , which is responsible for returning the result back. <br>  This approach was the most acceptable for me, since the functionality of ajax will always be under control, no matter where it is.  I will give the code of the server and client sides to clarify the situation. <br><br>  Server part: <br><blockquote><ol><li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); else <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></font></code> </li> <li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } <font color="#0000ff">#endregion</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#0000ff"><font color="#0000ff">#region</font> ICallbackEventHandler implementation <font color="#0000ff">public</font> <font color="#0000ff">void</font> RaiseCallbackEvent( <font color="#0000ff">string</font> eventArg) { m_callbackEventArg = eventArg; } <font color="#0000ff">public</font> <font color="#0000ff">string</font> GetCallbackResult() { <font color="#0000ff">string</font> result = <font color="#A31515">""</font> ; <font color="#0000ff">if</font> (DataSource != <font color="#0000ff">null</font> ) <font color="#0000ff">foreach</font> ( <font color="#0000ff">object</font> o <font color="#0000ff">in</font> DataSource) { <font color="#0000ff">string</font> item = o.ToString(); <font color="#0000ff">if</font> (item.StartsWith(m_callbackEventArg)) result += item + <font color="#A31515">"||"</font> ; } <font color="#0000ff">if</font> (result.Length &gt; 2) <font color="#0000ff">return</font> result.Substring(0, result.Length - 2); <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; } #endregion</font></font></code> </li> </ol></blockquote><br>  The <em>RaiseCallbackEvent</em> method only remembers the string that came from the client.  It stores the text that the user entered on the site in the input field of our control.  This value will filter the results of the sample. <br>  The <em>GetCallbackResult</em> method <em>is</em> endowed with a bit more logic.  Here there is an element-by-step list traversal (stored in the DataSource), each line in it is compared with the filter value, and if all is well, it is entered into the result.  Yes, it is worth noting that the disadvantage of this approach is that both the query and the result must be a string.  That is, it is our concern how to serialize data.  In my case, it was enough to separate the different strings with the substring ||, however, for more serious projects, we will have to be somewhat confused. <br><br>  Now let's take a look at the client code: <br><blockquote><ol><li>  _populateListBegin: <font color="#0000ff">function</font> () { </li><li>  <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> .get_loadDynamically () == <font color="#0000ff">false</font> ) { </li><li>  <font color="#0000ff">this</font> ._filterList ( <font color="#0000ff">this</font> ._textFilter); </li><li>  <font color="#0000ff">this</font> ._displayList (); </li><li>  } </li><li>  <font color="#0000ff">else</font> { </li><li>  WebForm_DoCallback ( <font color="#0000ff">this</font> .get_element (). Id, <font color="#0000ff">this</font> ._textFilter, <font color="#0000ff">this</font> ._onPopulateListComplete, <font color="#0000ff">this</font> .get_element (). Id, <font color="#0000ff">null</font> , <font color="#0000ff">true</font> ); </li><li>  } </li><li>  }, </li><li></li><li>  _onPopulateListComplete: <font color="#0000ff">function</font> (result, context) { </li><li>  <font color="#0000ff">var</font> rscb = $ find (context); </li><li>  rscb._processCallbackResult (result); </li><li>  } </li></ol></blockquote><br>  This code is part of the prototype of a list object implemented in JavaScript on the client.  The first function is called when the user clicks on the "expand" list (event registration and button code is omitted, as it relates to another topic).  An interesting point for us is the call to the <em>WebForm_DoCallback</em> function, which starts the process of accessing the server side.  As parameters, it takes the ID of the object that caused the callback request, the request parameter (string), the delegate to the response handler function, the context that can be used when processing the response, the delegate to the error handler function (we do not need it here simplicity control), and a boolean parameter, meaning asynchronous or not sending.  Actually this is all the magic of ajax request. <br>  The <em>_onPopulateListComplete</em> function will be called when a response is received from the server.  It should be noted that it is not executed in the context of the object, so the call to this can give an incorrect result.  That is why I passed in the context of the object id. <br><br>  Here are all the little things that need to be done when implementing a server control with a full AJAX exchange.  Do not hit hard, this is my first post.  If there are any questions on the content (I am sure they will), I will answer in the comments with pleasure. </div><p>Source: <a href="https://habr.com/ru/post/83196/">https://habr.com/ru/post/83196/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../83190/index.html">ASP.NET MVC 2: second release candidate released</a></li>
<li><a href="../83191/index.html">The qualities of a successful entrepreneur - Practical grip (2/11)</a></li>
<li><a href="../83192/index.html">New entertainment?</a></li>
<li><a href="../83194/index.html">Network configuration in an educational institution</a></li>
<li><a href="../83195/index.html">LG is preparing to release a netbook with 3G support</a></li>
<li><a href="../83197/index.html">The results of the ACM ICPC 2010 World Championship finals</a></li>
<li><a href="../83200/index.html">Space Robot Robonaut 2</a></li>
<li><a href="../83202/index.html">Blocking DNS DDoS with fail2ban</a></li>
<li><a href="../83203/index.html">Won "nyashka"</a></li>
<li><a href="../83204/index.html">Unimaginable nature of nature</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>