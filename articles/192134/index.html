<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We get the source code VM / 370</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear Khabarchans! 
 Almost a week ago, I wrote my first post about VM / 370. The first comment to him was a perfectly fair remark : 
 Fun, of c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We get the source code VM / 370</h1><div class="post__text post__text-html js-mediator-article">  Hello, dear Khabarchans! <br>  Almost a week ago, I wrote <a href="http://habrahabr.ru/post/191602/">my first post</a> about VM / 370.  The first comment to him was a <a href="http://habrahabr.ru/post/191602/">perfectly fair remark</a> : <br><blockquote>  Fun, of course, but the "canvas" consists mainly of the findings of commands.  To be honest, it is much more interesting to read not only about the installation of the system itself, but also about its ‚Äúguts‚Äù, like, what, and why. <br>  Investigate the source code of VM / 370, for example. </blockquote><br>  Yes, indeed, the installation tutorial, to put it mildly, an outdated OS, is interesting only in general cognitive terms as a demonstration of its capabilities.  But the description of the principles of working with quotes from source is another matter.  Moreover, the source code is available.  The only problem is that such a description is a serious matter. <br>  VM / 370 operating principles are described in <a href="http://bitsavers.informatik.uni-stuttgart.de/pdf/ibm/370/VM_370/plm/">this three-volume edition</a> .  The source code itself is relatively small, ‚Äúonly‚Äù two hundred thousand lines in assembler ‚Äî CP and about the same number ‚Äî CMS.  But the work is still to be capital. <br>  In this article, I don‚Äôt set myself the task of even starting a cycle on VM / 370 internals.  I‚Äôll just explain how I extracted the VM / 370 source code in a readable format.  In the process of extracting, I learned something interesting about working with VM / 370. <br><a name="habracut"></a><br><br><h4>  Unpacking the tape in the CMS </h4><br>  The volume of the tape source is about thirty megabytes.  Being absolutely sure that the files are stored on tape in uncompressed form, I simply divided this volume by the capacity of the cylinder 3330 and calculated that I would need 130 cylinders to save all the sources.  Then it certainly turned out to be wrong (apparently, some kind of compression does occur, the size of the printouts is about 40 megabytes), but fortunately the tape consisted of several volumes, and I just printed them one by one. <br>  So, add to the directory, in the description of the user MAINT, the line: <br><pre><code class="bash hljs">MDISK 192 3330 200 130 CPR6L0 WR READ * SOURCES</code> </pre> <br>  Note: I did the whole process under the user maint.  Generally speaking, this is a malicious violation of the ‚Äúdo not work under the root‚Äù rule and cannot be done this way. <br>  Let's start VM, we will log in as MAINT, we will launch CMS.  We introduce punch cards with the catalog description and update it with the ‚ÄúDIRECT MYVM‚Äù command.  Log in (for account changes to take effect).  We connect the disk 192 (using the ‚Äúaccess 192 b‚Äù command) and the source tape.  Load the first archive volume (CP source) with the command ‚ÄúVMFPLC2 LOAD * * B‚Äù. <br><br><h4>  Printout </h4><br>  For a long time I could not find a way to print several files with one command.  The fact is that the PRINT and PUNCH commands swear at asterisks in the file name.  And I did not want to print five hundred pieces of files manually.  In the end, I decided that it would be easiest to write a printout program in assembler, but rummaging through the assembler manuals found an easier way. <br>  The LISTFILE command (an analogue of DIR / ls) has an option (EXEC. If you run LISTFILE with this option, LISTFILE will create a file (EXEC files are analogous to bat / sh), with lines like &amp; 1 &amp; 2. &amp; 1 &amp; 2 are the script parameters. <br>  Now attention!  When you run the CMS PUNCH command, in each line of the CMS EXEC file, instead of &amp; 1, PUNCH will be substituted and then the line will be executed.  In my opinion, this is the best solution for IBM‚Äôs user interface engineers (albeit unnecessary on Linux with awk). <br>  I experimented with various printouts and decided that PUNCH is better than PRINT. <br>  Note: Hercules punch card output is set to EBCDIC format.  To get a readable code, you need to reconfigure it to ASCII with the command "ATTACH D ./sources/DMK.txt ascii". <br>  So, create a list of files: <br><pre> <code class="bash hljs">L * * B (EXEC</code> </pre><br>  And we derive them: <br><pre> <code class="bash hljs">CMS PUNCH ...  .</code> </pre><br>  Already when it was all over, I realized that it made sense to add the first line &amp; CONTROL OFF (analog echo off) to the CMS EXEC.  Yes, I didn't catch VM / 370, but even elementary MS-DOS. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  File sharing </h4><br>  As a result of previous manipulations, I received a DMK.txt file with the sources glued together.  Now they need to be separated.  To do this, I applied this awk script: <br><pre> <code class="bash hljs">/^MAINT MAINT MAINT MMMM AAAA IIII NNNN TTTT$/ {next} /^USERID/ {next} <span class="hljs-variable"><span class="hljs-variable">$1</span></span>==<span class="hljs-string"><span class="hljs-string">":READ"</span></span>{ MYFILE=<span class="hljs-string"><span class="hljs-string">"./DMK/"</span></span><span class="hljs-variable"><span class="hljs-variable">$2</span></span> <span class="hljs-string"><span class="hljs-string">"_"</span></span> <span class="hljs-variable"><span class="hljs-variable">$3</span></span> next } { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span> <span class="hljs-variable"><span class="hljs-variable">$0</span></span> &gt; MYFILE }</code> </pre><br>  I apologize for the g-code, it was written on the knee and not for the purpose of readability / efficiency. <br><br>  Now, in the same way, you can display the source code of CMS (conditional DMS code), RSCS (conditional DMT code, name Remote Spooling Communication Subsystem confuses a little, but this is in some sense an analogue of fido) and IPCS (conditional DMM code, system tests). <br><br><h4>  Links </h4><br><ul><li>  <a href="http://gfile.ru/a1Qtf/">Sources (glued)</a> . </li><li>  <a href="http://gfile.ru/a1Yh7">The final product</a> . </li><li>  <a href="http://bitsavers.informatik.uni-stuttgart.de/pdf/ibm/370/princOps/GA22-7000-10_370_Principles_of_Operation_Sep87.pdf">Principles of operation of the System / 370 machine</a> . </li></ul></div><p>Source: <a href="https://habr.com/ru/post/192134/">https://habr.com/ru/post/192134/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192122/index.html">Typical vulnerabilities on sites with statistics</a></li>
<li><a href="../192124/index.html">String interpolation. Fairy Tale</a></li>
<li><a href="../192126/index.html">OS / 2 Death: Killing or Self-Shot?</a></li>
<li><a href="../192128/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ72 (August 24 - 31, 2013)</a></li>
<li><a href="../192130/index.html">foreach</a></li>
<li><a href="../192136/index.html">Building a provider network on Cisco switches using Option 82 and Dynamic ARP Inspection</a></li>
<li><a href="../192140/index.html">Undocumented features of undocumented features: Transfer ref to another stream</a></li>
<li><a href="../192144/index.html">CLR Exception Filters</a></li>
<li><a href="../192146/index.html">Copy works in the public domain? National Indian hut to help you</a></li>
<li><a href="../192150/index.html">Installation Guide and Guide for Web Deploy in Windows Server 2008 R2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>