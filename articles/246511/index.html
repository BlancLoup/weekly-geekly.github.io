<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MultiCAD.NET: calculation of the total length of the segments in the drawing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A question often comes to us in tech support: ‚ÄúHow to calculate the sum of the lengths of segments (pipeline sections, elements of electrical circuits...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MultiCAD.NET: calculation of the total length of the segments in the drawing</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/686/379/734/6863797343d547c9832314d6d8c4b90f.jpg"><br><br>  A question often comes to us in tech support: ‚ÄúHow to calculate the sum of the lengths of segments (pipeline sections, elements of electrical circuits, etc.) in a drawing?‚Äù.  There are plenty of ways to solve this problem, in today's publication we will look at the application implementation on the MultiCAD.NET API, the summing length, which works in nanoCAD, AutoCAD and ZWCAD.  As an example, we will take the task of determining the total length of pipes in the water supply scheme and consider two options for choosing the elements to be counted: user-defined and according to the created filter. <a name="habracut"></a><br><br><h1>  Determining the sum of user-selected line lengths </h1><br>  Before proceeding to determine the length of the segment, it is necessary to determine what is a segment in MultiCAD.NET.  The segment is a standard primitive along with a circle, text, spline, etc. To represent a segment in a drawing database, use the <code>DbLine</code> class from the namespace of all the primitives <code>Multicad.DatabaseServices.StandardObjects</code> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <code>DbLine</code> objects as properties contain a start and end point, but do not contain information about the length of the segment.  Of course, the coordinates of the points of the segment are enough to calculate its length, but it will be more convenient to use its geometric representation ‚Äî an object of the class <code>LineSeg3d</code> (accessed by the <code>DbLine.Line</code> property) and its <code>Length</code> property to get the length: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> length = line.Line.Length;</code> </pre><br>  So, we will consider the first version of the application, when the user is asked to independently select segments for calculating the total length value.  To implement custom object selection, the <code>SelectObjects</code> method of the <code>SelectObjects</code> object manager class will be used: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> McObjectId[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SelectObjects</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sPromt</span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  The method displays a tooltip in the console and allows the user to select objects himself, the IDs of the selected objects are written into an array.  Then the array elements are recognized, and for objects that are segments, we obtain the length and increment the result.  General view of the command that implements this procedure: <br><br><pre> <code class="cs hljs">CommandMethod(<span class="hljs-string"><span class="hljs-string">"LineLengthSum"</span></span>, CommandFlags.NoCheck | CommandFlags.NoPrefix)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LineLengthSum</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//      McObjectId[] idSelecteds = McObjectManager.SelectObjects("   "); if (idSelecteds.Length == 0) { MessageBox.Show("  "); return; } double lengthSum = 0; foreach (McObjectId currID in idSelecteds) { //    ID McObject currObj = currID.GetObject(); //    if (currObj is DbLine) { lengthSum += (currObj as DbLine).Line.Length; } } MessageBox.Show(lengthSum.ToString(), "   :", MessageBoxButtons.OK, MessageBoxIcon.Information); }</span></span></code> </pre><br>  In addition to the straight line segments in the drawings, polylines are used, which are a combination of segments and / or arc elements.  You can get the length of a polyline in the same way, using the geometric representation of the primitive - the <code>Polyline3d</code> class through the <code>Polyline</code> property: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> length = polyline.Polyline.Length;</code> </pre><br><h1>  Automatic calculation of the total length of lines </h1><br>  In practice, when a drawing contains a large number of elements and you want to eliminate user input errors, objects can be selected automatically using an object filter.  When creating a filter, the necessary criteria are specified: the selection area of ‚Äã‚Äãthe objects (sheets, layers, documents, area, etc.) and the types of objects. <br>  For example, in order to select all the lines on a specific layer, a filter with the name of the layer is used: <br><br><pre> <code class="cs hljs">ObjectFilter filter = ObjectFilter.Create(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); filter.AddLayer(<span class="hljs-string"><span class="hljs-string">" "</span></span>); filter.AddType(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(DbLine)); List&lt;McObjectId&gt; ids = filter.GetObjects();</code> </pre><br>  The most common practice in practice is the application of the automatic calculation of the total length of lines - the formation of a report on the type of pipes in the water supply scheme. <br><br><img src="https://habrastorage.org/files/f03/1d6/df0/f031d6df0fe94e0f992509794fd90f53.png"><br><br>  In our example, the pipeline scheme is organized in such a way that the pipes of each type are located on separate layers: ‚ÄúContour 1‚Äù and ‚ÄúContour 2‚Äù. <br>  The following command forms a text report with an indication of all types of pipes located on separate layers and their total length. <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">CommandMethod(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"createReport"</span></span></span><span class="hljs-meta">, CommandFlags.NoCheck | CommandFlags.NoPrefix)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createReport</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { List&lt;String&gt; reportStrings = getLengthSumByLayer(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reportStrings.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { MessageBox.Show(<span class="hljs-string"><span class="hljs-string">"      "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//      int indent = 0; //   DbText caption = new DbText(); caption.Text = new TextGeom("   ", new Point3d(0, indent, 0), Vector3d.XAxis, "Standard", 10); caption.DbEntity.AddToCurrentDocument(); foreach (String str in reportStrings) { indent -= 10; DbText reportText = new DbText(); reportText.Text = new TextGeom(str, new Point3d(0, indent, 0), Vector3d.XAxis, "Standard", 6); reportText.DbEntity.AddToCurrentDocument(); } }</span></span></code> </pre><br>  The calculation of the total length and filling in the rows of the report is done in the <code>getLengthSumByLayer()</code> method, the code of which is presented below: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLengthSumByLayer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { List&lt;String&gt; reportStrings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;String&gt;(); <span class="hljs-comment"><span class="hljs-comment">//      List&lt;string&gt; layers = McObjectManager.CurrentStyle.GetLayers(); foreach (string layerName in layers) { ObjectFilter filter = ObjectFilter.Create(true).AddType(typeof(DbLine)).AddType(typeof(DbPolyline)).AddLayer(layerName); List&lt;McObjectId&gt; idSelected = filter.GetObjects(); if (idSelected.Count != 0) { double lengthSum = 0; foreach (McObjectId currID in idSelected) { //    ID McObject currObj = currID.GetObject(); //    if (currObj is DbLine) { lengthSum += (currObj as DbLine).Line.Length; } else if (currObj is DbPolyline) { lengthSum += (currObj as DbPolyline).Polyline.Length; } } //         ,      if (lengthSum != 0) { reportStrings.Add(layerName.ToString() + ": " + lengthSum.ToString()); } } } return reportStrings; }</span></span></code> </pre><br><br>  After this command is executed, a report will be added to the drawing: <br><br><img src="https://habrastorage.org/files/e76/a0a/184/e76a0a184ffc4420a65d1076159206ba.jpg"><br><br>  A detailed procedure for downloading MultiCAD.NET applications can be found in our article <a href="http://habrahabr.ru/company/nanosoft/blog/242497/">Step-by-step overview: a single MultiCAD.NET application in nanoCAD, AutoCAD, ZWCAD</a> . <br><br>  You can also discuss the article on our <a href="http://forum.nanocad.ru/index.php%3Fshowtopic%3D6556">forum</a> . <br>  Translation of the article into English: <a href="http://developer.nanocad.com/blog/2015/02/12/multicad-net-calculating-the-total-length-of-lines/">MultiCAD.NET: Calculating the total length of lines</a> . </div><p>Source: <a href="https://habr.com/ru/post/246511/">https://habr.com/ru/post/246511/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246497/index.html">6 games in 6 weeks - the fifth game</a></li>
<li><a href="../246499/index.html">Investments: How to get started on the Chicago Stock Exchange</a></li>
<li><a href="../246503/index.html">Using different VCS repositories in PhpStorm</a></li>
<li><a href="../246507/index.html">How to remain an expert in a changing world</a></li>
<li><a href="../246509/index.html">Create an emotional stress tracker.</a></li>
<li><a href="../246515/index.html">How I was looking for an idea for a startup in Silicon Valley</a></li>
<li><a href="../246517/index.html">We connect NTFS to write to Mac OS X Yosemite 10.10</a></li>
<li><a href="../246519/index.html">How we did cashback service kubish.ru</a></li>
<li><a href="../246521/index.html">LIVR - ‚Äúlanguage independent validation rules‚Äù or data validation without ‚Äúproblems‚Äù</a></li>
<li><a href="../246523/index.html">Hacker's guide to neural networks. Chapter 2: Machine Learning. Binary classification</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>