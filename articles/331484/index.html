<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Machine Learning for an Insurance Company: Exploring Algorithms</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I propose to continue the good tradition that began on Friday just over a month ago. Then I shared with you an introductory article about why machine ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Machine Learning for an Insurance Company: Exploring Algorithms</h1><div class="post__text post__text-html js-mediator-article">  I propose to continue the good tradition that began on Friday just over a month ago.  Then I shared with you an introductory article about why machine learning in an insurance company is needed and how the realism of the idea itself was tested.  Today will be its continuation, in which the most interesting begins - the testing of algorithms. <br><br><img src="https://habrastorage.org/web/31f/1ba/651/31f1ba651312497488004574987bc63c.jpg"><br><a name="habracut"></a><br><h2>  The series of articles "Machine learning for an insurance company" </h2><br>  1. <a href="https://habrahabr.ru/company/microsoft/blog/329082/">Realistic ideas</a> . <br>  2. <a href="https://habrahabr.ru/company/microsoft/blog/331484/">We investigate the algorithms</a> . <br>  3. <a href="https://habrahabr.ru/company/microsoft/blog/334556/">Improving the model through algorithm optimization</a> . <br><br><h2>  Using the ability to embed Python scripts in Azure for data preprocessing </h2><br>  In the first article, we talked about the fact that Azure supports the use of Python scripts.  The module required for this can receive as input two data arrays and a zip-archive with additional materials (for example, other scripts, libraries, etc.). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A simple example: in the first article in the final assessment, there was a remark about an unbalanced test sample in classes.  You can correct the situation by entering into the scheme a simple script that will filter out extra lines in the entire sample.  As a demonstration, we will do it in the following way (others are possible). <br><br><img src="https://habrastorage.org/web/973/af4/38e/973af438ebf74f7e8c357e24bf00c79b.png"><br><br>  The module returns a modified data array, which (as will be seen later) contains an equal number of records for both classes. <br><br><h2>  Analysis of the data used.  Using MS Analysis Service </h2><br>  In almost any machine learning task, the raw data does not provide a satisfactory result.  To select the most informative features for the model, data mining is required. <br><br>  In the prototype, which was discussed in the previous article, two types of data were used: the number of visits by the patient to the doctor in the last three months and the last amount spent on this visit.  To begin, add: <br><br><ul><li>  age; </li><li>  id diagnoses; </li><li>  the number of cost peaks in the last 3 months. </li></ul><br>  However, in this way we will only increase the number of signs without having processed them in any way.  To do this, we use MS Analysis Services, which uses machine learning to extract features, in particular, a simplified Bayesian algorithm. <br><br><img src="https://habrastorage.org/web/2b9/499/534/2b9499534a7a41f78cd255920e87d276.png"><br><br>  Based on the results, you can select boundaries for the binary representation of the input data.  For example, ‚Äúage less than 19‚Äù and ‚Äúnumber of visits to a doctor is less than 5‚Äù indicate a greater likelihood of no peak.  While the ‚Äúage is older than 64‚Äù and ‚Äúthe number of requests is more than 14‚Äù is fraught with expenses next month. <br><br>  You can get a list of diagnoses, which most often precede large spending. <br><br><img src="https://habrastorage.org/web/d16/b95/2fd/d16b952fd1784e0a9226026ef5d56e75.png"><br><br>  This is only part of the selected diagnoses.  In each of the diagnoses, with a probability of from 85% to 100%, there will be a peak in costs.  Their presence is worth making a separate sign.  Do not miss the presence of conventional diagnoses, which will not cost the company expensive.  Therefore, we should normalize the probabilities found and introduce a new sign, which will be a weighted sum of the number of diagnoses over the past 90 days. <br><br>  As a result, seven parameters were obtained in the input feature vector.  Compare them with what was obtained last time using different algorithms. <br><br><h2>  Testing various algorithms and setting their parameters </h2><br>  We will determine the parameters that will be used for training.  Consider several different classification algorithms: logistic regression, support vector machine, decision jungle / random forest, Bayesian network.  Neural networks are also an obvious option, but this is a separate complex topic and in this case this algorithm will be redundant. <br><br>  Since the data was filtered to obtain a balanced sample, we will not change the boundary value for the assignment of classes.  We will return to this question in the next article. <br><br><h4>  Logistic regression </h4><br>  This is a special case of a linear regressor adapted to the tasks of classification.  The algorithm was already mentioned in the first article, where it was used to build the simplest model as a prototype. <br><br>  At the initial stage, it allows you to get the initial value in the range from minus to plus infinity.  Next, we perform the transformation using a sigmoid function of the form 1 / (1 + e ^ (- score)), where score is the value obtained earlier, we perform the conversion.  The result will be a number ranging from -1 to +1.  The decision to belong to the class is made on the basis of the selected threshold value. <br><br><img src="https://habrastorage.org/web/7fc/012/de7/7fc012de719f4665966fea0cc5cc7842.png"><br><br>  Options: <br><br><ul><li>  <b>Optimization tolerance</b> - the limit for the minimum change in accuracy.  If the difference between iterations becomes less than the specified value, learning stops.  In most cases, you can leave the default value of 1E-7. <br><br></li><li>  <b>L1 &amp; L2 regularization</b> - regularization according to the norms of order 1 and 2.  L1 is used to reduce the dimension of the input data by removing the attributes that have the least effect on the result.  L2 ‚Äúfinishes‚Äù signs with large coefficients, reducing these coefficients to zero at infinity.  These values ‚Äã‚Äãare coefficients for norms and, for starters, can remain equal to 1 by default. <br><br></li><li>  <b>L-BFGS</b> is an optimization method for finding the local maximum (minimum) of a non-linear functional without restrictions with limited memory.  This is a quasi-Newtonian method (based on the accumulation of information about the curvature of the objective function for changing its gradient), used to weigh the parameters of the model.  Here the choice depends on the preferences: the value set affects the amount of data used to invert the hessian function.  Essentially, the specified number of last vectors is taken.  Increasing this value improves accuracy.  Improves to certain limits (do not forget about retraining).  It can greatly increase the execution time, so it is often set in the vicinity of 10. <br><br></li><li>  <b>Random seed</b> can be set if necessary to obtain the same results on different runs of the algorithm. </li></ul><br><img src="https://habrastorage.org/web/6ee/107/3b2/6ee1073b2e534f0f89d92fe1d57bf65d.png"><br><br>  This algorithm was used in the prototype model, so the comparison will be most revealing.  Even without adjusting the boundaries of the definition of classes and with small additions to the vector of input features, the percentage of correctly predicted peaks increased by 5%, and their absence increased by 15%.  Such an important indicator, as the area under the curve of this graph, also increased significantly.  This parameter reflects how well the values ‚Äã‚Äãof classes relate to each other for different boundary values.  The further the curve is from the diagonal, the better. <br><br><h4>  Support Vector Machine </h4><br>  The support vector method is included in the group of linear classifiers, although some modifications to the main part of the algorithm allow the construction of non-linear classifiers.  The bottom line is to translate the source data into a higher dimension and build a separating hyperplane.  Increasing the dimensionality is necessary, since the source vectors are often linearly inseparable.  After translation, the hyperplane is searched for with the condition of maximum clearance to hyperplanes, denoting the boundary of classes. <br><br><img src="https://habrastorage.org/web/441/26f/973/44126f973f2048129a9cb44c508b3f66.png"><br><br>  Options: <br><br><ul><li>  <b>Number of iterations</b> - the number of iterations of the learning algorithm.  Represents a parameter for the exchange of accuracy and speed of the algorithm.  For a start, you can put a value in the range from 1 to 10. </li><li>  <b>Lambda</b> - weight analogue for L1 in logistic regression </li><li>  <b>Normalize features</b> - normalize data before training.  Due to the specifics of the method, in most cases the parameter should be left on by default. </li><li>  <b>Project to unit sphere</b> - normalization of coefficients.  This parameter is optional and most often its use will not be needed. </li><li>  <b>Allow unknown category</b> - the default enabled parameter that allows the handling of unknown parameters of the model.  It degrades the work of the model with those data that are known to the classifier, and at the same time improves the accuracy for unknowns. </li><li>  <b>Random seed</b> - similar to logistic regression. </li></ul><br><img src="https://habrastorage.org/web/6e9/f76/6fc/6e9f766fcb89436696ce273efbb67264.png"><br><br>  The graph shows that this is not the most successful algorithm for this task.  Accuracy and area under the curve are low.  In addition, the curve itself is unstable in nature, which might be acceptable for the prototype, but not for the model with the processed data. <br><br><h4>  Bayesian network </h4><br>  Bayesian networks are a probabilistic data model, represented as an acyclic directed graph.  The vertices of the graph are variables that reflect the truth of a certain judgment, and the edges are the degree of dependence between them.  Setting up the model is the selection of these variables and the relationship between them.  In our case, the final assessed judgment on which the graph converges will be the presence of a peak of costs. <br><br><img src="https://habrastorage.org/web/8c9/577/374/8c95773749384d4eb2a6d82f0c7b275b.png"><br><br>  Options: <br><br><ul><li>  <b>Number of training iterations</b> - the same as the parameter in SVM. </li><li>  <b>Include bias</b> - the introduction of a constant value in the input parameters of the model.  This is necessary when it is not in the source vector. </li><li>  <b>Allow unknown values</b> - similar to the parameter in SVM. </li></ul><br><img src="https://habrastorage.org/web/a71/46a/a41/a7146aa41a554a79af363d56a52eb245.png"><br><br>  The Bayesian classifier showed results very similar to the results of logistic regression.  Since the regression is simpler, we‚Äôll dwell on it between them. <br><br><h4>  Random forest </h4><br>  This method is a committee of classic decision trees.  In this algorithm, trees are not pruned (pruning is a method of reducing the complexity of a model through cutting branches of a tree after it is completely built).  However, early stop conditions remain.  Diversity is achieved by choosing random subsets of the source data.  The size remains the same, but reuse of the same data is allowed in these subsets. <br><br>  Each tree uses a random subset of attributes of size m (m is a tunable parameter, however, it is often suggested to use a value close to the root of the size of the original feature vector).  The classification goes through a vote.  The class with the most votes wins. <br><br><img src="https://habrastorage.org/web/c71/b83/c8e/c71b83c8e71f4bb4b2bf1de3385003be.png"><br><br>  Options: <br><br><ul><li>  <b>The default resampling method</b> is bagging, which gives each tree a unique selection of data as described above.  You can also set replicate, if you need to train all trees on the same data. </li><li>  <b>Number of decision trees</b> .  Increasing the number of trees can provide more sample coverage, but not always, and at the cost of increased training time. </li><li>  <b>Maximum depth</b> - the maximum depth of the tree.  The default value - 32 - is quite large and in many situations will lead to retraining.  Most often there is no need to do a depth of more than ten. </li><li>  <b>Number of random splits per node</b> - determines the number of random separation of signs when constructing vertices.  Too much can lead to retraining, so it‚Äôs worth starting to limit to a value between 10 and 30. </li><li>  <b>Minimum number of samples per leaf node</b> - the minimum number of records for the formation of a "sheet" (vertices that are no longer subject to division into branches).  It almost never makes sense to leave one in this place, since such leaves are redundant and often lead the model to retraining. </li><li>  <b>Allow unknown values</b> - similar to SVM. </li></ul><br><img src="https://habrastorage.org/web/9af/320/3a8/9af3203a84ea4f31b73768d3081358ef.png"><br><br>  Random forest turned out to be the most efficient algorithm, giving an increase in the definition of peaks by 8% and their absence by 13%.  Important in the context of the problem is the best interpretability of the reasons for determining the data to any of the classes.  Of course, this algorithm as a whole is a black box, but for it there are relatively simple ways to extract the necessary information. <br><br>  In all the algorithms described above, except for Bayesian networks, there is a ‚Äúcreate trainer mode‚Äù parameter.  Putting it on the Parameter Range, you can enable the mode in which the algorithm learns on various options for the combination of parameters within the specified ranges, and gives the best option.  This feature will illuminate later. <br><br><h4>  Using cross-validation to test variance </h4><br>  Cross-validation assessment can be used to solve various problems.  For example, it is used to combat retraining in a small amount of data to isolate a separate validation sample.  Now it will be required as a tool to test the ability of the current model to generalize.  To do this, divide the data into ten parts and consider each of them as a test.  Next, you will need to train the model on each version of the separation. <br><br>  Take the algorithm that showed the best results among the others - Random Forest. <br><br><img src="https://habrastorage.org/web/63b/4e5/709/63b4e570934c4a85a96061779d8dda66.png"><br><br>  For all samples, the result is stable and quite high.  The model has a good ability to generalize, and a sufficient amount of data is fed to the training. <br><br><h2>  Total </h2><br>  In this part of the series of articles on machine learning, we examined: <br><br><ol><li>  Embedding Python scripts in the overall project scheme on the example of obtaining a data sample balanced by classes. </li><li>  Use MS Analysis Services to extract new traits from raw data. </li><li>  Cross-validation of the model to assess the stability of the result and completeness of data in the training set. </li></ol><br>  The results show a clear improvement in the accuracy and stability of the model.  In the final article, we will address issues of retraining, statistical emissions and committees. <br><br><h4>  About the authors </h4><br>  The <a href="http://www.waveaccess.ru/">WaveAccess</a> team creates technically complex, high-load and fault-tolerant software for companies from different countries.  Commentary by Alexander Azarov, Head of Machine Learning at WaveAccess: <br><blockquote>  Machine learning allows you to automate areas where expert opinions currently dominate.  This makes it possible to reduce the influence of the human factor and increase the scalability of the business. </blockquote></div><p>Source: <a href="https://habr.com/ru/post/331484/">https://habr.com/ru/post/331484/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331472/index.html">Introduction to ServiceNow and IT Infrastructure Management: Digest # 2</a></li>
<li><a href="../331474/index.html">Automatic compression of stored data in redis</a></li>
<li><a href="../331476/index.html">Visualizing goals increases their achievement by 46%. How do we solve this in WebCanape?</a></li>
<li><a href="../331478/index.html">How to hold a raffle among Java programmers</a></li>
<li><a href="../331482/index.html">Challenges marathon round of Yandex. Algorithm 2017</a></li>
<li><a href="../331486/index.html">Webinar: How will targeted cyber attacks develop?</a></li>
<li><a href="../331488/index.html">Thirteenth Developer Economics Survey</a></li>
<li><a href="../331490/index.html">How to stop looking for a good data center and start living</a></li>
<li><a href="../331494/index.html">Tables! Tables? Tables ...</a></li>
<li><a href="../331496/index.html">Milestones in the history of encryption and combat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>