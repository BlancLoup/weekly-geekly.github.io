<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Basics of computer networks. Subject number 7. Spanning Tree Protocol: STP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Welcome to the next article on the basics of computer networks. Today we will touch on yet another family of protocols in the switching world. And tod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Basics of computer networks. Subject number 7. Spanning Tree Protocol: STP</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/688/c9d/228/688c9d22830947b6a2f1d45b2eaca113.jpg"></div><br><br>  Welcome to the next article on the basics of computer networks.  Today we will touch on yet another family of protocols in the switching world.  And today we will talk about spanning tree protocols or STP.  We learn how to build this tree, how to manage it, what loops are, how to deal with them.  The topic is interesting, so I invite you to read more. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Content</b> <div class="spoiler_text">  1) <a href="https://habrahabr.ru/post/307252/">Basic network terms, OSI network model and TCP / IP protocol stack.</a> <br>  2) <a href="https://habrahabr.ru/post/307714/">Top-level protocols.</a> <br>  3) <a href="https://habrahabr.ru/post/308636/">Protocols of lower levels (transport, network and channel).</a> <br>  4) <a href="https://habrahabr.ru/post/312340/">Network devices and types of cables used.</a> <br>  5) <a href="https://habrahabr.ru/post/314484/">The concept of IP addressing, subnet masks and their calculation.</a> <br>  6) <a href="https://habrahabr.ru/post/319080/">The concept of VLAN, Trunk and VTP and DTP protocols.</a> <br>  7) Spanning Tree Protocol: STP. <br>  8) <a href="https://habrahabr.ru/post/334778/">Channel Aggregation Protocol: Etherchannel.</a> <br>  9) Routing: static and dynamic on the example of RIP, OSPF and EIGRP. <br>  10) Network Address Translation: NAT and PAT. <br>  11) Reservation protocols for the first transition: FHRP. <br>  12) Computer network security and virtual private networks: VPN. <br>  13) Global networks and protocols used: PPP, HDLC, Frame Relay. <br>  14) Introduction to IPv6 configuration and routing. <br>  15) Network management and network monitoring. <br><br>  PS Perhaps over time, the list will be added. </div></div><br>  Long thought where to start.  In an amicable way, one must begin with a theory.  But it makes sense to understand the protocol when I have not yet encountered a problem that this protocol can solve.  Therefore, I decided to start with a little practice and show what you can immediately stumble over.  Next, deal with this problem and show what to do next.  I will collect the most common scheme. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/384/873/8e9/3848738e9ee94cf382b7386dce9bb4c3.PNG"></div><br>  There are 2 computers and 2 switches connected to each other.  The address for PC1-192.168.1.2, and for PC2-192.168.1.3.  Computers communicate with each other, send something to each other.  But we notice a weak spot. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/fe2/ae4/3c6/fe2ae43c6f0a48a8ab0839dc965de02a.png"></div><br>  If a cable breaks, participants will be left without communication.  And the very first thought that comes to mind is to plug another cable.  But the first thought is not always true.  The pictures do not show it, so I will show it in the form of animation. <br><br><div class="spoiler">  <b class="spoiler_title">Switching loop</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/files/a7b/957/7a3/a7b9577a36bd40cbbbad6f633b5a2d87.gif"></div><br></div></div><br>  I think they noticed how strangely the links flashed in sync.  This phenomenon is called a loop.  To learn more about it, you need to go into simulation mode.  Open the spoiler below and admire. <br><br><div class="spoiler">  <b class="spoiler_title">Commutation loop in simulation mode</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/files/c7b/fc2/aca/c7bfc2acadf944c08656bb4034df1fd7.gif"></div><br></div></div><br>  I will explain in more detail.  So PC1 decides to send an ICMP packet to PC2.  As a rule, before you start sending, you need to know its MAC address, and it starts ARP.  We remember how switches work with ARP.  They send it to all ports, except outgoing.  What happens to us? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/591/ffc/e84/591ffce8457c45e481634086768f7012.PNG"></div><br>  The switch, according to its logic, sends ARP to both ports (fa0 / 2 and fa0 / 24).  But does not send it to fa0 / 1. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1ff/69c/c82/1ff69cc820d64e6a9346f61079a27d21.png"></div><br>  SW2 will do the same.  He will send the ARP that he received from port fa0 / 24 to the active port fa0 / 2.  And the second ARP received from port fa0 / 2 will be sent to fa0 / 24.  It would seem that we have already received ARP from the 24th port.  But here is the nuance.  We received ARP from another port and a separate ARP message.  Therefore, for the switch, these are 2 different frames and are processed independently of each other.  Well, then by analogy.  SW2 will send one of the ARPs back to SW1, and that, in turn, will send back SW2.  And he will walk like this indefinitely until the cable is pulled out or until the switch ‚Äúdrowns‚Äù with frames and stops responding.  This is the loop.  Accordingly, the more switches, the more frames will be created, which will lead to a rapid network failure.  Therefore, by increasing the redundancy of connections, we increase the probability of getting loops.  Who is interested to see this flicker on your computer, download <a href="https://drive.google.com/open%3Fid%3D0BzKZChrEeV7zRVhUdWVUVzMyX1U">from here</a> . <br><br>  Understood the leading minds that this is bad and must be fought with.  This task was laid on the shoulders of an outstanding engineer Radia Perlman (Radia Joy Perlman) in 1985.  What is the essence of its technology.  You have an N-th number of switches connected to each other.  And before transferring user data, they negotiate among themselves for the right to become a root switch or ‚Äúroot switch‚Äù.  The remaining switches leave only those interfaces that lead to the root switch, and the rest off.  Thus, each switch can be reached only in one way.  Let us analyze this process in more detail. <br><br>  We have 3 switches connected to each other. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b62/41c/2ef/b6241c2efc6440b9b7e7eff8c1a18324.PNG"></div><br>  I conditionally gave them names and MAC addresses.  Each switch includes the classic STP protocol (let's talk about the others below).  As I said above, they need to determine which of them will become the root switch.  To do this, they begin to exchange BPDU frames.  Let's see what this frame is. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/062/522/d9c/062522d9c82413a2f7b3953cf3bc911a.png"></div><br>  If it is hard to see, you can click on it and the original image will open (open the image by pressing the mouse wheel, or right-click on ‚ÄúOpen link in new tab‚Äù, so as not to close the article itself). <br>  A lot of incomprehensible fields.  We will get acquainted with them and we will put all this porridge in order. <br><br><ol><li>  <b>Protocol Identifier</b> is a 2-byte field that is always zero. </li><li>  <b>The version of the STP protocol (Protocol Version Identifier)</b> is a field the size of 1 byte, the value of which is always equal to "0". </li><li>  <b>BPDU type (BPDU type)</b> - 1 byte, which is ‚Äú0‚Äù if it is a configuration BPDU (CBPDU), or ‚Äú1‚Äù if it is a TCN BPDU. <br><ul><li> <b>CBPDU (Configuration Bridge Protocol Data Unit)</b> - a frame used to calculate the spanning tree.  That is, when the value = 0. </li><li>  <b>The TCNBPDU (Topology Change Notification Bridge Protocol Data Unit)</b> is a frame used to notify others about changes in the topology.  That is, when the value is 1. Simply put, if the switch sees what has happened, some change in the topology (the link has fallen off, the neighbor has died, etc.), it starts up a BPDU with a value of ‚Äú1‚Äù in the BPDU field Type.  And then frames with the value ‚Äú0‚Äù work to rebuild the tree. </li></ul></li><li>  <b>Flags</b> ‚Äî Only 1 byte is used in this field.  These flags are used when changing the topology (bit "1") and confirming the topology (bit "8"). </li><li>  <b>Root Identifier</b> ‚Äî This field contains information about the root switch, namely its priority and its MAC address. </li><li>  <b>Root Path Cost</b> - this is the total cost to the root switch.  I will give a sign where the cost is indicated. <br><table><tbody><tr><th>  Channel speed </th><th>  Cost of </th></tr><tr><td>  10 Gbps </td><td>  2 </td></tr><tr><td>  1 Gbps </td><td>  four </td></tr><tr><td>  100 Mbps </td><td>  nineteen </td></tr><tr><td>  10 Mbps </td><td>  100 </td></tr></tbody></table><br>  This table is modified.  Previously, the cost was considered differently, but with the advent of new speed standards, the previous specification has lost its force. </li><li>  <b>Bridge Identifier</b> - here the sending switch records its data (priority + MAC address). </li><li>  <b>Port Identifier</b> - here the sending switch records the port identifier (that is, the one from which this BPDU comes out). </li><li>  <b>Message Age</b> - this is the time interval (in seconds).  It is needed in order to recognize obsolete frames and discard.  It is formed by the root switch and sets to the initial value "0".  Next, each subsequent switch increases this value by the delay time.  As soon as this value exceeds the maximum threshold value, it will be discarded. </li><li>  <b>Maximum message lifetime (Max Age)</b> - this field is responsible, just for the maximum lifetime.  Exceeding it, the switch drops the frame. </li><li>  <b>Hello Time</b> ‚Äî The time interval at which the switch sends BPDU frames.  The default is 2 seconds. </li><li>  <b>Forward Delay</b> - a time interval that indicates how many seconds the switch port will be in the <b>listening</b> and <b>learning</b> state. </li></ol><br>  This is the standard set of BPDUs in STP.  Depending on the version, the fields may be called differently, but the principle of their work is the same.  The frame itself is large and on the move can not immediately keep everything in my head.  This is normal.  Know all the fields by heart is not required.  The main thing that needs to be firmly understood within the CCNA framework is fields 5, 6, 7 and 8. Therefore, we proceed to the analysis of the operation of the STP protocol. <br><br>  In many editions of "ciskovsky" and third-party, the work of STP is shown on the example of 3 switches connected to each other.  I will not depart from the tradition and will do likewise. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/b3e/146/2fd/b3e1462fd6ef484ea5b6e5e2adb5c618.PNG"></div><br>  Conventionally, I gave them the names and MAC-addresses, so as not to litter the head with a long addressing.  Moving on. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/613/53f/a90/61353fa9033b41cabfbe4cb1f6c7a872.PNG"></div><br>  And since the STP protocol is working on the switches, they need to choose who will be the main one in the topology or the <b>root one</b> .  For this, they begin to exchange BPDU frames.  This is where fields 5, 6 and 7 are important. I specifically want to dwell on them.  Initially, switches in field 5 (Root Bridge Identifier or Root Identifier) ‚Äã‚Äãbegin to write their ‚Äúpriority + MAC address‚Äù.  If you manually change nothing, then the priority is 32678. Next, the switch that receives this frame from the neighbor will compare its Root Identifier with the newcomer.  If he sees that his neighbor has this Root ID lower, then from that moment he will relay his BPDU.  As a result, only one switch will remain in the network, which will generate BPDUs. <br><br>  In field 6 of the Root Path Cost, the switch records the cost of the path.  When creating a BPDU, the root switch writes 0 to it, since this is it.  But the following switches are already beginning to summarize the cost of the table presented above. <br><br>  Well, in the field 7 "Bridge Identifier" a bunch of "priority + MAC address" of the switch itself is recorded.  That is, if the bundle of the root switch is always written in the Root Identifier, then in this field, it always writes its own.  That is, when relaying BPDU from neighbor to neighbor, switches add their Bridge ID here. <br><br>  I will say a few words about the ‚Äúpriority + MAC address‚Äù bundle.  They are not summarized in any way.  I inserted the plus sign in the context that they always work together.  At first, switches, when holding elections, look at <b>priority</b> .  And if priorities are equal (and by default they are equal), then it starts relying on MAC addresses.  And the one who has less MAC-address becomes main, root or root.  Call as you like.  That priority is needed just to administratively influence the choice of the root switch.  Imagine the situation that you have 2 switches.  One of them is new and productive, and the second is old, ancient and will soon be written off.  And it turns out that the old switch has a MAC address less than the new switch, which means that with equal priorities, the old switch will always win.  It is to solve such a controversial problem that priority is needed.  Moreover, when you change the priority, it must be a multiple of 4096 (that is, 32768, 28672, 24576, and so on).  We return to the scheme. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a6c/f8f/723/a6cf8f72350b481c9981b49ab3ca4e1c.PNG"></div><br>  Well, since the priorities of the three switches are the same, they start the elections by MAC addresses.  The lowest MAC address of Switch 1 =&gt; it becomes root. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b37/641/0b2/b376410b29924c199d5f2decb23e3cd8.PNG"></div><br>  Since Switch 1 becomes root, it immediately transfers all its interfaces to the ‚ÄúDesignated‚Äù mode.  That is, it is the port that has the shortest path to the root switch (in this case, to itself). <br><br>  Further Switch 2 and Switch 3 must decide for themselves which port will be the root.  That is, the port that has the lowest cost path to the root switch.  Everything is obvious here.  If it suddenly turns out that the cost of several ports is the same, then he will choose the port with the lowest sequence number or name.  For example, fa0 / 1 will be selected from ports fa0 / 1, fa0 / 2 and fa0 / 3. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d9f/29a/800/d9f29a80052945ca906fce1e1ee59fc6.PNG"></div><br>  Root ports are defined, but what to do with the link between Switch 2 and Switch 3, because it can create a loop?  To prevent it, they agree on which of them will disconnect their port. <br><br>  They will also agree on the Bridge ID.  Priorities are equal, so we look at the MAC-addresses.  Switch 2 has a smaller MAC address, so it switches the port to Designated mode, and Switch 3 to Non-Designated mode.  ‚ÄúNon-Designated‚Äù is a mode in which the port is prohibited from transmitting any data, but is allowed to listen to what is happening on the network.  That is, if a link falls off, it can turn on and work right. <br><br>  In addition to roles, ports have states that they must pass without fail.  I will explain on the example of the constructed topology.  Here we have built above tree STP.  There are no loops and everything is fine.  One of the Switch 3 ports is in the <b>Blocking</b> state.  Here he listens to BPDU and does not touch anyone.  But if a link suddenly falls off or a topology changes, it immediately goes into the <b>Listening</b> or <b>Listening</b> state.  In this state, it sends, listens only to BPDU frames and processes the received information.  If he sees that his neighbors have worse parameters than he does, then after 15 seconds, he goes into the next state of <b>Learning</b> or <b>Learning</b> .  This phase also lasts 15 seconds.  In ‚ÄúLearning,‚Äù the port does almost everything the same as in the previous state, except that it now builds a switching table based on the received frames.  If after 15 seconds, he does not receive a BPDU with parameters better than his, he will go to the last state <b>Forwarding</b> or <b>Promotion</b> .  This is the final and full state.  It exchanges not only service information, but also user data.  That is, the transition from the <b>Listening</b> to <b>Forwarding</b> state lasts 30 seconds. <br><br>  There is also a <b>Disable</b> or <b>Disabled</b> state when manually disconnecting a port, but I do not consider this to be an STP state.  In this state, nothing will be transmitted.  This, roughly speaking, the physical shutdown of the port. <br><br>  The above example is the work of the classic STP protocol, which is also called <b>CST (Classic Spanning Tree)</b> .  One of its downsides is that it builds one single tree for the entire topology.  And considering that VLANs appeared, it was necessary to modify this protocol for them.  Cisco, as a pioneer, released the <b>PVST (Per-VLAN Spanning Tree) protocol</b> .  He allowed to build a separate tree for each VLAN.  The only thing that he worked with ISL (proprietary tsiskovsky protocol that works with tagged frames), which was used only on devices of this manufacturer.  But with the advent of the open 802.1q protocol, they quickly upgraded <b>PVST</b> and gave it the name <b>PVST +</b> .  It works the same as its predecessor, but with 802.1q.  I will draw a diagram and explain in more detail. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/4c3/04b/7a3/4c304b7a3ff94482970481a9ef838b7f.PNG"></div><br>  Here, for example, I have 2 VLANs.  And for each VLAN, the PVST + protocol builds a separate tree.  In principle, this is its difference from CST.  Elections and transitions are similar and with the same time interval.  Unfortunately, or fortunately, modern Cisco switches no longer support CST. <br><br>  Therefore, let's practice PVST +.  Moreover, when the network is operating in the same VLAN (which is the default VLAN), it will differ little from the classical STP. <br><br>  I have quickly assembled the lab from 3 switches and now I‚Äôll show you clearly. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/8e5/367/dbf/8e5367dbf0bd44a08aa5b97d0b49246d.PNG"></div><br>  And as soon as the switches go through all the stages, an STP-tree is formed. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/733/c8b/e49/733c8be49834471fb606054e14ebfe76.PNG"></div><br>  I think you noticed that one of the Switch3 switch ports is orange.  This means that this port is in the <b>Blocking</b> state.  Do not confuse with <b>Disabled</b> .  That is, it does not apply to user traffic, but listens to what is happening on the network.  And no matter how much we plug in the cables.  The topology will always work out STP and close loops. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/1cc/8cb/5ca/1cc8cb5ca39c45249a51e1b4307d782c.PNG"></div><br>  Actually, as shown in the figure. <br><br>  Now I‚Äôll show what happens to the switches when the tree is already built.  According to the STP logic, the root switch should send a Hello frame to the ‚Äúslave‚Äù switches with a time interval of 2 seconds. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/82a/f00/273/82af00273dfd4e328646ec29c29518ab.PNG"></div><br>  What he is, you see in the picture above.  Please pay attention to the field frame Ethernet 802.3.  Namely, ‚ÄúSource MAC-Address‚Äù and ‚ÄúDestination MAC-Address‚Äù.  In ‚ÄúSource MAC-Address‚Äù, he writes down the MAC address of his port (in this case, FastEthernet 0/1).  And in the ‚ÄúDestination MAC-Address‚Äù the multicast address is ‚Äú0180.C200.0000‚Äù, which is sent to all participants who know what STP is and work with it.  Well, the frame itself is STP BPDU.  There are a lot of fields.  But I will focus on the more important ones, which I marked with a red rectangle. <br><br><ul><li>  <b>Root ID</b> - 32769 / 0009.7C94.0557.  This is, exactly, that very bunch of ‚Äúpriority + MAC address‚Äù.  But here is an interesting point.  If in classic STP, the default priority was 32768, here we see 32769. In the PVST + protocol and others who can work with VLAN, the <b>system ID extension</b> parameter is added to the priority.  This parameter contains the VLAN number and, according to it, the switch understands which STP process it belongs to.  That is, in this case, we have VLAN # 1 =&gt; priority = 32768 + 1 = 32769. If we configured for the 10th VLAN, the priority was 32778. Well, after the fractional line, the MAC address of the interface itself. </li><li>  <b>Root Path Cost</b> - the cost of the path.  We study the frame when it comes out of the root switch =&gt; there is 0. </li><li>  <b>Bridge ID</b> ‚Äî The switch ID that relays this BPDU.  It is currently the same as the Root ID. </li><li>  <b>Port ID</b> - the port ID.  Same as priority - 32769. </li><li>  <b>Message Age</b> - time interval.  Since the BPDU is ‚Äúfresh‚Äù, it stands at 0. </li><li>  <b>Max Age</b> - the maximum lifetime is 20 seconds. </li><li>  <b>Hello Time</b> - the sending interval is 2 seconds. </li><li>  <b>Forward Delay</b> - indicates how many seconds to be in one phase (listening or learning) - 15 seconds. </li></ul><br>  In principle, there is nothing new here, and all this we have analyzed above.  I showed this in order for you to understand why I had loaded so long with dry text. <br><br>  We already know who the root switch is and which port is blocked to eliminate the loop.  But in the exam and in everyday life we ‚Äã‚Äãwill operate with teams, with the help of which it will be possible to find out who in the segment is the root, from whom the port is blocked and other information.  Let's start with <b>Switch1</b> and with the most important <b>show spanning-tree</b> command.  Its important to remember. <br><br><pre><code class="hljs pgsql">Switch1#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> spanning-tree VLAN0001 Spanning tree enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">32769</span></span> Address <span class="hljs-number"><span class="hljs-number">0009.7</span></span>C94<span class="hljs-number"><span class="hljs-number">.0557</span></span> This bridge <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> the root Hello <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32769</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">1</span></span>) Address <span class="hljs-number"><span class="hljs-number">0009.7</span></span>C94<span class="hljs-number"><span class="hljs-number">.0557</span></span> Hello <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface <span class="hljs-keyword"><span class="hljs-keyword">Role</span></span> Sts <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> Prio.Nbr <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-comment"><span class="hljs-comment">---------------- ---- --- --------- -------- -------------------------------- Fa0/1 Desg FWD 19 128.1 P2p Fa0/2 Desg FWD 19 128.2 P2p</span></span></code> </pre> <br>  This command displays information about all STP processes (that is, for each VLAN) in which the switch participates.  In our case, only one VLAN.  Now let's talk about what these letters mean. <br><br>  The first thing that catches your eye is the <b>Root ID</b> block. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/327/9c8/cca/3279c8cca242460e8fd969c5dfc23a5a.PNG"></div><br>  It contains information about the priority, MAC address and timers of the root switch.  Here is another important line ‚ÄúThis bridge is the root‚Äù.  It says that this particular switch is the root of the VLAN.  Therefore, if you need to find the root switch, then look for this inscription.  On the adjacent switch (non-root) this line will not be. <br><br>  The next block is the <b>Bridge ID</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/4df/130/c76/4df130c76d114a14bf1da64a85966c0b.PNG"></div><br>  Here, respectively, information about the current switch.  On the root switch, this block is identical to the higher one. <br><br>  Well, below is the table. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/058/573/35c/05857335c16e4684bf970f93d705100c.PNG"></div><br><br>  It contains interfaces related to this VLAN, their roles, statuses, and so on.  Let us dwell on it. <br><br>  Since this is the root switch, the ports are automatically transferred to the ‚ÄúDesignated‚Äù role. <br>  The status ‚ÄúForwarding‚Äù indicates that the ports have passed all stages and are now in active mode (transfer). <br><br>  Next comes the cost, and it is equal to 19. FastEthernet operates at a speed of 100 Mbit / s and for this speed the cost is equal to 19 (the label is shown above). <br><br>  Next comes the Prio.Nbr or Priority Number column.  This is the port priority.  By default, this parameter is 128, and after the dot, the port serial number is recorded.  Accordingly, for Fa0 / 1 it is 128.1, and for Fa0 / 2 it is 128.2. <br><br>  The ‚Äúp2p‚Äù type indicates that the switch port operates in the ‚Äúfull-duplex‚Äù mode.  This means that the port can simultaneously transmit and receive. <br><br>  If ‚Äúshared‚Äù is specified there, it will mean that the port is operating in the ‚Äúhalf-duplex‚Äù mode.  That is, he either transmits or receives (not at the same time). <br><br>  Let's <b>move</b> on to the next <b>Switch2</b> switch.  Similarly, I will enter the command ‚Äúshow spanning-tree‚Äù and see what it shows. <br><br><pre> <code class="hljs pgsql">Switch2#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> spanning-tree VLAN0001 Spanning tree enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">32769</span></span> Address <span class="hljs-number"><span class="hljs-number">0009.7</span></span>C94<span class="hljs-number"><span class="hljs-number">.0557</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> Port <span class="hljs-number"><span class="hljs-number">1</span></span>(FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>) Hello <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32769</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">1</span></span>) Address <span class="hljs-number"><span class="hljs-number">00</span></span>D0<span class="hljs-number"><span class="hljs-number">.9776</span></span>.B743 Hello <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface <span class="hljs-keyword"><span class="hljs-keyword">Role</span></span> Sts <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> Prio.Nbr <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-comment"><span class="hljs-comment">---------------- ---- --- --------- -------- -------------------------------- Fa0/1 Root FWD 19 128.1 P2p Fa0/2 Desg FWD 19 128.2 P2p</span></span></code> </pre> <br>  Pay attention to the block <b>Root ID</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c20/cb3/b27/c20cb3b277394cdb88fa543906bfe239.PNG"></div><br>  As mentioned earlier, this contains information about the root switch.  But there is no longer the inscription "This bridge is the root", since this switch is not the root.  But there is another Port entry.  It contains the port leading to the root switch, and this is FastEthernet0 / 1.  Above is the Cost line and it is 19. Do not confuse this Cost line with the same line in the interface table below.  If the cost in the interface table is specified for a specific port, then the total cost to the root switch is recorded here.  For example, if there is another switch behind the Switch2 switch with the FastEthernet interface, then its cost will be higher. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f7f/0cd/299/f7f0cd2997a54f5290da2cc737891ca4.PNG"></div><br>  That is, he adds up the cost of his interface with the cost of his neighbor's interface. <br>  Moving on and stumble on the block <b>Bridge ID</b> .  Here he writes information about himself.  You may notice that the MAC addresses are different.  Next come the timers.  This is an important indicator and try not to forget about it.  Better not to change it.  But, if you still need to do it, then change and on neighboring switches.  Otherwise, it can lead to serious errors and will take quite a bit of time for elimination. <br><br>  The interface table differs from the root switch in that the FastEthernet0 / 1 role is not ‚ÄúDesignated‚Äù, but ‚ÄúRoot‚Äù.  That is, this port leads to the root switch. <br>  The last <b>Switch3</b> switch <b>stayed</b> <br><br><pre> <code class="hljs pgsql">Switch3#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> spanning-tree VLAN0001 Spanning tree enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">32769</span></span> Address <span class="hljs-number"><span class="hljs-number">0009.7</span></span>C94<span class="hljs-number"><span class="hljs-number">.0557</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> Port <span class="hljs-number"><span class="hljs-number">1</span></span>(FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>) Hello <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32769</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">1</span></span>) Address <span class="hljs-number"><span class="hljs-number">00</span></span>D0.BA84<span class="hljs-number"><span class="hljs-number">.7</span></span>C38 Hello <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface <span class="hljs-keyword"><span class="hljs-keyword">Role</span></span> Sts <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> Prio.Nbr <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-comment"><span class="hljs-comment">---------------- ---- --- --------- -------- -------------------------------- Fa0/1 Root FWD 19 128.1 P2p Fa0/2 Altn BLK 19 128.2 P2p</span></span></code> </pre> <br>  Here the configuration is the same, with the exception of the FastEthernet0 / 2 port. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/05d/8bd/1fc/05d8bd1fcdbb4bd28d4d3f3a462d4e34.PNG"></div><br><br>  He is in the role of <b>Alternate</b> .  That is, as a spare.  And the <b>Blocking</b> status indicates that the port is blocked in order to ‚Äúbreak‚Äù the loop.  Here is the principle of the classic STP.  I attach the <a href="https://drive.google.com/open%3Fid%3D0BzKZChrEeV7zTFNMN25HTXhPcEk">link</a> to download this lab. <br>  But this view is not very relevant, as you will not find a serious organization, which has only one VLAN.  Accordingly, our task is to make STP friends with VLAN. <br><br>  Therefore, we create VLANs on each switch.  You can, of course, enable VTP and they are automatically synchronized, but I am not a supporter of this protocol.  Therefore, in a notebook I prepared a template of commands that I will insert on each switch. <br><br><div class="spoiler">  <b class="spoiler_title">Command list</b> <div class="spoiler_text">  enable <br>  configure terminal <br>  vlan 2 <br>  exit <br>  vlan 3 <br>  exit <br>  interface range fastethernet 0 / 1-2 <br>  switchport mode trunk </div></div><br>  And now I will check what happened at the output with the command ‚Äúshow spanning-tree‚Äù. <br><br><pre> <code class="hljs dos">Switch1#show spanning-<span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> VLAN0001 Spanning <span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">32769</span></span> Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> This bridge is the root Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32769</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">1</span></span>) Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface Role Sts Cost Prio.Nbr <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span> ---------------- ---- --- --------- -------- -------------------------------- Fa0/<span class="hljs-number"><span class="hljs-number">1</span></span> Desg FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> P2p Fa0/<span class="hljs-number"><span class="hljs-number">2</span></span> Desg FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> P2p VLAN0002 Spanning <span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">32770</span></span> Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> This bridge is the root Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32770</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">2</span></span>) Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface Role Sts Cost Prio.Nbr <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span> ---------------- ---- --- --------- -------- -------------------------------- Fa0/<span class="hljs-number"><span class="hljs-number">1</span></span> Desg FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> P2p Fa0/<span class="hljs-number"><span class="hljs-number">2</span></span> Desg FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> P2p VLAN0003 Spanning <span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">32771</span></span> Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> This bridge is the root Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32771</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">3</span></span>) Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface Role Sts Cost Prio.Nbr <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span> ---------------- ---- --- --------- -------- -------------------------------- Fa0/<span class="hljs-number"><span class="hljs-number">1</span></span> Desg FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> P2p Fa0/<span class="hljs-number"><span class="hljs-number">2</span></span> Desg FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> P2p</code> </pre> <br>  It turned out a long text canvas, which describes the STP process for each VLAN.  If you look closely, you can see that Switch1 is the root for each VLAN.  But it is not always necessary. <br><br>  I'll explain now.  For example, we have Switch3, which blocks the port to eliminate the loop.  Let's take a look at its updated configuration. <br><br><pre> <code class="hljs dos">Switch3#show spanning-<span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> VLAN0001 Spanning <span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">32769</span></span> Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> Cost <span class="hljs-number"><span class="hljs-number">19</span></span> Port <span class="hljs-number"><span class="hljs-number">1</span></span>(FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>) Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32769</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">1</span></span>) Address <span class="hljs-number"><span class="hljs-number">00</span></span>D0.BA84.<span class="hljs-number"><span class="hljs-number">7</span></span>C38 Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface Role Sts Cost Prio.Nbr <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span> ---------------- ---- --- --------- -------- -------------------------------- Fa0/<span class="hljs-number"><span class="hljs-number">1</span></span> Root FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> P2p Fa0/<span class="hljs-number"><span class="hljs-number">2</span></span> Altn BLK <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> P2p VLAN0002 Spanning <span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">32770</span></span> Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> Cost <span class="hljs-number"><span class="hljs-number">19</span></span> Port <span class="hljs-number"><span class="hljs-number">1</span></span>(FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>) Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32770</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">2</span></span>) Address <span class="hljs-number"><span class="hljs-number">00</span></span>D0.BA84.<span class="hljs-number"><span class="hljs-number">7</span></span>C38 Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface Role Sts Cost Prio.Nbr <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span> ---------------- ---- --- --------- -------- -------------------------------- Fa0/<span class="hljs-number"><span class="hljs-number">1</span></span> Root FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> P2p Fa0/<span class="hljs-number"><span class="hljs-number">2</span></span> Altn BLK <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> P2p VLAN0003 Spanning <span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">32771</span></span> Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> Cost <span class="hljs-number"><span class="hljs-number">19</span></span> Port <span class="hljs-number"><span class="hljs-number">1</span></span>(FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>) Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32771</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">3</span></span>) Address <span class="hljs-number"><span class="hljs-number">00</span></span>D0.BA84.<span class="hljs-number"><span class="hljs-number">7</span></span>C38 Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface Role Sts Cost Prio.Nbr <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span> ---------------- ---- --- --------- -------- -------------------------------- Fa0/<span class="hljs-number"><span class="hljs-number">1</span></span> Root FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> P2p Fa0/<span class="hljs-number"><span class="hljs-number">2</span></span> Altn BLK <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> P2p</code> </pre> <br>  We see that it blocks the interface FastEthernet0 / 2 in all 3 VLANs.  And now a situation has arisen that you need to make Switch3 the root switch for VLAN 3. As described earlier, a priority game will come to the rescue.  Now it is equal to 32771 (32786 + 3).  I need to reduce it.  This can be done in several ways.  The first way is to set the priority manually.  I go to Switch 3 and write: <br><br><pre> <code class="hljs pgsql">Switch3(config)#spanning-tree vlan <span class="hljs-number"><span class="hljs-number">3</span></span> priority <span class="hljs-number"><span class="hljs-number">30000</span></span> % Bridge Priority must be <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> increments <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">4096.</span></span> % Allowed <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> are: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4096</span></span> <span class="hljs-number"><span class="hljs-number">8192</span></span> <span class="hljs-number"><span class="hljs-number">12288</span></span> <span class="hljs-number"><span class="hljs-number">16384</span></span> <span class="hljs-number"><span class="hljs-number">20480</span></span> <span class="hljs-number"><span class="hljs-number">24576</span></span> <span class="hljs-number"><span class="hljs-number">28672</span></span> <span class="hljs-number"><span class="hljs-number">32768</span></span> <span class="hljs-number"><span class="hljs-number">36864</span></span> <span class="hljs-number"><span class="hljs-number">40960</span></span> <span class="hljs-number"><span class="hljs-number">45056</span></span> <span class="hljs-number"><span class="hljs-number">49152</span></span> <span class="hljs-number"><span class="hljs-number">53248</span></span> <span class="hljs-number"><span class="hljs-number">57344</span></span> <span class="hljs-number"><span class="hljs-number">61440</span></span></code> </pre> <br>  I decided to set the priority to 30,000, since it is less than 32768. Yes, please note that we are changing the priority without sys-id-ext.  But after entering, there is a message that you need to enter a multiple of 4096. And below offers a valid priority.  You can enter one of the suggested values ‚Äã‚Äãand the priority will change. <br><br>  But I will show another way to change the priority. <br><br><pre> <code class="hljs lisp">Switch3(<span class="hljs-name"><span class="hljs-name">config</span></span>)# spanning-tree vlan <span class="hljs-number"><span class="hljs-number">3</span></span> root primary</code> </pre> <br>  When you enter this command, the switch looks at what Bridge ID was at the root switch and changes it to a lower value.  Only he takes away not 4096, but 8192. That is, he does less by 2 orders of magnitude.  I will enter this command and see what changes. <br><br><pre> <code class="hljs dos">Switch3#show spanning-<span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> VLAN0001 Spanning <span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">32769</span></span> Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> Cost <span class="hljs-number"><span class="hljs-number">19</span></span> Port <span class="hljs-number"><span class="hljs-number">1</span></span>(FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>) Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32769</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">1</span></span>) Address <span class="hljs-number"><span class="hljs-number">00</span></span>D0.BA84.<span class="hljs-number"><span class="hljs-number">7</span></span>C38 Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface Role Sts Cost Prio.Nbr <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span> ---------------- ---- --- --------- -------- -------------------------------- Fa0/<span class="hljs-number"><span class="hljs-number">1</span></span> Root FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> P2p Fa0/<span class="hljs-number"><span class="hljs-number">2</span></span> Altn BLK <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> P2p VLAN0002 Spanning <span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">32770</span></span> Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> Cost <span class="hljs-number"><span class="hljs-number">19</span></span> Port <span class="hljs-number"><span class="hljs-number">1</span></span>(FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>) Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32770</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">2</span></span>) Address <span class="hljs-number"><span class="hljs-number">00</span></span>D0.BA84.<span class="hljs-number"><span class="hljs-number">7</span></span>C38 Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface Role Sts Cost Prio.Nbr <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span> ---------------- ---- --- --------- -------- -------------------------------- Fa0/<span class="hljs-number"><span class="hljs-number">1</span></span> Root FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> P2p Fa0/<span class="hljs-number"><span class="hljs-number">2</span></span> Altn BLK <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> P2p VLAN0003 Spanning <span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">24579</span></span> Address <span class="hljs-number"><span class="hljs-number">00</span></span>D0.BA84.<span class="hljs-number"><span class="hljs-number">7</span></span>C38 This bridge is the root Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">24579</span></span> (priority <span class="hljs-number"><span class="hljs-number">24576</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">3</span></span>) Address <span class="hljs-number"><span class="hljs-number">00</span></span>D0.BA84.<span class="hljs-number"><span class="hljs-number">7</span></span>C38 Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface Role Sts Cost Prio.Nbr <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span> ---------------- ---- --- --------- -------- -------------------------------- Fa0/<span class="hljs-number"><span class="hljs-number">1</span></span> Desg FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> P2p Fa0/<span class="hljs-number"><span class="hljs-number">2</span></span> Desg FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> P2p</code> </pre> <br>  And I see that the VLAN 3 section has changed.  Now there is priority 24579 (24576 + 3) and there is a line ‚ÄúThis bridge is the root‚Äù indicating that this switch is now root for VLAN 3. Both ports are in ‚ÄúDesignated‚Äù role and ‚ÄúForward‚Äù status (which is true for the root switch) .  But the two upper sections with VLANs remained unchanged and for them FastEthernet 0/2 will remain blocked. <br><br>  Now let's see how Switch 1 reacted to the fact that they took the crown from him. <br><br><pre> <code class="hljs dos">Switch1#show spanning-<span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> VLAN0001 Spanning <span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">32769</span></span> Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> This bridge is the root Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32769</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">1</span></span>) Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface Role Sts Cost Prio.Nbr <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span> ---------------- ---- --- --------- -------- -------------------------------- Fa0/<span class="hljs-number"><span class="hljs-number">2</span></span> Desg FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> P2p Fa0/<span class="hljs-number"><span class="hljs-number">1</span></span> Desg FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> P2p VLAN0002 Spanning <span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">32770</span></span> Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> This bridge is the root Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32770</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">2</span></span>) Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface Role Sts Cost Prio.Nbr <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span> ---------------- ---- --- --------- -------- -------------------------------- Fa0/<span class="hljs-number"><span class="hljs-number">2</span></span> Desg FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> P2p Fa0/<span class="hljs-number"><span class="hljs-number">1</span></span> Desg FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> P2p VLAN0003 Spanning <span class="hljs-built_in"><span class="hljs-built_in">tree</span></span> enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">24579</span></span> Address <span class="hljs-number"><span class="hljs-number">00</span></span>D0.BA84.<span class="hljs-number"><span class="hljs-number">7</span></span>C38 Cost <span class="hljs-number"><span class="hljs-number">19</span></span> Port <span class="hljs-number"><span class="hljs-number">1</span></span>(FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>) Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32771</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">3</span></span>) Address <span class="hljs-number"><span class="hljs-number">0009</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>C94.<span class="hljs-number"><span class="hljs-number">0557</span></span> Hello <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface Role Sts Cost Prio.Nbr <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span> ---------------- ---- --- --------- -------- -------------------------------- Fa0/<span class="hljs-number"><span class="hljs-number">2</span></span> Desg FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> P2p Fa0/<span class="hljs-number"><span class="hljs-number">1</span></span> Root FWD <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> P2p</code> </pre> <br>  We see that he reacted calmly.  Switch 1 is still the root for VLAN 1 and VLAN 2. And only for VLAN 3 has it changed its state and port state. <br><br>  This is how you can manage different STP processes for each of the VLANs.  I attach a <a href="https://drive.google.com/open%3Fid%3D0BzKZChrEeV7zWDF4SFU0X2dMejA">link</a> to download. <br><br>  All this is of course good that the switch before turning on the port in every possible way rechecks everything.  But if we know that behind the switch port there is a client computer that does not create loops, then we can immediately transfer the port to ‚ÄúForwarding‚Äù mode, without waiting for 30 seconds.  For this there is a technology ‚ÄúPortfast‚Äù. <br><br>  I‚Äôll go to Switch2 and use the FastEthernet 0/3 port as an example: <br><br><pre> <code class="hljs vhdl">Switch2(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>)#spanning-tree portfast %<span class="hljs-literal"><span class="hljs-literal">Warning</span></span>: portfast should only be enabled <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> ports connected <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> a single host. Connecting hubs, concentrators, switches, bridges, etc... <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> this interface <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> portfast <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> enabled, can cause temporary bridging loops. <span class="hljs-keyword"><span class="hljs-keyword">Use</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> CAUTION %Portfast has been configured <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> FastEthernet0/<span class="hljs-number"><span class="hljs-number">3</span></span> but will only have effect <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> the interface <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a non-trunking mode.</code> </pre> <br>  After input, it immediately transfers the port to Forwarding mode, but displays a warning that this port must be strictly connected to one user host.  Otherwise, when connecting switches and other devices, it can lead to a loop.  Under the spoiler below it shows exactly how it works. <br><br><div class="spoiler">  <b class="spoiler_title">Portfast</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/files/7e2/72e/175/7e272e1757bb47d7986d825edd0b552c.gif"></div><br></div></div><br>  As you can see, he passed all the stages and immediately switched to the "Forwarding" mode.  Do not forget about this technology, but use it with caution, because if there is not a user host, but a switch or other device, you risk creating a loop. <br><br>  Here is the basic working principle of PVST +.  As you can see, it is not much different from the classic STP or CST. <br><br>  I think you have noticed what kind of text canvas the ‚Äúshow spanning-tree‚Äù command displays.  And the more VLANs, the more this conclusion.  And if you need to look at the information on the switch for the 10th VLAN, you will have to scroll the entire output from the very beginning, until you reach the line with the desired VLAN.  To facilitate this situation, there is a very good team that allows you to find out information for a specific VLAN.  This is the show spanning-tree vlan X command.  I'll check this command. <br><br><pre> <code class="hljs pgsql">Switch1#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> spanning-tree vlan <span class="hljs-number"><span class="hljs-number">3</span></span> VLAN0003 Spanning tree enabled protocol ieee Root ID Priority <span class="hljs-number"><span class="hljs-number">24579</span></span> Address <span class="hljs-number"><span class="hljs-number">00</span></span>D0.BA84<span class="hljs-number"><span class="hljs-number">.7</span></span>C38 <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> Port <span class="hljs-number"><span class="hljs-number">1</span></span>(FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>) Hello <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Bridge ID Priority <span class="hljs-number"><span class="hljs-number">32771</span></span> (priority <span class="hljs-number"><span class="hljs-number">32768</span></span> sys-id-ext <span class="hljs-number"><span class="hljs-number">3</span></span>) Address <span class="hljs-number"><span class="hljs-number">0009.7</span></span>C94<span class="hljs-number"><span class="hljs-number">.0557</span></span> Hello <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> sec Max Age <span class="hljs-number"><span class="hljs-number">20</span></span> sec Forward Delay <span class="hljs-number"><span class="hljs-number">15</span></span> sec Aging <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> Interface <span class="hljs-keyword"><span class="hljs-keyword">Role</span></span> Sts <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> Prio.Nbr <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-comment"><span class="hljs-comment">---------------- ---- --- --------- -------- -------------------------------- Fa0/2 Desg FWD 19 128.2 P2p Fa0/1 Root FWD 19 128.1 P2p</span></span></code> </pre> <br>  And here he is, at my command, he displays information only for the 3rd VLAN.  Very handy command, so take note. <br><br>  There is another interesting command "show spanning-tree summary". <br><br><pre> <code class="hljs pgsql">Switch3#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> spanning-tree <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span> Switch <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> pvst mode Root bridge <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: VLAN0003 Extended <span class="hljs-keyword"><span class="hljs-keyword">system</span></span> ID <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> enabled Portfast <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> disabled PortFast BPDU Guard <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> disabled Portfast BPDU <span class="hljs-keyword"><span class="hljs-keyword">Filter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> disabled Loopguard <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> disabled EtherChannel misconfig guard <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> disabled UplinkFast <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> disabled BackboneFast <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> disabled Configured Pathcost <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> used <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> short <span class="hljs-type"><span class="hljs-type">Name</span></span> Blocking Listening Learning Forwarding STP Active <span class="hljs-comment"><span class="hljs-comment">---------------------- -------- --------- -------- ---------- ---------- VLAN0001 1 0 0 1 2 VLAN0002 1 0 0 1 2 VLAN0003 0 0 0 2 2 ---------------------- -------- --------- -------- ---------- ---------- 3 vlans 2 0 0 4 6</span></span></code> </pre> <br>  It shows summary and brief statistics.  In which STP mode the switch works, for which VLAN is it root, what functions are enabled on it.  And most importantly, there is a table containing the names of the VLANs and the number of interfaces in this VLAN that are in different states.  This is very useful when you need to quickly go in and see if there are any blocked ports on the switch and for which VLANs they are blocked. <br><br>  In principle, of all the commands, these are often used, and for the CCNA level there are more than enough of them. <br>  In fact, STP and PVST + are not the only loop prevention protocols.  There are also RSTP and MSTP.  If the MSTP in the CCNA program is practically not mentioned, except for the fact that it exists, then Cisco started to speak openly and in detail about RSTP with Cisco with the new version of the CCNA 3.0 program.  Therefore, I will analyze it in more detail. <br><br>  You probably noticed that the classic STP, that PVST + require time for convergence.  Namely, 30 seconds, in case of failure or disconnection of any link.  This is certainly not so much, but the larger the network, the longer it takes.  And in a large corporate environment, complete convergence can take several minutes.  And to resolve this situation, the IEEE committee released the 802.1w standard or RSTP protocol. <br><br>  What is the essence.  If the classic STP had 4 states (Blocking, Listening, Learning, Forwarding), then in RSTP there were fewer of them.  Total 3 (Discarding, Listening and Forwarding).  That is, the switch drops, learns, or forwards.  But it does not converge more quickly because of this.  Rapid convergence of the protocol ensures that it calculates in advance which port to turn on if it fails.  Thus, in the event of a port failure, he does not start frantically studying the topology and jump over various states, but simply switches to a previously calculated one. <br>  A very good addition to the rapid convergence of the RSTP protocol was left by the user under the nickname <a href="https://habrahabr.ru/users/ksg222/" class="user_link">ksg222</a> .  And for that I express my gratitude to him.  I quote: <br>  Rapid convergence and response to failures in RSTP provide: <br><ul><li>  BPDU generation of messages by each device, regardless of the root switch; </li><li>  proposal / mechanism, when a point-to-point channel is activated, to quickly move ports to the ‚ÄúForwarding‚Äù state </li><li>  the mechanism of using an alternative port, with the loss of communication through the root port (like <a href="http://www.cisco.com/cisco/web/support/RU/109/1096/1096850_51.html">UplinkFast</a> technology); </li><li>  the mechanism of immediate response to receiving BPDU with the ‚Äúworst‚Äù root switch from a neighbor that has designated ports for this network segment (like <a href="http://www.cisco.com/c/ru_ru/support/docs/lan-switching/spanning-tree-protocol/12014-18.html">backbonefast</a> technology); </li><li>  a more optimal scheme for sending and processing TCN BPDU messages about changes in the network. </li></ul><br>  You can enable RSTP using the command: <br><br><pre> <code class="hljs lisp">Switch2(<span class="hljs-name"><span class="hljs-name">config</span></span>)#spanning-tree mode rapid-pvst</code> </pre> <br>  I assembled the lab and turned on the RSTP on each switch and check how quickly the rebuilding of the tree will occur. <br><br><div class="spoiler">  <b class="spoiler_title">RSTP Rebuilding the Tree</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/files/2a8/382/565/2a8382565ca84ed7b2b7cc82fb97daa6.gif"></div><br></div></div><br>  As you can see, the rebuild occurs in seconds.  For those who want to check it for themselves, I attach a <a href="https://drive.google.com/open%3Fid%3D0BzKZChrEeV7zVUlKZzdWLTdtcnM">file</a> with a lab. <br><br>  The article on STP protocols has come to an end.  Now we can build STP processes for each VLAN, manage priority and much more.  And for the speed of convergence we can use the RSTP protocol. <br><br>  <b>PS</b> I tried to highlight all the moments, but due to the fact that the article was written for one and a half months at different intervals, I could miss something.  If you have something to add, underline or something remains unclear, feel free to write.  And even if everything is clear, then write too.  I will be pleased!  Good luck with your training and see you in the next article. </div><p>Source: <a href="https://habr.com/ru/post/321132/">https://habr.com/ru/post/321132/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321122/index.html">Digest: DPI technologies and SORM equipment</a></li>
<li><a href="../321124/index.html">VMware Introduces New NSX Tools for SDN</a></li>
<li><a href="../321126/index.html">‚ÄúCosmos is the last frontier‚Äù: A bit about the IT infrastructure of the fastest radio telescope ASKAP</a></li>
<li><a href="../321128/index.html">HyperFlex - two new all-flash-systems from Cisco</a></li>
<li><a href="../321130/index.html">Smart Dust: how the smallest computer Michigan Micro Mote works</a></li>
<li><a href="../321134/index.html">Creating a desktop application using Webix and Electron</a></li>
<li><a href="../321136/index.html">ROC launched the first Orthodox messenger</a></li>
<li><a href="../321138/index.html">Voice standards</a></li>
<li><a href="../321140/index.html">Neural networks, genetic algorithms, etc. ... Myths and reality</a></li>
<li><a href="../321142/index.html">How to test online store communication channels before sales</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>