<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A special case of using Sikuli to solve a problem on Facebook</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago, Facebook began to use an NFS-based solution to store user photos. It helps to cope with a pressure of about 220 million new files occup...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A special case of using Sikuli to solve a problem on Facebook</h1><div class="post__text post__text-html js-mediator-article">  Some time ago, Facebook began to use an NFS-based solution to store user photos.  It helps to cope with a pressure of about 220 million new files occupying 25TB every week and at peak hours handing out more than 550 thousand images per second <a href="https://www.facebook.com/note.php%3Fnote_id%3D76191543919%26ref%3Dmf">[1]</a> .  The maximum number of files uploaded to one album has been increased from 60 to 200 to the delight of users. <br><br>  The presence of privacy settings and the fact that the free space on Picasa was safely eaten by the masterpieces of past years, prompted me and some acquaintances to try to use Facebook as a photo storage. <br><br>  Practice, however, revealed some inconvenience to the service, the most annoying of which was the <b>impossibility of removing the album</b> after loading a lot of photos into it.  This article is dedicated to everyone who has been affected by this problem and who is curious about another example of the use of the remarkable cross-platform visual automation tool Sikuli. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  The essence of the problem </h4><br>  Replication scenario was as follows: <br><ul><li>  Using the drag-and-drop upload form we upload photos to the new album in an amount exceeding 200. </li><li>  After uploading two hundred photos, the process is terminated by an error message. </li><li>  Attempting to delete an album through ‚ÄúEdit Album‚Äù - ‚ÄúDelete Album‚Äù fails. </li><li>  Deleting a photo through ‚ÄúEdit Album‚Äù - ‚ÄúEdit Photos‚Äù - ‚ÄúDelete‚Äù - ‚ÄúSave changes‚Äù also does not work. </li></ul><br>  The Bug Report was sent over a month ago, and at the time of writing this article has not lost its relevance, judging by the experience of other users. <br><br><h4>  Solution search and implementation </h4><br>  The only found method for deleting photos from an album in the state described above was to use the ‚ÄúDelete This Photo‚Äù link in the viewer.  Manually delete 200 photos in this way is not a fun lesson. <br><br>  Good articles by <a href="http://habrahabr.ru/users/zodiak/" class="user_link">zodiak</a> <a href="http://habrahabr.ru/blogs/gdev/129979/">[2]</a> and <a href="http://habrahabr.ru/users/kl7/" class="user_link">KL7</a> <a href="http://habrahabr.ru/blogs/ui/82639/">[3]</a> inspired the use of Sikuli. <br><br>  Briefly, Sikuli can be described as a visual technology for automating graphical user interfaces using images (screenshots).  The current implementation of Sikuli includes Sikuli Script ‚Äî a visual script API for Jython and Sikuli IDE ‚Äî an integrated development environment for writing scripts using screenshots.  With the help of Sikuli Script, you can automate everything that you see on the screen without using internal APIs.  You can programmatically control web pages, applications running on Windows / Linux / Mac OS X, and even iPhone applications running on an emulator. <br><br>  Unexpectedly, a simple script to automate actions was ‚Äúassembled‚Äù and debugged in Sikuli GUI within 15 minutes, most of which went to get acquainted with the documentation and search for optimal visual patterns uniquely characterizing the elements of Facebook web pages. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/193/b4f/74a/193b4f74a33b3a4cd5968b57b05e3215.png" alt="Source Code Screenshot"><br><br>  The screenshot is given due to the peculiarity of the Sikuli syntax, which includes the graphics in the source code. <br><br>  Pay attention to the 11th line in which there is the upper part of the picture frame and the empty space on the left, which is present only on the album photos on the left.  It should be noted that the search and recognition of patterns on the screen Sikuli performs starting from the top left corner, so in our case the first top picture on the left is selected in the album. <br><br>  The click function on the found image <i>click ()</i> performs a click in the geometric center of the specified area.  Increasing the area of ‚Äã‚Äãthe desired pattern in the script can reduce the likelihood of erroneous recognition on similar interface elements. <br><br>  The documentation also suggests that you can use the <i>MinTargetSize</i> parameter to fine-tune the speed of the script: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> org.sikuli.script.natives <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Vision Vision.setParameter(<span class="hljs-string"><span class="hljs-string">"MinTargetSize"</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  , , 6 -   . Vision.setParameter("MinTargetSize", 18) #  ,  18 -  .</span></span></code> </pre> <br><br><h4>  Demonstration of work </h4><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/lDaxIGjZVAQ%3Ffeature%3Doembed&amp;xid=25657,15700022,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhjT7qF-Yl45YYtOafU6qJBxqep9hQ" frameborder="0" allowfullscreen=""></iframe><br>  English captions are inserted for the sake of people who do not own the great and powerful. <br><br>  <b>Download the script</b> <a href="http://narod.ru/disk/27754751001/FacebookAlbumCleaner.sikuli.zip.html">here</a> . <br>  <b>NB!</b>  Most likely, you will have to change the browser name, keyboard shortcuts and wait time between commands for your environment. <br><br>  Interestingly, from GUI, scripts to disk are saved in folders or zip archives (when exporting to an executable format) with nested * .png images, a python source and an HTML page with embedded CSS for highlighting the code, when opened, the browser displays the nested graphics. <br><br><h4>  Conclusion </h4><br>  Sikuli made it possible to solve the problem, perhaps not in the most elegant, but in an effective enough way, while saving time and inspiring to write this article. <br><br>  You can learn more, download and install Sikuli for Linux, Windows and Mac OS X on the official website of the project <a href="http://sikuli.org/">http://sikuli.org</a> . </div><p>Source: <a href="https://habr.com/ru/post/130094/">https://habr.com/ru/post/130094/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130089/index.html">Imitation of named variables in LESS (with an example in jsFiddle)</a></li>
<li><a href="../130090/index.html">Firewalls - a bit of theory for beginners or what you need to know before you buy</a></li>
<li><a href="../130091/index.html">Free software at school or three days spent with benefit</a></li>
<li><a href="../130092/index.html">CPIO under the microscope</a></li>
<li><a href="../130093/index.html">Understanding WinAPI</a></li>
<li><a href="../130095/index.html">German police accused of using spyware</a></li>
<li><a href="../130096/index.html">Choosing a disk system for the database MySQL</a></li>
<li><a href="../130098/index.html">Plex Media Center</a></li>
<li><a href="../130101/index.html">Non-blocking queues: message exchange between threads</a></li>
<li><a href="../130102/index.html">Do you often use bank plastic cards?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>