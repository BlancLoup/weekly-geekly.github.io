<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asterisk: using AEL in everyday life</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we will talk about the integration of Asterisk with a CRM system. We will not consider the question from the CRM side, it‚Äôs enough to know that ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asterisk: using AEL in everyday life</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/1a8/84c/3ff/1a884c3ffd1e8a7847e3b55eb97796bb.png" alt="image"><br><br>  Today we will talk about the integration of Asterisk with a CRM system.  We will not consider the question from the CRM side, it‚Äôs enough to know that CRM wants to know about all calls (both incoming, outgoing and transferred) <br><br>  What <a href="http://centos-admin.ru/">we</a> want to get: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For each call, 2 events should be sent to CRM: start and stop.  Naturally with a bunch of arguments. <br><a name="habracut"></a><br>  To do this, we will call the sh script: <br><br><pre><code class="bash hljs">System(/etc/asterisk/scripts/crm.sh start <span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span> <span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span> <span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span> <span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>);   System(/etc/asterisk/scripts/crm.sh stop <span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span> <span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span> <span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span> <span class="hljs-variable"><span class="hljs-variable">${ID}</span></span> <span class="hljs-variable"><span class="hljs-variable">${CDUR}</span></span>); </code> </pre> <br>  The content of the script itself is not interesting to us, the meaning is that it passes these arguments to the CRM itself, and sometimes even returns something back. <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span> -  / <span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span> - ,     (   popup   ) <span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span> -   <span class="hljs-variable"><span class="hljs-variable">${ID}</span></span> - ID  (      ,     ).   ID   <span class="hljs-variable"><span class="hljs-variable">${UNIQUEID}</span></span>    <span class="hljs-variable"><span class="hljs-variable">${CDUR}</span></span> -  </code> </pre><br>  We will write these two scripts in a macro (by the way, macros in ael work / are called a little differently than in extensions.conf, for this the Gosub command is used. You need to know about this if you want to call a macro, for example, in the Dial command when the handset is picked up by subscriber B Ie to use not M (x) as in extensions.conf, but U (x)) <br><br><pre> <code class="bash hljs">macro crm (GROUP, DSTNUM, CIDNUM, ID) { System(/etc/asterisk/scripts/crm.sh start <span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span> <span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span> <span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span> <span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">return</span></span>; } macro crm-end (GROUP, DSTNUM, CIDNUM, ID) { MSet(CDUR=<span class="hljs-variable"><span class="hljs-variable">${CDR(billsec)}</span></span>); System(/etc/asterisk/scripts/crm.sh stop <span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span> <span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span> <span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span> <span class="hljs-variable"><span class="hljs-variable">${ID}</span></span> <span class="hljs-variable"><span class="hljs-variable">${CDUR}</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">return</span></span>; }</code> </pre><br>  For the organization of outgoing calls, the task turned out to be elementary; <br><br><pre> <code class="bash hljs">context outgoing { _X. =&gt; { Set(GROUP=office1); Set(DSTNUM=<span class="hljs-variable"><span class="hljs-variable">${EXTEN}</span></span>); Set(CIDNUM=<span class="hljs-variable"><span class="hljs-variable">${CALLERID(num)}</span></span>); Set(ID=<span class="hljs-variable"><span class="hljs-variable">${UNIQUEID}</span></span>); &amp;record-crm(<span class="hljs-variable"><span class="hljs-variable">${STRFTIME(,,%G/%m/%d/)}</span></span><span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); &amp;crm(<span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); Dial(SIP/trunk/<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>); }; }</code> </pre><br>  The rules for handling incoming calls are a bit more interesting.  Welcomes us with a proposal to dial an extension number, if the number is not dialed, then send a call to CRM: <br><br><pre> <code class="bash hljs">context inc { 2758725 =&gt; { MSet(DSTNUM=<span class="hljs-variable"><span class="hljs-variable">${EXTEN}</span></span>); MSet(GLOBAL(GROUP)=office1); Gosub(inc-crm,s,1(<span class="hljs-variable"><span class="hljs-variable">${EXTEN}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CALLERID(num)}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${UNIQUEID}</span></span>)) ; }; } context inc-crm { s =&gt; { MSET(DSTNUM=<span class="hljs-variable"><span class="hljs-variable">${ARG1}</span></span>); MSET(GLOBAL(CIDNUM)=<span class="hljs-variable"><span class="hljs-variable">${ARG2}</span></span>); MSet(GLOBAL(ID)=<span class="hljs-variable"><span class="hljs-variable">${ARG3}</span></span>); Background(welcome_message); &amp;crm(<span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); Gosub(redirect,<span class="hljs-variable"><span class="hljs-variable">${DB(crm/key)}</span></span>,1); }; }</code> </pre><br>  We need the context inc in case we have more than one number for incoming calls, we assign some of the variables globally, as they will accompany us in different parts of the dialplan. <br>  &amp; crm ($ {GROUP}, $ {DSTNUM}, $ {CIDNUM}, $ {ID}); <br>  We send the first request to CRM.  If the client is permanent, then CRM will return the number of the responsible manager, and our script will write it to AstDB (asterisk -rx "database put crm key XXX").  If a client is new or a responsible manager is not assigned to him, then CRM will return the group / queue number (this was a bit of a hassle in terms of sending start / stop requests) <br>  Having received a treasured combination of numbers from CRM, we go on. <br><br><pre> <code class="bash hljs">context redirect { 1000 =&gt; { &amp;record-crm(<span class="hljs-variable"><span class="hljs-variable">${STRFTIME(,,%G/%m/%d/)}</span></span><span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); &amp;crm-group(<span class="hljs-variable"><span class="hljs-variable">${QUEUE_MEMBER_LIST(first)}</span></span>,,); Queue(first,tT,,,15,,,<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-arg); }; _1XX =&gt; { &amp;record-crm(<span class="hljs-variable"><span class="hljs-variable">${STRFTIME(,,%G/%m/%d/)}</span></span><span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); &amp;crm(<span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); Dial(SIP/<span class="hljs-variable"><span class="hljs-variable">${EXTEN}</span></span>); }; h =&gt; { NoOP(<span class="hljs-variable"><span class="hljs-variable">${MEMBERINTERFACE}</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-variable"><span class="hljs-variable">${EXISTS(${MEMBERINTERFACE}</span></span>)} ) { MSet(DSTNUM=<span class="hljs-variable"><span class="hljs-variable">${MEMBERINTERFACE:4}</span></span>); &amp;crm-end(<span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); Hangup; }; &amp;crm-group-end(<span class="hljs-variable"><span class="hljs-variable">${QUEUE_MEMBER_LIST(first)}</span></span>,,); }; }</code> </pre><br>  1000 is the group number, a queue will be called here.  In our example, the queue will be limited to 3 agents.  If you want to increase the number of queue agents, add commas after $ {QUEUE_MEMBER_LIST (first)} and a few lines to macro crm-group / crm-group-end.  Commas are needed to call a macro, i.e.  you need to pass as many arguments as the macro waits, you can more accurately pass more arguments, but if you mention this in the dialplan, it will curse and will not work.  $ {QUEUE_MEMBER_LIST (first)} Contains agents in the queue, in the end it turns out that we pass more than 3 arguments to the macro (agents + two empty arguments), but this is no longer a problem.  The main thing is that there are no more agents than the accepted arguments in the macro, otherwise not everyone will get a popup window. <br><br><pre> <code class="bash hljs">macro crm-group ( member1, member2, member3 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">${EXISTS(${member1:4}</span></span>)) { MSet(DSTNUM=<span class="hljs-variable"><span class="hljs-variable">${member1:4}</span></span>)); &amp;crm(<span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">${EXISTS(${member2:4}</span></span>)) { MSet(DSTNUM=<span class="hljs-variable"><span class="hljs-variable">${member2:4}</span></span>); &amp;crm(<span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">${EXISTS(${member3:4}</span></span>)) { MSet(DSTNUM=<span class="hljs-variable"><span class="hljs-variable">${member3:4}</span></span>); &amp;crm(<span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); }; <span class="hljs-built_in"><span class="hljs-built_in">return</span></span>; }</code> </pre><br>  We check if there is an agent, designate it as the one who accepts the call and send a request for a pop-up window. <br><br>  After that, the call goes to the first queue <br><br><pre> <code class="bash hljs">Queue(first,tT,,,15,,,<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-arg);</code> </pre><br>  The main thing is not to get confused in commas.  It seems to be written in the habr rules that you should not use smiles / brackets, but here I could not resist =) <br>  The set-arg macro is called with the Gosub command, if the macro were recorded in extensions.conf, the call would have been written a comma earlier. <br><br><pre> <code class="bash hljs">macro <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-<span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">arg</span></span></span></span> () { &amp;crm-group-end(<span class="hljs-variable"><span class="hljs-variable">${QUEUE_MEMBER_LIST(first)}</span></span>,,); <span class="hljs-built_in"><span class="hljs-built_in">return</span></span>; }</code> </pre><br>  I failed to pass arguments from the Queue command, so I had to resort to this small macro. <br><br><pre> <code class="bash hljs">macro crm-group-end ( member1, member2, member3 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-variable"><span class="hljs-variable">${EXISTS(${member1:4}</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">${member1:4}</span></span>!=<span class="hljs-variable"><span class="hljs-variable">${CHANNEL(peername)}</span></span>){ MSet(DSTNUM=<span class="hljs-variable"><span class="hljs-variable">${member1:4}</span></span>); &amp;crm-end(<span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); }; }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-variable"><span class="hljs-variable">${EXISTS(${member2:4}</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">${member2:4}</span></span>!=<span class="hljs-variable"><span class="hljs-variable">${CHANNEL(peername)}</span></span>){ MSet(DSTNUM=<span class="hljs-variable"><span class="hljs-variable">${member2:4}</span></span>); &amp;crm-end(<span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); }; }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-variable"><span class="hljs-variable">${EXISTS(${member3:4}</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">${member3:4}</span></span>!=<span class="hljs-variable"><span class="hljs-variable">${CHANNEL(peername)}</span></span>){ MSet(DSTNUM=<span class="hljs-variable"><span class="hljs-variable">${member3:4}</span></span>); &amp;crm-end(<span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); }; }; <span class="hljs-built_in"><span class="hljs-built_in">return</span></span>; }</code> </pre><br>  Again, as with the start request, we check the presence of agents, compare the queue agent with the one who picked up the phone ($ {CHANNEL}) and, if there is no match, send the stop (we don‚Äôt need a pop-up window). <br><br>  The manager talked with the client, the conversation is over, and we need to inform our CRM about it.  Returning to the redirect context <br><br><pre> <code class="bash hljs">h =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-variable"><span class="hljs-variable">${EXISTS(${MEMBERINTERFACE}</span></span>)} ) { MSet(DSTNUM=<span class="hljs-variable"><span class="hljs-variable">${MEMBERINTERFACE:4}</span></span>); &amp;crm-end(<span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); Hangup; }; &amp;crm-group-end(<span class="hljs-variable"><span class="hljs-variable">${QUEUE_MEMBER_LIST(first)}</span></span>,,); };</code> </pre><br>  Here we check the availability of $ {MEMBERINTERFACE}, in other words, whether the call was processed by one of the agents, if so, send to CRM stop for this agent, if the call is broken, then we send the stop to all agents of the queue. <br>  It remains for us to consider the option with call transfer.  In order not to lose clients during the transfer, we use the involved transfer (in features.conf I assigned #) to it.  To supplement the transfer function of sending requests to CRM, reassign context for it.  In my case, this is done for all calls, because I just added TRANSFER_CONTEXT = transfer in the globals section; <br><br>  Go to the context itself: <br><pre> <code class="bash hljs">context transfer { _1XX =&gt; { MSET(DSTNUM=<span class="hljs-variable"><span class="hljs-variable">${EXTEN}</span></span>); &amp;crm(<span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); Dial(SIP/<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>); }; h =&gt; { &amp;crm-end(<span class="hljs-variable"><span class="hljs-variable">${GROUP}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${DSTNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CIDNUM}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${ID}</span></span>); }; }</code> </pre><br>  We receive an incoming call, click # 100, CRM goes to start with number 100 (to whom we transfer the call) and customer number.  The manager with the number 100 receives a popup window, his colleague can add a few words about the mood of the client and hang up.  The transfer is complete.  At this stage, a stop request is sent to call one manager to another. <br><br>  At the end of the manager's conversation with the client, two stop requests will be sent - for the first and second managers, because they both talked to the client. <br><br>  Author: system administrator of the <a href="http://centos-admin.ru/">company Centos-admin.ru</a> <a href="http://habrahabr.ru/users/artzcom/" class="user_link">artzcom</a> . </div><p>Source: <a href="https://habr.com/ru/post/269053/">https://habr.com/ru/post/269053/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269039/index.html">PHP Digest 72 - interesting news, materials and tools (October 5 - 18, 2015)</a></li>
<li><a href="../269041/index.html">Solving common problems when building an Xcode project generated by Unity3D</a></li>
<li><a href="../269045/index.html">Phone numbers in email clients</a></li>
<li><a href="../269049/index.html">Serge - the solution for continuous localization from Evernote</a></li>
<li><a href="../269051/index.html">Converting multi-page xls / xslx to csv with PHPExcel</a></li>
<li><a href="../269055/index.html">Pulling information from the URL, in the style of Slack and Twitter</a></li>
<li><a href="../269057/index.html">Very handy abstract adapter for RecyclerView do it yourself</a></li>
<li><a href="../269059/index.html">Detective story - What do auto.ru and brazzers have in common?</a></li>
<li><a href="../26906/index.html">Starter Plucker Notes</a></li>
<li><a href="../269061/index.html">Steam Protocol v2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>