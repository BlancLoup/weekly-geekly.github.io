<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We understand what was discovered there in the problem of queens</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A couple of months ago, an interesting article appeared with an analysis of the classical problem of placing queens on a chessboard (see details and h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We understand what was discovered there in the problem of queens</h1><div class="post__text post__text-html js-mediator-article"><p>  A couple of months ago, an <a href="http://www.jair.org/papers/paper5512.html">interesting article</a> appeared with an analysis of the classical problem of placing queens on a chessboard (see details and history below).  The task is incredibly well known and everything has already been examined under a microscope, so it was surprising that something really new had appeared. </p><br><p> <a href="https://habr.ru/topic/343738/"><img src="https://habrastorage.org/web/21b/c20/ab9/21bc20ab9a964a86886b5fff17a94799.png" alt="image"><br></a>  Can you put six more?  And find all the solutions? <br>  (picture from the article) </p><br><p>  Further, unfortunately, there was some completely unintelligible story from the chain of such transformations: </p><br><ul><li>  Excellent article --- University press service ---&gt; <a href="https://www.st-andrews.ac.uk/news/archive/2017/title,1539813,en.php">unintelligible press release</a> . </li><li>  Press release --- amusing translation ---&gt; <a href="https://geektimes.ru/post/292631/">incomprehensible article on Hyktimes</a> </li></ul><br><p>  It is worth noting that five at random open links in Russian even less clarified the picture of what is happening. </p><br><p>  I thought here - it would be necessary for someone to interrupt this strange chain and state the essence of events in a normal language. </p><br><p>  What will be discussed: </p><br><ul><li>  <a href="https://habr.ru/post/343738/">Task history</a> <br><ul><li>  <a href="https://habr.ru/post/343738/">Latin square</a> </li><li>  <a href="https://habr.ru/post/343738/">The eight queens problem</a> </li></ul></li><li>  <a href="https://habr.ru/post/343738/">Three types of "queens" problem</a> <br><ul><li>  <a href="https://habr.ru/post/343738/">Arrangement of N Queens</a> </li><li>  <a href="https://habr.ru/post/343738/">Count the number of decisions</a> </li><li>  <a href="https://habr.ru/post/343738/">Addition to N Queens</a> </li><li>  <a href="https://habr.ru/post/343738/">Task variations</a> </li></ul></li><li>  <a href="https://habr.ru/post/343738/">Models and complexity</a> <br><ul><li>  <a href="https://habr.ru/post/343738/">Linear Search for N Queens</a> </li><li>  <a href="https://habr.ru/post/343738/">How to count the number of solutions in practice</a> </li><li>  <a href="https://habr.ru/post/343738/">Supplement to N</a> </li></ul></li><li>  <a href="https://habr.ru/post/343738/">findings</a> <a name="habracut"></a><br><a name="history"></a><br><h1 id="istoriya-zadachi">  Task history </h1><br><a name="latin_square"></a><br><h4 id="latinskiy-kvadrat">  Latin square </h4><br><p>  The task has been known since antiquity ( <a href="http://vbn.aau.dk/files/13649565/R-2007-32.pdf">~ the Middle Ages</a> ), it is necessary to arrange the letters so that in one line and in one column they are not the same, as for example here: <br></p><br><img src="https://habrastorage.org/webt/v-/rc/dv/v-rcdvodzfiti5c_chseegucqns.jpeg"><br><br>  The name Latin Square itself received due to the habit of using Latin letters by Leonard Euler for this task.  From the Latin square (and a number of similar problems), new ones naturally appeared, such as the problem of queens, where an additional constraint on the diagonal is added. <br><a name="eight_queens"></a><br><h4 id="zadacha-o-vosmi-ferzyah">  The eight queens problem </h4></li></ul><br><p>  The task was invented in 1848 by <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D1%2585%25D0%25BC%25D0%25B0%25D1%2582%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BA%25D0%25BE%25D0%25BC%25D0%25BF%25D0%25BE%25D0%25B7%25D0%25B8%25D1%2582%25D0%25BE%25D1%2580">chess composer</a> Max Bezsel: the essence of the task is to arrange 8 queens on a chessboard so that they do not attack each other.  Since then, many mathematicians, such as Gauss, have been working on the problem, and algorithmic scientists and programmers, such as Dijkstra, have come up with many approaches to finding and counting solutions. </p><br><p>  In the problem we are going to talk about, not 8 queens, but N and the board, respectively, are not ordinary chess, but NxN. </p><br><a name="types"></a><br><h1 id="tri-tipa-zadachi-o-ferzyah">  Three types of "queens" problem </h1><br><p>  There are three most popular queen problem statements. </p><br><a name="classic"></a><br><h4 id="rasstanovka-n-ferzey">  Arrangement of N Queens </h4><br><p>  The task is formulated very straightforwardly. </p><br><p>  <strong>Given</strong> : empty NxN board, for example 8x8 <br></p><br><img src="https://habrastorage.org/webt/bs/r5/qa/bsr5qa2v5xnehuo3_0tphlmouc4.png"><br><p>  (in principle, it is clear that simply specify N, but so clearer) </p><br><p>  <strong>Find</strong> : Arrangement of the maximum possible number of queens <br></p><br><img src="https://habrastorage.org/webt/ak/9f/ws/ak9fwswmot2heeiytw0odv-7awg.png" width="600"><br><br>  Those.  at the input the number is the size of the board, and at the exit the position of queens (one solution). <br><a name="counting_problem"></a><br><h4 id="podschet-chisla-resheniy">  Count the number of decisions </h4><br><p>  The task is also quite simple: </p><br><p>  <strong>Given:</strong> size of empty board N <br>  <strong>Find:</strong> H is the number of possible arrangements of N queens on the board. </p><br><p>  For example, the size of the board is N = 1, then the number of possible arrangements is H = 1. <br>  N = 8 =&gt; H = 92. </p><br><a name="completion"></a><br><h4 id="dopolnenie-do-n-ferzey">  Addition to N Queens </h4><br><p>  Here the wording is a bit more insidious: </p><br><p>  <strong>Given:</strong> board size N and M positions of already established queens <br>  <strong>Find:</strong> Positions Remaining N - M Queens </p><br><p>  Visually, everything is like on KPDV: <br></p><br><img src="https://habrastorage.org/webt/gz/x7/uu/gzx7uumqgljk6on_m3zsr65d1fe.png"><br><p>  (picture is also from the original article) </p><br><a name="other"></a><br><h4 id="variacii-zadachi">  Task variations </h4><br><p>  Generally speaking, there are more variations of the problem: see for example: the arrangement of white and black queens <br>  <a href="http://www.csplib.org/Problems/prob110">http://www.csplib.org/Problems/prob110</a> <br>  however, here we consider only the main classic version. </p><br><p>  In such a variation, the solutions are significantly different (White does not beat White, and Black does not Black: in case of confusion, see the <a href="https://habrahabr.ru/post/343738/%3Freply_to%3D10552574">comments here</a> ): <br></p><br><img width="600" src="https://habrastorage.org/webt/9h/f6/_c/9hf6_c0z8qserlik5f_g3yh95ks.png"><br><p>  (here is the maximum number of queens, and in the place of the cross you can put white, and in place of the black point - but not both at once; taken from the <a href="https://www.researchgate.net/publication/221353569_Models_and_Symmetry_Breaking_for_%2527Peaceable_Armies_of_Queens%2527">article</a> ) </p><br><a name="problems"></a><br><h1 id="modeli-i-slozhnost-zadach">  Models and complexity of tasks </h1><br><p>  The time has come to actually discuss: how does this decide everything and how quickly can this be done at all? </p><br><a name="linear"></a><br><h4 id="lineynyy-poisk-dlya-klassicheskoy-zadachi">  Linear search for a classic task </h4><br><p>  The most interesting point is that even experts sometimes get confused and think that to solve the N-queens, a combinatorial search is needed and they think that the complexity of the problem is higher than P. About the fact that P and NP are once wrote on Habr√©: <a href="https://habrahabr.ru/post/207112/">Why do we all need SAT and all these P-NP (part one)</a> and the <a href="https://habrahabr.ru/post/208774/">second here</a> .  However, the problem is solved <strong>without going through the</strong> options!  That is, for a board of any size, you can always arrange the queens one by one in the following ladder: </p><br><img width="600" src="https://habrastorage.org/webt/gt/i5/ox/gti5oxluamrjkcfeqy_5f1r7ewc.png"><br><p>  There are a number of alignment algorithms, for example, see <a href="https://www.researchgate.net/publication/234812180_Explicit_solutions_to_the_N_-queens_problem_for_all_N">this article</a> or <a href="https://en.wikipedia.org/wiki/Eight_queens_puzzle">even here in the wiki</a> . </p><br><p>  Hence the conclusion, for N = 1 and N&gt; 3 there is always a solution (see algo), and for N = 2 or N = 3 <br>  always not (trivially follows from the board).  This means that the solvability problem for N queens (where you need to say if there is a solution or not) is solved trivially in a constant time (well, ok, constructively linear - to arrange / check). </p><br><p>  It's time to double-check what we read, we read the typical title ‚Äúthe N Queens problem was recognized as an NP-complete task‚Äù - did you have your eyes flush? </p><br><a name="counting"></a><br><h4 id="kak-schitat-chislo-resheniy-na-praktike">  How to count the number of solutions in practice </h4><br><p>  This is where the most interesting begins: the number of solutions for the queens placement problem even has its own name - ‚Äú <a href="https://oeis.org/A000170">A000170</a> sequence‚Äù.  This is where the good news ends.  The complexity of the problem: above NP and P #, in practice this means that the optimal solution is to download the sequence data to the dictionary and return the desired number.  Since for N = 27 it was already considered on a parallel cluster for how many weeks there. </p><br><p>  <strong>Solution</strong> : write out a label and n, return a (n) <br>  na (n) <br>  eleven <br>  20 <br>  thirty <br>  4: 2 <br>  5:10 <br>  6-4 <br>  7:40 <br>  8: 92 <br>  9: 352 <br>  10: 724 <br>  ... <br>  21: 314666222712 <br>  22: 2691008701644 <br>  23: 24233937684440 <br>  24: 227514171973736 <br>  25: 2207893435808352 <br>  26 22317699616364044 <br>  27: 234907967154122528 </p><br><p>  However, if you have some tricky version of the problem and still need to calculate the solutions (and their number is unknown and no one considered them before), then the best version of the prototype is discussed below. </p><br><a name="asp"></a><br><h4 id="dopolnenie-do-n-i-answer-set-programming">  Addition to N and Answer Set Programming </h4><br><p>  Here the most interesting begins: what is the new result of the article?  <strong>The task of complementing to N queens is NP-complete</strong> !  (Interestingly, the NP-completeness of the Latin square addition <a href="http://www.sciencedirect.com/science/article/pii/0166218X84900751%3Fvia%253Dihub">was known</a> as far back as 1984.) </p><br><p>  What does this mean in practice?  The easiest way to solve this problem (or suddenly, if we need its variation) is to use SAT.  However, I prefer the following analogy: </p><br><p> SAT is an assembler for combinatorial NP-problems, and Answer Set Programming (ASP) is C ++ (the ASP also has a mysterious Russian soul: it is at times confused and unpredictable for the uninitiated; by the way, the <a href="">theory underlying modern ASP has</a> been invented in 1988, by Mikhail Gelfond and Vladimir Lifshits, then working at the universities of Texas and Stanford, respectively). </p><br><p>  To put it simply, ASP is a declarative constraint programming language (constraints in English literature) with Prolog syntax.  That is, we write down what constraints the solution must satisfy, and the system reduces everything to the SAT version and finds a solution for us. </p><br><p>  The details of the solution are not so important here, and Answer Set Programming is worthy of a separate post (which is already indecently long in my draft): therefore, we‚Äôll analyze conceptual points </p><br><pre><code class="hljs pgsql">% <span class="hljs-keyword"><span class="hljs-keyword">domain</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>(<span class="hljs-number"><span class="hljs-number">1.</span></span>.n). <span class="hljs-keyword"><span class="hljs-keyword">column</span></span>(<span class="hljs-number"><span class="hljs-number">1.</span></span>.n). % alldifferent <span class="hljs-number"><span class="hljs-number">1</span></span> { queen(X,Y) : <span class="hljs-keyword"><span class="hljs-keyword">column</span></span>(Y) } <span class="hljs-number"><span class="hljs-number">1</span></span> :- <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>(X). <span class="hljs-number"><span class="hljs-number">1</span></span> { queen(X,Y) : <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>(X) } <span class="hljs-number"><span class="hljs-number">1</span></span> :- <span class="hljs-keyword"><span class="hljs-keyword">column</span></span>(Y). % remove conflicting answers :- queen(X1,Y1), queen(X2,Y2), X1 &lt; X2, Y1 == Y2. :- queen(X1,Y1), queen(X2,Y2), X1 &lt; X2, Y1 + X1 == Y2 + X2. :- queen(X1,Y1), queen(X2,Y2), X1 &lt; X2, Y1 - X1 == Y2 - X2.</code> </pre> <br><p>  Line <code>1 { queen(X,Y) : column(Y) } 1 :- row(X).</code>  - called the choice rule, and it determines what is a valid search space. </p><br><p>  The last three lines are called integrity constraints: and they determine what constraints the solution should satisfy: there can be no queen in the same row, no queen in the same column (omitted due to symmetry) and no queen on the same diagonal. </p><br><p>  As a system for experiments, I recommend <a href="https://github.com/potassco/clingo">Clingo</a> . <br>  And for starters, it is worth watching their <a href="https://potassco.org/doc/start/">tutorial</a> and post a blog at <a href="http://www.hakank.org/constraint_programming_blog/2010/12/a_first_look_at_answer_set_programming.html">www.hakank.org</a> . </p><br><p>  Of course, if you write on ASP for the first time, then the first model will not work incredibly efficient and fast, but most likely it will be faster to bust with a return written in haste.  However, if you understand the basic principles of the system, ASP can become "regexp for NP-complete tasks." </p><br><p>  Let's conduct a simple numerical experiment with our ASP model.  I added 5 insidious queens to the model and ran a search for a solution for N from 1 to 150 and this is what happened (running on a regular home laptop): <br></p><br><img src="https://habrastorage.org/webt/p5/jw/v1/p5jwv1vi3ymiufgliyrjhy_8fcc.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>  So, our ASP model can find solutions for the add-on problem for about a minute with N &lt;= 150 (in the usual case).  This shows that the system is excellent for prototyping models of complex combinatorial problems. </p><br><a name="conclusions"></a><br><h1 id="vyvody">  findings </h1><br><ul><li>  The new result is connected not with the classical problem of 8 queens, but with the addition of the generalized problem of queens (which is interesting, but on the whole is natural); </li><li>  The complexity increases significantly, because, by slyly putting the queens on the board, you can knock down an algorithm that puts the queens on some fixed pattern; </li><li>  It is impossible to effectively calculate the number of solutions (well, absolutely; until some horror happens and P is not equal to NP, etc.); </li><li>  Perhaps this result will affect the work of modern SAT systems, as some experts believe that this task is somewhat simpler than the classic NP-complete tasks (but this is just an opinion) </li><li>  If for some reason you need to solve a similar task for some reason, it is best to use the systems Alla Answer Set Programming, specially designed for this purpose. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/343738/">https://habr.com/ru/post/343738/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343726/index.html">Hinton's capsule nets</a></li>
<li><a href="../343728/index.html">Unity game, open source</a></li>
<li><a href="../343730/index.html">We write DSL in Koltin</a></li>
<li><a href="../343732/index.html">Corporate "stuffing" for small networks</a></li>
<li><a href="../343736/index.html">Avtomatny workshop - 2. Example "Crossing", the mathematical transformations of TK in OA</a></li>
<li><a href="../343740/index.html">Security Week 48: Root Access for Diligence, Miner Consultant and Trial Macro Malware</a></li>
<li><a href="../343744/index.html">We integrate smartcontract into the web application on Nodejs</a></li>
<li><a href="../343748/index.html">Garbage collection and lifetime of objects</a></li>
<li><a href="../343750/index.html">Release of the second version of the Nodejs plugin for Sublime Text</a></li>
<li><a href="../343752/index.html">Welford method and multidimensional linear regression</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>