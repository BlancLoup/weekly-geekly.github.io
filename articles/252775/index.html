<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Software creation of NinePatchDrawable</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The new Android Lollipop has such an interesting component as VectorDrawable . If you use it wisely, you can significantly reduce the volume of the ap...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Software creation of NinePatchDrawable</h1><div class="post__text post__text-html js-mediator-article">  The new Android Lollipop has such an interesting component as <a href="http://developer.android.com/reference/android/graphics/drawable/VectorDrawable.html">VectorDrawable</a> .  If you use it wisely, you can significantly reduce the volume of the application, saving on graphics resources, plus the use of vector graphics frees us from the dreary process of creating images for different screen densities.  The first thought that came to me when I saw VectorDrawable was: ‚ÄúWow!  Can you pull him up like a <a href="http://developer.android.com/guide/topics/graphics/2d-graphics.html">NinePatch</a> ? ‚Äù.  It turned out impossible.  Here one could be a little upset and be content with the fact that at least icons can be kept in a vector.  However, I decided not to stop there.  The result was a <a href="https://github.com/KamiSempai/NinePatchBuildUtils">universal utility</a> that can make NinePatchDrawable out of any Drawable. <br><br><img src="https://habrastorage.org/files/535/be6/593/535be65930be4d71a565d79bac0a46ee.png"><br><br>  In the image you see, a vector is used, but it is spread out in the center.  And this is amazing!  The ability to stretch the vector only in certain areas provides, in truth, tremendous opportunities.  And if you consider that <a href="https://github.com/telly/MrVector">there are projects</a> that allow you to use the vector on earlier versions of the android, vector images begin to show themselves in all their glory. <br><a name="habracut"></a><br>  Before we start the miraculous transformation, let's get into the details and find out how we can achieve the desired result.  First, let's try to understand what NinePatchDrawable is.  And it consists of two main parts, the first of which is a Bitmap, and the second array of bytes, called ‚Äúchunk‚Äù, contains information about how to stretch this Bitmap.  From this it follows that with any Bitmap and the corresponding ‚Äúchunk‚Äù in its hands, it is possible to create NinePatchDrawable to bypass the standard model: create 9.png, put it into a project, compile it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, in practice, not everything is so simple.  The fact is that, in fact, it is not realistic to find documentation about how a ‚Äúchunk‚Äù is formed.  Its generation, still at the compilation stage, is handled by the aapt utility, and in the android API there is not a single class that helps in ‚Äúchunk‚Äù generation.  I managed to find out what the bulk of the array is.  Frankly, I do not fully understand what byte is responsible for what, but this was enough. <br><br><h3>  What is ‚Äúchunk‚Äù? </h3><br>  Let's sort this array by bytes.  Bytes, the purpose of which I do not know, I decided to call the "magic", because of their mystery and mystery.  So: <br><ul><li>  [0] - wasDeserialized flag; </li><li>  [1] - indicates the number of points in the XDivs array; </li><li>  [2] - indicates the number of points in the array YDivs; </li><li>  [3] - indicates the number of points in the Colors array; </li><li>  [4-11] - 8 "magic" bytes; </li><li>  [12-27] - 16 bytes for Padding; </li><li>  [28-31] - 4 "magic" bytes; </li><li>  [32- ~] - Next is the enumeration of XDivs, YDivs and Colors arrays. </li></ul><br>  The zero byte stores the boolean value ‚ÄúwasDeserialized‚Äù.  In all the examples I found, it says that it should be 0x01, but if you specify instead any other value or anything terrible happens, it will automatically be set to true when converting the ‚Äúchunk‚Äù array to a native object. <br><br>  Padding, XDivs, YDivs and Colors data is stored in int (4 bytes).  By the way, this is why Padding does not occupy 4 bytes, by the number of sides, but 16 bytes. <br><br>  XDivs and YDivs contain areas for stretching along the X and Y axes. The score is kept from scratch.  The first number indicates the beginning of the first field, the next at its end, and so on.  Then, the following array is described in the same way. <br><br>  As an example, let's look at the NinePatch image 6 by 6. <br><br><img src="https://habrastorage.org/files/419/c11/3db/419c113db92c4a38b2006770fb6afa1d.png"><br><br>  Here, a stretchable region along the X axis extends from 2 to 3 pixels, and along the Y axis from 2 to 4. This means that XDivs will consist of [0x02, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00], and YDivs of [ 0x02, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00].  As the first (second in order) and second (third in order) bytes of the ‚Äúchunk‚Äù array, defining the size of XDivs and YDivs, you should specify 0x02, which means 2 points of 4 bytes each. <br><br>  For a better understanding of what should be stored in the Colors array, I made some small changes to the previous image, let's look at it again. <br><br><img src="https://habrastorage.org/files/050/e6f/9ce/050e6f9ce64f470d9035ab0e9ba96f70.png"><br><br>  As can be seen from the figure, the image can be divided into 9 regions.  Colors defines how to draw these regions.  There are 2 options: <br><br><ol><li>  0x00000000 (TRASPARENT) region will be transparent. </li><li>  0x00000001 (NO_COLOR) region will be visible. </li></ol><br>  As it might seem from the name, Colors is responsible for a certain color, however, in this case, its purpose is much more trivial - to indicate the visibility of the region. <br>  For the above image, if we want to leave all the regions visible, we need to specify [0x01, 0x00, 0x00, 0x00] 9 times, and for 3 bytes (4 in order) of the ‚Äúchunk‚Äù array, set the value to 0x09. <br><br>  <b>A curious note:</b> apparently, the native code involved in drawing is still on the sizes of the Colors array, he himself knows how many regions the image has, and will receive them no matter what size we set for Colors.  As a result, there will be an access to the memory area outside our array, as a result, we will get the disappearing sectors that appear, from one drawing to another. <br><br>  At first, I wondered if this was enough for me to create a full-fledged NinePatch.  It turned out enough.  The fact is that NinePatch, before using a ‚Äúchunk‚Äù, converts it with the power of the validateNinePatchChunk method into a native Res_png_9patch object.  If you look at the source code, you can see by the code, incomprehensible bytes for us are not used, which means you can fill them with any values, such as zeros. <br><br><h3>  NinePatchBuilder </h3><br>  Now, knowing how to generate ‚Äúchunk‚Äù, it will not be difficult to create NinePatch from any image, including Drawable, if you first draw it on a Bitmap.  To simplify these steps, I decided to create a class <a href="">NinePatchBuilder</a> . <br><br>  The following code shows how to use it in the case of regular Bitmap. <br><br><pre><code class="java hljs">NinePatchBuilder ninePatchBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NinePatchBuilder(getResources()) .addStretchSegmentX(<span class="hljs-number"><span class="hljs-number">0.49f</span></span>, <span class="hljs-number"><span class="hljs-number">0.51f</span></span>) .addStretchSegmentY(<span class="hljs-number"><span class="hljs-number">0.49f</span></span>, <span class="hljs-number"><span class="hljs-number">0.51f</span></span>) .setBitmap(bitmap); Drawable drawable = ninePatchBuilder.build();</code> </pre> <br>  The addStretchSegment methods specify areas for stretching.  Since, when creating the NinePatch, images can be used whose size is not known in advance, it was decided to use relative sizes in the range [0, 1].  When you call build, depending on the settings and the size of the Bitmap, an array of ‚Äúchunk‚Äù will be formed and NinePatchDrawable will be created. <br><br>  This is what happens inside NinePatchBuilder: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//   NinePatchBuilder. private Drawable buildFromBitmap(Bitmap bitmap) { return new NinePatchDrawable(mResources, bitmap, getChunkByteArray(bitmap), getPaddingRect(bitmap.getWidth(), bitmap.getHeight()), mSrcName); }</span></span></code> </pre><br>  The code for the getChunkByteArray method will not be given, since most of its implementation follows from the previously described ‚Äúchunk‚Äù generation algorithm. <br><br>  Similarly for Drawable.  Anything can be a Drawable here, including VectorDrawable.  As a result, having only one vector image, we get a complete set of NinePatchDrawable, for all screen densities! <br>  Suppose we have a vector image. <br><br><div class="spoiler">  <b class="spoiler_title">android.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"500dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"500dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:viewportWidth</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"500"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:viewportHeight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"500"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">path</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:fillColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#9FBF3B"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:pathData</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"M301.314,83.298l20.159-29.272c1.197-1.74,0.899-4.024-0.666-5.104c-1.563-1.074-3.805-0.543-4.993,1.199 L294.863,80.53c-13.807-5.439-29.139-8.47-45.299-8.47c-16.16,0-31.496,3.028-45.302,8.47l-20.948-30.41 c-1.201-1.74-3.439-2.273-5.003-1.199c-1.564,1.077-1.861,3.362-0.664,5.104l20.166,29.272 c-32.063,14.916-54.548,43.26-57.413,76.34h218.316C355.861,126.557,333.375,98.214,301.314,83.298"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">path</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:fillColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFFFF"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:pathData</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"M203.956,129.438c-6.673,0-12.08-5.407-12.08-12.079c0-6.671,5.404-12.08,12.08-12.08 c6.668,0,12.073,5.407,12.073,12.08C216.03,124.03,210.624,129.438,203.956,129.438"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">path</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:fillColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFFFF"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:pathData</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"M295.161,129.438c-6.668,0-12.074-5.407-12.074-12.079c0-6.673,5.406-12.08,12.074-12.08 c6.675,0,12.079,5.409,12.079,12.08C307.24,124.03,301.834,129.438,295.161,129.438"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">path</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:fillColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#9FBF3B"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:pathData</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"M126.383,297.598c0,13.45-10.904,24.354-24.355,24.354l0,0c-13.45,0-24.354-10.904-24.354-24.354V199.09 c0-13.45,10.904-24.354,24.354-24.354l0,0c13.451,0,24.355,10.904,24.355,24.354V297.598z"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">path</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:fillColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#9FBF3B"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:pathData</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"M140.396,175.489v177.915c0,10.566,8.566,19.133,19.135,19.133h22.633v54.744 c0,13.451,10.903,24.354,24.354,24.354c13.451,0,24.355-10.903,24.355-24.354v-54.744h37.371v54.744 c0,13.451,10.902,24.354,24.354,24.354s24.354-10.903,24.354-24.354v-54.744h22.633c10.569,0,19.137-8.562,19.137-19.133V175.489 H140.396z"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">path</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:fillColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#9FBF3B"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:pathData</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"M372.734,297.598c0,13.45,10.903,24.354,24.354,24.354l0,0c13.45,0,24.354-10.904,24.354-24.354V199.09 c0-13.45-10.904-24.354-24.354-24.354l0,0c-13.451,0-24.354,10.904-24.354,24.354V297.598z"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br>  Convert it to NinePatch is easy. <br><br><pre> <code class="java hljs">NinePatchBuilder ninePatchBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NinePatchBuilder(resources) .addStretchSegmentX(<span class="hljs-number"><span class="hljs-number">0.49f</span></span>, <span class="hljs-number"><span class="hljs-number">0.51f</span></span>) .addStretchSegmentY(<span class="hljs-number"><span class="hljs-number">0.49f</span></span>, <span class="hljs-number"><span class="hljs-number">0.51f</span></span>) .setDrawable(R.drawable.android, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) resources.getDimension(R.dimen.android_width), (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) resources.getDimension(R.dimen.android_height));</code> </pre><br>  Additionally, you must specify the dimensions in pixels, since not all Drawable have fixed sizes.  At the time of the call to build, Drawable will be drawn on the Bitmap and this Bitmap is already used to create the NinePacthDrawable. <br><br><h3>  Special cases </h3><br>  Naturally, blindly use Drawable Drawable, not always a good solution, as there are, for example, <a href="http://developer.android.com/reference/android/graphics/drawable/DrawableContainer.html">DrawableContainer</a> and its heirs.  To support such complex objects had to go to a certain trick. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//   NinePatchBuilder. if (drawable instanceof DrawableContainer) { final XmlPullParser parser = mResources.getXml(drawableId); final AttributeSet attrs = Xml.asAttributeSet(parser); int type = XmlPullParser.START_DOCUMENT; try { while ((type=parser.next()) != XmlPullParser.START_TAG &amp;&amp; type != XmlPullParser.END_DOCUMENT) { // Empty loop } } catch (XmlPullParserException | IOException e) { e.printStackTrace(); } if (type == XmlPullParser.START_TAG) { Drawable result = null; try { result = drawable.getClass().newInstance(); } catch (InstantiationException | IllegalAccessException e) { e.printStackTrace(); } if (result != null) { try { result.inflate(new ResourceWrapper(mResources), parser, attrs); return result; } catch (XmlPullParserException | IOException e) { e.printStackTrace(); } } } }</span></span></code> </pre><br>  This is part of the code from NinePatchBuilder, it creates a new Drawable of the same class as the original using Class.newInstance (), and then fills it with the inflate method.  All this is similar to what happens inside a LayoutInflater, with the exception of ResourceWrapper.  In it lies the whole essence.  If you look into the work of the inflate method, then we will see that the child Drawables are obtained by the getDrawable method from the resources transferred as a parameter.  To obtain the desired result, simply override this method. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//   NinePatchBuilder. private class ResourceWrapper extends Resources { public ResourceWrapper(Resources resources) { super(resources.getAssets(), resources.getDisplayMetrics(), resources.getConfiguration()); } @Override public Drawable getDrawable(int id) throws NotFoundException { return buildFromDrawable(id, mDrawableWidth, mDrawableHeight); } @Override public Drawable getDrawable(int id, Theme theme) throws NotFoundException { return buildFromDrawable(id, mDrawableWidth, mDrawableHeight); } }</span></span></code> </pre><br>  Thanks to this ‚Äútink of ears‚Äù we have implemented full support for all heirs of the DrawableContainer with any nesting level, and if you convert a StateListDrawable, then the output will be a StateListDrawable consisting of NinePatchDrawable. <br><br><h3>  XML and caching </h3><br>  One builder was not enough for me, I decided to go ahead and make a <a href="">NinePatchInflater</a> class that collects NinePatch from an XML file.  As a result, our Drawable can be described as follows: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nine-patch-plus</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:auto</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">auto:src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">auto:width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/android_width"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">auto:height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/android_height"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">auto:stretchX</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.49, 0.51"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">auto:stretchY</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.49, 0.51"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  The file must be in the ‚Äúxml‚Äù folder.  Now, the code involved in creating such a drawable can be reduced to a single line. <br><br><pre> <code class="java hljs">Drawable drawable = NinePatchInflater.inflate(resources, R.xml.vector_drawable_nine_patch);</code> </pre><br>  In addition to making most of the code in a separate file, inflater has another big plus - caching by resource id.  The fact is that creating a drawable can be a very expensive operation, especially in our case, when you need to create a bunch of unnecessary objects in the future to get one Drawable.  Fortunately, most of the necessary work has already been done in the ConstantState class, we only need to save ConstantState created Drawables in the cache and, if necessary, create new Drawables using the ConstantState.newDrawable () method.  I will not go into details, the article turned out to be so expanded, and besides, I didn‚Äôt invent anything new, this is how caching takes place in the Resources class. <br><br><h3>  Conclusion </h3><br>  It turned out quite well, however, to create a full-fledged wrapper over resources so that it would be possible to insert links to these files directly into XML markup, without resorting to writing program code, and it did not work out.  As it turned out, when creating a View, in some places, methods with the access modifier ‚Äúby default‚Äù are used, and sometimes the static methods of the Drawable class are called directly.  Despite this, I believe that the desired result was achieved, although not fully. <br><br>  GitHub project: <a href="https://github.com/KamiSempai/NinePatchBuildUtils">NinePatchBuildUtils</a> <br><br><div class="spoiler">  <b class="spoiler_title">How to connect to your project</b> <div class="spoiler_text">  There are 2 options. <br>  Option 1 (in the forehead): <br><ul><li>  Copy the folder with the module "ninepatchbuildutils" to your project </li><li>  Add to the settings.gradle file: <br><pre> <code class="xml hljs">include ':ninepatchbuildutils'</code> </pre> </li><li>  Add dependency to file build.gradle of application module: <br><pre> <code class="xml hljs">compile project(':ninepatchbuildutils')</code> </pre> </li><li>  Rebuild project </li></ul><br>  Option 2 (elegant): <br><br><ul><li>  Download the project from the gita to a separate folder, for example ‚ÄúNinePatchBuildUtils‚Äù </li><li>  Add to the settings.gradle file: <br><pre> <code class="xml hljs">include ':ninepatchbuildutils' project(':ninepatchbuildutils').projectDir = new File('<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span><span class="hljs-tag">    &gt;</span></span>/NinePatchBuildUtils/ninepatchbuildutils/')</code> </pre>  You can also use a relative path: <br><pre> <code class="xml hljs">project(':ninepatchbuildutils').projectDir = new File(settingsDir, '../NinePatchBuildUtils/ninepatchbuildutils/')</code> </pre> </li><li>  Add dependency to file build.gradle of application module: <pre> <code class="xml hljs">compile project(':ninepatchbuildutils')</code> </pre> </li><li>  Rebuild project </li></ul></div></div><br>  Links for especially <s>stupid as I am</s> curious: <br>  NinePatch Sources: <a href="">NinePatch.java</a> and <a href="">NinePatch.cpp</a> <br>  A place to read about Res_png_9patch: <a href="">ResourceTypes.h</a> and <a href="">ResourceTypes.cpp</a> <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/252775/">https://habr.com/ru/post/252775/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252767/index.html">We program in a cloud: the review popular IDE</a></li>
<li><a href="../252769/index.html">Align the modal window in the center</a></li>
<li><a href="../25277/index.html">Firefox 3.0 RC1</a></li>
<li><a href="../252771/index.html">Perspective matrices in graphic API or the devil hides in details</a></li>
<li><a href="../252773/index.html">Material Design: to the moon and back</a></li>
<li><a href="../252779/index.html">e-Ticket misunderstanding</a></li>
<li><a href="../252781/index.html">Working with metasecond structures in Python - MetaNet library</a></li>
<li><a href="../252783/index.html">Rewrite Require.js using Promise. Part 1</a></li>
<li><a href="../252785/index.html">IBM Containers now in Bluemix: we put everything on the shelves</a></li>
<li><a href="../252787/index.html">Increase page conversion in the App Store and Google Play with A / B tests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>