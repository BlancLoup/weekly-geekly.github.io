<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Problem solving with pwnable.kr 08 is leg and 10 is shellshock. ARM assembler. Bash vulnerability</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we recall the syntax of the ARM assembler, deal with the shellshock vulnerability, and also solve the 8th and 10th tasks from the sit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Problem solving with pwnable.kr 08 is leg and 10 is shellshock. ARM assembler. Bash vulnerability</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/al/py/ef/alpyefagnx81cc2xc1ncjqs8lus.png" alt="image"></div><br>  In this article, we recall the syntax of the ARM assembler, deal with the shellshock vulnerability, and also solve the 8th and 10th tasks from the site <a href="https://pwnable.kr/index.php">pwnable.kr</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Organizational Information</b> <div class="spoiler_text">  Especially for those who want to learn something new and develop in any of the areas of information and computer security, I will write and talk about the following categories: <br><br><ul><li>  PWN; </li><li>  cryptography (Crypto); </li><li>  network technologies (Network); </li><li>  reverse (Reverse Engineering); </li><li>  steganography (Stegano); </li><li>  search and exploitation of WEB vulnerabilities. </li></ul><br>  In addition to this, I will share my experience in computer forensics, analysis of malware and firmware, attacks on wireless networks and local area networks, conducting pentests and writing exploits. <br><a name="habracut"></a><br>  So that you can find out about new articles, software and other information, I created a <a href="https://t.me/RalfHackerChannel">channel in Telegram</a> and a <a href="https://t.me/RalfHackerPublicChat">group to discuss any issues</a> in the field of ICD.  Also, I will personally consider your personal requests, questions, suggestions and recommendations <a href="https://t.me/hackerralf8">personally and will answer everyone</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All information is provided for educational purposes only.  The author of this document does not bear any responsibility for any damage caused to anyone as a result of using knowledge and methods obtained as a result of studying this document. <br></div></div><br><h2>  Leg quest solution </h2><br>  We click on the first icon with the signature leg, and we are told that we need to connect via SSH with the password guest.  They also provide source code in C and assembler. <br><br><img src="https://habrastorage.org/webt/tp/my/fe/tpmyfexuyfyvtftxadhlbycvqpq.png" alt="image"><br><br>  Let's download both files and sort the source code in C. By assembly language, we can say that it uses ARM syntax.  About ARM assembler on Habr√© wrote <a href="https://habr.com/ru/post/133808/">here</a> and <a href="https://habr.com/ru/post/188712/">here</a> . <br><br><img src="https://habrastorage.org/webt/cz/hs/8_/czhs8_n5hz9ie1tdq5nu898yphe.png" alt="image"><br><br>  In the main () function, a number is received from the user and compared with the sum of the results of the three key () functions.  Let's sort them in order. <br><br><img src="https://habrastorage.org/webt/ia/h-/zv/iah-zvx_7qfrsjoupbdj8or_23w.png" alt="image"><br><br>  Thus, the value from the PC register is placed in register R3.  In ARM assembler, the PC register contains the address of the next instruction to be executed.  We look at the disassembled code. <br><br><img src="https://habrastorage.org/webt/tj/rr/eu/tjrreu4ie7jl7rv1wvyeplbaoni.png" alt="image"><br><br>  Thus, the key1 () function will return the value 0x8ce4.  Let's analyze the key2 () function. <br><br><img src="https://habrastorage.org/webt/cj/qx/ln/cjqxlnvud1daccdku7gmivncaga.png" alt="image"><br><br>  0x8d08 is placed in R3, which is then incremented by 4 and written to the register R0.  That is, key2 () will return 0x8d0c.  Consider key3 (). <br><br><img src="https://habrastorage.org/webt/yp/mi/7r/ypmi7r5kd-ro6ee8ilr07oofp9a.png" alt="image"><br><br>  By analogy with the first function, we conclude that key3 () will return a value from the LR register.  LR contains the return address of the function.  Let's see where the function is called and take the following address. <br><br><img src="https://habrastorage.org/webt/77/gc/d1/77gcd1bkm7ufsifqwpksxoevtpy.png" alt="image"><br><br>  The key3 () function will return 0x8d80.  Connect via SSH and enter the sum of the three numbers found in the program. <br><br><img src="https://habrastorage.org/webt/mo/m3/i3/mom3i3yhdmzzdyleqdv1z5yyxfe.png" alt="image"><br><br><img src="https://habrastorage.org/webt/sh/l9/ph/shl9phxuqspw1bngeyqf-v8nvms.png" alt="image"><br><br>  We hand over the flag and get two points. <br><br><img src="https://habrastorage.org/webt/tn/0u/tv/tn0utvomkq7-8pwyni7ehgi2j3y.png" alt="image"><br><br><h2>  Shellshock aka Bashdoor </h2><br>  Shellshock (Bashdoor) is a software vulnerability discovered in the GNU Bash program that allows arbitrary commands to be executed upon receipt of some non-standard values ‚Äã‚Äãof environment variables.  The vulnerability has received the number CVE-2014-6271. <br><br>  On Unix-like operating systems, each program has environment variables.  The child process inherits from the parent a list of environment variables.  In addition to environment variables, bash also maintains an internal list of functions - named scripts that can be called from an executable script.  When running scripts from other (parent) scripts, it is possible to export the values ‚Äã‚Äãof existing environment variables and function definitions.  Function definitions are exported by encoding them in the form of new environment variables of a special format, starting with empty brackets ‚Äú()‚Äù, followed by the definition of the function as a string.  New bash instances at their start scan all environment variables, detecting this format and converting it back to the definition of an internal function.  Thus, if an attacker has the ability to submit an arbitrary environment variable to run bash, then the ability to execute arbitrary commands appears. <br><br>  The following example prints the text VULN. <br><br><pre><code class="bash hljs">env x=<span class="hljs-string"><span class="hljs-string">'() { : ; }; echo ‚ÄúVULN‚Äù'</span></span> bash -c ‚Äú<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> text‚Äù</code> </pre> <br>  Since when executing the ‚Äúecho text‚Äù command, the function definition contained in the environment variable x will be loaded, and the 'echo ‚ÄúVULN‚Äù ‚Äùcommand will be executed with it. <br><br><h2>  Shellshock job solution </h2><br>  We click on the first icon with the signature shellshock, and we are told that we need to connect via SSH with the password guest. <br><br><img src="https://habrastorage.org/webt/ur/c_/ko/urc_komo-hzsx8z8at-piypqvag.png" alt="image"><br><br>  When connected, we see the corresponding banner. <br><br><img src="https://habrastorage.org/webt/os/r5/y9/osr5y9rqx4cdypgefj8ncrsh4um.png" alt="image"><br><br>  Let's find out what files are on the server, as well as what rights we have. <br><br><img src="https://habrastorage.org/webt/hr/0l/u1/hr0lu1ylo_fdkyswsftxzoqcnj8.png" alt="image"><br><br>  Let's see the outcome of the code. <br><br><img src="https://habrastorage.org/webt/74/un/1w/74un1w-xrfzvpblpztqv9qd7zdo.png" alt="image"><br><br>  Of interest is the line calling the system function.  Based on the name, we assume that bash, which is next to the program and called from the program, is vulnerable.  By analogy with the attack described in the article, we execute the command to read the flag. <br><br><pre> <code class="bash hljs">/bin/cat flag</code> </pre> <br>  To do this, we define a function in the environment variable where we place this command.  And then run the program. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> x=<span class="hljs-string"><span class="hljs-string">"() { :; }; /bin/cat flag;"</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/h8/u9/07/h8u907vxl0x0qjivbolvogqx1-m.png" alt="image"><br><br>  We hand over the flag and get one more point.  See you in the next article. <br><br>  We are in a telegram channel: a <a href="https://t.me/RalfHackerChannel">channel in Telegram</a> . </div><p>Source: <a href="https://habr.com/ru/post/461269/">https://habr.com/ru/post/461269/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461255/index.html">How to shoot yourself in the foot in C and C ++. Haiku OS Recipe Collection</a></li>
<li><a href="../461257/index.html">How to calculate ROI from test automation with Selenium?</a></li>
<li><a href="../461259/index.html">Storage Party, August 8, Moscow</a></li>
<li><a href="../461261/index.html">Checklist of useful RRC webinars on RRC products</a></li>
<li><a href="../461265/index.html">About the abuse of the use of the operating system in projects for microcontrollers</a></li>
<li><a href="../46127/index.html">8 ways to turn a new site visitor into a regular visitor</a></li>
<li><a href="../461271/index.html">How to promote a mobile application in 2019: 4 practical ways + useful tools</a></li>
<li><a href="../461273/index.html">Greedy approach and slot machines. Analysis of the tasks of the ML-track of the programming championship</a></li>
<li><a href="../461277/index.html">Overview of the free SQLIndexManager tool</a></li>
<li><a href="../461279/index.html">How to create a simple microservice on Golang and gRPC and containerize it using Docker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>