<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Firebase queue: steroids for firebase</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About Firebase more than once wrote on Habr√©. The key advantage of this system is that in some cases it is possible to build a complete web applicatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Firebase queue: steroids for firebase</h1><div class="post__text post__text-html js-mediator-article">  About Firebase more than once wrote on Habr√©.  The key advantage of this system is that in some cases it is possible to build a complete web application on it that works with real-time data.  Having the ability to edit the rules of access to the database and the fact that these rules can be arranged on the basis of users (who are also brought here), in principle, you can do without any backend.  But usually there are problems that are better solved "from the outside" than to produce bikes in the rules ( <a href="http://stackoverflow.com/a/23132570/1594839">for example</a> ). <br><br>  In mid-May, the developers announced the release of <a href="https://github.com/firebase/firebase-queue">firebase-queue</a> .  This is a javascript library with which you can organize work with data in the database, as with tasks.  It works as follows: we define the task cell using <b>Queue ()</b> on the server and establish a connection.  Now, when a new element appears in this cell, the server will take the necessary actions, if necessary, will inform about the progress and errors, and upon completion will delete the task.  As a result, we get the opportunity to cover many problems arising in development with Firebase - to reconcile the data, conduct additional validation (for example, check for spam and mate), send them to another location (for example, upload a picture to the hosting) and more. <br><a name="habracut"></a><br>  As an example, take the above question from stackoverflow.  We have an object with the n-th number of elements.  After adding / deleting an item, we want to update the total count.  In the database, we define two objects: <b>elements</b> and <b>length</b> .  Also in the rules we specify the cells of the tasks <b>addnode</b> and <b>rmnode</b> .  In them from the client we will send that object which we want to receive and delete respectively from <b>elements</b> . <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ref = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Firebase(<span class="hljs-string"><span class="hljs-string">'https://***.firebaseio.com'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> addNode = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  kriskowal/q   var deferred = Q.defer(); var task = ref.child('addnode').push({ new: text }, function(e) { if (e) { deferred.reject(e); } else { /*      .  progress()     _progress, resolve() -  . */ ref.child('addnode/'+task.key()).on('value', function(d) { var v = d.val(); if(v == null) { deferred.resolve(); } else { deferred.notify(v._progress); } }) }}); return deferred.promise; } var rmNode = function(k) { var deferred = Q.defer(); var task = ref.child('rmnode').push({ key: k }, function(e) { if (e) { deferred.reject(e); } else { ref.child('addnode/'+task.key()).on('value', function(d) { var v = d.val(); if(v == null) { deferred.resolve(); } else { deferred.notify(v._progress); } }) }}); return deferred.promise; }</span></span></code> </pre> <br>  Firebase-queue is attached to task cells.  As soon as a new task appears, we already perform the necessary manipulations on the server: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ref = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Firebase(<span class="hljs-string"><span class="hljs-string">'https://***.firebaseio.com'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> length; ref.child(<span class="hljs-string"><span class="hljs-string">'length'</span></span>).once(<span class="hljs-string"><span class="hljs-string">'value'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) </span></span>{ length = d.val(); }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> addNodeQueue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Queue(ref.child(<span class="hljs-string"><span class="hljs-string">'addnode'</span></span>), {}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data, progress, resolve, reject</span></span></span><span class="hljs-function">) </span></span>{ ref.child(<span class="hljs-string"><span class="hljs-string">'elements'</span></span>).push(data.new, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e) { reject(e); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { progress(<span class="hljs-number"><span class="hljs-number">50</span></span>); length++; ref.child(<span class="hljs-string"><span class="hljs-string">'length'</span></span>).set(length, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e) { reject(e.message); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { resolve(); }}); }}); }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rmNodeQueue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Queue(ref.child(<span class="hljs-string"><span class="hljs-string">'rmnode'</span></span>), {}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data, progress, resolve, reject</span></span></span><span class="hljs-function">) </span></span>{ ref.child(<span class="hljs-string"><span class="hljs-string">'elements/'</span></span>+data.key).remove(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e) { reject(e); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { progress(<span class="hljs-number"><span class="hljs-number">50</span></span>); length--; ref.child(<span class="hljs-string"><span class="hljs-string">'length'</span></span>).set(length, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e) { reject(e); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { resolve(); }}); }}); });</code> </pre><br>  The rules will be as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"rules"</span></span>: { <span class="hljs-string"><span class="hljs-string">"addnode"</span></span>: { <span class="hljs-string"><span class="hljs-string">"$taskId"</span></span>: { <span class="hljs-string"><span class="hljs-string">"new"</span></span>: { <span class="hljs-string"><span class="hljs-string">".validate"</span></span>: <span class="hljs-string"><span class="hljs-string">"newData.isString()"</span></span> } } }, <span class="hljs-string"><span class="hljs-string">"rmnode"</span></span>: { <span class="hljs-string"><span class="hljs-string">"$taskId"</span></span>: { <span class="hljs-string"><span class="hljs-string">"key"</span></span>: { <span class="hljs-string"><span class="hljs-string">".validate"</span></span>: <span class="hljs-string"><span class="hljs-string">"root.child('elements/'+newData.val()).exists()"</span></span> <span class="hljs-comment"><span class="hljs-comment">//         } } } } }</span></span></code> </pre><br>  In order not to overload and preserve the overview nature of the article, I decided to omit the story about security rules for tasks, task specifications and options that you can specify for <b>Queue ()</b> .  This is all fine (like all of their documentation) described on the project page on github. </div><p>Source: <a href="https://habr.com/ru/post/266355/">https://habr.com/ru/post/266355/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266345/index.html">A practical guide to hacking (and protecting) games on Unity</a></li>
<li><a href="../266347/index.html">Overview of segmentation algorithms</a></li>
<li><a href="../266349/index.html">Practical training in pentest laboratories. Part 1</a></li>
<li><a href="../266351/index.html">Battered banality. As a schoolboy bot wrote</a></li>
<li><a href="../266353/index.html">Ansible and Rails - flexible replacement for Capistrano while maintaining familiar comfort</a></li>
<li><a href="../266357/index.html">100 out of 100 in Google PageSpeed ‚Äã‚ÄãInsights (Bug or feature)?</a></li>
<li><a href="../266359/index.html">In the guests' sitting "Grasshopper"</a></li>
<li><a href="../266361/index.html">1–°: Programmers Club - Teacher‚Äôs View</a></li>
<li><a href="../266363/index.html">We draw on electronic map tiles in MSSQL</a></li>
<li><a href="../266367/index.html">We write a simple * game physics of the aircraft</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>