<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pdef - compiler and web interface description language</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the beginning of last year, I had the idea to write my own interface language (IDL), which would be similar to Protobuf or Thrift, but would be int...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pdef - compiler and web interface description language</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  At the beginning of last year, I had the idea to write my own interface language (IDL), which would be similar to Protobuf or Thrift, but would be intended for the web.  I was hoping to finish it somewhere in three months.  A little more than a year passed before the first stable version. </blockquote><br>  <a href="http://pdef.io/">Pdef</a> (protocol definition language) is a statically typed interface description language that supports JSON and HTTP RPC.  It allows you to once describe the interfaces and data structures, and then generate code for specific programming languages.  Pidef is suitable for public api, internal services, distributed systems, configuration files, as a format for storing data, cache and message queues. <br><br>  Main functionality: <br><br><ul><li>  A developed system of packages, modules and namespaces. </li><li>  Support for cyclic imports and type dependencies (with some limitations). </li><li>  A simple type system based on a clear separation of interfaces and data structures. </li><li>  Inheritance of messages (analog structs) and interfaces. </li><li> Support for call chains, for example, <code>github.user(1).repos().all()</code> . </li><li>  JSON as data format and HTTP RPC for data transfer. </li><li>  Ability to use other formats and RPC. </li><li>  Plug-in code generators (officially supported by <a href="https://github.com/pdef/pdef-java">Java</a> , <a href="https://github.com/pdef/pdef-python">Python</a> and <a href="https://github.com/pdef/pdef-objc">Objective-C</a> ). </li><li>  Optional code generation, i.e.  Pidef allows you to serialize data and send requests by hand. </li></ul><br>  Why do I need Pidef?  Primarily to increase productivity and simplify the development and support of client-server, service-oriented and distributed code.  But it also combines the documentation and description of api and allows you to build vertically integrated systems in which the overhead costs of the interaction of individual components are reduced. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Message description example: <pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">message</span></span> Human { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span> int64; <span class="hljs-attribute"><span class="hljs-attribute">name</span></span> string; <span class="hljs-attribute"><span class="hljs-attribute">birthday</span></span> datetime; <span class="hljs-attribute"><span class="hljs-attribute">sex</span></span> Sex; <span class="hljs-attribute"><span class="hljs-attribute">continent</span></span> ContinentName; }</code> </pre><br>  Examples of use ( <a href="">examples of generated code</a> ): <div class="spoiler">  <b class="spoiler_title">Json</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Ivan Korobkov"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"birthday"</span></span>: <span class="hljs-string"><span class="hljs-string">"1987-08-07T00:00Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sex"</span></span>: <span class="hljs-string"><span class="hljs-string">"male"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"continent"</span></span>: <span class="hljs-string"><span class="hljs-string">"europe"</span></span> }</code> </pre><br></div></div><div class="spoiler">  <b class="spoiler_title">Java</b> <div class="spoiler_text"><pre> <code class="java hljs">Human human = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Human() .setId(<span class="hljs-number"><span class="hljs-number">1</span></span>) .setName(<span class="hljs-string"><span class="hljs-string">"John"</span></span>) .setSex(Sex.MALE) .setContinent(ContinentName.ASIA) String json = human.toJson(); Human another = Human.fromJson(json);</code> </pre><br></div></div><div class="spoiler">  <b class="spoiler_title">Python</b> <div class="spoiler_text"><pre> <code class="python hljs">human = Human(id=<span class="hljs-number"><span class="hljs-number">1</span></span>, name=<span class="hljs-string"><span class="hljs-string">"John"</span></span>) human.birthday = datetime.datetime(<span class="hljs-number"><span class="hljs-number">1900</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) s = human.to_json() another = Human.from_json(s)</code> </pre><br></div></div><div class="spoiler">  <b class="spoiler_title">Objective c</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">Human *human = [[Human alloc]init]; human.id = <span class="hljs-number"><span class="hljs-number">1</span></span>; human.name = <span class="hljs-string"><span class="hljs-string">@"John"</span></span>; human.sex = Sex_MALE; human.continent = ContinentName_EUROPE; <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">NSData</span></span> *data = [human toJsonError:&amp;error]; Human *another = [Human messageWithData:data error:&amp;error];</code> </pre><br></div></div><br><a name="habracut"></a><h1>  Installation </h1>  Pidef consists of a compiler, plug-in code generators and bayindings specific to specific programming languages.  The compiler and code generators are written in Python. <br><br>  Installing the compiler as a Python package with <a href="https://pypi.python.org/pypi/pdef-compiler/">PyPI</a> : <br><br><pre> <code class="bash hljs">pip install pdef-compiler</code> </pre><br>  Or, you can download an archive with a specific version from the <a href="https://github.com/pdef/pdef/releases">project's release page</a> , unzip it and execute: <br><br><pre> <code class="bash hljs">python setup.py install</code> </pre><br>  Installing code generators (download links are on specific language pages): <br><br><pre> <code class="bash hljs">pip install pdef-java pip install pdef-python pip install pdef-objc</code> </pre><br>  That's it, the compiler is ready to use.  You can run the following command to make sure everything is set correctly.  She will download the sample package and check it out. <br><br><pre> <code class="bash hljs">pdefc -v check https://raw.github.com/pdef/pdef/master/example/world.yaml</code> </pre><br>  Each code generator during installation adds its own commands to the compiler, you can see them in the help: <br><br><pre> <code class="bash hljs">pdefc -h ... generate-python Python code generator. generate-objc Objective-C code generator. generate-java Java code generator. pdefc generate-python -h</code> </pre><br><br><h1>  Using </h1>  Create a package file <code>myproject.yaml</code> : <br><br><pre> <code class="hljs pgsql">package: <span class="hljs-type"><span class="hljs-type">name</span></span>: myproject modules: - posts - photos</code> </pre><br>  Create the module files: <br><br><pre> <code class="hljs cmake">//  posts.pdef namespace myproject; import myproject.photos; interface Posts { get(id int64) Post; @post create(title <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> @post, text <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> @post) Post; } <span class="hljs-keyword"><span class="hljs-keyword">message</span></span> Post { id int64; title <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; text <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; photos <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>&lt;Photo&gt;; }</code> </pre><br><pre> <code class="hljs cmake">//  photos.pdef namespace myproject; <span class="hljs-keyword"><span class="hljs-keyword">message</span></span> Photo { id int64; url <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; }</code> </pre><br>  Run code generation: <br><br><pre> <code class="bash hljs">pdefc generate-java myproject.yaml --out generated-java/ pdefc generate-python myproject.yaml --out generated-python/ pdefc generate-objc myproject.yaml --out generated-objc/</code> </pre><br>  Code generators support the mapping of Pidef‚Äôs modules and namespaces to specific programming languages.  More details can be found in the command description <br><br><br><h1>  Guide to Pidef 1.1 </h1><br><h2>  Syntax </h2><br>  Pidef syntax is similar to Java / C ++ with an inverted order of types and fields / arguments.  All identifiers must begin with a Latin character and contain only Latin characters, numbers and underscores.  <a href="">Grammar Description</a> (BNF). <br><br>  Example: <pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">example</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">MyInterface</span></span> { method( arg0 int32, arg1 <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ) list&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;; } message MyMessage { field0 int32; field1 <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Number { ONE, TWO; }</code> </pre><br><br><h3>  Comments </h3><br>  There are two types of comments: single-line and multi-line for documentation.  Documentation comments can be placed at the very beginning of the module, before determining the type (by message, interface, or enumeration) or before the method.  Single-line comments are cut when parsing, multi-line ones are saved and used by code generators for documentation. <br><br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** * This is a multi-line module docstring. * It is a available to the code generators. * * Start each line with a star because it is used * as line whitespace/text delimiter when * the docstring is indented (as method docstrings). */</span></span> namespace example; // This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a one <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">comment</span></span>, it <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> stripped <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> the source code. <span class="hljs-comment"><span class="hljs-comment">/** Interface docstring. */</span></span> interface ExampleInterface { <span class="hljs-comment"><span class="hljs-comment">/** * Method docstring. */</span></span> hello(<span class="hljs-type"><span class="hljs-type">name</span></span> string) string; }</code> </pre><br><br><h2>  Packages and modules </h2><br><h3>  Packages </h3><br>  Pidef files should be organized into packages.  Each package is described by one <code>yaml</code> file, which contains the name of the package and lists the modules and dependencies.  Cyclic dependencies between packages are prohibited.  Module names are automatically mapped to files.  For this, the points are replaced with the system directory separator and the extension <code>.pdef</code> .  For example, <code>users.events</code> corresponds to the <code>users/events.pdef</code> .  Dependencies indicate the package name and an optional path to its <code>yaml</code> file <code>yaml</code> a space.  Dependency paths can be set and overridden when executing console commands. <br><br>  Sample package file: <pre> <code class="hljs pgsql">package: # Package <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>: example # Additional information <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>: <span class="hljs-number"><span class="hljs-number">1.1</span></span> url: https://github.com/pdef/pdef/ author: Ivan Korobkov &lt;ivan.korobkov@gmail.com&gt; description: Example application # Module files. modules: - example - photos - users - users.profile # Other packages this package <span class="hljs-keyword"><span class="hljs-keyword">depends</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>. dependencies: - common - pdef_test https://raw.github.com/pdef/pdef/<span class="hljs-number"><span class="hljs-number">1.1</span></span>/test/test.yaml</code> </pre><br>  And its file structure (the <code>api</code> directory is optional): <pre> <code class="hljs">api/ example.yaml example.pdef photos.pdef users.pdef users/profile.pdef</code> </pre><br><br><h3>  Modules and namespaces </h3><br>  A module is a separate <code>*.pdef</code> file with a description of messages, interfaces, and enumerations.  Each module immediately after the optional documentation should contain an indication of the namespace.  All types in the same namespace must have unique names.  Different packages can use the same namespace. <br><br>  Namespaces in pidef are wider than in Java / C # / C ++ and do not have to follow the structure of files and directories.  For the latter, there are module names.  Usually, one or more packages use the same namespace.  Possible examples: <code>twitter</code> , <code>github</code> , etc. <br><br><pre> <code class="hljs cs"><span class="hljs-comment"><span class="hljs-comment">/** Module with a namespace. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">myproject</span></span>; message Hello { text <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; }</code> </pre><br><br><h3>  Imports </h3><br>  Imports are similar to <code>include</code> in other languages, they allow you to access types from another module in one module.  Imports are placed immediately after specifying the module namespace.  Modules are imported using the package name and file path without the <code>.pdef</code> extension, with a <code>.pdef</code> instead of a directory separator.  When the module name matches the package name, the module can be imported only by the package name. <br><br>  Separate imports: <pre> <code class="hljs coffeescript">namespace example; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> package; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Equivalent to <span class="hljs-string"><span class="hljs-string">"import package.package"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> package/<span class="hljs-built_in"><span class="hljs-built_in">module</span></span> names match. <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> package.<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>;</code> </pre><br>  Batch Imports: <pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">example</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> package.module import submodule0, submodule1;</code> </pre><br><br><h3>  Cyclic imports and dependencies </h3><br>  Cyclic imports are possible as long as the types of one module do not inherit the types of another module and vice versa.  Otherwise, you can try to divide the modules into smaller ones or merge them into one file.  Cyclic dependencies between types are allowed. <br><br>  Such restrictions are sufficient to support most programming languages.  Interpreted languages ‚Äã‚Äãlike Ruby or Python are also supported, since the Pidef compiler ensures that the modules will have a clear tree order of execution when inheriting, otherwise the modules can be executed in any order.  More information about the implementation of circular dependencies in specific languages ‚Äã‚Äãcan be found in the <a href="">Pdef Generated and Language-Specific Code.</a> <br><br>  Example of cyclic imports and dependencies: <pre> <code class="hljs pgsql">// users.pdef namespace example; <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> example <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> photos; // Circular <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>. message <span class="hljs-keyword"><span class="hljs-keyword">User</span></span> { bestFriend <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>; // <span class="hljs-keyword"><span class="hljs-keyword">References</span></span> a declaring <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>. photo Photo; // <span class="hljs-keyword"><span class="hljs-keyword">References</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> another module. }</code> </pre><br><pre> <code class="hljs pgsql">// photos.pdef namespace example; <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> example <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> users; // Circular <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>. message Photo { <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>; // <span class="hljs-keyword"><span class="hljs-keyword">References</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> another module. }</code> </pre><br><br><h3>  Name resolution </h3><br>  Within the same namespace, a local type name is used, for example, <code>MyMessage</code> ; within a different <code>namespace.MyMessag</code> full name is <code>namespace.MyMessag</code> . <br><br><br><h2>  Type system </h2><br>  Pidef has a simple static type system built on the principle of separation of interfaces and data structures. <br><br><h3>  Void </h3><br>  <code>void</code> is a special type that indicates that the method does not return a result. <br><br><h3>  Data types </h3><br><h4>  Primitive types </h4><br><ul><li>  <code>bool</code> : boolean value (true / false) </li><li>  <code>int16</code> : signed 16-bit number </li><li>  <code>int32</code> : a significant 32-bit number </li><li>  <code>int64</code> : signed 64-bit number </li><li>  <code>float</code> : 32-bit floating point number </li><li>  <code>double</code> : 64-bit floating point number </li><li>  <code>string</code> : Unicode string </li><li>  <code>datetime</code> : date to time without specifying the time zone </li></ul><br><h4>  Containers </h4><br><ul><li>  <code>list</code> : an ordered list whose elements can be any data type. </li><li>  <code>set</code> : an unordered set of unique values, the elements of which can be any data type. </li><li>  <code>map</code> : container is key-value, keys must be primitive types, values ‚Äã‚Äãcan be any data types. </li></ul><br><pre> <code class="hljs cpp">message Containers { numbers <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;int32&gt;; tweets <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;Tweet&gt;; ids <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>&lt;int64&gt;; colors <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>&lt;Color&gt;; userNames <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>&lt;int64, <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;; photos <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;Photo&gt;&gt;; }</code> </pre><br><h4>  Transfers </h4><br>  An enumeration is a collection of unique string values.  Enums are also used to specify discriminators for inheritance. <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sex</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-type"><span class="hljs-type">MALE</span></span>, <span class="hljs-type"><span class="hljs-type">FEMALE</span></span>; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventType</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-type"><span class="hljs-type">USER_REGISTERED</span></span>, <span class="hljs-type"><span class="hljs-type">USER_BANNED</span></span>, <span class="hljs-type"><span class="hljs-type">PHOTO_UPLOADED</span></span>, <span class="hljs-type"><span class="hljs-type">PHOTO_DELETED</span></span>, <span class="hljs-type"><span class="hljs-type">MESSAGE_RECEIVED</span></span>; }</code> </pre><br><h4>  Messages and Exceptions </h4><br>  A message (similar to <code>struct</code> 'a) is a collection of statically typed named fields.  Messages support simple and polymorphic inheritance.  Messages defined as exceptions can optionally be used to specify exceptions in interest. <br><br><ul><li>  All message fields must have unique names. </li><li>  The field type must be a data type. </li><li>  The field may indicate the message in which it is defined (self-referencing). </li></ul><br><br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** Example message. */</span></span> message <span class="hljs-keyword"><span class="hljs-keyword">User</span></span> { id int64; <span class="hljs-type"><span class="hljs-type">name</span></span> string; age int32; profile Profile; friends <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>&gt;; // Self-referencing. } <span class="hljs-comment"><span class="hljs-comment">/** Example exception. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exception</span></span> UserNotFound { userId int64; }</code> </pre><br><h4>  Inheritance </h4><br>  Inheritance allows one message to inherit the fields of another message or exception.  In simple inheritance, descendants cannot be unpacked from the parent, for this there is polymorphic inheritance. <br><br><ul><li>  Cyclic inheritance is prohibited. </li><li>  A message can have only one parent. </li><li>  Redefinition of fields in descendants is prohibited. </li><li>  The child and the parent must be either messages or exceptions, i.e.  they can not be mixed. </li><li>  A parent must be defined before its descendants, and also cannot be imported from dependent modules (more details in cyclic imports). </li></ul><br>  Example of inheritance: <pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">message</span></span> EditableUser { <span class="hljs-attribute"><span class="hljs-attribute">name</span></span> string; <span class="hljs-attribute"><span class="hljs-attribute">sex</span></span> Sex; <span class="hljs-attribute"><span class="hljs-attribute">birthday</span></span> datetime; } <span class="hljs-attribute"><span class="hljs-attribute">message</span></span> User : EditableUser { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span> int32; <span class="hljs-attribute"><span class="hljs-attribute">lastSeen</span></span> datetime; <span class="hljs-attribute"><span class="hljs-attribute">friendsCount</span></span> int32; <span class="hljs-attribute"><span class="hljs-attribute">likesCount</span></span> int32; <span class="hljs-attribute"><span class="hljs-attribute">photosCount</span></span> int32; } <span class="hljs-attribute"><span class="hljs-attribute">message</span></span> UserWithDetails : User { <span class="hljs-attribute"><span class="hljs-attribute">photos</span></span> list&lt;Photo&gt;; <span class="hljs-attribute"><span class="hljs-attribute">friends</span></span> list&lt;User&gt;; }</code> </pre><br><h4>  Polymorphic inheritance </h4><br>  Polymorphic inheritance allows you to unpack descendants based on the value of the discriminator field.  The parent with all descendants is the inheritance tree.  One descendant can inherit another (and not just the parent), but only within the same tree. <br><br>  For polymorphic inheritance you need: <br><br><ul><li>  Create an enumeration that will serve as a set of values ‚Äã‚Äãfor the discriminator. </li><li>  Add a field with the type of this enumeration to the parent message and mark it as <code>@discriminator</code> . </li><li>  Specify the discriminator value of each of the descendants as <code>message Subtype : Base(DiscriminatorEnum.VALUE)</code> . </li></ul><br>  Limitations: <br><br><ul><li>  Parent and all descendants must be defined in one package. </li><li>  The type of discriminator must be defined before the parent and cannot be imported from the dependent module. </li><li>  In one inheritance tree there can be only one discriminator field. </li><li>  You can not inherit a polymorphic message without specifying the value of the discriminator. </li></ul><br>  An example of polymorphic inheritance: <pre> <code class="hljs haskell">/** <span class="hljs-type"><span class="hljs-type">Discriminator</span></span> enum. */ enum <span class="hljs-type"><span class="hljs-type">EventType</span></span> { <span class="hljs-type"><span class="hljs-type">USER_EVENT</span></span>, <span class="hljs-type"><span class="hljs-type">USER_REGISTERED</span></span>, <span class="hljs-type"><span class="hljs-type">USER_BANNED</span></span>, <span class="hljs-type"><span class="hljs-type">PHOTO_UPLOADED</span></span>, } /** <span class="hljs-type"><span class="hljs-type">Base</span></span> event with a discriminator field. */ message <span class="hljs-type"><span class="hljs-type">Event</span></span> { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EventType</span></span></span><span class="hljs-class"> @discriminator; // </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">The</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> field marked as @discriminator time datetime; } /** </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Base</span></span></span><span class="hljs-class"> user event. */ message </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserEvent</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Event</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EventType</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">USER_EVENT</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">User</span></span></span><span class="hljs-class">; } message </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserRegistered</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserEvent</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EventType</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">USER_REGISTERED</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ip</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">browser</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">device</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">; } message </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserBanned</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserEvent</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EventType</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">USER_BANNED</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">moderatorId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int64</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">reason</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">; } message </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PhotoUploaded</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Event</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EventType</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PHOTO_UPLOADED</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">photo</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Photo</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">userId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int64</span></span></span><span class="hljs-class">; }</span></span></code> </pre><br><br><h3>  Interfaces </h3><br>  An interface is a collection of statically typed methods.  Each method has a unique name, named arguments and result.  The result can be any type of data, including other interfaces. <br><br>  A method is called <em>terminal</em> when it returns a data type or <code>void</code> .  The method is called <em>interface</em> when it returns the interface.  A sequential method call must end with a terminal method, for example, <code>app.users().register("John Doe")</code> . <br><br>  Terminal methods can be labeled <code>@post</code> to separate methods that modify data.  Their arguments can also be marked as <code>@post</code> .  HTTP RPC sends these methods as POST requests, and <code>@post</code> adds arguments to the request body. <br><br>  Terminal methods not marked with <code>@post</code> can have <code>@query</code> arguments that are sent as an HTTP query string. <br><br><ul><li>  Interface methods must have unique names. </li><li>  Arguments must have unique names. </li><li>  Arguments must be data types. </li><li>  Only terminal methods can be marked as <code>@post</code> . </li><li>  Only terminal methods not marked as <code>@post</code> can have <code>@query</code> arguments. </li><li>  The last method in the call chain must be terminal. </li></ul><br>  Interface example: <pre> <code class="hljs vala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** Void method. */</span></span> void0() <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** Interface method. */</span></span> service(arg <span class="hljs-keyword"><span class="hljs-keyword">int32</span></span>) Service; <span class="hljs-comment"><span class="hljs-comment">/** Method with 3 args. */</span></span> method(arg0 <span class="hljs-keyword"><span class="hljs-keyword">int32</span></span>, arg1 <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, arg2 list&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;) <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** Terminal method with @query args. */</span></span> query(limit <span class="hljs-keyword"><span class="hljs-keyword">int32</span></span> @query, offset <span class="hljs-keyword"><span class="hljs-keyword">int32</span></span> @query) list&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;; <span class="hljs-comment"><span class="hljs-comment">/** Terminal post method with one of args marked as @post. */</span></span> @post mutator(arg0 <span class="hljs-keyword"><span class="hljs-keyword">int32</span></span>, postArg <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> @post) <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; }</code> </pre><br><h4>  Interface Inheritance </h4><br>  Interfaces can inherit other interfaces. <br><br><ul><li>  Redefinition of methods is prohibited. </li><li>  A heir can have only one parent. </li><li>  If the parent has an exception, then the heirs must either not specify the exception, or specify the exception of the parent. </li></ul><br>  An example of interface inheritance: <pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">BaseInterface</span></span> { method() <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">SubInterface</span></span> : <span class="hljs-title"><span class="hljs-title">BaseInterface</span></span> { anotherMethod() <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>; }</code> </pre><br><h4>  Exceptions </h4><br>  Exceptions are specified in root interfaces using <code>@throws(Exception)</code> .  The root interface is the interface from which all calls begin.  Exceptions to other interfaces in the call chain are ignored.  To support multiple exceptions, polymorphic inheritance or composition is used.  Usually there is one root interface, for example, <code>Github</code> or <code>Twitter</code> , and one exception. <br><br>  An example of polymorphic exceptions: <pre> <code class="hljs haskell">@throws(<span class="hljs-type"><span class="hljs-type">AppException</span></span>) interface <span class="hljs-type"><span class="hljs-type">Application</span></span> { users() <span class="hljs-type"><span class="hljs-type">Users</span></span>; photos() <span class="hljs-type"><span class="hljs-type">Photos</span></span>; search() <span class="hljs-type"><span class="hljs-type">Search</span></span>; } enum <span class="hljs-type"><span class="hljs-type">AppExceptionCode</span></span> { <span class="hljs-type"><span class="hljs-type">AUTH_EXC</span></span>, <span class="hljs-type"><span class="hljs-type">VALIDATION_EXC</span></span>, <span class="hljs-type"><span class="hljs-type">FORBIDDEN_EXC</span></span> } exception <span class="hljs-type"><span class="hljs-type">AppException</span></span> { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppExceptionCode</span></span></span><span class="hljs-class"> @discriminator; } exception </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AuthExc</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppException</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppExceptionCode</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AUTH_EXC</span></span></span><span class="hljs-class">) {} exception </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ValidationExc</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppException</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppExceptionCode</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VALIDATION_EXC</span></span></span><span class="hljs-class">) {} exception </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ForbiddenExc</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppException</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppExceptionCode</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FORBIDDEN_EXC</span></span></span><span class="hljs-class">) {}</span></span></code> </pre><br><br><h1>  Conclusion </h1>  It was pretty easy to write a draft compiler, I think it was ready in about a month of free time work.  The rest of the year was spent on making the device relatively simple, unambiguous and convenient to use.  Generics were not included in the stable version of the language, polymorphic inheritance with multiple discriminators, redefinition of exceptions in call chains, an open type system (which allowed you to use your own native types, such as <code>native mytype</code> ), weak typing (when the field or the result of the method was of <code>object</code> type, and had to unpack it themselves), and much more.  As a result, I hope, we have a simple, easy-to-read and easy-to-use language. <br><br>  Why is there no full support for REST?  Initially, it was planned, but the specification and functionality turned out to be quite voluminous, so REST was replaced with a simpler implementation of HTTP RPC.  In future versions, it may appear.  More information about RPC can be found in the specification, and examples can be found on the buyding village pages of specific languages.  Links are at the end of the article. <br><br>  I would like to share my feelings about the use of language from the point of view of the user, and not the author.  Over the past year I have used it in several projects, in some of them even the alpha version.  I like Pidef.  It enhances the weak connectivity of components, unifies types, interfaces, and documentation, and frees programmers from routine code duplication in different languages. <br><br>  I think, as I already wrote at the beginning of the article, it greatly reduces the overhead of organizing the interaction of various systems, including mobile clients, websites, api servers, internal services, distributed systems, push notification servers, queues, and data storage systems.  All of them, as a result, can use the same available data types and interfaces.  At the same time there is not any technological lock-in, because inside by default it is the same JSON and HTTP. <br><br><h1>  Links </h1><ul><li>  Project site <a href="http://pdef.io/">pdef.io</a> (redirects to GitHab) </li><li>  <a href="https://github.com/pdef/pdef/tree/master/example">Sample package</a> </li><li>  <a href="">Language guide</a> </li><li>  <a href="">Style guide</a> </li><li>  <a href="">JSON format specs</a> </li><li>  <a href="https://github.com/pdef/pdef/blob/master/docs/">HTTP RPC specs</a> </li><li>  <a href="">Grammar in BNF</a> </li><li>  <a href="">Generated and language specific code</a> with examples </li><li>  <a href="https://github.com/pdef/pdef-generator-template">How to write a code generator</a> </li><li>  <a href="https://groups.google.com/d/forum/pdef">Google group</a> (pdef@googlegroups.com) </li><li>  <a href="https://github.com/pdef/pdef-java">Java</a> , <a href="https://github.com/pdef/pdef-python">Python</a> , <a href="https://github.com/pdef/pdef-objc">Objective-C</a> code generators and banding (available at Central Maven, PyPI and CocoaPods, respectively) </li></ul></div><p>Source: <a href="https://habr.com/ru/post/209018/">https://habr.com/ru/post/209018/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../209008/index.html">6 C # Simple Trick Questions</a></li>
<li><a href="../209010/index.html">Chaos Communication Congress: Disneyland for hacker, SCADA security and not only</a></li>
<li><a href="../209012/index.html">Windows Azure Media Services vs. Amazon Elastic Transcoder. Part 2: Amazon Elastic Transcoder</a></li>
<li><a href="../209014/index.html">Make a call in one click</a></li>
<li><a href="../209016/index.html">HTML DRM specifications are kept secret</a></li>
<li><a href="../209020/index.html">Yandex learned to search on Facebook</a></li>
<li><a href="../209022/index.html">Everything you wanted to know about Chromecast or how to make an ordinary TV a little smarter for $ 35</a></li>
<li><a href="../209024/index.html">Debugging with XDebug and PhpStorm using the example of 1C-Bitrix site</a></li>
<li><a href="../209026/index.html">2 whales landing page (landing page)</a></li>
<li><a href="../209028/index.html">Virgin Galactic has posted a video of the third supersonic flight SpaceShipTwo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>