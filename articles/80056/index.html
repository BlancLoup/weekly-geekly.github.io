<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We do the timer or the first project on the FPGA</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I will begin my first article by reporting: in the subject of the article I am a novice myself, but I chose such a topic. I will explain why. I have b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We do the timer or the first project on the FPGA</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/geektimes/post_images/188/786/66f/18878666f35696e733bad5b2543eaaa0.jpg" align="left">  I will begin my first article by reporting: in the subject of the article I am a novice myself, but I chose such a topic.  I will explain why.  I have been reading Habr for quite a long time, and I have always been interested in the topics of those who are currently studying what he is talking about.  Such articles are always understandable, always find their audience and always betray the reader‚Äôs interest and enthusiasm of the author, which for beginners in any field usually exceeds the limit! <br><br>  So, recently I became interested in the FPGA theme, faced with them in school, read all sorts of docks and ordered the Starter Kit for experiments.  Now, having received a testing ground for experiments by mail and having conducted the first experiment, I am ready to share with habrauser.  I hope it will be interesting. <br><a name="habracut"></a><br>  First, let's go over the theory, what does the FPGA abbreviation in the topic of the article mean?  You can always read the wiki yourself, so I will try to describe it myself.  Who knows what FPGA is, skip boldly. <br><br>  FPGA (Programmable Logic Integrated Circuit) is one of the types of electronic devices used to implement various logic devices of very different complexity, from binary counters, simple logic circuits (replacing standard integrated circuits - scattering) to specialized processors and neurochips. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      With the appointment figured out the question - how?  Inside the FPGA are some basic elements that are connected based on the configuration record.  Possible basic elements, type and location of the configuration record storage depend on the type of FPGA and on the specific model.  In modern FPGA there are two types: CPLD and FPGA, we will pay them by paragraph. <br><br>  CPLD (complex programmable logic device - complex programmable logic devices) - FPGA, the basic elements of which are macrocells and simple logic gates (AND (-NOT) / OR (-NE)).  Usually contains less basic elements than FPGA, but is faster.  Also usually contains non-volatile configuration memory directly on the chip, but has a limited number of configuration cycles. <br><br>  FPGA (field-programmable gate array - user-programmable gate array) - FPGA, which usually have a whole bunch of types of basic blocks, these are both custom logic elements (truth tables) and addition-multiplication (Digital signal processing - DSP) and PLL (Phase -Locked Loop) for dividing and multiplying the frequency and some others depending on the model.  Usually they have volatile internal memory and functionality for loading configuration from external non-volatile memory. <br><br>  The definitions of these types of FPGAs and the differences between them can be found very different, both in books and on the Internet.  Therefore, you should not dwell on this difference, the producers themselves classify their FPGAs.  If you do not remember the abbreviations or understand the meanings of some words - it‚Äôs not scary, the main thing is to get a general concept about FPGA, I hope I achieved it.  And now to practice! <br><br>  Let's start by discussing the tools.  I will use the Altera Cyclone II FPGA Starter Board developer starter kit, this is a ready-made board on which the Cyclone II FPGA series - EP2C20F484C7N, as well as various peripherals and interfaces are installed.  In this article we use LEDs and seven-segment indicators.  We will not use any special blocks of this FPGA series, so if you wish, you can use almost any other FPGA (FPGA and CPLD). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/6a2/000/5bb/6a20005bb676ec0b2148ec4424c672e1.jpg"></div><br><br>  Those who are very interested can buy one of the developer‚Äôs kits or assemble the device themselves, which is quite difficult for a beginner, but quite a doable task.  The programmer circuits and the FPGAs wiring diagrams themselves are easy to googling, and besides, those who previously were engaged in amateur AVR firmware can find a suitable Altera Byte Blaster programmer.  In general, I will provide you with a circuit implementation of a habrauzer (At the end of the article, the diagram of my Starter Board)  Who wants to try without monetary costs and see the result of the work - you can use the simulator built into Quartus II (this article does not describe how to work with it). <br><br>  From the software we will use Quartus II, the free version of which you can find on the manufacturer‚Äôs website (Altera), both in Windows and Linux versions. <br><br>  And here we come to practice closely!  Launch our CAD system Quartus II and create a project.  The first steps of the wizard we specify the name of the project and its place of deployment, then skip the step of adding files (still have time).  We will finish creating the project at the stage of choosing a device, if we are doing it on a piece of iron, we know the name of the FPGA for sure, and choose it.  If we just do a project for FPGA, we will choose something more powerful, for example, the third cyclone.  I choose the FPGA which is installed in my starter whale. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/241/a4a/07b/241a4a07b929a5077c39967416088ab2.jpg" alt="1_proj_wizard_ch"></div><br><br>  Click Finish - the project is created.  The project structure in Quartus is hierarchical, we need to select the top of the hierarchy (Top-Level Entity).  We can use for designing circuit files and logic description files on one of the HDL (Hardware description language).  My opinion is that the schematic file with the main blocks of logic is most clearly used as the top of the hierarchy, and the blocks themselves are implemented on HDL.  Opinions may be different, while choosing, reading a lot of holivarny topics, but while he stopped on such a model, you can make your choice.  I chose VHDL ((Very high speed integrated circuits) Hardware Description Language) as the HDL language, you can use any other, for example Verilog or AHDL, it all depends on your preferences. <br><br>  Create our first project file (File - New ..) and select Block Diagram / Schematic File.  Now let's draw the simplest circuit, add one Input, one Output and connect them (in a real FPGA this circuit will transmit a signal from one leg to another).  For this Double Click on an empty place of the scheme and in the Symbol dialog that opens, select the required element. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/9b9/f5c/1d1/9b9f5c1d1339d8a044309c7377bc7734.jpg" alt="2_add_inp_outp"></div><br><br>  We connect just like that, by a line.  Give the pins the names (Double Click by elements), input call CLOCK_27 [0], and output call LEDR [0].  The names were not chosen by chance - CLOCK_27 [0] I then associate with the generator input 27Mhz, and LEDR [0] with a zero red LED.  Save the file, leaving a tick to add to the project.  Now set the resulting file to the top of the project hierarchy.  To do this, the Project Navigator window, in the Files tab, in the context menu of our file, select Set as Top-Level Entity.  Hello, world is ready.  Compiling the project (Processing - Start Compilation), if we see Info: Quartus II Full Compilation was successful.  - rejoice and believe that the first stage is over. <br><br>  Now let's deal with our goals.  Our device will start counting the minutes and hours when the power is turned on.  So we need four seven-segment indicators ‚ÄúHHH: MM‚Äù.  For timing, we need a more or less accurate 1Hz signal.  We get it by dividing the frequency 27Mhz, then we will count it by 60 (seconds), then again by 60 (minutes), and then by 24 (hours).  From the last two blocks the binary number of minutes and hours will go to the decoder Bin -&gt; BCD (binary-coded decimal) -&gt; 7seg.  Here, in general, and the whole device.  At once I will make a reservation that the scheme will be asynchronous (Minutes start from seconds, and hours from minutes), for simplicity and clarity. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/ecc/ace/f68/eccacef6864212ef17f816310241858e.jpg" alt="3_block_shem"></div><br><br>  So, we will create our first block - the frequency division block.  Create a new file, as we can already, only the file type will be VHDL File.  Paste the code into it: <br><br> <code>library ieee; <br> use ieee.std_logic_1164.all; <br> use ieee.std_logic_unsigned.all; <br> <br> entity Div_27Mhz_to_1Hz is <br> port( clk:in std_logic; clk_out:out std_logic); <br> end Div_27Mhz_to_1Hz; <br> <br> architecture div_behavior of Div_27Mhz_to_1Hz is <br> begin <br> process(clk) <br> variable cnt : integer range 0 to 27000000; <br> begin <br> if(clk'event and clk = '1') <br> then <br> <br> if(cnt &gt;= 13500000) <br> then <br> clk_out &lt;= '1'; <br> else <br> clk_out &lt;= '0'; <br> end if; <br> <br> if(cnt = 27000000) <br> then <br> cnt := 0; <br> else <br> cnt := cnt + 1; <br> end if; <br> <br> end if; <br> end process; <br> end div_behavior; <br></code> <br><br>  I will skip the service directives (you can see in the directory, links at the end), I will pay attention only to the logic of work.  First we declare the entity, i.e.  block itself.  We specify its inputs and outputs, their types and names.  The std_logic type in common means a bit.  Next, we describe the internal architecture of this unit.  The architecture consists of parallel processes.  Each process has its own sensitivity list, for example, the only process in the example above is sensitive to changes at input clk.  Variables can be declared for the process, in our example it is a variable of the type integer range 0 to 27000000. Next, the elementary logic is set in the process body: until half the period has passed - we push the logical zero to the output, half is passed - we push the unit, but do not forget to count and reset the counter to reach 27000000. I do not pretend to the ideal code - while I study, I will be happy with the amendments :) <br><br>  Save the file with the code and create a symbol (File - Create / Update - Create Symbol Files For Current Files), this is necessary in order to insert this block into our main scheme.  You can find your characters in the Project folder in the insert symbol dialog.  Now let's go over the remaining blocks in less detail. <br><br> <code>library ieee; <br> use ieee.std_logic_1164.all; <br> use ieee.std_logic_unsigned.all; <br> <br> -- For CONV_STD_LOGIC_VECTOR: <br> use ieee.std_logic_arith.all; <br> <br> entity cnt_0_to_59 is <br> port( clk:in std_logic; c59:out std_logic; vector:out std_logic_vector(5 downto 0)); <br> end cnt_0_to_59; <br> <br> architecture cnt_behavior of cnt_0_to_59 is <br> begin <br> process(clk) <br> variable cnt : integer range 0 to 59; <br> begin <br> if(clk'event and clk = '1') <br> then <br> if(cnt = 59) <br> then <br> cnt := 0; <br> c59 &lt;= '1'; <br> vector &lt;= CONV_STD_LOGIC_VECTOR(cnt, 6); <br> else <br> cnt := cnt + 1; <br> c59 &lt;= '0'; <br> vector &lt;= CONV_STD_LOGIC_VECTOR(cnt, 6); <br> end if; <br> end if; <br> end process; <br> end cnt_behavior; <br></code> <br><br>  This is a counting block from zero to 59, which we use to count minutes and seconds.  Of the new products, the output type is std_logic_vector (5 downto 0), which defines a group of bits (bit vector), as well as the function CONV_STD_LOGIC_VECTOR (cnt, 6), which converts a variable into a bit vector of the specified length. <br><br> <code>library ieee; <br> use ieee.std_logic_1164.all; <br> use ieee.std_logic_unsigned.all; <br> <br> -- For CONV_STD_LOGIC_VECTOR: <br> use ieee.std_logic_arith.all; <br> <br> entity cnt_0_to_23 is <br> port( clk:in std_logic; vector:out std_logic_vector(4 downto 0)); <br> end cnt_0_to_23; <br> <br> architecture cnt_behavior of cnt_0_to_23 is <br> begin <br> process(clk) <br> variable cnt : integer range 0 to 23; <br> begin <br> if(clk'event and clk = '1') <br> then <br> if(cnt = 23) <br> then <br> cnt := 0; <br> vector &lt;= CONV_STD_LOGIC_VECTOR(cnt, 5); <br> else <br> cnt := cnt + 1; <br> vector &lt;= CONV_STD_LOGIC_VECTOR(cnt, 5); <br> end if; <br> end if; <br> end process; <br> end cnt_behavior;</code> <br> <br>  Above the hour counter.  Nothing new. <br><br> <code>library ieee; <br> use ieee.std_logic_1164.all; <br> use ieee.std_logic_unsigned.all; <br> <br> -- For CONV_STD_LOGIC_VECTOR: <br> use ieee.std_logic_arith.all; <br> <br> entity bin2bcd_5bit is <br> port( bin:in std_logic_vector(4 downto 0); <br> bcd1:out std_logic_vector(3 downto 0); <br> bcd10:out std_logic_vector(3 downto 0) <br> ); <br> <br> end bin2bcd_5bit; <br> <br> architecture converter_behavior of bin2bcd_5bit is <br> begin <br> process(bin) <br> variable i : integer range 0 to 23; <br> variable i1 : integer range 0 to 9; <br> begin <br> i := conv_integer(bin); <br> i1 := i / 10; <br> bcd10 &lt;= CONV_STD_LOGIC_VECTOR(i1, 4); <br> i1 := i rem 10; <br> bcd1 &lt;= CONV_STD_LOGIC_VECTOR(i1, 4); <br> end process; <br> end converter_behavior;</code> <br> <br>  The Binary to BCD converter, in fact, simply splits one binary number into two, each of which represents a digit of a decimal number.  Among the novelties is the rem operator, the remainder from division.  The converter for six bits is written in a similar way, I will not give it. <br><br> <code>library ieee; <br> use ieee.std_logic_1164.all; <br> use ieee.std_logic_unsigned.all; <br> <br> entity BCD_to_7seg is <br> port( <br> BCD:in std_logic_vector(3 downto 0); <br> seg:out std_logic_vector(6 downto 0) <br> ); <br> <br> end BCD_to_7seg; <br> <br> architecture conv_behavior of BCD_to_7seg is <br> begin <br> process(BCD) <br> begin <br> if BCD = "0000" then seg &lt;= "0000001";--0 <br> elsif BCD = "0001" then seg &lt;= "1001111";--1 <br> elsif BCD = "0010" then seg &lt;= "0010010";--2 <br> elsif BCD = "0011" then seg &lt;= "0000110";--3 <br> elsif BCD = "0100" then seg &lt;= "1001100";--4 <br> elsif BCD = "0101" then seg &lt;= "0100100";--5 <br> elsif BCD = "0110" then seg &lt;= "0100000";--6 <br> elsif BCD = "0111" then seg &lt;= "0001111";--7 <br> elsif BCD = "1000" then seg &lt;= "0000000";--8 <br> elsif BCD = "1001" then seg &lt;= "0000100";--9 <br> else seg &lt;= "1001001";--err <br> end if; <br> end process; <br> end conv_behavior;</code> <br> <br>  Single-bit converter to a seven-segment code implemented by a simple truth table.  The seven-segment code itself is a bit representation of the burning segments on the indicator in the order abcdefg, in my case also inverse. <br><br><div style="text-align:center;"><img src="http://lh3.ggpht.com/_IctAdKE9U2c/S0OU3bnuHiI/AAAAAAAAAMI/tAZNQy_VjrQ/4_segment_display.jpg" alt="image"></div><br><br>  So we implemented all the blocks, it remains to put them together.  I will cite the Main scheme and the decoding of the symbol bin2seg, which is also implemented as a scheme to save space. <br><br>  Main scheme: <br>  (click-click) <br><div style="text-align:center;"> <a href=""><img src="http://lh3.ggpht.com/_IctAdKE9U2c/S0OVaoShsSI/AAAAAAAAAMk/u2NAakf02yw/s400/5_main.jpg"></a> </div><br>  (As can be seen in the diagram, I output the seconds count on the green LEDs, again for clarity) <br><br>  bin2seg: <br>  (click-click) <br><div style="text-align:center;"> <a href=""><img src="http://lh6.ggpht.com/_IctAdKE9U2c/S0OWn7Z3UBI/AAAAAAAAANA/EgSm6uSEzR8/s400/6_bin_to_seg.jpg"></a> </div><br><br>  The project is ready, you can compile and test.  I wanted to tell you about the modeling of the work of the scheme in the quarter, but something so happened a lot, there will be interest - I will write in the next article.  Now the last stage - we need to associate our virtual inputs / outputs with real FPGA legs. <br><br>  The association can be carried out after compilation in the menu of Assignments - Pins.  In the window that appears, you will see the location of the pins on the chip and under it the list of pins of the project.  By changing the Location field, we map the internal inputs to the real legs.  In my case, I look at the names of the pins according to the scheme of my board, and in the case of their development you will know the names of the pins.  The last step is the firmware, it is carried out from the Tools - Programmer menu, the start button (the programmer must be connected and the drivers are installed). <br><br>  Well, everything seems to be.  In conclusion, I want to say that if there is public interest in this topic, I will certainly write more articles.  For example, how to finish this project to normal hours with setting and alarm clock or something new, I already have plans :) <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/6azhbEc2Y6Q%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhi5o_O82_Ncepnezy-0oBduTQkSKQ" frameborder="0" allowfullscreen=""></iframe><br><br>  <b>Promised links:</b> <br>  <a href="http://www.altera.com/">www.altera.com</a> - all kinds of documentation and product advertising <br>  <a href="http://www.bsuir.by/vhdl/reference/">www.bsuir.by/vhdl/reference</a> - VHDL reference <br>  <a href="http://altera.ru/">altera.ru</a> - our representative of the company Altera, I ordered a starter kit there <br>  + I used the book of J.R.Armstrong Modeling of digital systems in the VHDL language. <br>  For those who will undertake to collect himself, I attach the scheme of my board.  ( <a href="http://depositfiles.com/ru/files/j4ssue6o1">quality</a> ) <br>  And also a bonus - the project of the timer ( <a href="http://depositfiles.com/files/czyngfklf">Kach Kach Kach</a> ) </div><p>Source: <a href="https://habr.com/ru/post/80056/">https://habr.com/ru/post/80056/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../80050/index.html">Will Intel have to remove from the compiler a function that deliberately delivers bad code for AMD processors?</a></li>
<li><a href="../80051/index.html">December FireForge.net Review</a></li>
<li><a href="../80052/index.html">Nexus One. The presentation has begun</a></li>
<li><a href="../80053/index.html">What fine HTML code should look like.</a></li>
<li><a href="../80054/index.html">How to make a budget geocluster hosting</a></li>
<li><a href="../80057/index.html">Nexus one</a></li>
<li><a href="../80059/index.html">Where to chew granite science</a></li>
<li><a href="../80062/index.html">Pyrant + PyModels - the easiest replacement for Django ORM *</a></li>
<li><a href="../80065/index.html">encached: caching server</a></li>
<li><a href="../80066/index.html">Pandigital 7000DW Photo Frame Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>