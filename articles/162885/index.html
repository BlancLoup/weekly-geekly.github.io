<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Black holes in the development of Web project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It's about PHP, JavaScript and MySQL as a starting point. I will also give some figures of performance tests and time losses that can kill a project, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Black holes in the development of Web project</h1><div class="post__text post__text-html js-mediator-article">  It's about PHP, JavaScript and MySQL as a starting point.  I will also give some figures of performance tests and time losses that can kill a project, using the example of one of the products that I recently had to open to find problem areas, and show how to kill a project in three steps. <br><br><img src="https://habrastorage.org/storage2/fbb/817/d4f/fbb817d4f38ac13024eab5e73b880a05.jpg"><br><br><h4>  Preface. </h4><br>  Recently, I was given the task to help find problems in one of the web projects created as usual in PHP + MySQL, and all this is also wrapped up in the Symfony Framework.  The database began to grow strongly, as people collected behavioral events (for example, a fleet of vehicles) that flowed literally every 5 minutes.  Naturally, the event table has grown, and in order for MySQL to cope with it at least somehow, it was broken into partitions.  In the end, it all came down to all sorts of samples and reports, i.e.  analytics.  As a result, even a simple sample for the period, plus a small calculation, took from 11 seconds and more.  Apparently, therefore, it was decided to limit the selected period in days. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  And so it went: <br><br><h4>  Problem 1 - Base </h4><br>  The base was chosen MySQL.  Apparently the fact that it is free, bribes everyone.  But I consider weighing on the third-tier base, heavy analytics, I consider the first mistake and the most important one.  On a test sample of <b>700K</b> entries in the event table, the sample for the period increased to <b>30 seconds</b> .  All the complexity was in the data.  The events table had a ‚Äúdifferent type of event‚Äù entry with the ON or OFF property, i.e.  the beginning and the end of a certain event.  Everything is pretty standard, and anyone would easily make a sample: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ev1.event_point,ev1.event_date, (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> event_date <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> test_events <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ev1.event_point = event_point <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> event_type = (<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> ev1.event_type = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> event_date &gt; ev1.event_date <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> end_date <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test_events <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ev1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ev1.event_date <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-string"><span class="hljs-string">'2012-1-1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-string"><span class="hljs-string">'2012-1-31'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> ev1.event_type <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> , <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br><br>  for example and test, one type of event 1 beginning and 2 end was used, although in the base there are about 40 pairs.  As a result, simply selecting the records for the period, with the addition of the end of this event immediately, takes about <b>20-30 seconds</b> from MySQL. <br>  For comparison, the free database, SQL Server 2008 in the Web edition, was also taken, all of which was launched on MS Server 2008 R2 in the VirtualBox virtual environment.  I will say right away that the Web edition, though free, does not have a number of important options, especially important for analytics, for example, there is no optimization and caching for View and Procedure. <br>  All tests showed that MS SQL easily executes a query in less than <b>1 second</b> with <b>1KK</b> data. <br>  Next, it was necessary to make a simple calculation and choose how long those or other types of events took for a certain piece of time.  This is not difficult to calculate at the SQL server level, we impose a condition on top and we get a ready-made report: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> event_point,<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">TIMESTAMPDIFF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">HOUR</span></span>,event_date,end_date)) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ev1.event_point,ev1.event_date, (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> event_date <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> test_events <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ev1.event_point = event_point <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> event_type = (<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> ev1.event_type = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> event_id &gt; ev1.event_id <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> end_date <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test_events <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ev1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ev1.event_date <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-string"><span class="hljs-string">'2012-1-1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-string"><span class="hljs-string">'2012-1-31'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> ev1.event_type <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> , <span class="hljs-number"><span class="hljs-number">2</span></span>) ) report <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> event_point</code> </pre><br><br>  Such an example on the same MS SQL database is performed instantly, in less than 1 second.  But with MySQL you can not wait for the result, increasing the period, the base went tight.  Apparently, those who collected the project understood this and decided to stop processing the sample right in PHP.  And in order not to lose everything as well 20-30 seconds per JOIN, it was decided to make a simple SELECT for the period, throw everything into Array and there, by running, find the beginning and the end and then easily give the amounts.  What was done, in the end, I again came to a dead end, the growth of the period began to take up to 1 minute.  on the calculation.  And I began to study the second problem, trying to understand why just running an Array takes such a long time.  I was hoping that there would be just a typo or mistake, but it turned out that just running Array takes a lot of time.  Here is the second problem. <br><br><h4>  Problem 2 - Array in PHP </h4><br>  Having studied all the data, I realized that PHP cannot quickly handle large arrays.  After reading in various forums, I saw discussions confirming this version.  This is a PHP problem.  It was decided to write a simple test to verify the facts. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $summary[] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $count = <span class="hljs-number"><span class="hljs-number">5000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i1=<span class="hljs-number"><span class="hljs-number">0</span></span>;$i1&lt;$count;++$i1){ $summary[$i1] = $i1; } $t = microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i1=<span class="hljs-number"><span class="hljs-number">0</span></span>;$i1&lt;$count;++$i1){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i2=<span class="hljs-number"><span class="hljs-number">0</span></span>;$i2&lt;$count;++$i2){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-string"><span class="hljs-string">"5468735354987"</span></span>!=<span class="hljs-string"><span class="hljs-string">"654654655465"</span></span>){ $summary[$i1] = $i1*$i2; } } } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;li&gt;time: "</span></span>.(microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)-$t).<span class="hljs-string"><span class="hljs-string">' ms&lt;/li&gt;'</span></span>; $sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i1=<span class="hljs-number"><span class="hljs-number">0</span></span>;$i1&lt;$count;++$i1){ $sum = $sum + $summary[$i1]; } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;li&gt;test["</span></span>+$sum+<span class="hljs-string"><span class="hljs-string">"]"</span></span>; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  The code was created based on the task in the project.  In this test, the search is 5000 * 5000 = 25KK cycles, and even ++ ++ i was used instead of $ i ++ to raise the speed.  As a result, this test gave <b>11 seconds</b> .  Attempting to run this code just directly in the console without a Web server, gave me <b>10 seconds</b> .  And it all started on my computer and not on the host or virtual machine, and all with the configuration: Intel Core i5, 8GB.  PHP 5.3.9 <br>  Realizing that for PHP this is the limit that you can squeeze, I decided to check this code on other platforms, having a virtual machine with MS Server 2008 R2 on hand.  The test code was easily transferred to ASP, ASPX, WSC, VBS and NodeJS.  As a result, I received the following data: <br><br><img src="https://habrastorage.org/storage2/9d1/b6c/347/9d1b6c3472f562848d4ce6fe76629e5c.jpg" alt="image"><br><br>  In the screenshot we see three test options.  1) virtual machine 2) my computer 3) servers available to me on the Internet. <br><br>  1. PHP surprisingly gave very close results, considering that everything was run perfectly on different resources and capacities. <br>  2. ASP is a close analogue of PHP that gave a worse result, and it also depends on the capacity of the environment. <br>  3. WCS was very disappointing, given that Microsoft once described it as a compiled version of ASP, which should work much faster, which turned out to be completely different. <br>  4. VBS is a purely console version of the script, although it showed better results than PHP, but for a web project it is unacceptable. <br>  5. ASPX showed just great results.  Here I am not surprised, all the same it is C # <br>  6. NodeJS also issued, as expected, just excellent performance. <br><br>  Here are all the script options: <br><br><div class="spoiler">  <b class="spoiler_title">test.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $summary[] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $count = <span class="hljs-number"><span class="hljs-number">5000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i1=<span class="hljs-number"><span class="hljs-number">0</span></span>;$i1&lt;$count;++$i1){ $summary[$i1] = $i1; } $t = microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i1=<span class="hljs-number"><span class="hljs-number">0</span></span>;$i1&lt;$count;++$i1){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i2=<span class="hljs-number"><span class="hljs-number">0</span></span>;$i2&lt;$count;++$i2){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-string"><span class="hljs-string">"5468735354987"</span></span>!=<span class="hljs-string"><span class="hljs-string">"654654655465"</span></span>){ $summary[$i1] = $i1*$i2; } } } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;li&gt;time: "</span></span>.(microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)-$t).<span class="hljs-string"><span class="hljs-string">' ms&lt;/li&gt;'</span></span>; $sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i1=<span class="hljs-number"><span class="hljs-number">0</span></span>;$i1&lt;$count;++$i1){ $sum = $sum + $summary[$i1]; } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;li&gt;test["</span></span>+$sum+<span class="hljs-string"><span class="hljs-string">"]"</span></span>; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">test.asp</b> <div class="spoiler_text"><pre> <code class="vbscript hljs">&lt;% count = <span class="hljs-number"><span class="hljs-number">5000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> summary(<span class="hljs-number"><span class="hljs-number">5000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i1=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> count summary(i1) = i1 <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> t = <span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i1=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> count <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i2=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> count <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"5468735354987"</span></span>&lt;&gt;<span class="hljs-string"><span class="hljs-string">"654654655465"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> summary(i1) = i1*i2 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>.write <span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>()-t sum = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i1=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> count sum = sum + summary(i1) <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>.write <span class="hljs-string"><span class="hljs-string">"sum:"</span></span>&amp;sum <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>.write <span class="hljs-string"><span class="hljs-string">"&lt;br&gt;test-wsc&lt;br&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> obj = <span class="hljs-built_in"><span class="hljs-built_in">GetObject</span></span>(<span class="hljs-string"><span class="hljs-string">"script:"</span></span>&amp;<span class="hljs-built_in"><span class="hljs-built_in">Server</span></span>.MapPath(<span class="hljs-string"><span class="hljs-string">"test.wsc"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">Call</span></span> obj.run() %&gt;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">test.wsc</b> <div class="spoiler_text"><pre> <code class="vbscript hljs">&lt;?xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span>?&gt; &lt;component&gt; &lt;?component <span class="hljs-keyword"><span class="hljs-keyword">error</span></span>=<span class="hljs-string"><span class="hljs-string">"true"</span></span> debug=<span class="hljs-string"><span class="hljs-string">"true"</span></span>?&gt; &lt;registration description=<span class="hljs-string"><span class="hljs-string">"test"</span></span> progid=<span class="hljs-string"><span class="hljs-string">"test"</span></span> version=<span class="hljs-string"><span class="hljs-string">"0.1"</span></span> classid=<span class="hljs-string"><span class="hljs-string">"{13e4b1b3-c698-40ea-8450-9cbc9b33ef03}"</span></span> &gt; &lt;/registration&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>&gt; &lt;method name=<span class="hljs-string"><span class="hljs-string">"run"</span></span>/&gt; &lt;/<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>&gt; &lt;implements type=<span class="hljs-string"><span class="hljs-string">"ASP"</span></span> id=<span class="hljs-string"><span class="hljs-string">"ASP"</span></span>/&gt; &lt;script language=<span class="hljs-string"><span class="hljs-string">"VBScript"</span></span>&gt; &lt;![CDATA[ <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> run() count = <span class="hljs-number"><span class="hljs-number">5000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> summary(<span class="hljs-number"><span class="hljs-number">5000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i1=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> count summary(i1) = i1 <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> t : t = <span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i1=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> count <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i2=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> count <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"5468735354987"</span></span>&lt;&gt;<span class="hljs-string"><span class="hljs-string">"654654655465"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> summary(i1) = i1*i2 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>.write (<span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>()-t) sum = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i1=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> count sum = sum + summary(i1) <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>.write <span class="hljs-string"><span class="hljs-string">"sum:"</span></span>&amp;sum <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> ]]&gt; &lt;/script&gt; &lt;/component&gt;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">test.vbs</b> <div class="spoiler_text"><pre> <code class="vbscript hljs">count = <span class="hljs-number"><span class="hljs-number">5000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> summary(<span class="hljs-number"><span class="hljs-number">5000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i1=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> count summary(i1) = i1 <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> t = <span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i1=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> count <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i2=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> count <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"5468735354987"</span></span>&lt;&gt;<span class="hljs-string"><span class="hljs-string">"654654655465"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> summary(i1) = i1*i2 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-built_in"><span class="hljs-built_in">msgbox</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>()-t) sum = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i1=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> count sum = sum + summary(i1) <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-built_in"><span class="hljs-built_in">msgbox</span></span> <span class="hljs-string"><span class="hljs-string">"sum:"</span></span>&amp;sum</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">test.aspx</b> <div class="spoiler_text"><pre> <code class="cs hljs">&lt;%@ Page validateRequest=<span class="hljs-string"><span class="hljs-string">"false"</span></span> Debug=<span class="hljs-string"><span class="hljs-string">"true"</span></span> %&gt; &lt;%@ Import Namespace=<span class="hljs-string"><span class="hljs-string">"System.IO"</span></span> %&gt; &lt;%@ Import Namespace=<span class="hljs-string"><span class="hljs-string">"System.Data"</span></span> %&gt; &lt;%@ Import Namespace=<span class="hljs-string"><span class="hljs-string">"System.Diagnostics"</span></span> %&gt; &lt;%@ Import Namespace=<span class="hljs-string"><span class="hljs-string">"System.Threading"</span></span> %&gt; &lt;script language=<span class="hljs-string"><span class="hljs-string">"C#"</span></span> runat=<span class="hljs-string"><span class="hljs-string">"server"</span></span>&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Page_Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Object sender, EventArgs E</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = <span class="hljs-number"><span class="hljs-number">5000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] summary = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[<span class="hljs-number"><span class="hljs-number">5000</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; i1 &lt; count; i1++) { summary[i1] = i1; } Stopwatch stopwatch = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stopwatch(); stopwatch.Start(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; i1 &lt; count; ++i1) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; i2 &lt; count; ++i2) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-string"><span class="hljs-string">"5468735354987"</span></span>!=<span class="hljs-string"><span class="hljs-string">"654654655465"</span></span>){ summary[i1] = i1*i2; } } } stopwatch.Stop(); Response.Write(<span class="hljs-string"><span class="hljs-string">"&lt;li&gt;time: "</span></span> + (stopwatch.ElapsedMilliseconds) + <span class="hljs-string"><span class="hljs-string">" ms&lt;/li&gt;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; i1 &lt; count; ++i1) { sum = sum + summary[i1]; } Response.Write(<span class="hljs-string"><span class="hljs-string">"&lt;li&gt;test["</span></span> + sum + <span class="hljs-string"><span class="hljs-string">"]"</span></span>); } &lt;/script&gt;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">test_nodejs.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>); http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ res.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, {<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>}); summary = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(); count = <span class="hljs-number"><span class="hljs-number">5000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i1=<span class="hljs-number"><span class="hljs-number">0</span></span>;i1&lt;count;++i1){ summary[i1] = i1; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> start = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getTime(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i1=<span class="hljs-number"><span class="hljs-number">0</span></span>;i1&lt;count;++i1){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i2=<span class="hljs-number"><span class="hljs-number">0</span></span>;i2&lt;count;++i2){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-string"><span class="hljs-string">"5468735354987"</span></span>!=<span class="hljs-string"><span class="hljs-string">"654654655465"</span></span>){ summary[i1] = i1*i2; } } } res.write(<span class="hljs-string"><span class="hljs-string">"&lt;li&gt;time: "</span></span>+(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getTime() - start)+<span class="hljs-string"><span class="hljs-string">" ms"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i1=<span class="hljs-number"><span class="hljs-number">0</span></span>;i1&lt;count;++i1){ sum = sum + summary[i1]; } res.write(<span class="hljs-string"><span class="hljs-string">"&lt;li&gt;sum: ["</span></span>+sum+<span class="hljs-string"><span class="hljs-string">"]"</span></span>); res.end(); }).listen(<span class="hljs-number"><span class="hljs-number">1337</span></span>, <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Server running at http://127.0.0.1:1337/'</span></span>);</code> </pre><br></div></div><br><br>  The data obtained suggested that JavaScript in the browser is similar to ASPX and NodeJS, so it was decided to check the same thing just in the browser.  Again, the code is instantly converted to a test under HTML and we get the following code: <br><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">testClear</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> summary = []; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> count = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">5000</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i1=</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">;i1&lt;count;++i1){ summary[i1] = i1; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> start = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">Date</span></span></span><span class="javascript">().getTime(); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i1=</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">;i1&lt;count;++i1){ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i2=</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">;i2&lt;count;++i2){ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript">(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"5468735354987"</span></span></span><span class="javascript">!==</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"654654655465"</span></span></span><span class="javascript">){ summary[i1] = i1*i2; } } } </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"testClear"</span></span></span><span class="javascript">).innerHTML = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"time: "</span></span></span><span class="javascript">+(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">Date</span></span></span><span class="javascript">().getTime() - start)+</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">" ms"</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> sum = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(i1=</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">;i1&lt;count;++i1){ sum = sum + summary[i1]; } alert(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"sum: ["</span></span></span><span class="javascript">+sum+</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"]"</span></span></span><span class="javascript">); } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"testClear();"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>test clear:<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'testClear'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Running in the browser gave me <b>75 ms</b> , which is just fine.  The solution is clear right away - cut the array processing from PHP and transfer it to the client in the array, and there to do the calculation.  What was done ... BUT! .. time at startup again turned out to be over <b>10 sec</b> .  All tests and searches in the code, brought me to a new problem called <b>Prototype</b> . <br><br><h4>  Problem 3 - Prototype and AJAX </h4><br>  The fact is that in the project interface, everything was built on the version with AJAX.  Those.  developers have done in the spirit of Web 2.0, fashionable and beautiful.  The user selects data selection options, clicks CREATE REPORT and receives a loaded report by Ajax below.  Everyone thinks it is now standard, to issue information without rebooting.  Here lies the treacherous enemy. <br>  It turns out that <b>Prototype</b> has two options for loading the page, for which the evalScripts [true / false] parameter is responsible.  When (evalScripts = false), Prototype loads the information and displays it on the screen simply as text, and naturally all the blocks with JavaScript will not be executed.  This is where the dynamically loaded pages are processed and evalScripts = true is set, and it just parses with the execution of eval () for the script part.  As a result, instead of a clean code with its <b>75 ms,</b> we get about <b>11 seconds</b> !!!  For me it was a shock.  It turns out that you can not download the Ajax code and execute it.  And this fear was confirmed as soon as I calculated the specific report in the interface header.  Those.  in the loaded page, left Array issued by PHP and made an external function call with the calculation from the global environment passing the array as a parameter, and got its <b>75 ms back</b> . <br><br>  This fact prompted me to write another test, with the same code, but to test different browsers and also compare it with the Ajax behavior in <b>JQuery</b> . <br><br>  In the end, I got the following data: <br><br><img src="https://habrastorage.org/storage2/1ee/080/002/1ee0800022d3ffa6b15bba201fd3b268.jpg" alt="image"><br><br>  Code samples can be seen here: <br><br><div class="spoiler">  <b class="spoiler_title">test.htm</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">testClear</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> summary = []; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> count = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">5000</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i1=</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">;i1&lt;count;++i1){ summary[i1] = i1; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> start = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">Date</span></span></span><span class="javascript">().getTime(); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i1=</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">;i1&lt;count;++i1){ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i2=</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">;i2&lt;count;++i2){ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript">(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"5468735354987"</span></span></span><span class="javascript">!==</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"654654655465"</span></span></span><span class="javascript">){ summary[i1] = i1*i2; } } } </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"testClear"</span></span></span><span class="javascript">).innerHTML = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"time: "</span></span></span><span class="javascript">+(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">Date</span></span></span><span class="javascript">().getTime() - start)+</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">" ms"</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> sum = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(i1=</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">;i1&lt;count;++i1){ sum = sum + summary[i1]; } alert(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"sum: ["</span></span></span><span class="javascript">+sum+</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"]"</span></span></span><span class="javascript">); } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"testClear();"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>test clear:<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'testClear'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">test_jquery.htm</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'text/javascript'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'jquery.js'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">test</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#test'</span></span></span><span class="javascript">).html(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'loading...'</span></span></span><span class="javascript">); $.get(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'test_ajax.html'</span></span></span><span class="javascript">, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">data</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#test'</span></span></span><span class="javascript">).html(data); }); } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"test();"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>test jquery ajax:<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'test'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">test_prototype.htm</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'text/javascript'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'prototype.js'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">testFn</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'test'</span></span></span><span class="javascript">).update(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'loading...'</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> Ajax.Updater(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'test'</span></span></span><span class="javascript">,</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'test_ajax.html'</span></span></span><span class="javascript">, { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">method</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'get'</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">asynchronous</span></span></span><span class="javascript">:</span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">evalScripts</span></span></span><span class="javascript">:</span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">onSuccess</span></span></span><span class="javascript">: </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">transport</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'test'</span></span></span><span class="javascript">).update(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'in process...'</span></span></span><span class="javascript">); }, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">onFailure</span></span></span><span class="javascript">: </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">transport</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ alert(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Error"</span></span></span><span class="javascript">); } }); } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"testFn();"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>test prototype ajax:<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'test'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">test_ajax.html</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> summary = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">Array</span></span></span><span class="javascript">(); count = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">5000</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(i1=</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">;i1&lt;count;++i1){ summary[i1] = i1; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> start = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">Date</span></span></span><span class="javascript">().getTime(); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i1=</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">;i1&lt;count;++i1){ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i2=</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">;i2&lt;count;++i2){ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript">(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"5468735354987"</span></span></span><span class="javascript">!=</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"654654655465"</span></span></span><span class="javascript">){ summary[i1] = i1*i2; } } } </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"test"</span></span></span><span class="javascript">).innerHTML = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"time: "</span></span></span><span class="javascript">+(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">Date</span></span></span><span class="javascript">().getTime() - start)+</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">" ms"</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> sum = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(i1=</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">;i1&lt;count;++i1){ sum = sum + summary[i1]; } alert(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"sum: ["</span></span></span><span class="javascript">+sum+</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"]"</span></span></span><span class="javascript">); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><br>  As a result, the picture came out pretty scary. <br>  1. Why 64bit version of IE with clean code gave such a loss of speed, working in 64bit environment, I did not understand <br>  2. The speed of Javascript from under the Prototype is just awful.  Between the clean code and the option with Ajax, the difference is huge. <br>  3. jQuery surprised too.  Although not as much as the Propotype, it is also far from the pure execution of the JS code. <br>  4. Further analysis leads to a complete dead end.  Why Chrome and FireFox gave such terrible results compared to IE.  Moreover, IE9 was in a virtual machine, and IE10 was already just on the computer. <br><br>  There were no other options to double-check.  What was at hand, and then used.  You can take and check for yourself.  But the situation is, in principle, clear. <br><br><h4>  Problem 4 - String Replace </h4><br>  Literally at the time of this writing, I came across one more problem, but already in another web project, and already on ASP.  There, the base issued reports, and as a result, an output of about 3.5Mb was obtained, with placed markers for subsequent filling.  As a result, only the operation with Replace () took about 11 seconds.  The breakdown into pieces with a run, as well as a regular schedule, did not yield a speed increase.  As a result, another test was written to compare different platforms.  Having a small HTML report, so under 3.5Mb in size, I decided to feed it to the code and perform replays under the same conditions in order to compare it in the same way as with Array. <br><br>  So, we have a test file of 3.5 M in size, with tags placed in the text for the test, as well as the same version of the code imported to different platforms. <br><br>  Having banished the test, we get the following picture: <br><br><img src="https://habrastorage.org/storage2/0a3/d88/368/0a3d88368d56dc6ca096499d8a3abbde.jpg" alt="image"><br><br>  In this test (local host) it‚Äôs just UsbWebServer running on my computer, the rest are different providers that were accessed. <br><br>  1. ASP has huge problems with strings.  Regular version gave the result only worse, as well as breaking into small pieces and processing.  There is also a huge dependence on the server and its capacity. <br>  2. It also turned out with an ASPX script.  In a virtual machine, it gave <b>13 seconds</b> , but on a simple web server, in the simplest version of a web host that offers 1and1, the speed dropped 4 times, even though I ran the script in a virtual machine with dedicated resources for it. <br>  3. PHP again showed a certain stability, but now the Kiev hoster failed, apparently there were very few resources allocated for the host, or the server was busy at night. <br>  4. NodeJS gave the best result in this race.  But, unfortunately, I was not pleased, as more than <b>2 seconds</b> - this is quite critical, despite the fact that the report was not the largest.  So the problem with parsing had to be solved by searching for other methods. <br><br>  Code options: <br><br><div class="spoiler">  <b class="spoiler_title">test_replace.asp</b> <div class="spoiler_text"><pre> <code class="vbscript hljs">&lt;% <span class="hljs-comment"><span class="hljs-comment">'time: 13.58594 'time: 58.01563 Set FSO = CreateObject("Scripting.FileSystemObject") Set File = FSO.GetFile(Server.MapPath("test_replace.txt")) Set Reader = FSO.OpenTextFile(File, 1,False) buffer = Reader.ReadAll Reader.Close t = timer() For rec=1 to 10 For col=0 to 100 buffer = Replace(buffer,"{{"&amp;rec&amp;":"&amp;col&amp;"}}","-|-") Next Next response.write "time: "&amp;timer()-t response.write "&lt;hr&gt;" response.write buffer %&gt;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">test_replace.aspx</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">&lt;%@ Page validateRequest="false" <span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>="true" %&gt; &lt;%@ <span class="hljs-keyword"><span class="hljs-keyword">Import</span></span> Namespace="System.IO" %&gt; &lt;%@ <span class="hljs-keyword"><span class="hljs-keyword">Import</span></span> Namespace="System.Data" %&gt; &lt;%@ <span class="hljs-keyword"><span class="hljs-keyword">Import</span></span> Namespace="System.Diagnostics" %&gt; &lt;%@ <span class="hljs-keyword"><span class="hljs-keyword">Import</span></span> Namespace="System.Threading" %&gt; &lt;script <span class="hljs-keyword"><span class="hljs-keyword">language</span></span>="C#" runat="server"&gt; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> Page_Load(<span class="hljs-keyword"><span class="hljs-keyword">Object</span></span> sender, EventArgs E) { //<span class="hljs-type"><span class="hljs-type">time</span></span>: <span class="hljs-number"><span class="hljs-number">8736</span></span> ms //<span class="hljs-type"><span class="hljs-type">time</span></span>:[<span class="hljs-number"><span class="hljs-number">1</span></span>and1] <span class="hljs-number"><span class="hljs-number">16183</span></span> ms string buffer = File.ReadAllText(<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>.MapPath("test_replace.txt")); Stopwatch stopwatch = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Stopwatch(); stopwatch.<span class="hljs-keyword"><span class="hljs-keyword">Start</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> rec = <span class="hljs-number"><span class="hljs-number">0</span></span>; rec &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; rec++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> col = <span class="hljs-number"><span class="hljs-number">0</span></span>; col &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; col++) { buffer = buffer.Replace("{{" + rec + ":" + col + "}}", "-|-"); } } stopwatch.Stop(); Response.<span class="hljs-keyword"><span class="hljs-keyword">Write</span></span>("&lt;li&gt;time: " + (stopwatch.ElapsedMilliseconds) + " ms&lt;/li&gt;"); Response.<span class="hljs-keyword"><span class="hljs-keyword">Write</span></span>(buffer); } &lt;/script&gt;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">test_replace.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//time: 4.570 ms //time:ks.ua 10.3491752148 ms //time:servmax 5.7612838745117 ms $buffer = file_get_contents('test_replace.txt'); $t = microtime(true); for($rec=0;$rec&lt;10;++$rec){ for($col=0;$col&lt;100;++$col){ $buffer = str_replace( "{{".$rec.":".$col."}}","-|-", $buffer ); } } echo "time: ".(microtime(true)-$t).' ms'; echo "&lt;hr&gt;"; echo $buffer; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">test_replace_nodejs.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>); http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ fs.readFile(<span class="hljs-string"><span class="hljs-string">'test_replace.txt'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, data</span></span></span><span class="hljs-function">) </span></span>{ data = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { res.writeHead(<span class="hljs-number"><span class="hljs-number">404</span></span>); res.end(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(err)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } res.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, {<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> start = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getTime(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rec = <span class="hljs-number"><span class="hljs-number">0</span></span>; rec &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; ++rec) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> col = <span class="hljs-number"><span class="hljs-number">0</span></span>; col &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; ++col) { data = data.replace(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>( <span class="hljs-string"><span class="hljs-string">"{{"</span></span> + rec + <span class="hljs-string"><span class="hljs-string">":"</span></span> + col + <span class="hljs-string"><span class="hljs-string">"}}"</span></span>, <span class="hljs-string"><span class="hljs-string">"g"</span></span> ), <span class="hljs-string"><span class="hljs-string">"-|-"</span></span>); } } <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getTime()-start); res.end(data); }); }).listen(<span class="hljs-number"><span class="hljs-number">1337</span></span>, <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Server running at http://127.0.0.1:1337/'</span></span>);</code> </pre><br></div></div><br><br><h4>  Total </h4><br>  PS I wanted to describe briefly, issuing only numbers, but without explanation, it would probably be incomprehensible to someone.  So I apologize for the long text, well, the style of writing, for me it is still quite a big problem ... I am not a writer. <br><br>  PSS Very confused by the tendency to load all projects by default on MySQL.  Still, this is the base of the third echelon, and it is more suitable for Wordpress, forum and other minor tasks.  The fact that the base is free, in the end goes much more expensive.  Instead of doing all the analytics right in the database, instructing it to be engaged in optimization and caching, the developers are engaged in writing PHP code kilometers instead of a single query in the database.  If the question is only in price, then take MS SQL Server in the Web edition, which is also free, but it will give you all the advantages of analytics, or use Oracle, after all, these are high-end databases.  PostgresSQL did not produce an acceptable result, so it was immediately dropped for further testing.  If someone suddenly finds it interesting, here is an analogue of the SQL Server code that you can export to this or that database: <br><br><div class="spoiler">  <b class="spoiler_title">test.sql</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> test_events ( event_id <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), event_type <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, event_point <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, event_date datetime ) <span class="hljs-comment"><span class="hljs-comment">-------------- ALTER TABLE [test_events] ADD CONSTRAINT [IDX_event_type] DEFAULT ((1)) FOR [event_type] GO ALTER TABLE [test_events] ADD CONSTRAINT [IDX_event_point] DEFAULT ((1)) FOR [event_point] GO ALTER TABLE [test_events] ADD CONSTRAINT [IDX_event_date] DEFAULT (NULL) FOR [event_date] GO -------------- DECLARE @counter bigint = 0; DECLARE @event_type smallint = 1; -------------- BEGIN TRANSACTION; WHILE @counter &lt; 1000000 BEGIN IF @event_type=1 SET @event_type=2 ELSE SET @event_type=1 INSERT INTO test_events (event_type,event_point,event_date) VALUES (@event_type,ROUND(5 * RAND() + 100,0),DATEADD(MINUTE,@counter*10,'1/1/2011')) SET @counter = @counter + 1 END COMMIT TRAN; -------------- SET NOCOUNT ON SELECT event_point,SUM(DATEDIFF(hour,event_date,end_date)) FROM ( SELECT ev1.event_point,ev1.event_date, (select top 1 event_date from test_events where ev1.event_point = event_point and event_type = (CASE WHEN ev1.event_type = 1 THEN 2 ELSE 1 END) and event_id &gt; ev1.event_id) as end_date FROM test_events as ev1 WHERE ev1.event_date BETWEEN '2012-1-1' AND '2012-1-31' AND ev1.event_type IN (1 , 2) ) report GROUP BY event_point</span></span></code> </pre><br></div></div><br><br>  Thanks to all!  I hope that this information will be useful to you. </div><p>Source: <a href="https://habr.com/ru/post/162885/">https://habr.com/ru/post/162885/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../162873/index.html">How much does an iOS developer earn?</a></li>
<li><a href="../162875/index.html">IT Career Map</a></li>
<li><a href="../162877/index.html">Autonomous radio Thermometer on msp430, NRF24L01 + and solar powered</a></li>
<li><a href="../162881/index.html">Integration of the 1C-Bitrix template</a></li>
<li><a href="../162883/index.html">Crowdfunding Secrets from Gary and Charles</a></li>
<li><a href="../162889/index.html">Basics in SciLab. On the example of exam questions on CSVE</a></li>
<li><a href="../162891/index.html">Installing the patch when running VMware on Ubuntu 12.04 and other distributions</a></li>
<li><a href="../162893/index.html">A bit about Pivot tables in PostgreSQL and Python</a></li>
<li><a href="../162895/index.html">10 misconceptions about Windows Azure and Open Source</a></li>
<li><a href="../162901/index.html">QR code to help IT manager</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>