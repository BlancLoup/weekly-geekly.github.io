<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SAP Enterprise Portal Hacking</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The popularity of SAP NetWeaver Portal and its availability from the Internet make it an attractive target for attacks on companies of various sizes a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SAP Enterprise Portal Hacking</h1><div class="post__text post__text-html js-mediator-article"> The popularity of SAP NetWeaver Portal and its availability from the Internet make it an attractive target for attacks on companies of various sizes and profiles.  This article discusses how a potential attacker can crack this popular SAP ERP system module and how to avoid such a threat. <br><br>  Business applications represent an attractive target for computer intruders.  Objectives can be very different: industrial espionage, the application of financial and reputational losses, obtaining critical information for sale.  As a rule, attacks on business applications and systems are targeted and carried out by highly skilled people. <br><br>  SAP NetWeaver Portal (EP) is the main entry point to the SAP ERP system for all users of the corporate network.  A portal is usually used internally as a platform, where it is stored and processed as public information (including company news, employee data, etc.), as well as confidential information (internal documents, instructions and orders).  In addition, the portal provides users with the necessary tools with which they can perform their daily work tasks: to hold meetings and meetings, manage users, edit documents, work with the necessary tables, etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  A distinctive feature of SAP Portal is that it is associated with almost all other SAP components deployed on the company's network.  Thus, the compromise of SAP Portal will lead not only to the compromise of all the information processed in it, but also to turn it into a kind of springboard for further attacks by the attacker. <br><br>  Many users remain in the false belief that the SAP ERP system is not accessible from the Internet.  Meanwhile, SAP Portal can often be accessed from the Internet, using, for example, a simple Google Dork <code>inurl:/irj/portal</code> , where you can find a large number of SAP <code>inurl:/irj/portal</code> available for connection: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dfa/a30/f69/dfaa30f6938955a3a6fa8317cc1e2b13.png"><br><br>  Search Engine Shodan also makes it easy to detect available SAP Portal. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f2/4a2/8e7/4f24a28e7366b2a304da8ecb24c71e21.png"><br><br>  The popularity of SAP NetWeaver Portal and its availability from the Internet make it an attractive target for attacks on companies of various sizes and profiles.  Consider SAP Portal in more detail. <br><br><h5>  SAP NETWEAVER PORTAL ARCHITECTURE </h5><br>  The SAP Portal architecture is shown in the figure below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/23d/e01/eab/23de01eab161ce540b4b196fdb6327b2.png"><br><br>  As can be seen from the diagram, the basis of the system is the Web Application Server (SAP J2EE), in the context of which the portal operates.  Portal itself is a platform for the work of various modules, the main of which are iViews, applications and Web services. <br><br>  The diagram shows that SAP Portal is associated with a database, as well as with many other components and SAP models. <br><br>  Having a general idea of ‚Äã‚Äãthe architecture of the portal, you can proceed to consider the possible vectors of attacks on it. <br><br><h5>  ATTACK ON SAP NETWEAVER J2EE </h5><br>  SAP NetWeaver J2EE is the foundation of SAP Portal, so it‚Äôs important to understand how an attacker could compromise J2EE.  To do this, you need to understand some of the nuances of the work of J2EE. <br><br>  Access to applications running in J2EE is determined by the developers of these applications using a descriptor file called web.xml.  Below is an example of such a file descriptor. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>CriticalAction<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-class</span></span></span><span class="hljs-tag">&gt;</span></span>com.sap.admin.Critical.Action<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>CriticalAction<span class="hljs-tag"><span class="hljs-tag">&lt;/&lt;/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>/admin/critical<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-mapping</span></span></span><span class="hljs-tag"> &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">security-constraint</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-resource-collection</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-resource-name</span></span></span><span class="hljs-tag">&gt;</span></span>Restrictedaccess<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-resource-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>/admin/*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http-method</span></span></span><span class="hljs-tag">&gt;</span></span>GET<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http-method</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-resource-collection</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">auth-constraint</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">role-name</span></span></span><span class="hljs-tag">&gt;</span></span>administrator<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">role-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">auth-constraint</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">security-constraint</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Consider it in more detail. <br><br>  <b>Attack Verb Tampering</b> .  The most important tags in the descriptor file are: <code>servlet-name</code> , which defines the name of the servlet;  <code>http-method</code> , specifying the HTTP method to access the servlet;  <code>role-name</code> that indicates the required role to access the servlet.  Thus, to access the CriticalAction servlet, the user must send a <code>GET</code> request and at the same time have administrative rights. <br><br>  However, authentication can be bypassed: if a user makes a request other than <code>GET</code> , his user role will not be checked.  Developers, as a rule, restrict access to the application for the <code>GET</code> and <code>POST</code> methods, but sometimes forget about the <code>HEAD</code> method.  The latter is similar to <code>GET</code> , except for one difference - the server response contains only a header.  Thus, if the attacker finds an application that does not require confirmation from the server to work, he can try to use this error. <br><br>  For example, the CTC servlet allows you to manage users in SAP Portal: create and delete users, move them between groups.  Thus, it is a suitable object for attack, because in a request to create a user it is important to send a request, and not to receive a response. <br><br>  Although the CTC servlet provides authentication using the GET and POST methods, an attacker can gain administrative access to the ERP system using only two <code>HEAD</code> requests to the SAP Portal: <br>  ‚Ä¢ create a new blabla user with a blabla password <br><pre> <code class="html hljs xml">HEAD /ctc/ConfigServlet?param=com.sap.ctc.util.UserConfig;CREATEUSER;USERNAME=blabla,PASSWORD=blabla</code> </pre><br>  ‚Ä¢ add the created user to the Administrators group <br><pre> <code class="html hljs xml">HEAD /ctc/ConfigServlet?param=com.sap.ctc.util.UserConfig;ADD_USER_TO_GROUP;USERNAME=blabla,GROUPNAME=Administrators</code> </pre><br>  This type of attack is called Verb Tampering.  To protect the system, you must: <br>  ‚Ä¢ Install SAP Notes: 1503579,1616259 <br>  ‚Ä¢ Check all web.xml files.  This can be done using the ERPScan utility WEB.XML checker. <br><br>  <b>Invoker Servlet</b> .  Take a look at web.xml again. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>CriticalAction<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-class</span></span></span><span class="hljs-tag">&gt;</span></span>com.sap.admin.Critical.Action<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>CriticalAction<span class="hljs-tag"><span class="hljs-tag">&lt;/&lt;/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>/admin/critical<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-mapping</span></span></span><span class="hljs-tag"> &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">security-constraint</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-resource-collection</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-resource-name</span></span></span><span class="hljs-tag">&gt;</span></span>Restrictedaccess<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-resource-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>/admin/*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http-method</span></span></span><span class="hljs-tag">&gt;</span></span>GET<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http-method</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http-method</span></span></span><span class="hljs-tag">&gt;</span></span>HEAD<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http-method</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-resource-collection</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">auth-constraint</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">role-name</span></span></span><span class="hljs-tag">&gt;</span></span>administrator<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">role-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">auth-constraint</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">security-constraint</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Let's look at another important tag - the <code>url-pattern</code> , which describes the URI by which access to the servlet will be granted.  Thus, by sending a <code>GET</code> request to the URI <code>/admin/critical/CriticalAction</code> , the user will gain access to the CriticalAction servlet if he has the role of administrator. <br><br>  However, in this case, the attacker can bypass authentication and gain access to the servlet.  The fact is that, by default, the InvokerServlet mechanism is enabled in SAP, which allows you to access servlets using specially crafted links.  In other words, an attacker can access the CriticalAction servlet by URI <code>/servlet/com.sap.admin.Critical.Action</code> and gain access, not the name of any role, since this URI does not match the one specified in the url-pattern. <br><br>  To attack real ERP systems, an attacker can use the same CTC servlet.  In addition to user management, it allows you to execute commands of the OS running SAP Portal, for example, ‚Äúcreate user‚Äù. <br><br><pre> <code class="html hljs xml">/ctc/servlet/ConfigServlet?param=com.sap.ctc.util.FileSystemConfig;EXECUTE_CMD;CMDLINE=[]</code> </pre> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4af/bd4/4cb/4afbd44cb3eb324f33bab9af3750b71d.png"><br><br>  The figure shows the execution of the ipconfig command on the SAP Portal server. <br><br>  To protect the system, you must: <br>  ‚Ä¢ install the SAP notes: 1467771, 1445998; <br>  ‚Ä¢ Check all web.xml files (this can be done using the <a href="http://erpscan.com/products/erpscan-webxml-checker/">ERPScan</a> utility <a href="http://erpscan.com/products/erpscan-webxml-checker/">WEB.XML checker</a> ). <br><br>  We now turn to the consideration of possible attacks directly to the portal. <br><br><h5>  DIRECT ATTACKS ON THE PORTAL </h5><br>  <b>Security Zone</b> .  Portal has a module called Security Zone.  It serves as an additional tool for configuring access to portal programs (iViews).  Zones are defined for each application in the <code>portalapps.xml</code> file descriptor and have a critical parameter such as Safety Level.  He is responsible for the level of access to the application.  Safety Level provides four levels of safety: <br><br>  ‚Ä¢ No Safety <br>  o Anonymous users are allowed access to portal components defined in the security zone. <br>  ‚Ä¢ Low Safety <br>  o The user must be at least a portal user in order to access the portal components defined in the security zone. <br>  ‚Ä¢ Medium Safety <br>  o The user must have a specific role on the portal that has been granted access to the portal components defined in the security zone. <br>  ‚Ä¢ High Safety <br>  o The user must have a role on the portal with high administrative rights, which is granted the right to access the portal components defined in the security zone. <br><br>  Developers should carefully consider the Safety Levels task, since, if a user accesses, for example, an iView at a direct URL: <code>/irj/servlet/prt/portal/prtroot/&lt;iView_ID&gt;</code> , access to the application will be checked only by the results of the Safety check. Level. <br><br>  A number of critical applications were found in SAP Portal with <code>Safety Level= No Safety</code> .  To protect the system, you must check the settings of the Safety Level applications. <br><br>  <b>Xss</b> .  SAP Portal is a web application, so it has all the typical vulnerabilities for web applications.  One of these is crossite scripting (XSS).  However, unlike classic vectors for such attacks, when attacking a portal, an attacker can use Portal features ‚Äî for example, EPCF technology, which allows access to user data through a special JavaScript API. <br><br>  An example of such a "malicious" load: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SCRIPT</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> alert(EPCM.loadClientData(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"urn:com.sap.myObjects"</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"person"</span></span></span><span class="actionscript">); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SCRIPT</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  To protect the system, you must: <br>  ‚Ä¢ set the SAP Note: 1656549. <br><br>  <b>Directory traversal</b> .  This is another classic attack on Web applications.  However, there is also a specificity here - for example, going beyond the limits of the directory is not performed by traditional symbols <code>/../</code> , but <code>!252f..!252f</code> , as in this vulnerability: <br><pre> <code class="html hljs xml">/irj/servlet/prt/portal/prteventname/nav/prteventdata/root!3d!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f..!252f../prtroot/com.sap.portal.support.browse.default</code> </pre> <br><br>  To protect the system, you must: <br>  ‚Ä¢ Set the SAP Note: 1630293. <br><br>  <b>XML External Entity</b> .  This is a classic attack on XML transport of web applications.  XML is one of the main transports in SAP NetWeaver Portal, so a potential attacker might try to compromise the system through it - in particular, get administrative access to SAP Portal. <br><br>  SAP has a special password store, SAP Security Storage, located in the SecStore.properties file.  Passwords are encrypted, but the decryption key is located in the same directory as the passwords (in the SecStore.key file).  Thus, if an attacker can read these files, he can decrypt passwords and gain administrative access to the portal. <br><br>  This attack is carried out in several stages: <br>  ‚Ä¢ finding a vulnerability that allows you to read SAP-Portal server files; <br>  ‚Ä¢ reading the SecStore.properties file with encrypted passwords; <br>  ‚Ä¢ reading the SecStore.key file with keys for decrypting passwords; <br>  ‚Ä¢ decrypt the administrative password and gain access to SAP Portal. <br><br>  As a vulnerability that allows you to read files from the SAP Portal server, you can use the previously described.  This can be Directory Traversal, Command Execution. <br><br>  Separately, I would like to demonstrate the implementation of external XML-modules (XXE).  Here is a typical request to the portal in the sniffer. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c7/857/4e8/7c78574e8d32116a91b578bb914c9609.png"><br><br>  As you can see, the <code>POST</code> request contains a huge number of parameters.  If you look closely, one of them contains XML. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3e7/221/741/3e722174130d850b54fd8f30289f6fba.png"><br><br>  It is in it that we will try to implement a request that will return the contents of the <code>SecStore.properties</code> and <code>SecStore.key</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9bb/d0d/bea/9bbd0dbea315841526ad2317d9f7da23.png"><br><br>  The figure shows how you can read files from the SAP Portal server using the XXE vulnerability. <br><br>  After successfully reading the files, they can be decrypted using the ERPScan SecStore descriptor utility. <br><br>  To do this, run <code>SecStore_Cr.jar</code> in the same directory where the password files and key received from the server are located, specify the SID of the system.  As a result, the utility will display the decoded passwords and other service information. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/082/7c5/f54/0827c5f54e9d3a8e512b2541ea70213d.png"><br><br>  <b>Disclosure</b> .  Together with SAP Portal comes a lot of services that can be used by attackers to obtain information when planning attacks on the system.  However, other vectors of events are also possible - for example, using the portal as a springboard for further actions.  Many documents are stored here, and with the help of a simple internal search engine and queries like a <code>secret</code> or <code>password</code> , an attacker can find out a large amount of confidential information. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0b2/e75/e65/0b2e75e65b550d0d0e7eb8a14d1b54fe.png"><br><br><h5>  FINDINGS </h5><br>  The popularity of SAP NetWeaver Portal - one of the modules of the SAP ERP system - made it the most attractive target for attackers seeking to gain access to corporate information.  That is why attention to its security is required from both the system administrators and developers, and even ordinary users. </div><p>Source: <a href="https://habr.com/ru/post/204148/">https://habr.com/ru/post/204148/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../204136/index.html">Runet in pictures XI. Online lending in Russia: opportunities and prospects</a></li>
<li><a href="../204138/index.html">The five main qualities of a good solution for auditing IT infrastructure</a></li>
<li><a href="../204142/index.html">Drawings for self-assembly mobile phone</a></li>
<li><a href="../204144/index.html">Setting up a multi-loop control system of a fixed structure</a></li>
<li><a href="../204146/index.html">ArkOS Home Cloud on Raspberry Pi</a></li>
<li><a href="../204150/index.html">DotNetFiddle - JsFiddle for .Net developers</a></li>
<li><a href="../204154/index.html">SPS IPC Drives 2013 Visit Report - a bit about real industrial robots</a></li>
<li><a href="../204156/index.html">Pump controller</a></li>
<li><a href="../204160/index.html">How to facilitate the installation of .apk on Android or GUI for adb install</a></li>
<li><a href="../204162/index.html">TempusJS - working with the date in javascript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>