<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lazy initialization in Spring Boot 2.2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the translator: since the Spring Framework is one of the main frameworks on which we build CUBA , news about the new features of Spring does not ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lazy initialization in Spring Boot 2.2</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/k4/wp/kw/k4wpkwqnpuvxqqd3xyidbxkmgvo.png"></p><br><p>  <em>From the translator: since the Spring Framework is one of the main frameworks on which we build <a href="https://www.cuba-platform.ru/">CUBA</a> , news about the new features of Spring does not pass unnoticed by us.</em>  <em>Lazy initialization is one of the ways to reduce the time of the first application load, which in our age of universal use of microservices is an important metric.</em>  <em>For those who prefer reading video to reading, there is a 10-minute <a href="https://www.youtube.com/watch%3Fv%3D_m4xpHUf55E">speech by</a> Josh Long on the topic of the article.</em> </p><br><p>  The recently announced first milestone release of Spring Boot 2.2 adds support for lazy initialization.  In this article, we will look at new functionality and explain how to enable it. </p><a name="habracut"></a><br><h2 id="chto-eto-znachit---byt-lenivym">  What does it mean to be lazy? </h2><br><p>  The Spring Framework supports lazy initialization since its source code moved to <a href="https://github.com/spring-projects/spring-framework">git</a> eleven years ago.  By default, when the application context is updated, each bin is recreated and its dependencies are injected.  In contrast, if a bean is configured for lazy initialization, it will not be created and its dependencies will not be put down until it is necessary. </p><br><h2 id="vklyuchenie-lenivoy-inicializacii">  Enabling lazy initialization </h2><br><p> In any version of Spring Boot, you can enable lazy initialization if you don't mind <code>BeanFactoryPostProcessor</code> with your hands with <code>BeanFactoryPostProcessor</code> .  Spring Boot 2.2 simply simplifies this process by introducing a new property, <code>spring.main.lazy-initialization</code> (there are also equivalent methods in <code>SpringApplication</code> and <code>SpringApplicationBuilder</code> ).  When this property is set to <code>true</code> , the application beans will be configured to use lazy initialization. </p><br><h2 id="preimuschestva-lenivoy-inicializacii">  The benefits of lazy initialization </h2><br><p>  Lazy initialization can significantly reduce the start time of your application, since at this stage less classes are loaded and fewer bins are created.  For example, a small web application that uses Actuator and Spring Security usually starts 2.5 seconds.  And with lazy initialization, this process takes 2 seconds.  The exact values ‚Äã‚Äãof the acceleration will vary from application to application, depending on the structure of the dependency graph of bins. </p><br><p>  <em>Translator's note: I started this <a href="https://github.com/arun-gupta/spring-hibernate-hsql">example</a> by writing Spring Boot 2.2 dependencies, and the launch time with lazy initialization was 3 seconds, and without it - 4. I think that for more serious applications, a significant gain in start time due to the use of lazy initialization we will not see.</em>  <em><u>Upd:</u> on the advice of <a href="https://habr.com/ru/users/alek_sys/" class="user_link">alek_sys,</a> disabled validation and update of the database schema and enabled lazy initialization of JPA for both cases - it turned out 2.7 and 3.7 seconds before the appearance of the <code>Started WebApplication in...</code></em> </p><br><h2 id="a-chto-tam-naschet-devtools">  And what about DevTools? </h2><br><p>  Spring Boot DevTools provide a marked acceleration of development.  Instead of restarting the JVM and the application, every time you change something, DevTools ‚Äúhot restart‚Äù the application in the same JVM.  A significant advantage of this restart is that it gives JIT the opportunity to optimize the code that is executed when the application starts.  After several restarts, the original time of 2.5 seconds is reduced by almost 80% to 500 ms.  With lazy initialization, everything is even better.  Setting the <code>spring.main.lazy-initialization</code> property shows the restart time directly in the IDE to 400 ms. </p><br><h2 id="obratnaya-storona-lenivoy-inicializacii">  Reverse side of lazy initialization </h2><br><p>  As was shown above, turning on lazy initialization can quite seriously reduce the application launch time.  And, perhaps, you will have an overwhelming desire to use it all the time, or, at a minimum, you will be wondering why lazy initialization is not enabled by default.  There are several possible negative effects that are best clarified immediately. </p><br><p>  The fact that classes are not loaded, and the bins are not created until they are needed, can mask problems that could have been detected earlier in the application launch phase.  For example, it may be the absence of the required class, a memory overflow or an error due to incorrect configuration. </p><br><p>  In web applications, lazy configuration can increase the latency of HTTP requests that cause initialization of the beans.  This is usually the first request, but there may be additional unwanted effects affecting load balancing or automatic scaling. </p><br><h2 id="eta-shtuka-vklyuchena">  Is this thing included? </h2><br><p>  If you are not sure how exactly lazy initialization affects your application or you want to check that other aspects of the framework are right for you and do what you need, then it will be useful for you to use the debugger for this.  By setting the breakpoint on the bean's constructor, you can see at what exact moment the bean is initialized.  For example, in a web application written in Spring Boot and with lazy initialization enabled, you can see that the bins marked with the <code>@Controller</code> annotation <code>@Controller</code> not created before the first request to <code>DispatcerServlet</code> Spring MVC or to <code>DispatchHandler</code> Spring WebFlux. </p><br><h2 id="kogda-vklyuchat-lenivuyu-inicializaciyu">  When to include lazy initialization? </h2><br><p>  As we have already seen above, lazy initialization offers noticeable improvements during the launch of the application, but there are also down sides, so you need to use this feature very carefully. </p><br><p>  One area where lazy initialization can bring dividends (with almost no overhead) is the application development process.  While you are writing an application, reduced restart time, which is provided by lazy initialization in combination with DevTools, can save you considerable time. </p><br><p>  Where else can you get the benefits of using lazy initialization - so it is in integration tests.  You may already be using <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html">"slicing" tests</a> to reduce execution time, limiting the number of initialized bins in some types of tests.  Lazy initialization provides an alternative opportunity to achieve the same result.  If you are not in the right position to change the structure of the application for ‚Äúslice‚Äù tests, or for specifically your tests there is no suitable ‚Äúslicing‚Äù, then enabling lazy initialization will limit the number of bins to those that are used only in your test.  This will reduce the test execution time, especially if they are run in an isolated environment during development. </p><br><p>  Include a lazy initialization on the prode last.  And, if you decide to do this, do it with caution.  For web applications, the container manager can rely on the entry <code>/health</code> point, which usually responds fairly quickly, but you have to remember that, potentially, the first calls can take longer than usual.  You should also remember about the amount of memory allocated for the JVM, so as not to encounter overflow when all components are initialized. <br></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/445592/">https://habr.com/ru/post/445592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445582/index.html">CRM-systems: protection or threat?</a></li>
<li><a href="../445584/index.html">OS1: primitive kernel on Rust for x86. Part 2. VGA, GDT, IDT</a></li>
<li><a href="../445586/index.html">Android Academy in Moscow - talk about how it was and share course materials</a></li>
<li><a href="../445588/index.html">3D scanning of a person in 30 seconds will be shown at the exhibition</a></li>
<li><a href="../445590/index.html">English grammar. Who vs. Whom - how to understand which word to use</a></li>
<li><a href="../445594/index.html">Tools for creating a responsive site without access to the site</a></li>
<li><a href="../445596/index.html">Kubernetes tips & tricks: custom error pages in NGINX Ingress</a></li>
<li><a href="../445600/index.html">[Poll and evil] Hosting, be they wrong</a></li>
<li><a href="../445602/index.html">PHP Russia 2019: your own ‚Äústadium‚Äù for the first league language</a></li>
<li><a href="../445608/index.html">Game over: analysts report an increase in the number of DDoS attacks on the game segment</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>