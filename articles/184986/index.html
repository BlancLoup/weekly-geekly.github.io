<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Analysis of the resources of the old quest Harvester '96</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good to everyone, I want to tell you about the color palette in old games of the time of 256 colors, about fonts and a little Delphi. 
 On the quest a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Analysis of the resources of the old quest Harvester '96</h1><div class="post__text post__text-html js-mediator-article">  Good to everyone, I want to tell you about the color palette in old games of the time of 256 colors, about fonts and a little Delphi. <br>  On the quest about the quest, described below, I spent about 100 hours of time. <br>  The story about the way. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a5c/8f6/00e/a5c8f600edae60fb8b52bcb1d2c5f68d.png" alt="image"><br><a name="habracut"></a><br><h4>  Palette </h4><br>  From <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D0%25BB%25D0%25B8%25D1%2582%25D1%2580%25D0%25B0_(%25D0%25BA%25D0%25BE%25D0%25BC%25D0%25BF%25D1%258C%25D1%258E%25D1%2582%25D0%25B5%25D1%2580%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584%25D0%25B8%25D0%25BA%25D0%25B0)">wiki</a> : <br>  In computer graphics, the palette is a limited set of colors that allows you to display a computer‚Äôs graphic system. <br>  From the wide color space, any N colors are selected, and their coordinates (usually: R, G, and B) are stored in a special table ‚Äî the palette.  Raster graphics data using a palette represent an array where numbers (indices) of colors in a palette are stored. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b1b/46e/a59/b1b46ea59d0cf91f13a1b0a6db3ad20c.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Push.  A palette is a file or a block of data of sizes 768 bytes (256 indices of three bytes R, G, B) or 1024 bytes (4 * 256, RGB plus reserve). <br>  Usually they put the palette separately for a group of pictures, and there may be different palettes for different parts of the game. <br>  The picture has the maximum coordinates X, Y, the size is X * Y, the left-upper corner is zero, for each game you need to determine such things as the origin, XY values ‚Äã‚Äãof the font, whether these variables are stored somewhere in the data stream. <br>  The font picture itself consists of a stream of bytes of indices, we read 1 byte, we take from the array of the palette: <br>  R = buf_pal [index * 3 + 0] <br>  G = buf_pal [index * 3 + 1] <br>  B = buf_pal [index * 3 + 2] <br>  where buf_pal is an array of data read from the palette file. <br><br>  So far I have only met 768 byte interleaved palettes (RGB). <br>  Sometimes colors are not RGB-RGB, but, for example, BGR-BGR. <br>  Sometimes the image is too dark and it is necessary for each R, G, B to do a bit shift to the left by 2 (multiplication by 4). <br>  The method of determining - on the eye, knocked down the palette, you will know immediately. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1b6/bf7/2a7/1b6bf72a70833544f3eadee3d7542db7.png" alt="image"><br><br>  In Delphi, you can get the color using the RGB function (r, g, b). <br>  In Harvester, the palette is an uncompressed file harv_cd \ GRAPHIC \ PAL \ INVHELP.PAL <br><br>  Ok, quest with a palette completed.  Found her and she is not hidden.  Go to the search and study of the font. <br><br><h4>  Font </h4><br>  A font is a table with pointers to the beginning of pictures, symbol images.  In old games, it can be assumed that all games used a table of 256 characters, there were no unicode sorts in my memory. <br>  First of all, we need a clue how to look at the whole table, in the case of the subject of the game - this is Gameplay Tips, the phrases of hints at the beginning of the game are written in the file \ harv_cd \ ADJHEAD.RCS, just fine!  We will drive all the codes in order from 32 to 255 in the hex editor, or just the ones we need and see, which allows us to display the standard font of the game. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/023/c76/aae/023c76aaea32035e43e292e0c6ce9d5e.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/0d2/ba9/1ce/0d2ba91cefb3887204e7e30bbc60ff31.png" alt="image"><br><br>  Fine!  At first glance, the number of umlauts is enough for one set of Russian letters, either lowercase or uppercase.  Already good news. <br>  Now you need to find where the font data is physically located and what can be done with it. <br>  In this game, this is an easy task, font files with sonorous names HARVFNT2.CFT, HARVFONT.CFT, etc.  lie in the \ harv_cd \ GRAPHIC \ FONT \ directory. <br><br>  I start watching the file in the GBS program (GraphBitStream from old-games.ru).  It consists of a header and a data array of a rectangular picture of letters.  Very often one-bit font, in this game it is 8-bit.  Each byte is a color index, and the font size is approximately 800 x 12 pixels. <br>  It looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/fea/70f/3b1/fea70f3b17640185720a83eb8b4eb9bc.png" alt="image"><br><br>  TEXTFONT.CFT font character sequence <br>  Font width 6-8 and height ~ 12, beginning in the file with 0454h.  This will be the top left corner for zero, then the line goes to the right along the X coordinate, the second line starts with 801 bytes. <br><img src="https://habrastorage.org/getpro/habr/post_images/a53/90f/9c5/a5390f9c502b7414507598ac2f52b731.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/3d0/8d7/eef/3d08d7eef5c54e6d4779df6ad844a5e4.png" alt="image"><br><br>  In the file data stream, you need to catch something, began to spoil the file and determined the approximate dimensions of the height and width of the image of characters, wrote the same type of bytes, like EEh in groups of 10-20-30 bytes and watched what would happen in the game.  I found out that the font can be drawn in 256 colors, which is very unusual.  I found out that for all fonts the data starts from 0454h. <br>  It looked like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/310/92c/b3d/31092cb3d3d131cd95deab5399a691f9.png" alt="image"><br><br>  Well, with this knowledge in mind, it is already possible to redraw existing umlauts and get Russian letters.  Immediately get out the minuses.  For example, each letter has a different width, and if it is not changed, the letters will not be scattered in order and you will have to do an index transcoder to insert text. <br><br>  I had to study the font file header, it looked like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/0d6/97a/63d/0d697a63d65040076c2e8a9d3356a2d7.jpg" alt="image"><br><br>  It turned out the following.  The bottom line is: <br>  There is a table of 256 values ‚Äã‚Äãfor each letter code, which lists the widths of characters and pointers to the beginning of the data stream of a particular character.  In some characters, for example, "@" was zero, that is, in the game this is an empty space.  The thought came that if you set the required width and the necessary pointer to the beginning of the data in the table, you can insert the data taking into account the color of the pixel. <br>  Great, already much better than it was. <br>  I‚Äôve put a graphic editor in Delphi, I‚Äôve put a font file parser, I got a prototype: <br><img src="https://habrastorage.org/getpro/habr/post_images/faa/8c3/538/faa8c35381b2f10da947954c85981a0b.png" alt="image"><br><br>  And the option in which I redraw the entire font.  The left mouse button is a pencil with the selected color, the right mouse button is an eraser.  You can increase, you can choose a color from the palette. <br><img src="https://habrastorage.org/getpro/habr/post_images/9fd/fa4/9f3/9fdfa49f3499ba614049423a397d4acc.png" alt="image"><br><br>  The first experiments: <br><img src="https://habrastorage.org/getpro/habr/post_images/94e/93c/3c3/94e93c3c3cd67eb177cd1770a2eb868e.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/632/a6a/240/632a6a2409ef6fcef604cfbb05d2fc59.png" alt="image"><br><br>  And the result: <br><img src="https://habrastorage.org/getpro/habr/post_images/3d0/1aa/967/3d01aa967557e0133affd29df2eccccb.png" alt="image"><br><br>  Similarly, I redraw the remaining fonts, only 6 pieces. <br>  Codes took from CP1251, font Arial. <br>  Quest with fonts finished, the result and the tool is. <br>  Go to the search text. <br><br><h4>  Text </h4><br>  The text of the dialog with the NPC is stored in the file \ harv_cd \ DIALOGUE.IDX <br>  The file is encoded very funny.  If there are codes 0Dh, 0Ah, then we skip the byte, otherwise we do xor 170, that is, we have a simple xor encoding.  You can hide the resource text from prying eyes and not much to spend on decoding. <br>  This part was spied on the forum old-games.ru <br>  There are no difficulties with inserting text into the game, the file in cp1251 is encoded with xor and is replaced in the original. <br><br>  Then there is a file DIALOG.RSP in which the questions in the dialogs are written in plain text. <br><br>  Then there is some text in the harvest.exe file, like LOOK, TALK, etc.  Offhand, it turns out that you cannot increase the length of a phrase without debugging an .exe file in search of a text table.  The problem number one has turned out. <br><br>  Then in the file HARVEST.SCR for xor'en number 170 is the script of the game. <br><br>  Problem number ga <s>w</s> .  I can‚Äôt find the text of the descriptions of items, but there it should be quite extensive. <br>  And while he stopped at the stage of translated dialogues: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/900/12a/f55/90012af55f4b2de296bc01ceadfcf886.png" alt="image"><br><br>  Test her. <br><img src="https://habrastorage.org/getpro/habr/post_images/a5c/8f6/00e/a5c8f600edae60fb8b52bcb1d2c5f68d.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f93/9fd/f8a/f939fdf8ab25aa6b4b4c81599c668521.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a1e/63d/c9b/a1e63dc9b21c008c26d3e6ceb9644a3b.png" alt="image"><br><br>  And demo video: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Xxho53F8Izw%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhgSn-mkJWjV0reRqNex7I9BhEcIew" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/184986/">https://habr.com/ru/post/184986/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184970/index.html">Driver for PostgreSQL on Node.js</a></li>
<li><a href="../184972/index.html">Instead of passwords tattoo and ... pills</a></li>
<li><a href="../184974/index.html">Please support the symbol of domestic currency</a></li>
<li><a href="../184978/index.html">1C + offline maps on Android</a></li>
<li><a href="../184982/index.html">SamMobile presented Android 4.3 for the smartphone Galaxy S4 Google Play edition</a></li>
<li><a href="../184988/index.html">Cyber ‚Äã‚ÄãSecurity. Weekly Review June 17 - June 23, 2013</a></li>
<li><a href="../184990/index.html">[ANNOUNCEMENT] High-capacity battery [HLI-Z10XL] 3800mAh for BlackBerry Z10 (4G and 3G) + battery case (3000mAh)</a></li>
<li><a href="../184992/index.html">Appeared the first renders of the London headquarters of Google</a></li>
<li><a href="../184994/index.html">Photos for Lumia. What's new?</a></li>
<li><a href="../184996/index.html">JavaOpen and JavaDay in Samara</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>