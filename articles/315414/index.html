<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pro web client 1C</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the nice features of the 1C: Enterprise technology is that the application solution developed using the technology of managed forms can be laun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pro web client 1C</h1><div class="post__text post__text-html js-mediator-article">  One of the nice features of the 1C: Enterprise technology is that the application solution developed using the technology of managed forms can be launched in a thin (executable) client for Windows, Linux, MacOS X, or as a web client for 5 browsers - Chrome, Internet Explorer, Firefox, Safari, Edge, and all this - without changing the source code of the application.  Moreover, externally, the application in the thin client and in the browser functions and looks almost identical. <br>  Find 10 differences (under the cat 2 pictures): <br><a name="habracut"></a><br>  Linux thin client window: <br><br><img src="https://habrastorage.org/files/42b/83b/bc2/42b83bbc2c7d41ec97bbeae2cd48f773.png" alt="image"><br><br>  The same window in the web client (in the Chrome browser): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/1f6/88d/f20/1f688df20aae4868bcf184a49d408042.png" alt="image"><br><br>  Why did we make a web client?  Speaking a little pathetic, this task was set before us by time.  Work over the Internet has long been a prerequisite for business applications.  Initially, we added the ability to work via the Internet for our thin client (some of our competitors, by the way, stopped at this; others, on the contrary, refused a thin client and limited to the implementation of the web client).  We decided to give our users the opportunity to choose the version of the client that suits them more. <br><br><img src="https://habrastorage.org/files/0fe/d2b/376/0fed2b376dff49e59b74ab2a577afea7.png" alt="image"><br><br>  Adding the ability to work over the Internet for a thin client was a big project with a complete change of client-server interaction architecture.  Creating a web client is a new project, starting from scratch. <br><br><h3>  Formulation of the problem </h3><br>  So, the requirements for the project: the web client should do the same thing as the thin client, namely: <br><br><ol><li>  Display user interface </li><li>  Execute client code written in 1C </li></ol><br>  The user interface in 1C is described in a visual editor, but declaratively, without a pixel-by-pixel arrangement of elements;  about three dozen types of interface elements are used - buttons, input fields (text, digital, date / time), lists, tables, graphics, etc. <br><br>  The client code in 1C can contain server calls, work with local resources (files, etc.), printing and much more. <br><br>  Both the thin client (when working through the web) and the web client use the same set of web services to communicate with the 1C application server.  The implementation of the clients, of course, is different - the thin client is written in C ++, the web client is written in JavaScript. <br><br><h3>  A bit of history </h3><br>  The project of creating a web client started in 2006, a team of 5 people participated in it (on average).  At certain stages of the project, developers were involved to implement specific functionality (tabular document, diagrams, etc.);  as a rule, these were the same developers that did this functionality in the thin client.  Those.  developers re-wrote JavaScript components previously created by them in C ++. <br><br>  From the very beginning, we rejected the idea of ‚Äã‚Äãany automatic (at least partial) conversion of C ++ code of a thin client into a JavaScript web client due to the strong conceptual differences between these two languages;  The web client was written in JavaScript from scratch. <br><br>  In the first iterations of the project, the web client converted the client code in the embedded language 1C directly into JavaScript.  The thin client acts differently - the code in the built-in language 1C is compiled into byte-code, and then this byte-code is interpreted by the client.  Subsequently, the web client also began to do - first, it gave a performance gain, and second, it allowed unifying the architecture of thin and web clients. <br><br>  The first version of the 1C: Enterprise platform with web client support was released in 2009.  The web client at that time supported 2 browsers - Internet Explorer and Firefox.  The initial plans were to support Opera, but due to the problems that were unsurmountable at that time with the handlers for closing the application in Opera (it was not possible to track down the application with 100% confidence, and at that moment to disconnect from the 1C application server) these plans had to be abandoned. <br><br><h3>  Project structure </h3><br>  In total, the 1C: Enterprise platform has 4 projects written in JavaScript: <br><br><ol><li>  WebTools are shared libraries used by other projects (we include the <a href="https://en.wikipedia.org/wiki/Google_Closure_Tools">Google Closure Library here</a> ). </li><li>  <a href="http://v8.1c.ru/overview/Term_000000785.htm">Formatted</a> Document Control (implemented in JavaScript in both the thin client and the web client) </li><li>  <a href="https://wonderland.v8.1c.ru/blog/planirovshchik/">Scheduler</a> control (implemented in JavaScript in both the thin client and the web client) </li><li>  Web client </li></ol><br>  The structure of each project resembles the structure of Java projects (or .NET projects - to whom that is closer);  we have a namespace, and each namespace lies in a separate folder.  Inside the folder are files and neymspeys classes.  There are about 1000 files in the web client project. <br><br>  Structurally, the web client is divided into the following subsystems: <br><br><ul><li>  Managed Client Application Interface <br><ul><li>  General interface of the application (system menus, panels) </li><li>  Managed form interface, including, among other things, about 30 controls (buttons, various types of input fields - text, digital, date / time, etc., tables, lists, charts, etc.) </li></ul><br></li><li>  An object model that is accessible to developers on the client (more than 400 types in total: the object model of the managed interface, data composition settings, conditional design, etc.) </li><li>  Interpreter built-in language 1C </li><li>  Browser extensions (used for non-javascript functionality) <br><ul><li>  Working with cryptography </li><li>  Work with files </li><li>  A technology of external components that allows them to be used in both thin and web clients. </li></ul></li></ul><br><h3>  Design features </h3><br>  Implementing all of the above in JavaScript is not easy.  Perhaps 1C Web Client is one of the largest client-side applications written in JavaScript - about 450,000 lines.  We are actively using an object-oriented approach in the web client code, which simplifies working with such a large project. <br><br>  To minimize the size of the client code, we first used our own obfuscator, and starting with platform version 8.3.6 (October 2014), we began to use the <a href="https://en.wikipedia.org/wiki/Google_Closure_Tools">Google Closure Compiler</a> .  The effect of using the figures - the size of the web client framework after obfuscation: <br><br><ul><li>  Own obfuscator - 1556 KB </li><li>  Google Closure Compiler - 1073 KB </li></ul><br>  Using the Google Closure Compiler helped us improve the performance of the web client by 30% compared to our own obfuscator.  In addition, the amount of memory consumed by the application decreased by 15-25% (depending on the browser). <br><br>  Google Closure Compiler works very well with object-oriented code, so its efficiency is for the web client as high as possible.  Closure Compiler does a few good things for us: <br><br><ul><li>  Static type checking at the project build stage (provided that we cover the code with JSDoc annotations).  The result is static typing, very close in level to typing in C ++.  This helps to catch a fairly large percentage of errors at the compilation stage of the project. </li><li>  Reducing code size through obfuscation </li><li>  A number of executable code optimizations, such as: <br><br><ul><li>  inline function substitutions.  Calling a function in JavaScript is a rather expensive operation, and inline substitutions of often used small methods significantly speed up the work of the code. </li><li>  Counting constants at compile time.  If the expression depends on a constant, the actual value of the constant will be substituted into it. </li></ul></li></ul><br>  We use WebStorm as the development environment for the web client. <br><br>  For code analysis, we use the <a href="http://www.sonarqube.org/">SonarQube</a> , where we integrate static code analyzers.  With the help of analyzers, we monitor the degradation of the quality of the source code in JavaScript and try to avoid it. <br><br><img src="https://habrastorage.org/files/12d/02e/816/12d02e8169a74932b747a3b6848a221f.png"><br><br><h3>  What tasks solved / solve </h3><br>  During the project we faced a number of interesting tasks that we had to solve. <br><br><h4>  Data exchange with the server and between windows </h4><br>  There are situations where obfuskie source code may interfere with the operation of the system.  A code external to the executable code of the web client, due to obfuscation, may have function and parameter names different from those that our executable code expects.  The external code for us is: <br><br><ul><li>  Code coming from the server in the form of data structures </li><li>  Code of another application window </li></ul><br>  To avoid obfuscation when interacting with the server, we use the @expose tag: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/**
 * @constructor
 * @extends {Base.SrvObject}
 */</span></span>
Srv.Core.GenericException = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)
</span></span>{
    <span class="hljs-comment"><span class="hljs-comment">/**
     * @type {string}
     * @expose
     */</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.descr;

    <span class="hljs-comment"><span class="hljs-comment">/**
     * @type {Srv.Core.GenericException}
     * @expose
     */</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.inner;

    <span class="hljs-comment"><span class="hljs-comment">/**
     * @type {string}
     * @expose
     */</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clsid;

    <span class="hljs-comment"><span class="hljs-comment">/**
     * @type {boolean}
     * @expose
     */</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.encoded;
}</code></pre><br>
               (,      ).<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/**
 *    DropDownWindow
 *
 * @interface
 * @struct
 */</span></span>
WebUI.IDropDownWindowExp = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{}

<span class="hljs-comment"><span class="hljs-comment">/**
 *    1   
 *
 * @param {boolean} isForward
 * @param {boolean} checkOnly
 * @return {boolean}
 * @expose
 */</span></span>
WebUI.IDropDownWindowExp.prototype.moveMarker = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">isForward, checkOnly</span></span></span><span class="hljs-function">)</span></span>{}

<span class="hljs-comment"><span class="hljs-comment">/**
 *      
 *
 * @param {boolean} isFirst
 * @param {boolean} checkOnly
 * @return {boolean}
 * @expose
 */</span></span>
WebUI.IDropDownWindowExp.prototype.moveMarkerTo = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">isFirst, checkOnly</span></span></span><span class="hljs-function">)</span></span>{}

<span class="hljs-comment"><span class="hljs-comment">/**
 * @return {boolean}
 * @expose
 */</span></span>
WebUI.IDropDownWindowExp.prototype.selectValue = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{}</code></pre><br>
<br>
<h4>We used Virtual DOM before it became mainstream)</h4><br>
   ,      UI,   ,  DOM        .      Virtual DOM     UI.       DOM    ,     ,     DOM-.<br>
<br>
<h4>  -</h4><br>
  -  ,         (CSS  ..). ,    (     )    ,     CSS.<br>
<br>
<img src="https://habrastorage.org/files/4cb/536/7c4/4cb5367c48784aa187903e643ff978d5.png" alt="image"><br>
<br>
<h4></h4><br>
           (  Java  C++),    ,    <a href="https://ru.wikipedia.org/wiki/Selenium">Selenium</a>.<br>
<br>
   ‚Äì       ,        ,   -.    ,    ¬´1¬ª,  -.           ‚Äî .     -     .        -    ,        ‚Äì       .         .<br>
<br>
         25 .        (,     )       .        .<br>
<br>
<img src="https://habrastorage.org/files/2d5/ede/e2c/2d5edee2c27146589fc64e7f4e9d2cba.png" alt="image"><br>
<b>     </b><br>
<br>
   Selenium   ; ,  -         ‚Äì Selenium    ,    , ..      .             ,       .<br>
<br>
    (  Selenium)        .        ¬´1:¬ª.      (    )       .     ‚Äì       .<br>
<br>
        ;    <a href="http://apmblog.dynatrace.com/2014/12/11/dynatrace-ajax-edition-4-5-last-page-chapter-yet-story-continues/">Dynatrace AJAX Edition</a>   <a href="https://en.wikipedia.org/wiki/Dynatrace">DynaTrace</a>.            ,   .       ( )      ‚Äì         ,          .           JavaScript,     DOM  ..   /           ‚Äì      ,   .<br>
<br>
        ,  Google Closure Compiler  -     inline-  (,      ).       ,   .<br>
<br>
<h3> </h3><br>
 ,     ,    JavaScript,    :<br>
<br>
<ul>
<li>   </li>
<li>   </li>
<li>  <a href="http://v8.1c.ru/overview/Term_000000545.htm"> </a></li>
</ul><br>
     .   ‚Äì ,     ( ,   JavaScript   Chrome  Firefox),      ‚Äî  ,    .  ,    3    ‚Äì  Windows, Linux  MacOS.       1:      1.     -         .<br>
<br>
   Safari    NPAPI,    Internet Explorer ‚Äî  ActiveX. <a href="https://ru.wikipedia.org/wiki/Microsoft_Edge">Microsoft Edge</a>    ,  -     .<br>
<br>
<h3> </h3><br>
       - ‚Äì    .  -      ,        ,   -.<br>
<br>
  ‚Äî  , ,    . ,    ‚Äì       .   -          .       (    )  ,      -       (   ).              .</div><p>Source: <a href="https://habr.com/ru/post/315414/">https://habr.com/ru/post/315414/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../315402/index.html">Backup VM ESXi with Bareos</a></li>
<li><a href="../315404/index.html">We invite you to a meeting with practitioners defenders of ASU-TP</a></li>
<li><a href="../315406/index.html">Implementing a pull-down interface in an iOS application</a></li>
<li><a href="../315408/index.html">Zvooq filed a lawsuit for $ 29 million to the ‚Äúlargest Russian public corporation‚Äù - ‚ÄúYandex‚Äù</a></li>
<li><a href="../315410/index.html">Bilateral data binding with ECMAScript-2015 without proxy</a></li>
<li><a href="../315416/index.html">Personal experience of receiving the Blue Card in Germany 2015-2016. Part 3: Arriving in Germany</a></li>
<li><a href="../315418/index.html">Polish clouds. Price notes (not only for Ukrainians)</a></li>
<li><a href="../315420/index.html">How to create elusive goals in the game 2016 Hitman</a></li>
<li><a href="../315422/index.html">We control the quality of the code using the SonarQube platform</a></li>
<li><a href="../315424/index.html">Creation of the world Experience of creating intelligent life with their own hands</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>