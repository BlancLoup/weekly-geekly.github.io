<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automated Testing and Database</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many examples of elementary and intermediate levels in unit testing in any language show how easy it is to check the logic of your applications with t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automated Testing and Database</h1><div class="post__text post__text-html js-mediator-article">  Many examples of elementary and intermediate levels in unit testing in any language show how easy it is to check the logic of your applications with the help of unit tests.  However, not everything is so simple when testing applications in which the database plays a central role, and it is these that are the majority of web applications.  Those who are engaged in unit testing of their applications, I think, have repeatedly encountered the problem of testing a database.  Almost 2 years ago <a href="http://habrahabr.ru/blogs/php/61710/">, an article</a> on this topic <a href="http://habrahabr.ru/blogs/php/61710/">was already</a> on Habr√©, but I would like to reveal it more. <br><a name="habracut"></a><br><h4>  Dbunit </h4><br>  So, DbUnit.  It was originally developed for JUnit (a framework for unit testing Java applications) for a database setup before running tests.  As a result, the extension developed and migrated to other xUnit frameworks, in particular to PHPUnit.  Currently supported MySql, PostgreSql, Oracle and Sqlite. <br><br><h4>  Why DbUnit? </h4><br>  To test the interaction of your application with the database, you need to additionally perform the following steps: <br><ul><li>  Consider the structure of the database and tables </li><li>  Explore the insertion of the original data, if necessary </li><li>  Conduct a database state check after performing any business logic operations. </li><li>  Clear the base and repeat again for each test (otherwise the subsequent tests will depend on the previous ones) </li></ul><br>  If you write this manually using SQL queries, then pretty soon you start cursing unit testing in principle.  In addition, it does not correspond to one of the main principles of unit testing - tests should be minimally complex and as readable as possible. <br><br><h4>  In order </h4><br>  So, how should the base interaction test pass? <br><ol><li>  <b>Clearing the base</b> .  When you first start we do not know what state the database is in, so we must ‚Äústart from scratch‚Äù; </li><li>  <b>Insert the initial data (fixture)</b> .  Usually, the application needs any initial data that it extracts from the database for further processing.  they must be inserted into the newly cleaned base; </li><li>  <b>Actually performing tests and checking the results</b> .  No comments. </li></ol><br><h4>  PHPUnit Database Test Case </h4><br>  If in the case of a normal test case in PHPUnit you just have to inherit the PHPUnit_Framework_TestCase class, then in the case of testing a database, everything is somewhat more complicated: <br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">"PHPUnit/Extensions/Database/TestCase.php"</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Extensions_Database_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getConnection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $pdo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PDO(<span class="hljs-string"><span class="hljs-string">'mysql:host=localhost;dbname=testdb'</span></span>, <span class="hljs-string"><span class="hljs-string">'root'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createDefaultDBConnection($pdo, <span class="hljs-string"><span class="hljs-string">'testdb'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createFlatXMLDataSet(dirname(<span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span>).<span class="hljs-string"><span class="hljs-string">'/_files/guestbook-init.xml'</span></span>); } }</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      You must implement two abstract methods, getConnection () and getDataSet ().  The first is necessary for establishing a connection with the database, the second for filling the database with tables and filling in the actual tables. <br>  It is important to note that getConnection () must use the PDO to connect to the database, but your application does not have to use the PDO to query the database.  The connection established by the getConnection () method is used only for preparing the database for tests and assertions. <br>  The initial database content is abstracted using the PHPUnit_Extensions_Database_DataSet_IDataSet and PHPUnit_Extensions_Database_DataSet_IDataTable interfaces.  The getDataSet () method is called by the setUp () method to get and insert fixtures.  In the example, we used the createFlatXMLDataSet () factory method to get the dataset from the XML representation. <br><br><h4>  DataTables &amp; DataSets </h4><br>  So what is it?  These are key concepts of the extension in question.  DataTable and DataSet is an abstraction for tables and records in a real database.  A fairly simple mechanism allows you to hide the real database behind objects, which in turn can be implemented in various ways. <br>  Such an abstraction is necessary to compare the expected content of the base and real.  The expected content can be presented in various forms due to abstraction - for example, XML, CSV, PHP arrays.  The DataTable and DataSet interfaces allow comparing data from the expected source with the real ones from the database. <br>  Also, the DataSet and DataTable are used to set the initial state of the database before running the test. <br>  Below we will consider various options for datasets. <br><br><h4>  Flat XML DataSet </h4><br>  This is the most simple type of dataset.  Each element inside the root represents one record from the database.  The element name must correspond to the table name, and the attributes and values ‚Äã‚Äã- the fields and field values, respectively, for example: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">post_id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"My First Post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">date_created</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2008-12-01 12:30:29"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contents</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"This is my first post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rating</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">post_id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"My Second Post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">date_created</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2008-12-04 15:35:25"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contents</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"This is my second post"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataset</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  This is equivalent to a post table in a DB with 2 entries. <br><table><tbody><tr><th>  post_id </th><th>  title </th><th>  date_created </th><th>  contents </th><th>  rating </th></tr><tr><td>  one </td><td>  My first post </td><td>  2008-12-01 12:30:29 </td><td>  This is my first post </td><td>  five </td></tr><tr><td>  2 </td><td>  My second post </td><td>  2008-12-04 15:35:25 </td><td>  This is my second post </td><td>  <i>Null</i> </td></tr></tbody></table><br>  In general, quite simple and clear. <br>  An empty table is equivalent to an empty element, for example, an empty current_visitors table: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">current_visitors</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataset</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  NULL values ‚Äã‚Äãfor the record are represented as the absence of the corresponding attribute (see the blog example, the rating field), however, one point should be taken into account.  For flat XML DataSet, the table structure is determined by the first element, i.e.  if there are no attributes in the first element, and they are in the subsequent elements for the same table, then these attributes will be ignored.  For example, if in the example with the blog table, the date_created attribute with its value is removed from the first element, then this attribute will not be taken into account in the second element and the date_created field will not be in the table. <br>  Using the createFlatXmlDataSet () method: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Extensions_Database_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createFlatXmlDataSet(<span class="hljs-string"><span class="hljs-string">'myFlatXmlFixture.xml'</span></span>); } }</code> </pre><br><br><h4>  XML DataSet </h4><br>  This version of the representation in XML has no Flat XML flaws, but is also somewhat more complicated: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span>post_id<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span>title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span>date_created<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span>contents<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span>rating<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">row</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>My First Post<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>2008-12-01 12:30:29<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>This is my first post<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">row</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">row</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>My Second Post<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>2008-12-04 15:35:25<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>This is my second post<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">null</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">row</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataset</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  A table is fully represented by a &lt;table&gt; element, in which &lt;column&gt; is nested to define the fields of the table and &lt;row&gt; to represent the records.  In turn, &lt;value&gt; can be nested with &lt;value&gt; to represent meaningful fields and &lt;null /&gt; for NULL values. <br><br>  An empty table is represented as a table without &lt;row&gt; elements: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"current_visitors"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span>current_visitors_id<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span>ip<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataset</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Using the createXMLDataSet () method: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Extensions_Database_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createXMLDataSet(<span class="hljs-string"><span class="hljs-string">'myFlatXmlFixture.xml'</span></span>); } }</code> </pre><br><br><h4>  CSV Data Set </h4><br>  Presentation of a table in CSV format (Comma Separated Values ‚Äã‚Äãis the simplest format for storing tables).  Everything is pretty clear: <br> <code>post_id,title,date_created,contents,rating <br> 1,My First Post,2008-12-01 12:30:29,This is my first post,5 <br> 2,My Second Post,2008-12-04 15:35:25,This is my second post, <br></code> <br>  The use is somewhat more complicated than with XML: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Extensions_Database_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $dataSet = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHPUnit_Extensions_Database_DataSet_CsvDataSet(); $dataSet-&gt;addTable(<span class="hljs-string"><span class="hljs-string">'post'</span></span>, <span class="hljs-string"><span class="hljs-string">'post.csv'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $dataSet; } }</code> </pre><br>  To use it, we need to create an object of the PHPUnit_Extensions_Database_DataSet_CsvDataSet class.  The constructor takes three arguments that define the CSV format: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($delimiter = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">','</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $enclosure = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'"'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $escape = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'"'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{}</code> </pre><br>  After that we add tables to the addTable method - one file - one table. <br><br><h4>  PHP arrays </h4><br>  Currently, there is no standard implementation of datasets using arrays, but it is easy to implement;) <br><br>  Suppose that we need to store datasets in this format: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'post'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'post_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'My First Post'</span></span>, <span class="hljs-string"><span class="hljs-string">'date_created'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'2008-12-01 12:30:29'</span></span>, <span class="hljs-string"><span class="hljs-string">'contents'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'This is my first post'</span></span>, <span class="hljs-string"><span class="hljs-string">'rating'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'post_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'My Second Post'</span></span>, <span class="hljs-string"><span class="hljs-string">'date_created'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'2008-12-04 15:35:25'</span></span>, <span class="hljs-string"><span class="hljs-string">'contents'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'This is my second post'</span></span>, <span class="hljs-string"><span class="hljs-string">'rating'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ), ), )</code> </pre><br><br>  Implementation: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'PHPUnit/Extensions/Database/DataSet/AbstractDataSet.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'PHPUnit/Extensions/Database/DataSet/DefaultTableIterator.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'PHPUnit/Extensions/Database/DataSet/DefaultTable.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'PHPUnit/Extensions/Database/DataSet/DefaultTableMetaData.php'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayDataSet</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Extensions_Database_DataSet_AbstractDataSet</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $tables = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($data <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $tableName =&gt; $rows) { $columns = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($rows[<span class="hljs-number"><span class="hljs-number">0</span></span>])) { $columns = array_keys($rows[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } $metaData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHPUnit_Extensions_Database_DataSet_DefaultTableMetaData($tableName, $columns); $table = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHPUnit_Extensions_Database_DataSet_DefaultTable($metaData); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($rows <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $row) { $table-&gt;addRow($row); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tables[$tableName] = $table; } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createIterator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($reverse = FALSE)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHPUnit_Extensions_Database_DataSet_DefaultTableIterator(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tables, $reverse); } }</code> </pre><br>  Few comments - for our dataset, we inherit abstract datasets (which flat XML, XML, CSV and others inherit from).  In the constructor, we pass the previously specified array.  As in the case of flat XML, the table structure is determined by the first record, but in this case it is not critical, because we have the ability to explicitly specify NULL values.  The structure, by the way, is determined by creating a PHPUnit_Extensions_Database_DataSet_DefaultTableMetaData object.  After that we create the actual table, passing the structure to it and adding the records to the table using the addRow () method.  We also need to implement the abstract createIterator method, but there is nothing complicated about it :) <br><br>  Using: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Extensions_Database_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayDataSet(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'post'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'post_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'My First Post'</span></span>, <span class="hljs-string"><span class="hljs-string">'date_created'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'2008-12-01 12:30:29'</span></span>, <span class="hljs-string"><span class="hljs-string">'contents'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'This is my first post'</span></span>, <span class="hljs-string"><span class="hljs-string">'rating'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'post_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'My Second Post'</span></span>, <span class="hljs-string"><span class="hljs-string">'date_created'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'2008-12-04 15:35:25'</span></span>, <span class="hljs-string"><span class="hljs-string">'contents'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'This is my second post'</span></span>, <span class="hljs-string"><span class="hljs-string">'rating'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ), ), )); } }</code> </pre><br><br><h4>  Query / Database Dataset </h4><br>  For assertions, we will need not only the expected datasets, but also real ones from the database.  QueryDataSet will help us with this. <br><pre> <code class="php hljs">$ds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHPUnit_Extensions_Database_DataSet_QueryDataSet(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getConnection()); $ds-&gt;addTable(<span class="hljs-string"><span class="hljs-string">'post'</span></span>);</code> </pre><br>  or with explicit use of the query: <br><pre> <code class="php hljs">$ds-&gt;addTable(<span class="hljs-string"><span class="hljs-string">'post'</span></span>, <span class="hljs-string"><span class="hljs-string">'SELECT * FROM post ORDER BY post_id'</span></span>);</code> </pre><br>  You can also use an existing connection to automatically retrieve datasets from existing tables using the PHPUnit_Extensions_Database_DB_DefaultDatabaseConnection :: createDataSet () method (this is an object created in getConnection ()).  If you do not pass the parameter to createDataSet (), then the dataset will be created from all existing tables.  If you pass an array with the names of tables in the database as a parameter, then only data from these tables will be created. <br><br><h4>  Replacement DataSet </h4><br>  I have already mentioned the problem of NULL values ‚Äã‚Äãfor flat XML datasets (for CSV, the problem is the same - it is impossible to explicitly set a NULL value in a fixture).  This can be solved with the help of a special decorator - ReplacementDataSet: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'PHPUnit/Extensions/Database/DataSet/ReplacementDataSet.php'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Extensions_Database_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $ds = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createFlatXmlDataSet(<span class="hljs-string"><span class="hljs-string">'myFlatXmlFixture.xml'</span></span>); $rds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHPUnit_Extensions_Database_DataSet_ReplacementDataSet($ds); $rds-&gt;addFullReplacement(<span class="hljs-string"><span class="hljs-string">'##NULL##'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $rds; } }</code> </pre><br>  Now we can use ## NULL ## in XML to denote NULL values: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">post_id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"My First Post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">date_created</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2008-12-01 12:30:29"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contents</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"This is my first post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rating</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">post_id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"My Second Post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">date_created</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2008-12-04 15:35:25"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contents</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"This is my second post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rating</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"##NULL##"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataset</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h4>  Dataset filtering </h4><br>  For large datasets, you can apply filtering with the DataSetFilter: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'PHPUnit/Extensions/Database/DataSet/ReplacementDataSet.php'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Extensions_Database_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testIncludeFilteredPost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $dataSet = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getConnection()-&gt;createDataSet(); $filterDataSet = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHPUnit_Extensions_Database_DataSet_DataSetFilter($dataSet); $filterDataSet-&gt;addIncludeTables(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'post'</span></span>)); $filterDataSet-&gt;setIncludeColumnsForTable(<span class="hljs-string"><span class="hljs-string">'post'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'post_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// .. } public function testExcludeFilteredPost() { $dataSet = $this-&gt;getConnection()-&gt;createDataSet(); $filterDataSet = new PHPUnit_Extensions_Database_DataSet_DataSetFilter($dataSet); $filterDataSet-&gt;addExcludeTables(array('foo', 'bar', 'baz')); $filterDataSet-&gt;setExcludeColumnsForTable('post', array('date_created', 'rating')); // .. } }</span></span></code> </pre><br>  In the first case, we left only the post table and the contents of its records for the post_id and title fields in the dataset.  In the second, we have excluded the tables 'foo', 'bar' and 'baz' from the dataset, and removed the values ‚Äã‚Äãfor the 'date_created' and 'rating' fields from the post table entries. <br><br><h4>  Dataset composition </h4><br>  We can connect several datasets into one.  If the datasets have the same tables, then the records will be added to them, for example: <br>  dataset-1.xml <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">post_id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"My First Post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">date_created</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2008-12-01 12:30:29"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contents</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"This is my first post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rating</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataset</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  dataset-2.xml <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">post_id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"My Second Post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">date_created</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2008-12-04 15:35:25"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contents</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"This is my second post"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataset</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  We aggregate them: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Extensions_Database_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $ds1 = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createFlatXmlDataSet(<span class="hljs-string"><span class="hljs-string">'dataset-1.xml'</span></span>); $ds2 = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createFlatXmlDataSet(<span class="hljs-string"><span class="hljs-string">'dataset-2.xml'</span></span>); $compositeDs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHPUnit_Extensions_Database_DataSet_CompositeDataSet(); $compositeDs-&gt;addDataSet($ds1); $compositeDs-&gt;addDataSet($ds2); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $compositeDs; } }</code> </pre><br><br><h4>  Asserts </h4><br>  It is often necessary to check the number of records in a table.  This can be done using the usual assertEquals: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Extensions_Database_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testAddEntry</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getConnection()-&gt;getRowCount(<span class="hljs-string"><span class="hljs-string">'post'</span></span>)); $blog = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Blog(); $blog-&gt;addPost(<span class="hljs-string"><span class="hljs-string">"My third post."</span></span>, <span class="hljs-string"><span class="hljs-string">"This is my third post."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getConnection()-&gt;getRowCount(<span class="hljs-string"><span class="hljs-string">'post'</span></span>)); } }</code> </pre><br>  The getRowCount () method returns the number of records in the specified table. <br><br>  To compare the tables, use the assertTablesEqual () method: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Extensions_Database_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testTables</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $queryTable = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getConnection()-&gt;createQueryTable(<span class="hljs-string"><span class="hljs-string">'post'</span></span>, <span class="hljs-string"><span class="hljs-string">'SELECT * FROM post'</span></span>); $expectedTable = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createFlatXmlDataSet(<span class="hljs-string"><span class="hljs-string">"myFlatXmlFixture.xml"</span></span>)-&gt;getTable(<span class="hljs-string"><span class="hljs-string">"post"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertTablesEqual($expectedTable, $queryTable); } }</code> </pre><br>  It must be remembered that the test can fail when checking the date - if you have a fixed date in the fixture, and the current time is recorded in the base, you will receive a file if these dates do not match.  Therefore, dates are often removed from the expected result and, accordingly, change the receipt of a real dataset: <br><pre> <code class="php hljs">$queryTable = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getConnection()-&gt;createQueryTable(<span class="hljs-string"><span class="hljs-string">'post'</span></span>, <span class="hljs-string"><span class="hljs-string">'SELECT post_id, title, date_created, contents, rating FROM post'</span></span>);</code> </pre><br>  Finally, you can directly compare datasets with assertDataSetsEqual (): <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Extensions_Database_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testTables</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $dataSet = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getConnection()-&gt;createDataSet(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'post'</span></span>)); $expectedDataSet = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createFlatXmlDataSet(<span class="hljs-string"><span class="hljs-string">"myFlatXmlFixture.xml"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertDataSetsEqual($expectedDataSet, $dataSet); } }</code> </pre><br><br>  The article is largely written based on the <a href="http://www.beberlei.de/dbunit.html">Benjamin Eberlei article ‚ÄúThe Ultimate Guide to Database-Testing with PHPUnit‚Äù</a> , and of course the <a href="http://www.phpunit.de/manual/3.5/en/database.html">official manual</a> . </div><p>Source: <a href="https://habr.com/ru/post/113872/">https://habr.com/ru/post/113872/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113859/index.html">Unity3d script basics</a></li>
<li><a href="../113864/index.html">The Ukrainian government wants to close online stores that do not have an office</a></li>
<li><a href="../113867/index.html">AMD podkololi Intel Valentine</a></li>
<li><a href="../113870/index.html">Building a multikopter, part three</a></li>
<li><a href="../113871/index.html">Slaughter set</a></li>
<li><a href="../113873/index.html">Among the mail attachments of the company HBGary was the decompiled code Stuxnet</a></li>
<li><a href="../113874/index.html">Internet + Firefox => offline dictionaries are no longer needed</a></li>
<li><a href="../113875/index.html">London Stock Exchange finally launched trading on the Linux platform</a></li>
<li><a href="../113876/index.html">China: how to order production or delivery</a></li>
<li><a href="../113877/index.html">Transparent and verifiable choices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>