<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Steganography past files: hiding data right in the sectors</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Small preface 
 Steganography, if anyone does not remember, is hiding information in any containers. For example, in pictures (discussed here and here...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Steganography past files: hiding data right in the sectors</h1><div class="post__text post__text-html js-mediator-article"><h3>  Small preface </h3><br>  Steganography, if anyone does not remember, is hiding information in any containers.  For example, in pictures (discussed <a href="https://habr.com/ru/post/112976/">here</a> and <a href="https://habr.com/ru/post/128327/">here</a> ).  You can also hide data in the service tables of the file system (this was written <a href="https://habr.com/ru/post/347604/">here</a> ), and even <a href="https://habr.com/ru/post/60726/">in the service packets of the TCP protocol</a> .  Unfortunately, all these methods have one drawback: to quietly ‚Äúinterstate‚Äù information into a container, we need clever algorithms that take into account the peculiarities of the container‚Äôs internal structure.  Yes, and with the stability of the container to manipulate problems: for example, if a little edit the picture, the hidden information is lost. <br><br>  Is it possible to somehow manage without tricky algorithms and subtle manipulations of data, while still ensuring the operability of the container and an acceptable level of security of hidden data?  Looking ahead to say - yes, you can!  And even offer a utility. <br><a name="habracut"></a><br><h3>  Bloody details of the method </h3><br>  The basic idea is simple, like a blow to the forehead with a cudgel: there are areas on the disk to which the operating system never writes (or writes in rare cases).  In order not to look for these areas with clever algorithms, we will use redundancy - that is, many times we will duplicate our hidden information across all sectors of the disk.  Then, right on top of all this splendor, you can create the necessary partitions, format file systems, write files and install OSes - anyway, some of the secret data is saved and retrieved, and multiple duplication helps us to make up the original whole of the pieces. <br><br>  The advantage of this method is obvious: we are not dependent on the file format, or even on the type of file system used. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The disadvantages, too, I think, are obvious: <br><br><ul><li>  The secret data can only be changed by completely overwriting the entire disk, and then recreating the content visible to the user.  In this case, you can not use the software that recreates the disk from the image: it will recreate the previous secret data. </li><li>  The greater the amount of secret data, the greater the likelihood of loss of information. </li><li>  Extracting data from a disk can take a long time.  From several minutes to several days (modern discs are large). </li></ul><br>  We now turn to the particulars. <br><br>  It is clear that if you just blur the secret data on the entire disk, then they will be hidden only from the naked eye.  If we arm our eyes with, say, a disk editor, then the data will appear in all its glory.  Therefore, the data would be nice to encrypt, so as not to shine.  We will encrypt simply, but with taste: according to the algorithm aes256-cbc.  Encryption key ask the user, let him come up with a good password. <br><br>  The next question is how do we distinguish the ‚Äúcorrect‚Äù data from the corrupted ones.  Here the checksum will help us, but not simple, but SHA1.  Why?  For git, it is good enough, which means it will do for us.  It was decided: we supply each saved piece of information with a checksum, and if, after decryption, it coincided, then the decryption was successful. <br><br>  You will also need the fragment number and the total length of the secret data.  Fragment number - to keep track of which pieces we have already deciphered, and which remained.  The total length is useful to us when processing the last fragment, in order not to write extra data (that is, padding).  Well, since we still have a header, then add the name of the secret file.  It will come in handy after decryption, so as not to guess what to open it with. <br><br><h3>  We check the method in practice </h3><br>  For verification, take the most common media - a flash drive.  I found an old 1 GB, which is quite suitable for experiments.  If you, like me, had the idea not to bathe with physical media, but to test on a file - a disk image, then I will immediately say: it will not work.  When formatting such a ‚Äúdisk‚Äù, Linux creates the file again, and all unused sectors will be filled with zeros. <br><br>  As a Linux machine, unfortunately, I had to use the weather station on the balcony on the Raspberry Pi 3. There is little memory there, so we will not hide large files.  We confine ourselves to a maximum size of 10 megabytes.  Too small files also make no sense: the utility writes data to the disk in clusters of 4 KB each.  Therefore, from below, we restrict ourselves to a 3 kb file ‚Äî it fits into one such cluster. <br><br>  We will mock the flash drive in stages, checking after each stage whether the hidden information is read: <br><br><ol><li>  Fast formatting in FAT16 format with a cluster size of 16 kb.  This is what Windows 7 offers to do with a flash drive, on which the file system is missing. </li><li>  Filling a flash drive with rubbish of 50%. </li><li>  Filling a flash drive with 100% garbage. </li><li>  "Long" formatting in FAT16 format (with overwriting everything). </li></ol><br>  The first two tests quite expectedly ended in complete victory: the utility was able to successfully extract 10 megabytes of secret data from the flash drive.  But after the flash drive scored files to the eyeballs, a failure occurred: <br><br> <code>Total clusters read: 250752, decrypted: 158 <br> ERROR: cannot write incomplete secretFile</code> <br> <br>  As you can see, only 158 clusters were successfully decrypted (632 kilobytes of raw data, which gives 636424 bytes of payload).  It is clear that 10 megabytes cannot be found here, and there are obviously duplicates among these clusters.  Even 1 megabyte cannot be restored this way.  But you can guarantee that we will restore the 3 kilobytes of secret data from the flash drive even after it is formatted and recorded to the string.  However, experiments show that it is quite possible to extract a file with a length of 120 kilobytes from such a flash drive. <br><br>  The last test, unfortunately, showed that the flash drive was overwritten all: <br><br> <code>$ sudo ./steganodisk -p password /dev/sda <br> Device size: 250752 clusters <br> 250700 99% <br> Total clusters read: 250752, decrypted: 0 <br> ERROR: cannot write incomplete secretFile <br></code> <br><br>  Not a single cluster has been preserved ... Sad but not tragic!  Let's try to create a partition on the flash drive before formatting, and already in it - a file system.  By the way, she came from the factory with this formatting, so we do not do anything suspicious. <br>  It is expected that the available space on the flash drive has slightly decreased. <br><br>  It is also expected that 10 megabytes still could not be hidden on a fully clogged drive.  But now the number of successfully decoded clusters has more than doubled! <br><br> <code>Total clusters read: 250752, decrypted: 405</code> <br> <br>  A megabyte, unfortunately, cannot be assembled from pieces, but two hundred kilobytes is easy. <br><br>  Well, the news of the last, 4th test, this time joyful: the full formatting of such a flash drive did not lead to the destruction of all the information!  120 kilobytes of secret data perfectly fit into the unused space. <br><br>  Testing Summary: <br><br><img src="https://habrastorage.org/webt/lc/1r/ii/lc1riil0s_qjcrnenxtkbcboi4m.png"><br><br><h3>  A bit of theorizing: on free space and unused sectors </h3><br>  If you once divided your hard disk into partitions, you might notice that it is not always possible to allocate all free space on the disk.  The first section always begins with some indentation (usually 1 megabyte, or 2048 sectors).  Behind the last section, too, sometimes, there remains a small ‚Äútail‚Äù of unused sectors.  Yes, and sometimes between the sections remain gaps, although rarely. <br><br>  In other words, there are sectors on the disk that cannot be accessed during normal work with the disk, but you can write data to these sectors!  So, read it too.  Adjusted for the fact that there is also a partition table and loader code, which are located in an empty area at the beginning of the disk. <br><br>  Let us distract for a while from the sections and look at the disk from a height, so to speak, a bird's flight.  Here we have an empty partition on the disk.  Create a file system in it.  Is it possible to say that some sectors on the disk were left unclogged? <br><br>  And-and-and - drum roll!  The answer will almost always be - yes!  Indeed, in most cases, the creation of a file system is reduced to the fact that only a few blocks of service information are written to the disk, and the rest of the contents of the section does not change. <br><br>  And also - purely empirically - it can be assumed that the file system may not always take up all the space allocated to it to the last sector.  For example, a FAT16 file system with a cluster size of 64 kilobytes obviously cannot fully occupy a partition with a size that is not a multiple of 64 kilobytes.  At the end of this section, there will have to be a ‚Äútail‚Äù in several sectors, unavailable for storing user data.  However, experimentally this assumption could not be confirmed. <br><br>  So, to maximize the space available under the steganogram, you need to use a file system with a larger cluster size.  You can still create a partition, even if it is optional (on a flash drive, for example).  There is no need to create empty sections or leave unallocated areas - this will attract the attention of interested citizens. <br><br><h3>  Experiment Utility </h3><br>  The utility sources can be found <a href="https://github.com/dishather/steganodisk">here.</a> <br><br>  The build will require Qt version 5.0 and above and OpenSSL.  If something is not going to - you may have to correct the file steganodisk.pro. <br><br>  You can change the cluster size from 4 KB to, say, 512 bytes (in secretfile.h).  At the same time, the overhead of service information will increase: the header and checksum occupy a fixed 68 bytes. <br><br>  You need to run the utility, of course, with root user privileges, and with caution.  There will be no questions before overwriting the specified file or device! <br><br>  Enjoy. </div><p>Source: <a href="https://habr.com/ru/post/447028/">https://habr.com/ru/post/447028/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447018/index.html">Quantum enrichment in a multi-world interpretation</a></li>
<li><a href="../447020/index.html">Productivity is not about time management, but about attention management.</a></li>
<li><a href="../447022/index.html">Do not make listeners to reflect</a></li>
<li><a href="../447024/index.html">How to combine the benefits of a laptop and a desktop computer? Analysis of problems and ideas solutions</a></li>
<li><a href="../447026/index.html">Writing an OTA-downloader for ATmega128RFA1 (as part of the Smart Response XE device)</a></li>
<li><a href="../447034/index.html">New bug in Telegram Desktop allows you to read the latest message.</a></li>
<li><a href="../447036/index.html">Cocktail for healthy eating - it is made by a startup from the accelerator of ITMO University</a></li>
<li><a href="../447038/index.html">In the list of threats: "Game of Thrones" - one of the most popular covers for cybercriminals</a></li>
<li><a href="../447040/index.html">Study: the average cost of switches decreases - we understand why</a></li>
<li><a href="../447042/index.html">The best of creating clean and fast Angular applications.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>