<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Are there still windows 9x users? We write the utility for reading NTFS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, finding windows 9x users has become difficult, but possible. But still they are. It is also known that it is not possible to use hard disks ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Are there still windows 9x users? We write the utility for reading NTFS</h1><div class="post__text post__text-html js-mediator-article">  Recently, finding windows 9x users has become difficult, but possible.  But still they are.  It is also known that it is not possible to use hard disks with NTFS partitions using standard operating system tools.  Let's try to fix it by writing a program that allows you to read data from NTFS partitions. <br><br>  <b>What will we demand from our program?</b> <br>  Yes, in general, not much.  The developed program should copy from partitions of a hard disk with the NTFS5 file system to FAT partitions.  This program should be used if Windows 2000 (which uses NTFS 5) is missing or unavailable.  Long file names should be supported, as well as hard drives of any capacity (including more than 8GB).  The operating environment is OS DOS, Windows 9x.  The program must have a "standard" two-pane "Norton" interface. <br><a name="habracut"></a><br><br>  <b>We will decide on the algorithm</b> <br>  After starting the program, a list of existing partitions appears on the screen with an indication of the hard disk, partition type and partition size.  By default, the choice of partitions with a type other than NTFS is prohibited (a corresponding message is displayed).  If you select an NTFS partition, it checks whether the partition is NTFS.  In case of a discrepancy, a corresponding message is issued.  If the partition is recognized as NTFS, 2 file panels are displayed.  The left pane displays a list of files and directories in the root directory of the NTFS partition.  The right displays the contents of the current directory of the current logical drive. <br>  The user performs the necessary actions (such as browsing the partition files, copying from the NTFS partition to the FAT partition) and exits the program 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>How is everything arranged</b> <br>  When the program starts, the parameters of all hard drives in the system are determined.  Defined: geometry, volume, as well as support for advanced functions of reading and writing.  The result for each drive is recorded in the following structure: <br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sDrvInfo</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> Drive; <span class="hljs-comment"><span class="hljs-comment">//   (80h..FFh) unsigned char ExtSupp; //   Int13 Ext (0 - ) unsigned short NumCyl; //   unsigned short NumHead; //   unsigned short NumSect; //     unsigned long NumAll; //      sDrvInfo *Next; //     };</span></span></code> </pre> <br>  Standard read / write functions (implemented through functions 02h and 03h of interrupt 13h) require specifying 3-dimensional sector numbers (track-head-sector) and work only for hard disks of no more than 8GB.  Extended functions (Int13 Ext) (42h and 43h interrupts 13h) allow you to specify the absolute sector number and work on hard drives of any size.  Therefore, with such support, reading of sectors is performed only through these functions. <br>  Then, for each hard disk, the partitions located on it are determined.  The result for each section is recorded in the structure: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sPartInfo</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> Drive; <span class="hljs-comment"><span class="hljs-comment">//   (80h..FFh) unsigned char Type; //   unsigned long Start; //      unsigned long Size; //      unsigned long Table; //      // ,      unsigned char NumEnt; //     sPartInfo *Next; //     };</span></span></code> </pre><br>  The procedure for searching for partitions is recursive, since the presence of extended partitions in general gives a tree.  An extended partition can have one of 2 types: 05h (for HDD &lt;= 8GB) or 0Fh (for HDD&gt; 8GB).  In the second case, access to the partition is possible only through Int13 Ext. <br>  Work with logical disks FAT is performed in a standard way (via interrupt 21h), therefore it is not of interest.  It is worth noting that, depending on whether long file names are supported, either standard functions or functions of the 71h group of the interrupt 21h are used. <br><br>  Working with the NTFS partition is based on manual parsing of all structures.  In accordance with the NTFS structure, the sequence of analysis of the partition is as follows (note: after reading each MFT record or index block, the fixup area must be corrected ‚Äî see the NTFS structure for more details): <br>  1. Two important parameters are extracted from the boot sector of a partition: the number of sectors per cluster and the number of the cluster where the MFT begins. <br>  2. MFT record number 3 (volume information) is read and an attempt is made to extract the name (label) of the volume from it.  In case of failure, it is assumed that the volume does not have a label. <br>  3. Read MFT entry number 5 (root directory).  The index contains a list of files and directories. <br>  4. When switching to a directory (above- or under-), the MFT record responsible for the required directory is read, and the index is also extracted from it. <br>  5. When accessing a file (for example, for reading), the MFT record responsible for the file is read and analyzed. <br><br>  If it is interesting, I'll sign for more.  Source codes <a href="">here</a> . <br><br>  PS: <br>  Source zip <a href="">here</a> . <br><br>  <b>And it looks like this in pictures:</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/51d/164/86d/51d16486d2b502aa2d580bc75243c8a8.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/3b9/1f2/9fd/3b91f29fd825791cf535b3c60d28fcc4.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/490/b74/3f3/490b743f3a7ab4d2c379c0d0b0c4e35f.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/3c1/654/6d7/3c16546d76a753461585ed3860524319.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/2ed/24a/3d0/2ed24a3d0c65077d810c44f4b2f89f31.png"><br></div><p>Source: <a href="https://habr.com/ru/post/126151/">https://habr.com/ru/post/126151/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126142/index.html">Switch from Mac OS X to Linux</a></li>
<li><a href="../126144/index.html">Modern biometric identification methods</a></li>
<li><a href="../126145/index.html">Thunderbird will be your default email program in Ubuntu 11.10</a></li>
<li><a href="../126146/index.html">Federal Trade Commission investigates possible antitrust violations by Google</a></li>
<li><a href="../126149/index.html">My ‚Äúsecond‚Äù iOS app</a></li>
<li><a href="../126155/index.html">Release Mango scheduled for the first of September</a></li>
<li><a href="../126157/index.html">Vkontakte vs Mail.ru Group</a></li>
<li><a href="../126159/index.html">IBM PC is 30 years old</a></li>
<li><a href="../126160/index.html">SMM in politics, pros, cons, specifics of work</a></li>
<li><a href="../126161/index.html">Sony Ericsson has updated the 2011 model firmware</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>