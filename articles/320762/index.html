<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A small comparison of the performance of the MongoDB vs ClickHouse DBMS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Since ClickHouse column DBMS (Yandex internal development) became available to everyone, I decided to use this DBMS instead of MongoDB for storing ana...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A small comparison of the performance of the MongoDB vs ClickHouse DBMS</h1><div class="post__text post__text-html js-mediator-article">  Since ClickHouse column DBMS (Yandex internal development) became available to everyone, I decided to use this DBMS instead of MongoDB for storing analytical data.  Before using, I made a small performance test and want to share the results with the IT community. <br><a name="habracut"></a><br>  For the test used nodejs.  Libraries for a DBMS under nodejs (driver): <br>  ‚Üí <a href="https://github.com/TimonKK/clickhouse">ClickHouse</a> <br>  ‚Üí <a href="https://github.com/mongodb/node-mongodb-native">MongoDB</a> <br><br>  Tested on hardware: <br><blockquote>  i5-3570 <br>  8gb DDR3 1333 MHz Kingston <br>  CSSD-N128GB3-BK <br>  OS: Linux Mint 18 </blockquote><br>  Before starting the test, I installed ClickHouse and MongoDB with standard settings.  Created a collection in MongoDB "testCollections" and a table in ClickHouse "test" with the MergeTree engine.  Here is the structure of the test table in ClickHouse (in MongoDB the structure is dynamic): <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> (event_date <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> toDate(event_time), event_time DateTime <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">now</span></span>(), <span class="hljs-built_in"><span class="hljs-built_in">number</span></span> UInt64, <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">String</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">month</span></span> <span class="hljs-keyword"><span class="hljs-keyword">String</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">engine</span></span> = MergeTree(event_date, (event_time, <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">month</span></span>), <span class="hljs-number"><span class="hljs-number">8192</span></span>);</code> </pre> <br>  Fields event_ * for dates. <br>  number - for a random number. <br>  text - for random text. <br>  month - for a random month. <br>  In MongoDB I will also insert similar data with the same structure. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And here you can begin the test.  Test data will be done on the "fly", that is, insert the data and watch the results of the implementation of the insert in milliseconds.  The test will not update because ClickHouse does not have this operation. <br><br>  Data structure to insert: <br><br><pre> <code class="hljs 1c">MongoDB [ { event_date: '<span class="hljs-number"><span class="hljs-number">2017-01-29</span></span>', event_time: '<span class="hljs-number"><span class="hljs-number">2017-01-29</span></span> 16:00:40', number: <span class="hljs-number"><span class="hljs-number">3</span></span>, text: 'sequi voluptatibus labore', month: 'December' }, ... ]</code> </pre> <br><pre> <code class="hljs 1c">ClickHouse [ [ '<span class="hljs-number"><span class="hljs-number">2017-01-29</span></span>', '<span class="hljs-number"><span class="hljs-number">2017-01-29</span></span> 16:00:40', <span class="hljs-number"><span class="hljs-number">1</span></span>, 'Et omnis consequatur id eaque suscipit error sed at. Eos ut omnis corporis unde. Tenetur ...', 'July' ], ... ]</code> </pre><br>  So, let's begin. <br><br><h4>  Data size: 500 thousand records </h4><br>  In this test we will insert and select data. <br><br>  - Insert into the database. <br><br>  MongoDB: <br><br><img src="http://www.picshare.ru/uploads/170129/rN6x3UDGto.jpg" alt="image"><br><br>  Insert took ~ 8289 ms. <br><br>  ClickHouse: <br><br><img src="http://www.picshare.ru/uploads/170129/y0t3371Qj4.jpg" alt="image"><br><br>  Insert took ~ 17375 ms. <br><br>  Total 17375-8289 = 9086 ms.  MongoDB inserts data about 2 times faster than ClickHouse. <br><br>  - Select data <br><br>  We will choose how many times the month ‚ÄúDecember‚Äù is repeated in the table (collection). <br><br>  MongoDB.  Request: <br><br><pre> <code class="javascript hljs">db.testCollections.aggregate([ { <span class="hljs-string"><span class="hljs-string">"$group"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">_id</span></span> : <span class="hljs-string"><span class="hljs-string">"$month"</span></span>, <span class="hljs-attr"><span class="hljs-attr">count</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">$sum</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> } } } ])</code> </pre><br>  Result 300 ms: <br><br><img src="http://www.picshare.ru/uploads/170129/6r4vw7EpR1.jpg" alt="image"><br><br>  ClickHouse.  Request: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">month</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">month</span></span>;</code> </pre><br>  Result 42 ms: <br><br><img src="http://www.picshare.ru/uploads/170129/qU3uIvwUo8.jpg" alt="image"><br><br>  Total 300-42 = 258 ms.  ClickHouse is about 7 times faster to select data with grouping than MongoDB. <br><br>  Let's make another simple select with limit 20. <br><br>  MongoDB: <br><br><pre> <code class="javascript hljs"> db.testCollections.find().limit(<span class="hljs-number"><span class="hljs-number">20</span></span>);</code> </pre> <br><br>  Result 13 ms: <br><br><img src="http://www.picshare.ru/uploads/170129/L2c4iVgGzT.jpg" alt="image"><br><br>  ClickHouse: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>;</code> </pre><br>  Result 24 ms: <br><br><img src="http://www.picshare.ru/uploads/170129/WA5vuo8G2Q.jpg" alt="image"><br><br>  Total for select with limit 20 ClickHouse spent approximately 2 more time than MongoDB. <br><br>  Let's multiply the data 10 times and repeat the test for data sampling. <br><br><h4>  Data size: 5 million records </h4><br>  In this test, we will select the data (that is, the data described above is already inserted into both databases). <br>  Result count in both databases: <br><br><img src="http://www.picshare.ru/uploads/170129/Sv4K3sa1X9.jpg" alt="image"><br><br>  - Select data <br><br>  Same queries with grouping.  MongoDB: <br><br><img src="http://www.picshare.ru/uploads/170129/IgGVW0u0o5.jpg" alt="image"><br><br>  Sampling time 3145 ms. <br><br>  ClickHouse: <br><br><img src="http://www.picshare.ru/uploads/170129/xwLX1zsLh3.jpg" alt="image"><br><br>  Sampling time 112 ms. <br><br>  ClickHouse with a given amount of data is ten times faster.  Regular select with limit 20 was the same as with 500 thousand records. <br><br>  Let's multiply the data 10 times and repeat the test for data sampling.  (something I put on 500 thousand records more, there will be 50 500 000 records). <br><br><h4>  Data size: 50.5 million records </h4><br>  Result count in both databases: <br><br><img src="http://www.picshare.ru/uploads/170129/Y09i8MJOX3.jpg" alt="image"><br><br>  - Select data <br><br>  Same queries with grouping.  MongoDB: <br><br>  The mongodb client for nodejs fell off after 35009 ms.  Here is the result from the client GUI for working with MongoDB: <br><br><img src="http://www.picshare.ru/uploads/170129/VWQt4jXx50.jpg" alt="image"><br><br>  Sampling time 1m 12,571 s. <br><br>  ClickHouse: <br><br><img src="http://www.picshare.ru/uploads/170129/TqQ3qU7eko.jpg" alt="image"><br><br>  Sampling time 931 ms. <br><br>  ClickHouse is clearly leading the way. <br><br><h4>  Summary </h4><br>  ClickHouse is great for projects with BigData.  Sampling speed is impressive.  This DBMS is a good choice for storing data associated with analytical information. <br><br>  Project with tests: <a href="https://github.com/lvovgeka/ClickHouseVsMongoDB">see</a> . </div><p>Source: <a href="https://habr.com/ru/post/320762/">https://habr.com/ru/post/320762/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320750/index.html">Protecting information on Google - some technical details</a></li>
<li><a href="../320754/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ247 (January 23 - 29, 2017)</a></li>
<li><a href="../320756/index.html">PHP Digest number 101 - interesting news, materials and tools (January 15 - 29, 2017)</a></li>
<li><a href="../320758/index.html">The revival of the IT-questionnaire or how to follow the questions toster and stackoverflow v2</a></li>
<li><a href="../320760/index.html">Is it time to quit?</a></li>
<li><a href="../320764/index.html">Dell EMC: Convergence Conversion</a></li>
<li><a href="../320766/index.html">Comparison of 7 photogrammetry systems. What is better to choose?</a></li>
<li><a href="../320768/index.html">BGP Fake-AS</a></li>
<li><a href="../320772/index.html">The difference between statistics and data science</a></li>
<li><a href="../320776/index.html">Google Chrome Extensions: a quick do-it-yourself translator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>