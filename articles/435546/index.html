<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Practical tips, examples, and SSH tunnels</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Practical examples of SSH that will bring your remote system administrator skills to a new level. Teams and tips will help not only use SSH , but also...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Practical tips, examples, and SSH tunnels</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/oz/pn/4x/ozpn4xuna3odpakxmdgnlwqxwto.jpeg"></div><br>  Practical examples of <a href="https://en.wikipedia.org/wiki/Secure_Shell">SSH</a> that will bring your remote system administrator skills to a new level.  Teams and tips will help not only use <code>SSH</code> , but also more competently navigate the network. <br><br>  Knowing a few <code>ssh</code> tricks is useful to any system administrator, network engineer, or security specialist. <br><a name="habracut"></a><br><h3>  Case Studies SSH </h3><br><ol><li>  <a href="https://habr.com/ru/post/435546/">Ssh socks proxy</a> </li><li>  <a href="https://habr.com/ru/post/435546/">SSH tunnel (port forwarding)</a> </li><li>  <a href="https://habr.com/ru/post/435546/">SSH tunnel to the third host</a> </li><li>  <a href="https://habr.com/ru/post/435546/">Reverse ssh tunnel</a> </li><li>  <a href="https://habr.com/ru/post/435546/">SSH reverse proxy</a> </li><li>  <a href="https://habr.com/ru/post/435546/">Installing VPN over SSH</a> </li><li>  <a href="https://habr.com/ru/post/435546/">Copy SSH key (ssh-copy-id)</a> </li><li>  <a href="https://habr.com/ru/post/435546/">Remote command execution (non-interactive)</a> </li><li>  <a href="https://habr.com/ru/post/435546/">Remote packet capture and viewing in Wireshark</a> </li><li>  <a href="https://habr.com/ru/post/435546/">Copying a local folder to a remote server via SSH</a> </li><li>  <a href="https://habr.com/ru/post/435546/">Remote GUI Applications with SSH X11 Redirection</a> </li><li>  <a href="https://habr.com/ru/post/435546/">Remote file copying using rsync and ssh</a> </li><li>  <a href="https://habr.com/ru/post/435546/">SSH over the Tor network</a> </li><li>  <a href="https://habr.com/ru/post/435546/">SSH to EC2 instance</a> </li><li>  <a href="https://habr.com/ru/post/435546/">Editing text files using VIM via ssh / scp</a> </li><li>  <a href="https://habr.com/ru/post/435546/">Mounting Remote SSH as Local Folder with SSHFS</a> </li><li>  <a href="https://habr.com/ru/post/435546/">SSH Multiplexing with ControlPath</a> </li><li>  <a href="https://habr.com/ru/post/435546/">Streaming video over SSH using VLC and SFTP</a> </li><li>  <a href="https://habr.com/ru/post/435546/">Two-factor authentication</a> </li><li>  <a href="https://habr.com/ru/post/435546/">Jumps on hosts with SSH and -J</a> </li><li>  <a href="https://habr.com/ru/post/435546/">Blocking SSH brute-force attempts using iptables</a> </li><li>  <a href="https://habr.com/ru/post/435546/">SSH Escape to change port forwarding</a> </li></ol><br><h1>  First basics </h1><br><h4>  SSH command line parsing </h4><br>  The following example uses common parameters that are often encountered when connecting to a remote <code>SSH</code> server. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -v -p 22 -C neo@remoteserver</code> </pre> <br><ul><li>  <code>-v</code> : debug output is especially useful when analyzing authentication problems.  Can be used several times to display additional information. </li><li>  <code>- p 22</code> : <b>port for connecting</b> to a remote SSH server.  22 is not necessary to specify, because this is the default value, but if the protocol is on some other port, then we specify it with the help of the <code>-p</code> parameter.  The listening port is specified in the <code>sshd_config</code> file in the format <code>Port 2222</code> . </li><li>  <code>-C</code> : compression for connection.  If you have a slow channel or you view a lot of text, it can speed up the connection. </li><li>  <code>neo@</code> : the line before the symbol @ denotes the username for authentication on the remote server.  If you do not specify it, the default will be the username of the account you are currently logged in to (~ $ whoami).  The user can also be specified with the <code>-l</code> option. </li><li>  <code>remoteserver</code> : the name of the host to which <code>ssh</code> connected, this can be a fully qualified domain name, IP address or any host in the local hosts file.  To connect to a host that supports both IPv4 and IPv6, you can add the <code>-4</code> or <code>-6</code> option to the command line for proper resolution. </li></ul><br>  All of the above parameters are optional, except for <code>remoteserver</code> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Using a configuration file </h4><br>  Although many are familiar with the <code>sshd_config</code> file, there is also a client configuration file for the <code>ssh</code> command.  The default is <code>~/.ssh/config</code> , but it can be defined as a parameter for the <code>-F</code> option. <br><br><pre> <code class="bash hljs">Host * Port 2222 Host remoteserver HostName remoteserver.thematrix.io User neo Port 2112 IdentityFile /home/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/.ssh/remoteserver.private_key</code> </pre> <br>  In the sample ssh configuration file above, there are two host entries.  The first one denotes all the hosts, the Port 2222 configuration parameter is used for all. The second one says that for the <b>remoteserver</b> host <b>you</b> should use a different username, port, FQDN and IdentityFile. <br><br>  The configuration file can save a lot of time on entering characters, allowing you to automatically apply advanced configuration when connecting to specific hosts. <br><br><h4>  Copying files over SSH using SCP </h4><br>  The SSH client comes with two other very handy tools for copying files over an <b>encrypted ssh connection</b> .  See below for an example of the standard use of the scp and sftp commands.  Note that many of the parameters for ssh apply to these commands. <br><br><pre> <code class="bash hljs">localhost:~$ scp mypic.png neo@remoteserver:/media/data/mypic_2.png</code> </pre> <br>  In this example, the file <b>mypic.png is</b> copied to <b>remoteserver</b> in the folder <b>/ media / data</b> and renamed to <b>mypic_2.png</b> . <br><br>  Do not forget about the difference in the port parameter.  On this come across many who run <code>scp</code> from the command line.  Here the port parameter is <code>-P</code> , and not <code>-p</code> , as in the ssh client!  You will forget, but do not worry, everyone will forget. <br><br>  For those familiar with console <code>ftp</code> , many of the commands are similar in <code>sftp</code> .  You can <b>push</b> , <b>put,</b> and <b>ls</b> as your heart desires. <br><br><pre> <code class="bash hljs">sftp neo@remoteserver</code> </pre> <br><h1>  Practical examples </h1><br>  In many of these examples, you can achieve results using different methods.  As in all our <a href="https://hackertarget.com/research/">textbooks</a> and examples, preference is given to practical examples that just do their job. <br><br><a name="1"></a><h3>  1. SSH socks proxy </h3><br>  The SSH Proxy feature is number 1 for a good reason.  It is more powerful than many people assume, and gives you access to any system that a remote server has access to using almost any application.  The ssh client can tunnel traffic through a SOCKS proxy with one simple command.  It is important to understand that traffic to remote systems will come from a remote server, as will be indicated in the logs of the web server. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -D 8888 user@remoteserver localhost:~$ netstat -pan | grep 8888 tcp 0 0 127.0.0.1:8888 0.0.0.0:* LISTEN 23880/ssh</code> </pre> <br>  Here we run a socks proxy on TCP port 8888, the second command checks that the port is active in listening mode.  127.0.0.1 indicates that the service works only on localhost.  We can use a slightly different command to listen on all interfaces, including ethernet or wifi, this will allow other applications (browsers, etc.) on our network to connect to the proxy service via ssh socks proxy. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -D 0.0.0.0:8888 user@remoteserver</code> </pre> <br>  Now we can configure the browser to connect to socks-proxy.  In Firefox, select <b>Settings |</b>  <b>Basic |</b>  <b>Network settings</b> .  Specify the IP address and port for the connection. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/daa/f8b/545/daaf8b54515ce6eee864c8416d41eef9.png"><br><br>  Pay attention to the option at the bottom of the form, so that the browser's DNS requests also go through the SOCKS proxy.  If you are using a proxy server to encrypt web traffic on a local network, then you probably want to select this option so that DNS queries are tunneled over an SSH connection. <br><br><h4>  Activate socks proxy in Chrome </h4><br>  Running Chrome with certain command line parameters activates socks proxies, as well as tunneling DNS requests from the browser.  Trust but check.  Use <a href="https://hackertarget.com/tcpdump-examples/">tcpdump</a> to verify that DNS queries are no longer visible. <br><br><pre> <code class="bash hljs">localhost:~$ google-chrome --proxy-server=<span class="hljs-string"><span class="hljs-string">"socks5://192.168.1.10:8888"</span></span></code> </pre> <br><h4>  Using other applications with proxies </h4><br>  Keep in mind that many other applications can also use socks-proxies.  A web browser is simply the most popular one.  Some applications have configuration options for activating the proxy server.  Others need a little help with an ancillary program.  For example, <a href="https://github.com/haad/proxychains">proxychains</a> allows <a href="https://github.com/haad/proxychains">you</a> to run through Microsoft socks-proxy RDP, etc. <br><br><pre> <code class="bash hljs">localhost:~$ proxychains rdesktop <span class="hljs-variable"><span class="hljs-variable">$RemoteWindowsServer</span></span></code> </pre> <br>  Socks-proxy configuration parameters are specified in the proxychains configuration file. <br><br><blockquote>  Hint: if using remote desktop from linux to windows?  Try the <a href="https://github.com/FreeRDP/FreeRDP">FreeRDP</a> client.  This is a more modern implementation than <code>rdesktop</code> , with much smoother interaction. </blockquote><br><h4>  The option of using SSH through socks-proxy </h4><br>  You are sitting in a cafe or hotel - and you have to use rather unreliable WiFi.  From a laptop, locally run ssh-proxy and set up an ssh-tunnel to the home network on the local Rasberry Pi.  Using a browser or other applications configured for socks-proxy, we can access any network services in our home network or access the Internet through a home connection.  Everything between your laptop and your home server (via Wi-Fi and the Internet to your home) is encrypted in the SSH tunnel. <br><br><a name="2"></a><h3>  2. SSH Tunnel (Port Forwarding) </h3><br>  In its simplest form, an SSH tunnel simply opens up a port on your local system that connects to another port on the other end of the tunnel. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -L 9999:127.0.0.1:80 user@remoteserver</code> </pre> <br>  Let's analyze the <code>-L</code> parameter.  It can be thought of as the local listening side.  Thus, in the example above, port 9999 is tapped on the localhost side and forwarded via port 80 to remoteserver.  Please note that 127.0.0.1 refers to localhost on a remote server! <br><br>  We will rise on the step.  In the following example, the listening ports are associated with other nodes on the local network. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -L 0.0.0.0:9999:127.0.0.1:80 user@remoteserver</code> </pre> <br>  In these examples, we connect to a port on a web server, but this can be a proxy server or any other TCP service. <br><br><a name="3"></a><h3>  3. SSH tunnel to a third-party host </h3><br>  We can use the same parameters to connect the tunnel from a remote server to another service running on the third system. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -L 0.0.0.0:9999:10.10.10.10:80 user@remoteserver</code> </pre> <br>  In this example, we are redirecting the tunnel from the remoteserver to the web server running on 10.10.10.10.  Traffic from remoteserver to 10.10.10.10 is <b>no longer in the SSH tunnel</b> .  The web server on 10.10.10.10 will consider the remoteserver source of web requests. <br><br><a name="4"></a><h3>  4. Reverse SSH Tunnel </h3><br>  Here we set up a listening port on a remote server that will connect back to the local port on our localhost (or another system). <br><br><pre> <code class="bash hljs">localhost:~$ ssh -v -R 0.0.0.0:1999:127.0.0.1:902 192.168.1.100 user@remoteserver</code> </pre> <br>  In this SSH session, a connection is established from port 1999 on the remoteserver to port 902 on our local client. <br><br><a name="5"></a><h3>  5. Reverse SSH Proxy </h3><br>  In this case, we set up a socks proxy on our ssh connection, however, the proxy listens on the remote end of the server.  Connections to this remote proxy now appear from the tunnel as traffic from our localhost. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -v -R 0.0.0.0:1999 192.168.1.100 user@remoteserver</code> </pre> <br><h4>  Troubleshooting problems with remote SSH tunnels </h4><br>  If you have problems with the operation of remote SSH options, check with <code>netstat</code> what other interfaces the listening port is connected to.  Although we specified 0.0.0.0 in the examples, but if the value of <b>GatewayPorts</b> in <b>sshd_config is</b> set to <b>no</b> , then the listener will be bound to localhost (127.0.0.1) only. <br><br><blockquote><h4>  Safety warning </h4><br>  Please note that when opening tunnels and socks-proxies, internal network resources may be accessed by unreliable networks (for example, the Internet!).  This can be a serious security threat, so make sure you understand what the listener is and what it has access to. </blockquote><br><a name="6"></a><h3>  6. Installing VPN over SSH </h3><br>  The general term among specialists in attack methods (pentesters, etc.) is ‚Äúa point of support in a network‚Äù.  After establishing a connection in one system, this system becomes a gateway for further access to the network.  The fulcrum that allows you to move in breadth. <br><br>  For such a foothold, we can use SSH proxies and <b>proxychains</b> , however there are some limitations.  For example, it will not be possible to work directly with sockets, so we will not be able to scan ports within the network through <a href="https://hackertarget.com/nmap-online-port-scanner/">Nmap</a> <code>SYN</code> . <br><br>  Using this more advanced VPN option, the connection drops to <b>level 3</b> .  Then we can simply send traffic through the tunnel using standard network routing. <br><br>  The method uses <code>ssh</code> , <code>iptables</code> , <code>tun interfaces</code> and routing. <br><br>  First you need to set these parameters in <code>sshd_config</code> .  Since we are making changes to the interfaces of both the remote and client systems, we <b>need root rights on both sides</b> . <br><br><pre> <code class="bash hljs">PermitRootLogin yes PermitTunnel yes</code> </pre> <br>  Then we establish an ssh connection using the parameter that requests the initialization of tun devices. <br><br><pre> <code class="bash hljs">localhost:~<span class="hljs-comment"><span class="hljs-comment"># ssh -v -w any root@remoteserver</span></span></code> </pre> <br>  Now we should have a tun device when showing interfaces ( <code># ip a</code> ).  The next step is to add IP addresses to the tunnel interfaces. <br><br>  SSH client side: <br><br><pre> <code class="bash hljs">localhost:~<span class="hljs-comment"><span class="hljs-comment"># ip addr add 10.10.10.2/32 peer 10.10.10.10 dev tun0 localhost:~# ip tun0 up</span></span></code> </pre> <br>  SSH server side: <br><br><pre> <code class="bash hljs">remoteserver:~<span class="hljs-comment"><span class="hljs-comment"># ip addr add 10.10.10.10/32 peer 10.10.10.2 dev tun0 remoteserver:~# ip tun0 up</span></span></code> </pre> <br>  Now we have a direct route to another host ( <code>route -n</code> and <code>ping 10.10.10.10</code> ). <br><br>  You can route any subnet through a host on the other side. <br><br><pre> <code class="bash hljs">localhost:~<span class="hljs-comment"><span class="hljs-comment"># route add -net 10.10.10.0 netmask 255.255.255.0 dev tun0</span></span></code> </pre> <br>  On the remote side, you must enable <code>ip_forward</code> and <code>iptables</code> . <br><br><pre> <code class="bash hljs">remoteserver:~<span class="hljs-comment"><span class="hljs-comment"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward remoteserver:~# iptables -t nat -A POSTROUTING -s 10.10.10.2 -o enp7s0 -j MASQUERADE</span></span></code> </pre> <br>  Boom!  <b>VPN over SSH tunnel at network level 3</b> .  This is already a victory. <br><br>  If there are any problems, use <a href="https://hackertarget.com/tcpdump-examples/">tcpdump</a> and <code>ping</code> to determine the cause.  Since we are playing at level 3, our icmp packages will go through this tunnel. <br><br><a name="7"></a><h3>  7. Copy SSH key (ssh-copy-id) </h3><br>  There are several ways, but this command saves time, so as not to copy files manually.  It simply copies ~ / .ssh / id_rsa.pub (or the default key) from your system to <code>~/.ssh/authorized_keys</code> on the remote server. <br><br><pre> <code class="bash hljs">localhost:~$ ssh-copy-id user@remoteserver</code> </pre> <br><a name="8"></a><h3>  8. Remote command execution (non-interactive) </h3><br>  The <code>ssh</code> command can be linked to other commands for a normal user-friendly interface.  Just add the command you want to run on the remote host as the last parameter in quotes. <br><br><pre> <code class="bash hljs">localhost:~$ ssh remoteserver <span class="hljs-string"><span class="hljs-string">"cat /var/log/nginx/access.log"</span></span> | grep badstuff.php</code> </pre> <br>  In this example, <code>grep</code> is executed on the local system after the log has been downloaded via the ssh channel.  If the file is large, it is more convenient to run <code>grep</code> on the remote side simply by enclosing both commands in double quotes. <br><br>  Another example performs the same function as <code>ssh-copy-id</code> from example 7. <br><br><pre> <code class="bash hljs">localhost:~$ cat ~/.ssh/id_rsa.pub | ssh remoteserver <span class="hljs-string"><span class="hljs-string">'cat &gt;&gt; .ssh/authorized_keys'</span></span></code> </pre> <br><a name="9"></a><h3>  9. Remote packet capture and viewing in Wireshark </h3><br>  I took one of our <a href="https://hackertarget.com/tcpdump-examples/">tcpdump examples</a> .  Use it to remotely intercept packets and output the result directly to the local Wireshark GUI. <br><br><pre> <code class="bash hljs">:~$ ssh root@remoteserver <span class="hljs-string"><span class="hljs-string">'tcpdump -c 1000 -nn -w - not port 22'</span></span> | wireshark -k -i -</code> </pre> <br><a name="10"></a><h3>  10. Copying a local folder to a remote server via SSH </h3><br>  A beautiful trick that compresses a folder with <code>bzip2</code> (this is the -j parameter in the <code>tar</code> command) and then extracts the <code>bzip2</code> stream on the other side, creating a duplicate folder on the remote server. <br><br><pre> <code class="bash hljs">localhost:~$ tar -cvj /datafolder | ssh remoteserver <span class="hljs-string"><span class="hljs-string">"tar -xj -C /datafolder"</span></span></code> </pre> <br><a name="11"></a><h3>  11. Remote GUI applications with SSH X11 redirection </h3><br>  If ‚ÄúX's‚Äù are installed on the client and remote server, then you can remotely execute the GUI command, with a window on your local desktop.  This feature exists a long time ago, but is still very useful.  Launch a remote web browser or even a VMWawre Workstation console, as I do in this example. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -X remoteserver vmware</code> </pre> <br>  The string <code>X11Forwarding yes</code> in the <code>sshd_config</code> file is required. <br><br><a name="12"></a><h3>  12. Remote file copying using rsync and ssh </h3><br>  <code>rsync</code> is much more convenient than <code>scp</code> if periodic backup of a directory, a large number of files or very large files is required.  There is a recovery function after the failure of the transfer and copy only the modified files, which saves traffic and time. <br><br>  This example uses <code>gzip</code> (-z) compression and archive mode (-a), which includes recursive copying. <br><br><pre> <code class="bash hljs">:~$ rsync -az /home/testuser/data remoteserver:backup/</code> </pre> <br><a name="13"></a><h3>  13. SSH over the Tor network </h3><br>  The anonymous Tor network can tunnel SSH traffic using the <code>torsocks</code> .  The following command will proxy ssh-proxy through Tor. <br><br><pre> <code class="bash hljs">localhost:~$ torsocks ssh myuntracableuser@remoteserver</code> </pre> <br>  <a href="https://github.com/dgoulet/torsocks">Torsocks</a> will use proxy port 9050 on localhost.  As always, when using Tor, you need to seriously check what traffic is being tunneled and other operational security issues (opsec).  <b>Where do your DNS queries go?</b> <br><br><a name="14"></a><h3>  14. SSH to EC2 instance </h3><br>  To connect to an EC2 instance, you need a private key.  Download it (the .pem extension) from the Amazon EC2 control panel and change the permissions ( <code>chmod 400 my-ec2-ssh-key.pem</code> ).  Keep the key in a safe place or place it in your <code>~/.ssh/</code> folder. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -i ~/.ssh/my-ec2-key.pem ubuntu@my-ec2-public</code> </pre> <br>  The <b>-i option</b> simply tells the ssh client to use this switch.  The <code>~/.ssh/config</code> file is ideal for automatically configuring key usage when connected to the ec2 host. <br><br><pre> <code class="bash hljs">Host my-ec2-public Hostname ec2???.compute-1.amazonaws.com User ubuntu IdentityFile ~/.ssh/my-ec2-key.pem</code> </pre> <br><a name="15"></a><h3>  15. Editing text files using VIM via ssh / scp </h3><br>  For all <code>vim</code> lovers, this advice will save some time.  With <code>vim</code> files are edited for scp with one command.  This method simply creates the file locally in <code>/tmp</code> , and then copies it back as soon as we save it from <code>vim</code> . <br><br><pre> <code class="bash hljs">localhost:~$ vim scp://user@remoteserver//etc/hosts</code> </pre> <br>  Note: The format is slightly different from regular <code>scp</code> .  After the host we have a double <code>//</code> .  This is a link to an absolute path.  One slash will be the path relative to the <code>users</code> home folder. <br><br><pre> <code class="bash hljs">**warning** (netrw) cannot determine method (format: protocol://[user@]hostname[:port]/[path])</code> </pre> <br>  If you see such an error, double check the format of the command.  This usually means a syntax error. <br><br><a name="16"></a><h3>  16. Mounting Remote SSH as a Local Folder with SSHFS </h3><br>  With <code>sshfs</code> , the <code>ssh</code> file system client, we can connect a local directory to a remote location with all file interactions in an encrypted <code>ssh</code> session. <br><br><pre> <code class="bash hljs">localhost:~$ apt install sshfs</code> </pre> <br>  On Ubuntu and Debian, install the <code>sshfs</code> package, and then simply accept the remote location to our system. <br><br><pre> <code class="bash hljs">localhost:~$ sshfs user@remoteserver:/media/data ~/data/</code> </pre> <br><a name="17"></a><h3>  17. SSH Multiplexing with ControlPath </h3><br>  By default, if there is an existing connection to a remote server using <code>ssh</code> second connection using <code>ssh</code> or <code>scp</code> establishes a new session with additional authentication.  The <code>ControlPath</code> option allows you to use an existing session for all subsequent connections.  This will significantly speed up the process: the effect is noticeable even in the local network, and even more so when connected to remote resources. <br><br><pre> <code class="bash hljs">Host remoteserver HostName remoteserver.example.org ControlMaster auto ControlPath ~/.ssh/control/%r@%h:%p ControlPersist 10m</code> </pre> <br>  ControlPath specifies the socket to check for new connections for an active <code>ssh</code> session.  The last option means that even after logging out of the console, the existing session will remain open for 10 minutes, so during this time you can reconnect over the existing socket.  See the <code>ssh_config man</code> help for more information. <br><br><a name="18"></a><h3>  18. Streaming video over SSH using VLC and SFTP </h3><br>  Even long-time users of <code>ssh</code> and <code>vlc</code> (Video Lan Client) are not always aware of this convenient option, when you really need to watch videos over the network.  In the settings <b>File |</b>  <b>Open Network Stream</b> <code>vlc</code> programs can be entered as <code>sftp://</code> .  If a password is required, a prompt will appear. <br><br><pre> <code class="bash hljs">sftp://remoteserver//media/uploads/myvideo.mkv</code> </pre> <br><a name="19"></a><h3>  19. Two-factor authentication </h3><br>  The same two-factor authentication as your bank account or Google account applies to the SSH service. <br><br>  Of course, <code>ssh</code> initially has a two-factor authentication function, which means a password and an SSH key.  The advantage of a hardware token or Google Authenticator application is that it is usually a different physical device. <br><br>  See our 8-minute guide to <a href="https://hackertarget.com/ssh-two-factor-google-authenticator/">using Google Authenticator and SSH</a> . <br><br><a name="20"></a><h3>  20. Jumping to hosts with ssh and -J </h3><br>  If, because of network segmentation, you have to go through several ssh hosts to get to the destination destination network, you will save time with the -J shortcut. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -J host1,host2,host3 user@host4.internal</code> </pre> <br>  The main thing here is to understand that this is not similar to the <code>ssh host1</code> , then <code>user@host1:~$ ssh host2</code> and so on. The -J parameter cleverly uses redirection so that localhost establishes a session with the next host in the chain.  Thus, in the example above, our localhost is authenticated to host4.  That is, our localhost keys are used, and the session from localhost to host4 is fully encrypted. <br><br>  To do this, specify the <b>ProxyJump</b> configuration option in <b>ssh_config</b> .  If you regularly have to go through several hosts, then automation through the config will save a lot of time. <br><br><a name="21"></a><h3>  21. Blocking SSH brute-force attempts using iptables </h3><br>  Anyone who ran the SSH service and looked through the logs knows about the number of bruteforce attempts that occur every hour every day.  A quick way to reduce noise in the logs is to transfer SSH to a non-standard port.  Edit the <code>sshd_config</code> file using the <b>Port ##</b> configuration parameter. <br><br>  Using <code>iptables</code> , you can also easily block attempts to connect to a port when a certain threshold is reached.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The easiest way to do this is to use </font></font><a href="https://hackertarget.com/enable-ossec-active-response/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSSEC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , since it not only blocks SSH, but performs a bunch of other intrusion detection measures based on the host name (HIDS).</font></font><br><br><a name="22"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 22. SSH Escape to change port forwarding </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And our last example is </font></font><code>ssh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intended to change the port forwarding on the fly within an existing session </font></font><code>ssh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Imagine such a scenario. </font><font style="vertical-align: inherit;">You are deep in the net; </font><font style="vertical-align: inherit;">you may have jumped through half a dozen hosts and you need a local port on the workstation that is redirected to the Microsoft SMB of the old Windows 2003 system (does anyone remember ms08-67?). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clicking </font></font><code>enter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, try typing in console </font></font><code>~C</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">This is a control sequence in a session that allows you to make changes to an existing connection.</font></font><br><br><pre> <code class="bash hljs">localhost:~$ ~C ssh&gt; -h Commands: -L[bind_address:]port:host:hostport Request <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> forward -R[bind_address:]port:host:hostport Request remote forward -D[bind_address:]port Request dynamic forward -KL[bind_address:]port Cancel <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> forward -KR[bind_address:]port Cancel remote forward -KD[bind_address:]port Cancel dynamic forward ssh&gt; -L 1445:remote-win2k3:445 Forwarding port.</code> </pre> <br>    ,       1445   Windows 2003,     .    <code>msfconsole</code> ,     (,      ). <br><br><h1>  Completion </h1><br>  ,    <code>ssh</code>    ;             ( <code>man ssh</code> , <code>man ssh_config</code> , <code>man sshd_config</code> ). <br><br>              .         <code>ssh</code>       ,   . </div><p>Source: <a href="https://habr.com/ru/post/435546/">https://habr.com/ru/post/435546/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435536/index.html">Humanoid robots: the benefits and problems of anthropomorphic mechanisms</a></li>
<li><a href="../435538/index.html">In 2018, in Germany, more "green" energy was received than electricity from the burning of coal</a></li>
<li><a href="../435540/index.html">New keywords in java</a></li>
<li><a href="../435542/index.html">Game development and diploma defense or ‚ÄúHow I killed two birds with one stone the first pancake‚Äù</a></li>
<li><a href="../435544/index.html">Innopolis University employee received a Facebook grant</a></li>
<li><a href="../435548/index.html">Hacking public services - you can, if you really need</a></li>
<li><a href="../435550/index.html">GitLab 11.6 released with serverless functions and Kubernetes clusters for groups</a></li>
<li><a href="../435552/index.html">Import Substitution - Epitaph from Digitalization</a></li>
<li><a href="../435556/index.html">Moving to the data center: how it was</a></li>
<li><a href="../435558/index.html">PostgreSQL testing with HugePages on Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>