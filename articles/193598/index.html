<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Once again about Deferred / Promise</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It so happened that the last few weeks very often I had to hear the words Promise and Deferred from different people. As a rule, these concepts are us...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Once again about Deferred / Promise</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/3df/09f/5ef/3df09f5ef275490e6a594e023d0a7ec8.jpg" alt="Deferred" align="left">  It so happened that the last few weeks very often I had to hear the words <b>Promise</b> and <b>Deferred</b> from different people.  As a rule, these concepts are used by developers that have already been seen, who are faced with certain tasks in their activities. <br><br>  As I can tell, for people who in practice have <i>not encountered</i> some specific problems, these 2 concepts are quite difficult to understand.  And not because the concepts of Promise and Deferred are complicated with something, but because it is rather difficult to invent a suitable task right away in order to try Deferred objects (in jQuery and not only) in action. <br><br>  Yes, probably for those who are familiar with this question, it will seem trivial and not worth it and the eaten away egg.  In addition, the issue has already been discussed many times.  However, I will have the courage to touch it again and here is why: <b>1)</b> It seems to me that this post may be interesting for some readers.  <b>2)</b> I will go from practice, not from theory.  My task is to demonstrate the operation of the tool.  The theory and other applications, if necessary, you will find in the links to the post. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Below I will try to show you that Promise and Deferred are very, very simple.  In addition, to explain this topic, I will have to touch on a few more interesting points in JavaScript. <br><br><a name="habracut"></a><br><br>  <b>What is a Deferred object?</b>  : this is a very simple way to catch the states of asynchronous events. <br>  <b>Why use them?</b>  : for example, to assign a common callback to several AJAX requests. <br>  <b>Where can this be used?</b>  : for example, you want to show a map on the page.  But only when received information about all the marks on it from an external source.  Suppose you load a page and a map (hidden) and show a preloader, at this point the browser sends 20 AJAX requests to your server and receives information.  And only after the completion of all requests you need to hide the preloader, show the map, markers and blocks of content.  This is how an abstract task can be formulated. <br><br>  Next, I will show examples in CoffeeScript (with JavaScript under the spoiler) and I should clarify some points regarding CoffeeScript. <br><br>  1) CoffeeScript is absolutely the same JavaScript, but with a cleaner and more concise syntax. <br>  2) <b>-&gt;</b> in CoffeeScript means <b>function () {}</b> in JavaScript <br>  3) <b>(a, b) -&gt;</b> in CoffeeScript means <b>function (a, b) {}</b> in JavaScript <br>  4) <b>do</b> in CoffeeScript means <b>()</b> in JavaScript.  Ie the function call, which name is specified after <b>do</b> <br>  5) <b>do (a, b) -&gt; "Hello World!"</b>  in CoffeeScript means <b>(function (a, b) {return "Hello World!";}) (a, b)</b> in JavaScript <br><br><h5>  Apply method </h5><br>  I am lazy and do not like to once again knock fingers on the keys.  Therefore, <b>console.log</b> I prefer to use just <b>log</b> .  This is easily achieved using the JS method <b>apply</b> . <br><br>  <b>What is the apply method?</b>  This is one of the Function methods (Function.apply).  So, it applies to all functions. <br>  <b>What does the apply method do?</b>  It is called from a function and therefore affects it.  <b>The first argument</b> sets the context of the function being called, i.e.  actually forcibly sets the value of <b>this</b> inside this function.  <b>The second argument</b> is an array of parameters for the function. <br>  <b>Where can this be used?</b>  Often in the description of functions you can see that it accepts a list of parameters <b>fn (x1, x2, x3, x4, ...)</b> as input, but by a strange coincidence you may have an array of variables and you would like to pass this array to a function in as a list, not as a single array variable.  This is exactly what the <b>apply</b> method <b>does</b> .  In essence, apply allows you to expand an array of variables into a function parameter list. <br><br>  Knowing that the array of all values ‚Äã‚Äãpassed to the function in JavaScript can be obtained through the <b>arguments</b> variable, let's make the following feint with our ears: <br><br><pre><code class="coffeescript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.log = <span class="hljs-function"><span class="hljs-function">-&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log.apply(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>, arguments)</code> </pre> <br><br><div class="spoiler">  <b class="spoiler_title">Js version</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.log = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log.apply(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (_error) {} };</code> </pre><br><br></div></div><br><br>  <b>What happened here?</b>  I created a <b>log</b> method in the global scope.  All the arguments that I get (arguments) when I call the <b>log</b> method I pass as a list to the <b>console.log</b> function (the apply method helps me).  In addition, in order not to violate the logic of the <b>console.log</b> method, I preferred to pass the <b>console</b> object as the first argument to the <i>apply</i> function.  For browsers that have problems with <b>console.log,</b> I use <b>try</b> to protect myself. <br><br><div class="spoiler">  <b class="spoiler_title">Some more sugar in Coffee</b> <div class="spoiler_text">  Put <b>...</b> after the arguments array and you will save yourself from specifying the context and manual writing apply.  This code is completely identical to the one presented above. <br><br><pre> <code class="coffeescript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.log = <span class="hljs-function"><span class="hljs-function">-&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log arguments...</code> </pre><br><br></div></div><br><br>  If this is all more or less clear, then move on.  By the way, I didn‚Äôt just remember how to <b>apply</b> - it is still useful to us. <br><br><h5>  Step 1. Classical problem </h5><br>  To emulate 10 asynchronous requests, use the <b>setTimeout method</b> .  When performing, he breaks away from the main stream of performance and "lives his life."  So we found a great option to test the operation of Deferred objects. <br><br>  Let's make a simple loop and run setTimeout 10 times and prologue the <b>index</b> variable. <br><br><pre> <code class="coffeescript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.10</span></span>] setTimeout -&gt; log index , <span class="hljs-number"><span class="hljs-number">1000</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Js version</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index, _i; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (index = _i = <span class="hljs-number"><span class="hljs-number">0</span></span>; _i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; index = ++_i) { setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> log(index); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); }</code> </pre><br></div></div><br><br>  Exactly in a second, we will receive not the numbers <b>"0 1 2 3 4 5 6 7 8 9"</b> , but <b>"10 10 10 10 10 10 10 10 10 10"</b> . <br>  This happened because by the time the code inside <b>setTimeout is</b> executed, the cycle is already over (it will work very quickly), and the <b>index</b> counter at this point will take the extreme value and will be equal to 10. <br><br><h5>  Step 2. The classic solution </h5><br>  In order to solve the above problem, you simply wrap the executable code in a function and call it, passing the current value of the counter.  Voila!  In a coffeescript, these actions are quite elegant. <br><br><pre> <code class="coffeescript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.10</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> (index) -&gt; setTimeout -&gt; log index , <span class="hljs-number"><span class="hljs-number">1000</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Js version</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index, _fn, _i; _fn = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> log(index); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (index = _i = <span class="hljs-number"><span class="hljs-number">0</span></span>; _i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; index = ++_i) { _fn(index); }</code> </pre><br></div></div><br><br><h5>  Step 3. How does deferred work? </h5><br>  A deferred object is just a repository for the state of an asynchronous function.  There are usually several such conditions: <br><br>  - <b>pending</b> - waiting for completion of the process <br>  - <b>rejected</b> - the process is completed by dropping <br>  - <b>resolved</b> - process completed successfully <br><br>  In addition, the Deferred object has a number of methods that can change its state.  For example, the <b>.resolve ()</b> method. <br><br>  By the state of the Deferred object, we can judge whether the process whose state we are monitoring is complete. <br><br>  From this we can conclude that in order to use the Deferred object, we must: <br><br>  <b>1)</b> create a Deferred object <br>  <b>2)</b> When completing the asynchronous method, transfer the Deferred object to the desired state <br>  <b>3)</b> Send the Deferred object from the current function to somewhere where its status will be monitored. <br><br>  Below you see the code that illustrates this.  I leave a detailed analysis to the interested reader.  About <b>return dfd.promise ()</b> read immediately after the sample code. <br><br><pre> <code class="coffeescript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.10</span></span>] promise = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> (index) -&gt; dfd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $.Deferred() setTimeout -&gt; log index dfd.resolve() , <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dfd.promise()</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Js version</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index, promise, _i; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (index = _i = <span class="hljs-number"><span class="hljs-number">0</span></span>; _i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; index = ++_i) { promise = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dfd; dfd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $.Deferred(); setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ log(index); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dfd.resolve(); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dfd.promise(); })(index); }</code> </pre><br></div></div><br><br>  You should definitely pay attention to the <b>return dfd.promise ()</b> string.  And for sure you will ask a reasonable question: ‚Äúwhy, when returning from a function, it is not the Deferred object itself that is transferred, namely the <b>Promise</b> ?‚Äù.  The bottom line is that when transferring a Deferred object to the outside, you must exclude from it all methods that can change its state.  Since nowhere, except for the strictly specified allowed area, a Deferred object should not be able to change its state.  Otherwise, the final developer may not resist the temptation and break the given pattern.  <b>Promise</b> is exactly what is involved in returning a reduced copy of Deferred. <br><br><h5>  Step 4. We form an array of "promises" </h5><br>  If we need to wait for 10 asynchronous functions to be executed, we will simply form an array of ‚Äúpromises‚Äù (apparently promises to finish our execution once), which are formed in the functions inside the loop.  And so, we create an empty array and enter into it a new ‚Äúpromise‚Äù at each iteration. <br><br><pre> <code class="coffeescript hljs">promises_ary = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.10</span></span>] promise = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> (index) -&gt; dfd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $.Deferred() setTimeout -&gt; log index dfd.resolve() , <span class="hljs-number"><span class="hljs-number">1000</span></span> dfd.promise() promises_ary.push promise log promises_ary</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Js version</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index, promise, promises_ary, _i; promises_ary = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (index = _i = <span class="hljs-number"><span class="hljs-number">0</span></span>; _i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; index = ++_i) { promise = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dfd; dfd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $.Deferred(); setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ log(index); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dfd.resolve(); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dfd.promise(); })(index); promises_ary.push(promise); } log(promises_ary);</code> </pre><br></div></div><br>  As a result, <b>log</b> will show us a list of objects. <br><br><pre> <code class="javascript hljs"># =&gt; [obj, obj, ...]</code> </pre><br><br><h5>  Step 5. Use the array of "promises" </h5><br>  And now it is very simple to hang up a callback, which will be called only after the execution of all asynchronous functions.  To do this, we need the jQuery method <b>$ .when</b> .  The <b>$ .when</b> documentation is described as a method that accepts a parameter list for input.  However, we have an input array of <b>promises_ary</b> parameters.  As it is not difficult to guess, we again use the <b>apply</b> method. <br><br><pre> <code class="coffeescript hljs">promises_ary = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.10</span></span>] promise = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> (index) -&gt; dfd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $.Deferred() setTimeout -&gt; log index dfd.resolve() , <span class="hljs-number"><span class="hljs-number">1000</span></span> dfd.promise() promises_ary.push promise $.<span class="hljs-keyword"><span class="hljs-keyword">when</span></span>.apply($, promises_ary).done -&gt; log <span class="hljs-string"><span class="hljs-string">'Promises Ary is Done'</span></span></code> </pre><br><br><h5>  Step 6. A bit of randomness </h5><br>  In the end, of course, you should add a bit of ‚Äúrandomness‚Äù to our setTimeout function.  Let's make a simple <s>helper</s> method that will return random numbers and will execute the code inside setTimeout with a random delay. <br><br><pre> <code class="coffeescript hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rand</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(min, max)</span></span></span><span class="hljs-function"> -&gt;</span></span> Math.floor(Math.random() * (max - min + <span class="hljs-number"><span class="hljs-number">1</span></span>) + min) promises_ary = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.10</span></span>] promise = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> (index) -&gt; dfd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $.Deferred() setTimeout -&gt; log index dfd.resolve() , rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>) * <span class="hljs-number"><span class="hljs-number">1000</span></span> dfd.promise() promises_ary.push promise $.<span class="hljs-keyword"><span class="hljs-keyword">when</span></span>.apply($, promises_ary).done -&gt; log <span class="hljs-string"><span class="hljs-string">'Promises Ary is Done'</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Js version</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index, promise, promises_ary, _i; rand = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">min, max</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * (max - min + <span class="hljs-number"><span class="hljs-number">1</span></span>) + min); }; promises_ary = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (index = _i = <span class="hljs-number"><span class="hljs-number">0</span></span>; _i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; index = ++_i) { promise = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dfd; dfd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $.Deferred(); setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ log(index); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dfd.resolve(); }, rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>) * <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dfd.promise(); })(index); promises_ary.push(promise); } $.when.apply($, promises_ary).done(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> log(<span class="hljs-string"><span class="hljs-string">'Promises Ary is Done'</span></span>); });</code> </pre><br></div></div><br><br>  In conclusion, it should be said that all AJAX requests in jQuery from version 1.5 use the Deferred / Promise mechanism, so working with them is even easier. <br><br>  I will stop at this.  The basic example with explanations, in my opinion, is completed.  I think this will be enough to continue a deeper study of Deferred / Promise equipment from other sources.  I hope this post once will help someone. <br><br><ol><li>  <a href="http://api.jquery.com/category/deferred-object/">Deferred Object (JQuery official)</a> </li><li>  <a href="http://habrahabr.ru/post/113073/">jQuery Deferred Object (Habr)</a> </li><li>  <a href="http://habrahabr.ru/post/112960/">Using Deferred Objects in jQuery 1.5 (Habr)</a> </li><li>  <a href="http://wiki.commonjs.org/wiki/Promises">CommonJS Promises</a> </li><li>  <a href="">AngularJS (promise / deferred)</a> </li><li>  <a href="http://habrahabr.ru/post/183008/">Deferred objects in AngularJS</a> </li><li>  <a href="http://habrahabr.ru/post/189084/">Promises in AngularJS</a> </li><li>  <a href="https://github.com/CodeCatalyst/promise-as3">Promises for ActionScript 3.0</a> </li><li>  <a href="http://jquery.page2page.ru/index.php5/%25D0%259E%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582_deferred">Object deferred</a> </li></ol><br><br>  <i>Question for discussion:</i> Often it is necessary to meet the statement that Deferred can be used not only together with asynchronous functions, but also with synchronous ones.  At the moment I have not met the tasks where it can be useful.  If you have a similar practice, it would be interesting to learn about it. <br><br>  <i>Question for discussion:</i> It would be interesting to know about the tasks where you used Deferred / Promises. </div><p>Source: <a href="https://habr.com/ru/post/193598/">https://habr.com/ru/post/193598/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../193584/index.html">Ethics (or unethical) massive government surveillance</a></li>
<li><a href="../193586/index.html">Implementation of the voice menu on perl via usb modem Huawei e1550</a></li>
<li><a href="../193588/index.html">Protect the Internet, or Hands off, cursed NSA, from the brainchild of the military-industrial complex!</a></li>
<li><a href="../193592/index.html">What is silent Gantt chart or why projects are always late</a></li>
<li><a href="../193594/index.html">Report from the hacker tournament and security conference with Mitnick</a></li>
<li><a href="../193600/index.html">What kids think about programmers and programming</a></li>
<li><a href="../193606/index.html">"Achtung!", Or Monitor the status of the project assembly</a></li>
<li><a href="../193608/index.html">Congratulations on the Day of the programmer!</a></li>
<li><a href="../193610/index.html">Board game teaching children programming</a></li>
<li><a href="../193612/index.html">Happy programmer!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>