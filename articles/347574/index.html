<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We use Apple Pay and Troika card as a pass to work</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR. The article describes the process of creating an access control system (ACS), in which three cards, any contactless EMV bank cards, as well as...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We use Apple Pay and Troika card as a pass to work</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/nn/al/u9/nnalu9dnujtv9szmsqw33qgof70.png" alt="We use Apple Pay, Android Pay, Mastercard Paypass, Visa PayWave and Troika card as a pass to work"><br><br>  <b>TL; DR.</b> The article describes the process of creating an access control system (ACS), in which three cards, any contactless EMV bank cards, as well as Apple Pay and Android Pay phones can be used as an identifier.  The system is controlled via Telegram-bot. <br><br><h4>  The main tasks of the system </h4><br><ul><li>  <b>Get rid of unnecessary cards</b> - as an identifier is used that which the user already has: a transport card, phone or bank card.  Which ID to use - everyone chooses.  The system works with all types of identifiers simultaneously. </li><li>  <b>Get rid of the pass office and complex management programs</b> - we are tired of issuing and collecting cards from users, keeping separate computers for managing passes, studying advanced programs. </li><li>  <b>Management through Telegram</b> - establishment and deletion of users occurs remotely and does not require a computer. </li></ul><a name="habracut"></a><br><h2>  Please do not need more cards! </h2><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/im/x5/j1/imx5j1sci8ml-89qidz1_w8tdow.png" alt="Wallet swollen from cards"></div><br>  <font color="99999">- Do you already have our card?</font> <font color="99999"><br></font>  <font color="99999">- have mercy ...</font> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now everyone wants to give you his card: shops, fitness clubs, parking lots, business centers, VIP-discount-points-savings.  It is humiliating to offer a person to carry another card with them.  And given that the <a href="https://ru.wikipedia.org/wiki/EM-4100">EM-Marine</a> (125kHz) standard cards, which are popular in access control systems in the CIS, are three times thicker than the usual ISO 7810 - this is triple humiliating. <br>  Therefore, the first requirement for our system is <b>no additional cards</b> . <br><br><div style="text-align:center;"><img width="500" alt="Comparison of EM4100 EM-Marine and ISO7810 card thickness" src="https://habrastorage.org/webt/lz/vm/bz/lzvmbzhyl4zvgpsp59lflocfax4.png"></div><br>  <font color="99999">Em-Marine and ISO7810 card thickness comparison</font> <br><br>  In addition to physical dimensions, EM-Marine cards are technologically backward.  Such a card can be easily cloned from a distance of half a meter straight from the pocket of a passerby. <br><br>  Demo video: <a href="https://www.youtube.com/watch%3Fv%3DqvIIUny4EWI">www.youtube.com/watch?v=qvIIUny4EWI</a> <br>  <i>The video shows the reading of a thin em4100 card from a distance of 50cm, thick cards are read from a greater distance.</i> <i><br></i> <br><h2>  All access control uncomfortable </h2><br>  All existing access control systems, in our opinion, are too complicated and inconvenient.  They require the issuance of individual cards, installation of programs, staff training, memorizing the sequence of actions with master cards, etc. <br><br>  In some cases, complex access control systems are necessary: ‚Äã‚Äãin large buildings with multiple access zones, turnstiles, security guards, temporary passes. <br><br>  In cases where you need to control access to one or two doors, such complications are not justified.  Even the content of a separate computer with a program for access control is a bust for us. <br><br>  We do not have separate employees engaged in the issue of passes, there is no temporary passes and security.  System administration should be so simple that any new person can quickly master it without instructions.  Since the person responsible for the access control system may not be in place, system management must be remote. <br><br><h2>  Card "Troika" as an identifier </h2><br>  The Troika card is a rechargeable card for the fare payment on all types of Moscow public transport.  This is the most profitable and convenient way to pay for public transport and some urban services: a planetarium, a skating rink, zoos, the Tretyakov Gallery, parking.  Therefore, the "Troika" is in every Muscovite, who regularly uses public transport.  You can purchase a card at the cash desks of the metro for ‚âà $ 1. <br><br>  Technically, the card is based on the Mifare Plus chip operating in SL1 mode - Mifare Classic 1K emulation mode.  On the back of the card is a 10-digit number that is used to remotely recharge the card‚Äôs balance.  This number is convenient to use as an identifier in the access control system. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ux/ay/mm/uxaymm4sr7dooxbxo_n1taf-ari.png"></div><br>  <font color="grey">The ‚ÄúTroika‚Äù card number is recorded in the card's memory in the 32nd block of the 8th sector.</font>  <font color="grey">To read a protected area of ‚Äã‚Äãmemory, a six-byte key is needed, which has not been so secret for a long time.</font> <br><br>  The ‚ÄúThree‚Äù card number (not to be confused with the chip's UID) is stored in protected memory in block 32 from the second byte to the lower four bits of the seventh byte.  To read this area of ‚Äã‚Äãmemory, an A-key for sector 8 is needed. These keys are not a secret for a long time and are easily found on the Internet along with a detailed description of the data storage format.  Since we are not going to record any data on the card, we only need key <b>A</b> to read the necessary sector. <br><br>  Thus, to add a new pass to the database, it is enough to visually read the card number and inform the administrator.  This can even be done remotely. <br><blockquote>  Security issues of this approach are discussed in the FAQ at the end of the article.  Code samples for reading the Troika card number using the Arduino are in the ‚ÄúFirst prototype‚Äù chapter. </blockquote>  In St. Petersburg, there is a similar card "Plantain."  If necessary, it can also be used as an identifier, simultaneously with the Troika card. <br><br><h2>  Apple / Android Pay and Bank Cards </h2><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/q-/yk/k0/q-ykk0xyb30tizfjebfld97x6bw.png" alt="Apple Pay, Android Pay, Samsung Pay, Visa PayWave, Mastercard PayPass are all commercial names of payment instruments that use the same EMV Contactless Specifications protocol."></div><br>  <font color="99999">Payment instruments with different names work on the same EMV protocol</font> <br><br>  All payment instruments shown in the picture above work on the same EMV protocol, freely available on <a href="https://www.emvco.com/">EMVco.com</a> .  Therefore, by saying "EMV-card", we will simultaneously mean Apple Pay, Android Pay, Samsung Pay, Visa PayWave, MasterCard PayPass. <br><blockquote>  There is a misconception that the POS terminal should separately support Apple / Android Pay, so users prefer to look at the checkout for a special icon to be sure that their payment tool is supported.  In fact, almost everywhere where contactless payment is supported, any device will work. </blockquote>  Contactless EMV cards (and contact cards too) allow you to read the data indicated below without authorization, that is, without entering a PIN code.  In the last chapter, we will look at why it is safe enough. <br><br><pre><code class="hljs axapta"><span class="hljs-comment"><span class="hljs-comment">//   (  )</span></span>
Cardholder Name:  IVAN IVANOV 

<span class="hljs-comment"><span class="hljs-comment">//  ,    </span></span>
PAN:  <span class="hljs-number"><span class="hljs-number">4556</span></span> <span class="hljs-number"><span class="hljs-number">5386</span></span> <span class="hljs-number"><span class="hljs-number">2774</span></span> <span class="hljs-number"><span class="hljs-number">0649</span></span> 

<span class="hljs-comment"><span class="hljs-comment">//  </span></span>
Expiry <span class="hljs-keyword"><span class="hljs-keyword">date</span></span>:  <span class="hljs-number"><span class="hljs-number">08</span></span>/<span class="hljs-number"><span class="hljs-number">2019</span></span> 

<span class="hljs-comment"><span class="hljs-comment">//  track 1    (  )</span></span>
Track <span class="hljs-number"><span class="hljs-number">1</span></span>:  .... 

<span class="hljs-comment"><span class="hljs-comment">//  track 2   </span></span>
Track <span class="hljs-number"><span class="hljs-number">2</span></span>:  <span class="hljs-number"><span class="hljs-number">4556538627740649.</span></span>.... 

<span class="hljs-comment"><span class="hljs-comment">//     .  ,  .</span></span>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span>
Paylog:  ........... 
</code></pre><br>
     Cardholder Name   ,  PAN ( )  .          .<br>
<br>
  PAN          .     ,     10    .  ,      ,     . <br>
<br>
 ,           10 ,       ,   EMV-.<br>
<br>
<h4> EMV-  </h4><br>
 EMV-   NFC-,    APDU-.       ,     Arduino  $3<br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed//X7WyPCG/embed?ref=https" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
   ,      EMV.   ‚Äî    EMV     Arduino  .<br>
<br>
<div class="spoiler"><b class="spoiler_title">      . ( )</b><div class="spoiler_text">  EMV    :<br>
<br>
<ul>
<li> <b><a href="https://www.aliexpress.com/item/PN532-NFC-RFID-Module-V3-Kits-Reader-Writer/32452824672.html">PN532 breakout board</a> + Arduino</b> ‚Äî pn532     Arduino  SPI.    pn532 ‚Äî 3.3V,    Arduino pro 3.3V,     .     EMV-   <a href="https://github.com/zhovner/Adafruit-PN532">   Adafruit PN532</a>, c    EMV-. </li>
<li><b><a href="https://www.aliexpress.com/item/PN532-NFC-RFID-Module-V3-Kits-Reader-Writer/32452824672.html">PN532 breakout board</a> + <a href="https://www.aliexpress.com/item/1pcs-CP2102-module-USB-to-TTL-serial-UART-STC-download-cable-PL2303-Super-Brush-line-upgrade/32694152202.html"> USB-TTL</a></b> ‚Äî  PN532    UART-       <a href="https://github.com/nfc-tools/libnfc">libnfc</a></li>
<li><b> PC/SC- </b> ‚Äî   ACR122U, HiD Omnikey   . </li>
<li><b>Android   NFC- </b>‚Äî   <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.github.devnied.emvnfccard%26hl%3Den">Credit Card Reader</a>   EMV- .    APDU-    .   100  (donate),    Log      APDU ,     .    <a href="https://github.com/devnied/EMV-NFC-Paycard-Enrollment">  Java</a>. </li>
</ul><br>
<blockquote>        EMV.   APDU <b>     EMVco</b>, -       . <br>
<br>
   EMV    ,  ,   ,   .</blockquote>  APDU-       .     PC/SC       ,    ..<br>
<br>
    <a href="http://www.infintuary.org/scs.php">SmartCard Scripter</a>,    PC/SC- HiD Omnikey.  SmartCard Scripter    pascal-      .    <a href="http://www.infintuary.org/scs_tut.php">infintuary.org/scs_tut.php</a> <br>
<br>
     APDU   ,   :<br>
<br>
<pre><code class="hljs delphi"><span class="hljs-comment"><span class="hljs-comment">//    UID </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>
  APDU(<span class="hljs-string"><span class="hljs-string">'FF CA 00 00 00'</span></span>);
<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code></pre><br>
<h4>  ‚Äî  SELECT (PPSE)</h4><br>
<font color="grey"> : <a href="https://www.emvco.com/wp-content/plugins/pmpro-customizations/oy-getfile.php%3Fu%3D/wp-content/uploads/documents/EMVCo_PPSE_and_Application_Mgmt_for_SE_v1.0-1.pdf">EMV Contactless Specifications ‚Äî PPSE and Application Management for Secure Element</a></font><br>
<br>
   EMV-      PPSE (Payment System Environment)  SELECT. <br>
<br>
<b>APDU- SELECT PPSE</b><br>
<pre><code class="cpp hljs"><span class="hljs-string"><span class="hljs-string">'00 A4 04 00 0E 32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 00'</span></span>
  <span class="hljs-number"><span class="hljs-number">00</span></span> A4 <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-comment"><span class="hljs-comment">//  select </span></span>
   <span class="hljs-number"><span class="hljs-number">0</span></span>E <span class="hljs-comment"><span class="hljs-comment">//  command data (14 )</span></span>
    <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> <span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>E <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>E <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">46</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-comment"><span class="hljs-comment">// command data 2PAY.SYS.DDF01</span></span>
    <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
</code></pre><br>
<h4>   ‚Äî SELECT AID</h4><br>
   SELECT PPSE    FCI (File Control Information)   ,   .    (VISA, MasterCard, AmericanExpress)     ,    .<br>
<br>
<b>  VISA  SELECT PPSE</b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-string"><span class="hljs-string">'6F 23 84 0E 32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 A5 11 BF 0C 0E 61 0C 4F 07 A0 00 00 00 03 10 10 87 01 01 90 00'</span></span></code></pre><br>
      -  TVL <a href="https://www.emvlab.org/tlvutils/">emvlab.org/tlvutils/</a>.     VISA,  :<br>
<br>
<img width="500" src="https://habrastorage.org/webt/zb/qv/uk/zbqvukz-qeklrmcbwio5fdgtcj4.png"><br>
<br>
         (AID).   ,   <b>A0000000031010</b>,  Visa International. <br>
<br>
AID   <b>4F</b>.       ,   .   ,   AID    5  16 ,      7 .     AID  ,     <b>4F 07</b>   7     AID.          ,   AID  ,       ,         ,   Visa  MasterCard.     PPSE-     :     <b>6F</b>,   <b>90 00</b>     <b>4F 07</b>,   .<br>
<br>
  AID: <a href="https://www.eftlab.co.uk/index.php/site-map/knowledge-base/211-emv-aid-rid-pix">eftlab.co.uk/knowledge-base/211-emv-aid-rid-pix</a><br>
<br>
  AID<br>
<br>
<pre><code class="hljs lisp">A0000000031010 Visa International
A0000000032020 Visa International
A0000000041010 Mastercard International
A0000000043060 Mastercard International United States Maestro (<span class="hljs-name"><span class="hljs-name">Debit</span></span>)
</code></pre><br>
  AID,     SELECT.       Visa International,     PPSE SELECT<br>
<br>
<b>APDU- SELECT AID</b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-string"><span class="hljs-string">'00 A4 04 00 07 A0 00 00 00 03 10 10'</span></span>
  <span class="hljs-number"><span class="hljs-number">00</span></span> A4 <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-comment"><span class="hljs-comment">//  select </span></span>
   <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-comment"><span class="hljs-comment">//  command data (7 )</span></span>
    A0 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-comment"><span class="hljs-comment">// AID Visa International</span></span>
</code></pre><br>
<h4> PDOL (Processing Options Data Object List)</h4><br>
           PDOL (Processing Options Data Object List).    POS- ‚Äî    , ,     , ,    ,   . <br>
<br>
 PDOL     .    PDOL ‚Äî  .    PDOL   : <a href="https://www.eftlab.co.uk/index.php/site-map/knowledge-base/145-emv-nfc-tags">eftlab.co.uk/index.php/site-map/knowledge-base/145-emv-nfc-tags</a>.<br>
   ,   PDOL   ,       ,   .    - ,  ‚Äî . <br>
<br>
   ,           PDOL. ,   PAN-   ,     POS-. ,       PAN-.     ,      PDOL.<br>
<br>
<b>     .   PDOL.</b> <br>
<br>
<pre><code class="cpp hljs"><span class="hljs-string"><span class="hljs-string">'6F 31 84 07 A0 00 00 00 03 10 10 A5 26 9F 38 18 9F 66 04 9F 02 06 9F 03 06 9F 1A 02 95 05 5F 2A 02 9A 03 9C 01 9F 37 04 BF 0C 08 9F 5A 05 60 08 40 06 43 90 00'</span></span>
</code></pre><br>
    <a href="https://www.emvlab.org/tlvutils/"></a>:<br>
<br>
<img width="500" src="https://habrastorage.org/webt/uc/uy/k0/ucuyk0u4gzsys5j9w7lses9m1aq.png"><br>
<br>
,   PDOL    <b>9F38</b>   <b>9F66049F02069F03069F1A0295055F2A029A039C019F3704</b>.  emvlab.org     PDOL,     Android- <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.github.devnied.emvnfccard%26hl%3Den">Credit Card Reader</a>.<br>
<br>
   ,    .    PDOL:<br>
<br>
<img width="600" src="https://habrastorage.org/webt/aj/ni/qh/ajniqhcynvgklbechfvingyvmk4.png"><br>
<br>
       ,    emvlab.org.         .<br>
<br>
  PDOL <br>
<br>
<pre><code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">9F</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-comment"><span class="hljs-comment">//   PDOL.  18 (24 ) </span></span>
 <span class="hljs-number"><span class="hljs-number">9F</span></span> <span class="hljs-number"><span class="hljs-number">66</span></span> ( <span class="hljs-number"><span class="hljs-number">04</span></span>) <span class="hljs-comment"><span class="hljs-comment">// Terminal Transaction Qualifiers (TTQ).    </span></span>
  <span class="hljs-number"><span class="hljs-number">9F</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span> ( <span class="hljs-number"><span class="hljs-number">06</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
   <span class="hljs-number"><span class="hljs-number">9F</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span> ( <span class="hljs-number"><span class="hljs-number">06</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
   <span class="hljs-number"><span class="hljs-number">9F</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>A ( <span class="hljs-number"><span class="hljs-number">02</span></span>) <span class="hljs-comment"><span class="hljs-comment">//     ISO3166-1</span></span>
   <span class="hljs-number"><span class="hljs-number">95</span></span> ( <span class="hljs-number"><span class="hljs-number">05</span></span>) <span class="hljs-comment"><span class="hljs-comment">// Terminal Verification Results</span></span>
    <span class="hljs-number"><span class="hljs-number">5F</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>A ( <span class="hljs-number"><span class="hljs-number">02</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  ,    ,   ISO4217</span></span>
     <span class="hljs-number"><span class="hljs-number">9</span></span>A ( <span class="hljs-number"><span class="hljs-number">03</span></span>) <span class="hljs-comment"><span class="hljs-comment">//    YYMMDD</span></span>
      <span class="hljs-number"><span class="hljs-number">9</span></span>C ( <span class="hljs-number"><span class="hljs-number">01</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
       <span class="hljs-number"><span class="hljs-number">9F</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span> ( <span class="hljs-number"><span class="hljs-number">04</span></span>) <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
</code></pre><br>
      PDOL    <a href="https://www.emvco.com/emv-technologies/contactless/">EMV Contactless Specifications Book C-1/2/3 Kernel 1/2/3 Specification.</a><br>
<br>
    PDOL    ,    ,    ,      PDOL.      (   ),  33 .      PDOL   33 . <br>
<br>
        ,   ‚Äî       PDOL,   .      ,    <b>6985 Conditions of use not satisfied</b>.<br>
<br>
   ,      PDOL   ,  Terminal Transaction Qualifiers (TTQ).    VISA,      ,     VCPS 2.1.1.     TTQ   : <br>
<br>
<pre><code class="cpp hljs"><span class="hljs-string"><span class="hljs-string">'F0 00 00 00'</span></span>
</code></pre><br>
    TTQ <a href="https://www.eftlab.co.uk/index.php/site-map/our-articles/161-the-use-of-ctqs-and-ttqs-in-nfc-transactions"></a>.<br>
<br>
 MasterCard,    ,   PDOL   PAN-     PDOL.<br>
<br>
    <b>      PDOL</b>:<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-string"><span class="hljs-string">'80A80000238321F0000000000000000000000000000000000000000000000000000000000000000000'</span></span>
 <span class="hljs-number"><span class="hljs-number">80</span></span> A8 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-comment"><span class="hljs-comment">//  GET PROCESSING OPTIONS (GPO)</span></span>
  <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-comment"><span class="hljs-comment">//    (35 )</span></span>
   <span class="hljs-number"><span class="hljs-number">83</span></span> <span class="hljs-comment"><span class="hljs-comment">//  PDOL-</span></span>
    <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-comment"><span class="hljs-comment">//  PDOL- (33 )</span></span>
     F0 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-comment"><span class="hljs-comment">// Terminal Transaction Qualifiers (TTQ)</span></span>
      <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
       <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
        <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
         <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-comment"><span class="hljs-comment">// Terminal Verification Results (TVR)</span></span>
          <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-comment"><span class="hljs-comment">// </span></span>
           <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
            <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
             <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
</code></pre><br>
    ,   ,    <b>77</b>   SW2=9000.       PAN-,     . ()<br>
<br>
<h4> PAN- </h4><br>
        EMV,        ,    ,              ,  PAN-. <br>
<br>
PAN-     :<br>
<br>
<ul>
<li><b><a href="https://www.emvlab.org/emvtags/show/t57/">Track 2 Equivalent Data</a></b> ‚Äî  <b>57</b>.     0  19 ,     13 (19 ).       <b>57 13</b>.  8    PAN-.</li>
<li><b><a href="https://www.emvlab.org/emvtags/show/t5A/">Application Primary Account Number (PAN)</a></b> ‚Äî  <b>5A</b>.    8 ,       5A 08.   PAN .</li>
<li><b>Track 2 Data</b> ‚Äî  <b>9F 6B" ‚Äî </b>.   13 .  PAN    .</li>
</ul><br>
APDU- (   ? ,  )<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-string"><span class="hljs-string">'00 b2 01 1c 00'</span></span>
<span class="hljs-string"><span class="hljs-string">'00 b2 01 0c 00'</span></span>
<span class="hljs-string"><span class="hljs-string">'00 b2 02 0c 00'</span></span>
<span class="hljs-string"><span class="hljs-string">'00 b2 01 14 00'</span></span>
<span class="hljs-string"><span class="hljs-string">'00 b2 02 14 00'</span></span>
<span class="hljs-string"><span class="hljs-string">'00 b2 04 14 00'</span></span>
</code></pre><br>
       <b>57 13</b>  <b>5A 08</b>.  8           <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC_%25D0%259B%25D1%2583%25D0%25BD%25D0%25B0"> </a>.<br>
<br>
  ,     . <br>
<br>
      PAN-     -<br>
<br>
<img src="https://habrastorage.org/webt/gp/1d/n5/gp1dn5p-hdrdeh7fnvi9bt-78tu.png"><br>
<br>
</div></div><br>
<h2> </h2><br>
       10- ,         PAN-  ,     ¬´¬ª.    ,            ,  ,  . <br>
<br>
       ,     10- .        ,     .<br>
<br>
      Arduino + PN532 breakout board.<br>
    : <a href="https://www.youtube.com/watch%3Fv%3DaXNvjuRrCQk">www.youtube.com/watch?v=aXNvjuRrCQk</a><br>
<br>
  Arduino,   ,  : <a href="https://github.com/zhovner/Adafruit-PN532">github.com/zhovner/Adafruit-PN532</a>,   <i>examples/ApplePay_Troyka_ACS</i><br>
   ,      PDOL, -    EMV-   .           .<br>
<br>
<h2> Parsec</h2><br>
          arduino  raspberry pi,        .<br>
<br>
             ,    ,       ,         . <br>
<br>
 ,     ,  <a href="https://www.parsec.ru/">Parsec.ru</a><br>
           <a href="https://www.parsec.ru/special-solutions/pn3pnr-p03e/">PNR-P03E</a>.<br>
<br>
<img src="https://habrastorage.org/webt/s6/jc/9w/s6jc9wvbroy6b7lrjfewn4qnqvm.png"><br>
<font color="grey">Parsec PNR-P03E       </font><br>
<br>
 RFID-,    ,     .  Mifare, HiD iClass  ..<br>
<br>
  ,       ,      EMV-. <br>
<br>
<h4>   PNR-P03E</h4><br>
<ul>
<li><b>   </b> ‚Äî          ,       EMV, ¬´¬ª   .       .</li>
<li><b>    </b> ‚Äî          : Wiegand  26  58 , OSDP (RS-485, RS-232), Touch memory (I-Button)     Parsec</li>
<li><b>  </b> ‚Äî    ,           </li>
<li><b>SDK  </b> ‚Äî          </li>
</ul><br>
-,   .    ,       Wiegand. <br>
<br>
<div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/oz/ba/hx/ozbahxhfu7kkah65558vpknjp2k.png"></div><br>
          .      ,   .           . <br>
<br>
<h2> </h2><br>
 ‚Äî  ,       .        ,  ,   ,   . <br>
<br>
            .               ,     API    Telegram-. <br>
<br>
     ,          <a href="https://habrahabr.ru/company/intems/blog/316728/">¬´     ¬ª</a>.    <a href="https://habrahabr.ru/users/rgmih/" class="user_link">rgmih</a> ,       . <br>
<br>
       <a href="http://www.itrium.ru/"></a>.<br>
<br>
<img src="https://habrastorage.org/webt/da/je/q6/dajeq6xnhvlidhd7my3bqbu579o.png"><br>
‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ<font color="grey">     </font><br>
<br>
    Linux   ARM-.<br>
<br>
  ,       :<br>
<br>
<ul>
<li><b> </b> ‚Äî     .         .     SD-.      .</li>
<li><b>Web   REST API</b> ‚Äî         Telegram-  API.    .</li>
<li><b>  Ethernet</b> ‚Äî    IP-.     2 .</li>
<li><b>    64 </b> ‚Äî        .        .</li>
</ul><br>
   ,          Wiegand.         ,        . <br>
<br>
 ,                .        . <br>
<br>
  ,      ,         ,    .<br>
<br>
<h3> </h3><br>
    c  Ethernet-.      IP- .   ,  ,  . <br>
<br>
     ¬´ ¬ª.      ,          .<br>
<br>
<img src="https://habrastorage.org/webt/ia/rf/lh/iarflhxhnauwl7joz9a2pyoxbry.gif"><br>
‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ<font color="grey">    -  </font><br>
<br>
-             ,     .       ,     ,       ,       .<br>
<br>
<h2>   Telegram</h2><br>
      ,   - ,    Telegram ,     / .        REST API.<br>
<br>
<div style="text-align:center;"><img alt="   Telegram-" width="400" src="https://habrastorage.org/webt/gk/dt/lr/gkdtlr_duefkzmfkrndq7mn0mii.png"></div><br>
‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ‚ÄÄ<font color="grey">   Telegram-.</font><br>
<h2>FAQ</h2><br>
            ,      .    :<br>
<br>
<ul>
<li><b>  ,  ?</b><br>
,       ,   ,         .        .     -    .</li>
<li><b>    ¬´¬ª    !</b><br>
,  .         .         (  Android c NFC  ),           Mifare.    ,     ,         . ,           EM-Marine,           -  ,          ÃÅ .</li>
<li><b>        .</b><br>
   .  EMV          ¬´ EMV   ¬ª.  ,   :      -,        . - (  )       .     , POS-       ,   .         POS-.    -,   .      ,        ,   ,        ‚Äî . </li>
<li><b>      ,   ,     .</b><br>
,  .   ,   ,   . CVV-    .  , ,   Apple Pay       .     ,   ,      ,      ¬´¬ª.<br>
</li>
<li><b>   EMV    .</b><br>
  ,         EMV .     <a href="https://github.com/emsec/ChameleonMini">ChameleonMini</a>,     .   <a href="https://developer.android.com/guide/topics/connectivity/nfc/hce.html">Android Host-based Card Emulation</a>,         Android .           ,     . <br>
</li>
</ul><br>
<hr><br>
 ,      :<br>
<br>
   ‚Äî <a href="https://vk.com/aquamine">aquamine</a><br>
    ‚Äî <a href="https://habrahabr.ru/users/valdikss/" class="user_link">ValdikSS</a> <br>
 Telegram  ‚Äî <a href="http://targence.com/">Alexey Tsverov</a><br>
   ‚Äî  <a href="https://parsec.ru/">Parsec</a>    <br>
    ‚Äî  <a href="http://www.itrium.ru/"></a>    <a href="https://habrahabr.ru/users/rgmih/" class="user_link">rgmih</a> </div><p>Source: <a href="https://habr.com/ru/post/347574/">https://habr.com/ru/post/347574/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347558/index.html">Script to delete universal Windows Store apps</a></li>
<li><a href="../347562/index.html">Announcement of ElixirLangMoscow Meetup # 7</a></li>
<li><a href="../347564/index.html">Xception: compact deep neural network</a></li>
<li><a href="../347570/index.html">Again about services for ICO: read and be terrified</a></li>
<li><a href="../347572/index.html">The story of how two graduates of "mathex" made the first sales</a></li>
<li><a href="../347576/index.html">Object in a case or Optional in Java 8 and Java 9. Part 2: ‚ÄúHow it is done in Java 8‚Äù</a></li>
<li><a href="../347578/index.html">‚ÄúWhen you tell a true story, they believe it much more‚Äù - Interview with Oleg Shelaev, part 2</a></li>
<li><a href="../347580/index.html">On Lee effect waves: Pitonizing DAF generation</a></li>
<li><a href="../347582/index.html">Personal experience: how we transferred the infrastructure from one data center to the US to another</a></li>
<li><a href="../347584/index.html">Disable triggers in ZABBIX on schedule</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>