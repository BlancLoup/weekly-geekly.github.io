<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DZ Online Tech: Postgres Professional</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hey. 

 Last year, I began filming a series of programs / interviews on the subject of digital business transformation ( they are here, who are intere...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DZ Online Tech: Postgres Professional</h1><div class="post__text post__text-html js-mediator-article">  Hey. <br><br>  Last year, I began filming a series of programs / interviews on the subject of digital business transformation ( <a href="https://www.youtube.com/channel/UCJuwCFeP6rhSUqk9gRMAwuw">they are here, who are interested - sign up</a> ).  These programs were at the junction of IT and business, but, nevertheless, more about business. <br><br>  In the process, it became clear that there are quite a few topics that have significant depth from a programming point of view.  And this year we started shooting a series of interviews under the general label ‚ÄúDZ Online Tech‚Äù - now with an emphasis on what is under the hood.  Well, since everyone is too lazy to watch the video, of course, these interviews are decrypted, and today I publish the first one - with Ivan Panchenko from Postgres Professional. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Who is interested in the original - here it is: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/YmePVl2FCcM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  (Well, by the way, I can‚Äôt swear that all issues will be decrypted, so if you like it - subscribe to YouTube, everything comes back earlier and guaranteed.) <br><br>  <u>For those who like to read - decoding:</u> <br><a name="habracut"></a><br>  <b>Good afternoon, Ivan.</b>  <b>Postgres is massively perceived as an import substitution tool.</b>  <b>And the most famous driver of its use is the idea of ‚Äã‚Äã‚Äúlet's replace some Western DBMS with Postgres‚Äù.</b>  <b>It is known that he has a lot of his own values.</b>  <b>I would like to take a quick look at them.</b>  <b>If we choose, without looking ‚Äúimport - not import‚Äù, but from a clean slate - why is that so?</b> <br><br>  Good day.  First, most Postgres chooses not because of import substitution.  It is clear that there are indeed government measures that restrict the import of foreign software.  Postgres Pro is in the registry, so it is suitable for import substitution.  In fact, this is a global trend to increasingly choose Postgres.  We see only its reflection.  Perhaps, what we have expressed in import substitution is, in fact, a consequence of some deeper, fundamental processes. <br><br>  Postgres ripened.  This is a good alternative to older commercial databases.  All over the world, they now realize that Postgres is a product of the same class as whales: Oracle, Microsoft SQL Server and DB2, the last of which is almost forgotten, but nevertheless, it is a good product. <br><br>  But, anyway, DB2 is gradually floating somewhere out of the market, and Oracle, Microsoft SQL is on it.  And Postgres is the third thing that now globally flows into the market.  I must say that it has been floating for a long time - 10 years ago, when good support for Windows appeared in Postgres.  When replication appeared in it, they began to perceive it;  they started talking about him as a database for business, industry and something serious. <br><br>  <b>Now you still say in the picture "there were two good ones, there is one more good one".</b>  <b>But for sure there are things that put him ahead and make him prefer to rest.</b> <br><br>  Yes, there are several such things.  First, Postgres is an open source product with a specific license.  At the same time, he has commercial clones.  One of them is ours.  But the fact that it comes from an open source product is in itself a big advantage. <br><br>  The second topic is that Postgres is a highly extensible database.  This was also the driver of its development. <br><br>  It must be said that the degree of extensibility of Postgres is the place where our Russian contribution is most noticeable.  The last 15-17 years, our team is mainly engaged in the mechanisms of extensibility. <br><br>  For example, in Rambler in 2000, where I first worked together with my current colleagues in the company, we used the extensibility of Postgres to increase the performance of the Rambler news service 30 times.  How?  We are programmers who are fluent in C and can read documentation.  These two things allowed us to create a new type of index to quickly search through arrays, which goes beyond the classical relational model, but is useful. <br><br>  In particular, in Rambler, replacing an extra join (join) with an array in which you can search by a tricky index increased performance 30 times.  It is necessary to understand that then all the Rambler content projects were spinning on typewriters, whose power did not exceed the capacity of a modern smartphone: Pentium 2, 400 MHz, 500 MB of memory.  If you're lucky, the Pentium 3 (it appeared then) up to 800 MHz.  Such Pentium 3 could be 2 pieces in the server.  And all this served millions of requests. <br><br>  It is clear that then it was necessary to very seriously optimize the code, otherwise it would all not work.  Postgres extensibility helped.  We sat, thought, and within a reasonable time, we can say for a month, did what then formed the basis of everything that now exists in Postgres related to JSON with full-text search. <br><br>  Because of this, Postgres quickly added support for semi-structured data.  What it is?  These are key values, roughly speaking.  In 2004, we made an extension of the Hstore in Postgres to store key-value type information inside a single database field.  Then it was not JSON, it went into fashion later.  And then there was Hstore.  Why hstore?  We looked at Perl, which hash (hash), and here we have a hash with almost the same syntax made in Postgres. <br><br>  Initially, this thing existed as a separate extension (extension), then it was committed to the main set of what is included in Postgres.  And she was just as popular.  That is, JSON has skirted it in popularity just recently. <br><br>  <b>It turns out that you in a certain sense put an end to this stupid discussion of SQL and noSQL, creating a DBMS that possesses the properties of both of them at the same time.</b> <br><br>  In a sense, yes.  From noSQL, we took the good, namely, the relative flexibility, without loss of transactionality, without loss of data integrity and everything that usually happens in normal DBMS. <br><br>  So, Hstore.  But Hstore was single level.  That is a one-level hash.  This is not JSON, just a hash.  And plus the arrays in Postgres came before us.  We made support for the indices, that is, we could quickly search by what is in the arrays, and by what lies inside Hstore, both by keys and by values.  This is a useful thing.  People began to use it around the world.  Then came JSON.  He appeared recently, the year in 2011-2012 in Postgres.  There were three different attempts to implement it.  Then all these attempts were thrown out, and made in another way.  At the beginning, JSON was simply a text that lies in a special field. <br><br>  <b>Did your team do json?</b> <br><br>  No, our team did an important thing for JSON.  When JSON appeared in Postgres, it was just a text field, and in order to extract something from there, some search value had to parse JSON every time.  Of course, it worked slowly, but allowed to store multi-level data. <br><br>  But in this text box there is little sense.  I, for example, in my projects and so kept weakly structured data in text fields, simply without naming it a field of a special type.  But the question is that with this JSON it was also necessary to work effectively.  And what we have already done with our team in 2014 is JSON-B. <br><br>  It is faster due to the fact that it has already been decomposed and parsed.  Parsed so that you can quickly get value by key.  When we did JSON-B, we screwed the ability to search by indexes to it, then it became really popular. <br><br>  <b>Okay.</b>  <b>Returning to specific properties: what else is there that distinguishes Postgres from other DBMSs and is the reason for using it?</b> <br><br>  All that we talked about JSON for so long is all a manifestation of Postgres flexibility.  There are many places where it can be expanded.  The other side of flexibility is geodata support.  Exactly the same way as special indices were made, for example, for searching by JSON, by arrays and by texts, approximately the same place was used for indices for quick search by geo-information, by spatial data.  There we also put our rather large Russian hand to this business. <br><br>  As a result, PostGIS, this is a very common way of working with geographic information in the world. <br><br>  <b>Do users develop extensions for Postgres for their projects?</b>  <b>Is this a significant amount of its application?</b> <br><br>  No, of course, this is some kind of "cream" on top.  There are people who need it, because their task grows to it.  First of all, it is a universal database that supports all standards very well and which is surely suitable for almost any task. <br><br>  If you start a startup, for example - take Postgres, you can‚Äôt go wrong.  Because, first of all, it is functionally expandable.  And secondly, if you use its open source version, then do not become a hostage of the license you need to acquire. <br><br>  <b>Do you, as an employee of a commercial company, say this, perhaps, not very happy?</b> <br><br>  These are laws of nature, against which you can not argue.  There is open source, and there is a business on open source.  And this is quite an unusual thing, different from the usual business.  But in the future, the role of open source, apparently, will grow.  At least, this can be seen from the success of Postgres and from Gartner‚Äôs annoying graphics, that the open source database is being used more and more often, and there‚Äôs no way to go. <br><br><img src="https://habrastorage.org/webt/5o/hw/1s/5ohw1s-ug9fpqrlf-nizwlvltw0.jpeg"><br><br>  <b>You as a company, why are you needed?</b>  <b>Here it is open source: went, downloaded and everything is all right?</b> <br><br>  Actually, went, downloaded, but buried in the problem.  Sooner or later, people stick to the problem.  It is clear that most users will use the open source version.  They will have no problems, they have small bases, they will not grow.  But in some cases need the help of a professional. <br><br>  Previously, the model was simple.  In this case, I'm talking about Postgres, because different products are at different stages of this evolutionary path.  Postgres was originally just a university project.  People did not think about money;  they were interested in solving the problem.  Then he was a volunteer project: people made for themselves.  At the same time they worked in some companies like ours. <br><br>  <b>Well, how did you make the decision in Rambler?</b> <br><br>  Rambler is a good example.  We did it because we needed it.  We were not at all worried about business users.  Does it need someone else or not. <br><br>  Postgres-companies initially began to emerge not in Russia, but in other countries.  For the first time such a company originated in Japan, but with Fujitsu money.  There has been invested quite a lot.  And she began developing in Postgres and near-Postgres things.  Then, in a fairly short time after that, the second quadrant (2nd Quadrant) in England and in America Enterprise DB appeared.  These are all companies that make money from Postgres.  All these companies start with the fact that they execute orders.  They are engaged ... <br><br>  <b>Custom development.</b> <br><br>  Custom development at the DBMS level.  We do that too, and we did things like that when we weren't yet a company, because Postgres is expanding.  ‚ÄúWe need to search for full-text search not only this way, but also correctly ignore our French accents, or our German umlauts.  Finish it - we'll pay you. "  Or: ‚ÄúJSON is a very good thing.  Here to attach to it an index.  And then our free ad portal will fly a little faster than the rest. ‚Äù <br><br>  These guys really financed the development by paying individual developers or, in some cases, ordering to young, newly appeared companies some features that they wanted to get.  And then gradually the need for commercial versions of Postgres began to arise. <br><br>  Why, and in general, where did these commercial forks come from?  First of all, I must say that Postgres has such a tricky license, which legally allows you to make a commercial product out of it.  BSD-like license.  This is not a GPL.  You can take at least the same code, even without making any changes to it, leave there two lines from the license agreement, add something else to it, and write that this is my ‚ÄúVasya Pupkin DB‚Äù and I sell it .  To go to the market and sell even for billions - please, it does not matter.  Will anyone buy Vasya Pupkin ‚ÄúVasya Pupkin DB‚Äù or not is a separate question.  Most likely no.  And if he brings something of his own there?  And they started doing it. <br><br>  We have such a picture, where green and red flags indicate commercial and non-commercial forks Postgres.  There are a lot of them.  We counted 40-50 pieces.  Most of them, of course, are not successful: they are bent, they are forgotten.  Some large organizations, such as Amazon or Salesforce, may fork over themselves, for example.  The most famous commercial forks are, of course, Greenplum, EnterpriseDB.  Including our Postgres Pro, Japanese Fujitsu Enterprise Postgres. <br><br><img src="https://habrastorage.org/webt/yi/iq/2c/yiiq2cbhpwjcacsn0vvk4lfleek.png"><br><br>  The British, too, have recently done the Postgres enterprise version.  For what?  There are specialized forks, for example, Greenplum is a database for massive analytical calculations with large parallelism.  They took Postgres about a decade ago, very much changed the scheduler, added work with distributed queries there, however, having lost transactional integrity.  But for analytical databases it does not matter: everything is already there, and it is necessary to collect and properly distribute the request among the servers.  They made Greenplum. <br><br>  This thing is used, among other things, in Russia.  In particular, Tinkoff Bank boasted that they have it.  Good thing, which had a certain commercial success, but lagged behind open source, because it had a large level of incompatibility.  They changed the scheduler very much, did a lot of good things, of course, they can be praised for it, but the development of open source went the other way.  And here the main thing is not to go far.  The farther you go, the harder it is then to merge. <br><br>  <b>The first example is when Postgres versions have been made that have some specific functionality.</b>  <b>This is one example of why commercial companies arise.</b>  <b>And what else is there?</b> <br><br>  Greenplum did a really big functional thing that pushes Postgres heavily sideways.  At the same time, it is no longer a universal product, but it is well-resolving an important task in demand. <br><br>  Another group of forks is our Postgres Pro and Enterprise DB.  The latter, oddly enough, despite all their American nature, are engaged in migration from Oracle. <br><br>  In America, too, moving from Oracle, because it is expensive to pay for every sneeze.  Not everyone wants it, and not everyone has what to pay.  Therefore, Enterprise DB offers worldwide migration services from Oracle.  And in order to make it easier to crawl, they chose the implementation path in Enterprise DB of some features that are in Oracle. <br><br>  And what is our Postgres Pro?  We decided not to go this route, although we also did some features from Oracle, for example, asynchronous autonomous transactions.  But in the long run, we do not see the path of following Oracle.  Because ‚Äúfollow‚Äù means that you will always lag behind, and still you will never be 100% compatible, and you still have to constantly prove your at least partial compatibility.  This is a difficult problem. <br><br>  Although you can write the Oracle parser of the PSQL language;  Thank God, it is documented syntactically, but you will not find very strict documentation on its semantics.  Moreover, for full compatibility you will have to reproduce the "bug in the bug."  Here, try to do it, and then prove that this is true.  We realized that in fact it does not completely solve the problem of migration.  We decided that it was better to move forward.  Better to just make the best product. <br><br>  <b>On the other hand, is it necessary to make compatibility at the level of full coverage in such a picture, I'm not talking about a ‚Äúbug in a bug‚Äù?</b>  <b>The challenge is to close the conditional 80% of the cost of migration.</b> <br><br>  It really seems that way, but in practice it turns out that when you migrate a system, it looks like this: you are given a complete system.  This is a black box wrapped in black paper tied with a black rope.  You do not know what is inside.  Is there 80% there or does it get out a bit?  It often happens that it was developed by the ‚Äúhooded‚Äù method on 3 floors, and the builders of the first floor have long since disappeared. <br><br>  And therefore, in order to migrate to this thing, you have to do reverse engineering - not even to rewrite, but to understand whether it works or not.  That is, if you have the perfect test coverage - then yes, you can talk ... <br><br>  <b>What never happens, of course ..</b> <br><br>  ... You can say: "We replace the engine, run the tests.  100% passed, everything is verified.  Go".  In reality, this does not happen.  This is the perfect case.  And therefore it turns out that you realize 80%, and the rest you will still suffer, and you do not know in advance what.  Migration has other, much more significant problems. <br><br>  Every product, every DBMS has advantages.  In Postgres, for example, this is working with JSON and with arrays, which we talked about.  Many things that are optimally written to Oracle like this are optimally written differently to Postgres.  Therefore, if you migrate ‚Äúto stupid‚Äù, then you will get a minimally working subset that is compatible with both.  You will not take advantage of either the old database or the new one. <br><br>  <b>Give me two words about the future.</b>  <b>Where does all this go?</b>  <b>Will you kill all the competitors?</b> <br><br>  I do not think that we will kill all competitors.  In principle, we have such good, ‚Äúsweet‚Äù goals.  We came not to kill, but to build.  Our task is to create a very good database.  Desirable best. <br><br>  <b>And what is it?</b>  <b>What is the criterion for this goodness?</b>  <b>I doubt that Microsoft‚Äôs task is to make a very bad database.</b> <br><br>  Yes, of course, all go to this.  Therefore, in the database world there are now some trends.  And since data volumes are growing faster than anything else, respectively, the main trend of databases now is distribution.  Those who will better solve the problem of a distributed database - they will be great. <br><br>  <b>With us was Ivan Panchenko.</b>  <b>Thank you Ivan.</b> <br><br>  Thank. </div><p>Source: <a href="https://habr.com/ru/post/352650/">https://habr.com/ru/post/352650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352636/index.html">20 modules for Node.js, which is useful to know</a></li>
<li><a href="../352640/index.html">The golden rule of git rebase</a></li>
<li><a href="../352644/index.html">GitLab 10.6 released: CI / CD for GitHub and in-depth integration with Kubernetes</a></li>
<li><a href="../352646/index.html">3CX voice application development: an introduction for beginners</a></li>
<li><a href="../352648/index.html">TeamLead Conf review: 2 days with 2 tracks, 25 reports, 474 participants, the pain is immeasurable</a></li>
<li><a href="../352652/index.html">Igor Sheludko, FSPro Labs: ‚ÄúWorking as a tracker, I see the evolution of many ideas</a></li>
<li><a href="../352654/index.html">We meet the service from Cloudflare at addresses 1.1.1.1 and 1.0.0.1, or ‚Äúthe public DNS regiment has arrived!‚Äù</a></li>
<li><a href="../352656/index.html">Digital events in Moscow from April 2 to 8</a></li>
<li><a href="../352658/index.html">Conference DEFCON 22. "Alone at home with an automatic protection system." Chris Littlebury</a></li>
<li><a href="../352662/index.html">Startups and Microsoft: Venture, Hubs, and That's All</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>