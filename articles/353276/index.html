<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>UI tests in iOS project. Is there a profit and why are they being introduced at all?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are quite a few people who did not just write UI tests at least once, but would do it in commercial projects, because this part of the developme...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>UI tests in iOS project. Is there a profit and why are they being introduced at all?</h1><div class="post__text post__text-html js-mediator-article">  There are quite a few people who did not just write UI tests at least once, but would do it in commercial projects, because this part of the development is very difficult <strong>to sell to the customer and argue to the manager</strong> why they are needed and why they take so long.  The Novosibirsk company <a href="http://improve-group.ru/">Improve Digital</a> decided to take this step for a number of reasons, in particular, because the project under development is long-term and with great potential for further development. <br><br>  Next, the transcript of <strong>Mikhail Domrachev</strong> 's <a href="http://appsconf.ru/">speech</a> at <a href="http://appsconf.ru/">AppsConf</a> 2017, during which he told how <strong>to implement UI tests</strong> in iOS projects <strong>in practice</strong> , and shared his thoughts when it is really necessary, and when - unnecessarily. <br><br>  Looking ahead, we note that there are both pros and cons.  But, in our opinion, a <strong>significant reduction in the number of design bugs</strong> without the enormous effort of manual testing is an indisputable advantage that anyone has to try on with the small difficulties that arise. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/d8/a3/6w/d8a36whq9gdhotyhq5xoeppqphm.jpeg"><br><a name="habracut"></a><br><h2>  Backround </h2><br>  Let's start from afar, with a description of the project before we are faced with problems with the design. <br><br><ul><li>  The project has been actively living and developing for 2 years, it can be called long-term. </li><li>  The development team is increasing. </li><li>  The project consists of many mobile applications that have common functionality. </li><li>  Developed the Core framework, which highlighted the overall functionality, and which is connected to each project in the form module. </li></ul><br>  We work with a fairly large foreign financial company, which has branches in different countries.  Each country has its own mobile application, which has common functions, but differs in design and some specificity for a country related, for example, to legislation. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/q7ibo5L9eLI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Technical side </h2><br>  All our screens are implemented in tabular form.  A table consists of a set of such bundles as a cell and a View-Model for it.  That is, we can customize the cell content through the View-Model and set a specific design, in different countries it will look different, but in fact it is the same resource that lies in the Core framework. <br><br><img src="https://habrastorage.org/webt/2p/qu/8x/2pqu8xbgv6iguametcfhrnur1lc.jpeg"><br><br>  The picture shows the screen.  The top cell has its own View-Model, through which you can: <br><br><ul><li>  customize the background color <br></li><li>  set the name of the image (imageName), which we take from resources. <br></li></ul><br>  In the View-Model for the button you can set: <br><br><ul><li>  content (title) <br></li><li>  design (title color), <br></li><li>  background color of this button. <br></li></ul><br><h2>  Core framework </h2><br>  On average, about <strong>70% of the</strong> functionality from the Core framework is reused in each new application, and only 30% of it is wound on to something new. <br><br><img src="https://habrastorage.org/webt/m9/-q/bc/m9-qbcdfqfxy2f4suey1nnelbmq.jpeg"><br><br>  In the core framework is: <br><br><ul><li>  <strong>Screen module</strong> - already ready screens in the form of modules.  I call them modules, because some standard business logic has already been implemented there, routing the switch to other screens and has its own default design. <br></li><li>  <strong>Any services</strong> - various basic services, for example, for work with a network, with data caching, etc. <br></li><li>  <strong>Utils</strong> are categories (helper) that help you write code faster. <br></li><li>  <strong>Design elements</strong> - all design elements, which consist of: <br><ul><li>  <strong>xib</strong> for all cells: </li><li>  <strong>cell</strong> classes for these cells </li><li>  <strong>View-Model</strong> . </li></ul></li></ul><br>  In each new application we have to add the following: <br><br><ul><li>  <strong>Override screen module</strong> - override screens from the Core framework. <br></li><li>  <strong>New screen modules ‚Äî</strong> new screens if these functions are not reused anywhere. <br></li><li>  <strong>Override services</strong> - usually you need to override the Network-service, because APIs in all countries are not 100% identical. <br></li><li>  <strong>xib</strong> - sometimes you need to develop a new design for the cell. <br></li></ul><br>  Although usually all cells are taken from Core.  We can customize their design through the View-Model, they are quite versatile, and at the output we get a Lego design. <br><br><img src="https://habrastorage.org/webt/rp/an/7i/rpan7immqr-cjkdottyilossmlq.jpeg"><br><br>  As a result, we have such a "Frankenstein". <br><br><h3>  Examples </h3><br><img src="https://habrastorage.org/webt/uf/7c/i2/uf7ci2xn0jr1r6j07vejbcjcnt4.jpeg"><br><br>  This is the same screen, but in different countries.  It has a common base implementation, that is, is programmed in Core.  Differences in design, we implement through different categories for colors and pictures.  If you look closely, you can hardly find 10 differences here, for example: <br><br><ol><li>  different pictures, in different countries in the resources there are different pictures with the same name; <br></li><li>  a different background at the calculator; <br></li><li>  various alignment of information and some other fonts; <br></li><li>  different color at the button <br></li></ol><br><img src="https://habrastorage.org/webt/74/0e/p-/740ep-ctgjaow7mdkljmaezpkls.jpeg"><br><br>  The second type of screen is more complicated.  On the left - the basic implementation in the Core framework, on the right - the customer in a new country decided to display the same information in a slightly different way.  Business logic is preserved, but it was necessary to make a new design.  We used other cells (also from the Core framework), and also implemented a new functionality - credit card payment. <br><br>  Everything seemed to be good, the customer was very pleased and offered to increase the speed and make new countries faster.  But, naturally, we did not take everything into account. <br><br><h2>  Sources of problems </h2><br><ul><li>  <strong>New Developers</strong> <br></li></ul><br>  To increase the momentum on the project, new developers were hired. <br><br><ul><li>  <strong>Shared resources</strong> <br></li></ul><br>  As already said, we have common resources for all countries, and they are in the public domain.  A new developer (or even an old developer) could modify the parameters or move / change elements in the shared resources.  Everyone, of course, understands that it is impossible to do this, but there have been cases all the same. <br><br><ul><li>  <strong>The designer forgot about the uniform style of applications.</strong> <br></li></ul><br>  All our applications have the same style, for example, the same text alignment, certain cell colors, the same backgrounds.  Over time, our designer began to forget about this single style and could make changes to the style of the base cell.  But he did not even suspect that by doing so he could harm a completely different application, for which he was not even responsible.  And the developer, who deals with them, also did not know that they hurt him.  As a result, with manual testing, there were always some problems with the "left" design. <br><br>  We immediately realized that the solution to these problems would be the introduction of Ul-tests.  Before introducing ul-tests, we made a small analysis of the market of tools with the help of which it can be done on iOS projects, we did not consider other platforms. <br><br><h3>  Ul testing tools: </h3><br><ul><li>  <strong>iOS Ul testing</strong> from Apple; <br></li><li>  <strong>appium</strong> is now the most popular framework for writing uniform tests for different operating systems.  You can write a general test and export it to different platforms. <br></li><li>  <strong>Calaba.sh</strong> - an open framework developed by Xamarin, also involves writing common tests for different platforms. <br></li></ul><br><br><img src="https://habrastorage.org/webt/jt/dg/ee/jtdgeejm-hg13dvwhxy2fbxryhm.jpeg"><br><br>  We did the analysis on clear criteria: <br><br><ol><li>  <strong>Cost</strong>  All our products in the basic configuration without any features are free, any developer can fasten them to their project and use. <br></li><li>  <strong>Cross platform</strong>  This was not so important for us, but in the analysis we still considered this criterion. <br></li><li>  <strong>Kodogeneratsiya,</strong> that is, the possibility of test-recording - during the interaction with the UI elements generated the code of our test. <br></li></ol><br>  Apple and Appium have such tools, while Calaba.sh is not in the basic configuration, but there is a Xamarin cloud where you can buy this function.  Also, there are more than 2000 devices, where you can run tests.  Test-recording is not always very good.  When we do not write with our hands, we sometimes do not understand what is being generated.  The absence of such a tool can play a plus.  I will tell about it a bit later. <br><br>  4. <strong>Experience with</strong> members of our team of any tool prior to our project. <br><br>  All the guys in our team used only one tool - Apple.  More precisely, they simply knew something about him.  All voted unanimously for this tool.  In principle, we had enough of the functions that it provides, other platforms were not so important to us. <br><br>  I'll tell you about it a little more in detail. <br><br>  <strong>iOS Ul testing</strong> is a rather young technology that was introduced in 2015.  It is based on two things: <br><br><ul><li>  XCTest - a framework that allows you to write and run tests; <br></li><li>  Accessibility - allows people with disabilities to use Apple devices to the full.  For UI tests, it provides the ability to interact with UI elements during the execution of UI tests. <br></li></ul><br>  XCTest is based on only three classes: <br><br><ol><li>  XCUI Application - a kind of proxy between the application and tests; <br></li><li>  XCUIEIement - your UI element on the screen; <br></li><li>  XCUIEIementQuery - a request to search for an item that is on the screen by some criterion. <br></li></ol><br><h3>  UI demo test recording </h3><br><iframe width="560" height="315" src="https://www.youtube.com/embed/q7ibo5L9eLI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  It's simple - put the cursor in the function, press record.  Runs a UI test.  We click on the elements and generated code. <br><br>  Let's see what he generated. <br><br><pre><code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">XCUIApplication</span></span> *app = app2; [app.buttons[<span class="hljs-string"><span class="hljs-string">@"start"</span></span>] tap]; <span class="hljs-built_in"><span class="hljs-built_in">XCUIElement</span></span> *element = [[[[app.otherElements containingType:<span class="hljs-built_in"><span class="hljs-built_in">XCUIElementTypeNavigationBar</span></span> identifier:@‚Äú<span class="hljs-built_in"><span class="hljs-built_in">UIView</span></span>‚Äù] childrenMatchingType:<span class="hljs-built_in"><span class="hljs-built_in">XCUIElementTypeOther</span></span>].element childrenMatchingType:<span class="hljs-built_in"><span class="hljs-built_in">XCUIElementTypeOther</span></span>].element childrenMatchingType:<span class="hljs-built_in"><span class="hljs-built_in">XCUIElementTypeOther</span></span>].element; [element tap]; <span class="hljs-built_in"><span class="hljs-built_in">XCUIApplication</span></span> *app2 = app; [app2.keys[<span class="hljs-string"><span class="hljs-string">@"t"</span></span>] tap]; [app typeText:@‚Äút<span class="hljs-string"><span class="hljs-string">"]; . . . [app typeText:@"</span></span>c<span class="hljs-string"><span class="hljs-string">"]; [app2.keys[@‚Äúo"</span></span>] [element tap];</code> </pre> <br>  Of course, he doesn‚Äôt always do so badly, but I honestly tried to write down demos 3-4 times, and always ran into the same mistakes: <br><br><ol><li>  The XCUI Application was incorrectly initialized, did not do log and init for it, but equated some mythical variable app2, which had never been defined before.  On the next screen, he did the same. <br></li><li>  Item found incorrect.  The item has been exposed to AccessibilityNotifier, by which it should have searched for this item.  But he did not see it, and began to search simply through childrenMatchingType. <br></li></ol><br><h3>  Cons UI test recording: </h3><br><ol><li>  a lot of code; </li><li>  code that is not always readable - many times; </li><li>  not always working code; </li><li>  reuse of functionality is not implemented. </li></ol><br>  These minuses of UI test recording are not always encountered, but speed is important when writing UI tests.  I want to write some functions quickly, beautifully, and at the same time I don‚Äôt want to come back and edit anything after test recording.  It usually takes more time than you write yourself right away. <br><br><h2>  From theory to practice </h2><br>  The first thing we encountered was the <strong>Stub manager</strong> , or rather, its absence.  Prior to this, we did not implement unit tests on the project, and we didn‚Äôt emulate the connection to the network. <br><br>  We wanted not to repeat test-recording errors and write tests that are cleaner and more accurate.  This was helped by the <strong>Page object pattern</strong> .  Few people know about him, but testers who write tests should be aware of. <br><br>  We implemented the <strong>Snapshot</strong> tool for taking screenshots during the execution of our UI tests in order not only to see if our test fell while executing it, but also to see the result, to compare the design on the screens. <br><br>  Consider in detail each item. <br><br><h3>  Stub manager </h3><br>  For some reason, it is considered that implementing network emulation is difficult.  In fact, everything is done very simply with the help of the <strong>class NSURLProtocol</strong> .  This is a class that allows you to predetermine the work of the URL loading system for iOS. <br><br>  Everything is done in two steps: <br><br><ol><li>  creating your own class that inherits from the NSURLProtocol; </li><li>  register it in the URL download system. </li></ol><br>  When in an application you send a request to the network, the download system first checks to see if any of your NSURLProtocol's are registered.  If so, then she addresses each of them in her own order and asks if it is possible to process this request.  If we say yes, the request to the network is terminated, and we process it at the application level. <br><br><h3>  Custom class NSURLProtocol </h3><br>  Only three methods need to be overridden: <br><br><ol><li>  whether we can process this request (just returns true / false): <br><br><pre> <code class="objectivec hljs">+(<span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span>)canInitWithRequest:(<span class="hljs-built_in"><span class="hljs-built_in">NSURLRequest</span></span> *)request</code> </pre> </li><li>  The startLoading method itself, where all the magic of data substitution takes place: <br><br><pre> <code class="objectivec hljs">-(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)startLoading</code> </pre> </li><li>  at the end we tell the system that we have finished processing the request: <br><br><pre> <code class="objectivec hljs">-(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)stopLoading</code> </pre> </li></ol><br>  A little more about startLoading, where all the magic happens. <br><br><pre> <code class="objectivec hljs">(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)startLoading <span class="hljs-built_in"><span class="hljs-built_in">NSData</span></span> *cachedData <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cachedData) { <span class="hljs-built_in"><span class="hljs-built_in">NSHTTPURLResponse</span></span> *response [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.client URLProtocol: didReceiveResponse: cacheStoragePolicy:]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.client URLProtocol:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> didLoadData: cachedData]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.client URLProtocolDidFinishLoading: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.client URLProtocol: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> didFailWithError:   }</code> </pre><br>  Inside, we simply take the data from the cache <code>(NSData *cachedData)</code> .  In our case, they are stored in different bundles, because for each test case for the same request there may be different answers.  If there is such data, we create our own custom response, give it to the system, and also tell it to return the cached data. <br><br>  If we did not find this data, we simply create our own custom error, which will return to the request, as if it came from the network. <br><br>  With Stub manager you only register your class.  This is done through: <br><br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">NSURLSessionConfiguration</span></span> setProtocolClasses: @[[MyNSURLProtocol <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]]</code> </pre> <br>  Everything is done very quickly, easily and works.  So do not be afraid of this. <br><br><h3>  Page object pattern </h3><br>  As I said, we decided to fight the drawbacks of test-recording and take a more responsible approach to writing UI tests.  We tried to make the code cleaner, and applied the Page object pattern. <br><br><img src="https://habrastorage.org/webt/2h/ib/yj/2hibyjoe-cibcg9juhyqaezmnva.jpeg"><br><br>  It is quite simple and is based on the fact that there must be some kind of layer between the tests and the screen for which the tests are written, where the reusable functionality is implemented.  That is, all complex interactions with elements and all searches for elements on screens are sewn up there. <br><br>  <strong>Benefits of Page object pattern:</strong> <br><br><ul><li>  Readability code. <br></li><li>  Reuse of functionality. <br></li><li>  Centralized user interface. <br></li></ul><br><h3>  Our approach </h3><br>  We decided that it would be unnecessary to write a layer for each screen.  We just wrote a common layer for the entire application, it is called XCTestUtils and consists of 3 components: <br><br><ol><li>  Class FFElements, in which the search for elements on the screen is sewn up.  It has two functions: search by key and search by index. <br><br><pre> <code class="objectivec hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FFElements</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> -(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XCUIElement</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">objectForKeyedSubscript</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">; -(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XCUIElement</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">objectAtIndexedSubscript</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSUInteger</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br></li><li>  Category to XCTestCase (Elements).  Here we have specified certain FFElements that we need to write UI tests: cells, labels, buttons;  text fields. <br><br><pre> <code class="objectivec hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XCTestCase</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Elements</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">readonly</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FFElements</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">textFields</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">readonly</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FFElements</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">buttons</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">readonly</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FFElements</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">labels</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">readonly</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FFElements</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cells</span></span></span><span class="hljs-class">; -(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wait</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSTimeInterval</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interval</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br></li><li>  A small category for XCUIEIement, which helps to work with textFields: <br><br><pre> <code class="objectivec hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XCUIElement</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Utils</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pasteText</span></span></span><span class="hljs-class">; +(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">forceTap</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br></li></ol><br>  As you saw in the demo, to enter some text into textFields, a code is generated that clicks on each button.  We have introduced the forceTap function - long press.  When we click on textFields, we have a ‚ÄúInsert Text‚Äù or ‚ÄúCopy‚Äù die. <br><br>  It turned out cool, and everyone was happy. <br><br><h3>  Demo </h3><br>  I will show a small demo about how we use the Page object pattern. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/q7ibo5L9eLI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Through property FFElements, we access specific elements with a specific type and call methods to interact with them.  We work with textFields like this: click, do a long press, and paste the text.  It turned out only 6 lines - clear, readable, and, most importantly, working. <br><br><h3>  Snapshot </h3><br>  We run a UI test, it is run on the device, and we are looking to ensure that the design does not go.  And we can and see. <br><br>  Therefore, we decided to implement a tool such as Snapshot.  It is part of the <strong>Fastlane</strong> group of tools, it is quite simple, it is easy to implement and it is of great benefit. <br><br>  <strong>Snapshot benefits:</strong> <br><br><ul><li>  makes screenshots; <br></li><li>  runs UI tests and takes screenshots in the right places; <br></li><li>  integrates easily with CI, because it runs from the terminal. <br></li></ul><br>  There are literally three steps required to deploy a snapshot. <br><br><ol><li>  In the terminal, enter the command fastlane snapshot init.  After that, it generates a file called Snapfile - this is the configuration file. <br></li><li>  Customize Snapfile. <br></li><li>  We indicate the places where we would like to receive a screenshot. <br></li></ol><br><h3>  Snapfile </h3><br>  We can specify in general all devices on which UI tests will be run, screenshots will be made in the same places on different devices. <br><br><pre> <code class="objectivec hljs"> devices ([ <span class="hljs-string"><span class="hljs-string">"iPhone 6s"</span></span> ]) scheme: <span class="hljs-string"><span class="hljs-string">"our scheme"</span></span> output_directory: <span class="hljs-string"><span class="hljs-string">"./path/."</span></span> stop_after_first_error: Bool reinstall_app: Bool clear_previous_screenshots: Bool Erase_simulator: Bool languages ([ <span class="hljs-string"><span class="hljs-string">"en-US"</span></span> ])</code> </pre><br>  In addition, we specify the scheme on which the UI tests are run, the folder where the result of all the screenshots will be stored, and the auxiliary settings. <br><br>  We can also specify the languages ‚Äã‚Äãin which we will run our UI tests.  If you have a lot of localizations, you can specify all your localizations here and get screenshots with different languages ‚Äã‚Äãat the output. <br><br><h3>  Time for screenshot </h3><br>  From a technical point of view, in the code itself you just need to add a specific file - <strong>SnaphotHelper.</strong>  <strong>swift</strong> in target with tests.  This file is generated in your project folder, when you do fastlane snapshot init, you just need to put it in the target. <br><br>  Then we call inside the <strong>setup ()</strong> method <strong>: [Snapshot setupSnapshot: app]</strong> inside all test cases where we want to take screenshots, and transfer XCUI Application there. <br><br>  The last thing that remains is to simply run through the code to the places where we want to take a screenshot, specify the name of the screenshot with which the <strong>[Snapshot snapshot: @ "Name screen" picture waitForLoadingIndicator: YES] is generated</strong> , run from the terminal, make a fastlane snapshot and enjoy. <br><br>  After passing the tests, there will be not only pictures from different screens, but an HTML page will be generated. <br><br><img src="https://habrastorage.org/webt/ko/q5/zq/koq5zqrnrtz3airnooliqfvp1hk.jpeg"><br><br>  On it, all the pictures are divided into categories, for example, by device and localization, which you specified in Snapfile.  True, the only negative - all these screenshots are sorted not by the sequence of their execution, but by name. <br><br><h2>  Pay attention! </h2><br>  Before you decide to implement UI tests, you should pay attention to a few points: <br><br><ol><li>  Do not be afraid of <strong>Stub manager</strong> - it must be implemented 100%.  On a real network, testing is bad. <br></li><li>  <strong>Page object pattern</strong> - you have to fight for the purity of your code, even if it is written for UI tests. <br></li><li>  You can easily embed the snapshot tool <strong>.</strong>  If you have all the test cases ready, all the code has been written, this is done a maximum during noon. <br></li></ol><br>  In our project we received the following <strong>benefits</strong> : <br><br><ul><li>  Reduced the number of bugs with the design to almost zero. <br></li><li>  Implemented a tool to quickly generate all screenshots of the application and integrated tests with CI. <br></li><li>  Made a check of the correct routing in the application. <br></li></ul><br>  I didn‚Äôt talk about it, but we have rather complicated routing.  It may differ in different countries.  We just check a specific element on each screen that is only on this screen, and if it is not there, it means that we are in the wrong place, something went wrong.  So we check the routing. <br><br>  But we also got small <strong>cons</strong> : <br><br><ul><li>  <strong>The duration of the implementation of UI-tests</strong> .  Create a basic framework: implement the Page object pattern, implement a Snapshot, Stub manager ‚Äî this is done very quickly, but time is spent on thinking up test cases and debugging. <br></li><li>  Your tests will also need to be <strong>maintained when refactoring</strong> .  In our case, this is done quite often.  Of course, not much time is spent on this, but we should not forget about it. <br></li></ul><br>  As I promised, at the end I‚Äôll give my thoughts when it is really worth implementing UI tests. <br><br><h3>  Use tests worth: </h3><br><ol><li>  If you have a long-term project - 100% UI tests need to be implemented.  If you are constantly developing your product, you must be responsible for the quality of the design as well. <br></li><li>  In order to carry on a dialogue about Pixel Perfect and operate not with the words ‚Äúsomething went there,‚Äù but give out screenshots of your entire application, where you will see what needs to be corrected. <br></li><li>  If you have complex logic of navigation in the application, you should also implement UI tests, this helps a lot.  You can even not pay special attention to the design, but it is quite simple to implement the logic to test the navigation. <br></li></ol><br><br><blockquote>  <strong>news</strong> <br><br>  This year we decided to bring the <strong>conference on mobile development</strong> into a separate event - now <a href="http://appsconf.ru/">AppsConf Moscow</a> will be a completely separate event and will be held <strong>on October 8 and 9</strong> .  We plan to hold <strong>the largest</strong> mobile development <strong>event</strong> in Russia, gather activists from all mobile developer communities from across the country, and submit over 60 reports for more than 500 people. <br><br>  But at the <a href="http://ritfest.ru/2018">RIT ++</a> festival there will be many diverse related reports, for example, we received the following applications: <br><br>  <a href="http://ritfest.ru/2018/abstracts/3431">Mobile DevOps: we automate and improve the process of mobile development</a> / Vyacheslav Chernikov (Binwell) <br><br>  <a href="http://ritfest.ru/2018/abstracts/3397">Microservices on the frontend in Mail.ru Mail</a> / Egor Utrobin (Mail.ru) <br><br>  <a href="http://ritfest.ru/2018/abstracts/3348">Integration Testing of Scala</a> Microservices / Yuri Badalyan (2GIS) <br><br>  Examine the <a href="http://ritfest.ru/2018/abstracts">list of applications</a> with which, however, the PC will still work for a month, and if you are interested, <a href="http://conf.ontico.ru/conference/join/rit2018.html%3Fpopup%3D3">book your tickets</a> . <br></blockquote></div><p>Source: <a href="https://habr.com/ru/post/353276/">https://habr.com/ru/post/353276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353266/index.html">The latest version of updates for our superpowers. Review of the book by Dan Roham "Draw to win"</a></li>
<li><a href="../353268/index.html">JPoint 2018: Debriefing</a></li>
<li><a href="../353270/index.html">Five Myths about Data Science</a></li>
<li><a href="../353272/index.html">7 principles for designing container-based applications</a></li>
<li><a href="../353274/index.html">Tips and Tricks for an IT Administrator: Deploying a Different OS with Windows Deployment Services</a></li>
<li><a href="../353280/index.html">Nagios-traffic light from the Chinese blocks</a></li>
<li><a href="../353282/index.html">Hackers attacked Poloniex users with a fake mobile application</a></li>
<li><a href="../353284/index.html">The smallest computer in the world, an energy efficient chip and other innovations for IoT</a></li>
<li><a href="../353286/index.html">Welcome to the first international web conference Kolesa / Web 2018</a></li>
<li><a href="../353290/index.html">Firefox Gecko, "which we lost"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>