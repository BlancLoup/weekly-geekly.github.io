<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Displaying the statuses of ICQ, Jabber, Skype and MRA on the site in any way</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It may be necessary to add to the site a display of the current network status of contacts of various messaging services. Most often this can be found...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Displaying the statuses of ICQ, Jabber, Skype and MRA on the site in any way</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/storage2/d91/acb/9a9/d91acb9a93a75ef4da72af7ac9d585fa.jpg"></div><br><br>  It may be necessary to add to the site a display of the current network status of contacts of various messaging services.  Most often this can be found on business cards or to display the availability of the online support operator.  You can use for this official services or unofficial, which, as a rule, provide more opportunities for registration, different themes with pictures.  But what to do if we have the original site and default images do not fit into its style?  You have to either reinvent your bike, which is unlikely to be better than the existing ones, or borrow ideas from ready-made solutions and adapt them to our needs.  We will go the second way. <br><br>  First, let's define our tasks: <br>  - if possible, use official status services <br>  - in case of their absence, you can resort to outsiders <br>  - the method should be as simple as possible, without surplus (you can always expand it later) <br>  - so that the page will not be drawn at the time of the request, we will make a buffer 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Consider 4 basic ways on the example of ICQ, Jabber, Skype and MRA.  The rest can be done similarly. <br><a name="habracut"></a><br>  Verification will be carried out using php.  Create a file ‚Äústatus.php‚Äù and add its execution to the scheduler every 5 minutes.  The status will be saved in a separate file. <br><br>  In my case, for each protocol its own file, for example "icq.s".  Because  I have saved not only the status text, but also a picture, then a part of the html-code is written in two lines.  So that later on the page of the site not to tear out paragraphs, I decided to simply insert the desired piece in a certain place on the page: <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(<span class="hljs-string"><span class="hljs-string">'icq.s'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  It will be possible to record arbitrarily large and complex structures. <br><br><br><br><h2>  ICQ status </h2><br>  We will use the official status check service.  It also has its drawbacks, it works strange.  For example, the status of "Away" he gives only when the contact is the status of "Invisible".  In other cases, except offline, the contact is always displayed "Online".  Therefore, if you put the status ‚ÄúAway‚Äù in the client, it will still appear as ‚ÄúOnline‚Äù.  But this is not a reason to refuse, we will use the official service, as was stated in the tasks. <br><br>  Do not forget to allow the client to display status on sites.  There are many ways to determine status, but they use the same address for verification: <br><br><pre> <code class="xml hljs">http://status.icq.com/online.gif?icq=__UIN</code> </pre><br>  Depending on the current ICQ status, the address of the image being sent will take on the values: <br><br><pre> <code class="xml hljs">http://status.icq.com/0/online0.gif - Away http://status.icq.com/0/online1.gif - Online    http://status.icq.com/0/online2.gif - Offline</code> </pre><br>  Depending on the number in the name of the picture, the status will be determined.  We will receive the ‚ÄúLocation‚Äù header from the server response and capture that number from there.  And then with the help of switch we will set what will be given as status.  The design is as follows: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $a = @get_headers(<span class="hljs-string"><span class="hljs-string">'http://status.icq.com/online.gif?icq=__UIN'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($a <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $Header) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_int(strpos($Header, <span class="hljs-string"><span class="hljs-string">'Location'</span></span>))) { $Status = substr($Header, <span class="hljs-number"><span class="hljs-number">-5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ($Status){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'0'</span></span>: $icqstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="icq-away.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'1'</span></span>: $icqstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="icq-online.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'2'</span></span>: $icqstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="icq-offline.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: $icqstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="icq-offline.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e){}</code> </pre><br>  The variable "icqstatus" stores the current status.  If the service does not work, then the status is given "Offline".  Now write this status in the file buffer: <br><br><pre> <code class="php hljs">$f=fopen(<span class="hljs-string"><span class="hljs-string">'/home/mysite/icq.s'</span></span>,<span class="hljs-string"><span class="hljs-string">'w'</span></span>); fwrite($f,$icqstatus); fclose($f);</code> </pre><br>  Please note that you need to specify the full path to the file on the server. <br>  As I already wrote above, to display the status in the right place of the page we insert: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(<span class="hljs-string"><span class="hljs-string">'icq.s'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  <b>UPD: changes on ICQ site</b> <br>  Now, instead of three options, there are only ‚Äúonline‚Äù or ‚Äúoffline‚Äù.  Change the code as follows: <br><br><div class="spoiler">  <b class="spoiler_title">View work option</b> <div class="spoiler_text">  Depending on the current ICQ status, the address of the image being sent will take on the values: <br><br><pre> <code class="xml hljs">http://status.icq.com/0/online1.gif - Online</code> </pre><br>  All other values ‚Äã‚Äãwill mean Offline.  So we write: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $a = @get_headers(<span class="hljs-string"><span class="hljs-string">'http://status.icq.com/online.gif?icq=__UIN'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($a <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $Header) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_int(strpos($Header, <span class="hljs-string"><span class="hljs-string">'Location'</span></span>))) { $Status = substr($Header, <span class="hljs-number"><span class="hljs-number">-5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ($Status){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'1'</span></span>: $icqstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="icq-online.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: $icqstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="icq-offline.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e){}</code> </pre><br>  The rest is as usual. <br></div></div><br><br><br><h2>  Skype status </h2><br>  There is an official Skype status checker here.  Unlike ICQ, we have a great opportunity to get an answer in the form of a status text.  Use this link for this: <br><br><pre> <code class="xml hljs">http://mystatus.skype.com/_.txt</code> </pre><br>  Do not forget to allow the client to display status on sites.  Depending on the current status of Skype, we get the following values: <br><br><pre> <code class="xml hljs">Online Away Do Not Disturb Offline</code> </pre><br>  We just have to do how to get the contents of a text file without any additional gestures, it is already kosher and does not contain anything extra. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $a = @file_get_contents(<span class="hljs-string"><span class="hljs-string">"http://mystatus.skype.com/_.txt"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>($a) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'Online'</span></span>: $skypestatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="skype-online.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'Away'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'Do Not Disturb'</span></span>: $skypestatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="skype-away.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'Offline'</span></span>: $skypestatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="skype-offline.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: $skypestatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="skype-offline.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e){}</code> </pre><br>  And traditionally, we write the received status from the variable "skypestatus" to the file: <br><br><pre> <code class="php hljs">$f=fopen(<span class="hljs-string"><span class="hljs-string">'/home/mysite/skype.s'</span></span>,<span class="hljs-string"><span class="hljs-string">'w'</span></span>); fwrite($f,$skypestatus); fclose($f);</code> </pre><br>  In the right place of the site will display: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(<span class="hljs-string"><span class="hljs-string">'skype.s'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br><br><h2>  Jabber status </h2><br>  This is exactly the case when we cannot do without the use of third-party services.  There are no established ways to determine the network status of Jabber.  But there are good people.  Truth and way more complicated. <br><br>  At first I used this service <a href="http://web-apps.ru/jabber-presence/">http://web-apps.ru/jabber-presence/</a> and for a long time it worked perfectly.  But I recently went offline for a week and had to look for alternatives, one of which was <a href="http://presence.jabberfr.org/">http://presence.jabberfr.org/</a> .  We will use it. <br><br>  Go to the page of the French service, write your JID and at the bottom select "Your status (text)".  Just below the generated address will appear, by which the status will be determined. <br><br><pre> <code class="xml hljs">http://presence.jabberfr.org/____JID/text-en.txt</code> </pre><br>  Now we need to add a presence.jabberr.org service to the roster.  He will appear in the contact list and will have the same status as you.  To enable the display of the status of the link generated above, we will send the bot a message with the text ‚Äúvisible‚Äù without quotes. <br><br>  Depending on the current status of Jabber, we have the following values: <br><br><pre> <code class="xml hljs">Available Away Not available Do not disturb Free for chat Offline</code> </pre><br>  If the status is ‚ÄúInvisible‚Äù, the last used status will be shown before hiding. <br>  We implement the display of the status obtained on our website.  Also, as in the case of Skype, we get just a text file.  In addition to the status it contains nothing more. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $a = @file_get_contents(<span class="hljs-string"><span class="hljs-string">'http://presence.jabberfr.org/____JID/text-en.txt'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ($a){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'Available'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'Free for chat'</span></span>: $jabberstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="jabber-online.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'Away'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'Not available'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'Do not disturb'</span></span>: $jabberstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="jabber-away.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'Offline'</span></span>: $jabberstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="jabber-offline.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: $jabberstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="jabber-offline.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e){}</code> </pre><br>  The jabberstatus variable contains the current status.  Write it in the file ‚Äújabber.s‚Äù: <br><br><pre> <code class="php hljs">$f=fopen(<span class="hljs-string"><span class="hljs-string">'/home/mysite/jabber.s'</span></span>,<span class="hljs-string"><span class="hljs-string">'w'</span></span>); fwrite($f,$jabberstatus); fclose($f);</code> </pre><br>  In the right place of the site we will display the status: <br><br><pre> <code class="xml hljs"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">include</span></span></span><span class="php">(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'jabber.s'</span></span></span><span class="php">); </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br><br>  <b>UPD: alternative</b> <br>  Because  Now the French service has fallen, I decided that it is better to write an alternative, i.e.  <a href="http://web-apps.ru/jabber-presence/">http://web-apps.ru/jabber-presence/</a> .  Our domestic friend.  One of them will work. <br><br><div class="spoiler">  <b class="spoiler_title">View work option</b> <div class="spoiler_text">  Go to the page <a href="http://web-apps.ru/jabber-presence/">http://web-apps.ru/jabber-presence/</a> and read the description.  For the lazy, I'll write everything in steps. <br><br>  Add to our roster web-apps-presence@jabber.ru.  After adding the message will come with a brief help.  We will need to remember the contents of the html string: the first one at jabber, the second one by its md5 hash.  In the example, the second option will be used. <br><br><pre> <code class="xml hljs">http://web-apps.ru/jabber-presence/html/xid/____JID</code> </pre><br>  Now we write to the bot bot a message containing only the number 1. We will get an answer that the status display is enabled. <br>  Further we will set the type of the displayed status, we need only the text.  To do this, send in a personal bot a message: <br><br><pre> <code class="xml hljs">set html=%{status}</code> </pre><br>  Depending on the current status of Jabber, we have the following values: <br><br><pre> <code class="xml hljs">available away xa dnd chat</code> </pre><br>  If the status is ‚ÄúInvisible‚Äù, the last used status will be shown before hiding.  All other cases equate to offline. <br>  We implement the display of the status obtained on our website. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $a = @file_get_contents(<span class="hljs-string"><span class="hljs-string">'http://web-apps.ru/jabber-presence/html/xid/____JID'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ($a){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'available'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'chat'</span></span>: $jabberstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="jabber-online.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'away'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'xa'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'dnd'</span></span>: $jabberstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="jabber-away.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: $jabberstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="jabber-offline.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e){}</code> </pre><br>  The rest is as usual. <br></div></div><br><br><br><h2>  MRA status </h2><br>  This is Mail.ru Agent.  Again we will use the official service of checking the status of Mail.ru Agent.  Like ICQ, we are given the opportunity to display only a picture, without status text: <br><br><pre> <code class="xml hljs">http://status.mail.ru/?_</code> </pre><br>  Because  all images have the same address and all of the same size, you have to come up with something else.  You can find out their weight, but this is not the best way.  Let's make a knight's move, I mean, we will simply determine the md5-hash of the image.  We also get three types of statuses: <br><br><pre> <code class="xml hljs">0318014f28082ac7f2806171029266ef - Online, Free for chat, Do not disturb 89d1bfcdbf238e7faa6aeb278c27b676 - Away a46f044e175e9b1b28c8d9a9f66f4495 - Offline, Invisible</code> </pre><br>  After determining the hash with a familiar construction, we set the status: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $a = @md5(file_get_contents(<span class="hljs-string"><span class="hljs-string">"http://status.mail.ru/?_"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>($a) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'0318014f28082ac7f2806171029266ef'</span></span>: $mrastatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="mra-online.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'89d1bfcdbf238e7faa6aeb278c27b676'</span></span>: $mrastatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="mra-away.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'a46f044e175e9b1b28c8d9a9f66f4495'</span></span>: $mrastatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="mra-offline.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: $mrastatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="mra-offline.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e){}</code> </pre><br>  Write the resulting MRA status to the file: <br><br><pre> <code class="php hljs">$f=fopen(<span class="hljs-string"><span class="hljs-string">'/home/mysite/mra.s'</span></span>,<span class="hljs-string"><span class="hljs-string">'w'</span></span>); fwrite($f,$mrastatus); fclose($f);</code> </pre><br>  And in the right place we will display the status: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(<span class="hljs-string"><span class="hljs-string">'mra.s'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  Check how it works, you can here <a href="http://damaks.me/">http://damaks.me/</a> .  There is a lot of work, I will try to stay in the network a little longer so that you can see this action with your own eyes. <br><br><br><h2>  Other protocols </h2><br>  Similarly, we can check the current network status of other protocols.  If there is an official service, then use it, if not, then use alternative ones.  Here are 4 different ways, at least one of which is suitable for other protocols. <br><br><div class="spoiler">  <b class="spoiler_title">Vkontakte status</b> <div class="spoiler_text">  We receive the status (it is possible to use both numeric id, and an alias): <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $ch = curl_init(<span class="hljs-string"><span class="hljs-string">'https://api.vkontakte.ru/method/getProfiles?uids=__ID&amp;fields=online'</span></span>); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-number"><span class="hljs-number">1</span></span>); $result=curl_exec($ch); curl_close($ch); $a = substr($result, <span class="hljs-number"><span class="hljs-number">-4</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ($a){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'1'</span></span>: $vkstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="vk-online.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'0'</span></span>: $vkstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="vk-offline.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: $vkstatus = <span class="hljs-string"><span class="hljs-string">'&lt;img src="vk-offline.png" alt=""/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e){}</code> </pre><br>  Write it to the file: <br><br><pre> <code class="php hljs">$f=fopen(<span class="hljs-string"><span class="hljs-string">'/home/mysite/vk.s'</span></span>,<span class="hljs-string"><span class="hljs-string">'w'</span></span>); fwrite($f,$vkstatus); fclose($f);</code> </pre><br>  And where you need to display: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(<span class="hljs-string"><span class="hljs-string">'vk.s'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br></div></div><br><br><h2>  PS </h2><br>  I found different ways of displaying statuses on different resources, I can‚Äôt definitely remember.  Especially there are the same descriptions many times.  If the source is known, I will add to the post.  If there are comments / suggestions, I will listen with pleasure. </div><p>Source: <a href="https://habr.com/ru/post/150389/">https://habr.com/ru/post/150389/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../150383/index.html">Nokia Belle Refresh</a></li>
<li><a href="../150384/index.html">Windows Azure Mobile Services - the announcement of a new cloud service</a></li>
<li><a href="../150385/index.html">Getting Started with Windows Azure Mobile Services</a></li>
<li><a href="../150386/index.html">Movim: Decentralized Social Network</a></li>
<li><a href="../150387/index.html">Microsoft patented multitouch stylus</a></li>
<li><a href="../150393/index.html">Users and customers. What is the difference?</a></li>
<li><a href="../150394/index.html">Yandex joined the W3C</a></li>
<li><a href="../150395/index.html">Yandex closes Chat in Ya.Pochte and gives in return 10 gigs to the Disk</a></li>
<li><a href="../150396/index.html">SkyDrive for Android is available</a></li>
<li><a href="../150397/index.html">RAD Studio XE3 - changes to the EULA?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>