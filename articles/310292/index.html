<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bug work</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúPeople have forgotten this truth,‚Äù said Fox, 
 - but you do not forget: 
 you are forever responsible for all those who tamed ... 

 Antoine de Saint...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bug work</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/925/fcf/946/925fcf94685e4cd2b11aa47f812ff213.PNG">  <b><i>‚ÄúPeople have forgotten this truth,‚Äù said Fox,</i></b> <b><i><br></i></b>  <b><i>- but you do not forget:</i></b> <b><i><br></i></b>  <b><i>you are forever responsible for all those who tamed ...</i></b> <b><i><br><br></i></b>  <b><i>Antoine de Saint-Exupery "The <a href="http://lib.ru/EKZUPERY/mprinc.txt">Little Prince</a> "</i></b> <br><br>  Only the one who does nothing is not mistaken.  Over time, errors accumulate.  What can I say, right now in my hands there are a dozen use cases that lead to various errors in the <a href="https://habrahabr.ru/post/276329/">Quantum Noughts alone</a> and are completely lacking in spirit to deal with (the code there is really <a href="">hellish</a> ).  But sometimes I find time to fix something.  And you know what?  Correcting old mistakes is no less interesting than making new ones! <br><a name="habracut"></a><br><h4>  <b>Old Ur in new clothes</b> </h4><br>  <a href="https://habrahabr.ru/post/224661/">Ur</a> is one of my very first games (if not on <a href="http://www.zillions-of-games.com/">Zillions of Games</a> , then on <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D1452">Axiom</a> <a href="https://habrahabr.ru/post/226235/">for sure</a> ).  This is the game that started my passion for board games!  Of course, this is not about the <a href="http://skyruk.livejournal.com/211326.html">reconstructions of</a> <a href="https://en.wikipedia.org/wiki/Robert_Charles_Bell">Bell</a> or <a href="https://en.wikipedia.org/wiki/H._J._R._Murray">Murray</a> .  For all their virtues, these pundits, apparently seldom played board games (at least according to their own rules).  The only, in my opinion, playable <a href="http://skyruk.livejournal.com/231444.html%3Fthread%3D4494868">version of the</a> rules for this game, was developed by <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BA%25D0%25B8%25D1%2580%25D1%258E%25D0%25BA,_%25D0%2594%25D0%25BC%25D0%25B8%25D1%2582%25D1%2580%25D0%25B8%25D0%25B9_%25D0%2598%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B5%25D0%25B2%25D0%25B8%25D1%2587">Dmitry Skiryuk</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">The game looked ugly</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/XLmDzqquyQU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br>  Fortunately, <a href="https://habrahabr.ru/users/nomad1/" class="user_link">Nomad1</a> almost immediately joined the creative process, having developed an excellent implementation of the game under <a href="https://habrahabr.ru/post/225631">Android and iOS</a> .  It should be noted that another one of Habr's authors took part in the development.  Without the excellent musical themes created by <a href="https://habrahabr.ru/users/1eqinfinity/" class="user_link">1eqinfinity</a> , the game would not have been so atmospheric in half.  The resources of the Android version have significantly improved the <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D2262">appearance of the</a> ZoG version, but one of the important points was not given to me in any way. <br><br><div class="spoiler">  <b class="spoiler_title">It's all about the "piles" of figures</b> <div class="spoiler_text">  According to the rules proposed by Dmitry Skiryuk, there are several positions on the board that allow you to place up to four game chips "on top of each other."  Such a stack works on the principle of <a href="https://ru.wikipedia.org/wiki/LIFO">LIFO</a> - a chip that has entered the position of the first goes last.  This mechanism allows you to delay the advancement of the opponent's chips, ‚Äúpressing‚Äù them with your own.  This is exactly the problem.  Under the <a href="http://www.zillions-of-games.com/">Zillions of Games</a> model, each board field can contain no more than one piece. <br><br>  This is not the first time I've come across this restriction and I know how to deal with it.  In some games, such as " <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D2369">Focus</a> ", you can use "composite" shapes, which are the "piles" of pieces put on each other.  A similar approach is used in <a href="https://habrahabr.ru/post/272119/">mancalah</a> .  Unfortunately, for Ur this method is inapplicable, would have to define too many types of shapes.  Another approach consists in the imperceptible movement of the ‚Äúpile‚Äù pieces to specially selected positions outside the board (as was done in <a href="https://habrahabr.ru/post/234587/">Ritmomachia</a> ). <br></div></div><br>  In the first version of Hurray, I hid the locked figures, imperceptibly moving them to invisible fields.  When the top chip went away, I returned the pieces from the pile, one by one, to their original place.  Unfortunately, visibility suffered.  With such a ‚Äúview from above,‚Äù it was necessary to have a good understanding of the rules in order to distinguish the situations of ‚Äúknocking down‚Äù chips from their ‚Äúcovering‚Äù.  More recently, I managed to solve this problem: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/EV4iMOrqvDM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><div class="spoiler">  <b class="spoiler_title">I started with Puluk</b> <div class="spoiler_text">  I have long wanted to make <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D2525">this game</a> .  In Puluk, chips can be stacked on top of each other, but, unlike Focus, there is no limit on the size of the stack.  Since it was impossible to use "composite" shapes, the idea was to draw tiles of chips with a slight overlap of each other.  And here I was greatly helped by developments from another <a href="https://habrahabr.ru/post/278853/">game</a> .  The fact is that the board in ZRF can be defined in two ways.  The easiest way to determine the grid is: <br><pre><code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">grid</span></span> (<span class="hljs-name"><span class="hljs-name">start-rectangle</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">104</span></span>) (<span class="hljs-name"><span class="hljs-name">dimensions</span></span> (<span class="hljs-string"><span class="hljs-string">"a/b/c/d/e/f/g"</span></span> (<span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-comment"><span class="hljs-comment">; files ("10/9/8/7/6/5/4/3/2" (0 50)) ; ranks ) )</span></span></code> </pre>  The number 18 (in parentheses) is the offset by which the shape tile moves when the position changes horizontally.  Since the width of the tile itself is 30, the pieces overlap each other.  It doesn't look too good: <br><br><img src="https://habrastorage.org/files/8f2/efa/825/8f2efa8258394912b5aa88632bcb99ae.PNG"><br><br>  Fortunately, there is a way to fix the situation!  This small <a href="https://github.com/GlukKazan/ZoG/blob/master/utils/perl/grid.pl">script</a> has already helped me with Chase once, it will help now.  It is not very correct, it does not work correctly with negative numbers and multiple descriptions of grids, but it saves me a lot of time.  Here is how the game looks after its use: <br><br><img src="https://habrastorage.org/files/4bf/67b/fb0/4bf67bfb04204bfbb118b670f18f0e96.PNG"><br><br>  The secret is simple - now, each position is described individually.  The order of the description of positions determines the z-sequence of the "overlay" of tiles on each other: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">positions</span></span> ... (<span class="hljs-name"><span class="hljs-name">g5</span></span> <span class="hljs-number"><span class="hljs-number">108</span></span> <span class="hljs-number"><span class="hljs-number">304</span></span> <span class="hljs-number"><span class="hljs-number">158</span></span> <span class="hljs-number"><span class="hljs-number">354</span></span>) (<span class="hljs-name"><span class="hljs-name">f5</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span> <span class="hljs-number"><span class="hljs-number">304</span></span> <span class="hljs-number"><span class="hljs-number">140</span></span> <span class="hljs-number"><span class="hljs-number">354</span></span>) (<span class="hljs-name"><span class="hljs-name">e5</span></span> <span class="hljs-number"><span class="hljs-number">72</span></span> <span class="hljs-number"><span class="hljs-number">304</span></span> <span class="hljs-number"><span class="hljs-number">122</span></span> <span class="hljs-number"><span class="hljs-number">354</span></span>) (<span class="hljs-name"><span class="hljs-name">d5</span></span> <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">304</span></span> <span class="hljs-number"><span class="hljs-number">104</span></span> <span class="hljs-number"><span class="hljs-number">354</span></span>) (<span class="hljs-name"><span class="hljs-name">c5</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">304</span></span> <span class="hljs-number"><span class="hljs-number">86</span></span> <span class="hljs-number"><span class="hljs-number">354</span></span>) (<span class="hljs-name"><span class="hljs-name">b5</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">304</span></span> <span class="hljs-number"><span class="hljs-number">68</span></span> <span class="hljs-number"><span class="hljs-number">354</span></span>) (<span class="hljs-name"><span class="hljs-name">a5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">304</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">354</span></span>) ... )</code> </pre><br>  Unfortunately, due to the group movement of the figures specific to Puluk, the picture ‚Äúbreaks‚Äù.  The covered shape is moved to the second one and is drawn after the piece moved by the player.  Nothing can be done about it, this is how Zillions of Games works <br><br><img src="https://habrastorage.org/files/cb0/302/7c8/cb03027c804442aaaca0183785a3791e.PNG"><br><br>  Puluk is simply not suitable for this way of displaying figures.  But Ur - fits! <br></div></div><br>  In Ur the figures <b>do not</b> move in groups.  A single chip can be placed on top of the ‚Äústack‚Äù (in some fields of the board) or leave the top of the ‚Äústack‚Äù.  In this regard, the rules of the game in ‚ÄúUr‚Äù are ideal for the chosen approach.  The only thing is to correctly determine the positions on the board (by moving a part of the positions up a couple of pixels up and to the left) and link them together: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/032/b38/fa7/032b38fa77c44e8fb2fd6143541ac9bd.PNG"></div><br>  The approach works, but in some cases the picture breaks: <br><br><img align="left" src="https://habrastorage.org/files/cb0/e56/ff4/cb0e56ff4e1f460a8f16f781abbec1b5.PNG">  In general, everything is clear here.  We deal with rectangular tiles, partially painted with a ‚Äútransparent‚Äù color, but when ZoG renders a ‚Äútransparent‚Äù color, it takes a part of the board image (background image), and not a figure that overlaps the same place.  I have already come across a similar when drawing shapes for " <a href="https://habrahabr.ru/post/274043/">MarGo</a> " and I know how to deal with it.  All you need is to draw additional tiles with shaded lower right corners.  The fill color must match the color of the figure below. <br><br>  Unfortunately, the matter is not limited to the preparation of graphic resources.  The fact is that the shell Zillions of Games "does not like" to perform "extra" work.  When moving <b>one</b> shape, the others do not redraw.  After performing the animation of the move, the figure is simply drawn at the new position, and the old position is filled (again) with a rectangular fragment of the background image of the board.  There is a way to "deceive the system".  It is necessary ‚Äúonly‚Äù to initiate the redrawing of all the figures, starting from the bottom of the pile: <br><br><div class="spoiler">  <b class="spoiler_title">Here's what it looks like.</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> refresh (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">im-white</span></span>?) (<span class="hljs-name"><span class="hljs-name">if</span></span> friend? (<span class="hljs-name"><span class="hljs-name">create</span></span> White $<span class="hljs-number"><span class="hljs-number">1</span></span>) else (<span class="hljs-name"><span class="hljs-name">create</span></span> Black $<span class="hljs-number"><span class="hljs-number">1</span></span>) ) else (<span class="hljs-name"><span class="hljs-name">if</span></span> friend? (<span class="hljs-name"><span class="hljs-name">create</span></span> Black $<span class="hljs-number"><span class="hljs-number">1</span></span>) else (<span class="hljs-name"><span class="hljs-name">create</span></span> White $<span class="hljs-number"><span class="hljs-number">1</span></span>) ) ) ) (<span class="hljs-name"><span class="hljs-name">define</span></span> check-refresh (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? down) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">or</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">flag</span></span>? is-enemy?) not-enemy?) (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">not-flag</span></span>? is-enemy?) enemy?) ) (<span class="hljs-name"><span class="hljs-name">refresh</span></span> $<span class="hljs-number"><span class="hljs-number">3</span></span>) else (<span class="hljs-name"><span class="hljs-name">refresh</span></span> $<span class="hljs-number"><span class="hljs-number">2</span></span>) ) else (<span class="hljs-name"><span class="hljs-name">refresh</span></span> $<span class="hljs-number"><span class="hljs-number">1</span></span>) ) ) (<span class="hljs-name"><span class="hljs-name">define</span></span> pre-action ... (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? down) mark down (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? up) (<span class="hljs-name"><span class="hljs-name">not-empty</span></span>? up)) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">or</span></span> (<span class="hljs-name"><span class="hljs-name">piece</span></span>? King) (<span class="hljs-name"><span class="hljs-name">piece</span></span>? KingE) (<span class="hljs-name"><span class="hljs-name">piece</span></span>? KingF)) (<span class="hljs-name"><span class="hljs-name">check-refresh</span></span> King KingF KingE) else (<span class="hljs-name"><span class="hljs-name">check-refresh</span></span> Man ManF ManE) ) (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-enemy? enemy?) up ) back ) )</code> </pre><br></div></div><br>  In fact, all the ‚Äústack‚Äù pieces are re-created with the same types, as part of the move that removes the top chip.  This is already a workable <a href="">solution</a> .  Of course, if you closely follow the animation, you can see a brief destruction of the image when removing the chips or the animation of the movement of the figure with the filled in "corner", but at the end of the move the picture is restored to a completely acceptable state.  Perhaps this is the best that can be achieved by means of Zillions of Games. <br><br><div class="spoiler">  <b class="spoiler_title">Unfortunately, there is another problem.</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/files/a00/3b7/c08/a003b7c08dab4e31afa7f86afa91494d.PNG"></div><br>  Yellow rectangles are regions associated with shapes.  It can be seen that in the ‚Äúpiles‚Äù the upper regions overlap the lower ones.  This is the problem.  In order to "click" on the chip of the underlying pile, you need to hit the mouse in a narrow strip a couple of pixels wide.  The mouse cursor helps a little with this - it changes shape when it is pointed at a figure capable of performing a move, but there is a big ambush here. <br><br>  The Zillions of Games shell supports a rather tricky UI-related option.  When you turn on "smart moves", the player no longer has to drag the pieces on the board with the mouse.  If we click on a piece that can make a single move, the move will be executed automatically, without any dragging.  In the case of Ur, it is very convenient (but in Chess, sometimes, it does not happen very well).  But the option has a reverse side - if we click on an empty field, on which a single move can be executed, then this move will be executed!  Now imagine a stack of three pieces.  The upper rectangle significantly exceeds the two-pixel corners in area and, if a move is possible to it, then a slightly quivering hand can easily lead to a defeat in the whole game. <br></div></div><br>  As a bonus, I received an unexpected gift.  In general, I was planning to rewrite the Axiom-version after ZRF, but it was not needed!  Because of the simplification of the logic of the game, AI began to cope with the game <b>much</b> better.  Suffice to say that sometimes he wins from me, and in most cases, he does not have time to spend only one chip.  It is still worse than the Android version, but it is already quite pleasant to play with it. <br><br><h4>  <b>Hunting for the "Elephant"</b> </h4><br>  <a href="http://www.chessvariants.com/other.dir/elephant_hunt.html">It</a> was not my mistake, but my hands were very much itchy to fix it.  I do not know why.  This is one pretty original chess-like <a href="http://www.chessvariants.com/other.dir/elephant_hunt.html">game</a> supposedly popular among the <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D1%2582%25D1%2583%25D1%2580%25D0%25B8">Ituri</a> pygmies.  According to the <a href="http://www.chessvariants.com/who/Freederick">author</a> , the description of the game was discovered by his friend in the diaries of the French missionary Maurice Morceau, dated 1821: <br><br><blockquote>  <i>French French French French French French French French French French French French French French French French French French French French French uri</i>  <i>His personal effects, including the diaries, were later found in a cannibal village by anthropological expedition.</i> </blockquote><br>  Unfortunately, we are dealing only with the author's reconstruction.  The game description was obviously incomplete, there was no access to the original source, and contact with a friend was subsequently lost.  In particular, it is doubtful whether the use of a ‚Äú <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BD%25D1%258C_(%25D1%2588%25D0%25B0%25D1%2585%25D0%25BC%25D0%25B0%25D1%2582%25D1%258B)">knight's</a> move‚Äù movement in the game is too abstract for such a traditional game: <br><br><blockquote>  <i>5x5 on author author author author author author 5 5 author 5 5 field 5 a Knight-move, which is sort of abstract.</i>  <i>However, it‚Äôs impossible to hopefully win if colorbound.</i> </blockquote><br>  By the way, this quote uses " <a href="https://en.wikipedia.org/wiki/Fairy_chess_piece">Ralph Betza's '' funny notation ''</a> ", which I wrote about <a href="https://habrahabr.ru/post/309096/">earlier</a> .  Why am I so interested in this game?  Let's try to figure it out. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5c1/d8a/bdc/5c1d8abdc7264b32b273f5da7c1457f2.PNG"></div><br>  We see one of the rare games that use figures of two different sizes.  An elephant is a big figure occupying four fields of the board at once.  It can move one ‚Äúbig‚Äù step along any orthogonal plane and ‚Äúsqueezes‚Äù everything that happens to be on the four target cells.  He is opposed by the "pygmies", moving by the "Horse", as well as one "shaman", moving on one or two cells, on any of eight sides. <br><br>  Of course, ‚Äúsmall‚Äù figures cannot just move to cells occupied by an ‚Äúelephant‚Äù (that would be too easy).  An elephant can be ‚Äúeaten‚Äù only under the condition that <b>all the</b> fields under it are attacked!  The author himself draws parallels with the medieval European game called "The <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D0%25B8%25D1%2581%25D0%25B0_%25D0%25B8_%25D0%25B3%25D1%2583%25D1%2581%25D0%25B8">Fox and the Geese</a> ".  Not a bad idea, but, unfortunately, the implementation pumped up. <br><br><div class="spoiler">  <b class="spoiler_title">Some code</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> Ele-shift ( $<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">verify</span></span> not-friend?) (<span class="hljs-name"><span class="hljs-name">verify</span></span> (<span class="hljs-name"><span class="hljs-name">not-friend</span></span>? ul)) (<span class="hljs-name"><span class="hljs-name">verify</span></span> (<span class="hljs-name"><span class="hljs-name">not-friend</span></span>? ur)) (<span class="hljs-name"><span class="hljs-name">verify</span></span> (<span class="hljs-name"><span class="hljs-name">not-friend</span></span>? dl)) (<span class="hljs-name"><span class="hljs-name">verify</span></span> (<span class="hljs-name"><span class="hljs-name">not-friend</span></span>? dr)) (<span class="hljs-name"><span class="hljs-name">set-attribute</span></span> vulnerable? (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">attacked</span></span>? ul) (<span class="hljs-name"><span class="hljs-name">attacked</span></span>? ur) (<span class="hljs-name"><span class="hljs-name">attacked</span></span>? dl) (<span class="hljs-name"><span class="hljs-name">attacked</span></span>? dr))) (<span class="hljs-name"><span class="hljs-name">capture</span></span> ul) (<span class="hljs-name"><span class="hljs-name">capture</span></span> ur) (<span class="hljs-name"><span class="hljs-name">capture</span></span> dl) (<span class="hljs-name"><span class="hljs-name">capture</span></span> dr) add )) (<span class="hljs-name"><span class="hljs-name">define</span></span> Shaman-shift2 ( $<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">if</span></span> empty? add $<span class="hljs-number"><span class="hljs-number">2</span></span>) (<span class="hljs-name"><span class="hljs-name">verify</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> not-friend? (<span class="hljs-name"><span class="hljs-name">or</span></span> (<span class="hljs-name"><span class="hljs-name">empty</span></span>? c) (<span class="hljs-name"><span class="hljs-name">vulnerable</span></span>? c)))) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">not-empty</span></span>? c) (<span class="hljs-name"><span class="hljs-name">capture</span></span> c)) add ))</code> </pre></div></div><br>  There are two mistakes here.  One offensive, but the other - fundamental!  First of all, quite unexpectedly, a shaman can attack a lonely-standing elephant (at the same time, quite expectedly, ‚Äúbreaking‚Äù the picture).  At the same time, he does not eat the elephant itself, but simply occupies the cage below it: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/770/c20/4c7/770c204c70df4eeeb66c8e305dce0f66.PNG"></div><br>  The root of evil is here: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">if</span></span> empty? add ...)</code> </pre><br>  If the cell is empty - then we get up on it (and move on, but in a different reality).  The trick is that the cell "under the elephant" is <b>really</b> empty.  It is in another grid, small and ‚Äúelephant‚Äù would not fit in it, with all the desire.  This is pretty easy to fix: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> my-empty? (<span class="hljs-name"><span class="hljs-name">and</span></span> not-friend? (<span class="hljs-name"><span class="hljs-name">or</span></span> (<span class="hljs-name"><span class="hljs-name">empty</span></span>? c) (<span class="hljs-name"><span class="hljs-name">vulnerable</span></span>? c))) ) ... (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">my-empty</span></span>?) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">not-empty</span></span>? c) (<span class="hljs-name"><span class="hljs-name">capture</span></span> c)) add $<span class="hljs-number"><span class="hljs-number">2</span></span>) ...</code> </pre><br>  Further more: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/18c/25a/480/18c25a4802b940baa3a2ccaf88149a33.PNG"></div><br>  In such a simple way, using a shaman as bait, a lonely pygmy can defeat a whole elephant!  Of course, this is a bit different from what the author intended.  But why did this happen?  In fact, everything is simple.  An elephant can be taken if all four cells on which it stands are under combat.  Now let's see the code: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">set-attribute</span></span> vulnerable? (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">attacked</span></span>? ul) (<span class="hljs-name"><span class="hljs-name">attacked</span></span>? ur) (<span class="hljs-name"><span class="hljs-name">attacked</span></span>? dl) (<span class="hljs-name"><span class="hljs-name">attacked</span></span>? dr)))</code> </pre><br>  Everything is quite transparent and it would even work if only the "pygmies" participated in the game.  Performing a battle with the ‚Äúknight's move‚Äù, they <b>do not</b> attack the squares of the 2x2 square on which they are located.  Shaman - is another matter!  It "covers" 3 of the 4 fields of the square on which it stands.  It remains to ‚Äúcover‚Äù the field on which the shaman himself is located and the trap is ready.  And it does not matter that the shaman will be eaten - the attribute of the vulnerability will <b>already</b> be installed and the whole next move will work! <br><br>  By understanding the error, you can easily fix it.  The <a href="https://github.com/GlukKazan/ZoG/commit/c78cab2fc6c32ca8eaf1c0f270ceed935b4bbf7d">patch</a> itself is quite verbose, but its essence is simple.  We refuse to use the predicate <b>attacked?</b>  in this game (it simply does not fit here) and is replaced by manual checks.  A more flexible approach allows for special treatment for the "shaman".  With the appearance of the game, unfortunately, nothing can be done.  The picture constantly ‚Äúbreaks‚Äù.  This game is not very suitable for Zillions of Games (but the idea itself is certainly interesting). <br><br><h4>  <b>Do not look back!</b> </h4><br>  In the process of working on new games, I know the Zillions of Games platform better.  Complete new solutions come to my mind, which I couldn‚Äôt have thought of before.  Often they are so good that they allow other older games to be fixed.  So, in one of the <a href="http://skyruk.livejournal.com/493105.html">articles by</a> Dmitry Skiryuk, a very original game " <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D2524">Duel</a> " is described, in which instead of chess pieces there are used dice. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/PiT2WN8ixpg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  When performing a move, the cube rolls across the board to the number of steps that was depicted on its upper face at the beginning of the turn.  Movement is not performed in a straight line, the direction can be changed in an arbitrary manner.  This is important because the face to which the cube will be turned upwards at the end of the turn will depend not only on the starting and ending point, but also on the chosen path of movement. <br><br>  This kind of movement (with possible changes in direction at each step) in board games is quite common.  This and Thunderclap in " <a href="https://geektimes.ru/post/269152/">Ko Shogi</a> " and quiet moves of the figures in the " <a href="https://habrahabr.ru/post/283502/">Nine-Tile Cyvasse</a> " and much more.  The main problem associated with it is the need to prohibit returning to previously completed fields.  If the maximum distance does not exceed three steps (as in Claude Leroy‚Äôs <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D2462">Mana</a> game), it is enough to prohibit the change of direction to the exact opposite (for this, the ZRF has a remarkable predicate <b>not-last-from?</b> ). <br><br><div class="spoiler">  <b class="spoiler_title">Strictly speaking, he does not always save</b> <div class="spoiler_text">  In the implementation of <a href="">Mana</a> on ZRF, this technique works, but can lead to a crash of the game.  In the game it is possible (although unlikely) a situation in which one or two of the first partial moves will lead a figure into a dead end, from which there is no way out.  This is due to the fact that each partial move is considered independent, independent of the others.  <a href="http://www.zillions-of-games.com/">Zillions of Games</a> can not see the problem until it "rests on her nose."  <a href="https://www.jocly.com/">Jocly</a> , considering the entire compound course as a whole, allows us to construct a more correct <a href="https://www.jocly.com/">implementation</a> . <br></div></div><br>  If the figure can move more than 3 steps, <b>not-last-from?</b>  no longer saves.  You must somehow mark <b>all</b> previously passed fields.  In ZRF, for binding to fields of Boolean values, so-called ‚Äúpositional flags‚Äù are used.  Unfortunately, they are not part of the game state and are automatically cleared at the beginning of each <b>partial</b> move. <br><br><div class="spoiler">  <b class="spoiler_title">The exit, of course, is</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> clear-mark mark a0 (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? next) next (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> enemy? (<span class="hljs-name"><span class="hljs-name">piece</span></span>? Mark)) capture ) ) back ) (<span class="hljs-name"><span class="hljs-name">define</span></span> step ( (<span class="hljs-name"><span class="hljs-name">create</span></span> Mark) $<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">verify</span></span> (<span class="hljs-name"><span class="hljs-name">my-empty</span></span>?)) (<span class="hljs-name"><span class="hljs-name">clear-mark</span></span>) (<span class="hljs-name"><span class="hljs-name">add-partial</span></span> $<span class="hljs-number"><span class="hljs-number">2</span></span> $<span class="hljs-number"><span class="hljs-number">3</span></span>) ))</code> </pre><br></div></div><br>  Invisible figures can be placed on the visited fields (they are certainly part of the state).  The main thing is not to forget to delete them in time!  This technique is so versatile that it can be useful in a variety of completely different games.  First of all, various transitional games such as <a href="http://skyruk.livejournal.com/424973.html">Salta</a> or <a href="http://skyruk.livejournal.com/488033.html">Traverse</a> come to mind, but the game is not limited to games of the <a href="https://ru.wikipedia.org/wiki/%25D0%25A5%25D0%25B0%25D0%25BB%25D0%25BC%25D0%25B0">Halma</a> family.  The same technique allowed to bring to the "working" state " <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D2515">Luzhanqi</a> " and the long time ago written " <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D2351">Ossetian checkers</a> ". <br><br><h4>  <b>Instead of an epilog ...</b> </h4><br>  Continuing the conversation about drafts, I want to note that the ‚Äúwork on the bugs‚Äù is not always reduced to purely technical issues.  Very often, in the process of working on the game, I learn something new.  Sometimes these ‚Äúdetails‚Äù literally turn over all my ideas about the game, forcing me to look at it in a new way.  As an example, I want to talk about one of the most interesting varieties of " <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D1%2583%25D1%2580%25D0%25B5%25D1%2586%25D0%25BA%25D0%25B8%25D0%25B5_%25D1%2588%25D0%25B0%25D1%2588%25D0%25BA%25D0%25B8">Turkish drafts</a> ". <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/wAGwt0Bp8ss" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  This game is played in <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B0%25D1%2585%25D1%2580%25D0%25B5%25D0%25B9%25D0%25BD">Bahrain</a> .  All the rules of "Turkish drafts" are executed.  Only one new rule is introduced, which is absent in the original game.  This rule is very simply formulated and, in some cases, significantly affects the character of the game, making it more combinational.  For me it was a very unexpected and interesting find.  Can you determine what it is, by recording the game? <br><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text">  The rule came as a surprise to me.  In the variety of ‚ÄúTurkish drafts‚Äù, which is played in Bahrain, the concept of the <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D1%2585_(%25D1%2588%25D0%25B0%25D1%2585%25D0%25BC%25D0%25B0%25D1%2582%25D1%258B)">Shah</a> is introduced, very similar to chess.  The situation when one of the figures is attacked is called ‚ÄúKish‚Äù (ÿ¥ŸÉ).  The rules prohibit responding with an attack if, in a previous move, the enemy attacked one of your pieces (that is, to do "kish ... kish").  At the same time, it is not necessary to eliminate the threat.  You can make any move, provided that it does not threaten the enemy. <br><br>  Since the tactic of "retaliatory" attack is widely used in the "Turkish checkers", such innovation is very piquantly diversifies the game.  In turn, it was very interesting for me to learn something new about drafts, and also to try to express it through <a href="https://github.com/GlukKazan/ZoG/commit/c09e518984ddf79d9ccbd4a89edc38e51c620815">ZRF</a> . <br></div></div><br></div><p>Source: <a href="https://habr.com/ru/post/310292/">https://habr.com/ru/post/310292/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310278/index.html">Gitlab-CI and Ansible-lint syntax checking</a></li>
<li><a href="../310282/index.html">The second wave of fateful changes GitHub</a></li>
<li><a href="../310284/index.html">React.js: build an isomorphic / universal application from scratch. Part 2: add bootstrap, pages and routing</a></li>
<li><a href="../310286/index.html">What links to use: absolute or relative?</a></li>
<li><a href="../310288/index.html">ClusterR clustering, part 1</a></li>
<li><a href="../310294/index.html">The digest of interesting materials for the mobile developer # 171 (September 12-18)</a></li>
<li><a href="../310296/index.html">Voice and video for programmers. How we create a realtime communications conference</a></li>
<li><a href="../310298/index.html">Chinese government may ban high-PUE data centers</a></li>
<li><a href="../310300/index.html">How to officially accept foreign currency payments from abroad in Russia (PI)</a></li>
<li><a href="../310302/index.html">Universal (Isomorphic) project on Koa 2.x + React + Redux + React-Router</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>