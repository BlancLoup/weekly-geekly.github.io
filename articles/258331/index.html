<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HTML page on Canvas</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Canvas is an interesting and perspective HTML5 element. It is well suited as an auxiliary element on an HTML page, for example, for drawing some simpl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HTML page on Canvas</h1><div class="post__text post__text-html js-mediator-article">  Canvas is an interesting and perspective HTML5 element.  It is well suited as an auxiliary element on an HTML page, for example, for drawing some simple plot of a dynamic splash screen.  However, the implementation of functionally complete integrated solutions with a focus on the Canvas task is not so simple. <br><br><img src="https://habrastorage.org/files/572/d0c/9d9/572d0c9d969a4b298dddb02b905ead0b.jpg" alt="Image - html page on canvas"><br><br>  Purpose of the article: <br><ul><li>  Consider the implementation mechanism based on Canvas full HTML pages with support for dynamic content, links and controls. </li><li>  Understand whether it is possible to use this mechanism, and whether the game is worth the candle. </li></ul><a name="habracut"></a><br>  Strengths: <br><ul><li>  Canvas is easily embedded in the HTML DOM, since it is a typical HTML element. </li><li>  Canvas is fast because it has a low-level API and supports the usual raster format. </li></ul><br>  Weak sides: <br><ul><li>  Canvas does not support the HTML DOM inside itself, so you cannot simply put useful content, links and controls on the Canvas. </li><li>  Low-level API is too simple, and the use of JavaScript libraries leads to inevitable loss of performance, which ultimately limits the range of Canvas. </li></ul><br>  The best way to figure it out is to make out a simple but illustrative example.  The example was compiled as a partial generalization of knowledge that can be obtained in a disparate form by reading the materials on the links: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://www.w3schools.com/tags/ref_canvas.asp">Canvas Reference</a> <br>  <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial">Canvas training</a> <br>  <a href="http://www.html5canvastutorials.com/">Canvas examples</a> <br>  <a href="http://www.ibm.com/developerworks/ru/library/wa-htmlmark/">Interesting article part 1</a> <br>  <a href="http://www.ibm.com/developerworks/ru/library/wa-htmlmark2/">Interesting article part 2</a> <br><br>  <a href="https://github.com/apelserg/stencil-html-integrate-page-on-canvas">Sample code on GitHab-e (just open the htm file in the browser from the disk)</a> <br>  <a href="http://www.apelserg.ru/open-html5-stencils/stencil-html-integrate-page-on-canvas/html-integrate-page-on-canvas.htm">Demo example (quickly see the result)</a> <br><br><h4>  Work environment </h4><br>  <b>Development environment:</b> <br><br>  FF (Windows, Linux Mint) is used as the main browser. <br>  To check the compatibility of CR and IE (Windows). <br>  Next - available gadgets (about this at the end). <br><br>  IDE under Widows - Visual Studio Community, Notepad.  The studio is free, it formats the code well, accepts auto-additions acceptably and finds obvious errors (for example, the parenthesis is missing). <br>  Linux IDE - gedit. <br><br>  <b>Architectural approach:</b> <br><br>  Frontend, static server. <br>  Native API without external libraries.  The absence of libraries is not an end in itself, just as long as you can do without them. <br><br>  <b>Code structure:</b> <br><br>  The code could be pushed into a single file (not so much code).  But, to make it clearer, it is better to spread it by file: <br><br>  HTML page: html_page_on_canvas.htm <br>  Common code: html_page_on_canvas_main.js <br>  Model management code: html_page_on_canvas_model.js <br>  Canvas drawing control code: html_page_on_canvas_canva.js <br><br>  <b>Global variables:</b> <br><br>  Global variables are bad.  Without a global scope, it is difficult to live.  As a compromise, a global APELSERG object was created, in which all functions and global variables are stored: <br><br>  MAIN: general functions <br>  MODEL: model change functions <br>  MODEL.DATA: model data <br>  CANVA: model rendering functions <br>  CONFIG: global variables <br><br><h4>  Model </h4><br>  The basic structure of the operation is based on the classic MVC pattern: <br><br>  The role of Model is performed by MODEL.DATA data. <br>  The role of View is performed by CANVA functions. <br>  The role of the Controller is performed by the MODEL function. <br><br>  Let's start implementing the page objects.  To whom both, and I always liked it when it is snowing on advertising banners.  I wish the snow was all over the page.  Now it can be implemented.  In general, there is no magic in this - Canvas and is designed to implement this kind of tasks. <br><br>  Each snowflake is an object: <br><br><pre><code class="javascript hljs">APELSERG.MODEL.Flake = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">flakeX, flakeY, flakeSize, flakeColor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.BaseX = flakeX; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.X = flakeX; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Y = flakeY; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Size = flakeSize; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Color = flakeColor; }</code> </pre> <br>  Here it is important to consider that the possibility of dynamics is laid inside the object - changing the properties of X and Y. <br><br>  To organize the snowfall, an array of snowflakes is created: <br><br><pre> <code class="javascript hljs">APELSERG.MODEL.MakeFlakes = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">flakeNum</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> flakes = []; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> color = <span class="hljs-string"><span class="hljs-string">"white"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = <span class="hljs-number"><span class="hljs-number">0</span></span>; n &lt; flakeNum; n++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * APELSERG.CONFIG.SET.PicWidth); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * APELSERG.CONFIG.SET.PicHeight); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = n % APELSERG.CONFIG.SET.FlakesSize; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> flake = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> APELSERG.MODEL.Flake(x, y, s, color); flakes.push(flake); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> flakes; }</code> </pre><br>  For clarity, the content will also be dynamic.  To do this, each line will be stored as a separate object: <br><br><pre> <code class="javascript hljs">APELSERG.MODEL.ContentLine = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text, textX, textY, textColor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Text = text; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.X = textX; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Y = textY; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Color = textColor; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.FontHeight = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br>  Here in the dynamics, in addition to movement, laid the possibility of changing the size of the font - the property FontHeight.  Alternatively, you can store words and even letters separately.  So you can simulate a variety of dynamic visual effects. <br><br>  For content selected nursery rhymes on winter themes: <br><br><pre> <code class="javascript hljs">ROOT.MODEL.MakeContent = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> color = <span class="hljs-string"><span class="hljs-string">"white"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pointX = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pointY = ROOT.CONFIG.PROC.CanvaID.height; <span class="hljs-comment"><span class="hljs-comment">//    var addY = 30; //    var Cnt = 0; //    var content = []; content.push(new ROOT.MODEL.ContentLine("   ", pointX, pointY + addY * Cnt++, color)); content.push(new ROOT.MODEL.ContentLine("   ", pointX, pointY + addY * Cnt++, color)); content.push(new ROOT.MODEL.ContentLine("   ", pointX, pointY + addY * Cnt++, color)); content.push(new ROOT.MODEL.ContentLine(" ", pointX, pointY + addY * Cnt++, color)); return content; }</span></span></code> </pre><br>  In fairness, I must say that storing content in a function is not good.  This approach is used solely as an example.  In the working environment, dynamic content can be loaded, for example, from a web service. <br><br><h4>  Animation </h4><br>  For animation in modern browsers there is a special function - window.requestAnimationFrame.  This is a typical code for its activation: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//--      window.MyRequestAnimationFrame = (function (callback) { return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function (callback) { window.setTimeout(callback, 1000 / 60); }; })(); //--   MyAnimation = function () { //--   //--    Canvas //--   window.MyRequestAnimationFrame(function () { MyAnimation(); }); }</span></span></code> </pre><br>  From the example it can be seen that the requestAnimationFrame, in a functional basis, simply starts on a timeout 60 times per second.  But it‚Äôs good because, unlike setTimeout, it is synchronized with browser redraw cycles and can adjust to the resources of the device on which it is running.  Read more about requestAnimationFrame <a href="http://html5.by/blog/what-is-requestanimationframe/">here</a> . <br><br>  Among the shortcomings, it should be noted that this is a resource-intensive task for the CPU, since the Canvas will be redrawn regardless of whether something has changed in the model or not.  A large model is not always possible to recalculate and draw in the allotted period of time. <br><br>  Using the CONFIG.SET.CntHandle variable, a simple mechanism is implemented to separate the processes of changing the model and drawing over different requestAnimationFrame cycles.  The mechanism is not perfect, but easily controlled.  The quality criterion is subjective visual perception: if it looks comfortable, then everything is fine.  It remains to find the correct value for CONFIG.SET.CntHandle. <br><br>  In the example, window.requestAnimationFrame is used without a compatibility wrapper.  The result is a function to control all animation processes: <br><br><pre> <code class="javascript hljs">APELSERG.MAIN.Animation = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ (APELSERG.CONFIG.SET.CntHandle &gt; APELSERG.CONFIG.PROC.CntHandle) ? (APELSERG.CONFIG.PROC.CntHandle++) : (APELSERG.CONFIG.PROC.CntHandle = <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (APELSERG.CONFIG.PROC.CntHandle == <span class="hljs-number"><span class="hljs-number">0</span></span>) APELSERG.CANVA.Rewrite(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (APELSERG.CONFIG.PROC.CntHandle == <span class="hljs-number"><span class="hljs-number">1</span></span>) APELSERG.MODEL.UpdateContent(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (APELSERG.CONFIG.PROC.CntHandle == <span class="hljs-number"><span class="hljs-number">2</span></span>) APELSERG.MODEL.UpdateFlakes(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.requestAnimationFrame(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ APELSERG.MAIN.Animation(); }); }</code> </pre><br><br>  A few notes: <br><ul><li>  The criterion for the next drawing is always a change in the model.  That is, if the model has not changed, then there is no need to redraw the Canvas.  For example, it makes sense to animate a chess game only after the next move.  If this is taken into account, then, in some cases, you can significantly unload the CPU. </li><li>  RequestAnimationFrame is designed so that it does not guarantee the time between calls, as it is intended, first of all, to ensure the visibility of the animation process.  And for the model it is often the stability of time intervals that is important.  The model change cycle can be implemented at setTimeout (not shown in the example). </li></ul><br>  Criteria for animation of snow and content - simplicity and compactness of the code. <br><br>  Snowflake animation (model change): <br><br><pre> <code class="javascript hljs">APELSERG.MODEL.UpdateFlakes = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> APELSERG.MODEL.DATA.Flakes) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> flake = APELSERG.MODEL.DATA.Flakes[n]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dir = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * <span class="hljs-number"><span class="hljs-number">100</span></span>) % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) dir = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shift = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * <span class="hljs-number"><span class="hljs-number">100</span></span>) % <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> move = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * <span class="hljs-number"><span class="hljs-number">100</span></span>) % <span class="hljs-number"><span class="hljs-number">2</span></span> + APELSERG.CONFIG.SET.FlakesMove; <span class="hljs-comment"><span class="hljs-comment">//    if (((flake.X + shift * dir) &lt; (flake.BaseX + 10)) &amp;&amp; ((flake.X + shift * dir) &gt; (flake.BaseX - 10))) { flake.X += shift * dir; } //   flake.Size += dir; if (flake.Size &gt; APELSERG.CONFIG.SET.FlakesSize) flake.Size = APELSERG.CONFIG.SET.FlakesSize; if (flake.Size &lt; 0) flake.Size = 0; //   flake.Y += move; if (flake.Y &gt; APELSERG.CONFIG.SET.PicHeight) flake.Y = 1; } }</span></span></code> </pre><br>  Content animation (model change): <br><br><pre> <code class="javascript hljs">APELSERG.MODEL.UpdateContent = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = <span class="hljs-number"><span class="hljs-number">0</span></span>; APELSERG.MODEL.DATA.Content.length &gt; n; n++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contentLine = APELSERG.MODEL.DATA.Content[n]; <span class="hljs-comment"><span class="hljs-comment">//   contentLine.Y -= APELSERG.CONFIG.SET.ContentMove; //     if (contentLine.Y &gt; 150 &amp;&amp; contentLine.Y &lt; APELSERG.CONFIG.PROC.CanvaID.height - 50) { if (contentLine.FontHeight &lt; APELSERG.CONFIG.SET.ContentFontSize) { contentLine.FontHeight++; } } else { if (contentLine.FontHeight &gt; 0) contentLine.FontHeight--; } } }</span></span></code> </pre><br>  After changing the model, it is drawn on the Canvas.  The background can be any suitable photo.  All the rendering is done by one simple function: <br><br><pre> <code class="javascript hljs">APELSERG.CANVA.Rewrite = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ctx = APELSERG.CONFIG.PROC.Ctx; <span class="hljs-comment"><span class="hljs-comment">//  ctx.drawImage(APELSERG.CONFIG.PROC.Img, 0, 0); //  for (var n = 0 in APELSERG.MODEL.DATA.Content) { var content = APELSERG.MODEL.DATA.Content[n]; if (content.X &gt;= 0 &amp;&amp; content.Y &gt;= 0 &amp;&amp; content.FontHeight &gt; 0) { ctx.font = content.FontHeight.toString() + "px Arial"; ctx.textAlign = "center"; ctx.fillStyle = content.Color; ctx.fillText(content.Text, APELSERG.CONFIG.PROC.CanvaID.width / 2, content.Y); } } //  ( ) for (var n = 0 in APELSERG.MODEL.DATA.Flakes) { var flake = APELSERG.MODEL.DATA.Flakes[n]; ctx.beginPath(); ctx.arc(flake.X, flake.Y, flake.Size / 2, 0, 2 * Math.PI); ctx.fillStyle = flake.Color; ctx.fill(); } }</span></span></code> </pre><br><h4>  Adding functional buttons and links </h4><br>  Functional buttons and links are also dynamic objects (similar to snow and content).  But the dynamics of these objects is not movement, but a change in color when you hover or click on them. <br><br>  Object describing the command: <br><br><pre> <code class="javascript hljs">APELSERG.MODEL.Command = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cmdCode, cmdName, cmdX, cmdY, lengthX, lengthY, cmdColor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Code = cmdCode; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name = cmdName; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.X = cmdX; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Y = cmdY; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LengthX = lengthX; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LengthY = lengthY; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Color = cmdColor; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SelectColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SelectCnt = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SelectName = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ShowBorder = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.FontHeight = <span class="hljs-number"><span class="hljs-number">20</span></span>; }</code> </pre><br>  Object describing the link: <br><br><pre> <code class="javascript hljs">APELSERG.MODEL.Link = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">linkUrl, linkName, linkX, linkY, lengthX, lengthY, linkColor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Url = linkUrl; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name = linkName; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.X = linkX; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Y = linkY; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LengthX = lengthX; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LengthY = lengthY; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Color = linkColor; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SelectColor = <span class="hljs-string"><span class="hljs-string">'lightblue'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SelectCnt = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SelectName = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ShowBorder = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.FontHeight = <span class="hljs-number"><span class="hljs-number">20</span></span>; }</code> </pre><br>  Although the objects are similar in structure, for convenience, they are described as different entities. <br><br>  When the mouse moves, its coordinates are stored in global variables: <br><br><pre> <code class="javascript hljs">APELSERG.CONFIG.PROC.CanvaID.addEventListener(<span class="hljs-string"><span class="hljs-string">'mousemove'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ APELSERG.CONFIG.PROC.MouseMoveX = event.clientX - APELSERG.CONFIG.PROC.CanvaID.offsetLeft - APELSERG.CONFIG.SET.PicBorder; APELSERG.CONFIG.PROC.MouseMoveY = event.clientY - APELSERG.CONFIG.PROC.CanvaID.offsetTop - APELSERG.CONFIG.SET.PicBorder; });</code> </pre><br>  When processing the model, the mouse coordinates are compared with the location of the reference object or command: <br><br><pre> <code class="javascript hljs">APELSERG.MODEL.CheckMoveFrame = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">frame</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((APELSERG.CONFIG.PROC.MouseMoveX &gt; frame.X) &amp;&amp; (APELSERG.CONFIG.PROC.MouseMoveX &lt; frame.X + frame.LengthX) &amp;&amp; (APELSERG.CONFIG.PROC.MouseMoveY &gt; frame.Y) &amp;&amp; (APELSERG.CONFIG.PROC.MouseMoveY &lt; frame.Y + frame.LengthY)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  If the mouse cursor hits the object, then the SelectName property is set: <br><br><pre> <code class="javascript hljs">command.SelectName = APELSERG.MODEL.CheckMoveFrame(command);</code> </pre><br>  Similarly, a click is processed: <br><br><pre> <code class="javascript hljs">APELSERG.CONFIG.PROC.CanvaID.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ APELSERG.CONFIG.PROC.MouseClickX = event.clientX - APELSERG.CONFIG.PROC.CanvaID.offsetLeft - APELSERG.CONFIG.SET.PicBorder; APELSERG.CONFIG.PROC.MouseClickY = event.clientY - APELSERG.CONFIG.PROC.CanvaID.offsetTop - APELSERG.CONFIG.SET.PicBorder; }); APELSERG.MODEL.CheckClickFrame = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">frame</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((APELSERG.CONFIG.PROC.MouseClickX &gt; frame.X) &amp;&amp; (APELSERG.CONFIG.PROC.MouseClickX &lt; frame.X + frame.LengthX) &amp;&amp; (APELSERG.CONFIG.PROC.MouseClickY &gt; frame.Y) &amp;&amp; (APELSERG.CONFIG.PROC.MouseClickY &lt; frame.Y + frame.LengthY)){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  If the click is on an object, then the SelectCnt property is set: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (APELSERG.MODEL.CheckClickFrame(command)) command.SelectCnt = APELSERG.CONFIG.SET.CntSelect;</code> </pre><br>  SelectCnt sets the number of animation cycles during which the frame will be highlighted. <br><br>  After it was determined on which element was pressed, execute the desired command or click on the link is no longer difficult. <br><br>  It makes sense to briefly describe the implementation of the stop and resume animation cycle. <br><br>  At the very beginning, the animation loop starts when the form loads (APELSERG.MAIN.Animation () in the function APELSERG.MAIN.OnLoad ()).  To stop, you simply need to stop resuming the animation loop as requestedAnimationFrame.  Stopping occurs when the APELSERG.CONFIG.PROC.Stop flag is set.  It does not make sense to cancel cancelAnimationFrame, in a single cycle with requestAnimationFrame, since it cancels an already running cycle, which is meaningless (the new cycle starts anyway).  In order to resume the animation loop, you need to reset the APELSERG.CONFIG.PROC.Stop flag and start APELSERG.MAIN.Animation ().  This happens by double clicking the mouse or ‚ÄúF2‚Äù on the keyboard. <br><br>  If you press "F1" in the animation mode, it will also stop, but using cancelAnimationFrame without setting the APELSERG.CONFIG.PROC.Stop flag.  Resuming a double-click animation will not succeed, this will be prevented by the reset flag APELSERG.CONFIG.PROC.Stop.  The animation resumption mechanism, for this case, is provided only by pressing "F2".  The stop for ‚ÄúF1‚Äù was added specifically to demonstrate the mechanism of work cancelAnimationFrame: <br><br><pre> <code class="javascript hljs">APELSERG.CONFIG.PROC.CanvaID.addEventListener(<span class="hljs-string"><span class="hljs-string">'dblclick'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (APELSERG.CONFIG.PROC.Stop) { APELSERG.CONFIG.PROC.Stop = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; APELSERG.CONFIG.PROC.ShowCommands = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//--      APELSERG.MAIN.Animation(); } }); window.addEventListener('keydown', function (event) { if (event.keyCode == APELSERG.CONFIG.KEY.F1) { window.cancelAnimationFrame(APELSERG.CONFIG.PROC.TimeoutID); } if (event.keyCode == APELSERG.CONFIG.KEY.F2) { APELSERG.CONFIG.PROC.Stop = true; window.cancelAnimationFrame(APELSERG.CONFIG.PROC.TimeoutID); if(APELSERG.CONFIG.PROC.Stop) { APELSERG.CONFIG.PROC.Stop = false; APELSERG.CONFIG.PROC.ShowCommands = false; //--      APELSERG.MAIN.Animation(); } } });</span></span></code> </pre><br><br><h4>  Adding data entry controls </h4><br>  With controls that are responsible for data entry, everything is not so clear.  A simple element, for example, increasing / decreasing the value, can be implemented as described above (in the example, these are the "+" and "-" buttons). <br><br>  But, if the question is about a full-fledged input element - a drop-down list or a data line entry, then the implementation of such a task within Canvas is much more complicated. <br><br>  In this case, the so-called ‚Äúhybrid‚Äù approach can help.  That is, for data entry, in addition to Canvas, standard HTML DOM elements are used.  Elements can be created statically and hidden under Canvas using absolute positioning and Z indexing.  Or create dynamically at the time of entry.  The example shows the dynamic creation of two input elements.  One input element is located on top of the Canvas (the APELSERG.MAIN.ShowSettingsTextSpeed ‚Äã‚Äã() function).  The other is outside the Canvas (the APELSERG.MAIN.ShowSettingsThemeSelect () function).  Functionally, both options work, but the element that is located on top of the Canvas has problems when scaling (Ctrl +, Ctrl-). <br><br><h4>  Dynamic adaptability </h4><br>  After the basic example (Snowfall) was developed, it seemed not very interesting.  Therefore, the example is expanded by topics.  For the background of the themes, photos of different sizes were specially selected to check and debug the dynamics of the Canvas. <br><br>  The function is responsible for the dynamics: <br><br><pre> <code class="javascript hljs">APELSERG.MAIN.CanvasSize = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (APELSERG.CONFIG.SET.PicWidth &lt; <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerWidth * <span class="hljs-number"><span class="hljs-number">0.9</span></span>) &amp;&amp; APELSERG.CONFIG.PROC.CanvaID.width != APELSERG.CONFIG.SET.PicWidth) { APELSERG.CONFIG.PROC.CanvaID.width = APELSERG.CONFIG.SET.PicWidth; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (APELSERG.CONFIG.SET.PicWidth &gt; <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerWidth * <span class="hljs-number"><span class="hljs-number">0.9</span></span>) &amp;&amp; APELSERG.CONFIG.PROC.CanvaID.width != <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerWidth * <span class="hljs-number"><span class="hljs-number">0.9</span></span>)) { APELSERG.CONFIG.PROC.CanvaID.width = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerWidth * <span class="hljs-number"><span class="hljs-number">0.9</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (APELSERG.CONFIG.SET.PicHeight &lt; <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerHeight * <span class="hljs-number"><span class="hljs-number">0.8</span></span>) &amp;&amp; APELSERG.CONFIG.PROC.CanvaID.height != APELSERG.CONFIG.SET.PicHeight) { APELSERG.CONFIG.PROC.CanvaID.height = APELSERG.CONFIG.SET.PicHeight; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (APELSERG.CONFIG.SET.PicHeight &gt; <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerHeight * <span class="hljs-number"><span class="hljs-number">0.8</span></span>) &amp;&amp; APELSERG.CONFIG.PROC.CanvaID.height != <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerHeight * <span class="hljs-number"><span class="hljs-number">0.8</span></span>)) { APELSERG.CONFIG.PROC.CanvaID.height = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerHeight * <span class="hljs-number"><span class="hljs-number">0.8</span></span>) } }</code> </pre><br>  The function works according to a simple algorithm - if the background photo is smaller than the window size (taking into account the scrolling elements), the Canvas is set to the size of the photo, otherwise the Canvas is set to the window size. <br><br><h4>  Compatibility </h4><br>  Canvas (like HTML5 in general) is a relatively new element and not all devices and browsers support it.  And the HTML page should be displayed always, everywhere and so that it is convenient to work with it.  Compatibility implies not only technological support for the next new feature.  The decisive factors may be, for example, the size and / or resolution of the screen, the presence of controls (there is only a touchscreen), processor performance.  Not until new technologies and beauty, when the basic functions can not be performed. <br><br>  When designing an HTML page, mechanisms should be provided to ensure the necessary level of compatibility.  This statement applies not only to HTML5 and Canvas. <br><br>  The example shows the mechanism of another display of the model - in the form of a classic HTML page.  Everything is done very simply, since this does not apply to the main topic of the article. <br><br>  First, during the boot process, the key signs of compatibility are determined: <br><br><pre> <code class="javascript hljs">APELSERG.MAIN.CheckCompatible = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.requestAnimationFrame || screen.width &lt; <span class="hljs-number"><span class="hljs-number">1000</span></span>) { APELSERG.CONFIG.SET.CompatibleType = <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> </pre><br>  And, if the display of the Canvas is impossible or undesirable, a simple HTML page is formed with the function APELSERG.MODEL.ContentAsHtmlText (). <br><br><h4>  Canvas problems </h4><br>  Canvas periodically "lag".  Lags appear even at low load.  Subjectively - the time and frequency of lags depend on the specific device, operating system and browser.  The essence of the problem, apparently, lies in the single-threaded event loop and / or in the garbage collector. </div><p>Source: <a href="https://habr.com/ru/post/258331/">https://habr.com/ru/post/258331/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258321/index.html">Win32 / Spy.Bebloh banking trojan is used to steal online banking data</a></li>
<li><a href="../258323/index.html">How to stop worrying about backing up, or Oracle Zero Data Loss Recovery Appliance</a></li>
<li><a href="../258325/index.html">Managing dependencies in iOS applications correctly: Getting to know Typhoon</a></li>
<li><a href="../258327/index.html">Let's Lab. IS-IS routing protocol. Part 4 (final)</a></li>
<li><a href="../258329/index.html">DevConf 2015: 38 parrots or how a conference of communities of developers is trying to survive in the blockade of import substitution</a></li>
<li><a href="../258333/index.html">All publications by Habrahabr, Hiktaims, Megamind in one place</a></li>
<li><a href="../258335/index.html">Vulnerability in KCodes NetUSB in D-Link, NETGEAR, TP-LINK, Trendnet, ZyXEL and other routers</a></li>
<li><a href="../258337/index.html">A fistful of relays. Part 2 - Register File</a></li>
<li><a href="../258343/index.html">Apple has released the first update for Watch OS</a></li>
<li><a href="../258351/index.html">Three-dimensional figures of Soma as an idea for the children's designer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>