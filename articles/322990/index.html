<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing mnemonic editor for SCADA-system on Fabric.js</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day everyone. Today I will tell you how I wrote a mnemoscheme editor for a SCADA system on fabric.js. The share of dextop SCADA-systems is slowly...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing mnemonic editor for SCADA-system on Fabric.js</h1><div class="post__text post__text-html js-mediator-article">  Good day everyone.  Today I will tell you how I wrote a mnemoscheme editor for a SCADA system on fabric.js.  The share of dextop SCADA-systems is slowly but surely decreasing.  Everything translates to the Web, and the process control system is no exception. <br><a name="habracut"></a><br>  So, what we want to get in the end: SCADA server runs as a Windows service.  Technological data obtained from OPC servers.  To service http requests on the server, we use the idhttpServer component.  On the client side, the mnemonic will be displayed in the browser.  The graphics are only SVG, so that the scheme itself changes to the user's screen resolution. <br><br>  Accordingly, what we want from the editor: <br><br><ul><li>  Drawing the simplest shapes: rectangles, circles, lines, text. </li><li>  Inserting ready-made SVG images created by other more advanced editors. </li><li>  Resizing shapes, moving the mouse around the screen, moving the keyboard arrows. </li><li>  Copy / Paste / Delete. </li><li>  Binding of the object to the data received from the equipment (by ID). </li><li>  Saving to file, opening from file. </li></ul><br>  All this could be done by writing an editor under Windows.  But the difficulty was in rendering small SVG images.  And I thought, if we display the mnemonic diagram in the browser, then why not draw it in the browser?  After all, the browser is the best SVG and render. <br>  This is <a href="https://habrahabr.ru/post/162367/">where fabric.js</a> was found, which almost came up for this purpose. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Adding, copying, pasting simple elements is trivial, everything is as written in the documentation.  Here I will not bring it. <br><br>  But with the insertion and copying of SVG-images is not all smooth.  Next, I will describe how I circumvented the fabric.js bugs. <br><br>  There are 2 ways to insert a finished SVG image on canvas: <br><br><ul><li>  All SVG-image is inserted as a whole (grouped) </li><li>  The image is inserted immediately ungrouped.  Each element can be individually moved. </li></ul><br>  The main problem is that when the SVG element <code>&lt;rect x="0" y="0"</code> has the property <code>transform="translate(168 202)"</code> , the SVG is drawn on the canvas in coordinates <code>168 202</code> , and the pointers for resizing appear in another place, in the coordinates <code>x="0" y="0"</code> . <br><br>  <a href="https://github.com/kangax/fabric.js/issues/1520">Judging by this</a> such a sore from his birth.  This means that we insert the SVG image already grouped. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> addShape = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shapeName</span></span></span><span class="hljs-function">) </span></span>{ fabric.loadSVGFromURL(<span class="hljs-string"><span class="hljs-string">'./assets/'</span></span> + shapeName + <span class="hljs-string"><span class="hljs-string">'.svg'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">objects, options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> loadedObject = fabric.util.groupSVGElements(objects, options); loadedObject.set({ <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">angle</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }) .setCoords(); canvas.add(loadedObject); }); };</code> </pre><br>  The same bug (or feature?) Appears when copying / pasting.  The standard clone method with SVG does not work.  When inserting, the pointers for resizing do not overlap with the inserted image, so first we bring the coordinates of the original image to 0: <br><br><pre> <code class="javascript hljs">canvas.getActiveGroup().setTop(<span class="hljs-number"><span class="hljs-number">0</span></span>); canvas.getActiveGroup().setLeft(<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br>  Then, we present the image in the form of text, create a new image from the text, restore the coordinates of the original image. <br><br><div class="spoiler">  <b class="spoiler_title">Copy to internal buffer:</b> <div class="spoiler_text"><pre> <code class="javascript hljs">CopyClip = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> activeObject = canvas.getActiveObject(), activeGroup = canvas.getActiveGroup(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activeGroup) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tx_top = canvas.getActiveGroup().getTop(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tx_left = canvas.getActiveGroup().getLeft(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tx_Angle = canvas.getActiveGroup().getAngle(); canvas.getActiveGroup().setAngle(<span class="hljs-number"><span class="hljs-number">0</span></span>); canvas.getActiveGroup().setTop(<span class="hljs-number"><span class="hljs-number">0</span></span>); canvas.getActiveGroup().setLeft(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tx = canvas.getActiveGroup().toSVG(); tx = <span class="hljs-string"><span class="hljs-string">'&lt;?xml version="1.0" standalone="no"?&gt;&lt;!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"&gt;&lt;svg width="100%" height="100%" version="1.1" xmlns="http://www.w3.org/2000/svg"&gt;'</span></span> +tx+ <span class="hljs-string"><span class="hljs-string">'&lt;/svg&gt;'</span></span>; canvas.getActiveGroup().setAngle(tx_Angle); canvas.getActiveGroup().setTop(tx_top); canvas.getActiveGroup().setLeft(tx_left); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loadSVG = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">svg</span></span></span><span class="hljs-function">) </span></span>{ fabric.loadSVGFromString(svg, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">objects, options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = fabric.util.groupSVGElements(objects, options); canvas.add(obj).centerObject(obj).renderAll(); obj.setCoords(); }); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loadSVGWithoutGrouping = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">svg</span></span></span><span class="hljs-function">) </span></span>{ fabric.loadSVGFromString(svg, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">objects</span></span></span><span class="hljs-function">) </span></span>{ canvas.add.apply(canvas, objects); canvas.renderAll(); }); }; Buff_clipb = tx; canvas.getActiveGroup().setAngle(tx_Angle); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activeObject) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tx_top = canvas.getActiveObject().getTop(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tx_left = canvas.getActiveObject().getLeft(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tx_Angle = canvas.getActiveObject().getAngle(); canvas.getActiveObject().setAngle(<span class="hljs-number"><span class="hljs-number">0</span></span>); canvas.getActiveObject().setTop(<span class="hljs-number"><span class="hljs-number">0</span></span>); canvas.getActiveObject().setLeft(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tx = canvas.getActiveObject().toSVG(); tx = <span class="hljs-string"><span class="hljs-string">'&lt;?xml version="1.0" standalone="no"?&gt;&lt;!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"&gt;&lt;svg width="100%" height="100%" version="1.1" xmlns="http://www.w3.org/2000/svg"&gt;'</span></span> +tx+ <span class="hljs-string"><span class="hljs-string">'&lt;/svg&gt;'</span></span>; canvas.getActiveObject().setAngle(tx_Angle); canvas.getActiveObject().setTop(tx_top); canvas.getActiveObject().setLeft(tx_left); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loadSVG = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">svg</span></span></span><span class="hljs-function">) </span></span>{ fabric.loadSVGFromString(svg, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">objects, options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = fabric.util.groupSVGElements(objects, options); canvas.add(obj).centerObject(obj).renderAll(); obj.setCoords(); }); } Buff_clipb = tx; canvas.getActiveObject().setAngle(tx_Angle); }; };</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Paste from internal buffer:</b> <div class="spoiler_text"><pre> <code class="javascript hljs">PasteClip = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loadSVG = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">svg</span></span></span><span class="hljs-function">) </span></span>{ fabric.loadSVGFromString(svg, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">objects, options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = fabric.util.groupSVGElements(objects, options); canvas.add(obj).centerObject(obj).renderAll(); obj.setCoords(); }); } _loadSVG(Buff_clipb); };</code> </pre><br></div></div><br>  With drawing lines, too, not everything is smooth.  The thickness of the line in fabric.js depends on the length of the line, which is rather strange.  Therefore, insert the line as SVG. <br><br><div class="spoiler">  <b class="spoiler_title">Line insert</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addLineGoriz</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">wid</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wid2; wid2 = $(<span class="hljs-string"><span class="hljs-string">"#spinner[name=Line_widht_value]"</span></span>).spinner(<span class="hljs-string"><span class="hljs-string">"value"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Line_widht_value '</span></span>, wid2); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> SVGValue_txt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tek_Stroke_color[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-string"><span class="hljs-string">"#"</span></span>) { tek_Stroke_color = <span class="hljs-string"><span class="hljs-string">"#"</span></span>+tek_Stroke_color}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Stroke_col = tek_Stroke_color; SVGValue_txt = <span class="hljs-string"><span class="hljs-string">"&lt;Line x1=\"370\" y1=\"90\" x2=\"570\" y2=\"90\" style=\"stroke: "</span></span>+Stroke_col+<span class="hljs-string"><span class="hljs-string">"; stroke-width:"</span></span>+wid2 +<span class="hljs-string"><span class="hljs-string">"px;\" /&gt;"</span></span>; SVGValue_txt = <span class="hljs-string"><span class="hljs-string">'&lt;?xml version="1.0" standalone="no"?&gt;&lt;!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"&gt;&lt;svg width="100%" height="100%" version="1.1" xmlns="http://www.w3.org/2000/svg"&gt;'</span></span> +SVGValue_txt+ <span class="hljs-string"><span class="hljs-string">'&lt;/svg&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loadSVGWithoutGrouping = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">svg</span></span></span><span class="hljs-function">) </span></span>{ fabric.loadSVGFromString(svg, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">objects</span></span></span><span class="hljs-function">) </span></span>{ canvas.add.apply(canvas, objects); canvas.renderAll(); }); }; _loadSVGWithoutGrouping(SVGValue_txt); };</code> </pre><br></div></div><br>  Move the keyboard arrows elements very convenient. <br><br><div class="spoiler">  <b class="spoiler_title">It is done trivially:</b> <div class="spoiler_text"><pre> <code class="javascript hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).keydown(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">eventObject</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> activeObject = canvas.getActiveObject(), activeGroup = canvas.getActiveGroup(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(<span class="hljs-string"><span class="hljs-string">"[name=Line_widht_value]"</span></span>).is(<span class="hljs-string"><span class="hljs-string">":focus"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> val_width=$( <span class="hljs-string"><span class="hljs-string">"#spinner[name=Line_widht_value]"</span></span> ).spinner(<span class="hljs-string"><span class="hljs-string">"value"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activeObject) { activeObject.setStrokeWidth(val_width); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(<span class="hljs-string"><span class="hljs-string">"[name=opacity_value]"</span></span>).is(<span class="hljs-string"><span class="hljs-string">":focus"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> val_width=$( <span class="hljs-string"><span class="hljs-string">"[name=opacity_value]"</span></span> ).spinner(<span class="hljs-string"><span class="hljs-string">"value"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activeObject) { activeObject.set(<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>,val_width); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(<span class="hljs-string"><span class="hljs-string">"[name=font_size_value]"</span></span>).is(<span class="hljs-string"><span class="hljs-string">":focus"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> val_size=$( <span class="hljs-string"><span class="hljs-string">"#spinnerfont[name=font_size_value]"</span></span> ).spinner(<span class="hljs-string"><span class="hljs-string">"value"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activeObject) { activeObject.set(<span class="hljs-string"><span class="hljs-string">'fontSize'</span></span>,val_size); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((!($(<span class="hljs-string"><span class="hljs-string">"[name=nameobj]"</span></span>).is(<span class="hljs-string"><span class="hljs-string">":focus"</span></span>)))&amp;&amp; (!($(<span class="hljs-string"><span class="hljs-string">"[name=Line_widht_value]"</span></span>).is(<span class="hljs-string"><span class="hljs-string">":focus"</span></span>)))&amp;&amp; (!($(<span class="hljs-string"><span class="hljs-string">"[name=opacity_value]"</span></span>).is(<span class="hljs-string"><span class="hljs-string">":focus"</span></span>)))&amp;&amp;(!($(<span class="hljs-string"><span class="hljs-string">"[name=nametxt]"</span></span>).is(<span class="hljs-string"><span class="hljs-string">":focus"</span></span>)))&amp;&amp; (!($(<span class="hljs-string"><span class="hljs-string">"[name=font_size_value]"</span></span>).is(<span class="hljs-string"><span class="hljs-string">":focus"</span></span>))) ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activeGroup) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventObject.which == <span class="hljs-number"><span class="hljs-number">37</span></span>) { activeGroup.setLeft(activeGroup.getLeft()<span class="hljs-number"><span class="hljs-number">-1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventObject.which == <span class="hljs-number"><span class="hljs-number">39</span></span>) { activeGroup.setLeft(activeGroup.getLeft()+<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventObject.which == <span class="hljs-number"><span class="hljs-number">38</span></span>) { activeGroup.setTop(activeGroup.getTop()<span class="hljs-number"><span class="hljs-number">-1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventObject.which == <span class="hljs-number"><span class="hljs-number">40</span></span>) { activeGroup.setTop(activeGroup.getTop()+<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventObject.which == <span class="hljs-number"><span class="hljs-number">46</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> objectsInGroup = activeGroup.getObjects(); canvas.discardActiveGroup(); objectsInGroup.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">object</span></span></span><span class="hljs-function">) </span></span>{ canvas.remove(object); }); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventObject.which == <span class="hljs-number"><span class="hljs-number">67</span></span>) { CopyClip(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventObject.which == <span class="hljs-number"><span class="hljs-number">86</span></span>) { PasteClip(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activeObject) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventObject.which == <span class="hljs-number"><span class="hljs-number">37</span></span>) { activeObject.setLeft(activeObject.getLeft()<span class="hljs-number"><span class="hljs-number">-1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventObject.which == <span class="hljs-number"><span class="hljs-number">39</span></span>) { activeObject.setLeft(activeObject.getLeft()+<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventObject.which == <span class="hljs-number"><span class="hljs-number">38</span></span>) { activeObject.setTop(activeObject.getTop()<span class="hljs-number"><span class="hljs-number">-1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventObject.which == <span class="hljs-number"><span class="hljs-number">40</span></span>) { activeObject.setTop(activeObject.getTop()+<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventObject.which == <span class="hljs-number"><span class="hljs-number">46</span></span>) { canvas.remove(activeObject); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventObject.which == <span class="hljs-number"><span class="hljs-number">67</span></span>) { CopyClip(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventObject.which == <span class="hljs-number"><span class="hljs-number">86</span></span>) { PasteClip(); } } } });</code> </pre><br></div></div><br>  Binding to the tags of the SCADA-system is carried out through the element id. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setIDObj</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> activeObject = canvas.getActiveObject(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activeObject) { activeObject.set({ <span class="hljs-attr"><span class="hljs-attr">id</span></span> : $(<span class="hljs-string"><span class="hljs-string">"input[name=nameobj]"</span></span>).val() }); } };</code> </pre><br>  In SCADA for displaying analog values, we will use the text text field, for discrete any image.  The image will change either color or transparency.  Those.  let's create 2 images, we will tie one to the enabled state, the other to the disabled one.  When the state is on, set the transparency of the first image to 1, the second to 0. <br><br>  Preservation.  We will save in SVG format.  To do this, use <code>canvas.toSVG().</code> <br><br><div class="spoiler">  <b class="spoiler_title">Opening a mimic in a new tab:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> rasterizeSVG = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.open( <span class="hljs-string"><span class="hljs-string">'data:image/svg+xml;utf8,'</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(canvas.toSVG())); };</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Opening from file:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Loadfromfile = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shapeName</span></span></span><span class="hljs-function">) </span></span>{ fabric.loadSVGFromURL(shapeName + <span class="hljs-string"><span class="hljs-string">'.svg'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">objects, options</span></span></span><span class="hljs-function">) </span></span>{ canvas.add.apply(canvas, objects); canvas.renderAll(); }); };</code> </pre><br></div></div><br>  We load the SVG from the file completely ungrouped.  And we see that the elements with the property <code>transform="translate(XY)"</code> and the pointers for resizing were in the upper left corner, whereas the image itself in the coordinates of X Y. <br><br>  It is necessary for the Web server to write a crutch that would reset the <code>translate</code> coordinates and translate them to <code>x="X" y="Y"</code> . <br><br>  In the web-server of the editor, the mnemonic will be saved using the POST method. <br>  Continued <a href="https://habrahabr.ru/post/325640/">in the 2nd part.</a> </div><p>Source: <a href="https://habr.com/ru/post/322990/">https://habr.com/ru/post/322990/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../322978/index.html">The birth of a new algorithm called Broo and comparison with Brotli and the rest</a></li>
<li><a href="../322980/index.html">Why learning is a new procrastination</a></li>
<li><a href="../322982/index.html">11 steps to a good online store. Delivery</a></li>
<li><a href="../322984/index.html">Again about floating point numbers</a></li>
<li><a href="../322988/index.html">Browser frontend optimization</a></li>
<li><a href="../322992/index.html">Diverse and motivating "English online"</a></li>
<li><a href="../322994/index.html">Stories of small business in Krasnodar: insane team of freelancers and a lot of courage</a></li>
<li><a href="../322996/index.html">Internet counterintelligence in action: create a personal information security management system</a></li>
<li><a href="../322998/index.html">Free ASP.NET Core Training Courses at the Microsoft Virtual Academy</a></li>
<li><a href="../323002/index.html">Five reasons why you have to learn English</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>