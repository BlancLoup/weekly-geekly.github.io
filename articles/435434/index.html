<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We use annotations in PHP to the maximum</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Being a back-end developer, I love microservice architectures with all the fibers of my soul, but even more, I like to develop microservices. When dev...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We use annotations in PHP to the maximum</h1><div class="post__text post__text-html js-mediator-article"><p>  Being a back-end developer, I love microservice architectures with all the fibers of my soul, but even more, I like to develop microservices.  When developing, whatever, I adhere to one simple principle - minimalism.  By minimalism, I mean a simple truth: the code should be as transparent as possible, it should be at a minimum (the ideal code is the one that does not exist), and therefore I bet in favor of annotations. </p><a name="habracut"></a><br><p>  In this article, I will bring to your attention the skeleton for future applications, in which annotations are used to solve the following tasks: </p><br><ul><li>  <a href="https://habr.com/ru/post/435434/">Routing in controllers</a> </li><li>  <a href="https://habr.com/ru/post/435434/">Injection of dependencies in controllers and not only</a> </li><li>  <a href="https://habr.com/ru/post/435434/">Description of database schema in models</a> </li><li>  <a href="https://habr.com/ru/post/435434/">Validation of model properties</a> </li></ul><br><p>  Such a skeleton will be based on the following packages: </p><br><ul><li>  <a href="https://github.com/PHP-DI/PHP-DI">Php di</a> </li><li>  <a href="http-router">Sunrise Router</a> </li><li>  <a href="https://github.com/doctrine/orm">Doctrine orm</a> </li><li>  <a href="https://github.com/symfony/validator">Symfony validator</a> </li></ul><br><p>  Also, such a skeleton will be based on packages adhering to the following PSR recommendations: </p><br><ul><li>  <a href="https://www.php-fig.org/psr/psr-3/">PSR-3</a> </li><li>  <a href="https://www.php-fig.org/psr/psr-7/">PSR-7</a> </li><li>  <a href="https://www.php-fig.org/psr/psr-11/">PSR-11</a> </li><li>  <a href="https://www.php-fig.org/psr/psr-15/">PSR-15</a> </li><li>  <a href="https://www.php-fig.org/psr/psr-17/">PSR-17</a> </li></ul><br><p>  In this article, I will not tell you what a composer is, about a beaten "onion," and even more so about PSR, it is assumed that you already know all this in one degree or another. </p><br><div class="spoiler">  <b class="spoiler_title">Too lazy to read, what is it?</b> <div class="spoiler_text"><pre><code class="bash hljs">composer create-project sunrise/awesome-skeleton app</code> </pre> </div></div><br><p><img src="https://habrastorage.org/webt/uw/3o/rj/uw3orjgwhbb8i6cvihi6hnoddtm.jpeg" alt="wheel bike"></p><br><h2 id="kontrollery">  Controllers </h2><br><p>  As a rule, regardless of what tools we use, we always have routing separately, controllers separately, I don‚Äôt take account of Symfony Routing right now, this is a little about something else. </p><br><h3 id="marshrutizaciya-v-kontrollerah">  Routing in controllers </h3><br><p>  Consider the example below: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">ResponseInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">ServerRequestInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Server</span></span>\<span class="hljs-title"><span class="hljs-title">MiddlewareInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Server</span></span>\<span class="hljs-title"><span class="hljs-title">RequestHandlerInterface</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Route</span></span></span><span class="hljs-comment">( * id="resource.update", * path="/resource/{id&lt;\d+&gt;}", * methods={"PATCH"}, * before={ * "App\Http\Middleware\FooMiddleware", * "App\Http\Middleware\BarMiddleware" * }, * after={ * "App\Http\Middleware\BazMiddleware", * "App\Http\Middleware\QuxMiddleware" * } * ) */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceUpdateController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MiddlewareInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritDoc</span></span></span><span class="hljs-comment">} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ServerRequestInterface $request, RequestHandlerInterface $handler)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResponseInterface</span></span></span><span class="hljs-function"> </span></span>{ $response = $handler-&gt;handle($request); <span class="hljs-comment"><span class="hljs-comment">// some code return $response; } }</span></span></code> </pre> <br><p>  You probably noticed that the controller is middleware, as in Zend Expressive, moreover, through the annotations, you can specify which middleware will be launched before the launch of this controller, and which after. </p><br><p>  The <strong>@Route annotation</strong> may contain the following properties: </p><br><ul><li>  <u>id</u> - route ID </li><li>  <u>path</u> - route <u>path</u> rule </li><li>  <u>methods</u> - valid HTTP route methods </li><li>  <u>before</u> - middleware that will run before the controller starts </li><li>  <u>after</u> - middleware that will run after the controller starts </li></ul><br><p>  The route path contains the usual for all <strong>{id}</strong> construct, however, to validate an attribute, you must specify a regular expression <strong>{id &lt;\ d +&gt;}</strong> , and if you need to make part of the path optional, you just need to put it in brackets <strong>/ resource / {action} (/ {id })</strong> . </p><br><p>  It should be noted that the properties of the annotation are strictly validated, you will be notified immediately if your regular expressions are not correct, or the middleware does not exist, etc. </p><br><h3 id="inekciya-zavisimostey-v-kontrollerah">  Injection dependencies in controllers </h3><br><p>  Consider the example below: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">ResponseInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">ServerRequestInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Server</span></span>\<span class="hljs-title"><span class="hljs-title">MiddlewareInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Server</span></span>\<span class="hljs-title"><span class="hljs-title">RequestHandlerInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Log</span></span>\<span class="hljs-title"><span class="hljs-title">LoggerInterface</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Route</span></span></span><span class="hljs-comment">( * id="resource.update", * path="/resource/{id&lt;\d+&gt;}", * methods={"PATCH"} * ) */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceUpdateController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MiddlewareInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Inject</span></span></span><span class="hljs-comment"> * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> LoggerInterface */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $logger; <span class="hljs-comment"><span class="hljs-comment">/** * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritDoc</span></span></span><span class="hljs-comment">} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ServerRequestInterface $request, RequestHandlerInterface $handler)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResponseInterface</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;logger-&gt;debug(<span class="hljs-string"><span class="hljs-string">'foo bar'</span></span>); $response = $handler-&gt;handle($request); <span class="hljs-comment"><span class="hljs-comment">// some code return $response; } }</span></span></code> </pre> <br><p>  There is nothing easier than getting some kind of dependency from a container ... </p><br><h3 id="registraciya-kontrollera-v-prilozhenii">  Register controller in the application </h3><br><p>  You just need to create a controller, the rest of the application will do for you, find such a controller, pass it to the router, which will launch it if necessary ... What could be simpler?  The main thing that is required of you out of the box, create controllers in the <strong>src / Http / Controller</strong> directory. </p><br><p><img src="https://habrastorage.org/webt/po/ha/5y/poha5ytdpin_sm3skziuan1abma.jpeg" alt="wheel bike"></p><br><h2 id="modeli">  Models </h2><br><p>  If you worked with Doctrine ORM and Symfony Validator, nothing interesting for you, except that everything is configured out of the box, for the rest I will present some examples.  Immediately it is necessary to designate that the models should be created in the <strong>src / Entity</strong> directory and inherit from <strong>App \ Entity \ AbstractEntity</strong> . </p><br><h3 id="prostoy-primer-modeli">  A simple example of a model </h3><br><p>  Consider the example below: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Validator</span></span>\<span class="hljs-title"><span class="hljs-title">Constraints</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">Assert</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\HasLifecycleCallbacks * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table(name="resource") */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Resource</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Id * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\GeneratedValue(strategy="AUTO") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(type="integer") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> null|int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $id; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column( * type="string", * length=128, * nullable=false * ) * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Assert</span></span></span><span class="hljs-comment">\NotBlank * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Assert</span></span></span><span class="hljs-comment">\Type("string") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Assert</span></span></span><span class="hljs-comment">\Length(max=128) * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> null|string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $title; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column( * type="text", * nullable=false * ) * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Assert</span></span></span><span class="hljs-comment">\NotBlank * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Assert</span></span></span><span class="hljs-comment">\Type("string") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> null|string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $content; <span class="hljs-comment"><span class="hljs-comment">// setters and getters }</span></span></code> </pre> <br><p>  Again, there is no need to register our model anywhere, there is no need to describe somewhere a validation, or a schema of the tables, all in one place, simple and clear.  The only thing that needs to be done in order for the <strong>resource</strong> table to be created is to run the following script from the application root: </p><br><pre> <code class="bash hljs">composer db:update</code> </pre> <br><p>  <em>Database connection settings are in the file: src / config / environment.php</em> </p><br><h3 id="prostoy-primer-ispolzovaniya-modeli-v-kontrollere">  A simple example of using the model in the controller </h3><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>\<span class="hljs-title"><span class="hljs-title">Resource</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">EntityManager</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">ResponseInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">ServerRequestInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Server</span></span>\<span class="hljs-title"><span class="hljs-title">MiddlewareInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Server</span></span>\<span class="hljs-title"><span class="hljs-title">RequestHandlerInterface</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Route</span></span></span><span class="hljs-comment">( * id="resource.create", * path="/resource", * methods={"POST"} * ) */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceCreateController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MiddlewareInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Inject</span></span></span><span class="hljs-comment"> * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> EntityManager */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $entityManager; <span class="hljs-comment"><span class="hljs-comment">/** * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritDoc</span></span></span><span class="hljs-comment">} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ServerRequestInterface $request, RequestHandlerInterface $handler)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResponseInterface</span></span></span><span class="hljs-function"> </span></span>{ $data = (<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>) $request-&gt;getParsedBody(); $response = $handler-&gt;handle($request); $resource = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Resource(); $resource-&gt;setTitle($data[<span class="hljs-string"><span class="hljs-string">'title'</span></span>] ?? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); $resource-&gt;setContent($data[<span class="hljs-string"><span class="hljs-string">'content'</span></span>] ?? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); $violations = $resource-&gt;validate(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($violations-&gt;count() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $response-&gt;withStatus(<span class="hljs-number"><span class="hljs-number">400</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;entityManager-&gt;persist($resource); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;entityManager-&gt;flush(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $response-&gt;withStatus(<span class="hljs-number"><span class="hljs-number">201</span></span>); } }</code> </pre> <br><p>  The <strong>@Assert annotation</strong> is responsible for validation, the validation logic itself is described in the <strong>AbstractEntity</strong> class inherited by the model. </p><br><p>  <em>The implementation is of a demonstration nature, the purpose of the author is to reduce the number of lines of code ...</em> </p><br><p><img src="https://habrastorage.org/webt/sg/xm/zn/sgxmznyvaqtpysimnaahix2onna.jpeg" alt="wheel bike"></p><br><h2 id="nastroyki-prilozheniya">  Application settings </h2><br><table><thead><tr><th>  File </th><th>  Description </th></tr></thead><tbody><tr><td>  config / cli-config.php </td><td>  Doctrine CLI </td></tr><tr><td>  config / container.php </td><td>  Php di </td></tr><tr><td>  config / definitions.php </td><td>  Application dependencies </td></tr><tr><td>  config / environment.php </td><td>  Application Environment Configuration </td></tr></tbody></table><br><h3 id="svoi-zavisimosti">  Your dependencies </h3><br><p>  To add a new dependency to the application, just open the file <strong>config / definitions.php</strong> and add a new dependency by analogy with the existing ones, after which it will be available through injections, as in the examples of this article. </p><br><h3 id="rekomendacii">  Recommendations </h3><br><p>  After installing the skeleton, it is recommended to add the file <strong>config / environment.php</strong> to <strong>.gitignore</strong> , and duplicate the file itself as an example with a new name: </p><br><pre> <code class="bash hljs">cp config/environment.php config/environment.php.example</code> </pre> <br><p>  You can go the other way by filling out the environment settings from <strong>.env</strong> using the <a href="https://github.com/symfony/dotenv">symfony / dotenv package</a> . </p><br><p><img src="https://habrastorage.org/webt/cz/h3/pw/czh3pwgvo7nfkixn1ggbgdxmirm.jpeg" alt="wheel bike"></p><br><p>  The game ‚Äúwhy write it when you have it‚Äù can be played endlessly, but be that as it may, open-source can endure everything ... </p><br><p>  To install the skeleton, use the following command: </p><br><pre> <code class="bash hljs">composer create-project sunrise/awesome-skeleton app</code> </pre> <br><p>  To explore the source code of the skeleton, use the link: <a href="https://github.com/sunrise-php/awesome-skeleton">sunrise / awesome-skeleton</a> . </p><br><hr><br><p>  I would like to express special thanks to <a href="https://github.com/oscarotero">Oscar Otero</a> for his contribution to open-source, in particular for the excellent selection of <a href="https://github.com/middlewares/awesome-psr15-middlewares">Awesome PSR-15 Middleware</a> , some of which are integrated into <strong>sunrise / awesome-skeleton</strong> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/435434/">https://habr.com/ru/post/435434/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435424/index.html">Parse & Android: recommendations for novice developers</a></li>
<li><a href="../435426/index.html">How Microsoft Excel works with row heights</a></li>
<li><a href="../435428/index.html">Remote control of Fceux emulator using Python</a></li>
<li><a href="../435430/index.html">The coolest new CES 2019</a></li>
<li><a href="../435432/index.html">New Year, New GitHub: Unlimited Free Private Repositories</a></li>
<li><a href="../435436/index.html">5 IT infrastructure trends: forecast for 2019</a></li>
<li><a href="../435442/index.html">Funnel change</a></li>
<li><a href="../435446/index.html">Verkhuffa algorithm for an arbitrary even number system</a></li>
<li><a href="../435448/index.html">About the experience of communicating with the signal generator through QTcpSocket and SCPI</a></li>
<li><a href="../435450/index.html">Happy new year with new MQTT / UDP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>