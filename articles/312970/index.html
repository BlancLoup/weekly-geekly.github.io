<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Evolutionary database design</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over the past decade, we have developed and improved several methods that allow database design to evolve in parallel with the development of the appl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Evolutionary database design</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/fb6/b4d/268/fb6b4d268d884ce19a3ab7d9268f127e.jpg"></p><br><p>  <em>Over the past decade, we have developed and improved several methods that allow database design to evolve in parallel with the development of the application.</em> </p><br><p>  <em>This is a very valuable feature of flexible methodologies.</em>  <em>The methods rely on the application of continuous integration and automated refactoring to database development, as well as close interaction between application developers and database administrators.</em>  <em>These methods work both in preproduction and in already started systems, in fresh projects without Legacy, and in inherited systems.</em> </p><br><p>  In the last decade, we have seen an increase in <a href="http://www.martinfowler.com/articles/newMethodology.html">flexible methodologies</a> .  Compared to their predecessors, they change the requirements for database design.  One of the most important requirements is the idea of ‚Äã‚Äãan evolutionary architecture.  In a flexible project, you assume that you cannot fix the system requirements in advance.  As a result, it becomes impractical to have a detailed, clear design stage at the beginning of a project.  The system architecture should evolve simultaneously with software iterations.  Flexible methods, in particular, extreme programming (XP), have a set of techniques that make this evolutionary architecture practical. <a name="habracut"></a></p><br><p>  When we and our colleagues from ThoughtWorks began to do agile-projects, we realized that we need to solve the problem of database evolution to support the evolution of architecture.  We started around 2000 with a project, the database of which eventually reached almost 600 tables.  In the process of working on this project, we developed methods that allowed us to change the scheme and conveniently migrate existing data.  This made the database fully flexible and evolving.  We described the methods in earlier versions of this article, and its content inspired other commands and toolsets.  Since then, we have used and further developed methods in hundreds of projects around the world, from small groups to large multinational programs.  We have long been going to update this article, and now this opportunity has appeared. </p><br><hr><br><h2 id="dzhen-realizuet-novuyu-yuzer-istoriyu">  Jen realizes new user story </h2><br><p>  In order to get an idea of ‚Äã‚Äãhow it all works, let's outline what happens when a developer (Jen) writes code to implement a new user story.  The story describes a user who has the ability to see, search and update the position, batch number and serial number of goods in stock.  Looking at the database schema, Jen sees that there are currently no fields in the product availability table, only one inventory_code field, which is the concatenation (union) of these three fields.  It must divide the single code into three separate fields: location_code, batch_number, and serial_number. </p><br><p>  Here are the steps she must take: </p><br><ul><li>  Add new columns to the inventory table in an existing scheme. </li><li>  Write a migration script and separate the data from the inventory_code column by created columns: location_code, batch_number, and serial_number. </li><li>  Modify application code to use new columns. </li><li>  Modify all parts of the database code, such as samples, stored procedures, and triggers, to use the new columns. </li><li>  Change all indexes based on inventory_code. </li><li>  Save the database migration script and all application code changes to the version control system </li></ul><br><p>  To add new columns and transfer data, Jen writes a migration script for SQL, which she can compare with the current schema.  This will simultaneously change the scheme and transfer all available data about the goods in stock. </p><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> inventory <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> location_code VARCHAR2(<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> inventory <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> batch_number VARCHAR2(<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> inventory <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> serial_number VARCHAR2(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> inventory <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> location_code = <span class="hljs-keyword"><span class="hljs-keyword">SUBSTR</span></span>(product_inventory_code,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> inventory <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> batch_number = <span class="hljs-keyword"><span class="hljs-keyword">SUBSTR</span></span>(product_inventory_code,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> inventory <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> serial_number = <span class="hljs-keyword"><span class="hljs-keyword">SUBSTR</span></span>(product_inventory_code,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> uidx_inventory_code; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> uidx_inventory_identifier <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inventory (location_code,batch_number,serial_number); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> product_inventory <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> inventory_code;</code> </pre> <br><p>  Jen runs the migration script in a local copy of the database on his computer.  It then proceeds to update the code to use the new columns.  In the process, it applies the existing test suite to the new code to detect any changes in the behavior of the application.  Some tests, those that covered the combined column, need to be updated.  Perhaps you need to add some more tests.  After Jen did all this, and the application passed all the tests on her computer, she loads the changes into the common project repository, which we call <strong>mainline</strong> .  These changes include migration scripts and application code changes. </p><br><p>  If Jen is not very familiar with making these changes, she is lucky that they are universal for databases.  Therefore, it can look into the <a href="http://martinfowler.com/books/refactoringDatabases.html">book about the refactoring of databases</a> .  Online there is <a href="http://databaserefactoring.com/SplitColumns.html">help</a> on this topic. </p><br><p>  After the changes appear in the mainline, they are picked up <a href="http://www.martinfowler.com/articles/continuousIntegration.html">by the continuous integration server</a> .  It runs migration scripts on the database copy in mainline, and then all application tests.  If everything is successful, this process will be repeated at each stage of the <a href="http://martinfowler.com/bliki/DeploymentPipeline.html">Deployment Pipeline</a> , including testing (QA) and staging.  The same code will finally run in production, this time updating the actual database schema and data. </p><br><p>  In a small user history, as in the example, there is only one database migration, large user histories are often split into several separate migrations for each change in the database.  Our rule is to make every change in the database as small as possible.  The smaller, the easier it is to get the correct result, and any errors can be quickly detected and debugged.  Migrations, as in the example, are easy to combine, so it is better to do a lot of small ones. </p><br><h2 id="rabota-s-izmeneniyami">  Work with changes </h2><br><p>  Since flexible methods became popular in the early 2000s, one of their most obvious characteristics is the tendency to change.  Before they appeared, the most common ideas about software were: understanding the requirements at an early stage, setting requirements, using requirements as a basis for design, design execution, and then project execution.  This plan-driven cycle is often called (usually with a mock) waterfall approach. </p><br><p>  Such approaches are used in attempts to minimize changes, which translates into excessive preliminary work.  And when the preliminary work is completed, the changes lead to serious problems.  As a result, if requirements change, these approaches lead to malfunctions, and the revision of requirements is a headache for such processes. </p><br><p>  Flexible processes have other methodological approaches to change.  They are friendly to change, even in the later stages of project development.  Changes are monitored, but the nature of the process makes them as likely as possible.  Partly - this is the answer to the embedded instability of the requirements of many projects, in part - the concept of better support for dynamic business structures and helping them with changes, under the pressure of competitors. </p><br><p>  In order to put this process on the wheels, you need to change the attitude to the design.  Instead of thinking of design as a phase that ends before the design phase, you look at design as a continuous process that alternates with design, testing, and even delivery.  Such a contrast between planned and evolutionary design. </p><br><p>  One of the most important contributions of flexible methods is approaches in which evolutionary design has the ability to keep work under control.  And instead of the usual chaos that often takes over, when design is not planned in advance, these methods give rise to ways to control evolutionary design and make them practical. </p><br><p>  An important part of this approach is iterative development, when the full life cycle of software runs many times over the entire existence of a project.  Flexible processes run the full life cycle in each iteration, completing the iteration with a working, tested, integrated code and a small subset of the requirements of the final product.  These iterations are short - from a few hours to several weeks: more experienced teams use shorter iterations. </p><br><p>  Although the interest and use of these methods has increased, one of the most important questions is how to use evolutionary design for databases.  For a long time, a group of people from the database community perceived the design of the database as something that necessarily required preliminary planning.  Changing the database schema in the final phases of development usually leads to propagating defects in the application.  In addition, a change in the schema after deployment leads to painful data migration. </p><br><p>  Over the past ten and a half years, we have participated in many large projects that used the evolutionary design of the database and it worked successfully.  Some projects included more than 100 people at several work locations around the world.  Others - more than half a million lines of code, more than 500 tables.  Some of them had several versions of the application in production and each required around-the-clock service.  In the course of these projects, we came across iterations lasting for a month and a week, but shorter iterations worked better.  The methods described below made this possible. </p><br><p>  From the first days we tried to spread the techniques to more of our projects.  We got more experience from covering more cases, and now all our projects use this approach.  We also draw inspiration, ideas, and experience from other people using this approach. </p><br><h2 id="ogranicheniya">  Restrictions </h2><br><p>  Before we begin to understand the approaches, I want to say that we have not solved all the problems of the evolutionary design of databases. </p><br><p>  We had projects with hundreds of retail stores, with their own databases, each of which needed to be updated.  But we have not yet considered the situation when a large group of sites have a lot of settings.  As an example, you can consider a small business application that allows you to make schema settings crammed in thousands of different small companies. </p><br><p>  Increasingly, we see people using a variety of schemas as part of a unified database environment.  We worked with projects that used several similar schemes, but did not try dozens or hundreds.  Over the next few years, we predict to deal with this situation. </p><br><p>  We do not believe that these problems are unsolvable.  In the end, when we wrote the original version of this article, we did not get rid of the problem of continuous work or database integration.  We found ways to deal with them and hope that we will expand the boundaries of the evolutionary design of the database.  But until this happens, we will not argue that we are not capable of solving such problems. </p><br><h2 id="metodiki">  Techniques </h2><br><p>  Our approach to the evolutionary design of the database is based on several important techniques. </p><br><h3 id="administratory-bd-tesno-vzaimodeystvuyut-s-razrabotchikami">  Database administrators work closely with developers </h3><br><p>  One of the principles of flexible methods is that workers with different skills and experience should interact very closely with each other.  They do not have to communicate only through official meetings and documents.  They need to contact and work with each other all the time.  This affects everyone: analysts, project managers, subject matter experts, developers ... and database administrators. </p><br><p>  Each task that a developer is working on may potentially need the help of a database administrator.  Both developers and administrators must consider whether significant changes to the database schema will be included in the development task.  If so, the developer should consult with the database administrator to decide how to make changes.  The developer knows what new functionality is required, and the administrator has a unified view of the data of the current application and other surrounding applications.  Often, developers have an idea of ‚Äã‚Äãthe application they are working on, but do not have all the other upstream or downstream dependencies of the scheme.  Even if it is a single database application, it may contain dependencies about which the developer is not up to date. </p><br><p>  At any time, the developer can contact the administrator and ask to understand the changes in the database.  When the pair style is used, the developer learns how the database works, and the administrator learns the specifics of the database requirements.  The most common question ‚Äî whether to apply for changes to the DBA or not ‚Äî lies with the developer if he is concerned about the impact of the changes on the database.  But the DBA is also taking the initiative.  When they see requirements that they believe can have a significant impact on the data, they can contact the developers to discuss the impact on the database.  DBAs may also affect migrations, as they are fixed in the version control system.  Since the return migration is annoying, we benefit from every small migration that is easier to reverse. </p><br><p>  To make this possible, the DBA must willingly go forward and be accessible.  It is necessary that the developer can easily descend and ask a few questions in slak or khipchaty - any means of communication that developers use.  When you are organizing a workspace for a project, try to make the DBAs and the developers sit closer to each other so that they are easy to contact.  Make sure that administrators are aware of any meetings related to the design of the application, so that they can easily catch up.  In working microclimates, we often see people creating barriers between database administrators and development functions.  For the evolutionary process of database design to work, you need to erase these barriers. </p><br><h3 id="vse-artefakty-bazy-dannyh-are-version-controlled-with-application-code">  All database artifacts are version controlled with application code </h3><br><p>  Developers benefit greatly from using version control of all their artifacts: application code, functional and unit tests, code like build scripts, Chef or Puppet scripts used to create a working environment. </p><br><p><img src="https://habrastorage.org/files/5d5/927/975/5d5927975ee44745901c8db28d42f0d1.png"><br>  <em>Figure 1: All database artifacts in version control, along with other project artifacts</em> </p><br><p>  Similarly, all database artifacts must be in a version control system, in the same repository that is used by everyone else.  The advantages of this: </p><br><ul><li>  Everything is in one place and it is easy for any project participant to find the right one. </li><li>  Every change to the database is saved, making it easy to check if any problem occurs.  We can track any database deployment and find the required status of the schema and auxiliary data. </li><li>  We do not deploy if the database is not synchronized with the application, which leads to the return of errors and data updates. </li><li>  We can easily create new environments: for development, testing, and of course production.  Everything you need to create a working version of the application must be in the same repository so that you can quickly clone and assemble. </li></ul><br><h3 id="vse-izmeneniya-bazy-dannyh---eto-migracii">  All database changes are migrations. </h3><br><p>  In many organizations, there is a process in which developers make changes to the database using schema editing tools and ad-hoc SQL for data.  After they finish development, database administrators compare the developed database with the database in production and make the appropriate changes there, putting the application into a working state.  But in production it is difficult to do this, because the context indicator of changes, the one that was in development, was lost.  We need to understand again why the changes were made, but to a different group of people. </p><br><p>  To avoid this, we prefer to capture the changes during development and save them as an artifact of the first level, which can then be tested and fixed with the same process and control as for changes in the application code.  We do this by displaying every change in the database, like a script for migrating the database, which, like changes in the application code, are in the version control system.  These migration scripts include: schema changes, database code changes, reference data updates, transaction data updates, and data problems corrected due to production bugs. </p><br><p>  Here is the change, the addition of min_insurance_value and max_insurance_value to the equipment_type table, with several default values. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> equipment_type <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span>( min_insurance_value <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>), max_insurance_value <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> equipment_type <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> min_insurance_value = <span class="hljs-number"><span class="hljs-number">3000</span></span>, max_insurance_value = <span class="hljs-number"><span class="hljs-number">10000000</span></span>;</code> </pre> <br><p>  This change adds a set of fixed data to the location and equipment_type tables. </p><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- Create new warehouse locations #Request 497 INSERT INTO location (location_code, name , location_address_id, created_by, created_dt) VALUES ('PA-PIT-01', 'Pittsburgh Warehouse', 4567, 'APP_ADMIN' , SYSDATE); INSERT INTO location (location_code, name , location_address_id, created_by, created_dt) VALUES ('LA-MSY-01', 'New Orleans Warehouse', 7134, 'APP_ADMIN' , SYSDATE); -- Create new equipment_type #Request 562 INSERT INTO equipment_type (equipment_type_id, name, min_insurance_value, max_insurance_value, created_by, created_dt) VALUES (seq_equipment_type.nextval, 'Lift Truck', 40000, 4000000, 'APP_ADMIN', SYSDATE);</span></span></code> </pre> <br><p>  When working with this method, we never have to use schema editing tools such as Navicat, DBArtisanor, or SQL Developer, and we never run wireless DDL or DML to add persistent data or fix errors.  In addition to updates in the database, which occur because of applications, all changes are made by migrations. </p><br><p>  Calling migrations as SQL command sets, we only tell part of the story, but in order to use them correctly, we need something else. </p><br><ul><li>  Each migration requires a unique identification. </li><li>  Need to keep track of which migrations have been applied to the database. </li><li>  You need to manage the constraints of the sequence of actions between migrations.  In the example above, we must apply the ALTER TABLE migration at the beginning, otherwise the second migration will not be able to add the equipment type insert. </li></ul><br><p>  We process these requirements by assigning a serial number to each migration.  It acts as a unique identifier and ensures that the order in which they are applied in the database can be maintained.  When a developer creates a migration, he puts the SQL into a text file within the migration folder, within the project version control repository.  It looks at the highest currently used number in the migration folder, and uses that number along with a description to give the file a name.  The earliest pair of migrations can be called 0007_add_insurance_value_to_equipment_type.sql and 0008_data_location_equipment_type. </p><br><p>  In order to track the application of migrations in the database, we use the changelog table.  Database migration frameworks, as a rule, create this table and automatically update it every time a migration is applied.  Then the database can always tell which migration was synchronized.  If we do not use such a framework, because there are no such, we automate the process using a script at the beginning of our work. </p><br><p><img src="https://habrastorage.org/files/5c6/e1c/83e/5c6e1c83e4b5478e8adabeb36b93ef46.png"><br>  <em>Figure 2: The changelog table maintained by the database migration framework</em> </p><br><p>  Using this numbering scheme, we can track changes when they are applied to the set of databases we work with. </p><br><p><img src="https://habrastorage.org/files/e93/fb8/6ca/e93fb86caf59417095e3d50d5d7afb24.jpg"><br>  <em>Figure 3: Migration script cycle from its inception to deployment in production</em> </p><br><p>  Some of these migrations may need to be implemented more often than migrations associated with new components.  In this scenario, we noticed that it is useful to have a separate migration repository or folder for debugging data-related bugs. </p><br><p><img src="https://habrastorage.org/files/470/039/414/4700394141a9418b9697b4fa2cdbb47a.png"><br>  <em>Figure 4: Separate folders for managing new changes to database components and correcting data in production</em> </p><br><p>  Each of these folders can be tracked separately using database migration tools: Flyway, dbdeploy, MyBatis or similar.  Each should have a separate table for storing the number of migrations.  The flyway.table property in Flyway is used to change the name of the table where the migration metadata is stored. </p><br><h3 id="kazhdyy-imeet-svoy-ekzemplyar-bazy-dannyh">  Everyone has their own copy of the database. </h3><br><p>  Most development companies use a single database, jointly, by all employees.  They may use a separate database for testers or staging, but they basically limit the number of active databases.  Sharing a database in this way is a consequence of the fact that copies are difficult to install and manage.  As a result, companies minimize their number.  Control over who is responsible for changing the scheme in such situations is different: some companies require that all changes be made by administrative teams, others allow developers to make any changes, and administrators are attracted when the changes go to the next level. </p><br><p>  When we started experimenting with flexible projects, we noticed that developers usually work in the same way ‚Äî they use their own copy of the code.  Just as people learn, going through different options, developers are experimenting with the implementation of components and can make several attempts before choosing the right one.  It is necessary that they have the opportunity to experiment in their workspace, and then download the code to the shared repository when it is more and more stable.  If everyone works in the same space, then they inevitably interfere with each other with half-ready changes.  Although we prefer continuous integration, when integration does not occur more than a few hours later, a personal working copy plays an important role.  Version control systems support this work, allowing developers to work independently and support the integration of their work into the mainline copy. </p><br><p>     ,       .    ‚Äì    ,     ,    .     ,      ,       . </p><br><p>             ,    ,   ,       .          ,     ,             .          .        ,  <a href="https://www.vagrantup.com/">Vagrant</a>   <a href="http://martinfowler.com/bliki/InfrastructureAsCode.html">"  "</a> ,             . </p><br><p><img src="https://habrastorage.org/files/d65/3c9/dd9/d653c9dd90e24c2cab5784ff81ffba0b.jpg"><br> <em> 5:          </em> </p><br><p><img src="https://habrastorage.org/files/42d/f53/1db/42df531db77643d7b445fa35650a7ba8.jpg"><br> <em> 6:            </em> </p><br><p>           ,    - ,   ,         . ,           ,   . </p><br><pre> <code class="sql hljs">&lt;target name="create_schema" description="<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">schema</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> defined <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> properties<span class="hljs-string"><span class="hljs-string">"&gt; &lt;echo message="</span></span><span class="hljs-keyword"><span class="hljs-keyword">Admin</span></span> UserName: ${admin.username}<span class="hljs-string"><span class="hljs-string">"/&gt; &lt;echo message="</span></span>Creating <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>: ${db.username}<span class="hljs-string"><span class="hljs-string">"/&gt; &lt;sql password="</span></span>${admin.password}<span class="hljs-string"><span class="hljs-string">" userid="</span></span>${admin.username}<span class="hljs-string"><span class="hljs-string">" url="</span></span>${db.url}<span class="hljs-string"><span class="hljs-string">" driver="</span></span>${db.driver}<span class="hljs-string"><span class="hljs-string">" classpath="</span></span>${jdbc.classpath}<span class="hljs-string"><span class="hljs-string">" &gt; CREATE USER ${db.username} IDENTIFIED BY ${db.password} DEFAULT TABLESPACE ${db.tablespace}; GRANT CONNECT,RESOURCE, UNLIMITED TABLESPACE TO ${db.username}; GRANT CREATE VIEW TO ${db.username}; ALTER USER ${db.username} DEFAULT ROLE ALL; &lt;/sql&gt; &lt;/target&gt;</span></span></code> </pre> <br><p>     ,   ,     .        . </p><br><pre> <code class="sql hljs">&lt;target name="drop_schema"&gt; &lt;echo message="Admin UserName: ${admin.username}"/&gt; &lt;echo message="Working UserName: ${db.username}"/&gt; &lt;sql password="${admin.password}" userid="${admin.username}" url="${db.url}" driver="${db.driver}" classpath="${jdbc.classpath}" &gt; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USER</span></span> ${db.username} <span class="hljs-keyword"><span class="hljs-keyword">CASCADE</span></span>; &lt;/sql&gt; &lt;/target&gt;</code> </pre> <br><p> ,    ,        .   - build.properties   ,   Jen   db.username,      .  ,   ,     create_schema                . </p><br><p>    ,       ,           , , , ,  , ,       . </p><br><p>       ,     ,   ,           .      <a href="http://martinfowler.com/bliki/PhoenixServer.html"></a> ‚Äî      .         ,      . </p><br><p>       ,       . QA      ,         ,     .           ,          . </p><br><h3 id="razrabotchiki-postoyanno-integriruyut-izmeneniya-bazy-dannyh">       </h3><br><p>   ,      ,   ‚Äî     ,       (CI). CI    ,      mainline .     :      mainline,      .  ,    ‚Äî GoCD, SNAP CI, Jenkins, Bambooand Travis CI. </p><br><p><img src="https://habrastorage.org/files/f2d/e74/6f0/f2de746f0b2243ac9f494fb26d486d45.jpg"><br> <em> 7:   ,       </em> </p><br><p>  7    ,      ,  ,     ,   CI      ,      . </p><br><p>     </p><br><p> 1)    ,      .   , ,  ,  ,    .  ,         . </p><br><p>  ,       ,   . </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">project</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> projecttypeid <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">project</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> fk_project_projecttype <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (projecttypeid) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> projecttype DEFERRABLE <span class="hljs-keyword"><span class="hljs-keyword">INITIALLY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFERRED</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">project</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> projecttypeid = (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> projecttypeid <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> projecttype <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=<span class="hljs-string"><span class="hljs-string">'Integration'</span></span>);</code> </pre> <br><p>    ‚Äî    ,     ,    .       ,   ,      . </p><br><p> 2)  ,    ,    .   ‚Äî      mainline.   ,     ,      .     ,   ,       . </p><br><p>      - ,    ‚Äî ,      ‚Äî        .  ,    ,     .             ,    . </p><br><p>  ,        ,  ,        .  ,       .         ,  ,       mainline. </p><br><p> 3)     mainline.        ,           ‚Äî    <a href="http://martinfowler.com/bliki/ParallelChange.html">Parallel Change</a> . </p><br><p> 4)  CI    mainline    ,     . </p><br><p> 5)  CI       ,          ,     .  ,     : ,  ,    . </p><br><p> 6)  ,    ,  CI      .       ,        downstream ,   Deployment Pipeline.      ,   jar, war, dll  . </p><br><p>            .            .    ‚Äî DDL, DML, Data, , ,  ,   ‚Äî    ,      .  ,    ,        ,        ,    . </p><br><p>    ,         ,            .        ,        (),      . (        ).  ,          ,            .     ,         ,       . </p><br><p>      ,   ,       ,    ,   ,  <a href="http://martinfowler.com/bliki/FrequencyReducesDifficulty.html">  </a> .         ,          ,      . </p><br><h3 id="baza-dannyh-sostoit-iz-shemy-i-dannyh">        </h3><br><p>      ,          ,     .        ,      , , ,      .        , ,   ,   ..  -    production,           . </p><br><p>      .   ‚Äî  .        ,    .    ‚Äî    .     ,      ,    ,     . </p><br><p>      ,  ,   ,      ,      ,       . </p><br><p>      ,         .    ,      ,        . </p><br><p>   ,   ,     .    ,    .               . ,       ,            .     <a href="http://martinfowler.com/bliki/IncrementalMigration.html">Incremental Migration</a>         . </p><br><p>            ,        ,     ,    ,      ,        .      ,           . <a href="http://jailer.sourceforge.net/">Jailer</a>       . </p><br><h3 id="vse-izmeneniya-bazy-dannyh---eto-refaktoring-bazy-dannyh">     ‚Äî     </h3><br><p> ,      ,      ,       ,    .       ,   ,     . ,         . </p><br><blockquote> ,     ,        ,      <br><ul><li> <a href="http://martinfowler.com/books/refactoring.html"> ( 2)</a> </li></ul><br></blockquote><p>  ,      .  ,       ,      ,     . </p><br><p>           ,      ,    . </p><br><ul><li>     </li><li>      </li><li>       </li></ul><br><p>  ,      ,         ,    ,      . </p><br><p>    ,     .       ,         .        . </p><br><p>    ,  <a href="http://databaserefactoring.com/IntroduceNewColumn.html">  </a> ,      ,    .      ,     ,     .   , ,        <strong></strong> . <strong> </strong>    ,      . </p><br><p>      <a href="http://databaserefactoring.com/MakeColumnNonNullable.html">  non nullable</a> ,   ,   null,     .   ,         ,      .     ,      null. </p><br><p>        (   ),     ,  .     (  )     .         . </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> customer <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> last_usage_date <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sysdate</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> customer <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> last_usage_date = (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(order_date) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> order.customer_id = customer.customer_id) <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> last_usage_date <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> customer <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> last_usage_date = last_updated_date <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> last_usage_date <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> customer <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> last_usage_date <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>;</code> </pre> <br><p>  ‚Äî      .    ,        ,    ,    ,       ,  ,   . </p><br><p>    ‚Äî <a href="http://databaserefactoring.com/SplitTable.html"> </a> ,  ,         .    ,    ,         .       , ,  . </p><br><p>     ,          .          . </p><br><p>  ,    ,      ,   .  ,      .     ,   ,           ,     . </p><br><h3 id="faza-perehoda">   </h3><br><p>     ,  ,               .       ,       , ,      .         -,  <a href="http://databaserefactoring.com/RenameTable.html"> </a> .      ,    . </p><br><p> <strong> </strong> ‚Äî   ,         ,  .              . (     ,  DDL, DML      ,      ,            .) </p><br><p><img src="https://habrastorage.org/files/b92/77e/6ef/b9277e6ef4be469e9d898a99add7103f.jpg"><br> <em> 8:   ,       ,      </em> </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> customer <span class="hljs-keyword"><span class="hljs-keyword">RENAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">client</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> customer <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, first_name, last_name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">client</span></span>;</code> </pre> <br><p>    <a href="http://databaserefactoring.com/RenameTable.html"></a> ,    ,    customer   client,     customer,     .  <a href="http://martinfowler.com/bliki/ParallelChange.html"> </a>     .    ,          downstream .         ,       . </p><br><p>  ‚Äì       .       ,     ,  <a href="http://databaserefactoring.com/RenameColumn.html"> </a> . </p><br><h3 id="avtomatizaciya-refaktoringov">   </h3><br><p>       ,        .                 .       .   <a href="http://liquibase.org/">LiquiBase</a>  <a href="http://guides.rubyonrails.org/active_record_migrations.html">Active Record Migrations</a>   DSL     ,        . </p><br><p>           ,                 .                . </p><br><p>    ,   ,  SQL DDL (  )  DML (  )     .    ,        ,     .           . </p><br><p>          ,           .      ,     ,          .         ,       production. </p><br><p>    production      ,           .     ,    ,           .      ,   production   ,     .       ,         . </p><br><p>    ,         .                .          ,   ,      ,        .      ,                 .    ,         ,     production,   ,    ,     ,  ,     . </p><br><p> ,     ,  ,   Flyway, LiquiBase,  MyBatis, DBDeploy.     Flyway. </p><br><pre> <code class="bash hljs">psadalag:flyway-4 $ ./flyway migrate Flyway 4.0.3 by Boxfuse Database: jdbc:oracle:thin:@localhost:1521:xe (Oracle 11.2) Successfully validated 9 migrations (execution time 00:00.021s) Creating Metadata table: <span class="hljs-string"><span class="hljs-string">"JEN_DEV"</span></span>.<span class="hljs-string"><span class="hljs-string">"schema_version"</span></span> Current version of schema <span class="hljs-string"><span class="hljs-string">"JEN_DEV"</span></span>: &lt;&lt; Empty Schema &gt;&gt; Migrating schema <span class="hljs-string"><span class="hljs-string">"JEN_DEV"</span></span> to version 0 - base version Migrating schema <span class="hljs-string"><span class="hljs-string">"JEN_DEV"</span></span> to version 1 - asset Migrating schema <span class="hljs-string"><span class="hljs-string">"JEN_DEV"</span></span> to version 2 - asset <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> Migrating schema <span class="hljs-string"><span class="hljs-string">"JEN_DEV"</span></span> to version 3 - asset parameters Migrating schema <span class="hljs-string"><span class="hljs-string">"JEN_DEV"</span></span> to version 4 - inventory Migrating schema <span class="hljs-string"><span class="hljs-string">"JEN_DEV"</span></span> to version 5 - split inventory Migrating schema <span class="hljs-string"><span class="hljs-string">"JEN_DEV"</span></span> to version 6 - equipment <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> Migrating schema <span class="hljs-string"><span class="hljs-string">"JEN_DEV"</span></span> to version 7 - add insurance value to equipment <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> Migrating schema <span class="hljs-string"><span class="hljs-string">"JEN_DEV"</span></span> to version 8 - data location equipment <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> Successfully applied 9 migrations to schema <span class="hljs-string"><span class="hljs-string">"JEN_DEV"</span></span> (execution time 00:00.394s). psadalag:flyway-4 $</code> </pre> <br><h3 id="razrabotchiki-mogut-obnovlyat-svoi-bazy-dannyh-po-trebovaniyu">        . </h3><br><p>   ,      mainline ‚Äî   ,       .       ,    ,  ,   ,         ,    .     ‚Äî       mainline        . </p><br><p>         .    ,   ,  -      mainline     .       8,             .     . </p><br><pre> <code class="bash hljs">psadalag:flyway-4 $ ./flyway migrate Flyway 4.0.3 by Boxfuse Database: jdbc:oracle:thin:@localhost:1521:xe (Oracle 11.2) ERROR: Found more than one migration with version 8 Offenders: -&gt; /Users/psadalag/flyway-4/sql/V8__data_location_equipment_type.sql (SQL) -&gt; /Users/psadalag/flyway-4/sql/V8__introduce_fuel_type.sql (SQL) psadalag:flyway-4 $</code> </pre> <br><p>     ,    :       9,        mainline.        .      ,     ,   8    9    . </p><br><pre> <code class="sql hljs">psadalag:flyway-4 $ mv sql/V8__introduce_fuel_type.sql sql/V9__introduce_fuel_type.sql psadalag:flyway-4 $ ./flyway clean Flyway 4.0.3 by Boxfuse Database: jdbc:oracle:thin:@localhost:1521:xe (Oracle 11.2) Successfully cleaned schema "JEN_DEV" (execution time 00:00.031s) psadalag:flyway-4 $ ./flyway migrate Flyway 4.0.3 by Boxfuse Database: jdbc:oracle:thin:@localhost:1521:xe (Oracle 11.2) Successfully validated 10 migrations (execution time 00:00.013s) Creating Metadata table: "JEN_DEV"."schema_version" Current version of schema "JEN_DEV": &lt;&lt; Empty Schema &gt;&gt; Migrating schema "JEN_DEV" to version 0 - base version Migrating schema "JEN_DEV" to version 1 - asset Migrating schema "JEN_DEV" to version 2 - asset type Migrating schema "JEN_DEV" to version 3 - asset parameters Migrating schema "JEN_DEV" to version 4 - inventory Migrating schema "JEN_DEV" to version 5 - split inventory Migrating schema "JEN_DEV" to version 6 - equipment type Migrating schema "JEN_DEV" to version 7 - add insurance value to equipment type Migrating schema "JEN_DEV" to version 8 - data location equipment type Migrating schema "JEN_DEV" to version 9 - introduce fuel type Successfully applied 10 migrations to schema "JEN_DEV" (execution time 00:00.435s). psadalag:flyway-4 $</code> </pre> <br><p>     ,    ,  ,  -    ,     .     ,   .      :        . </p><br><p>      ,     ,  ,    mainline    - . </p><br><p>           ,     ,   ,    .        ,    ,  ,       mainline. </p><br><h3 id="chyotko-razdelit-ves-kod-dostupa-k-baze-dannyh">         </h3><br><p>  ,      ,  ,     .  SQL       ,    .          ,      .              <a href="http://www.martinfowler.com/books/eaa.html">Patterns of Enterprise Application Architecture</a> . </p><br><p>          .      ,        SQL,     ,       SQL.      ,     ,    .    ,   ,   SQL,  ,       .       ,    . </p><br><h3 id="delayte-bolshe-relizov">    </h3><br><p>           ,        .   - ,    ‚Äî      . </p><br><p>      ,          production .      ,    ,     ,      ,     . </p><br><h2 id="variacii">  Variations </h2><br><p>      ,        ,    ,    . </p><br><h3 id="neskolko-versiy">   </h3><br><p>        ,  ,    .          AB       <a href="http://martinfowler.com/bliki/CanaryRelease.html">Canary Releases</a> , ,     .       ,         .          production,    ,    ,        . </p><br><p>   ,     ‚Äî          ,     .   ,           ,  ,           ,    production. </p><br><h3 id="dostavka-izmeneniy-s-prilozheniem">     </h3><br><p>      ,            .          ,         (            ),        ,  , , <a href="http://flywaydb.org/">Flyway</a>      . </p><br><h3 id="neskolko-prilozheniy-ispolzuyuschih-odnu-bazu-dannyh">  ,     </h3><br><p>              ‚Äî <a href="http://enterpriseintegrationpatterns.com/SharedDataBaseIntegration.html">  Shared Database</a> .   ,        ,  ,     .   ,    ,     ,     .         <a href="http://sadalage.com/blog/2015/08/16/behavior-driven-database-development/">  </a> ,   ,     ,   ,    .     ,     ,    . </p><br><h3 id="nosql-bazy-dannyh"> NoSQL   </h3><br><p>         ,     ,   ,          .  ,  ,   NoSQL  ,       .   ,     ,     ,       . </p><br><p>   NoSQL        ,     "".          ,      .  ,     ,    .    ,           .              .       ,        . </p><br><h2 id="vam-ne-nuzhna-armiya-administratorov-bd">       </h2><br><p>        ,       .           ,     ( QA,   )    .           ,     .             ,     ,       . </p><br><p>       .        (  ),  ,        .       ,    ,     - ,   ,  ,       . </p><br><p>    .      ,     ,     .      DevOps   (Puppet, Chef, Docker, Rocket, and Vagrant)  . </p><br><p>   ,        ,      ,     ,   ,        production .    ‚Äî     .        ,        .      ,      ,  ,          . </p><br><p>  <em>(Translation by <a href="https://www.instagram.com/minotauria/">Natalia Bass</a> )</em> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/312970/">https://habr.com/ru/post/312970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../312956/index.html">Use Veeam Cloud Connect. Store client backups and replicas</a></li>
<li><a href="../312958/index.html">7 services for monitoring sites</a></li>
<li><a href="../312962/index.html">Incomplete Google AMP technology denies mobile traffic sites.</a></li>
<li><a href="../312964/index.html">NetAngels Contest: Winner of SSL certificate for 1 year and promo codes</a></li>
<li><a href="../312968/index.html">Enter text beautifully</a></li>
<li><a href="../312972/index.html">Lectures of the Technosphere. Semester 2 Information Search (Spring 2016)</a></li>
<li><a href="../312974/index.html">Pygmy-sized web application</a></li>
<li><a href="../312976/index.html">Ruby Hero Russia Award 2016</a></li>
<li><a href="../312978/index.html">The unsightly truth about entrepreneurship</a></li>
<li><a href="../312980/index.html">Developer of the week: Katie McLaughlin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>