<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing a game using Box2D in ActionScript 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, dear reader! 
 Recently an article was published, which described work with the Box2D engine. 
 However, the engine on the site was version ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing a game using Box2D in ActionScript 3</h1><div class="post__text post__text-html js-mediator-article">  Good day, dear reader! <br>  Recently an <a href="http://habrahabr.ru/blogs/gdev/128157/">article</a> was published, which described work with the Box2D engine. <br>  However, the engine on the site was version 2.1a, which, unfortunately, differed from the work provided in the article.  Unfortunately, the meager foreign documentation on this version of the engine made me understand myself in many ways.  Part of my research I would like to share with you, dear reader. <br><a name="habracut"></a><br><br>  First of all I would like to talk about the changes from version 2.0. <br><ul><li>  The geometric properties of the figures were separated from the physical.  Now the physical properties are of the b2FixtureDef type, and the geometric properties remain in the b2BodyDef type.  To apply physical properties to our geometry, we need to call the CreateFixture function for our body <i>(b2Body)</i> with the parameter of physical properties. <br><pre><code class="java hljs">body.CreateFixture(fixtureDef);</code> </pre> </li><li>  You also need to specify the type of our object in b2BodyDef.  There are 3 such types: <ol><li>  Static </li><li>  Dynamic </li><li>  Kinematic <i>(if necessary, so that the object would move, but it could not be moved by other objects)</i> </li></ol></li><li>  Now you do not need to specify the size of our world. </li><li>  The limit on the number of polygons has been removed. </li></ul><br><br>  For the development of a new version, let us analyze an example. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First we need to create a new project <i>(I use FlashDevelop)</i> and see something like this: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> flash.display.Sprite; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> flash.events.Event; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sprite</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stage) init(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> addEventListener(Event.ADDED_TO_STAGE, init); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e:Event = </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">null</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span></span>{ removeEventListener(Event.ADDED_TO_STAGE, init); } } }</code> </pre> <br>  Next, we <a href="http://www.box2dflash.org/download">load the</a> 2.1a version of the engine and throw it into the folder with the code of our project. <br>  We import the classes we need: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Box2D.Common.Math.b2Vec2; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Box2D.Dynamics.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Box2D.Collision.Shapes.b2PolygonShape; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Box2D.Collision.Shapes.b2CircleShape; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> flash.display.Sprite; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> flash.events.Event; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> flash.events.KeyboardEvent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> flash.utils.getTimer;</code> </pre> <br><br>  Create the variables we need: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> PIXELS_TO_METRE:Number = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Number(<span class="hljs-number"><span class="hljs-number">30</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   .  ,   Box2D     . public var world:b2World; // . public var ball:b2Body; //. public var timer:Number = new Number(0); //      .</span></span></code> </pre> <br><br>  After removing the ADDED_TO_STAGE handler, we create our world: <br><pre> <code class="java hljs">world = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2World(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2Vec2(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre> <br>  The first parameter that accepts an object of type b2Vec2 is gravity in our world.  In this case, I have it directed down the y-axis by 10 points, which suits me. <br>  The second parameter is the resolution \ prohibition of sleep for objects in the world. <br><br>  Next you need to create objects in our world.  I decided to create a function that creates a rectangle: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addBox</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x:Number, y:Number, width:Number, height:Number, dyn:</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:b2Body </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bodyDef:b2BodyDef = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2BodyDef(); bodyDef.position.Set((x + width / <span class="hljs-number"><span class="hljs-number">2</span></span>) / PIXELS_TO_METRE, (y + height / <span class="hljs-number"><span class="hljs-number">2</span></span>) / PIXELS_TO_METRE); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dyn == <span class="hljs-number"><span class="hljs-number">1</span></span>) bodyDef.type = b2Body.b2_dynamicBody; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content:Sprite = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Sprite(); content.graphics.beginFill(<span class="hljs-number"><span class="hljs-number">0x000000</span></span>); content.graphics.drawRect(<span class="hljs-number"><span class="hljs-number">0</span></span> - width / <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> - height / <span class="hljs-number"><span class="hljs-number">2</span></span>, width, height); bodyDef.userData = content; addChild(bodyDef.userData); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> boxShape:b2PolygonShape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2PolygonShape(); boxShape.SetAsBox(width / <span class="hljs-number"><span class="hljs-number">2</span></span> / PIXELS_TO_METRE, height / <span class="hljs-number"><span class="hljs-number">2</span></span> / PIXELS_TO_METRE); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fixtureDef:b2FixtureDef = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2FixtureDef(); fixtureDef.shape = boxShape; fixtureDef.density = dyn; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body:b2Body = world.CreateBody(bodyDef); body.CreateFixture(fixtureDef); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(body); }</code> </pre> <br>  The bodyDef object stores the parameters of our rectangle: coordinates, rotation, and contents.  Initially, the point of coordinates is the center of our rectangle.  Since it is inconvenient for me, I calculated the upper left point, which will be entered as a parameter. <br>  In our project there will be both dynamic <i>(living)</i> rectangles and static ones.  We check our parameter <i>(dyn)</i> and set the type, if necessary. <br>  Next, I draw the rectangle itself, its graphic component, starting from the center. <br>  The SetAsBox method on an object of type b2PolygonShape assigns a rectangle to the physical part of the object.  As parameters, it also takes meters and starts counting from the middle. <br>  The fixtureDef object is the physical parameters of our rectangle: dynamism, density, elasticity, and a physical model.  Such parameters as density and elasticity, I did not use. <br>  Next, we send data about the object in our world. <br><br>  Next, I created a function to create the ball, the main character of our project: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addBall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x:Number, y:Number, radius:Number)</span></span></span><span class="hljs-function">:</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bodyDef:b2BodyDef = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2BodyDef(); bodyDef.position.Set((x + radius) / PIXELS_TO_METRE, (y + radius) / PIXELS_TO_METRE); bodyDef.type = b2Body.b2_dynamicBody; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content:Sprite = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Sprite(); content.graphics.beginFill(<span class="hljs-number"><span class="hljs-number">0x000000</span></span>); content.graphics.drawCircle(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, radius); bodyDef.userData = content; addChild(bodyDef.userData); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> circShape:b2CircleShape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2CircleShape(radius / PIXELS_TO_METRE); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fixtureDef:b2FixtureDef = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2FixtureDef(); fixtureDef.shape = circShape; fixtureDef.density = <span class="hljs-number"><span class="hljs-number">1</span></span>; ball = world.CreateBody(bodyDef); ball.CreateFixture(fixtureDef); }</code> </pre> <br>  Creating a ball is extremely similar to creating a rectangle and therefore I will not consider it. <br><br>  Create a triangle that we will have a ladder: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTriangle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x:Number, y:Number, size:Number)</span></span></span><span class="hljs-function">:</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bodyDef:b2BodyDef = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2BodyDef(); bodyDef.position.Set(x / PIXELS_TO_METRE, y / PIXELS_TO_METRE); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content:Sprite = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Sprite(); content.graphics.beginFill(<span class="hljs-number"><span class="hljs-number">0x000000</span></span>); content.graphics.moveTo(size, <span class="hljs-number"><span class="hljs-number">0</span></span>); content.graphics.lineTo(<span class="hljs-number"><span class="hljs-number">0</span></span>, size); content.graphics.lineTo(size, size); bodyDef.userData = content; addChild(bodyDef.userData); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> polyDef:b2PolygonShape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2PolygonShape(); polyDef.SetAsArray([ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2Vec2(size / PIXELS_TO_METRE, size / PIXELS_TO_METRE), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2Vec2(<span class="hljs-number"><span class="hljs-number">0</span></span>, size / PIXELS_TO_METRE), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2Vec2(size / PIXELS_TO_METRE, <span class="hljs-number"><span class="hljs-number">0</span></span>) ]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fixtureDef:b2FixtureDef = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2FixtureDef(); fixtureDef.shape = polyDef; fixtureDef.density = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body:b2Body = world.CreateBody(bodyDef); body.CreateFixture(fixtureDef); }</code> </pre> <br>  It's all the same, except for the creation of a physical model.  The physical model here is an object of type b2PolygonShape.  Since there is no template <i>(like addBox),</i> we ourselves draw a triangle using an array of vectors.  Countdown begins from the last element of the array to the first. <br><br>  Next, we create a function called creteObjects, where we write: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">creteObjects</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span></span>{ addBall(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>); addBox(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">580</span></span>, <span class="hljs-number"><span class="hljs-number">450</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); addBox(<span class="hljs-number"><span class="hljs-number">250</span></span>, <span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); addTriangle(<span class="hljs-number"><span class="hljs-number">210</span></span>, <span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>); addBox(<span class="hljs-number"><span class="hljs-number">610</span></span>, <span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">190</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>); addBox(-<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span>); addBox(<span class="hljs-number"><span class="hljs-number">800</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m1:b2Body = addBox(<span class="hljs-number"><span class="hljs-number">430</span></span>, <span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m2:b2Body = addBox(<span class="hljs-number"><span class="hljs-number">451</span></span>, <span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m3:b2Body = addBox(<span class="hljs-number"><span class="hljs-number">472</span></span>, <span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m4:b2Body = addBox(<span class="hljs-number"><span class="hljs-number">493</span></span>, <span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m5:b2Body = addBox(<span class="hljs-number"><span class="hljs-number">514</span></span>, <span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m6:b2Body = addBox(<span class="hljs-number"><span class="hljs-number">535</span></span>, <span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m7:b2Body = addBox(<span class="hljs-number"><span class="hljs-number">556</span></span>, <span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m8:b2Body = addBox(<span class="hljs-number"><span class="hljs-number">577</span></span>, <span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m9:b2Body = addBox(<span class="hljs-number"><span class="hljs-number">598</span></span>, <span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre> <br>  The last elements are our future bridge. <br>  Next we need to connect the elements of our bridge. <br>  We write the following to the end of creteObjects: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jointDef:b2RevoluteJointDef = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2RevoluteJointDef(); jointDef.enableLimit = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; jointDef.lowerAngle = <span class="hljs-number"><span class="hljs-number">0</span></span>; jointDef.upperAngle = <span class="hljs-number"><span class="hljs-number">0.1</span></span>; jointDef.Initialize(m1, m2, m1.GetWorldCenter()); world.CreateJoint(jointDef); jointDef.Initialize(m2, m3, m2.GetWorldCenter()); world.CreateJoint(jointDef); jointDef.Initialize(m3, m4, m3.GetWorldCenter()); world.CreateJoint(jointDef); jointDef.Initialize(m4, m5, m4.GetWorldCenter()); world.CreateJoint(jointDef); jointDef.Initialize(m5, m6, m5.GetWorldCenter()); world.CreateJoint(jointDef); jointDef.Initialize(m6, m7, m6.GetWorldCenter()); world.CreateJoint(jointDef); jointDef.Initialize(m7, m8, m7.GetWorldCenter()); world.CreateJoint(jointDef); jointDef.Initialize(m8, m9, m8.GetWorldCenter()); world.CreateJoint(jointDef);</code> </pre> <br>  First, we create the configuration of our bundle to which we apply limits, so as not to shake much. <br>  Further we connect all elements among themselves. <br><br>  All objects in the world are ready and working.  But if you compile the application, we will not see anything good.  Why?  We have not completed the render. <br>  At the end of the init function, we create the ENTER_FRAME event: <br><pre> <code class="java hljs">stage.addEventListener(Event.ENTER_FRAME, onEnterFrame);</code> </pre> <br>  Actually the onEnterFrame function code: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onEnterFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e:Event = </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">null</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span></span>{ world.Step(<span class="hljs-number"><span class="hljs-number">1</span></span> / <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bb:b2Body = world.GetBodyList(); bb; bb = bb.GetNext()){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bb.GetUserData() is Sprite) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sprite:Sprite = bb.GetUserData() as Sprite; sprite.x = bb.GetPosition().x * PIXELS_TO_METRE; sprite.y = bb.GetPosition().y * PIXELS_TO_METRE; sprite.rotation = bb.GetAngle() * (<span class="hljs-number"><span class="hljs-number">180</span></span> / Math.PI); } } }</code> </pre> <br>  Step function updates our world.  As a parameter, it takes how often to update objects.  In seconds. <br>  Next, we get all the objects in the world and update their position and rotation. <br><br>  You can test.  Everything works fine, not taking into account the fact that we can not control our character.  Now fix this. <br><br> <a href="http://itmages.ru/image/view/281937/85d2c78a"><img src="https://habrastorage.org/getpro/habr/post_images/0c3/8f9/4aa/0c38f94aa68d2b2aa555a3e3e5336be3.png"></a> <br><br>  Add a keystroke handler: <br><pre> <code class="java hljs">stage.addEventListener(KeyboardEvent.KEY_DOWN, onKeyDown);</code> </pre> <br>  Create an onKeyDown function: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onKeyDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e:KeyboardEvent)</span></span></span><span class="hljs-function">:</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.keyCode == <span class="hljs-number"><span class="hljs-number">39</span></span> &amp;&amp; getTimer() - p &gt; <span class="hljs-number"><span class="hljs-number">200</span></span>) { ball.ApplyImpulse(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2Vec2(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), ball.GetPosition()); p = getTimer(); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.keyCode == <span class="hljs-number"><span class="hljs-number">37</span></span> &amp;&amp; getTimer() - p &gt; <span class="hljs-number"><span class="hljs-number">200</span></span>) { ball.ApplyImpulse(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> b2Vec2( -<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), ball.GetPosition()); p = getTimer(); } }</code> </pre> <br>  The ApplyImpulse function applies a push to an object with a given force vector and position. <br>  I also remember keystroke and the following will happen no earlier than 200 milliseconds. <br><br>  As a result, we get <a href="http://megaswf.com/serve/1173896">this</a> .  Download the source code of the project <a href="http://rghost.ru/21704871">here</a> . <br>  We briefly discussed the creation of objects in the world of Box2D as standard and its own.  They created a bridge with tangles and taught the character to move.  Good luck, dear reader! </div><p>Source: <a href="https://habr.com/ru/post/128529/">https://habr.com/ru/post/128529/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128524/index.html">10 menu examples for web pages</a></li>
<li><a href="../128525/index.html">Competition from Unisender: welcome aboard or Baltic e-mail marketing conference</a></li>
<li><a href="../128526/index.html">Protection against DDOS attacks with improvised means. Getting access to your server</a></li>
<li><a href="../128527/index.html">Re: Command line in the service of a Linux photographer</a></li>
<li><a href="../128528/index.html">Google.com is 14 years old</a></li>
<li><a href="../128530/index.html">A brief video review of Windows 8</a></li>
<li><a href="../128532/index.html">The concept of educational social network</a></li>
<li><a href="../128533/index.html">Getting Started with the Google+ API</a></li>
<li><a href="../128534/index.html">Analysis of static C ++ code analysis tools</a></li>
<li><a href="../128535/index.html">Simple implementation of the long polling mechanism in PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>