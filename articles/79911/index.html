<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Working with ICQ in Java</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 Once we decided to create our own microblogging with blackjack and whores c chess and poetess. At first they made the site, but it quickl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Working with ICQ in Java</h1><div class="post__text post__text-html js-mediator-article"><h4>  Prehistory </h4><br>  Once we decided to create <a href="http://joyreactor.ru/">our own microblogging</a> <s>with blackjack and whores</s> c chess and poetess.  At first they made the site, but it quickly became clear that it was not enough to implement the idea.  It was necessary to work with messages through Jabber and ICQ. <br>  We started with a simple one - with jabber.  There were no problems here - we wrote in Java, so we screwed the <a href="http://www.igniterealtime.org/projects/smack/">Smack API</a> and it all worked.  But, as it is not sad, but the most popular IM protocol is still ICQ ... <br><br><h4>  Task </h4><br>  So, the task: log in to ICQ, receive and send messages, understand X-statuses, work with Cyrillic. <br><br>  Consider solutions. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Solutions </h4><br>  * <a href="http://www.google.ru/search%3Fq%3Dicq%2Bjava%2Blibrary">icq java library</a> - find and use a certain analogue of the Smack API for ICQ <br>  * <a href="http://code.google.com/p/pyicqt/">PyICQt</a> - use personal ICQ transport and work with it through the same Smack API <br>  * score on ICQ and continue to use the Orthodox Jabber - no comment))) <br><br><h5>  icq java library </h5><br>  The method of deep googling on the above query " <a href="http://www.google.ru/search%3Fq%3Dicq%2Bjava%2Blibrary">icq java library</a> " was able to find the following: <br><br>  Library - Last Updated <br>  <a href="http://sourceforge.net/projects/exeqlib/">exeQ</a> - 2539 days ago <br>  <a href="http://sourceforge.net/projects/openmim/">OpenMIM</a> - 240 days ago <br>  <a href="http://code.google.com/p/joscar/">joscar</a> - &lt;30 days ago <br><br>  <i>The parameter ‚ÄúLast update‚Äù describes the abandonment of the library.</i>  <i>When choosing the ICQ library, it is absolutely necessary to take into account its abandonment.</i>  The fact is that the owner of ICQ is AOL Corporation.  Very kind and cheerful people work there who change the ICQ protocol for the sake of lulz about a couple of times a year, which is why third-party clients and libraries SUDDENLY stop working until the authors fix them. <br><br>  For obvious reasons, only joscar deserves close attention from the listed libraries, but at the time of this writing, he had serious problems with Cyrillic, but there is hope that they will be eliminated in the near future. <br><br>  In the meantime, we move on to the next method. <br><br><h5>  PyICQt </h5><br>  Argued that ICQ-transport - is evil.  And this is true, but there is one nuance: a <b>public ICQ-transport is evil.</b> <br>  Problems in the work of public ICQ-transports are related to the fact that ICQ servers severely limit the number of connections from a single client IP, so the transport can normally serve only a very small number of clients. <br>  Public transport does not suit us, then you have to raise your own. <br><br>  The procedure for installing / configuring PyICQt + EJabberd is quite simple and described, for example, <a href="http://sviver88.blogspot.com/2009/07/icq-pyicq-ejabberd-freebsd.html">here</a> .  We are more interested in the client part. <br><br>  So, we raised a jabber server located at jabber.joyreactor.ru and icq-transport on it with the address icq.jabber.joyreactor.ru. <br><br>  Now you need to create a user, on behalf of which we will connect: <br><br> <code>ejabberdctl register username jabber.joyreactor.ru password</code> <br> <br>  Next, log in on his behalf to our server with any jabber-client and add our user icq-transport using Service Discovery.  All is ready!  You can go to Java. <br><br>  We need the <a href="http://www.igniterealtime.org/downloads/index.jsp">Smack API</a> : <br><br><blockquote>  <font color="#000000">import</font> <font color="#006699">org.jivesoftware.smack. *</font> <font color="#339933">;</font> </blockquote><br><br>  and the following information: <br><br><blockquote>  Roster.  <font color="#006633">setDefaultSubscriptionMode</font> <font color="#009900">(</font> SubscriptionMode. <font color="#006633">accept_all</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  XMPPConnection icqConnection <font color="#339933">=</font> <font color="#000000">new</font> XMPPConnection <font color="#009900">(</font> ICQ_HOST <font color="#009900">)</font> <font color="#339933">;</font> <br>  icqConnection.  <font color="#006633">connect</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  SASLAuthentication.  <font color="#006633">supportSASLMechanism</font> <font color="#009900">(</font> <font color="#0000ff">"PLAIN"</font> , <font color="#cc66cc">0</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#666666">// To connect to EJabberd</font> <br>  icqConnection.  <font color="#006633">login</font> <font color="#009900">(</font> ICQ_LOGIN, ICQ_PASS <font color="#009900">)</font> <font color="#339933">;</font> <br></blockquote><br><br>  Connect: <br><br><blockquote>  Roster.  <font color="#006633">setDefaultSubscriptionMode</font> <font color="#009900">(</font> SubscriptionMode. <font color="#006633">accept_all</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  XMPPConnection icqConnection <font color="#339933">=</font> <font color="#000000">new</font> XMPPConnection <font color="#009900">(</font> ICQ_HOST <font color="#009900">)</font> <font color="#339933">;</font> <br>  icqConnection.  <font color="#006633">connect</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  SASLAuthentication.  <font color="#006633">supportSASLMechanism</font> <font color="#009900">(</font> <font color="#0000ff">"PLAIN"</font> , <font color="#cc66cc">0</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#666666">// To connect to EJabberd</font> <br>  icqConnection.  <font color="#006633">login</font> <font color="#009900">(</font> ICQ_LOGIN, ICQ_PASS <font color="#009900">)</font> <font color="#339933">;</font> <br></blockquote><br>  set handlers: <br><br><blockquote>  RosterListener rosterListener <font color="#339933">=</font> <font color="#000000">new</font> RosterListener <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000000">public</font> <font color="#000066">void</font> entriesAdded <font color="#009900">(</font> Collection <font color="#339933">&lt;</font> String <font color="#339933">&gt;</font> arg0 <font color="#009900">)</font> <font color="#009900">{</font> <br>  Roster roster <font color="#339933">=</font> connection.  <font color="#006633">getRoster</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  RosterGroup gr <font color="#339933">=</font> roster.  <font color="#006633">getGroup</font> <font color="#009900">(</font> <font color="#0000ff">"Users"</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000000">if</font> <font color="#009900">(</font> gr <font color="#339933">==</font> <font color="#000066">null</font> <font color="#009900">)</font> <br>  gr <font color="#339933">=</font> roster  <font color="#006633">createGroup</font> <font color="#009900">(</font> <font color="#0000ff">"Users"</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000000">for</font> <font color="#009900">(</font> <font color="#003399">String</font> entry <font color="#339933">:</font> arg0 <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000000">try</font> <font color="#009900">{</font> <br>  <font color="#003399">String</font> <font color="#009900">[</font> <font color="#009900">]</font> groups <font color="#339933">=</font> <font color="#009900">{</font> <font color="#0000ff">"Users"</font> <font color="#009900">}</font> <font color="#339933">;</font> <br>  <font color="#000000">if</font> <font color="#009900">(</font> roster. <font color="#006633">getEntry</font> <font color="#009900">(</font> entry <font color="#009900">)</font> <font color="#339933">==</font> <font color="#000066">null</font> <font color="#009900">)</font> <br>  roster.  <font color="#006633">createEntry</font> <font color="#009900">(</font> entry, <font color="#000066">null</font> , groups <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <font color="#000000">catch</font> <font color="#009900">(</font> XMPPException ex <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#666666">// TODO: Handle exception.</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br>  <font color="#000000">public</font> <font color="#000066">void</font> entriesUpdated <font color="#009900">(</font> Collection <font color="#339933">&lt;</font> String <font color="#339933">&gt;</font> arg0 <font color="#009900">)</font> <font color="#009900">{</font> <br>  Roster roster <font color="#339933">=</font> connection.  <font color="#006633">getRoster</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  RosterGroup gr <font color="#339933">=</font> roster.  <font color="#006633">getGroup</font> <font color="#009900">(</font> <font color="#0000ff">"Users"</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000000">if</font> <font color="#009900">(</font> gr <font color="#339933">==</font> <font color="#000066">null</font> <font color="#009900">)</font> <br>  gr <font color="#339933">=</font> roster  <font color="#006633">createGroup</font> <font color="#009900">(</font> <font color="#0000ff">"Users"</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000000">for</font> <font color="#009900">(</font> <font color="#003399">String</font> entry <font color="#339933">:</font> arg0 <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000000">try</font> <font color="#009900">{</font> <br>  <font color="#003399">String</font> <font color="#009900">[</font> <font color="#009900">]</font> groups <font color="#339933">=</font> <font color="#009900">{</font> <font color="#0000ff">"Users"</font> <font color="#009900">}</font> <font color="#339933">;</font> <br>  <font color="#000000">if</font> <font color="#009900">(</font> roster. <font color="#006633">getEntry</font> <font color="#009900">(</font> entry <font color="#009900">)</font> <font color="#339933">==</font> <font color="#000066">null</font> <font color="#009900">)</font> <br>  roster.  <font color="#006633">createEntry</font> <font color="#009900">(</font> entry, <font color="#000066">null</font> , groups <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <font color="#000000">catch</font> <font color="#009900">(</font> XMPPException ex <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#666666">// TODO: Handle exception.</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br>  <font color="#000000">public</font> <font color="#000066">void</font> entriesDeleted <font color="#009900">(</font> Collection <font color="#339933">&lt;</font> String <font color="#339933">&gt;</font> arg0 <font color="#009900">)</font> <font color="#009900">{</font> <font color="#009900">}</font> <br>  <font color="#000000">public</font> <font color="#000066">void</font> presenceChanged <font color="#009900">(</font> Presence packet <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000000">try</font> <font color="#009900">{</font> <br>  org.  <font color="#006633">jivesoftware</font> .  <font color="#006633">smack</font>  <font color="#006633">packet</font> .  <font color="#006633">Presence</font> prs <font color="#339933">=</font> <font color="#009900">(</font> org. <font color="#006633">Jivesoftware</font> . <font color="#006633">Smack</font> . <font color="#006633">Packet</font> . <font color="#006633">Presence</font> <font color="#009900">)</font> packet <font color="#339933">;</font> <br>  <font color="#000000">if</font> <font color="#009900">(</font> <font color="#339933">!</font> prs. <font color="#006633">getFrom</font> <font color="#009900">(</font> <font color="#009900">)</font> . <font color="#006633">split</font> <font color="#009900">(</font> <font color="#0000ff">"@"</font> <font color="#009900">)</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> . <font color="#006633">equalsIgnoreCase</font> <font color="#009900">(</font> ICQ_TRANSPORT <font color="#009900">)</font> <font color="#009900">)</font> <br>  <font color="#666666">// TODO: Process presence.</font> <br>  <font color="#009900">}</font> <font color="#000000">catch</font> <font color="#009900">(</font> <font color="#003399">Exception</font> ex <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#666666">// TODO: Handle exception.</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <font color="#339933">;</font> <br>  PacketListener icqListener <font color="#339933">=</font> <font color="#000000">new</font> PacketListener <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000000">public</font> <font color="#000066">void</font> processPacket <font color="#009900">(</font> Packet packet <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000000">try</font> <font color="#009900">{</font> <br>  org.  <font color="#006633">jivesoftware</font> .  <font color="#006633">smack</font>  <font color="#006633">packet</font> .  <font color="#006633">Message</font> msg <font color="#339933">=</font> <font color="#009900">(</font> org. <font color="#006633">Jivesoftware</font> . <font color="#006633">Smack</font> . <font color="#006633">Packet</font> . <font color="#006633">Message</font> <font color="#009900">)</font> packet <font color="#339933">;</font> <br>  <font color="#000000">if</font> <font color="#009900">(</font> msg. <font color="#006633">getType</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">! =</font> org. <font color="#006633">jivesoftware</font> . <font color="#006633">smack</font> . <font color="#006633">packet</font> . <font color="#006633">Message</font> . <font color="#006633">Type</font> . <font color="#006633">error</font> <font color="#339933">&amp;&amp;</font> <br>  msg.  <font color="#006633">getFrom</font> <font color="#009900">(</font> <font color="#009900">)</font> .  <font color="#006633">split</font> <font color="#009900">(</font> <font color="#0000ff">"@"</font> <font color="#009900">)</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> .  <font color="#006633">equalsIgnoreCase</font> <font color="#009900">(</font> ICQ_TRANSPORT <font color="#009900">)</font> <font color="#009900">)</font> <br>  <font color="#666666">// TODO: Process message.</font> <br>  <font color="#009900">}</font> <font color="#000000">catch</font> <font color="#009900">(</font> <font color="#003399">Exception</font> ex <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#666666">// TODO: Handle exception.</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <font color="#339933">;</font> <br>  icqConnection.  <font color="#006633">getRoster</font> <font color="#009900">(</font> <font color="#009900">)</font> .  <font color="#006633">addRosterListener</font> <font color="#009900">(</font> icqRosterListener <font color="#009900">)</font> <font color="#339933">;</font> <br>  icqConnection.  <font color="#006633">addPacketListener</font> <font color="#009900">(</font> icqListener, <font color="#000000">new</font> PacketTypeFilter <font color="#009900">(</font> org. <font color="#006633">jivesoftware</font> . <font color="#006633">smack</font> . <font color="#006633">packet</font> . <font color="#006633">Message</font> . <font color="#000000">class</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <br></blockquote>  send message: <br><br><blockquote>  org.  <font color="#006633">jivesoftware</font> .  <font color="#006633">smack</font>  <font color="#006633">packet</font> .  <font color="#006633">Message</font> message <font color="#339933">=</font> <font color="#000000">new</font> org.  <font color="#006633">jivesoftware</font> .  <font color="#006633">smack</font>  <font color="#006633">packet</font> .  <font color="#006633">Message</font> <font color="#009900">(</font> <font color="#0000ff">"587641264"</font> <font color="#339933">+</font> <font color="#0000ff">"@"</font> <font color="#339933">+</font> ICQ_TRANSPORT <font color="#009900">)</font> <font color="#339933">;</font> <br>  message.  <font color="#006633">setBody</font> <font color="#009900">(</font> <font color="#0000ff">"Hello world !!!"</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  icqConnection.  <font color="#006633">sendPacket</font> <font color="#009900">(</font> message <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br><h4>  Morality </h4><br>  During the solution of the problem, we encountered many problems, the main of which is the rapid obsolescence of the ICQ protocol.  We were able to bypass only with the help of personal ICQ-transport, which, as it turned out, is relatively easy to configure. <br>  Sources <a href="http://code.assembla.com/empaty/subversion/nodes/em">here</a> . <br><br>  It would be interesting to hear about a similar experience with you. </div><p>Source: <a href="https://habr.com/ru/post/79911/">https://habr.com/ru/post/79911/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../79893/index.html">Search for a suitable distributed cluster file system</a></li>
<li><a href="../79894/index.html">Remove yourself from an online society - "Web 2.0 Suicide Machine"</a></li>
<li><a href="../79899/index.html">New Year's agitation or hosting free then</a></li>
<li><a href="../79900/index.html">The most interesting publication of the year 2009 about Delphi</a></li>
<li><a href="../79909/index.html">intv.ru distributes 10 USD</a></li>
<li><a href="../79912/index.html">Optimize memory and queries in wordpress</a></li>
<li><a href="../79913/index.html">All about String.intern ()</a></li>
<li><a href="../79916/index.html">Gamers generation</a></li>
<li><a href="../79917/index.html">The most high-tech ball in history</a></li>
<li><a href="../79919/index.html">Computer in the car</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>