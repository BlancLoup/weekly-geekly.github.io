<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Electric demon and carbon dioxide</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, two curious devices arrived from America: the electric imp microcomputer and the K30 optical sensor for carbon dioxide in the air. Each of t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Electric demon and carbon dioxide</h1><div class="post__text post__text-html js-mediator-article">  Recently, two curious devices arrived from America: the electric imp microcomputer and the K30 optical sensor for carbon dioxide in the air.  Each of them is curious in its own way, I will tell a little about each of them and about their connection. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/521/3b3/f0a/5213b3f0a96f61c1f0814c76b3edf7d8.jpg" width="640" height="427"><br><br><h2>  Electric imp </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Imps are a kind of imp in German folklore.  As well as an abbreviation for the Interface Message Processor, one of <a href="http://en.wikipedia.org/wiki/Interface_Message_Processor">the predecessor projects for the Internet</a> .  The creators of the system recognize both predecessors.  In life, this thing turned out to be a rather docile, well-documented platform for developing embedded applications. <br><br>  The article-review of Internet announcements can be read in the <a href="http://habrahabr.ru/post/148119/">article on Habr√©</a> , I will try to tell you about the specifics and subtleties that became clear in the process. <br><a name="habracut"></a><br><br><h3>  How it all works. </h3><br><img src="https://habrastorage.org/getpro/geektimes/post_images/d34/97b/e42/d3497be4235011745daf27aee46a2eaa.jpg" width="573" height="350"><br>  <sub>Grandma feeds imps, source: Wikipedia</sub> <br><br>  The system consists of three parts: <br><br>  1. <strong>Imp itself</strong> .  It was all seen in the photos, this is the same SD card with LEDs inside and a photodiode on the ‚Äútop‚Äù (opposite to the contacts) end, through which the wifi network configuration is written into it. <br> <a href="http://imgur.com/3vnup"><img src="https://habrastorage.org/getpro/geektimes/post_images/ae1/9a3/7b5/ae19a37b5aa01d326861b3053dc47812.jpg" title="Hosted by imgur.com"></a> <a href="http://imgur.com/zl0mV"><img src="https://habrastorage.org/getpro/geektimes/post_images/280/3f5/402/2803f54024299429f9bd830bf40c1e3c.jpg" title="Hosted by imgur.com"></a> <br><br>  I will repeat the main characteristics of the ‚ÄúSD-patches‚Äù filling: <br><table><tbody><tr><td width="100">  CPU: </td><td>  Cortex M3 32 bit </td></tr><tr><td>  Wifi: </td><td>  b / g / n (!), WEP, WPA, WPA2, WPS, WPS-PIN. </td></tr><tr><td>  I / O: </td><td>  6 legs that can be configured for GPIO or embedded RS-232, I2C, SPI, PWM and ADC.  There is a built-in pulse counter and interrupt handling of events on the first leg.  The assignment of the legs can be changed during the execution of the program. </td></tr></tbody></table><br>  Power supply - 3.3V, maximum - 3.6V, logic is <em>not</em> 5V tolerant.  On my shawl with a connector is a voltage regulator, so it can be powered by any voltage, but the signals must be 3.3V. <br><br>  Imp performance is a separate, interesting topic.  ARM promises for the Cortex-M3 12.5 DMIPS / mW, whatever that means.  In the coming days I want to measure the performance of the processor and the wifi of the imp with any tests, I will be grateful to the readers, who will tell me where to look for generally accepted speed tests for embedded platforms.  Well, or just advise how to do it better. <br><br>  Imp program is programmed in the <a href="http://www.squirrel-lang.org/">squirrel</a> language, about which I can not say anything bad.  This is such a "scripting C".  Those.  syntax - from C, dynamic types, automatic memory management - from scripts.  The interpreter <em>and</em> bytecode compiler are 7K lines in C ++.  The interpreter can be downloaded as a source under linux or installed from macport on a poppy.  Classes related to the imp itself are described in the <a href="http://devwiki.electricimp.com/doku.php%3Fid%3Delectricimpapi">development wiki.</a> <br><br>  2. <strong>Impee, "impuleable</strong> . <strong>"</strong>  This is the plug into which the imp is inserted.  Each slot has an impedance identification chip ( <a href="http://www.atmel.com/Images/doc8740.pdf">ATSHA204</a> ), which is involved in encrypting the traffic from the imp to the Scheduler.  In the scheduler, impee is displayed in the form of rectangles, and not imps.  And your code, or as they call it, ‚Äúfirmware‚Äù (firmware), is downloaded when you turn on impee with any imp inserted.  That is, the imps can be freely rearranged, if the saved wifi configuration allows them to connect to the network.  Immediately after switching on and establishing a connection, the firmware inserted into the inserted imp will be flooded, which in Scheduler is associated with this impee.  After uploading the firmware, the connection with the Internet can be disconnected, imp will continue to work, but there will be no connection with the outside world, respectively.  There are no firmware downloads from the local network and they will not do it. <br><br>  3. <strong>Planner</strong> .  This is the cloud service that all electric imp-a reviews mention.  Free for developer imps, and I haven‚Äôt yet seen others on sale. <br>  It performs two independent functions: creating and editing firmware for imps and combining imps and wimps (virtual imps).  Virtual imps are currently modules run on the electricimp.com server, written by the electrical impovtsami themselves.  You cannot load your code as a virtual imp yet.  Now there are exactly 10 WIMPs, of which practically useful are three: sending and receiving an HTTP request, as well as publishing data on the cosm.com service. <br><br> <a href="http://imgur.com/JMv2P"><img src="https://habrastorage.org/getpro/geektimes/post_images/ec1/b1c/7f0/ec1b1c7f0e2df829a1bf936aeba33c3e.jpg" title="Hosted by imgur.com"></a> <br><br><h3>  Imp programming </h3><br>  The startup sequence of a working ipma looks like this. <br><br>  1. Imp must commission, put into operation.  To do this, it must be inserted into the connector (impee), with flashes (blink up) to transfer the configuration of the wifi network to it.  Live it looks like this: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/zbhu7Mwicok%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253&amp;usg=ALkJrhhv_9hVO4mG3X2l6zzzz_WgPp_S4w" frameborder="0" allowfullscreen=""></iframe><br><br>  2. After that, a new blue rectangle corresponding to impee will appear in the Scheduler.  In the menu, you can select the firmware designed for this device. <br><br>  3. The firmware must be written and debugged.  This can be done directly in the corresponding scheduler interface.  It is divided into two parts, the code is written at the top, error messages and the operation logs of the imp are displayed at the bottom. <br>  <a href="https://gist.github.com/4360766">My code for imp-a</a> , receiving and publishing on cosm.com data from the CO2 sensor, as well as a <a href="">screenshot of the editor</a> in the charger with the output log imp-a.  Please note that there are no procedures in the code related to communication with the cosm.  This communication takes place through the output interface, to which a virtual imp (vimp) is connected to the scheduler, in the screenshot above it is light green. <br><br><h2>  CO2 sensor </h2><br><br> <a href="http://imgur.com/JkjK9"><img src="https://habrastorage.org/getpro/geektimes/post_images/1cd/649/486/1cd64948695e6db7d10f26d66cbc2a50.jpg" title="Hosted by imgur.com"></a> <a href="http://imgur.com/eBQSl"><img src="https://habrastorage.org/getpro/geektimes/post_images/c64/519/945/c6451994574a576ebec2782914efa487.jpg" title="Hosted by imgur.com"></a> <a href="http://imgur.com/DGW6n"><img src="https://habrastorage.org/getpro/geektimes/post_images/ad5/79d/438/ad579d438e0bd7d16f74bf6679dd478f.jpg" title="Hosted by imgur.com"></a> <br><br>  It is interesting to measure the level of CO2 in a room for three reasons. <br><br>  First, in itself, this gas in elevated concentrations is not useful.  Weak excess leads to a feeling of stale head and stale air.  A significant increase in CO2 levels (up to 0.2‚Äì0.5%) leads to heart palpitations, loss of concentration and mild nausea.  Levels greater than 0.5% are considered toxic, more than 4% are life-threatening. <br><br>  Secondly, in ventilation systems, CO2 sensors are used as ‚Äúcanaries in the mine‚Äù.  It turns out that, as a rule, elevated CO2 levels are accompanied by elevated levels of other air pollutants, such as phenols and natural gases.  Those.  CO2 sensor can be considered as a common "air quality sensor". <br><br>  Third, it is convenient to measure CO2 by the optical method (NDIR), which gives exceptionally good temporal, temperature, and selective (ie, insensitivity to other impurities) stability. <br><br>  <a href="http://www.co2meter.com/products/k-30-co2-sensor-module">The K30 sensor</a> is the cheapest ($ 65) CO2 level meter based on the nondispersive infrared sensor (NDIR, <a href="http://en.wikipedia.org/wiki/Nondispersive_infrared_sensor">en.wikipedia.org/wiki/Nondispersive_infrared_sensor</a> ).  It can be said that the NDIR sensor is a spectrometer that measures the absorption of light of a single wavelength, depending on the concentration of the gas being measured.  For CO2, an infrared LED with a wavelength of 4 micrometers is used. <br><br>  In addition to the analog output, the sensor can communicate with the outside world using the I2C and RS-232 protocols.  I could not connect to it via i2c, neither imp-ohm, nor arduinoy uno.  At the same time, I took the code for the Arduin from the manufacturer's datasheets, but I could not receive a single byte (and it seems to even successfully send, which is quite surprising) from the sensor.  I do not have a logic analyzer, so I didn‚Äôt get an accurate diagnosis, but most of all it was like the incompatibility of the i2c protocol implementations with the sensor and controllers.  Documentation of the i2c interface of the imp additionally also lies - the write method returned -2, although I had to -1 for unsuccessful sending, in general, I decided to refer to the good old RS232. <br><br>  Unfortunately, it is necessary to communicate with the sensor using a heavy industrial protocol <a href="http://ru.wikipedia.org/wiki/Modbus">ModBus</a> .  Luckily, the datasheet results in a magic string of bytes, which must be sent to read CO2 measurement data.  So I did not go deep into the industrial protocols, sent a magic string and got a normal answer! <br><br>  Now the level of carbon dioxide in the room where my imp are located and the sensor can be <a href="https://cosm.com/feeds/94395">viewed here</a> .  Now the sensor is periodically in a state of "guts out" and disconnected from the cosmos, but I hope that when you read this article, it will be online. <br><br><h2>  findings </h2><br>  I liked electric imp for its originality and well-thought-out concept, as well as the lack of glitch.  Its cloudy part, including documentation, still carries traces of stormy refinement, but I hope that the guys will get on and we will be able to use imps where it‚Äôs appropriate and convenient: in home automation, robots and monitoring systems. <br><br>  The K30 carbon dioxide sensor is convenient and reliable when communicating with it via the RS-232 interface.  I2C requires debugging, I am not the only one who has encountered this problem. </div><p>Source: <a href="https://habr.com/ru/post/163751/">https://habr.com/ru/post/163751/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../163739/index.html">We improve the experience of interaction with forms</a></li>
<li><a href="../163741/index.html">Call to Santa Claus</a></li>
<li><a href="../163743/index.html">Searchlight past events ‚Ññ1</a></li>
<li><a href="../163745/index.html">Windows exception handling</a></li>
<li><a href="../163749/index.html">UCLA created a new type of magnetoresistive memory.</a></li>
<li><a href="../163755/index.html">Erlang on Xen - run Erlang applications on bare virtual hardware</a></li>
<li><a href="../163761/index.html">Xabber will open under GPLv3 in January</a></li>
<li><a href="../163767/index.html">Simple in-circuit programmer ARM microcontroller LPC series do it yourself. Circuitry. Part one</a></li>
<li><a href="../163769/index.html">Something about page weight</a></li>
<li><a href="../163771/index.html">Using Webex on Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>