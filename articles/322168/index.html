<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Union Type, TPT, DDD, ORM and RDBMS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Combinations and pattern-matching are widely used in functional programming to increase the reliability and expressiveness of programs. 

 A classic e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Union Type, TPT, DDD, ORM and RDBMS</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/07b/4b0/488/07b4b04880d9471a9d0ad33978261579.png"></div><br>  <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B1%25D1%258A%25D0%25B5%25D0%25B4%25D0%25B8%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_(%25D1%2581%25D1%2582%25D1%2580%25D1%2583%25D0%25BA%25D1%2582%25D1%2583%25D1%2580%25D0%25B0_%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D1%2585)">Combinations</a> and pattern-matching are widely used in functional programming to increase the reliability and expressiveness of programs. <br><br>  A classic example of successful use of associations for business process modeling is the shopping cart and order status.  The user has the right to add and remove goods until he paid the order.  But the operation itself modification paid order is meaningless.  The Remove operation for an empty basket is also meaningless.  Then, instead of the common class <code>Cart</code> it <code>ICartState</code> to define the <code>ICartState</code> interface and declare one implementation for each state.  In more detail, this approach is described in the text <a href="http://boustrophedonic.com/blog/2012/10/21/union-types-in-csharp/">here</a> and in the video format <a href="http://fsharpforfunandprofit.com/ddd/">here</a> . <br><br>  Recently, we had the task to design the database structure for specialized CRM / ERP.  The first approach to the modeling of contracts was not successful, due to the fact that both physical and legal entities from Russia and other countries of the world can act as parties to contracts.  The TIN is necessary for the seller to receive payment, but it is not always necessary for the merchant (passport data are more often used for personal identification).  Formats details of domestic and foreign legal entities do not match.  It did not help the case that the individual entrepreneurs are individuals, but they ‚Äúpretend‚Äù to be legal. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In retrospect, we dismantled the mistakes of the initial design and outlined the direction of refactoring.  All interested in our history, please under the cat. <br><a name="habracut"></a><br>  The initial outline of the domain model looked like this: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> BusinessEntityType { [Display(Name = <span class="hljs-string"><span class="hljs-string">". : , LTD, ..."</span></span>)] LegalEntity = <span class="hljs-number"><span class="hljs-number">0</span></span>, [Display(Name = <span class="hljs-string"><span class="hljs-string">""</span></span>)] IndividualEntrepreneur, [Display(Name = <span class="hljs-string"><span class="hljs-string">". "</span></span>)] Person, [Display(Name = <span class="hljs-string"><span class="hljs-string">"   "</span></span>)] NonProfitEducationalInstitution } [DisplayName(<span class="hljs-string"><span class="hljs-string">""</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Contractor</span></span> : <span class="hljs-title"><span class="hljs-title">NamedEntityBase</span></span> { [Required] [Display(Name = <span class="hljs-string"><span class="hljs-string">"  /   ."</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Address MainAddress { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">"  "</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Address ActualAddress { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">" "</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> BusinessEntityType Type { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">""</span></span>), StringLength(<span class="hljs-number"><span class="hljs-number">127</span></span>), RegularExpression(<span class="hljs-string"><span class="hljs-string">"\\d+"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Inn { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">" "</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">""</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> PhoneNumber { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Contractor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[NotNull] </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, BusinessEntityType type, [NotNull] Address mainAddress, Address actualAddress = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mainAddress == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(mainAddress)); Type = type; MainAddress = mainAddress; ActualAddress = actualAddress; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Contractor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } }</code> </pre><br>  The ‚Äúcounterparty‚Äù clearly tried to please both the ‚Äúphysicists‚Äù and the ‚Äúlawyers‚Äù, which did not benefit the SRP.  It became absolutely not clear where to go OGRNY, BIKI and other not interesting physics attributes and why the TIN is a mandatory field for physical.  Buyers? <br><br><h2>  The second approach to the projectile </h2><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DisplayName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">)</span></span>] [Table(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(Contractor), Schema = <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(Office))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Contractor</span></span> : <span class="hljs-title"><span class="hljs-title">NamedEntityBase</span></span> { <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">   /   . </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> [Required] [Display(Name = "  /   .")] public Address MainAddress { get; set; } </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">    </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> [Display(Name = "  ")] public Address ActualAddress { get; set; } [Display(Name = " ")] public ContractorType Type { get; set; } [Display(Name = ""), StringLength(127), RegularExpression("\\d+")] public string Inn { get; set; } [Display(Name = " ")] public string Email { get; set; } [Display(Name = "")] public string Phone { get; set; } public string FullName =&gt; string.Join(" ", Name.Split(',')); public virtual LegalContact LegalContact { get; set; } public virtual PersonContact PersonContact { get; set; } public Contractor([NotNull] string name, ContractorType type, [NotNull]Address mainAddress, Address actualAddress = null) : base(name) { if (mainAddress == null) throw new ArgumentNullException(nameof(mainAddress)); Type = type; MainAddress = mainAddress; ActualAddress = actualAddress; } protected Contractor() { } } public class PersonContact : EntityBase, IContact { [Display(Name = ""), StringLength(127), RegularExpression("\\d+")] public string Inn { get; set; } public string Email { get; set; } public string Phone { get; set; } public string Name { get; set; } public string Surname { get; set; } public string Patronymic { get; set; } public Address Address { get; set; } } public class LegalContact : EntityBase, IContact { [Display(Name = ""), StringLength(127), RegularExpression("\\d+")] public string Inn { get; set; } public string Kpp { get; set; } public string Ogrn { get; set; } public string Okpo { get; set; } public string Okved { get; set; } public string Name { get; set; } public string FullName { get; set; } public string Email { get; set; } public string Phone { get; set; } public Address MainAddress { get; set; } public Address ActualAddress { get; set; } } public interface IContact : IHasId</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;int&gt;</span></span></span><span class="hljs-comment"> { string Email { get; set; } }</span></span></code> </pre><br>  "Contacts" here would be more correctly called "details".  The need for an <code>IContact</code> interface raises questions.  ‚ÄúNot so‚Äù here is that integrity control for <code>LegalContact</code> and <code>PersonContact</code> is possible only by using Check Constraint. <br><br>  How would the union from <code>LegalContact</code> and <code>PersonContact</code> !  Unfortunately, relational database management systems do not provide such functionality.  In addition, the <code>Type</code> field now looks redundant.  Cases of IP and individual face are combined in <code>PersonContact</code> , although from the point of view of business processes, IP caps are closer to legal entities. <br><br><h2>  The third approach to the projectile </h2><br>  Let's declare an abstract <code>Contractor</code> class, heirs for each type of counterparty, and consider what unites them.  The main use of the counterparty is the signing of contracts.  In this case, we do not work with EDS, therefore, the full name and details of the parties are sufficient to substitute them into an automatically created document that will be printed and signed. <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">DisplayName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">)</span></span>] [Table(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(Contractor), Schema = <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(Office))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Contractor</span></span> : <span class="hljs-title"><span class="hljs-title">EntityBase</span></span> { [Display(Name = <span class="hljs-string"><span class="hljs-string">" "</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ContractorType Type { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Phone { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Contractor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ContractorType type</span></span></span><span class="hljs-function">)</span></span> { Type = type; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Contractor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } } [Table(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(CompanyContractor), Schema = <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(Office))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CompanyContractor</span></span> : <span class="hljs-title"><span class="hljs-title">Contractor</span></span> { [Display(Name = <span class="hljs-string"><span class="hljs-string">"/VAT"</span></span>), StringLength(<span class="hljs-number"><span class="hljs-number">12</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Vat { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">""</span></span>), StringLength(<span class="hljs-number"><span class="hljs-number">9</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Kpp { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">""</span></span>), StringLength(<span class="hljs-number"><span class="hljs-number">13</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Ogrn { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">""</span></span>), StringLength(<span class="hljs-number"><span class="hljs-number">10</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Okpo { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">""</span></span>), StringLength(<span class="hljs-number"><span class="hljs-number">10</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Okved { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FullName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Address MainAddress { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Address ActualAddress { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CompanyContractor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { Name = name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CompanyContractor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } } [Table(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(PersonContractor), Schema = <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(Office))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PersonContractor</span></span> : <span class="hljs-title"><span class="hljs-title">Contractor</span></span> { [Display(Name = <span class="hljs-string"><span class="hljs-string">""</span></span>), StringLength(<span class="hljs-number"><span class="hljs-number">12</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Vat { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">" "</span></span>), StringLength(<span class="hljs-number"><span class="hljs-number">15</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Ogrnip { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Surname { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Patronymic { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Address Address { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FullName =&gt; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Join(<span class="hljs-string"><span class="hljs-string">" "</span></span>, Name, Surname, Patronymic); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PersonContractor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> email</span></span></span><span class="hljs-function">)</span></span> { Name = name; Email = email; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PersonContractor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } }</code> </pre><br>  You could add getter to the <code>Type</code> property, in case you need <a href="https://habrahabr.ru/post/283522/">multiple dispatch</a> .  But following YAGNI we will leave everything as it is. <br><br>  As ORM, we use the Entity Framework.  This structure can be mapped to a relational database using the <a href="https://www.asp.net/mvc/overview/getting-started/getting-started-with-ef-using-mvc/implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application">table per type (TPT)</a> approach. <br><br>  All that remains is to transfer the ‚Äúcommon‚Äù fields to <code>ContractorBase</code> .  Now the base class looks logical.  The system is available details and representative of the counterparty.  In case of questions you can try to contact by phone or e-mail. <br><br><h2>  Who is IP and what it eat </h2><br>  IP - is a form of economic activity without a legal entity.  We will not go into the subtleties of the civil code.  Let us dwell on the main thing: the PI has the <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D1%2581%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25BD%25D0%25BE%25D0%25B9_%25D0%25B3%25D0%25BE%25D1%2581%25D1%2583%25D0%25B4%25D0%25B0%25D1%2580%25D1%2581%25D1%2582%25D0%25B2%25D0%25B5%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D1%2580%25D0%25B5%25D0%25B3%25D0%25B8%25D1%2581%25D1%2582%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BD%25D0%25BE%25D0%25BC%25D0%25B5%25D1%2580_%25D0%25B8%25D0%25BD%25D0%25B4%25D0%25B8%25D0%25B2%25D0%25B8%25D0%25B4%25D1%2583%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D0%25B3%25D0%25BE_%25D0%25BF%25D1%2580%25D0%25B5%25D0%25B4%25D0%25BF%25D1%2580%25D0%25B8%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25B0%25D1%2582%25D0%25B5%25D0%25BB%25D1%258F">OGRNP</a> (analogue of the <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D1%2581%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25BD%25D0%25BE%25D0%25B9_%25D0%25B3%25D0%25BE%25D1%2581%25D1%2583%25D0%25B4%25D0%25B0%25D1%2580%25D1%2581%25D1%2582%25D0%25B2%25D0%25B5%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D1%2580%25D0%25B5%25D0%25B3%25D0%25B8%25D1%2581%25D1%2582%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BD%25D0%25BE%25D0%25BC%25D0%25B5%25D1%2580">OGRN</a> ) and the TIN.  In this case, the TIN of the physical person of Vasi Ivanov and IP Vasi Ivanov is the same number. <br><br>  If we are interested in a person in the context of labor or other contractual relations, then we can define another entity ‚Äúnat.  face "and connect it with counterparties Counterparty - physical.  face and sp.  Then it will be impossible to make a mistake when establishing an IP with an existing individual.  A more expanded reference book of individuals may be required in another context (for example, to pay wages, SNILS will be required).  Then we can repeat the ‚Äútrick‚Äù with TPT and add another table for each ‚Äúcut‚Äù in which we are interested in the data. <br><br><blockquote>  The question of how to determine that Ivan Ivanov Ivan from Kazan and Ivan Ivan Ivan from Penza - I will not consider different people, because this topic is worthy of a separate article. </blockquote><br><h2>  UI organization </h2><br>  Creating different counterparties will require filling in different fields, so we will need a form for each heir of the counterparty.  Is logical.  If in the UI it is permissible to have instead of this list of counterparties on the list for each type, then we can finish.  If it is more convenient to work with a single list of counterparties, you will have to change something again.  <code>IContractor</code> interface and <code>IContractor</code> abstract methods there.  Rename <code>ContractorBase</code> to <code>ContractorInfo</code> and make this class non-abstract to be able to display the list of suppliers.  We return <code>ContractorType</code> to distinguish the types of counterparties.  EntityFramework materializes objects through Refletion, so we calmly leave the constructor and the <code>Type</code> and <code>Name</code> properties protected.  Information about counterparties does not appear by itself, but is added only together with the counterparty itself.  We had to denormalize the table, which is ‚Äúnot very‚Äù in terms of consistency and the need for additional gestures when changing the fields that are part of the ‚Äúname‚Äù, but not bad for performance. <br><br><h2>  Conclusion </h2><br>  Despite the fact that the union is not supported out of the box by either relational DBMS or C #, using TPT, you can design a data structure of any complexity and branching, ensuring that all required fields are filled.  It is necessary only to select all possible cases and create one for each heir.  In the most extreme case (when there is nothing in common between the heirs), the base class will contain only Id.  Such a table looks strange, however, it is much easier to set the Foreign Key for related tables than in any other way.  In addition, the approach can be applied recursively and formally, which increases reliability when designing an extensive domain model. </div><p>Source: <a href="https://habr.com/ru/post/322168/">https://habr.com/ru/post/322168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../322154/index.html">Finnish schools: myths in the international press, context features and new technologies</a></li>
<li><a href="../322156/index.html">I need to know what you think: transparency of thinking AI as a necessary condition</a></li>
<li><a href="../322158/index.html">Multitasking. How to cope with ghosts outsiders</a></li>
<li><a href="../322162/index.html">$ mol_app_bench: preparing JS benchmarks quickly and easily</a></li>
<li><a href="../322166/index.html">Yii 2.0: release of the debug 2.0.8 extension</a></li>
<li><a href="../322170/index.html">‚ÄúHello, (real) world!‚Äù In php in 2017</a></li>
<li><a href="../322172/index.html">As in Canada, looking for missing children</a></li>
<li><a href="../322176/index.html">Infrared optics instead of optical fiber in the data center: the original project of engineers from the United States</a></li>
<li><a href="../322178/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ250 (February 13 - 19, 2017)</a></li>
<li><a href="../322180/index.html">Azure-IaaS-Digest number 13 (January-February)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>