<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to scan a castle (almost) for free</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 For the game World Void we needed to port a historical monument to the Unreal Engine 4. My task was to scan the castle. I was expecting...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to scan a castle (almost) for free</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  For the game <a href="http://worldvoid.com/">World Void</a> we needed to port a historical monument to the Unreal Engine 4.  My task was to scan the castle.  I was expecting financing, which was delayed, so I finally decided to just take it and do everything on my own, without money, and I did it - I scanned the lock!  A few months have passed, and I am still delighted!  In this article I will tell you how I did it.  But first, I want to thank Milo≈° Luk√°cs, Jeffrey Ian Wilson, and the 3D Scanning User Group, without whom this would have been impossible. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/652/85d/b5e/65285db5ea85947bdfd99524a42f1d61.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e27/fa8/b15/e27fa8b15d4adcdece29842914fb2f1e.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  What is photogrammetry? </h2><br>  In short, photogrammetry is the process of creating 3D models from several photographs of the same object taken at different angles. <br><br>  I will not consider a three-dimensional scanning of objects, this topic is already sufficiently covered. <br><br>  If you want to start mastering photogrammetry, I recommend this short <a href="https://www.youtube.com/watch%3Fv%3DLeU_2SHwhqI">video of</a> James Candy from YouTube.  Although Agisoft Photoscan is mentioned in it, the concepts discussed will work in any other software for photogrammetry.  You can also read the <a href="http://bertrand-benoit.com/blog/the-poor-mans-guide-to-photogrammetry/">Photogrammetry Guide for the Poor</a> . <br><br>  In their workflow photogrammetry is used by many artists, it was used for the Kite demo from Epic games, in Star Wars Battlefront and an infinite number of other projects.  However, most of these studios scanned stones and trees.  Epic games wrote a <a href="https://www.unrealengine.com/blog/creating-assets-for-open-world-demo">post</a> about how resources were created for the open world demo.  Employees of the company even wrote a <a href="https://www.unrealengine.com/blog/imperfection-for-perfection">post</a> about the choice of equipment and <a href="https://www.unrealengine.com/blog/imperfection-for-perfection-part-2">another one</a> describing the process of eliminating lighting.  I highly recommend reading these posts if you have not seen them yet. <br><a name="habracut"></a><br><h2>  Difficulties </h2><br>  When scanning such a large object as a lock, one should not forget about the following difficulties: <br><br><ul><li>  Number of shots: the lock is more voluminous than a stone, so even if you need a low-poly model, you will have to take more shots.  This means that you need a larger SD card.  But having bought a bulk SD card, you will encounter problems with the discharge of the battery, so it would be nice to buy a spare battery.  This may seem obvious, but when I started taking more than two thousand shots, for me it turned out to be a revelation.  In half of this process, I began to discharge the battery.  Fortunately, the guards of the castle allowed me to charge the camera in their office.  Having taken pictures, you will have to find enough storage space on your computer, but hard drives are very cheap nowadays. </li><li>  More time: it is logical that the more you shoot, the more time is needed.  It took me 8 hours to scan the castle, which means you will need 8 hours of cloudy / cloudy weather.  It would also be nice to take all the necessary photos of one section of the castle, and only then move on to the next.  In this case, if the sunlight shifts a little and the software fails to link all the photos together, you can always connect them manually using control points. </li><li>  Computational power: because of the large number of analyzed photos, you will need a lot of computing resources.  Computer requirements depend on 3D scanning software, but here's what you need to know: <br><ul><li>  RAM.  A lot of RAM, 64 GB is an excellent choice.  However, some 3d-scanning packages use a caching system that allows processing scans with a small amount of RAM, but I still do not recommend working with less than 32 GB. </li><li>  Video processor  The faster the better.  A lot of video memory is not needed, 4 GB is enough.  I would recommend the NVidia GTX card, because some of the software does not support AMD. </li><li>  CPU.  The more cores, the better. </li></ul></li><li>  Difficult angles of shooting: when scanning a stone, you can take pictures at any angle, and in the huge castle there are hard-to-reach places.  If possible, use the drone, but I did not have it, so I had to solve the problem differently, as I will discuss below. </li><li>  Complex construction: unlike stone, the castle has more complex forms, not to mention the fact that the stones do not have internal premises.  The task becomes even more difficult, you need to make sure that everything you need is removed.  How to achieve this?  Pre-planning and on-site verification. </li></ul><br><h2>  Learn your purpose (pre-planning) </h2><br>  I work in the historical monument of Byblos, a city in Lebanon that has been inhabited for more than ten thousand years.  However, the castle itself dates back to the 12th century.  This is a relatively small castle compared to the newer ones built in some European countries, but each wall of this castle is made of highly detailed masonry, polished by time itself. <br><br>  By studying the goal, I mean that you need to sketch on paper views from above and from the side, break them into several elements, choose the order of shooting and highlight those areas in which you need to take more pictures. <br><br>  In addition, errors accumulate during scanning, which leads to the creation of displaced geometry, so you should always make a full set of circular images of the object so that the scans are automatically corrected.  Open geometry may not be accurate. <br><br>  I also took the opportunity and made many shots of the surrounding area from the castle walls, which made it possible to add a landscape to the scan. <br><br>  Hint: Do not take multiple images at different angles from one point (panoramic images).  Most often this leads to undesirable errors. <br><br>  A useful way to scan small tunnels in which, due to limited space, it is difficult to take pictures from all angles: walk in a straight line, and at each step, take a picture with a forward-looking camera.  This technique gives less resolution, but it may be enough. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f6f/a47/0a2/f6fa470a24170a04f2dccb92236303f2.jpg"><br><br>  There is a very high probability that you will miss several angles during scanning and the images will not overlap enough, which will result in areas with low resolution appearing in the scan, so I highly recommend checking the result in place.  Reality Capture 3D scanning software, for example, can check the overlap of a huge number of images on a laptop in just a few minutes.  This is incredibly useful - it will let you know in which areas more images are needed. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/74d/a50/f5d/74da50f5d2dbe81d8ad5301f8e957b1e.jpg"><br><br>  White dots mark the places from which the pictures were taken.  Blue dots are manually added survey points to help link some items that the software cannot link automatically.  Note that there are a lot of survey points on the roof of the castle, and this is normal, because I didn‚Äôt have a drone and I couldn‚Äôt take enough roofs.  Fortunately, I managed to tie them by hand, which might not be possible for large locks.  Total software snapped 4000 photos. <br><br><h2>  What do you need? </h2><br>  If you are trying to save as much as possible, this is what you need: <br><br><ul><li>  The camera (aha), necessarily a "DSLR" (DSLR).  The new smartphones, for example, in the Galaxy S7 are pretty good cameras, but if you earn 3D scanning, then buy a DSLR.  I did not have a "SLR", so I borrowed it from my aunt.  It was the Nikon d3200, and since I scanned the rock lock, I didn‚Äôt need a camera with greater sharpness. </li><li>  Lens.  Cameras are sold with lenses with a variable focal length (18-55 mm), but it is recommended to use a lens with a fixed focal length.  However, if you use the limit value (18 or 55) for the entire scan, then everything should be fine. </li><li>  Tripod.  Yes, you will need it, especially if you are shooting in low light conditions, for example, inside the castle, and you cannot use the flash, that is, you will take pictures with a long shutter speed. </li><li>  Monopod is useful, but if you do not shake hands and selected the desired shutter speed, you can do without it.  On the other hand, it costs only 10 dollars, so why not? </li><li>  Sd card  I used a 64 GB SD card.  I had a laptop with me, and if the card were full, I could just transfer the pictures to a hard disk. </li></ul><br><h2>  What I did not use </h2><br><ul><li>  Battery.  I did not have it, but if you are going to take a lot of pictures, I recommend buying a second or even a third battery. </li><li> Drone.  He can greatly facilitate your work, and if there is such an opportunity, then consider buying it.  I did not have a drone, so I had to climb and take pictures from various dangerous points.  Fortunately, it worked, but how much do you want to tempt fate, especially in large castles? </li><li>  Chrome ball and gray ball.  This device is used to obtain perfect color fidelity and a perfect light removal process.  It is tempting to use any opportunity to create the perfect scan.  But first ask yourself, is it worth it?  There are other techniques to eliminate lighting that do not require this device, while providing quite decent results.  In my case, this device would add to the project another large layer of complexity that was not worth any possible quality improvement. </li><li>  Calibration target Color checker.  This is an expensive but useful device for calibrating the camera.  I did not use it when scanning. </li></ul><br><h2>  Software </h2><br>  I tested a bunch of photogrammetric software, and any of the packages listed below adequately deal with small scans, but I needed to process large amounts of data (4000 photos with a resolution of 24 megapixels). <br><br><ul><li>  Agisoft Photoscan.  Agisoft is the most popular software in the entertainment industry.  It has a friendly interface and amazing quality of finished scans.  The standard version costs $ 180, but if you need the option of creating survey points, which can be very useful when creating large scans, you will have to buy a professional version for $ 3,500.  At the same time, Agisoft consumes a lot of computing resources, and if you want to process a large amount of data, you will need an incredibly powerful computer.  Not to mention that Agisoft is a bit slower than its competitors on this list. </li><li>  Pix4d.  Because of the specialized set of tools, this software is most common in industry and agriculture.  On a powerful computer, it can process large amounts of data, and at the same time a little faster than Agisoft.  Subscription to this package costs $ 350 per month.  However, I did not really like the quality of the resulting textures. </li><li>  Autodesk Recap.  This is a cloud software that has a free version and creates good quality scans.  Unfortunately, the processing set is limited to 250 photos, and it takes forever to upload large amounts of data to the cloud. </li><li>  Reality Capture.  A beginner who took the market by storm.  This is an incredibly fast software, it can process large amounts of data and is able to work on a regular computer with an NVidia video processor.  It can even be run on a laptop, but I do not recommend doing this, unless you have a gaming laptop with good cooling - a strong and long load on the laptop reduces its life.  Reality Capture has excellent fast-snap features that allow you to link images on a laptop in seconds.  This is a handy tool to check the data set at the location to make sure that there are enough snapshots.  Compared to Agisoft, this software scans a bit more noisy.  It costs 99 euros for three months, but this version can handle no more than 2500 images.  If you need more, you will have to buy the CLI version for 7,500 euros per year.  Fortunately for me, when scanning the castle, Reality Capture was in beta status and was free for 60 days.  This is more than enough to complete the scan. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/ad4/962/56d/ad496256dd6e76db585a5f9b4ad9140e.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f01/3b6/2d0/f013b62d039dd7dac29b9b65162fd583.jpg"><br><br><h2>  Expenses </h2><br>  This is the interesting part.  I borrowed the camera, the software was free, but I still needed to process the scan, because my laptop could not cope with it.  Here Milosz Luk√°cs helped me, he offered to process the data on his computer, and my gratitude knows no bounds.  He also helped me in the data binding process, showed a couple of tricks for correcting some of my mistakes peculiar to beginners.  As a result, I only had to spend money on a tripod, monopod and SD card, for a total of $ 70 + shipping.  That is, yes, I managed to scan the castle from top to bottom for only $ 70!  I proved that with desire, you can find a way.  I was lucky, but luck came when I began to communicate and make friends. <br><br><h2>  Can this be repeated? </h2><br>  Six months before the start of the scan of the castle, I did not know anything about 3D scanning.  And although I am tempted to say that I did it alone, it will not be true - they helped me, and in many ways this help was received from the community and industry professionals.  How did I manage to find them?  Pretty simple - in the Facebook 3D Scanning Users Group.  First I joined the group, then I explained what I wanted to do, and I received great support from the community.  One of the band members, professional Jeffrey Ian Wilson even wrote to me in a ‚Äúlichku‚Äù, and we had a fruitful conversation.  He put me on the right path, realized that I was ready for a complex project and made recommendations.  In addition, he advised to treat his recommendations with a certain degree of skepticism.  The same applies to my advice: in fact, my experience in 3D scanning is only six months, when I scanned the castle, I made mistakes, fortunately, they were not too serious and I managed to fix them.  If I managed to scan the lock, it does not mean that I am the best assistant in scanning locks.  I just share my experience, study and try everything yourself.  I answer the question in the section heading: yes, you can repeat my ‚Äúfeat‚Äù, if you have the determination, then nothing is impossible. <br><br><h2>  Finally </h2><br>  I sincerely hope that our experience can be useful for readers, and if something interesting comes out of this, email me on Twitter or share on Facebook, I‚Äôll be happy to take a look. <br><br>  Processing a scan from one billion polygons and porting it into the game engine is another story, worthy of another post. </div><p>Source: <a href="https://habr.com/ru/post/335520/">https://habr.com/ru/post/335520/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335506/index.html">‚ÄúOne of the daily processes accelerates from 3 hours to 15 minutes‚Äù: Andrei Bogoslovsky about in-memory computing at SberTech</a></li>
<li><a href="../335508/index.html">Emulator in the emulator for playing chip-tunes on YM2149F</a></li>
<li><a href="../335512/index.html">Using ImGui with SFML to create game development tools</a></li>
<li><a href="../335516/index.html">Secure OpenVPN on VPS in a few minutes</a></li>
<li><a href="../335518/index.html">The master who conquered death ... through Power Point. Book review by A. Kapterev ‚ÄúPresentation Mastery‚Äù</a></li>
<li><a href="../335522/index.html">Welford method and one-dimensional linear regression</a></li>
<li><a href="../335524/index.html">Optimization Unity3d UI by GPU (for example minimap) or create a minimap without additional cameras and sprites</a></li>
<li><a href="../335526/index.html">Building recommendations for a job site. Lecture in Yandex</a></li>
<li><a href="../335528/index.html">Receive phonebook entries from a mobile phone without a display</a></li>
<li><a href="../335530/index.html">So you decided to deploy OpenStack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>