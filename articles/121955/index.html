<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>I build websites! Like a boss</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="www.youtube.com/watch?v=NisCkxU544c 

 After watching the presentation of Yuri ( yrashk ) with Erlang Conference about web frameworks in Erlang, I bec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>I build websites! Like a boss</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://www.youtube.com/watch%3Fv%3DNisCkxU544c"><img src="https://habrastorage.org/getpro/habr/post_images/e4b/787/dff/e4b787dff0198398dfad66fac2475e3b.jpg" alt="Like a boss"><br></a> <br>  <a href="http://www.youtube.com/watch%3Fv%3DNisCkxU544c">www.youtube.com/watch?v=NisCkxU544c</a> <br><br>  After watching the presentation of Yuri ( <a href="http://habrahabr.ru/users/yrashk/" class="user_link">yrashk</a> ) with Erlang Conference about web frameworks in Erlang, I became interested and decided to make saytik not on node.js, as I originally intended, but using some Erlang framework. <br><br>  In the end, I came across a <a href="http://chicagoboss.org/">Chicago Boss</a> framework.  I have heard about the framework myself before, but I haven‚Äôt been able to use it yet. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  What does the boss give us?  In general, they position themselves as ‚Äúrails-type, but on an erlang.‚Äù  With the rails, by the way, I also didn‚Äôt have anything at all, so I didn‚Äôt care.  But I‚Äôve dealt with MVC because  at work we have a solid ASP.NET MVC2.  So the basic concepts are clear. <br><br>  BossDB is available;  it is, in fact, ActiveRecord, written using parameterized modules, supporting different backends.  Memory, Mnesia, MongoDB, MySQL, Postgres.  According to the <a href="http://chicagoboss.org/projects/chicagoboss/wiki/DB_Adapter_Quickstart">developers,</a> to support the new database, you need to write about three hundred lines of code. <br><br>  There are Django Templates, with almost full coverage of all features, filters, and more. <br><br>  There are other things that I haven‚Äôt really played with yet ... <br><br><h4>  Installation </h4><br>  With the installation on ubunt there was a small problem that is treated by downloading the old version of erlang and copying one header file from there (lib / kernel / src / inet_dns.hrl), which for some reason is missing from the ubuntov delivery;  still had to put the erlang-dev package. <br><br>  After this is done <br><pre><code class="bash hljs">make make app NewSite <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../NewSite</code> </pre> <br><br><h4>  Getting to understand ... </h4><br><br>  In principle, there is a good tutorial <a href="http://www.evanmiller.org/chicago-boss-guide.html">An Evening with Chicago Boss</a> .  But it is a little outdated, and slightly does not correspond to the realities of the latest versions. <br><br><h4>  Tasks </h4><br><ul><li>  Write a couple of pages "for all" </li><li>  Write authorization </li><li>  Write a user profile editor </li></ul><br><br><h4>  Project structure </h4><br><pre> <code class="hljs pgsql">/controller /<span class="hljs-keyword"><span class="hljs-keyword">view</span></span> /model /<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> /static /test</code> </pre><br>  all three are clear <br><pre> <code class="hljs 1c">/admin -  ,  /  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  ,    /ebin -  , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     /lang -   .          /lib - <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   <span class="hljs-keyword"><span class="hljs-keyword"></span></span> .       /mail -        ,      </code> </pre><br><br>  If you run the project through ./start-dev.sh, then the boss will do a hot reboot of the whole machine, so you can develop it without restarting the server, which is very convenient. <br><br><h4>  Model </h4><br>  <a href="http://chicagoboss.org/embedded/chicagoboss/api-record.html">Model API</a> <br><br>  The model is a parameterized erlang module, a specific thing, I don't know much about it.  For now, just using it as is. <br><br>  For example, user model <br><pre> <code class="erlang hljs"><span class="hljs-keyword"><span class="hljs-keyword">-module</span></span><span class="hljs-params"><span class="hljs-params">(user, [Id, FirstName, LastName, Email, PasswordHash, CreateTime])</span></span>. -compile(export_all).</code> </pre><br><br>  This is already a model.  It has properties, as well as automatically generated field access methods.  Properties that end in <em>Id</em> or <em>Time</em> are special.  Some - to create links and dependencies between objects, the second will only accept tuples in a format that gives <em>erlang: now ()</em> <br><br>  After the model code has been saved in <em>/models/user.erl</em> , the admin <em>panel</em> will access the list of current models and class documentation. <br><br>  You can create validation methods for the model, but we‚Äôll skip this for now. <br><br><h4>  Bossdb </h4><br>  <a href="http://chicagoboss.org/embedded/chicagoboss/api-db.html">BossDB API</a> <br><br>  This is an API for working with a database. <br>  The boss stores all entries with an Id of the following form: <em>&lt;model_atom&gt; is &lt;unique_id&gt;</em> , where model_atom is an atom described in the model module :), and unique_id is a numeric identifier that does not repeat even for different models, so if you have the user and article, <em>user-1</em> and <em>article-1</em> models cannot exist.  Considering that the numbers in the Erlang are limited by the amount of RAM, you can not worry about id overflow :). <br><br>  Of particular interest are search operations.  They have a short form, writing down with mathematical symbols, such as Œµ, ‚àâ, ‚âÅ and others. <br><br>  Sampling can be done by transferring string Id records.  Because  it is prefixed with the model name - there will be no confusion. <br><pre> <code class="erlang hljs">User = boss_db:find(<span class="hljs-string"><span class="hljs-string">"user-1"</span></span>).</code> </pre><br><br><h4>  Controller </h4><br>  <a href="http://chicagoboss.org/embedded/chicagoboss/api-controller.html">Controller API</a> <br><br>  The controller is also a parameterized module.  But he has only one parameter.  This is the field in which the http request will be located.  The request has methods for accessing form fields (in the case of POST) and headers. <br><br><pre> <code class="erlang hljs"><span class="hljs-keyword"><span class="hljs-keyword">-module</span></span><span class="hljs-params"><span class="hljs-params">(user_controller, [Req])</span></span>. -compile(export_all). index('GET', []) -&gt; ok.</code> </pre><br><br>  Here is a simple controller that simply renders the default template when a GET request is made to the address <em>/ user / index</em> <br><br>  You can write a controller that displays the user on his Id, as well as understanding the different methods of issuance. <br>  Parsing a URL is as follows: <br><pre> <code class="erlang hljs"><span class="hljs-keyword"><span class="hljs-keyword">-module</span></span><span class="hljs-params"><span class="hljs-params">(user_controller, [Req])</span></span>. -compile(export_all). index('GET', []) -&gt; {ok, [{users, boss_db:find(user, [])}]}; index('GET', [<span class="hljs-string"><span class="hljs-string">"id"</span></span>, Id, <span class="hljs-string"><span class="hljs-string">"method"</span></span>, Method]) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> boss_db:find(Id) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> {error, Reason} -&gt; boss_flash:add(Req, error, <span class="hljs-string"><span class="hljs-string">"Invalid User"</span></span>, <span class="hljs-string"><span class="hljs-string">"User not found"</span></span>), ok; {user, User} -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Method <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-string"><span class="hljs-string">"json"</span></span> -&gt; {json, User} <span class="hljs-comment"><span class="hljs-comment">%%, ,   -    _ -&gt; {ok, [{user, User}]} end end.</span></span></code> </pre><br><br>  What is going on here? <br>  If an empty request comes to us - then find all the objects of the User model, and render the default template by passing a list of parameters to it, one of which will be users, containing all users. <br>  If the request has id &amp; method parameters - try to find the user by Id, in case of failure, create a boss_flash with an error message and render the template. <br>  If the user is found then do the following ‚Äî if the method contains the string ‚Äújson‚Äù, return the data as a JSON object.  For any other method, render the HTML template with user data. <br><br><h4>  Template </h4><br>  <a href="http://chicagoboss.org/embedded/chicagoboss/api-view.html">Template API</a> <br>  uses the Django template system, through the <a href="https://github.com/evanmiller/erlydtl">ErlyDTL</a> library <br><br>  For example, here is a template for our / user page. <br><pre> <code class="html hljs xml">{{boss_flash}} <span class="hljs-comment"><span class="hljs-comment">&lt;!--        ,     --&gt;</span></span> {% if users %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>{% trans "User List" %}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> {% for user in users %} {% trans "First Name" %} : {{ user.first_name }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> {% trans "Last Name" %} : {{ user.last_name }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/user/id/{{user.id}}/method/html"</span></span></span><span class="hljs-tag">&gt;</span></span>{% trans "View" %}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/user/id/{{user.id}}/method/json"</span></span></span><span class="hljs-tag">&gt;</span></span>{% trans "JSON" %}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> {% endfor %} {% endif %} {% if user %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>{% trans "User Info" %}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> {% trans "First Name" %} : {{ user.first_name }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> {% trans "Last Name" %} : {{ user.last_name }} {% endif %}</code> </pre><br><br>  The <em>trans</em> function will automatically translate strings.  Also, all the strings for translation are automatically selected from the template files and go to the translation web interface in the admin panel.  Files - regular * .po <br>  <em>boss_flash</em> is a special construct for displaying temporary messages.  No need to steam with sessions or passing a message through parameters or hidden fields.  Very comfortably.  An identical mechanism is used in validator messages in ASP.Net MVC. <br><br><h4>  Authorization </h4><br>  Login made cleverly.  In each controller, you can write the <em>before_ / 1</em> function, which receives the name action and for it should return either a tuple <em>{ok, AdditionalParameters}</em> , or <em>{redirect, "/ url / to / redirect"}</em> . <br>  Usually it is stored in a separate module in the <em>/ lib</em> folder <em>.</em> <br><br><pre> <code class="erlang hljs"><span class="hljs-keyword"><span class="hljs-keyword">-module</span></span><span class="hljs-params"><span class="hljs-params">(auth_lib)</span></span>. -export(require_authentication/<span class="hljs-number"><span class="hljs-number">1</span></span>). require_authentication(Req) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> boss_session:get_session_data(Req, principal) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> {error, Reason} -&gt; {redirect, <span class="hljs-string"><span class="hljs-string">"/login"</span></span>}; PrincipalId -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> boss_db:find(PrincipalId) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> {error, Reason} -&gt; boss_flash:add(Req, error, <span class="hljs-string"><span class="hljs-string">"User not found"</span></span>, Reason), {redirect, <span class="hljs-string"><span class="hljs-string">"/error"</span></span>}; {user, Principal} -&gt; {ok, Principal} <span class="hljs-comment"><span class="hljs-comment">% Principal -     action   end end.</span></span></code> </pre><br><br>  In order to use this method, the controller must have methods with three parameters <br><pre> <code class="erlang hljs"><span class="hljs-keyword"><span class="hljs-keyword">-module</span></span><span class="hljs-params"><span class="hljs-params">(protected_controller, [Req])</span></span>. -compile(export_all). before_(<span class="hljs-string"><span class="hljs-string">"public"</span></span>) -&gt; ok; <span class="hljs-comment"><span class="hljs-comment">%%  /protected/public     % before_(_) -&gt; auth_lib:require_authentication(Req). %%     % index(Req, [], Principal) -&gt; {ok, [{principal, Principal}]}. public(Req, []) ok.</span></span></code> </pre><br><br>  If authentication is successful, then the current user will be passed to the third parameter.  Otherwise, it will be redirected to / login. <br>  If the user has been authenticated, but the record has disappeared from the database, it will be redirected to / error, and an error message will be added. <br><br>  Now you need to write a controller to check. <br><pre> <code class="erlang hljs"><span class="hljs-keyword"><span class="hljs-keyword">-module</span></span><span class="hljs-params"><span class="hljs-params">(login_controller, [Req])</span></span>. -compile(export_all). index('GET', []) -&gt; ok; index('POST', []) -&gt; Email = Req:post_param(<span class="hljs-string"><span class="hljs-string">"email"</span></span>), PasswordHash = erlang:md5(Req:post_param(<span class="hljs-string"><span class="hljs-string">"password"</span></span>)), <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> boss_db:find(user, [ email = Email, password_hash = PasswordHash], <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> {user, Principal} -&gt; boss_session:set_session_value(Req, principal, Principal.id), {redirect, <span class="hljs-string"><span class="hljs-string">"/protected"</span></span>}; {error, Reason} -&gt; boss_flash:add(Req, error, <span class="hljs-string"><span class="hljs-string">"Invalid User"</span></span>), ok <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre><br>  <b>Note, the 'equals' character in the expression is not (ASCII =), but (UTF-8 =).</b> <br><br><h4>  Conclusion </h4><br>  You can still write a lot of things, but slightly tired :) <br>  In principle, everything is written fairly quickly and fun.  This is my first working Erlang code.  For now, I like everything. <br><br>  Note: in the article code, it is clear that mistakes, unfinished guards and other trifles.  Please do not kick much, I write on the Erlang the second day. <br>  Write in a personal, correct article. </div><p>Source: <a href="https://habr.com/ru/post/121955/">https://habr.com/ru/post/121955/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121948/index.html">New Google service: Me on the Web</a></li>
<li><a href="../121949/index.html">Report on meeting Apple Developers Community # 5</a></li>
<li><a href="../121950/index.html">Karatsuba algorithm for multiplying two numbers</a></li>
<li><a href="../121953/index.html">How we implemented business processes and why we need it at all</a></li>
<li><a href="../121954/index.html">Nokia Developer Day in Rostov-on-Don</a></li>
<li><a href="../121958/index.html">About blocks and their use in Objective-C part 3</a></li>
<li><a href="../121960/index.html">The hotel sued Google for search prompts when entering the hotel name.</a></li>
<li><a href="../121961/index.html">LulzSec Group attacked the website of the CIA and the US Senate. Week Lulz Security on Habr√© continues</a></li>
<li><a href="../121963/index.html">Big update: Evernote for Windows and Mac got links to notes, copies of notes and more.</a></li>
<li><a href="../121964/index.html">What units to choose when layout</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>