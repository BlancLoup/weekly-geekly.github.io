<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Women's Day Gift by FPGA</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! On the eve of March 8, I decided to make my lover a small gift using the tools that I most often have to use at work. Having a little free time...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Women's Day Gift by FPGA</h1><div class="post__text post__text-html js-mediator-article">  Hello!  On the eve of March 8, I decided to make my lover a small gift using the tools that I most often have to use at work.  Having a little free time, I thought, why not write a small article on the topic about it.  This is a great opportunity to congratulate all the ladies and, in particular, the small female composition of the community habrahabr.  The article is written " <i>just for fun</i> " and has no scientific contribution, does not carry much meaning, but may be useful for novice developers in the field of FPGAs.  I will tell you what tools are used to get the final result and what came of it.  In the article you will see the flickering hearts and running text on the 8x8 LED matrix, which is controlled by a small old FPGA.  At the end of the article you will find a video demonstration of the joint operation of the FPGA and a matrix of LEDs. <br><img src="https://habrastorage.org/files/a71/bf0/fad/a71bf0fadc2e43f8ae9813573ca6aad9.jpg"><br><img src="https://habrastorage.org/files/704/892/48c/70489248c580490c9ad8f05e77816e1c.png"><br><a name="habracut"></a><br><h3>  Tool </h3><br>  The project is implemented on a debug board with FPGA Spartan3E.  It contains the simplest strapping of various interfaces (VGA, PS / 2), it has LEDs and an LED display, as well as flip-flops, buttons and various other outputs for connecting something third-party.  The fee is very cheap, ordered from ebay at one of the Chinese stores.  Price - <b>$ 135.00</b> including shipping (~ 4000r at old prices). <br><br>  <a href="http://www.sz-21eda.com/">The official website of the</a> manufacturer is currently <b>dead</b> , which is not surprising. <br><br>  <b>The main features of the board:</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  FPGA Spartan3E ( <b>XC3S500E-4PQ208C</b> ) - 500K logic gates, </li><li>  Clock source CLK = 50 MHz, </li><li>  64M SDRAM external memory, </li><li>  SPI Flash (M25P80) for storing FPGA firmware, </li><li>  LED matrix LED 8x8, LED line 8 pcs., </li><li>  8 trigger switches and 5 buttons, </li><li>  Connectors for two LED displays, </li><li>  VGA connector for connecting a monitor, </li><li>  PS / 2 connectors, etc. </li></ul><br>  Crystal Spartan3E XC3S500E FPGA crystal resources are listed in the table: <br><br><img src="https://habrastorage.org/files/483/2da/040/4832da0405834ff5bb268b23ccf02352.jpg"><br><br>  For simple projects and initial acquaintance with the FPGA design this is more than enough. <br><br><h3>  LED matrix </h3><br>  A matrix of LED8x8 LEDs is connected to the FPGA.  Obviously, each LED does not connect directly, because it will require the use of 64 FPGA pins, which is very expensive and unwise!  Below is a diagram of the Chinese datasheet on the debug board.  It can be seen that the LEDs are connected in columns and rows of 8 pieces, and the connection is not directly, but through PNP transistors.  The emitter of the transistor is connected to the supply voltage, the base to the FPGA contacts, and the collector to the matrix of LEDs.  In total, 16 contacts are connected to the FPGA.  The control logic of the LED matrix is <u>negative</u> , that is, the LEDs are lit with a low logic level (log. 0). <br><br><img src="https://habrastorage.org/files/64d/f5e/055/64df5e055fa6432b922dd12e03b64394.png"><br><br>  This means that if you set the desired logical level on a particular row and column, then a certain LED will light up. <br><br>  <b>Examples:</b> <br><br>  A) if the vector <b>LEDY</b> = ‚Äú11111110‚Äù, and the vector <b>LEDX</b> = ‚Äú11111110‚Äù, the single LED in the lower right corner will light up. <br><br>  <i>11111111</i> <i><br></i>  <i>11111111</i> <i><br></i>  <i>11111111</i> <i><br></i>  <i>11111111</i> <i><br></i>  <i>11111111</i> <i><br></i>  <i>11111111</i> <i><br></i>  <i>11111111</i> <i><br></i>  <i>11111110</i> <br><br>  B) if the vector <b>LEDY</b> = "11111110", and the vector <b>LEDX</b> = "00000000", then the entire bottom line will light up. <br><br>  <i>11111111</i> <i><br></i>  <i>11111111</i> <i><br></i>  <i>11111111</i> <i><br></i>  <i>11111111</i> <i><br></i>  <i>11111111</i> <i><br></i>  <i>11111111</i> <i><br></i>  <i>11111111</i> <i><br></i>  <i>00000000</i> <br><br>  <b>C</b> ) if the vector <b>LEDY</b> = "00000000", and the vector <b>LEDX</b> = "11111110", then the entire right column will light up. <br><br>  <i>11111110</i> <i><br></i>  <i>11111110</i> <i><br></i>  <i>11111110</i> <i><br></i>  <i>11111110</i> <i><br></i>  <i>11111110</i> <i><br></i>  <i>11111110</i> <i><br></i>  <i>11111110</i> <i><br></i>  <i>11111110</i> <br><br>  D) if the vector <b>LEDY</b> = "00000000", and the vector <b>LEDX</b> = "00000000", then the whole matrix of LEDs will light up. <br><br>  In this regard, there is a certain <b>difficulty</b> .  How to light a matrix of LEDs in such a way that a certain character in the form of a letter or number is displayed on it?  In fact, it is not difficult. <br><br><h3>  Display characters on LEDs </h3><br>  The process of displaying characters on a matrix of LEDs is quite simple.  First, it is necessary to organize a counter of a certain digit capacity and use its three most significant digits to switch the LEDY vector.  <i>Why three digits?</i>  Switching 8-bit vector can be described using a finite state machine using 3 control bits.  In VHDL, this is done like this: <br><br>  <b>Counter</b> <br><br><pre><code class="vhdl hljs">pr_cnt: <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>(clk, rst) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rst = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> cnt_led &lt;= (<span class="hljs-keyword"><span class="hljs-keyword">others</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'0'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> rising_edge(clk) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rst_reg = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> cnt_led &lt;= (<span class="hljs-keyword"><span class="hljs-keyword">others</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'0'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cnt_led &lt;= cnt_led + <span class="hljs-string"><span class="hljs-string">'1'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>;</code> </pre> <br>  The first reset (rst) is global.  The second reset (rst_reg) is software and is controlled by a trigger. <br><br>  <b>State machine for LEDY</b> <br><br><pre> <code class="vhdl hljs">pr_3x8: <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>(cnt_cmd) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> cnt_cmd <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"000"</span></span> =&gt; en_xhdl &lt;= <span class="hljs-string"><span class="hljs-string">"11111110"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"001"</span></span> =&gt; en_xhdl &lt;= <span class="hljs-string"><span class="hljs-string">"11111101"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"010"</span></span> =&gt; en_xhdl &lt;= <span class="hljs-string"><span class="hljs-string">"11111011"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"011"</span></span> =&gt; en_xhdl &lt;= <span class="hljs-string"><span class="hljs-string">"11110111"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"100"</span></span> =&gt; en_xhdl &lt;= <span class="hljs-string"><span class="hljs-string">"11101111"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"101"</span></span> =&gt; en_xhdl &lt;= <span class="hljs-string"><span class="hljs-string">"11011111"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"110"</span></span> =&gt; en_xhdl &lt;= <span class="hljs-string"><span class="hljs-string">"10111111"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">others</span></span> =&gt; en_xhdl &lt;= <span class="hljs-string"><span class="hljs-string">"01111111"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>;</code> </pre> <br>  Changing the state of the counter includes one bit in the LEDY column of LEDs.  Thus, the ‚Äú <i>running zero</i> ‚Äù scheme is organized. <br><br>  Next, we need two more state machines with exactly the same logic for organizing the vector of lines <b>LEDX</b> .  In principle, one can do without one, but it is clearer to do it in a manner similar to the column vector. <br><br>  <b>Intermediate spacecraft</b> <br><br><pre> <code class="vhdl hljs">pr_8x4: <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>(en_xhdl) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> en_xhdl <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"11111110"</span></span> =&gt; led_cmd &lt;= <span class="hljs-string"><span class="hljs-string">"000"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"11111101"</span></span> =&gt; led_cmd &lt;= <span class="hljs-string"><span class="hljs-string">"001"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"11111011"</span></span> =&gt; led_cmd &lt;= <span class="hljs-string"><span class="hljs-string">"010"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"11110111"</span></span> =&gt; led_cmd &lt;= <span class="hljs-string"><span class="hljs-string">"011"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"11101111"</span></span> =&gt; led_cmd &lt;= <span class="hljs-string"><span class="hljs-string">"100"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"11011111"</span></span> =&gt; led_cmd &lt;= <span class="hljs-string"><span class="hljs-string">"101"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"10111111"</span></span> =&gt; led_cmd &lt;= <span class="hljs-string"><span class="hljs-string">"110"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">others</span></span> =&gt; led_cmd &lt;= <span class="hljs-string"><span class="hljs-string">"111"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>;</code> </pre> <br>  <b>KA for vector LEDX</b> <br><br><pre> <code class="vhdl hljs">pr_ledx: <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>(led_cmd) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> led_cmd <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"000"</span></span> =&gt; ledx &lt;= <span class="hljs-string"><span class="hljs-string">"01111110"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"001"</span></span> =&gt; ledx &lt;= <span class="hljs-string"><span class="hljs-string">"10111101"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"010"</span></span> =&gt; ledx &lt;= <span class="hljs-string"><span class="hljs-string">"11011011"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"011"</span></span> =&gt; ledx &lt;= <span class="hljs-string"><span class="hljs-string">"11100111"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"100"</span></span> =&gt; ledx &lt;= <span class="hljs-string"><span class="hljs-string">"11100111"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"101"</span></span> =&gt; ledx &lt;= <span class="hljs-string"><span class="hljs-string">"11011011"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"110"</span></span> =&gt; ledx &lt;= <span class="hljs-string"><span class="hljs-string">"10111101"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">others</span></span> =&gt;ledx &lt;= <span class="hljs-string"><span class="hljs-string">"01111110"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>;</code> </pre> <br>  As a result of these actions, the vector <b>LEDX</b> is formed.  It is this vector that draws the symbols on the LED matrix, and the LEDY vector is responsible for the timely shutdown of unnecessary LEDs.  In this example, the cross or the <b>‚ÄúX‚Äù</b> symbol should light up on the LED matrix, which can be visually observed if you look closely at the last state machine.  Thus, the column vector becomes auxiliary, and the row vector draws characters and with its help you can ‚Äúwrite‚Äù anything on the LED matrix. <br><br>  The project made two files of the same type of generation of symbols on a matrix of LEDs.  In the first block, the heart is displayed, and in the second, the text ‚ÄúMARCH 8!‚Äù Is displayed using the ROM-memory design.  Symbols of the text are in memory and they must be properly addressed.  Since the process of displaying is fast enough, it is necessary to adjust the frequency of the display so that the characters can be read.  To do this, you need to create an additional counter for 27 bits, which will divide the 50 MHz input frequency by 2 ^ 27 and allow our eye to observe the change of characters on the matrix of LEDs. <br><br>  Character codes are stored in memory as a two-dimensional array.  8-bit numbers vary depending on the logic of the finite state machine (for outputting the character to the LEDs), and also depending on the address (in order to change the character on the matrix of LEDs): <br><br><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> rom_type <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> (<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> rom_8x8 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> rom_type; <span class="hljs-keyword"><span class="hljs-keyword">constant</span></span> ROM_TEXT: rom_8x8:=( ( <span class="hljs-string"><span class="hljs-string">"11000011"</span></span>, <span class="hljs-string"><span class="hljs-string">"10011001"</span></span>, <span class="hljs-string"><span class="hljs-string">"00111101"</span></span>, <span class="hljs-string"><span class="hljs-string">"00111111"</span></span>, <span class="hljs-string"><span class="hljs-string">"00111111"</span></span>, <span class="hljs-string"><span class="hljs-string">"00111101"</span></span>, <span class="hljs-string"><span class="hljs-string">"10011001"</span></span>, <span class="hljs-string"><span class="hljs-string">"11000011"</span></span>) ... /cut <span class="hljs-comment"><span class="hljs-comment">--      2D-: pr_8x8: process(clk, rst) is begin if (rst = '0') then data_led &lt;= (others =&gt; '0'); elsif rising_edge(clk) then data_led &lt;= ROM_TEXT(CONV_INTEGER(addr_txt(Na-1 downto Na-3)))(CONV_INTEGER(led_cmd)); end if; end process;</span></span></code> </pre><br><h3>  Special effects </h3><br>  Agree that if you just light a symbol on the matrix, is it a bit boring?  In the project it is necessary to add <i>special effects</i> in the form of blinking and running lights.  Make it very easy.  This will require the well-known PWM algorithm (pulse width modulation).  With its help, you can control the power that is supplied to the load (that is, regulate the current).  This is done by varying the pulse duty cycle at a constant signal frequency. <br><br>  I will not tell you how to make PWM on the FPGA, many articles have been written about it.  The basic principle is that a change in the duration of the pulses of zeros and ones is organized on several controlled meters.  In my project, you can control both the PWM itself (by changing the counter speed by increasing the count), and changing the data output rate to the LED matrix, changing the counter width for the LEDY column vector (by selecting the required bit fields).  Taken together, this allows for various effects of twinkling, fading and running lights, which can be seen in the final video. <br><br><h3>  FPGA Project </h3><br>  The FPGA project consists of several parts: these are the source code files in the VHDL language, which describe the algorithm of the microcircuit operation, and the UCF restriction file, which defines the connection of the FPGA contacts, their standard, output current, speed, restrictions on clock frequencies in the project, etc. <br><br>  <b>Pinout contacts in UCF</b> <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">## BUTTONS = ## K1-K5 NET "KB[5]" LOC = P54; NET "KB[4]" LOC = P58; NET "KB[3]" LOC = P57; NET "KB[2]" LOC = P159; NET "KB[1]" LOC = P154; ## LEDS = ## LED_MATRIX NET "LED_X&lt;7&gt;" LOC = "P49" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_X&lt;6&gt;" LOC = "P48" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_X&lt;5&gt;" LOC = "P40" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_X&lt;4&gt;" LOC = "P50" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_X&lt;3&gt;" LOC = "P62" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_X&lt;2&gt;" LOC = "P98" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_X&lt;1&gt;" LOC = "P64" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_X&lt;0&gt;" LOC = "P63" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_Y&lt;7&gt;" LOC = "P75" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_Y&lt;6&gt;" LOC = "P78" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_Y&lt;5&gt;" LOC = "P76" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_Y&lt;4&gt;" LOC = "P69" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_Y&lt;3&gt;" LOC = "P74" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_Y&lt;2&gt;" LOC = "P65" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_Y&lt;1&gt;" LOC = "P68" | IOSTANDARD = LVTTL | DRIVE = 8; NET "LED_Y&lt;0&gt;" LOC = "P77" | IOSTANDARD = LVTTL | DRIVE = 8; NET "RESET" LOC = P148 | IOSTANDARD = LVTTL; NET "CLK" LOC = P183 | IOSTANDARD = LVCMOS33; NET "CLK_IN" TNM_NET = "CLK_TN"; TIMESPEC TS_CLK = PERIOD "CLK_TN" 20 ns HIGH 50 %;</span></span></code> </pre><br>  <b>Top-level vhdl file</b> <br><br><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">entity</span></span> top_xc3s500e_heart <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>( <span class="hljs-comment"><span class="hljs-comment">---- SWITCHES ---- RESET : in std_logic; --! asycnchronous reset: SW(0) SW : in std_logic_vector(7 downto 1); --! other switches ---- CLOCK 50 MHz ---- CLK : in std_logic; --! main clock 50 MHz ---- LED DISPLAY ---- LED_X : out std_logic_vector(7 downto 0); --! LEDs Y LED_Y : out std_logic_vector(7 downto 0); --! LEDs X ---- BUTTONS ---- KB : in std_logic_vector(5 downto 1); --! Five Buttons ); end top_xc3s500e_heart;</span></span></code> </pre> <br>  Port Description: <br><br><ul><li>  <b>RESET</b> - global reset (switch SW [0]), </li><li>  <b>CLK</b> - 50 MHz clock speed, </li><li>  <b>SW &lt;1&gt;</b> is the PWM resolution, </li><li>  <b>SW &lt;2&gt;</b> - heart control mode, </li><li>  <b>SW &lt;3&gt;</b> - 8x8 matrix reset, </li><li>  <b>SW &lt;4&gt;</b> - switching blocks HEART / TEXT, </li><li>  <b>KB &lt;1&gt;</b> - PWM master counter speed control (total period), </li><li>  <b>KB &lt;2&gt;</b> - Control the speed of the secondary PWM counter (pulse duty cycle), </li><li>  <b>KB &lt;3&gt;</b> - Change control of 8x8 matrix counter (for LEDY vector). </li><li>  <b>LED_X</b> is the vector of rows of the LED matrix, </li><li>  <b>LED_Y</b> - vector of LED matrix columns, </li></ul><br>  The schematic view of the project after the synthesis process is presented in the figure below.  It contains input and output buffers, a DCM node, three knockout bounce contacts for the buttons and three functional nodes: PWM control, a generator of LEDs on the LED8x8 LED array, and a heart output on the matrix. <br><br><img src="https://habrastorage.org/files/d2f/5af/e3b/d2f5afe3bfe34f92958e816c25fe9bc1.png"><br><br>  After synthesis, placement and tracing the project in the FPGA looks like this: <br><br><img src="https://habrastorage.org/files/f0c/726/c8a/f0c726c8a872446fb4a25ad340cd5d4c.png"><br><br>  As you can see, the FPGA is generally empty.  For resources used, the results are also shown in the figure above. <br><br><h3>  Result </h3><br>  So, after the correct firmware is loaded into the FPGA and the necessary buttons are pressed, and the switches are in the correct position, the LED matrix should ‚Äúcome to life‚Äù and show the following features: <br><br>  <b>Picture: heart</b> <br><br><img src="https://habrastorage.org/files/a52/cef/032/a52cef03233c452eb45b2382fefbc58e.jpg"><br><br>  <b>Video: Shimmering and running heart</b> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/qEx-GeGIqpE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <b>Video: Text "8 MARCH!":</b> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_Q9FdIdKhn0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  The project was created in VHDL language in Xilinx ISE CAD.  Work: 1 evening (project creation) + 2 pm (writing article).  The source code <b><a href="https://github.com/capitanov/fpga_heart">is laid out on github</a></b> , if someone is interested in doing something like this. <br><br>  Once again I want to congratulate all women on the upcoming holiday.  I wish you all happiness, warmth and love!  In particular, I say hello to my beloved wife. <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/323260/">https://habr.com/ru/post/323260/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323250/index.html">PVS-Studio security research</a></li>
<li><a href="../323252/index.html">Python program for statistical text analysis</a></li>
<li><a href="../323254/index.html">Backbone projects of telecommunications giants and maps of underwater communication channels</a></li>
<li><a href="../323256/index.html">DariaDB. Database development for storing time series</a></li>
<li><a href="../323258/index.html">Motion Detection in FPGA Video Stream</a></li>
<li><a href="../323262/index.html">Implementing HQoS on Juniper MX80 / MX104 fixed ports</a></li>
<li><a href="../323266/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ252 (March 27 - 5, 2017)</a></li>
<li><a href="../323268/index.html">8 best extensions for WordPress to improve the menu on your site</a></li>
<li><a href="../323270/index.html">Forms and custom input fields in Angular 2+</a></li>
<li><a href="../323272/index.html">Deep Learning Libraries Theano / Lasagne</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>