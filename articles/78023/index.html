<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Nested Grids with ExtJS 3.0</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 



 The essence of the problem considered in this article lies in the fact that the Grid ExtJS library objects are not intended to be us...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Nested Grids with ExtJS 3.0</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br><br><img src="https://habrastorage.org/getpro/habr/post_images/07e/faa/348/07efaa34881de4a9dbf2d0c3a571d411.png" alt="image"><br><br>  The essence of the problem considered in this article lies in the fact that the Grid ExtJS library objects are not intended to be used in the context of nesting.  In general, such a task rarely becomes the developer.  And yet, sometimes, as, for example, in my case, one has to face it.  Below I will try to share the accumulated experience, and, perhaps, I will thus render invaluable help to someone, for which I sincerely hope :).  So, good luck ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h2>  Nested Grids or ColumnTree </h2><br><br>  Many may notice that most of the tasks can be simply solved using the ColumnTree method, instead of trying to implement nested ‚Äúgrids‚Äù.  Yes, if you are completely satisfied with this decision - use it.  ColumnTrees are intended for this purpose.  But in some cases it is quite difficult to come to terms with the fact that you lose all those useful functions that Grids provide us with, namely: sorting, Drag &amp; Drop columns, filters, etc.  etc.  If they are really necessary, then you have to think about the implementation of the ability to invest one grid in another.  Below is how to do it. <br><br><h2>  Problems using RowExpander </h2><br><br>  At first glance, the RowExpander plugin from the ux library is intended to solve the problem.  However, not all so simple.  This plugin is designed to be able to display / hide arbitrary HTML code in the "grid" line.  In particular, when trying to insert another grid into a string, we run into problems with the operation of this plugin.  Exit, in fact, 2: write your own plugin or modify the existing one. <br><br>  I will leave the implementation of my plug-ins to the conscience of those who have a lot of free time, but I chose the path of modification.  In the end, no one forbids calling a modified plugin with a different name and using it as something new and new.  To health!  :) <br><br>  The main nagging is associated with incorrect display of icons and some related to this, the wrong behavior of the RowExpander plugin, which is inside the ‚Äúgrid‚Äù that also uses this plugin.  The essence of the idea of ‚Äã‚Äãsolving a problem is that each ‚Äúgrid‚Äù nested in another ‚Äúgrid‚Äù should use its own style names to determine whether the line is open / closed.  Armed with this idea, it is quite simple to realize the dynamic creation of identical styles with different names, directly dependent on the grid ID.  Make it pretty simple.  Let's change the plugin's constructor a bit by adding the following code: <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">if</font> (!config.id) { <br> config.id = Ext.id(); <br> } <br> <br> Ext.apply( <font color="#0000ff">this</font> , config); <br> <br> <font color="#0000ff">var</font> css = <br> <font color="#A31515">'.x-'</font> + <font color="#0000ff">this</font> .id + <font color="#A31515">'-grid3-row-collapsed .x-grid3-row-expander { background-position:0 0; }'</font> + <br> <font color="#A31515">'.x-'</font> + <font color="#0000ff">this</font> .id + <font color="#A31515">'-grid3-row-expanded .x-grid3-row-expander { background-position:-25px 0; }'</font> + <br> <font color="#A31515">'.x-'</font> + <font color="#0000ff">this</font> .id + <font color="#A31515">'-grid3-row-collapsed .x-grid3-row-body { display:none !important; }'</font> + <br> <font color="#A31515">'.x-'</font> + <font color="#0000ff">this</font> .id + <font color="#A31515">'-grid3-row-expanded .x-grid3-row-body { display:block !important; }'</font> <br> ; <br> <br> Ext.util.CSS.createStyleSheet( css, Ext.id()); <br> <br> <font color="#0000ff">this</font> .expanderClass   = <font color="#A31515">'x-grid3-row-expander'</font> ; <br> <font color="#0000ff">this</font> .rowExpandedClass = <font color="#A31515">'x-'</font> + <font color="#0000ff">this</font> .id + <font color="#A31515">'-grid3-row-expanded'</font> ; <br> <font color="#0000ff">this</font> .rowCollapsedClass = <font color="#A31515">'x-'</font> + <font color="#0000ff">this</font> .id + <font color="#A31515">'-grid3-row-collapsed'</font> ;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The need to define the properties of expanderClass, rowExpandedClass and rowCollapsedClass is related to the fact that now it will be quite easy for us to operate with their values ‚Äã‚Äãinside the plugin, and we still have to make some changes to its code. <br><br>  Now we have separate style classes for each unique grid on our page.  Let's change the methods associated with defining the behavior of the plugin so that they can use the predefined style names: <br><br>  Change the render method: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">return</font> <font color="#A31515">'&lt;div class="'</font> + <font color="#0000ff">this</font> .expanderClass + <font color="#A31515">'"&gt; &lt;/div&gt;'</font> ;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Also change the toggleRow methods: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">this</font> [Ext.fly(row).hasClass( <font color="#0000ff">this</font> .rowCollapsedClass) ? <font color="#A31515">'expandRow'</font> : <font color="#A31515">'collapseRow'</font> ](row);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  expandRow: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">Ext.fly( row).replaceClass( <font color="#0000ff">this</font> .rowCollapsedClass, <font color="#0000ff">this</font> .rowExpandedClass);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  and collapseRow: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">Ext.fly( row).replaceClass( <font color="#0000ff">this</font> .rowExpandedClass, <font color="#0000ff">this</font> .rowCollapsedClass);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Everything, on this treatment of the plug-in disease described above can be considered complete. <br><br>  However, a complete solution to all problems with this does not come. <br><br><h2>  Tree branches and leaves </h2><br><br>  First of all, like any other tree, ours should be able to correctly reflect the ‚Äúbranches‚Äù and ‚Äúleaves‚Äù.  By these concepts, I mean that the "branch" can be opened (it has descendants), and the leaves have no descendants.  Unfortunately, in its current state, RowExpander cannot distinguish ‚Äúleaves‚Äù from ‚Äúbranches‚Äù and adds open / close controls to all rows of the ‚Äúgrid‚Äù.  For the full implementation of the tree, we will have to continue to change it. <br><br>  Fortunately, the decision is not so difficult.  Let's dwell on the thesis that our data set should contain a sign of whether the record is finite (‚Äúsheet‚Äù) or may contain descendants (‚Äúbranch‚Äù).  To do this, it is enough to define a field in the record, for example, with the name ‚Äúis_leaf‚Äù, taking the logical value true or false (is_leaf = true - ‚Äúsheet‚Äù, is_leaf = false - ‚Äúbranch‚Äù). <br><br>  At the same time, we should not prevent the plugin from working as it did before.  That is, we will determine for ourselves how and when the plugin should work in tree mode, by default, it will behave as before. <br><br>  To implement this mechanism, we define the public configuration properties actAsTree = false and treeLeafProperty = 'is_leaf'.  Thus, when initializing a plug-in, it will be possible to indicate whether the plug-in should behave like a tree (in fact, check whether the ‚Äúgrid‚Äù lines are leaves of the tree), and also set the name of the ‚Äúsheet‚Äù attribute in the record. <br><br>  First of all, we need to define another style to display the sheet (in fact, it should just hide the open / close element on elements with type is_leaf = true): <br><br>  Add to the already created style definition: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">var</font> css = <br> ... <br> + <font color="#A31515">'.x-grid-expander-leaf .x-grid3-row-expander { background: none; }'</font> <br> ;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  and define a property that we could use inside the plugin for the given style class name: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">this</font> .leafClass = <font color="#A31515">'x-grid-expander-leaf'</font> ;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  There is only a handful of things left; you need to affix this class to the appropriate lines and prohibit actions to open / close lines marked as leaves. <br><br>  To do this, change the getRowClass method (row initialization): <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">var</font> cssClass = <font color="#0000ff">this</font> .state[record.id] ? <font color="#0000ff">this</font> .rowExpandedClass : <font color="#0000ff">this</font> .rowCollapsedClass; <br> <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> .actAsTree &amp;&amp; record.get( <font color="#0000ff">this</font> .treeLeafProperty)) { <br> cssClass = <font color="#0000ff">this</font> .leafClass; <br> } <br> <font color="#0000ff">return</font> cssClass;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  and add a check to the toggleRow, expandRow, collapseRow methods (prohibit actions on the leaves): <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">if</font> (Ext.fly(row).hasClass( <font color="#0000ff">this</font> .leafClass)) { <br> <font color="#0000ff">return</font> ; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h2>  Event handling problem </h2><br><br>  Even after all this, problems remain.  The behavior of ‚Äúgrids‚Äù nested in each other turns out to be rather inadequate.  You will encounter glitches when selecting rows, sorting, etc.  Actions on the rows of descendants will be projected on the parent "grid".  This is all pretty unpleasant, but very easily solved! <br><br>  On each newly created descendant just need to disable pop-up events.  To do this, we will make the next change in RowExpander to the onRender method, which in turn is executed at the time of rendering the ‚Äúgrid‚Äù itself. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">if</font> ( <font color="#0000ff">this</font> .actAsTree) { <br> grid.getEl().swallowEvent([ <font color="#A31515">'mouseover'</font> , <font color="#A31515">'mouseout'</font> , <font color="#A31515">'mousedown'</font> , <font color="#A31515">'click'</font> , <font color="#A31515">'dblclick'</font> ]); <br> });</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h2>  Problem with memory leaks </h2><br><br>  And not all problems are solved :).  We still need to take care of removing all the components associated with the collapsed grids.  It makes no sense to describe the detailed changes, especially since this area may still change more than once.  Just look at the code: <br><br>  The full code of the modified RowExpander plugin: <a href="">RowExpander.js</a> <br>  A live example of nested grids: <a href="http://mikhailstadnik.com/ext/examples/nested-grid.htm">ExtJS Nested Grids Example</a> <br><br><h2>  Conclusion </h2><br><br>  Despite the primary difficulties in building nested grids, and seemingly confronted with the unsuitability of ‚Äúgrids‚Äù to nesting, in a rather simple way, we managed to achieve quite an acceptable result, which once again shows the flexibility and extensibility of the ExtJS library. <br><br>  It only remains for me to hope that this article will help someone to overcome the difficulties. <br><br>  Good luck in development! <br><br>  PS This is a cross-posting of the original article " <a href="http://mikhailstadnik.com/nested-grids-with-extjs">Nested Grids using ExtJS 3.0</a> " posted on my personal blog. </div><p>Source: <a href="https://habr.com/ru/post/78023/">https://habr.com/ru/post/78023/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../78016/index.html">Online passport copy fraud</a></li>
<li><a href="../78017/index.html">Tale of why I got up and left</a></li>
<li><a href="../78018/index.html">Sparse NTFS files</a></li>
<li><a href="../78019/index.html">Internet providers merge info on subscribers?</a></li>
<li><a href="../78022/index.html">The problem with running WM</a></li>
<li><a href="../78024/index.html">PropertyGrid in Visual Studio: mapping fields associated with collections of objects</a></li>
<li><a href="../78026/index.html">How to take my money from the Yandex wallet. Part 5. Failure</a></li>
<li><a href="../78027/index.html">Their sudoku on their batch file</a></li>
<li><a href="../78029/index.html">New feature on Google homepage</a></li>
<li><a href="../78031/index.html">RoverPC X8 or Russian do not surrender :)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>