<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Troubleshooting Android Time Sync Issues</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After reading the article ‚ÄúMoving the MSD time zone to MSK - a new local-scale Y2K‚Äù , he recalled that he and his work colleague had already solved th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Troubleshooting Android Time Sync Issues</h1><div class="post__text post__text-html js-mediator-article">  After reading the article <a href="http://habrahabr.ru/blogs/sysadm/130363/">‚ÄúMoving the MSD time zone to MSK - a new local-scale Y2K‚Äù</a> , he recalled that he and his work colleague had already solved this problem on Android (HTC Hero) long ago and wanted to write in a sandbox, but put everything off until later.  And today there was another article <a href="http://habrahabr.ru/blogs/android/130808/">‚ÄúUpdating time zones on Android‚Äù, which</a> practically buried the idea of ‚Äã‚Äãwriting, and confirmed the idea that you shouldn‚Äôt postpone important things for later.  But ... having a little remembered, I nevertheless decided, because these articles dealt with problems related to the transition to winter / summer time and didn‚Äôt touch at all the moment regarding the weather widget‚Äôs work with the weather and automatic time determination through the cellular operator. <br><br><a name="habracut"></a>  It all started when a new HTC Desire S. was purchased. <br><br>  During the setup process, it turned out that in the date and time settings it is not possible to choose my city - Novosibirsk and have to choose an alternative city with the appropriate time zone. <br>  It also turned out that the time synchronization from the operator works somehow mysteriously and the HTC Clock widget in the weather display mode and with the automatic synchronization turned on displays incorrect time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href="http://www.imageup.ru/img54/auto_wrong796417.png.html"><img src="https://habrastorage.org/getpro/geektimes/post_images/d4a/f03/162/d4af03162c93cbe8a1d5d4d58ed48836.jpg"></a> <br><br>  In the picture it may seem that everything is in order, but the time on the phone actually ran an hour ago.  You can turn off automatic detection and set the zone by hand, but then we get the following: <br><br> <a href="http://www.imageup.ru/img54/manual-wrong796421.png.html"><img src="https://habrastorage.org/getpro/geektimes/comment_images/31d/c3d/d8c/31dc3dd8c19321aa09cd97a9900e7715.jpg"></a> <br><br>  As you can see, Novosibirsk is absent in the list.  We had to choose Bangkok, and the system time in the phone became correct, but the widget still displays backward an hour. <br><br>  We tried to find a solution online.  Found that we are not alone, and such problems exist not only among residents of Novosibirsk, but also among residents of other cities on the planet.  We did not find a comprehensive solution to all these problems. <br><br>  It was possible to score on it all, turn it off, set it up with your hands and not pay attention to the widget, but ... it's Android - and this means that we can and must defeat it! <br><br><h5>  And so, we start </h5><br>  The new phone was not rutovny at that time and could not be made as such.  Therefore, for experiments, HTC Hero was taken with the original + root / busybox / apps2sd firmware, which had exactly the same problems. <br><br>  Found through osmonitor application in which the time zone is selected - (com.android.settings).  We looked at the source code for the com.android.settings package and found out that resources are loaded from the <i>timezones.xml</i> XML file. <br><br>  We got the apk of this application <i>/system/app/Settings.apk with the</i> following command: <br><pre> adb pull /system/app/Settings.apk </pre><br><br>  I will not describe all the details of the work of APK manager and Android SDK tools, I think interested people can easily figure it out.  I will focus only on the key points. <br><br>  Using the APK manager, the following actions were performed. <br><ul><li>  decompile </li><li>  pens in another window edited files </li><li>  compile.  When compiling, APK manager asks questions: <br>  ‚ÄúIs this a system apk (y / n)‚Äù - we answer yes <br>  ‚ÄúAside from the signatures, make sure you‚Äôre free of charge.‚Äù - also answer yes. <br>  Next, we act on the instructions proposed by the APK manager, in the other window, delete the files from the keep directory that we changed + resources.arsc. </li><li>  We complete the assembly. </li></ul><br>  We made changes for our city, by analogy, residents of other cities will also be able to try to fix this problem on their phones. <br><br>  The resulting apk was placed back into the phone: <br><pre>  adb push Settings.apk / system / app / </pre><br><br>  With this we achieved the fact that in the list of manual selection of the time zone appeared Novosibirsk. <br><br>  Our city appeared in the list, but the definition of the time zone in the automatic mode still did not work correctly.  To do this, we went further and found out that the time zone settings for cities are stored in the database, namely in the file /system/etc/WPDB.zip. <br>  Taking it out of the phone using all the same adb, we extracted two bases from it <br><ul><li>  WP_0409WWE.db </li><li>  WP_0419RUS.db </li></ul><br>  for English and Russian, respectively.  Looking at the data, we found that for our city, the time zone is registered as Asia / Almaty, we had to correct this moment, for this we changed the timezoneId to Asia / Novosibirsk in the databases (using Lita as the SQLite database editor): <br><pre> update locationlist set timezoneId = 'Asia / Novosibirsk' where name = 'Novosibirsk' - (for WP_0409WWE.db)
 update locationlist set timezoneId = 'Asia / Novosibirsk' where name = 'Novosibirsk' - (for WP_0419RUS.db)
</pre><br>  In addition, another database added an entry about our city, namely in <i>/system/etc/timezones.db</i> <br>  Added entry, timezoneId: Asia / Novosibirsk, other fields Novosibirsk, ru - Novosibirsk. <br><br>  In order for all changes to take effect, reset the cache for applications <br>  Clock, Settings and Weather Provider.  Well, for complete confidence restarted the phone. <br><br><h5>  Results </h5><br><br>  As a result, we got the following cakes: <br> <a href="http://www.imageup.ru/img54/auto-right796430.png.html"><img src="https://habrastorage.org/getpro/geektimes/post_images/283/e73/dea/283e73dea7a8ee5ec8144504bb325075.jpg"></a> <br>  As we can see, in automatic mode, the zone is determined correctly, the system time and time on the widget are the same, well, in manual mode, everything is fine. <br><br>  Having become involved in a war with time, we decided to go to the end.  Namely, to solve the problem of canceling the transition to winter / summer time. <br>  Download the latest tzdata (aka timeinfo.dat) from, then still available, resource <a href="">elsie.nci.nih.gov/pub</a> <br>  Found that in her about us have not thought, corrected, prepared and poured into the phone.  At the time of writing, this database already contains the correct settings for our vast country, and how to solve this problem is well described in the article <a href="http://habrahabr.ru/blogs/android/130808/">‚ÄúUpdating time zones on Android‚Äù</a> <br><br>  In conclusion, I provide a list of the tools we used: <br><ul><li>  <a href="http://forum.xda-developers.com/showthread.php%3Ft%3D695701">APK Manager</a> </li><li>  <a href="http://www.dehats.com/drupal/%3Fq%3Dnode/58">Lita</a> </li><li>  <a href="http://developer.android.com/sdk/index.html">Android SDK</a> </li></ul><br>  I hope we have not wasted time, and this information will be useful to someone. <br><br>  P.S.  after publication, I accidentally found an article describing the addition of a new city <a href="http://habrahabr.ru/blogs/android/105053/">HTC Sense and a weather widget - we add our city</a> slightly intersecting with this one. <br></div><p>Source: <a href="https://habr.com/ru/post/131320/">https://habr.com/ru/post/131320/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131309/index.html">Google Nexus One is not likely to get updates to Android 4.0</a></li>
<li><a href="../131310/index.html">Problems transfer lists of transfers or why abstractions "flow"</a></li>
<li><a href="../131313/index.html">RIF-Voronezh will be held November 10-11</a></li>
<li><a href="../131314/index.html">TeamLab Calendar - our modest contribution to your time management</a></li>
<li><a href="../131316/index.html">Inviter - Two years of work</a></li>
<li><a href="../131321/index.html">Yandex is not looking for pictures on request "children"</a></li>
<li><a href="../131323/index.html">GMP: with what we give up</a></li>
<li><a href="../131325/index.html">How to create a successful startup? Surely there is a method</a></li>
<li><a href="../131326/index.html">Sony buys stake in Ericsson in Sony Ericsson</a></li>
<li><a href="../131329/index.html">Sony Ericsson is now wholly owned by Sony Corporation.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>