<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asteroids javascript implementation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In order to somehow dilute the trend towards 30line players, I decided to write a rather complete and, in comparison with 30lines, bulk implementation...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asteroids javascript implementation</h1><div class="post__text post__text-html js-mediator-article">  In order to somehow dilute the trend towards 30line players, I decided to write a rather complete and, in comparison with 30lines, bulk implementation of the classic game Asteroids. <br><img src="https://habrastorage.org/getpro/habr/post_images/b67/887/8d2/b678878d2dc0415dea1145afabdeb775.png" alt="screenshot" align="left"><br>  I will not be measured by the number of lines or characters of the code, because  <a href="https://github.com/AterCattus/js-asteroids">it has a</a> fairly normal design and even comments. <br>  The world of the game is drawn on canvas, all objects of the world are unified, and the collision detector uses a pixel-by-pixel test.  There is a simple dubbing of life, godmod for the first seconds after the appearance, points, complexity increasing with points and, of course, asteroids falling apart. <br>  You can try <a href="http://ater.me/asteroids/">here</a> .  I strongly advise Chrome or at least FF. <br><a name="habracut"></a><br><br>  To reduce the amount of logic, all the objects of the world are made universal, with minimal separation depending on the specific type.  The geometry of the objects is stored in the lists of vertices, just like they used to do through glBegin (GL_LINES).  For the ship, two geometries are assigned (regular and with flame during acceleration) for the sake of the same logic unification.  If you break the code, you can make asteroids or bullets in the shape of a ship, and so on.  All points in the geometry are specified in the coordinates [-1..1], and specific dimensions are obtained by scaling at the canvas drawing level.  And for any size of the asteroid, you can apply any geometry (there are several options for asteroids). <br><br>  Each object has a group of characteristics: <br><ul><li>  Object type: ship, asteroid, bullet.  UFO yet; </li><li>  Current geometry; </li><li>  Coordinates of the geometry center in the screen SC; </li><li>  The size of the object, as a multiplier of coordinates in geometry; </li><li>  The projections of the velocity vector on the coordinate axes; </li><li>  Drag coefficient (&gt; 1 for the ship, which leads to drag after acceleration); </li><li>  Angle of rotation and "angular velocity" used for asteroids and bullets; </li><li>  The lifetime of the object, if this time is limited (applies to bullets). </li></ul><br>  Unification has greatly simplified the handling of special situations, such as wrapping an object as it leaves the screen. <br><div class="spoiler">  <b class="spoiler_title">All wrapping logic for both axes</b> <div class="spoiler_text">  S - object data, W - world data <pre><code class="hljs pgsql">[{x:<span class="hljs-string"><span class="hljs-string">'x'</span></span>, W:Ww}, {x:<span class="hljs-string"><span class="hljs-string">'y'</span></span>, W:Wh}].<span class="hljs-keyword"><span class="hljs-keyword">forEach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(_) { var <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> = (_.W&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>)+Sr, diff = _.W+<span class="hljs-number"><span class="hljs-number">2</span></span>*Sr; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (S[_.x] &lt; -<span class="hljs-keyword"><span class="hljs-keyword">limit</span></span>) {S[_.x] += diff} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (S[_.x] &gt; <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span>) {S[_.x] -= diff} });</code> </pre>  The code can still be reduced.  But imkho from becomes less clear. </div></div><br>  In one of the first versions I tried the variant with the display of objects in two parts, with a partial approach over the edges (a sort of Portal).  It looked funny, but it seemed to me not at all canonical.  Maybe worth a refund? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Differentiation by type is performed only in the logic of handling collisions, in order to understand what has come across at all.  Now accounted for the collision of asteroids in the ship and bullets.  There are thoughts about the collision of asteroids with each other, and, of course, an introduction to the game of UFOs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/577/388/133/57738813345673193c565aca94b1f652.png" alt="image" align="right">  The initial version of the collisions on the shells (the bounding box through the circumscribed circles) showed inconsistency, when in the case, as in the picture on the right, the collision worked.  This was unacceptable, as it deprived of all the "drive".  I came up with two solutions: the mathematical calculation of the intersection of geometry (any object is represented as a closed set of segments) and pixel-by-pixel testing exactly as it draws the browser engine.  The first option is, theoretically, less resource-intensive, but I chose the second. <br>  A second canvas is created, on which (only if the shell test confirms a possible intersection) two checked objects are drawn, but in a red-green color gamut with active blending by 50%.  As a result, in the place of the real intersection, we will have pixels that have both red and green components.  Very simple, though not effective. <br><div class="spoiler">  <b class="spoiler_title">The test for the second canvas looks like this</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/963/2b0/c42/9632b0c420a16f14bb8902fb04b908cf.png" alt="image"><br>  The screenshot is a bit crooked due to the lack of synchronization of the drawing with the screenshot. </div></div><br><br>  Well, some already more or less "meat" in the end: <br><img src="https://habrastorage.org/getpro/habr/post_images/db2/5cf/c96/db25cfc9681fc09822fc24dcc3d18a45.png" alt="image"><br>  It is seen that asteroids are derived wireframe.  Again, for the sake of canonicity. </div><p>Source: <a href="https://habr.com/ru/post/202888/">https://habr.com/ru/post/202888/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202874/index.html">Tiny Tron on JS (30 lines of code)</a></li>
<li><a href="../202876/index.html">Upgrading Nexus 4 to Android 4.4 on Linux</a></li>
<li><a href="../202878/index.html">What do bad security managers do?</a></li>
<li><a href="../202880/index.html">Git to help admin lokalkhost</a></li>
<li><a href="../202884/index.html">Overcoming the hidden dangers of KVO in Objective C</a></li>
<li><a href="../202890/index.html">PHP creator Rasmus Lerdorf - about anarchy and democracy in language development, PHP 5.6 and complaining programmers</a></li>
<li><a href="../202894/index.html">Galileo is the first Arduino-compatible microcomputer on the Intel platform. Now Available!</a></li>
<li><a href="../202896/index.html">Continuous Integration in Selectle</a></li>
<li><a href="../202898/index.html">Wireless communications "smart home". Part two, practical</a></li>
<li><a href="../202900/index.html">KUB-BS - controller ‚Äúfor growth‚Äù for monitoring container-type objects, including Cellular base stations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>