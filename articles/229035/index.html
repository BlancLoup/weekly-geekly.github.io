<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Strongly typed incomplete data representation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article ‚ÄúType Designing,‚Äù the idea was described of how to construct types that are similar to classes. This makes it possible to sepa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Strongly typed incomplete data representation</h1><div class="post__text post__text-html js-mediator-article">  In the previous article <a href="http://habrahabr.ru/post/222553/">‚ÄúType Designing,‚Äù the</a> idea was described of how to construct types that are similar to classes.  This makes it possible to separate the stored data from the meta-information and focus on the presentation of the properties of the entities themselves.  However, the described approach is quite complex due to the use of the HList type.  In the course of the development of this approach, it was understood that for many practical problems a linear ordered sequence of properties, like the completeness of a set of properties, is not mandatory.  If this requirement is relaxed, the constructed types are much simpler and become very convenient for use. <br><br>  In the updated version of the <a href="">synapse-frames</a> library, hierarchical data structures are described extremely simply and any subsets of such structures are represented. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Bilateral-typed relationships </h2><br><br>  The property of an object is usually considered in relation to the object itself, and in this case the property has a data type.  One type is only for limiting the data that can be contained in the property.  Therefore, it seemed logical to represent the property as <code>Slot[T]</code> .  However, a property is also tied to the type of object in which this property is declared, although not in a very explicit way.  In the above article, to establish such a relationship, a new surrogate type was constructed from a set of properties. <br><br>  If, however, to express the relationship to the type of container directly in the type of the property itself, then this allows you to avoid creating a surrogate type and use much more convenient means.  So, we present the property as a two-sided relationship between two types: <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Relation</span></span></span><span class="hljs-class">[-</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">L</span></span></span><span class="hljs-class">,</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">R</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rel</span></span></span><span class="hljs-class">[-</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">L</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">R</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">name: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Relation</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">L</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">R</span></span></span><span class="hljs-class">]</span></span></code> </pre><br>  (the -L symbol means contravariance, i.e., the property will be available also for the descendants of type L. And the type R is declared invariant, since we plan to use getters and setters for the property) <br><br>  The Rel class allows us to describe the attributes available for type L. For example, <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Box</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">width</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Rel</span></span>[<span class="hljs-type"><span class="hljs-type">Box</span></span>, <span class="hljs-type"><span class="hljs-type">Int</span></span>](<span class="hljs-string"><span class="hljs-string">"width"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> height = <span class="hljs-type"><span class="hljs-type">Rel</span></span>[<span class="hljs-type"><span class="hljs-type">Box</span></span>, <span class="hljs-type"><span class="hljs-type">Int</span></span>](<span class="hljs-string"><span class="hljs-string">"height"</span></span>)</code> </pre><br><br>  (the same properties will be available for Box type descendants). <br><br>  In addition to just the name, any meta information required by the application can be attached to the property ‚Äî the database domain, the text description of the property, the serializer / deserializer, the limit on the size of the stored data, the width of the column in the table, the display format (for dates), etc.  Meta-information, in case of need, can be linked by external linking using map. <br><br>  For type L we need to have some kind of real type.  In the previous version, we designed this type as a HList over the properties of this type.  Here you can use an arbitrary type available in Scala as the type L.  For example, any primitive type, or any type alias, you can use traits, abstract and final classes, object.types.  Thanks to contravariant L, we can use the inheritance relation between types, which we use as property carriers.  Apparently, it is convenient to reflect the inheritance relation in the form of a set of abstract classes, traits and final classes in accordance with the logic of the subject area. <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shape</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BoundingRectangle</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rectangle</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shape</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BoundingRectangle</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Circle</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shape</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BoundingRectangle</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">width</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Rel</span></span>[<span class="hljs-type"><span class="hljs-type">BoundingRectangle</span></span>, <span class="hljs-type"><span class="hljs-type">Int</span></span>](<span class="hljs-string"><span class="hljs-string">"width"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> height = <span class="hljs-type"><span class="hljs-type">Rel</span></span>[<span class="hljs-type"><span class="hljs-type">BoundingRectangle</span></span>, <span class="hljs-type"><span class="hljs-type">Int</span></span>](<span class="hljs-string"><span class="hljs-string">"height"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> radius = <span class="hljs-type"><span class="hljs-type">Rel</span></span>[<span class="hljs-type"><span class="hljs-type">Circle</span></span>, <span class="hljs-type"><span class="hljs-type">Int</span></span>](<span class="hljs-string"><span class="hljs-string">"radius"</span></span>)</code> </pre><br><br>  A separate attribute can be viewed as one component, allowing you to go from the parent object to the child.  If the child has its own attributes, then you can navigate through any of them.  A pair of such attributes can be combined into a path from the ‚Äúgrandfather‚Äù to the ‚Äúgrandson‚Äù and a new relation will be obtained (Rel2 (attr1, attr2)). <br><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rel2</span></span></span><span class="hljs-class">[-</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">L</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">M</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">R</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">_1: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Relation</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">L</span></span></span></span><span class="hljs-class"><span class="hljs-params">, </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">M</span></span></span></span><span class="hljs-class"><span class="hljs-params">], _2: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Relation</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">M</span></span></span></span><span class="hljs-class"><span class="hljs-params">, </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">R</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Relation</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">L</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">R</span></span></span><span class="hljs-class">]</span></span></code> </pre><br><br>  The `/` method, which constructs Rel2, is added to DSL, thereby realizing the composition of relations. <br><br>  I would also like to note that such relationships are an integral part of the triples that form the basis of the RDF / OWL ontologies.  Namely, relations represent the average component of the three: <br>  (object identifier of type L, identifier of property Relation [L, R], identifier of value of property of type R). <br><br><h2>  Strongly Typed Ids </h2><br><br>  When using an incomplete description of an object through a set of attributes, the question of comparing different sets of attributes with the same instance is very important.  It is necessary in some way to reflect the <i>authenticity of the</i> instance to itself.  OOP for this purpose can use the fact that the attribute values ‚Äã‚Äãbelong to the same object.  In the database, some method of identification is usually used.  Equality of object identifiers allows to display the authenticity of the objects in question. <br><br>  We can also use identifiers to relate attribute sets to a single instance.  Since the attributes in our case are associated with the type of object, then the identifier must be associated with the same type.  This will allow at the compilation stage to check the consistency of the types of the identified object and attributed attributes. <br><br>  In the simplest case, we could use this type of identifier: <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Id</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">]</span></span></code> </pre><br><br>  However, this method of identification is not universal.  First, many objects are identified only within parent objects;  secondly, many types of objects can have several identification methods at once.  To reflect the first phenomenon, we can use the Rel [-L, R] type described above, considering it as a way of transition from the parent object to a specific instance of the child object.  If we recall that child objects are often combined into typed collections, then the child object identifier is composite: first, the collection is selected, and then an element of this collection is selected by an integer index: <br><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> children = <span class="hljs-type"><span class="hljs-type">Rel</span></span>[<span class="hljs-type"><span class="hljs-type">Parent</span></span>, <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Children</span></span>]](<span class="hljs-string"><span class="hljs-string">"children"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntId</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">id: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Relation</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Seq</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">child123</span></span></span><span class="hljs-class"> </span></span>= children / <span class="hljs-type"><span class="hljs-type">IntId</span></span>(<span class="hljs-number"><span class="hljs-number">123</span></span>)</code> </pre><br>  (here the DSL method `/` is used, combining two relationships into one (composition of relationships)). <br><br>  This method of identification allows you to uniquely move from the parent object to the desired child element.  What if we want to use an alternative method of identification?  For example, we know that some property of a child object has a unique property within the parent object, and, therefore, can be used to select a child object.  In this case, we can use the identification through the index: <br><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IndexedCollection</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TId</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Index</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TId</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">keyProperty: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Relation</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-class"><span class="hljs-params">, </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">TId</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Relation</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Seq</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">],</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IndexedCollection</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TId</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">]] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IndexValue</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TId</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">value:</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">TId</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Relation</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IndexedCollection</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TId</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">]</span></span></code> </pre><br><br>  For example: <br><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name = <span class="hljs-type"><span class="hljs-type">Rel</span></span>[<span class="hljs-type"><span class="hljs-type">Child</span></span>, <span class="hljs-type"><span class="hljs-type">String</span></span>](<span class="hljs-string"><span class="hljs-string">"name"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> childByName = name.index <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> childVasya = parent / children / childByName / <span class="hljs-type"><span class="hljs-type">IndexValue</span></span>(<span class="hljs-string"><span class="hljs-string">"Vasya"</span></span>)</code> </pre><br><br>  Thus, the Rel [-L, R] type, extended by the sequence number in the collection and indexed by the property of the child object, allows navigation in the hierarchical data structure. <br><br>  To identify objects that are at the topmost level and have no parent object, you can enter a special type of Global, which will contain all the collections of high-level objects: <br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Global</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">persons</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Rel</span></span>[<span class="hljs-type"><span class="hljs-type">Global</span></span>, <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Person</span></span>]](<span class="hljs-string"><span class="hljs-string">"persons"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> otherTopLevelObjects = <span class="hljs-type"><span class="hljs-type">Rel</span></span>[<span class="hljs-type"><span class="hljs-type">Global</span></span>, <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">OtherTopLevelObject</span></span>]](<span class="hljs-string"><span class="hljs-string">"otherTopLevelObjects"</span></span>)</code> </pre><br><br><h2>  Data schema </h2><br><br>  Relations themselves are building blocks that allow you to build both the data structures themselves and the schemas of these data.  To describe the data schema, you can use the relational approach - entity-relationship.  In this case, the schema is a collection of entity descriptions and a collection of descriptions of relationships between entities.  For entities, a set of attributes is specified, and for relationships, 1-0, 1-1, 1- *, * - * <br><br>  You can also use an object-oriented approach that describes the nature, properties and collections of child objects, for which, in turn, properties and collections are described. <br><br>  The relational scheme is, of course, perfectly suited for presenting data in a database, and object-oriented can be used to create object-oriented services (web-services?). <br><br>  To describe type T in the object-oriented version of the scheme, one of the descendants of <code>Schema[T]</code> . <br>  <code>SimpleSchema</code> - for simple types that do not contain attributes; <br>  <code>RecordSchema</code> - composite types containing the specified attributes; <br>  <code>CollectionSchema</code> - for types Seq [T] allows you to bind the schema elements of the collection. <br><br><h2>  Data storage </h2><br><br>  Meta-information itself does not contain data.  For storage, you must use other structures.  Such structures depend on the needs of the application: <br><ul><li>  ordinary classes with ordinary properties that are accessed using reflection by property names; </li><li>  special classes for storing data that also contain meta-information are inheritors of <code>Instance[T]</code> ( <code>SimpleInstance, RecordInstance, CollectionInstance</code> ).  These types simplify working with the data described by the scheme, since  data storage directly corresponds to the scheme; </li><li>  linear tuple, "list of lists" ( <code>List[Any]</code> ).  The hierarchical structure of nested Records can be decomposed into a linear structure - a sequence of primitive types.  Nested collections are converted into lists of simplest type lists.  Such a representation can be used for transmission over the network and for interaction with the database (since the tuple directly corresponds to the row of the table).  To convert Instances to flat lists and back, use a pair of operations align / unalign (flatten); </li><li>  DB tables, data from which is retrieved using RecordSet; </li><li>  JSON objects; </li><li>  XML. </li></ul><br><br><h2>  Data construction </h2><br><br>  When creating data instances, the most important limitation that we want to check at the compilation stage is that the properties can be specified only for the types for which they are declared (for this, the property generally has a generic type for the left side relations).  From this it follows that in the process of creating an instance of data that satisfies the scheme, it is necessary to use special tools.  For example: <br><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> b1 = empty[<span class="hljs-type"><span class="hljs-type">Box</span></span>] .set(width, simple(<span class="hljs-number"><span class="hljs-number">10</span></span>)) .set(height, simple(<span class="hljs-number"><span class="hljs-number">20</span></span>))</code> </pre><br><br>  It uses the immutable type <code>Instance[Box]</code> , to which pairs are added - (property, value).  In case there is little data, this approach is sufficient.  If you need to collect a lot of data, it is more efficient to use a mutable builder, within which the required set of attributes is gradually formed.  At the end of the build, the builder is converted to <code>Instance[Box]</code> : <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> boxBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Builder</span></span>(boxSchema) boxBuilder.set(width, simple(<span class="hljs-number"><span class="hljs-number">10</span></span>)) boxBuilder.set(height, simple(<span class="hljs-number"><span class="hljs-number">20</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> b1 = boxBuilder.toInstance</code> </pre><br><br>  Also the builder provides two runtime checks - <br><ol><li>  the inadmissibility of the use of properties that are not included in the scheme; </li><li>  ensuring the completeness of the formed object. </li></ol><br><br>  In order to present data in rows of tables in a database, it is necessary to convert nested Records into a flat structure.  To do this, use a pair of align / unalign methods. <br><br><h2>  Conclusion </h2><br><br>  The outlined approach allows <br><ul><li>  describe complex subject areas with explicit preservation of meta-information; </li><li>  operate on properties in a strongly typed way (with type checking at compile time); </li><li>  to represent arbitrary hierarchical data structures (like json'a) with type checking at all levels; </li><li>  submit incomplete data and verify the degree of completeness (for example, you can have <code>smallSchema[T]</code> and <code>fullSchema[T]</code> with which to check data instances). </li></ul><br><br>  In contrast to the approach described in the <a href="http://habrahabr.ru/post/222553/">previous article</a> , we weaken the requirement to ensure that the data completeness is checked at compile time.  In return, a much simpler and more convenient approach is obtained.  The admissibility of using the property on the specified type is checked by the compiler without constructing bulky surrogate types based on HList.  At the same time, we are not constrained by an object-oriented approach in terms of presenting data and limiting the composition of entity attributes. </div><p>Source: <a href="https://habr.com/ru/post/229035/">https://habr.com/ru/post/229035/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229023/index.html">Project 2045 - avatars</a></li>
<li><a href="../229025/index.html">How to go bankrupt with Google Maps</a></li>
<li><a href="../229027/index.html">COOLRF: Project News Digest # 2</a></li>
<li><a href="../229029/index.html">Using LaTeX instead of HTML in Habrahabr</a></li>
<li><a href="../229031/index.html">Overview of 7 online software localization services</a></li>
<li><a href="../229037/index.html">LG G Watch became available for purchase on Google Play</a></li>
<li><a href="../229039/index.html">Log in via Google to Android and check the token on the server</a></li>
<li><a href="../229041/index.html">Work with data in mobile applications. Implement offline storage and data synchronization using Microsoft Azure and SQLite</a></li>
<li><a href="../229043/index.html">Centos 7 release released</a></li>
<li><a href="../229045/index.html">Game server on Scala + Akka</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>