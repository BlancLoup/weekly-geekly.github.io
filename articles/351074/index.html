<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to quickly write and roll out in the production of machine learning algorithm</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nowadays, data analysis is increasingly used in various, often remote from IT fields and tasks that a specialist faces in the early stages of a projec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to quickly write and roll out in the production of machine learning algorithm</h1><div class="post__text post__text-html js-mediator-article">  Nowadays, data analysis is increasingly used in various, often remote from IT fields and tasks that a specialist faces in the early stages of a project are radically different from those faced by large companies with advanced analytics departments.  In this article I will discuss how to quickly make a useful prototype and prepare a simple API for its use by an application programmer. <br><br>  For example, consider the problem of predicting the price of pipes placed on the Kaggle competition platform.  Description and data can be found <a href="https://www.kaggle.com/c/caterpillar-tube-pricing">here</a> .  In fact, in practice, very often there are tasks in which you need to quickly make a prototype with a very small amount of data, or even without any real data until the first implementation.  In these cases, you have to approach the task creatively, start with simple heuristics and appreciate each query or tagged object.  But in our model situation, fortunately, there are no such problems and therefore we can immediately begin with a review of the data, the definition of the problem and the attempts to apply the algorithms. <br><a name="habracut"></a><br>  So, unpacking the archive with the data, you can find that it contains approximately a couple dozen csv-files.  According to the description on the competition page, the main ones are train_set.csv and test_set.csv.  They contain basic price information.  The remaining files contain auxiliary, but slightly less important data.  Let's look at them in more detail. <br><br>  Placing the archive in the data subdirectory of the project root directory and unarchiving it with commands 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> data/ $ unzip data.zip $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ..</code> </pre> <br>  We can see what is in the files of interest to us: <br><br><pre> <code class="bash hljs">$ head data/competition_data/train_set.csv tube_assembly_id,supplier,quote_date,annual_usage,min_order_quantity,bracket_pricing,quantity,cost TA-00002,S-0066,2013-07-07,0,0,Yes,1,21.9059330191461 TA-00002,S-0066,2013-07-07,0,0,Yes,2,12.3412139792904 TA-00002,S-0066,2013-07-07,0,0,Yes,5,6.60182614356538 TA-00002,S-0066,2013-07-07,0,0,Yes,10,4.6877695119712 TA-00002,S-0066,2013-07-07,0,0,Yes,25,3.54156118026073 TA-00002,S-0066,2013-07-07,0,0,Yes,50,3.22440644770007 TA-00002,S-0066,2013-07-07,0,0,Yes,100,3.08252143576504 TA-00002,S-0066,2013-07-07,0,0,Yes,250,2.99905966403855 TA-00004,S-0066,2013-07-07,0,0,Yes,1,21.9727024365273</code> </pre><br>  We see columns with data corresponding to the object (instance), the price of which we will predict.  Namely, the assembly identifier (it‚Äôs completely incomprehensible at the moment, but the magic of machine learning, among other things, is that in order to make effective use of data, it‚Äôs sometimes not necessary to understand what they mean), the vendor number, the date, and so on.  Separately, pay attention to the penultimate column with the number of units of delivery.  Finally, the last column is the label (label), its price.  The more units of goods delivered, the lower its price, which is consistent with our understanding of what is happening in the real world. <br><br>  Let's look now at the file with test data. <br><br><pre> <code class="bash hljs">$ head data/competition_data/test_set.csv id,tube_assembly_id,supplier,quote_date,annual_usage,min_order_quantity,bracket_pricing,quantity 1,TA-00001,S-0066,2013-06-23,0,0,Yes,1 2,TA-00001,S-0066,2013-06-23,0,0,Yes,2 3,TA-00001,S-0066,2013-06-23,0,0,Yes,5 4,TA-00001,S-0066,2013-06-23,0,0,Yes,10 5,TA-00001,S-0066,2013-06-23,0,0,Yes,25 6,TA-00001,S-0066,2013-06-23,0,0,Yes,50 7,TA-00001,S-0066,2013-06-23,0,0,Yes,100 8,TA-00001,S-0066,2013-06-23,0,0,Yes,250 9,TA-00003,S-0066,2013-07-07,0,0,Yes,1</code> </pre><br>  The same columns except for the last - namely, the predicted price.  What is logical for the competition - it is on these data that the answer must be formed in order to be sent to the competition website and receive an intermediate result. <br><br>  As we noted above, in addition to the two main data files at our disposal there are also quite a few additional ones.  It makes sense to look at at least a couple of them in order to catch the basic idea of ‚Äã‚Äãthe data they contain. <br><br><pre> <code class="bash hljs">$ head data/competition_data/tube.csv tube_assembly_id,material_id,diameter,wall,length,num_bends,bend_radius,end_a_1x,end_a_2x,end_x_1x,end_x_2x,end_a,end_x,num_boss,num_bracket,other TA-00001,SP-0035,12.7,1.65,164,5,38.1,N,N,N,N,EF-003,EF-003,0,0,0 TA-00002,SP-0019,6.35,0.71,137,8,19.05,N,N,N,N,EF-008,EF-008,0,0,0 TA-00003,SP-0019,6.35,0.71,127,7,19.05,N,N,N,N,EF-008,EF-008,0,0,0 TA-00004,SP-0019,6.35,0.71,137,9,19.05,N,N,N,N,EF-008,EF-008,0,0,0 TA-00005,SP-0029,19.05,1.24,109,4,50.8,N,N,N,N,EF-003,EF-003,0,0,0 TA-00006,SP-0029,19.05,1.24,79,4,50.8,N,N,N,N,EF-003,EF-003,0,0,0 TA-00007,SP-0035,12.7,1.65,202,5,38.1,N,N,N,N,EF-003,EF-003,0,0,0 TA-00008,SP-0039,6.35,0.71,174,6,19.05,N,N,N,N,EF-008,EF-008,0,0,0 TA-00009,SP-0029,25.4,1.65,135,4,63.5,N,N,N,N,EF-003,EF-003,0,0,0</code> </pre><br>  Yeah, it's just a correspondence between some kind of ‚Äúassembly identifier‚Äù mentioned above and the material, diameter, and so on.  The information is probably quite useful for learning the algorithm. <br><br>  Finally, let's see what is contained in the file devoted to the materials of which the pipes are made. <br><br><pre> <code class="bash hljs">$ head data/competition_data/bill_of_materials.csv tube_assembly_id,component_id_1,quantity_1,component_id_2,quantity_2,component_id_3,quantity_3,component_id_4,quantity_4,component_id_5,quantity_5,component_id_6,quantity_6,component_id_7,quantity_7,component_id_8,quantity_8 TA-00001,C-1622,2,C-1629,2,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00002,C-1312,2,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00003,C-1312,2,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00004,C-1312,2,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00005,C-1624,1,C-1631,1,C-1641,1,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00006,C-1624,1,C-1631,1,C-1641,1,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00007,C-1622,2,C-1629,2,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00008,C-1312,2,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00009,C-1625,2,C-1632,2,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA</code> </pre><br>  Again we just see a list of correspondences between the ‚Äúassembly identifier‚Äù and the components.  Pay attention to the abundance of fields with the value "NA".  As a rule, they denote gaps in the data, but in this example they correspond to cases where the component is simply not enough to fill all 8 positions in the header. <br><br>  It would seem that the data have been studied in general terms, it is time to proceed directly to setting up the algorithm.  And here it is not - before you start setting up an algorithm, you should understand what we are going to achieve from it, how we will compare the two algorithms, which one is worse, and which one is better.  First, we will have to leave part of the tagged data to check the quality of the trained algorithm; in machine learning, this part of the data is called <em>validation sampling</em> .  Secondly, we will have to exclude this part of the data from those on which we will conduct training, otherwise a model that predicts exactly that label (in our case, the price), which was in the training object and random - in any other case, will give perfect predictions on a validation sample, but absolutely terrible - with real use.  Baseline data after excluding a validation sample from them is called a <em>training sample</em> .  The process of training a model in a training set and testing the quality of its work in a <em>validation process</em> is called a <em>validation procedure</em> .  But this is not all - in addition to the choice of a validation procedure (which, by the way, may change during experiments), it is also necessary to choose a method for assessing the quality of prediction with the available experimental results.  Namely, a function that will take the corresponding two arrays as input and will give an assessment of how well the predictions correspond to the experiment.  Such a function is called <em>a quality metric</em> and in its actual situations it often depends much more on choosing than on what algorithm we choose and how we will tune it.  Without going into the details of this fine process, we will use the Root Mean Squared Logarithic Error (RMSLE) proposed by the organizers. <br><br>  So, the fundamental issues are resolved and we can start writing the code that loads the data and trains our algorithm.  In order to test the base pipeline, we divide the sample into training and validation parts in the 70/30 ratio, we use two simple features and one of the simplest algorithms - linear regression. <br><br>  We write the basic function to load the data and check its performance: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> list_of_instances = [] list_of_labels = [] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'./data/competition_data/train_set.csv'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> input_stream: header_line = input_stream.readline() columns = header_line.strip().split(<span class="hljs-string"><span class="hljs-string">','</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> input_stream: new_instance = dict(zip(columns[:<span class="hljs-number"><span class="hljs-number">-1</span></span>], line.split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[:<span class="hljs-number"><span class="hljs-number">-1</span></span>])) new_label = float(line.split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[<span class="hljs-number"><span class="hljs-number">-1</span></span>]) list_of_instances.append(new_instance) list_of_labels.append(new_label) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list_of_instances, list_of_labels &gt;&gt;&gt; list_of_instances, list_of_labels = load_data() &gt;&gt;&gt; print(len(list_of_instances), len(list_of_labels)) <span class="hljs-number"><span class="hljs-number">30213</span></span> <span class="hljs-number"><span class="hljs-number">30213</span></span> &gt;&gt;&gt; print(list_of_instances[:<span class="hljs-number"><span class="hljs-number">3</span></span>]) [{<span class="hljs-string"><span class="hljs-string">'annual_usage'</span></span>: <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'quote_date'</span></span>: <span class="hljs-string"><span class="hljs-string">'2013-07-07'</span></span>, <span class="hljs-string"><span class="hljs-string">'tube_assembly_id'</span></span>: <span class="hljs-string"><span class="hljs-string">'TA-00002'</span></span>, <span class="hljs-string"><span class="hljs-string">'min_order_quantity'</span></span>: <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'bracket_pricing'</span></span>: <span class="hljs-string"><span class="hljs-string">'Yes'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span>: <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-string"><span class="hljs-string">'supplier'</span></span>: <span class="hljs-string"><span class="hljs-string">'S-0066'</span></span>}, {<span class="hljs-string"><span class="hljs-string">'annual_usage'</span></span>: <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'quote_date'</span></span>: <span class="hljs-string"><span class="hljs-string">'2013-07-07'</span></span>, <span class="hljs-string"><span class="hljs-string">'tube_assembly_id'</span></span>: <span class="hljs-string"><span class="hljs-string">'TA-00002'</span></span>, <span class="hljs-string"><span class="hljs-string">'min_order_quantity'</span></span>: <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'bracket_pricing'</span></span>: <span class="hljs-string"><span class="hljs-string">'Yes'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span>: <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-string"><span class="hljs-string">'supplier'</span></span>: <span class="hljs-string"><span class="hljs-string">'S-0066'</span></span>}, {<span class="hljs-string"><span class="hljs-string">'annual_usage'</span></span>: <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'quote_date'</span></span>: <span class="hljs-string"><span class="hljs-string">'2013-07-07'</span></span>, <span class="hljs-string"><span class="hljs-string">'tube_assembly_id'</span></span>: <span class="hljs-string"><span class="hljs-string">'TA-00002'</span></span>, <span class="hljs-string"><span class="hljs-string">'min_order_quantity'</span></span>: <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'bracket_pricing'</span></span>: <span class="hljs-string"><span class="hljs-string">'Yes'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span>: <span class="hljs-string"><span class="hljs-string">'5'</span></span>, <span class="hljs-string"><span class="hljs-string">'supplier'</span></span>: <span class="hljs-string"><span class="hljs-string">'S-0066'</span></span>}] &gt;&gt;&gt; print(list_of_labels[:<span class="hljs-number"><span class="hljs-number">3</span></span>]) [<span class="hljs-number"><span class="hljs-number">21.9059330191461</span></span>, <span class="hljs-number"><span class="hljs-number">12.3412139792904</span></span>, <span class="hljs-number"><span class="hljs-number">6.60182614356538</span></span>]</code> </pre><br>  The results are in line with expectations.  Now we will write the preparation of a function that translates objects (instances) into feature models (samples). <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_bracket_pricing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> instance[<span class="hljs-string"><span class="hljs-string">'bracket_pricing'</span></span>] == <span class="hljs-string"><span class="hljs-string">'Yes'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> instance[<span class="hljs-string"><span class="hljs-string">'bracket_pricing'</span></span>] == <span class="hljs-string"><span class="hljs-string">'No'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> ValueError <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_quantity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [int(instance[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>])] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_sample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> is_bracket_pricing(instance) + get_quantity(instance) &gt;&gt;&gt; print(list(map(to_sample, list_of_instances[:<span class="hljs-number"><span class="hljs-number">3</span></span>]))) [[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>], [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]]</code> </pre><br>  Later, when there are a lot of different features, they will all move to the features.py file specially reserved for this, where they will be overgrown with variations, auxiliary functions, and in some particularly neglected cases - also with unit tests. <br><br>  Now, in principle, we already have everything necessary to train the first, simplest model of machine learning.  A small (but important) point - we agreed that we will be optimized for the metric proposed in the contest condition <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>R</mi><mi>M</mi><mi>S</mi><mi>L</mi><mi>E</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>q</mi><mi>r</mi><mi>t</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mn>1</mn><mi>n</mi><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>p</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x2212;</mo><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>a</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>)</mo><msup><mo stretchy=&quot;false&quot;>)</mo><mn>2</mn></msup></mrow><mo>,</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="61.443ex" height="3.262ex" viewBox="0 -987.6 26454.6 1404.6" role="img" focusable="false" style="vertical-align: -0.969ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-52" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-4D" x="759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-53" x="1811" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-4C" x="2456" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-45" x="3138" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-3D" x="4180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-73" x="5486" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-71" x="5956" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-72" x="6416" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-74" x="6868" y="0"></use><g transform="translate(7229,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-66" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-72" x="800" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-61" x="1252" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-63" x="1781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-31" x="2215" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-6E" x="2715" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-73" x="3566" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-75" x="4035" y="0"></use><g transform="translate(4608,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-6E" x="1242" y="499"></use><g transform="translate(878,-308)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-31" x="1124" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-28" x="6735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-6C" x="7374" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-6F" x="7673" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-67" x="8158" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-28" x="8639" y="0"></use><g transform="translate(9028,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-69" x="712" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-2B" x="10098" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-31" x="11099" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-29" x="11599" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-2212" x="12211" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-6C" x="13462" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-6F" x="13760" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-67" x="14246" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-28" x="14726" y="0"></use><g transform="translate(15116,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-2B" x="16212" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-31" x="17213" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-29" x="17713" y="0"></use><g transform="translate(18103,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-32" x="550" y="583"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-2C" x="26176" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>R</mi><mi>M</mi><mi>S</mi><mi>L</mi><mi>E</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>s</mi><mi>q</mi><mi>r</mi><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mn>1</mn><mi>n</mi><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>‚àí</mo><mtext>&nbsp;</mtext><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><mo>,</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> RMSLE = \ sqrt {\ frac1n \ sum_ {i = 1} ^ n (\ log (p_i + 1) - \ log (a_i + 1)) ^ 2}, </script></p>  Where <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>p</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.059ex" height="1.817ex" viewBox="-38.5 -520.7 886.3 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-69" x="712" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-2"> p_i </script>  - the predicted value of the model, and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>a</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.029ex" height="1.817ex" viewBox="0 -520.7 873.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-69" x="748" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>a</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-3"> a_i </script>  - actual.  In order for our efforts to select features and model settings to more closely match this goal, apply the function to labels. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.175ex" height="2.66ex" viewBox="0 -832 7825.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-28" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-78" x="940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-29" x="1512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-3D" x="2179" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-6C" x="3486" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-6F" x="3784" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-67" x="4270" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-28" x="4750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMATHI-78" x="5140" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-2B" x="5934" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-31" x="6935" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/351074/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgokRw21OgBV-4zFIhDEs4pIuVPiA#MJMAIN-29" x="7436" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>&nbsp;</mtext><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-4"> f (x) = \ log (x + 1) </script>  .  The fact is that most of the regression machine learning methods are designed to minimize the square error (MSE) - and it is to the optimization of such a quality metric that we reduce our task by applying the above function to the labels. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> math <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_interim_label</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(label)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> math.log(label + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_final_label</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(interim_label)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> math.exp(interim_label) - <span class="hljs-number"><span class="hljs-number">1</span></span> &gt;&gt;&gt; print(to_final_label(to_interim_label(<span class="hljs-number"><span class="hljs-number">42</span></span>))) <span class="hljs-number"><span class="hljs-number">42.0</span></span></code> </pre><br>  It seems that we were not mistaken with the transition functions from the original labels to more convenient ones for optimization and vice versa, and these functions are indeed reciprocal.  Now we initialize the model and train it on the received feature-guides and intermediate labels. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>model = LinearRegression() &gt;&gt;&gt; list_of_samples = list(map(to_sample, list_of_instances)) &gt;&gt;&gt; TRAIN_SAMPLES_NUM = <span class="hljs-number"><span class="hljs-number">20000</span></span> &gt;&gt;&gt; train_samples = list_of_samples[:TRAIN_SAMPLES_NUM] &gt;&gt;&gt; train_labels = list_of_labels[:TRAIN_SAMPLES_NUM] &gt;&gt;&gt; model.fit(train_samples, train_labels)</code> </pre><br>  Now the model is trained and we can check how well it works by comparing the result of its prediction and the actual values ‚Äã‚Äãon the validation sample. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>validation_samples = list_of_samples[TRAIN_SAMPLES_NUM:] &gt;&gt;&gt; validation_labels = list(map(to_interim_label, list_of_labels[TRAIN_SAMPLES_NUM:])) &gt;&gt;&gt; squared_errors = [] &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> sample, label <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> zip(validation_samples, validation_labels): &gt;&gt;&gt; prediction = model.predict(numpy.array(sample).reshape(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>))[<span class="hljs-number"><span class="hljs-number">0</span></span>] &gt;&gt;&gt; squared_errors.append((prediction - label) ** <span class="hljs-number"><span class="hljs-number">2</span></span>) &gt;&gt;&gt; mean_squared_error = sum(squared_errors) / len(squared_errors) &gt;&gt;&gt; print(<span class="hljs-string"><span class="hljs-string">'Mean Squared Error: {0}'</span></span>.format(mean_squared_error)) Mean Squared Error: <span class="hljs-number"><span class="hljs-number">0.8251727558694294</span></span></code> </pre><br>  Is the resulting error small or small?  A priori, it is impossible to say, but given the fact that we use only two features and one of the simplest models, most likely our prediction is far from optimal.  Let's try to experiment, for example by adding new features.  For example, in the base data file, in addition to the two fields already used (bracket_pricing and quantity), there is a field min_order_quantity (even if the values ‚Äã‚Äãare not very often different from 0).  Let's try to use its value as a new feature for learning the algorithm. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_min_order_quantity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [int(instance[<span class="hljs-string"><span class="hljs-string">'min_order_quantity'</span></span>])] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_sample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (is_bracket_pricing(instance) + get_quantity(instance) + get_min_order_quantity(instance)) Mean Squared Error: <span class="hljs-number"><span class="hljs-number">0.8234554779286141</span></span></code> </pre><br>  As you can see, the error has decreased slightly, which means our algorithm has improved.  We will not stop there and add one more feature after another. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_annual_usage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [int(instance[<span class="hljs-string"><span class="hljs-string">'annual_usage'</span></span>])] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_sample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (is_bracket_pricing(instance) + get_quantity(instance) + get_min_order_quantity(instance) + get_annual_usage(instance)) Mean Squared Error: <span class="hljs-number"><span class="hljs-number">0.8227852260998361</span></span></code> </pre><br>  The next unused field, quote_date, does not have a simple interpretation as a number or a set of numbers of fixed length.  So you have to think a little about how to use its value as a numeric input for the algorithm.  Of course, both year and month and day can help as a new feature, but the most logical first approximation is the number of days starting from a certain date ‚Äî for example, from January 1, the zero year, as the day that arrived before the earliest date in the file.  In the first approximation, it is still possible to calculate that there are always 365 days in a year, and 30 months in each of the 12 months. And let the seeming mathematical incorrectness of this assumption do not confuse us - we can always clarify the formulas later and see if the corresponding feature will improve the prediction quality by validation sample. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_absolute_date</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-number"><span class="hljs-number">365</span></span> * int(instance[<span class="hljs-string"><span class="hljs-string">'quote_date'</span></span>].split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]) + <span class="hljs-number"><span class="hljs-number">12</span></span> * int(instance[<span class="hljs-string"><span class="hljs-string">'quote_date'</span></span>].split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>]) + int(instance[<span class="hljs-string"><span class="hljs-string">'quote_date'</span></span>].split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)[<span class="hljs-number"><span class="hljs-number">2</span></span>])] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_sample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (is_bracket_pricing(instance) + get_quantity(instance) + get_min_order_quantity(instance) + get_annual_usage(instance) + get_absolute_date(instance)) Mean Squared Error: <span class="hljs-number"><span class="hljs-number">0.8216646342919645</span></span></code> </pre><br>  As you can see, even a not quite mathematically and astronomically correct feature nevertheless helped to improve the quality of the prediction of our model.  We now turn to the new type of features contained in the tube_assembly_id and supplier fields.  Each of these fields contains the values ‚Äã‚Äãof the identifiers of the manufacturer and vendor.  They have not binary and not quantitative nature, but describe the type of object from a fixed list.  In machine learning, such properties of objects and their corresponding features are <em>categorical</em> .  However, the category of the manufacturer itself is unlikely to help us, since they are not repeated in the test_set.csv file, and we absolutely correctly divided the marked sample so that there is (practically) no corresponding intersection between the training and validation parts.  Nevertheless, let us try to extract something useful from the value of the supplier field.  Let's first see what the corresponding codes are found in the file with marked data. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'./data/competition_data/train_set.csv'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> input_stream: ... header_line = input_stream.readline() ... suppliers = set() ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> input_stream: ... new_supplier = line.split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>] ... suppliers.add(new_supplier) ... &gt;&gt;&gt; print(len(suppliers)) <span class="hljs-number"><span class="hljs-number">57</span></span> &gt;&gt;&gt; print(suppliers) {<span class="hljs-string"><span class="hljs-string">'S-0058'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0013'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0050'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0011'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0070'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0104'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0012'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0068'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0041'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0023'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0092'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0095'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0029'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0051'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0111'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0064'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0005'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0096'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0062'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0004'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0059'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0031'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0078'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0106'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0060'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0090'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0072'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0105'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0087'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0080'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0061'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0108'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0042'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0027'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0074'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0081'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0025'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0024'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0030'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0022'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0014'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0054'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0015'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0008'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0007'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0009'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0056'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0026'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0107'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0066'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0018'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0109'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0043'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0046'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0003'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0006'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0097'</span></span>}</code> </pre><br>  As we see, there are not so many of them.  For a start, you can try to do the simplest standard for such cases, namely, to compare each value of the field array with one unit, standing in place of the corresponding identifier and all other values ‚Äã‚Äãequal to 0. <br><br><pre> <code class="python hljs">SUPPLIERS_LIST = [<span class="hljs-string"><span class="hljs-string">'S-0058'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0013'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0050'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0011'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0070'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0104'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0012'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0068'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0041'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0023'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0092'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0095'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0029'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0051'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0111'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0064'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0005'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0096'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0062'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0004'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0059'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0031'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0078'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0106'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0060'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0090'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0072'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0105'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0087'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0080'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0061'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0108'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0042'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0027'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0074'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0081'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0025'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0024'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0030'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0022'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0014'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0054'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0015'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0008'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0007'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0009'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0056'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0026'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0107'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0066'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0018'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0109'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0043'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0046'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0003'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0006'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0097'</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_supplier</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> instance[<span class="hljs-string"><span class="hljs-string">'supplier'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> SUPPLIERS_LIST: supplier_index = SUPPLIERS_LIST.index(instance[<span class="hljs-string"><span class="hljs-string">'supplier'</span></span>]) result = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * supplier_index + [<span class="hljs-number"><span class="hljs-number">1</span></span>] + [<span class="hljs-number"><span class="hljs-number">0</span></span>] * (len(SUPPLIERS_LIST) - supplier_index - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: result = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * len(SUPPLIERS_LIST) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_sample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (is_bracket_pricing(instance) + get_quantity(instance) + get_min_order_quantity(instance) + get_annual_usage(instance) + get_absolute_date(instance) + get_supplier(instance)) Mean Squared Error: <span class="hljs-number"><span class="hljs-number">0.7992338454746866</span></span></code> </pre><br>  As we see, there was a significant reduction in the average error.  Most likely this means that the value of the field that we added contains valuable information for the algorithm and it is worth trying to use it later several more times, but in some less banal way.  We have already discussed that the tube_assembly field is unlikely to help us directly, but you should still try to check it experimentally. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_assembly</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> assembly_id = int(instance[<span class="hljs-string"><span class="hljs-string">'tube_assembly_id'</span></span>].split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>]) result = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * assembly_id + [<span class="hljs-number"><span class="hljs-number">1</span></span>] + [<span class="hljs-number"><span class="hljs-number">0</span></span>] * (<span class="hljs-number"><span class="hljs-number">25000</span></span> - assembly_id - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_sample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (is_bracket_pricing(instance) + get_quantity(instance) + get_min_order_quantity(instance) + get_annual_usage(instance) + get_absolute_date(instance) + get_supplier(instance) + get_assembly(instance))</code> </pre><br>  Of course, a specific way of converting a manufacturer's identifier into a feature lector looks somewhat awkward, especially considering the number of possible values, however, if the reader has a more constructive use of this field directly and without additional data, you can discuss it in the comments and even try to apply it within code currently available.  And we recall that in addition to the main file with the training sample, we have several other files with auxiliary data and try to experiment with their involvement.  For example, so that we are not very offended by the relative (albeit predictable) failure with the direct use of the tube_assembly_id field value, we can try to take revenge using the data contained in the specs.csv file and describing the corresponding specifiers in the anonymized form. <br><br><pre> <code class="bash hljs">head data/competition_data/specs.csv -n 20 tube_assembly_id,spec1,spec2,spec3,spec4,spec5,spec6,spec7,spec8,spec9,spec10 TA-00001,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00002,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00003,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00004,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00005,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00006,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00007,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00008,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00009,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00010,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00011,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00012,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00013,SP-0004,SP-0069,SP-0080,NA,NA,NA,NA,NA,NA,NA TA-00014,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00015,SP-0063,SP-0069,SP-0080,NA,NA,NA,NA,NA,NA,NA TA-00016,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00017,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00018,SP-0007,SP-0058,SP-0070,SP-0080,NA,NA,NA,NA,NA,NA TA-00019,SP-0080,NA,NA,NA,NA,NA,NA,NA,NA,NA</code> </pre><br>  It seems that there is a simple enumeration of qualifiers corresponding to each value.  Accordingly, it seems reasonable to choose an array of ones and zeros as a fichevector, in which the units are in positions that correspond to the existing specifiers, and zeros to the rest.  In order to use the data from the additional file, we will have to make a small change in the code structure. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_assembly_specs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance, assembly_to_specs)</span></span></span><span class="hljs-function">:</span></span> result = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> spec <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> assembly_to_specs[instance[<span class="hljs-string"><span class="hljs-string">'tube_assembly_id'</span></span>]]: result[int(spec.split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>])] = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_sample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance, additional_data)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (is_bracket_pricing(instance) + get_quantity(instance) + get_min_order_quantity(instance) + get_annual_usage(instance) + get_absolute_date(instance) + get_supplier(instance) + get_assembly_specs(instance, additional_data[<span class="hljs-string"><span class="hljs-string">'assembly_to_specs'</span></span>])) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_additional_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> result = dict() assembly_to_specs = dict() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'data/competition_data/specs.csv'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> input_stream: header_line = input_stream.readline() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> input_stream: tube_assembly_id = line.split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] specs = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> spec <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> line.strip().split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>:]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> spec != <span class="hljs-string"><span class="hljs-string">'NA'</span></span>: specs.append(spec) assembly_to_specs[tube_assembly_id] = specs result[<span class="hljs-string"><span class="hljs-string">'assembly_to_specs'</span></span>] = assembly_to_specs <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result additional_data = load_additional_data() list_of_samples = list(map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x:to_sample(x, additional_data), list_of_instances)) Mean Squared Error: <span class="hljs-number"><span class="hljs-number">0.7754770419953809</span></span></code> </pre><br>  Our works were not in vain and the target metric improved by 0.024, which is not bad at the current stage.  On this, perhaps, for the time being it is possible to stop with the optimization of the algorithm and discuss the question of simply providing a convenient API to the trained algorithms for an application programmer. <br><br>  First, save the trained model to disk. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'./data/model.mdl'</span></span>, <span class="hljs-string"><span class="hljs-string">'wb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> output_stream: output_stream.write(pickle.dumps(model))</code> </pre><br>  Now we will create a generate_response.py script, in which we will use the results obtained earlier. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pickle <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> research <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FinalModel</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, model, to_sample, additional_data)</span></span></span><span class="hljs-function">:</span></span> self._model = model self._to_sample = to_sample self._additional_data = additional_data <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._model.predict(numpy.array(self._to_sample( instance, self._additional_data)).reshape(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>))[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'./data/model.mdl'</span></span>, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> input_stream: model = pickle.loads(input_stream.read()) additional_data = research.load_additional_data() final_model = FinalModel(model, research.to_sample, additional_data) print(final_model.process({<span class="hljs-string"><span class="hljs-string">'tube_assembly_id'</span></span>:<span class="hljs-string"><span class="hljs-string">'TA-00001'</span></span>, <span class="hljs-string"><span class="hljs-string">'supplier'</span></span>:<span class="hljs-string"><span class="hljs-string">'S-0066'</span></span>, <span class="hljs-string"><span class="hljs-string">'quote_date'</span></span>:<span class="hljs-string"><span class="hljs-string">'2013-06-23'</span></span>, <span class="hljs-string"><span class="hljs-string">'annual_usage'</span></span>:<span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'min_order_quantity'</span></span>:<span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'bracket_pricing'</span></span>:<span class="hljs-string"><span class="hljs-string">'Yes'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span>:<span class="hljs-string"><span class="hljs-string">'1'</span></span>})) <span class="hljs-number"><span class="hljs-number">2.357692493326624</span></span></code> </pre><br>  Now, in the same way, an application programmer can load the model and accompanying variables in any script and use it to predict values ‚Äã‚Äãon new incoming data. <br><br>  In the next series - further optimization of the model, more features, more complex algorithms and setting up their hyperparameters, if necessary - advanced validation procedures. </div><p>Source: <a href="https://habr.com/ru/post/351074/">https://habr.com/ru/post/351074/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351060/index.html">We write Telegram-bot on Go to search Wikipedia</a></li>
<li><a href="../351062/index.html">Hell of a bare iron programming</a></li>
<li><a href="../351068/index.html">Program for digitizing graphs, drawings, drawings: algorithms for the project ‚ÄúTutor: Mathematics‚Äù</a></li>
<li><a href="../351070/index.html">Unexpected earnings difficulties on the Internet</a></li>
<li><a href="../351072/index.html">Password change: 10 steps to good implementation</a></li>
<li><a href="../351078/index.html">Performance and runtime at the JPoint 2018 conference</a></li>
<li><a href="../351080/index.html">Accelerate javascript build using webpack 2-3</a></li>
<li><a href="../351082/index.html">Operating systems from scratch; Level 1 (younger half)</a></li>
<li><a href="../351084/index.html">Google leanback - big brother care</a></li>
<li><a href="../351086/index.html">Calculation of the timing and cost of projects: how is this done and is it possible to simplify the process?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>