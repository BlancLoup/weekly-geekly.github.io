<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GitHub, website and automatic test site creation from the latest source code version</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will talk about how to automatically get the latest version of the source code from the main branch of your repository and deploy from it...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GitHub, website and automatic test site creation from the latest source code version</h1><div class="post__text post__text-html js-mediator-article">  This article will talk about how to automatically get the latest version of the source code from the main branch of your repository and deploy from it a project on a virtual hosting.  Just want to note that I met GitHub and Git only yesterday.  Therefore, this article may seem trivial to an experienced web programmer.  And I hope that will help those who are just starting their way as a web programmer. <br><br><a name="habracut"></a><br><h4>  Introduction </h4><br>  I have a small website on a virtual hosting.  It does not have full shell access and scripts are limited in some rights.  For example, I cannot use the PHP <i>system</i> function and the <i>file_get_contents</i> function.  After I created the repository on GitHub, learned to work a bit with the changes and updated the source code, it was time to think about what to do next.  I wanted to see my changes in action, but at the same time so that the main site continued to work. <br><br>  Of the scripting languages ‚Äã‚Äãavailable to me, I only know PHP.  The choice on what to write was made automatically.  I understood that my script should somehow receive update notifications from GitHub and download the source code.  I decided to make a subdomain of <i>development.mysite.com</i> and post the latest version of the source code there.  In addition, I have a website configuration file with passwords for the database, which I did not share on GitHub.  This file must be added to the downloaded sources for it to work. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thus, the whole process can be divided into the following steps: <br><ul><li>  figure out how to get notifications from GitHub; </li><li>  download source codes; </li><li>  make the necessary changes with them. </li></ul><br><br><h4>  Notifications from GitHub </h4><br>  Everything is quite simple here.  GitHub supports hooks.  We register the address of our script in the <i>Post-Receive URLs</i> and that's it.  It will be called at each change of the main repository branch.  Read more about this on the <a href="http://help.github.com/post-receive-hooks/">GitHub</a> site (in English).  In this case, in my script, I do not process information about the last transaction (commit). <br><br><h4>  Download source </h4><br>  The developer has two options for downloading the code: <br><ul><li>  use GitHub API; </li><li>  Download an archived version of the main branch. </li></ul><br><br><h5>  Github API </h5><br>  Using the program interfaces you can get information about the last commit.  It contains the <i>Tree SHA</i> ID.  This identifier allows you to consistently get a list and contents of all project files. <br><br>  An example of using the GitHub API for PHP is <a href="http://davidwalsh.name/github-markdown">described in the blog of David Volsh</a> .  Take some useful features from there and add your own.  Let's start writing our script.  First of all the parameters <br><blockquote><ol><li> <code><font color="black">&lt;?php <font color="#008000">/* static settings */</font> $user = <font color="#A31515">'&lt;github_username&gt;'</font> ; $repo = <font color="#A31515">'&lt;github_reponame&gt;'</font> ; $user_repo = $user . <font color="#A31515">'/'</font> . $repo; $tree_base_url = <font color="#A31515">"http://github.com/api/v2/json/tree/show/"</font> . $user_repo; <font color="#008000">// path on the server where your repository will go</font> $stage_dir = $_SERVER[ <font color="#A31515">'DOCUMENT_ROOT'</font> ] . dirname($_SERVER[ <font color="#A31515">'SCRIPT_NAME'</font> ]); ?&gt;</font></code> </li> <li> <code><font color="black"><font color="#008000">&lt;?php /* static settings */ $user = <font color="#A31515">'&lt;github_username&gt;'</font> ; $repo = <font color="#A31515">'&lt;github_reponame&gt;'</font> ; $user_repo = $user . <font color="#A31515">'/'</font> . $repo; $tree_base_url = <font color="#A31515">"http://github.com/api/v2/json/tree/show/"</font> . $user_repo; <font color="#008000">// path on the server where your repository will go</font> $stage_dir = $_SERVER[ <font color="#A31515">'DOCUMENT_ROOT'</font> ] . dirname($_SERVER[ <font color="#A31515">'SCRIPT_NAME'</font> ]); ?&gt;</font></font></code> </li> <li> <code><font color="black">&lt;?php <font color="#008000">/* static settings */</font> $user = <font color="#A31515">'&lt;github_username&gt;'</font> ; $repo = <font color="#A31515">'&lt;github_reponame&gt;'</font> ; $user_repo = $user . <font color="#A31515">'/'</font> . $repo; $tree_base_url = <font color="#A31515">"http://github.com/api/v2/json/tree/show/"</font> . $user_repo; <font color="#008000">// path on the server where your repository will go</font> $stage_dir = $_SERVER[ <font color="#A31515">'DOCUMENT_ROOT'</font> ] . dirname($_SERVER[ <font color="#A31515">'SCRIPT_NAME'</font> ]); ?&gt;</font></code> </li> <li> <code><font color="black">&lt;?php <font color="#008000">/* static settings */</font> $user = <font color="#A31515">'&lt;github_username&gt;'</font> ; $repo = <font color="#A31515">'&lt;github_reponame&gt;'</font> ; $user_repo = $user . <font color="#A31515">'/'</font> . $repo; $tree_base_url = <font color="#A31515">"http://github.com/api/v2/json/tree/show/"</font> . $user_repo; <font color="#008000">// path on the server where your repository will go</font> $stage_dir = $_SERVER[ <font color="#A31515">'DOCUMENT_ROOT'</font> ] . dirname($_SERVER[ <font color="#A31515">'SCRIPT_NAME'</font> ]); ?&gt;</font></code> </li> <li> <code><font color="black">&lt;?php <font color="#008000">/* static settings */</font> $user = <font color="#A31515">'&lt;github_username&gt;'</font> ; $repo = <font color="#A31515">'&lt;github_reponame&gt;'</font> ; $user_repo = $user . <font color="#A31515">'/'</font> . $repo; $tree_base_url = <font color="#A31515">"http://github.com/api/v2/json/tree/show/"</font> . $user_repo; <font color="#008000">// path on the server where your repository will go</font> $stage_dir = $_SERVER[ <font color="#A31515">'DOCUMENT_ROOT'</font> ] . dirname($_SERVER[ <font color="#A31515">'SCRIPT_NAME'</font> ]); ?&gt;</font></code> </li> <li> <code><font color="black">&lt;?php <font color="#008000">/* static settings */</font> $user = <font color="#A31515">'&lt;github_username&gt;'</font> ; $repo = <font color="#A31515">'&lt;github_reponame&gt;'</font> ; $user_repo = $user . <font color="#A31515">'/'</font> . $repo; $tree_base_url = <font color="#A31515">"http://github.com/api/v2/json/tree/show/"</font> . $user_repo; <font color="#008000">// path on the server where your repository will go</font> $stage_dir = $_SERVER[ <font color="#A31515">'DOCUMENT_ROOT'</font> ] . dirname($_SERVER[ <font color="#A31515">'SCRIPT_NAME'</font> ]); ?&gt;</font></code> </li> <li></li><li> <code><font color="black"><font color="#008000">&lt;?php <font color="#008000">/* static settings */</font> $user = <font color="#A31515">'&lt;github_username&gt;'</font> ; $repo = <font color="#A31515">'&lt;github_reponame&gt;'</font> ; $user_repo = $user . <font color="#A31515">'/'</font> . $repo; $tree_base_url = <font color="#A31515">"http://github.com/api/v2/json/tree/show/"</font> . $user_repo; // path on the server where your repository will go $stage_dir = $_SERVER[ <font color="#A31515">'DOCUMENT_ROOT'</font> ] . dirname($_SERVER[ <font color="#A31515">'SCRIPT_NAME'</font> ]); ?&gt;</font></font></code> </li> <li> <code><font color="black">&lt;?php <font color="#008000">/* static settings */</font> $user = <font color="#A31515">'&lt;github_username&gt;'</font> ; $repo = <font color="#A31515">'&lt;github_reponame&gt;'</font> ; $user_repo = $user . <font color="#A31515">'/'</font> . $repo; $tree_base_url = <font color="#A31515">"http://github.com/api/v2/json/tree/show/"</font> . $user_repo; <font color="#008000">// path on the server where your repository will go</font> $stage_dir = $_SERVER[ <font color="#A31515">'DOCUMENT_ROOT'</font> ] . dirname($_SERVER[ <font color="#A31515">'SCRIPT_NAME'</font> ]); ?&gt;</font></code> </li> <li> <code><font color="black">&lt;?php <font color="#008000">/* static settings */</font> $user = <font color="#A31515">'&lt;github_username&gt;'</font> ; $repo = <font color="#A31515">'&lt;github_reponame&gt;'</font> ; $user_repo = $user . <font color="#A31515">'/'</font> . $repo; $tree_base_url = <font color="#A31515">"http://github.com/api/v2/json/tree/show/"</font> . $user_repo; <font color="#008000">// path on the server where your repository will go</font> $stage_dir = $_SERVER[ <font color="#A31515">'DOCUMENT_ROOT'</font> ] . dirname($_SERVER[ <font color="#A31515">'SCRIPT_NAME'</font> ]); ?&gt;</font></code> </li> </ol></blockquote><br><br>  A copy of the source code will be created in the directory where our script is located.  Next, insert the function to retrieve the data at the address, peeped from David: <br><blockquote><ol><li>  &lt;? php </li><li>  <font color="#008000">/ * gets url * /</font> </li><li>  <font color="#0000ff">function</font> get_content_from_github ($ url) </li><li>  { </li><li>  $ ch = curl_init (); </li><li>  curl_setopt ($ ch, CURLOPT_URL, $ url); </li><li>  curl_setopt ($ ch, CURLOPT_RETURNTRANSFER, 1); </li><li>  curl_setopt ($ ch, CURLOPT_CONNECTTIMEOUT, 1); </li><li>  echo <font color="#A31515">"Getting: {$ url}"</font> ; </li><li>  $ content = curl_exec ($ ch); </li><li>  curl_close ($ ch); </li><li>  <font color="#0000ff">return</font> $ content; </li><li>  } </li><li>  ?&gt; </li></ol></blockquote><br><br>  Then comes the function that finds the <i>Tree SHA</i> and starts downloading files: <br><blockquote><ol><li>  &lt;? php </li><li>  <font color="#0000ff">function</font> get_repo_json () </li><li>  { </li><li>  global $ user, $ repo, $ user_repo, $ tree_base_url, $ stage_dir; </li><li></li><li>  $ json = array (); </li><li>  $ list_commits_url = <font color="#A31515">'http://github.com/api/v2/json/commits/list/'</font> .  $ user_repo.  <font color="#A31515">'/ master'</font> ; </li><li></li><li>  echo <font color="#A31515">"Master branch url: {$ list_commits_url} \ n &lt;br&gt;"</font> ; </li><li>  $ json [ <font color="#A31515">'commit'</font> ] = json_decode (get_content_from_github ($ list_commits_url), <font color="#0000ff">true</font> ); </li><li></li><li>  <font color="#008000">// get sha for the latest tree</font> </li><li>  $ tree_sha = $ json [ <font color="#A31515">'commit'</font> ] [ <font color="#A31515">'commits'</font> ] [0] [ <font color="#A31515">'tree'</font> ]; </li><li>  echo <font color="#A31515">"Tree sha: {$ tree_sha} \ n &lt;br&gt;"</font> ; </li><li>  $ cont_str = $ tree_base_url.  <font color="#A31515">"/ {$ tree_sha}"</font> ; </li><li>  $ <font color="#0000ff">base</font> = json_decode (get_content_from_github ($ cont_str), <font color="#0000ff">true</font> ); </li><li></li><li>  <font color="#008000">// output project structure</font> </li><li>  echo <font color="#A31515">"&lt;pre&gt;"</font> ; </li><li>  get_repo ($ <font color="#0000ff">base</font> [ <font color="#A31515">'tree'</font> ], 0, $ stage_dir); </li><li>  echo <font color="#A31515">"&lt;/ pre&gt;"</font> ; </li><li>  } </li><li>  ?&gt; </li></ol></blockquote><br><br>  This function calls the <i>get_repo</i> function, which recursively passes through all the directories of the project. <br><blockquote><ol><li>  &lt;? php </li><li>  <font color="#0000ff">function</font> get_repo ($ objects, $ level = 0, $ current_dir) </li><li>  { </li><li>  global $ tree_base_url, $ user_repo; </li><li></li><li>  chdir ($ current_dir); </li><li></li><li>  <font color="#0000ff">foreach</font> ($ objects <font color="#0000ff">as</font> &amp; $ <font color="#0000ff">object</font> ) </li><li>  { </li><li>  $ type = $ <font color="#0000ff">object</font> [ <font color="#A31515">'type'</font> ]; </li><li>  $ sha = $ <font color="#0000ff">object</font> [ <font color="#A31515">'sha'</font> ]; </li><li>  $ name = $ <font color="#0000ff">object</font> [ <font color="#A31515">'name'</font> ]; </li><li></li><li>  <font color="#008000">// add padding</font> </li><li>  echo str_pad ( <font color="#A31515">""</font> , $ level, <font color="#A31515">"\ t"</font> ); </li><li>  echo $ name.  <font color="#A31515">"\ n"</font> ; </li><li></li><li>  <font color="#0000ff">if</font> (strcmp ($ type, <font color="#A31515">"tree"</font> ) == 0) </li><li>  { </li><li>  mkdir ($ name); </li><li></li><li>  $ new_dir = $ current_dir.  <font color="#A31515">'/'</font> .  $ name; </li><li></li><li>  $ tree = $ tree_base_url.  <font color="#A31515">'/'</font> .  $ sha; </li><li>  $ new_objects = json_decode (get_content_from_github ($ tree), <font color="#0000ff">true</font> ); </li><li></li><li>  get_repo ($ new_objects [ <font color="#A31515">'tree'</font> ], $ level + 1, $ new_dir); </li><li></li><li>  <font color="#008000">// change current directory back</font> </li><li>  chdir ($ current_dir); </li><li>  } </li><li>  <font color="#0000ff">else</font> </li><li>  { </li><li>  <font color="#008000">// get file content</font> </li><li>  $ blob_url = <font color="#A31515">"http://github.com/api/v2/json/blob/show/"</font> .  $ user_repo.  <font color="#A31515">"/"</font> .  $ sha; </li><li>  $ data = get_content_from_github ($ blob_url); </li><li></li><li>  $ filename = $ current_dir.  <font color="#A31515">'/'</font> .  $ name; </li><li>  file_put_contents ($ filename, $ data); </li><li>  } </li><li>  } </li><li>  } </li><li>  ?&gt; </li></ol></blockquote><br><br>  It is worth noting that we immediately receive the contents of the file, without any additional information.  Therefore, we do not need to call the <i>json_decode</i> function as in the cases with calls to other API functions. <br><br><h6>  Results of getting source code via API </h6><br>  This script has two significant drawbacks: <br><ul><li>  it works quite slowly; </li><li>  I never managed to download the entire project.  CURL ends on timeout, the whole process stops without downloading a third of the source files. </li></ul><br>  In addition, the very idea of ‚Äã‚Äãpumping a project on individual files seems ideologically incorrect. <br><br><h5>  Archive with the main branch of the project </h5><br>  Having poked at the GitHub buttons, I discovered the ability to download an archived version of the source files.  This approach is much better!  You can download a choice of either a Zip archive or Tar.  My choice fell on Zip, because it is easier to unpack it on a shared hosting.  Let's look at the script. <br><blockquote><ol><li>  &lt;? php </li><li>  $ download = <font color="#0000ff">true</font> ; </li><li>  $ unzip = <font color="#0000ff">true</font> ; </li><li>  $ move = <font color="#0000ff">true</font> ; </li><li></li><li>  $ stage_dir = $ _SERVER [ <font color="#A31515">'DOCUMENT_ROOT'</font> ].  dirname ($ _ SERVER [ <font color="#A31515">'SCRIPT_NAME'</font> ]); </li><li>  $ filepath = $ stage_dir.  <font color="#A31515">'/'</font> .  <font color="#A31515">'master.zip'</font> ; </li><li></li><li>  echo <font color="#A31515">"&lt;pre&gt;"</font> ; </li><li>  ?&gt; </li></ol></blockquote><br><br>  The variables <i>download</i> , <i>unzip</i> and <i>move</i> control the program flow and allow you to disable its parts.  They can be used for debugging.  For example, if the archive is already downloaded, but not unpacked, then there is no point in downloading it again. <br><blockquote><ol><li>  &lt;? php </li><li>  <font color="#0000ff">if</font> ($ download) </li><li>  { </li><li>  $ url = <font color="#A31515">"http://github.com/&lt;your_github_username&gt;/&lt;your_github_repo_name&gt;/zipball/master"</font> ; </li><li></li><li>  $ ch = curl_init (); </li><li>  curl_setopt ($ ch, CURLOPT_URL, $ url); </li><li>  curl_setopt ($ ch, CURLOPT_RETURNTRANSFER, 1); </li><li>  curl_setopt ($ ch, CURLOPT_CONNECTTIMEOUT, 1); </li><li>  echo <font color="#A31515">"Getting: {$ url} \ n"</font> ; </li><li>  $ content = curl_exec ($ ch); </li><li>  echo <font color="#A31515">"Got \" {$ content} \ "\ n"</font> ; </li><li>  curl_close ($ ch); </li><li></li><li>  $ dom = <font color="#0000ff">new</font> DOMDocument (); </li><li>  @ $ dom-&gt; loadHTML ($ content); </li><li></li><li>  $ xpath = <font color="#0000ff">new</font> DOMXPath ($ dom); </li><li>  $ hrefs = $ xpath-&gt; evaluate ( <font color="#A31515">"/ html / body // a"</font> ); </li><li></li><li>  $ href = $ hrefs-&gt; item (0); </li><li>  $ zipurl = $ href-&gt; getAttribute ( <font color="#A31515">'href'</font> ); </li><li>  echo <font color="#A31515">"Zip url: {$ zipurl} \ n"</font> ; </li><li></li><li>  $ data = http_get_file ($ zipurl); </li><li>  <font color="#0000ff">if</font> (substr ($ data, <font color="#A31515">"http: //"</font> )) </li><li>  { </li><li>  $ data = http_get_file ($ data); </li><li>  } </li><li></li><li>  file_put_contents ($ filepath, $ data); </li><li>  } </li><li>  ?&gt; </li></ol></blockquote><br><br>  GitHub makes several redirects that for some reason are not executed with CURL.  Therefore, with the help of it we find the address of the first redirect, then we try to go through it.  We get another redirect address and finally get to the coveted archive.  The <i>http_get_file</i> function used in the code above: <br><blockquote><ol><li>  &lt;? php </li><li>  <font color="#0000ff">function</font> http_get_file ($ url) </li><li>  { </li><li>  $ url_stuff = parse_url ($ url); </li><li>  $ port = isset ($ url_stuff [ <font color="#A31515">'port'</font> ])?  $ url_stuff [ <font color="#A31515">'port'</font> ]: 80; </li><li></li><li>  $ path = $ url_stuff [ <font color="#A31515">'path'</font> ]; </li><li>  $ last = $ path [strlen ($ path) -1]; </li><li>  <font color="#0000ff">if</font> (strcmp ($ last, <font color="#A31515">"_"</font> ) == 0) </li><li>  { </li><li>  $ path = substr_replace ($ path, <font color="#A31515">""</font> , -1); </li><li>  } </li><li></li><li>  $ fp = fsockopen ($ url_stuff [ <font color="#A31515">'host'</font> ], $ port); </li><li></li><li>  $ query = <font color="#A31515">'GET'</font> .  $ path.  <font color="#A31515">"HTTP / 1.0 \ n"</font> ; </li><li>  $ query. = <font color="#A31515">'Host:'</font> .  $ url_stuff [ <font color="#A31515">'host'</font> ]; </li><li>  $ query. = <font color="#A31515">"\ n \ n"</font> ; </li><li></li><li>  fwrite ($ fp, $ query); </li><li></li><li>  <font color="#0000ff">while</font> ($ line = fread ($ fp, 1024)) </li><li>  { </li><li>  $ buffer. = $ line; </li><li>  } </li><li>  <font color="#0000ff">if</font> (preg_match ( <font color="#A31515">'/ ^ Location: (. +?) $ / m'</font> , $ buffer, $ matches)) </li><li>  { </li><li>  <font color="#0000ff">return</font> $ matches [1]; </li><li>  } </li><li></li><li>  preg_match ( <font color="#A31515">'/ Content-Length: ([0-9] +) /'</font> , $ buffer, $ parts); </li><li>  <font color="#0000ff">return</font> substr ($ buffer, - $ parts [1]); </li><li>  } </li><li>  ?&gt; </li></ol></blockquote><br><br>  Found a strange functionality.  After the <i>parse_url</i> function is executed, the <i>underscore</i> is added to the end of the file name at the last address pointing to the real archive. <br><br>  Unpack the archive: <br><blockquote><ol><li>  &lt;? php </li><li>  <font color="#0000ff">if</font> ($ unzip) </li><li>  { </li><li>  echo <font color="#A31515">"Uncompressing archive ... \ n"</font> ; </li><li>  $ zip = <font color="#0000ff">new</font> ZipArchive; </li><li>  $ res = $ zip-&gt; open ($ filepath); </li><li>  <font color="#0000ff">if</font> ($ res === TRUE) </li><li>  { </li><li>  $ zip-&gt; extractTo ($ stage_dir); </li><li>  $ zip-&gt; close (); </li><li>  echo <font color="#A31515">"Done! \ n"</font> ; </li><li>  } <font color="#0000ff">else</font> </li><li>  { </li><li>  echo <font color="#A31515">"Failed \ n"</font> ; </li><li>  exit (1); </li><li>  } </li><li>  } </li><li>  ?&gt; </li></ol></blockquote><br><br>  Inside the archive we are waiting for a folder with the name consisting of the user name, the repository name and a piece of SHA code of the commit.  And inside this folder are the project files.  I have a <i>code</i> folder.  The next step is to move the <i>code</i> folder up one level.  This is necessary in order to properly display the subdomain.  The subdomain is configured, for example, to the <i>/ public_html / development</i> folder.  The archive is unpacked in <i>/ public_html / development / &lt;user&gt; _ &lt;repo&gt; _ &lt;sha&gt; / &lt;files&gt;</i> . <br><blockquote><ol><li>  &lt;? php </li><li>  <font color="#0000ff">if</font> ($ move) </li><li>  { </li><li>  $ files = scandir ($ stage_dir); </li><li>  $ match_array = preg_grep ( <font color="#A31515">'/ &lt;user_name&gt; * /'</font> , $ files); </li><li>  <font color="#0000ff">if</font> (is_array ($ match_array)) </li><li>  { </li><li>  <font color="#008000">// remove all directory if any</font> </li><li>  delete_directory ( <font color="#A31515">"code"</font> ); </li><li>  $ dir_name = current ($ match_array); </li><li>  $ rep_dir = $ dir_name.  <font color="#A31515">"/ code"</font> ; </li><li>  echo <font color="#A31515">"Try to move {$ rep_dir} to code \ n"</font> ; </li><li>  rename ($ rep_dir, <font color="#A31515">"code"</font> ); </li><li>  rmdir ($ dir_name); </li><li>  echo <font color="#A31515">"Done moving files \ n"</font> ; </li><li>  } </li><li>  } </li><li></li><li>  <font color="#0000ff">function</font> delete_directory ($ dirname) </li><li>  { </li><li>  <font color="#0000ff">if</font> (is_dir ($ dirname)) </li><li>  $ dir_handle = opendir ($ dirname); </li><li>  <font color="#0000ff">if</font> (! $ dir_handle) </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; </li><li>  <font color="#0000ff">while</font> ($ file = readdir ($ dir_handle)) </li><li>  { </li><li>  <font color="#0000ff">if</font> ($ file! = <font color="#A31515">"."</font> &amp;&amp; $ file! = <font color="#A31515">".."</font> ) </li><li>  { </li><li>  <font color="#0000ff">if</font> (! is_dir ($ dirname. <font color="#A31515">"/"</font> . $ file)) </li><li>  unlink ($ dirname. <font color="#A31515">"/"</font> . $ file); </li><li>  <font color="#0000ff">else</font> </li><li>  delete_directory ($ dirname. <font color="#A31515">'/'</font> . $ file); </li><li>  } </li><li>  } </li><li>  closedir ($ dir_handle); </li><li>  rmdir ($ dirname); </li><li>  } </li><li>  ?&gt; </li></ol></blockquote><br><br>  And finally, I copy the configuration file, which is located in the <i>/ public_html / development /</i> folder <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  &lt;? php </li><li>  copy ( <font color="#A31515">"config.php"</font> , <font color="#A31515">"&lt;new_path&gt; /core.php"</font> ); </li><li>  echo <font color="#A31515">"All jobs have been done! \ n"</font> ; </li><li>  echo <font color="#A31515">"&lt;/ pre&gt;"</font> ; </li><li>  ?&gt; </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br><h6>  Script results downloading archived source code </h6><br>  The script does what you need!  =) <br><br><h4>  Conclusion </h4><br>  This article reviewed approaches to creating a test software environment for a website, the source code of which is stored in the GitHub system.  The proposed approaches in the future can be combined.  First create a complete copy of the repository by downloading the archive, and then keep track of which files were changed in the last commit and update only them. <br><br>  The solution I used to create a test software environment may not be ideal.  I am very interested to know how other people do it.  Share your knowledge! <br><br>  PS This article was published with the support of <a href="https://geektimes.ru/users/dive/" class="user_link">dive</a> 'habrauser, who sent me an invite.  Thank! </div><p>Source: <a href="https://habr.com/ru/post/83235/">https://habr.com/ru/post/83235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../83227/index.html">News went to the iPhone</a></li>
<li><a href="../83228/index.html">Xerox PARC</a></li>
<li><a href="../83230/index.html">Thoughts on computer voice control</a></li>
<li><a href="../83232/index.html">Crazy idea of ‚Äã‚Äãglobal intetization or Internet communism using google and android</a></li>
<li><a href="../83233/index.html">The architecture of the program on the example of the communicator</a></li>
<li><a href="../83236/index.html">Samsung M100S - communicator on the operating system Android 2.1</a></li>
<li><a href="../83237/index.html">In defense of the gravity and color differentiation of pants ...</a></li>
<li><a href="../83238/index.html">Microsoft Creative Destruction</a></li>
<li><a href="../83239/index.html">Seven startups per week on the Sharepoint 2010 platform</a></li>
<li><a href="../83240/index.html">Laser modem 1+ Gbit / s to replace WiFi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>