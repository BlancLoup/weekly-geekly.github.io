<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Backspace Invaders or how to connect a 64x64 LED display to Arduino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="4095 LEDs and all-all-all 

 Surprisingly, the ATmega328 controller, which underlies the Arduino Uno, handles the display of the image on such a displ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Backspace Invaders or how to connect a 64x64 LED display to Arduino</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ac0/20d/905/ac020d905fcf46f8a7458d999c31a514.jpg"><br>  <i><font color="999999">4095 LEDs and all-all-all</font></i> <br><br>  Surprisingly, the ATmega328 controller, which underlies the Arduino Uno, handles the display of the image on such a display.  From this all turned out "pocket" console (weighing several kilograms), in which the game is stitched based on the Space Invaders.  Plans to come up with something else, because the free memory is left full. <br><br>  Under the cat you can read about how such a display is arranged and how it can be controlled. <br><a name="habracut"></a><br>  Sometimes, instead of finding <a href="https://vk.com/album782822_104271587">old computers in a collection</a> , I make them myself from <a href="https://habrahabr.ru/post/318500/">scrap materials</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This time I wanted to do something compact with a resolution at the level of consoles and computers of the early 80s.  True, the display at 64x64 pixels does not reach the Atari 2600, but by as much as 64 pixels more than the display of the Nokia 3310, where the games were also.  So it should have been enough for a margin of at least for a comfortable game of Tetris or Pong. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/86b/dbc/720/86bdbc720d954c949f82749a98c1d080.gif"></div><br>  In addition to the display, I got a board that is compatible with the Arduino Uno, and began to think as if now with all this good to take off. <br><br>  <a href="https://www.adafruit.com/">Adafruit</a> sells such displays and you can find <a href="https://learn.adafruit.com/category/led-matrix">examples of</a> their use on its website.  There is also a link to the <a href="https://github.com/adafruit/RGB-matrix-Panel">library</a> to work with them.  The library supports Arduino Uno and Arduino Mega. <br><br>  This library organizes video memory, where it stores the colors of the pixels.  The user program repaints these pixels, and the image is displayed in the timer interrupt handler.  With small displays it works well, but in my case this method is not suitable.  Even if you allocate half a byte for each pixel (one bit for R, G, B, and one extra bit), then for the 64x64 matrix you will need 2 kilobytes of memory.  And this is all that ATmega328P has.  You can, of course, take the processor more powerful, but this is not the Jedi way. <br><br>  After all, who makes us keep all the lines of the screen at once?  You can re-evaluate each line before displaying it.  For primitive graphics from several sprites, these calculations should not take too much time, so everything should work. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/6a2/bd1/86f/6a2bd186f3ff491d96f2dfe91a218b92.jpg"></div><br>  It was in the <s>woods of the</s> summer computer school, it was too lazy to search for documentation on the microcircuits and to trace the board in order to understand what it is connected to.  Therefore, I selected the algorithm for working with the display from the libraries I downloaded in advance: <br><br><ul><li>  We expose on the inputs of the display the output line address </li><li>  Fill the array with colors of pixels of sprites that intersect with the current line </li><li>  Push all the pixels one by one into the shift register that controls the LEDs </li><li>  We snap the data and submit them to the outputs of the registers </li></ul><br>  As a result, an array with the size of only four lines of the screen is allocated for video memory.  Why four?  This is because at the same time we push the data in two lines - because the matrix has two groups of inputs: R1 / G1 / B1 and R2 / G2 / B2.  They control two lines that are 16 pixels apart. <br><br>  But then why not two lines, but four?  It turns out that the 64x64 matrix consists of two independent 32x64 matrices.  It would be possible to connect individual processor outputs to each, but the ATmega328 does not have enough of them.  Fortunately, the caring manufacturer provided for the cascading of these matrices - the output of the shift register of one can be connected to the input of the other.  Then a 32x128 logical matrix will be obtained, which is physically displayed as 64x64.  That is, in each phase we need to push two lines of 128 pixels into the registers - and this is the 4 lines of the physical screen. <br><br><img src="https://habrastorage.org/files/763/7d6/366/7637d6366a1540558e603b704ff247b6.png"><br><br>  We made a prototype of the console during the summer computer school.  The first game was something that remotely resembled <a href="https://github.com/Dovgalyuk/BackspaceInvaders">Space Invaders</a> . <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/gy7oADJboqM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  In reality, the LEDs are very much burned eyes.  Adjusting their brightness with the help of PWM is unlikely to succeed - the performance of the ATmega is not enough.  We must take some kind of ARM or FPGA. <br><br>  The final version I designed in a wooden case.  The screen is protected by sanded plexiglass.  Due to the scattering of light, the eyes are no longer burned, but now it‚Äôs more difficult to remove the console‚Äôs video work - the whole image becomes blurred. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/x_SeKeACu_A" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  The whole program uses 1101 bytes (53%) of RAM and 6432 (19%) bytes of ROM.  There is still a place to make a few games and a menu to select them. <br><br>  <b>Links</b> <br><br><ol><li>  Project sources: <a href="https://github.com/Dovgalyuk/BackspaceInvaders">github.com/Dovgalyuk/BackspaceInvaders</a> </li><li>  Description of the matrix on the site adafruit: <a href="https://learn.adafruit.com/32x16-32x32-rgb-led-matrix">learn.adafruit.com/32x16-32x32-rgb-led-matrix</a> </li><li>  Adafruit library for matrix management: <a href="https://github.com/adafruit/RGB-matrix-Panel">github.com/adafruit/RGB-matrix-Panel</a> </li><li>  Adafruit library for drawing graphic primitives: <a href="https://github.com/adafruit/Adafruit-GFX-Library">github.com/adafruit/Adafruit-GFX-Library</a> </li><li>  A similar project on a more powerful processor: <a href="https://learn.adafruit.com/ledgames-beaglebone-black-64x64-led-game/overview">learn.adafruit.com/ledgames-beaglebone-black-64x64-led-game/overview</a> </li><li>  An article about managing a smaller display: <a href="https://geektimes.ru/post/275548/">geektimes.ru/post/275548</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/403231/">https://habr.com/ru/post/403231/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../403219/index.html">We invite you to the game room on April 23</a></li>
<li><a href="../403221/index.html">The most symmetrical objects in the world</a></li>
<li><a href="../403225/index.html">Information Philosophy, Part 1</a></li>
<li><a href="../403227/index.html">We go down - we grow up, or axis Z for cheap</a></li>
<li><a href="../403229/index.html">Computer card games: streamers that are worth paying attention to</a></li>
<li><a href="../403233/index.html">NASA: Enceladus has all the conditions for the emergence and maintenance of life</a></li>
<li><a href="../403235/index.html">The second is more interesting than the first: a note on the new scales Xiaomi</a></li>
<li><a href="../403237/index.html">Adding SDM-220 counter to OpenHab</a></li>
<li><a href="../403239/index.html">WiFi radio WOLNA. How to create a small startup</a></li>
<li><a href="../403241/index.html">Ask Ethan: How does dark matter interact with black holes?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>