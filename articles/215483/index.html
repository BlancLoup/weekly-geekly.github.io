<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Programming ARM7 controllers in Eclipse: how it is done. v2.0</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I once wrote an article about programming controllers in Eclipse , but this was done under Ubuntu and without the help of toolchain. Now I will tell y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Programming ARM7 controllers in Eclipse: how it is done. v2.0</h1><div class="post__text post__text-html js-mediator-article">  I once wrote an article <a href="http://habrahabr.ru/post/174195/">about programming controllers in Eclipse</a> , but this was done under Ubuntu and without the help of toolchain.  Now I will tell you how to do this using the toolchain and under Windows. <br>  So, I had: Eclipse installed for Java, a board with an AT91SAM7X512 controller, Atmel's SAM-ICE module, and evil bosses as motivation. <br><a name="habracut"></a><br><br><h5>  Install / reinstall Eclipse IDE </h5><br>  The first thing we do is install Eclipse and everything you need into it.  The latest current version is Eclipse Kepler.  If it is not installed, go <a href="https://www.eclipse.org/downloads/">here</a> and download the Eclipse IDE for C / C ++ Developers, then unpack it in a convenient place. <br><br>  If Eclipse is already installed (in my case Eclipse IDE for Java Developers), then launch it, choose a convenient place for us to workpace, where all the projects will lie, go to the <b>Help ‚áí Install New Software</b> menu and in the " <b>Work with ...</b> "choose" Kepler - <a href="http://download.eclipse.org/releases/kepler">download.eclipse.org/releases/kepler</a> ".  We will open a list of what is on this source.  Expand the " <b>Programming language</b> " node, tick the " <b>C / C ++ Development Tools</b> ", then expand the " <b>Mobile and Device Development</b> " node, tick the " <b>C / C ++ GDB Hardware Debugging</b> ", click " <b>Next</b> " and " <b>Finish</b> ".  After installation, Eclipse will restart. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In case you downloaded the Eclipse IDE for C / C ++ Developers, reinstall the C / C ++ GDB Hardware Debugging plugin.  We will need it when debugging, but for now we will install another plugin to support the toolchain. <br><br>  Go back to the <b>Help ‚áí Install New Software</b> menu, click the " <b>Add</b> " button.  In the window that appears, specify any name in the string " <b>Name</b> ", and in the string " <b>Location</b> " indicate the following: <br> <code><a href="http://gnuarmeclipse.sourceforge.net/updates"></a> gnuarmeclipse.sourceforge.net/updates</code> <br>  Click " <b>OK</b> ".  We will be shown a huge list of what is in this source from a whole one component - the " <b>CDT GNU Cross Development Tools</b> ".  We put a tick on it, click " <b>Next</b> " and " <b>Finish</b> ".  During installation, do not pay attention to Warning and feel free to click on OK.  After installation, Eclipse will restart. <br>  Voila, that's all.  Go ahead. <br><br><h5>  Install the compiler </h5><br>  Go <a href="https://sourcery.mentor.com/GNUToolchain/subscription3053%3Flite%3Darm%26lite%3DARM%26signature%3D4-1330864567-0-e3ad3089427f58b2a4a8bdf30f5fb0fb4ae5e79f">here</a> and download the Sourcery CodeBench Lite Edition installer.  At the moment, the latest version 2013.11-24.  The installation is simple, the only thing to focus on - be sure to check the box ‚Äú <b>Change PATH variable</b> ‚Äù.  After installation, restart the machine. <br>  To verify the installation, in the command line, execute the command: <br>  <code>arm-none-eabi-gcc -v</code> . <br>  It should show us a detailed description of the entire toolkit and a version of the compiler.  On this with the compiler everything. <br><br><h5>  Create a skeleton project </h5><br>  Run Eclipse, go to the menu " <b>File-&gt; New-&gt; C Project</b> ".  A project creation window will appear.  We give it a name, in the ‚Äú <b>Project type</b> ‚Äù tree, select the project type ‚Äú <b>ARM Cross Target Application -&gt; Empty Project</b> ‚Äù, and select Sourcery from the toolchains.  Click Finish. <br><br>  There is a project, now we need a Startup file and linker scripts for debug configuration and for flashing to the controller. <br>  Go <a href="http://www.atmel.com/tools/at91samsoftwarepackage.aspx">here</a> and download the archive "AT91SAM7X-EK Software Package for IAR 5.2, Keil and GNU".  In it, we go along the path / at91sam7x-ek / packages / and choose any project whose name ends in gnu.  We follow this path / project_name / at91lib / boards / at91sam7x-ek, <b>pick up the</b> file <b>board_cstartup.S</b> from here, <b>pick the</b> files <b>AT91sam7x512.h</b> , <b>sram.lds</b> , <b>flash.lds</b> from the folder <b>at91sam7x512</b> and copy all this. in one folder. <br><br>  Go to Eclipse again.  There we right-click on our project and select " <b>Import</b> ", in the window that appears, select <b>General-&gt; File System</b> , click Next.  Select the folder where you copied the files board_cstartup, sram and flash, put a tick on these files and click <b>Finish</b> .  Voila, the files appeared in our project. <br><br>  Now you need a little fix .lds files.  Bring them to this form: <br><br><div class="spoiler">  <b class="spoiler_title">sram.lds</b> <div class="spoiler_text">  OUTPUT_FORMAT ("elf32-littlearm", "elf32-littlearm", "elf32-littlearm") <br>  OUTPUT_ARCH (arm) <br>  ENTRY (entry) <br><br>  MEMORY <br>  { <br>  sram (W! RX): ORIGIN = 0x200000, LENGTH = 0x20000 <br>  flash (RX): ORIGIN = 0x000000, LENGTH = 0x80000 <br>  } <br><br>  SECTIONS <br>  { <br>  .  = ALIGN (4); <br>  .fixed: <br>  { <br>  _sfixed =.; <br>  * (. vectors) <br>  * (. ramfunc) <br>  * (. text *) <br>  * (. rodata *) <br>  * (. data) <br>  .  = ALIGN (4); <br>  _efixed =.; <br>  }&gt; sram <br><br>  .relocate: AT (_efixed) <br>  { <br>  .  = ALIGN (4); <br>  _srelocate =.; <br>  .  = ALIGN (4); <br>  _erelocate =.; <br>  } <br><br>  .bss: { <br>  _szero =.; <br>  * (. bss) <br>  * (. bss *) <br>  * (COMMON) <br>  .  = ALIGN (4); <br>  _ezero =.; <br>  }&gt; sram <br><br>  _sstack = 0x220000; <br>  } <br>  end =.; </div></div><br><br><div class="spoiler">  <b class="spoiler_title">flash.lds</b> <div class="spoiler_text">  OUTPUT_FORMAT ("elf32-littlearm", "elf32-littlearm", "elf32-littlearm") <br>  OUTPUT_ARCH (arm) <br>  ENTRY (entry) <br><br>  MEMORY <br>  { <br>  sram (RWX): ORIGIN = 0x200000, LENGTH = 0x20000 <br>  flash (RX): ORIGIN = 0x100000, LENGTH = 0x80000 <br>  } <br><br>  SECTIONS <br>  { <br>  .fixed: <br>  { <br>  .  = ALIGN (4); <br>  _sfixed =.; <br>  * (. vectors) <br>  * (. text *); <br>  * (. rodata *) <br>  _efixed =.; <br>  }&gt; flash <br><br>  .relocate: AT (_efixed) <br>  { <br>  _srelocate =.; <br>  * (. data) <br>  * (. data *) <br>  .  = ALIGN (4); <br>  _erelocate =.; <br>  }&gt; sram <br><br>  .bss: { <br>  _szero =.; <br>  * (. bss) <br>  * (. bss *) <br>  * (COMMON) <br>  .  = ALIGN (4); <br>  _ezero =.; <br>  }&gt; sram <br><br>  _sstack = 0x220000; <br>  } <br>  end =.; </div></div><br>  Skeleton design is ready. <br>  Now you can write code by adding new files through <b>File-&gt; New-&gt; C / C ++ Source File</b> .  I had a project and I just imported it. <br><br><h5>  Project Setup </h5><br>  Now you need to configure the project, for which we go to the <b>Project-&gt; Properties</b> menu or right-click on our project and select <b>Properties</b> there. <br>  In the window that appears, select the item ‚Äú <b>C / C ++ Build-&gt; Setting</b> ‚Äù.  Select the item Configuration in the Configuration field.  Now go through all the settings. <br><br><h6>  Target processor </h6><br><ol><li>  Processor - arm7tdmi </li><li>  Architecture - armv4t </li><li>  Thumb - disabled </li><li>  Thumb interwork - enabled </li><li>  Endianness - Little Endian </li><li>  Float ABI - Library </li><li>  Other target flags: -marm - mlong-calls </li></ol><br><br><h6>  ARM Windows GCC C Compiler - Optimization </h6><br><ol><li>  Pack structure - disabled </li><li>  Short enumeration - disabled </li><li>  Function sections - enabled </li><li>  Data sections - disabled </li></ol><br><br><h6>  ARM Windows GCC C Compiler - Miscellaneous </h6><br><ol><li>  Language Standart - ISO C99 with GNU Extensions </li></ol><br>  The remaining items here do not touch <br><br><h6>  ARM Windows GCC C Linker </h6><br>  In paragraph General: <br><ol><li>  Script File - do not touch yet </li><li>  Do not use standart start files - enabled </li><li>  Do not use default libraries - enabled </li><li>  Remove unused section - enabled </li></ol><br>  The rest - disable <br><br>  In the item Miscellaneous: put a tick on Cross Refereinse. <br><br><h6>  ARM Windows GNU Create Flash Image - Output </h6><br><ol><li>  Output file format - ihex </li></ol><br><br>  Go back to the Debugging tab, and in the Configuration field, select Debug.  We set the Debug level to Maximum, and the Debug format to gdb, click Apply.  Now we switch the configuration to Release, set the Debug level - None and click Apply. <br><br>  Now we‚Äôll go back to ARM Windows GCC C Linker - General, select Debug in the Configuration field, and specify our sram.lds file as the Script file.  Click Apply.  Now we switch the configuration to Release, and we specify the flash.lds file as the Script file and click Apply again.  Everything, project setup is complete.  Now we can enable the required build configuration and build the firmware. <br><br><h5>  We fasten debugging </h5><br>  Go <a href="http://www.segger.com/jlink-software.html%3Fstep%3D1%26file%3DJLink_482">here</a> , enter the serial number of our SAM-ICE, download and install the software package for J-Link.  There is a very important thing here - GDB Server, which is very useful to us for debugging.  Another important thing is JFlash, which allows you to flash our controller without any problems. <br><br>  Create a configuration for running the debug server, for which in Eclipse we go to the menu <b>Run-&gt; External Tools-&gt; External Tools Configurations</b> and double-click on the Program item.  Customize, newly created configuration. <br><br>  Main tab: <br><ol><li>  Name - let's call it something, for example GDB Server </li><li>  Location - specify the path to the recently installed JLink GDB Server, in my case it is C: \ Program Files (x86) \ SEGGER \ JLinkARM_V412 \ JLinkGDBServerCL.exe </li><li>  Working Directory - specify the path to the folder of our project </li><li>  Arguments - we don‚Äôt need any arguments, the JTAG interface is used by default. </li></ol><br><br>  Common tab: <br><ol><li>  We tick the Display in the favorites menu and Launch in background. </li></ol><br><br>  Now create a configuration for running debugging.  Go to the menu <b>Run-&gt; Debug Configurations</b> , in the window that opens, double-click on the <b>GDB Hardware Debugging</b> , which will create a new debugging configuration.  Customizable. <br>  Main tab: <br><ol><li>  C / C ++ Application - specify our application from the Debug folder with the .elf extension </li><li>  Project - we indicate our project. </li><li>  At the bottom of the window, at the level of the Apply and Revert buttons, another hidden setting is hidden, you need to open it before going to the next tab and select " <b>Legacy GDB Hardware Debugging Launcher</b> " </li></ol><br><br>  Debugger tab: <br><ol><li>  GDB Command - specify our debugger arm-none-eabi-gdb.exe </li><li>  Command Set - Standart Windows </li><li>  Protocol Version - mi </li><li>  Use remote target - enabled </li><li>  JTAG Device - Generic TCP / IP </li><li>  Host name or IP adress - localhost </li><li>  Port number - 2331 </li></ol><br><br>  Startup tab: <ol><li>  Reset and Delay - disabled </li><li>  Halt - disabled </li><li>  This is followed by a window in which we specify the following initialization script: <br> <code># connect to the J-Link gdb server</code> <br> <code>target remote localhost:2331</code> <br> <code># Set JTAG speed to 30 kHz</code> <br> <code>monitor endian little</code> <br> <code>monitor speed 30</code> <br> <code># Reset the target</code> <br> <code>monitor reset 8</code> <br> <code>monitor sleep 10</code> <br> <code># Change mapping, putting RAM at addr. 0</code> <br> <code>monitor long 0xFFFFFF00 = 0x00000001</code> <br> <code># Setup GDB for faster downloads</code> <br> <code>set remote memory-write-packet-size 1024</code> <br> <code>set remote memory-write-packet-size fixed</code> <br> <code>monitor speed 12000</code> <br> <code>break main</code> <br> <code>load</code> <br> </li><li>  Load image - enabled, use project binary </li><li>  Load symbols - enabled, use project binary </li><li>  Symbol offset - do not set </li><li>  Set program counter at - disabled </li><li>  Set breakpoint at - disabled </li><li>  Resume - disabled </li><li>  Run command - empty </li></ol><br><br>  Common tab: <br><ol><li>  We tick the Display in the favorites menu, Allocate console and Launch in background. </li></ol><br><br>  All is ready.  Now, for debugging, we connect SAM-ICE to the USB port of our machine and to the board with the controller, build our project, start the GDB server, and then launch the debug configuration itself. <br><br>  As a result, we received a free IDE for programming and debugging applications for ARM controllers, to replace, say, the same IAR.  Our Eclipse, of course, is somewhat inferior in terms of debugging - it is not possible to view the register values ‚Äã‚Äãof peripheral devices, such as SPI or timers-counters. <br><br>  On the <a href="http://www.segger.com/">SEGGER</a> website, <a href="http://www.segger.com/">you</a> can see that there is a version of the GDB server for Linux.  I suspect that in the same simple way with some changes you can organize and debugging, for example, under Ubuntu. <br>  Good luck to everyone in programming matters! <br>  PS If you have noticed an inaccuracy or know a way to improve this technique - write in the comments, I will be glad to advice and constructive criticism. </div><p>Source: <a href="https://habr.com/ru/post/215483/">https://habr.com/ru/post/215483/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../215471/index.html">The dark story of a Linux user experience with Windows 8</a></li>
<li><a href="../215475/index.html">There was a duel between Timo Boll (Timo Boll) and the Kuka robot</a></li>
<li><a href="../215477/index.html">iOS Development Gems in AppCode</a></li>
<li><a href="../215479/index.html">Opportunities of Global Service Delivery Centers Fujitsu (Global Delivery Centers) on the example of the Russian GDC</a></li>
<li><a href="../215481/index.html">Growth Hacking: How to earn more, using metrics correctly</a></li>
<li><a href="../215487/index.html">Educational and learning resources for web developers and web designers</a></li>
<li><a href="../215493/index.html">Eddie Osmani‚Äôs translation of Patterns for Scalable JavaScript Applications Completed</a></li>
<li><a href="../215499/index.html">New conference for those in the .NET world</a></li>
<li><a href="../215501/index.html">Sony and Panasonic announced the "heir" of Blu-ray</a></li>
<li><a href="../215505/index.html">New successful test Morpheus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>