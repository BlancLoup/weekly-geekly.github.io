<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About the division of labor and its consequences</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few years ago we had a chance to take part in the development of a gas meter. At the time of the start of work with the customer, he already had som...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About the division of labor and its consequences</h1><div class="post__text post__text-html js-mediator-article">  A few years ago we had a chance to take part in the development of a gas meter.  At the time of the start of work with the customer, he already had some work.  And these developments have seemed to us a very interesting example to demonstrate the consequences of an unsuccessful division of labor according to competencies.  Under the cut, we will describe why the separation was unsuccessful, and how we solved the problems that arose as a result. <br><a name="habracut"></a><br>  Three specialists took part in the development of a gas meter (in fact, more, but within the framework of the article we are only interested in three competencies).  These were: <br><br><ol><li>  Design Engineer, Part-time Metrology Specialist </li><li>  Circuit Designer </li><li>  Programmer </li></ol><br>  The designer provided a device that generates a signal for opening and closing a special valve.  He looked like this: <br><br><img src="https://habrastorage.org/files/3c7/61c/211/3c761c2114574639adb0a584f93ebddb.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It was necessary to measure the time the valve was in the open state (distance from A to B), and the frequency of valve opening. <br><br>  Of course, it is not possible to process such a signal directly by the microcontroller, so the circuit engineer was tasked with developing an intermediate converter that generates the following signal: <br><br><img src="https://habrastorage.org/files/712/c3a/130/712c3a130a7f41df985158a556db42ac.png"><br><br>  The device will run on battery, so most of the time the microcontroller will be in Sleep Mode.  Therefore, the programmer asked to send a signal to the Interrupt pin, set the microcontroller to wake up by the interrupt from the corresponding port, and in the interrupt handler performed the timer start / stop. <br><br>  Everything looks good so far, each specialist did his job and did it efficiently.  Only here the quality of the device as a whole did not suit anyone.  At a constant expense, the device gave readings with considerable variation and it was completely unclear what the reason was. <br><br><h4>  Why did this happen? </h4><br>  Incorrect operation of the flow meter found at an early stage of development.  Such mistakes happen and there is nothing to worry about.  Scary is another, no one knew where the error and how to find it. <br><br>  The reasons for the lack of accuracy of the flow meter could be: <br><br><ol><li>  Errors in valve design and input generator </li><li>  Errors in the input signal conversion circuit </li><li>  Software bugs </li></ol><br>  In addition, the developers did not have complete confidence that the problem exists in principle, because the characteristics of the flow meter were determined using a reference bench, which was developed in parallel with the flow meter and was also far from ideal. <br><br>  As a result, sooner or later we get a situation where each team member, being confident in the impeccability of the results of his work, crumbles a loaf on his neighbor.  Whereas the top management perceives the project entirely and displeasedly with the whole team.  The team originate conflicts, loud controversy, disunity.  The designer declares that there is an error in the program, the programmer says that an error in the design of the valve, etc. <br><br><h4>  What to do? </h4><br>  The development of the flow meter is much more complicated and the customer decided to attract new specialists.  So we got to work. <br><br>  We saw two ways to solve the problem: <br><br><ol><li>  Total testing and acceptance of each team member </li><li>  Orchestra Man </li></ol><br>  The first option looks pretty standard and very popular in software development.  For example, to check the software, we buy or develop a precision signal generator generated at the output of the converter, feed it to the microcontroller and compare its readings in various conditions with the readings of the generator.  The solution is not the cheapest and, sometimes, far from being the fastest, but quite working. <br><br>  The performance and quality of the input converter can also be assessed using a good and correctly tuned oscilloscope.  Or develop a special device for analyzing the conversion. <br><br>  But to check the operation of the valve is much more difficult, you need to submit a fixed flow, convert the valve signal and measure the signal using a specialized frequency meter.  In fact, this is not much different from the flow meter that we already had. <br><br>  Unfortunately, our customer was not ready to go this way, he needed a more elegant solution, especially since he could not develop a successful algorithm for checking the valve and signal generator. <br><br>  Therefore, the customer was provided with an employee who has competence in both circuit design and programming with metrology.  His task was to analyze the situation as a whole and save the team from the possibility of blaming each other. <br><br>  Look under the hood.  And now our human orchestra began to analyze the project.  The analysis began with an input converter: <br><br><img src="https://habrastorage.org/files/b81/c0c/67e/b81c0c67eb2d413993d163e27dd2385a.png"><br><br>  The original of the scheme has not been preserved, but the essence of it can be caught in the picture.  As you can see, the circuit is built on a trigger (4013) and optocouplers.  False alarms are eliminated with the help of Zener diode D1 and RC-chains. <br><br>  The circuit quite well converts the input signal from the valve.  But when it was built, the circuit designer did not take into account the ultimate goal and the specifics of the signal. <br><br>  The essence of the problem was that when setting the task of the circuitry, he was given the oscillogram of the input signal and the expected output type.  According to the oscillogram, the circuit technician could not see that the steepness of the key fronts A and B would be insufficient to ensure stable and timely operation of the optocouplers.  In fact, the use of comparators was necessary for the transformation scheme to work correctly.  Circuit design is not very happy with this solution, since  Comparators will complicate the scheme and will certainly give more consumption.  In many ways, this concern is connected with the habit of solving the tasks set exclusively in circuit design, not cooperating with the programmer and not using the capabilities of the microcontroller. <br><br>  With the program, too, everything was not smooth.  On the one hand, if the microcontroller is awake all the time, it receives interrupts and instantly starts / stops the timer.  However, it was worthwhile to turn on the power saving mode, how the strange began.  Looking into the microcontroller datasheet, we found that the microcontroller waking up time depends on many factors, and this significantly affected the accuracy of measurements.  The start and stop of the timer lagged far behind the input signal.  The programmer knew that the wake-up time is comparable to the time the valve is in the open state, but he expected that it would only lead to a uniform displacement of the timer start / stop relative to the input signal.  In fact, we received a significant variation in the readings of the energy-saving and waking microcontrollers.  For a metrologist, this problem would be obvious, but he did not participate in software development, because  did not have such expertise. <br><br>  Valve operation analysis failed.  It was difficult or impossible to test the valve and evaluate its operation without conversion and measurement of its signal.  We decided to deal with problems in the converter and the program, get a measuring and computing unit that will not cause us doubts and test the valve using the obtained unit. <br><br><h3>  Orchestra Man </h3><br>  Having understood the project as a whole, we started to solve obvious problems.  The easiest way to solve a software problem was to start and stop the timer.  On the microcontroller we used, there was a Gate-controlled timer that could be started and stopped in hardware, before the microcontroller wakes up and, if necessary, even without waking it up.  If a programmer were interested in metrology, he would have found such a solution himself long ago and tried to implement it.  But often programmers are only interested in programming.  In addition, there were two more factors that significantly influenced the adoption of unsuccessful decisions by the programmer: <br><br><ol><li>  The programmer did not work in active power saving mode.  He simply did not encounter the problem of slow waking up the microcontroller and the effects manifested in this connection. </li><li>  The programmer was already working with the Gate-controlled timer and was faced with the fact that he simply does not work.  So on all subsequent projects, he avoided this function and was afraid of it as a fire.  As it turned out, not all programmers read Errata and track revisions of microcontrollers.  In the early revisions of the microcontroller, this function really did not work. </li></ol><br>  Along the way, we have affected the accuracy of the input signal conversion.  For us it was obvious the need to move from optocouplers to comparators.  The customer was worried about the problem of increasing consumption, he had already heard about it from his circuit engineering.  Circuit engineer was well versed in his subject area, but he didn‚Äôt even think about the functionality of the microcontroller used in the project.  Not only did the microcontroller already contain two comparators, it also turned out that one of them would be enough for us, we will simply switch the lower and upper levels of the reference voltage programmatically, without using additional external switches.  Considering that low power consumption was one of the key advantages of the microcontroller we used, the comparator cost us very cheap (about 8 ¬µA).  And the high input resistance of the comparator made it possible to make a set of reference voltages quite inexpensive in consumption (no more than 10 ŒºA).  As a result, we have a pretty simple input signal processing scheme: <br><br><img src="https://habrastorage.org/files/75b/fbe/56c/75bfbe56cfec44fbae8fe04fa4187bfc.png"><br><br>  Since  The signal comes from the valve, both positive and negative, we shift it using resistors R1 and R2.  Divider R3-R5 we set the reference voltage.  As the battery voltage decreases, the reference voltages and the offset to R1 and R2 will decrease synchronously, so this will have little effect on the accuracy of the signal conversion. <br><br>  To start and stop the timer through the use of gate-control technology, our microcontroller generates signals for opening and closing the gate using a comparator at the hardware level without exiting sleep mode.  RC chains are eliminated, since we can programmatically control the gate using the RA5 port of the microcontroller.  The comparator output is connected to the trigger CLK input.  The comparator voltage reference is switched programmatically (either C12IN0- or C12IN1- is connected, depending on whether we expect the valve to open or close). <br><br><h3>  What is the result? </h3><br>  Having developed our own signal conversion circuit and our microcontroller firmware, we significantly increased the accuracy of gas flow measurement.  We also helped the flow meter designer.  Now he could easily notice flaws in the operation of the valve and signal generator, and he did not have to think that the problem was not on his side.  Even if he had any questions, he had someone to discuss with them, because  we could always describe the signal conversion and measurement algorithm from the metrology point of view and, if necessary, correct something. <br><br>  The division of tasks according to competences allows the team members to achieve a very high level of development in their fields, but sooner or later we come to the conclusion that specialists no longer understand each other.  In this situation, it is very useful to have a person at hand who is knowledgeable in all areas related to the project.  It may not be as good as any specialist individually, but able to see the whole picture.  Also, the experience of this project has shown that such a specialist has a very positive effect on the interaction of specialists, cultivates the interest of engineers in working with each other.  The programmer and the circuit designer began to think more often about measurement errors, the circuit designer discovered new possibilities for using the microcontroller periphery, the designer metrologist began to trust his colleagues and actively use the results of their work for analyzing the hardware. <br>  I would also like to draw attention to the fact that having superficial knowledge in a wide range of areas, the person orchestra at the interview stage does not look attractive from the point of view of both the programmer and the metrologist and circuit design.  But in fact, he can play a key role in a difficult situation. </div><p>Source: <a href="https://habr.com/ru/post/308090/">https://habr.com/ru/post/308090/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308080/index.html">Website development based on ASP.NET Core and Platformus CMS</a></li>
<li><a href="../308082/index.html">Analysis of the Quran with AI</a></li>
<li><a href="../308084/index.html">SObjectizer: from simple to complex. Part III</a></li>
<li><a href="../308086/index.html">Individual daily limit for outgoing calls (limitation of paid directions)</a></li>
<li><a href="../308088/index.html">Safely use Go language in web programming</a></li>
<li><a href="../308092/index.html">It's time to tell you how I was Beeline for 4 years on Habr√© - and what I learned about Habr during that time</a></li>
<li><a href="../308094/index.html">Training with reinforcements for the smallest</a></li>
<li><a href="../308098/index.html">CsvLogWriter plugin for JMeter</a></li>
<li><a href="../308100/index.html">Trello Clone on Phoenix and React. Parts 4-5</a></li>
<li><a href="../308102/index.html">Development for SailfishOS: menu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>