<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Is it possible to leave Klintsy? (data mining of blablacar.ru)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Parsing blablacar.ru website and analyzing passenger traffic from Klintsy, Bryansk region using the R programming language. 



 Prehistory 


 By the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Is it possible to leave Klintsy? (data mining of blablacar.ru)</h1><div class="post__text post__text-html js-mediator-article"><p>  <i>Parsing blablacar.ru website and analyzing passenger traffic from Klintsy, Bryansk region using the R programming language.</i> </p><br><p><img src="https://habrastorage.org/web/80c/941/e50/80c941e50fd94ebe892defe324da6643.png" alt="image"></p><a name="habracut"></a><br><h2 id="predystoriya">  Prehistory </h2><br><p>  By the will of various circumstances, downshift in a small town of the Bryansk region (Klintsy).  I live, I work, I am interested in cultural rest.  "Where can I go here?" - I ask the locals.  "It is best to go to the station for tickets," clinch benevolently advise. </p><br><p>  I liked the idea, and decided to take one-two-day trips as an escape from worries, choosing Blablakar for this purpose (it‚Äôs more economical to pick up the travel time, you can talk with the driver, more choice of routes). </p><br><p>  In order to better present: where, when, how and for how much you can leave Klintsy, he did a little research.  Results, algorithm, scripts and data are shared in this article. </p><br><h2 id="biblioteki-r">  R libraries </h2><br><p>  The following R libraries were used for the study: </p><br><ul><li>  rvest, Rselenium - data parsing; </li><li>  dplyr, tidyr - data manipulation; </li><li>  ggplot2, ggmap, grid, gridExtra - visualization; </li><li>  forecast, zoo - work with time series; </li><li>  aret, xgboost, mlr - machine learning. </li></ul><br><h2 id="poluchenie-dannyh">  Data acquisition </h2><br><p>  It was not possible to collect data from the site using standard R tools (rvest library).  Blablakar works on JS, which forms dynamic pages depending on the user's request, and the rvest functions do not support them. </p><br><p>  Since I am familiar with web technologies to the extent that I did, I didn‚Äôt understand where and what was on the server and how it tightened up, but chose a simpler, as it seemed to me, solution. </p><br><p>  I installed a Rselenium server on my machine, launched Google Chrome through it, which formed the necessary page and saved the output.  Further the page without problems was parsed by R. </p><br><p>  Blablakar provides data in just two months (713 trips), so this scheme worked fine (since the third, crunching with crutches, the server started up).  However, I am not sure that the algorithm is suitable for parsing more pages - too much time and resources are leaving, many bottlenecks. </p><br><div class="spoiler">  <b class="spoiler_title">Parser script</b> <div class="spoiler_text"><pre><code class="hljs lua">####   #### #  mnth &lt;- <span class="hljs-number"><span class="hljs-number">5</span></span>:<span class="hljs-number"><span class="hljs-number">7</span></span> #  days &lt;- seq(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) #   url.t &lt;- c() urls &lt;- c() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> mnth){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> days){ url &lt;- paste0(<span class="hljs-string"><span class="hljs-string">"https://www.blablacar.ru/poisk-poputchikov/klintcy/#?db="</span></span>, j, <span class="hljs-string"><span class="hljs-string">"/"</span></span>, i, <span class="hljs-string"><span class="hljs-string">"/2017&amp;fn=%D0%9A%D0%BB%D0%B8%D0%BD%D1%86%D1%8B,+%D0%91%D1%80%D1%8F%D0%BD%D1%81%D0%BA%D0%B0%D1%8F+%D0%BE%D0%B1%D0%BB%D0%B0%D1%81%D1%82%D1%8C&amp;fc=52.756616%7C32.256669&amp;fcc=RU&amp;fp=0&amp;tn=&amp;sort=trip_date&amp;order=asc&amp;radius=15&amp;limit=100"</span></span>) url.t &lt;- c(url.t, url) } urls &lt;- c(urls, url.t) url.t &lt;- c() } #    urls &lt;- urls[<span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">74</span></span>] urls &lt;- urls[<span class="hljs-number"><span class="hljs-number">-52</span></span>] #  <span class="hljs-number"><span class="hljs-number">31</span></span>  ####  #### #       blblcars &lt;- data.frame(Name = character(), Age = character(), Date = character(), Time = character(), City = character(), Price = character(), stringsAsFactors = FALSE) #   RSelenium rD &lt;- rsDriver( browser = c(<span class="hljs-string"><span class="hljs-string">"chrome"</span></span>)) remDr &lt;- rD$client <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> urls) { #    remDr$navigate(j) #   <span class="hljs-number"><span class="hljs-number">3</span></span> ,       Sys.sleep(<span class="hljs-number"><span class="hljs-number">3</span></span>) #     html &lt;- remDr$getPageSource() html &lt;- read_html(html<span class="hljs-string"><span class="hljs-string">[[1]]</span></span>) #  names &lt;- html_nodes(html, <span class="hljs-string"><span class="hljs-string">".ProfileCard-info--name"</span></span>) names.i &lt;- c() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (length(names) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { names.i &lt;- NA } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:length(names)) { names.i[i] &lt;- <span class="hljs-built_in"><span class="hljs-built_in">gsub</span></span>(<span class="hljs-string"><span class="hljs-string">".*\n |\n.*"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, names<span class="hljs-string"><span class="hljs-string">[[i]]</span></span>) } } #  age &lt;- html_nodes(html, <span class="hljs-string"><span class="hljs-string">".u-truncate+ .ProfileCard-info"</span></span>) age.i &lt;- c() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (length(age) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { age.i &lt;- NA } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:length(age)) { age.i[i] &lt;- <span class="hljs-built_in"><span class="hljs-built_in">gsub</span></span>(<span class="hljs-string"><span class="hljs-string">".*: |&lt;br/&gt;.*"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, age<span class="hljs-string"><span class="hljs-string">[[i]]</span></span>) } } #  <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> &lt;- html_nodes(html, <span class="hljs-string"><span class="hljs-string">".time"</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>.i &lt;- c() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (length(<span class="hljs-built_in"><span class="hljs-built_in">date</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>.i &lt;- NA } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:length(<span class="hljs-built_in"><span class="hljs-built_in">date</span></span>)) { <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>.i[i] &lt;- <span class="hljs-built_in"><span class="hljs-built_in">gsub</span></span>(<span class="hljs-string"><span class="hljs-string">".*content=\"|\"&gt;.*"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">date</span></span><span class="hljs-string"><span class="hljs-string">[[i]]</span></span>) } } #  <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> &lt;- html_nodes(html, <span class="hljs-string"><span class="hljs-string">".time"</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>.i &lt;- c() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (length(<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>.i &lt;- NA } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:length(<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>)) { <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>.i[i] &lt;- <span class="hljs-built_in"><span class="hljs-built_in">gsub</span></span>(<span class="hljs-string"><span class="hljs-string">".* - |\n.*"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">time</span></span><span class="hljs-string"><span class="hljs-string">[[i]]</span></span>) } } #  price &lt;- html_nodes(html, <span class="hljs-string"><span class="hljs-string">".price"</span></span>) price.i &lt;- c() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (length(price) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { price.i &lt;- NA } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:length(price)) { price.i[i] &lt;- <span class="hljs-built_in"><span class="hljs-built_in">gsub</span></span>(<span class="hljs-string"><span class="hljs-string">".*&lt;span class=\"\"&gt;\n|\n.*"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, price<span class="hljs-string"><span class="hljs-string">[[i]]</span></span>) } } #   city &lt;- html_nodes(html, <span class="hljs-string"><span class="hljs-string">".trip-roads-stop~ .trip-roads-stop"</span></span>) city.i &lt;- c() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (length(city) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { city.i &lt;- NA } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:length(city)) { city.i[i] &lt;- <span class="hljs-built_in"><span class="hljs-built_in">gsub</span></span>(<span class="hljs-string"><span class="hljs-string">"&lt;span class=\"trip-roads-stop\"&gt;|&lt;/span&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, city<span class="hljs-string"><span class="hljs-string">[[i]]</span></span>) } } #    blblcars.t &lt;- data.frame(Name = names.i, Age = age.i, Date = <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>.i, Time = <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>.i, City = city.i, Price = price.i, stringsAsFactors = FALSE) #      blblcars &lt;- rbind(blblcars, blblcars.t) } #   RSelenium remDr$<span class="hljs-built_in"><span class="hljs-built_in">close</span></span>() #   save(blblcars, file = <span class="hljs-string"><span class="hljs-string">"data/blblcars"</span></span>)</code> </pre> </div></div><br><h2 id="dinamika-i-predskazanie-trafika">  Traffic dynamics and prediction </h2><br><div class="spoiler">  <b class="spoiler_title">Data preprocessing script</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">####   #### #   <span class="hljs-keyword"><span class="hljs-keyword">load</span></span>("data/blblcars") #    blblcars$Age &lt;- <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.integer(blblcars$Age) blblcars$Price &lt;- <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.integer(gsub("[^0-9]", "", blblcars$Price)) blblcars$hours &lt;- <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.integer(gsub(":..", "", blblcars$<span class="hljs-type"><span class="hljs-type">Time</span></span>)) blblcars$days &lt;- weekdays(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.Date(blblcars$<span class="hljs-type"><span class="hljs-type">Date</span></span>))</code> </pre> </div></div><br><p>  On average, 10 cars a day leave Klintsy, the maximum is 35. Traffic is growing.  What influences the positive dynamics - the holiday season, more favorable road conditions in the summer, the long-term growth of the service audience - it's hard to say for sure.  We need data for at least a couple of years. </p><br><div class="spoiler">  <b class="spoiler_title">Graphics script</b> <div class="spoiler_text"><pre> <code class="hljs mel">####   #### # row.names(blblcars)[is.na(blblcars$Price)] <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-06</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span> -    blblcars$Date[<span class="hljs-number"><span class="hljs-number">214</span></span>] &lt;- <span class="hljs-string"><span class="hljs-string">"2017-06-03"</span></span> #  ,      #    bl.<span class="hljs-keyword"><span class="hljs-keyword">date</span></span> &lt;- blblcars %&gt;% count(Date) bl.<span class="hljs-keyword"><span class="hljs-keyword">date</span></span>$n[bl.<span class="hljs-keyword"><span class="hljs-keyword">date</span></span>$Date == <span class="hljs-string"><span class="hljs-string">"2017-06-03"</span></span>] &lt;- <span class="hljs-number"><span class="hljs-number">0</span></span> bl.<span class="hljs-keyword"><span class="hljs-keyword">date</span></span>$Date &lt;- as.Date(bl.<span class="hljs-keyword"><span class="hljs-keyword">date</span></span>$Date) bl.<span class="hljs-keyword"><span class="hljs-keyword">date</span></span> &lt;- bl.<span class="hljs-keyword"><span class="hljs-keyword">date</span></span> %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>(Date != <span class="hljs-string"><span class="hljs-string">"2017-07-12"</span></span>) # Min. <span class="hljs-number"><span class="hljs-number">1</span></span>st Qu. Median Mean <span class="hljs-number"><span class="hljs-number">3</span></span>rd Qu. Max. # <span class="hljs-number"><span class="hljs-number">0.00</span></span> <span class="hljs-number"><span class="hljs-number">8.00</span></span> <span class="hljs-number"><span class="hljs-number">10.00</span></span> <span class="hljs-number"><span class="hljs-number">11.48</span></span> <span class="hljs-number"><span class="hljs-number">13.00</span></span> <span class="hljs-number"><span class="hljs-number">35.00</span></span> summary(bl.<span class="hljs-keyword"><span class="hljs-keyword">date</span></span>$n) ####  <span class="hljs-string"><span class="hljs-string">"     "</span></span> #### ggplot(bl.<span class="hljs-keyword"><span class="hljs-keyword">date</span></span>, aes(x = Date, y = n))+ geom_line()+ geom_smooth()+ labs(title = <span class="hljs-string"><span class="hljs-string">" "</span></span>, subtitle = <span class="hljs-string"><span class="hljs-string">"    .   blablacar.ru  11   11  2017 ."</span></span>, caption = <span class="hljs-string"><span class="hljs-string">": blablacar.ru silentio.su"</span></span>, x = <span class="hljs-string"><span class="hljs-string">""</span></span>, y = <span class="hljs-string"><span class="hljs-string">" "</span></span>)+ theme(legend.position = <span class="hljs-string"><span class="hljs-string">"none"</span></span>, axis.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>.x = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.title.x = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>.y = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.title.y = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), title = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>))</code> </pre> </div></div><br><p><img src="https://habrastorage.org/getpro/habr/post_images/88b/0fa/aab/88b0faaab3886813e79823731c80b0bc.png" alt="image"></p><br><p>  Predicting traffic for the next week or month is also problematic.  Tested several models, but the accuracy of predictions leaves much to be desired. </p><br><div class="spoiler">  <b class="spoiler_title">Model script</b> <div class="spoiler_text"><pre> <code class="hljs mel">####   #### bl.arima &lt;- zoo(bl.<span class="hljs-keyword"><span class="hljs-keyword">date</span></span>$n, bl.<span class="hljs-keyword"><span class="hljs-keyword">date</span></span>$Date) model.arima &lt;- auto.arima(bl.arima) predic.ar &lt;- forecast(model.arima, h = <span class="hljs-number"><span class="hljs-number">14</span></span>) plot(predic.ar, type = <span class="hljs-string"><span class="hljs-string">"line"</span></span>, main = <span class="hljs-string"><span class="hljs-string">" "</span></span>) title(main = <span class="hljs-string"><span class="hljs-string">"     "</span></span>, xlab = <span class="hljs-string"><span class="hljs-string">"ARIMA(2,1,1),   12-25  2017 ."</span></span>, ylab = <span class="hljs-string"><span class="hljs-string">" "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>(<span class="hljs-string"><span class="hljs-string">": blablacar.ru silentio.su"</span></span>, x = <span class="hljs-number"><span class="hljs-number">0.98</span></span>, y = <span class="hljs-number"><span class="hljs-number">0.02</span></span>, just = c(<span class="hljs-string"><span class="hljs-string">"right"</span></span>, <span class="hljs-string"><span class="hljs-string">"bottom"</span></span>), gp = gpar(fontsize = <span class="hljs-number"><span class="hljs-number">14</span></span>, col = <span class="hljs-string"><span class="hljs-string">"dimgrey"</span></span>))</code> </pre> </div></div><br><p><img src="https://habrastorage.org/web/259/a42/738/259a427382b54ca5969fd482caf7eeee.png" alt="image"></p><br><h2 id="samye-populyarnye-napravleniya">  Most popular destinations </h2><br><p>  For two months, cars from Klintsy were sent to 59 different cities.  However, there are few main directions: Bryansk (40% of all trips), Moscow (18%), cities of the Bryansk region, Gomel (border town in Belarus, regional center), Oryol, Smolensk - 88% of all trips. </p><br><div class="spoiler">  <b class="spoiler_title">Graphics script</b> <div class="spoiler_text"><pre> <code class="hljs mel">####    #### bl.city &lt;- blblcars %&gt;% count(City) bl.city$percents &lt;- round(bl.city$n/sum(bl.city$n)*<span class="hljs-number"><span class="hljs-number">100</span></span>, digits = <span class="hljs-number"><span class="hljs-number">2</span></span>) bl.city &lt;- bl.city %&gt;% arrange(desc(n)) # <span class="hljs-number"><span class="hljs-number">59</span></span>  length(unique(bl.city$City)) ####  <span class="hljs-string"><span class="hljs-string">"-10   .   blablacar.ru"</span></span> #### ggplot(bl.city[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>,], aes(x = <span class="hljs-keyword"><span class="hljs-keyword">reorder</span></span>(City, n), y = percents, fill = percents))+ geom_bar(stat = <span class="hljs-string"><span class="hljs-string">"identity"</span></span>)+ coord_flip()+ geom_label(aes(label = paste0(percents, <span class="hljs-string"><span class="hljs-string">"%"</span></span>)), <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">5</span></span>, colour = <span class="hljs-string"><span class="hljs-string">"white"</span></span>, hjust = <span class="hljs-number"><span class="hljs-number">1</span></span>)+ labs(title = <span class="hljs-string"><span class="hljs-string">"       "</span></span>, subtitle = <span class="hljs-string"><span class="hljs-string">"-10   .   blablacar.ru"</span></span>, caption = <span class="hljs-string"><span class="hljs-string">": blablacar.ru silentio.su"</span></span>, x = <span class="hljs-string"><span class="hljs-string">""</span></span>, y = <span class="hljs-string"><span class="hljs-string">"%   "</span></span>)+ theme(legend.position = <span class="hljs-string"><span class="hljs-string">"none"</span></span>, axis.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>.x = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.title.x = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>.y = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.title.y = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), title = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>))</code> </pre> </div></div><br><p><img src="https://habrastorage.org/web/601/b7a/419/601b7a41972f4f02815ec44093a77810.png" alt="image"></p><br><p>  If you put the destination on the map, you get an almost perfect circle with a center in Klintsy and a radius of 1000-1200 km, dense in the center and discharged closer to the periphery.  The arc Klintsy-Bryansk-Kaluga-Moscow is also clearly visible. </p><br><div class="spoiler">  <b class="spoiler_title">Script Cards</b> <div class="spoiler_text"><pre> <code class="hljs django"><span class="xml"><span class="xml">####    .   blablacar.ru #### #  bl.city </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">na.omit</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">bl.city</span></span></span></span><span class="xml"><span class="hljs-tag">) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">geo</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">geocode</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">bl.city</span></span></span></span><span class="xml"><span class="hljs-tag">$</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">City</span></span></span></span><span class="xml"><span class="hljs-tag">) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">bl.city</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cbind</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">bl.city</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">as.data.frame</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">geo</span></span></span></span><span class="xml"><span class="hljs-tag">)) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">map</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">get_map</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">location</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Klintsy"</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">maptype</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"terrain"</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">4)</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ggmap</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">map</span></span></span></span><span class="xml"><span class="hljs-tag">)+ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">geom_point</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">bl.city,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">aes</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">lon,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">lat,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">percents),</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">alpha</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">colour</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"red"</span></span></span></span><span class="xml"><span class="hljs-tag">)+ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">labs</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"   .   blablacar.ru"</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">caption</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">": blablacar.ru silentio.su"</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"% :"</span></span></span></span><span class="xml"><span class="hljs-tag">)+ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">theme</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">legend.position</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"left"</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">legend.text</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">element_text(size</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">12),</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">axis.text.x</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">element_text(size</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">8),</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">axis.title.x</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">element_text(size</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">8),</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">axis.text.y</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">element_text(size</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">8),</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">axis.title.y</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">element_text(size</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">8),</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">element_text(size</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">14))</span></span></span></span></span></span></code> </pre> </div></div><br><p><img src="https://habrastorage.org/web/0ed/82b/f7d/0ed82bf7dc864be684fd1c4cd589abf0.png" alt="image"></p><br><p>  That is, mainly clinchans travel around the place, regularly travel to nearby regional centers and to the MSC. </p><br><h2 id="stoimost-proezda">  Fare </h2><br><p>  The fare for all drivers, grouped in directions, is about the same: about 100 p.  - in the region, an average of 280 p.  - Bryansk, 900 p.  - Moscow.  It is somewhere around 25% cheaper than regular carriers. </p><br><p>  The biggest price range is for tickets to Orel (from 350 to 600 rubles) and Smolensk (from 450 to 650 rubles). </p><br><div class="spoiler">  <b class="spoiler_title">Graphics script</b> <div class="spoiler_text"><pre> <code class="hljs mel">####    <span class="hljs-number"><span class="hljs-number">-10</span></span>  #### bl.price.top &lt;- blblcars %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>(City %in% unique(bl.city$City[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>])) %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>(City, Price) bl.price.top &lt;- full_join(bl.price.top, bl.price.top %&gt;% group_by(City) %&gt;% summarise(mean = mean(Price)) ) bl.price.top$mean &lt;- round(bl.price.top$mean, digits = <span class="hljs-number"><span class="hljs-number">0</span></span>) bl.price.top$mean &lt;- paste0(bl.price.top$mean, <span class="hljs-string"><span class="hljs-string">" ."</span></span>) bl.price.top &lt;- bl.price.top %&gt;% unite(City, c(City, mean), sep = <span class="hljs-string"><span class="hljs-string">", "</span></span>) ####  <span class="hljs-string"><span class="hljs-string">"         "</span></span> #### ggplot(bl.price.top, aes(x = <span class="hljs-keyword"><span class="hljs-keyword">reorder</span></span>(City, Price), y = Price))+ stat_summary(geom = <span class="hljs-string"><span class="hljs-string">"line"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>, fun.data = <span class="hljs-string"><span class="hljs-string">"mean_cl_boot"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>, colour = <span class="hljs-string"><span class="hljs-string">"blue"</span></span>)+ stat_summary(fun.data = <span class="hljs-string"><span class="hljs-string">"mean_cl_boot"</span></span>, colour = <span class="hljs-string"><span class="hljs-string">"red"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>)+ labs(title = <span class="hljs-string"><span class="hljs-string">"    -      "</span></span>, subtitle = <span class="hljs-string"><span class="hljs-string">"    .   blablacar.ru (-10 )"</span></span>, caption = <span class="hljs-string"><span class="hljs-string">": blablacar.ru silentio.su"</span></span>, x = <span class="hljs-string"><span class="hljs-string">"   "</span></span>, y = <span class="hljs-string"><span class="hljs-string">" , ."</span></span>)+ theme(legend.position = <span class="hljs-string"><span class="hljs-string">"none"</span></span>, legend.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>.x = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">angle</span></span> = <span class="hljs-number"><span class="hljs-number">90</span></span>), axis.title.x = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>.y = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.title.y = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), title = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>))</code> </pre> </div></div><br><p><img src="https://habrastorage.org/web/940/e5f/28a/940e5f28a3064b8399ad3c3c9e0c046f.png" alt="image"></p><br><p>  Oddly enough, the price of the trip does not always depend on the distance.  The most expensive trip from Klintsy to the South and the Caucasus is 1500-2300 r.  For similar distances in the direction of Europe ask two times less. </p><br><div class="spoiler">  <b class="spoiler_title">Graphics script</b> <div class="spoiler_text"><pre> <code class="hljs mel">####    #### bl.price &lt;- blblcars %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>(City, Price) %&gt;% group_by(City) %&gt;% summarise(price = mean(Price)) bl.price$price &lt;- round(bl.price$price, digits = <span class="hljs-number"><span class="hljs-number">0</span></span>) bl.price &lt;- bl.price %&gt;% arrange(desc(price)) ####  <span class="hljs-string"><span class="hljs-string">"-10     .   blablacar.ru"</span></span> #### ggplot(bl.price[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>,], aes(x = <span class="hljs-keyword"><span class="hljs-keyword">reorder</span></span>(City, price), y = price, fill = price))+ geom_bar(stat = <span class="hljs-string"><span class="hljs-string">"identity"</span></span>)+ coord_flip()+ geom_label(aes(label = paste0(price, <span class="hljs-string"><span class="hljs-string">" ."</span></span>)), <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">5</span></span>, colour = <span class="hljs-string"><span class="hljs-string">"white"</span></span>, hjust = <span class="hljs-number"><span class="hljs-number">1</span></span>)+ labs(title = <span class="hljs-string"><span class="hljs-string">"        "</span></span>, subtitle = <span class="hljs-string"><span class="hljs-string">"-10     .   blablacar.ru"</span></span>, caption = <span class="hljs-string"><span class="hljs-string">": blablacar.ru silentio.su"</span></span>, x = <span class="hljs-string"><span class="hljs-string">""</span></span>, y = <span class="hljs-string"><span class="hljs-string">"  , ."</span></span>)+ theme(legend.position = <span class="hljs-string"><span class="hljs-string">"none"</span></span>, axis.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>.x = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.title.x = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>.y = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.title.y = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), title = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>))</code> </pre> </div></div><br><p><img src="https://habrastorage.org/web/e70/4dd/c41/e704ddc415584c83b14fe7791e0d5453.png" alt="image"></p><br><h2 id="analiz-voditeley">  Driver analysis </h2><br><p>  I was interested in the motivation of drivers.  Why do they charge passengers?  Are among them those who use the service for commercial gain? </p><br><p>  54% of drivers for two months only once used the service.  The rest go with a frequency of 1 time per month to 1 time per week, probably on business cases - passengers are taken in order to reduce travel expenses. </p><br><p>  I found only one person, who, most likely (but this is not accurate), is engaged in commercial carrying (route taxi, Novozybkov ‚Äì Klintsy ‚Äì Moscow route, every three days). </p><br><div class="spoiler">  <b class="spoiler_title">Graphics script</b> <div class="spoiler_text"><pre> <code class="hljs mel">####    #### drivers &lt;- blblcars %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>(Name, Age) drivers$Age &lt;- paste0(<span class="hljs-string"><span class="hljs-string">": "</span></span>, drivers$Age) drivers &lt;- drivers %&gt;% unite(Name, c(Name, Age), sep = <span class="hljs-string"><span class="hljs-string">", "</span></span>) drivers &lt;- drivers %&gt;% count(Name) drivers$percents &lt;- round(drivers$n/sum(drivers$n)*<span class="hljs-number"><span class="hljs-number">100</span></span>, digits = <span class="hljs-number"><span class="hljs-number">2</span></span>) drivers &lt;- arrange(drivers, desc(n)) drivers$per.month &lt;- round(drivers$n/<span class="hljs-number"><span class="hljs-number">2</span></span>, digits = <span class="hljs-number"><span class="hljs-number">0</span></span>) summary(as.factor(drivers$n))/sum(drivers$n)*<span class="hljs-number"><span class="hljs-number">100</span></span> ####  <span class="hljs-string"><span class="hljs-string">"    "</span></span> #### ggplot(drivers[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>,], aes(x = <span class="hljs-keyword"><span class="hljs-keyword">reorder</span></span>(Name, n), y = percents, fill = percents))+ geom_bar(stat = <span class="hljs-string"><span class="hljs-string">"identity"</span></span>)+ coord_flip()+ geom_label(aes(label = paste0(per.month, <span class="hljs-string"><span class="hljs-string">" ./"</span></span>)), <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">5</span></span>, colour = <span class="hljs-string"><span class="hljs-string">"white"</span></span>, hjust = <span class="hljs-number"><span class="hljs-number">1</span></span>)+ labs(title = <span class="hljs-string"><span class="hljs-string">"    "</span></span>, subtitle = <span class="hljs-string"><span class="hljs-string">"-10      .   blablacar.ru"</span></span>, caption = <span class="hljs-string"><span class="hljs-string">": blablacar.ru silentio.su"</span></span>, x = <span class="hljs-string"><span class="hljs-string">""</span></span>, y = <span class="hljs-string"><span class="hljs-string">"   "</span></span>)+ theme(legend.position = <span class="hljs-string"><span class="hljs-string">"none"</span></span>, axis.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>.x = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.title.x = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>.y = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.title.y = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), title = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>))</code> </pre> </div></div><br><p><img src="https://habrastorage.org/web/857/336/0e5/8573360e5492439192b9b3688b7fde51.png" alt="image"></p><br><h2 id="vremya-otpravleniya">  Departure time </h2><br><p>  The easiest way to leave Klintsy is from 16:00 to 19:00.  Cars go to Moscow at night, at about nine in the evening. </p><br><div class="spoiler">  <b class="spoiler_title">Graphics script</b> <div class="spoiler_text"><pre> <code class="hljs mel">####      <span class="hljs-number"><span class="hljs-number">-10</span></span> #### bl.hours &lt;- blblcars %&gt;% group_by(City) %&gt;% count(hours) bl.hours &lt;- <span class="hljs-keyword"><span class="hljs-keyword">ungroup</span></span>(bl.hours) #    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> unique(bl.hours$City)) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> seq(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!j %in% bl.hours$hours[bl.hours$City == i]) { bl.hours &lt;- rbind(bl.hours, data.frame(City = i, hours = j, n = <span class="hljs-number"><span class="hljs-number">0</span></span>)) } } } #  <span class="hljs-number"><span class="hljs-number">-10</span></span> bl.hours &lt;- bl.hours %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>(City %in% bl.city$City[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>]) bl.hours$percents &lt;- round(bl.hours$n/sum(bl.hours$n)*<span class="hljs-number"><span class="hljs-number">100</span></span>, digits = <span class="hljs-number"><span class="hljs-number">2</span></span>) ####  <span class="hljs-string"><span class="hljs-string">"   .   blablacar.ru   "</span></span> #### ggplot(bl.hours, aes(x = hours, y = percents, fill = City))+ geom_bar(stat = <span class="hljs-string"><span class="hljs-string">"identity"</span></span>)+ labs(title = <span class="hljs-string"><span class="hljs-string">"      16:00  19:00"</span></span>, subtitle = <span class="hljs-string"><span class="hljs-string">"   .   blablacar.ru   "</span></span>, caption = <span class="hljs-string"><span class="hljs-string">": blablacar.ru silentio.su"</span></span>, x = <span class="hljs-string"><span class="hljs-string">" ( )"</span></span>, y = <span class="hljs-string"><span class="hljs-string">"%    ( -10)"</span></span>, fill = <span class="hljs-string"><span class="hljs-string">":"</span></span>)+ theme(legend.position = <span class="hljs-string"><span class="hljs-string">"right"</span></span>, legend.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">12</span></span>), axis.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>.x = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.title.x = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>.y = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.title.y = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), title = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>))</code> </pre> </div></div><br><p><img src="https://habrastorage.org/web/455/9b7/abb/4559b7abb61e49bdac0173a10f3c9012.png" alt="image"></p><br><p>  Most often, people leave the city on Tuesday, Friday and Sunday. </p><br><div class="spoiler">  <b class="spoiler_title">Graphics script</b> <div class="spoiler_text"><pre> <code class="hljs mel">####      <span class="hljs-number"><span class="hljs-number">-10</span></span> #### bl.days &lt;- blblcars %&gt;% group_by(City) %&gt;% count(days) bl.days &lt;- <span class="hljs-keyword"><span class="hljs-keyword">ungroup</span></span>(bl.days) #    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> unique(bl.days$City)) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> unique(bl.days$days)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!j %in% bl.days$days[bl.days$City == i]) { bl.days &lt;- rbind(bl.days, data.frame(City = i, days = j, n = <span class="hljs-number"><span class="hljs-number">0</span></span>)) } } } #  <span class="hljs-number"><span class="hljs-number">-10</span></span> bl.days &lt;- bl.days %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>(City %in% bl.city$City[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>]) bl.days$percents &lt;- round(bl.days$n/sum(bl.days$n)*<span class="hljs-number"><span class="hljs-number">100</span></span>, digits = <span class="hljs-number"><span class="hljs-number">2</span></span>) #     bl.days$days &lt;- as.factor(bl.days$days) bl.days$days &lt;- factor(bl.days$days, levels = c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)) ####  <span class="hljs-string"><span class="hljs-string">"   .   blablacar.ru   "</span></span> #### ggplot(bl.days, aes(x = days, y = percents, fill = City))+ geom_bar(stat = <span class="hljs-string"><span class="hljs-string">"identity"</span></span>)+ labs(title = <span class="hljs-string"><span class="hljs-string">"      ,   "</span></span>, subtitle = <span class="hljs-string"><span class="hljs-string">"   .   blablacar.ru   "</span></span>, caption = <span class="hljs-string"><span class="hljs-string">": blablacar.ru silentio.su"</span></span>, x = <span class="hljs-string"><span class="hljs-string">" "</span></span>, y = <span class="hljs-string"><span class="hljs-string">"%    ( -10)"</span></span>, fill = <span class="hljs-string"><span class="hljs-string">":"</span></span>)+ theme(legend.position = <span class="hljs-string"><span class="hljs-string">"right"</span></span>, legend.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">12</span></span>), axis.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>.x = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.title.x = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>.y = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), axis.title.y = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>), title = element_text(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">14</span></span>))</code> </pre> </div></div><br><p><img src="https://habrastorage.org/web/814/a5c/9d1/814a5c9d179a4fe28162527716bfd500.png" alt="image"></p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  According to the results of the study, I made a schedule that explains where, when and for how much you can <strong>most likely</strong> leave if such a desire arises. </p><br><div class="spoiler">  <b class="spoiler_title">Schedule script</b> <div class="spoiler_text"><pre> <code class="hljs mel">####  #### tbls &lt;- blblcars %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>(City %in% bl.city$City[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>]) %&gt;% group_by(City) %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>(City, days, Time, Price) #    tbls &lt;- full_join(tbls, tbls %&gt;% summarise(mean.price = round(mean(Price), digits = <span class="hljs-number"><span class="hljs-number">0</span></span>)), by = <span class="hljs-string"><span class="hljs-string">"City"</span></span> ) tbls &lt;- tbls %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>(-Price) #      tbls &lt;- full_join(tbls, tbls %&gt;% count(days) %&gt;% top_n(<span class="hljs-number"><span class="hljs-number">1</span></span>, n), by = <span class="hljs-string"><span class="hljs-string">"City"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> unique(tbls$City)) { tbls$days.y[tbls$City == i] &lt;- paste0(unique(tbls$days.y[tbls$City == i]), collapse = <span class="hljs-string"><span class="hljs-string">", "</span></span>) } tbls &lt;- tbls %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>(-c(days.x, n)) #     tbls &lt;- full_join(tbls, tbls %&gt;% count(Time) %&gt;% top_n(<span class="hljs-number"><span class="hljs-number">1</span></span>, n), by = <span class="hljs-string"><span class="hljs-string">"City"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> unique(tbls$City)) { tbls$Time.y[tbls$City == i] &lt;- paste0(unique(tbls$Time.y[tbls$City == i]), collapse = <span class="hljs-string"><span class="hljs-string">", "</span></span>) } tbls &lt;- tbls %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>(-c(Time.x, n)) tbls &lt;- <span class="hljs-keyword"><span class="hljs-keyword">ungroup</span></span>(tbls) tbls &lt;- unique(tbls) tbls &lt;- tbls[c(<span class="hljs-string"><span class="hljs-string">"City"</span></span>, <span class="hljs-string"><span class="hljs-string">"days.y"</span></span>, <span class="hljs-string"><span class="hljs-string">"Time.y"</span></span>, <span class="hljs-string"><span class="hljs-string">"mean.price"</span></span>)] colnames(tbls) &lt;- c(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"  "</span></span>) tbls &lt;- tbls %&gt;% arrange(<span class="hljs-string"><span class="hljs-string">` `</span></span>) write.csv(tbls, <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> = <span class="hljs-string"><span class="hljs-string">"data/tbls.csv"</span></span>, row.names = F)</code> </pre> </div></div><br><p><img src="https://habrastorage.org/web/f2f/50b/90a/f2f50b90ad5d4dffb1574479f348638a.png" alt="image"></p><br><p>  I also trained in the xgboost algorithm, which predicts the most likely route based on the day of the week and departure time. </p><br><p>  The most informative sign was the hour of departure.  In the late night, the model consistently advises to go to Novozybkov, in the afternoon - to Bryansk, in the evening - to Moscow.  Trips to other cities xgboost finds unlikely. </p><br><div class="spoiler">  <b class="spoiler_title">Xgboost model</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">####  XGBOOST #### #   df &lt;- <span class="hljs-keyword"><span class="hljs-keyword">read</span></span>.csv("data/   - .csv", stringsAsFactors = F) df &lt;- df %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>(c(City, <span class="hljs-type"><span class="hljs-type">Time</span></span>, days)) df &lt;- df %&gt;% separate(<span class="hljs-type"><span class="hljs-type">Time</span></span>, c("hours", "minutes"), sep = ":") df$days &lt;- <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.factor(df$days) levels(df$days) &lt;- c("7", "2", "1", "5", "3", "6", "4") df[,<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>] &lt;- apply(df[,<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(x) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(x)) top10 &lt;- df %&gt;% count(City) %&gt;% arrange(<span class="hljs-keyword"><span class="hljs-keyword">desc</span></span>(n)) top10 &lt;- top10$City[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>] df &lt;- df %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>(City %<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>% top10) df &lt;- na.omit(df) #   df$<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> &lt;- <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.factor(df$City))<span class="hljs-number"><span class="hljs-number">-1</span></span> City.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> &lt;- df %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>(City, <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>) City.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> &lt;- <span class="hljs-keyword"><span class="hljs-keyword">unique</span></span>(City.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>) df &lt;- df[,<span class="hljs-number"><span class="hljs-number">-1</span></span>] #    train  test #  <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> indexes &lt;- createDataPartition(df$<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>, times = <span class="hljs-number"><span class="hljs-number">1</span></span>, p = <span class="hljs-number"><span class="hljs-number">0.7</span></span>, list = F) train &lt;- df[indexes,] test &lt;- df[-indexes,] #   y.train &lt;- train$<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> #   train.m &lt;- data.matrix(train[,<span class="hljs-number"><span class="hljs-number">-4</span></span>]) train.m &lt;- xgb.DMatrix(train.m, label = y.train) # Stopping. Best iteration: # [<span class="hljs-number"><span class="hljs-number">15</span></span>] train-merror:<span class="hljs-number"><span class="hljs-number">0.425361</span></span>+<span class="hljs-number"><span class="hljs-number">0.010171</span></span> # test-merror:<span class="hljs-number"><span class="hljs-number">0.504626</span></span>+<span class="hljs-number"><span class="hljs-number">0.035449</span></span> model &lt;- xgb.cv(data = train.m, nfold = <span class="hljs-number"><span class="hljs-number">4</span></span>, eta = <span class="hljs-number"><span class="hljs-number">0.03</span></span>, nrounds = <span class="hljs-number"><span class="hljs-number">2000</span></span>, num_class = <span class="hljs-number"><span class="hljs-number">10</span></span>, objective = "multi:softmax", early_stopping_round = <span class="hljs-number"><span class="hljs-number">200</span></span>) #    #   train$<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> &lt;- <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.factor(train$<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>) traintask &lt;- makeClassifTask(data = train, target = "class") lrn &lt;- makeLearner("classif.xgboost", predict.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = "response") lrn$par.vals &lt;- list(objective = "multi:softmax", eval_metric = "merror", nrounds = <span class="hljs-number"><span class="hljs-number">15</span></span>, eta = <span class="hljs-number"><span class="hljs-number">0.03</span></span>) params &lt;- makeParamSet(makeDiscreteParam("booster", <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> = c("gbtree", "gblinear")), makeIntegerParam("max_depth", lower = <span class="hljs-number"><span class="hljs-number">1</span></span>, upper = <span class="hljs-number"><span class="hljs-number">10</span></span>), makeNumericParam("min_child_weight", lower = <span class="hljs-number"><span class="hljs-number">1</span></span>, upper = <span class="hljs-number"><span class="hljs-number">10</span></span>), makeNumericParam("subsample", lower = <span class="hljs-number"><span class="hljs-number">0.5</span></span>, upper = <span class="hljs-number"><span class="hljs-number">1</span></span>), makeNumericParam("colsample_bytree", lower = <span class="hljs-number"><span class="hljs-number">0.5</span></span>, upper = <span class="hljs-number"><span class="hljs-number">1</span></span>)) rdesc &lt;- makeResampleDesc("CV", iters = <span class="hljs-number"><span class="hljs-number">4</span></span>) #   ctrl &lt;- makeTuneControlRandom(maxit = <span class="hljs-number"><span class="hljs-number">10</span></span>) #   mytune &lt;- tuneParams(learner = lrn, task = traintask, resampling = rdesc, par.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> = params, control = ctrl, <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">info</span></span> = T) # [Tune-y] <span class="hljs-number"><span class="hljs-number">10</span></span>: mmce.test.mean=<span class="hljs-number"><span class="hljs-number">0.525</span></span>; <span class="hljs-type"><span class="hljs-type">time</span></span>: <span class="hljs-number"><span class="hljs-number">0.0</span></span> min # [Tune] Result: booster=gbtree; max_depth=<span class="hljs-number"><span class="hljs-number">10</span></span>; min_child_weight=<span class="hljs-number"><span class="hljs-number">5</span></span>; # subsample=<span class="hljs-number"><span class="hljs-number">0.99</span></span>; colsample_bytree=<span class="hljs-number"><span class="hljs-number">0.907</span></span> : mmce.test.mean=<span class="hljs-number"><span class="hljs-number">0.516</span></span> # Xgboost-model #   param &lt;- list( "num_class" = <span class="hljs-number"><span class="hljs-number">10</span></span>, "objective" = "multi:softmax", "eval_metric" = "merror", "eta" = <span class="hljs-number"><span class="hljs-number">0.03</span></span>, "max_depth" = <span class="hljs-number"><span class="hljs-number">10</span></span>, "min_child_weight" = <span class="hljs-number"><span class="hljs-number">5</span></span>, "subsample" = <span class="hljs-number"><span class="hljs-number">0.99</span></span>, "colsample_bytree" = <span class="hljs-number"><span class="hljs-number">0.907</span></span>) #    model &lt;- xgb.cv(data = train.m, params = param, nfold = <span class="hljs-number"><span class="hljs-number">4</span></span>, nrounds = <span class="hljs-number"><span class="hljs-number">20000</span></span>, early_stopping_round = <span class="hljs-number"><span class="hljs-number">100</span></span>) # Stopping. Best iteration: # [<span class="hljs-number"><span class="hljs-number">84</span></span>] train-merror:<span class="hljs-number"><span class="hljs-number">0.462308</span></span>+<span class="hljs-number"><span class="hljs-number">0.015107</span></span> test-merror:<span class="hljs-number"><span class="hljs-number">0.509050</span></span>+<span class="hljs-number"><span class="hljs-number">0.028020</span></span> # Xgboost- model &lt;- xgboost(data = train.m, params = param, nrounds = <span class="hljs-number"><span class="hljs-number">84</span></span>, scale_pos_weight = <span class="hljs-number"><span class="hljs-number">5</span></span>) #  test-matrix y.test &lt;- test$<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> test &lt;- data.matrix(test[,<span class="hljs-number"><span class="hljs-number">-4</span></span>]) #    mat &lt;- xgb.importance(feature_names = colnames(train.m), model = model) xgb.plot.importance(importance_matrix = mat, main = " :") #  y.predict &lt;- predict(model, test, nrounds = <span class="hljs-number"><span class="hljs-number">84</span></span>, scale_pos_weight = <span class="hljs-number"><span class="hljs-number">5</span></span>) #     replace.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> &lt;- <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(x){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unique</span></span>(x)) { x[x == i] &lt;- City.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>$City[City.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>$<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> == i] } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(x) } #   confusionMatrix(replace.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(y.predict), replace.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(y.test)) #   #    df_test &lt;- data.frame(hours = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(sample(x = c(<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>), size = <span class="hljs-number"><span class="hljs-number">10</span></span>, replace = T)), minutes = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(sample(x = c(<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>), size = <span class="hljs-number"><span class="hljs-number">10</span></span>, replace = T)), days = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(sample(x = c(<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">7</span></span>), size = <span class="hljs-number"><span class="hljs-number">10</span></span>, replace = T))) #  df_test$City &lt;- replace.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(predict(model, data.matrix(df_test), nrounds = <span class="hljs-number"><span class="hljs-number">84</span></span>, scale_pos_weight = <span class="hljs-number"><span class="hljs-number">5</span></span>)) #   df_test &lt;- df_test[c("City", "days", "hours", "minutes")] colnames(df_test) &lt;- c(" ", " ", " ", " ") df_test &lt;- df_test %&gt;% arrange(` `) grid.text("     xgboost", x = <span class="hljs-number"><span class="hljs-number">0.5</span></span>, y = <span class="hljs-number"><span class="hljs-number">0.93</span></span>, just = c("centre", "bottom"), gp = gpar(fontsize = <span class="hljs-number"><span class="hljs-number">16</span></span>)) grid.<span class="hljs-keyword"><span class="hljs-keyword">table</span></span>(df_test) grid.text(": blablacar.ru", x = <span class="hljs-number"><span class="hljs-number">0.02</span></span>, y = <span class="hljs-number"><span class="hljs-number">0.01</span></span>, just = c("left", "bottom"), gp = gpar(fontsize = <span class="hljs-number"><span class="hljs-number">11</span></span>)) grid.text(" silentio.su", x = <span class="hljs-number"><span class="hljs-number">0.98</span></span>, y = <span class="hljs-number"><span class="hljs-number">0.01</span></span>, just = c("right", "bottom"), gp = gpar(fontsize = <span class="hljs-number"><span class="hljs-number">11</span></span>))</code> </pre> </div></div><br><p><img src="https://habrastorage.org/web/e20/f50/84d/e20f5084d7d346fb9d6ea0d5982b1179.png" alt="image"></p><br><p>  If you answer the question in the headline, the answer is: ‚ÄúYes, you can leave Klintsy. <del>  only close </del>  Well this is not Omsk. </p><br><ul><li><p>  <a href=""><em>GithHub Code</em></a> </p><br></li><li>  <a href="https://docs.google.com/spreadsheets/d/1NcSy17ciauMwurxPqgfBtIMeDpXiAu2plmDDgnnz7LM/edit%3Fusp%3Dsharing"><em>Data on GoogleSheets</em></a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/333428/">https://habr.com/ru/post/333428/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333418/index.html">We pump over NES Classic Mini - continuation</a></li>
<li><a href="../333420/index.html">Comodo Internet Security Local Update Server</a></li>
<li><a href="../333422/index.html">Unity on Linux? No problem</a></li>
<li><a href="../333424/index.html">Creating a directory of address information with blackjack and API</a></li>
<li><a href="../333426/index.html">Exact calculation of averages and covariances by the Welford method</a></li>
<li><a href="../333432/index.html">Atlassian certification: how to get a crust from Atlassian that you're cool</a></li>
<li><a href="../333436/index.html">The digest of interesting materials for the mobile developer # 212 (July 10 - July 16)</a></li>
<li><a href="../333440/index.html">The recommendation of the first track for streaming. Lecture in Yandex</a></li>
<li><a href="../333442/index.html">How we searched and found a bug in Visual Studio C ++</a></li>
<li><a href="../333444/index.html">Pygest # 13. Releases, articles, interesting projects from the world of Python [July 4, 2017 - July 17, 2017]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>