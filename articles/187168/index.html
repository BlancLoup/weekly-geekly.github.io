<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Small office scan optimization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good time of day, community! 

 I decided to tell how in one working group the ‚Äúfast‚Äù translation of a paper document into digital form was organized....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Small office scan optimization</h1><div class="post__text post__text-html js-mediator-article">  Good time of day, community! <br><br>  I decided to tell how in one working group the ‚Äúfast‚Äù translation of a paper document into digital form was organized. <br><br>  To begin, tell you what it is.  And there is a working group (about 10 computers) headed by a standalone system unit, proudly referred to as a ‚Äúserver‚Äù.  The server has a 64-bit Ubuntu Server with Samba configured. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As before managers were scanned: the computer was turned on, to which the HP ScanJet 2400 flatbed scanner was connected (if it was not turned on) and the document was scanned page by page with the location of the file to be saved. <br>  Obvious disadvantages: it was necessary to turn on the computer (and then turn it off), time was spent waiting for the OS to load, the program, the scanner had warmed up for a long time before the first scan. <br><br>  How it became: the manager approached the scanner, inserted the documents in a pack (up to 20 sheets), pressed a button on the scanner, took the documents.  While scans have returned to their place already in the ball. <br>  Time to get a digital copy has decreased tenfold. <br><a name="habracut"></a><br>  <b>Implementation</b> <br><habracut><br>  Needed was an inexpensive document scanner with the ability to connect to linux.  The choice fell on the Brother <a href="http://www.brother.ru/g3.cfm/s_page/92250/s_name/productdetail/s_level/264390/s_product/ADS2100">ADS-2100</a> model. <br><img src="https://habrastorage.org/getpro/habr/post_images/eb1/b40/08e/eb1b4008e461fa833d8dae8e62aa5316.jpg" alt="image"><br>  So, we connect the scanner with a USB cable to the server and configure it. <br><br>  1. We look, whether the scanner is connected <br><pre><code class="bash hljs">lsusb</code> </pre> <pre> <code class="bash hljs">Bus 005 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub Bus 004 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub Bus 003 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub Bus 001 Device 004: ID 03f0:3817 Hewlett-Packard LaserJet P2015 series Bus 001 Device 002: ID 04f9:60a1 Brother Industries, Ltd Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</code> </pre> <br>  2. Go to the manufacturer's website <a href="http://www.brother.ru/">www.brother.ru</a> and follow the links go to the <a href="http://welcome.solutions.brother.com/bsc/public_s/id/linux/en/index.html">welcome.solutions.brother.com/bsc/public_s/id/linux/en/index.html</a> page for downloading drivers and software for Linux <br>  We are looking for Download ‚Üí Scanner Driver / ADS Driver / Scan-Key-Tool ‚Üí for ADS models brscan4 64bit file of deb format, and also scan-key-tool 64bit file of the same format <br>  I downloaded the driver from the working computer, then I just threw them into a ball on the server and installed it from there. <br><br>  3. Go to the directory with the downloaded files and install the scanner driver <br><pre> <code class="bash hljs">dpkg -i brscan4-0.4.1-3.amd64.deb</code> </pre> <pre> <code class="bash hljs">     brscan4. (   ...     108594   .)   brscan4 (  brscan4-0.4.1-3.amd64.deb)...   brscan4 (0.4.1-3) ... This software is based <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> part on the work of the Independent JPEG Group.</code> </pre> <br>  4. We give permissions to scan under a regular user. <br>  Open the file /lib/udev/rules.d/40-libsane.rules and add the following comment before the comment "# The following rule will disable USB autosuspend for the device" <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Brother scanners ATTRS{idVendor}=="04f9", ENV{libsane_matched}="yes"</span></span></code> </pre> <br>  5. Reboot the server <br><br>  6. Similarly to paragraph 3, install the Scan-key-tool <br><pre> <code class="bash hljs">dpkg -i brscan-skey-0.2.4-0.amd64.deb</code> </pre> <pre> <code class="bash hljs">     brscan-skey. (   ...     108623   .)   brscan-skey (  brscan-skey-0.2.4-0.amd64.deb)...   brscan-skey (0.2.4-0) ...</code> </pre> <br>  7. Fix the configuration files.  When you press a certain key, the command is launched.  This is written in /opt/brother/scanner/brscan-skey/brscan-skey-0.2.4-0.cfg <br>  Its contents are: <br><pre> <code class="bash hljs">password= IMAGE=<span class="hljs-string"><span class="hljs-string">"sh /opt/brother/scanner/brscan-skey/script/scantoimage-0.2.4-0.sh"</span></span> OCR=<span class="hljs-string"><span class="hljs-string">"sh /opt/brother/scanner/brscan-skey/script/scantoocr-0.2.4-0.sh"</span></span> EMAIL=<span class="hljs-string"><span class="hljs-string">"sh /opt/brother/scanner/brscan-skey/script/scantoemail-0.2.4-0.sh"</span></span> FILE=<span class="hljs-string"><span class="hljs-string">"sh /opt/brother/scanner/brscan-skey/script/scantofile-0.2.4-0.sh"</span></span> SEMID=b</code> </pre> <br>  On the scanner there are three buttons: enable / disable the scanner, start scanning and scanning on the USB flash drive. <br>  It was experimentally found out that the variable FILE = is responsible for the scan button. <br>  Change it to <br><pre> <code class="bash hljs">FILE=<span class="hljs-string"><span class="hljs-string">"sh /home/admin/file.sh"</span></span></code> </pre> <br>  Create a script /home/admin/file.sh <br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#! /bin/sh set +o noclobber # # $1 = scanner device # $2 = friendly name # ##   resolution=300 device=$1 ##      temp_dir=/tmp/scan_"`date +%Y-%m-%d-%H-%M-%S`" mkdir -p $temp_dir cd $temp_dir ##      if [ "`which usleep 2&gt;/dev/null `" != '' ];then usleep 10000 else sleep 0.01 fi ##  ##    =40 ##     ##    4 ##   ##     ,     ##     tiff &lt;u&gt;scanimage&lt;/u&gt; --batch-count=40 --source 'Automatic Document Feeder(centrally aligned,Duplex)' -x 210 -y 297 --device-name "$device" --resolution $resolution ‚Äìformat=tiff ##   tif-  jpg-   90% &lt;u&gt;convert&lt;/u&gt; -quality 90% *.tif im.jpg ##   tif-   rm *.tif ##  jpg- &lt;u&gt;exiftool&lt;/u&gt; -d %Y-%m-%d_%H.%M-%S%%-c.%%e "-filename&lt;FileModifyDate" $temp_dir ##   111        ## ..     ##     find . -size +111k -exec mv {} /srv/scan \; ##      rm -r $temp_dir ##  -  saned ##    ,    root cd /srv/scan chown saned:saned *.jpg</span></span></code> </pre> </div></div><br>  In the script, I stressed what was not in the system.  Install / create: <br>  a) for scanimage <br><pre> <code class="bash hljs">apt-get install libsane sane-utils</code> </pre><br>  b) to convert <br><pre> <code class="bash hljs">apt-get install imagemagick</code> </pre><br>  c) for exifrool <br><pre> <code class="bash hljs">apt-get install libimage-exiftool-perl</code> </pre><br>  d) create a ball / srv / scan visible on the local network as // server / scan for reading to all users <br><br>  We expose the rights to the script 600 <br><br>  8. <i>Not mandatory step.</i>  I changed the daemon startup script to track the status of the scanner keys / opt / brother / scanner / brscan-skey / brscan-skey as follows: <br><div class="spoiler">  <b class="spoiler_title">It was</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#! /bin/sh if [ "$1" = "-h" ] || [ "$1" = "--help" ]; then if [ "$2" = "2" ];then echo ' no option :register all MFCs' echo ' -t (--terminate) :terminate this tool' echo ' -a (--add MFC) :register the specified MFC' echo ' -d (--delete) MFC :exclude the specified MFC' echo ' -p (--passwd) PASSWORD :set the password' echo ' -u (--username) USERNAMR :set the user name' echo ' -l (--list) :list the available MFCs' echo ' -m (--mailto) :mail address (scan to e-mail)' echo ' --refresh :refresh setting' echo ' --reset :reset the configuration file' echo ' --diagnosis :print diagnosis data' echo ' -h --help :help' fi echo ' Copyright 2007-2012 Brother Industries, Ltd' exit 0 fi if [ "$1" = "-l" ] || [ "$1" = "--list" ]; then /opt/brother/scanner/brscan-skey/brscan-skey-0.2.4-0 $* exit 0 fi if [ "$1" = "-f" ];then /opt/brother/scanner/brscan-skey/brscan-skey-0.2.4-0 $* else /opt/brother/scanner/brscan-skey/brscan-skey-0.2.4-0 $*&amp; fi</span></span></code> </pre></div></div><div class="spoiler">  <b class="spoiler_title">It became</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#! /bin/sh if [ "$1" = "-h" ] || [ "$1" = "--help" ]; then ## if [ "$2" = "2" ];then echo ' no option :register all MFCs' echo ' -t (--terminate) :terminate this tool' echo ' -a (--add MFC) :register the specified MFC' echo ' -d (--delete) MFC :exclude the specified MFC' echo ' -p (--passwd) PASSWORD :set the password' echo ' -u (--username) USERNAMR :set the user name' echo ' -l (--list) :list the available MFCs' echo ' -m (--mailto) :mail address (scan to e-mail)' echo ' --refresh :refresh setting' echo ' --reset :reset the configuration file' echo ' --diagnosis :print diagnosis data' echo ' -h --help :help' ## fi echo ' Copyright 2007-2012 Brother Industries, Ltd' exit 0 fi if [ "$1" = "-l" ] || [ "$1" = "--list" ]; then /opt/brother/scanner/brscan-skey/brscan-skey-0.2.4-0 $* exit 0 fi if [ "$1" = "-f" ];then /opt/brother/scanner/brscan-skey/brscan-skey-0.2.4-0 $* else /opt/brother/scanner/brscan-skey/brscan-skey-0.2.4-0 $*&amp; fi</span></span></code> </pre> </div></div>  <sup>I just did not understand why we need the second argument.</sup> <br>  We add this script to autoload.  Add to /etc/rc.local <br><pre> <code class="bash hljs">/opt/brother/scanner/brscan-skey/brscan-skey</code> </pre> <br>  And you can run it: <br><pre> <code class="bash hljs">brscan-skey</code> </pre> <br>  To stop the demon <br><pre> <code class="bash hljs">brscan-skey -t</code> </pre> <br>  9. Make a script for periodic cleaning of the scan directory <br><div class="spoiler">  <b class="spoiler_title">/home/admin/del.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#! /bin/sh work_dir=/srv/scan archiv_dir=/srv/scan/ mkdir -p $archiv_dir ##    ,  -    cd $work_dir mv *.jpg $archiv_dir ## find -maxdepth 1 -type f -mtime +1 -exec mv {} $archiv_dir \; ##   7   cd $archiv_dir find . -type f -mtime +7 -delete</span></span></code> </pre> </div></div><br>  Script rights are 740 <br><br>  Using cron, you can assign the periodicity of the cleanup script execution.  But since every day after working day the server is turned off by briefly pressing the power button, I added to the /etc/acpi/powerbtn.sh file <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">##    /home/admin/del.sh</span></span></code> </pre> <br><br>  A short video demonstrating the operation of the scanner. <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/ckWz8mmrSqo%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhgnhBWPyF7QZbIZbVlUiMAYFs-GOQ" frameborder="0" allowfullscreen=""></iframe><br><br>  Thanks for attention! </habracut></div><p>Source: <a href="https://habr.com/ru/post/187168/">https://habr.com/ru/post/187168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../187154/index.html">Spaghetti article about spaghetti code</a></li>
<li><a href="../187158/index.html">Russian Open Quadcopter Championship</a></li>
<li><a href="../187162/index.html">Just5 Brick Presentation: How I Met Thomofon + Answers to Habroid Questions</a></li>
<li><a href="../187164/index.html">HttpRequest - a library for easy work with the HTTP protocol</a></li>
<li><a href="../187166/index.html">Sound transmission through pictures in social networks</a></li>
<li><a href="../187170/index.html">Sony is preparing a camera that connects to the smartphone</a></li>
<li><a href="../187172/index.html">Simple Inter-Process Communication in C #</a></li>
<li><a href="../187176/index.html">Map with projections from Proj4js to Canvas</a></li>
<li><a href="../187178/index.html">Symfony2 subscribe to dynamic events</a></li>
<li><a href="../187182/index.html">Using XML on the example of offline work with documents</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>