<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WCF REST services and UWP applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quite a frequent question that arises for those who are trying to develop under UWP is ‚ÄúHow does a UWP application get data from a SQL Server database...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WCF REST services and UWP applications</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/cdd/4f1/117/cdd4f1117c564c919ec1ef4f0a3ef1b5.jpg"></div><br>  Quite a frequent question that arises for those who are trying to develop under UWP is ‚ÄúHow does a UWP application get data from a SQL Server database?‚Äù.  Direct data can not be obtained.  Working with databases from UWP applications requires a customized web service. <br><br>  Client application developers are usually far from creating server backends, but they need at least an idea of ‚Äã‚Äãservices. <br><br>  Under the cat a description of how to create a local WCF REST service and retrieve data from it using a UWP application.  The service will be able to receive data from a SQL Server database created in Azure (but similarly, you can get data from any local database).  In addition, so that everything does not look very trite, the possibility of placing the service itself in Azure to work with it from the same client UWP application will be considered. <br><a name="habracut"></a><br><h4>  Creating a REST service </h4><br>  In order to test our UWP applications, we will create a simple service.  I will describe the creation of WCF, and not Web API 2 service, since I was last interested in writing a backend several years ago (and not because it has advantages). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/021/854/bcd/021854bcd31a4521b38541e754924228.PNG"><br><br>  Delete the example code that will be created for us automatically. <br><br><div class="spoiler">  <b class="spoiler_title">Code that is removed</b> <div class="spoiler_text">  From IService1.cs <br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">OperationContract</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span>; [OperationContract] <span class="hljs-function"><span class="hljs-function">CompositeType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDataUsingDataContract</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CompositeType composite</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Add your service operations here // Use a data contract as illustrated in the sample below to add composite types to service operations. [DataContract] public class CompositeType { bool boolValue = true; string stringValue = "Hello "; [DataMember] public bool BoolValue { get { return boolValue; } set { boolValue = value; } } [DataMember] public string StringValue { get { return stringValue; } set { stringValue = value; } } }</span></span></code> </pre> <br>  From Service1.svc.cs <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"You entered: {0}"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CompositeType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDataUsingDataContract</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CompositeType composite</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (composite == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-string"><span class="hljs-string">"composite"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (composite.BoolValue) { composite.StringValue += <span class="hljs-string"><span class="hljs-string">"Suffix"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> composite; }</code> </pre> <br></div></div><br>  We add the following contract operation and class code to IService1.cs: <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">ServiceContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IService1</span></span> { [WebGet(UriTemplate = <span class="hljs-string"><span class="hljs-string">"/GetScheduleJson"</span></span>, RequestFormat = WebMessageFormat.Json, ResponseFormat = WebMessageFormat.Json, BodyStyle = WebMessageBodyStyle.Bare)] <span class="hljs-function"><span class="hljs-function">List&lt;Timetable&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetScheduleJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } [DataContract] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Timetable</span></span> { [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTime arrivaltime { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Int16 busnumber { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> busstation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br>  The arrival time field could be made of type TimeSpan, but it is much more convenient to work with DateTime later in JSON.  You can also specify the format of WebMessageFormat.Xml in the contract operation.  The operation itself is marked with the attribute WebGet, and therefore returns the result.  If you just need to execute the code, you can mark the operation WebInvoke. <br><br>  And in Service1.svc.cs we add the following code: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Timetable&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetScheduleJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetSchedule(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> List&lt;Timetable&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSchedule</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { List&lt;Timetable&gt; Schedule = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Timetable&gt; { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timetable { id=<span class="hljs-number"><span class="hljs-number">1</span></span>, arrivaltime=DateTime.Parse(<span class="hljs-string"><span class="hljs-string">"12:05:00"</span></span>), busnumber=<span class="hljs-number"><span class="hljs-number">5</span></span>, busstation =<span class="hljs-string"><span class="hljs-string">""</span></span> }, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timetable { id=<span class="hljs-number"><span class="hljs-number">2</span></span>, arrivaltime =DateTime.Parse(<span class="hljs-string"><span class="hljs-string">"12:10:00"</span></span>), busnumber=<span class="hljs-number"><span class="hljs-number">5</span></span>, busstation =<span class="hljs-string"><span class="hljs-string">" "</span></span> } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Schedule; }</code> </pre> <br>  Easily configure Web.config.  Add endpointBehavior to the behaviors section: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">endpointBehaviors</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">behavior</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"restBehavior"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">webHttp</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">behavior</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">endpointBehaviors</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  And below, in the already existing code, add the name attribute with the value ‚Äúservicebehavior‚Äù to the behavior tag: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">serviceBehaviors</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">behavior</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"servicebehavior"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- To avoid disclosing metadata information, set the values below to false before deployment --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">serviceMetadata</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">httpGetEnabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">httpsGetEnabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- To receive exception details in faults for debugging purposes, set the value below to true. Set to false before deployment to avoid disclosing exception information --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">serviceDebug</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">includeExceptionDetailInFaults</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">behavior</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">serviceBehaviors</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Now we can add the service and endpoint to the root of the system.serviceModel tag: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">services</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag"> =</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ServiceForUWP.Service1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">behaviorConfiguration</span></span></span><span class="hljs-tag"> =</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"servicebehavior"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">endpoint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag"> =</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RESTEndPoint"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contract</span></span></span><span class="hljs-tag"> =</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ServiceForUWP.IService1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">binding</span></span></span><span class="hljs-tag"> =</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"webHttpBinding"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">address</span></span></span><span class="hljs-tag"> =</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">behaviorConfiguration</span></span></span><span class="hljs-tag"> =</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"restBehavior"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">services</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  We get a ready service. <br><br>  By running debugging (you need to select a project in Solution Explorer) and open in browser (in my case, port 64870) <br> <code>http://localhost:64870/Service1.svc/GetScheduleJson</code> <br>  we will receive result in the form of JSON: <br>  [{"Arrivaltime": "\ / Date (1487408400000 + 0300) \ /", "busnumber": 5, "busstation": "Birch", "id": 1}, {"arrivaltime": "\ / Date ( 1487408700000 + 0300) \ / "," busnumber ": 5," busstation ":" Children's World "," id ": 2}] <br><br>  If we want to return the data filtered by any parameter, we can change the operation to something similar: <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">WebGet(UriTemplate = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/GetScheduleJson/{id}"</span></span></span><span class="hljs-meta">, RequestFormat = WebMessageFormat.Json, ResponseFormat = WebMessageFormat.Json, BodyStyle = WebMessageBodyStyle.Bare)</span></span>] <span class="hljs-function"><span class="hljs-function">List&lt;Timetable&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetScheduleJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br>  Now implementing the method <pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">List&lt;Timetable&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetScheduleJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span></code> </pre>  we will get the result by going to <code>http://localhost:64870/Service1.svc/GetScheduleJson/1</code> .  In this case, 1 is the parameter passed to the method. <br><br><h4>  Creating a client UWP application </h4><br>  Retrieving data from a UWP application is simple.  There are 2 options: use Windows.Web.Http.HttpClient or System.Net.Http.HttpClient. <br><br>  Both clients can be used in UWP applications.  The Web is a bit newer (it was released in 8.1), and it is more suitable for native development under UWP.  If you plan to use the code in ASP.NET applications or in Xamarin applications for other mobile platforms, then you better take the Net client.  In addition, at the moment the Web client has more settings and features (for example, the ability to use a special SSL certificate for authentication). <br><br>  Actually, in .NET Core for UWP applications, System.Net.Http is a wrapper over the Windows.Web.Http component.  But this wrapper supports the same API as the System.Net.Http space from .NET. <br><br>  Further two simple examples of receiving data from the service: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uri = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"http://localhost:64870/service1.svc/GetScheduleJson"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Windows.Web.Http.HttpClient(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> json = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> client.GetStringAsync(uri); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uri = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"http://localhost:64870/service1.svc/GetScheduleJson"</span></span>); System.Net.Http.HttpClient client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Net.Http.HttpClient(); System.Net.Http.HttpResponseMessage responseGet = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> client.GetAsync(uri); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> json = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> responseGet.Content.ReadAsStringAsync();</code> </pre> <br>  In order to deserialize the data, you can use the NuGet package Newtonsoft.Json: <br><br><pre> <code class="cs hljs">List&lt;Timetable&gt; appsdata = JsonConvert.DeserializeObject&lt;Timetable&gt;(json);</code> </pre><br>  Of course, you must also add the code of the Timetable class (exactly the same as in the service application). <br><br><h4>  Create SQL Server Database in Azure </h4><br>  Creating a database in Azure is easy.  You need to go to the portal and fill in the following fields: <br><br><img src="https://habrastorage.org/files/a79/757/9ce/a797579ce7c24ffcb6494a300b370e9f.PNG"><br><br>  It remains only to choose a price category.  Prices start at 5 USD per month.  This amount will cover the bonus received from the free registration in <a href="https://www.visualstudio.com/dev-essentials/">Dev Essentials</a> (25 USD is given every month during the year).  At registration, you must bind the card.  For such registrations, as a rule, an additional card is created, the limit of which can be adjusted. <br><br>  The ASP.NET connection string (SQL authentication) to the database in this case will be: <br><br><pre> <code class="cs hljs">Server=tcp:timetableserverok.database.windows.net,<span class="hljs-number"><span class="hljs-number">1433</span></span>;Initial Catalog=timetabledb;Persist Security Info=False;User ID={your_username};Password={your_password};MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=<span class="hljs-number"><span class="hljs-number">30</span></span>;</code> </pre> <br>  You can view it by accessing the database properties in the Azure portal.  In order to be able to access the database from the current machine, you need to add its IP to the firewall list. <br><br><img src="https://habrastorage.org/files/18a/5b6/c0f/18a5b6c0f84b45e2ba3dbc3aea720658.PNG"><br><br>  Editing is possible from the Server Explorer window of Visual Studio. <br><br><img src="https://habrastorage.org/files/df0/390/fac/df0390fac4dc4bdc882abb70f2c60287.PNG"><br><br><img src="https://habrastorage.org/files/9a1/918/283/9a19182832b04703834d4e9983cba1ab.PNG"><br><br>  Create some table <br><br><img src="https://habrastorage.org/files/79e/1a3/687/79e1a36879dd43faaf612612015c067e.PNG"><br><br>  And enter any test data. <br><br><h4>  Getting service data from SQL Server </h4><br>  In order to "pull" the data from the database, we need to make small changes to the project of our service.  Add two namespaces: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Data; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Data.SqlClient;</code> </pre> <br>  Variable containing the text of the connection string to the SQL Server database: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ConnectionString = <span class="hljs-string"><span class="hljs-string">"Server=tcp:timetableserverok.database.windows.net,1433;Initial Catalog=timetabledb;Persist Security Info=False;User ID=alexej;Password=_;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;"</span></span>;</code> </pre> <br>  I use the newly created database in Azure, but, as already mentioned, you can connect to any databases, including local ones (in this case, of course, you will need to replace the connection string). <br><br>  Now, in order to "pull" the data from the database, you need to change the code of the GetSchedule method to the following: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> List&lt;Timetable&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSchedule</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (DataSet ds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataSet()) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (SqlConnection sqlCon = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SqlConnection(ConnectionString)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { sqlCon.Open(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> sqlStr = <span class="hljs-string"><span class="hljs-string">"select * from Timetable"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (SqlDataAdapter sqlDa = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SqlDataAdapter(sqlStr, sqlCon)) { sqlDa.Fill(ds); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { sqlCon.Close(); } } List&lt;Timetable&gt; Schedule = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Timetable&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (DataTable dt = ds.Tables[<span class="hljs-number"><span class="hljs-number">0</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (DataRow dr <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dt.Rows) { Schedule.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timetable() { id = Convert.ToInt16((dr[<span class="hljs-string"><span class="hljs-string">"ID"</span></span>])), arrivaltime = DateTime.Parse(dr[<span class="hljs-string"><span class="hljs-string">"arrivaltime"</span></span>].ToString()), busnumber = Convert.ToInt16((dr[<span class="hljs-string"><span class="hljs-string">"busnumber"</span></span>] ?? <span class="hljs-number"><span class="hljs-number">0</span></span>)), busstation = dr[<span class="hljs-string"><span class="hljs-string">"busstation"</span></span>].ToString() }); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Schedule; } }</code> </pre> <br><h4>  Creating a cloud service </h4><br>  To place a service in Azure, you need to download and install the <a href="https://www.visualstudio.com/vs/azure-tools/">Azure SDK for .NET</a> (approximately 450 MB) and create a new project of a special type of Cloud Service. <br><br><img src="https://habrastorage.org/files/f3b/6b3/1d4/f3b6b31d42dd470ab6feb6e6a1609ae5.PNG"><br><br>  Choose a role and rename it to your taste <br><br><img src="https://habrastorage.org/files/049/7de/136/0497de136c3c456c8da10991603d5b51.PNG"><br><br>  As a result, we will have two projects: AzureCloudServiceTimetable and TimetableService <br>  In the second (TimetableService) we can copy the code from our local service.  Namely - the contents of the files IService1.cs, Service1.svc.cs, Web.config.  After that, the project can be tested.  You can make changes in the Web.config file before publishing.  In tag <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">serviceMetadata</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">httpGetEnabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">httpsGetEnabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  change values ‚Äã‚Äãto false <br><br>  To publish to Azure, you need to create packages.  On the AzureCloudServiceTimetable project, you need to call the context menu and select Package. <br><br><img src="https://habrastorage.org/files/44d/3aa/eec/44d3aaeeca4a414fb2fc19193f3a90fb.PNG"><br><br>  After the process is complete, the directory with the package and the configuration file will be opened. <br>  You can publish to Azure using the portal‚Äôs web interface.  We go to the portal.  Select the item Cloud services (classic), create a new one and fill in the fields <br><br><img src="https://habrastorage.org/files/8b8/426/050/8b84260505004753bf6c96929368d697.PNG"><br><br>  It is necessary to set 2 checkboxes: ‚ÄúDeploy, even if one or several roles contain a separate instance‚Äù and ‚ÄúStart deployment‚Äù.  After deployment and launch (it may take some time to start) you can make a request by URI: <br><br> <code>http://servicetimetable.cloudapp.net/Service1.svc/GetScheduleJson</code> <br> <br>  This address can be used in the UWP application.  Deployment Details: <a href="https://docs.microsoft.com/ru-ru/azure/cloud-services/cloud-services-how-to-create-deploy-portal">Creating and Deploying a Cloud Service</a> <br><br>  <b>PS:</b> Thanks to the user <a href="https://habrahabr.ru/users/dmitry_dvm/" class="user_link">dmitry_dvm</a> for clarifying / editing </div><p>Source: <a href="https://habr.com/ru/post/322202/">https://habr.com/ru/post/322202/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../322192/index.html">How we created a hosting provider with our own data center (continued)</a></li>
<li><a href="../322194/index.html">The book "The Basics of Data Science and Big Data. Python and the science of data "</a></li>
<li><a href="../322196/index.html">IBM gives access to the main component of Watson</a></li>
<li><a href="../322198/index.html">Bugs from the USSR</a></li>
<li><a href="../322200/index.html">Go global strategies for startups</a></li>
<li><a href="../322206/index.html">61 ways to improve your site's SEO</a></li>
<li><a href="../322208/index.html">Immunitable data in C ++</a></li>
<li><a href="../322212/index.html">Dagaz: Architecture</a></li>
<li><a href="../322214/index.html">Development of transactional microservices using Aggregates, Event Sourcing and CQRS (Part 2)</a></li>
<li><a href="../322216/index.html">How to develop a cross-platform application using only JSON markup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>