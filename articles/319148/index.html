<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What to do if the cables have ears, or a steganographic proxy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon. Today I will tell you about one type of paranoia associated with the latest trends in the state protection of the population from info...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What to do if the cables have ears, or a steganographic proxy</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon.  Today I will tell you about one type of paranoia associated with the latest trends in the state protection of the population from information, and the method of its treatment. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c26/6ea/540/c266ea5409674bb9b8428e0621b29ab4.jpg" alt="image"></div><a name="habracut"></a><br><h3>  World of censorship </h3><br>  The fact is that recently the active distribution of Roskomnadzor, SORM, gold shields, root certificates, black FBI vans and other methods of interception / restriction / substitution of traffic on everyone‚Äôs favorite Internet began. <br><br>  Against this background, many began to have a disease, beautifully described by the phrase "the walls have ears."  And it would have been without a reason - but all your data goes through routes that are unknown to you, through black boxes that do not belong to you, servers that you do not control, and soon all this will also be saved.  Well, how can you not get nervous? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      They say encryption will save everyone.  But is it?  By omitting the problems of classical and modern cryptography, one way or another, encrypted traffic can always be relatively easy to detect and tritely cover the transmission channel.  And here steganography comes to the rescue. <br><br>  To penetrate and understand why we need it, let's look at the classical scheme of transferring traffic from Alice to Bob on the Internet: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c03/f3d/970/c03f3d970a7c4df98f5dc561264654ba.jpg"></div><br>  We take into account that the Internet and communication channels in it are beyond our control and vulnerable by design.  Moreover, between Alice and Bob, there is someone who <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25BD%25D0%25B5%25D1%2582-%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25B9%25D0%25B4%25D0%25B5%25D1%2580">controls</a> the transmission medium and <a href="https://rkn.gov.ru/">restricts</a> ( <a href="https://habrahabr.ru/post/272207/">listening to</a> / inserting her word) their message exchange. <br><br>  In fact, transmission via data via the Internet increasingly resembles the problem of prisoners. <br><br>  And the scheme looks like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/7fb/b79/1ce/7fbb791ceb6f4e1886b052b76e3bf8f4.jpg"></div><br>  Where Willy is not a gardener, as it seems at first glance, but a security guard, restricting the transfer of any messages to Bob.  Alice is a free man (or a prisoner in another cell), with whom Bob wants to communicate bypassing the guard. <br><br>  Accordingly, the task of steganography is that the security guard simply does not notice the exchange of messages.  And who exactly is the guard - pkn or FBI van - special cases. <br><br><h3>  And what have the proxy? </h3><br><ul><li>  Bob is software on a controlled device, through which you really want free exchange of information, regardless of its position in the world. </li><li>  Willy is evil providers, regulators, corporate proxy servers, and others who want to stop this exchange. </li><li>  Alice is the gateway through which we receive information from the external (or other internal) world. </li></ul><br>  Depending on the situation, between Alice and Bob can be both a controlled communication channel by Willy, his (channel) may not be in principle.  For the sake of truth, it is worth noting that few people completely cut off communication channels, and even behind a great firewall you can, if you wish, sit on Facebook.  So this case will be the first and easiest option. <br><br>  The steganographic channel will then be created simply on top of the previously known channel controlled by Willy.  Consider as an example the implementation using ordinary sockets. <br><br>  A stegokanal is created by connecting Bob to Alice via a socket on a pre-set port. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/702/7e9/166/7027e91666d34eda97410362ac232fad.jpg"></div><br>  The resulting scheme is simple and reliable.  But, this is not exactly steganography.  For Willy, it is quite obvious that the exchange of pictures on non-standard ports is no accident.  Partially, you can reduce the level of suspicion using standard ports and protocols.  For example, file sharing via FTP.  In general, one of the fastest and most convenient options.  You can use it as long as the degree of inadequacy and suspicion on the part of Willy is not very high. <br><br><h4>  Now imagine that Willie forbade Bob to exchange messages with Alice.  At all. </h4><br>  Then, to create a steganographic tunnel (a channel without a direct link), a shared resource is needed.  A classic example is social networks - accessible from most points of the world, public.  Ideal for the exchange of steganograms, not quite suitable for proxies due to the need for a large flow of information.  However, sekyurnost requires sacrifice.  In this case, the victim will fall speed, but more on that later.  Consider the implementation using the VC as a public medium of exchange: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a18/2bb/b8a/a182bbb8ae9f45d29ed749e8b644246e.jpg"></div><br>  This scheme relies on third-party service, which means it is completely dependent on it.  On the other hand, the exchange of pictures between users does not cause any suspicion, even with a high frequency (bots, for the most part, are legal).  From the minuses we get reduced throughput and the ability to be without a communication line at the right moment - if usually a spare channel is optional, then this is a prerequisite for work. <br><br><h3>  And now about the implementation itself and what happened </h3><br>  Bob is implemented as a normal proxy relay type [Socket-Stegochanel], listening to a specific port.  He hides all the data arriving at him in stegocontainers using a pre-negotiated algorithm and sends it to Alice's stego channel.  All recording and extraction operations are carried out with a secret established beforehand (in steganography, in principle, it is possible without it, there are no restrictions on the implementation). <br><br>  Alice of the [Stegochanel-Socket] type receives all traffic from Bob through the stegokanal, extracts it from the stegocontainers and redirects to the real proxy the server you want to use, allocating a separate connection to the proxy for each instance of the stegokanal (to avoid confusion).  After all, who knows in advance what kind of traffic and why you need to send, right? <br><br><h4>  And how does it work? </h4><br>  For testing, I rented a cheap ARM server in France as a proxy server, deployed Ubuntu 16.10 and Squid along with a repeater on it.  All measurements were taken from home with the Internet at 5 Mbps through ADSL of the national Russian provider.  If someone wants to check at normal speed, I‚Äôll leave links to GitHub at the end. <br><br>  As a proof of concept, I implemented a stegokanal over sockets.  If there is interest, I will conduct similar testing for implementation with VK as a medium of exchange.  The algorithm is its own version of the LSB method with a maximum capacity of about a quarter of bytes of the total number of pixels, working with images without compression, which I may write about later.  At first, a single image of Che Guevara was used as a container in png with a resolution of 518x587. <br><br>  Test results as a proxy in firefox without any plug-ins and add.  settings: <br><br><ul><li>  wikipedia.org - 1:13; </li><li>  en.wikipedia.org - 2:01, after that, communication with the server continues, but the entire content is already loaded; </li><li>  google.com (.fr) - ~ 2m, hints do not work, search results are loaded by the minute; </li><li>  duckduckgo.com - did not load in 10 minutes; </li><li>  txti.es - ~ 3s per page.  True, fast web pages; </li><li>  garfield.vexer.ru - 1:35.  Advertising did not load (and the adblock is not needed); </li><li>  reddit.com - it loads for a very long time (more than 10 minutes), it loads something, but you hardly have enough patience; </li><li>  bing.com - 1:45 full download.  ~ 50 seconds per search results page; </li><li>  jcgonzalez.com - not loaded; </li><li>  minergate.com - 4m; </li><li>  vk.com - ~ 1m, images load longer, dialogs run fast; </li><li>  linkedin.com - ~ 50c, but the huge image background will load for a long time; </li><li>  weather.com - not loaded; </li></ul><br>  It should be noted that such speeds (very modest, especially if you look at the calendar) are explained not only by the fact that steganography transmits an excessive amount of information, but also by the overhead of the steganographic algorithm itself.  And it would be strange to expect from an ARM server for 3 green presidents something unusual in terms of performance.  Renting a faster server gives a strong acceleration (2 times on the old weak x86 server). <br><br>  By turning off images and media elements, turning on the adblock, the speed can be increased.  Moving the same method about 10 years (15?) Ago, we obtain the corresponding page loading speed corresponding to the same time.  But in general, the conclusion remains the same - <b>such a</b> steganographic proxy is only suitable for emergency cases. <br><br>  Impressions of such an Internet are far from positive.  Perhaps with other methods of steganography, or simply by optimizing mine, you can achieve great results.  However, so far, the resulting Proof of Concept only says that such a proxy is only suitable for emergency cases.  That, in fact, is not particularly surprising.  Or unexpectedly.  Most of the problems with delays are timings when shaking hands in ssl.  Here you have the universal plant https. <br><br>  Having thought it over, it was decided to replace poor static Che Guevara with random images with minimal redundancy.  After all, if you transmit not 16 times more information, but 4, then theoretically, we will get a nice bonus to speed.  Fortunately, the generators of random images of a given size on the Internet is full. <br><br>  Results from retesting: <br><br><ul><li>  wikipedia.org - 21s; </li><li>  en.wikipedia.org - 21s; </li><li>  google.com (.fr) - 23s to work, 45s to full load, 3s to issue; </li><li>  duckduckgo.com - 45s to work, 55s to full load; </li><li>  txti.es - instantly; </li><li>  garfield.vexer.ru - 1:10 with advertising, the next strips are loaded for 10 seconds each, since all the hardest is already in the cache; </li><li>  reddit.com - 44c without content, 1:20 with its preview; </li><li>  bing.com - 13c full download, 5c for issue with pictures; </li><li>  jcgonzalez.com - fell, but 404 issues quickly; </li><li>  minergate.com - 1m; </li><li>  vk.com - 23c, pages with messages of 10 seconds or more, depending on the content; </li><li>  linkedin.com - 40c; </li><li>  weather.com - not loaded; </li></ul><br>  It is already possible to live with such an Internet, especially if there are few alternatives.  Steganographic stability falls with an increase in the ratio of noise / useful information, to donate or not - it's not up to me to decide. <br>  On this I consider the experiment completed.  The sources, binaries, instructions for use and help are on the github below.  If there are additional questions - I will wait in the comments. <br><br>  ‚Üí <a href="https://github.com/LabunskyA/StegoProxy">GitHub</a> </div><p>Source: <a href="https://habr.com/ru/post/319148/">https://habr.com/ru/post/319148/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../319138/index.html">How to start implementing Hadoop in the company</a></li>
<li><a href="../319140/index.html">Third-party applications that use the Google Hangouts API will stop working after April 25, 2017</a></li>
<li><a href="../319142/index.html">Ludum Dare # 37: First Experience and Participation Experience</a></li>
<li><a href="../319144/index.html">learnopengl. Lesson 1.7 - Transformations</a></li>
<li><a href="../319146/index.html">How IT professionals work. Nikita Abdullin, security analyst at Riscure</a></li>
<li><a href="../319150/index.html">Non-standard XMPP protocol support with Smack</a></li>
<li><a href="../319152/index.html">Script for removing old drivers</a></li>
<li><a href="../319154/index.html">nanoCAD Plus 8.1: what does the user expect in the new version of the Russian CAD system?</a></li>
<li><a href="../319156/index.html">Webpack in Visual Studio for large solutions</a></li>
<li><a href="../319158/index.html">SSH instead of VPN</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>