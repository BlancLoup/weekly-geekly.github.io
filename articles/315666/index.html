<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How Phoenix Kills React</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About one and a half years ago we wrote an internal tool for corporate announcements. Initially, it used Phoenix for the backend and React for the fro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How Phoenix Kills React</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/393/bdc/820/393bdc82063645699c7fa2685252430a.png"><br><br><p>  About one and a half years ago we wrote an internal tool for corporate announcements.  Initially, it used Phoenix for the backend and React for the frontend.  Thus, we got the benefits of Redux and Phoenix channels when delivering updates to the browser in real time. </p><br><p>  This allowed us to get a great live interface, but slowed down the development speed and caused a small number of developers involved in the process.  About three months ago we decided to throw out React and return to server rendering. </p><br><h2>  Why we decided to replace React </h2><br><p>  Real-time update allows you to better immerse yourself in the work with the application, but it also has additional costs. </p><a name="habracut"></a><br><h3>  Development cost </h3><br><p>  Instead of adding a new feature in one place, we had to deal with it both in the API part and in the UI part.  It also meant that every developer who wants to add his own contribution to the project should know <em>both React and Phoenix</em> , which discouraged them from trying to get involved in the work. </p><br><h3>  Testing </h3><br><p>  Testing was another sore point when working with the React code.  Since the application and the client were separated, it was necessary to be sure that the answers of our test server simulation are always relevant.  In practice, this was not a serious problem, but several times it still stuck a stick in the wheels, reducing our confidence in the tests. </p><br><h3>  Contribute to the project </h3><br><p>  Finally, we wanted more people to be involved in the work on the project.  We found that implementing the functionality in two places is much more labor intensive compared to working in a single place.  And trying to coordinate backend and front-end developers is quite tiresome.  This is especially important since the work on this application occurs in our ‚Äútime for development‚Äù. </p><br><h2>  Replacement process </h2><br><p> Due to the fact that we already had a ready-to-use API, we were able to rewrite pages on Phoenix and turn on production without affecting the existing front-end on React.  Since the application is mostly a CRUD, most of the pages were simply replicated one-to-one, only replacing the <code>className</code> with <code>class</code> and blocks <code>{}</code> with <code>&lt;%= %&gt;</code> . </p><br><p>  In places where we needed JavaScript, we went the beaten track of ‚Äúinterspersing‚Äù pieces on it.  The best example of this approach is a live update of comments.  Whenever a comment is created on the backend, we broadcast it to all users.  Instead of sending JSON, we create a <code>live-html</code> channel through which we transmit updates in the form of HTML.  Here is the JavaScript code straight from the application: </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> socket <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./socket'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> channel = socket.channel(<span class="hljs-string"><span class="hljs-string">'live-html'</span></span>, {}) channel.join() .receive(<span class="hljs-string"><span class="hljs-string">'ok'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Joined successfully'</span></span>, resp) }) .receive(<span class="hljs-string"><span class="hljs-string">'error'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Unable to join'</span></span>, resp) }) channel.on(<span class="hljs-string"><span class="hljs-string">'new-comment'</span></span>, payload =&gt; { $(<span class="hljs-string"><span class="hljs-string">`[data-announcement-id='</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${payload.announcement_id}</span></span></span><span class="hljs-string">'] .comments-list`</span></span>) .append(payload.comment_html) })</code> </pre> <br><p>  This surprisingly small amount of JavaScript code provides a huge piece of the functionality of our application.  Such a strategy for generating HTML on the server and transmitting it to clients is much easier than writing a full-fledged front-end application with the same features. </p><br><p>  We also added Turbolinks here, which made the update of the page very smooth and allowed us to get a feeling of SPA. </p><br><h2>  results </h2><br><p>  Full migration was relatively painless.  We came to the conclusion that in a few months more people joined the project than in the whole year of using the frontend at React.  Tests have become much easier to write, at the same time they have become much more reliable.  After all, now it‚Äôs not necessary that the server test responses are different from the real ones. </p><br><p>  Despite the fact that many of the company's employees knew about the ongoing migration, we did not tell anyone that we had poured changes into production.  Not a single person mentioned a noticeable difference.  Also, no one understood that the application they used was no longer based on React.  All thanks to the speed of Phoenix with its significantly shorter page return time and the lack of loading a large piece of data from the frontend application to React. </p><br><h2>  Lessons learned </h2><br><p>  At the end of our work, we understood and proved to ourselves that we can write applications on Phoenix with server rendering, which will work just as perfectly as SPA applications on a separate framework.  Not only did the finished product turn out to be just as cool, we also began to add new features faster, could be confident in the tests and it was easier to attract developers to participate in the project.  In general, I think it was a big victory. </p><br><p>  Have you refused any front-end frameworks lately? </p><br><h2>  Conclusion from the Wuns </h2><br><p>  Friends!  The next article is about creating a blog in Phoenix in a week.  Today we decided to discuss another interesting topic related to this framework. </p><br><p>  I remind you that we are holding a <a href="https://wunsh.ru/first_contest.html%3Futm_source%3Dhabr%26utm_medium%3Dcontent%26utm_campaign%3Dfirst_contest">contest with a cool prize</a> for the victory in which you need to publish a cool article about the Elixir on Habr√©.  And also urge you to actively <a href="https://wunsh.ru/%3Futm_source%3Dhabr%26utm_medium%3Dcontent%26utm_campaign%3Dsubscribe">subscribe to the newsletter</a> .  Twice a week we send new articles to the mail, which is not yet publicly available on the site!  Thanks to everyone who stays with us! </p><br>  <i><s>* The title to activate the heated discussions, filled with joy and good, in the comments.</s></i> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/315666/">https://habr.com/ru/post/315666/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../315652/index.html">JetBrains Night in Moscow. Video. First steps with TeamCity DSL</a></li>
<li><a href="../315654/index.html">File system, cheap and fast</a></li>
<li><a href="../315656/index.html">Tracking Problems: How Mobile Workers Cheat Companies Due to Control Technology Deficiencies</a></li>
<li><a href="../315660/index.html">Some subtleties of using Service Workers</a></li>
<li><a href="../315664/index.html">Configuring Virtual Private Network on AWS EC2 from OpenVPN on Linux</a></li>
<li><a href="../315668/index.html">Code for which I still feel ashamed</a></li>
<li><a href="../315672/index.html">Kemerovo hackathon "DevTime"</a></li>
<li><a href="../315674/index.html">Competition of projects in the field of advertising technologies Go to AdTech</a></li>
<li><a href="../315676/index.html">Extensions to C and C ++. Part 1</a></li>
<li><a href="../315678/index.html">Https support without any settings</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>