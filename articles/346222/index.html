<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Letter to the Turkish Sultan" or linear regression on C # using Accord.NET for the analysis of open data in Moscow</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When it comes to mastering the very basics of machine learning, it is often suggested to study the corresponding tools in Python or R. We will not dis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Letter to the Turkish Sultan" or linear regression on C # using Accord.NET for the analysis of open data in Moscow</h1><div class="post__text post__text-html js-mediator-article">  When it comes to mastering the very basics of machine learning, it is often suggested to study the corresponding tools in <a href="https://habrahabr.ru/company/piter/blog/263457/">Python or R.</a>  We will not discuss their pros and cons, but just ask ourselves what to do if you are familiar only with the .NET ecosystem, but at the same time you are very curious to plunge into the world of data science?  The answer is simple, do not despair and look towards <a href="http://fsharp.org/guides/data-science/">F #</a> , and if you also, like me from .NET, only know the basics of C #, then try to learn the <a href="http://accord-framework.net/">Accord.NET Framework</a> . <br><br>  We have already analyzed its use for solving <a href="https://habrahabr.ru/post/337438/">the classification problem</a> , and this time we will try to consider the simplest tools for linear regression.  To do this, we will use open data on the analysis of citizens' appeals taken from the official <a href="https://www.mos.ru/feedback/reviews/">website of the Mayor of Moscow</a> . <br><br>  Despite the fact that the title of the article is <b>C #</b> , we will try to build code on <b>VB.NET</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I just need to invite you under the cat! <br><br><img src="https://habrastorage.org/webt/tl/cm/_p/tlcm_peakreh_o-nrwvik2ecvrq.jpeg"><br><a name="habracut"></a><br><a name="I"></a><br>  In order to <b>avoid <a href="https://habrahabr.ru/post/343216/">such comments</a></b> , right at the very beginning I will say that <b>I have nothing to do with the Moscow government</b> , governments, prefectures, etc.  therefore, <b>it makes no sense for me to complain about their work</b> .  I just accidentally found <a href="https://www.mos.ru/feedback/reviews/">this data</a> , manually typed it in a tablet and put it on <a href="https://github.com/bosonbeard/Funny-models-and-scripts/tree/master/3.Machine_learning/1.msc_mayor_app">GitHub</a> for you. <br><br>  Well, and if anyone is curious, then this article continues the mini-cycle on how I studied Data Science from scratch <i>(and so I did not really learn)</i> , if anyone is interested, then I hid references to other articles under the spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Other articles of the cycle</b> <div class="spoiler_text">  1. Learn the basics: <br><ul><li>  ‚Äú <a href="https://habrahabr.ru/post/331118/">Catch data big and small!</a>  "- (Overview of Cognitive Class Data Science Courses) </li><li>  " <a href="https://habrahabr.ru/post/331794/">Now he counted you</a> " or Data Science from Scratch </li><li>  ‚Äú <a href="https://habrahabr.ru/post/331992/">Iceberg instead of Oscar!</a>  "Or as I tried to learn the basics of DataScience on kaggle </li><li>  ‚Äú <a href="https://habrahabr.ru/post/335214/">‚Äú A train that could! ‚ÄùOr‚Äú Specialization Machine learning and data analysis ‚Äù, through the eyes of a newbie in Data Science</a> </li></ul><br>  2. Practice first skills <br><ul><li>  <a href="https://habrahabr.ru/post/337040">‚ÄúRise of Machinery Learning‚Äù or combine a hobby in Data Science and analyzing the spectra of light bulbs</a> </li><li>  <a href="https://habrahabr.ru/post/337438/">‚ÄúAs per the notes!‚Äù Or Machine Learning (Data science) in C # using Accord.NET Framework</a> </li><li>  <a href="https://habrahabr.ru/post/338124/">‚ÄúUse the Power of Machine Learning, Luke!‚Äù Or automatic classification of luminaires according to the CIL</a> </li><li>  <a href="https://habrahabr.ru/post/340698/">‚Äú4 weddings and one funerals‚Äù or linear regression for analyzing the open data of the Moscow government</a> </li></ul><br></div></div><br>  Honestly, I'm not a programmer, besides Accord.NET, I learned very superficially.  Unfortunately, there is not so much literature on it, and on-line courses were somehow not immediately found, so in many respects only the developer site remains, and it is not as informative as we would like. <br><br>  Therefore, with the data set proposed above, I carried out the main manipulations in the last <a href="https://habrahabr.ru/post/340698/">article of the cycle</a> (ibid also a more detailed description of the data set).  And in this article, we will creakly try to read the data, train the model and build some kind of graph. <br><br>  Content: <br><br>  <a href="https://habr.com/ru/post/346222/">Part I: introduction and some data</a> <br>  <a href="https://habr.com/ru/post/346222/">Part II: we write code on C #</a> <br>  <a href="https://habr.com/ru/post/346222/">Part III: we write the code on VB and the conclusion</a> <br><br>  Before you start writing code - two words about data. <br>  These are open data on the analysis of citizens' appeals sent to those or other executive bodies of the city of Moscow.  I must say that the statistics are scarce, while only 22 months. <br><br>  In fact, it could have been - 23 months, but in November, the developers provided an incomplete data set, and I did not include it. <br>  <a href="https://github.com/bosonbeard/Funny-models-and-scripts/tree/master/3.Machine_learning/1.msc_mayor_app">Data is presented in csv format.</a>  Data columns mean the following: <br><br> <code>num ‚Äì   <br> year ‚Äì   <br> month ‚Äì   <br> total_appeals ‚Äì      <br> appeals_to_mayor ‚Äì       <br> res_positive-    <br> res_explained ‚Äì       <br> res_negative ‚Äì      <br> El_form_to_mayor ‚Äì        <br> Pap_form_to_mayor -        to_10K_total_VAO‚Ä¶to_10K_total_YUZAO ‚Äì    10000      <br> to_10K_mayor_VAO‚Ä¶ to_10K_mayor_YUZAO‚Äì          10000      <br></code> <br>  I did not find a way to automate the data collection process and had to be collected by hand in the end, so that I could have made a slight mistake somewhere, well, the reliability of the data itself would be left to the authors. <br><br>  It remains to tell just a few words about the framework itself and you can go to the code. <br>  <a href="http://accord-framework.net/">Accord.NET</a> is an <b>open source project</b> , which in most cases can still be used for commercial development under the LGPL license.  It seems that the framework has all the basic tools needed for data analysis and machine learning, from testing statistical hypotheses to neural networks. <br><a name="II"></a><br>  Now you can go with a clear conscience to the code. <br>  I posted a solution with a project on C # and VB.NET for you on <a href="https://github.com/bosonbeard/Funny-models-and-scripts/tree/master/3.Machine_learning/1.msc_mayor_app/msc_vb_cs">GitHub</a> , you can just download it and try to build it (the idea is to start).  If you want to create a project yourself from scratch, then for a similar functionality you need to do the following: <br><br><ol><li>  Create a new project (I created a console project with Net Framework 4.5). </li><li>  Using the package manager (NuGet), install Accord.Controls version 3.8 (it will pull all the other packages we need) and Accord.IO for working with tables.  Also, for drawing graphics, you will need to include the standard Windows.Forms library.  That's actually all you can write code. </li></ol><br>  I will place the full code in C # under the spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Full code for C #</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Accord.Statistics.Models.Regression.Linear; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Accord.IO; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Accord.Math; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Data; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Accord.Controls; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Accord.Math.Optimization.Losses; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">cs_msc_mayor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//for separating the training and test samples int traintPos = 18; int testPos = 22; int allData = testPos + (testPos - traintPos); //for correct reading symbol of float point in csv System.Globalization.CultureInfo customCulture = (System.Globalization.CultureInfo)System.Threading.Thread.CurrentThread.CurrentCulture.Clone(); customCulture.NumberFormat.NumberDecimalSeparator = "."; System.Threading.Thread.CurrentThread.CurrentCulture = customCulture; //read data string CsvFilePath = @"msc_appel_data.csv"; DataTable mscTable = new CsvReader(CsvFilePath, true).ToTable(); //for encoding the string values of months into numerical values Dictionary&lt;string, double&gt; monthNames = new Dictionary&lt;string, double&gt; { ["January"] = 1, ["February"] = 2, ["March"] = 3, ["April"] = 4, ["May"] = 5, ["June"] = 6, ["July"] = 7, ["August"] = 8, ["September"] = 9, ["October"] = 10, ["November"] = 11, ["December"] = 12 }; string[] months = mscTable.Columns["month"].ToArray&lt;String&gt;(); double[] dMonths= new double[months.Length]; for (int i=0; i&lt; months.Length; i++) { dMonths[i] = monthNames[months[i]]; //Console.WriteLine(dMonths[i]); } //select the target column double[] OutResPositive = mscTable.Columns["res_positive"].ToArray(); // separation of the test and train target sample double[] OutResPositiveTrain = OutResPositive.Get(0, traintPos); double[] OutResPositiveTest = OutResPositive.Get(traintPos, testPos); //deleting unneeded columns mscTable.Columns.Remove("total_appeals"); mscTable.Columns.Remove("month"); mscTable.Columns.Remove("res_positive"); mscTable.Columns.Remove("year"); //add coded in a double column month into Table //create new column DataColumn newCol = new DataColumn("dMonth", typeof(double)); newCol.AllowDBNull = true; // add new column mscTable.Columns.Add(newCol); //fill new column int counter = 0; foreach (DataRow row in mscTable.Rows) { row["dMonth"] = dMonths[counter]; counter++; } //receiving input data from a table double[][] inputs = mscTable.ToArray(); //separation of the test and train sample double[][] inputsTrain= inputs.Get(0, traintPos); double[][] inputsTest = inputs.Get(traintPos, testPos); //simple linear regression model var ols = new OrdinaryLeastSquares() { UseIntercept = true }; //linear regression model for several features MultipleLinearRegression regression = ols.Learn(inputsTrain, OutResPositiveTrain); //make a prediction double[] predicted = regression.Transform(inputsTest); //console output for (int i = 0; i &lt; testPos - traintPos; i++) { Console.WriteLine("predicted: {0} real: {1}", predicted[i], OutResPositiveTest[i]); } // And print the squared error using the SquareLoss class: Console.WriteLine("error = {0}", new SquareLoss(OutResPositiveTest).Loss(predicted)); // print the coefficient of determination double r2 = new RSquaredLoss(numberOfInputs: 29, expected: OutResPositiveTest).Loss(predicted); Console.WriteLine("R^2 = {0}", r2); // alternative print the coefficient of determination double ur2 = regression.CoefficientOfDetermination(inputs, OutResPositiveTest, adjust: true); Console.WriteLine("alternative version of R2 = {0}", r2); Console.WriteLine("Press enter and close chart to exit"); // for chart int[] classes = new int[allData]; double[] mountX = new double[allData]; for (int i = 0; i &lt; allData; i++) { if (i&lt;testPos) { // for csv data mountX[i] = i+1; classes[i] = 0; //csv data is class 0 } else { //for predicted mountX[i] = i- (testPos - traintPos)+1; classes[i] = 1; //predicted is class 1 } } // make points of chart List&lt;double&gt; OutChart = new List&lt;double&gt;(); OutChart.AddRange(OutResPositive); OutChart.AddRange(predicted); // plot chart ScatterplotBox.Show("res_positive from months", mountX, OutChart.ToArray(), classes).Hold(); // for pause Console.ReadLine(); } } }</span></span></code> </pre><br></div></div><br>  In many ways, the solution of the linear regression problem is taken from the example from <a href="http://accord-framework.net/docs/html/T_Accord_Statistics_Models_Regression_Linear_MultipleLinearRegression.htm">the developers site</a> , everything is not very difficult there, but still let's sort the code in parts. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Accord.Statistics.Models.Regression.Linear; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Accord.IO; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Accord.Math; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Data; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Accord.Controls; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Accord.Math.Optimization.Losses;</code> </pre><br>  Load namespaces of third-party libraries. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">cs_msc_mayor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> {</code> </pre><br>  Create a namespace, class, main method - everything is trivial. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//for separating the training and test samples int traintPos = 18; int testPos = 22; int allData = testPos + (testPos - traintPos);</span></span></code> </pre><br>  We define variables that will be useful to us later to divide the data into control and training samples. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//for correct reading symbol of float point in csv System.Globalization.CultureInfo customCulture = (System.Globalization.CultureInfo)System.Threading.Thread.CurrentThread.CurrentCulture.Clone(); customCulture.NumberFormat.NumberDecimalSeparator = "."; System.Threading.Thread.CurrentThread.CurrentCulture = customCulture;</span></span></code> </pre><br>  It is useful for us, so that our fractional separator is read in the same way in the version of the project in python and in the version in .NET <i>(at least for me)</i> . <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//read data string CsvFilePath = @"msc_appel_data.csv"; DataTable mscTable = new CsvReader(CsvFilePath, true).ToTable();</span></span></code> </pre><br>  We read data from a csv file into a data table format. <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//for encoding the string values of months into numerical values Dictionary&lt;string, double&gt; monthNames = new Dictionary&lt;string, double&gt; { ["January"] = 1, ["February"] = 2, ["March"] = 3, ["April"] = 4, ["May"] = 5, ["June"] = 6, ["July"] = 7, ["August"] = 8, ["September"] = 9, ["October"] = 10, ["November"] = 11, ["December"] = 12 }; string[] months = mscTable.Columns["month"].ToArray&lt;String&gt;(); double[] dMonths= new double[months.Length]; for (int i=0; i&lt; months.Length; i++) { dMonths[i] = monthNames[months[i]]; //Console.WriteLine(dMonths[i]); }</span></span></code> </pre><br>  In order to process data about the month in which appeals took place, it is necessary to translate them into a digestible format, in this case we will encode everything into double type. <br>  By analogy with the solution in Python, we first create a dictionary, and then recode the data in accordance with it using a loop. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//select the target column double[] OutResPositive = mscTable.Columns["res_positive"].ToArray(); // separation of the test and train target sample double[] OutResPositiveTrain = OutResPositive.Get(0, traintPos); double[] OutResPositiveTest = OutResPositive.Get(traintPos, testPos);</span></span></code> </pre><br>  Select the objective function.  We will forecast the number of positive decisions for all appeals. <br>  In the first line, we pull out this data from the table, converting it to a double type. <br>  And then in the other two variables, copy positions from 0 to 18 for the training set and from 18 to 22 for the control sample. <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//deleting unneeded columns mscTable.Columns.Remove("total_appeals"); mscTable.Columns.Remove("month"); mscTable.Columns.Remove("res_positive"); mscTable.Columns.Remove("year");</span></span></code> </pre><br>  We remove unnecessary columns from the table: our objective function, months, years, and the total number of hits, because it includes information about the positive outcome of the review. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//add coded in a double column month into Table //create new column DataColumn newCol = new DataColumn("dMonth", typeof(double)); newCol.AllowDBNull = true; // add new column mscTable.Columns.Add(newCol); //fill new column int counter = 0; foreach (DataRow row in mscTable.Rows) { row["dMonth"] = dMonths[counter]; counter++; }</span></span></code> </pre><br>  And now, add a column with recoded months, first create a new column, add it to the table, and then fill it in a loop. <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//receiving input data from a table double[][] inputs = mscTable.ToArray(); //separation of the test and train sample double[][] inputsTrain= inputs.Get(0, traintPos); double[][] inputsTest = inputs.Get(traintPos, testPos);</span></span></code> </pre><br>  By analogy with the objective function, we create arrays of input data (attributes). <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//simple linear regression model var ols = new OrdinaryLeastSquares() { UseIntercept = true }; //linear regression model for several features MultipleLinearRegression regression = ols.Learn(inputsTrain, OutResPositiveTrain);</span></span></code> </pre><br>  It remains to create a model.  First, we create an object of ordinary linear regression, and then on the basis of it we create a model for multiple regression, because we have almost 30 signs.  We train the model naturally on a training set. <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//make a prediction double[] predicted = regression.Transform(inputsTest);</span></span></code> </pre><br>  We directly obtain the prediction for the training sample. <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//console output for (int i = 0; i &lt; testPos - traintPos; i++) { Console.WriteLine("predicted: {0} real: {1}", predicted[i], OutResPositiveTest[i]); } // And print the squared error using the SquareLoss class: Console.WriteLine("error = {0}", new SquareLoss(OutResPositiveTest).Loss(predicted)); // print the coefficient of determination double r2 = new RSquaredLoss(numberOfInputs: 29, expected: OutResPositiveTest).Loss(predicted); Console.WriteLine("R^2 = {0}", r2); // alternative print the coefficient of determination double ur2 = regression.CoefficientOfDetermination(inputs, OutResPositiveTest, adjust: true); Console.WriteLine("alternative version of R2 = {0}", r2); Console.WriteLine("Press enter and close chart to exit");</span></span></code> </pre><br>  We display in the console data on the predicted and real values, as well as information about the error and the coefficient of determination. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// for chart int[] classes = new int[allData]; double[] mountX = new double[allData]; for (int i = 0; i &lt; allData; i++) { if (i&lt;testPos) { // for csv data mountX[i] = i+1; classes[i] = 0; //csv data is class 0 } else { //for predicted mountX[i] = i- (testPos - traintPos)+1; classes[i] = 1; //predicted is class 1 } } // make points of chart List&lt;double&gt; OutChart = new List&lt;double&gt;(); OutChart.AddRange(OutResPositive); OutChart.AddRange(predicted);</span></span></code> </pre><br>  The developers themselves seem to advise using third-party tools for displaying graphs, but we will use the ScatterplotBox chart supplied with the framework, which displays points.  For the data to be at least somehow visual, we create an analogue of the time trend on the X scale (point 1 is January 16, the last point is October 2017), and in parallel we classify points in another array the first 22 are our original data and the last 4 predicted (graph paint them in a different color). <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">// plot chart ScatterplotBox.Show("res_positive from months", mountX, OutChart.ToArray(), classes).Hold(); // for pause Console.ReadLine(); } } }</span></span></code> </pre><br>  ScatterplotBox.Show displays a window with a schedule.  To him we will feed our previously prepared data for the X and Y axes. <br><a name="III"></a><br>  Frankly, I don‚Äôt know Visual Basic, but here the <a href="http://converter.telerik.com/">converter from C # to VB.NET</a> will help us. <br><br>  We will not analyze the code in parts, you can use the comments left in the code, they are identical for both projects and divide the code into similar sections. <br><br><div class="spoiler">  <b class="spoiler_title">Full code on VB.NET</b> <div class="spoiler_text"><pre> <code class="hljs rust">Imports System Imports System.Linq Imports Accord.Statistics.Models.Regression.Linear Imports Accord.IO Imports Accord.Math Imports System.Data Imports System.Collections.Generic Imports Accord.Controls Imports Accord.Math.Optimization.Losses Module Program Sub Main() <span class="hljs-symbol"><span class="hljs-symbol">'for</span></span> separating the training and test samples Dim traintPos As Integer = <span class="hljs-number"><span class="hljs-number">18</span></span> Dim testPos As Integer = <span class="hljs-number"><span class="hljs-number">22</span></span> Dim allData As Integer = testPos + (testPos - traintPos) <span class="hljs-symbol"><span class="hljs-symbol">'for</span></span> correct reading symbol of float point <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> csv Dim customCulture As System.Globalization.CultureInfo = CType(System.Threading.Thread.CurrentThread.CurrentCulture.<span class="hljs-built_in"><span class="hljs-built_in">Clone</span></span>(), System.Globalization.CultureInfo) customCulture.NumberFormat.NumberDecimalSeparator = <span class="hljs-string"><span class="hljs-string">"."</span></span> System.Threading.Thread.CurrentThread.CurrentCulture = customCulture <span class="hljs-symbol"><span class="hljs-symbol">'read</span></span> data Dim CsvFilePath As <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> = <span class="hljs-string"><span class="hljs-string">"msc_appel_data.csv"</span></span> Dim mscTable As DataTable = New CsvReader(CsvFilePath, True).ToTable() <span class="hljs-symbol"><span class="hljs-symbol">'for</span></span> encoding the string values of months into numerical values Dim monthNames As Dictionary(Of <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, Double) = New Dictionary(Of <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, Double) <span class="hljs-built_in"><span class="hljs-built_in">From</span></span> {{<span class="hljs-string"><span class="hljs-string">"January"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-string"><span class="hljs-string">"February"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, {<span class="hljs-string"><span class="hljs-string">"March"</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}, {<span class="hljs-string"><span class="hljs-string">"April"</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>}, {<span class="hljs-string"><span class="hljs-string">"May"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>}, {<span class="hljs-string"><span class="hljs-string">"June"</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>}, {<span class="hljs-string"><span class="hljs-string">"July"</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>}, {<span class="hljs-string"><span class="hljs-string">"August"</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>}, {<span class="hljs-string"><span class="hljs-string">"September"</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>}, {<span class="hljs-string"><span class="hljs-string">"October"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>}, {<span class="hljs-string"><span class="hljs-string">"November"</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>}, {<span class="hljs-string"><span class="hljs-string">"December"</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>}} Dim months As <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>() = mscTable.Columns(<span class="hljs-string"><span class="hljs-string">"month"</span></span>).ToArray(Of <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>)() Dim dMonths As Double() = New Double(months.Length - <span class="hljs-number"><span class="hljs-number">1</span></span>) {} For i As Integer = <span class="hljs-number"><span class="hljs-number">0</span></span> To months.Length - <span class="hljs-number"><span class="hljs-number">1</span></span> dMonths(i) = monthNames(months(i)) Next <span class="hljs-symbol"><span class="hljs-symbol">'select</span></span> the target column Dim OutResPositive As Double() = mscTable.Columns(<span class="hljs-string"><span class="hljs-string">"res_positive"</span></span>).ToArray() <span class="hljs-symbol"><span class="hljs-symbol">'separation</span></span> of the test and train target sample Dim OutResPositiveTrain As Double() = OutResPositive.[Get](<span class="hljs-number"><span class="hljs-number">0</span></span>, traintPos) Dim OutResPositiveTest As Double() = OutResPositive.[Get](traintPos, testPos) <span class="hljs-symbol"><span class="hljs-symbol">'deleting</span></span> unneeded columns mscTable.Columns.Remove(<span class="hljs-string"><span class="hljs-string">"total_appeals"</span></span>) mscTable.Columns.Remove(<span class="hljs-string"><span class="hljs-string">"month"</span></span>) mscTable.Columns.Remove(<span class="hljs-string"><span class="hljs-string">"res_positive"</span></span>) mscTable.Columns.Remove(<span class="hljs-string"><span class="hljs-string">"year"</span></span>) <span class="hljs-symbol"><span class="hljs-symbol">'add</span></span> coded <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a double column month into Table <span class="hljs-symbol"><span class="hljs-symbol">'create</span></span> new column Dim newCol As DataColumn = New DataColumn(<span class="hljs-string"><span class="hljs-string">"dMonth"</span></span>, GetType(Double)) newCol.AllowDBNull = True <span class="hljs-symbol"><span class="hljs-symbol">'add</span></span> new column mscTable.Columns.Add(newCol) <span class="hljs-symbol"><span class="hljs-symbol">'fill</span></span> new column Dim counter As Integer = <span class="hljs-number"><span class="hljs-number">0</span></span> For Each row As DataRow In mscTable.Rows row(<span class="hljs-string"><span class="hljs-string">"dMonth"</span></span>) = dMonths(counter) counter += <span class="hljs-number"><span class="hljs-number">1</span></span> Next <span class="hljs-symbol"><span class="hljs-symbol">'receiving</span></span> input data from a table Dim inputs As Double()() = mscTable.ToArray() <span class="hljs-symbol"><span class="hljs-symbol">'separation</span></span> of the test and train sample Dim inputsTrain As Double()() = inputs.[Get](<span class="hljs-number"><span class="hljs-number">0</span></span>, traintPos) Dim inputsTest As Double()() = inputs.[Get](traintPos, testPos) <span class="hljs-symbol"><span class="hljs-symbol">'simple</span></span> linear regression model Dim ols = New OrdinaryLeastSquares() With {.UseIntercept = True} <span class="hljs-symbol"><span class="hljs-symbol">'linear</span></span> regression model <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> several features Dim regression As MultipleLinearRegression = ols.Learn(inputsTrain, OutResPositiveTrain) <span class="hljs-symbol"><span class="hljs-symbol">'make</span></span> a prediction Dim predicted As Double() = regression.Transform(inputsTest) <span class="hljs-symbol"><span class="hljs-symbol">'console</span></span> output For i As Integer = <span class="hljs-number"><span class="hljs-number">0</span></span> To testPos - traintPos - <span class="hljs-number"><span class="hljs-number">1</span></span> Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"predicted: {0} real: {1}"</span></span>, predicted(i), OutResPositiveTest(i)) Next <span class="hljs-symbol"><span class="hljs-symbol">'And</span></span> print the squared error using the SquareLoss class Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"error = {0}"</span></span>, New SquareLoss(OutResPositiveTest).Loss(predicted)) <span class="hljs-symbol"><span class="hljs-symbol">'print</span></span> the coefficient of determination Dim r2 As Double = New RSquaredLoss(numberOfInputs:=<span class="hljs-number"><span class="hljs-number">29</span></span>, expected:=OutResPositiveTest).Loss(predicted) Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"R^2 = {0}"</span></span>, r2) <span class="hljs-symbol"><span class="hljs-symbol">'alternative</span></span> print the coefficient of determination Dim ur2 As Double = regression.CoefficientOfDetermination(inputs, OutResPositiveTest, adjust:=True) Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"alternative version of R2 = {0}"</span></span>, r2) Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Press enter and close chart to exit"</span></span>) <span class="hljs-symbol"><span class="hljs-symbol">'for</span></span> chart Dim classes As Integer() = New Integer(allData - <span class="hljs-number"><span class="hljs-number">1</span></span>) {} Dim mountX As Double() = New Double(allData - <span class="hljs-number"><span class="hljs-number">1</span></span>) {} For i As Integer = <span class="hljs-number"><span class="hljs-number">0</span></span> To allData - <span class="hljs-number"><span class="hljs-number">1</span></span> If i &lt; testPos Then mountX(i) = i + <span class="hljs-number"><span class="hljs-number">1</span></span> classes(i) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'csv</span></span> data is class <span class="hljs-number"><span class="hljs-number">0</span></span> Else mountX(i) = i - (testPos - traintPos) + <span class="hljs-number"><span class="hljs-number">1</span></span> classes(i) = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'predicted</span></span> is class <span class="hljs-number"><span class="hljs-number">1</span></span> End If Next <span class="hljs-symbol"><span class="hljs-symbol">'make</span></span> points of chart Dim OutChart As List(Of Double) = New List(Of Double)() OutChart.AddRange(OutResPositive) OutChart.AddRange(predicted) <span class="hljs-symbol"><span class="hljs-symbol">'plot</span></span> chart ScatterplotBox.Show(<span class="hljs-string"><span class="hljs-string">"res_positive from months"</span></span>, mountX, OutChart.ToArray(), classes).Hold() <span class="hljs-symbol"><span class="hljs-symbol">'for</span></span> pause Console.ReadLine() End Sub End Module</code> </pre><br></div></div><br>  It should be noted that our project turned out to be quite cross-platform, since it can be assembled both using Visual Studio under Windows and using MonoDevelop under Linux.  However, this is true, only in relation to C #, the code on VB.NET under Mono is not always going without problems. <br>  Instead of a thousand words, let's take a look at screen shots. <br><br>  Build VB project version 1.0.1.  under Windows. <br><br><img src="https://habrastorage.org/webt/tb/lb/t9/tblbt9w5_cqlkqquc3dmpag-hae.png"><br><br>  Build C # project version 1.0.0.  under Linux Mint. <br><br><img src="https://habrastorage.org/webt/hl/yd/qu/hlydqu2gz6bmdz-q7mf_3dcs-ne.png"><br><br>  You probably noticed that the results in the pictures are slightly different. <br>  <b>This is not Mono's fault</b> .  The thing is that in the version of the project (1.0.0) on C # compiled under Linux, I forgot to take into account the recoded column with months.  And in the project version (1.0.1) on VB compiled in Visual Studio - I took it into account. <br><br>  I wanted to first correct the screenshots, but then I thought that this was a clear demonstration that this feature slightly improved the quality of the prediction. <br><br>  However, in fact, we have achieved poor results that have no benefit other than training. <br><br>  The reasons for this are the following factors: <br><br><ol><li>  We have data in different quantities, but we did not scale them.  <i>(Because I have not figured out how to do it yet with Accord.NET)</i> . </li><li>  We also shoved almost all the signs into the model and did not use the ‚Äúbad‚Äù signs, that is, regularization.  <i>(Guess why? That's right because I haven't figured it out yet either)</i> . </li><li>  Well, certainly too little data to do, normal predictions. </li></ol><br>  <i>Maybe some other things about which I do not know.</i> <br><br>  But fortunately we didn‚Äôt set ourselves the goal of practical application of the model, it was important for us to learn about the framework and try to do the simplest things, well, then I hope that you will master this tool and I will learn how to work with Accord on your articles . </div><p>Source: <a href="https://habr.com/ru/post/346222/">https://habr.com/ru/post/346222/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346210/index.html">On-Premise vs. Cloud IaaS - advantages and disadvantages</a></li>
<li><a href="../346214/index.html">First contact with ‚Äúvar‚Äù in Java 10</a></li>
<li><a href="../346216/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ296 (January 1 - 7, 2018)</a></li>
<li><a href="../346218/index.html">11 libraries (sets of components) for Angular, which is worth knowing in 2018</a></li>
<li><a href="../346220/index.html">11 libraries (sets of components) for Vue, which is worth knowing in 2018</a></li>
<li><a href="../346228/index.html">How to read math</a></li>
<li><a href="../346230/index.html">Reverse Engineering Star Wars: Yoda Stories</a></li>
<li><a href="../346232/index.html">MSSQL Server. Example of using linked server</a></li>
<li><a href="../346234/index.html">Net :: Ethereum module for working with Solidity contracts</a></li>
<li><a href="../346236/index.html">Knowledge Representations in Intelligent Systems, Expert Systems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>