<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to implement a SOAP service for working with Google tables through SQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There was a task - during the preparation of a demo of one of the solutions, it was necessary to show that customer information can be saved anywhere ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to implement a SOAP service for working with Google tables through SQL</h1><div class="post__text post__text-html js-mediator-article">  There was a task - during the preparation of a demo of one of the solutions, it was necessary to show that customer information can be saved anywhere - in a simple case, for example, in Google tables, in a more complex ( <s>after a six-month ‚Äúimplementation‚Äù and multi-million dollar budget</s> ) in a CRM client.  In the WSO2 ESB used by us there is a connector to Google tables - but it turned out to be not a very simple task to implement the required functionality on it - and then I scored it. <br><br>  But recently, figuring out the new features of the WSO2 Data Services Server found that it can easily implement a SOAP-service for working with Google tables (which you can then pick up anywhere).  And work with data in the table is carried out through familiar to all SQL. <br>  How to make it, and I want to tell under a cat. <br><a name="habracut"></a><br>  (If you suddenly think that you have already seen this post somewhere - do not be surprised - the last post was banned - got too carried away with links - here I tried to correct it). <br><br><h2>  What is WSO2 Data Services Server </h2><br>  But first, a small educational program.  What is <a href="http://www.wso2.ru/">WSO2</a> ?  If simple, this is a set of Open-Source projects (mainly from the Apache stack) delivered to the single OSGI-based Carbon platform.  As a result - from the projects we get products - with a single admin, support and other things.  WSO2 covers a wide range of integration tasks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In our case - WSO2 Data Services Server is used to organize access to data, and data sources can be very different - and the usual databases (from MySQL to DB2 - roughly speaking, for which there is a JDBC driver), and NoSQL databases, and (CSV, Excel) and external services (as in our case - Google Spreadsheet).  All this can be wrapped either by SOAP or by a REST service. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a9/5f0/c79/7a95f0c79b92e981bc79ca3850af842b.gif" alt="image"><br><br><h2>  Installing WSO2 Data Services Server </h2><br>  What is convenient when working with WSO2 products is that in terms of installation, configuration and support they are all guided by the same principles.  Installing WSO2 DSS is no different from installing WSO2 ESB, an example of which can be seen, for example, <a href="http://www.emdev.ru/-/bazovye-sagi-po-ustanovke-produktov-wso2">here</a> .  Roughly speaking - downloaded, unpacked, launched - and voila - in a few seconds we can enter the admin area at (by default) https: // localhost: 9443 / carbon (the login password is admin / admin) <br><br><img src="https://habrastorage.org/files/eae/769/7bb/eae7697bb3cc443d92e695300a5b4234.png"><br><br><h2>  Google spreadsheet </h2><br>  What is Google Spreadsheets will not tell - I think everyone knows.  Let's create a test table with which we will work - for example with three columns - ID, FirstName, LastName <br><br><img src="https://habrastorage.org/files/559/81d/f70/55981df70a18430d895658c6ef0b485d.png"><br><br>  The table is opened by a link like <a href="https://docs.google.com/spreadsheets/d/1k4jebSdGJ39nyDnIc505PI0H2XKk8Q8ewxSpe71/edit">docs.google.com/spreadsheets/d/1k4jebSdGJ39nyDnIc505PI0H2XKk8Q8ewxSpe71/edit#gid=0</a> , the part of the link before "/ edit" is the URL of the table, which will then need to be used for access, in our case it is <br><br>  <b><a href="https://docs.google.com/spreadsheets/d/1k4jebSdGJ39nyDnIc505PI0H2XKk8Q8ewxSpe71">docs.google.com/spreadsheets/d/1k4jebSdGJ39nyDnIc505PI0H2XKk8Q8ewxSpe71</a></b> <br><br><h2>  Creating a service </h2><br>  In order to create a service in the menu on the left, select Services -&gt; Add -&gt; Create.  On the first screen, enter the basic data - the name of the service (in my case, GoogleClients, and Namespace (in my case, <a href="http://ws.wso2.org/dataservices/google_client">ws.wso2.org/dataservices/google_client</a> ). You can use any other. We leave the rest of the default settings. <br><br><img src="https://habrastorage.org/files/cd3/de1/0a9/cd3de10a9e4743ddae806fbbb6b5ba54.png"><br><br><h3>  Creating a data source </h3><br>  The next step is to set up data sources (Data Source).  One service can work with several sources at once - we have to add our Google table as a source. <br><br>  At the next step, we say ‚ÄúAdd DataSource‚Äù, enter the name in the form that opens (for example, googleTable), select the type (Google Spreadsheet) and tick the ‚ÄúUse Query Mode‚Äù box (this will allow us to communicate with the table in SQL). <br>  Further more interesting - you need to set the connection to the table.  As the Google Spreadsheet URL we use the URL of the table, as I showed above. <br><br>  But over the following fields will need to work. <br><br><h3>  App registration in the Google Developers Console </h3><br>  The following fields are Client ID and Client Secret - the identification of your application (in this case, the service) with which it will knock on Google Spreadsheets.  To get this data, go to the Google Developers Console: <a href="https://console.cloud.google.com/">console.cloud.google.com</a> , register a new application there and add OAuth2 authorization (API &amp; Auth -&gt; Credentials -&gt; Add Credentials -&gt; OAuth 2.0 client ID).  When creating a key, it will be necessary to specify the same ‚ÄúAuthorized redirect URIs‚Äù that is used when registering a Datasource (in the simplest case, it will be <a href="https://localhost/">localhost</a> : 9443 / authCodeReceiver. <br><br><img src="https://habrastorage.org/files/938/699/8f3/9386998f38b94e1680ef5e79914149d7.png"><br><br>  After creation, we will get the required Client ID and Client Secret which we need to indicate on the DataSource registration form.  The last thing you need to get is ‚ÄúRefresh Token‚Äù - the token in which information about a particular user will be ‚Äúsewn up‚Äù on behalf of whom we work - to do this, click the ‚ÄúGenerate Tokens‚Äù button - you will be asked to log in to Google (log in by the user who has there is access to the source table) and access permissions.  As a result, the field will be inserted (automatically) received Refresh Token.  Then click "Test Connection" - if everything went well - you will get a positive result - you can move on. <br><br><img src="https://habrastorage.org/files/793/75a/4c8/79375a4c826e4a1b9ce189f3d0339ded.png"><br><br><h3>  Making requests </h3><br>  Everything, the step of magic passed - further everything is simpler.  The next step is to create queries.  Let's start with a request to get all the records.  In the next ‚ÄúQueries‚Äù step, click ‚ÄúAdd New Query‚Äù and start creating our query: <br><ul><li>  <b>Query name</b> : for example selectClients </li><li>  <b>Datasource</b> : select the <b>googleTable</b> created at the last step </li><li>  <b>Query</b> : <i>select ID, FirstName, LastName from Sheet1</i> - where ID, FirstName and LastName are the names of the columns in the table, and Sheet1 is the name of the tab </li></ul><br>  Yes Yes Yes!  That's the point - we‚Äôll work with our Google table through the familiar and beloved SQL! <br><br>  Then click "Generate Response" - the output fields will be generated by the column names, it is recommended to change the "Group By Element" - For example, "Clients" and "Row name" to "Client" - these names will be used in the response tags.  If you wish, you can edit the generated ‚ÄúOutput Mapping‚Äù. <br><br><img src="https://habrastorage.org/files/8ad/572/cdd/8ad572cdd5d44824bdbd075a533638c1.png"><br><br>  Similarly, we create <b>insertQuery</b> as <i>insert into Sheet1 (ID, FirstName, LastName) values ‚Äã‚Äã(?,?,?)</i> - only now we will need to click "Generate Input Mappings" - to generate input parameters (by the number of questions in the query).  They are best edited for names and types. <br><br><img src="https://habrastorage.org/files/979/3af/29a/9793af29a0b549ecb1b7fb50d62ba6c7.png"><br><br>  Similarly, you can generate any other queries ‚Äî both selects with parameters, and updates and delete-s ‚Äî it‚Äôs important that we can work with the Google table as with a normal SQL table.  I did not investigate how complex queries are supported - but in my case I had fairly simple, basic queries. <br><br><h3>  Creating operations </h3><br>  The next step is simple - for each request we generate an operation (service method).  Everything is simple here - we create an operation and specify for which request it is. <br><br><img src="https://habrastorage.org/files/b53/50c/4b9/b5350c4b96f04a03bed01b54fc9e959c.png"><br><br><h2>  Service testing </h2><br>  Click ‚ÄúFinish‚Äù - everything - SOAP service for working with our Google table is ready!  You can test it - in the list of services we click on our ‚ÄúTry this service‚Äù - and in the window that opens, select the operation, drive in if necessary parameters - and go ahead. <br><br><img src="https://habrastorage.org/files/7f3/0b0/ad5/7f30b0ad5de047c28240c0447ccbedf6.png"><br><br>  Everything!  Service is ready - now we can work with our table from the bus or any other application (by WSDL we can easily generate client code to call this service).  If you do not hesitate to "magic" with ClientID, Secret Key and the receipt of Refresh Token - then everything gets no more than everything. <br><br>  At the same time, we did not write a single line of code - well, except for simple SQL queries. </div><p>Source: <a href="https://habr.com/ru/post/271033/">https://habr.com/ru/post/271033/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271019/index.html">Power Query: steroids for MS Excel and Power BI</a></li>
<li><a href="../271021/index.html">Why does WhatsApp collect and store confidential information about the user and their conversations?</a></li>
<li><a href="../271023/index.html">Data transfer to Russia. Short FAQ on Misconceptions</a></li>
<li><a href="../271025/index.html">Spring 4 MVC, Hibernate: many to many association</a></li>
<li><a href="../271031/index.html">VK Open Api CSRF vulnerability, which allows to get Access Tokens of third-party sites that use authorization via VK</a></li>
<li><a href="../271035/index.html">LINQ converter between roman and arabic numbers</a></li>
<li><a href="../271037/index.html">EMC ViPR 2.1: Third Platform Data Management</a></li>
<li><a href="../271039/index.html">Overview of Cisco UCS Initial Setup</a></li>
<li><a href="../271041/index.html">We invite you to a meeting on web development on December 2</a></li>
<li><a href="../271043/index.html">Isilon.Next - how Big Data storage has become larger, cloudier and softer *</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>