<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Live Tiles Updates in Background Agents</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my opinion, one of the strengths of Windows Phone is its design. More precisely, a design concept that a developer can use to get the most out of i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Live Tiles Updates in Background Agents</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/5982314e/3eaf8184/97f286d7/0b62b488.png"><br>  In my opinion, one of the strengths of Windows Phone is its design.  More precisely, a design concept that a developer can use to get the most out of it when developing their applications. <br><br>  One of the key concepts - Live Tiles or "live tiles" - "application icons on steroids."  Proper use of Live Tiles binds the user to the application and gives a completely different feeling when used.  For example, when I chose an application for weather forecasting, the key criterion for me was that the application had Live Tile and promptly updated the forecast.  As a result, after setting up the application and fixing Live Tile on the start screen, I practically did not launch this application anymore, but at the same time, immediately after removing the lock screen, I see real-time information about the weather. <br><br>  A good example, you think, but how do we do this? <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The application that I use to update my Live Tile (and there may be several, because I can fix the Live Tile for several cities) using a periodic background agent. <br><br>  Let's take an example to figure out how to implement a Live Tile update from a background agent. <br><br>  First I will prepare 2 background pictures for tiles.  I did the following: <br><img src="https://habrastorage.org/storage1/f723c11b/c61f7c57/4f50afcb/90436bef.png"><br>  and <br><img src="https://habrastorage.org/storage1/b0cfb02a/6a6ca56c/b71863ea/c8a8fe74.png"><br>  These are PNG files, size 173x173 on a transparent background, so that through it you can see the background color of the theme that is currently installed on the phone. <br><br>  Then we will create a simple project based on Windows Phone Application on C #.  Add the prepared pictures to it.  I added them under the simple names 1.png and 2.png.  In the settings you need to set the Content type for them and Copy if newer copy conditions. <br><br>  Let's proceed directly to the development of the application. <br><br>  We will have the main application tile and one secondary tile updated. <br><br>  <i>Note: An application always has an application tile, even if it is not attached to the start screen.</i>  <i>There may be several secondary tiles and you need to create them from the application.</i> <br><br>  Add a second page to the application and call it LandingPage.xaml - it will open when the secondary tile of our application is clicked. <br><br>  Let's go to the start page of the MainPage.xaml application and add a button to it: <br><pre><code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!--TitlePanel contains the name of the application and page title--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TitlePanel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"12,17,0,28"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ApplicationTitle"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LIVE TILES UPDATE DEMO"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StaticResource PhoneTextNormalStyle}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PageTitle"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"9,-7,0,0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StaticResource PhoneTextTitle1Style}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--ContentPanel - place additional content here--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ContentPanel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"12,0,12,0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TileAdder"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TileAdder_Click"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  In the code, we will add a button click handler, in which we will add a secondary tile with some ‚Äúdemo logic‚Äù: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TileAdder_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { IsolatedStorageFile CounterStorage = IsolatedStorageFile.GetUserStoreForApplication(); IsolatedStorageFileStream CounterStream = CounterStorage.OpenFile(<span class="hljs-string"><span class="hljs-string">"counter"</span></span>, System.IO.FileMode.OpenOrCreate); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = CounterStream.ReadByte(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) count = <span class="hljs-number"><span class="hljs-number">1</span></span>; StandardTileData appTileData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StandardTileData(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((count % <span class="hljs-number"><span class="hljs-number">2</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { appTileData.Title = <span class="hljs-string"><span class="hljs-string">" 002"</span></span>; appTileData.BackgroundImage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"/1.png"</span></span>, UriKind.RelativeOrAbsolute); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((count % <span class="hljs-number"><span class="hljs-number">7</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { appTileData.Title = <span class="hljs-string"><span class="hljs-string">" 007"</span></span>; appTileData.BackgroundImage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">""</span></span>, UriKind.RelativeOrAbsolute); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { appTileData.Title = <span class="hljs-string"><span class="hljs-string">" 000"</span></span>; appTileData.BackgroundImage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"/2.png"</span></span>, UriKind.RelativeOrAbsolute); } appTileData.Count = count; CounterStream.Seek(<span class="hljs-number"><span class="hljs-number">0</span></span>, SeekOrigin.Begin); count = count + <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count &gt; <span class="hljs-number"><span class="hljs-number">99</span></span>) count = <span class="hljs-number"><span class="hljs-number">99</span></span>; CounterStream.WriteByte((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)count); CounterStream.Close(); ShellTile.Create(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"/LandingPage.xaml"</span></span>, UriKind.RelativeOrAbsolute), appTileData); }</code> </pre> <br><br>  To create a secondary tile, we first create an object containing the tile data, then call the method to which we pass the URI of the page, which will be called and the object with the data is all very simple. <br><br>  The logic of variation in the content of the secondary tile is designed simply so that when you demonstrate the application, the tile is created with different parameters. <br><br>  Pay attention to the use of a file with a counter that changes dynamically - it is an imitation of receiving external data or a demonstration of synchronization between the application and the background agent, to which we will proceed. <br><br>  Since if the Count property is greater than 99, the display will still be 99, we consider only up to 99 and can easily convert from int to byte. <br><br>  Now we need to create a background agent that would update the data on our tiles.  Add a project like Windows Phone Scheduler Task Agent to the solution, then add a link to it to the main project and add its namespace to the block using the main page of the main application. <br><br>  Also in the block using the main page of the aspen application, you need to remember to add a namespace to work with Isolated Storage and agents.  I called the project with the UpdateTileAgent agent and in my case this block looks like this: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UpdateTileAgent; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Phone.Scheduler; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO.IsolatedStorage; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO;</code> </pre><br><br>  So, we need to create and register a background agent.  I will do this in the main page's Loaded event handler.  To do this, I will add this handler, and add the agent creation code to the handler: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> UpdateTileAgentName = <span class="hljs-string"><span class="hljs-string">"Agent-Tile"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Constructor public MainPage() { InitializeComponent(); this.Loaded += new RoutedEventHandler(MainPage_Loaded); } void MainPage_Loaded(object sender, RoutedEventArgs e) { PeriodicTask myPeriodicTask = ScheduledActionService.Find(UpdateTileAgentName) as PeriodicTask; if (myPeriodicTask != null) { try { ScheduledActionService.Remove(UpdateTileAgentName); } catch (Exception ex) { MessageBox.Show("    :" + ex.Message); } } myPeriodicTask = new PeriodicTask(UpdateTileAgentName); myPeriodicTask.Description = "Agent-Tile"; try { ScheduledActionService.Add(myPeriodicTask); #if DEBUG ScheduledActionService.LaunchForTest(UpdateTileAgentName, TimeSpan.FromSeconds(10)); #endif } catch (Exception ex) { MessageBox.Show("  :" + ex.Message); } if (ShellTile.ActiveTiles.Count() &gt; 1) TileAdder.IsEnabled = false; }</span></span></code> </pre><br><br>  In general, the code is quite simple.  I want to draw attention to several features. <br><br>  Periodic agents run once every half hour.  For debugging, this is not very convenient, so I use a conditional compilation directive in which I ask you to start the agent in the debug build after 10 seconds. <br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> DEBUG ScheduledActionService.LaunchForTest(UpdateTileAgentName, TimeSpan.FromSeconds(10)); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre><br><br>  I don‚Äôt want to create multiple secondary tiles with a link to the same page.  Therefore, I check the number of tiles and depending on this I turn on / off the button for adding tiles. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ShellTile.ActiveTiles.Count() &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) TileAdder.IsEnabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre><br>  The Agent <i>Description</i> field is required and without it it will not be added to the scheduler. <br><br>  Everything, with the application itself, we are finished.  Now you can proceed to the agent. <br><br>  The main work in the agent is conducted in the <i>OnInvoke</i> method: <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnInvoke</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ScheduledTask task</span></span></span><span class="hljs-function">)</span></span></code> </pre><br><br>  In order to work comfortably with tiles, do not forget to add the necessary directives to the using code block of the agent.  I have it as follows: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Phone.Scheduler; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Phone.Shell; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO.IsolatedStorage; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO;</code> </pre><br><br>  Add a tile update to the agent code based on "external" data in the form of a counter and add a bit of variety using logic similar to the logic of creating a secondary tile. <br><br>  I selected the code for updating the tile to a separate function. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TileUpdater</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ShellTile tile, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> count</span></span></span><span class="hljs-function">)</span></span> { StandardTileData appTileData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StandardTileData(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((count % <span class="hljs-number"><span class="hljs-number">2</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { appTileData.Title = <span class="hljs-string"><span class="hljs-string">" 002"</span></span>; appTileData.BackgroundImage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"/1.png"</span></span>, UriKind.RelativeOrAbsolute); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((count % <span class="hljs-number"><span class="hljs-number">7</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { appTileData.Title = <span class="hljs-string"><span class="hljs-string">" 007"</span></span>; appTileData.BackgroundImage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">""</span></span>, UriKind.RelativeOrAbsolute); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { appTileData.Title = <span class="hljs-string"><span class="hljs-string">" 000"</span></span>; appTileData.BackgroundImage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"/2.png"</span></span>, UriKind.RelativeOrAbsolute); } appTileData.Count = count+<span class="hljs-number"><span class="hljs-number">1</span></span>; tile.Update(appTileData); }</code> </pre><br><br>  The <i>OnInvoke</i> method <i>itself</i> looks like this: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnInvoke</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ScheduledTask task</span></span></span><span class="hljs-function">)</span></span> { ShellTile AppTile = ShellTile.ActiveTiles.FirstOrDefault(); IsolatedStorageFile CounterStorage = IsolatedStorageFile.GetUserStoreForApplication(); IsolatedStorageFileStream CounterStream = CounterStorage.OpenFile(<span class="hljs-string"><span class="hljs-string">"counter"</span></span>, System.IO.FileMode.OpenOrCreate); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = CounterStream.ReadByte(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) count = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     TileUpdater(AppTile, count+1); //       if (ShellTile.ActiveTiles.Count() &gt; 1) { //  -    IEnumerable&lt;ShellTile&gt; tiles = ShellTile.ActiveTiles.Skip(1); //   Secondary Tiles foreach (ShellTile st in tiles) { TileUpdater(st, count); } } CounterStream.Seek(0, SeekOrigin.Begin); count++; if (count &gt; 99) count = 99; CounterStream.WriteByte((byte)count); CounterStream.Close(); #if DEBUG ScheduledActionService.LaunchForTest(UpdateTileAgentName, TimeSpan.FromSeconds(10)); #endif NotifyComplete(); }</span></span></code> </pre><br><br>  What do we see here?  The request already familiar to us to start the agent in 10 seconds and the divided logic of updating the main application tile and additional ones.  I want to remind you that this can be implemented, because the application tile is the first in the list and is always there, even if the application is not attached to the start screen. <br><br>  Also here you can update in the agent and other properties of the tile.  Learn more about tiles and properties here: <a href="http://msdn.microsoft.com/ru-ru/windowsphone/hh505822">http://msdn.microsoft.com/ru-ru/windowsphone/hh505822</a> . <br><br>  Now you can build and run the application in the emulator.  Fix the application itself on the start screen, do not forget to create a second tile.  See how tiles change over time. <br><br>  Now, armed with this knowledge, I think you will easily add the advanced Live Tiles functionality to your Windows Phone apps. <br><br>  <b>UPD</b> : Thank you <a href="http://habrahabr.ru/users/max_sokolov/" class="user_link">max_sokolov</a> for the reminder.  Periodically starting background agents have the following properties: <ul><li>  run about once every 30 minutes </li><li>  their work time is limited to 25 seconds (some sources say 15 seconds) </li><li>  CPU power consumption is limited </li><li>  their memory consumption is limited (depending on the platform, the minimum value is 6 MB) </li><li>  the system may decide not to start the agent if resources are insufficient (for example, the phone is discharged) </li><li>  if the agent completes 3 times with an error, the system will stop running it </li><li>  The agent is added to the launch schedule for 14 days, then you can / need to update </li></ul><br>  <b>Useful links:</b> <br>  <a href="http://msdn.microsoft.com/ru-ru/windowsphone">Windows Phone Development Center on MSDN</a> <br>  <a href="http://www.microsoft.com/downloads/ru-ru/details.aspx%3Ffamilyid%3D0a373422-6680-46a7-89e1-e9a468a14259%26displaylang%3Dru">Windows Phone SDK 7.1</a> <br>  <a href="http://social.msdn.microsoft.com/Forums/ru-RU/formobiledevicesru/threads">Forums on development for Windows Phone in Russian</a> </div><p>Source: <a href="https://habr.com/ru/post/134658/">https://habr.com/ru/post/134658/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134651/index.html">From pamphlets to bills: the Hartley Library goes online</a></li>
<li><a href="../134652/index.html">DevCon'12: registration for the conference is open!</a></li>
<li><a href="../134653/index.html">Repaint for large images</a></li>
<li><a href="../134654/index.html">Rules for composing letters: 15 points that need to be checked before clicking the "send" button</a></li>
<li><a href="../134657/index.html">Programmer for FPGA</a></li>
<li><a href="../134659/index.html">Red Hat enters the Big Data market</a></li>
<li><a href="../134660/index.html">Incredible Adventures with Microsoft.Practices.Unity</a></li>
<li><a href="../134666/index.html">ARMPRF</a></li>
<li><a href="../134667/index.html">People's Award Nevosoft</a></li>
<li><a href="../134668/index.html">The history of the startup Questli: the global market from Siberia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>