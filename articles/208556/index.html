<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An example of using standalone actions in Yii2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing a site, an integral part is the collection of data. Sampling for certain conditions, pagination. Each time to write implementation in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An example of using standalone actions in Yii2</h1><div class="post__text post__text-html js-mediator-article">  When developing a site, an integral part is the collection of data.  Sampling for certain conditions, pagination.  Each time to write implementation in controllers is very boring.  When you can once make an extensible implementation of frequently used functionality. <br><br>  This article will give an example of how to use the Standalone actions functionality of the Yii2 framework to beautifully organize a uniform architecture that can be used in all parts of the application. <br><a name="habracut"></a><br>  <b>In short, what it is</b> : the ability to create once the implementation of action-a and tie them to arbitrary controllers.  So, the basic SiteController of an application based on a <a href="https://packagist.org/packages/yiisoft/yii2-app-basic">basic application template</a> implements two action-a - for error handling and captcha checking: <br><br><div class="spoiler">  <b class="spoiler_title">attaching action s to SiteController</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">controllers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Yii</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">web</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SiteController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'error'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'yii\web\ErrorAction'</span></span>, ], <span class="hljs-string"><span class="hljs-string">'captcha'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'yii\captcha\CaptchaAction'</span></span>, <span class="hljs-string"><span class="hljs-string">'fixedVerifyCode'</span></span> =&gt; YII_ENV_TEST ? <span class="hljs-string"><span class="hljs-string">'testme'</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, ], ]; } }</code> </pre> <br></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  What do we need </h5><br><ol><li>  ListAction - <a href="">standalone action</a> , realizes the connection between queries and search models. </li><li>  DataProvider - interlayer over requests, implements pagination navigation, sorting. </li><li>  Search <a href="">Model</a> - Model of search, accepts incoming data, performs validation and creates DataProvider with the necessary request. </li></ol><br>  The implementation of the last two things can be seen in the standard <a href="">CRUDs</a> generated by <a href="">gii</a> .  It may seem unnecessary to take the data sample to a separate class, when it could be implemented by the method in the AR models themselves (as it was in yii1).  But as it seems to me, the division of responsibility and the removal of the functional in a separate class gives more flexibility. <br><br><h5>  ListAction implementation </h5><br>  It is a class with a run method that is called when an action is requested.  The class is inherited from yii \ base \ Action.  Actions can be configured by binding to its controller by changing its properties.  In our action, we pass the search model, inherited from the base abstract class and other optional settings for action, such as a custom view, data spacer method, method of obtaining pagination, etc. <br><br><div class="spoiler">  <b class="spoiler_title">class implementation with comments</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">shop</span></span>\<span class="hljs-title"><span class="hljs-title">actions</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Yii</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">web</span></span>\<span class="hljs-title"><span class="hljs-title">Response</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">shop</span></span>\<span class="hljs-title"><span class="hljs-title">components</span></span>\<span class="hljs-title"><span class="hljs-title">FilterModelBase</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">widgets</span></span>\<span class="hljs-title"><span class="hljs-title">LinkPager</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListAction</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">base</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> FilterModelBase */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_filterModel; <span class="hljs-comment"><span class="hljs-comment">/** * -        * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> callable */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_validationFailedCallback; <span class="hljs-comment"><span class="hljs-comment">/** *     , *  true,        - eg $_GET/$_POST[SearchModel][attribute] * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $directPopulating = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *   ,  true,     html , *   AJAX  * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $paginationAsHTML = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $requestType = <span class="hljs-string"><span class="hljs-string">'get'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *    * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $view = <span class="hljs-string"><span class="hljs-string">'@app/modules/shop/views/list/index'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_filterModel) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> base\ErrorException(<span class="hljs-string"><span class="hljs-string">'   '</span></span>); } $request = Yii::$app-&gt;request; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($request-&gt;isAjax) { Yii::$app-&gt;response-&gt;format = Response::FORMAT_JSON; } <span class="hljs-comment"><span class="hljs-comment">//   $data = (strtolower($this-&gt;requestType) === 'post' &amp;&amp; $request-&gt;isPost) ? $_POST : $_GET; $this-&gt;_filterModel-&gt;load(($this-&gt;directPopulating) ? $data : [$this-&gt;_filterModel-&gt;formName() =&gt; $data]); //      $this-&gt;_filterModel-&gt;search(); //       if ($this-&gt;_filterModel-&gt;hasErrors()) { /** *       , *  ajax   ,     ,   */ if ($request-&gt;isAjax){ return (is_callable($this-&gt;_validationFailedCallback)) ? call_user_func($this-&gt;_validationFailedCallback, $this-&gt;_filterModel) : [ 'error' =&gt; current($this-&gt;_filterModel-&gt;getErrors()) ]; } if (empty($data)) { $this-&gt;_filterModel-&gt;clearErrors(); } } if (!($dataProvider = $this-&gt;_filterModel-&gt;getDataProvider())) { throw new base\ErrorException('  DataProvider'); } if ($request-&gt;isAjax) { //      return [ 'list' =&gt; $this-&gt;_filterModel-&gt;buildModels(), 'pagination' =&gt; ($this-&gt;paginationAsHTML) ? LinkPager::widget([ 'pagination' =&gt; $dataProvider-&gt;getPagination() ]) : $dataProvider-&gt;getPagination() ]; } return $this-&gt;controller-&gt;render($this-&gt;view ?: $this-&gt;id, [ 'filterModel' =&gt; $this-&gt;_filterModel, 'dataProvider' =&gt; $dataProvider, 'requestType' =&gt; $this-&gt;requestType, 'directPopulating' =&gt; $this-&gt;directPopulating ]); } public function setFilterModel(FilterModelBase $model) { $this-&gt;_filterModel = $model; } public function setValidationFailedCallback(callable $callback) { $this-&gt;_validationFailedCallback = $callback; } }</span></span></code> </pre><br></div></div><br>  You also need to create a default view for the output if it is not an Ajax request. <br><br><div class="spoiler">  <b class="spoiler_title">default view</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">widgets</span></span>\<span class="hljs-title"><span class="hljs-title">ActiveForm</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">helpers</span></span>\<span class="hljs-title"><span class="hljs-title">Html</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \yii\web\View $this * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \yii\data\DataProviderInterface $dataProvider * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \app\modules\shop\components\FilterModelBase $filterModel * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> ActiveForm: $form * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string $requestType * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> bool $directPopulating */</span></span> <span class="hljs-comment"><span class="hljs-comment">//      safe  if (($safeAttributes = $filterModel-&gt;safeAttributes())) { echo Html::beginTag('div', ['class' =&gt; 'well']); $form = ActiveForm::begin([ 'method' =&gt; $requestType ]); foreach ($safeAttributes as $attribute) { echo $form-&gt;field($filterModel, $attribute)-&gt;textInput([ 'name' =&gt; (!$directPopulating) ? $attribute : null ]); } echo Html::submitInput('search', ['class' =&gt; 'btn btn-default']). Html::endTag('div'); ActiveForm::end(); } echo \yii\grid\GridView::widget([ 'dataProvider' =&gt; $dataProvider, 'filterModel' =&gt; $filterModel ]);</span></span></code> </pre><br></div></div><br><br>  In this view, the default search form is implemented for the <a href="">secure attributes of</a> the search model and the search results are displayed using the GridView widget.  Safe attributes are if they are specified in the script or if they have validation rules. <br><br><h5>  Basic Search Model </h5><br>  It is an abstract class from which the search models transmitted in ListAction should inherit.  It implements the basis for the interaction of the model and the ListAction.  The sampling logic is implemented in the inherited models. <br><br><div class="spoiler">  <b class="spoiler_title">abstract class implementation</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">shop</span></span>\<span class="hljs-title"><span class="hljs-title">components</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">data</span></span>\<span class="hljs-title"><span class="hljs-title">DataProviderInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FilterModelBase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> DataProviderInterface */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_dataProvider; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> DataProviderInterface */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *    *      ,    -    .. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> mixed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildModels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_dataProvider-&gt;getModels(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataProvider</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_dataProvider; } }</code> </pre><br></div></div><br>  It remains to implement the search model and attach a ListAction to search for this model in an arbitrary controller.  In the search model, it is mandatory to implement data sampling.  Everything else depends on the requirements of a particular search model - validation, data composition logic, etc. <br><br>  The data composition logic is overridden in the buildModels method. <br><br>  Below is a simple example of a product search model with comments: <br><br><div class="spoiler">  <b class="spoiler_title">Search model</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">shop</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>\<span class="hljs-title"><span class="hljs-title">search</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">shop</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">data</span></span>\<span class="hljs-title"><span class="hljs-title">ActiveDataProvider</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">data</span></span>\<span class="hljs-title"><span class="hljs-title">Pagination</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductSearch</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shop</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">components</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FilterModelBase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $price; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $page_size = <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *    * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-comment"><span class="hljs-comment">//   ['price', 'required'], //  ,       ['page_size', 'integer', 'integerOnly' =&gt; true, 'min' =&gt; 1] ]; } /** *    * @return ActiveDataProvider|\yii\data\DataProviderInterface */ public function search() { //        $query = shop\models\Product::find() -&gt;with('categories'); /** *  DataProvider,   ,   */ $this-&gt;_dataProvider = new ActiveDataProvider([ 'query' =&gt; $query, 'pagination' =&gt; new Pagination([ 'pageSize' =&gt; $this-&gt;page_size ]) ]); //   ,    if ($this-&gt;validate()) { $query-&gt;where('price &lt;= :price', [':price' =&gt; $this-&gt;price]); } return $this-&gt;_dataProvider; } /** *    , *     *   . * @return array|mixed */ public function buildModels() { $result = []; /** * @var shop\models\Product $product */ foreach ($this-&gt;_dataProvider-&gt;getModels() as $product) { $result[] = array_merge($product-&gt;getAttributes(), [ 'categories' =&gt; $product-&gt;categories ]); } return $result; } }</span></span></code> </pre><br></div></div><br>  It remains to attach the ListAction to the controller and transfer the product search model to it: <br><br><div class="spoiler">  <b class="spoiler_title">configuring the controller to search for products</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">shop</span></span>\<span class="hljs-title"><span class="hljs-title">controllers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">web</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">shop</span></span>\<span class="hljs-title"><span class="hljs-title">actions</span></span>\<span class="hljs-title"><span class="hljs-title">ListAction</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">shop</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>\<span class="hljs-title"><span class="hljs-title">search</span></span>\<span class="hljs-title"><span class="hljs-title">ProductSearch</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; ListAction::className(), <span class="hljs-string"><span class="hljs-string">'filterModel'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductSearch(), <span class="hljs-string"><span class="hljs-string">'directPopulating'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, ] ]; } }</code> </pre><br></div></div><br>  So, when addressing an action using Ajax, we get JSON of approximately the following content: <br><br><div class="spoiler">  <b class="spoiler_title">sampling result</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"list"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"7"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"price"</span></span>: <span class="hljs-string"><span class="hljs-string">"50"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"product title #7"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"product description #7"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"create_time"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"update_time"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"categories"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"category title #1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"category description #1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"create_time"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"update_time"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span> } ] } ], <span class="hljs-attr"><span class="hljs-attr">"pagination"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"pageVar"</span></span>: <span class="hljs-string"><span class="hljs-string">"page"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"forcePageVar"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"route"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"urlManager"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"validatePage"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pageSize"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">"totalCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } }</code> </pre><br></div></div><br>  If the validation fails, the array will contain a description of the error.  With the usual request (not Ajax), we will see something like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b75/413/24e/b7541324ec26c2ca5fb29a05e554b10a.png"><br><br>  For example, a small <a href="https://github.com/ZhandosKz/list-action-example">module</a> was created based on the <a href="https://packagist.org/packages/yiisoft/yii2-app-basic">basic application template</a> .  It needs to be connected in the settings of the application Yii2 and start the migration with test data <br><br><pre> <code class="bash hljs">php yii migrate --migrationPath=modules/shop/migrations</code> </pre><br><br>  Summarizing all the above, this functionality makes it possible to create a uniform implementation of a sample of collections and any other repeating functionality. <br><br>  As an example from reality, we use this functionality in the API, one action implements, depending on the request, the output of the response in JSON or a web interface for testing. </div><p>Source: <a href="https://habr.com/ru/post/208556/">https://habr.com/ru/post/208556/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../208540/index.html">Perfect smartphone</a></li>
<li><a href="../208542/index.html">Chef for 21 days. Part one. Introduction</a></li>
<li><a href="../208544/index.html">NSA switches to cooling its data center with sewage following the example of Google</a></li>
<li><a href="../208552/index.html">Development Quick Look plugin for OS X</a></li>
<li><a href="../208554/index.html">Aviate launcher goes under Yahoo wing</a></li>
<li><a href="../208558/index.html">Solving Media Identity Problem in DevOps Methodology</a></li>
<li><a href="../208560/index.html">Traffic light on PLC - 30 blocks</a></li>
<li><a href="../208562/index.html">Organizing the storage of personal files locally and in the clouds</a></li>
<li><a href="../208564/index.html">The history of a heavy project: a little about the bureaucracy, infrastructure and software development process</a></li>
<li><a href="../208566/index.html">Installing ownCloud 6 on Debian 7 wheezy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>