<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>AWS Insight: Virtual Private Cloud</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, habrasoobschestvo! 

 Today, I finally plucked up courage and have time to tell you about the wonderful service that Amazon Web Services provides:...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>AWS Insight: Virtual Private Cloud</h1><div class="post__text post__text-html js-mediator-article">  Hi, habrasoobschestvo! <img src="https://habrastorage.org/storage2/87a/d81/82c/87ad8182cc066b729b08398c09df962f.png" alt="image" align="right"><br><br>  Today, I finally plucked up courage and have time to tell you about the wonderful service that Amazon Web Services provides: <a href="http://aws.amazon.com/vpc/">Virtual Private Cloud - VPC</a> . <br><br>  <b>VPC</b> is a service that allows you to create private isolated networks in the Amazon public cloud.  What does VPC provide? <br><ul><li>  Gray Address Subnets </li><li>  Full control over the addresses </li><li>  Dynamic and convenient management of network devices and routing </li><li>  Supports EC2, RDS, SQS, ElastiCache and other services </li><li>  Much more .. </li></ul><br>  VPC has a lot of internal concepts and terms, let me describe them as they are configured.  And today, together with you, I will set up a cross-zone network for VPC for greater fault tolerance. <br><a name="habracut"></a><br><h4>  VPC </h4><br>  So, in the console, go to <a href="https://console.aws.amazon.com/vpc">VPC</a> and create a new private cloud: <br><img src="https://habrastorage.org/storage2/3bb/c8d/6d1/3bbc8d6d148800e0907e9349983ae4b5.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For example, I chose the sixteenth subnet 10.50.0.0, which includes 256 * 256 = 65536 addresses.  By the way, we can select the Tenancy parameter: <br><ul><li>  default </li><li>  separately </li></ul><br>  By default, this is as usual - your instances are raised anywhere.  But a separate <a href="http://aws.amazon.com/dedicated-instances/">"apartment"</a> allows you to run instances close, but for a fee. <br><br><h4>  Subnetworks </h4><br>  Created a cloud, now you need to create <b>subnets</b> .  Our cloud is tied to a region and can have many subnets (where can we stuff 65k addresses, then?), And the subnets themselves are already tied to regions. <br><br>  There are also subnets: <br><ul><li>  <b>private</b> - do not have direct access to the Internet, only through public networks and NAT </li><li>  <b>public</b> - can access the Internet through Elastic IP and Internet Gateway </li></ul><br>  So, let's create 2 subnets in one zone: private and public, and in the other only private, so that it turns out like this: <br><img src="https://habrastorage.org/storage2/be7/74e/893/be774e893256a5604a14016d733d3521.png" alt="image"><br><br>  The private and public subnet will become later, therefore we will create 3 simple subnets: <br><img src="https://habrastorage.org/storage2/b9d/128/481/b9d1284815165ad6aea44e918a729258.png" alt="image"><br><br>  And later we have what we wanted: <br><img src="https://habrastorage.org/storage2/3c7/c13/825/3c7c138256390ed9d03acd12f5a3389f.png" alt="image"><br><br><h4>  Internet gateway </h4><br>  As I mentioned earlier, a public network can have direct access to the Internet through a gateway. <br><br>  <b>Internet Gateway</b> is a virtual device that allows hosts that have Elastic IP (EIP) to the Internet.  Let's create a gateway and attach it to our cloud, so that it is: <br><img src="https://habrastorage.org/storage2/5e7/fc0/29f/5e7fc029f1a1838d7ab49f180e82e7d0.png" alt="image"><br><br>  Actually, we create the gateway: <br><img src="https://habrastorage.org/storage2/b3b/b4c/7ff/b3bb4c7ffaf4e85c58e9b1a2013fe9d1.png" alt="image"><br><br>  We cling the gateway to the cloud: <br><img src="https://habrastorage.org/storage2/db7/909/df9/db7909df9e69a0cb7c9a4d9318c9b01c.png" alt="image"><br><br><h4>  Route tables </h4><br>  How now to direct our public network to the newly created gateway?  For this there are routes. <br><br>  <b>Routes</b> are virtual routes that span one or more subnets and give information about how traffic should be distributed.  From the side of the hosts, this is not displayed.  They have a simple main route to the first (for example 10.50.1.1) host on the subnet.  VPC itself resolves through Routes where the traffic will go. <br><br>  By default, when creating a subnet, a routing table is created, we leave it for private networks and create a new one: <br><img src="https://habrastorage.org/storage2/0cd/406/555/0cd406555d3474c0f0eefed32038ed1d.png" alt="image"><br><br>  Selecting a new table, at the bottom of the page we can see its components.  Let's create a route to the Internet 0.0.0.0/24, which will go through our Internet Gateway: <br><img src="https://habrastorage.org/storage2/dc0/aa5/710/dc0aa5710122638c219800d6d63d1c16.png" alt="image"><br><br>  Well, we associate our public subnet with this table: <br><img src="https://habrastorage.org/storage2/e83/b30/527/e83b30527860f693e0eb8ebec3f5bc60.png" alt="image"><br><br>  So, let's raise the EC2 instance in our public subnet and give it the EIP, and put the private address 10.50.3.254 <i>(we can control them !!!)</i> so that it is: <br><img src="https://habrastorage.org/storage2/ccc/6b0/fe9/ccc6b0fe9a17e00b0ded00146222ff27.png" alt="image"><br><br>  Let's start by creating an instance in EC2.  In fact, you need to check VPC and select the desired subnet: <br><img src="https://habrastorage.org/storage2/830/7d1/eab/8307d1eabedebd94eee371af9fff0370.png" alt="image"><br><br>  While the instance is running, we‚Äôll get EIP for VPC. But where it‚Äôs usually, just choose not EC2: <br><img src="https://habrastorage.org/storage2/19a/2f4/68b/19a2f468b9be032749bf73251dd51dcf.png" alt="image"><br><br><h4>  Network interfaces </h4><br>  When you create a new instance in the VPC automatically creates a network interface. <br><br>  <b>A network interface</b> is a virtual device with which you can manage the physical interfaces of an instance.  Network interfaces are managed from the EC2 console. <br><br>  So, let's see what we got there: <br><img src="https://habrastorage.org/storage2/897/794/034/897794034e74906b6d32809c2c3816a2.png" alt="image"><br><br>  Now we will try to assign the interface a new private address: <br><br><br>  Now the interface has virtually 2 addresses.  Well, let's link to the EIP interface: <br><img src="https://habrastorage.org/storage2/1e7/98a/981/1e798a981830362e5e652a43ff7ebdca.png" alt="image"><br><br>  That's all, our instance is available outside: <br><pre><code class="bash hljs">$ telnet 107.23.210.139 22 Trying 107.23.210.139... Connected to 107.23.210.139. Escape character is <span class="hljs-string"><span class="hljs-string">'^]'</span></span>. SSH-2.0-OpenSSH_5.3</code> </pre> <br><br><h4>  NAT Instance </h4><br>  As mentioned earlier, private subnets should only access the Internet through NAT.  So let's make our new instance as such.  Also, I usually put OpenVP on this instance in order to have access to VPC. <br><br>  <b>1.</b> Resolve forwarding in <i>/etc/sysctl.conf</i> : <br><pre> <code class="bash hljs">net.ipv4.ip_forward = 1</code> </pre><br>  <b>2.</b> Let's solve forvarding in iptables: <br><pre> <code class="bash hljs">iptables -t filter -A FORWARD -s 10.50.0.0/16 -j ACCEPT iptables -t filter -A FORWARD -d 10.50.0.0/16 -j ACCEPT iptables -t nat -A POSTROUTING -s 10.50.0.0/16 -o eth0 -j MASQUERADE</code> </pre><br><br>  Next, install and configure the <a href="https://safesrv.net/install-openvpn-on-centos/">OpenVPN server</a> .  So, suppose that we did everything and we can connect to the network. <br><br><h4>  Private networks </h4><br>  How can private subnets be able to understand how to go to the Internet?  Yes Easy!  All the same routes.  Let's take the remaining table and make changes to it: we will choose our NAT instance for the Internet as the gateway 0.0.0.0/0: <br><img src="https://habrastorage.org/storage2/21b/ad8/2b8/21bad82b8dc64b208d4c6952bd6192b4.png" alt="image"><br><br>  Well, let's associate this table with the two remaining subnets: <br><img src="https://habrastorage.org/storage2/4f7/d2b/3d5/4f7d2b3d5cff4811a2eed1e276e89ed2.png" alt="image"><br><br><h4>  Dedication </h4><br>  That's all, now we can create instances in our private subnets that will be available only through OpenVPN.  Directly access to them can be opened through the Elastic Load Balancer, which is exposed to the outside.  Subnet can later take such a simple but interesting view: <br><img src="https://habrastorage.org/storage2/bb0/937/e1b/bb0937e1b91a863c8590ad48f6d2a5f1.png" alt="image"><br><br>  In VPC, there are still many nuances, for example, a VPN to your data center, which is AWS menthe and the heap of fine details, but in general the conclusion is obvious.  With VPC, you can create a resilient AWS-based private cloud. <br><br>  Questions? </div><p>Source: <a href="https://habr.com/ru/post/167635/">https://habr.com/ru/post/167635/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../167619/index.html">Runetology (183): Elena Orlova, PayU CEO</a></li>
<li><a href="../167621/index.html">Startup Ideas Search Methods</a></li>
<li><a href="../167625/index.html">Corporate blog - do you need a project company?</a></li>
<li><a href="../167631/index.html">Moving folders in Yandex mail</a></li>
<li><a href="../167633/index.html">Cisco SMARTnet: Estimated Budget and Warranty for Enterprise Networks</a></li>
<li><a href="../167641/index.html">1800mAh high capacity battery for Nokia Lumia 820 [HLI-BP5TSL]</a></li>
<li><a href="../167643/index.html">Review of the OPPO Finder X907 smartphone</a></li>
<li><a href="../167647/index.html">Editing static HTML pages in the browser</a></li>
<li><a href="../167649/index.html">Lotus 1-2-3: 30th anniversary of the coup</a></li>
<li><a href="../167651/index.html">The Battle of Asakai: How EVE Online handles giant battles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>