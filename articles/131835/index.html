<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Now how do I automate</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, are you tired of typing passwords, writing commands, looking at boring wallpapers? Do you want to conquer the universe and rest on your laurels? M...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Now how do I automate</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/ad16799a/7030bb8f/83f9d4bc/54eb6f09.jpg"><br>  So, are you tired of typing passwords, writing commands, looking at boring wallpapers?  Do you want to conquer the universe and rest on your laurels?  Make the robots work instead of yourself! <br><a name="habracut"></a><br><br><h4>  Putting a robot </h4><br>  To train tolerance and loyalty, Yoda's teacher allowed us to log into all 1000 servers of the Imperial Ewok Breeding Committee in weightless conditions on SSH, to hammer in username and password and check who created the file size /tmp/yoda_is_awesome.txt <br>  We write a script that will collect passwords and commands for us.  From pre-installed / easy-to-deliver to unix / linux there are: Bash / Shell, Perl, Python. <br>  There are more specialized modules / programs for a task with SSH in Bash / Perl / Python.  But tomorrow Yoda‚Äôs teacher will ask to do it via Telnet too, then sudo echo ‚ÄúYoda is superman!‚Äù.  Consider the more general Expect in conjunction with Bash, the ‚ÄúExpect.pm‚Äù module for Perl, the ‚Äúpexpect‚Äù module for Python. <br>  Listing scripts at the end. <br>  We begin to meditate on the running lines: <br><pre><code class="bash hljs">$ ./sshauto.sh|pl|py <span class="hljs-string"><span class="hljs-string">'ls -l /tmp/yoda_is_awesome.txt'</span></span></code> </pre> <br>  Output: <br><pre> <code class="bash hljs">Password: pavlo@10.10.10.10<span class="hljs-string"><span class="hljs-string">'s password: -rw-r--r-- 1 root root 56 Jul 19 2006 /tmp/yoda_is_awesome.txt pavlo@20.20.20.20'</span></span>s password: -rw-r--r-- 1 root root 56 Jul 19 2006 /tmp/yoda_is_awesome.txt pavlo@30.30.30.30<span class="hljs-string"><span class="hljs-string">'s password: -rw-r--r-- 1 root root 56 Jul 19 2006 /tmp/yoda_is_awesome.txt &lt;  &gt;</span></span></code> </pre><br>  Meditation is over.  Finish the file ‚Äúgrep‚Äù to taste. <br><br><h4>  We study foreign robots </h4><br>  <b>Public key</b> .  Spread out all 1000 SSH Public key servers for your user.  This is time consuming, and under other conditions (another user, the need to use sudo, ...) may be useless. <br>  <b>cssh (Cluster SSH)</b> .  Opens the console by the number of servers, and one additional window to execute commands on all servers simultaneously.  A good solution for 3 servers, but not for 1000. <br>  <b>sshpass</b> .  Passing a password for ssh in clear view to STDIN is not supported.  But there is for example sshpass: `sshpass -p 'PASSWORD' ssh pavlo@10.10.10.10 'ls -l / tmp / temp_file.txt'` which solves this problem, but will not help if additional sudo or user changes are required. <br>  <b>Microscopes</b> .  (CFEngine, Puppet, own version).  Provided that it is everywhere.  He can also entrust such a task.  But this is no longer the intended use, ‚ÄúHammer nails with a microscope.‚Äù 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Dark side </h4><br>  None of the listed solutions met me working out of the box with the usual installation of the operating system.  Each of them requires the installation of at least one package. <br><br><h4>  Galaxy capture </h4><br>  Here are examples of the implementation / use of "Expect" in Bash, Perl, Python. <br>  Script requirements: <br>  a.  ip_addresses.txt is a file with a list of all IP addresses. <br>  b.  The password must be entered at the start of the hidden script. <br><br>  <b>BASH</b> <br>  Installation required: expect <br><pre> <code class="bash hljs">$ cat ./sshauto.sh <span class="hljs-comment"><span class="hljs-comment">#!/bin/bash echo -n "Password:" read -s passw; echo stty echo while read IP do ./sshlogin.exp $passw $IP "$1" 2&gt; /dev/null done &lt; ip_addresses.txt $ cat ./sshlogin.exp #!/usr/bin/expect -f set password [lrange $argv 0 0] set ip_address [lrange $argv 1 1] set command [lindex $argv 2] spawn ssh -q -t -o StrictHostKeyChecking=no pavlo@$ip_address $command expect "*?assword:*" send -- "$password\r" expect eof</span></span></code> </pre><br><br>  <b>PERL</b> <br>  Requires installation of modules: Expect, Term :: ReadKey <br><pre> <code class="perl hljs">$ cat ./sshauto.pl <span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl use Expect; use Term::ReadKey; print "Password:"; ReadMode 'noecho'; $password = ReadLine(0); chomp($password); print "\n"; ReadMode 'normal'; $command = $ARGV[0]; open (IP_list, 'ip_addresses.txt'); foreach $IP (&lt;IP_list&gt;) { chomp($IP); $cli = "/usr/bin/ssh -q -t -o StrictHostKeyChecking=no et0362\@$IP $command"; $exp = new Expect; $exp-&gt;raw_pty(1); $exp-&gt;spawn($cli) or die "Cannot spawn $cli: $!\n"; $exp-&gt;expect(5, [ qr /ssword:*/ =&gt; sub { my $exph = shift; $exph-&gt;send("$password\n"); exp_continue; }] ); }; close (IP_list);</span></span></code> </pre><br><br>  <b>Python</b> <br>  Module installation required: pexpect <br><pre> <code class="python hljs">$ cat ./sshauto.py <span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python import pexpect import getpass import sys command = sys.argv[1] password = getpass.getpass() IP_list = open('ip_addresses.txt') IP = IP_list.readline() while IP: print IP, cli="ssh pavlo@%s %s" % (IP,command) exp = pexpect.spawn(cli) exp.expect('password:') exp.sendline(password) exp.expect(pexpect.EOF) print exp.before IP = IP_list.readline() IP_list.close()</span></span></code> </pre><br>  Well that's all.  Successful to you achievements in the field of automation. <br><br>  * The article used a picture <a href="http://pricoles.ru/%3Fp%3D1752">from here.</a> </div><p>Source: <a href="https://habr.com/ru/post/131835/">https://habr.com/ru/post/131835/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131827/index.html">Lending to startups</a></li>
<li><a href="../131830/index.html">History, part 2. The formation of a global brand: LG from 1980 to 1995</a></li>
<li><a href="../131831/index.html">Microsoft helps develop Samba</a></li>
<li><a href="../131832/index.html">Million Dollar Mind Game / Video Game Geeks</a></li>
<li><a href="../131834/index.html">Vote for the best Mango app for Windows Phone</a></li>
<li><a href="../131836/index.html">rbenv and ruby-build: an easy alternative to RVM</a></li>
<li><a href="../131839/index.html">Microsoft and the school of Internet marketing "Netology" announced a partnership. Customers benefit!</a></li>
<li><a href="../131840/index.html">Spanish court found piracy harmless</a></li>
<li><a href="../131841/index.html">What can really give specialized software for marketing?</a></li>
<li><a href="../131842/index.html">CMS rating system</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>