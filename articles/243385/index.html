<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Processors, cores and threads. System topology</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will try to describe the terminology used to describe systems capable of executing several programs in parallel, that is, multi-core...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Processors, cores and threads. System topology</h1><div class="post__text post__text-html js-mediator-article">  In this article I will try to describe the terminology used to describe systems capable of executing several programs in parallel, that is, multi-core, multiprocessing, multi-threaded.  Different types of concurrency in the IA-32 CPU appeared at different times and in a slightly inconsistent order.  In all this, it is quite easy to get confused, especially considering that operating systems carefully hide parts from not too sophisticated application programs. <br><br><img src="https://habrastorage.org/files/b1a/f1f/27c/b1af1f27c3c54e6d9b4c238eb735111f.png"><br><br>  The terminology used below is used in documentation for Intel processors.  Other architectures may have different names for similar concepts.  Where they are known to me, I will mention them. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The purpose of the article is to show that with all the variety of possible configurations of multiprocessor, multi-core and multi-threaded systems for programs running on them, opportunities are created both for abstraction (ignoring differences) and for taking into account the specifics (the ability to programmatically learn the configuration). <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Warning Signs ¬Æ, ‚Ñ¢, ¬© in the article</b> <div class="spoiler_text">  My <a href="http://habrahabr.ru/company/intel/blog/204838/">comment</a> explains why company employees should use copyright marks in public communications.  In this article they had to be used quite often. </div></div><br><br><h4>  CPU </h4><br>  Of course, the most ancient, most often used and ambiguous term is ‚Äúprocessor‚Äù. <br><br>  In the modern world, the processor is the (package) that we buy in a beautiful Retail box or a not very beautiful OEM bag.  An indivisible entity inserted into the socket on the motherboard.  Even if there is no connector and it is impossible to remove it, that is, if it is soldered tightly, it is one chip. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b87/467/87e/b8746787eed04380936f34318098a53d.jpg"></div><br><br>  Mobile systems (phones, tablets, laptops) and most desktops have one processor.  Workstations and servers can sometimes boast two or more processors on the same motherboard. <br><br>  Support for multiple CPUs in one system requires numerous changes in its design.  At a minimum, it is necessary to ensure their physical connection (to provide several sockets on the motherboard), to resolve issues of processor identification (see later in this article, as well as my <a href="http://habrahabr.ru/company/intel/blog/220851/">previous</a> note), coordination of memory access and interrupt delivery (the interrupt controller should be able to route interrupts on multiple processors) and, of course, support from the operating system.  I, unfortunately, could not find a documentary mention of the creation of the first multiprocessor system on Intel processors, but Wikipedia <a href="http://en.wikipedia.org/wiki/Sequent_Computer_Systems">claims</a> that Sequent Computer Systems supplied them already in 1987, using Intel 80386 processors. Widespread support of several chips in one system becomes available starting with the Intel¬Æ Pentium. <br><br>  If there are several processors, then each of them has its own connector on the board.  Each of them has complete independent copies of all resources, such as registers, executing devices, caches.  They share a common memory - RAM.  Memory can be connected to them in various and rather nontrivial ways, but this is a separate story that goes beyond the scope of this article.  It is important that in any case for the executable programs should create the illusion of a uniform shared memory, accessible from all processors included in the system. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1d7/95b/162/1d795b162c8c4f30a9e13181877dbdc5.jpg"></div><br>  <i>Ready to take off!</i>  <i>Intel¬Æ Desktop Board D5400XS</i> <br><br><h4>  Core </h4><br>  Historically, multi-core Intel IA-32 appeared later Intel¬Æ HyperThreading, but in the logical hierarchy, it is next. <br><br>  It would seem that if there are more processors in the system, then its performance is higher (on tasks capable of using all the resources).  However, if the cost of communications between them is too high, then the entire gain from concurrency is killed by long delays in the transmission of common data.  This is what is observed in multiprocessor systems - both physically and logically they are very far from each other.  For effective communication in such conditions, you have to come up with specialized tires, such as Intel¬Æ QuickPath Interconnect.  The power consumption, size and price of the final solution, of course, do not decrease from all this.  The high integration of components must come to the rescue - the circuits that execute parts of a parallel program must be dragged closer to each other, preferably one crystal.  In other words, in one processor it is necessary to organize several <i>cores</i> , all identical to each other, but working independently. <br><br>  The first multi-core IA-32 processors from Intel were introduced in 2005.  Since then, the average number of cores in server, desktop, and now mobile platforms has been steadily increasing. <br><br>  Unlike two single-core processors on the same system that share only memory, the two cores can also have shared caches and other resources responsible for interacting with the memory.  Most often, the first-level caches remain private (each kernel has its own), while the second and third levels can be both general and separate.  Such an organization of the system reduces the delivery of data between neighboring cores, especially if they are working on a common task. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/cf5/aa3/9ea/cf5aa39ea95a488fbfda486ff9cc987b.jpg"></div><br>  Micrograph of a four-core Intel processor, codenamed Nehalem.  Separate cores, shared L3 cache, as well as QPI links to other processors and a shared memory controller are allocated. <br><br><h4>  Hyperstream </h4><br>  Until around 2002, the only way to get an IA-32 system capable of running two or more programs in parallel was to use multiprocessor systems.  Intel¬Æ Pentium¬Æ 4, as well as the Xeon line with the code name Foster (Netburst), introduced a new technology - hypertreads or hyperflows - Intel¬Æ HyperThreading (hereinafter referred to as HT). <br><br>  There is nothing new under the sun.  HT is a special case of what is referred to in the literature as simultaneous multithreading (simultaneous multithreading, SMT).  In contrast to the ‚Äúreal‚Äù cores, which are complete and independent copies, in the case of HT only one part of the internal nodes is duplicated in one processor, primarily those responsible for storing the architectural state - the registers.  The executive nodes responsible for the organization and processing of data remain singular, and at any given time they are used by at most one of the streams.  Like kernels, hyper-threads divide caches between themselves, but starting from what level it depends on the specific system. <br><br>  I will not try to explain all the pros and cons of designs with SMT in general and with HT in particular.  An interested reader can find a fairly detailed discussion of technology in many sources, and, of course, on <a href="http://en.wikipedia.org/wiki/Hyper-threading">Wikipedia</a> .  However, I will note the following important point explaining the current restrictions on the number of hyper-flows in real products. <br><br><h6>  Flow restrictions </h6><br>  In what cases is the presence of a ‚Äúdishonest‚Äù multi-core in the form of HT justified?  If one application thread is not able to load all executing nodes inside the kernel, then they can be ‚Äúlent‚Äù to another thread.  This is typical for applications that have a ‚Äúbottleneck‚Äù not in calculations, but when accessing data, that is, often generating cache misses and having to wait for the delivery of data from memory.  At this time, the core without HT will be forced to idle.  The presence of HT allows you to quickly switch free executing nodes to another architectural state (since it is just duplicated) and execute its instructions.  This is a special case of reception called latency hiding, when one long-term operation during which useful resources are idle is masked by the parallel execution of other tasks.  If the application already has a high degree of utilization of kernel resources, the presence of hyper-streams will not allow acceleration - here you need ‚Äúhonest‚Äù kernels. <br><br>  Typical scenarios for desktop and server applications designed for general-purpose machine architectures have the potential for concurrency implemented with HT.  However, this potential is quickly "consumed."  Perhaps for this reason, on almost all IA-32 processors, the number of hardware hyper-threads does not exceed two.  In typical scenarios, the gain from using three or more hyper-streams would be small, but the loss in crystal size, its power consumption and cost is significant. <br><br>  Another situation is observed on typical tasks performed on video accelerators.  Therefore, these architectures are characterized by the use of SMT technology with a larger number of threads.  Since Intel¬Æ Xeon Phi coprocessors (introduced in 2010) are ideologically and genealogically quite close to video cards, they can have <i>four</i> hyper-threads on each core - a unique configuration for IA-32. <br><br><h4>  Logical processor </h4><br>  Of the three ‚Äúlevels‚Äù of parallelism described (processors, cores, hyper-threads), some or even all may be missing in a particular system.  This is affected by BIOS settings (multicore and multithreading are disabled independently), microarchitecture features (for example, HT was absent in the Intel¬Æ Core ‚Ñ¢ Duo, but was returned with the release of Nehalem) and events during system operation (multiprocessor servers can turn off failed processors in case of fault detection and continue to ‚Äúfly‚Äù on the remaining ones).  How is this multilevel concurrency zoo visible to the operating system and, ultimately, application applications? <br><br>  Further, for convenience, we denote the number of processors, cores and threads in some system by a triple ( <i>x</i> , <i>y</i> , <i>z</i> ), where <i>x</i> is the number of processors, <i>y</i> is the number of cores in each processor, and <i>z</i> is the number of hyper flows in each core.  Further, I will call this top three a well-established term, which has little with the section of mathematics.  The product <i>p</i> = <i>xyz</i> determines the number of entities called <i>logical processors of the</i> system.  It defines the total number of independent application process contexts in a shared memory system running in parallel that the operating system has to consider.  I say "forced" because it cannot control the order of execution of two processes located on different logical processors.  This applies, among other things, to hyper-flows: although they work ‚Äúsequentially‚Äù on one core, a specific order is dictated by the hardware and is not available for monitoring or controlling programs. <br><br>  Most often, the operating system hides from the final applications the features of the physical topology of the system on which it is running.  For example, the following three topologies: (2, 1, 1), (1, 2, 1) and (1, 1, 2) - the OS will be in the form of two logical processors, although the first one has two processors, the second - two kernel, and the third - just two threads. <br><br><img src="https://habrastorage.org/files/1e4/804/abe/1e4804abe34340eaaa96d2dbc80a4ca1.png"><br>  <i>The Windows Task Manager displays 8 logical processors;</i>  <i>but how much is it in processors, cores and hyper-threads?</i> <br><br><img src="https://habrastorage.org/files/3f0/814/1c9/3f08141c94c74786b95e4eb0e7884fc3.png"><br>  <i>The Linux <code>top</code> features 4 logical processors.</i> <br><br>  This is quite convenient for creators of application applications - they do not have to deal with the equipment features that are often irrelevant for them. <br><br><h4>  Software definition of topology </h4><br>  Of course, abstraction of topology into a single number of logical processors in some cases creates enough grounds for confusion and misunderstanding (in heated Internet disputes).  Computational applications that want to squeeze maximum performance out of iron require detailed control over where their streams will be located: closer to each other on neighboring hyper-flows or vice versa, away on different processors.  The speed of communication between logical processors in a single core or processor is much higher than the speed of data transfer between processors.  The possibility of heterogeneity in the organization of RAM also complicates the picture. <br><br>  Information about the topology of the system as a whole, as well as the position of each logical processor in the IA-32, is available using the CPUID instruction.  Since the appearance of the first multiprocessor systems, the identification scheme of logical processors has been expanded several times.  To date, its parts are contained in sheets 1, 4 and 11 of the CPUID.  Which sheet to look at can be determined from the following flowchart taken from article [2]: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/632/1ab/b0b/6321abb0b653443284417a041ae99d01.png"></div><br><br>  I will not bore here with all the details of individual parts of this algorithm.  If interest arises, then this can be devoted to the next part of this article.  I will refer the interested reader to [2], which deals with this issue in as much detail as possible.  Here I first briefly describe what APIC is and how it relates to topology.  Then we will consider working with the 0xB sheet (eleven in decimal notation), which is currently the last word in ‚Äúapi-building‚Äù. <br><br><h6>  APIC ID </h6><br>  Local APIC (advanced programmable interrupt controller) is a device (now part of the processor) that is responsible for working with interrupts coming to a specific logical processor.  Each logical processor has its own APIC.  And each of them in the system must have a unique APIC ID value.  This number is used by interrupt controllers to address when delivering messages, and all others (for example, the operating system) to identify logical processors.  The specification for this interrupt controller evolved from an Intel 8259 PIC chip through Dual PIC, APIC and <acronym>xAPIC</acronym> to <acronym>x2APIC</acronym> . <br><br>  Currently, the width of the number stored in the APIC ID has reached a full 32 bits, although in the past it was limited to 16, and even earlier - only 8 bits.  Today, the remnants of old days are scattered around the entire CPUID, but in CPUID.0xB.EDX [31: 0] all 32 bits of the APIC ID are returned.  On each logical processor that independently executes the CPUID instruction, its value will be returned. <br><br><h6>  Clarification of relationships </h6><br>  The APIC ID value itself does not say anything about topology.  To find out which two logical processors are inside one physical (i.e., are ‚Äúbrothers‚Äù hyper-environments), which two are inside one processor, and which turned out to be completely different processors, you need to compare their APIC ID values.  Depending on the degree of kinship, some of their bits will be the same.  This information is contained in CPUID.0xB, which is encoded with an operand in ECX.  Each of them describes the position of the bit field of one of the topology levels in EAX [5: 0] (more precisely, the number of bits that need to be shifted to the right in the APIC ID to remove the lower levels of the topology), as well as the type of this level - hyperflow, core or processor , - in ECX [15: 8]. <br><br><img src="https://habrastorage.org/files/84c/a02/77f/84ca0277f9b548ef82b3cb755e1c1481.png"><br><br>  Logical processors that are inside one core will have the same APIC ID bits, except those belonging to the SMT field.  For logical processors that are in the same processor, all bits except the Core and SMT fields.  Since the number of podlist with CPUID.0xB can grow, this scheme will allow supporting the description of topologies and with a greater number of levels, if necessary in the future.  Moreover, it will be possible to introduce intermediate levels between the already existing ones. <br><br>  An important consequence of the organization of this scheme is that there can be ‚Äúholes‚Äù in the set of all APIC IDs of all logical processors of the system, i.e.  they will not go consistently.  For example, in a multi-core processor with HT turned off, all APIC IDs may turn out to be even, since the low-order bit, which is responsible for coding the hyperflow number, will always be zero. <br><br>  Note that CPUID.0xB is not the only source of information on logical processors available to the operating system.  The list of all processors available to it, along with their APIC ID values, is encoded in the MADT ACPI table [3, 4]. <br><br><h4>  Operating systems and topology </h4><br>  Operating systems provide information about the topology of logical processors to applications using their own interfaces. <br><br>  In Linux, topology information is contained in the <code>/proc/cpuinfo</code> pseudo file, as well as the output from the <code>dmidecode</code> .  In the example below, I filter the contents of cpuinfo on some four-core system without HT, leaving only entries related to the topology: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs ruby">ggg@shadowbox<span class="hljs-symbol"><span class="hljs-symbol">:~</span></span>$ cat /proc/cpuinfo <span class="hljs-params"><span class="hljs-params">|grep 'processor\|</span></span>physical\ id\<span class="hljs-params"><span class="hljs-params">|siblings\|</span></span>core\<span class="hljs-params"><span class="hljs-params">|cores\|</span></span>apicid<span class="hljs-string"><span class="hljs-string">' processor : 0 physical id : 0 siblings : 4 core id : 0 cpu cores : 2 apicid : 0 initial apicid : 0 processor : 1 physical id : 0 siblings : 4 core id : 0 cpu cores : 2 apicid : 1 initial apicid : 1 processor : 2 physical id : 0 siblings : 4 core id : 1 cpu cores : 2 apicid : 2 initial apicid : 2 processor : 3 physical id : 0 siblings : 4 core id : 1 cpu cores : 2 apicid : 3 initial apicid : 3</span></span></code> </pre><br></div></div><br><br>  In FreeBSD, the topology is communicated via the sysctl mechanism in the kern.sched.topology_spec variable as XML: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs xml">user@host:~$ sysctl kern.sched.topology_spec kern.sched.topology_spec: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groups</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cache-level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mask</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0xff"</span></span></span><span class="hljs-tag">&gt;</span></span>0, 1, 2, 3, 4, 5, 6, 7<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">children</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cache-level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mask</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0xff"</span></span></span><span class="hljs-tag">&gt;</span></span>0, 1, 2, 3, 4, 5, 6, 7<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">children</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cache-level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mask</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0x3"</span></span></span><span class="hljs-tag">&gt;</span></span>0, 1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flags</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"THREAD"</span></span></span><span class="hljs-tag">&gt;</span></span>THREAD group<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SMT"</span></span></span><span class="hljs-tag">&gt;</span></span>SMT group<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flags</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cache-level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mask</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0xc"</span></span></span><span class="hljs-tag">&gt;</span></span>2, 3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flags</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"THREAD"</span></span></span><span class="hljs-tag">&gt;</span></span>THREAD group<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SMT"</span></span></span><span class="hljs-tag">&gt;</span></span>SMT group<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flags</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cache-level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mask</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0x30"</span></span></span><span class="hljs-tag">&gt;</span></span>4, 5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flags</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"THREAD"</span></span></span><span class="hljs-tag">&gt;</span></span>THREAD group<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SMT"</span></span></span><span class="hljs-tag">&gt;</span></span>SMT group<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flags</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cache-level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mask</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0xc0"</span></span></span><span class="hljs-tag">&gt;</span></span>6, 7<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flags</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"THREAD"</span></span></span><span class="hljs-tag">&gt;</span></span>THREAD group<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SMT"</span></span></span><span class="hljs-tag">&gt;</span></span>SMT group<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flag</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flags</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">children</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">children</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groups</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><br>  In MS Windows 8, topology information can be viewed in Task Manager. <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/files/d98/731/7f6/d987317f66c244dfbf223697161b9526.png"></div><br></div></div><br><br>  They are also provided by the console utility <a href="http://technet.microsoft.com/en-us/sysinternals/cc835722.aspx">Sysinternals Coreinfo</a> and the API call <a href="http://blogs.technet.com/b/winserverperformance/archive/2008/09/13/getting-system-topology-information-on-windows.aspx">GetLogicalProcessorInformation</a> . <br><br><h4>  Full picture </h4><br>  I will illustrate once again the relationship between the concepts of "processor", "core", "hyper-thread" and "logical processor" with a few examples. <br><br><h6>  System (2, 2, 2) </h6><br><img src="https://habrastorage.org/files/dfb/e05/4f1/dfbe054f1cbc4d0cb51ba1abca3961a2.png"><br><br><h6>  System (2, 4, 1) </h6><br><img src="https://habrastorage.org/files/bc3/9b6/358/bc39b6358048467fb87a6789ec83c63c.png"><br><br><h6>  System (4, 1, 1) </h6><br><img src="https://habrastorage.org/files/76d/bb8/694/76dbb8694eff44409c654004ff121c73.png"><br><br><h4>  Other matters </h4><br>  In this section, I brought some oddities that arise due to the multi-level organization of logical processors. <br><br><h6>  Cache </h6><br>  As I already mentioned, the caches in the processor also form a hierarchy, and it is quite strongly connected with the topology of the cores, but it is not uniquely defined by it.  To determine which caches for which logical processors are common and which are not, the output of CPUID.4 and its pods is used. <br><br><h6>  Licensing </h6><br>  Some software products are supplied by the number of licenses determined by the number of processors in the system on which they will be used.  Others - the number of cores in the system.  Finally, to determine the number of licenses, the number of processors can be multiplied by a fractional "core factor", depending on the type of processor! <br><br><h6>  Virtualization </h6><br>  Virtualization systems capable of simulating multi-core systems can assign an arbitrary topology to virtual processors inside the machine that do not coincide with the actual hardware configuration.  So, inside the host system (1, 2, 2), some well-known virtualization systems by default move all logical processors to the upper level, i.e.  create a configuration (4, 1, 1).  Combined with the topology-dependent licensing features, this can produce fun effects. <br><br>  Thanks for attention! <br><br><h4>  Literature </h4><br><ol><li>  Intel Corporation.  Intel¬Æ 64 and IA-32 Architectures Software Developer's Manual.  Volumes 1-3, 2014. <a href="http://www.intel.com/content/www/us/en/processors/architectures-software-developer-manuals.html">www.intel.com/content/www/us/en/processors/architectures-software-developer-manuals.html</a> </li><li>  Shih Kuo.  Intel¬Æ 64 Architecture Processor Topology Enumeration, 2012 - <a href="https://software.intel.com/en-us/articles/intel-64-architecture-processor-topology-enumeration">software.intel.com/en-us/articles/intel-64-architecture-processor-topology-enumeration</a> </li><li>  OSDevWiki.  MADT.  <a href="http://wiki.osdev.org/MADT">wiki.osdev.org/MADT</a> </li><li>  OSDevWiki.  Detecting CPU Topology.  <a href="http://wiki.osdev.org/Detecting_CPU_Topology_%252880x86%2529">wiki.osdev.org/Detecting_CPU_Topology_%2880x86%29</a> </li></ol><br><br></div><p>Source: <a href="https://habr.com/ru/post/243385/">https://habr.com/ru/post/243385/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243373/index.html">Auto-positioning and autotracing of printed circuit boards</a></li>
<li><a href="../243377/index.html">We invite you to participate in Security Meet Up December 4</a></li>
<li><a href="../243379/index.html">Zabbix + Communigate Pro: low-level discovery and account monitoring</a></li>
<li><a href="../243381/index.html">Work in the office VS Work in coworking for a small team</a></li>
<li><a href="../243383/index.html">How to send push notifications to the Windows Universal app</a></li>
<li><a href="../243389/index.html">What will be new on .NEXT and why it will be good</a></li>
<li><a href="../243391/index.html">Facebook's Osquery Introduction</a></li>
<li><a href="../243393/index.html">Should everyone learn programming?</a></li>
<li><a href="../243395/index.html">Moving from online to offline IDE when programming Nucleo-F401RE</a></li>
<li><a href="../243397/index.html">Well.js is another approach to modular JavaScript development.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>