<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Objective C. Practice. Developments</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Event-oriented logic in Objective-C rests on three pillars ‚Äî protocols, a notification center, and key-value observing. Traditionally, protocols are u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Objective C. Practice. Developments</h1><div class="post__text post__text-html js-mediator-article">  Event-oriented logic in Objective-C rests on three pillars ‚Äî protocols, a notification center, and key-value observing.  Traditionally, protocols are used to extend the functionality of the base classes without inheritance, key-value observing - for interaction between the visual and logical part of the application, and the notification center - for handling user events. <br><br>  Naturally, all this beauty can be safely used to build complex applications.  There is no real need to invent your own bikes, of course.  However, I, as a person who came to the development of Objective C applications from the .NET world, found it very unpleasant that the notification center, which I planned to use for events, breaks the application stack, writing the event to a queue in the UI thread, and the protocols in the classic view not too convenient, therefore, for convenience, I decided to build myself a mechanism that would be much more similar to what we used to do in the world of .NET.  Thus was born the idea of ‚Äã‚Äãimplementing the model of multiple signatories through a special class called AWHandlersList. <br><br>  This article is designed for programmers who have some experience in creating applications on Objective-C and have written similar bikes, or solved similar problems in standard ways.  This option is not a silver bullet, but it proved to be a convenient mechanism that minimizes writing code for cracking sets of events with different interfaces and parameters. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  The idea of ‚Äã‚Äãa class is quite simple - it contains a list of signers, each element of which consists of two components ‚Äî target and selector. <br><br>  What is this bike made for?  It seemed to me that it is more convenient than all the standard models presented for some logic related to the transmission of events.  Maybe he will help someone to make life easier. <br><br>  In .NET, the usual event logic model offers a delegate with two parameters - sender of type object and args of type inherited from EventArgs.  In order not to break your brain, do the same.  To begin with, let's define an empty EventArgs class from which all event arguments will be inherited. <br><br><pre><code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AWEventArgs</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><br>  Now we define a class that will contain a pair of ‚Äútarget object and a method being called‚Äù, adding some debugging information to it at the same time so that the logic of events can be easily debugged in the future. <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AWEventHandler</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">@private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *_description; } <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">assign</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> target; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">assign</span></span>) SEL method; +(AWEventHandler *)handlerWithTarget:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)target method:(SEL)method; <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AWEventHandler</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">synthesize</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">; -(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initWithTarget</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SEL</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">m</span></span></span><span class="hljs-class">; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> = [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> init]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { target = t; method = m; _description = [[<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> alloc] initWithFormat:<span class="hljs-string"><span class="hljs-string">@"EventHandler, Target=%@, Method=%@"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">NSStringFromClass</span></span>([target <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]), <span class="hljs-built_in"><span class="hljs-built_in">NSStringFromSelector</span></span>(method)]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; } -(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)description { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _description; } -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)dealloc { [_description release]; [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> dealloc]; } +(AWEventHandler *)handlerWithTarget:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)target method:(SEL)method { AWEventHandler *handler = [[[AWEventHandler alloc] initWithTarget:target method:method] autorelease]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handler; } <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span></code> </pre> <br><br>  As you can see, both target and method are essentially weak links.  This is quite natural - weak links are used everywhere in the Objective-C world to avoid circular references and to allow objects to be automatically freed.  Unfortunately, this leads to the fact that with careless coding, ‚Äúdead‚Äù pointers to objects that drop an application appear everywhere, so I‚Äôll show a little further one beautiful mechanism that allows you to prevent and eliminate their occurrence. <br><br>  Now, finally, let's move on to our main class - the list of signatories.  There are non-trivial moments in the code, but they are solved by reading the documentation, and if there is no desire to understand the question, then you can simply use it, the code is completely working and removed from the ‚Äúcombat‚Äù project. <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AWEventHandlersList</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">NSMutableArray</span></span> *_handlers; } <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *name; -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)addReceiver:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)receiver delegate:(SEL)delegate; -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)removeReceiver:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)receiver delegate:(SEL)delegate; -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)clearReceivers; -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)invoke; -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)invokeWithSender:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)sender; -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)invokeWithSender:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)sender args:(AWEventArgs *)event; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSRunLoop</span></span> *runLoop; <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span></code> </pre> <br><br>  In brief, I will explain why we need fields of this class. <br><br>  The first is name.  I prefer to name events so that you can see in the logs exactly what event was triggered.  Usually, I use the name of the class as the name of the event, along with the name of the class being called in it to raise the method.  This is a convenient practice, as it allows you not to scour convulsively around the stack in search of who threw the event, but simply to see this value in the debug console. <br><br>  The <code>addReceiver</code> and <code>removeRecevier</code> logical - they accept an object and a selector that will accept calls later. <br><br>  The <code>invoke</code> methods should throw an event, passing it to the signed objects for processing.  They are given in three variants - in order not to pass empty nil values ‚Äã‚Äãin the event that there is no need for any event parameters. <br><br>  The <code>clearReceivers</code> method <code>clearReceivers</code> internal, it is better to define it in an anonymous section, since the calling code should not be able to unsubscribe other objects from events, but historically it has been rendered to the interface.  It is easy to fix, if you think it is wrong. <br><br>  Finally, the <code>runLoop</code> property <code>runLoop</code> necessary if you are going to make certain events be tied to a specific thread.  For example, this is necessary if some code in the worker thread must update the visual part of the application, or vice versa - from the UI thread should be access to any worker thread synchronized through the message queue, that is, if there is a need to throw events and process them in different streams. <br><br>  Implementing a class is ideologically trivial, but it does require some understanding of how selectors work.  Difficult moments I will clarify in the comments in the code itself. <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AWEventHandlersList</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">synthesize</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">runLoop</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_runLoop</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">synthesize</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_name</span></span></span><span class="hljs-class">; -(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">init</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> = [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> init]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; _handlers = [[<span class="hljs-built_in"><span class="hljs-built_in">NSMutableArray</span></span> alloc] init]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; } -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)addReceiver:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)receiver delegate:(SEL)delegate { <span class="hljs-comment"><span class="hljs-comment">/*    ,   ,          ,  *    .      */</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> removeReceiver:receiver delegate:delegate]; [_handlers addObject:[AWEventHandler handlerWithTarget:receiver method:delegate]]; } -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)removeReceiver:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)receiver delegate:(SEL)delegate { <span class="hljs-comment"><span class="hljs-comment">/*      ,    ,      * (NSLock),     ,            , *      ,         NSLock */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(AWEventHandler *handler <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [[_handlers <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span>] autorelease]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(handler.method == delegate &amp;&amp; handler.target == receiver) [_handlers removeObject:handler]; } -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)clearReceivers { [_handlers removeAllObjects]; } -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)invoke { [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> invokeWithSender:<span class="hljs-literal"><span class="hljs-literal">nil</span></span> args:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; } -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)invokeWithSender:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)sender { [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> invokeWithSender:sender args:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; } -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)invokeWithSender:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)sender args:(AWEventArgs *)event { [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> invokeWithSender:sender args:event runLoop:_runLoop]; } -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)invokeWithSender:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)sender args:(AWEventArgs *)event runLoop:(<span class="hljs-built_in"><span class="hljs-built_in">NSRunLoop</span></span> *)runLoop { <span class="hljs-comment"><span class="hljs-comment">/*  ,         ,   null    *     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!runLoop) runLoop = [<span class="hljs-built_in"><span class="hljs-built_in">NSRunLoop</span></span> currentRunLoop]; <span class="hljs-built_in"><span class="hljs-built_in">NSUInteger</span></span> order = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *handlersCopy = [<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> arrayWithArray:_handlers]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(AWEventHandler *handler <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> handlersCopy) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(runLoop == [<span class="hljs-built_in"><span class="hljs-built_in">NSRunLoop</span></span> currentRunLoop]) [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> internalInvoke:[<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> arrayWithObjects:handler, sender == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> ? [<span class="hljs-built_in"><span class="hljs-built_in">NSNull</span></span> null] : sender, event == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> ? [<span class="hljs-built_in"><span class="hljs-built_in">NSNull</span></span> null] : event, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>]]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> [runLoop performSelector:<span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(internalInvoke:) target:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> argument:[<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> arrayWithObjects:handler, sender == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> ? [<span class="hljs-built_in"><span class="hljs-built_in">NSNull</span></span> null] : sender, event == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> ? [<span class="hljs-built_in"><span class="hljs-built_in">NSNull</span></span> null] : event, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>] order:order++ modes:[<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> arrayWithObject:<span class="hljs-built_in"><span class="hljs-built_in">NSDefaultRunLoopMode</span></span>]]; } <span class="hljs-comment"><span class="hljs-comment">/*            performSelector:target:argument:order:modes: */</span></span> -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)internalInvoke:(<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *)data { AWEventHandler *handler = [data objectAtIndex:<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> sender = [data objectAtIndex:<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sender == [<span class="hljs-built_in"><span class="hljs-built_in">NSNull</span></span> null]) sender = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> args = [data objectAtIndex:<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(args == [<span class="hljs-built_in"><span class="hljs-built_in">NSNull</span></span> null]) args = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*               */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NSMethodSignature</span></span> *mSig = [handler.target methodSignatureForSelector:handler.method]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>([mSig numberOfArguments] == <span class="hljs-number"><span class="hljs-number">2</span></span>) [handler.target performSelector:handler.method]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>([mSig numberOfArguments] == <span class="hljs-number"><span class="hljs-number">3</span></span>) [handler.target performSelector:handler.method withObject:sender]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([mSig numberOfArguments] == <span class="hljs-number"><span class="hljs-number">4</span></span>) [handler.target performSelector:handler.method withObject:sender withObject:args]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">@throw</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">NSException</span></span> exceptionWithName:<span class="hljs-string"><span class="hljs-string">@"Invalid selector type"</span></span> reason:<span class="hljs-string"><span class="hljs-string">@"This type of selector is not supported"</span></span> userInfo:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; } -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)dealloc { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.name = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> clearReceivers]; [_handlers release]; [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> dealloc]; } <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span></code> </pre> <br><br>  Now we define a pair of auxiliary macros that will allow us to embed the logic of working with events into the class in literally two lines. <br><br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#define DEFINE_EVENT(eventName) \ -(void)add ## eventName ## Handler:(id)receiver action:(SEL)action; \ -(void)remove ## eventName ## Handler:(id)receiver action:(SEL)action #define DEFINE_EVENT_IMPL(eventName, innerVariable) \ -(void)add ## eventName ## Handler:(id)receiver action:(SEL)action \ { \ [innerVariable addReceiver:receiver delegate:action]; \ } \ \ -(void)remove ## eventName ## Handler:(id)receiver action:(SEL)action \ { \ [innerVariable removeReceiver:receiver delegate:action] ; \ } \</span></span></code> </pre> <br><br>  Now in order to create an event in a class, you need to define an internal list variable: <br><br><pre> <code class="objectivec hljs">AWEventHandlersList *_handlers;</code> </pre> <br><br>  Define an event in the interface <br><br><pre> <code class="objectivec hljs">DEFINE_EVENT(Event);</code> </pre> <br><br>  And link the list with the event <br><br><pre> <code class="objectivec hljs">DEFINE_EVENT_IMPL(Event, _handlers)</code> </pre> <br><br>  Two methods are automatically added to the class ‚Äî <code>addEventHandler:action:</code> and <code>removeEventHandler:action:</code> and you can trigger an event through the <code>invoke</code> methods of the <code>_handlers</code> object. <br><br>  Of course, don't forget that the _handlers object needs to be initialized in the constructor. <br><br><pre> <code class="objectivec hljs">_handlers = [AWEventHandlersList new];</code> </pre> <br><br>  And destroy in the object's destructor <br><br><pre> <code class="objectivec hljs">[_handlers release];</code> </pre> <br><br>  In the second part of the article, I will explain what problems the use of this approach leads to and how to cope with the difficulties of ‚Äúdead‚Äù references that arise in any more or less voluminous application as a result of our own mistakes. </div><p>Source: <a href="https://habr.com/ru/post/168179/">https://habr.com/ru/post/168179/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../168163/index.html">Learning through the exchange of observations</a></li>
<li><a href="../168165/index.html">Pirate party has opened its hosting</a></li>
<li><a href="../168167/index.html">Ask questions to Intel experts. Software Intellectual Property</a></li>
<li><a href="../168169/index.html">LunarCraft or the exploration of the near frontiers of space</a></li>
<li><a href="../168173/index.html">Once again about statistics, Nokia, Elop and burning memo</a></li>
<li><a href="../168181/index.html">Overview of updates to the Windows Azure platform for the month</a></li>
<li><a href="../168183/index.html">Mail server based on ROSA Server Enterpise Linux in a few minutes</a></li>
<li><a href="../168185/index.html">Deploy Zabbix agents to a large number of Windows-based servers using Powershell</a></li>
<li><a href="../168187/index.html">How to build Adobe Air app for Mac OS AppStore</a></li>
<li><a href="../168189/index.html">License Manager for 1C in a virtual environment + monitoring in Zabbix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>