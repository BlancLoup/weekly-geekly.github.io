<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As we in PassportVision interface did</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Interface design is a very complicated craft. Alas, it is not very clear how to learn this craft. Of course, today there are a huge number of differen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As we in PassportVision interface did</h1><div class="post__text post__text-html js-mediator-article">  Interface design is a very complicated craft.  Alas, it is not very clear how to learn this craft.  Of course, today there are a huge number of different good books about different good approaches to this very design.  However, the practice suggests that even if you read them all thoughtfully, it will not mean that you will be able to create the perfect UI in any situation.  And the thing is that such an activity is rather a kind of art, rather than following a set of rules.  But how to master this art if good books do not give the necessary skills?  It seems to us that experience is still the key factor in this matter.  But to learn only from one‚Äôs own experience is a long-term occupation, it would be better to look at other people (and this is not only related to interfaces). <br><br>  Let's talk a little about how to learn from someone else's experience.  We have many familiar teams that develop really cool apps.  And when they show us their interfaces, they begin to tell <i>what</i> and <i>how</i> they did.  And we always ask <i>why</i> they did it, <i>why</i> they came to precisely this decision.  And it seems to us that this is the most correct question.  Yes, there are brilliant people who, without any materiel in their sleep, will see the perfect interface without all sorts of hard thoughts about how to do well and how to do badly.  But there are few such people, and you will not learn much from such experience.  Image thinking really develops when you are told about the <i>motivation of</i> each of your decisions (even the smallest).  Like, we first did this and that, but the users were uncomfortable because of this, so we redid everything like this, and now everyone lives happily. <br><br>  In this post, we would like to tell the story of one mold that we made when developing our product <a href="http://passportvision.ru/">PassportVision</a> (which was already <a href="http://habrahabr.ru/company/enterra/blog/219535/">told</a> on Habr√©).  This is one and only small mold, but we have been doing it for a whole year.  How well we did it is to judge you, but the users are very pleased (isn't this the criterion of a good interface?).  We repeatedly reworked different things, hotly arguing about various trifles, but in the end it turned out that it is convenient to use.  However, we think that in a year we will take a look at this post, take a look at our already old UI by that time and say: ‚ÄúO Lord!  Did we really give <i>it to</i> users?  Oh, shameful, how shameful. ‚Äù  But everything is correct - the interface must constantly evolve, evolve, become better.  And today we will talk about what is available today and how did we come to this. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/63a/6b9/169/63a6b91697d87e8b2430c5bcac0b74af.jpg"><a name="habracut"></a><br><br><h4>  Formulation of the problem </h4><br>  There is the following situation: the client comes to some wonderful place, and they ask him for passport data.  The client sends his passport to the operator, who, in turn, places the document in the scanner and presses a special button to start PassportVision.  And after a few seconds, our program has recognized client data at the output.  And it would be possible to immediately send this data to a Word document, database, web form, another specialized program (underline the necessary), but first it would be nice to show the recognition results to the operator for verification.  Do not think that PassportVision recognizes everything so badly that it is constantly necessary to correct errors behind it.  But, alas, we have to put up with the fact that modern computer technology is not able to provide one hundred percent recognizability of absolutely any text.  And taking into account all the love with which in our country are suitable for the design of individual design of a passport for each person (a unique combination of the font, its outlines and colors, the location of the fields and the angle of inclination - let your passport not look like the others!), Errors will appear .  Perhaps they will be only on every n-th passport, perhaps they will be very small, but they will still be.  Therefore, it is not very desirable to skip the verification phase. <br><br>  <b>Strict statement of the technical assignment:</b> make it so that verification happens as simply and quickly as possible.  To direct "vzhuh!" - And the correctness of the results was verified. <br><br><h4>  First approach </h4><br>  We remember well our very first version of the interface: on the left - the passport picture, on the right - the values ‚Äã‚Äãof the recognized fields.  Like, look at the results and compare with the original. <br><img src="https://habrastorage.org/getpro/habr/post_images/9f1/265/165/9f12651658666f8633973677c8a4c512.jpg"><br>  And everything seems to be fine, but only the verification takes a lot of time (sometimes this time is comparable to the manual entry of passport data), and many errors still remain. <br><br><h4>  Work with zones </h4><br><h5>  Painting on zones </h5><br>  The process of working on the interface was very simple: we used our program every day and the inconvenient things were found by ourselves.  The most annoying circumstance was the following: it was necessary to spend too much time after reading the value of the next field to translate the view of the passport and find on it the corresponding zone.  The solution is simple: let's tell the user where the zone with which he is currently working is in the picture (that is, the field with the cursor, we also separately highlight it separately).  You can, for example, circle the right place: <br><img src="https://habrastorage.org/getpro/habr/post_images/caa/2c0/503/caa2c0503ddee82efe857d5945bce86f.jpg"><br>  However, jumping from place to place, the rectangle created a not very pleasant visual noise, it annoyed many.  Therefore, we decided to draw all the rectangles, and select the desired color: <br><img src="https://habrastorage.org/getpro/habr/post_images/de2/351/db8/de2351db89366708ba95a73dc259774f.jpg"><br>  The link ‚Äúfield-zone‚Äù works in both directions: when clicking on a field, a zone is highlighted, and when clicking on a zone, the field is activated (highlighting + cursor setting + focus).  When you hover the mouse over a certain area, a pop-up hint appears with the recognized data. <br><br><h5>  Tooltips </h5><br>  With these colored rectangles it became, of course, somewhat better, but not really.  All the same, it took a lot of time to drive the gaze left-right to verify the recognized data with the original image.  Disorder, let's reduce this distance.  We started to display a tooltip next to the current field, which displayed the corresponding zone: <br><img src="https://habrastorage.org/getpro/habr/post_images/de1/c70/e33/de1c70e3385737ac7ce5c329d1518c04.jpg"><br>  Perhaps the solution will seem a bit strange, but experience has shown that it is really convenient.  A bit of hassle added fields that are placed vertically (for example, a series and passport number).  Of course, for the convenience of reading they had to turn: <br><img src="https://habrastorage.org/getpro/habr/post_images/619/679/5dc/6196795dcf261768633e55adbb3b3c80.jpg"><br>  Thus, the movement of the eye turned out minimal.  At any given time, you are in the context of a single field: here is the recognized data, and here is the picture of the original.  No need to be distracted to look somewhere else.  This greatly accelerated the verification process. <br><br><h5>  Highlight individual characters </h5><br>  Let's simplify the search tasks.  Not always and not everyone can check the entire field entirely.  Especially if it is some large field (for example, the place of issue of three lines).  Soon we will talk about navigation and suspicious characters and find out that in the course of working with the program, problem areas are often highlighted.  The problem arises to find the selected text fragment in the picture.  It seems to be a simple task, but if you enclose the selected area in a frame on a pop-up hint, then everything becomes even simpler: <br><img src="https://habrastorage.org/getpro/habr/post_images/b6b/982/4e5/b6b9824e5f08d0b34ab8ff1677d71826.jpg"><br>  Some may say that improvements at this level are not needed, which, they say, will not affect anything.  But we have a different approach: if we can somehow save a few tens of milliseconds to the user, then it would be better to do so.  (In this place, it is necessary to bring calculations with a smart face, such as if 100 operators will process 100 clients a day each with our program, then 10 milliseconds saved on one passport in 100 days will save the industry almost three man-hours. But we will not do that.) In any case, the feature does not seem to interfere, but it looks cool.  =) <br><br><h5>  Multiple zones for one field </h5><br>  An additional problem arises after it comes to the realization that in some documents some fields may be duplicated.  For example, in the passport of a citizen of the Russian Federation, the number and series are stamped both on the top page and on the bottom page.  And worst of all, each entry can be recognized in its own way (for example, due to the fact that the top page of the passport is devoid of any external protection and is more susceptible to mechanical damage; we are very sad about this).  By default, we show the user the option in which they themselves are more confident, but you need to provide a choice.  Therefore, with a <s>slight hand movement with a</s> couple of lines of code, we turn our TextBox into a ComboBox, which can be opened with the help of a hot key, and then use the up / down keys to select the desired option.  In order to simplify the selection, while traveling in the drop-down list in the tooltip area, we show exactly the zone that corresponds to the selected option: <br><img src="https://habrastorage.org/getpro/habr/post_images/65f/92b/6bb/65f92b6bbffc288167860afc335f429e.jpg"><br>  On the main image of the passport, alternatives are also highlighted in a special way: <br><img src="https://habrastorage.org/getpro/habr/post_images/f85/0d2/87a/f850d287aced5660a33aa53f264884c8.jpg"><br>  We approach some fields in a special way.  For example, a floor is always represented by a ComboBox with two options, regardless of the recognition results (they only affect the initial value). <br><br><h5>  Machine Readable Zone </h5><br>  And everything was good, until we began to support the machine-readable zone.  Visually check it several, ahem, problematic.  If the series and number is still easy to check, then the average person from the street is unlikely to cope with the last name.  The fact is that 33 letters of the great and powerful are displayed in 26 letters of the English alphabet and 7 digits (for example, 'H' -&gt; '3', 'S' -&gt; '7').  It‚Äôs dangerous to show this on a tooltip - you can scare an unprepared person.  Therefore, we treat some zones in a special way: even if we took a surname from a machine-readable zone (and more often we are somehow more confident in it), then we show the main zone with a surname in the tooltip to make the check easier.  In this case, there are problems with the restoration of the original contours of characters (the image is something else we have slipped!), But we try to solve them as much as we can. <br><img src="https://habrastorage.org/getpro/habr/post_images/11c/2e0/811/11c2e08115dc5a647c5de1a9a2d43acc.jpg"><br><br><h4>  Error navigation </h4><br><h5>  Suspicious characters </h5><br>  We prompted all kinds of clues, but so far have not saved a person from the need to carefully read the entire text.  Disorder!  Fortunately for our users, we learned to classify some characters as ‚Äúsuspicious‚Äù.  In the interface, we paint these symbols in red: <br><img src="https://habrastorage.org/getpro/habr/post_images/a24/1f9/6a7/a241f96a727fa47969dc82fb19648dc5.jpg"><br>  Initially, we are based on the confidence of each character (the degree of confidence in the correctness of recognition), which Tesseract informs us with care.  With the help of magical heuristics, we in each case determine the threshold confidence, below which all characters are considered suspicious.  Then we run several additional algorithms (more heuristics for god heuristics!), Which help us improve the criteria for suspicion.  For example, if the points were badly printed on the date ‚Äú01/01/2014‚Äù and Tesseract is not particularly sure of them, we still will not consider them suspicious, because we know something that the recognition algorithm does not know. <br><br><h5>  Basics of navigation </h5><br>  Our efforts were not in vain: almost all the errors we have painted in red.  Yes, we are capturing the right symbols, but it‚Äôs better to be safe than to overlook any shortcomings.  In the overwhelming majority of cases, it is enough to go over suspicious characters and, if necessary, make edits.  To speed up the process, we added the ability to move to the next and previous suspicious character from the keyboard.  At the same time, the corresponding potential error is immediately highlighted in the text and highlighted on the tooltip.  Due to the selection, the user can immediately begin to enter the correct version of the data, if the recognition results turned out to be erroneous. <br><br><h5>  We improve navigation </h5><br>  But trouble does not come alone.  We noticed that suspicious characters most often go in groups.  This is due to the fact that the image of a passport in some place there is some trouble, which spoils not one particular character, but immediately a certain area.  Therefore, if several suspicious characters go in a row, then we combine them into a suspicious group.  However, it happens that inside a word that, logically, everything should be one suspicious group, there is a letter in which we are confident against all odds.  Such a letter will remain black, but the word will most likely have to be completely rewritten.  Therefore, we introduced the concept of suspicious words - these are words in which there are too many suspicious characters.  By analogy, we introduced the concept of a suspicious field: if there are too many suspicious characters in the field (for example, bad people smeared the entire passport), then, most likely, the entire field will have to be rewritten, and the miracle in the form of several correctly recognized characters will not help us here. <br><br>  How now to organize the navigation of errors in terms of "previous" and "next"?  We thought for a long time and settled on the following solution: we built a tree of suspicious symbols, groups, words and fields, after which we went through it with a search for depth.  Using the practice as a criterion of truth, they realized that it was really convenient. <br><img src="https://habrastorage.org/getpro/habr/post_images/9ef/4e5/994/9ef4e59948415994d6d4ad0079cc1b12.png"><br>  Of course, there are additional buns.  There is a navigation mode in which the transition by error and the transition through the fields are combined.  That is, we will visit each field in any case, even if there are no ‚Äúsuspicious characters‚Äù in it (it still does not hurt to look at it so that our conscience is clear).  There are hot keys to go to each specific field. <br><br><h4>  Editing </h4><br><h5>  Undo / Redo </h5><br>  Observations on users gave us interesting information for thought.  It turns out that most people perceive our form not as a set of input fields that are not particularly related, but as a single document.  And since this is one document, then the Undo / Redo stack should be common to all fields.  In other words, if the user corrected something, moved to the next field, and then realized that he had made some corrections somehow, then by pressing Ctrl + Z he expects that the changes will be rolled back exactly in the previous field.  Not that this was obvious from the very beginning, but the convenience of users is paramount: we made a single Undo / Redo stack for all fields. <br><br><h5>  Watching the characters </h5><br>  When editing it was necessary to take into account one more thing, which relates more to the software implementation than to the usability solution.  Each character has special metadata (his confidence and outline on the original image), which need to be dragged when editing.  Moreover, with Undo / Redo operations, all metadata should be correctly restored.  There are more interesting cases.  For example, the surname was recognized incorrectly (‚ÄúIvonov‚Äù), and the user in the clipboard just missed the correct spelling of the surname (‚ÄúIvanov‚Äù).  What should happen after pressing Ctrl + V with metadata?  The correct answer is: for the beginning and end of the word, the data should be saved completely (and confidence, and the outline of the letter), and turning the letter ‚Äúo‚Äù into ‚Äúa‚Äù should be understood by the program as correcting the error, which means that the outline of the letter should remain in the metadata of the new letter ‚Äú but". <br>  I would like to say that the particular pain was delivered not by the correction of letters, but by the separation and connection of words, because gaps do not have metadata (we finish building them on the fly along the contours of adjacent letters).  The internal data structure changes significantly with such operations, which had to be carefully taken into account when implementing the same Undo / Redo. <br><br><h5>  Register adjustment </h5><br>  Not all changes need to be processed in the same way.  For example, if a user corrected a letter case (for example, ‚ÄúIvanov‚Äù was replaced by ‚ÄúIvanov‚Äù), then from the point of view of metadata, nothing should change: all confidence and contours of letters remain in place.  But in the Undo / Redo-stack such an operation still needs to be entered.  In addition, we support the ability to automatically adjust the register.  Some of our clients have standards on how passport information should be presented: someone needs all capital letters, and someone only needs to capitalize the first letters (special fun begins at the place of issue when we try to understand what words still need to write with a capital letter, and which - no).  If you tick the appropriate box, then PassportVision will take all the problems with the register on yourself.  For example, if you put a space in the middle of the ‚Äúcity of Moscow‚Äù, then as a result you should receive ‚Äúthe city of Moscow‚Äù.  Such capitalizations should not be confused by the logic of the Undo / Redo-stack and the tracking of metadata: everything should work clearly and as much as possible for the user. <br><br><h4>  Customization </h4><br>  We have already talked about many little things and nuances, but no matter how elaborate the interface is, there are always people who don‚Äôt like it.  We still have a lot of moments, because of which there are heated debates.  For example, some believe that the image of the passport should be on the right, some - on the left, some do not need it at all.  The ‚ÄúSubdivision code‚Äù field in the recognition results is called ‚ÄúNumber‚Äù due to the fact that many of our corporate clients have ‚ÄúNumber‚Äù written in their software in the appropriate place, but other clients want exactly ‚ÄúSubdivision Code‚Äù.  Some people like our field order, and some want the field order to be like in a passport: first the information about the issue, and only then the full name, etc. And some information about the issue is not needed at all, they want to remove it.  Someone didn‚Äôt like our navigation system and tooltips.  Do you need to select the first suspicious place at the very beginning of working with the form (to save one keystroke) or just put the cursor at the beginning of the first field.  Disputes are ongoing and additional features.  For example, we have the function of checking the expired passport.  Some do not need it at all, and some want to block the processing of results in the event of an overdue passport.  Some want a feature with automatic transliteration of results.  The list can be continued for a long time. <br><br>  And if all these comments came only from some outside observers, then they could not be ignored.  But when a client comes in and says: ‚ÄúI will give you money only if everything goes both way and that way‚Äù, it becomes more difficult to ignore comments.  Therefore, now we are actively working on the settings of the application, so that, having pierced a few checkboxes, we could build for each one the interface that would suit it to the maximum.  But that's another story. <br><br><h4>  Instead of conclusion </h4><br>  I repeat: we do not pretend that we now have the perfect interface for our task.  But this is the interface that some people work with daily, and they like it.  We plan to continue to actively develop it, improve it and make it more and more convenient and enjoyable to use.  And in this post, we only tried to show how our thought was going when we made certain decisions, to which we paid attention, how we worked through various trifles.  We sincerely hope that you could learn some useful things from our history. </div><p>Source: <a href="https://habr.com/ru/post/229047/">https://habr.com/ru/post/229047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229037/index.html">LG G Watch became available for purchase on Google Play</a></li>
<li><a href="../229039/index.html">Log in via Google to Android and check the token on the server</a></li>
<li><a href="../229041/index.html">Work with data in mobile applications. Implement offline storage and data synchronization using Microsoft Azure and SQLite</a></li>
<li><a href="../229043/index.html">Centos 7 release released</a></li>
<li><a href="../229045/index.html">Game server on Scala + Akka</a></li>
<li><a href="../229049/index.html">Anyone can hack Tor for $ 3000</a></li>
<li><a href="../229051/index.html">Refactor or not refactor?</a></li>
<li><a href="../229055/index.html">Canary: smart home security system</a></li>
<li><a href="../229057/index.html">PPA: almost complete autonomy. We build autonomous power supply for a small village</a></li>
<li><a href="../229061/index.html">Want an adventure - work as a field engineer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>