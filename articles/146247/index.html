<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Meet the third PowerShell (part I)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The pace of development of modern technologies is such that we can hardly keep up with them. But today we‚Äôll run a little bit ahead, learn about the i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Meet the third PowerShell (part I)</h1><div class="post__text post__text-html js-mediator-article">  The pace of development of modern technologies is such that we can hardly keep up with them.  But today we‚Äôll run a little bit ahead, learn about the innovations of PowerShell v3, and look at them not only with our eyes, but also with our hands. <br><a name="habracut"></a><br><h5>  Stand </h5><br>  I built two Windows Server 2012 RC based machines for Hyper-V, created a forest from one domain called <code>litware.inc</code> .  The two machines in the domain are called <code>w2012dc1.litware.inc</code> and <code>w2012cl1.litware.inc</code> , respectively.  At <code>w2012dc1</code> domain services and DNS <code>w2012cl1</code> , and at <code>w2012cl1</code> nothing revolves except, in fact, the OS itself.  Also in the domain there is a user <code>user1</code> , a member of the <code>domain users</code> group.  You could, of course, install Windows 8 RC on a second machine for beauty, so to speak, but I decided to save a little bit of disk space by taking one parent virtual hard disk and hooking two children to it instead of using two independent virtual hard disks. <br>  Also, I should mention that not all the terms I use are already localized and are on <a href="http://www.microsoft.com/Language">the Microsoft language portal</a> , so I give their translation exactly as I understand these terms, and in brackets I give the original name in English. <br><br><h5>  New opportunities </h5><br>  First, let's just list them: <br><br><ul><li>  <b>Workflows</b> (Eng. <i>Workflows</i> ) - these are some processes running sequentially or in parallel, performing complex management tasks.  Actually, PowerShell v3 now includes support for Windows Workflow Foundation, and the PowerShell workflows themselves are repeatable, parallelizable, interruptible, and recoverable. </li><li>  <b>Robust sessions</b> ( <i>Robust sessions</i> ) are PowerShell sessions that are automatically restored after network turmoil and similar interruptions.  Also, this technology allows you to disconnect from a session on one machine and connect to the same session on another. </li><li>  <b>Scheduled jobs</b> (Eng. <i>Scheduled jobs</i> ) - PowerShell jobs that can be executed at a certain interval, or in response to an event. </li><li>  <b>Special session configuration</b> ( <i>Custom session configurations</i> ) - For each PowerShell session, you can predetermine a specific set of parameters and save them in a special configuration file, then to enter the session on a ready-made one. </li><li>  <b>Simplified language syntax</b> (as stated), the simplified syntax allows the PowerShell script to look less like a program and more like a natural human language. </li><li>  <b>Search cmdlets</b> (eng. <i>Cmdlet discovery</i> ) - automatic loading of the module in which the cmdlet is located, if this module is, of course, installed on the machine. </li><li>  <b>Show-Command</b> is just one of the new cmdlets, with which we, perhaps, will begin. </li></ul><br><h5>  Show-command </h5><br>  After its launch, without parameters, a window appears, from which blows grandeur and chic: <br>  If you had to search for a particular cmdlet on TechNet, or even use .NET objects, then here you are, I don‚Äôt want all the modules, all the cmdlets. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/65e/ef8/944/65eef8944a926393a5188f0439a8d50c.png"><br><br>  Here, if you please, manage the DNS server and DNS client service cmdlets, and if you select any module, for example, a network, you can find out the routing table configuration cmdlets or, say, TCP / IP parameters of network interfaces. <br><br><img src="https://habrastorage.org/storage2/7d0/e0a/a67/7d0e0aa67bcc702771faa7e2a6860af3.png"><br><br>  I also tried to look for the words "share", "user", "acl", "policy", "adapter", and so on and so forth, try, this is interesting. <br><br><h5>  Cmdlet discovery </h5><br>  Associated with the previous, but not directly dependent.  In PowerShell v2 in Windows Server 2008 R2, in order to perform certain operations, you need to connect this or that module, PowerShell v3 automatically determines which module is responsible for launching the cmdlet and loads this module in the background, without any questions. <br>  Let's compare.  I decided to get a list of group domain policies, if I try to load them into PowerShell v2: <br><br><pre> <code class="ruby hljs">Get-GPO -All <span class="hljs-params"><span class="hljs-params">| ft Id #     Id ,  </span></span></code> </pre> <br>  Then we get an error, because the GroupPolicy module is not loaded: <br><br><pre> <code class="ruby hljs">Import-Module GroupPolicy</code> </pre> <br>  Now, if you repeat, everything goes fine: <br><br><img src="https://habrastorage.org/storage2/2f9/db0/66e/2f9db066ea5a3cf91da06e0e814ce1eb.png"><br><br>  In PowerShell v3, everything is fine initially: <br><br><img src="https://habrastorage.org/storage2/c97/41a/962/c9741a962263e30f4b74b51dc43db9b5.png"><br><br><h5>  Simplified language syntax </h5><br>  Here, it seemed to me, the developers decided to bring the language closer to SQL, well, at least some analogy can be traced.  The point is that they introduced new syntaxes for the <code>Foreach-Object</code> and <code>Where-Object</code> cmdlets.  Although the practical value of <code>Foreach</code> : <br><br><pre> <code class="ruby hljs">Get-Service <span class="hljs-params"><span class="hljs-params">| Foreach Name</span></span></code> </pre> <br>  instead <br><br><pre> <code class="ruby hljs">Get-Service <span class="hljs-params"><span class="hljs-params">| Foreach {$_.Name}</span></span></code> </pre> <br>  In my opinion, it is doubtful. <br>  Another thing is <code>Where</code> : <br><br><pre> <code class="ruby hljs">Get-Service <span class="hljs-params"><span class="hljs-params">| Where Status -eq Running</span></span></code> </pre> <br>  instead <br><br><pre> <code class="ruby hljs">Get-Service <span class="hljs-params"><span class="hljs-params">| Where {$_.Status -eq "Running"}</span></span></code> </pre> <br>  already nothing, without any braces curly with dollar quotes. <br>  Also, a couple of new operators appeared: <code>-In</code> and <code>-NotIn</code> , indicating a range.  With them, I think, more than understandable: <br><br><img src="https://habrastorage.org/storage2/9c7/50d/115/9c750d115c09dfd9a152282a0d0be48f.png"><br><br><h5>  Custom session configurations </h5><br>  The most remarkable innovation that I want to talk about in the first part is the configuration of the session in conjunction with the delegation of administrative powers.  The actual configuration file is a file with the .pssc extension, which only contains a hash table of properties and values: authorship, language, variables, function definitions, and so on.  There are other properties in the session configuration itself: <br><br><pre> <code class="ruby hljs">Get-PSSessionConfiguration <span class="hljs-params"><span class="hljs-params">| Get-Member</span></span></code> </pre> <br>  A picture similar to this one will appear: <br><br><img src="https://habrastorage.org/storage2/3e1/f95/7fc/3e1f957fc775fb787ccb40afa7e37734.png"><br><br>  See how many customizable parameters?  You can even compare with the picture that appears when you run this command in PowerShell v2 and feel the difference. <br>  But how to use it?  And now I will show, I confess, I was picking long enough to write these few lines.  So, we consistently execute: <br><br><pre> <code class="ruby hljs">$defSSDL = (Get-Item <span class="hljs-symbol"><span class="hljs-symbol">WSMan:</span></span>\localhost\Service\RootSDDL).Value <span class="hljs-comment"><span class="hljs-comment"># SSDL " " $SecDescriptor = New-Object -TypeName Security.AccessControl.CommonSecurityDescriptor $false, $false, $defSSDL #   $user = Get-ADUser "user1" #  Active Directory  ,  , ,    $SecDescriptor.DiscretionaryAcl.AddAccess([System.Security.AccessControl.AccessControlType]::Allow, $user.SID.Value, 268435456, [System.Security.AccessControl.InheritanceFlags]::None, [System.Security.AccessControl.PropagationFlags]::None) # SID   $sddl = $SecDescriptor.GetSddlForm("All") # ,   $creds = Get-Credential "administrator</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@litware</span></span></span><span class="hljs-comment">.inc" #    New-PSSessionConfigurationFile -Path .\DnsRead.pssc -SessionType RestrictedRemoteServer -VisibleCmdlets "Show-DnsServer*" -ModulesToImport DnsServer #   Register-PSSessionConfiguration -Name DnsRead -Path .\DnsRead.pssc -AccessMode Remote -SecurityDescriptorSddl $sddl -RunAsCredential $creds # </span></span></code> </pre> <br><br>  Notice, I limited the configuration to the <code>DnsServer</code> module and only to cmdlets starting on <code>Show-DnsServer</code> , this ensures that although the shell itself will run with the privileges of user <code>administrator@litware.inc</code> , the remote user <code>user1</code> from the remote machine <code>w2012cl1</code> cannot do anything except perhaps for this: <br><br><img src="https://habrastorage.org/storage2/1b5/35d/1d3/1b535d1d3c438bcbb6fed1471f9e0f1e.png"><br><br>  Convenient thing, right?  By limiting the modules and cmdlets inside PowerShell, we can easily and naturally, within our team of administrators, make some employees responsible for the DNS, others for the network, and users, for example, to give the right to make snapshots of their Hyper-V machines inside VDI, and no one know the credentials of the user from which the task is performed!  And the ready configuration file is simply transferred from one place to all other servers with similar functions. <br>  In the next part we will go further, or rather up the list, analyze the reliable sessions, scheduled tasks and, of course, workflows.  Well, and, perhaps, a little touch on the new PowerShell ISE, there is also something to look at. </div><p>Source: <a href="https://habr.com/ru/post/146247/">https://habr.com/ru/post/146247/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146240/index.html">The battle against redeployments reaches the clouds</a></li>
<li><a href="../146241/index.html">The whole discography of Choi, videos, photos and texts</a></li>
<li><a href="../146242/index.html">$ 80,000 to the best programmers for winning the robot competition</a></li>
<li><a href="../146244/index.html">Noise is useful in solving creative problems.</a></li>
<li><a href="../146246/index.html">External and internal review of the tablet Enot J145</a></li>
<li><a href="../146248/index.html">Emotional social network</a></li>
<li><a href="../146249/index.html">Big Data Backup</a></li>
<li><a href="../14625/index.html">Miranda IM 0.7</a></li>
<li><a href="../146251/index.html">Water cooling system from the construction shop</a></li>
<li><a href="../146252/index.html">Chromium OS ported to Raspberry Pi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>