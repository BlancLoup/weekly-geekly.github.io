<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Share and update! Save space, time and server resources 1C</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last time we told how our infrastructure and the principles of working with 1C databases, of which we have countless half a thousand, have changed, an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Share and update! Save space, time and server resources 1C</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/company/knopka/blog/225027/">Last time</a> we told how our infrastructure and the principles of working with 1C databases, of which we have <s>countless</s> half a thousand, have changed, and about how we automate work with so much data.  However, there are still difficulties and crutches, and as the number of clients <a href="http://knopka.com/%3Futm_source%3Dhabrahabr%26utm_campaign%3D1c2">grows,</a> we have to invent new <a href="http://knopka.com/%3Futm_source%3Dhabrahabr%26utm_campaign%3D1c2">buttons</a> and improve old ways of optimization.  One of the main problems when working with a large number of databases 1C - rolling updates.  Today we will talk about data separation technology, which allows you to reduce the number of bases and simplify their maintenance. <br><br><img src="https://habrastorage.org/files/3b4/4e5/175/3b44e51759bd401e827675a42bd7c16a.png"><br><br>  Finding documentation on the database separation mechanism is quite difficult: there is a small article on the <a href="http://v8.1c.ru/overview/Term_000000788.htm">underlying site</a> , but it has brought us little benefit.  There is a good old <a href="https://www.google.ru/search%3Fq%3D1%25D0%25A1%2520%25D1%2580%25D0%25B0%25D0%25B7%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5%2520%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D1%2585">Google</a> , but in order to understand the intricacies, you will have to surf the issue for hours in search of the necessary piece of information.  We had no other choice, and you now have this article.  We hope it is useful. <br><a name="habracut"></a><br><h4>  Enough tolerating this! </h4><br>  When working with 1C, there is a lot to be updated: configuration, KLADR, lists of banks (they are deprived of licenses, you know), exchange rates (oh, these economically unstable euros and dollars), lists of users, processing, version of the platform.  On a good hardware update KLADR with all regions for one base takes about half an hour.  Configuration update takes from 10 minutes to several hours (when rolling in a pack). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When the base is one, two, ten, all this can be done in the form of daily routine work.  When a few dozen - it takes a very long time, but you can cope.  When there are hundreds of bases, and the <s>Siberian summer is the</s> last day of reporting in the yard, it may happen that it is physically impossible to update all the databases - there is not enough time and server resources. <br><br>  Do not forget that in each separate database lives her majesty Configuration, which does not differ from the base to the base or byte.  He lives and eats a place, despite the fact that the configuration also needs to load changes, insert processing and extend the standard functionality. <br><br>  So, if you have a few (except for organizations) that do not differ in bases, with the same configuration, the separation mechanism can make life much easier (not without tar, but more on that later).  Otherwise, very soon you will have to hire an army of admins :) <br><br><h4>  Base segregation </h4><br>  To begin with, you need to determine the sign on which you will divide the base.  The separator can be of any data type, we use a string 10 characters long: organization TIN.  The main thing is that the name of the separator (common prop) should not coincide with already existing configuration objects, that is, it cannot be called, for example, ‚ÄúOrganization‚Äù, since there is already such a reference book.  We called the separator "Group of Companies". <br><br>  After that, we take your typical configuration with an empty database, go to the configurator and open the section ‚ÄúGeneral Details‚Äù.  Add a common attribute and change the value of "Splitting data" to "Split": <br><br><img src="https://habrastorage.org/files/945/fef/e21/945fefe2171348288e35537313447e72.png"><br><br>  The configurator will offer to create session parameters - silently agree and move on.  After the creation of the ‚ÄúGeneral Props‚Äù with the separation property enabled, the database becomes similar to a multi-storey building.  The house has elements accessible to everyone and from each floor: an elevator, a flight of stairs, communications, and there is <nobr>something</nobr> unique, accessible only within the floor: apartments, a corridor, windows.  The metaphor is simple, and hopefully understandable :) <br><br>  To enter a certain organization (or area of ‚Äã‚Äãthe database), you must provide a separator in the connection string to the database or specify it in the v8i file (which we described <a href="http://habrahabr.ru/company/knopka/blog/225027/">last time</a> ). <br><br><pre><code class="hljs pgsql">[ <span class="hljs-number"><span class="hljs-number">7710967300</span></span>  ] <span class="hljs-keyword"><span class="hljs-keyword">Connect</span></span>=Srvr="%servername%";<span class="hljs-keyword"><span class="hljs-keyword">Ref</span></span>="%base_name%"; AdditionalParameters=/Z "-0,-0,+7710967300";</code> </pre> <br><br>  After / Z indicate the general details in order.  Since in our typical accounting already have two common system properties, we specify for them the value -0 so that they are not used, and as the third (which we created) we transfer the TIN. <br><br><h4>  1000 and 1 checkbox </h4><br>  Now you need to determine how much of the data will be common to all areas.  All this is configured through the configurator.  In the properties of the general props, which we have just created, there is a ‚ÄúComposition‚Äù item that opens a small list of 800 parameters: <br><br><img src="https://habrastorage.org/files/32e/4d2/137/32e4d2137b214ac49b14250b632e8854.png"><br><br>  The selection of parameters is left to your prudence, discretion and environment.  Here is <a href="">our option</a> (neater, there are 20,000 pixels). <br><br>  The separator also allows you to set up a separate list of users for each database - this can be useful if you have hundreds of users - when entering a certain database you don‚Äôt have to scroll through this list to bloody blisters.  We do not use it because we have configured transparent authorization. <br><br><h4>  Unload data from current databases </h4><br>  To upload data from current databases, we use a universal <nobr>XML-exchange</nobr> .  You can‚Äôt just take and unload the base, you need to set up the exchange rules, otherwise, during the download, errors (and conflicts) may arise (and there will be any), and the second base will simply not get through.  Recall that we divide the base areas for each organization and in our case <a href="https://mega.co.nz/">such exchange rules</a> work.  If you decide to use another separator, you will have to poke around with brains and checkboxes.  The main thing is not to use the standard unloading - this will lead to the duplication of all predefined records. <br><br><img src="https://habrastorage.org/files/0ea/e46/b09/0eae46b09f0b483fb1bd36ec64c62a93.png"><br><br><blockquote>  Housekeeping note: it is better to unload reference books and documents separately - this way you can avoid unnecessary mistakes at the time of loading. </blockquote><br><br><h4>  We load data into the divided base </h4><br>  Run 1C with the / Z parameter "-0, -0, +% your separator%", indicating the separator of the organization whose data we are going to load.  We launch the universal exchange and feed the files we received during the upload: first reference books, then documents.  Repeat this operation for each <nobr>base-area</nobr> . <br><br><img src="https://habrastorage.org/files/617/48b/d44/61748bd44728408db9a5b142a8210c3b.png"><br><br>  To simplify the task, we perform bulk uploads, pre-running a slightly fixed standard processing via the command line (/ Execute c: \ upload.epf).  Then manually load the resulting files into a split database. <br><br><h4>  How to spend more time to spend less time </h4><br>  The separation process is not a quick thing.  Recall that we now have more than 500 organizations, but in a couple of weeks we managed to divide only 70. However, we know for sure that in six months we will thank our past for the work done and a lot of time and effort saved. <br><br>  Accountants <a href="http://knopka.com/%3Futm_source%3Dhabrahabr%26utm_campaign%3D1c2">Buttons</a> do not notice the transition of organizations from a normal base to a divided one; for them, the process is painless.  Booty burns only admins :) <br><br>  Side effects: saving space 1 to 20, an indirect increase in the speed of work - invaluable.  In absolute figures: 50 organizations occupy 2 GB of space in SQL, while one separate database takes up 800 MB. <br><br><h4>  The promised spoon of tar, even four: </h4><br><ul><li>  if <nobr>one</nobr> of the users has ruined the data in one organization, you have to roll back the entire divided database - you can not just take and roll one data area </li><li>  you have to test updates more carefully, especially those that add or change directories </li><li>  if you need to transfer the base to the client (or merge the tax :), you have to do the reverse procedure: unload the organization from the split base using universal exchange, then load it into an empty regular base and save from it into.  <nobr>dt file</nobr> </li><li>  in a divided database, it is impossible to manage the scheduled tasks (for example, it will not be possible to automatically update currency rates) </li></ul><br>  The first three spoons are not so bitter - they just make us more attentive.  But we still do not know what to do with the fourth, but we are diligently investigating. </div><p>Source: <a href="https://habr.com/ru/post/239697/">https://habr.com/ru/post/239697/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../239679/index.html">Charming marketing</a></li>
<li><a href="../239681/index.html">Results of the Russian Code Cup 2014 and analysis of tasks</a></li>
<li><a href="../239685/index.html">Successful and unsuccessful expeditions to Mars and the orbit of Mars: infographics</a></li>
<li><a href="../239689/index.html">Windows Phone Store Games - 5% conversion without marketing</a></li>
<li><a href="../239693/index.html">Clouds through the eyes of IT professionals: vision and expectations</a></li>
<li><a href="../239699/index.html">How to automatically back up MySQL database and Web server to FTP repository</a></li>
<li><a href="../239701/index.html">Comparative testing of USB flash drives standard On-The-Go</a></li>
<li><a href="../239703/index.html">IBM presents an alternative to x86 servers - systems based on OpenPOWER technologies.</a></li>
<li><a href="../239707/index.html">Trilateration with iBeacons, iOS security and VKontakte mobile advertising on #MBLTDev</a></li>
<li><a href="../239713/index.html">Why are Yandex and Mail.ru cheaper, and what does it mean</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>