<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Connecting "self-made" devices via bluetooth with iOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habrayuzer! I had a situation at work that I had to design a device for iOS that would transmit data to iPad via bluetooth. In short, this is a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Connecting "self-made" devices via bluetooth with iOS</h1><div class="post__text post__text-html js-mediator-article">  Hello, Habrayuzer!  I had a situation at work that I had to design a device for iOS that would transmit data to iPad via bluetooth.  In short, this is a device that should hide in a regular pack of cigarettes and transfer data to the ipad, on which edge it lies.  I started studying the apple site for the interaction between bluetooth devices and the ipad itself, but there were options to either use GameKit (which we didn‚Äôt fit at all), or to join the Apple MFi program (which brings a lot of restrictions and just don‚Äôt enter it).  They began to look for solutions, and then a person came to me, who was very good at electronics. <br><a name="habracut"></a><br>  Initially, the development was planned for Arduino, but a knowledgeable person dissuaded from this undertaking due to large financial costs (a batch of about 1000 pieces was needed).  And we found the optimal solution - to assemble the device ourselves.  Since I am not good at electronics, I will simply describe what components were used: <br><br><ul><li>  position sensor MMA7260QT </li><li>  ATmega16U4-AU controller </li><li>  bluetooth bluegiga </li></ul><br><br>  The result was this prototype: <br><img src="https://habrastorage.org/storage2/3fd/fda/52d/3fdfda52dbaf9cefe4c80db8c2ab766d.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Bottom view: <br><img src="https://habrastorage.org/storage2/f9f/c59/ec5/f9fc59ec567044fb8dab060bf38081ba.jpg"><br><br>  The device perfectly conveyed its position, but the main question arose: how to transfer this data to the iPad? <br><br>  The solution came quite unexpectedly - there is such a profile in SSP - ‚Äújust works‚Äù, when code is exchanged, <br>  but without indication and user involvement.  And we decided to use it, emulating the usual bluetooth keyboard.  Screwed this profile to the prototype, and this is what happened (I apologize for the quality of the video, but I think the point will be clear): <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/vRg5ppmJHGI&amp;xid=25657,15700023,15700043,15700186,15700190,15700253,15700255,15700259&amp;usg=ALkJrhh92Y1M2VzIm4pGLK494TcllnjRcA" frameborder="0" allowfullscreen=""></iframe><br><br>  The device transmits a certain letter 10 times per second depending on the location, and at each change of position transmits a number from 0 to 9 which corresponds to the charge of the battery. <br><br>  Well, on the iPad it was not difficult to intercept data from the keyboard.  I created a hidden UITextField, and just intercepted the ‚Äúpressed‚Äù keys in it.  Here is a brief code for how this all works: <br><br><pre><code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITextFieldDelegate</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">IBOutlet</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UITextField</span></span> *textField; } <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">strong</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IBOutlet</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UILabel</span></span> *currTestLabel; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">strong</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IBOutlet</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UILabel</span></span> *packPositionLabel; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">strong</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IBOutlet</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UILabel</span></span> *batteryPercentageLabel; <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span></code> </pre> <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class"> - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-class"> </span></span>{ [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> viewDidLoad]; [textField becomeFirstResponder]; } - (<span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span>)textField:(<span class="hljs-built_in"><span class="hljs-built_in">UITextField</span></span> *)textField shouldChangeCharactersInRange:(<span class="hljs-built_in"><span class="hljs-built_in">NSRange</span></span>)range replacementString:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)string { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([string isEqualToString:<span class="hljs-string"><span class="hljs-string">@"Z"</span></span>] || [string isEqualToString:<span class="hljs-string"><span class="hljs-string">@"z"</span></span>] || [string isEqualToString:<span class="hljs-string"><span class="hljs-string">@""</span></span>] || [string isEqualToString:<span class="hljs-string"><span class="hljs-string">@""</span></span>]) { _packPositionLabel.text = <span class="hljs-string"><span class="hljs-string">@""</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([string isEqualToString:<span class="hljs-string"><span class="hljs-string">@"9"</span></span>]) { _batteryPercentageLabel.text = <span class="hljs-string"><span class="hljs-string">@"100%"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NO</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span></code> </pre><br><br>  I hope this article will make life easier for someone.  If anyone needs a circuit, device firmware, or details about how it ultimately works, I‚Äôm happy to share it! <br><br><habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/152621/">https://habr.com/ru/post/152621/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../152603/index.html">In django, you can use your model instead of contrib.auth.models.User</a></li>
<li><a href="../152607/index.html">Mozilla's high-speed future apps</a></li>
<li><a href="../152609/index.html">Student technology day - now live from St. Petersburg!</a></li>
<li><a href="../152611/index.html">Save money from your youth or a couple of statements, easily checked in Excel</a></li>
<li><a href="../152617/index.html">G8 Summit - everyone will be there</a></li>
<li><a href="../152625/index.html">Quest to configure an alternative port ADFS 2.0</a></li>
<li><a href="../152629/index.html">User Experience Versus Interface Innovations</a></li>
<li><a href="../152631/index.html">How to choose an SSL certificate</a></li>
<li><a href="../152635/index.html">Briefly about duplicating Windows 8 Tiles</a></li>
<li><a href="../152637/index.html">First steps with Chromium Embedded Framework and .NET</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>