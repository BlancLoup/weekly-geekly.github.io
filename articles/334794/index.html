<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bluetooth mesh - network architecture and security</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Finishing the topic of the bluetooth mesh network (the first note , the second note ), today we will briefly review its architecture and security. 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bluetooth mesh - network architecture and security</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/web/1a2/c92/f53/1a2c92f53c5e4f6fb9e8512df3da100a.jpg" alt="image"></div><br>  Finishing the topic of the bluetooth mesh network (the <a href="https://habrahabr.ru/post/333792/">first note</a> , the <a href="https://habrahabr.ru/post/334478/">second note</a> ), today we will briefly review its architecture and security. <br><br>  Welcome. <br><a name="habracut"></a><br><h3>  Architecture </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/web/de9/563/0f1/de95630f181b4c70885c1324f60df007.PNG" alt="image"></div><br>  The network architecture is similar to the OSI network model and consists of 8 levels.  Consider them from the bottom up. <br><br>  <b>Level BLE (Bluetooth Low Energy)</b> - located at the very bottom of the stack.  This is not just one of the layers of the architecture, but in fact, it is a complete BLE stack, which is necessary for providing a network with wireless communication.  Thus, the network is completely dependent on the availability of the BLE stack on the device. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>The link layer (Bearer Layer)</b> defines the principles for processing a network PDU.  Currently two channels are defined: <br><br><ul><li>  <i>Advertisment Channel (Advertising Bearer)</i> ‚ÄîUses the ability to advertize and scan the BLE level to receive and transmit PDU packets; </li><li>  <i>GATT channel (GATT Bearer)</i> - allows a device that does not support the ‚ÄúAdvertising Bearer‚Äù to communicate with network nodes using the ‚ÄúProxy‚Äù protocol.  The "Proxy" protocol is encapsulated in a GATT (Generic Attributes Profile) operation using specifically defined GATT characteristics.  The proxy host implements these characteristics and supports both channels in order to be able to convert and transfer messages between two types of media. </li></ul><br>  <b>Network layer (Network Layer)</b> - defines various types of message addresses and their format, and also transfers PDU packets from the transport layer to the link layer.  A layer can support several channels, each of which can have several network interfaces, including a local interface used for communication between elements that are part of the same node.  The layer also determines which network interfaces should transmit messages.  An input filter is applied to messages coming from the link layer to determine whether these messages should be delivered higher.  Output messages are processed by the output filter for and do the same thing only for the delivery below.  Thus, the functions of the ‚ÄúRelay‚Äù and ‚ÄúProxy‚Äù nodes can be implemented by the network layer. <br><br>  <b>Lower Transport Layer</b> ‚Äî Receives PDU packets from the upper transport layer and sends them to the lower transport layer of another device.  If necessary, segmentation and assembly packages.  For packets whose length exceeds the length of one transport PDU, the layer performs segmentation, dividing the packet into several transport PDUs.  The receiving party will assemble these segments into one packet of the upper transport layer PDU and transmit it higher. <br><br>  <b>Upper Transport Layer (Upper Transport Layer)</b> - is responsible for encrypting, decrypting, and authenticating application data passing through the access layer. <br><br>  <b>Access Level</b> - is responsible for how applications can use the upper transport layer by: <br><br><ul><li>  determine the format of the application data; </li><li>  manage the encryption and decryption process performed at the upper transport layer; </li><li>  checks before sending the data upwards that the data received from the upper transport layer is intended for the current network and a specific application. </li></ul><br>  <b>Foundation Models Layer level</b> - responsible for the implementation of those models related to network configuration and management. <br><br>  <b>Models Layer (Models Layer)</b> - implements the model, thereby implementing the behavior, messages, states, state bindings, etc., in accordance with the definitions of the model specifications. <br><br><h3>  Security </h3><br>  BLE allows the creator of profiles to use a variety of different security mechanisms, from different approaches to pairing, to individual security requirements related to individual characteristics.  In fact, security in BLE is absolutely optional, it is simply allowed to have a device.  The developer or device manufacturer is responsible for the threats himself and determines the security requirements for his product.  However, in a Bluetooth network, <b>security is a prerequisite for network operation</b> and this condition cannot be changed or disabled. <br><br>  We list the fundamental components of security: <br><br><ol><li>  All network messages are encrypted and authenticated. </li><li>  Network security, application security and device security are considered as separate components. </li><li>  Security keys can be changed during the life of the network using the Key Refresh procedure. </li><li>  Obfuscating messages makes it difficult to track them, ensuring confidentiality. </li><li>  The process of adding a device to a network is itself a process in the context of security. </li><li>  Deleting nodes from the network is done in such a way as to exclude an attack of the ‚Äútrashcan‚Äù type. </li></ol><br><h4>  Division of responsibility </h4><br>  Network security is based on three types of security keys.  These keys provide security for various aspects of the network, thereby improving overall network security. <br><br>  To understand the term ‚Äúdelineation of responsibility‚Äù, consider a lighting lamp having a relay function (Relay).  As a repeater, it can process messages related to a door or window security system, which is part of this network.  The lamp does not have the ability to access and process the details of such messages, but must transmit them to other nodes.  To ensure that access to such messages is denied, the network uses different security keys to protect messages at the network level from those used to protect data related to specific applications: lighting, security, heating, etc. <br><br>  All nodes in the network have a network key (NetKey).  But this key makes the device a node and a member of the network.  But the encryption key and private key are generated directly from the NetKey key. <br>  Possession of a NetKey key allows a node to decrypt data and authenticate to the ‚Äúnetwork layer‚Äù of the network stack, in order to be able to perform certain network functions, such as relaying.  But the possession of them does not allow to decrypt these applications. <br><br>  A network can be divided into subnets, and each subnet has its own NetKey key belonging only to nodes that are members of that subnet.  This feature can be used to isolate specific physical areas, such as each room in a hotel. <br><br>  The data of a particular application can only be decrypted by nodes that have the correct application key (‚ÄúAppKey‚Äù).  A large number of keys of this type can pass through nodes in the network, but, as a rule, a limited set of nodes having this application will have a certain key.  For example, lamps and light switches will have the AppKey key for the lighting application, but not the key for the heating system, which will only have thermostats, radiator valves, etc. <br><br>  The ‚ÄúAppKey‚Äù keys are used by the upper transport layer of the network stack to decrypt and authenticate messages before passing their access level. <br><br>  ‚ÄúAppKey‚Äù keys are associated with only one ‚ÄúNetKey‚Äù key.  This association is called ‚Äúkey binding‚Äù and means that specific applications that own a specific ‚ÄúAppKey‚Äù key can work only on one specific network, while the network can contain several independent applications. <br><br>  And the last key, the device key "DevKey".  This is a special type of application key.  Each node has a unique DevKey, known only to the device with the function of the registrar in the network (Provisioner) and to no one else.  DevKey is used in the preparation process to ensure secure communication between the Provisioner and the host. <br><br><h4>  Deleting a node, updating a key, and trashcan attacks </h4><br>  And so, the nodes contain different security keys.  If a node has broken down and needs to be disposed of, or if the owner decides to give the node to another owner, it is important that the device and the keys it contains cannot be used to install an attack on the network in which it previously was.  For this, the procedure for removing a node from the network has been defined.  The application on the Provisioner device adds the node to the blacklist, and then initiates the Key Refresh Procedure.  This procedure causes all nodes on the network, with the exception of those that are members of the blacklist, to receive new network keys, application keys and all other derived data.  In other words, it replaces the entire set of security keys that form the basis of network security and applications.  Thus, a node that has been removed from the network and which contains the old ‚ÄúNetKey‚Äù and the old set of keys ‚ÄúAppKey‚Äù is no longer a member of the network and poses no threat. <br><br><h4>  Confidentiality </h4><br>  The private key (privacy key) obtained from the ‚ÄúNetKey‚Äù is used to obfuscate the values ‚Äã‚Äãof the PDU headers, such as the source address, for example.  Obfuscation ensures that random, passive message interception cannot be used to track the devices and people who use these devices.  Obfuscation also makes it difficult to attack based on traffic analysis. <br><br><h4>  Repeat based attacks </h4><br>  This attack is a technique in which the interceptor intercepts one or more messages and simply re-transmits them later in order to deceive the recipient by doing what the attacking device is not authorized to do.  Example: a car keyless entry system always has the risk of intercepting data between the car owner and the car. <br>  The bluetooth network has protection against such attacks.  Protection is based on the use of two fields in the PDU package: <br><br><ul><li>  <b>"</b> Sequence Number <b>"</b> (Sequence Number (SEQ)).  Elements of the network each time you send a message, increase the value of SEQ.  A node receiving a message with an SEQ value less than or equal to the previous valid message will cancel it, since it is likely that this message refers to a replay attack. </li><li>  <b>‚ÄúIV Index‚Äù</b> is a field considered with SEQ.  Its value within the message from this element must always be equal to or greater than the value of this field in the last valid message of this element. </li></ul><br>  That's all. <br><br>  I hope the information provided gives a complete overview of the new technology. <br><br>  For those who want to learn more about it, there are 3 wonderful specifications: <br>  - profile specification; <br>  - model specification; <br>  - device specification. <br>  All of them are available <a href="https://www.bluetooth.com/specifications/mesh-specifications%3F_ga%3D2.216956694.1272745227.1501746630-277251224.1500554250">here</a> . <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/334794/">https://habr.com/ru/post/334794/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334782/index.html">As another large courier company, the personal data of its customers handed out</a></li>
<li><a href="../334786/index.html">MMO from scratch. Part 2. Building functionality + Diamond Square algorithm</a></li>
<li><a href="../334788/index.html">Offshore and foreign trade transactions: advantages and pitfalls</a></li>
<li><a href="../334790/index.html">As I made the fastest resize of images. Part 3, fixed-point numbers</a></li>
<li><a href="../334792/index.html">Microsoft did not isolate Windows Defender in the sandbox, so I did</a></li>
<li><a href="../334796/index.html">How Android works, part 1</a></li>
<li><a href="../334798/index.html">1C and ETL</a></li>
<li><a href="../334800/index.html">DataGrip 2017.2: Supports Redshift and Azure, several databases in PostgreSQL, transaction control and more</a></li>
<li><a href="../334802/index.html">Music licensing for indie developers</a></li>
<li><a href="../334804/index.html">Finding the best place in the world for a windmill</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>