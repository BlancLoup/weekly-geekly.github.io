<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DIY Math Package for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The reason for writing this post was the article "Mathcad Express - a free math editor about which few people know . " 

 I liked the discussion aroun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DIY Math Package for Android</h1><div class="post__text post__text-html js-mediator-article">  The reason for writing this post was the article <a href="http://habrahabr.ru/company/nerepetitor/blog/247999/">"Mathcad Express - a free math editor about which few people know</a> . <a href="http://habrahabr.ru/company/nerepetitor/blog/247999/">"</a> <br><br>  I liked the discussion around this article.  However, I am more interested in a slightly different aspect of the problem being discussed, namely: is a computer algebra system needed on a smartphone or tablet, or is it such a strange cockroach in the head of a near-engineer engineer? <br><a name="habracut"></a><br><h4>  Formulation of the problem </h4><br>  As you know, the life of a simple programmer is hard and unsightly.  About a year ago, when I realized the computational capabilities of my china phone with four cores on the Android platform, I wanted to shake my scientific antiquity and count something on the phone.  Play-market can do everything, it was thought then. <br><br>  There were no special restrictions, for my scientific career I managed to use both Mathcad with MATLAB, and Mathematics, and FEM-systems (Ansys).  Therefore, to begin to look everything. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Such a picture has taken shape (I will not provide links; those who wish can easily find it on the Play Market): <br><ul><li>  Matlab Mobile, as an extension of the licensed copy of the desktop version.  I did not have one at home, so, unfortunately, this option has disappeared; </li><li>  The Wolfram Alpha service and a cloud of tutorials from the Wolfram Group are not exactly what I associate with the words ‚Äúcalculate on my own‚Äù; </li><li>  The Matlab and Octave clones for Android are already warmer, but writing code on a 5-inch screen is not very convenient; </li><li>  A huge number of scientific calculators of varying degrees of sophistication.  They all have one thing in common - the input and presentation of results are organized as in a classical (hardware) graphing calculator.  The main disadvantage of such an idea is the absence of a ‚Äúdocument‚Äù that can be saved, changed and recounted again and again; </li><li>  Nothing that looked like a Matkad could then be found. </li></ul><br><br>  Why am I here and at the beginning of the post mentioned Mathcad?  In my opinion, this idea fits well with the tasks of mobile mathematics: <br><ul><li>  On a small device screen with a finger-oriented interface, it‚Äôs still more convenient to work with a formula if it is written in a natural mathematical form, and not as a code in a scripting language; </li><li>  A mobile device is well suited to try something quickly.  Therefore, a convenient interface is required from the mobile mathematical system, but no serious computational capabilities are required; </li><li>  Ideally, in such a system, I need a PR feature.  That is, not only to quickly write down a complex formula and build a couple of graphs, but it is also convenient to publish it in all your social networks.  The formulas in the natural mathematical notation here are also more convenient than the script. </li></ul><br><br>  That is, I would love to install Mathcad mobile on my smartphone.  But there was no such thing (in the sense of ‚ÄúMatkad‚Äù, but not a smartphone) on the Play-market.  Hence the idea to develop something like this on your own. <br><br><h4>  Task statement </h4><br>  So, I decided to write from scratch an Android application designed to create and work with mathematical calculated documents. <br><br>  I formulated the requirements for the application as follows: <br><ul><li>  The widest possible coverage of supported devices.  Hence the minimum API level 8; </li><li>  Support for screens of various resolutions and landscape / portrait orientation; </li><li>  Document storage format - custom based on XML; </li><li>  Detailed documentation.  In order not to produce entities, the same format in which the documents themselves are stored is used for documentation; </li><li>  To create printed documentation, provide for export to LaTeX, since it is convenient for writing formulas and makes it possible to generate PDF; </li><li>  Math is limitless.  Do not implement everything.  Therefore, the initial functional includes functions of several variables, graphics (2D and 3D), numerical integration and differentiation, a logical operator.  Further, depending on the user likes; </li><li>  The ability to insert text and images, but the text editing functionality for a start is minimal; </li><li>  Convenience and quality take precedence over functionality; </li><li>  Languages ‚Äã‚Äãare only those that I know myself and can develop and maintain without recourse to a translator. </li></ul><br><br>  And, probably, the most important thing.  This is a hobby.  Therefore, it is important to remain realistic and not aim at the fact that it is impossible for one person to realize at a reasonable time in the mode of 5-6 days a week for 2 hours. <br><br>  Since the project received the status of "favorite hobby for the next year," then there are two important consequences: <br><ul><li>  I decided not to limit myself to reasonable expenses for equipment / promotion / services, if any; </li><li>  Goals such as ‚ÄúEarn at any cost‚Äù and ‚ÄúBe at the top‚Äù are not set, so I decided not to add ads to applications and refuse to promote through motivated downloads. </li></ul><br><br>  At the same time, I am opposed to complete freebies.  Therefore, I chose the following monetization model: <br><ul><li>  The application itself is paid and is distributed only through the Play-market; </li><li>  There is a free version with an identical appearance and interface, but with a stripped down math.  Moreover, this functionality is not deactivated, but is missing at the code level.  That is, the free version cannot be physically switched to full mode and it is distributed wherever possible. </li></ul><br><br>  This model is easily implemented using a version control system (in my case, SVN), where the main branch is intended for experiments and development, and two subsidiaries are for the releases of the paid and free versions, respectively. <br><br>  At this point, you can draw a line under the input data and start discussing the implementation. <br><br><h4>  Solution Method </h4><br>  In my opinion, the most important question is how to organize on a smartphone the input and editing of formulas that can be calculated (for a start, only numerically), but at the same time they are presented in a natural mathematical form?  How to combine from these formulas, graphs, text and images loaded from a file a single document capable of self-calculation? <br><br>  Many of you have probably used the Word's formula editor.  On the big screen, but with a keyboard and mouse at hand, everything is very simple.  You can see various mathematical palettes on the screen (or are easily accessible from the menu), the mouse is positioned with the mouse, and then the desired character is entered either from the keyboard or with the mouse.  Part of the formula can be easily selected with the mouse, copied, replaced or dragged to another location.  The formulas themselves as floating objects can be dragged with the mouse to any part of the document.  Familiar, yes? <br><br>  And now the same thing on the touch screen, without a mouse, without a hardware keyboard, where does the virtual keyboard cover a third (half of the landscape orientation) of the screen? <br><br>  I'll start with the layout of the objects in the document.  There are actually not very many options: <br><ul><li>  Each object has its own coordinates and objects can be positioned relative to each other arbitrarily, as in a vector graphics editor.  This option is implemented in the Matkad itself.  Under Android, you can use outdated AbsoluteLayout for this, but you must also implement the alignment / distribution of objects and groups of objects.  That is, in this embodiment, an additional user interface is needed that is not related to the main task.  For a desktop computer, this is not critical, but the usability of a mobile application, in my opinion, will be worse; </li><li>  Location in the cells of the table, as in MS Excel.  I dismissed this option immediately, since the math document is anything but a table; </li><li>  A simple list where each object is in its own line.  This is how most scientific calculators work.  This is what I implemented in the first version of the application.  Cheap and angry.  He received quite reasonable comments from users that such a method is very inconvenient, since there is an objective need to group some formulas in rows; </li><li>  The result is a simplified version of RelativeLayout, a sort of two-dimensional list where, by default, objects are added vertically (from the bottom of the selected object), but with a single window you can add an object both to the right and to the left of the selected one: <br><br><img src="https://habrastorage.org/files/369/6fb/db4/3696fbdb40e14d86b2b9169195c159b6.png"></li></ul><br><br>  So far I have abandoned the mode of capturing and dragging objects while moving a finger across the screen, since such an interface in the case of a two-dimensional list requires some work.  Instead, the possibility of group selection of objects and group operations through the context menu is implemented: deleting, copying to the buffer and replacing the selected object with the contents from the buffer. <br><br>  The next question is related to the input of information.  Many calculators have their own virtual math keyboard for this.  To me, this approach does not seem optimal.  For example, I myself use a tablet with an external USB keyboard, and in this case it has a landscape orientation.  To roll out a virtual keyboard in such a situation, which takes up half of the screen, is not entirely logical.  Therefore, I initially aimed at the fact that the application will work with a standard system keyboard and not require special keyboard extensions.  That is, absolutely all mathematical symbols can be entered as a code from the keyboard, and this idea is again borrowed from Matkad.  To enter Greek characters, I simply added Greek to the keyboard layouts. <br><br>  However, forcing the user to memorize all the codes is not a good idea.  Therefore, at the bottom of the screen, regardless of orientation, there is a second toolbar, in design and size identical to the top main one.  All mathematical symbols, of which there are now about 50, are located in one line on this panel, and it scrolls to the right and left.  With a short press, the character is entered.  With a long press on the symbol, a hint pops up that is and which code corresponds to it: <br><br><img src="https://habrastorage.org/files/840/92b/34d/84092b34d3eb4ee29232184d36c9a3cd.png"><br><br>  In support of this idea, I want to quote the feedback of one of the users: "it makes the app perfect". <br><br>  And where are codes or characters entered?  Here again, everything looks like a Matkad.  When adding an object, empty input fields appear.  You can enter text, numbers or symbols into them.  When you enter, for example, a division symbol, a fraction with two fields appears in one of the input fields, one of which will include the text entered earlier in the deleted field.  This is the main input mode, which is good when you know the exact sequence of typing the desired formula: <br><br><img src="https://habrastorage.org/files/5ee/80f/2e1/5ee80f2e1e8b44a686b03dfd756db43f.png"><br><br>  And if you do not know or need to change something in the formula?  Context menu to help.  It is activated by long pressing on the part of the formula and provides access to the clipboard.  In addition, there is a button to expand the selection area.  From the bottom toolbar, you can enter a symbol that will be applied to the selected block: <br><br><img src="https://habrastorage.org/files/ff7/7c7/750/ff77c7750b884fe998abd9bf8ac38dc7.png"><br><br>  It turned out a kind of cooperation.  The user, entering the formula in such a way, does the main work on its syntactic analysis.  And the application in gratitude for this formula will calculate. <br><br>  Thus, each formula has two aspects: <br><ul><li>  First, it is a hierarchy of nested layouts, which contain both input fields and mathematical notation.  Visually, this is the usual formula. <br><br><img src="https://habrastorage.org/files/bde/a1c/50c/bdea1c50cde94cae80edb8e65352d26e.png"><br><br></li><li>  Secondly, it is the hierarchical structure of primitive mathematical tokens, each of which is able to be calculated.  Each token is associated with its corresponding layout and is its owner. </li></ul><br><br><h4>  Underwater rocks </h4><br>  And here a serious ambush was waiting for me.  De facto, Android has a limit on the number of nested layouts related to the size of the procedure call stack.  In this case, the compiler will not say anything, but during operation (in the android.view.View.draw method of one of the nested layouts), the application crashes with the exception of StackOverflowErrors.  Read more about it <a href="http://stackoverflow.com/questions/16843357/what-is-the-android-ui-thread-stack-size-limit-and-how-to-overcome-it">here</a> . <br><br>  To catch this exception is real, since I have my own implementation of the onDraw () method at the very beginning of this call chain, but at the same time, starting with a certain complexity of the formula, it will simply cease to be drawn.  I had to manually control the depth of attachments of the elements of the formula, and, starting from a certain critical depth (selected experimentally), give an unsympathetic, but still necessary message ‚ÄúUnfortunately, the formula depth limit for this version of Android has been reached‚Äù. <br><br>  Experimentally, I picked up the following values ‚Äã‚Äãof the maximum depth, counting from the root RelativeLayout fragment: <br><ul><li>  if API level &lt;15 (Android 2.2.x - 4.0.x), then the maximum depth is 7 nested levels of layouts; </li><li>  if API level is from 15 to 17 (4.1.x - 4.2.x), then 9 levels; </li><li>  if API level&gt; 17 (4.3.x and higher), then 15 levels. </li></ul><br><br>  The second problem is the lack of a standard component that would combine horizontal-vertical scrolling and scaling.  These actions seem to be supported by WebView, but WebView itself doesn't suit me at all.  The solution is clumsy, but it works - I took the sources of the standard ScrollView and HorizontalScrollView, combined them into one component and screwed in the detection and processing of zoom.  What I still could not bring to mind is the correct positioning in the document after a change in scale. <br><br><h4>  Documentation and localization </h4><br>  Reading the user reviews on the Play Store about various scientific calculators, I found that one of the weak points of most calculators is the lack of documentation.  Sometimes full.  Therefore, I decided to give the documentation a lot of attention.  And I added it both to the application itself (the NavigationDraver sidebar turned out to be convenient for this purpose) and uploaded it to the network as a PDF and added links to the application for direct download to the application. <br><br><img src="https://habrastorage.org/files/936/b5e/e35/936b5ee3506b4434b57662ab7f080222.png"><br><br><img src="https://habrastorage.org/files/89d/1be/85a/89d1be85a28746c2a8bac191c5c35794.png"><br><br>  In the application, the documentation sections are stored in XML and opened as separate frames.  There is a function to convert the document to LaTeX.  The pdfletx utility in the workplace completes the job.  The result is not ashamed to put on <a href="http://drive.google.com/file/d/0Bwle6EObrO16OU9VX1hrVlJabk0">public display</a> . <br><br>  Now a few words about localization.  The development of the old habit is conducted in English.  When the program is compiled and launched (that is, ready for sale), the interface and documentation of the newly added chips are translated into two other languages, one of which is Russian. <br><br>  And here I was pleasantly surprised by the download statistics in the developer console.  Mathematics in RuNet honored!  By the way, I did not release the Russian version right away, but when the number of downloads approached a thousand.  But it practically did not increase the already high percentage of downloads from Russia and neighboring countries.  At the moment, the distribution of downloads for the <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.mkulesh.micromath">free version</a> by languages ‚Äã‚Äãand countries looks like this: <br><br><img src="https://habrastorage.org/files/76a/e9c/f35/76ae9cf353ae4599abba2aafe4f966da.png"><br><img src="https://habrastorage.org/files/287/be3/08b/287be308bdf94c3db868b81b966ab89c.png"><br><br>  That is, Russia, Ukraine and Kazakhstan together provide more than 40% of downloads.  The paid version gives a different picture: downloads from Russia dominate only with a slight margin. <br><br><h4>  Conclusion </h4><br>  Well, a lot has already been written, it‚Äôs time to go round.  From a computational point of view, many of the necessary things have not yet been realized: there are no complex numbers, there is no support for arrays, there is not even primitive matrix arithmetic, there is no solution of equations.  But then a reasonable question arises - is it necessary on the phone?  It is interesting to hear the opinion of a respected audience. <br><br>  As for the immediate tasks, while the basic wishes of users relate to increasing export opportunities.  For example, one of the last comments: ‚ÄúInterested in such a question, is there any way to link a document with a match?  That would be an opportunity to finalize the document on the PC.  Regarding Matkad, I personally doubt it, since the format is proprietary, but such things as exporting to HTML (just today I found the <a href="http://www.mathjax.org/">MathJax</a> framework), to PDF, or some open office format can be implemented. <br><br>  At this I want to thank for the attention of all who read to the end, and with a sense of accomplishment, to bow out.  I will be glad to questions, if any. </div><p>Source: <a href="https://habr.com/ru/post/250727/">https://habr.com/ru/post/250727/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250717/index.html">Last night amazon fell in europe</a></li>
<li><a href="../250719/index.html">Implementing messaging between browser tabs</a></li>
<li><a href="../250721/index.html">HighLoad in the platform for online auto parts stores</a></li>
<li><a href="../250723/index.html">Ara, yes? Or the modular smartphone of the future</a></li>
<li><a href="../250725/index.html">Results of testing algorithms of Russian biometric companies in the world market</a></li>
<li><a href="../250729/index.html">How to simplify the verification of a bank card holder for online payments?</a></li>
<li><a href="../250731/index.html">JMeter: Forget Beanshell Sampler</a></li>
<li><a href="../250733/index.html">Introducing the Realtek RTL8954C debug card</a></li>
<li><a href="../250735/index.html">What DDoS protection services do not negotiate or why protection does not work</a></li>
<li><a href="../250743/index.html">Weekly assembly Vivaldi 1.0.105.7</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>