<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Notifications in the browser and an example of how they can be used with benefit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably, you all have already heard about the Web Push technology as part of the Push API and Notifications API . I am sure that among you there are ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Notifications in the browser and an example of how they can be used with benefit</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/dde/6a0/53c/dde6a053cdab4cc5a7d945fcc6bcd7c1.PNG"><br><br>  Probably, you all have already heard about the Web Push technology as part of the <a href="https://developers.google.com/web/updates/2015/03/push-notifications-on-the-open-web">Push API and Notifications API</a> .  I am sure that among you there are those who pin their hopes on this technology as a new channel of communication with the user.  And I do not exclude the possibility that this article will be read by the founders of those few startups who have seriously taken up the hilling of the Web-push technology for advertising and marketing.  Today I will tell you about how you can use this technology. <br><a name="habracut"></a><br>  Modern web standards have given us the opportunity to send notifications to the user.  These are such pop-up messages in the lower right corner of the screen, although the location depends on the browser used, and the developer cannot directly influence the location of the message.  And these messages pop up means and show some information.  Information known to the user as it is impossible to extend these notifications to an audience that is not subscribed to them.  And everything seems to be logical, but users stubbornly press the ‚ÄúRefuse‚Äù button when they are offered to subscribe to receive such notifications.  Let's try to figure out why this is happening. <br><br>  Technology "web push" stalled in one place and this is obvious.  In addition to the annoying factor of having the notice itself, which bursts into the surface of the desktop with a fast, dazzling white airplane, there is one more reason.  This use of technology is not intended.  Initially, the technology was conceived as a tool for interactivity of web applications.  All web applications work in a browser and it is extremely difficult or impossible for them to access the environment of the user's operating system.  Therefore, if the user collapses the browser, he practically turns off the application, and whatever happens there, he will not know about it until he opens the browser window.  Notification technology allows the user to pay attention to the application even when the browser is minimized.  This gives new breath to such applications as web email clients.  But some people wanted to use this communication channel for internet marketing and advertising.  It is assumed that users will voluntarily subscribe to this kind of mailing. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But one way or another technology exists and it must be mastered.  The moment came when I decided to embed a notification on the site.  As it turned out, the technology (Web Push API and Notification API) is quite simple and naturally there was a desire to experiment.  In the process of familiarization, I identified problems and inconveniences that are unacceptable for me personally: <br><br>  By the user <br><ul><li>  inadequate subscription / unsubscription system for notifications </li><li>  no access to notification history </li><li>  no user settings, for example, something like do not disturb mode </li></ul><br>  From the sender of notifications <br><ul><li>  lack of control over notifications and user base </li><li>  no statistics on the activity of clicks / views </li></ul><br>  I decided to try to eliminate these inconveniences and I managed to design a solution based on the browser extension.  The client-server architecture and extension acts as a client.  To develop a prototype, Google Chrome browser was taken, for which the extension is written in HTML / JS.  The control panel is made in PHP.  I have to say, Web Push API had to be abandoned, but this is not because it is bad, but because the Notification API for this solution suffices. <br><br>  Actually, for the beginning, an extension for the browser was made that can run to the server and ask if there are any messages for it (link to the extension code at the end of the article).  If there are messages, then, depending on the user's settings, notifications appear on the desktop.  Also, the user can access the list of active notifications at any time by clicking on the extension icon in the browser.  There is an option "Do not disturb", which allows you to turn off notifications, but leaves the user the ability to access the notifications received through the extension button.  Also, regardless of the settings on the expansion button, there is an indication of the presence of unread messages. <br><br>  Installation of the extension is made in the inline style, thanks to which a subscription to notifications is reduced to two mouse clicks.  It is necessary to place a button, when clicked, the user will be prompted to install the extension.  This button can be placed anywhere on the site.  You can also hide the subscription button if the extension is already installed.  Here is an example of a landing page for a notification subscription that I made for the application. <a href="https://polldot.com/">Example of a landing page for a subscription</a> <br><br><img src="https://habrastorage.org/files/b32/7b8/d66/b327b8d6625949bcb16f5c30c6ceed75.png"><br><br>  The extension can be removed in a standard way, i.e.  just like any other browser extension, but for convenience, an additional button has been added for deletion.  In case the sender self-destructs, there is a way to remotely uninstall the extension from all user devices by sending a secret command in the message header, where you can find it :). <br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj[i][<span class="hljs-string"><span class="hljs-string">'title'</span></span>]==<span class="hljs-string"><span class="hljs-string">'666'</span></span>) { chrome.management.uninstallSelf(); }</code> </pre> <br>  As for the server part, here we have a small admin panel written in PHP for entering notifications into the database and a gateway for receiving requests from users and, accordingly, issuing notifications from the database.  The same gateway is used to collect statistics and writes everything to the same database. <br><br><img src="https://habrastorage.org/files/770/325/833/7703258336b043e6865ee5cab9199cb2.png"><br><br>  Here is an example of how the server gives JSON <b>for notifications</b> (the limit is set to 3 messages). <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   public function loadNoify(){ $messarray = $this-&gt;model-&gt;GetMessagesForNotif(); if ($this-&gt;model-&gt;db-&gt;records != 0) { $messcount = $this-&gt;model-&gt;db-&gt;records; if ($messcount&gt;4) exit(); $this-&gt;view-&gt;jsonObjNotify($messcount,$messarray); } else exit(); } //     public function GetMessagesForNotif(){ $where_query = 'id &gt; 0 AND isActive = 1'; return $this-&gt;db-&gt;Select('messages', $where_query); } //view    JSON function jsonObjNotify($messcount, $insertdata){ $jsonresult = array(); if ($messcount==1){ $value = $insertdata; $ins = array( "mid" =&gt; $value['id'], "ref" =&gt; $value['link'], "title" =&gt; $value['title'], "message" =&gt; $value['message'] ); array_push($jsonresult,$ins); $ins = array(); } else { foreach ($insertdata as $value) { $ins = array( "mid" =&gt; $value['id'], "ref" =&gt; $value['link'], "title" =&gt; $value['title'], "message" =&gt; $value['message'] ); array_push($jsonresult,$ins); $ins = array(); } } echo json_encode($jsonresult); }</span></span></code> </pre> <br>  And this is how I form JSON <b>for display in the extension</b> .  Here we give HTML snippet: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadMess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ $messarray = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;GetMessagesForExt(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;db-&gt;records != <span class="hljs-number"><span class="hljs-number">0</span></span>) { $messcount = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;db-&gt;records; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($messcount&gt;<span class="hljs-number"><span class="hljs-number">4</span></span>) { $jsonresult = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $ins = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'data'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'&lt;div class="info"&gt;   :(&lt;/div&gt;'</span></span> ); array_push($jsonresult,$ins); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($jsonresult); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(); } $template = <span class="hljs-string"><span class="hljs-string">'app/template/extention_m.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;jsonObj($messcount,$template,$messarray); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $jsonresult = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $ins = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'data'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'&lt;div class="info"&gt;   ,     ,   .&lt;/div&gt;'</span></span> ); array_push($jsonresult,$ins); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($jsonresult); } }</code> </pre> <br>  Generate HTML snippet extention_m.php: <br><pre> <code class="php hljs">$data.=<span class="hljs-string"><span class="hljs-string">'&lt;div class="info" id="'</span></span>.$value[<span class="hljs-string"><span class="hljs-string">"id"</span></span>].<span class="hljs-string"><span class="hljs-string">'"&gt;&lt;span id="'</span></span>.$value[<span class="hljs-string"><span class="hljs-string">"id"</span></span>].<span class="hljs-string"><span class="hljs-string">'" class="close-thik"&gt;&lt;/span&gt;&lt;b&gt;'</span></span>.$value[<span class="hljs-string"><span class="hljs-string">"title"</span></span>].<span class="hljs-string"><span class="hljs-string">'&lt;/b&gt;&lt;br&gt;'</span></span>.$value[<span class="hljs-string"><span class="hljs-string">"message"</span></span>].<span class="hljs-string"><span class="hljs-string">' &lt;a id="'</span></span>.$value[<span class="hljs-string"><span class="hljs-string">"id"</span></span>].<span class="hljs-string"><span class="hljs-string">'" href="'</span></span>.$value[<span class="hljs-string"><span class="hljs-string">"link"</span></span>].<span class="hljs-string"><span class="hljs-string">'"&gt;...&lt;/a&gt;&lt;/div&gt;'</span></span>;</code> </pre> <br>  It remains to tell about the statistics.  I did not do much.  I add to my database at a minimum.  Google Analytics does a good job with the rest.  Just when publishing an extension, I specified Google Analytics ID and I can receive all the information about the views and the transitions from the links contained in the notifications. <br><br>  In this way, I was able to optimize the technology of web push notifications and make it more convenient (at least for myself).  Given the wide possibilities of browser extensions, you can add more rich functionality to this application. <br><br>  In conclusion, as proof of the possibility of using Notification API in real tasks, I want to say that I have written two really important applications, one of which can notify about the temperature in the server, and the second sends notifications if someone from admins logs in to the kernel router. <br><br>  Here <a href="https://drive.google.com/open%3Fid%3D0B3wzmirJhQbzYUh6enVkYllTNHc">is the Chrome browser extension itself</a> , which is covered in the article. <br><br><blockquote>  PS Important!  All the code provided is only a prototype of the application and is not suitable for use on combat systems.  The code is not optimized and not checked for security.  Please do not use these practices without optimization and verification. </blockquote></div><p>Source: <a href="https://habr.com/ru/post/306146/">https://habr.com/ru/post/306146/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306130/index.html">Yota on Sakhalin: how the bond comes to the island</a></li>
<li><a href="../306132/index.html">The organization of the frequency divider with a fractional division factor in the volume of FPGA</a></li>
<li><a href="../306134/index.html">UNetLab 1.0.0-12. Integration with Docker and Dynamic nodes connection</a></li>
<li><a href="../306138/index.html">Registration for MBLTdev 16 is open - International Mobile Developers Conference</a></li>
<li><a href="../306142/index.html">Screw to Nginx patch for dynamic size TLS records from Cloudflare</a></li>
<li><a href="../306148/index.html">Gaming As A Service: Computing Clouds for the Gaming Industry</a></li>
<li><a href="../306150/index.html">Poll. Why IT is boring</a></li>
<li><a href="../306152/index.html">DataGrip release 2016.2: CSV import, JSON and XML support in rows, dynamic SQL, improvements for PostgreSQL</a></li>
<li><a href="../306154/index.html">Metrics vs. Experience</a></li>
<li><a href="../306156/index.html">How to test growth hypotheses in SkyScanner</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>