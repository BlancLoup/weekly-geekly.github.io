<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>AngularJS + UI Router: check authorization and access rights</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If your application involves user authorization and / or access control, then you will have to either reinvent the wheel or google to find the right s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>AngularJS + UI Router: check authorization and access rights</h1><div class="post__text post__text-html js-mediator-article">  If your application involves user authorization and / or access control, then you will have to either reinvent the wheel or google to find the right solution.  Basically, I did it too.  In the end, I accepted the option described below acceptable to me. <br><br><h4>  Prerequisites </h4><br>  I decided to store information about the authorized user in sessionStorage, copying it when the application is started in <code>$rootScope</code> .  Also, as recommended by the authors of the UI Router, I store the <code>$state</code> and <code>$stateParam</code> objects in <code>$stateParam</code> for easy access.  Information about access to a particular state can be transmitted through the <code>data</code> block when describing the state itself.  Since my application is denied access everywhere, I decided to go from the reverse and add the value <code>noLogin = true</code> for states that do not require authorization, such as the login page, password recovery, or registration. <br><a name="habracut"></a><br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'myApp.auth'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'ui.router'</span></span> ]) .config([<span class="hljs-string"><span class="hljs-string">'$stateProvider'</span></span>, <span class="hljs-string"><span class="hljs-string">'$urlRouterProvider'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$stateProvider, $urlRouterProvider</span></span></span><span class="hljs-function">) </span></span>{ $stateProvider .state(<span class="hljs-string"><span class="hljs-string">'auth'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/auth'</span></span>, <span class="hljs-attr"><span class="hljs-attr">abstract</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">template</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;ui-view&gt;'</span></span> }) .state(<span class="hljs-string"><span class="hljs-string">'auth.login'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/login'</span></span>, <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'src/auth/partials/login.html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-string"><span class="hljs-string">'noLogin'</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }); ]);</code> </pre><br><br><h4>  Creating a service for pre-routing </h4><br>  You need to check the authorization and access rights at the very beginning, before the router works, before it sends the visitor to the requested state (it is assumed that you know that the UI Router does not manage the positions, but the states. Read more in the official documentation).  A good way to do this is to hang the listener on the <code>$stateChangeStart</code> event in the run () method of your main module.  In order not to litter with the functionality of the body of the method, which can be voluminous and complex, I brought it to a separate service, in the <code>run()</code> method, I simply call the service method.  I think no further explanation will be needed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'myApp.auth'</span></span>) .service(<span class="hljs-string"><span class="hljs-string">'SessionService'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'$injector'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$injector</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-string"><span class="hljs-string">"use strict"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkAccess = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event, toState, toParams, fromState, fromParams</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $scope = $injector.get(<span class="hljs-string"><span class="hljs-string">'$rootScope'</span></span>), $sessionStorage = $injector.get(<span class="hljs-string"><span class="hljs-string">'$sessionStorage'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (toState.data !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (toState.data.noLogin !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &amp;&amp; toState.data.noLogin) { <span class="hljs-comment"><span class="hljs-comment">//  ,   -  //     } } else { //    if ($sessionStorage.user) { $scope.$root.user = $sessionStorage.user; } else { //     -     event.preventDefault(); $scope.$state.go('auth.login'); } } }; } ]);</span></span></code> </pre><br><br><h4>  Putting it all together </h4><br>  Well, there remains the final touch to make it all work - to hang the listener on the event of the <code>$state</code> service. <br><br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'myApp'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'myApp.auth'</span></span>, <span class="hljs-string"><span class="hljs-string">'ui.router'</span></span>, <span class="hljs-string"><span class="hljs-string">'ngStorage'</span></span> ]) .run([ <span class="hljs-string"><span class="hljs-string">'$rootScope'</span></span>, <span class="hljs-string"><span class="hljs-string">'$state'</span></span>, <span class="hljs-string"><span class="hljs-string">'$stateParams'</span></span>, <span class="hljs-string"><span class="hljs-string">'SessionService'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$rootScope, $state, $stateParams, SessionService</span></span></span><span class="hljs-function">) </span></span>{ $rootScope.$state = $state; $rootScope.$stateParams = $stateParams; $rootScope.user = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      $rootScope.$on('$stateChangeStart', function (event, toState, toParams, fromState, fromParams) { SessionService.checkAccess(event, toState, toParams, fromState, fromParams); } ); } ])</span></span></code> </pre><br><br><h4>  Conclusion </h4><br>  I think this example is quite enough to use it as an idea and write your own authorization and access rights check with any kind of buns.  For example, in the same <code>data</code> block, when describing a state, you can send any RBAC rules and then check them in your service. </div><p>Source: <a href="https://habr.com/ru/post/245049/">https://habr.com/ru/post/245049/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245035/index.html">We master the CC430 - microcontrollers with a radio module: do-it-yourself photo finish</a></li>
<li><a href="../245037/index.html">OpenFlow: current state, prospects, problems</a></li>
<li><a href="../245041/index.html">Do your letters get spammed? Check ip on ban</a></li>
<li><a href="../245043/index.html">We write firmware for Arduino in C ++ with REST control through the serial port and the screen</a></li>
<li><a href="../245047/index.html">We raise the simplified provider network at home</a></li>
<li><a href="../245051/index.html">Hacker's guide to neural networks. Schemes of real values. Strategy # 3: Analytical Gradient</a></li>
<li><a href="../245053/index.html">How to create and earn SaaS | Part 13 | Three steps roaming technology</a></li>
<li><a href="../245057/index.html">About Oracle Coherence in Russian: Why is it needed?</a></li>
<li><a href="../245061/index.html">Career development in Finland: a great interview with Mikhail Samarin</a></li>
<li><a href="../245063/index.html">10 tips for freelancers how to prioritize tasks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>