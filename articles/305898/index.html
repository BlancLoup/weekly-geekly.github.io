<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cache, Hash and Nyash Mesh</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="UPD0 (2016-07-19 23-31): apparently, the first half of my article is a successfully invented bicycle. Thanks to habravchanam for the link to the speci...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cache, Hash and Nyash Mesh</h1><div class="post__text post__text-html js-mediator-article"><p>  <strong>UPD0 (2016-07-19 23-31): apparently, the first half of my article is a successfully invented bicycle.</strong>  <strong>Thanks to habravchanam for the <a href="https://www.w3.org/TR/2016/REC-SRI-20160623/">link to the specification</a></strong> <br>  An article is no more valuable than a free description of an already invented technology. </p><br><h1>  Prehistory </h1><br><p> July Saturday evening was coming to an end.  Chopping wood on a shish kebab, I hung the USB modem on the baguette, commanded <code>sudo wvdial</code> , deployed the browser and updated the tab with the open github.  Rather, I tried to update.  The speed did not please, and as a result the page was refreshed, but some style files were obviously missing;  and it was not about blocking, since I had observed similar problems with other sites, and often they were solved simply by updating the page several times.  The overload of the 3G network was to blame for everything. </p><br><p>  Stop!  But what about the cache? </p><a name="habracut"></a><br><p>  A short googling led <a href="http-caching%3Fhl%3Dru">to the official Google manual</a> .  I will not retell it entirely;  Most likely, the fact was that the browser was diligently waiting for the server to transmit ETags, and the server‚Äôs response was lost in crowded trijungles. </p><br><p>  After a couple of days, returning from the cafe on a stuffy day, I came up with a rationalization proposal that solves this (and several other problems), which I present in this article. </p><br><h1>  The essence of the proposal </h1><br><p>  To add to all tags for connecting <em>subordinate</em> statics (styles, scripts, images) the <code>checksum</code> attribute that would store the hash (for example, SHA-1, as in git) of the required file: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"//habracdn.net/habr/styles/1468852450/_build/topic_form.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"all"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">checksum</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ef4547a3d5731e77f5a1a19e0a6d89915a56cd3a"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br><p>  Having found a similar tag in the body of a web page, the browser looks to see if there is an object with such a hash in the cache, and if so, do <strong>not send any requests at all</strong> : it‚Äôs clear that the file is exactly the one that is required.  It is better to store the files in the browser cache immediately with the names corresponding to their hashes, as the same git does. </p><br><p>  The backward compatibility of the proposed solution is obvious. </p><br><h2>  What problems does this solve? </h2><br><h3>  The notorious guessing game: Is the file in the cache relevant? </h3><br><ul><li>  You no longer need to send a request and compare the received ETags. </li><li>  Even if the file in the cache seems to be outdated, but the hash is the same - you can safely use it. </li><li>  Cleaning the cache as a means of solving problems partially loses its relevance. </li></ul><br><h3>  Dilemma: jQuery from your domain or from a CDN? </h3><br><p>  Small site owners often have to choose: either to connect jQuery and / or similar libraries from a CDN (Google, for example), or from their domain. <br>  In the first case, the site loading time decreases (including the primary one, that is, when a visitor first visits the site) due to the fact that the file from Google‚Äôs servers is more likely to already be in the browser cache.  But, for example, WordPress developers adhere to the second option, focusing on autonomy.  And in conditions when CDNs fall, are blocked, etc., they can be understood. <br>  Now it will be possible to get rid of such a problem forever: does it matter where the file comes from, if its contents are exactly what the html page needs, and does it certify it?  You can safely specify your domain, and if the library is in the cache (no matter downloaded from this site, another ‚Äúsmall‚Äù site or from some CDN), it will pick up. </p><br><h3>  Mixed HTTPS / HTTP Content </h3><br><p>  One of the reasons for prohibiting the download of HTTP resources on HTTPS pages is the possibility of replacing HTTP content.  Now it is no longer a barrier: the browser can get the required content and verify its hash with the hash transmitted via HTTP.  The abolition of the ban on mixed content (with the presence and coincidence of the hash) will speed up the spread of HTTPS. </p><br><h3>  Indirect definition of history by statics loading time </h3><br><p>  It is known that the owner of a certain site <code>evilsite.org</code> can (with some probability) determine whether a visitor was on another site <code>goodsite.org</code> by requesting, for example, an image of <code>goodsite.org/favicon.ico</code> .  If the download time of the icon is negligible, then it is in the cache, therefore, the visitor was on <code>goodsite.org</code> .  Now this attack will become more complicated: the near-zero response time will only mean that the visitor was <em>on the site with the same favicon</em> .  This, of course, does not solve the problem entirely, but it nevertheless somewhat complicates life to the defining one. </p><br><h2>  What does it not affect? </h2><br><ul><li>  On html-pages </li><li>  On images, styles and scripts opened by direct link, and not serving as supporting elements of the page. </li><li>  On images, styles and scripts that are not assumed to be unchanged, for example, when the newest version of some library from the CDN of this library is connected. </li></ul><br><h2>  Ideology </h2><br><p>  As usual (I‚Äôm a mathematician, what can I do here) we formulate the axioms that are put into the sentence: </p><br><ol><li>  <strong>All transferred files are divided into main <em>(mainly html-pages)</em> and subordinate <em>(scripts, images, styles, etc.)</em> .</strong> <br>  In the ideology laid down in the HTTP caching standards, all files are equal.  This, of course, is tolerant, but does not meet modern realities. </li><li>  <strong>It doesn't matter where the subordinate file comes from.</strong>  <strong>It is important that its contents satisfy the needs of the main one.</strong> <br>  In the existing ideology, even the abbreviation URI itself - Uniform Resource Identifier - implies that the resource identifier is its address in the network.  But, alas, for subordinate files this is somewhat untrue. </li></ol><br><h1>  Perspectives </h1><br><h2>  Promised nyash mesh </h2><br><p>  Knowing the hash of the required auxiliary file, you can almost safely request it from anyone;  the main danger is that if the node being polled does indeed have the required file, then it knows its contents and, most likely, at least one URI address at which the required file could (or could) be obtained.  We have two options for using the proposed technology, taking into account this threat in order to ensure a smooth approach to the network mesh network: </p><br><h3>  Trusted devices </h3><br><p>  For example, in the office there are programmers whose computers are integrated into a local network.  Programmer Vasya comes early in the morning, opens the githab and gets into the cache styles from the new design, which is rolled out at night (we have the night, there is the day).  When programmer Petya comes to the office and also downloads the html-code of the gitkhabovskaya page, his computer asks all the computers on the network: "Do you have a file with such and such a hash?"  "Catch!"  - answers Vasina computer, thereby saving traffic. <br>  Then comes a break, Vasya and Peter climb to watch the seals and send photos to each other.  But each cat is downloaded through the office channel only once ... </p><br><h3>  Anonymous shared cache </h3><br><p>  Anya rides a tram from work and reads news ... for example, on Yandex News.  Having met the next <code>&lt;img&gt;</code> , Anin‚Äôs phone from a random MAC address asks everyone he sees: ‚ÄúGuys, and no one has a file with such and such a hash?‚Äù.  If the answer is received in a reasonable time - profit, Anya saved cheap mobile traffic.  It is important to change the MAC address to random and not to ‚Äúyell‚Äù more often when there are too few nodes in the field of view and the questioner can be identified visually. <br>  The reasonable response time is determined based on the cost of traffic. </p><br><h2>  Further transition to nyash-meshu </h2><br><p>  The photo in the social network can be represented as a blob containing the hash and address of the actual image (possibly in several different sizes), as well as a list of comments and likes.  This blob can also be viewed as an auxiliary file, cached and transferred to each other. <br>  Moreover, an album of photos is also easily turned into a blob: a list of image hashes + a list of hashes of photo blobs (the first is necessary for displaying photos immediately when adding a like / comment, and meta-information - as it is received). <br>  It only remains to implement the electronic signature and the fields of the form "replaces the blob of such-and-such" - and the nyash-mesh-sotsialochka is ready. </p><br><h2>  Hash compaction </h2><br><p>  Ideally, when writing a hash, you should not use a hexadecimal number system, but a system with a larger base (since we decided to save traffic).  Another idea is the <code>magnet</code> attribute, which contains a <a href="https://ru.wikipedia.org/wiki/Magnet-%25D1%2581%25D1%2581%25D1%258B%25D0%25BB%25D0%25BA%25D0%25B0">magnet link</a> .  Cheap, angry, standardized and allows you to also specify several classic source addresses, which is important in the case of carpet locks and in cases where the browser knows that traffic to different servers is charged differently. </p><br><h2>  Mismatch behavior </h2><br><p>  It is possible that the hash of the received file did not match the required one.  In this case, it would be reasonable to provide meta-tags that indicate to the browser whether to use such a file (by default - not) and whether to report the incident to the server (by default - not). </p><br><h2>  Alternative files </h2><br><p>  In some cases, you can use any of several files with different hashes.  For example, the site uses minified jQuery, but if there is non-minified in the browser cache - what prevents you from using it? </p><br><h2>  Proactive caching </h2><br><p>  Many devices work in two modes: when the Internet is conditionally unlimited (for example, a mobile phone in a Wi-Fi network) and when the Internet is limited (traffic limit or narrow channel).  Browser or extension to it can, using unlimited connection, pre-download popular libraries (like jQuery and plug-ins to it), as well as they need to be updated.  Isn't it a dream of many for jQuery to be included in the browser? </p><br><h1>  Conclusion </h1><br><p>  The proposed rationalization is important, since the struggle to optimize the download sites is in full swing.  Most of all, small and medium sites will benefit from shared libraries (and maybe some frequently used images) in the cache.  The consumption of traffic by mobile devices will decrease, which is important in view of the limited bandwidth of cellular Internet channels.  Large sites can also reduce the load on their servers if mesh technologies are implemented. <br>  Thus, the support of the proposed technology is beneficial for webmasters, whose websites will load faster, and for browser manufacturers, who will also display pages faster, and for providers, who will decrease the bandwidth consumption (though not so much, but not from active providers). ). </p><br><p>  PS <br>  I would be very pleased to hear from <a href="https://habrahabr.ru/users/mithgol/" class="user_link">Mithgol</a> , <a href="https://habrahabr.ru/users/shpankov/" class="user_link">Shpankov</a> and <a href="https://habrahabr.ru/users/barakadama/" class="user_link">BarakAdama</a> . </p><br><p>  Pps <br>  Habr is omniscient, to which sport lotto send a rational offer? </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/305898/">https://habr.com/ru/post/305898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../305886/index.html">VShBI Lectures: Game Design and Game Operations</a></li>
<li><a href="../305888/index.html">Agile API - is it possible?</a></li>
<li><a href="../305890/index.html">The digest of interesting events from the world of Java, and around it # 6 (07/04/2016 - 07/17/2016)</a></li>
<li><a href="../305892/index.html">Modal windows on Angular, Angular 2 and ReactJS</a></li>
<li><a href="../305894/index.html">JIT compiler optimizes not cool, but very cool</a></li>
<li><a href="../305900/index.html">ES6 humanly</a></li>
<li><a href="../305904/index.html">Haordic Organization Visa (Part 4)</a></li>
<li><a href="../305906/index.html">Increment in php</a></li>
<li><a href="../305908/index.html">"Closer to the people": Does the manager need to understand programming</a></li>
<li><a href="../305910/index.html">The evolution of mobile payments</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>