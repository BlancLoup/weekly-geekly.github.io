<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Advanced Dependency Injection on the example of Ninject</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, we discovered Dependency Injection, understood all its advantages and undoubted benefits, and began to use it in our projects. Let's see what else...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Advanced Dependency Injection on the example of Ninject</h1><div class="post__text post__text-html js-mediator-article">  So, we discovered Dependency Injection, understood all its advantages and undoubted benefits, and began to use it in our projects.  Let's see what else you can do with Dependency Injection using the example of the Ninject library. <br><br>  For the code to work, we need, in addition to Ninject itself, to install three more extensions: Ninject.Extensions.Factory, Ninject.Extensions.Interception and Ninject.Extensions.Interception.DynamicProxy.  These extensions are available in NuGet with the appropriate identifiers. <br><a name="habracut"></a><br><h4>  Factories </h4><br>  Consider a fairly frequent situation.  The project has several repositories that encapsulate the work with the database.  Let it be UserRepository, CustomerRepository, OrderRepository.  In addition, in the business layer there is a class Worker, which accesses these repositories.  We want to weaken dependencies, select interfaces from repositories and resolve dependencies through a DI-container: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Worker</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Worker</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IUserRepository userRepository, ICustomerRepository customerRepository, IOrderRepository orderRepository</span></span></span><span class="hljs-function">)</span></span> { } }</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Already at this stage, an alarming bell starts to ring in my head: aren't there too many dependencies being introduced into the Worker class?  What happens if the Worker has to contact a couple of repositories?  And the future problem is still beginning to emerge: the ‚Äúlittering‚Äù of the working classes with a huge number of injections. <br>  At the same time, we notice that our repositories belong to the same layer, one can even say - to one ‚Äúfamily‚Äù of classes.  (depending on the project, perhaps even all repositories are inherited from the same parent class).  This is a great opportunity to take advantage of the factories mechanism that Ninject provides. <br><br>  So, we create the factory interface: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IRepositoryFactory</span></span> { <span class="hljs-function"><span class="hljs-function">IUserRepository </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateUserRepository</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-function">ICustomerRepository </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateCustomerRepository</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-function">IOrderRepository </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateOrderRepository</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre><br><br>  and write the implementation of this interface in our NinjectModule: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CommonModule</span></span> : <span class="hljs-title"><span class="hljs-title">NinjectModule</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Bind&lt;IUserRepository&gt;().To&lt;UserRepository&gt;(); Bind&lt;ICustomerRepository&gt;().To&lt;CustomerRepository&gt;(); Bind&lt;IOrderRepository&gt;().To&lt;OrderRepository&gt;(); Bind&lt;IRepositoryFactory&gt;().ToFactory(); } }</code> </pre><br><br>  Please note: the class that implements the IRepositoryFactory, we did not create!  Yes, we don‚Äôt need it - Ninject will create it, guided by the following logic: each method of our interface must return a new object of the specified type.  If this type can be resolved through the dependencies specified in NinjectModule, then it will be resolved and created. <br><br>  Implementing a factory allows you to replace several dependencies with one: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Worker</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IRepositoryFactory _repositoryFactory; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Worker</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IRepositoryFactory repositoryFactory</span></span></span><span class="hljs-function">)</span></span> { _repositoryFactory = repositoryFactory; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> customerRepository = _repositoryFactory.CreateCustomerRepository(); } }</code> </pre><br><br>  Here you can see another plus from the use of factories.  With classic dependency resolution, Dependency Injection must go through the entire dependency tree and create all instances of all classes that participate in the dependencies.  In other words, if in an application of 200 classes they use DI, then when trying to get an instance of a class that is at the top of the dependency tree, 200 instances of the other classes will be created, even if 10 are used in the current scenario 10. The factory supports lazy loading, that is .  in the example above, an instance of <b>only a</b> CustomerRepository will be created and <b>only</b> when calling the Test method. <br><br>  In addition to reducing the number of dependencies, the factory allows you to conveniently work with the parameters of the designers during the injection through the designer.  Add the userName parameter to the UserRepository constructor: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UserRepository</span></span> : <span class="hljs-title"><span class="hljs-title">IUserRepository</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserRepository</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userName</span></span></span><span class="hljs-function">)</span></span> { } }</code> </pre><br><br>  and modify the factory interface: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IRepositoryFactory</span></span> { <span class="hljs-function"><span class="hljs-function">IUserRepository </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateUserRepository</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userName</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">ICustomerRepository </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateCustomerRepository</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-function">IOrderRepository </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateOrderRepository</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre><br><br>  Now, when we call the repository, we can easily pass the parameter to the constructor: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Worker</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IRepositoryFactory _repositoryFactory; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Worker</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IRepositoryFactory repositoryFactory</span></span></span><span class="hljs-function">)</span></span> { _repositoryFactory = repositoryFactory; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestUser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userRepository = _repositoryFactory.CreateUserRepository(<span class="hljs-string"><span class="hljs-string">"testUser"</span></span>); } }</code> </pre><br><br><h4>  Aspects </h4><br>  Ninject allows you to embed not only injections into data types, but also to add additional functionality to the methods, that is, to introduce aspects.  Consider this, again, a fairly frequent example.  Suppose we want to enable automatic logging for some of our methods.  Create a log class and highlight the interface: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ILogger</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Log</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Exception ex</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Logger</span></span> : <span class="hljs-title"><span class="hljs-title">ILogger</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Log</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Exception ex</span></span></span><span class="hljs-function">)</span></span> { Console.WriteLine(ex.Message); } }</code> </pre><br><br>  Now we will specify how exactly we will modify the necessary methods.  To do this, we need to implement the IInterceptor interface: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ExceptionInterceptor</span></span> : <span class="hljs-title"><span class="hljs-title">IInterceptor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ILogger _logger; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExceptionInterceptor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ILogger logger</span></span></span><span class="hljs-function">)</span></span> { _logger = logger; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Intercept</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IInvocation invocation</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { invocation.Proceed(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { _logger.Log(ex); } } }</code> </pre><br><br>  Of course, this is an incomplete log, an exception here, in violation of all canons, is not forwarded further down the stack, but tritely ‚Äúswallowed‚Äù.  But for an illustration fit. <br><br>  The idea here is that the direct method call occurs during invocation.Processed.  So, we can add any functionality before and after calling this method.  What we are doing is framing the method call in try / catch and putting an exception (if it happens) to some log. <br><br>  You can enable Intercept for the desired method / methods in several ways, the simplest and most elegant of which is to mark the method with a special attribute.  Let's create this attribute.  It should be inherited from the InterceptAttribute and specify which Intercept to use. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogExceptionAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">InterceptAttribute</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IInterceptor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateInterceptor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IProxyRequest request</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.Context.Kernel.Get&lt;ExceptionInterceptor&gt;(); } }</code> </pre><br><br>  Finally, we mark our attribute with the desired virtual method.  Naturally, if the method is non-virtual, no Interception will occur, because  Ninject uses the banal mechanism of inheritance and creating a proxy class with overridden methods: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Worker</span></span> { [LogException] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"test exception"</span></span>); } }</code> </pre><br><br>  In our example, the exception will be intercepted and output to the console.  At the same time, since we introduced the logger class to our Interception again through dependency injection, our working class doesn‚Äôt even ‚Äúguess‚Äù about the existence of some loggers and other auxiliary tools.  Everything that the aspect implementation introduces in it is the LogException attribute. <br>  At the same time, in our NinjectModule there is dependency resolution only for the ILogger, since we again specified the resolution for the ExceptionInterceptor in the LogExceptionAttribute: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CommonModule</span></span> : <span class="hljs-title"><span class="hljs-title">NinjectModule</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Bind&lt;ILogger&gt;().To&lt;Logger&gt;(); } }</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/235995/">https://habr.com/ru/post/235995/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../235983/index.html">RabbitMQ - Deferred messages, part 2</a></li>
<li><a href="../235987/index.html">"IT-galaxy" will be held September 25 in Moscow</a></li>
<li><a href="../235989/index.html">Whistler 118ST Ru radar detector: tested on the roads</a></li>
<li><a href="../235991/index.html">Autonomous soft robot slider carries 3 kg of cargo</a></li>
<li><a href="../235993/index.html">Overview of the most interesting materials on data analysis and machine learning ‚Ññ12 (September 1 - 8, 2014)</a></li>
<li><a href="../235997/index.html">What threatens the business process engine programmer on the example of Apache Activiti</a></li>
<li><a href="../235999/index.html">Moscow, September 18, Intel Software 2014</a></li>
<li><a href="../236001/index.html">How to make control equipment for an aircraft simulator</a></li>
<li><a href="../236003/index.html">Accelerator QIWI Universe. Start</a></li>
<li><a href="../236005/index.html">The history of the evolution of the office</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>