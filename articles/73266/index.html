<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>REPL WebPart for SharePoint</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Intro 
  Today I will talk about the prototype of the first component under the Sapphire label. This is a REPL WebPart. This web part is intended for ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>REPL WebPart for SharePoint</h1><div class="post__text post__text-html js-mediator-article"><h4>  Intro </h4><br> <a href="http://github.com/butaji/Sapphire"><img title="logo" src="https://habrastorage.org/getpro/habr/post_images/dfe/172/43d/dfe17243d2eb320abc6543637315212a.png" alt="logo" width="240" height="80" align="right"></a>  Today I will talk about the prototype of the first component under the Sapphire label.  This is a REPL WebPart.  This web part is intended for making operational changes on the server side of SharePoint, as well as for remote execution of scripts and testing of some pieces of code. <br><br><h4>  PreBody </h4><br>  The production of this web part was initiated in the rather frequent requirements of executing server code with sufficient efficiency, in the inaccessibility of development tools at hand. <br>  Here is a small prezentnatsiya, in which I tried to display the principles of the Repl WebPart: <a title="Sapphire Environment Repl WebPart" href="http://www.slideshare.net/butaji/sapphire-environment-repl-webpart">Sapphire Environment Repl WebPart</a> <br>  In addition to the slides, I‚Äôll tell you that the web part is a classic hosting of Dynamic Languages ‚Äã‚ÄãRuntime languages, of which only Python is available. <br><a name="habracut"></a><br><h4>  Body </h4><br>  Then I wanted to talk about how I did it all, so the project includes several basic modules: <br><ul><li>  Web part and view controls </li><li>  Language Hosting </li></ul><br>  More about them in more detail <br><br><h4>  Language Hosting </h4><br>  Due to the fact that the languages ‚Äã‚Äãthat I want to implement in this project is an unlimited set, then of course I need an abstract factory to create them, which will hide the hierarchy of all available languages ‚Äã‚Äãand encapsulate them under the interface: <br>  <font color="#0000ff">public</font> <font color="#0000ff">interface</font> ILanguagesFactory <br>  <font color="#0000ff">{</font> <br>  ILanguage Create ( <font color="#2b91af">string</font> name); <br>  <font color="#0000ff">}</font> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <font color="#0000ff">public</font> <font color="#0000ff">interface</font> ILanguage <br>  <font color="#0000ff">{</font> <br>  <font color="#2b91af">string</font> Name <font color="#0000ff">{</font> <font color="#0000ff">get</font> ;  <font color="#0000ff">}</font> <br><br>  <font color="#2b91af">object</font> Execute ( <font color="#2b91af">string</font> input); <br><br>  <font color="#0000ff">void</font> SetVar ( <font color="#2b91af">string</font> name, <font color="#2b91af">object</font> <font color="#0000ff">value</font> ); <br><br>  <font color="#2b91af">object</font> GetVar ( <font color="#2b91af">string</font> name); <br>  <font color="#0000ff">}</font> <br><br><br>  Great, then the assemblies necessary for the implementation of scripting languages ‚Äã‚Äãjoin our project: <br><ul><li>  <a href="">Ironpython.dll</a> </li><li>  <a href="">Microsoft.Dynamic.dll</a> </li><li>  <a href="">Microsoft.Scripting.Core.dll</a> </li><li>  <a href="">Microsoft.Scripting.ExtensionAttribute.dll</a> </li><li>  <a href="">Microsoft.Scripting.dll</a> </li></ul><br>  Everything is ready to implement Python, as an environment for executing code, great, let's start: <br>  <font color="#0000ff">public</font> <font color="#0000ff">class</font> <font color="#2b91af">PythonLanguage</font> : ILanguage <br>  <font color="#0000ff">{</font> <br>  <font color="#0000ff">private</font> <font color="#0000ff">readonly</font> ScriptScope _scope; <br><br>  <font color="#0000ff">public</font> <font color="#2b91af">string</font> Name <br>  <font color="#0000ff">{</font> <br>  <font color="#0000ff">get</font> <font color="#0000ff">{</font> <font color="#0000ff">return</font> <font color="#a31515">"Python"</font> ;  <font color="#0000ff">}</font> <br>  <font color="#0000ff">}</font> <br><br>  <font color="#0000ff">public</font> PythonLanguage () <br>  <font color="#0000ff">{</font> <br>  _scope = Python.CreateEngine (). CreateScope (); <br>  <font color="#0000ff">}</font> <br><br>  <font color="#0000ff">public</font> <font color="#2b91af">object</font> Execute ( <font color="#2b91af">string</font> input) <br>  <font color="#0000ff">{</font> <br>  ScriptSource source = _scope.Engine.CreateScriptSourceFromString (input); <br>  <font color="#0000ff">return</font> source.Execute (_scope); <br>  <font color="#0000ff">}</font> <br>  <font color="#0000ff">}</font> <br><br><br>  Next, let's complicate the task a bit, due to the fact that we will need to implement a context for working with SharePoint, it should look something like this: <br>  [Test] <br>  <font color="#0000ff">private</font> <font color="#0000ff">void</font> python_should_assume_sharepoint_variables () <br>  <font color="#0000ff">{</font> <br>  SPWeb fakeWeb = Isolate.Fake.Instance &lt;SPWeb&gt; (); <br>  Isolate.WhenCalled (() =&gt; fakeWeb.Title) .WillReturn ( <font color="#a31515">"I'm fake web"</font> ); <br>  var python = _factory.Create ( <font color="#a31515">"Python"</font> ); <br>  python.SetVar ( <font color="#a31515">"__x__"</font> , <font color="#a31515">"123"</font> ); <br>  python.SetVar ( <font color="#a31515">"__web__"</font> , fakeWeb); <br>  python.Execute ( <font color="#a31515">"__x__ = __web __. Title"</font> ); <br>  var x = ( <font color="#2b91af">string</font> ) python.GetVar ( <font color="#a31515">"__x__"</font> ); <br>  Assert.AreEqual (x, <font color="#a31515">"I'm fake web"</font> ); <br>  <font color="#0000ff">}</font> <br><br><br>  To work with SharePoint objects in from IronPython, we need to add several libraries: <br>  _scope.Engine.Runtime.LoadAssembly ( <font color="#0000ff">typeof</font> ( <font color="#2b91af">string</font> ) .Assembly); <br>  _scope.Engine.Runtime.LoadAssembly ( <font color="#0000ff">typeof</font> (Uri) .Assembly); <br>  _scope.Engine.Runtime.LoadAssembly ( <font color="#0000ff">typeof</font> (SPList) .Assembly); <br><br><br>  This will be the basis of our work with dynamic languages. <br><br><h4>  WebPart + WebControls </h4><br>  Let's create a project using SPVisualDev, add a feature to it, inside which we will create a Repl WebPart web part, all other actions are standard, however there is a small nuance, we will need an object with which we can output string values ‚Äã‚Äãafter execution.  I decided to create an object with the classic name Console for these purposes, its implementation is extremely simple: <br>  <font color="#0000ff">public</font> <font color="#0000ff">class</font> <font color="#2b91af">Console</font> <br>  <font color="#0000ff">{</font> <br>  <font color="#0000ff">private</font> <font color="#0000ff">readonly</font> StringBuilder _messageBuilder = <font color="#0000ff">new</font> StringBuilder (); <br><br>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> Write ( <font color="#2b91af">object</font> message) <br>  <font color="#0000ff">{</font> <br>  _messageBuilder.Append (message); <br>  <font color="#0000ff">}</font> <br><br>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> WriteLine ( <font color="#2b91af">object</font> message) <br>  <font color="#0000ff">{</font> <br>  _messageBuilder.AppendLine (message.ToString ()); <br>  <font color="#0000ff">}</font> <br><br>  <font color="#0000ff">public</font> <font color="#2b91af">string</font> Message <br>  <font color="#0000ff">{</font> <br>  <font color="#0000ff">get</font> <br>  <font color="#0000ff">{</font> <br>  <font color="#0000ff">return</font> _messageBuilder.ToString (); <br>  <font color="#0000ff">}</font> <br>  <font color="#0000ff">}</font> <br>  <font color="#0000ff">}</font> <br><br><br>  We will transmit it to the language execution environment, and after the execution of the code, poll its Message property and display its content in our web part. <br><br><h4>  Endody </h4><br>  All project sources are available on github: <a href="http://github.com/butaji/Sapphire">http://github.com/butaji/Sapphire</a> <br>  The same preliminary version of Sapphire.Environment (solution supplied in WSP) can be merged onto CodePlex: <a href="http://sapphire.codeplex.com/Release/ProjectReleases.aspx%3FReleaseId%3D34895">http://sapphire.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=34895</a> </div><p>Source: <a href="https://habr.com/ru/post/73266/">https://habr.com/ru/post/73266/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../73255/index.html">Troll Control</a></li>
<li><a href="../73257/index.html">Gateway + Shaper for Ubuntu's Home Network</a></li>
<li><a href="../73258/index.html">Configuration Management</a></li>
<li><a href="../73263/index.html">One step to the perfect team</a></li>
<li><a href="../73265/index.html">Daos. New advertising engine for sites</a></li>
<li><a href="../73268/index.html">Create an image of Windows XP SP3 for deployment over the network via WDS</a></li>
<li><a href="../73269/index.html">Are you already on Google Wave?</a></li>
<li><a href="../73272/index.html">Autorun ASP.NET applications</a></li>
<li><a href="../73273/index.html">Build Zend Framework</a></li>
<li><a href="../73275/index.html">The fundamental difference between Russian Wikipedia and English</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>