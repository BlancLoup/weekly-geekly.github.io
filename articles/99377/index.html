<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SSH access organization by one-time passwords</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In any serious company, it is sometimes necessary that an employee who has gone on vacation urgently fulfill his official duties. Consider a situation...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SSH access organization by one-time passwords</h1><div class="post__text post__text-html js-mediator-article"> In any serious company, it is sometimes necessary that an employee who has gone on vacation urgently fulfill his official duties.  Consider a situation where a company needs a specific employee, for example, a system administrator who is currently reclining on the beach a thousand kilometers away from the stuffy office.  Let us even assume that this employee agrees to do the work unexpectedly dropped on his head and there is an internet cafe at the resort.  But here‚Äôs the problem: the cafe is located in a dark alley, on its computers are popular OS, Trojans, keyloggers and other haktulzy, so typing the root password from the company's main server on such machines is rather unwise. <br><br>  There are several solutions to this problem.  For example, one-time passwords can be used, namely the s / key system, using the md4 and md5 algorithms for generating passwords.  About this system and will be discussed below. <br><a name="habracut"></a><br>  S / key works on the client-server principle as follows: the user sets a secret key, which is then hashed hundreds of times (eg, 500).  The last (500th) hash of the secret phrase is remembered on the user's computer (server).  For <br>  authorization, the user will need to enter the previous (499th) hash of the secret key that will be generated by the client application.  The server hashes the combination entered by the user and, in case of coincidence with the previously stored data, authorizes the user and remembers the just entered (499th) hash, so that the next time to ask the previous (498th) to the current hash. <br><br>  You can read more about s / key on <a href="http://ru.wikipedia.org/wiki/S/Key">Wikipedia</a> and <a href="http://tools.ietf.org/html/rfc1760">RFC 1760</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We proceed to practice.  We will use PAM (a set of API for user authentication) and OPIE (PAM-module for working with one-time passwords).  It is assumed that SSH is already installed. <br><br>  Install OPIE: <br> <code>$ apt-get install opie-client opie-server</code> <br> <br>  Then you need to edit the configuration files: <br><br>  In the <b>/etc/pam.d/sshd file</b> you need to comment out the line " <i>@include common-auth</i> ": <br> <code>#@include common-auth</code> <br>  and add the following after it: <br> <code>auth sufficient pam_unix.so <br> auth sufficient pam_opie.so <br> auth required pam_deny.so</code> <br> <br>  The first line leaves the possibility of authorization by the password from the account.  If this is not required, then it can be removed. <br><br>  More information about configuring PAM can be read <a href="http://www.ibm.com/developerworks/ru/library/l-pam/index.html">here</a> and <a href="http://alexustes.dev.juga.ru/pam/article.html">here</a> . <br><br>  Next, edit <b>/ etc / ssh / sshd_config</b> - in the line " <i>ChallengeResponseAuthentication no</i> " <i>no</i> need to be changed to <i>yes</i> . <br><br>  Now restart ssh: <br> <code>$ service ssh restart</code> <br> <br>  OPIE data is stored in the <b>/ etc / opiekeys file</b> , which has the following format: <br><br>  Field Description <br>  name User login. <br>  sequence The sequence number of the hash. <br>  seed A seed is an unclassified random sequence. <br>  key Last used hash. <br>  date Date of last change. <br>  time The time of the last change. <br><br>  Initially this file is empty.  To set the initial data (generating the 500th hash), run the <i>opiepasswd</i> command: <br> <code>$ opiepasswd <br> Adding username: <br> You need the response from an OTP generator. <br> New secret pass phrase: <br> otp-md5 499 no8327 <br> Response:</code> <br> <br>  To get the requested response (Response), open the second console and run the command <i>otp-md5 499 no8327</i> : <br> <code>$ otp-md5 499 no8327 <br> Using the MD5 algorithm to compute response. <br> Reminder: Don't use opiekey from telnet or dial-in sessions. <br> Enter secret pass phrase:</code> <br> <br>  We invent and enter the password.  In response, we see something similar to WATS NIP DUD BRAD LIME DRUM. <br><br>  Pleasant moment: sometimes one-time passwords consist of short English words that are fairly easy to remember.  We return to the previous console to the opiepasswd application and enter the sequence given to us (WATS NIP DUD BRAD LIME DRUM).  In capital letters and with spaces.  According to experts, you can enter in small letters, but the author did not check this. <br><br> <code>$ opiepasswd <br> Adding username: <br> You need the response from an OTP generator. <br> New secret pass phrase: ********* <br> otp-md5 499 no8327 <br> Response: WATS NIP DUD BRAD LIME DRUM <br> <br> ID username OTP key is 499 no8327 <br> WATS NIP DUD BRAD LIME DRUM <br> $</code> <br> <br>  If you now open the <b>/ etc / opiekeys file</b> , you can see a line similar to <br> <code>username 0499 no8327 f825803faf1afaee Jul 10,2010 20:12:12</code> <br> <br>  When you go on vacation, you can take along a list of pre-generated one-time passwords.  You can get this list by running <i>opiekey -n 100 499 no8327</i> .  We will be asked for a secret phrase, and in response we will receive a list of 100 (the number is specified by the <i>-n</i> 100 key) one-time passwords of the form <br><br>  ... <br>  480: SLUR ROVE TONE ADAM MUST IRK <br>  481: FULL NAY LYLE BROW MARY COD <br>  482: WERE LOB DOME LIT GIN CHAD <br>  ... <br><br>  Sheet with passwords can be hidden deeper in a suitcase or copied to your phone as a simple text file.  At the end of this article, a more convenient and secure way to retrieve / store one-time passwords will be considered. <br><br>  Let's return to our SSH access: <br><br> <code>$ ssh username@host <br> Password:</code> <br> <br>  To authorize using a one-time password to request a password from your account, you must enter the password " <i>opiepasswd</i> ", after which you will be asked one-time password: <br><br> <code>$ ssh username@host <br> Password: opiepasswd <br> otp-md5 498 no8327 ext, Response:</code> <br> <br>  In response, we introduce a sequence that can be obtained by running <br> <code>$ otp-md5 498 no8327</code> <br>  or <br> <code>$ opiekey 498 no8327</code> <br> <br>  In fact, you can generate a response on any computer using any s / key generator instead of otp-md5 or opiekey. <br><br>  <b>If done correctly, we will get ssh-access.</b> <br><br>  Let's return to our legend about vacation.  Few in which Internet cafes can you find an ssh client.  As a solution to this problem, you can use the ssh client as a java applet.  Unfortunately, not all ssh clients are <s>equally useful as</s> supporting s / key.  The author of this article met only one working as it should applet: JCTerm from <a href="http://www.jcraft.com/jcterm/">Jcraft, Inc.</a>  The source code is available on the developer‚Äôs site.  The applet can be experienced <a href="http://wiredx.net/jcterm/">here</a> . <br><br>  Concluding the article, it is worth mentioning the open source java2me application OneTimePassword, available at <a href="http://sourceforge.net/projects/otp-j2me/">sourceforge.net/projects/otp-j2me</a> .  Having downloaded it to your mobile phone, you can safely go on vacation, without worrying about the safety of a sheet of one-time passwords that you no longer need - OneTimePassword will easily generate them. <br><br>  Happy holidays! <br><br>  When writing the article materials from the following sites were used: <br><br>  - <a href="http://ru.wikipedia.org/wiki/S/Key">en.wikipedia.org/wiki/S/Key</a> <br>  - <a href="http://tools.ietf.org/html/rfc1760">tools.ietf.org/html/rfc1760</a> <br>  - <a href="http://www.delta-xi.net/index.php%3F/archives/16-OTPs-Using-sKey-with-SSH-via-OPIE.html">www.delta-xi.net/index.php?/archives/16-OTPs-Using-sKey-with-SSH-via-OPIE.html</a> <br>  - <a href="http://blog.bogosity.se/2008/05/31/debian-ubuntu-skey-and-opie/">blog.bogosity.se/2008/05/31/debian-ubuntu-skey-and-opie</a> <br>  - <a href="http://www.opennet.ru/cgi-bin/opennet/man.cgi%3Ftopic%3Dopiekeys%26category%3D5">www.opennet.ru/cgi-bin/opennet/man.cgi?topic=opiekeys&amp;category=5</a> <br>  - <a href="http://alexustes.dev.juga.ru/pam/article.html">alexustes.dev.juga.ru/pam/article.html</a> <br>  - <a href="http://www.ibm.com/developerworks/ru/library/l-pam/index.html">www.ibm.com/developerworks/ru/library/l-pam/index.html</a> <br>  - <a href="http://sourceforge.net/projects/otp-j2me/">sourceforge.net/projects/otp-j2me</a> <br>  - <a href="http://www.jcraft.com/jcterm/">www.jcraft.com/jcterm</a> <br>  - <a href="http://wiredx.net/jcterm/">wiredx.net/jcterm</a> </div><p>Source: <a href="https://habr.com/ru/post/99377/">https://habr.com/ru/post/99377/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../99369/index.html">Overview of the Chinese UMPC Gome FlyTouch</a></li>
<li><a href="../99371/index.html">We create PivotViewer site content in 10 minutes using the example of Habrahabr</a></li>
<li><a href="../99373/index.html">Making lines of multiple parts</a></li>
<li><a href="../99375/index.html">Facts and Errors of Professional Programming</a></li>
<li><a href="../99376/index.html">RSA, is it really that simple?</a></li>
<li><a href="../99380/index.html">The first 100 GB Blu-ray discs coming soon</a></li>
<li><a href="../99385/index.html">Two stories about bank cards</a></li>
<li><a href="../99387/index.html">A detailed review of Alien Swarm - free cooperative shooter from Valve</a></li>
<li><a href="../99388/index.html">Canon DM-2400CR. Electronic Notebook. Dreams of the nineties</a></li>
<li><a href="../99389/index.html">US Army Tests HULC Robotic Exoskeleton</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>