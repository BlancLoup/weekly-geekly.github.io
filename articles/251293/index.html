<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What bugs did LibreOffce find in PVS-Studio?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Usually we check a project with PVS-Studio. This time it was different. We checked PVS-Studio with the help of LibreOffice. And then they could and vi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What bugs did LibreOffce find in PVS-Studio?</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b1/6f9/a5c/3b16f9a5c93c57796505c71aab909059.png"></div><br><br>  Usually we check a project with PVS-Studio.  This time it was different.  We checked PVS-Studio with the help of LibreOffice.  And then they could and vice versa check. <br><br><h2>  Introduction </h2><br>  Articles about project audits evoke a very different reaction from readers: from ‚ÄúHow much can you advertise this?‚Äù To ‚ÄúThank you so much!  PVS-Studio is really a great tool. ‚ÄùTo be fair, I want to say that advertising specialists are not involved in the verification of the project, only the PVS-Studio developers and the translator are making efforts.  The contribution of the analyzer to open source, of course there is not a small one.  Developers are not always interested in feedback, but the verification letter is received and errors found are corrected.  Using the example of the LibreOffice project, an article about which will also be available soon, I want to tell you about the impact of project checks on the analyzer itself and about the work done. <br><a name="habracut"></a><br><h2>  About the analyzer </h2><br>  <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> is a static analyzer that detects errors in the source code of C / C ++ applications.  The possibilities of application and integration of the analyzer are constantly expanding and, besides the demonstration of opportunities, open-source projects are impartial testers for the analyzer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The <a href="http://www.viva64.com/go.php%3Furl%3D1505">LibreOffice</a> project turned out to be a good test for a static analyzer and made each of the PVS-Studio team work. <br><br>  I'll tell you about the problems that we encountered during the test. <br><br><h2>  Memory leak </h2><br>  LibreOffice is built using MS Visual C ++ 2013 in Cygwin.  The PVS-Studio Standalone utility has relatively recently acquired the ability to check any projects, without going into the details of the build system, simply turn on ‚ÄúCompiler Monitoring‚Äù and run the build project.  Read more about this feature in the article: <a href="http://www.viva64.com/ru/b/0243/">PVS-Studio now supports any build system on Windows and any compiler.</a>  <a href="http://www.viva64.com/ru/b/0243/">Easy and out of the box</a> .  In short, from the running processes in Windows, the information needed to start the process in the same environment is extracted.  So, for storing the launch string, current directory, environment variables, etc.  allocated a few hundred kilobytes of unmanaged memory.  If the process belongs to a supported compiler, then the information was copied into managed memory, unmanaged memory was released anyway, BUT, for environment variables, as it turned out, this was not done.  For each process, an average of 500 kilobytes was not released.  This did not lead to serious problems on the projects that were checked before (at least we did not notice that something was wrong and the users did not complain).  Building LibreOffice by Make is accompanied by a huge number of processes that are not related to the compiler.  In a few hours of assembly, more than one hundred thousand processes were launched, with 25 gigabytes in the end.  After correcting this place, the size of the memory used by the monitoring program was reduced to 1.8 GB. <br><br><h2>  Long check </h2><br>  The entire build process, including the compilation of libraries, contained 12,245 source code files.  Unfortunately, the process of checking such a number of files took about 15 hours, so some optimizations were carried out in the analyzer core, which allowed the project to double-check in 9 hours.  This is 2 times more than the project build time, but this is already quite adequate and acceptable speed of work. <br><br><h2>  Complexity of the analysis </h2><br>  If the analyzer fails to parse any constructs in the source code, then it issues V001 messages to this file.  This section of code is skipped by the analyzer and in very rare cases affects the results of the check.  However, the V001 messages on this project have been studied and corrected. <br><br><h2>  Old ways format </h2><br>  When checking the project, system paths were found in the old format, for example, ‚ÄúC: /PROGRA~2/MICROS~4.0/VC/include‚Äù.  This format is fully supported by the analyzer's core and plug-in, but filtering messages on system files did not work, so the appropriate changes were made. <br><br><h2>  Failed serialization </h2><br>  This problem does not quite relate to the products of PVS-Studio.  In the PVS-Studio Standalone utility, in which LibreOffice was tested, file navigation has recently been improved, which now allows you to navigate through included headers and search for types and variables in dependent files.  All dependencies are collected during the scan and saved near the * .plog file.  Unfortunately, the standard class System.Runtime.Serialization.Formatters.Binary.BinaryFormatter cannot serialize large-volume structures ‚Äî an internal exception occurs, so the <a href="https://code.google.com/p/protobuf/">Protocol Buffers</a> library is now used, which does an excellent job with the same task. <br><br><h2>  Conclusion </h2><br>  The result of the LibreOffice check was an article that is designed to make one more open-source project better, and good edits in PVS-Studio products.  An article about an error found in LibreOffice will be published in the coming days.  And we want to say thanks to the project LibreOffice, which helped us make our analyzer better! <br><br><h2>  Additional links </h2><br><ol><li>  <a href="http://www.viva64.com/ru/b/0243/">PVS-Studio now supports any build system on Windows and any compiler.</a>  <a href="http://www.viva64.com/ru/b/0243/">Easy and out of the box</a> </li><li>  <a href="http://www.viva64.com/ru/b/0289/">New mechanism to suppress unnecessary messages analyzer</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/251293/">https://habr.com/ru/post/251293/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251277/index.html">Static JavaScript analyzers and errors that they can help you to unlearn (Part 1)</a></li>
<li><a href="../251283/index.html">BattleGIS - JavaScript engine for playing Tanchiki</a></li>
<li><a href="../251285/index.html">Overview of Microsoft Azure platform updates for February</a></li>
<li><a href="../251289/index.html">Corporate and unincorporated IaaS: how not to get lost in the cloud market</a></li>
<li><a href="../251291/index.html">Data Owners - Thoughts on, Pros and Cons</a></li>
<li><a href="../251295/index.html">Data compression methods</a></li>
<li><a href="../251297/index.html">Ekspozzer - creating a panorama from a video, averaging a video stream</a></li>
<li><a href="../251299/index.html">Lamp showing the weather forecast</a></li>
<li><a href="../251301/index.html">Administration of computers on the local network before loading the operating system</a></li>
<li><a href="../251303/index.html">16 months of functional programming</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>