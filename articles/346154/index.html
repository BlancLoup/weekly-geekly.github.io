<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simplify ReactJS Components with RxJs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Most likely, many people, having tried these 2 libraries sufficiently, thought about how to use them together productively. RxJs in its...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simplify ReactJS Components with RxJs</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  Most likely, many people, having tried these 2 libraries sufficiently, thought about how to use them together productively.  RxJs in itself does not shine with simplicity - a lot of functions, definitely, repel beginners.  However, having studied and accepted it, we get a very flexible tool for working with asynchronous code. <br><br>  I mean that by reading this post, you know ReactJS well, and at least represent the essence of RxJs.  I will not use Redux in the examples, but everything that will be written below is perfectly projected onto the React + Redux bundle. <br><a name="habracut"></a><br><h2>  Motivation </h2><br>  We have a component that should produce some asynchronous / heavy actions (let's call them ‚Äúrecalculation‚Äù) over its <code>props</code> and display the result of their execution.  In general, we have 3 types of <code>props</code> : <br><br><ol><li>  Parameters for changing which we need to recalculate and render </li><li>  Parameters for changing which we must use the value of the previous recalculation and render </li><li>  Parameters which change does not require any recalculation or rendering, however, they will affect the next recalculation </li></ol><br>  It is very important that we do not make unnecessary movements and recalculate and render only when necessary.  For example, consider a component that, using the passed parameter, counts and displays the Fibonacci number.  It has the following input: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  <code>className</code> - css class that should be hung on the root element (type 2) </li><li>  <code>value</code> - the number according to which is used for calculations (1st type) </li><li>  <code>useServerCall</code> - the parameter that allows you to calculate by means of a request to the server, or locally (type 3) </li></ol><br><div class="spoiler">  <b class="spoiler_title">Component example</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PropTypes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'prop-types'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> classnames <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'classnames'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//,     Promise import calculateFibonacciExternal from './calculateFibonacci'; export default class Fibonacci extends React.Component { //  ,   static propTypes = { className: PropTypes.string, value: PropTypes.number.isRequired, useServerCall: PropTypes.bool.isRequired, }; //  .      //  state = { loading: true, fibonacci: null, }; //    componentWillMount() { //       -   // ,    this.calculateFibonacci(this.props.value, this.props.useServerCall, (fibonacci) =&gt; { this.setState({ fibonacci: fibonacci, loading: false, }); }); } //   props componentWillReceiveProps(nextProps) { //  value -   if(nextProps.value !== this.props.value) { this.setState({ loading: true, }); this.calculateFibonacci(nextProps.value, nextProps.useServerCall, (fibonacci) =&gt; { this.setState({ fibonacci: fibonacci, loading: false, }); }); } } //    shouldComponentUpdate(nextProps, nextState) { //      ,   useServerCall return this.props.className !== nextProps.className || this.props.value !== nextProps.value || this.state.loading !== nextState.loading || this.state.fibonacci !== nextState.fibonacci; } // ,          //  ,     componentWillUnmount() { this.unmounted = true; } unmounted = false; calculationId = 0; //      ,   //     calculateFibonacci = (value, useServerCall, cb) =&gt; { const currentCalculationId = ++this.calculationId; calculateFibonacciExternal(value, useServerCall).then(fibonacci =&gt; { if(currentCalculationId === this.calculationId &amp;&amp; !this.unmounted) { cb(fibonacci); } }); }; //    render() { return ( &lt;div className={ classnames(this.props.className, this.state.loading &amp;&amp; 'loading') }&gt; { this.state.loading ? 'Loading...' : `Fibonacci of ${this.props.value} = ${this.state.fibonacci}` } &lt;/div&gt; ); } }</span></span></code> </pre><br></div></div><br>  It turned out as difficult: the whole code is spread over the 4th methods of the component life cycle, where it looks related, comparing with the previous states, it is easy to forget or break something when updating.  Let's try to make this code better. <br><br><h2>  Introducing <a href="https://github.com/DontRelaX/react-rx-props">react-rx-props</a> </h2><br>  I wrote this small library in order to make the solution of this issue in a more concise way.  It consists of two higher order components (HoC, Higher Order Component): <br><br><ol><li>  <code>reactRxProps</code> - converts incoming <code>props</code> (with some exceptions) into Observables and sends them to your component </li><li>  <code>reactRxPropsConnect</code> - takes the logic of working with Observables from your component, allowing you to make it without an internal state (stateless) </li></ol><br>  Using the first HoC, we get: <br><br><div class="spoiler">  <b class="spoiler_title">Sample component using reactRxProps</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PropTypes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'prop-types'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> classnames <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'classnames'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { reactRxProps } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-rx-props'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> calculateFibonacciExternal <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./calculateFibonacci'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  Promise  Observable  . const calculateFibonacci = (...args) =&gt; Observable.fromPromise(calculateFibonacciExternal(...args)); class FibonacciReactRxProps extends React.Component { // ,     Observables //$        ( ) static propTypes = { className: PropTypes.string, value$: PropTypes.instanceOf(Observable).isRequired, useServerCall$: PropTypes.instanceOf(Observable).isRequired, exist$: PropTypes.instanceOf(Observable).isRequired, }; //       state = { loading: true, fibonacci: null, }; //            componentWillMount() { //useServerCall   ,       this.props.useServerCall$.subscribe(useServerCall =&gt; { this.useServerCall = useServerCall; }); //value         this.props.value$.switchMap(value =&gt; { this.value = value; this.setState({ loading: true, }); return calculateFibonacci(value, this.useServerCall) .takeUntil(this.props.exist$); //       }).subscribe(fibonacci =&gt; { this.setState({ loading: false, fibonacci: fibonacci, }); }); //     className,     propTypes -    //Observable.       . //  props,      Observables } //    render() { return ( &lt;div className={ classnames(this.props.className, this.state.loading &amp;&amp; 'loading') }&gt; { this.state.loading ? 'Loading...' : `Fibonacci of ${this.value} = ${this.state.fibonacci}` } &lt;/div&gt; ); } } // HoC,     (  ) export default reactRxProps({ propTypes: { className: PropTypes.string, value: PropTypes.number.isRequired, useServerCall: PropTypes.bool.isRequired, }, })(FibonacciReactRxProps);</span></span></code> </pre><br></div></div><br>  What are the advantages compared with the original component: <br><br><ol><li>  All the logic of when to do the recalculation and rendering in one place </li><li>  No duplicate code </li><li>  No comparisons with the previous state. </li><li>  We can always automatically unsubscribe from any Observable using <code>takeUntil(this.props.exist$)</code> </li><li>  All the logic that we do not need no actual results of calculations lies in the launch of <code>switchMap</code> </li></ol><br>  However, the component still has an internal state, which complicates its testing.  Let's use the second hoc: <br><br><div class="spoiler">  <b class="spoiler_title">An example of a component with no internal state</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PropTypes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'prop-types'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> classnames <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'classnames'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { reactRxProps, reactRxPropsConnect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-rx-props'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { compose } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'recompose'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> calculateFibonacciExternal <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./calculateFibonacci'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> calculateFibonacci = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...args</span></span></span><span class="hljs-function">) =&gt;</span></span> Observable.fromPromise(calculateFibonacciExternal(...args)); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FibonacciReactRxProps</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//           //     static propTypes = { className: PropTypes.string, value: PropTypes.number, fibonacci: PropTypes.number, }; //,  render() { return ( &lt;div className={ classnames(this.props.className, this.props.loading &amp;&amp; 'loading') }&gt; { this.props.loading ? 'Loading...' : `Fibonacci of ${this.props.value} = ${this.props.fibonacci}` } &lt;/div&gt; ); } } //compose    HoC    export default compose( //     reactRxProps({ propTypes: { className: PropTypes.string, value: PropTypes.number.isRequired, useServerCall: PropTypes.bool.isRequired, }, }), reactRxPropsConnect({ //   props       propTypes: { className: PropTypes.string, value$: PropTypes.instanceOf(Observable).isRequired, useServerCall$: PropTypes.instanceOf(Observable).isRequired, exist$: PropTypes.instanceOf(Observable).isRequired, }, //      Observables //    , : //this -&gt; model //this.props -&gt; props //this.setState -&gt; render connect: (props, render) =&gt; { const model = {}; props.useServerCall$.subscribe(useServerCall =&gt; { model.useServerCall = useServerCall; }); props.value$.switchMap(value =&gt; { model.value = value; render({ loading: true, }); return calculateFibonacci(model.value, model.useServerCall) .takeUntil(props.exist$); }).subscribe(fibonacci =&gt; { render({ loading: false, value: model.value, fibonacci: fibonacci, }); }); }, }) )(FibonacciReactRxProps);</span></span></code> </pre><br></div></div><br>  The component lost its internal state, as well as all the logic associated with Observables, and became elementary for testing, just like the new connect function. <br><br>  I hope you liked this approach and you also decide to try it.  I tried to find libraries with this functionality, but, unfortunately, my search did not return any results. <br><br><h2>  References: </h2><br>  <a href="https://github.com/DontRelaX/react-rx-props">React Rx Props Library</a> <br>  <a href="https://github.com/DontRelaX/react-rx-props/tree/master/example">An example of working with the library</a> </div><p>Source: <a href="https://habr.com/ru/post/346154/">https://habr.com/ru/post/346154/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346142/index.html">Hot reboot of components in React</a></li>
<li><a href="../346144/index.html">Mobile devices from the inside. Memory markup, file structure description and markup memory</a></li>
<li><a href="../346146/index.html">Python, under the pirate flag</a></li>
<li><a href="../346148/index.html">Configure Azure Application Insights for diagnosing software with microservice architecture</a></li>
<li><a href="../346152/index.html">The head of Intel suspected of selling the company's shares at $ 24 million due to the vulnerability of processors</a></li>
<li><a href="../346160/index.html">Open Source Cisco Cybersecurity Projects</a></li>
<li><a href="../346162/index.html">Do observers affect usability testing results?</a></li>
<li><a href="../346164/index.html">Specter and Meltdown</a></li>
<li><a href="../346166/index.html">Choosing a reliable database in a high load project</a></li>
<li><a href="../346168/index.html">Top 10 universities in Europe to study IT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>