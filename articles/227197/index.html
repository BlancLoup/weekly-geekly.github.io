<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Porting a Windows 8.1 application to Windows Phone 8.0 with troubleshooting</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Using the example of a simple Windows 8.1 application, let's see how easy it is to transfer applications from WinRT (Windows 8.1) to Silverlight (WP8....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Porting a Windows 8.1 application to Windows Phone 8.0 with troubleshooting</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/611/5cf/279/6115cf2795b1820f6d2762a4c8b885b0.png"><br><br>  Using the example of a simple Windows 8.1 application, let's see how easy it is to transfer applications from WinRT (Windows 8.1) to Silverlight (WP8.0) and analyze several pitfalls as we go. <br><a name="habracut"></a><br><br>  You probably heard about the advanced method of developing Windows / Windows Phone applications - Universal Apps.  The approach is sound, but the market share of WP8.1 is still only beginning to grow, and the application needs to be done now, so we‚Äôll focus on WP8.0 (Silverlight).  Advantages: support for devices on both WP8.0 and WP8.1, support for all types of screens without ‚Äúblack bars‚Äù (as opposed to WP7 applications), stable third-party libraries, etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Briefly about the original application </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/7e7/1b9/7be/7e71b97befbb074580b425d6500fe5ca.png"><br>  The guinea pig will be a nearly complete one-page Windows 8.1 application for displaying the basic exchange rates. <br><br>  Since the application is free and without ads, the functionality is strictly limited.  Only the most necessary functions: displaying the average exchange rate (USD, EUR, RUB), fluctuation graph for the last 30 days, displaying bank rates, currency converter and support for Live Tiles. <br>  Leave the server part behind the scenes.  there is nothing interesting. <br><br><h4>  Project structure </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/ee1/bf8/3bc/ee1bf83bc2e3b2145c9081e007ef2007.png"><br>  With an eye on Universal Apps, the main blocks are moved to the user control, the data classes are moved to the Portable Library, and the code responsible for getting the data is separated from the UI. <br><br><h5>  We transfer code to Windows Phone 8.0 </h5><br>  Create an empty project, throw out all the excess from MainPage, add the necessary references and NuGet packages.  First of all, add as links (Add -&gt; Existing Item -&gt; <a href="http://msdn.microsoft.com/en-us/library/ee707369(v%3Dvs.91).aspx">Add As Link</a> ) class files for processing data from the Windows 8 project. <br><br><h6>  Problems: </h6><br>  ‚óä Expecting that neymspeysy will not converge (WinRT vs Silverlight), so we use a warm tube #if #endif, it turns out that something like this: <br><pre><code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NETFX_CORE using Windows.Web.Http; using System.Runtime.InteropServices.WindowsRuntime; using Windows.Networking.BackgroundTransfer; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> WINDOWS_PHONE using System.Net.Http; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre> <br>  I should note that even though we do not use Universal Apps, Visual Studio 2013 Update 2 greatly simplifies working with #if #endif for different platforms.  Another drop-down list appeared right above the code, allowing you to quickly switch the platform without reopening the file.  IntelliSense no longer falls, Resharper does not fall off at the most inappropriate moment.  No more "This document is opened project project.", Etc. <br><br>  ‚óä Since we load data using HttpClient (later it will be clear why it is HttpClient), which is missing from WP8.0, we add the NuGet Microsoft.Net.Http package.  But here, not without surprises, without #if not done: <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buff; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NETFX_CORE var ibuff = await client.GetBufferAsync(uri); buff = ibuff.ToArray(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> WINDOWS_PHONE buff = await client.GetByteArrayAsync(uri); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre><br>  Tricky question, how many official implementations of HttpClient do you know? <br><br>  ‚óä We store the received data in the device‚Äôs memory, which would be something to show next time if there is no internet connection, but ... well, you understood: <br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NETFX_CORE var file = await ApplicationData.Current.LocalFolder.CreateFileAsync(LOCAL_DATA_FILENAME, CreationCollisionOption.ReplaceExisting); await FileIO.WriteTextAsync(file, json); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> WINDOWS_PHONE var fs = await ApplicationData.Current.LocalFolder.OpenStreamForWriteAsync(LOCAL_DATA_FILENAME, CreationCollisionOption.ReplaceExisting); using (StreamWriter streamWriter = new StreamWriter(fs)) { await streamWriter.WriteAsync(json); } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre><br>  Here it is worth remembering the difference between LocalFolder and LocalCache (since WP8.1), the main difference is that LocalFolder, unlike LocalCache, is affected by the built-in beckup / restore (not to be confused with roaming) and as a result your data may appear on a completely different device (or several) with all the consequences.  See how it works in more detail <a href="http://channel9.msdn.com/Events/Build/2014/2-522">here</a> .  In our case, LocalCache on WP8.0 is not available, so we use what we have. <br><br>  ‚óä Separately, it is worth mentioning support for data encryption, historically, I already had a self-written cross-platform binary compatible encryption class using <a href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a> , which roams from project to project.  The description of this class is beyond the scope of the article, I‚Äôll just say that under WP8.0 there is a wonderful class AesManaged, and under WinRT I use the mappers for the native implementation: <br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NETFX_CORE using Windows.Security.Cryptography; using Windows.Security.Cryptography.Core; using Windows.Storage.Streams; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> using System.Security.Cryptography; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre><br><br><h5>  We transfer UI to Windows Phone 8.0 </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/7e7/1b9/7be/7e71b97befbb074580b425d6500fe5ca.png"><br><br>  After the auxiliary code is transferred and successfully compiled, we undertake the interface.  Since  Phone, tablet or desktop is not the same thing at all.  Therefore, the application will look different.  For this, Windows 8 and Windows Phone projects will have their own MainPage and we will add user controls as links (Add As Link, in the future it will just move to the <a href="http://msdn.microsoft.com/en-us/library/windows/apps/dn609832.aspx">Shared project</a> ).  Plus, the controls themselves will adapt to the situation, for example, the width of the available space (do not forget about snapped mode in Windows 8). <br><br><h6>  Problems: </h6><br>  ‚óä The first thing to do is to divide the namespaces in the code behind classes using the same #if #endif, I will not give an example, just use Shift + Alt + F10 on everything that is highlighted in red. <br><br>  ‚óä It so happened that in WP8.0 there is no DataContextChanged event, so we change the logic a bit to get rid of it. <br><br>  ‚óä Since there are no built-in styles from WinRT XAML in WP8.0, such as SymbolThemeFontFamily, BaseTextBlockStyle, BodyTextBlockStyle, etc., we create a separate ResourceDictionary in the WP8.0 project.  Open ‚Äúc: \ Program Files (x86) \ Windows Kits \ 8.1 \ Include \ winrt \ xaml \ design \ generic.xaml‚Äù and rip out everything we need and put in the newly created ResourceDictionary, replacing or discarding something that is not supported on the phone (CharacterEllipsis -&gt; WordEllipsis, SemiLight -&gt; Light, Typography. * -&gt; c: \ NUL). <br>  Then we merge this reference book in App.xaml: <br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Application.Resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceDictionary</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceDictionary.MergedDictionaries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceDictionary</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CommonStyles.xaml"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceDictionary.MergedDictionaries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">local:LocalizedStrings</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:local</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:BXFinanceWP"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LocalizedStrings"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceDictionary</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Application.Resources</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  It is worth paying attention if you already have something in Application.Resources (for example, LocalizedStrings, if you have not thrown it out at the first stage) it will need to be placed inside a ResourceDictionary, as shown above. <br><br>  ‚óä I don‚Äôt know why, but the IValueConverter interfaces are slightly different between WinRT and Silverlight, so we rule all common (As Link added) converters in the project: <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Convert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Type targetType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> parameter #</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-params"> NETFX_CORE ,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> language #endif #</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WINDOWS_PHONE ,System.Globalization.CultureInfo culture #endif </span></span></span><span class="hljs-function">)</span></span></code> </pre><br><br>  ‚óä The next thing I encountered was the difference between third-party namespaces in XAML.  In WinRT, neymspeysy are described through "using:", and in Silverlight through "clr-namespace:", an example: <br><pre> <code class="cs hljs">xmlns:Common=<span class="hljs-string"><span class="hljs-string">"using:BXFinanceDashboard.Common"</span></span> xmlns:Common=<span class="hljs-string"><span class="hljs-string">"clr-namespace:BXFinanceDashboard.Common"</span></span></code> </pre><br>  There are not many solutions to this problem, and there is not a single good one, #ifdef for XAML is not.  In such cases, based on the specific situation, you can create the necessary controls in the code, bother with the custom build action, take out everything you can in styles and / or divide the interface into common and platform-specific files.  In extreme cases, copy-paste. <br>  But in our case, not everything is so difficult, because  in most cases, the namespace ad was needed to connect the converters.  Therefore, I simply created one ResourceDictionary one at a time in each project and declared the converters there.  And since the application is not large, I connected it globally in App.xaml.  The plus is that converters are not re-created, but you need to remember that names are now global and cannot be repeated. <br>  Just in case, here is the listing, WinRT (Windows 8.1): <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceDictionary</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:Common</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"using:BXFinanceDashboard.Common"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:HighlightValueConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HighlightUSDBuyConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HighlightBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFF4646"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:HighlightValueConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HighlightUSDSellConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HighlightBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFF4646"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:HighlightValueConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HighlightEURBuyConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HighlightBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFF4646"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:HighlightValueConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HighlightEURSellConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HighlightBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFF4646"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:HighlightValueConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HighlightRUBBuyConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HighlightBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFF4646"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:HighlightValueConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HighlightRUBSellConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HighlightBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFF4646"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:BoolToVisibilityConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BoolVisibilityConverter"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:BoolToVisibilityConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BoolNotVisibilityConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IsReversed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:OpacityConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OpacityConverter"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:OpacityConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OpacityNotConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IsReversed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceDictionary</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Silverlight (WP8.0): <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceDictionary</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:Common</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:BXFinanceDashboard.Common"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:HighlightValueConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HighlightUSDBuyConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HighlightBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFF4646"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NormalBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StaticResource PhoneForegroundBrush}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:HighlightValueConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HighlightUSDSellConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HighlightBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFF4646"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NormalBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StaticResource PhoneForegroundBrush}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:HighlightValueConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HighlightEURBuyConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HighlightBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFF4646"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NormalBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StaticResource PhoneForegroundBrush}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:HighlightValueConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HighlightEURSellConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HighlightBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFF4646"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NormalBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StaticResource PhoneForegroundBrush}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:HighlightValueConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HighlightRUBBuyConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HighlightBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFF4646"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NormalBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StaticResource PhoneForegroundBrush}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:HighlightValueConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HighlightRUBSellConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HighlightBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFF4646"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NormalBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StaticResource PhoneForegroundBrush}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:BoolToVisibilityConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BoolVisibilityConverter"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:BoolToVisibilityConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BoolNotVisibilityConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IsReversed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:OpacityConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OpacityConverter"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Common:OpacityConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OpacityNotConverter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IsReversed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ResourceDictionary</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  ‚óä Surprise was the difference between fonts on Windows and Windows Phone.  For some reason, I chose the symbols # 128314 / # 128315 from ‚ÄúSegoe UI Symbol‚Äù, but overlooked what they are called ‚ÄúUp / Down-Pointing Red Triangle‚Äù.  On Windows, they look exactly as needed, but on Windows Phone, they are both red and do not repaint, and besides, the symbol is already in width.  Having rummaged still, found more suitable # 9650 / # 9660.  It was not immediately clear what the matter was, I even had to make a comparison on the phone: <br><img src="https://habrastorage.org/getpro/habr/post_images/131/0c2/356/1310c2356df1f851ed598bd32bfe665f.png"><br><br>  By the way, do not forget to use exactly the glyphs (especially <a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.controls.symbol.aspx">in the buttons on the app bar</a> ), and not your pictures.  Zadolbatsya generate a dozen pictures for different DPI, for example, the screen of another application with the Nokia 1520: <br><img src="https://habrastorage.org/getpro/habr/post_images/009/514/5dc/0095145dc1c376e1c65f8114b3aabfcf.png"><br><br><h4>  Adapt the application to the phone </h4><br>  The application has gathered, well, but you should not stop.  Still, mobile is not the same as a tablet or desktop (by the way, the application on the desktop itself is updated if it hangs on the screen, which is convenient for all information panels). <br><br><h5>  Layout </h5><br>  To switch the chart of rates, the list of banks and the currency converter, we take the more familiar Pivot control on Windows Phone.  We include the tray (hiding the tray without a good reason is bad), we adjust the upper indent, so that the tray does not eat much space.  Fortunately, WP8 with a tray has fewer problems than WP7, it jumps less often, but do not forget that in the code the tray color can be specified not earlier than Page.Loaded.  To avoid an ugly stripe between the tray and the page, we need a transparency of 0.99. <br><br>  Since the screen of the phone is already in width, it is necessary that all the main controls adapt accordingly (this is also useful for snapped mode on the desktop). <br><br>  The list of banks automatically displays only one currency if there is not enough space, and a switch appears below.  Moreover, an important requirement here was that the list scrolling would remain in place when switching currencies.  Those.  that would not have to re-scroll to the required bank. <br><img src="https://habrastorage.org/getpro/habr/post_images/4a9/c89/65e/4a9c8965e8f43a2aa2914e5e8e9286e8.png"><br><br>  The currency converter, in turn, wraps up some elements and is justified in width: <br><img src="https://habrastorage.org/getpro/habr/post_images/bd7/2f3/1a5/bd72f31a5e788faf2e34cc9808d68ff0.png"><br><br>  You can achieve this behavior in several ways, for example, using states (states), but this time I just added the HorizontalAlignment properties to the control itself, the main thing is to scatter elements with grids and not StackPanel.  Example: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UserControl</span></span></span><span class="hljs-tag"> ‚Ä¶ </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Left"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RootPanel"</span></span></span><span class="hljs-tag">&gt;</span></span> ‚Ä¶ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding HorizontalAlignment, ElementName=Parent}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.ColumnDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.ColumnDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ToggleButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btnActionSell"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Center"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ToggleButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btnActionBuy"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Center"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  And in the MainPage on the phone we add Stretch: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Controls:CurrencyConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"currencyConverterControl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Stretch"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  Also from the point of view of usability, it was very desirable that the keyboard would not close the selection buttons on all DPI supported.  Plus he added that when entering (or inserting) the amount, it was possible directly on the keyboard to press the dollar sign or the euro (there is no ruble sign on the keyboard and in the font <a href="http://habrahabr.ru/post/226499/">yet</a> ) with the corresponding currency switching. <br><img src="https://habrastorage.org/getpro/habr/post_images/927/9d3/ea2/9279d3ea20322bb4cba2766c74f2ba20.png"><br><br><h5>  Live tiles </h5><br>  Since the application is under Windows Phone 8.0, we don‚Äôt have to dream about <a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh465460.aspx">WNS</a> , so on the phone we use the good old Periodic Background Agent.  The code is nothing special, you just need to remember to ask the user at the first start if he wants to receive updates in the background.  A side effect of using your agent is that when the user, for example, on the road and without the Internet, we already have some old data for displaying (on Windows 8.1 this problem is solved a little differently, see below).  When preparing images for tiles, remember that in Windows Phone the logo is strictly centered (with or without a signature), and in Windows 8 it moves up a bit. <br><img src="https://habrastorage.org/getpro/habr/post_images/a86/803/2db/a868032dbc6d0bfa2fe4620182f323ca.png"><br><br><h5>  Charts </h5><br>  Separately worth mentioning the transfer schedule fluctuations.  Out of habit on Windows, the graph was implemented using Controls.DataVisualization (the application was made with an eye to Universal Apps, and the Telerikov control was not yet released (at the time of writing)).  And as it turned out, it is under Windows Phone 8.0 that there is no normal DataVisualization port.  Under WinRT (Windws 8 and Windows Phone 8.1) there is <a href="https://www.nuget.org/packages/winrtxamltoolkit">WinRTXamlToolkit</a> , even on Windows Phone 7 you could use either from the usual Silverlight.  But under WP8.0 in no way (in WPToolkit, when transferred to WP8, DataVisualization was lost).  In general, even with WP7, WPToolkit does not cease to ‚Äúdelight‚Äù. <br>  In general, after spending half an hour searching, I threw Telelerk control on my phone (maybe I‚Äôll switch to Windows 8 when it goes to Universal Apps), adjusted the look and forgot it like a bad dream. <br><img src="https://habrastorage.org/getpro/habr/post_images/0f9/c89/467/0f9c89467ea8f6b8be788a3c862bb3f4.png"><br><br><h5>  Caching </h5><br>  In Windows 8.1 (missing in WP8.1), a wonderful feature appeared: you can tell the OS which URLs to cache.  Those.  if the stars converge, (or rather, if your application is used regularly), Windows itself will cache the data you need before the application starts.  This thing is called <a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.networking.backgroundtransfer.contentprefetcher.aspx">Content Prefetcher</a> .  You can add specific URLs or xml file-list from the server (if the data is dynamic, for example, news).  A simple example: <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegisterPrefetchUrls</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ContentPrefetcher.ContentUris.Any(u =&gt; u.AbsoluteUri == LIVE_DATA_URL)) { ContentPrefetcher.ContentUris.Clear(); ContentPrefetcher.ContentUris.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(LIVE_DATA_URL)); } }</code> </pre><br>  Respectively we load data as usual through HttpClient.  But it works only with <a href="httpclient">Windows.Web.Http.HttpClient</a> (the one that works through WinInet, not to be confused with other implementations of HttpClient).  If you need to load data only from the cache, if there is one, use the <a href="httpcachereadbehavior.aspx">Filters.HttpCacheReadBehavior.OnlyFromCache</a> filter. <br>  By the way, in VS Update 2, a useful menu appeared that would force the OS to cache data for debugging purposes, before it was only from the console.  But you need to remember to start the application itself first, in order to indicate the URLs, more details <a href="http://blogs.msdn.com/b/visualstudioalm/archive/2014/02/06/triggering-prefetch-for-windows-store-apps-in-visual-studio-2013-update-2.aspx">here</a> . <br><img src="https://habrastorage.org/getpro/habr/post_images/b04/aea/933/b04aea933ed3006a41c9bde742592973.png"><br><br><h4>  Usage statistics </h4><br>  This time it was decided to connect Google Analytics, not Flurry.  It hurts Flurry shows the wrong numbers compared to its own statistics ( <a href="http://habrahabr.ru/company/alawar/blog/210032/">not just me</a> ).  Plus, poor support for platforms other than iOS / Android and a terribly dull web panel (80+ http requests with each reboot).  As for me, it makes sense to use Flurry only for cross-platform games because  There are very useful installation tracking tools, in-app, etc. <br><br>  For Windows / Windows Phone, there is a ready-made <a href="http://googleanalyticssdk.codeplex.com/">Google Analytics SDK for Windows 8 and Windows Phone</a> .  The integration is simple, only I would advise calling SendView () not from OnNavigatedTo () as in the example, but from Page.Loaded to count the impressions when the user returns with the back button.  I also added a platform to the version field in analytics.xml: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appVersion</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.0.0 (WP)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appVersion</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Depending on the specifics of the application, it makes sense to add custom events (SendEvent ()).  As an example, I‚Äôm wondering how many users will actually use the currency converter, or what percentage has turned off Live Tile. <br><br><h4>  Final touches </h4><br>  We make the application page, do not forget to add <a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh781489.aspx">msApplication-ID</a> in the meta tags, so that the user could put the application from the IE menu.  If there is a desire, register the application in Bing, so that the user can put the application directly from the <a href="http://channel9.msdn.com/Events/Build/2014/2-655">web search results</a> page (on Windows 8.1 / Windows Phone 8.0 / 8.1). <br>  The only thing that upsets is the lack of the Russian-language ‚Äúdownload‚Äù button for the Windows Phone Store (can MS representatives comment?).  If you follow the rules of using Microsoft trademarks, you need to use only ready-made images, there is even a whole <a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh694084.aspx">guide</a> where and how to use them.  The result is that for the Windows Phone Store there is no button in Russian, and for the Windows Store there is no button without the word ‚ÄúDownload‚Äù.  I have to use English versions of the buttons: <br><img src="https://habrastorage.org/getpro/habr/post_images/3af/95f/c09/3af95fc0916adb318d58e208913765b0.png"><br><br><h4>  Conclusion </h4><br>  It turned out somehow long and messy, even though I tried to choose only interesting moments.  If you missed something, ask in the comments. </div><p>Source: <a href="https://habr.com/ru/post/227197/">https://habr.com/ru/post/227197/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227183/index.html">Comparison of geolocation binary databases and their drivers: GeoIP, Sypex Geo, TabGeo</a></li>
<li><a href="../227185/index.html">Development for Microsoft SQL Server: Unix way</a></li>
<li><a href="../227189/index.html">Hola: principles of work</a></li>
<li><a href="../227193/index.html">Creating offline maps for iOS applications</a></li>
<li><a href="../227195/index.html">Reflections on the blues - once again about exception handling</a></li>
<li><a href="../227199/index.html">Modern aspects of the presentation of texts in the analysis of natural language: classical and alternative approaches</a></li>
<li><a href="../227201/index.html">Own WebGL engine. Article number 1. Canvas</a></li>
<li><a href="../227203/index.html">Migration and Coexistence of Mail Systems</a></li>
<li><a href="../227205/index.html">Autotiling: automatic tile transitions</a></li>
<li><a href="../227209/index.html">The line between the cargo cult and the evolution in learning success</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>