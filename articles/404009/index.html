<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We manage the house through Telegram</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Currently, smart home control systems are becoming increasingly popular. A centralized interface that manages devices throughout your home helps save ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We manage the house through Telegram</h1><div class="post__text post__text-html js-mediator-article"><p>  Currently, smart home control systems are becoming increasingly popular.  A centralized interface that manages devices throughout your home helps save time and makes it much more efficient to control your home.  Realization of their vision of such systems is done by both famous brands: Apple, Amazon and Google, embedding them in their infrastructure, as well as craftsmen who assemble similar systems based on the Arduino platform. </p><br><p>  Our goal was the following: to create a system that will be available on a large number of devices and will not be tied to any place.  An excellent option for the implementation of management was a bot for the Telegram messenger.  Telegram has applications on all major platforms, as well as a web version.  Access to it can be obtained from anywhere, you just need to have an account. </p><br><p>  From the modules we have chosen the following: </p><br><p>  ‚Ä¢ Controlled RGB LED strip <br>  ‚Ä¢ Controlled outlet <br>  ‚Ä¢ Temperature sensor <br>  ‚Ä¢ Light sensor (used to automatically turn on the light) </p><a name="habracut"></a><br><h3>  What we need </h3><br><h4>  1. Raspberry Pi 3 </h4><br><p>  A small but remote computer that does not need to be presented, its power will be enough for us with our head for these tasks.  The third version is good presence of built-in Wi-Fi module, so we do not have to think about a third-party adapter. </p><br><h4>  2. Modules ESP8266 </h4><br><p>  We need them 4 pieces.  We used ESP-12F, but in general there is no difference: ESP-1 will be quite enough.  Also ready NodeMCU boards will help save you time and effort. </p><br><h4>  3. LED strip </h4><br><p>  We took a managed RGB tape on the WS2812b controllers, although, however, any tape running on 5V and supported by the Arduino platform will do. </p><br><h4>  4. Temperature and lighting sensors </h4><br><p>  We used the BH1750 module to determine the illumination in the room and the DS18B20 for temperature.  The main criteria were availability, support for the Arduino platform and the ability to work with 3.3V logic ESP8266. </p><br><h4>  5. Relay </h4><br><p>  The submodule MOD-1CH for Arduino can pass up to 10A of current and is controlled by 5V, we did not find any analogs for 3.3V, so we used a transistor in the key mode for control. </p><br><h4>  6. Telegram bot </h4><br><p>  Direct control of the entire system will be carried out using a Telegram bot running on Raspberry: this will allow the system to be easily accessible on any platform from anywhere in the world.  Creating a bot for Telegram is quite simple, thanks to the advanced platform and the support of a large number of languages. </p><br><p>  Thus, our entire system will look something like this: </p><br><p><img src="https://habrastorage.org/web/060/7b9/0b6/0607b90b6cd44144aa5e28641bc3e156.png" alt="image"></p><br><h3>  Implementation </h3><br><p>  First we test the modules. </p><br><p><img src="https://habrastorage.org/web/c2e/093/5de/c2e0935de6ad4b5dacda3e494e645eef.jpg" alt="image"></p><br><p>  The finished printed circuit boards adapt the distance between the pins, which considerably facilitates the soldering, and also contains the necessary resistors connecting the CH_PD and GPIO2 pins to the Vcc. </p><br><p>  Unfortunately, the ESP8266 modules are powered and run on 3.3V, not 5, like the Arduino.  You can convert voltage using a ready-to-use converter module, but you can also solder a circuit based on the AMS1117 linear stabilizer, as we did. </p><br><p><img src="https://habrastorage.org/web/171/88e/b51/17188eb517dd4ae7a781aae753d4df42.png" alt="image"></p><br><p>  The next stage is programming. </p><br><p>  Fortunately, the ESP8266 platform is supported by the Arduino IDE, which opens up many possibilities.  To directly download the firmware to the module, we will use the Arduino Nano, but the same can be done through a regular USB-UART converter.  Do not forget about the voltage difference between the Arduino and ESP. </p><br><p>  The scheme is as follows: </p><br><p><img src="https://habrastorage.org/web/47d/caa/be9/47dcaabe9a06464aa8e9d4d1e35ca479.png" alt="image"></p><br><p>  The button is needed in order to close the pin GPIO1 to GND when power is applied to the module and, thus, put it into programming mode. </p><br><p>  Next, set up the Arduino IDE so that it understands ESP ( <a href="https://geektimes.ru/post/271754/">detailed instructions with all links</a> ) and try to record a test sketch of a blinking LED. </p><br><p><img src="https://habrastorage.org/web/b88/94a/65a/b8894a65aa6143e0be334ea8e7468ad3.jpg" alt="image"></p><br><p>  After a successful blink, we proceeded to solder all the modules.  With a temperature and lighting sensor, everything is pretty standard. </p><br><p>  Temperatures: </p><br><p><img src="https://habrastorage.org/web/e7a/4a7/d03/e7a4a7d03d4e4c46b1af02d0f3e6a97e.png" alt="image"></p><br><p><img src="https://habrastorage.org/web/3ce/cbe/5fa/3cecbe5fadd144208d47b42f4b55f88d.jpg" alt="image"></p><br><p>  Lighting: </p><br><p><img src="https://habrastorage.org/web/1ec/4db/505/1ec4db505e254635a6dfcc0e8c1f65ab.png" alt="image"></p><br><p><img src="https://habrastorage.org/web/5a6/5bf/202/5a65bf202e0c4f698282a5554221130e.jpg" alt="image"></p><br><p>  But the ribbon and smart socket caused some difficulties. </p><br><p>  A simple connection of the control input of the tape to the ESP did not result.  It is not surprising, because WS2812b requires at least 70% of the VCC input (5x0.7 = 3.5) for the control input, and 3.3V board is not enough.  However we found <del>  crutch </del>  An interesting way to run them without using a boost converter.  If the diode requires at least 0.7xVcc to react to the signal and we cannot increase the level of this signal, then Vcc must be reduced!  Yes, the LEDs will not burn so brightly, but we do not need to power the entire tape in this way;  one diode is enough.  Transmitting the signal further along the chain, the LED already uses the Vcc level to form a signal, which is quite enough for a ‚Äúnormal‚Äù LED.  Thus, by connecting the first diode in the tape to power through a diode that ‚Äúeats‚Äù about 0.6V, we get a perfectly working tape, which is directly controlled from our ESP8266 module.  And we left the slightly dimmer first LED for debugging needs: display network connection status. </p><br><p>  This is what happened: </p><br><p><img src="https://habrastorage.org/web/6ea/eba/f9e/6eaebaf9e0c741a7ab938a97318d5d25.png" alt="image"></p><br><p><img src="https://habrastorage.org/web/2c9/cb1/baa/2c9cb1baac0c41ea90c0ceeba0c252ea.jpg" alt="image"></p><br><p>  We wanted to place our smart socket completely in the case from the old socket with a timer.  There should have got into: the ESP-12F itself, the power supply for it and the relay controlling the outlet.  However, having placed a relay and a power supply there, we could not fit an ESP module there either.  Therefore, I had to attach a small box from below. </p><br><p><img src="https://habrastorage.org/web/ed7/0d9/1fe/ed70d91fe74945818d27cfc476ed0305.jpg" alt="image"></p><br><p> The result was not as elegant as we originally wanted, but it was a whole device that just had to be plugged into an outlet. </p><br><p><img src="https://habrastorage.org/web/476/4bc/f54/4764bcf5488b400b9b0b1d3dd25b428a.png" alt="image"></p><br><p><img src="https://habrastorage.org/web/b63/79f/683/b6379f6833c34e4f8e04f5a974a5ec96.jpg" alt="image"></p><br><p>  The next step was to configure Raspberry.  The plan was this: our modules connect to the Wi-Fi access point, which is Raspberry, or rather, to its built-in Wi-Fi module.  Telegram-bot was launched on Raspberry, which is located with all modules on the local network and can exchange http-requests with them without any problems.  To the Internet it is all connected via Ethernet. </p><br><p>  To implement this plan, we used two packages: </p><br><ul><li>  hostapd - allows you to use the built-in wi-fi module as an access point </li><li>  dnsmasq - combines DHCP and DNS servers. </li></ul><br><p>  We tried to achieve relative independence of the code and devices, so all requests were made not to ip-addresses, but to names from the invented zone .sh (light.sh, socket.sh, etc.).  To do this, we configured static ip-addresses for each module and added DNS records corresponding to the modules to these DNS addresses.  The benefit of dnsmasq is very easy to configure ( <a href="https://frillip.com/using-your-raspberry-pi-3-as-a-wifi-access-point-with-hostapd">detailed instructions for setting up this system</a> ). </p><br><p>  And, finally, directly bot. </p><br><p>  We wrote a bot in Python using the python-telegram-bot library.  We have developed a button interface that simplifies operation, turning the device into a kind of remote control: </p><br><p><img src="https://habrastorage.org/web/5c1/14e/04c/5c114e04c8f84c209cbdb34a2e4e4301.png" alt="image"></p><br><p><img src="https://habrastorage.org/web/07a/b0f/d39/07ab0fd391324935afccf4632226702f.png" alt="image"></p><br><p>  The source bot code can be explored <a href="https://mega.nz/">here</a> . </p><br><p>  And so that no one would use it, we set the password protection. </p><br><h3 id="vyvod">  Conclusion </h3><br><p>  Of course, we have not created any revolutionary system, there is a huge amount of more holistic and well thought-out implementations.  The temperature and lighting modules could be made autonomous, since the ESP8266 has a special standby mode in which it consumes very little power.  You could add lightweight user extensibility that does not require changing the source code and reconfiguring network connections and whatnot.  However, the goal of this whole project was not at all that.  First of all, we wanted to create a simple system that could well be created by anyone at home and would not require serious preparation and costs.  And most importantly: we wanted to learn many things while we were doing this project.  And if the practicality and functionality of our solution can be refined for a long time, then the knowledge we gained in the process of planning and implementing this system was definitely worth the effort. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/404009/">https://habr.com/ru/post/404009/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../403997/index.html">Set of young biohacker</a></li>
<li><a href="../403999/index.html">The cult of cargo for AI: the myth of superhuman artificial intelligence</a></li>
<li><a href="../404003/index.html">Chemistry of the computer world</a></li>
<li><a href="../404005/index.html">Small spool and expensive: in-ear headphones from Fostex</a></li>
<li><a href="../404007/index.html">GPD Win - explore a miniature laptop with a diagonal of 5.5 ", designed for games and emulators</a></li>
<li><a href="../404011/index.html">Savings on blood: a new biomaterial delivery system has been developed in the laboratory</a></li>
<li><a href="../404015/index.html">Why on the go think better</a></li>
<li><a href="../404017/index.html">$ 126 for 5 minutes: how to use the price difference for countries against marketers</a></li>
<li><a href="../404019/index.html">Educational program on Krionika: simple language on a complex topic</a></li>
<li><a href="../404021/index.html">Doomsday Bunker in Norway with millions of ‚Äúarchival‚Äù seeds flooded due to permafrost melting</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>