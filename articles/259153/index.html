<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A few tips on OpenMP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="OpenMP is a standard that defines a set of compiler directives, library procedures, and environment variables for creating multi-threaded programs. 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A few tips on OpenMP</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/d8f/d67/b3d/d8fd67b3d0cb413ca8ea6aa05619bc3f.png" alt="image"><br><br>  OpenMP is a standard that defines a set of compiler directives, library procedures, and environment variables for creating multi-threaded programs. <br><br>  Many articles articles were on OpenMP.  However, the article contains some tips to help avoid some errors.  These tips are not often featured in lectures or books. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  1. <b>Name the critical sections.</b> </h5><br>  <i>In the queue, sons of bitches, in the queue!</i>  // M.  A. Bulgakov "Heart of a Dog" <br><br>  With the help of the directive <b>critical</b> we can specify a piece of code that will be executed only by one thread at a time.  If one of the threads has started the execution of the critical section with the given name, then the other threads that start the execution of the same section will be blocked.  They will wait for their turn.  As soon as the first thread completes the execution of the section, one of the blocked threads will enter it.  The choice of the next thread that will perform the critical section will be random. <br><a name="habracut"></a><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp critical [()]    </span></span></code> </pre> <br><br>  Critical sections can be named or unnamed.  Improves performance in various situations.  According to the standard, all critical sections without a name will be associated with one name.  Assigning a name allows you to simultaneously perform two or more critical sections simultaneously. <br><br>  Example: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp critical (first) { workA(); } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp critical (second) { workB(); } </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//  workA()  workB()    #pragma omp critical { workC(); } #pragma omp critical { workD(); } //     workC() ,     workD()</span></span></span></span></code> </pre><br><br>  When assigning a name, be careful not to assign the names of system functions or the names that have already been used.  If your critical sections work with the same resource (output in one file, output to the screen) you should assign the same name or not assign it at all. <br><br><h5>  2. <b>Do not use! = In cycle management</b> </h5><br>  The for directive imposes restrictions on the structure of the corresponding loop.  Definitely, the corresponding cycle should be canonical. <br><br><img src="https://habrastorage.org/files/cef/4b1/2ff/cef4b12ff00b4241aec171ed9cbba1d5.png" alt="image"><br><br>  Developer Response from the OpenMP Architecture Review Board <br><br>  If we allow! =, Programmers can get an indefinite number of loop iterations.  The problem in the compiler when it generates code to calculate the number of iterations. <br><br>  For a simple loop like: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n; ++i )</code> </pre><br>  You can determine the number of iterations, n if n&gt; = 0, and zero iterations if n &lt;0. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i != n; ++i )</code> </pre><br>  n iterations can be defined if n&gt; = 0;  if n &lt;0, we do not know the number of iterations. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n; i += <span class="hljs-number"><span class="hljs-number">2</span></span> )</code> </pre><br>  the number of iterations is the integer part of (((n + 1) / 2) if n&gt; = 0, and 0 if n &lt;0. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i != n; i += <span class="hljs-number"><span class="hljs-number">2</span></span> )</code> </pre><br>  cannot determine when i equals n.  What if n is an odd number? <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n; i += k )</code> </pre><br>  the number of iterations is the largest integer from (((n + k-1) / k) if n&gt; = 0, and 0 if n &lt;0;  if k &lt;0, this is not a valid OpenMP program. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i != n; i += k )</code> </pre><br>  i increases or decreases?  Will there be equality?  This all can lead to an endless loop. <br><br><h5>  3. <b>Carefully install nowait</b> </h5><br><blockquote>  If Hachiko wants to wait, he must wait. // Hachiko: The most loyal friend </blockquote><br>  If the clause <b>nowait is</b> not specified, then the <b>for</b> construction will implicitly end with barrier synchronization.  At the end of the parallel loop, an implicit barrier synchronization of parallel threads running occurs: their further execution occurs only when all of them reach the given point;  if there is no need for such a delay, the nowait option allows threads that have already reached the end of the cycle to continue execution without synchronization with the others. <br><br>  Example: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp parallel shared(n,a,b,c,d,sum) private(i) schedule(dynamic) { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp for nowait for (i = 0; i &lt; n; i++) a[i] += b[i]; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp for nowait for (i = 0; i &lt; n; i++) c[i] += d[i]; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp for nowait reduction(+:sum) for (i = 0; i &lt; n; i++) sum += a[i] + c[i]; }</span></span></code> </pre><br><br>  This example has an error; it is in <b>schedule (dynamic)</b> .  The point is that <b>nowait</b> dependent data cycles allow only c <b>schedule (static)</b> .  Only in this method of work scheduling <b>does the</b> standard guarantee that <b>nowait</b> works correctly for data dependent cycles.  In our case, it is enough to erase <b>schedule (dynamic)</b> in most implementations, the default is <b>schedule (static)</b> . <br><br><h5>  4. <b>Carefully check the code before using task untied</b> </h5><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> dummy; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp threadprivate(dummy) void foo() {dummy = ‚Ä¶; } void bar() {‚Ä¶ = dummy; } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp task untied { foo(); bar(); }</span></span></code> </pre><br>  <b>task untied</b> specifies that the task is not bound to the thread that began to execute it.  Another thread can continue execution of the task after pausing.  In this example, the misuse of <b>task untied</b> .  The programmer assumes that both functions in the task will be executed by one thread.  However, if, after pausing the task, bar () will be executed by another.  Due to the fact that each thread has its own dummy variable (in our case it is <b>threadprivate</b> ).  The assignment in bar () will be incorrect. <br><br>  I hope these tips will help beginners. <br><br>  <b>Useful links:</b> <br>  <a href="http://openmp.org/mp-documents/openmp-examples-4.0.2.pdf">OpenMP 4.0 pdf examples</a> <br>  <a href="https://github.com/OpenMP/Examples">OpenMP 4.0 github examples</a> <br>  <a href="http://www.openmp.org/mp-documents/OpenMP4.0.0.pdf">OpenMP 4.0 standard pdf</a> <br>  <a href="http://openmp.org/mp-documents/OpenMP-4.0-C.pdf">All directives on 4 sheets C ++ pdf</a> <br>  <a href="http://openmp.org/mp-documents/OpenMP-4.0-Fortran.pdf">All directives on 4 sheets Fortran pdf</a> <br>  <a href="https://yadi.sk/d/anm7BiVzgxekT">One of the best OpenMP slides in Russian from Mikhail Kurnosov pdf</a> </div><p>Source: <a href="https://habr.com/ru/post/259153/">https://habr.com/ru/post/259153/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259143/index.html">Yukon: 1st Annual Software Developer Conference</a></li>
<li><a href="../259145/index.html">Prototype OOP for Lua</a></li>
<li><a href="../259147/index.html">Network Evolution - New 25/50/100 GbE Standard</a></li>
<li><a href="../259149/index.html">SonarQube. We check the code for quality</a></li>
<li><a href="../259151/index.html">Unicorn in search of extraterrestrial intelligence: an analysis of the SETI @ home code</a></li>
<li><a href="../259155/index.html">LINQ for PHP: speed matters</a></li>
<li><a href="../259161/index.html">How to make a portable repair server</a></li>
<li><a href="../259163/index.html">DevConf 2015: Interview with the author - there will be no PHP6! Meet PHP7</a></li>
<li><a href="../259165/index.html">Making a Callback from the site using Askozia PBX</a></li>
<li><a href="../259167/index.html">XSD Design Patterns</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>