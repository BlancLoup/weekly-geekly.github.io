<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Google AppEngine from the start: Model</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article, we found out what Google AppEngine is, what you can do with it, and created the simplest and most primitive application for G...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Google AppEngine from the start: Model</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="http://habrahabr.ru/blogs/gae/81895/">previous article,</a> we found out what Google AppEngine is, what you can do with it, and created the simplest and most primitive application for GAE - helloworld with minimal support for user authentication.  Let's try to expand this application, considering, incidentally, the capabilities of Google AppEngine. <br><br><h2>  Structure and architecture </h2><br>  Our previous application was extremely simple, and, as such, did not need any architecture.  Now we are setting ourselves a more complex and more realistic task - accordingly, we should think about what will happen when the application starts to grow.  Of course, our task is invented and no architecture is required for it either, but for example we will try to do everything ‚Äúaccording to science‚Äù. <br><br><a name="habracut"></a><br> <a href="http://skitch.com/sgzmd/n1yds/gaehabr"><img src="http://img.skitch.com/20100125-piig8hjqa2dwx9xe524h2dpn5f.preview.jpg" alt="gaehabr"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This is what our application will look like in terms of structure.  Blue rectangles indicate that these pages are accessible and visible to all.  Yellow means that its contents may change if a user session is active.  Orange is completely closed from the outside world and can only be accessed by logging in before. <br><br>  Two pages in the picture above will be provided to us by the GAE - namely, ‚ÄúLogin with Google‚Äù and ‚ÄúLogout‚Äù.  All that is required of us is: <ol><li>  To write the main page which will give some imputed information and offer to login </li><li>  Write a version of the main page for users who have already logged in </li><li>  Write a login-handler that will register the fact of login and redirect the user to the main page </li><li>  Write a page of statistics that will show how many times the user logged into the system and when was the last time. </li></ol>  Where to start?  As usual - from the very beginning. <br><br><h2>  Model </h2><br>  In our application, the data storage model will be quite simple, however, it seems to me that this will be quite enough to illustrate the possibilities of GAE Datastore.  Suppose we need to store information about a user, namely, his ID, the date and time of the last visit, and the number of visits.  In the language of GAE Datastore it will look like this: <br><br><pre>	 #! / usr / bin / env python
	 # encoding: utf-8
	 "" "
	 model.py
	 $ Id: model.py 4 2010-01-25 12: 14: 48Z sigizmund $
	 Created by Roman Kirillov on 2010-01-25.
	 "" "

	 import datetime
	 from google.appengine.ext import db
	 from google.appengine.api import users


	 class Visitor (db.Model):
	     '' '
	     Simple object which uses Google DataStore persistence model
	     '' '

	     '' 'UserProperty encapsulates information about a Google's 
	     user account available to application.  It is set to
	     use current user as default user automatically
	     whever new object is created '' '
	     user = db.UserProperty (required = True, auto_current_user_add = True) 

	     '' 'DateTimeProperty uses standard date datetime.datetime
	     and it is set to auto-update to now () whenever record is saved '' '
	     lastVisit = db.DateTimeProperty (auto_now = True)

	     '' 'Very simple integer property with default value of 0' ''
	     hits = db.IntegerProperty (default = 0)
</pre><br>  <a href="http://code.google.com/p/habr-gae-helloworld/source/browse/trunk/model.py">http://code.google.com/p/habr-gae-helloworld/source/browse/trunk/model.py</a> <br><br>  Let's figure out who is that.  The <code>Visitor</code> class inherits from the standard GAE class <code>google.appengine.ext.db.Model</code> , which is an interface to Datastore - all classes that want to be persistent using this technology should extend this class.  Our <code>Visitor</code> class has three data fields: <code>user</code> , <code>lastVisit</code> and <code>hits</code> .  Consider them in detail, starting with the last. <ul><li>  <code>db.IntegerProperty hits</code> encapsulates the usual integer data type.  By default, all new objects of this class are assigned the value 0. Everything is simple: <pre>     u = Visitor ()
     u.hits = 1
     # ...
     hitsCount = u.hits
</pre>  Working with such fields is absolutely transparent - as a rule, you use them in the same way as objects of the basic, integer type. <br></li><li>  <code>lastVisit</code> is like the previous one, <code>db.DateTimeProperty</code> encapsulates the built-in data type, only this time it is <code>datetime.datetime</code> .  By and large, there is no difference - it works in the same way with a field as with the specified data type.  The field is configured so that you do not need to manually update it - every time the record is saved, the field value is set to <code>now()</code> (in this case, this is reasonable). </li><li>  <code>db.UserProperty user</code> is the most interesting one used here.  It encapsulates the GAE class of <a href="http://code.google.com/appengine/docs/python/users/userclass.html">users.User</a> - no need to store the user's email, no need to store a unique ID in case the email changes - it's all there.  And naturally, this is exactly the class whose object you get by making <code>users.get_current_user()</code> .  The settings of the field indicate that every time an object is created, the value of this field will be set according to the current user. </li></ul>  Working with our class is very simple: we create it as a regular object, set the fields we want to set (in this case, <code>hits</code> ) and save it in the Datastore: <br><br><pre>     u = Visitor ()
     u.hits = 17
     u.put ()
</pre><br>  This is sufficient for the object to be saved and available later as part of the entity <code>Visitor</code> .  About how to search for objects by the value of a specific field, I will tell a little bit later - in the next part of the article.  The sources of our test application are gradually gaining their haven <a href="http://code.google.com/p/habr-gae-helloworld/source/browse/">here</a> and will be laid out as they are written. <br><br><hr>  This was the second part of a series of articles about AppEngine.  In the following parts we will get to the delicious - the actual writing of the controller and the presentation.  Waiting for your comments, suggestions and questions. <br><br>  PS please advise a good syntax highlighter for Python, which will work fine with Habr?  <a href="http://tohtml.com/">tohtml.com</a> which I have always used generates something incompatible with Parser. <br><br>  <b>Update:</b> The third part - <a href="http://habrahabr.ru/blogs/gae/81933/">habrahabr.ru/blogs/gae/81933</a> </div><p>Source: <a href="https://habr.com/ru/post/81920/">https://habr.com/ru/post/81920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../81905/index.html">First Introductory Session of the Association of Internet Developers (AID)</a></li>
<li><a href="../81907/index.html">Rating Runet / CMS for stores</a></li>
<li><a href="../81913/index.html">LCD paper notepad replacement</a></li>
<li><a href="../81917/index.html">Redis 1.2.1 and PHP client Rediska 0.3.0 updated</a></li>
<li><a href="../81918/index.html">Mappi - panoramas of the streets of Moscow, the region and major cities of Russia</a></li>
<li><a href="../81921/index.html">One little feature that I lack in PHP ...</a></li>
<li><a href="../81922/index.html">ACHI - FOP replacement</a></li>
<li><a href="../81924/index.html">Master IBS Company</a></li>
<li><a href="../81926/index.html">PayPal froze Wikileaks.org assets again</a></li>
<li><a href="../81929/index.html">Tiler - rethought classic puzzle game for iPhone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>