<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Passed GTA - started down the player!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Chapter Seventeen, in which the frontend developers of Uprock move from GTA to alternative ways of using YouTube and the practical application of the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Passed GTA - started down the player!</h1><div class="post__text post__text-html js-mediator-article">  <i>Chapter Seventeen, in which the frontend developers of <a href="http://uprock.pro/">Uprock</a> move from GTA to alternative ways of using YouTube and the practical application of the actor model.</i> <br><br> <a href="http://gta.helloday.tv/GTA-4/Vladivostok-FM/Kino-%25E2%2580%2593-gruppa-krovi-(Gruppa-Krovi---Blood-type)-"><img src="https://habrastorage.org/getpro/habr/post_images/8ca/a83/467/8caa83467865b616c78adf9f9b5f11d6.jpg" alt="image"></a> <br><br>  What do we love in GTA?  The ability to <s>beat an innocent person to</s> hijack a car, rob a bank, fly a helicopter, plane or jetpack, and, of course, listen to the radio with good music.  In general, most people do not mind to arrange it in real life, but from the entire list only good music is legal <s>and that is not always, according to record companies</s> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And yes, we, like real fans, having passed GTA 5 launched <a href="http://gta.helloday.tv/">GTA Radio</a> with a set of all radio stations from all parts of this wonderful game.  Enjoy <s>everything for you</s> , and for those who are interested to make a similar player, please under the cat. <br><br><a name="habracut"></a><br><br>  In the case of GTA, it was necessary to see a couple of controversial issues with the copyright and the storage of music.  Yes, it would be convenient to simply make a player to mp3, but first it would be necessary to decide how to make a quick download, and secondly - what to do if the copyright holders want to write to us.  YouTube came to the rescue: it gives and storage of music, and settles all issues with copyright.  You just had to gently hide the player so that it does not hang out before your eyes.  Naturally, this gave a small number of problems: there was a little more traffic for end users, mobile devices ceased to be supported, and, unfortunately, safari 7 with its cunning power saving settings. <br><br>  The YouTube player has a rather inconvenient, but quite functional API: in addition to controlling the volume, position in the track, start-pause, it turned out that there is still the possibility of replacing the currently playing track via loadVideoByUrl.  At first, we simply re-created the instance for each new track, but this significantly altered the memory, and only then realized to check the documentation and find a way not to restart the flash for each new track. <br><br>  There are more than one hundred guides on how to use your YouTube player on the Internet, so there‚Äôs really no point in retelling how their player‚Äôs approach to browser events and native events differs, how to start and end a track, how to catch when a player really ready and can play and so on - this has all been discussed a hundred times by people who have used YouTube to create their own video sites. <br><br>  Another thing is important: that few people used it for an audio player.  Although the opportunity is really good: YT has really fast loading (thanks for CDN all over the world), seemingly good codecs, excellent compression (if you don‚Äôt let the video, but the static image - the song fits in a few MB without serious loss in quality) , and he also gives the opportunity to remove a bunch of questions from the owners, <s>more precisely, to shift them to Google</s> . <br><br>  We at <a href="http://uprock.pro/">Uprock</a> do not like to do a simple backend, if we do it, then something global, solid, weighty, high-load there, or integration with the real world, but simply storing data is actually much simpler in JSON.  Therefore - yes, there is an admin panel, but it edits JSON, which connects directly through browserify for faster page loading, so formally there is no backend on it.  But there is nginx, which on any non-existent page gives index.html, in which the magic begins. <br><br>  On the frontend, we often have an honest Stateless reigning here and now: absolutely everything on the site is resolved through routing (thanks page.js).  Why is this cool?  Yes, because instead of catching events, the developer simply puts the usual links, such as a transition to this: <br><br><pre><code class="javascript hljs">&lt;a href=<span class="hljs-string"><span class="hljs-string">"/GTA-San-Andreas"</span></span>&gt;GTA San Andreas&lt;<span class="hljs-regexp"><span class="hljs-regexp">/a&gt;</span></span></code> </pre> <br><br>  Turn on a random radio from GTA San Andreas, and at the same time change the background.  Although not really.  The only thing that will make the transition on this link - it vytsepit the names of all stations in the list of radio for GTA San Andreas, and then will transfer the user to a random space, for example, <a href="http://gta.helloday.tv/GTA-San-Andreas/Radio-X">Radio X</a> Do you think music will start playing there?  No, they did not guess.  The controller for the radio also simply makes a redirect, already to, say, <a href="http://gta.helloday.tv/GTA-San-Andreas/Radio-X/Faith-No-More---Midlife-Crisis">Faith No More,</a> and even then the background will change, and the music will start playing. <br><br>  Why do you need it?  First, it isolates the code well.  The part of the code that deals with the random selection of the station and the track does not interact with the part of the code associated with the render.  They can not influence each other, each part is engaged in its own business.  Secondly, it makes the code more logical.  If you cut out some of the details related to the render, alerts, remembering the last playing track, and so on - the whole code looks like this (the transition between pages is changed to document.location.hash for readability): <br><br><pre> <code class="javascript hljs">page(<span class="hljs-string"><span class="hljs-string">'/:game/:station/:track'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx, next</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> track = trackDetector(ctx.params); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ctx.path != getTrackUrl(track)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next(); <span class="hljs-comment"><span class="hljs-comment">//    player.onComplete = function () { document.location.hash = getTrackUrl(track.station.getNextTrack()); }; player.play(track); }); '/:game/:station/:track' .split('/') .map(function (record, id, array) { return array.slice(0, id + 1).join('/'); }) .reverse() .forEach(function (path) { page(path, function(){ document.location.hash = getTrackUrl(trackDetector(ctx.params)); }); });</span></span></code> </pre><br><br>  If the last part is incomprehensible to someone, it can be rewritten as <br><br><pre> <code class="javascript hljs">page(<span class="hljs-string"><span class="hljs-string">'/:game/:station/:track'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.location.hash = getTrackUrl(trackDetector(ctx.params)); }); page(<span class="hljs-string"><span class="hljs-string">'/:game/:station'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.location.hash = getTrackUrl(trackDetector(ctx.params)); }); page(<span class="hljs-string"><span class="hljs-string">'/:game'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.location.hash = getTrackUrl(trackDetector(ctx.params)); }); page(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.location.hash = getTrackUrl(trackDetector(ctx.params)); });</code> </pre><br><br>  As a result, we get a universal logical scenario: if a suitable track is not found, we try to go down to the station, to the game, then to the root, and if the suitable track does not exist, we make the transition to any randomly suitable track. <br><br>  In reality, what happens here is called the actor model. <br><br>  Why is it really necessary?  This gives us the opportunity to rely on the fact that the desired track exists, and make the transition to / GTA-San-Andreas / Radio-X, knowing that the track will not be found, but the error will be intercepted, and we will find some A suitable track from Radio X. <br><br>  What would it look like in normal code?  Well, something like this: <br><br><pre> <code class="javascript hljs">page(<span class="hljs-string"><span class="hljs-string">'/:game'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (glob.games[ctx.params.game]) { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.location.href = <span class="hljs-string"><span class="hljs-string">'/'</span></span>+ctx.params.game+<span class="hljs-string"><span class="hljs-string">'/'</span></span>+glob.games[ctx.params.game].stations.getRandom(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.location.href = <span class="hljs-string"><span class="hljs-string">'/'</span></span>+glob.games.getRandom()+<span class="hljs-string"><span class="hljs-string">'/'</span></span>; } })</code> </pre><br><br>  Tell me honestly, do not you think that this is somehow bloated and inefficient? <br><br>  And now let's get a little into the theory.  The model of actors was invented in the seventies for maximum efficiency of parallel computations.  Then the computers were not only large, but also connected to large networks spread across the country.  About this time there is a wonderful, relatively short story of Stanislav Lem "137 seconds."  There is a very clear understanding of how weak individual machines were, and how much people wanted to believe that by combining them all into one big network, they would get something incredible, for example, a prediction of the future. <br><br>  The meaning is very simple: there are autonomous entities that may or may not work.  They respond to incoming connections and can exchange messages with other entities they know about. <br><br>  This is not to say that it was a bad idea, autonomous parrellelism is experiencing another birth every time another technology for parallel computing appears. <br><br>  On the actors, text quests were built: the user focus was exchanged between the actors, each actor corresponded to a specific location.  All of them existed simultaneously, and in the Unreal Engine any full-fledged entity, be it npc or a wall, is an actor, an autonomous element. <br><br>  But text quests are actually a special case of the so-called abstract automaton.  Actors are used in a huge number of tasks, ranging from modeling the behavior of groups and ending with a web server: each of the actors corresponds to its resource, and simply processes incoming messages, if necessary, passing them on. <br><br>  But how does the actor really differ from just another parallel process in the system?  Firstly, it does not have to be in the system and does not have to be parallel: the actors just exchange messages.  Whether they are on the same machine or not, whether they are processed sequentially or in parallel is unimportant.  Moreover, this is a mandatory requirement for the model of actors: the developer should not expect messages to come in turn.  Only implementation is allowed (but not required), which guarantees that the messages that actor 1 sends to actor 2 will come in the same order as they were sent. <br><br>  So, we got to the most interesting: why it is needed. <br><br>  Imagine, you are a front-end vendor, and you finally began to feel that your ‚Äúbig‚Äù application can no longer remain whole: you have forgotten to create directives or widgets, are tired of arranging the structure of the entire application and combing it.  You finally began to feel that your application should have a microkernel, stand-alone components, and a pubsub data exchange model.  What else can you give what you know about the actors? <br><br>  Imagine that each of the router controllers does not have direct access to external data.  Generally it does not have: you can initialize it with some standard data set, and indicate that, if necessary, it can make requests to some other actors (for example, a database). <br><br>  Why is it important? <br><br>  Because now the controller can not affect the state of the application.  This is an autonomous entity whose behavior is rigidly clogged, which can be guaranteed to be covered with tests, and which the application cannot influence. <br><br>  Welcome to functional JavaScript. <br><br>  No, this is not a Haskell or a rock: an actor may have an internal state.  But do you need it in the routing, for example?  In most cases, no: default controllers should be stateless. <br><br>  But this is the very same functional that many people are so afraid of trying to build a complex OOP in javaScript, for example, by coming from java.  They don‚Äôt go to a foreign monastery with their samovar, but many try, yes. <br><br>  But the model of actors is not necessarily fully implemented (although it often costs). <br><br>  Yes, we can write something like <br><br><pre> <code class="javascript hljs">page.on(<span class="hljs-string"><span class="hljs-string">'*'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx</span></span></span><span class="hljs-function">)</span></span>{WebActors.send(WebActors.ANY, ctx.params)}); WebActors.spawnWorker(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ WebActors.receive([<span class="hljs-string"><span class="hljs-string">'GTA-san-andreas'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//send(...); }) });</span></span></code> </pre><br><br>  But do you need it?  Yes, it looks cool, perceived, perhaps, even steeper, but in reality, it is often not very convenient.  It is often much easier to simply keep in mind that each callback listener is a worker who possesses some kind of data (objects, functions, constants) that are clogged into it during initialization, and an internal state.  And the maximum that he can do is work with a single interface: render, audio, canvas, essence in WebGL.  All the rest he can do only by exchanging "messages" with other actors and the mediator - an actor who resolves all other actors. <br><br>  Generally speaking, formally speaking, web components are the same actors: autonomous entities that can be pulled for methods and attributes.  Doesn‚Äôt it resemble something? <br><br>  The frontend is slowly moving to become more autonomous.  If you are a frontend developer, you do not need to use the model of actors, but you should at least try and feel it. <br><br>  There is an old phrase that any developer should try OP, OOP, forth, and so on.  Now I would add the model of actors to this list, especially if you are a web developer. </div><p>Source: <a href="https://habr.com/ru/post/220551/">https://habr.com/ru/post/220551/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../220539/index.html">How does the program "Search for IT vulnerabilities" PrivatBank</a></li>
<li><a href="../220541/index.html">HP ProLiant Workshop with 65% discount - May 6-7 in Kiev</a></li>
<li><a href="../220543/index.html">Search VPS - second update: auctions, a place for backups, licenses and reviews about hosts</a></li>
<li><a href="../220547/index.html">Sweet couple from the publisher Peter</a></li>
<li><a href="../220549/index.html">What does ‚Äútoo expensive‚Äù mean?</a></li>
<li><a href="../220553/index.html">Yota has become a mobile operator (and what is a ‚Äúlarge file‚Äù?)</a></li>
<li><a href="../220555/index.html">Overview of open source backup tools</a></li>
<li><a href="../220557/index.html">Parallax Effect (3D) with Lens Blur in Google Camera</a></li>
<li><a href="../220561/index.html">New set to the School of data analysis of Yandex and analysis of the entrance exam</a></li>
<li><a href="../220563/index.html">Game patterns. How to reconcile Bitrix with third-party output template</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>