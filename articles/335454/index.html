<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Reducing the size of the Android build file in Unity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Build size is an important feature of a mobile application. If the application weighs a lot, it will be removed first when cleaning. Also smaller size...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Reducing the size of the Android build file in Unity</h1><div class="post__text post__text-html js-mediator-article">  Build size is an important feature of a mobile application.  If the application weighs a lot, it will be removed first when cleaning.  Also smaller size can speed up launch, install, download. <br><br>  Even an empty project in Unity weighs a lot.  A blank Android project with default settings in Unity 2017.1 weighs 21637 KB.  However, it can be very easily reduced to 11952 \ 12412 KB, specifying a platform for compilation (ARMv7 and x86, respectively). <br><br>  By analogy with this, you can still try to reduce the weight a little more by choosing Graphic API.  If you select OpenGLES2 instead of Auto Graphics API, you can save another 236 KB (11716 instead of 11952).  The benefit is insignificant and a loss in performance is possible, so I do not recommend doing this. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now let's talk about the contents of the project.  Consider a 2D game with lots of sprites. <br>  There are chances that many sprites will be symmetrical along one or more axes. <br><a name="habracut"></a><br>  Let's check if there is an automatic compression for this case: let's compile the scene with the Sprite Renderer exposed with one texture, for example, this one. <br><br><img src="https://habrastorage.org/web/887/91c/afd/88791cafde3a4713bb907db2e88505e6.png"><br><br>  ARMv7 build increased from 11952 KB 12046 KB, the increase from the empty build is 94 KB. <br><br>  Now prepare half the texture: <br><br><img src="https://habrastorage.org/web/5c1/c9f/99e/5c1c9f99eef6498587fc01273b55c32e.png"><br><br>  We put two Sprite Renderer with the same position, at the right we set Flip X for mirroring, in the Sprite Import Settings settings we will specify Pivot Right for combining the mirror halves.  It should turn out the same circle as it was before.  Compile, look at the size: 12000 KB, that is, the increase is almost two times less (48 KB against 94).  If there is any special compression, then by default it is ineffective. <br><br>  In principle, it is already possible to try to mirror all the necessary textures, but in the framework of a larger project it will not be very convenient: you will have to make a half for each object.  This problem can be solved by writing your own shader for horizontal mirroring of the image. <br><br>  Find a standard Unity shader for Sprite Renderer. <br><br><div class="spoiler">  <b class="spoiler_title">Sprites / Default</b> <div class="spoiler_text"><pre><code class="hljs pgsql">Shader "Sprites/Default" { Properties { [PerRendererData] _MainTex ("Sprite Texture", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Color ("Tint", Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) [MaterialToggle] PixelSnap ("Pixel snap", <span class="hljs-type"><span class="hljs-type">Float</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> } SubShader { Tags { "Queue"="Transparent" "IgnoreProjector"="True" "RenderType"="Transparent" "PreviewType"="Plane" "CanUseSpriteAtlas"="True" } Cull <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> Lighting <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> ZWrite <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> Fog { Mode <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> } Blend One OneMinusSrcAlpha Pass { CGPROGRAM #pragma vertex vert #pragma fragment frag #pragma multi_compile DUMMY PIXELSNAP_ON #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "UnityCG.cginc" struct appdata_t { <span class="hljs-type"><span class="hljs-type">float4</span></span> vertex : POSITION; <span class="hljs-type"><span class="hljs-type">float4</span></span> color : COLOR; float2 texcoord : TEXCOORD0; }; struct v2f { <span class="hljs-type"><span class="hljs-type">float4</span></span> vertex : SV_POSITION; fixed4 color : COLOR; half2 texcoord : TEXCOORD0; }; fixed4 _Color; v2f vert(appdata_t <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { v2f <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>.vertex = mul(UNITY_MATRIX_MVP, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.vertex); <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>.texcoord = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord; <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>.color = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.color * _Color; #ifdef PIXELSNAP_ON <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>.vertex = UnityPixelSnap (<span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>.vertex); #endif <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>; } sampler2D _MainTex; fixed4 frag(v2f <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) : SV_Target { fixed4 c = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord) * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.color; c.rgb *= ca; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c; } ENDCG } } }</code> </pre> <br></div></div><br>  Let's start by making sure that everything works.  Create a shader, copy the code into it, change the name in the code to Sprites / HorizontalSymmetry.  Now you need to create the material and select our shader.  Let's try to assign our material to the Sprite Renderer.  Should look like before. <br><br>  Now we analyze the shader.  All the magic happens here: <br><br><pre> <code class="hljs pgsql">fixed4 frag(v2f <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) : SV_Target { //tex2D      . //_MainTex -  , <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord -     <span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> fixed4 c = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord) * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.color; // r,g,b    acrgb *= ca; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c; }</code> </pre><br>  This is a function that should return the color of the pixel at the specified point.  We are given the position, texture, color for mixing.  You should not be afraid of fixed4: it's just a data type with 4 float: r, g, b, a. <br><br>  In the first line we get the color of the texture and then multiply it by a certain color IN.color.  This color is a shader parameter, you can change it in Sprite Renderer / Color. <br><br>  Next comes the color multiplication of alpha.  This is due to the fact that transparency depends not only on alpha, but also on the value of rgb.  For a better understanding of the color space, you can examine: <br><br><pre> <code class="hljs swift">fixed4 frag(v2f <span class="hljs-type"><span class="hljs-type">IN</span></span>) : <span class="hljs-type"><span class="hljs-type">SV_Target</span></span> { fixed4 <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = tex2D(_MainTex, <span class="hljs-type"><span class="hljs-type">IN</span></span>.texcoord) * <span class="hljs-type"><span class="hljs-type">IN</span></span>.color; <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>.rgb=<span class="hljs-number"><span class="hljs-number">0.5</span></span>; ca = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>; }</code> </pre><br>  We get a transparent gray texture.  With rgb = 1 and a = 0 it will be opaque white, with rgb = 0 and a = 0 fully transparent, rgb = 0 and a = 1 will be black opaque. <br><br>  If everything worked out, then we will try now to make horizontal mirroring.  We need to change this function so that in the first half of the image the whole texture is placed, in the second, the same texture but mirrored. <br><br>  This problem can be solved in the forehead: <br><br><pre> <code class="hljs pgsql">fixed4 frag(v2f <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) : SV_Target { //      fixed2 nIn = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord; //    <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.2</span></span> nIn.x = nIn.x*<span class="hljs-number"><span class="hljs-number">2</span></span>; //   ,   <span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nIn.r&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>) nIn.r = <span class="hljs-number"><span class="hljs-number">2</span></span>-nIn. //    fixed4 c = tex2D(_MainTex, nIN.texcoord) * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.color; // r,g,b    acrgb *= ca; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c; }</code> </pre><br>  If you think a little, you can make the decision shorter, more beautiful, faster: <br><br><pre> <code class="hljs pgsql">fixed4 frag(v2f <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) : SV_Target { //   <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord.x = <span class="hljs-number"><span class="hljs-number">1</span></span>-abs(<span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord.x<span class="hljs-number"><span class="hljs-number">-1</span></span>); //     fixed4 c = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord) * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.color; // r,g,b    acrgb *= ca; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c; }</code> </pre><br>  As an exercise, I suggest the reader solve this problem for vertical and double symmetry. <br><br>  Sometimes there can be transparency artifacts due to the fact that the sprite is drawn by default on a specific contour (mesh).  It is treated as follows: Sprite / Import Settings / Mesh type = Full Rect. <br><br>  This method is theoretically capable of reducing the size of textures used by 4 times.  Check how the build will behave with a quarter of the sprite (using a double symmetry shader).  The build size is 11978 KB against 12000 (half sprite).  Let me remind you that the empty project weighed 11952 KB.  That is, again, the increase was almost doubled (in 3.6 from the original circle without optimization). <br><br>  However, this is not the limit.  In my game used a large number of washers with radial symmetry.  This means that it is enough to have only one strip in order to set the whole circle!  Moreover, a half strip (radius, not diameter). <br><br>  Prepare the texture: <br><br><img src="https://habrastorage.org/web/4f4/653/19c/4f465319c10248a8aef0aa5d6133f82e.png"><br>  Now it's up to the shader.  Our task is to make a circle from the line. <br><br>  You can do this: find the distance of the current point from the center and use the texture coordinate with the position (1-distance * 2, 0).  Multiplication by two occurs because the maximum distance from the center is 0.5, not 1. We subtract from the unit because the texture is prepared on the left (edge ‚Äã‚Äãof the circle) to the right (center of the circle). <br><br>  Example of implementation: <br><br><pre> <code class="hljs pgsql">fixed4 frag(v2f <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) : SV_Target { fixed2 nIn = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord; nIn.x = nIn.x<span class="hljs-number"><span class="hljs-number">-0.5</span></span>; nIn.y = nIn.y<span class="hljs-number"><span class="hljs-number">-0.5</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> dist = sqrt(nIn.x*nIn.x+nIn.y*nIn.y); <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord.x = <span class="hljs-number"><span class="hljs-number">1</span></span>-dist*<span class="hljs-number"><span class="hljs-number">2</span></span>; fixed4 c = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord) * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.color; c.rgb *= ca; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c; }</code> </pre><br>  <i>Note: since the root is calculated here, the shader will work slower than the full circular image</i> <br><br>  Create a material, put it in the Sprite Renderer, set the Sprite = line, look.  The image will be very narrow, so you need to stretch the sprite (set a large value Trasnform.Scale.y).  It should make the original circle \ oval. <br><br>  Check the size of the build with a new shader and a circle from the strip: it turned out 11957 KB.  That is, the increment from an empty project is only 5 KB, and that includes the size of the shader. <br><br>  As a result, we have a handy tool, with which in some cases you can significantly reduce the size of the build.  It is suitable not only for Android, but also for any platform supporting shaders. </div><p>Source: <a href="https://habr.com/ru/post/335454/">https://habr.com/ru/post/335454/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335444/index.html">We teach the robot to cook pizza. Part 1: Getting the Data</a></li>
<li><a href="../335446/index.html">How to set up teamwork and keep calm in the Telegram chat rooms, if everything is burning, and everything is in hell</a></li>
<li><a href="../335448/index.html">Blocking operations as malware protection</a></li>
<li><a href="../335450/index.html">What can you learn about the apartment from the open directories</a></li>
<li><a href="../335452/index.html">Tutorial: ToDo Spring and ReactJS web apps</a></li>
<li><a href="../335458/index.html">How to find out your external IP from the program</a></li>
<li><a href="../335460/index.html">Friday: to the community</a></li>
<li><a href="../335464/index.html">Create a self-contained Docker cluster</a></li>
<li><a href="../335466/index.html">Apollo Link. Customize GraphQL client "for yourself"</a></li>
<li><a href="../335468/index.html">IOTV - a simple HTTP protocol for working with messages and commands of IOT objects in the VIALATM service</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>