<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cach√© audit log analysis using Cach√© (DeepSee)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The delivery of Cach√© DBMS, in addition to the database server itself, includes the technology for real-time business intelligence DeepSee. Using it i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cach√© audit log analysis using Cach√© (DeepSee)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/709/a37/13f/709a3713f624487f91ccd9e6dfda7fcc.png" align="left">  The delivery of Cach√© DBMS, in addition to the database server itself, includes the technology for real-time business intelligence DeepSee.  Using it is the fastest way to add OLAP functionality to your Cach√© application. <br><br>  Another element of the installation is an audit subsystem with a web-interface, the ability to extend its own event types and APIs for use in application code. <br><br>  Under the cat - a small example of sharing these subsystems, allowing you to answer questions - who, what, when did in the information system? <br><a name="habracut"></a><br><h3>  Audit subsystem </h3><br>  Designed to register events occurring in the system.  There is a ready-made web interface in the Cach√© system management portal - search, filtering, export, cleaning, etc.  You can use audit in the application code using the API - Security.Events classes - for registering event types,% SYS.Audit - events themselves,% SYSTEM.Security: Audit () is a convenient method for registering events.  By default, the audit subsystem is inactive, launched through: Management Portal - System Administration - Security - Audit. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Below is an example of a page with several buttons that are clicked on are registered in the audit base. <br><div class="spoiler">  <b class="spoiler_title">An example of the use of auditing in the application code</b> <div class="spoiler_text">  <font color="#8c868f">///</font> <font color="#8c868f">An example of the use of the audit subsystem in the application code</font> <br>  <font color="#3b5bb5">Class</font> <font color="#3b5bb5">habra.audit</font> <font color="#3b5bb5">Extends</font> <font color="#3b5bb5">% CSP.Page</font> <font color="#000000">{</font> <br><br>  <font color="#8c868f">///</font> <font color="#8c868f">Registration of application (user) event types</font> <br>  <font color="#3b5bb5">ClassMethod</font> <font color="#000000">EventTypesRegister ()</font> <font color="#3b5bb5">As</font> <font color="#3b5bb5">% Status</font> <font color="#000000">{</font> <br>  <font color="#8c868f">#;</font>  <font color="#8c868f">Event types are registered through a class from the% SYS system area.</font> <br>  <font color="#ff7800">set</font> <font color="#000000">ns</font> <font color="#3b5bb5">=</font> <font color="#3b5bb5">$ namespace</font> <font color="#000000">,</font> <font color="#3b5bb5">$ namespace</font> <font color="#3b5bb5">=</font> <font color="#409b1c">"% SYS"</font> <br><br>  <font color="#8c868f">#;</font>  <font color="#8c868f">set status = ## class (Security.Events) .Create (Source, Type, Name, Description)</font> <br>  <font color="#ff7800">set</font> <font color="#000000">statusC</font> <font color="#3b5bb5">=</font> <font color="#671ebb">## class</font> <font color="#000000">(</font> <font color="#3b5bb5">Security.Events</font> <font color="#000000">)</font> <font color="#3b5bb5">.Create</font> <font color="#000000">(</font> <font color="#409b1c">"habra"</font> <font color="#000000">,</font> <font color="#409b1c">"audit"</font> <font color="#000000">,</font> <font color="#409b1c">"create"</font> <font color="#000000">,</font> <font color="#409b1c">"Create event example"</font> <font color="#000000">)</font> <br>  <font color="#ff7800">set</font> <font color="#000000">statusR</font> <font color="#3b5bb5">=</font> <font color="#671ebb">## class</font> <font color="#000000">(</font> <font color="#3b5bb5">Security.Events</font> <font color="#000000">)</font> <font color="#3b5bb5">.Create</font> <font color="#000000">(</font> <font color="#409b1c">"habra"</font> <font color="#000000">,</font> <font color="#409b1c">"audit"</font> <font color="#000000">,</font> <font color="#409b1c">"read"</font> <font color="#000000">,</font> <font color="#409b1c">"Read event example"</font> <font color="#000000">)</font> <br>  <font color="#ff7800">set</font> <font color="#000000">statusU</font> <font color="#3b5bb5">=</font> <font color="#671ebb">## class</font> <font color="#000000">(</font> <font color="#3b5bb5">Security.Events</font> <font color="#000000">)</font> <font color="#3b5bb5">.Create</font> <font color="#000000">(</font> <font color="#409b1c">"habra"</font> <font color="#000000">,</font> <font color="#409b1c">"audit"</font> <font color="#000000">,</font> <font color="#409b1c">"update"</font> <font color="#000000">,</font> <font color="#409b1c">"Update event example"</font> <font color="#000000">)</font> <br>  <font color="#ff7800">set</font> <font color="#000000">statusD</font> <font color="#3b5bb5">=</font> <font color="#671ebb">## class</font> <font color="#000000">(</font> <font color="#3b5bb5">Security.Events</font> <font color="#000000">)</font> <font color="#3b5bb5">.Create</font> <font color="#000000">(</font> <font color="#409b1c">"habra"</font> <font color="#000000">,</font> <font color="#409b1c">"audit"</font> <font color="#000000">,</font> <font color="#409b1c">"delete"</font> <font color="#000000">,</font> <font color="#409b1c">"Delete event example"</font> <font color="#000000">)</font> <br><br>  <font color="#ff7800">set</font> <font color="#3b5bb5">$ namespace</font> <font color="#3b5bb5">=</font> <font color="#000000">ns</font> <br>  <font color="#ff7800">set</font> <font color="#000000">status</font> <font color="#3b5bb5">=</font> <font color="#000000">(statusC</font> <font color="#3b5bb5">&amp;&amp;</font> <font color="#000000">statusR</font> <font color="#3b5bb5">&amp;&amp;</font> <font color="#000000">statusU</font> <font color="#3b5bb5">&amp;&amp;</font> <font color="#000000">statusD)</font> <br><br>  <font color="#ff7800">Quit</font> <font color="#000000">status</font> <br>  <font color="#000000">}</font> <br><br>  <font color="#8c868f">///</font> <font color="#8c868f">A simple page with a few buttons.</font> <br>  <font color="#3b5bb5">ClassMethod</font> <font color="#000000">OnPage ()</font> <font color="#3b5bb5">As</font> <font color="#3b5bb5">% Status</font> <font color="#000000">{</font> <br><br>  <font color="#671ebb">&amp; html &lt;&lt;</font> <font color="#000000">! DOCTYPE html&gt; &lt;</font> <font color="#7f90aa">html</font> <font color="#000000">&gt; &lt;</font> <font color="#7f90aa">head</font> <font color="#000000">&gt; &lt;/</font> <font color="#7f90aa">head</font> <font color="#000000">&gt; &lt;</font> <font color="#7f90aa">body</font> <font color="#000000">&gt;</font> <br><br>  <font color="#000000">&lt;</font> <font color="#7f90aa">h3</font> <font color="#000000">&gt; Hello, # (</font> <font color="#3b5bb5">$ username</font> <font color="#000000">) #! &lt;/</font> <font color="#7f90aa">h3</font> <font color="#000000">&gt; &lt;</font> <font color="#7f90aa">hr</font> <font color="#000000">&gt;</font> <br><br>  <font color="#000000">&lt;</font> <font color="#7f90aa">form</font> <font color="#7f90aa">method</font> <font color="#000000">=</font> <font color="#409b1c">'post'</font> <font color="#000000">&gt;</font> <br>  <font color="#000000">&lt;</font> <font color="#7f90aa">button</font> <font color="#7f90aa">name</font> <font color="#000000">=</font> <font color="#409b1c">'create'</font> <font color="#000000">&gt; Create &lt;/</font> <font color="#7f90aa">button</font> <font color="#000000">&gt;</font> <br>  <font color="#000000">&lt;</font> <font color="#7f90aa">button</font> <font color="#7f90aa">name</font> <font color="#000000">=</font> <font color="#409b1c">'read'</font> <font color="#000000">&gt; Read &lt;/</font> <font color="#7f90aa">button</font> <font color="#000000">&gt;</font> <br>  <font color="#000000">&lt;</font> <font color="#7f90aa">button</font> <font color="#7f90aa">name</font> <font color="#000000">=</font> <font color="#409b1c">'update'</font> <font color="#000000">&gt; Update &lt;/</font> <font color="#7f90aa">button</font> <font color="#000000">&gt;</font> <br>  <font color="#000000">&lt;</font> <font color="#7f90aa">button</font> <font color="#7f90aa">name</font> <font color="#000000">=</font> <font color="#409b1c">'delete'</font> <font color="#000000">&gt; Delete &lt;/</font> <font color="#7f90aa">button</font> <font color="#000000">&gt;</font> <br>  <font color="#000000">&lt;/</font> <font color="#7f90aa">form</font> <font color="#000000">&gt;</font> <br><br>  <font color="#000000">&lt;/</font> <font color="#7f90aa">body</font> <font color="#000000">&gt; &lt;/</font> <font color="#7f90aa">html</font> <font color="#671ebb">&gt;&gt;</font> <br><br>  <font color="#ff7800">Quit</font> <font color="#3b5bb5">1</font> <br>  <font color="#000000">}</font> <br><br>  <font color="#8c868f">///</font> <font color="#8c868f">Parse form parameters</font> <br>  <font color="#3b5bb5">ClassMethod</font> <font color="#000000">OnPreHTTP ()</font> <font color="#3b5bb5">As</font> <font color="#3b5bb5">% Boolean</font> <font color="#000000">[</font> <font color="#3b5bb5">ServerOnly</font> <font color="#000000">= 1] {</font> <br><br>  <font color="#8c868f">#;</font>  <font color="#8c868f">the form will send to the server the only parameter - the name of the button</font> <br>  <font color="#8c868f">#;</font>  <font color="#8c868f">http: // [server] / [app] / [class]? name =</font> <br>  <font color="#ff7800">set</font> <font color="#000000">name</font> <font color="#3b5bb5">=</font> <font color="#3b5bb5">$ order</font> <font color="#000000">(% request</font> <font color="#3b5bb5">.Data</font> <font color="#000000">(</font> <font color="#409b1c">""</font> <font color="#000000">))</font> <font color="#8c868f">;</font>  <font color="#8c868f">find out which button caused the send</font> <br><br>  <font color="#8c868f">#;</font>  <font color="#8c868f">save to audit log (Source, Type, Name, EventData, Description)</font> <br>  <font color="#ff7800">set</font> <font color="#000000">status</font> <font color="#3b5bb5">=</font> <font color="#671ebb">## class</font> <font color="#000000">(</font> <font color="#3b5bb5">% SYSTEM.Security</font> <font color="#000000">)</font> <font color="#3b5bb5">.Audit</font> <font color="#000000">(</font> <font color="#409b1c">"habra"</font> <font color="#000000">,</font> <font color="#409b1c">"audit"</font> <font color="#000000">, name,</font> <font color="#409b1c">"pressed the button"</font> <font color="#000000">,</font> <font color="#409b1c">"1984"</font> <font color="#000000">)</font> <br><br>  <font color="#ff7800">Quit</font> <font color="#3b5bb5">1</font> <br>  <font color="#000000">}</font> <br><br>  <font color="#000000">}</font> <br></div></div><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/JE75_cypRJM%3Ffeature%3Doembed&amp;xid=17259,15700023,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjRMnOJ0-ZOgd9w-FRFZj-vmmHCOA" frameborder="0" allowfullscreen=""></iframe><br><br><h3>  DeepSee Business Intelligence Technology </h3><br>  DeepSee includes a variety of tools for building data warehouses, analyzing and visualizing data, user portal, reports, printing, export, etc.  Uses Cach√© security and audit subsystems.  There are various ways to organize DeepSee integration with almost any application - from the terminal to the web. <br><br>  One of the features of DeepSee is the possibility of analytics on operational data.  Achieved through background cube synchronization with your application data.  To do this, the DSTIME and DSINTERVAL <a href="">parameters</a> are defined in the data class.  When compiling a class, Cach√© generates an additional change-registration code.  When synchronization starts, only a small part of the cube data is updated, and the synchronization can be performed immediately after the changes in the OLTP classes, which makes it possible to speak of ‚Äúreal-time‚Äù business analysis. <br><br>  To use the background cube update in our example, you need to add the DSTIME and DSINTERVAL parameters to the% SYS.Audit system class and compile it. <br><div class="spoiler">  <b class="spoiler_title">Changes in% SYS.Audit</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/f20/387/df6/f20387df62b34f12b5fbdce7431b290c.png"></div></div><br><br><h3>  Together </h3><br>  After pre-setting the region (it is necessary to enable the global display ^ CacheAuditD) and the corresponding configuration of the web application for working with DeepSee, we proceed to the definition of the cube. <br><br>  We specify the source class with the data.  Class properties will form the basis for defining cube dimensions.  In the% SYS.Audit class, the Username, Event, UTCTimeStamp properties store information for answering the questions posed at the beginning of the article.  Based on the Username property, we define the Who dimension, the Event properties ‚Äî the What dimension, the UTCTimeStamp properties ‚Äî the When dimension.  The default measure is the number of entries. <br><br>  After compiling and initial filling of the cube, various data slices (pivot tables) are configured in DeepSee Analyzer.  They, in turn, become a source of data for visual components - widgets.  Widgets are combined into display panels (dashboard) and provide access to them for users.  The user portal allows organizing the work of users with display panels <abbr title=";)">without programming</abbr> . <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/ZLJiw18-Fb4%3Ffeature%3Doembed&amp;xid=17259,15700023,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjAr4xvcSA5rRUMlLjPYXl-RWXzeg" frameborder="0" allowfullscreen=""></iframe><br><br>  Based on the analysis of the audit log, you can easily see that one user is more likely to delete data in the system than another.  On a real system, with a large number of events and users, this information would be difficult to identify by simply viewing the audit log.  By including additional data in the cube, you can get a lot of other ‚Äúinteresting‚Äù information about the work of users in the system.  The main thing is to be able to ask the right questions. <br><img src="https://habrastorage.org/files/d3c/092/ae5/d3c092ae5bc34394b1c1b8a7cb8ccb33.png"><br><br>  Useful links: <br>  <a href="http://intersystems.ru/deepsee/index.html">more about DeepSee</a> <br>  <a href="https://github.com/intersystems-ru/deepseeaudit">example sources</a> <br>  <a href="https://github.com/intersystems-ru/DeepSeeMobile">display of the DeepSee portal on mobile devices</a> </div><p>Source: <a href="https://habr.com/ru/post/258289/">https://habr.com/ru/post/258289/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258279/index.html">Minimal mail server based on Postfix and Dovecot. Part 1: Dovecot</a></li>
<li><a href="../258281/index.html">Release of a new version of WordPress 4.2 Powell and a security breach</a></li>
<li><a href="../258283/index.html">Install AirSlax on a virtual machine. Work with WiFi</a></li>
<li><a href="../258285/index.html">What is TLS</a></li>
<li><a href="../258287/index.html">Habrahabr appropriated to everyone according to the ‚Äúdog‚Äù</a></li>
<li><a href="../258291/index.html">Lamp-rainbow do it yourself</a></li>
<li><a href="../258293/index.html">Object Storage - The Near Future of Storage Systems</a></li>
<li><a href="../258295/index.html">Do-it-yourself analysis of links in a project</a></li>
<li><a href="../258297/index.html">Commercial site security research</a></li>
<li><a href="../258301/index.html">50+ Best Bootstrap Add-ons</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>