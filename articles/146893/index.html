<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Localization of projects written using Catalyst MVC Framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suppose there are still desperate comrades studying and proving the advantages of Perl over other web development tools. More rarely, among them are t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Localization of projects written using Catalyst MVC Framework</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/6f3/4da/b75/6f34dab7503ba0a96deb649c898ef04f.png" alt="Catalyst Web Framework" align="right">  Suppose there are still desperate comrades studying and proving the advantages of Perl over other web development tools.  More rarely, among them are those who rated the Catalyst framework without fearing the lack of documentation in Russian.  I believe that those who are interested in this post are already familiar with how to create a new project, add missing parts to <code>View</code> <abbr title="Template toolkit">TT</abbr> and install the <code>CPAN</code> . <br><br>  I believe that one of the most important factors separating manual crafts from the program is its localization.  For this reason, starting to learn a new platform, after studying ideology, I find out the mechanism of localization. <br><br>  Since Perl means <code>gettext</code> , but not everything is so simple.  Let's go to practice. <br><a name="habracut"></a><br><h4>  Project preparation </h4><br>  To begin with, we will create a new project or open an existing one, say <code>MyApp</code> .  Take the <a href="">update_po.sh</a> script from the MojoMojo project and put it in the <code>./script</code> project <code>./script</code> .  In order for this script to become suitable, it is necessary to do the following manipulation on it, I hope none of the authors will not mind. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We make the replacement of <code>MOJOMOJO_DIR</code> with <code>PROJECT_DIR</code> in the whole file. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Default setting PERL_DEFAULT=`which perl` PROJECT_DIR="." PROJECT_NAME="MyApp"</span></span></code> </pre><br>  Add a local variable <code>PROJECT_NAME</code> with the name of your project and make a replacement in the entire <code>MojoMojo</code> file with <code>$PROJECT_NAME</code> . <br><br>  For the operation of this script, another <a href="http://code.google.com/p/asynapse/source/browse/trunk/perl/Asynapse/bin/po2json.pl%3Fr%3D116">po2json.pl</a> program is <a href="http://code.google.com/p/asynapse/source/browse/trunk/perl/Asynapse/bin/po2json.pl%3Fr%3D116">needed</a> , it is saved in <code>./script</code> .  Both files are executable. <div class="spoiler">  <b class="spoiler_title">UPD</b> <div class="spoiler_text">  The <code>po2json</code> script is part of the module <code>Locale::Simple</code> <br></div></div><br><br>  If you look at the <code>update_po.sh</code> code, you can see that the collection of strings for localization occurs in the following files and directories: <br><ul><li>  ./lib/[MyApp] - project source directory </li><li>  ./lib/[MyApp[.pm </li><li>  ./root/forms - CRUD templates </li><li>  ./root/base - TT templates, more correctly select a separate directory for them </li><li>  ./root/static/js - javascript scripts </li></ul><br>  If necessary, the script can be corrected for your projects. <br>  Create a directory <code>./lib/MyApp/I18N</code> , it will be our <code>.po</code> files.  If we use javascript, then we need to create a directory <code>./root/static/json</code> . <br><br><h4>  Code and settings </h4><br>  We add View :: TT, we name class HTML.  If we have an existing project with our own presentation, we can skip this item. <br><pre> <code class="bash hljs"> $ ./script/myapp_create.pl view HTML TT</code> </pre><br>  This command creates a file <code>./lib/MyApp/View/HTML.pm</code> .  In its configuration section, add a path that will indicate where the templates will be located: <br><pre> <code class="perl hljs">__PACKAGE_<span class="hljs-number"><span class="hljs-number">_</span></span>-&gt;config( <span class="hljs-string"><span class="hljs-string">TEMPLATE_EXTENSION =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'.tt'</span></span>, <span class="hljs-string"><span class="hljs-string">INCLUDE_PATH =&gt;</span></span> [ MyApp-&gt;path_to(<span class="hljs-string"><span class="hljs-string">'root'</span></span>, <span class="hljs-string"><span class="hljs-string">'base'</span></span>), ], <span class="hljs-string"><span class="hljs-string">render_die =&gt;</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, );</code> </pre><br>  For simplicity in <code>./lib/MyApp.pm</code> we do this default view: <br><pre> <code class="perl hljs">__PACKAGE_<span class="hljs-number"><span class="hljs-number">_</span></span>-&gt;config( <span class="hljs-string"><span class="hljs-string">name =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'MyApp'</span></span>, <span class="hljs-string"><span class="hljs-string">default_view =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'HTML'</span></span>, <span class="hljs-string"><span class="hljs-string">'View::HTML'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">ENCODING =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'UTF-8'</span></span>, }, ...</code> </pre><br>  and in the plug-in declaration, add <code>I18N</code> and <code>Unicode</code> : <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> Catalyst <span class="hljs-keyword"><span class="hljs-keyword">qw</span></span>/ -Debug ConfigLoader Static::Simple I18N Unicode ...</code> </pre><br>  The <code>I18N</code> plugin adds <code>loc()</code> or <code>localize()</code> to the project.  About other features you can read here <a href="">Catalyst :: Plugin :: I18N</a> . <br><br>  We proceed to the design of the first localized page.  Let's try two call options at the same time.  The first one transfers the line from the controller to the template using the <code>stash</code> tool, we will display it in the page header.  The second reflects the line in the body of the page by means of the function call in the template engine. <br>  Modify the function responsible for the root page in <code>./lib/MyApp/Controller/Root.pm</code> : <br><pre> <code class="perl hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function"> :</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Path</span></span></span><span class="hljs-function"> :</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Args</span></span></span></span>(0) { <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> ( $self, $c ) = @_; $c-&gt;stash-&gt;{title} = $c-&gt;loc("Home Page"); }</code> </pre><br>  Create a template for our index page <code>./root/base/index.tt</code> <br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>[% title %]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> [% c.loc("Hello World!") %] <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  We start and check.  If errors have occurred: fix / reload modules with CPAN. <br><br>  Now go to the translation of our page.  We create empty files for Russian and, say, German localization: <br><pre> <code class="bash hljs"> $ touch ./lib/MyApp/I18N/ru.po ./lib/MyApp/I18N/de.po</code> </pre><br>  and fill them with the script, which was discussed at the beginning of the article: <br><pre> <code class="bash hljs"> $ ./script/update_po.sh ru de</code> </pre>  If any errors occur, add the missing modules to the CPAN. <br><br>  Now edit these files using the example of the ‚Äúnative‚Äù: <br><pre> <code class="perl hljs"><span class="hljs-string"><span class="hljs-string">"Content-Type: text/plain; charset=utf-8\n"</span></span> <span class="hljs-string"><span class="hljs-string">"Content-Transfer-Encoding: 8bit\n"</span></span> <span class="hljs-string"><span class="hljs-string">"Language: ru\n"</span></span> <span class="hljs-comment"><span class="hljs-comment">#: root/base/index.tt:8 msgid "Hello World!" msgstr " !" #: lib/MyApp/Controller/Root.pm:32 msgid "Home Page" msgstr " "</span></span></code> </pre><br>  save, restart the server and go to the page.  If the Russian language is your priority in your browser, then your acquaintances from the first class should caress your eyes. <br><br>  If the project source code is <code>update_po.sh</code> restart <code>update_po.sh</code> with the <code>update_po.sh</code> languages, the old data in the <code>.po</code> files is saved. <br><br><h4>  Database </h4><br>  For correct storage and use of localized information in View, it is necessary for the driver, when connected to the database, to report that the information is transmitted in utf8.  To do this, in the connection configuration, specify a parameter equal to one, which is different for each SQL database: sqlite_unicode, mysql_enable_utf8, pg_enable_utf8, odbc_utf8_on, etc. <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Model::DB</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connect_info</span></span></span><span class="hljs-tag">&gt;</span></span> dsn dbi:mysql:database user username password password mysql_enable_utf8 1 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connect_info</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Model::DB</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  See the documentation for the DBI driver for details. <br><br><h4>  Crutches </h4><br>  If we output already localized information via <abbr title="Template toolkit">TT</abbr> , for example, from a database or a text file, then we are very likely to see krakozyabry.  To cure us, this function will help: <br><pre> <code class="perl hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enc</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> ( $self, $str ) = @_; utf8::decode($str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $str; }</code> </pre><br>  we insert it into <code>./lib/MyApp.pm</code> , respectively, we can call this function as from <code>perl</code> : <br><pre> <code class="perl hljs"> $c-&gt;stash-&gt;{field} = $c-&gt;enc($data);</code> </pre><br>  so in <abbr title="Template toolkit">TT</abbr> : <br><pre> <code class="html hljs xml"> [% c.enc(list.field) %]</code> </pre><br>  There is another way for <abbr title="Template toolkit">TT</abbr> , is to create a filter.  To do this, you need to define <code>FILTERS</code> in the configuration of the view <code>./lib/MyApp/View/HTML.pm</code> <br><pre> <code class="perl hljs">__PACKAGE_<span class="hljs-number"><span class="hljs-number">_</span></span>-&gt;config( <span class="hljs-string"><span class="hljs-string">TEMPLATE_EXTENSION =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'.tt'</span></span>, <span class="hljs-string"><span class="hljs-string">INCLUDE_PATH =&gt;</span></span> [ MyApp-&gt;path_to(<span class="hljs-string"><span class="hljs-string">'root'</span></span>, <span class="hljs-string"><span class="hljs-string">'base'</span></span>), ], <span class="hljs-string"><span class="hljs-string">render_die =&gt;</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">FILTERS =&gt;</span></span> { <span class="hljs-string"><span class="hljs-string">enc =&gt;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span></span>{ utf8::decode($_[<span class="hljs-number"><span class="hljs-number">0</span></span>]); $_[<span class="hljs-number"><span class="hljs-number">0</span></span>]; }, } );</code> </pre><br>  Called the filter in this way: <br><pre> <code class="html hljs xml"> [% list.field | enc %]</code> </pre><br>  But there is with him some kind of BAG when using data and dbi. <br><br><h4>  Javascript </h4><br>  First of all, you need to add a wrapper function, preferably in the form of a loadable file: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">str</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(locale) === <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) || (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> locale[str] === <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> locale[str] }</code> </pre><br>  and in the page header add the download of the translated localization data <br><pre> <code class="html hljs xml">... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"[% c.uri_for_static('json/') _ c.language _ '.po.json' %]"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Editing of localization files occurs in two stages: call <code>update_po.sh</code> and edit the localization file in <code>./lib/MyApp/I18N</code> ;  call <code>update_po.sh</code> again to update the <code>./root/static/json/[lang].po.json</code> file. <br><br><h4>  PS: </h4><br>  This article covers a very small part of the localization issues of a project for Catalyst, but it is sufficient to start. </div><p>Source: <a href="https://habr.com/ru/post/146893/">https://habr.com/ru/post/146893/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146883/index.html">What percentage of the market can take a tablet on Windows RT in the next 2 years?</a></li>
<li><a href="../146884/index.html">New borders of Moscow</a></li>
<li><a href="../146886/index.html">Online promotion - a spherical horse in a vacuum or why it does not work</a></li>
<li><a href="../146889/index.html">vmd - console application for downloading music from vk.com</a></li>
<li><a href="../146891/index.html">Ubercart shopping cart in popup window. Drupal 6</a></li>
<li><a href="../146894/index.html">Automatic weather station at the cottage</a></li>
<li><a href="../146896/index.html">Using Multiple Persistent Store in Core Data</a></li>
<li><a href="../146897/index.html">The illusion of reality, a note on human engineering</a></li>
<li><a href="../146898/index.html">Artificial Intelligence. Forecast 2029</a></li>
<li><a href="../146899/index.html">Book purchases can be tracked on Google Maps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>