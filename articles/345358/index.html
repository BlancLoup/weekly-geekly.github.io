<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a Christmas animation with Wolfram Language</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Translation of the blog O Tannenbaum Michael Trotta, director of Wolfram | Alpha. 


 This laptop describes how to create an animation of a decorated ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a Christmas animation with Wolfram Language</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/1t/ix/ov/1tixov4giphkfbwsasgjedlvwsq.png"><br><br>  Translation of the blog <a href="http://community.wolfram.com/groups/-/m/t/1248938">O Tannenbaum</a> Michael Trotta, director of Wolfram | Alpha. <br><br><hr><br>  This laptop describes how to create an animation of a decorated Christmas tree that moves its branches in sync with the voices of the music of the German song <a href="https://en.wikipedia.org/wiki/O_Tannenbaum"><i>O Tannenbaum of the</i></a> 16th century (English version - <i>O Christmas Tree</i> ).  One selected branch of the tree will act as a conductor, and the candle will be a baton.  This makes the animation interesting in all the verses.  We will also add some snow and some funny tree movements in the second half of the song.  To see the final design, watch this <a href="https://youtu.be/huKA0kjEcXw">YouTube video</a> : <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/wk/zt/ts/wkzttszjjhyjpfiyo7plwtgykie.png"><br><br>  I implement the animation using the following steps: <br><br><ol><li>  Build a Christmas tree with curved branches, where the branches can be moved smoothly up, down, left and right. </li><li>  Add decorations (colored balls, five-pointed stars) and candles of different colors to the branches.  Allow the jewelry to move relative to the ends of the branches. </li><li>  Convert 4 voices of music to 2D motion based on sound frequencies.  Simulate the conductor's movements synchronized with the music. </li><li>  Simulate the movement of jewelry in the form of a spherical pendulum.  Accounting friction patterns using dissipative function Rayleigh. </li><li>  Add snow for white christmas. </li><li>  Create a branch animation in relation to music. </li></ol><br>  Special thanks to my colleague Andrew Steyhacher for selecting and analyzing music in order to obtain data for the movement of the tree (below the section ‚ÄúFrom music to movements‚Äù).  And thanks to Amy Young for turning animated frames and music into one video clip. <br><br><h3>  Creating a Christmas tree </h3><br><h4>  Tree options </h4><br>  The size of the tree, the overall shape of the tree and the number of branches.  The names of the variables make their meaning obvious. <br><br><pre><code class="hljs delphi"><span class="hljs-comment"><span class="hljs-comment">(* radial branch count *)</span></span> radialBranchCount = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-comment"><span class="hljs-comment">(* vertical branch count *)</span></span> verticalBranchCount = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">(* tree height *)</span></span> treeHeight = <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-comment"><span class="hljs-comment">(* tree width *)</span></span> treeWidth = <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-comment"><span class="hljs-comment">(* plot points for the B-spline surfaces forming the branches *)</span></span> <span class="hljs-comment"><span class="hljs-comment">{Œº, ŒΩ}</span></span> = <span class="hljs-comment"><span class="hljs-comment">{6, 8}</span></span>;</code> </pre> <br>  The colors of the trunk and branches. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">stemColor</span></span> = Directive[Darker[Brown], Lighting -&gt; <span class="hljs-string"><span class="hljs-string">"Neutral"</span></span>, Specularity[Brown, <span class="hljs-number"><span class="hljs-number">20</span></span>]]; <span class="hljs-attribute"><span class="hljs-attribute">branchTopColor</span></span> = RGBColor[<span class="hljs-number"><span class="hljs-number">0</span></span>., <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>]; <span class="hljs-attribute"><span class="hljs-attribute">branchBottomColor</span></span> = RGBColor[<span class="hljs-number"><span class="hljs-number">0</span></span>., <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-attribute"><span class="hljs-attribute">branchSideColor</span></span> = RGBColor[<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.];</code> </pre> <br><h4>  Building a moving tree branch </h4><br>  Each branch has a cross section of a rectangle with varying dimension (depending on the distance from the stem).  The tip of the branch should point slightly upwards in order to have the familiar look of the Christmas tree.  At its widest size, the branch lies close to the cone (trunk).  The variable œÑ defines the up-down and variable œÉ left-right position of the branch tip.  I build a branch from the four surfaces of the B-spline (top, bottom, left, right) to have a smooth appearance with a small number of points defining the surface. <br><br><pre> <code class="hljs 1c">branchTopBottom[ tp_, {hb_, ht_}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>_, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>_}, {rb_, rt_}, R_, {œÉ_, œÑ_}] := Module[{A = -<span class="hljs-number"><span class="hljs-number">0.6</span></span>, Œ≤ = <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>, œÜm, Pm, dirR, dirœÜ, r, P1, P, \[ScriptN], \[ScriptP], x, y, œâ, ‚Ñõ, Œæ, \[ScriptH]s, \[ScriptH]}, œÜm = Mean[{œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>}]; Pm = R {<span class="hljs-built_in"><span class="hljs-built_in">Cos</span></span>[œÜm], <span class="hljs-built_in"><span class="hljs-built_in">Sin</span></span>[œÜm]}; dirR = <span class="hljs-number"><span class="hljs-number">1</span></span>. {<span class="hljs-built_in"><span class="hljs-built_in">Cos</span></span>[œÜm], <span class="hljs-built_in"><span class="hljs-built_in">Sin</span></span>[œÜm]}; dirœÜ = Reverse[dirR] {-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}; r = If[tp == <span class="hljs-string"><span class="hljs-string">"top"</span></span>, rt, rb]; (* move cross section radially away from the stem and contract it *) Table[P1 = {r <span class="hljs-built_in"><span class="hljs-built_in">Cos</span></span>[œÜ], r <span class="hljs-built_in"><span class="hljs-built_in">Sin</span></span>[œÜ]}; Table[P = P1 + s/ŒΩ (Pm - P1); \[ScriptN] = dirœÜ.P; \[ScriptP] = dirR.P; {x, y} = \[ScriptN] <span class="hljs-built_in"><span class="hljs-built_in">Cos</span></span>[ s/ŒΩ Pi/<span class="hljs-number"><span class="hljs-number">2</span></span>]^<span class="hljs-number"><span class="hljs-number">2</span></span> dirœÜ + \[ScriptP] dirR; œâ = œÉ* <span class="hljs-number"><span class="hljs-number">1</span></span>. s/ŒΩ Abs[œÜ<span class="hljs-number"><span class="hljs-number">2</span></span> - œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>]/ radialBranchCount; ‚Ñõ = {{<span class="hljs-built_in"><span class="hljs-built_in">Cos</span></span>[œâ], <span class="hljs-built_in"><span class="hljs-built_in">Sin</span></span>[œâ]}, {-<span class="hljs-built_in"><span class="hljs-built_in">Sin</span></span>[œâ], <span class="hljs-built_in"><span class="hljs-built_in">Cos</span></span>[œâ]}}; {x, y} = ‚Ñõ.{x, y}; Œæ = R s/ŒΩ; \[ScriptH]s = {ht, hb} + {Œæ (AR (R - Œæ) - (hb - ht) (Œ≤ - <span class="hljs-number"><span class="hljs-number">1</span></span>) Œæ), (ht - hb) Œæ^<span class="hljs-number"><span class="hljs-number">2</span></span> Œ≤}/R^<span class="hljs-number"><span class="hljs-number">2</span></span>; \[ScriptH] = If[tp == <span class="hljs-string"><span class="hljs-string">"top"</span></span>, \[ScriptH]s[[<span class="hljs-number"><span class="hljs-number">1</span></span>]], \[ScriptH]s[[<span class="hljs-number"><span class="hljs-number">2</span></span>]]] ; {x, y, \[ScriptH] + œÑ s/ŒΩ (ht - hb)}, {s, <span class="hljs-number"><span class="hljs-number">0</span></span>, ŒΩ}], {œÜ, œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>, (œÜ<span class="hljs-number"><span class="hljs-number">2</span></span> - œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>)/Œº}] <span class="hljs-comment"><span class="hljs-comment">// N ]</span></span></code> </pre> <br>  The radius at height h is only a linear interpolation of the maximum trunk radius and radius 0 in the upper part. <br><br><pre> <code class="hljs go">stemRadius[h_, H_] := (H - h)/H</code> </pre> <cut></cut><br><br>  The sides of the branch are only connecting elements between the upper and lower surfaces. <br><br><pre> <code class="hljs lua">branchOnStem[{{hb_, ht_}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>_, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>_}, R_}, {œÑ_, œÉ_}] := Module[{tBranch, bBranch, sideBranches}, {bBranch, tBranch} = Table[branchTopBottom[p, {hb, ht}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>}, stemRadius[{hb, ht}, treeHeight], R, {œÑ, œÉ}], {p, {<span class="hljs-string"><span class="hljs-string">"top"</span></span>, <span class="hljs-string"><span class="hljs-string">"bottom"</span></span>}}]; sideBranches = Table[BSplineSurface[{tBranch<span class="hljs-string"><span class="hljs-string">[[j]]</span></span>, bBranch<span class="hljs-string"><span class="hljs-string">[[j]]</span></span>}], {j, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>}}]; {branchTopColor, BSplineSurface[tBranch], branchBottomColor, BSplineSurface[bBranch], branchSideColor, sideBranches} ]</code> </pre> <br>  For later use, let's define a function only for the position of the end of the branch. <cut></cut><br><br><pre> <code class="hljs vbscript">branchOnStemEndPoint[ {{hb_, ht_}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>_, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>_}, R_}, {œÉ_, œÑ_}] := Module[{A = <span class="hljs-number"><span class="hljs-number">-0.6</span></span>, Œ≤ = <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>, Pm, dirR, dirœÜ, P, \[ScriptN], \[ScriptP], x, y, œâ, Œæ, \[ScriptH]s, \[ScriptH], œÜ = œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÜm = Mean[{œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>}]}, Pm = R {<span class="hljs-built_in"><span class="hljs-built_in">Cos</span></span>[œÜm], <span class="hljs-built_in"><span class="hljs-built_in">Sin</span></span>[œÜm]}; dirR = {<span class="hljs-built_in"><span class="hljs-built_in">Cos</span></span>[œÜm], <span class="hljs-built_in"><span class="hljs-built_in">Sin</span></span>[œÜm]}; {x, y} = dirR.Pm dirR; œâ = <span class="hljs-number"><span class="hljs-number">1.</span></span> œÉ <span class="hljs-built_in"><span class="hljs-built_in">Abs</span></span>[œÜ<span class="hljs-number"><span class="hljs-number">2</span></span> - œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>]/radialBranchCount; {x, y} = {{<span class="hljs-built_in"><span class="hljs-built_in">Cos</span></span>[œâ], <span class="hljs-built_in"><span class="hljs-built_in">Sin</span></span>[œâ]}, {-<span class="hljs-built_in"><span class="hljs-built_in">Sin</span></span>[œâ], <span class="hljs-built_in"><span class="hljs-built_in">Cos</span></span>[œâ]}}.{x, y}; \[ScriptH]s = {ht, hb} + (ht - hb) {Œ≤ - <span class="hljs-number"><span class="hljs-number">1.</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}; {x, y, \[ScriptH]s[[<span class="hljs-number"><span class="hljs-number">1</span></span>]] + œÑ (ht - hb)} ]</code> </pre> <br>  An interactive demonstration that allows a branch and its end to move as a function of {œÉ, œÑ}. <br><br><pre> <code class="hljs erlang-repl">Manipulate[ Graphics3D[{branchOnStem[{{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {Pi/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>, Pi/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>}, <span class="hljs-number"><span class="hljs-number">1</span></span> + œÅ}, œÉœÑ], Red, Sphere[branchOnStemEndPoint[{{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {Pi/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>, Pi/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>}, <span class="hljs-number"><span class="hljs-number">1</span></span> + œÅ}, œÉœÑ], <span class="hljs-number"><span class="hljs-number">0.05</span></span>]}, PlotRange -&gt; {{-<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>}, {-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}}, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">3.17</span></span>, <span class="hljs-number"><span class="hljs-number">0.85</span></span>, <span class="hljs-number"><span class="hljs-number">0.79</span></span>}], {{œÅ, <span class="hljs-number"><span class="hljs-number">1.6</span></span>, <span class="hljs-string"><span class="hljs-string">"branch length"</span></span>}, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, ImageSize -&gt; Small}, {{œÉœÑ, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-string"><span class="hljs-string">"branch\nleft/right\nup/down"</span></span>}, {-<span class="hljs-number"><span class="hljs-number">1</span></span>, -<span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}}, ControlPlacement -&gt; Left, SaveDefinitions -&gt; True]</code> </pre> <br><img src="https://habrastorage.org/webt/rk/av/qr/rkavqrf5-cgthc4qrpq3ogfd2fo.png"><br><br><h4>  Adding branches to the trunk </h4><cut></cut><br><br>  The trunk is just a cone, the top of which is the top of the tree. <br><br><pre> <code class="hljs django"><span class="xml"><span class="xml">stem = Cone[</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{0, 0, 0}, {0, 0, treeHeight}}</span></span><span class="xml"><span class="xml">, 1];</span></span></code> </pre> <br>  The size of the branches decreases with height, becoming geometrically smaller.  The total number of all levels of branches is equal to the height of the tree minus part of the step below. <br><br><pre> <code class="hljs lua">heightList1 = Module[{Œ± = <span class="hljs-number"><span class="hljs-number">0.8</span></span>, hs, sol}, hs = Prepend[Table[C Œ±^k, {k, <span class="hljs-number"><span class="hljs-number">0</span></span>, verticalBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}], <span class="hljs-number"><span class="hljs-number">0</span></span>]; sol = Solve[Total[hs] == <span class="hljs-number"><span class="hljs-number">10</span></span>, C, Reals]; Accumulate[hs /. sol<span class="hljs-string"><span class="hljs-string">[[1]]</span></span>]]</code> </pre> <br><blockquote>  {0, 2.97477, 5.35459, 7.25845, 8.78153, 10.} </blockquote><br><pre> <code class="hljs go">treeWidthOfHeight[h_] := treeWidth (treeHeight - h)/treeHeight</code> </pre> <br>  The branches are tight to the trunk, without gaps between them. <br><br><pre> <code class="hljs lua">Graphics3D[{{stemColor, stem}, {Darker[Green], Table[Table[ branchOnStem[{<span class="hljs-number"><span class="hljs-number">2</span></span> + heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>, {k , k + <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-number"><span class="hljs-number">2</span></span> Pi/ radialBranchCount , treeWidthOfHeight[Mean[heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>]]}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}], {k, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}] , {j, <span class="hljs-number"><span class="hljs-number">1</span></span>, verticalBranchCount}]}}, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">2.48</span></span>, <span class="hljs-number"><span class="hljs-number">-2.28</span></span>, <span class="hljs-number"><span class="hljs-number">0.28</span></span>}]</code> </pre><br><img src="https://habrastorage.org/webt/nn/mw/cp/nnmwcpqthbsdb-odi7g7sxi9hbu.png"><br><pre> <code class="hljs lua">Graphics3D[{{stemColor, stem}, {Darker[Green], Table[Table[ branchOnStem[{<span class="hljs-number"><span class="hljs-number">2</span></span> + heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>, {k , k + <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-number"><span class="hljs-number">2</span></span> Pi/ radialBranchCount , treeWidthOfHeight[Mean[heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>]]}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}], {k, <span class="hljs-number"><span class="hljs-number">0</span></span>, radialBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}] , {j, <span class="hljs-number"><span class="hljs-number">1</span></span>, verticalBranchCount}]}}, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">2.48</span></span>, <span class="hljs-number"><span class="hljs-number">-2.28</span></span>, <span class="hljs-number"><span class="hljs-number">0.28</span></span>}]</code> </pre> <br><img src="https://habrastorage.org/webt/tk/tv/2n/tktv2nmr4fc-ljprf_yedbu2afq.png"><br><br>  You can move branches to get a more realistic tree shape.  This is the tree that I will use in the future.  Changing tree settings and using another tree is quite simple. <cut></cut><br><br><pre> <code class="hljs lua">heightList2 = {<span class="hljs-number"><span class="hljs-number">2</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span>}.# &amp; /@ Partition[heightList1, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]; Graphics3D[{{Darker[Brown], stem}, {EdgeForm[], Table[ Table[branchOnStem[ {<span class="hljs-number"><span class="hljs-number">2</span></span> + heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>, {k , k + <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-number"><span class="hljs-number">2</span></span> Pi/ radialBranchCount , treeWidthOfHeight[Mean[heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>]]}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}], {k, <span class="hljs-number"><span class="hljs-number">0</span></span>, radialBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}] , {j, <span class="hljs-number"><span class="hljs-number">1</span></span>, verticalBranchCount}], Table[Table[ branchOnStem[{<span class="hljs-number"><span class="hljs-number">2</span></span> + heightList2<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>, {k , k + <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-number"><span class="hljs-number">2</span></span> Pi/ radialBranchCount + Pi/radialBranchCount, treeWidthOfHeight[Mean[heightList2<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>]]}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}], {k, <span class="hljs-number"><span class="hljs-number">0</span></span>, radialBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}] , {j, <span class="hljs-number"><span class="hljs-number">1</span></span>, verticalBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}]}}, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">2.48</span></span>, <span class="hljs-number"><span class="hljs-number">-2.28</span></span>, <span class="hljs-number"><span class="hljs-number">0.28</span></span>}]</code> </pre> <br><img src="https://habrastorage.org/webt/4p/k4/w3/4pk4w3ofu-nf_l5diodruho5xyo.png"><br><br>  One could easily make trees even denser with more branches. <br><br><pre> <code class="hljs lua">Graphics3D[{{Darker[Brown], stem}, {EdgeForm[], Table[Table[branchOnStem[ {<span class="hljs-number"><span class="hljs-number">2</span></span> + heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>, {k , k + <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-number"><span class="hljs-number">2</span></span> Pi/(<span class="hljs-number"><span class="hljs-number">2</span></span> radialBranchCount) , treeWidthOfHeight[Mean[heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>]]}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}], {k, <span class="hljs-number"><span class="hljs-number">0</span></span>, (<span class="hljs-number"><span class="hljs-number">2</span></span> radialBranchCount) - <span class="hljs-number"><span class="hljs-number">1</span></span>}] , {j, <span class="hljs-number"><span class="hljs-number">1</span></span>, verticalBranchCount}], Table[Table[branchOnStem[{<span class="hljs-number"><span class="hljs-number">2</span></span> + heightList2<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>, {k , k + <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-number"><span class="hljs-number">2</span></span> Pi/(<span class="hljs-number"><span class="hljs-number">2</span></span> radialBranchCount) + Pi/(<span class="hljs-number"><span class="hljs-number">2</span></span> radialBranchCount), treeWidthOfHeight[Mean[heightList2<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>]]}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}], {k, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span> radialBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}] , {j, <span class="hljs-number"><span class="hljs-number">1</span></span>, verticalBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}]}}, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">2.48</span></span>, <span class="hljs-number"><span class="hljs-number">-2.28</span></span>, <span class="hljs-number"><span class="hljs-number">0.28</span></span>}]</code> </pre> <br><img src="https://habrastorage.org/webt/jc/kp/eg/jckpeg1cj3lhimprsansnmvkuak.png"><cut></cut><br><br><h3>  Tree decoration </h3><br><br>  Now let's build some decorations to build a beautifully decorated Christmas tree.  I will add shiny balls, five-pointed stars and candles.  I recommend the original Thuringian Laus balls for your Christmas tree.  (You can find them <a href="https://www.krebslauscha.de/christmas-ornaments/about_us/history/">here</a> ) <br><br><h4>  Jewelry, Candles and Top </h4><br><h4>  Colored balls </h4><br><br>  Each tree should have some shiny glass spheres, toys. <br><br><pre> <code class="hljs vbscript">coloredBall[p_, size_, color_, {œï_, Œ∏_}] := Module[{\[ScriptD] = {<span class="hljs-built_in"><span class="hljs-built_in">Cos</span></span>[œï] <span class="hljs-built_in"><span class="hljs-built_in">Sin</span></span>[Œ∏], <span class="hljs-built_in"><span class="hljs-built_in">Sin</span></span>[œï] <span class="hljs-built_in"><span class="hljs-built_in">Sin</span></span>[Œ∏], -<span class="hljs-built_in"><span class="hljs-built_in">Cos</span></span>[Œ∏]}}, {EdgeForm[], GrayLevel[<span class="hljs-number"><span class="hljs-number">0.4</span></span>], Specularity[Yellow, <span class="hljs-number"><span class="hljs-number">20</span></span>], Cylinder[{p, p + <span class="hljs-number"><span class="hljs-number">1.5</span></span> size \[ScriptD]}, <span class="hljs-number"><span class="hljs-number">0.02</span></span> size ], color, Specularity[Yellow, <span class="hljs-number"><span class="hljs-number">10</span></span>], Sphere[p + (<span class="hljs-number"><span class="hljs-number">1.5</span></span> size + <span class="hljs-number"><span class="hljs-number">0.6</span></span> size) \[ScriptD] , <span class="hljs-number"><span class="hljs-number">0.6</span></span> size] }] Graphics3D[{coloredBall[{<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}, <span class="hljs-number"><span class="hljs-number">1</span></span>, Red, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}], coloredBall[{<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}, <span class="hljs-number"><span class="hljs-number">1</span></span>, Darker[Blue], {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>}]}, Axes -&gt; <span class="hljs-literal"><span class="hljs-literal">True</span></span>]</code> </pre> <br><img src="https://habrastorage.org/webt/6k/l2/go/6kl2govrmrot2oqllbbgodrqry8.png"><br><pre> <code class="hljs dos">branchOnStemWithBall[{{hb_, ht_}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>_, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>_}, R_}, {œÉ_, œÑ_}, color_, {œï_, Œ∏_}] := {branchOnStem[{{hb, ht}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>}, R}, {œÉ, œÑ}] , coloredBall[ branchOnStemEndPoint[{{hb, ht}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>}, R}, {œÉ, œÑ}], <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">45</span></span> (ht - hb)/<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">color</span></span>, {œï, Œ∏}]}</code> </pre> <br>  Here is a branch with a toy.  The variables {œÉ, œÑ} allow changing the position of the ball relative to the tip of the branch. <br><br><pre> <code class="hljs erlang-repl">Manipulate[ Graphics3D[{branchOnStemWithBall[{{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {Pi/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>, Pi/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>}, <span class="hljs-number"><span class="hljs-number">1</span></span> + œÅ}, œÉœÑ, Red, œïŒ∏]}, PlotRange -&gt; {{-<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>}, {-<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}}, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">3.17</span></span>, <span class="hljs-number"><span class="hljs-number">0.85</span></span>, <span class="hljs-number"><span class="hljs-number">0.79</span></span>}], {{œÅ, <span class="hljs-number"><span class="hljs-number">1.6</span></span>, <span class="hljs-string"><span class="hljs-string">"branch length"</span></span>}, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, ImageSize -&gt; Small}, {{œÉœÑ, {<span class="hljs-number"><span class="hljs-number">0.6</span></span>, <span class="hljs-number"><span class="hljs-number">0.26</span></span>}, <span class="hljs-string"><span class="hljs-string">"branch\nleft/right\nup/down"</span></span>}, {-<span class="hljs-number"><span class="hljs-number">1</span></span>, -<span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}}, {{œïŒ∏, {<span class="hljs-number"><span class="hljs-number">2.57</span></span>, <span class="hljs-number"><span class="hljs-number">1.88</span></span>}, <span class="hljs-string"><span class="hljs-string">"ball angles"</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, -Pi}, {Pi, Pi}}, ControlPlacement -&gt; Left, SaveDefinitions -&gt; True]</code> </pre> <br><img src="https://habrastorage.org/webt/fo/7d/gp/fo7dgp3hyi9lllpw0pi1pl6-n2m.png"><br><br>  Here is a tree with balls weighing mostly straight down.  I will use random colors for the balls. <br><br><pre> <code class="hljs lua">Graphics3D[{{Darker[Brown], stem}, {Table[ Table[branchOnStemWithBall[{<span class="hljs-number"><span class="hljs-number">2</span></span> + heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>, {k , k + <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-number"><span class="hljs-number">2</span></span> Pi/ radialBranchCount , treeWidthOfHeight[Mean[heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>]]}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, RandomColor[], {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}], {k, <span class="hljs-number"><span class="hljs-number">0</span></span>, radialBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}] , {j, <span class="hljs-number"><span class="hljs-number">1</span></span>, verticalBranchCount}] }}, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">2.48</span></span>, <span class="hljs-number"><span class="hljs-number">-2.28</span></span>, <span class="hljs-number"><span class="hljs-number">0.28</span></span>}, Axes -&gt; True]</code> </pre> <br><img src="https://habrastorage.org/webt/cu/c_/ik/cuc_ik_qw3zotcf8-iz-m_rghy4.png"><br><br>  Tree with balls in random directions.  If later the branches are moved, then we calculate the natural movements (which means solving the corresponding equations of motion) of the balls. <br><br><pre> <code class="hljs lua">Graphics3D[{{Darker[Brown], stem}, {Table[ Table[branchOnStemWithBall[{<span class="hljs-number"><span class="hljs-number">2</span></span> + heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>, {k , k + <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-number"><span class="hljs-number">2</span></span> Pi/ radialBranchCount , treeWidthOfHeight[Mean[heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>]]}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, RandomColor[], {RandomReal[{-Pi, Pi}], RandomReal[{<span class="hljs-number"><span class="hljs-number">0</span></span>, Pi}]}], {k, <span class="hljs-number"><span class="hljs-number">0</span></span>, radialBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}] , {j, <span class="hljs-number"><span class="hljs-number">1</span></span>, verticalBranchCount}]}}, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">2.48</span></span>, <span class="hljs-number"><span class="hljs-number">-2.28</span></span>, <span class="hljs-number"><span class="hljs-number">0.28</span></span>}, Axes -&gt; True]</code> </pre> <br><img src="https://habrastorage.org/webt/u_/_y/hn/u__yhnculi0z7e19c55qw8sfmhi.png"><br><br><h4>  Five-pointed stars </h4><br><br>  Now we build several five-pointed stars.  Since this ornament does not have rotational symmetry, I will allow an orientation angle relative to the thread on which it hangs. <cut></cut><br><br><pre> <code class="hljs mel">coloredFiveStar[p_, size_, dir_, color_, Œ±_, {œï_, Œ∏_}] := Module[{\[ScriptD] = {Cos[œï] Sin[Œ∏], Sin[œï] Sin[Œ∏], -Cos[Œ∏]}, points, P1, P2, d1, d2, d3, dP, dP2}, d2 = Normalize[dir - dir.\[ScriptD] \[ScriptD]]; d3 = Cross[\[ScriptD], d2]; {EdgeForm[], GrayLevel[<span class="hljs-number"><span class="hljs-number">0.4</span></span>], Specularity[Pink, <span class="hljs-number"><span class="hljs-number">20</span></span>], Cylinder[{p, p + (<span class="hljs-number"><span class="hljs-number">1.5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> + <span class="hljs-number"><span class="hljs-number">0.6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>) \[ScriptD]}, <span class="hljs-number"><span class="hljs-number">0.02</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> ], <span class="hljs-keyword"><span class="hljs-keyword">color</span></span>, Specularity[Hue[<span class="hljs-number"><span class="hljs-number">.125</span></span>], <span class="hljs-number"><span class="hljs-number">5</span></span>], dP = Sin[Œ±] d2 + Cos[Œ±] d3; dP2 = Cross[\[ScriptD], dP]; points = Table[p + (<span class="hljs-number"><span class="hljs-number">1.5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> + <span class="hljs-number"><span class="hljs-number">0.6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>) \[ScriptD] + <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> If[EvenQ[j], <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>] * (Cos[j <span class="hljs-number"><span class="hljs-number">2</span></span> Pi/<span class="hljs-number"><span class="hljs-number">10</span></span> ] \[ScriptD] + Sin[j <span class="hljs-number"><span class="hljs-number">2</span></span> Pi/<span class="hljs-number"><span class="hljs-number">10</span></span>] dP), {j, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>}]; P1 = p + (<span class="hljs-number"><span class="hljs-number">1.5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> + <span class="hljs-number"><span class="hljs-number">0.6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>) \[ScriptD] + <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> dP2; P2 = p + (<span class="hljs-number"><span class="hljs-number">1.5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> + <span class="hljs-number"><span class="hljs-number">0.6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>) \[ScriptD] - <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> dP2; {P1, P2} = (p + (<span class="hljs-number"><span class="hljs-number">1.5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> + <span class="hljs-number"><span class="hljs-number">0.6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>) \[ScriptD] + # <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>/ <span class="hljs-number"><span class="hljs-number">3</span></span> dP2) &amp; /@ {+<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>}; Polygon[ Join @@ (Function[a, Append[#, a] &amp; /@ Partition[points, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]] /@ {P1, P2})] }] Graphics3D[{coloredFiveStar[{<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, Darker[Red], <span class="hljs-number"><span class="hljs-number">0</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}], coloredFiveStar[{<span class="hljs-number"><span class="hljs-number">1.5</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, Darker[Purple], Pi/<span class="hljs-number"><span class="hljs-number">3</span></span>, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.4</span></span>}]}]</code> </pre> <br><img src="https://habrastorage.org/webt/gf/vm/rm/gfvmrmtjw8g2jpmzbypbkxgpryu.png"><br><pre> <code class="hljs dos">branchOnStemWithFiveStar[{{hb_, ht_}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>_, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>_}, R_}, {œÉ_, œÑ_}, color_, Œ±_, {œï_, Œ∏_}] := Module[{<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">Append</span></span>[Normalize[ Mean[{{Cos[œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>], Sin[œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>]}, {Cos[œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>], Sin[œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>]}}]], <span class="hljs-number"><span class="hljs-number">0</span></span>]}, {branchOnStem[{{hb, ht}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>}, R}, {œÉ, œÑ}] , coloredFiveStar[ branchOnStemEndPoint[{{hb, ht}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>}, R}, {œÉ, œÑ}], <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span> (ht - hb)/<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">color</span></span>, Œ±, {œï, Œ∏}]} ]</code> </pre> <br>  The Christmas tree is decorated with five-pointed stars. <br><br><pre> <code class="hljs lua">Graphics3D[{{Darker[Brown], stem}, {Table[ Table[branchOnStemWithFiveStar[{<span class="hljs-number"><span class="hljs-number">2</span></span> + heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>, {k , k + <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-number"><span class="hljs-number">2</span></span> Pi/ radialBranchCount , treeWidthOfHeight[Mean[heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>]]}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, RandomColor[], RandomReal[{-Pi, Pi}], {RandomReal[{-Pi, Pi}], RandomReal[<span class="hljs-number"><span class="hljs-number">0.1</span></span> {<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}]}], {k, <span class="hljs-number"><span class="hljs-number">0</span></span>, radialBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}] , {j, <span class="hljs-number"><span class="hljs-number">1</span></span>, verticalBranchCount}] }}, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">2.48</span></span>, <span class="hljs-number"><span class="hljs-number">-2.28</span></span>, <span class="hljs-number"><span class="hljs-number">0.28</span></span>}, Axes -&gt; True]</code> </pre> <br><img src="https://habrastorage.org/webt/zr/gw/fk/zrgwfkrh3ke8ozpzyzeiapl5ru0.png"><br><br><h4>  Candles </h4><br><br>  We will construct them starting from the leg, which is attached to the ends of the branches, with a wax-like body, blackened wick and fire.  To ease the animation and avoid the fire, I will use electric candles so that the flame does not change when the branches move. <br><br><pre> <code class="hljs mel">flamePoints = Table[{<span class="hljs-number"><span class="hljs-number">0.2</span></span> Sin[Pi z]^<span class="hljs-number"><span class="hljs-number">2</span></span> Cos[œÜ], <span class="hljs-number"><span class="hljs-number">0.2</span></span> Sin[Pi z]^<span class="hljs-number"><span class="hljs-number">2</span></span> Sin[œÜ], z}, {z, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">12</span></span>}, {œÜ, Pi/<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> Pi, <span class="hljs-number"><span class="hljs-number">2</span></span> Pi/<span class="hljs-number"><span class="hljs-number">24</span></span>}] litCandle[p_, size_, color_] := {EdgeForm[], <span class="hljs-keyword"><span class="hljs-keyword">color</span></span>, Cylinder[{p + {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0.001</span></span>}, p + {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span>}}, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0.04</span></span>], GrayLevel[<span class="hljs-number"><span class="hljs-number">0.1</span></span>], Specularity[Orange, <span class="hljs-number"><span class="hljs-number">20</span></span>], Cylinder[{p, p + {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0.05</span></span>}}, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0.06</span></span>], Black, Glow[Black], Cylinder[{ p + {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span>}, p + {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span> + <span class="hljs-number"><span class="hljs-number">0.05</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>}}, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0.008</span></span>], Glow[Orange], Specularity[Hue[<span class="hljs-number"><span class="hljs-number">.125</span></span>], <span class="hljs-number"><span class="hljs-number">5</span></span>], BSplineSurface[ Map[(p + {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span>} + <span class="hljs-number"><span class="hljs-number">0.3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> #) &amp;, flamePoints, {<span class="hljs-number"><span class="hljs-number">2</span></span>}], SplineClosed -&gt; {True, False}] }</code> </pre> <br>  White and red candles. <cut></cut><br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Graphics3D</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[{litCandle[{0, 0, 0}, 1, Directive[White, Glow[GrayLevel[0.3]</span></span>], <span class="hljs-selector-tag"><span class="hljs-selector-tag">Specularity</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[Yellow, 20]</span></span>]], <span class="hljs-selector-tag"><span class="hljs-selector-tag">litCandle</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[{0.5, 0, 0}, 1, Directive[Red, Glow[GrayLevel[0.1]</span></span>], <span class="hljs-selector-tag"><span class="hljs-selector-tag">Specularity</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[Yellow, 20]</span></span>]]}]</code> </pre> <br><img src="https://habrastorage.org/webt/fs/hh/ss/fshhsscki0cmtwwo30shu5tocyc.png"><br><br>  Later I will use an elongated branch with a candle so that it will be the conductor, so I will allow the candles to lean from the branch. <br><br><pre> <code class="hljs erlang-repl">branchOnStemWithCandle[{{hb_, ht_}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>_, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>_}, R_}, {œÉ_, œÑ_}, color_, Œ±_] := {branchOnStem[{{hb, ht}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>}, R}, {œÉ, œÑ}] , If[Œ± == <span class="hljs-number"><span class="hljs-number">0</span></span>, litCandle[ branchOnStemEndPoint[{{hb, ht}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>}, <span class="hljs-number"><span class="hljs-number">0.98</span></span> R}, {œÉ, œÑ}], <span class="hljs-number"><span class="hljs-number">0.66</span></span> (ht - hb) , color], Module[{P = branchOnStemEndPoint[{{hb, ht}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>}, <span class="hljs-number"><span class="hljs-number">0.98</span></span> R}, {œÉ, œÑ}], dir}, dir = Append[Reverse[Take[P, <span class="hljs-number"><span class="hljs-number">2</span></span>]] {-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, <span class="hljs-number"><span class="hljs-number">0</span></span>]; Rotate[ litCandle[ branchOnStemEndPoint[{{hb, ht}, {œÜ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÜ<span class="hljs-number"><span class="hljs-number">2</span></span>}, <span class="hljs-number"><span class="hljs-number">0.98</span></span> R}, {œÉ, œÑ}], <span class="hljs-number"><span class="hljs-number">0.66</span></span> (ht - hb) , color], Œ±, dir, P]]]} Manipulate[ Graphics3D[{branchOnStemWithCandle[{{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {Pi/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>, Pi/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>}, <span class="hljs-number"><span class="hljs-number">1</span></span> + œÅ}, œÉœÑ, Red, Œ±]}, PlotRange -&gt; {{-<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>}, {-<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}}, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">3.17</span></span>, <span class="hljs-number"><span class="hljs-number">0.85</span></span>, <span class="hljs-number"><span class="hljs-number">0.79</span></span>}], {{œÅ, <span class="hljs-number"><span class="hljs-number">1.6</span></span>, <span class="hljs-string"><span class="hljs-string">"branch length"</span></span>}, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, ImageSize -&gt; Small}, {{œÉœÑ, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-string"><span class="hljs-string">"branch\nleft/right\nup/down"</span></span>}, {-<span class="hljs-number"><span class="hljs-number">1</span></span>, -<span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}}, {{Œ±, Pi/<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">"candle angle"</span></span>}, -Pi, Pi}, ControlPlacement -&gt; Left, SaveDefinitions -&gt; True]</code> </pre> <br>  And here is a spruce with a candle on each branch. <br><br><pre> <code class="hljs lua">Graphics3D[{{Darker[Brown], stem}, {Table[ Table[branchOnStemWithCandle[{<span class="hljs-number"><span class="hljs-number">2</span></span> + heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>, {k , k + <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-number"><span class="hljs-number">2</span></span> Pi/ radialBranchCount , treeWidthOfHeight[Mean[heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>]]}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, White, <span class="hljs-number"><span class="hljs-number">0</span></span>], {k, <span class="hljs-number"><span class="hljs-number">0</span></span>, radialBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}] , {j, <span class="hljs-number"><span class="hljs-number">1</span></span>, verticalBranchCount}] }}, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">2.48</span></span>, <span class="hljs-number"><span class="hljs-number">-2.28</span></span>, <span class="hljs-number"><span class="hljs-number">0.28</span></span>}, Axes -&gt; True]</code> </pre> <br><img src="https://habrastorage.org/webt/rj/ua/zi/rjuazihu9cokw4eyvttvo00zmw0.png"><br><br><h4>  The top of the tree </h4><br>  For complete joy, I add a rotating spike on the top. <cut></cut><br><br><pre> <code class="hljs lua">spikey = Cases[ N@Entity[<span class="hljs-string"><span class="hljs-string">"Polyhedron"</span></span>, <span class="hljs-string"><span class="hljs-string">"RhombicHexecontahedron"</span></span>][ <span class="hljs-string"><span class="hljs-string">"Image"</span></span>], _GraphicsComplex, ‚àû]<span class="hljs-string"><span class="hljs-string">[[1]]</span></span>; top = {Gray, Specularity[Red, <span class="hljs-number"><span class="hljs-number">25</span></span>], Cone[{{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0.9</span></span> treeHeight}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1.08</span></span> treeHeight}}, treeWidth/<span class="hljs-number"><span class="hljs-number">240</span></span>], Orange, EdgeForm[Darker[Orange]], Specularity[Hue[<span class="hljs-number"><span class="hljs-number">.125</span></span>], <span class="hljs-number"><span class="hljs-number">5</span></span>], MapAt[((<span class="hljs-number"><span class="hljs-number">0.24</span></span> # + {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1.08</span></span> treeHeight}) &amp; /@ #) &amp;, spikey, <span class="hljs-number"><span class="hljs-number">1</span></span>] } Graphics3D[{{Darker[Brown], stem}, {Table[ Table[branchOnStem[{<span class="hljs-number"><span class="hljs-number">2</span></span> + heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>, {k , k + <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-number"><span class="hljs-number">2</span></span> Pi/ radialBranchCount , treeWidthOfHeight[Mean[heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>]]}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>} ], {k, <span class="hljs-number"><span class="hljs-number">0</span></span>, radialBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}] , {j, <span class="hljs-number"><span class="hljs-number">1</span></span>, verticalBranchCount}], top}}, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">2.48</span></span>, <span class="hljs-number"><span class="hljs-number">-2.28</span></span>, <span class="hljs-number"><span class="hljs-number">0.28</span></span>}, Axes -&gt; True]</code> </pre> <br><img src="https://habrastorage.org/webt/-k/uv/pn/-kuvpnraz0itsm9h7flqwugrv5k.png"><br><br><h4>  Tree decoration </h4><br>  We will single out one branch as a conductor.  We will randomly divide the remaining branches into four groups and decorate them with toys of two colors, five-pointed stars and candles. <br>  Now let's add a decoration or a candle to each branch of the tree.  I will use the above tree with 27 branches.  I start branches in height on the stem and azimuth angle. <br><br><pre> <code class="hljs lua">allBranches = Flatten[Riffle[ Table[Table[{<span class="hljs-number"><span class="hljs-number">2</span></span> + heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>, {k , k + <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-number"><span class="hljs-number">2.</span></span> Pi/ radialBranchCount , treeWidthOfHeight[Mean[heightList1<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>]]}, {k, <span class="hljs-number"><span class="hljs-number">0</span></span>, radialBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}] , {j, <span class="hljs-number"><span class="hljs-number">1</span></span>, verticalBranchCount}], Table[Table[{<span class="hljs-number"><span class="hljs-number">2</span></span> + heightList2<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>, {k , k + <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-number"><span class="hljs-number">2.</span></span> Pi/ radialBranchCount + Pi/radialBranchCount, treeWidthOfHeight[Mean[heightList2<span class="hljs-string"><span class="hljs-string">[[{j, j + 1}]]</span></span>]]}, {k, <span class="hljs-number"><span class="hljs-number">0</span></span>, radialBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}] , {j, <span class="hljs-number"><span class="hljs-number">1</span></span>, verticalBranchCount - <span class="hljs-number"><span class="hljs-number">1</span></span>}]], <span class="hljs-number"><span class="hljs-number">1</span></span>] Length[allBranches]</code> </pre> <br><blockquote>  27 </blockquote><br>  Let's color the branches in order, starting from the red below and to the purple on the top. <cut></cut><br><br><pre> <code class="hljs lua">Graphics3D[{{Darker[Brown], stem}, MapIndexed[(branchOnStem[#<span class="hljs-number"><span class="hljs-number">1</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}] /. _RGBColor :&gt; Hue[#<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-string"><span class="hljs-string">[[1]]</span></span>/<span class="hljs-number"><span class="hljs-number">36</span></span>]) &amp;, allBranches], top}, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">-0.2</span></span>}]</code> </pre> <br><img src="https://habrastorage.org/webt/g2/sf/kb/g2sfkb8g_u9j4z4yjw3ewzbphy0.png"><br><br>  We divide all branches into 4 groups for voices and one for the role of conductor. <br><br><pre> <code class="hljs pgsql">conductorBranch = <span class="hljs-number"><span class="hljs-number">7</span></span>; SeedRandom[<span class="hljs-number"><span class="hljs-number">12</span></span>]; voiceBranches = (Last /@ #) &amp; /@ GroupBy[{RandomChoice[{<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>}], #} &amp; /@ <span class="hljs-keyword"><span class="hljs-keyword">Delete</span></span>[Range[<span class="hljs-number"><span class="hljs-number">27</span></span>], {conductorBranch}], First]</code> </pre> <br><blockquote>  &lt;| 1 -&gt; {1, 4, 5, 6, 12, 18, 20}, 3 -&gt; {2, 8, 10, 11, 14, 22, 23, 25}, 2 -&gt; {3, 13, 15, 16, 21, 26}, 4 -&gt; {9, 17, 19, 24, 27} |&gt; </blockquote><br><pre> <code class="hljs erlang-repl">voiceBranches = &lt;|<span class="hljs-number"><span class="hljs-number">1</span></span> -&gt; {<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>}, <span class="hljs-number"><span class="hljs-number">2</span></span> -&gt; {<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">21</span></span>, <span class="hljs-number"><span class="hljs-number">26</span></span>}, <span class="hljs-number"><span class="hljs-number">3</span></span> -&gt; {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>}, <span class="hljs-number"><span class="hljs-number">4</span></span> -&gt; {<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>}|&gt;</code> </pre> <br><blockquote>  &lt;| 1 -&gt; {2, 9, 14, 17, 19, 24, 27}, 2 -&gt; {3, 13, 15, 16, 21, 26}, 3 -&gt; {1, 4, 5, 12, 18, 20}, 4 -&gt; {6, 8, 10, 11, 22, 23, 25} |&gt; </blockquote><br>  Here is an illustration of branches, painted according to what voice they represent. <br><br><pre> <code class="hljs lua">Graphics3D[{{Darker[Brown], stem}, branchOnStem[#<span class="hljs-number"><span class="hljs-number">1</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}] &amp; /@ allBranches<span class="hljs-string"><span class="hljs-string">[[voiceBranches[[1]]]]</span></span> /. _RGBColor :&gt; Yellow, branchOnStem[#<span class="hljs-number"><span class="hljs-number">1</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}] &amp; /@ allBranches<span class="hljs-string"><span class="hljs-string">[[voiceBranches[[2]]]]</span></span> /. _RGBColor :&gt; White, branchOnStem[#<span class="hljs-number"><span class="hljs-number">1</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}] &amp; /@ allBranches<span class="hljs-string"><span class="hljs-string">[[voiceBranches[[3]]]]</span></span> /. _RGBColor :&gt; LightBlue, branchOnStem[#<span class="hljs-number"><span class="hljs-number">1</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}] &amp; /@ allBranches<span class="hljs-string"><span class="hljs-string">[[voiceBranches[[4]]]]</span></span> /. _RGBColor :&gt; Pink, branchOnStem[ allBranches<span class="hljs-string"><span class="hljs-string">[[conductorBranch]]</span></span> {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1.5</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}] /. _RGBColor :&gt; Red, top}, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">-0.2</span></span>}]</code> </pre> <br><img src="https://habrastorage.org/webt/0g/kt/sc/0gktscx5hdl6wchiiyfizhvwqk0.png"><br><br>  A completed tree with the location of the end of the branches as parameters.  Also let the decorations on the tips of the branches sit tilted and be colorful. <cut></cut><br><br><pre> <code class="hljs lua">christmasTree[{{œÉ<span class="hljs-number"><span class="hljs-number">1</span></span>_, œÑ<span class="hljs-number"><span class="hljs-number">1</span></span>_}, {œÉ<span class="hljs-number"><span class="hljs-number">2</span></span>_, œÑ<span class="hljs-number"><span class="hljs-number">2</span></span>_}, {œÉ<span class="hljs-number"><span class="hljs-number">3</span></span>_, œÑ<span class="hljs-number"><span class="hljs-number">3</span></span>_}, {œÉ<span class="hljs-number"><span class="hljs-number">4</span></span>_, œÑ<span class="hljs-number"><span class="hljs-number">4</span></span>_}, {œÉc_, œÑc_}}, {{œï<span class="hljs-number"><span class="hljs-number">1</span></span>_, Œ∏<span class="hljs-number"><span class="hljs-number">1</span></span>_}, {œï<span class="hljs-number"><span class="hljs-number">2</span></span>_, Œ∏<span class="hljs-number"><span class="hljs-number">2</span></span>_}, {œï<span class="hljs-number"><span class="hljs-number">3</span></span>_, Œ∏<span class="hljs-number"><span class="hljs-number">3</span></span>_}}, {colBall1_, colBall2_, col5Star_}, conductorEnhancementFactor : fc_, conductorCandleAngle : œâc_, topRotationAngle : œâ_] := {{Darker[Brown], stem}, branchOnStemWithBall[#, {œÉ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÑ<span class="hljs-number"><span class="hljs-number">1</span></span>}, colBall1, {œï<span class="hljs-number"><span class="hljs-number">1</span></span>, Œ∏<span class="hljs-number"><span class="hljs-number">1</span></span>}] &amp; /@ allBranches<span class="hljs-string"><span class="hljs-string">[[voiceBranches[[1]]]]</span></span>, branchOnStemWithBall[#, {œÉ<span class="hljs-number"><span class="hljs-number">2</span></span>, œÑ<span class="hljs-number"><span class="hljs-number">2</span></span>}, colBall2, {œï<span class="hljs-number"><span class="hljs-number">2</span></span>, Œ∏<span class="hljs-number"><span class="hljs-number">2</span></span>}] &amp; /@ allBranches<span class="hljs-string"><span class="hljs-string">[[voiceBranches[[2]]]]</span></span>, branchOnStemWithFiveStar[#, {œÉ<span class="hljs-number"><span class="hljs-number">3</span></span>, œÑ<span class="hljs-number"><span class="hljs-number">3</span></span>}, col5Star, Pi/<span class="hljs-number"><span class="hljs-number">4</span></span>, {œï<span class="hljs-number"><span class="hljs-number">3</span></span>, Œ∏<span class="hljs-number"><span class="hljs-number">3</span></span>}] &amp; /@ allBranches<span class="hljs-string"><span class="hljs-string">[[voiceBranches[[3]]]]</span></span>, branchOnStemWithCandle[#, {œÉ<span class="hljs-number"><span class="hljs-number">4</span></span>, œÑ<span class="hljs-number"><span class="hljs-number">4</span></span>}, Directive[White, Glow[GrayLevel[<span class="hljs-number"><span class="hljs-number">0.3</span></span>]], Specularity[Yellow, <span class="hljs-number"><span class="hljs-number">20</span></span>]], <span class="hljs-number"><span class="hljs-number">0</span></span>] &amp; /@ allBranches<span class="hljs-string"><span class="hljs-string">[[voiceBranches[[4]]]]</span></span>, branchOnStemWithCandle[ allBranches<span class="hljs-string"><span class="hljs-string">[[conductorBranch]]</span></span> {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> + fc}, {œÉc, œÑc}, Directive[Red, Glow[GrayLevel[<span class="hljs-number"><span class="hljs-number">0.1</span></span>]], Specularity[Yellow, <span class="hljs-number"><span class="hljs-number">20</span></span>]], œâc], Rotate[top, œâ, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}] };</code> </pre><br>  The initial position of all branches and the elongated branch of the conductor, where its candle is tilted. <br><br><pre> <code class="hljs erlang-repl">Graphics3D[christmasTree[{{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}}, {{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}}, {Red, Darker[Yellow], Pink}, <span class="hljs-number"><span class="hljs-number">0.8</span></span>, Pi/<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], ImageSize -&gt; <span class="hljs-number"><span class="hljs-number">600</span></span>, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">3.06</span></span>, <span class="hljs-number"><span class="hljs-number">1.28</span></span>, <span class="hljs-number"><span class="hljs-number">0.27</span></span>}, PlotRange -&gt; {{-<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>}, {-<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>}}]</code> </pre> <br><img src="https://habrastorage.org/webt/15/88/rf/1588rftoal3tgea7aicdam7z-v0.png"><br><br>  Three ate with all the parameters selected randomly. <br><br><pre> <code class="hljs rust">SeedRandom[<span class="hljs-number"><span class="hljs-number">1</span></span>] Table[Graphics3D[christmasTree[RandomReal[<span class="hljs-number"><span class="hljs-number">1.5</span></span> {-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}], Table[{RandomReal[{-Pi, Pi}], RandomReal[{<span class="hljs-number"><span class="hljs-number">0</span></span>, Pi}]}, <span class="hljs-number"><span class="hljs-number">3</span></span>], RandomColor[<span class="hljs-number"><span class="hljs-number">3</span></span>], RandomReal[], RandomReal[Pi/<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>], ImageSize -&gt; <span class="hljs-number"><span class="hljs-number">200</span></span>, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">3.06</span></span>, <span class="hljs-number"><span class="hljs-number">1.28</span></span>, <span class="hljs-number"><span class="hljs-number">0.27</span></span>}, PlotRange -&gt; {{-<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>}, {-<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>}, {-<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>}}], {<span class="hljs-number"><span class="hljs-number">3</span></span>}] <span class="hljs-comment"><span class="hljs-comment">// Row</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/b1/ik/e7/b1ike7ecju7jc5k6h9qtjnvdixy.png"><br><br>  The following interactive demonstrations allow you to move branches, move decorations around the ends of branches, and color decorations as you like. <cut></cut><br><br><pre> <code class="hljs erlang-repl">Manipulate[ Graphics3D[ christmasTree[{œÉœÑ<span class="hljs-number"><span class="hljs-number">1</span></span>, œÉœÑ<span class="hljs-number"><span class="hljs-number">2</span></span>, œÉœÑ<span class="hljs-number"><span class="hljs-number">3</span></span>, œÉœÑ<span class="hljs-number"><span class="hljs-number">4</span></span>, œÉœÑc}, {œïŒ∏<span class="hljs-number"><span class="hljs-number">1</span></span>, œïŒ∏<span class="hljs-number"><span class="hljs-number">2</span></span>, œïŒ∏<span class="hljs-number"><span class="hljs-number">3</span></span>}, {col1, col2, col3}, l, œâc, œâ], ImageSize -&gt; <span class="hljs-number"><span class="hljs-number">400</span></span>, ViewPoint -&gt; {<span class="hljs-number"><span class="hljs-number">2.61</span></span>, <span class="hljs-number"><span class="hljs-number">1.99</span></span>, <span class="hljs-number"><span class="hljs-number">0.80</span></span>}, PlotRange -&gt; {{-<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>}, {-<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>}, {-<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>}}], <span class="hljs-string"><span class="hljs-string">"conductor"</span></span>, {{l, <span class="hljs-number"><span class="hljs-number">0.6</span></span>, <span class="hljs-string"><span class="hljs-string">"branch length"</span></span>}, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ImageSize -&gt; Small}, {{œâc, Pi/<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">"candle angle"</span></span>}, <span class="hljs-number"><span class="hljs-number">0</span></span>, Pi, ImageSize -&gt; Small}, {{œÉœÑc, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-string"><span class="hljs-string">"movement"</span></span>}, {-<span class="hljs-number"><span class="hljs-number">1</span></span>, -<span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, ImageSize -&gt; Small}, Delimiter, <span class="hljs-string"><span class="hljs-string">"voice 1 (balls)"</span></span>, Grid[{{<span class="hljs-string"><span class="hljs-string">"movement"</span></span>, <span class="hljs-string"><span class="hljs-string">"ornament"</span></span>}, {Control[{{œÉœÑ<span class="hljs-number"><span class="hljs-number">1</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-string"><span class="hljs-string">""</span></span>}, {-<span class="hljs-number"><span class="hljs-number">1</span></span>, -<span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, ImageSize -&gt; Small}], Control[{{œïŒ∏<span class="hljs-number"><span class="hljs-number">1</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-string"><span class="hljs-string">""</span></span>}, {-Pi, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {Pi, Pi}, ImageSize -&gt; Small}]}}], {{col1, Red, <span class="hljs-string"><span class="hljs-string">""</span></span>}, Red, ImageSize -&gt; Tiny}, Delimiter, <span class="hljs-string"><span class="hljs-string">"voice 2 (balls)"</span></span>, Grid[{{<span class="hljs-string"><span class="hljs-string">"movement"</span></span>, <span class="hljs-string"><span class="hljs-string">"ornament"</span></span>}, {Control[{{œÉœÑ<span class="hljs-number"><span class="hljs-number">2</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-string"><span class="hljs-string">""</span></span>}, {-<span class="hljs-number"><span class="hljs-number">1</span></span>, -<span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, ImageSize -&gt; Small}], Control[{{œïŒ∏<span class="hljs-number"><span class="hljs-number">2</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-string"><span class="hljs-string">""</span></span>}, {-Pi, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {Pi, Pi}, ImageSize -&gt; Small}]}}], {{col2, Darker[Yellow], <span class="hljs-string"><span class="hljs-string">""</span></span>}, Red, ImageSize -&gt; Tiny}, Delimiter, <span class="hljs-string"><span class="hljs-string">"voice 3 (5-star)"</span></span>, Grid[{{<span class="hljs-string"><span class="hljs-string">"movement"</span></span>, <span class="hljs-string"><span class="hljs-string">"ornament"</span></span>}, {Control[{{œÉœÑ<span class="hljs-number"><span class="hljs-number">3</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-string"><span class="hljs-string">""</span></span>}, {-<span class="hljs-number"><span class="hljs-number">1</span></span>, -<span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, ImageSize -&gt; Small}], Control[{{œïŒ∏<span class="hljs-number"><span class="hljs-number">3</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-string"><span class="hljs-string">""</span></span>}, {-Pi, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {Pi, Pi}, ImageSize -&gt; Small}]}}], {{col3, Pink, <span class="hljs-string"><span class="hljs-string">""</span></span>}, Red, ImageSize -&gt; Tiny}, Delimiter, <span class="hljs-string"><span class="hljs-string">"voice 4 (white candles)"</span></span>, Control[{{œÉœÑ<span class="hljs-number"><span class="hljs-number">4</span></span>, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-string"><span class="hljs-string">"movement"</span></span>}, {-<span class="hljs-number"><span class="hljs-number">1</span></span>, -<span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, ImageSize -&gt; Small}], Delimiter, Delimiter, {{œâ, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"top rotation"</span></span>}, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ImageSize -&gt; Small}, ControlPlacement -&gt; Left, SaveDefinitions -&gt; True]</code> </pre> <br><img src="https://habrastorage.org/webt/a0/oh/pz/a0ohpzm-noagqqrhdbbvlnztgma.png"><br><br><h3>  From music to movement </h3><br><br>  So, now that I‚Äôve finished making a parameterized Christmas tree with moving branches and decorations, I have to deal with the ratio of music to branch movements (and, in turn, decorations). <cut></cut><br><br><h4>  Get 4 voices as sound </h4><br><br>  Use the MIDI file of the song. <br><br><img src="https://habrastorage.org/webt/ct/z_/jn/ctz_jn1xerc_utbarlkabgxjoyu.png"><br><br><pre> <code class="hljs objectivec">{ohTannenBaum <span class="hljs-comment"><span class="hljs-comment">// Head, ohTannenBaum // ByteCount}</span></span></code> </pre> <br><br><blockquote>  {Sound, 287816} </blockquote><br>  Remove 4 voices. <br><br><pre> <code class="hljs objectivec">voices = AssociationThread[{<span class="hljs-string"><span class="hljs-string">"Soprano"</span></span>, <span class="hljs-string"><span class="hljs-string">"Alto"</span></span>, <span class="hljs-string"><span class="hljs-string">"Tenor"</span></span>, <span class="hljs-string"><span class="hljs-string">"Bass"</span></span>}, ImportString[ ExportString[ohTannenBaum, <span class="hljs-string"><span class="hljs-string">"MIDI"</span></span>], {<span class="hljs-string"><span class="hljs-string">"MIDI"</span></span>, <span class="hljs-string"><span class="hljs-string">"SoundNotes"</span></span>}]]; Sound[Take[<span class="hljs-meta"><span class="hljs-meta">#, 10]] &amp; /@ voices</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/in/jf/mo/injfmojk8uhlshwd7svit6wcy7o.png"><br><br><h4>  Voice to frequency </h4><br><br><pre> <code class="hljs erlang-repl">frequencyRules = &lt;|<span class="hljs-string"><span class="hljs-string">"A1"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">55</span></span>., <span class="hljs-string"><span class="hljs-string">"A2"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">110</span></span>., <span class="hljs-string"><span class="hljs-string">"A3"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">220</span></span>., <span class="hljs-string"><span class="hljs-string">"A4"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">440</span></span>., <span class="hljs-string"><span class="hljs-string">"B1"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">61.74</span></span>, <span class="hljs-string"><span class="hljs-string">"B2"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">123.5</span></span>, <span class="hljs-string"><span class="hljs-string">"B3"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">246.9</span></span>, <span class="hljs-string"><span class="hljs-string">"B4"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">493.9</span></span>, <span class="hljs-string"><span class="hljs-string">"C2"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">65.41</span></span>, <span class="hljs-string"><span class="hljs-string">"C3"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">130.8</span></span>, <span class="hljs-string"><span class="hljs-string">"C4"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">261.6</span></span>, <span class="hljs-string"><span class="hljs-string">"C5"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">523.3</span></span>, <span class="hljs-string"><span class="hljs-string">"D2"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">73.42</span></span>, <span class="hljs-string"><span class="hljs-string">"D#4"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">311.13</span></span>, <span class="hljs-string"><span class="hljs-string">"D4"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">293.7</span></span>, <span class="hljs-string"><span class="hljs-string">"D5"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">587.3</span></span>, <span class="hljs-string"><span class="hljs-string">"E2"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">82.41</span></span>, <span class="hljs-string"><span class="hljs-string">"E4"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">329.6</span></span>, <span class="hljs-string"><span class="hljs-string">"E5"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">659.3</span></span>, <span class="hljs-string"><span class="hljs-string">"F#2"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">92.50</span></span>, <span class="hljs-string"><span class="hljs-string">"F#4"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">370.0</span></span>, <span class="hljs-string"><span class="hljs-string">"G2"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">98.00</span></span>, <span class="hljs-string"><span class="hljs-string">"G#4"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">415.3</span></span>, <span class="hljs-string"><span class="hljs-string">"G4"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">392.0</span></span>|&gt;; {minf, maxf} = MinMax[frequencyRules]</code> </pre> <br><blockquote>  {55., 659.3} </blockquote><br><br>  The timing of the first vote. <br><br><pre> <code class="hljs lua">pw[t_] = Piecewise[{frequencyRules[#<span class="hljs-number"><span class="hljs-number">1</span></span>], #<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-string"><span class="hljs-string">[[1]]</span></span> &lt;= t &lt;= #<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-string"><span class="hljs-string">[[2]]</span></span>} &amp; @@@ voices<span class="hljs-string"><span class="hljs-string">[[1]]</span></span>]; Plot[pw[t], {t, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>}, PlotRange -&gt; {<span class="hljs-number"><span class="hljs-number">200</span></span>, All}, Filling -&gt; Axis, PlotLabel -&gt; <span class="hljs-string"><span class="hljs-string">"Soprano"</span></span>, Frame -&gt; True, FrameLabel -&gt; {<span class="hljs-string"><span class="hljs-string">"time in sec"</span></span>, <span class="hljs-string"><span class="hljs-string">"frequency in Hz"</span></span>}, AxesOrigin -&gt; {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>}]</code> </pre> <br><img src="https://habrastorage.org/webt/pt/ws/pe/ptwspe_jxogzpi4ydw2996keiis.png"><br><br>  To represent the frequencies in the movements, I will smooth the curves. <br><br><pre> <code class="hljs pgsql">spline = BSplineFunction[<span class="hljs-keyword"><span class="hljs-keyword">Table</span></span>[{t, pw[t]}, {t, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>}], SplineDegree -&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>]</code> </pre> <br><img src="https://habrastorage.org/webt/2s/56/pp/2s56ppiqh3xdlctqar6iyemosow.png"><br><br><pre> <code class="hljs erlang-repl">ParametricPlot[spline[t], {t, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>}, AspectRatio -&gt; <span class="hljs-number"><span class="hljs-number">0.5</span></span>, PlotPoints -&gt; <span class="hljs-number"><span class="hljs-number">1000</span></span>]</code> </pre><br><img src="https://habrastorage.org/webt/bw/wd/de/bwwddeh4obyehvik3q5xrsiba88.png"><br><br><pre> <code class="hljs markdown">tMax = 100; Do[<span class="hljs-string"><span class="hljs-string"> With[{j = j}, pwf[j</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t_</span></span>] = Piecewise[<span class="hljs-string"><span class="hljs-string">{frequencyRules[#1</span></span>], #2[<span class="hljs-string"><span class="hljs-string">[1</span></span>]] <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">t</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">#2[[2]]}</span></span></span></span><span class="xml"><span class="hljs-tag"> &amp; @@@ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">voices</span></span></span></span><span class="xml"><span class="hljs-tag">[[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">j</span></span></span></span><span class="xml"><span class="hljs-tag">]]]; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">splineFunction</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">j</span></span></span></span><span class="xml"><span class="hljs-tag">] = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">BSplineFunction[Table[{t,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pwf</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">j</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">t</span></span></span></span><span class="xml"><span class="hljs-tag">]}, {</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">t</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">100</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0.5</span></span></span></span><span class="xml"><span class="hljs-tag">}], </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">SplineDegree</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> 2]; voiceFunction[<span class="hljs-string"><span class="hljs-string">j</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t_Real</span></span>] := If[<span class="hljs-string"><span class="hljs-string">0 &lt; t &lt; tMax, splineFunction[j</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t/tMax</span></span>][<span class="hljs-string"><span class="hljs-string">[2</span></span>]]/maxf, 0]], {j, 4}]</code> </pre> <br>  Frequencies of four voices. <br><br><pre> <code class="hljs markdown">Plot[<span class="hljs-string"><span class="hljs-string">Evaluate[Reverse@Table[pwf[j</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>], {j, 4}]], {t, 0, 100}, Frame -&gt; True, FrameLabel -&gt; {"time in sec", "frequency in Hz"}, AspectRatio -&gt; 0.3]</code> </pre> <br><img src="https://habrastorage.org/webt/m_/hd/k1/m_hdk1alq_juvdv4uonnoor7htc.png"><br><br>  Smoothed scaled frequencies of four voices. <cut></cut><br><br><pre> <code class="hljs markdown">Plot[<span class="hljs-string"><span class="hljs-string">Evaluate[Table[voiceFunction[j</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>], {j, 4}]], {t, 0, 100}, Frame -&gt; True, FrameLabel -&gt; {"time in sec", "scaled frequency"}, AspectRatio -&gt; 0.3]</code> </pre> <br><img src="https://habrastorage.org/webt/q_/ji/7z/q_ji7zq6ktl5-7fog8f9usgrig8.png"><br><br>  Here is a graph of the (smoothed) first three voices in 3D. <br><br><pre> <code class="hljs markdown">ParametricPlot3D[<span class="hljs-string"><span class="hljs-string">{voiceFunction[1</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>], voiceFunction[<span class="hljs-string"><span class="hljs-string">2</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>], voiceFunction[<span class="hljs-string"><span class="hljs-string">3</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>]}, {t, 0, 100}, AspectRatio -&gt; Automatic, PlotPoints -&gt; 1000, BoxRatios -&gt; {1, 1, 1}]</code> </pre><br><img src="https://habrastorage.org/webt/fg/t0/d0/fgt0d0omfecmnzanq-yugsbf6dg.png"><br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Show</span></span>[% /. <span class="hljs-type"><span class="hljs-type">Line</span></span>[pts_] :&gt; Tube[pts, <span class="hljs-number"><span class="hljs-number">0.002</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">Method</span></span> -&gt; {"TubePoints" -&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>}]</code> </pre> <br><img src="https://habrastorage.org/webt/np/if/oa/npifoaeynfslhmmfaabfw0bae4u.png"><br><br><h3>  Get a pattern of oscillation </h3><br><br>  Snap to specific phrases to create all the beatings of tact. <br><br><pre> <code class="hljs markdown">{firstBeat, secondBeat, lastBeat} = voices[<span class="hljs-string"><span class="hljs-string">"Soprano"</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">[{1, 2, -1}, 2, 1</span></span>]]</code> </pre> <br><blockquote>  {1.33522, 2.00568, 98.7727} </blockquote><br><pre> <code class="hljs markdown">anchorDataOChristmasTree = SequenceCases[<span class="hljs-string"><span class="hljs-string"> voices["Soprano"</span></span>], (<span class="hljs-bullet"><span class="hljs-bullet">* pattern for "O Christmas Tree, O Christmas Tree..." *</span></span>) { SoundNote[<span class="hljs-string"><span class="hljs-string">"D4", {pickupStart_, _}, "Trumpet", ___</span></span>], SoundNote[<span class="hljs-string"><span class="hljs-string">"G4", {beatOne_, _}, "Trumpet", ___</span></span>], SoundNote[<span class="hljs-string"><span class="hljs-string">"G4", {_, _}, "Trumpet", ___</span></span>], SoundNote[<span class="hljs-string"><span class="hljs-string">"G4", {beatTwo_, _}, "Trumpet", ___</span></span>], SoundNote[<span class="hljs-string"><span class="hljs-string">"A4", {beatThree_, _}, "Trumpet", ___</span></span>], SoundNote[<span class="hljs-string"><span class="hljs-string">"B4", {beatFour_, _}, "Trumpet", ___</span></span>], SoundNote[<span class="hljs-string"><span class="hljs-string">"B4", {_, _}, "Trumpet", ___</span></span>], SoundNote[<span class="hljs-string"><span class="hljs-string">"B4", {beatFive_, _}, "Trumpet", ___</span></span>] } :&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">|</span></span></span></span><span class="xml"><span class="hljs-tag"> "</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">PhraseName</span></span></span></span><span class="xml"><span class="hljs-tag">" </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> "O Christmas Tree", "PickupBeat" -&gt; pickupStart, "TargetMeasureBeats" -&gt; {beatOne, beatTwo, beatThree}, "BeatLength" -&gt; Mean@Differences[<span class="hljs-string"><span class="hljs-string">{pickupStart, beatOne, beatTwo, beatThree, beatFour, beatFive}</span></span>] |&gt; ]; anchorDataYourBoughsSoGreen = SequenceCases[<span class="hljs-string"><span class="hljs-string"> voices["Soprano"</span></span>], (<span class="hljs-bullet"><span class="hljs-bullet">* "Your boughs so green in summertime..." *</span></span>) { SoundNote[<span class="hljs-string"><span class="hljs-string">"D5", {pickupBeatAnd_, _}, "Trumpet", ___</span></span>], SoundNote[<span class="hljs-string"><span class="hljs-string">"D5", {beatOne_, _}, "Trumpet", ___</span></span>], SoundNote[<span class="hljs-string"><span class="hljs-string">"B4", {_, _}, "Trumpet", ___</span></span>], SoundNote[<span class="hljs-string"><span class="hljs-string">"E5", {beatTwo_, _}, "Trumpet", ___</span></span>], SoundNote[<span class="hljs-string"><span class="hljs-string">"D5", {beatThreeAnd_, _}, "Trumpet", ___</span></span>], SoundNote[<span class="hljs-string"><span class="hljs-string">"D5", {beatFour_, _}, "Trumpet", ___</span></span>], SoundNote[<span class="hljs-string"><span class="hljs-string">"C5", {_, _}, "Trumpet", ___</span></span>], SoundNote[<span class="hljs-string"><span class="hljs-string">"C5", {beatFive_, _}, "Trumpet", ___</span></span>] } :&gt; With[<span class="hljs-string"><span class="hljs-string"> { (* the offbeat nature of this phrase requires some manual work to get things lined up in terms of actual beats *) pickupBeatStart = pickupBeatAnd - (beatOne - pickupBeatAnd), beatThree = beatThreeAnd - (beatFour - beatThreeAnd) }, &lt;| "PhraseName" -&gt; "Your boughs so green in summertime", "PickupBeat" -&gt; pickupBeatStart, "TargetMeasureBeats" -&gt; {beatOne, beatTwo, beatThree}, "BeatLength" -&gt; Mean@Differences[{pickupBeatStart, beatOne, beatTwo, beatThree, beatFour, beatFive}</span></span>] |&gt; ] ]; anchorData0 = Join[<span class="hljs-string"><span class="hljs-string">anchorDataOChristmasTree, anchorDataYourBoughsSoGreen</span></span>] // SortBy[<span class="hljs-string"><span class="hljs-string">#PickupBeat &amp;</span></span>]; meanBeatLength = Mean[<span class="hljs-string"><span class="hljs-string">anchorData0[[All, "BeatLength"</span></span>]]]; (<span class="hljs-bullet"><span class="hljs-bullet">* add enough beats to fill the end of the song, which ends on beat 2 *</span></span>) anchorData = Append[<span class="hljs-string"><span class="hljs-string">anchorData0, &lt;| "TargetMeasureBeats" -&gt; (lastBeat + {-1, 0, 1}* Last[anchorData0</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">"BeatLength"</span></span>]), "BeatLength" -&gt; Last[<span class="hljs-string"><span class="hljs-string">anchorData0</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">"BeatLength"</span></span>]|&gt;]; anchorData = Append[<span class="hljs-string"><span class="hljs-string">anchorData, &lt;| "TargetMeasureBeats" -&gt; (lastBeat + ({-1, 0, 1} + 3)* Last[anchorData</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">"BeatLength"</span></span>]), "BeatLength" -&gt; Last[<span class="hljs-string"><span class="hljs-string">anchorData</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">"BeatLength"</span></span>]|&gt;];</code> </pre> <br>  Interpolate the rhythm between and during phrases: <cut></cut><br><br><pre> <code class="hljs pgsql">interpolateAnchor = Apply[ <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>[{currentAnchor, nextAnchor}, <span class="hljs-keyword"><span class="hljs-keyword">With</span></span>[ {targetMeasureLastBeat = Last[currentAnchor["TargetMeasureBeats"]], nextMeasureFirstBeat = First[nextAnchor["TargetMeasureBeats"]]}, DeleteDuplicates@<span class="hljs-keyword"><span class="hljs-keyword">Join</span></span>[ currentAnchor["TargetMeasureBeats"], Range[targetMeasureLastBeat, nextMeasureFirstBeat - currentAnchor["BeatLength"]/<span class="hljs-number"><span class="hljs-number">4.</span></span>, Mean[{currentAnchor["BeatLength"], nextAnchor["BeatLength"]}]]] ]]]; measureBeats = Flatten@BlockMap[interpolateAnchor, anchorData, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]; measureBeats // Length</code> </pre> <br><blockquote>  144 </blockquote><br>  The rhythm varies slightly, and, if you do not take into account the above method of binding, this can lead to phasing between movement and sound: <br><br><pre> <code class="hljs erlang-repl">Histogram[Differences[measureBeats], PlotTheme -&gt; <span class="hljs-string"><span class="hljs-string">"Detailed"</span></span>, PlotRange -&gt; Full]</code> </pre> <br><img src="https://habrastorage.org/webt/nj/d2/a7/njd2a7brdrbr3fwombz0s65uzls.png"><br><br><pre> <code class="hljs erlang-repl"> (* add pickup beat at start *) swayControlPoints = Prepend[Join @@ (Partition[measureBeats, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, {}] // MapIndexed[ Function[{times, index}, {#, (-<span class="hljs-number"><span class="hljs-number">1</span></span>)^(Mod[index[[<span class="hljs-number"><span class="hljs-number">1</span></span>]], <span class="hljs-number"><span class="hljs-number">2</span></span>] + <span class="hljs-number"><span class="hljs-number">1</span></span>)} &amp; /@ times]]), {firstBeat, -<span class="hljs-number"><span class="hljs-number">1</span></span>}]; swayControlPointPlot = ListPlot[swayControlPoints, Joined -&gt; True, Mesh -&gt; All, AspectRatio -&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">6</span></span>, PlotStyle -&gt; {Darker[Purple]}, PlotTheme -&gt; <span class="hljs-string"><span class="hljs-string">"Detailed"</span></span>, MeshStyle -&gt; PointSize[<span class="hljs-number"><span class="hljs-number">0.008</span></span>], ImageSize -&gt; <span class="hljs-number"><span class="hljs-number">600</span></span>, Epilog -&gt; {Darker[Green], Thick, InfiniteLine[{{#, -<span class="hljs-number"><span class="hljs-number">1</span></span>}, {#, <span class="hljs-number"><span class="hljs-number">1</span></span>}}] &amp; /@ {firstBeat, secondBeat, lastBeat}}]; sway = BSplineFunction[ Join[{{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}}, Select[swayControlPoints, #[[<span class="hljs-number"><span class="hljs-number">1</span></span>]] &lt; tMax &amp;], {{<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}}], SplineDegree -&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>]; sh = Show[{swayControlPointPlot, ParametricPlot[sway[t], {t, <span class="hljs-number"><span class="hljs-number">0</span></span>, tMax}, PlotPoints -&gt; <span class="hljs-number"><span class="hljs-number">2500</span></span>]}]</code> </pre> <br><br><img src="https://habrastorage.org/webt/yt/3h/sq/yt3hsqbthdputaixhxsi_fcrg8s.png"><br><br><pre> <code class="hljs erlang-repl">{Show[sh, PlotRange -&gt; {{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>}, All}], Show[sh, PlotRange -&gt; {{<span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span>}, All}]}</code> </pre> <br><img src="https://habrastorage.org/webt/hl/hh/om/hlhhomrk7r944zfqmeogpsg1iiy.png"><br><br>  Now a small digression: Interpolation with B-splines gives nice smooth curves.  Unlike Interpolation, the actual data is not on the resulting curve.  It looks nice and smooth, and this is what we want for the visual purpose of this animation.  But interpolation is for a pair of points.  This means that for a given argument (between 0 and 1) of the B-spline function, we do not get a linear interpolation with respect to the first argument.  In place of this, you need to invert the interpolation to get the time as a function of the variable parameter of the interpolation.  Taking into account this effect, it is important to correctly align the music with the movements of the branches. <br><br><pre> <code class="hljs markdown">swayTimeCoordinate = Interpolation[<span class="hljs-string"><span class="hljs-string">Table[{t, sway[t/100</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">[1</span></span>]]}, {t, 0, 100, 0.1}], InterpolationOrder -&gt; 1]</code> </pre> <br><img src="https://habrastorage.org/webt/3z/np/n8/3znpn8epmoxj7t9ygxifhzqs16m.png"><br><br>  This graph shows the difference between interpolation and a modified parameter of the B-spline function. <br><br><pre> <code class="hljs">Plot[swayTimeCoordinate[t] - t, {t, 0, 100}]</code> </pre> <br><img src="https://habrastorage.org/webt/oa/bu/bv/oabubvrpgiajbphgh3uweem_tpq.png"><br><br><pre> <code class="hljs markdown">swayOfTime[<span class="hljs-string"><span class="hljs-string">t_</span></span>] := sway[<span class="hljs-string"><span class="hljs-string">swayTimeCoordinate[t</span></span>]/100][[2]] Plot[swayOfTime[t], {t, 0, 10}]</code> </pre> <br><img src="https://habrastorage.org/webt/t1/v8/_w/t1v8_wpml-v3uv23xrqmt4igskk.png"><br><br>  Visualize phrases and their relationship to movement with a tooltip and colored rectangles: <br><br><pre> <code class="hljs erlang-repl">phraseGraphics = BlockMap[ Apply[ Function[{currentAnchor, nextAnchor}, With[ {phraseStart = currentAnchor[<span class="hljs-string"><span class="hljs-string">"PickupBeat"</span></span>], phraseEnd = nextAnchor[<span class="hljs-string"><span class="hljs-string">"PickupBeat"</span></span>] - currentAnchor[<span class="hljs-string"><span class="hljs-string">"BeatLength"</span></span>]}, {Switch[currentAnchor[<span class="hljs-string"><span class="hljs-string">"PhraseName"</span></span>], <span class="hljs-string"><span class="hljs-string">"O Christmas Tree"</span></span>, Opacity[<span class="hljs-number"><span class="hljs-number">0.25</span></span>, Gray], <span class="hljs-string"><span class="hljs-string">"Your boughs so green in summertime"</span></span>, Opacity[<span class="hljs-number"><span class="hljs-number">0.25</span></span>, Darker@Green], _, Black], Tooltip[ Polygon[ {{phraseStart, -<span class="hljs-number"><span class="hljs-number">10</span></span>}, {phraseStart, <span class="hljs-number"><span class="hljs-number">10</span></span>}, {phraseEnd, <span class="hljs-number"><span class="hljs-number">10</span></span>}, {phraseEnd, -<span class="hljs-number"><span class="hljs-number">10</span></span>}}], Grid[{{currentAnchor[<span class="hljs-string"><span class="hljs-string">"PhraseName"</span></span>], SpanFromLeft}, {<span class="hljs-string"><span class="hljs-string">"Phrase Start:"</span></span>, phraseStart}, {<span class="hljs-string"><span class="hljs-string">"Phrase End:"</span></span>, phraseEnd} }]]}]]], Append[anchorData0, &lt;|<span class="hljs-string"><span class="hljs-string">"PickupBeat"</span></span> -&gt; lastBeat + meanBeatLength|&gt;], <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]; Show[swayControlPointPlot, ParametricPlot[sway[t], {t, <span class="hljs-number"><span class="hljs-number">0</span></span>, Last[measureBeats]}, ImageSize -&gt; Full, PlotPoints -&gt; <span class="hljs-number"><span class="hljs-number">800</span></span>, AspectRatio -&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">8</span></span>, PlotTheme -&gt; <span class="hljs-string"><span class="hljs-string">"Detailed"</span></span>, PlotRangePadding -&gt; Scaled[.<span class="hljs-number"><span class="hljs-number">02</span></span>]], Prolog -&gt; phraseGraphics]</code> </pre> <img src="https://habrastorage.org/webt/vi/r-/3o/vir-3oi4chjpigzcj0vockwedn8.png"><br><br><h4>  Movement Conductor </h4><br>  The conductor performs a simple periodic movement, synchronized with the music. <br><br><pre> <code class="hljs lua">threePatternPoints = {{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>}, {<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-0</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}}; threePatternBackground = ListPlot[ MapIndexed[ Callout[#<span class="hljs-number"><span class="hljs-number">1</span></span>, StringTemplate[<span class="hljs-string"><span class="hljs-string">"Beat #`` @ ``"</span></span>][First@#<span class="hljs-number"><span class="hljs-number">2</span></span>, #<span class="hljs-number"><span class="hljs-number">1</span></span>], Left] &amp;, threePatternPoints], PlotTheme -&gt; <span class="hljs-string"><span class="hljs-string">"Minimal"</span></span>, Axes -&gt; False, AspectRatio -&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, PlotStyle -&gt; Directive[Black, PointSize[<span class="hljs-number"><span class="hljs-number">0.025</span></span>]], PlotRange -&gt; {{<span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">0.75</span></span>}, {<span class="hljs-number"><span class="hljs-number">-1.5</span></span>, <span class="hljs-number"><span class="hljs-number">1.5</span></span>}}]; conductorControlTimes = swayControlPoints<span class="hljs-string"><span class="hljs-string">[[All, 1]]</span></span>; (* basic conductor control points <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> interpolation *) conductorControlPoints = MapIndexed[{conductorControlTimes<span class="hljs-string"><span class="hljs-string">[[First[#2]]</span></span>], #<span class="hljs-number"><span class="hljs-number">1</span></span>} &amp;, Join @@ ConstantArray[RotateRight[threePatternPoints, <span class="hljs-number"><span class="hljs-number">1</span></span>], Floor@(Length[conductorControlTimes]/<span class="hljs-number"><span class="hljs-number">3</span></span>)]]; (* the shape is okay, but <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> perfect *) conductor = Interpolation[conductorControlPoints]; (* adding pauses before/after the beat improves the shape of the curves <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> makes the beats more obvious *) conductorControlPointsWithPauses = Join @@ ({# - {meanBeatLength/<span class="hljs-number"><span class="hljs-number">8.</span></span>, <span class="hljs-number"><span class="hljs-number">-0.15</span></span>* Normalize[ Mean[threePatternPoints] - #<span class="hljs-string"><span class="hljs-string">[[ 2]]</span></span>]}, #, # + {meanBeatLength/<span class="hljs-number"><span class="hljs-number">8.</span></span>, <span class="hljs-number"><span class="hljs-number">0.15</span></span>*Normalize[ Mean[threePatternPoints] - #<span class="hljs-string"><span class="hljs-string">[[ 2]]</span></span>]}} &amp; /@ conductorControlPoints);</code> </pre> <br>      Interpolation. <cut></cut><br><br><pre> <code class="hljs erlang-repl">conductorWithPauses = Interpolation[conductorControlPointsWithPauses, InterpolationOrder -&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>];</code> </pre> <br><br>     . <br><br><pre> <code class="hljs sql">Manipulate[ <span class="hljs-keyword"><span class="hljs-keyword">Show</span></span>[threePatternBackground, ParametricPlot[ conductorWithPauses[t], {t, <span class="hljs-keyword"><span class="hljs-keyword">Max</span></span>[firstBeat,(*tmax<span class="hljs-number"><span class="hljs-number">-2</span></span>*meanBeatLength*)<span class="hljs-number"><span class="hljs-number">0</span></span>], tmax}, PerformanceGoal -&gt; <span class="hljs-string"><span class="hljs-string">"Quality"</span></span>], Epilog -&gt; {Red, PointSize[<span class="hljs-keyword"><span class="hljs-keyword">Large</span></span>], Point[conductorWithPauses[tmax]]}, ImageSize -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Large</span></span>], {{tmax, lastBeat, <span class="hljs-string"><span class="hljs-string">"t"</span></span>}, firstBeat + <span class="hljs-number"><span class="hljs-number">0.0001</span></span>, lastBeat, Appearance -&gt; <span class="hljs-string"><span class="hljs-string">"Labeled"</span></span>}, SaveDefinitions -&gt; <span class="hljs-literal"><span class="hljs-literal">True</span></span>]</code> </pre> <br><img src="https://habrastorage.org/webt/qe/bx/gh/qebxghgyjttyhnypgiyphu0bb2c.png"><br><br><h4>       </h4><br>        .    :     ,   ‚Äî   . <br><br> <b> 1</b> <br><br>      2D :  :     :           <br><br><pre> <code class="hljs markdown">Œ¥Delay = 0.3; voiceœÉœÑ[<span class="hljs-string"><span class="hljs-string">j_</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">time_</span></span>] := If[<span class="hljs-string"><span class="hljs-string">0 &lt; time &lt; tMax,(* smoothing factor *) Sin[Pi time/tMax</span></span>]^0.25 {voiceFunction[<span class="hljs-string"><span class="hljs-string">j</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">1. time</span></span>] - voiceFunction[<span class="hljs-string"><span class="hljs-string">j</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">time - Œ¥Delay</span></span>], voiceFunction[<span class="hljs-string"><span class="hljs-string">j</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">1. time</span></span>]}, {0, 0}] ParametricPlot[<span class="hljs-string"><span class="hljs-string">voiceœÉœÑ[1</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>], {t, 0, tMax}, AspectRatio -&gt; 1, PlotRange -&gt; All, Frame -&gt; True, Axes -&gt; False, PlotStyle -&gt; Thickness[0.002]]</code> </pre> <br><img src="https://habrastorage.org/webt/iv/8m/qc/iv8mqczhn2gpwpv9pgosf0f-nju.png"><br><br>  <b>Option 2</b> <br><br>      2D :  :    :  <cut></cut><br><br><pre> <code class="hljs rust">value = -<span class="hljs-number"><span class="hljs-number">1</span></span>; interpolateDance[{{t1_, t2_}, {t3_, t4_}}, t_] := With[{y1 = value, y2 = value = -value}, {{y1, t1 &lt; t &lt; t2}, {((y1 - y2) t - (t3 y1 - t2 y2))/(t2 - t3), t2 &lt; t &lt; t3}}]; dancingPositionPiecewise[notes : {__SoundNote}] := With[{noteTimes = Cases[notes, SoundNote[_, times : {startTime_, endTime_}, ___] :&gt; times]}, value = -<span class="hljs-number"><span class="hljs-number">1</span></span>; Quiet[Piecewise[ DeleteDuplicatesBy[ Join @@ BlockMap[interpolateDance[#, t] &amp;, noteTimes, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], Last], <span class="hljs-number"><span class="hljs-number">0</span></span>] ]]; tEnd = Max[voices[[All, All, <span class="hljs-number"><span class="hljs-number">2</span></span>]]]; dancingPositions = dancingPositionPiecewise /@ voices; Plot[Evaluate[KeyValueMap[Legended[#<span class="hljs-number"><span class="hljs-number">2</span></span>, #<span class="hljs-number"><span class="hljs-number">1</span></span>] &amp;, dancingPositions]], {t, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>}, PlotRangePadding -&gt; Scaled[.<span class="hljs-number"><span class="hljs-number">05</span></span>], PlotRange -&gt; {All, {-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}}, ImageSize -&gt; Large, PlotTheme -&gt; <span class="hljs-string"><span class="hljs-string">"Detailed"</span></span>, PlotLegends -&gt; <span class="hljs-literal"><span class="hljs-literal">None</span></span>]</code> </pre> <br><img src="https://habrastorage.org/webt/_c/6o/f6/_c6of6ok6ghmn1gke1ri25cyssy.png"><br><br><pre> <code class="hljs markdown">dancingPositionPiecewiseList = Normal[<span class="hljs-string"><span class="hljs-string">dancingPositions</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">[All, 2</span></span>]]; bsp = BSplineFunction[ Table[Evaluate[{t, dancingPositionPiecewiseList[[2]]}], {t, 0, 100, 0.2}]]</code> </pre> <br><img src="https://habrastorage.org/webt/2s/56/pp/2s56ppiqh3xdlctqar6iyemosow.png"><br><br><pre> <code class="hljs erlang-repl">ParametricPlot[bsp[t], {t, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, AspectRatio -&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span>, PlotPoints -&gt; <span class="hljs-number"><span class="hljs-number">2000</span></span>]</code> </pre> <br><img src="https://habrastorage.org/webt/hy/le/an/hyleanivkoc60mdysb-qaxtqafq.png"><br><br><pre> <code class="hljs markdown">Do[<span class="hljs-string"><span class="hljs-string">voiceIF[j</span></span>] = BSplineFunction[<span class="hljs-string"><span class="hljs-string"> Table[Evaluate[{t, dancingPositionPiecewiseList[[j</span></span>]]}], {t, 0, 100, 0.2}]], {j, 4}] Do[<span class="hljs-string"><span class="hljs-string">With[{j = j}, voiceTimeCoordinate[j</span></span>] = Interpolation[<span class="hljs-string"><span class="hljs-string">Table[{t, voiceIF[j</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t/100</span></span>][<span class="hljs-string"><span class="hljs-string">[1</span></span>]]}, {t, 0, 100, 0.1}], InterpolationOrder -&gt; 1]], {j, 4}]</code> </pre> <br>       œÉ-œÑ [-1,1] * [- 1,1]. <cut></cut><br><br><pre> <code class="hljs markdown">Clear[<span class="hljs-string"><span class="hljs-string">voiceœÉœÑ</span></span>]; voiceœÉœÑ[<span class="hljs-string"><span class="hljs-string">j_</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">time_</span></span>] := If[<span class="hljs-string"><span class="hljs-string">0 &lt; time &lt; tMax,(* smoothing factor *) Sin[Pi time/tMax</span></span>]^0.25* {sway[<span class="hljs-string"><span class="hljs-string">swayTimeCoordinate[time</span></span>]/tMax][<span class="hljs-string"><span class="hljs-string">[2</span></span>]], voiceIF[<span class="hljs-string"><span class="hljs-string">j</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">voiceTimeCoordinate[j</span></span>][<span class="hljs-string"><span class="hljs-string">time</span></span>]/tMax][<span class="hljs-string"><span class="hljs-string">[2</span></span>]]}, {0, 0}] Table[<span class="hljs-string"><span class="hljs-string">ListPlot[Table[ voiceœÉœÑ[j</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>], {t, 0, 105, 0.01}], Joined -&gt; True, AspectRatio -&gt; 1, PlotStyle -&gt; Thickness[0.002]], {j, 4}]</code> </pre> <br><img src="https://habrastorage.org/webt/ct/ip/_u/ctip_u3kqeriw0iadvqhdvs8zbk.png"><br><br><h3>    </h3><br>    ()    .  (,  )         .      , ,   ,   voiceœÉœÑ [j] [time]. <br><br><h4>    </h4><br>        . <br><br><pre> <code class="hljs markdown">Clear[<span class="hljs-string"><span class="hljs-string">r, œÅ, R, X, Y, Z</span></span>] R[<span class="hljs-string"><span class="hljs-string">t_</span></span>] := {X[<span class="hljs-string"><span class="hljs-string">t</span></span>], Y[<span class="hljs-string"><span class="hljs-string">t</span></span>], Z[<span class="hljs-string"><span class="hljs-string">t</span></span>]} r[<span class="hljs-string"><span class="hljs-string">t_</span></span>] := R[<span class="hljs-string"><span class="hljs-string">t</span></span>] + L {Cos[<span class="hljs-string"><span class="hljs-string">œï[t</span></span>]] Sin[<span class="hljs-string"><span class="hljs-string">Œ∏[t</span></span>]], Sin[<span class="hljs-string"><span class="hljs-string">œï[t</span></span>]] Sin[<span class="hljs-string"><span class="hljs-string">Œ∏[t</span></span>]], -Cos[<span class="hljs-string"><span class="hljs-string">Œ∏[t</span></span>]]} ‚Ñí = 1/2 r'[<span class="hljs-string"><span class="hljs-string">t</span></span>].r'[<span class="hljs-string"><span class="hljs-string">t</span></span>] - gr[<span class="hljs-string"><span class="hljs-string">t</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">[3</span></span>]]</code> </pre> <br><blockquote> -g (-L Cos[Œ∏[t]] + Z[t]) + 1/2 ((Derivative[1][Z][t] + L Sin[Œ∏[t]] Derivative[1][Œ∏][t])^2 + (Derivative[ 1][Y][t] + L Cos[Œ∏[t]] Sin[œï[t]] Derivative[1][Œ∏][t] + L Cos[œï[t]] Sin[Œ∏[t]] Derivative[1][œï][ t])^2 + (Derivative[1][X][t] + L Cos[Œ∏[t]] Cos[œï[t]] Derivative[1][Œ∏][t] ‚Äî L Sin[Œ∏[t]] Sin[œï[t]] Derivative[1][œï][t])^2) </blockquote><br><br>     ‚Ñ±   . <cut></cut><br><br><pre> <code class="hljs cs">‚Ñ± = <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> (\[ScriptF]œï œï<span class="hljs-string"><span class="hljs-string">'[t]^2 + \[ScriptF]Œ∏ Œ∏'</span></span>[t]^<span class="hljs-number"><span class="hljs-number">2</span></span>); eoms = {D[D[‚Ñí, œï<span class="hljs-string"><span class="hljs-string">'[t]], t] - D[‚Ñí, œï[t]] == -D[‚Ñ±, œï'</span></span>[t]], D[D[‚Ñí, Œ∏<span class="hljs-string"><span class="hljs-string">'[t]], t] - D[‚Ñí, Œ∏[t]] == -D[‚Ñ±, Œ∏'</span></span>[ t]]} <span class="hljs-comment"><span class="hljs-comment">// Simplify</span></span></code> </pre> <br><blockquote> {([ScriptF]œï + L^2 Sin[2 Œ∏[t]] Derivative[1][Œ∏][t]) Derivative[ 1][œï][t] + L Sin[Œ∏[t]] (-Sinœï[t]t] + Cos[œï[t][t] + L SinŒ∏[t][t]) == 0, [ScriptF]Œ∏ Derivative[1][Œ∏][t] + L (g Sin[Œ∏[t]] ‚Äî L Cos[Œ∏[t]] Sin[Œ∏[t]] Derivative[1][œï][t]^2 + Cos[Œ∏[t]] Cosœï[t]t] + Cos[Œ∏[t]] Sin[œï[t]t] + Sin[Œ∏[t][t] + L (Œ∏^‚Ä≤‚Ä≤)[t]) == 0} </blockquote><br><br> , ,         [ScriptF] œÜ, [ScriptF] Œ∏. <br><br><pre> <code class="hljs django"><span class="xml"><span class="xml"> paramRules = { g -&gt; 10, L -&gt; 1, \[ScriptF]œï -&gt; 1, \[ScriptF]Œ∏ -&gt; 1}; In[126]:= X[t_] := If[2 Pi </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">t</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">4</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Pi</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">8</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Cos</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">t</span></span></span></span><span class="xml"><span class="hljs-tag">], </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">8</span></span></span></span><span class="xml"><span class="hljs-tag">]; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Y</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">t_</span></span></span></span><span class="xml"><span class="hljs-tag">] </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag">= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">If[2</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Pi</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">t</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">4</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Pi</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">4</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Sin</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">t</span></span></span></span><span class="xml"><span class="hljs-tag">], </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">]; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Z</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">t_</span></span></span></span><span class="xml"><span class="hljs-tag">] </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag">= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">nds</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">NDSolve[{eoms</span></span></span></span><span class="xml"><span class="hljs-tag"> /</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">paramRules</span></span></span></span><span class="xml"><span class="hljs-tag">, œï[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">] == </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1,</span></span></span></span><span class="xml"><span class="hljs-tag"> œï'[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">] == </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0,</span></span></span></span><span class="xml"><span class="hljs-tag"> Œ∏[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">] == </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0.001,</span></span></span></span><span class="xml"><span class="hljs-tag"> Œ∏'[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">] == </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0},</span></span></span></span><span class="xml"><span class="hljs-tag"> {œï, Œ∏}, {</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">t</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">20</span></span></span></span><span class="xml"><span class="hljs-tag">}, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">PrecisionGoal</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> 3, AccuracyGoal -&gt; 3]</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/5r/b7/bf/5rb7bf1xmjzdd_vtm8c59lypuqk.png"><br><br><pre> <code class="hljs markdown">Plot[<span class="hljs-string"><span class="hljs-string">Evaluate[{\[Phi</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>], \[<span class="hljs-string"><span class="hljs-string">Theta</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>]} /. nds[[1]]], {t, 0, nds[[1, 2, 2, 1, 1, 2]]}, PlotRange -&gt; All]</code> </pre> <br><img src="https://habrastorage.org/webt/wh/hk/0z/whhk0zti0xrqmpf_kkmb4oxceqq.png"><br><br><pre> <code class="hljs lua">Graphics3D[ Table[With[{P = r[t] - R[t] /. nds<span class="hljs-string"><span class="hljs-string">[[1]]</span></span> /. paramRules}, {Black, Sphere[{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-number"><span class="hljs-number">0.02</span></span>], Gray, Cylinder[{{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, P}, <span class="hljs-number"><span class="hljs-number">0.005</span></span>], Darker[Blue], Sphere[P, <span class="hljs-number"><span class="hljs-number">0.02</span></span>]}], {t, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">0.05</span></span>}], PlotRange -&gt; All]</code> </pre> <br><img src="https://habrastorage.org/webt/c4/a4/39/c4a439vccghn7k6r_iqgoaa2xuu.png"><br><br><h4>    </h4><br><br>   Œ¥  œÑ   ,    . <cut></cut><br><br><pre> <code class="hljs delphi">branchToVoice = Association[ Flatten[<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">Function</span></span></span><span class="hljs-function">[</span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">{v, bs}</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(# -&gt; v)</span></span></span><span class="hljs-function"> &amp; /@ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bs</span></span></span><span class="hljs-function">] @@@ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Normal</span></span></span><span class="hljs-function">[</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">voiceBranches</span></span></span><span class="hljs-function">]]]</span></span></code> </pre> <br><blockquote> &lt;|2 -&gt; 1, 9 -&gt; 1, 14 -&gt; 1, 17 -&gt; 1, 19 -&gt; 1, 24 -&gt; 1, 27 -&gt; 1, 3 -&gt; 2, 13 -&gt; 2, 15 -&gt; 2, 16 -&gt; 2, 21 -&gt; 2, 26 -&gt; 2, 1 -&gt; 3, 4 -&gt; 3, 5 -&gt; 3, <br> 12 -&gt; 3, 18 -&gt; 3, 20 -&gt; 3, 6 -&gt; 4, 8 -&gt; 4, 10 -&gt; 4, 11 -&gt; 4, 22 -&gt; 4, 23 -&gt; 4, 25 -&gt; 4|&gt; </blockquote><br><pre> <code class="hljs markdown">tValues = Table[<span class="hljs-string"><span class="hljs-string">1. t , {t, -5, 110, 0.1}</span></span>]; Do[<span class="hljs-string"><span class="hljs-string">œÉœÑValues = Table[voiceœÉœÑ[j</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>] , {t, -5, 110, 0.1}]; ifœÉ[j] = Interpolation[ Transpose[{tValues, œÉœÑValues[[All, 1]]}]]; ifœÑ[j] = Interpolation[ Transpose[{tValues, œÉœÑValues[[All, 2]]}]], {j, 4}]</code> </pre> <br>   ,    .      ,              (     ). <br><br>           (   )   . <br><br><pre> <code class="hljs lua">changeTimeList = {<span class="hljs-number"><span class="hljs-number">17.6</span></span>, <span class="hljs-number"><span class="hljs-number">42.2</span></span>, <span class="hljs-number"><span class="hljs-number">66.8</span></span>, <span class="hljs-number"><span class="hljs-number">83.1</span></span>}; loudness[t_] := With[{Œª<span class="hljs-number"><span class="hljs-number">1</span></span> = <span class="hljs-number"><span class="hljs-number">0.2</span></span>, Œª<span class="hljs-number"><span class="hljs-number">2</span></span> = <span class="hljs-number"><span class="hljs-number">0.8</span></span>, Œ¥t = <span class="hljs-number"><span class="hljs-number">1.5</span></span>}, Which[t &lt;= changeTimeList<span class="hljs-string"><span class="hljs-string">[[3]]</span></span> - Œ¥t, Œª<span class="hljs-number"><span class="hljs-number">1</span></span>, changeTimeList<span class="hljs-string"><span class="hljs-string">[[3]]</span></span> - Œ¥t &lt;= t &lt;= changeTimeList<span class="hljs-string"><span class="hljs-string">[[3]]</span></span> + Œ¥t, Œª<span class="hljs-number"><span class="hljs-number">1</span></span> + (Œª<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span> Œª<span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> - Cos[Pi (t - (changeTimeList<span class="hljs-string"><span class="hljs-string">[[ 3]]</span></span> - Œ¥t))/(<span class="hljs-number"><span class="hljs-number">2</span></span> Œ¥t)])/<span class="hljs-number"><span class="hljs-number">2</span></span>, changeTimeList<span class="hljs-string"><span class="hljs-string">[[3]]</span></span> + Œ¥t &lt;= t &lt;= changeTimeList<span class="hljs-string"><span class="hljs-string">[[4]]</span></span> - Œ¥t , Œª<span class="hljs-number"><span class="hljs-number">2</span></span>, changeTimeList<span class="hljs-string"><span class="hljs-string">[[4]]</span></span> - Œ¥t &lt;= t &lt;= changeTimeList<span class="hljs-string"><span class="hljs-string">[[4]]</span></span> + Œ¥t, Œª<span class="hljs-number"><span class="hljs-number">1</span></span> + (Œª<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span> Œª<span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> + Cos[Pi (t - (changeTimeList<span class="hljs-string"><span class="hljs-string">[[ 4]]</span></span> - Œ¥t))/(<span class="hljs-number"><span class="hljs-number">2</span></span> Œ¥t)])/<span class="hljs-number"><span class="hljs-number">2</span></span>, t &gt;= changeTimeList<span class="hljs-string"><span class="hljs-string">[[3]]</span></span> + <span class="hljs-number"><span class="hljs-number">1.5</span></span>, Œª<span class="hljs-number"><span class="hljs-number">1</span></span>] ] Plot[loudness[t], {t, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>}, AxesOrigin -&gt; {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, PlotRange -&gt; All]</code> </pre> <br><img src="https://habrastorage.org/webt/xj/ag/ti/xjagtifz1vyaxdxu3ofxxwc0q6u.png"><cut></cut><br><br><pre> <code class="hljs markdown">Off[<span class="hljs-string"><span class="hljs-string">General::stop</span></span>]; SeedRandom[<span class="hljs-string"><span class="hljs-string">111</span></span>]; Monitor[<span class="hljs-string"><span class="hljs-string"> Do[ branchEnd[j, {œÉ_, œÑ_}</span></span>] = branchOnStemEndPoint[<span class="hljs-string"><span class="hljs-string"> allBranches[[j</span></span>]], {œÑ, œÉ}]; If[<span class="hljs-string"><span class="hljs-string">j =!= conductorBranch, With[{v = branchToVoice[j</span></span>]}, tipPosition[<span class="hljs-string"><span class="hljs-string">t_</span></span>] = branchEnd[<span class="hljs-string"><span class="hljs-string">j, loudness[t</span></span>] {ifœÉ[<span class="hljs-string"><span class="hljs-string">v</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>], ifœÑ[<span class="hljs-string"><span class="hljs-string">v</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>]}]]; {X[<span class="hljs-string"><span class="hljs-string">t_</span></span>], Y[<span class="hljs-string"><span class="hljs-string">t_</span></span>], Z[<span class="hljs-string"><span class="hljs-string">t_</span></span>] } = tipPosition[<span class="hljs-string"><span class="hljs-string">t</span></span>]; paramRules = { g -&gt; 20, L -&gt; 1, \[<span class="hljs-string"><span class="hljs-string">ScriptF</span></span>]œï -&gt; 1, \[<span class="hljs-string"><span class="hljs-string">ScriptF</span></span>]Œ∏ -&gt; 1}; While[<span class="hljs-string"><span class="hljs-string"> Check[ pendulumœïŒ∏[j</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t_</span></span>] = NDSolveValue[{eoms /. paramRules, œï[0] == RandomReal[{-Pi, Pi}], œï'[0] == 0.01 RandomReal[{-1, 1}], Œ∏[0] == 0.01 RandomReal[{-1, 1}], Œ∏'[0] == 0.01 RandomReal[{-1, 1}]}, {œï[t], Œ∏[t]}, {t, 0, 105}, PrecisionGoal -&gt; 4, AccuracyGoal -&gt; 4, MaxStepSize -&gt; 0.01, MaxSteps -&gt; 100000, Method -&gt; "BDF"]; False, True]] // Quiet], {j, Length[allBranches]}], j]</code> </pre> <br>        .         . <br><br><pre> <code class="hljs markdown">Plot[<span class="hljs-string"><span class="hljs-string">pendulum\[Phi</span></span>]\[<span class="hljs-string"><span class="hljs-string">Theta</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">51</span></span>][<span class="hljs-string"><span class="hljs-string">t</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">[2</span></span>]], {t, 0, 105}, AspectRatio -&gt; 1/4, PlotRange -&gt; All]</code> </pre> <br><img src="https://habrastorage.org/webt/in/wh/oz/inwhoz2rghhxfk7_skok7xdc5jc.png"><br><br><h3>    </h3><br><br>      . <br><br><pre> <code class="hljs matlab">SeedRandom[<span class="hljs-number"><span class="hljs-number">11</span></span>]; Do[randomColor[<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>] = RandomColor[]; randomAngle[<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>] = RandomReal[{-Pi/<span class="hljs-number"><span class="hljs-number">2</span></span>, Pi/<span class="hljs-number"><span class="hljs-number">2</span></span>}], {<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>, Length[allBranches]}]</code> </pre> <br>        . <br><br><pre> <code class="hljs lua"> conductorœÉœÑ[t_] := Piecewise[ {{{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, t &lt;= firstBeat/ <span class="hljs-number"><span class="hljs-number">2</span></span>}, {(t - firstBeat/<span class="hljs-number"><span class="hljs-number">2</span></span>)/(firstBeat/<span class="hljs-number"><span class="hljs-number">2</span></span>) conductorControlPointsWithPauses<span class="hljs-string"><span class="hljs-string">[[ 1, 2]]</span></span>, firstBeat/<span class="hljs-number"><span class="hljs-number">2</span></span> &lt; t &lt;= firstBeat}, {conductorWithPauses[t], firstBeat &lt; t &lt;= lastBeat}, {(tMax - t)/(tMax - lastBeat) conductorControlPointsWithPauses<span class="hljs-string"><span class="hljs-string">[[-1, 2]]</span></span>, lastBeat &lt; t &lt; tMax}, {{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, t &gt;= tMax}}]</code> </pre> <br>   . <br><br><pre> <code class="hljs markdown"> ListPlot[<span class="hljs-string"><span class="hljs-string">{Table[{t, conductorœÉœÑ[t</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">[1</span></span>]]}, {t, -1, 3, 0.01}], Table[<span class="hljs-string"><span class="hljs-string">{t, conductorœÉœÑ[t</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">[2</span></span>]]}, {t, -1, 3, 0.01}]}, PlotRange -&gt; All, Joined -&gt; True]</code> </pre> <br><img src="https://habrastorage.org/webt/xu/ij/md/xuijmdv35yzk8crpjn4wzml0jsq.png"><br><br><pre> <code class="hljs markdown"> With[<span class="hljs-string"><span class="hljs-string">{animationType = 2}, scalefactors[1</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t_</span></span>] := Switch[<span class="hljs-string"><span class="hljs-string">animationType, 1, {0.8, 1} , 2, loudness[t</span></span>]]; scalefactors[<span class="hljs-string"><span class="hljs-string">2</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t_</span></span>] := Switch[<span class="hljs-string"><span class="hljs-string">animationType, 1, {1, 1} , 2, loudness[t</span></span>]]; scalefactors[<span class="hljs-string"><span class="hljs-string">3</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t_</span></span>] := Switch[<span class="hljs-string"><span class="hljs-string">animationType, 1, {1, 1} , 2, loudness[t</span></span>]]; scalefactors[<span class="hljs-string"><span class="hljs-string">4</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t_</span></span>] := Switch[<span class="hljs-string"><span class="hljs-string">animationType, 1, {1, 1} , 2, loudness[t</span></span>]] ] christmasTreeWithSwingingOrnaments[<span class="hljs-string"><span class="hljs-string">t_, conductorEnhancementFactor : fc_, conductorCandleAngle : œâc_, topRotationAngle : œâ_, opts___</span></span>] := Graphics3D[<span class="hljs-string"><span class="hljs-string">{{Darker[Brown</span></span>], stem}, (<span class="hljs-bullet"><span class="hljs-bullet">* first voice *</span></span>) branchOnStemWithBall[<span class="hljs-string"><span class="hljs-string">allBranches[[#</span></span>]], scalefactors[<span class="hljs-string"><span class="hljs-string">1</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>] voiceœÉœÑ[<span class="hljs-string"><span class="hljs-string">1</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>], Darker[<span class="hljs-string"><span class="hljs-string">Yellow, -0.1</span></span>], If[<span class="hljs-string"><span class="hljs-string">t &lt; 0, {0, 0}, pendulumœïŒ∏[#</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>]]] &amp; /@ voiceBranches[<span class="hljs-string"><span class="hljs-string">[1</span></span>]], (<span class="hljs-bullet"><span class="hljs-bullet">* second voice *</span></span>) branchOnStemWithBall[<span class="hljs-string"><span class="hljs-string">allBranches[[#</span></span>]], scalefactors[<span class="hljs-string"><span class="hljs-string">2</span></span>] [<span class="hljs-string"><span class="hljs-string">t</span></span>] voiceœÉœÑ[<span class="hljs-string"><span class="hljs-string">2</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>], Blend[<span class="hljs-string"><span class="hljs-string">{Red, Pink}</span></span>], If[<span class="hljs-string"><span class="hljs-string">t &lt; 0, {0, 0}, pendulumœïŒ∏[#</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>]]] &amp; /@ voiceBranches[<span class="hljs-string"><span class="hljs-string">[2</span></span>]], (<span class="hljs-bullet"><span class="hljs-bullet">* third voice *</span></span>) branchOnStemWithFiveStar[<span class="hljs-string"><span class="hljs-string">allBranches[[#</span></span>]], scalefactors[<span class="hljs-string"><span class="hljs-string">3</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>] voiceœÉœÑ[<span class="hljs-string"><span class="hljs-string">3</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>], randomColor[<span class="hljs-string"><span class="hljs-string">#</span></span>], Pi/4, If[<span class="hljs-string"><span class="hljs-string">t &lt; 0, {0, 0}, pendulumœïŒ∏[#</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>]]] &amp; /@ voiceBranches[<span class="hljs-string"><span class="hljs-string">[3</span></span>]], (<span class="hljs-bullet"><span class="hljs-bullet">* fourth voice *</span></span>) branchOnStemWithCandle[<span class="hljs-string"><span class="hljs-string">#, scalefactors[4</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>] voiceœÉœÑ[<span class="hljs-string"><span class="hljs-string">4</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>], Directive[White, Glow[GrayLevel[0.3]], Specularity[Yellow, 20]], 0] &amp; /@ allBranches[[voiceBranches[[4]]]], (<span class="hljs-bullet"><span class="hljs-bullet">* conductor *</span></span>) branchOnStemWithCandle[ allBranches[[conductorBranch]] {1, 1, 1 + fc}, conductorœÉœÑ[t], Directive[Red, Glow[GrayLevel[0.1]], Specularity[Yellow, 20]], œâc], Rotate[top, œâ, {0, 0, 1}] }, opts, ViewPoint -&gt; {2.8, 1.79, 0.1}, PlotRange -&gt; {{-8, 8}, {-8, 8}, {-2, 15}}, Background -&gt; RGBColor[0.998, 1., 0.867] ]</code> </pre> <br>    ,     . <cut></cut><br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Show</span></span>[christmasTreeWithSwingingOrnaments[<span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0.8</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>], PlotRange -&gt; <span class="hljs-keyword"><span class="hljs-keyword">All</span></span>, Boxed -&gt; <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>]</code> </pre> <br><img src="https://habrastorage.org/webt/re/4v/4k/re4v4kfo-mzlwfjnb4qa6kavtue.png"><br><br><h3>   ! </h3><br>       () . ,    3D-,     .  ,   PDE (http://psoup.math.wisc.edu/papers/h3l.pdf),            ,   ,   . <br><br><h4>  (2D) </h4><br>   -      ¬´ <a href="http://demonstrations.wolfram.com/SnowflakeLikePatterns/">- </a> ¬ª.         ,    hex  snowflake. <br><br><pre> <code class="hljs lua">ReleaseHold /@ (MakeExpression[#<span class="hljs-string"><span class="hljs-string">[[1]]</span></span>, StandardForm] &amp; /@ Take[Cases[ Import[<span class="hljs-string"><span class="hljs-string">"http://demonstrations.wolfram.com/downloadauthornb.cgi?\ name=SnowflakeLikePatterns"</span></span>], Cell[_, <span class="hljs-string"><span class="hljs-string">"Input"</span></span>, ___], ‚àû], <span class="hljs-number"><span class="hljs-number">2</span></span>]); makeSnowflake[rule_, steps_] := Polygon[hex[#] &amp; /@ Select[Position[Reverse[CellularAutomaton[ {snowflakes<span class="hljs-string"><span class="hljs-string">[[ rule]]</span></span>, {<span class="hljs-number"><span class="hljs-number">2</span></span>, {{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, {<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, {<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}}}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}}, {{{<span class="hljs-number"><span class="hljs-number">1</span></span>}}, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {{{steps}}, {-steps, steps}, {-steps, steps}}]], <span class="hljs-number"><span class="hljs-number">0</span></span>], -steps - <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; -#<span class="hljs-string"><span class="hljs-string">[[1]]</span></span> + #<span class="hljs-string"><span class="hljs-string">[[2]]</span></span> &lt; steps + <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;]] SeedRandom[<span class="hljs-number"><span class="hljs-number">33</span></span>]; Table[Graphics[{Darker[Blue], makeSnowflake[RandomInteger[{<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3888</span></span>}], RandomInteger[{<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>}]]}], {<span class="hljs-number"><span class="hljs-number">4</span></span>}]</code> </pre> <br><img src="https://habrastorage.org/webt/3o/v4/mu/3ov4mutuj13iuepzcbvvnnycnug.png"><br><br>     ,   ,  .    ,   . <cut></cut><br><br><pre> <code class="hljs xml">denseFlakeQ[mr_MeshRegion] := With[{c = RegionCentroid[mr], pts = MeshCoordinates[mr]}, ( Divide @@ MinMax[EuclideanDistance[c, #] &amp; /@ pts]) <span class="hljs-tag"><span class="hljs-tag">&lt; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">3</span></span></span><span class="hljs-tag">] </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">randomSnowflakes</span></span></span><span class="hljs-tag">[] </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span><span class="hljs-tag">= </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">Module[{sf},</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">While</span></span></span><span class="hljs-tag">[(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sf</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">Module[{},</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TimeConstrained</span></span></span><span class="hljs-tag">[ </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hexagons</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">makeSnowflake[RandomInteger[{1,</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">3888</span></span></span><span class="hljs-tag">}], </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">RandomInteger</span></span></span><span class="hljs-tag">[{</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">10</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">60</span></span></span><span class="hljs-tag">}]]; (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Select</span></span></span><span class="hljs-tag">[</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ConnectedMeshComponents</span></span></span><span class="hljs-tag">[</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DiscretizeRegion</span></span></span><span class="hljs-tag">[</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hexagons</span></span></span><span class="hljs-tag">]], (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Area</span></span></span><span class="hljs-tag">[#] &gt;</span></span> 120 &amp;&amp; Perimeter[#]/Area[#] <span class="hljs-tag"><span class="hljs-tag">&lt; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">2</span></span></span><span class="hljs-tag"> &amp;&amp; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">denseFlakeQ</span></span></span><span class="hljs-tag">[#]) &amp;] /</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">.</span></span></span><span class="hljs-tag"> \ </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">_ConnectedMeshComponents</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span><span class="hljs-tag">&gt;</span></span> {}) // Quiet, 20, {}]]) === {}]; sf] randomSnowflakes[n_] := Take[NestWhile[Join[#, randomSnowflakes[]] &amp;, {}, Length[#] <span class="hljs-tag"><span class="hljs-tag">&lt; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">n</span></span></span><span class="hljs-tag"> &amp;], </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">n</span></span></span><span class="hljs-tag">] </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SeedRandom</span></span></span><span class="hljs-tag">[</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">22</span></span></span><span class="hljs-tag">]; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">randomSnowflakes</span></span></span><span class="hljs-tag">[</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">4</span></span></span><span class="hljs-tag">]</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/td/2f/sz/td2fszyydyxj5yvfuymsvssi0xi.png"><br><br><pre> <code class="hljs mel">normalizeFlake[mr_MeshRegion] := Module[{coords, center, coords1, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>, coords2}, coords = MeshCoordinates[mr]; center = Mean[coords]; coords1 = (# - center) &amp; /@ coords; <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = Max[Norm /@ coords1]; coords2 = coords1/<span class="hljs-keyword"><span class="hljs-keyword">size</span></span>; GraphicsComplex[coords2, {EdgeForm[], MeshCells[mr, <span class="hljs-number"><span class="hljs-number">2</span></span>]}]]</code> </pre> <br>      . <br><br><img src="https://habrastorage.org/webt/nr/24/of/nr24ofiigciiocqdy9ds-kcg-f8.png"><br><br><h4>  (3D) </h4><br><br>    2D ,           ,   3D . <br><br><pre> <code class="hljs lua">make3DFlake[flake2D_] := Module[{grc, reg, boundary, h, bc, rb, polys, pts}, grc = flake2D<span class="hljs-string"><span class="hljs-string">[[1]]</span></span>; reg = MeshRegion @@ (grc /. _EdgeForm :&gt; Nothing); boundary = (MeshPrimitives[#, <span class="hljs-number"><span class="hljs-number">1</span></span>] &amp;@RegionBoundary[reg])<span class="hljs-string"><span class="hljs-string">[[All, 1]]</span></span>; h = RandomReal[{<span class="hljs-number"><span class="hljs-number">0.05</span></span>, <span class="hljs-number"><span class="hljs-number">0.15</span></span>}]; bc = Join[#<span class="hljs-number"><span class="hljs-number">1</span></span>, Reverse[#<span class="hljs-number"><span class="hljs-number">2</span></span>]] &amp; @@@ Transpose[{Map[Append[#, <span class="hljs-number"><span class="hljs-number">0</span></span>] &amp;, boundary, {<span class="hljs-number"><span class="hljs-number">-2</span></span>}], Map[Append[#, h] &amp;, boundary, {<span class="hljs-number"><span class="hljs-number">-2</span></span>}]}]; rb = RegionBoundary[reg]; boundary = (MeshCells[#, <span class="hljs-number"><span class="hljs-number">1</span></span>] &amp;@rb)<span class="hljs-string"><span class="hljs-string">[[All, 1]]</span></span>; polys = Polygon[Join[#<span class="hljs-number"><span class="hljs-number">1</span></span>, Reverse[#<span class="hljs-number"><span class="hljs-number">2</span></span>]] &amp; @@@ Transpose[{boundary, boundary + Max[boundary]}]]; pts = Join[Append[#, <span class="hljs-number"><span class="hljs-number">0</span></span>] &amp; /@ MeshCoordinates[rb], Append[#, h] &amp; /@ MeshCoordinates[rb]]; {GraphicsComplex[Developer`ToPackedArray[pts], polys], MapAt[Developer`ToPackedArray[Append[#, <span class="hljs-number"><span class="hljs-number">0</span></span>]] &amp; /@ # &amp;, flake2D<span class="hljs-string"><span class="hljs-string">[[1]]</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], MapAt[Developer`ToPackedArray[Append[#, h]] &amp; /@ # &amp;, flake2D<span class="hljs-string"><span class="hljs-string">[[1]]</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]} ] listOfSnowflakes3D = make3DFlake /@ listOfSnowflakes; Graphics3D[{EdgeForm[], #}, Boxed -&gt; False, Method -&gt; {<span class="hljs-string"><span class="hljs-string">"ShrinkWrap"</span></span> -&gt; True}, ImageSize -&gt; <span class="hljs-number"><span class="hljs-number">120</span></span>, Lighting -&gt; {{<span class="hljs-string"><span class="hljs-string">"Ambient"</span></span>, Hue[<span class="hljs-number"><span class="hljs-number">.58</span></span>, <span class="hljs-number"><span class="hljs-number">.5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]}, {<span class="hljs-string"><span class="hljs-string">"Directional"</span></span>, GrayLevel[<span class="hljs-number"><span class="hljs-number">.3</span></span>], ImageScaled[{<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}]}}] &amp; /@ listOfSnowflakes3D</code> </pre> <br><img src="https://habrastorage.org/webt/ls/vk/i8/lsvki80y-ddgmvtraq5tgvz6bzy.png"><br><br><h4>    </h4><br>        <a href="">  </a>  1994 . ,        ,      . <br><br><pre> <code class="hljs lua">Manipulate[ Module[{eqs, nds, tmax, g = <span class="hljs-number"><span class="hljs-number">10</span></span>, Œ±, sign, V, x, y, u, v, Œ∏, œâ, kpar = kperp/f, œÅ = <span class="hljs-number"><span class="hljs-number">10</span></span>^œÅ<span class="hljs-built_in"><span class="hljs-built_in">exp</span></span>}, Œ± = ArcTan[u[t], v[t]]; sign = Piecewise[{{<span class="hljs-number"><span class="hljs-number">1</span></span>, (v[t] &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; <span class="hljs-number"><span class="hljs-number">0</span></span> &lt;= Œ± + Œ∏[t] &lt;= Pi) || (v[t] &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; -Pi &lt;= Œ± + Œ∏[t] &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>)}}, <span class="hljs-number"><span class="hljs-number">-1</span></span>]; V = Sqrt[u[t]^<span class="hljs-number"><span class="hljs-number">2</span></span> + v[t]^<span class="hljs-number"><span class="hljs-number">2</span></span>]; eqs = {D[x[t], t] == u[t], D[y[t], t] == v[t], D[u[t], t] == -(kperp Sin[Œ∏[t]]^<span class="hljs-number"><span class="hljs-number">2</span></span> + kpar Cos[Œ∏[t]]^<span class="hljs-number"><span class="hljs-number">2</span></span>) u[ t] + (kperp - kpar) Sin[Œ∏[ t]] Cos[Œ∏[t]] v[t] - sign Pi œÅ V^<span class="hljs-number"><span class="hljs-number">2</span></span> Cos[Œ± + Œ∏[t]] Cos[Œ±], D[v[t], t] == -(kperp Cos[Œ∏[t]]^<span class="hljs-number"><span class="hljs-number">2</span></span> + kpar Sin[Œ∏[t]]^<span class="hljs-number"><span class="hljs-number">2</span></span>) v[ t] + (kperp - kpar) Sin[Œ∏[ t]] Cos[Œ∏[t]] u[t] + sign Pi œÅ V^<span class="hljs-number"><span class="hljs-number">2</span></span> Cos[Œ± + Œ∏[ t]] Sin[Œ±] - g, D[œâ[t], t] == -kperp œâ[ t] - (<span class="hljs-number"><span class="hljs-number">3</span></span> Pi œÅ V^<span class="hljs-number"><span class="hljs-number">2</span></span>/l) Cos[Œ± + Œ∏[ t]] Sin[Œ± + Œ∏[t]], D[Œ∏[t], t] == œâ[t]} /. kpar -&gt; kperp/f; nds = NDSolve[ Join[eqs, {x[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span>, y[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span>, u[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span>, v[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-number"><span class="hljs-number">0.01</span></span>, œâ[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span>, Œ∏[<span class="hljs-number"><span class="hljs-number">0</span></span>] == Œ∏<span class="hljs-number"><span class="hljs-number">0</span></span>}], {x, y, u, v, Œ∏, œâ}, {t, <span class="hljs-number"><span class="hljs-number">0</span></span>, T}, MaxSteps -&gt; <span class="hljs-number"><span class="hljs-number">2000</span></span>] // Quiet; tmax = nds<span class="hljs-string"><span class="hljs-string">[[1, 2, 2, 1, 1, 2]]</span></span>; Graphics[{Thickness[<span class="hljs-number"><span class="hljs-number">0.002</span></span>], Gray, Table[Evaluate[ Line[{{x[t], y[t]} - l/<span class="hljs-number"><span class="hljs-number">2</span></span> {Cos[Œ∏[t]], Sin[Œ∏[t]]}, {x[t], y[t]} + l/<span class="hljs-number"><span class="hljs-number">2</span></span> {Cos[Œ∏[t]], Sin[Œ∏[t]]}}] /. nds<span class="hljs-string"><span class="hljs-string">[[1]]</span></span>], {t, <span class="hljs-number"><span class="hljs-number">0</span></span>, tmax, tmax/n}], Blue, Line[Table[ Evaluate[{x[t], y[t]} /. nds<span class="hljs-string"><span class="hljs-string">[[1]]</span></span>], {t, <span class="hljs-number"><span class="hljs-number">0</span></span>, tmax, tmax/<span class="hljs-number"><span class="hljs-number">200</span></span>}]]}, AspectRatio -&gt; ar, Frame -&gt; True, PlotRange -&gt; All]], <span class="hljs-string"><span class="hljs-string">"system parameters"</span></span>, {{kperp, <span class="hljs-number"><span class="hljs-number">5.1</span></span>, Subscript[<span class="hljs-string"><span class="hljs-string">"k"</span></span>, <span class="hljs-string"><span class="hljs-string">"‚àü"</span></span>]}, <span class="hljs-number"><span class="hljs-number">0.01</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, Appearance -&gt; <span class="hljs-string"><span class="hljs-string">"Labeled"</span></span>}, {{f, <span class="hljs-number"><span class="hljs-number">145</span></span>, Row[{Subscript[<span class="hljs-string"><span class="hljs-string">"k"</span></span>, <span class="hljs-string"><span class="hljs-string">"‚àü"</span></span>], <span class="hljs-string"><span class="hljs-string">"/"</span></span>, Subscript[<span class="hljs-string"><span class="hljs-string">"k"</span></span>, <span class="hljs-string"><span class="hljs-string">"‚à•"</span></span>]}]}, <span class="hljs-number"><span class="hljs-number">0.01</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>, Appearance -&gt; <span class="hljs-string"><span class="hljs-string">"Labeled"</span></span>}, {{œÅ<span class="hljs-built_in"><span class="hljs-built_in">exp</span></span>, <span class="hljs-number"><span class="hljs-number">-0.45</span></span>, Log[<span class="hljs-string"><span class="hljs-string">"œÅ"</span></span>]}, <span class="hljs-number"><span class="hljs-number">-3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, Appearance -&gt; <span class="hljs-string"><span class="hljs-string">"Labeled"</span></span>}, {{l, <span class="hljs-number"><span class="hljs-number">0.63</span></span>}, <span class="hljs-number"><span class="hljs-number">0.01</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, Appearance -&gt; <span class="hljs-string"><span class="hljs-string">"Labeled"</span></span>} , Delimiter, <span class="hljs-string"><span class="hljs-string">"fall parameters"</span></span>, {{Œ∏<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, Subscript[<span class="hljs-string"><span class="hljs-string">"Œ∏"</span></span>, <span class="hljs-string"><span class="hljs-string">"0"</span></span>]}, -Pi, Pi, Appearance -&gt; <span class="hljs-string"><span class="hljs-string">"Labeled"</span></span>}, {{T, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"falling time"</span></span>}, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, Appearance -&gt; <span class="hljs-string"><span class="hljs-string">"Labeled"</span></span>} , Delimiter, <span class="hljs-string"><span class="hljs-string">"plot"</span></span>, {{ar, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"aspect ratio"</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, Automatic}}, {{n, <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">"snapshots"</span></span>}, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}]</code> </pre> <br><img src="https://habrastorage.org/webt/z2/bf/bn/z2bfbnckxmcysbv4fxp5_2k8izw.png"><br><br>        ,      .            /       ,       . <br><br><h4>   </h4><br>      ,      . <br><br><pre> <code class="hljs markdown">randomParametrizedRotationMatrix[<span class="hljs-string"><span class="hljs-string">n_, œÑ_</span></span>] := Function @@ {œÑ, Module[<span class="hljs-string"><span class="hljs-string">{phi, s, c}, Do[phi[i</span></span>] = Sum[<span class="hljs-string"><span class="hljs-string">RandomReal[{-1, 1}</span></span>] Sin[<span class="hljs-string"><span class="hljs-string"> RandomReal[{0, n}</span></span>] œÑ + 2 Pi RandomReal[<span class="hljs-string"></span><span class="hljs-string"></span>]], {n}]; {c[<span class="hljs-string"><span class="hljs-string">i</span></span>], s[<span class="hljs-string"><span class="hljs-string">i</span></span>]} = {Cos[<span class="hljs-string"><span class="hljs-string">phi[i</span></span>]], Sin[<span class="hljs-string"><span class="hljs-string">phi[i</span></span>]]}, {i, 3}]; {{c[<span class="hljs-string"><span class="hljs-string">1</span></span>], s[<span class="hljs-string"><span class="hljs-string">1</span></span>], 0}, {-s[<span class="hljs-string"><span class="hljs-string">1</span></span>], c[<span class="hljs-string"><span class="hljs-string">1</span></span>], 0}, {0, 0, 1}}. {{c[<span class="hljs-string"><span class="hljs-string">2</span></span>], 0, s[<span class="hljs-string"><span class="hljs-string">2</span></span>]}, {0, 1, 0}, {-s[<span class="hljs-string"><span class="hljs-string">2</span></span>], 0, c[<span class="hljs-string"><span class="hljs-string">2</span></span>]}}. {{1, 0, 0}, {0, c[<span class="hljs-string"><span class="hljs-string">3</span></span>], s[<span class="hljs-string"><span class="hljs-string">3</span></span>]}, {0, -s[<span class="hljs-string"><span class="hljs-string">3</span></span>], c[<span class="hljs-string"><span class="hljs-string">3</span></span>]}}]}; randomParametrizedPathFunction := Function[<span class="hljs-string"><span class="hljs-string">t, Evaluate[{RandomReal[{-5, 5}</span></span>] + Sum[<span class="hljs-string"><span class="hljs-string">RandomReal[{-1, 1}</span></span>]/# Cos[<span class="hljs-string"><span class="hljs-string">2 Pi # t</span></span>] &amp;[<span class="hljs-string"><span class="hljs-string"> RandomReal[{1, 4}</span></span>]], {k, 5}], RandomReal[<span class="hljs-string"><span class="hljs-string">{-5, 5}</span></span>] + Sum[<span class="hljs-string"><span class="hljs-string">RandomReal[{-1, 1}</span></span>]/# Cos[<span class="hljs-string"><span class="hljs-string">2 Pi # t</span></span>] &amp;[<span class="hljs-string"><span class="hljs-string"> RandomReal[{1, 4}</span></span>]], {k, 5}], RandomReal[<span class="hljs-string"><span class="hljs-string">{2, 12}</span></span>] - RandomReal[<span class="hljs-string"><span class="hljs-string">{1.5, 2.5}</span></span>] t}]] SeedRandom[<span class="hljs-string"><span class="hljs-string">55</span></span>]; Do[<span class="hljs-string"><span class="hljs-string">rotMat[j</span></span>] = randomParametrizedRotationMatrix[<span class="hljs-string"><span class="hljs-string">3, œÑ</span></span>]; trans[<span class="hljs-string"><span class="hljs-string">j</span></span>] = randomParametrizedPathFunction; snowflakeColor[<span class="hljs-string"><span class="hljs-string"> j</span></span>] = {{"Ambient", Hue[<span class="hljs-string"><span class="hljs-string">RandomReal[{0.55, 0.6}</span></span>], RandomReal[<span class="hljs-string"><span class="hljs-string">{0.48, 0.52}</span></span>], RandomReal[<span class="hljs-string"><span class="hljs-string">{0.95, 1}</span></span>]]}, {"Directional", GrayLevel[<span class="hljs-string"><span class="hljs-string">RandomReal[{0.28, 0.32}</span></span>]], ImageScaled[<span class="hljs-string"><span class="hljs-string">{1, 1, 0}</span></span>]}}, {j, Length[<span class="hljs-string"><span class="hljs-string">listOfSnowflakes</span></span>]}] fallingSnowflake[<span class="hljs-string"><span class="hljs-string">flake_, {t_, ‚Ñõ_}</span></span>] := flake /. GraphicsComplex[<span class="hljs-string"><span class="hljs-string">cs_, rest__</span></span>] :&gt; GraphicsComplex[<span class="hljs-string"><span class="hljs-string">(‚Ñõ.# + t) &amp; /@ cs, rest</span></span>] Manipulate[<span class="hljs-string"><span class="hljs-string"> Graphics3D[{EdgeForm[</span></span>], Table[<span class="hljs-string"><span class="hljs-string">{Lighting -&gt; snowflakeColor[k</span></span>], fallingSnowflake[<span class="hljs-string"><span class="hljs-string"> listOfSnowflakes3D[[k</span></span>]], {trans[<span class="hljs-string"><span class="hljs-string">k</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>], rotMat[<span class="hljs-string"><span class="hljs-string">k</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">t</span></span>]}]}, {k, Length[listOfSnowflakes3D]}] }, PlotRange -&gt; 6, ViewPoint -&gt; {0, -10, 0}, ImageSize -&gt; 400], {{t, 3.2}, -5, 20}]</code> </pre> <br><img src="https://habrastorage.org/webt/wu/yk/op/wuykoprh8vehlmnoinb-ukq8cla.png"><br><br>       . <cut></cut><br><br><h3>    </h3><br>   ,   ,         .       . ,          .     ,      ,       .   24     . <br><br><pre> <code class="hljs lua">conductorBranchMaxfactor = <span class="hljs-number"><span class="hljs-number">0.5</span></span>; conductorBranchLength[t_] := conductorBranchMaxfactor* Which[t &lt; <span class="hljs-number"><span class="hljs-number">-3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-3</span></span> &lt; t &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>, (t + <span class="hljs-number"><span class="hljs-number">3</span></span>)/<span class="hljs-number"><span class="hljs-number">3.</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> &lt;= t &lt;= tMax, <span class="hljs-number"><span class="hljs-number">1</span></span>, tMax &lt; t &lt; tMax + <span class="hljs-number"><span class="hljs-number">3</span></span>, (<span class="hljs-number"><span class="hljs-number">1</span></span> - (t - tMax)/<span class="hljs-number"><span class="hljs-number">3</span></span>), True, <span class="hljs-number"><span class="hljs-number">0</span></span>]; topRotation[t_] := Which[t &lt; <span class="hljs-number"><span class="hljs-number">-3</span></span> || t &gt; tMax + <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, True, (<span class="hljs-number"><span class="hljs-number">1.</span></span> - Cos[(t + <span class="hljs-number"><span class="hljs-number">3</span></span>)/(tMax + <span class="hljs-number"><span class="hljs-number">6</span></span>)]) <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> Pi]; viewPoint[t_] := With[{vp = {<span class="hljs-number"><span class="hljs-number">2.8</span></span>, <span class="hljs-number"><span class="hljs-number">1.79</span></span>, <span class="hljs-number"><span class="hljs-number">0.1</span></span>}}, Which[t &lt; changeTimeList<span class="hljs-string"><span class="hljs-string">[[1]]</span></span> || t &gt; changeTimeList<span class="hljs-string"><span class="hljs-string">[[2]]</span></span>, vp, changeTimeList<span class="hljs-string"><span class="hljs-string">[[1]]</span></span> &lt;= t &lt;= changeTimeList<span class="hljs-string"><span class="hljs-string">[[2]]</span></span>, Module[{t0 = changeTimeList<span class="hljs-string"><span class="hljs-string">[[1]]</span></span>, Œît = changeTimeList<span class="hljs-string"><span class="hljs-string">[[2]]</span></span> - changeTimeList<span class="hljs-string"><span class="hljs-string">[[1]]</span></span>, œâvp}, œâvp = -Pi (<span class="hljs-number"><span class="hljs-number">1</span></span> - Cos[ Pi (t - t0)/Œît]); {{Cos[œâvp], Sin[œâvp], <span class="hljs-number"><span class="hljs-number">0</span></span>}, {-Sin[œâvp], Cos[œâvp], <span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}}.vp + {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span> Sin[Pi (t - t0)/Œît]^<span class="hljs-number"><span class="hljs-number">4</span></span> }]]] ParametricPlot3D[ viewPoint[t], {t, changeTimeList<span class="hljs-string"><span class="hljs-string">[[1]]</span></span>, changeTimeList<span class="hljs-string"><span class="hljs-string">[[2]]</span></span>}, BoxRatios -&gt; {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}]</code> </pre> <br><img src="https://habrastorage.org/webt/0t/q1/s2/0tq1s2smdbzunfogo4qf2n7vz28.png"><br><br><pre> <code class="hljs rust">animationFrame[t_] := Show[christmasTreeWithSwingingOrnaments[t, conductorBranchLength[t], <span class="hljs-number"><span class="hljs-number">1.4</span></span> conductorBranchLength[t], topRotation[t]], Background -&gt; <span class="hljs-literal"><span class="hljs-literal">None</span></span>, Boxed -&gt; False, SphericalRegion -&gt; True, ViewPoint -&gt; viewPoint[t]]</code> </pre><br>      ,    : <cut></cut><br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">animationFrame</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[35]</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/kc/65/89/kc6589uigtujt2v1n5y9i3nfw-w.png"><br><br><pre> <code class="hljs pgsql">framesPerSecond = <span class="hljs-number"><span class="hljs-number">24</span></span>; animationFrameDirectory = "/Users/mtrott/Desktop/ConductingChristmasTreeAnimationFrames/"; Monitor[ <span class="hljs-keyword"><span class="hljs-keyword">Do</span></span>[ <span class="hljs-keyword"><span class="hljs-keyword">With</span></span>[{t = <span class="hljs-number"><span class="hljs-number">-3</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>/framesPerSecond (frame - <span class="hljs-number"><span class="hljs-number">1</span></span>)}, gr = animationFrame[t]; Export[animationFrameDirectory &lt;&gt; IntegerString[frame, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>] &lt;&gt; ".png", gr, ImageSize -&gt; <span class="hljs-number"><span class="hljs-number">1800</span></span>, Background -&gt; <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>] ], {frame, <span class="hljs-number"><span class="hljs-number">1</span></span>, framesPerSecond (<span class="hljs-number"><span class="hljs-number">100</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>)}], <span class="hljs-keyword"><span class="hljs-keyword">Row</span></span>[{frame, " | ", Round[MemoryInUse[]/<span class="hljs-number"><span class="hljs-number">1024</span></span>^<span class="hljs-number"><span class="hljs-number">2</span></span>], "\[ThinSpace]MB" }] ]</code> </pre> <br>          (, Adobe After Effects)    ,    . <br><br>      info-russia@wolfram.com <br><br> <a href="https://www.wolfram.com/mathematica/trial/">   Mathematica</a> <br> <a href="https://account.wolfram.com/access/wolfram-one/trial">  Wolfram|One</a> </div><p>Source: <a href="https://habr.com/ru/post/345358/">https://habr.com/ru/post/345358/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345344/index.html">Sending a request to the specified MS SQL Server databases of all the specified servers using available tools</a></li>
<li><a href="../345346/index.html">Nebraska problem</a></li>
<li><a href="../345348/index.html">Adapting RoboVM for compiling for iOS from Windows / Linux</a></li>
<li><a href="../345350/index.html">Adding 3D objects to video</a></li>
<li><a href="../345356/index.html">Universal Dumper / Injector Unity3D (Mono, Android)</a></li>
<li><a href="../345362/index.html">Monte Carlo option premium calculation vs Black-Scholes formula</a></li>
<li><a href="../345364/index.html">We include support for TLS v1.3 in Nginx using the example of Debian 9</a></li>
<li><a href="../345366/index.html">Richard Hamming: "There are thoughts you can't think about"</a></li>
<li><a href="../345368/index.html">A selection of tutorials on AR / VR</a></li>
<li><a href="../345370/index.html">POWA-like PostgreSQL Monitoring with Prometheus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>