<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Metaprogramming</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Metaprogramming is the general name for a class of automation tools for a programmer. They understand code generation, preprocessor macros in C, C ++ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Metaprogramming</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/2d2/ca6/20d/2d2ca620dad7e0b943b72cbd8f8dc291.jpg" alt="image" align="left">  <a href="http://en.wikipedia.org/wiki/Metaprogramming">Metaprogramming</a> is the general name for a class of automation tools for a programmer.  They understand code generation, preprocessor macros in C, C ++ templates, LISP macros, creating their own DSLs, as well as using dynamic languages ‚Äã‚Äãwith code generation on the fly.  <a href="http://nemerle.org/Main_Page">Nemerle</a> supports another metaprogramming option. <br><br><a name="habracut"></a>  If so there are so many options, then it seems that inventing a new one does not make sense, but each of the listed options for implementing metaprogramming ideas has its own drawbacks that are not compatible with the ideas of the <a href="http://nemerle.org/Main_Page">Nemerle</a> language. <br><br>  Firstly, Nemerle is a compiled programming language, so the mechanisms from Ruby, Tcl and LISP fall away. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Macros C are the least powerful of all, since there is a large class of tasks that can be automated using macros from LISP, but not too much for macros C. In addition, macros C are not safe, since often the macro argument is calculated several times, is a function with a side effect, a subtle bug appears in the program. <br><br>  The advantage of code generation is that it has no relation to the language, but from this it follows its disadvantage - the project is complicated to build. <br><br>  C ++ templates are a good technology, but it has a lot of birth injuries, for example, it works at the text level, there are problems with interaction between libraries, and also relatively simple code on templates looks relatively simple, but complex code on templates looks very difficult.  This approach differs from the unspoken truth that an arbitrarily complex code should have a simple interface. <br><br>  Summarizing, you can describe what properties metaprogramming in Nemerle has: <br><ul><li>  Powerful macrosystem, similar to macrosystem in LISP. </li><li>  Macros are not distributed as source code, but as compiled assemblies ‚Äî plug-ins for the compiler. </li><li>  Using macros is as simple as using libraries. </li></ul><br>  <b>So what is a macro in the context of Nemerle?</b> <br><br>  A macro is a mapping (function) from a syntax tree to a syntax tree.  Simplified, the source code compiler builds a syntax tree, then the parts of the syntax tree describing the classes marked with the macro attribute are modified by the action of the macro itself and the compilation process continues. <br><br>  Macros can change the syntax trees of a particular class, as well as the entire program, thus, Neprole‚Äôs metaprogramming is powerful enough.  By power, I mean that the set of tasks that can be automated in Nemerle is quite wider than in other languages. <br><br>  <b>What for?</b> <br><br>  It is difficult to understand why and when to use metaprogramming, so it is best to analyze the tasks that use it.  The task of object serialization is the task of metaprogramming.  Suppose we have classes that define object trees, for example <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> A <br> { <br> <font color="#0000ff">public</font> Foo : <font color="#0000ff">int</font> { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> Bar : <font color="#0000ff">string</font> { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> } <br> <br> <font color="#0000ff">class</font> B <br> { <br> <font color="#0000ff">public</font> Baz : A { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> Pub : <font color="#0000ff">byte</font> { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Now add the code responsible for serialization: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">interface</font> ISerializable <br> { <br> Serialize(stream : StreamWriter) : <font color="#0000ff">void</font> ; <br> } <br> <br> <font color="#0000ff">class</font> A : ISerializable <br> { <br> <font color="#0000ff">public</font> Foo : <font color="#0000ff">int</font> { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> Bar : <font color="#0000ff">string</font> { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <br> <font color="#0000ff">public</font> Serialize(stream : StreamWriter) : <font color="#0000ff">void</font> <br> { <br> stream.WriteLine( <font color="#A31515">"&lt;A&gt;"</font> ); <br> stream.WriteLine($ <font color="#A31515">"&lt;Foo&gt;&lt;int&gt;$Foo&lt;/int&gt;&lt;/Foo&gt;"</font> ); <br> stream.WriteLine($ <font color="#A31515">"&lt;Bar&gt;&lt;string&gt;$Bar&lt;/string&gt;&lt;/Bar&gt;"</font> ); <br> stream.WriteLine( <font color="#A31515">"&lt;/A&gt;"</font> ); <br> } <br> } <br> <br> <font color="#0000ff">class</font> B : ISerializable <br> { <br> <font color="#0000ff">public</font> Baz : A { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> Pub : <font color="#0000ff">byte</font> { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <br> <font color="#0000ff">public</font> Serialize(stream : StreamWriter) : <font color="#0000ff">void</font> <br> { <br> stream.WriteLine( <font color="#A31515">"&lt;B&gt;"</font> ); <br> stream.WriteLine( <font color="#A31515">"&lt;Baz&gt;"</font> ); <br> when(Baz!= <font color="#0000ff">null</font> ) Baz.Serialize(stream); <br> stream.WriteLine( <font color="#A31515">"&lt;/Baz&gt;"</font> ); <br> stream.WriteLine($ <font color="#A31515">"&lt;Pub&gt;&lt;byte&gt;$Pub&lt;/byte&gt;&lt;/Pub&gt;"</font> ); <br> stream.WriteLine( <font color="#A31515">"&lt;/B&gt;"</font> ); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Obviously, there is a formal algorithm that translates the code from the first example into the code of the second example; if this algorithm is written in the Nemerle language, then we get a macro.  Then the code with serialization support can be rewritten, for example, like this: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">[MakeSerializable] <br> <font color="#0000ff">class</font> A <br> { <br> <font color="#0000ff">public</font> Foo : <font color="#0000ff">int</font> { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> Bar : <font color="#0000ff">string</font> { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> } <br> [MakeSerializable] <br> <font color="#0000ff">class</font> B <br> { <br> <font color="#0000ff">public</font> Baz : A { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> Pub : <font color="#0000ff">byte</font> { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Where MakeSerializable is a macro call. <br><br>  Based on this example, it is easy to derive a sign that it is time to use metaprogramming: <br><blockquote>  Above the code that ensures the operation of the main algorithm, repeated operations are performed. </blockquote><br><br>  It's funny that if Nemerle were mainstream, many products simply would not have appeared, for example, the AOP <a href="http://www.postsharp.org/">Postsharp</a> tool would not be necessary, since all its capabilities are easily and simply implemented through macros.  <a href="http://www.nunit.org/">NUnit</a> is another well-known tool. In the latest version, the parameterized tests were added, again this feature can be easily implemented through macros in Nemerle for the next version of <a href="http://www.nunit.org/">NUnit</a> , and with higher type control. <br><br>  For those who like numbers, the use of metaprogramming in my search project formulas reduced the amount of code by 20%, helped to improve the design of the system, since the awareness that the code will be transformed, makes writing code more structured.  An additional advantage is that the use of metaprogramming has facilitated the refactoring of the system. <br><br>  In conclusion, I want to once again note that the use of metaprogramming is aimed at reducing the auxiliary code and, as a result, the errors associated with it.  The key word here is the word "auxiliary", so the benefits of using metaprogramming will be primarily noticeable in large projects. </div><p>Source: <a href="https://habr.com/ru/post/58801/">https://habr.com/ru/post/58801/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../58796/index.html">Call of Duty 7!</a></li>
<li><a href="../58797/index.html">We connect transports to GTalk. Through thorns ...</a></li>
<li><a href="../58798/index.html">Add any video to your iTunes collection.</a></li>
<li><a href="../58799/index.html">iPod without iTunes? This is real!</a></li>
<li><a href="../58800/index.html">5 April startups</a></li>
<li><a href="../58803/index.html">How do the world see color blindness?</a></li>
<li><a href="../58807/index.html">Offline pinery, no registrations and personal in 1 html</a></li>
<li><a href="../58810/index.html">Zero prototype or projects "for yourself"</a></li>
<li><a href="../58811/index.html">Does anyone need a translation of "Developing a Comprehensive Autoloader"?</a></li>
<li><a href="../58812/index.html">A fresh look at things</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>