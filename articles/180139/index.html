<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MXML compiler. Part 3. We understand the work of the Flex-compiler</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi% habra_user%! 

 In the course of a series of articles on the Flex compiler, I decided to translate a good article by the author of this work on wh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MXML compiler. Part 3. We understand the work of the Flex-compiler</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/48a/a6a/a5d/48aa6aa5da7ceda7f9b87579ef60b793.jpg"><br>  Hi% habra_user%! <br><br>  In the course of a series of articles on the Flex compiler, I decided to translate a good article by the author of this work on what processes occur inside the compiler when building an application.  It dates back to the year 2008, but it was not noticed in the Russian-speaking community (and in others as well).  And since in the near future this particular compiler remains relevant for building the vast majority of Flash projects, I decided to continue the cycle of articles on its expansion. <br><br>  As usual, all those who are not tired of reading this line - I ask for the cut! <br><a name="habracut"></a><br>  First, I consider it appropriate to provide links to other articles in the series: <br><ol><li>  <a href="http://habrahabr.ru/post/128703/">Adding Designer Parameters to the MXML Flex Compiler</a> </li><li>  <a href="http://habrahabr.ru/post/131434/">MXML compiler.</a>  <a href="http://habrahabr.ru/post/131434/">Part 2. Non-string parameter initializers</a> </li><li>  MXML compiler.  Part 3. We understand the work of the Flex-compiler </li></ol><br>  Secondly, I had to google pretty well to find the actual (due to the transfer of Flex to the Apache) link to the code for branch 4.6, and to save your time, <s>I just leave it here:</s> <br>  <a href="http://opensource.adobe.com/svn//opensource/flex/sdk/branches/4.y/">opensource.adobe.com/svn//opensource/flex/sdk/branches/4.y</a> <br><div class="spoiler">  <b class="spoiler_title">Why am I using this particular version?</b> <div class="spoiler_text">  The answer lies in the build process, because if the version from Adobe could be assembled out of the box by simply downloading the sources and running ant, then with the version of Apache you have to pretty much try to compile it because of dependencies.  And the difference between them is still minimal (both do not support Maven for building :)) </div></div><br>  I (like the author of the original article) strongly recommend downloading the source code for a better understanding of the article material.  The article material is relevant for both (Apache &amp; Adobe) versions of the compiler. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Language compilers </h5><br>  In general, Flex compiler supports different programming languages.  They are compiled by a set of language-specific compilers.  If you look at the list of project classes named Compiler, you can see some of them: <br><img src="https://habrastorage.org/storage2/751/693/e4d/751693e4d120380f76571b92ae5910c4.jpg"><br>  However, it cannot be argued that all languages ‚Äã‚Äãcan be compiled in one step.  For example, the MXML compiler may use dependencies written in AS3.  Therefore, before compiling the MXML component into bytecode, the compiler must determine which AS3 classes it needs and verify that the code called from MXML code on AS3 is correct. <br><br>  It is also reasonable to assume that different compilers require a different number of stages.  For example, the MXML compiler requires twice as many steps as AS3. <br><br><h5>  flex2.compiler.SubCompiler </h5><br>  In Flex, all language compilers implement the same interface - <b>flex2.compiler.SubCompiler</b> : <br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SubCompiler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isSupported</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String mimeType)</span></span></span></span>; String[] getSupportedMimeTypes(); <span class="hljs-function"><span class="hljs-function">Source </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preprocess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Source source)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">CompilationUnit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Source source, SymbolTable symbolTable)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CompilationUnit unit, SymbolTable symbolTable)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">analyze1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CompilationUnit unit, SymbolTable symbolTable)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">analyze2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CompilationUnit unit, SymbolTable symbolTable)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">analyze3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CompilationUnit unit, SymbolTable symbolTable)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">analyze4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CompilationUnit unit, SymbolTable symbolTable)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CompilationUnit unit, SymbolTable symbolTable)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postprocess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CompilationUnit unit, SymbolTable symbolTable)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initBenchmarks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; PerformanceData[] getBenchmarks(); PerformanceData[] getEmbeddedBenchmarks(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">logBenchmarks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Logger logger)</span></span></span></span>; }</code> </pre> <br>  Among the methods not related to the compilation process can be distinguished: <br>  <b>String getName ()</b> - as the name implies, the method returns the name of the compiler; <br>  <b>isSupported</b> and <b>getSupportedMimeTypes</b> - used to determine the type of files that this compiler can read; <br>  benchmarks methods related to compile performance measurement. <br><br><h5>  Compilation stages </h5><br>  As you can see, the compilation process consists of 9 steps.  The main Flex compiler acts as a coordinator and is responsible for invoking compiler instances that expect something like this: <br><ol><li>  preprocess (once) </li><li>  parse1 (once) </li><li>  parse2 (once) </li><li>  analyze1 (once) </li><li>  analyze2 (once) </li><li>  analyze3 (once) </li><li>  analyze4 (once) </li><li>  generate (once) </li><li>  postprocess (many times until the instance requires a stop) </li></ol><br>  In addition to calling these methods, the main Flex compiler does a number of things: <br><ul><li>  Selects the appropriate compiler instance based on the type of the source file; </li><li>  Receives a list of not allowed types from instances and searches for them among project sources and libraries; </li><li>  Pass information by type into instances; </li><li>  Decides which compiler should run based on the state of the instances and the overall state of the resources. </li></ul><br>  In order to control everything and everyone, the main compiler forces instances to cooperate.  Basically, he requires you to follow a specific set of rules: <br><ul><li>  The syntax tree <b>should</b> be available at the end of <b>parse2</b> ; </li><li>  <b>analyze1</b> should have information about the name of the superclass; </li><li>  <b>analyze2</b> should be aware of all dependencies; </li><li>  <b>analyze4</b> should provide complete type information. </li></ul><br>  The compilation process continues until: <br><ul><li>  There will be no dependencies that need to be resolved; </li><li>  Instances of compilers will give an error. </li></ul><br><br><h5>  Call algorithms </h5><br>  As mentioned earlier, the compilation process consists of calling these 9 methods.  But despite the fact that the order of calling these methods is defined quite precisely, the main compiler can still call them differently.  In fact, there are 2 algorithms: One ( <b>flex2.compiler.API.batch1 ()</b> ) is structured, the other ( <b>flex2.compiler.API.batch2 ()</b> ) is conditionally pathogenic.  Consider them separately: <br><br>  <b>API.batch1 ()</b> is a conservative and more structured algorithm.  Its essence lies in the fact that it guarantees the occurrence of one phase for each file before moving to another phase.  For example, <b>analyze1 ()</b> will be called for all files before proceeding to <b>analyze2 ()</b> . <br><br>  <b>API.batch2 ()</b> is a conditionally pathogenic algorithm, its main goal is to minimize memory consumption.  Unlike <b>API.batch1 ()</b> , source files with a smaller number of dependencies can reach the <b>generate</b> stage much earlier than files with a greater number of dependencies reach the phase of analyze3 ().  The idea is that the resources allocated to the file can be freed immediately as the file will be compiled into bytecode. <br><br><h5>  Conclusion </h5><br>  Well, now you know much more about the internal workings of the Flex compiler!  Let's summarize: <br><ul><li>  The main Flex compiler uses only one of two compilation algorithms: batch1 or batch2; </li><li>  Compilation algorithms use 2 different strategies to invoke 9 stages of building an application; </li><li>  During the compilation process, compiler instances must cooperate and provide type information to the main compiler at the end of each step; </li><li>  The main compiler does all the gigantic work (searching for source files / libraries, managing error logging, etc.), which means that language compilers do not have to worry about it. </li></ul><br><br>  Described The above is relevant for all versions of utilities (mxmlc, compc, asdoc) that are part of the Flex Framework. <br><br><h5>  From the translator: </h5><br>  Please find the grammatical errors and inaccuracies to send a personal message, so as not to increase the number of translucent comments;) <br>  <b>PS</b> In general, initially the idea was to write an article about the Flex Compiler Extension, which allows you to expand the compiler without changing its code (connect via flex-config.xml as a jar-ok), but having thought better of it, I decided to first make this article that describes the whole under the hood. <br>  <b>PSS</b> Given the pace of development of ASC2.0, I believe that the Flex Compiler will be relevant for at least another year, or even more, so do not be afraid to study and pick it, especially since it is an invaluable experience! <br>  <b>PSSS</b> Yes, yes, dead.  Yes, Adobe abandoned the player.  Yes, they gave Apache.  Blah blah blah‚Ä¶ </div><p>Source: <a href="https://habr.com/ru/post/180139/">https://habr.com/ru/post/180139/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../180123/index.html">My nail in the lid of the coffin of Windows</a></li>
<li><a href="../180125/index.html">EFF resumes accepting Bitcoin donations - thanks to US government</a></li>
<li><a href="../180127/index.html">Copy Cloud Storage: 15 gigabytes for free</a></li>
<li><a href="../180129/index.html">After-party Google I / O serves as a robot bartender (some photos + video)</a></li>
<li><a href="../180135/index.html">Game Life and Fourier Transform</a></li>
<li><a href="../180145/index.html">Google refuses XMPP support</a></li>
<li><a href="../180149/index.html">Sony showed flexible E-Ink panels on which you can write like on paper</a></li>
<li><a href="../180153/index.html">The digest of interesting news and materials from the world of ayti for the last week ‚Ññ57 (May 11 - 18, 2013)</a></li>
<li><a href="../180155/index.html">Practical application to "I Love R". Unplanned</a></li>
<li><a href="../180159/index.html">Do not panic! About what Google did with XMPP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>