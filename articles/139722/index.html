<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Http headers will tell a lot about your device</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you correctly collect and interpret the headers, then you can say a lot about the device, and perhaps about the user himself. In this article I‚Äôll ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Http headers will tell a lot about your device</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/af2/2ce/a48/af22cea48ee03714dc205fc3e7c8072a.png" align="right"><br>  If you correctly collect and interpret the headers, then you can say a lot about the device, and perhaps about the user himself.  In this article I‚Äôll tell you how we use the information in the http headers in <a href="http://wapstart.ru/%3Fri%3D1%26utm_source%3DHabr%26utm_medium%3DBlog%26utm_campaign%3DHabrBlog">Wapstart</a> . <br>  Disclaimer - the article is an overview.  Some things may seem community too " <a href="http://lurkmore.to/%25D0%259A%25D0%25B0%25D0%25BF%25D0%25B8%25D1%2582%25D0%25B0%25D0%25BD_%25D0%259E%25D1%2587%25D0%25B5%25D0%25B2%25D0%25B8%25D0%25B4%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C">captainist</a> ". <br><br>  I'll start with the basics: <br>  As a rule, within the web, the interaction is performed using <a href="http://tools.ietf.org/html/rfc2616">the http protocol</a> . <br><a name="habracut"></a><br>  The minimum valid http request using the GET method is as follows: <br><pre><code class="hljs tex">GET / HTTP/1.0<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span></code> </pre> <br>  or so: <br><pre> <code class="hljs tex">GET / HTTP/1.1<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span> Host: wapstart.ru<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span></code> </pre><br>  The header is a pair: the name of the field and its value, separated by a colon.  Read more - in <a href="http://tools.ietf.org/html/rfc2616">rfc</a> . <br>  As a rule, browsers transmit some additional headers, which may or may not be described in rfc.  :) <br>  Almost always the User-agent header will be transferred, and when working through a proxy, the via or x-forwarder-for headers will also be added.  Strictly speaking, rfc <a href="http://tools.ietf.org/html/rfc2068">does not forbid</a> you to transfer your titles, it simply says that they should be ignored. <br>  For example, this query is still valid: <br><pre> <code class="hljs tex">GET / HTTP/1.1<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span> Host: wapstart.ru<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span> User-agent: dovg<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span> x-ololo: trololo<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span> x-habrauser: dovg<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span></code> </pre><br>  Headers will most likely get into your application in the form defined in rfc on the <a href="http://www.ietf.org/rfc/rfc3875">cgi protocol</a> .  (section 4.1) <br>  Roughly speaking, an indication of the protocol (HTTP) will be added to them, they will be converted to upper case, and the minuses (hyphens) will be replaced with an underscore: x-habrauser will turn into HTTP_X_HABRAUSER, for example.  Values ‚Äã‚Äãwill not undergo changes. <br>  In the real world, a lot of additional headers add opera-mini, as well as the standard browser of Nokia phones. <br><br>  Let's return to our tasks. <br>  We are engaged in advertising in the mobile web, so one of our priorities is to separate conditionally ‚Äúmobile users‚Äù from non-mobile ones. <br>  Of course, this task cannot be solved with 100% efficiency, because  information is generated on the client side, and as we know, no user data can be trusted. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition to defining the ‚Äúmobility‚Äù of a user, we want to know the following: <br><ul><li>  information about the user's device (screen resolution, the presence of wifi, etc.); </li><li>  the operating system that controls the device; </li><li>  browser (application) from which the request is made. </li></ul><br>  This data allows us to show more targeted, and therefore interesting to the user advertising. <br><br>  Let's start with the first goal - how to understand the "mobility" of the user.  Once upon a time we wrote <a href="https://github.com/Wapstart/stuff/blob/master/WebWapInterfaceChooser.php">such a script</a> . <br>  I give the implementation in php, but the algorithms used here are so trivial that the script can be ported to the nginx config though.  We, by the way, had an idea to do it at the nginx level, but our hands never reached its implementation. <br>  In this article I will not give the code, it is on github.  An important remark is that you cannot fully trust only one user-agent! <br><br>  For other tasks, we came up with the gdi database (Get Device Info), which currently can get information about the device, os and browser from the set of http headers. <br>  For us, the interface is as follows - <br><pre> <code class="hljs mel">get header:HTTP_ACCEPT_ENCODING=gzip%2C+deflate&amp;HTTP_USER_AGENT=Opera%2F9<span class="hljs-number"><span class="hljs-number">.80</span></span>+%28J2ME%2FMIDP%3B+Opera+Mini%2F6<span class="hljs-number"><span class="hljs-number">.24093</span></span>%2F27<span class="hljs-number"><span class="hljs-number">.1324</span></span>%3B+U%3B+ru%29+Presto%2F2<span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.119</span></span>+Version%2F11<span class="hljs-number"><span class="hljs-number">.10</span></span>&amp;HTTP_X_OPERAMINI_FEATURES=advanced%2C+file_system%2C+<span class="hljs-keyword"><span class="hljs-keyword">camera</span></span>%2C+touch%2C+folding%2C+routing&amp;HTTP_USER_AGENT=LG+%23+KP500&amp;HTTP_USER_AGENT=LG-KP500+Teleca%2FWAP2<span class="hljs-number"><span class="hljs-number">.0</span></span>+MIDP<span class="hljs-number"><span class="hljs-number">-2.0</span></span>%2FCLDC<span class="hljs-number"><span class="hljs-number">-1.1</span></span> VALUE header:HTTP_ACCEPT_ENCODING=gzip%2C+deflate&amp;HTTP_USER_AGENT=Opera%2F9<span class="hljs-number"><span class="hljs-number">.80</span></span>+%28J2ME%2FMIDP%3B+Opera+Mini%2F6<span class="hljs-number"><span class="hljs-number">.24093</span></span>%2F27<span class="hljs-number"><span class="hljs-number">.1324</span></span>%3B+U%3B+ru%29+Presto%2F2<span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.119</span></span>+Version%2F11<span class="hljs-number"><span class="hljs-number">.10</span></span>&amp;HTTP_X_OPERAMINI_FEATURES=advanced%2C+file_system%2C+<span class="hljs-keyword"><span class="hljs-keyword">camera</span></span>%2C+touch%2C+folding%2C+routing&amp;HTTP_USER_AGENT=LG+%23+KP500&amp;HTTP_USER_AGENT=LG-KP500+Teleca%2FWAP2<span class="hljs-number"><span class="hljs-number">.0</span></span>+MIDP<span class="hljs-number"><span class="hljs-number">-2.0</span></span>%2FCLDC<span class="hljs-number"><span class="hljs-number">-1.1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">234</span></span> O:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-string"><span class="hljs-string">"CuttedDevice"</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>:{s:<span class="hljs-number"><span class="hljs-number">5</span></span>:<span class="hljs-string"><span class="hljs-string">"*id"</span></span>;i:<span class="hljs-number"><span class="hljs-number">3027</span></span>;s:<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-string"><span class="hljs-string">"*name"</span></span>;s:<span class="hljs-number"><span class="hljs-number">5</span></span>:<span class="hljs-string"><span class="hljs-string">"KP500"</span></span>;s:<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-string"><span class="hljs-string">"*deleted"</span></span>;b:<span class="hljs-number"><span class="hljs-number">0</span></span>;s:<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-string"><span class="hljs-string">"*parent"</span></span>;O:<span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-string"><span class="hljs-string">"CuttedDeviceParent"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:{s:<span class="hljs-number"><span class="hljs-number">5</span></span>:<span class="hljs-string"><span class="hljs-string">"*id"</span></span>;i:<span class="hljs-number"><span class="hljs-number">23</span></span>;s:<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-string"><span class="hljs-string">"*name"</span></span>;s:<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-string"><span class="hljs-string">"LG"</span></span>;}s:<span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-string"><span class="hljs-string">"*screenWidth"</span></span>;i:<span class="hljs-number"><span class="hljs-number">240</span></span>;s:<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-string"><span class="hljs-string">"*screenHeight"</span></span>;i:<span class="hljs-number"><span class="hljs-number">400</span></span>;} <span class="hljs-comment"><span class="hljs-comment">//,    memcache ;) //        memcache,     .</span></span></code> </pre><br>  I hope that you will learn more about the interaction on devconf <a href="http://devconf.ru/offers/6">in this</a> report. <br><br>  Known problems that we can not solve: <ul><li>  Apple devices (Iphone, Ipad, Ipod) transmit only information about the version of the operating system, but not about the model of the device.  In other words, having an http request from a standard browser cannot be said from which Iphone it was made.  In terms of transmitted headers, 3gs and 4g will look the same.  Yes, we know that this can be solved by js. </li><li>  Some opera-mini assemblies cut (replace) all information about the phone. </li></ul><br><hr><br>  And finally, some statistics on the headers in our database: <br><pre> <code class="hljs pgsql">gdi=&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> count(<span class="hljs-keyword"><span class="hljs-keyword">distinct</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> request; count <span class="hljs-comment"><span class="hljs-comment">------- 134 (1 row)</span></span></code> </pre><br><pre> <code class="hljs pgsql">gdi=&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> request; count <span class="hljs-comment"><span class="hljs-comment">-------- 651655 (1 row)</span></span></code> </pre><br><pre> <code class="hljs pgsql">gdi=&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>, count(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> different_values <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> request <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> different_values <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-type"><span class="hljs-type">name</span></span> | different_values <span class="hljs-comment"><span class="hljs-comment">---------------------------+------------------ HTTP_USER_AGENT | 648494 HTTP_X_WAP_PROFILE | 701 HTTP_X_OPERAMINI_PHONE_UA | 698 HTTP_VIA | 572 HTTP_X_PROXY_ID | 245 HTTP_X_OPERAMINI_FEATURES | 184 HTTP_X_OPERAMINI_PHONE | 109 HTTP_X_MSISDN | 96 HTTP_X_BLUECOAT_VIA | 84 HTTP_X_DEVICE_USER_AGENT | 77 (10 rows)</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/139722/">https://habr.com/ru/post/139722/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139717/index.html">Android SDK: struggling with image memory size limits</a></li>
<li><a href="../139718/index.html">Prosto in Google Web Fonts</a></li>
<li><a href="../139719/index.html">Repository pattern in conjunction with Mongoose ODM</a></li>
<li><a href="../139720/index.html">Published webinars on Visual Studio 11, about innovations in ASP.NET and MVC4</a></li>
<li><a href="../139721/index.html">Online Store Under Load - Web Cluster Quality Metrics</a></li>
<li><a href="../139724/index.html">Userscript: Crossbrowser, Crossdomain</a></li>
<li><a href="../139725/index.html">Build automation on .Net using NuGet</a></li>
<li><a href="../139727/index.html">PHP Unit. Experience of testing classes working with the Database</a></li>
<li><a href="../139728/index.html">Sort letters by imap-folders on the mail server without using sieve and others like them</a></li>
<li><a href="../139729/index.html">Looking for a nice investor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>