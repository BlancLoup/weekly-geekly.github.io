<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dagaz: Again about XSLT</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Earlier, I wrote a small article about programming on XSLT , but it was of a somewhat synthetic, educational nature. In fact, if someone suddenly need...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dagaz: Again about XSLT</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/c97/a13/699/c97a13699b5b4bb98ffe09c0be6860fe.PNG">  Earlier, I wrote a small <a href="http://habrahabr.ru/post/203004/">article</a> about programming on <a href="http://ru.wikipedia.org/wiki/XSLT">XSLT</a> , but it was of a somewhat synthetic, educational nature.  In fact, if someone suddenly needs to find one of the possible arrangements of ‚Äú8 queens,‚Äù there are a dozen other, more convenient, languages ‚Äã‚Äãthan XSLT to solve this problem.  I often use XSLT in my work, but these examples of using it are boring and not very interesting.  Most recently, I found a more amusing application for this language.  It is about this, as well as about ‚Äúhow I have come to this thought,‚Äù I am going to tell you. <br><a name="habracut"></a><br>  For quite some time, I have literally been obsessed with the idea of ‚Äã‚Äãcreating a universal ‚Äúengine‚Äù designed to develop abstract logic games (such as <a href="http://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D1%2588%25D0%25BA%25D0%25B8">Checkers</a> , <a href="http://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D1%2585%25D0%25BC%25D0%25B0%25D1%2582%25D1%258B">Chess</a> or <a href="https://ru.wikipedia.org/wiki/%25D0%2593%25D0%25BE">Go</a> ).  Of course, I'm not original.  Similar projects <a href="http://www.zillions-of-games.com/">exist</a> , but all of them, in my opinion, <a href="http://habrahabr.ru/post/221779/">have</a> <a href="http://habrahabr.ru/post/242547/">shortcomings</a> (besides the " <a href="http://k-press.ru/cs/2001/1/clr/clr.asp">fatal</a> ").  However, the advantages of these developments are much greater, and perhaps the main thing is the declarative nature of the descriptions used.  So, for example, the description of the game in <a href="http://www.doc.ic.ac.uk/~sgc/papers/browne_cig11.pdf">GDL</a> language looks like: <br><br><pre><code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">game</span></span> Tic-Tac-Toe (<span class="hljs-name"><span class="hljs-name">board</span></span> (<span class="hljs-name"><span class="hljs-name">tiling</span></span> square) (<span class="hljs-name"><span class="hljs-name">size</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) ) (<span class="hljs-name"><span class="hljs-name">win</span></span> (<span class="hljs-name"><span class="hljs-name">in-a-row</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>)) )</code> </pre> <br>  Such a record is compact and self-sufficient.  It can be used as a ‚Äúraw material‚Äù for the work of <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D0%25B5%25D0%25BD%25D0%25B5%25D1%2582%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25B0%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC">genetic algorithms</a> that develop new types of logic games.  Unlike the <a href="http://www.doc.ic.ac.uk/~sgc/papers/browne_cig11.pdf">Ludi</a> project, I do not set myself such a goal, but a compact description will not be superfluous for me.  So, today, the description of one of the famous <a href="http://skyruk.livejournal.com/241051.html">games</a> in my <a href="https://github.com/GlukKazan/Dagaz/tree/master/src/drf">repository</a> looks like: <br><br><div class="spoiler">  <b class="spoiler_title">Mill</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> variables (<span class="hljs-name"><span class="hljs-name">let</span></span> hash <span class="hljs-number"><span class="hljs-number">0</span></span>) ) (<span class="hljs-name"><span class="hljs-name">define</span></span> invariant (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">not-situation-repeated</span></span>? hash <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)) ) (<span class="hljs-name"><span class="hljs-name">define</span></span> goals (<span class="hljs-name"><span class="hljs-name">check-loss</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> mans-left <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">&gt;=</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">count</span></span> (<span class="hljs-name"><span class="hljs-name">check</span></span> is-friend?)) ) ) (<span class="hljs-name"><span class="hljs-name">check-loss</span></span> (<span class="hljs-name"><span class="hljs-name">not-exists</span></span>? try-moves) ) ) (<span class="hljs-name"><span class="hljs-name">define</span></span> man-drop (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">decrement!</span></span> mans-left)) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-empty?) (<span class="hljs-name"><span class="hljs-name">drop-pieces</span></span> Man) (<span class="hljs-name"><span class="hljs-name">set!</span></span> unique mans-left) add-move ) (<span class="hljs-name"><span class="hljs-name">define</span></span> (<span class="hljs-name"><span class="hljs-name">man-move</span></span> direction) (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> mans-left)) (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> flying-mans-count (<span class="hljs-name"><span class="hljs-name">count</span></span> (<span class="hljs-name"><span class="hljs-name">check</span></span> is-friend?)))) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-friend?) (<span class="hljs-name"><span class="hljs-name">take-piece-to-head</span></span> current-pieces) (<span class="hljs-name"><span class="hljs-name">check</span></span> direction) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-empty?) (<span class="hljs-name"><span class="hljs-name">drop-pieces</span></span> current-pieces) add-move ) (<span class="hljs-name"><span class="hljs-name">define</span></span> man-random (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> mans-left)) (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">&gt;=</span></span> flying-mans-count (<span class="hljs-name"><span class="hljs-name">count</span></span> (<span class="hljs-name"><span class="hljs-name">check</span></span> is-friend?)))) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-friend?) (<span class="hljs-name"><span class="hljs-name">take-piece-to-head</span></span> current-pieces) (<span class="hljs-name"><span class="hljs-name">any</span></span> (<span class="hljs-name"><span class="hljs-name">check</span></span> is-empty?) (<span class="hljs-name"><span class="hljs-name">drop-pieces</span></span> current-pieces) add-move ) ) (<span class="hljs-name"><span class="hljs-name">define</span></span> (<span class="hljs-name"><span class="hljs-name">check-line</span></span> direction) (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">exists</span></span>? (<span class="hljs-name"><span class="hljs-name">check</span></span> is-friend?) (<span class="hljs-name"><span class="hljs-name">add-to-zobrist-hash</span></span> hash) (<span class="hljs-name"><span class="hljs-name">check</span></span> direction) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-friend?) (<span class="hljs-name"><span class="hljs-name">add-to-zobrist-hash</span></span> hash) (<span class="hljs-name"><span class="hljs-name">check</span></span> direction) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-friend?) (<span class="hljs-name"><span class="hljs-name">add-to-zobrist-hash</span></span> hash) ) ) ) (<span class="hljs-name"><span class="hljs-name">define</span></span> capturing (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">or</span></span> (<span class="hljs-name"><span class="hljs-name">check-line</span></span> strong-n) (<span class="hljs-name"><span class="hljs-name">check-line</span></span> strong-e) (<span class="hljs-name"><span class="hljs-name">check-line</span></span> strong-ne) (<span class="hljs-name"><span class="hljs-name">check-line</span></span> strong-se)) (<span class="hljs-name"><span class="hljs-name">any</span></span> (<span class="hljs-name"><span class="hljs-name">check</span></span> is-enemy?) capture) ) ) (<span class="hljs-name"><span class="hljs-name">game</span></span> (<span class="hljs-name"><span class="hljs-name">title</span></span> <span class="hljs-string"><span class="hljs-string">"Nine Men's Morris"</span></span>) (<span class="hljs-name"><span class="hljs-name">players</span></span> White Black) (<span class="hljs-name"><span class="hljs-name">board</span></span> (<span class="hljs-name"><span class="hljs-name">positions</span></span> A1 A4 A7 B2 B4 B6 C3 C4 C5 D1 D2 D3 D5 D6 D7 E3 E4 E5 F2 F4 F6 G1 G4 G7) (<span class="hljs-name"><span class="hljs-name">link</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> strong-n) (<span class="hljs-name"><span class="hljs-name">A1</span></span> A4) (<span class="hljs-name"><span class="hljs-name">A4</span></span> A7) (<span class="hljs-name"><span class="hljs-name">B2</span></span> B4) (<span class="hljs-name"><span class="hljs-name">B4</span></span> B6) (<span class="hljs-name"><span class="hljs-name">C3</span></span> C4) (<span class="hljs-name"><span class="hljs-name">C4</span></span> C5) (<span class="hljs-name"><span class="hljs-name">D1</span></span> D2) (<span class="hljs-name"><span class="hljs-name">D2</span></span> D3) (<span class="hljs-name"><span class="hljs-name">D5</span></span> D6) (<span class="hljs-name"><span class="hljs-name">D6</span></span> D7) (<span class="hljs-name"><span class="hljs-name">E3</span></span> E4) (<span class="hljs-name"><span class="hljs-name">E4</span></span> E5) (<span class="hljs-name"><span class="hljs-name">F2</span></span> F4) (<span class="hljs-name"><span class="hljs-name">F4</span></span> F6) (<span class="hljs-name"><span class="hljs-name">G1</span></span> G4) (<span class="hljs-name"><span class="hljs-name">G4</span></span> G6) ) (<span class="hljs-name"><span class="hljs-name">link</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> weak-s) (<span class="hljs-name"><span class="hljs-name">A4</span></span> A1) (<span class="hljs-name"><span class="hljs-name">A7</span></span> A4) (<span class="hljs-name"><span class="hljs-name">B4</span></span> B2) (<span class="hljs-name"><span class="hljs-name">B6</span></span> B4) (<span class="hljs-name"><span class="hljs-name">C4</span></span> C3) (<span class="hljs-name"><span class="hljs-name">C5</span></span> C4) (<span class="hljs-name"><span class="hljs-name">D2</span></span> D1) (<span class="hljs-name"><span class="hljs-name">D3</span></span> D2) (<span class="hljs-name"><span class="hljs-name">D6</span></span> D5) (<span class="hljs-name"><span class="hljs-name">D7</span></span> D6) (<span class="hljs-name"><span class="hljs-name">E4</span></span> E3) (<span class="hljs-name"><span class="hljs-name">E5</span></span> E4) (<span class="hljs-name"><span class="hljs-name">F4</span></span> F2) (<span class="hljs-name"><span class="hljs-name">F6</span></span> F4) (<span class="hljs-name"><span class="hljs-name">G4</span></span> G1) (<span class="hljs-name"><span class="hljs-name">G6</span></span> G4) ) (<span class="hljs-name"><span class="hljs-name">link</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> strong-e) (<span class="hljs-name"><span class="hljs-name">A1</span></span> D1) (<span class="hljs-name"><span class="hljs-name">D1</span></span> G1) (<span class="hljs-name"><span class="hljs-name">B2</span></span> D2) (<span class="hljs-name"><span class="hljs-name">D2</span></span> F2) (<span class="hljs-name"><span class="hljs-name">C3</span></span> D3) (<span class="hljs-name"><span class="hljs-name">D3</span></span> E3) (<span class="hljs-name"><span class="hljs-name">A4</span></span> B4) (<span class="hljs-name"><span class="hljs-name">B4</span></span> C4) (<span class="hljs-name"><span class="hljs-name">E4</span></span> F4) (<span class="hljs-name"><span class="hljs-name">F4</span></span> G4) (<span class="hljs-name"><span class="hljs-name">C5</span></span> D5) (<span class="hljs-name"><span class="hljs-name">D5</span></span> E5) (<span class="hljs-name"><span class="hljs-name">B6</span></span> D6) (<span class="hljs-name"><span class="hljs-name">D6</span></span> F6) (<span class="hljs-name"><span class="hljs-name">A7</span></span> D7) (<span class="hljs-name"><span class="hljs-name">D7</span></span> G7) ) (<span class="hljs-name"><span class="hljs-name">link</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> weak-w) (<span class="hljs-name"><span class="hljs-name">D1</span></span> A1) (<span class="hljs-name"><span class="hljs-name">G1</span></span> D1) (<span class="hljs-name"><span class="hljs-name">D2</span></span> B2) (<span class="hljs-name"><span class="hljs-name">F2</span></span> D2) (<span class="hljs-name"><span class="hljs-name">D3</span></span> C3) (<span class="hljs-name"><span class="hljs-name">E3</span></span> D3) (<span class="hljs-name"><span class="hljs-name">B4</span></span> A4) (<span class="hljs-name"><span class="hljs-name">C4</span></span> B4) (<span class="hljs-name"><span class="hljs-name">F4</span></span> E4) (<span class="hljs-name"><span class="hljs-name">G4</span></span> F4) (<span class="hljs-name"><span class="hljs-name">D5</span></span> C5) (<span class="hljs-name"><span class="hljs-name">E5</span></span> D5) (<span class="hljs-name"><span class="hljs-name">D6</span></span> B6) (<span class="hljs-name"><span class="hljs-name">F6</span></span> D6) (<span class="hljs-name"><span class="hljs-name">D7</span></span> A7) (<span class="hljs-name"><span class="hljs-name">G7</span></span> D7) ) (<span class="hljs-name"><span class="hljs-name">link</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> weak-ne) (<span class="hljs-name"><span class="hljs-name">A1</span></span> B2) (<span class="hljs-name"><span class="hljs-name">B2</span></span> C3) (<span class="hljs-name"><span class="hljs-name">E5</span></span> F6) (<span class="hljs-name"><span class="hljs-name">F6</span></span> G7)) (<span class="hljs-name"><span class="hljs-name">link</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> weak-sw) (<span class="hljs-name"><span class="hljs-name">B2</span></span> A1) (<span class="hljs-name"><span class="hljs-name">C3</span></span> B2) (<span class="hljs-name"><span class="hljs-name">F6</span></span> E5) (<span class="hljs-name"><span class="hljs-name">G7</span></span> F6)) (<span class="hljs-name"><span class="hljs-name">link</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> weak-se) (<span class="hljs-name"><span class="hljs-name">A7</span></span> B6) (<span class="hljs-name"><span class="hljs-name">B6</span></span> C5) (<span class="hljs-name"><span class="hljs-name">E3</span></span> F2) (<span class="hljs-name"><span class="hljs-name">F2</span></span> G1)) (<span class="hljs-name"><span class="hljs-name">link</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> weak-nw) (<span class="hljs-name"><span class="hljs-name">B6</span></span> A7) (<span class="hljs-name"><span class="hljs-name">C5</span></span> B6) (<span class="hljs-name"><span class="hljs-name">F2</span></span> E3) (<span class="hljs-name"><span class="hljs-name">G1</span></span> F2)) (<span class="hljs-name"><span class="hljs-name">attribute</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> mans-left) (<span class="hljs-name"><span class="hljs-name">players</span></span> White Black) <span class="hljs-number"><span class="hljs-number">9</span></span>) (<span class="hljs-name"><span class="hljs-name">attribute</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> flying-mans-count) <span class="hljs-number"><span class="hljs-number">4</span></span>) ) (<span class="hljs-name"><span class="hljs-name">pieces</span></span> (<span class="hljs-name"><span class="hljs-name">pre</span></span> variables) (<span class="hljs-name"><span class="hljs-name">pre</span></span> goals) (<span class="hljs-name"><span class="hljs-name">post</span></span> invariant) (<span class="hljs-name"><span class="hljs-name">piece</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> Man) (<span class="hljs-name"><span class="hljs-name">attribute</span></span> unique <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">moves</span></span> (<span class="hljs-name"><span class="hljs-name">post</span></span> capturing) (<span class="hljs-name"><span class="hljs-name">man-drop</span></span>) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> strong-n) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> strong-nw) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> strong-s) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> strong-se) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> strong-w) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> strong-sw) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> strong-e) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> strong-ne) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> weak-n) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> weak-nw) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> weak-s) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> weak-se) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> weak-w) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> weak-sw) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> weak-e) (<span class="hljs-name"><span class="hljs-name">man-move</span></span> weak-ne) (<span class="hljs-name"><span class="hljs-name">man-random</span></span>) ) ) ) )</code> </pre><br></div></div><br>  With all its declarativeness, such a description requires a parser and this is exactly the task that I currently do.  As in <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D0%25B8%25D1%2581%25D0%25BF">Lisp</a> , there is practically no ‚Äúsyntactic sugar‚Äù in this language.  The task of parsing the source text into lexemes is <a href="">trivial</a> , but what to do next?  Obviously, some kind of internal representation is required, providing convenient access to descriptions of such objects as a board and figures. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I thought about this question for a long time, until I caught myself thinking that I was going to develop a simplified analogue of <a href="https://ru.wikipedia.org/wiki/XPath">XPath</a> .  An attempt to develop such a "bicycle" is certainly a "disturbing bell."  In fact, if you need something that behaves like an XPath, why not use it?  Just convert the data to <a href="https://ru.wikipedia.org/wiki/XML">XML</a> , for example as follows: <br><br><div class="spoiler">  <b class="spoiler_title">XML representation</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span>define<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span>variables<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span>let<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span>hash<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  The parser that forms such a representation is a bit less <a href="">trivial</a> than the scanner discussed earlier (in fact, it is even <a href="">simpler</a> if you do not consider the <b>include</b> implementation).  His task is to form a stream of <a href="https://ru.wikipedia.org/wiki/SAX">SAX</a> events, in the order in which the corresponding tokens arrive at the input.  After receiving the <a href="https://ru.wikipedia.org/wiki/Document_Object_Model">DOM</a> representation, the task of navigation, according to the loaded description, is solved <a href="">elementarily</a> .  But there is one ‚Äúbut‚Äù: for more convenient work, it is desirable to have an XML description in a slightly different format: <br><br><div class="spoiler">  <b class="spoiler_title">Converted XML representation</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">define</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">variables</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">let</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hash</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">let</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">define</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Here, life makes its own adjustments.  In the above source, I can see such strings as " <b>decrement!</b> ", " <b>Is-empty?</b> " Or " <b>&gt; =</b> " and these are clearly not the "identifiers" that can be placed in the names of XML tags.  After some reflection, I decided to place them in attributes, as follows: <br><br><div class="spoiler">  <b class="spoiler_title">Corrected XML representation</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nt="define"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nt="variables"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nt="let"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nt="hash"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Of course, such a record is far less intuitive, but it‚Äôs not intended for humans!  How to get this form?  You can rewrite the parser ... But there is an easier way!  <a href="https://ru.wikipedia.org/wiki/XSLT">XSLT is</a> designed to convert XML from one form to another.  We <a href="">use it</a> .  You can see that this is a very simple conversion (in any case, the changes in the source code of the parser would look much less obvious).  Loading from SAX to DOM with the transformation in progress is not much different from the same loading without it. <br><br>  Appetite comes with eating.  Where there is one transformation, you can perform several.  Simply combine them into a " <a href="">conveyor</a> ".  What may need additional conversions?  Yes, for anything!  In ZRF, <a href="">for example</a> , there is a great opportunity.  One file can contain descriptions of several similar games at once, differing only in details.  At the same time there is one main description of " <b>game</b> " and several inheriting its " <b>variant</b> ": <br><br><div class="spoiler">  <b class="spoiler_title">Mill Option</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">variant</span></span> (<span class="hljs-name"><span class="hljs-name">title</span></span> <span class="hljs-string"><span class="hljs-string">"Three Men's Morris"</span></span>) (<span class="hljs-name"><span class="hljs-name">board</span></span> (<span class="hljs-name"><span class="hljs-name">grid</span></span> (<span class="hljs-name"><span class="hljs-name">dimensions</span></span> <span class="hljs-string"><span class="hljs-string">"A_C"</span></span> <span class="hljs-string"><span class="hljs-string">"3_1"</span></span>) (<span class="hljs-name"><span class="hljs-name">direction</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> strong-n) <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>) (<span class="hljs-name"><span class="hljs-name">direction</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> weak-s) <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">direction</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> strong-e) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">direction</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> weak-w) <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) ) (<span class="hljs-name"><span class="hljs-name">link</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> strong-ne) (<span class="hljs-name"><span class="hljs-name">A1</span></span> B2) (<span class="hljs-name"><span class="hljs-name">B2</span></span> C3)) (<span class="hljs-name"><span class="hljs-name">link</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> weak-sw) (<span class="hljs-name"><span class="hljs-name">B2</span></span> A1) (<span class="hljs-name"><span class="hljs-name">C3</span></span> B2)) (<span class="hljs-name"><span class="hljs-name">link</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> strong-se) (<span class="hljs-name"><span class="hljs-name">A3</span></span> B2) (<span class="hljs-name"><span class="hljs-name">B2</span></span> C1)) (<span class="hljs-name"><span class="hljs-name">link</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> weak-nw) (<span class="hljs-name"><span class="hljs-name">B2</span></span> A3) (<span class="hljs-name"><span class="hljs-name">C1</span></span> B2)) (<span class="hljs-name"><span class="hljs-name">attribute</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> mans-left) (<span class="hljs-name"><span class="hljs-name">players</span></span> White Black) <span class="hljs-number"><span class="hljs-number">3</span></span>) ) )</code> </pre><br></div></div><br>  It is required to describe only those objects that have changed.  The rest will be inherited from the only one in the <b>game</b> tag file.  Here is the <a href="">transformation</a> that realizes this ‚Äúmagic.‚Äù  The idea of ‚Äã‚Äãconversion is simple.  Opening another <b>variant</b> , we create a variable containing both subtags of both the <b>variant</b> tag itself and the corresponding <b>game</b> tag (the order of the subtags does not matter): <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:variable</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"u"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:copy-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"n"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:copy-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/r/n[*[position()=1 and name()='a']='game']/n"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:variable</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Then just remove duplicates: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:for-each</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"exsl:node-set($u)/n"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:variable</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"pos"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position()"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:if</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">test</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$pos=1 or not(*[position()=1 and name()='a'] = preceding-sibling::n/*[position()=1 and name()='a'])"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:copy-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"."</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:if</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:for-each</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The only thing to be remembered here is that, according to the XSLT 1.0 specification, the ‚Äúfragment of the result tree‚Äù stored in a variable cannot be used directly (except for trivial use cases in the <b>copy-of</b> ).  You must use the <b>node-set</b> extension function to convert it to a set of nodes. <br><br>  You can create and even more sophisticated weapons to fight against "copy-paste".  This <a href="">transformation is</a> more complicated.  I managed to implement it correctly only on the <a href="">third</a> attempt, but the result was worth it.  The fact is that in ZRF, the <b>define</b> keyword defines, in essence, a macro that can be embedded absolutely anywhere in the description.  Sometimes it is very convenient and saves from a large amount of writings.  In ZRF macros, you can use the parameters <b>$ 1</b> , <b>$ 2</b> , etc.  We will do better!  Our parameters will have normal names: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">macro</span></span> (<span class="hljs-name"><span class="hljs-name">plus</span></span> ab) (<span class="hljs-name"><span class="hljs-name">+</span></span> ab) ) (<span class="hljs-name"><span class="hljs-name">plus</span></span> (<span class="hljs-name"><span class="hljs-name">*</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>))</code> </pre><br>  After performing the <b>macro.xsl</b> conversion, in the source code we get the following: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">+</span></span> (<span class="hljs-name"><span class="hljs-name">*</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>))</code> </pre><br>  Of course, the macro itself and its arguments can be much more complex.  In the body of the macro, it is allowed to call nested macros.  While it is impossible to implement a recursive macro call, but only because there is no mechanism for stopping recursion.  So far, I have not found a single practical example of using recursive macros and embedding the ability to perform arithmetic calculations in a transformation will only complicate it, unnecessarily. <br><br>  XSLT can also be applied to more complex source code conversions.  The transformations that transform the description of the game in <b>GDL</b> or <b>ZRF</b> into the source code of <b>Dagaz</b> should be complicated, but there is nothing fantastic in them.  If you wish, you can even implement <a href="http://habrahabr.ru/post/214713/">PREZRF</a> macros (however, I think that this is already superfluous).  Thus, XSLT will provide backward compatibility without the need to directly process legacy (from the <b>Dagaz</b> point of view) formats.  It will not be possible to provide only support for the <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D1452">Axiom</a> description format, but only for the reason that this would require the implementation of a full <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BE%25D1%2580%25D1%2582_(%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">Forth</a> machine in the XSLT transformation. <br></div><p>Source: <a href="https://habr.com/ru/post/245849/">https://habr.com/ru/post/245849/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245835/index.html">The future of parametric CAD</a></li>
<li><a href="../245837/index.html">Concurrency structure in .net. ConcurrentQueue from the inside</a></li>
<li><a href="../245841/index.html">5 errors in user feedback</a></li>
<li><a href="../245845/index.html">Overview of App Annie features for Windows and Windows Phone developers</a></li>
<li><a href="../245847/index.html">Replication slots in PostgreSQL</a></li>
<li><a href="../245851/index.html">MyLifeOrganized: folders vs contexts</a></li>
<li><a href="../245853/index.html">Business is not childish - Or how did an eighth-grader deliver fruit?</a></li>
<li><a href="../245857/index.html">Installing BIND9 DNS on CentOS</a></li>
<li><a href="../245859/index.html">IOMeter2 v1.1.0</a></li>
<li><a href="../245861/index.html">We simulate the prestress of the concrete shell of the nuclear power plant</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>