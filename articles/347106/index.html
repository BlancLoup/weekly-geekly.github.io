<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As I wrote a telegram bot and uploaded it to a remote server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 As soon as the ban on anonymity in messengers came into effect on the territory of the Russian Federation, I got around to write a post...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As I wrote a telegram bot and uploaded it to a remote server</h1><div class="post__text post__text-html js-mediator-article"><h2>  <font color="#9cc2ce">Introduction</font> </h2><br>  As soon as the ban on anonymity in messengers came into effect on the territory of the Russian Federation, I got around to write a post about a <a href="https://core.telegram.org/bots">telegram bot</a> .  In the course of creating the bot, I ran into a large number of problems that had to be solved individually, and literally wiped out grains of information from all over the Internet.  And after several months of suffering and torment (coding is not my main occupation), I finally finished with the bot, figured out all the problems and am ready to tell my story to you. <br><br><img src="https://habrastorage.org/webt/rz/lm/ok/rzlmokg0sgakxiadcm1qvec300a.jpeg"><br><a name="habracut"></a><br><h2>  <font color="#9cc2ce">The first steps</font> </h2><br>  First you need to install a <a href="https://telegram.org/">telegram</a> on your PC and register with the messenger.  Find in search @BotFather is the father of all bots in the telegram, it is he who creates them.  We write him / newbot and answer two simple questions: the name of the bot and its username.  After that, @BotFather congratulates us on the successful creation of the bot and sends it token to us - 523870826: AAF0O8T-e7riRi8m6qlRz4pBKKdh0OfHKj8. <br><br><img src="https://habrastorage.org/webt/p2/wz/i0/p2wzi0pkfgq0uobu2_7drvnrq34.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Attention: token is the only identification key to the bot.</b>  <b>Do not post it anywhere, otherwise other people will be able to control your bot.</b>  <b>The bot with this token at the time of posting the article was deleted.</b> <br><br><h2>  <font color="#9cc2ce">What programming language to choose to write a bot?</font> </h2><br>  Then I did not bother for a long time and stopped at Python, because I know it well enough, and the convenient library is also present.  I decided to use the <a href="">PyTelagramBotAPI</a> (at the time of this writing, the latest available version is 3.5.1). <br><br>  Let's go to the first code. <br><br>  Import the PyTelegramBotAPI library. <br><br><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*- import telebot</span></span></code> </pre> <br>  Create a bot. <br><br><pre> <code class="python hljs">bot = telebot.TeleBot(<span class="hljs-string"><span class="hljs-string">"523870826:AAF0O8T-e7riRi8m6qlRz4pBKKdh0OfHKj8"</span></span>)</code> </pre><br>  Let's write a simple message handling using the <a href="https://habrahabr.ru/users/bot/" class="user_link">bot</a> .message_handler decorator. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(content_types=["text"]) def handle_text(message): if message.text == "Hi": bot.send_message(message.from_user.id, "Hello! I am HabrahabrExampleBot. How can i help you?") elif message.text == "How are you?" or message.text == "How are u?": bot.send_message(message.from_user.id, "I'm fine, thanks. And you?") else: bot.send_message(message.from_user.id, "Sorry, i dont understand you.")</span></span></code> </pre><br>  Put the bot in the mode of continuous processing of information coming from the telegram servers. <br><br><pre> <code class="python hljs">bot.polling(none_stop=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, interval=<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre><br>  In the variable message telegram passes the dictionary (map) of the form: <br><br><pre> <code class="python hljs">{<span class="hljs-string"><span class="hljs-string">'content_type'</span></span>: <span class="hljs-string"><span class="hljs-string">'text'</span></span>, <span class="hljs-string"><span class="hljs-string">'message_id'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'from_user'</span></span>: { <span class="hljs-string"><span class="hljs-string">'id'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'is_bot'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'first_name'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'username'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'last_name'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'language_code'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>}, <span class="hljs-string"><span class="hljs-string">'date'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'chat'</span></span>: { <span class="hljs-string"><span class="hljs-string">'type'</span></span>: <span class="hljs-string"><span class="hljs-string">'private'</span></span>, <span class="hljs-string"><span class="hljs-string">'last_name'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'first_name'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'username'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'id'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'all_members_are_administrators'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'photo'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'description'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'invite_link'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'pinned_message'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'sticker_set_name'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'can_set_sticker_set'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>}, <span class="hljs-string"><span class="hljs-string">'forward_from_chat'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'forward_from'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'forward_date'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'reply_to_message'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'edit_date'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'author_signature'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: <span class="hljs-string"><span class="hljs-string">'/start'</span></span>, <span class="hljs-string"><span class="hljs-string">'entities'</span></span>: <span class="hljs-string"><span class="hljs-string">'[&lt;telebot.types.MessageEntity object at 0x037CB6B0&gt;]'</span></span>, <span class="hljs-string"><span class="hljs-string">'caption_entities'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'audio'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'document'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'photo'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'sticker'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'video'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'video_note'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'voice'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'caption'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'contact'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'location'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'venue'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'new_chat_member'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'new_chat_members'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'left_chat_member'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'new_chat_title'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'new_chat_photo'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'delete_chat_photo'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'group_chat_created'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'supergroup_chat_created'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'channel_chat_created'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'migrate_to_chat_id'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'migrate_from_chat_id'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'pinned_message'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'invoice'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'successful_payment'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>}</code> </pre><br>  There are also other decorators who can receive audio files, videos, pictures, documents, geolocation, etc. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   '/start'  '/help'. @bot.message_handler(commands=['start', 'help']) def handle_start_help(message): pass #      @bot.message_handler(content_types=['document', 'audio']) def handle_document_audio(message): pass</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">The final code.</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*- import telebot bot = telebot.TeleBot("523870826:AAF0O8T-e7riRi8m6qlRz4pBKKdh0OfHKj8") @bot.message_handler(content_types=["text"]) def handle_text(message): if message.text == "Hi": bot.send_message(message.from_user.id, "Hello! I am HabrahabrExampleBot. How can i help you?") elif message.text == "How are you?" or message.text == "How are u?": bot.send_message(message.from_user.id, "I'm fine, thanks. And you?") else: bot.send_message(message.from_user.id, "Sorry, i dont understand you.") bot.polling(none_stop=True, interval=0) #   '/start'  '/help'. @bot.message_handler(commands=['start', 'help']) def handle_start_help(message): pass #      @bot.message_handler(content_types=['document', 'audio']) def handle_document_audio(message): pass bot.polling(none_stop=True, interval=0)</span></span></code> </pre><br></div></div><br><img src="https://habrastorage.org/webt/tq/zp/5h/tqzp5hbc58h7fnahrsvghcoykko.png"><br><br>  In general, the telegram allows bots to perform a lot of cool operations from creating custom keyboards to making payments.  <a href="https://core.telegram.org/bots/api">Link to the official Telegram documentation.</a> <br><br>  To save data about users decided to use the <a href="http://www.sqlite.org/">sqlite3</a> database. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sqlite3 connection = sqlite3.connect(<span class="hljs-string"><span class="hljs-string">"database"</span></span>, check_same_thread = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) cursor = connection.cursor() cursor.execute(<span class="hljs-string"><span class="hljs-string">"CREATE TABLE IF NOT EXISTS Inventory_on (ID INT, 'Primary weapon' TEXT, 'Secondary weapon' TEXT)"</span></span>) cursor.execute(<span class="hljs-string"><span class="hljs-string">"CREATE TABLE IF NOT EXISTS Clans (Name TEXT, Points INT)"</span></span>) cursor.execute(<span class="hljs-string"><span class="hljs-string">"CREATE TABLE IF NOT EXISTS WorkStatus (ID INT, Status INT)"</span></span>) connection.commit() connection.close()</code> </pre><br>  I started parallel processes using the threading library.  For example: the function of calculating the battles. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> threading threading.Thread(target=name_of_your_function).start()</code> </pre><br>  Then everything depends on your imagination. <br><br><h2>  <font color="#9cc2ce">Where to run your bot?</font> </h2><br>  I don‚Äôt want to leave my own PC on 24/7, and it‚Äôs not practical.  Therefore, I decided to use the free heroku service, but I suffered a failure due to the database I selected.  It turned out that every time the bot is restarted, heroku deletes all sqlite3 commits for the last session without exceptions.  After that, I decided to buy <a href="https://ru.wikipedia.org/wiki/VPS">VDS</a> (Virtual Dedicated Server, Virtual Dedicated Server) - a remote PC on which a certain amount of power and memory is allocated for you, and to the command line of which you are given access.  Most often, the operating system of such a machine is linux.  The fee is small - 400 rubles per month, so without much moral suffering I paid for VDS based on <a href="http://qref.sourceforge.net/quick/ch-tutorial.ru.html">Debian GNU / Linux</a> and began to figure out how to enable the bot on a remote server. <br><br><h2>  <font color="#9cc2ce">How to connect to VDS?</font> </h2><br>  There are different methods, I decided on an SSH connection via Putty.  Download Putty through the <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/">official website</a> and open it.  Enter the IP address of the VDS and press open. <br><br><img src="https://habrastorage.org/webt/ms/1z/pz/ms1zpzzjvncxtc73r5penyn3qys.jpeg"><br><br>  This should open a window where you need to enter the username and password from the server. <br><br><img src="https://habrastorage.org/webt/gk/cu/64/gkcu64pkqv9rx95lupowodsvgom.jpeg"><br><br>  All of the above data will give the company from which you purchase VDS.  Next VDS - server. <br><br><h2>  <font color="#9cc2ce">How to install all the programming languages ‚Äã‚Äãand libraries you need on the server?</font> </h2><br>  It's simple.  By entering these 5 commands into the server console in this sequence, you install python3, setuptools, pip3, and the pyTelegramBotAPI library on the server. <br><br><pre> <code class="hljs sql">apt-get <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> python3 apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> python3-setuptools apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> python3-pip pip3 <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> pyTelegramBotAPI</code> </pre><br>  All additional libraries that are not included in the main python3 package should also be installed according to the principle. <br><br><pre> <code class="hljs sql">pip3 <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> <span class="hljs-string"><span class="hljs-string">'name_of_site_package'</span></span></code> </pre><br><h2>  <font color="#9cc2ce">How to download files from my PC to the server?</font> </h2><br>  To begin, create a folder in which we will upload all the necessary files.  On the server, go to the / usr / local / bin directory and create a bot folder. <br><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/local/bin <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> bot</code> </pre><br>  I have windows installed on my PC, respectively, and the commands will be for the <a href="http://ustanovkaos.ru/rabota-v-sisteme/komandnaya-stroka-windows.html">windows command line</a> .  First you need to go to the directory where putty.exe is located. <br><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /program files/putty</code> </pre><br>  Next, we load bot.py, which is located in the C: \ Users \ Ilya \ PycharmProjects \ Bot directory (you need to substitute your directory) into the directory on the / usr / local / bin / bot server. <br><br><pre> <code class="hljs ruby">pscp.exe <span class="hljs-string"><span class="hljs-string">"C:\Users\Ilya\PycharmProjects\Bot\bot.py"</span></span> root@123.<span class="hljs-number"><span class="hljs-number">123.12</span></span>.<span class="hljs-number"><span class="hljs-number">12</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/usr/local/bin/bot</span></span></code> </pre><br>  Line root@123.123.12.12 should be replaced with a line of the form login @ IP_address, respectively, with your login and IP address (mentioned above in the section ‚ÄúHow to connect to VDS?‚Äù).  Replacing bot.py with the names of other files, download all the necessary ones. <br><br><h2>  <font color="#9cc2ce">How to download files from server to PC?</font> </h2><br>  Just as when uploading files to the server on the command line to the directory where putty.exe is located.  And enter this command to download the database file to the desktop of your PC. <br><br><pre> <code class="hljs ruby">pscp.exe root@123.<span class="hljs-number"><span class="hljs-number">123.12</span></span>.<span class="hljs-number"><span class="hljs-number">12</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/usr/local/bin/bot/database</span></span> <span class="hljs-string"><span class="hljs-string">"C:\Users\Ilya\Desktop</span></span></code> </pre><br><h2>  <font color="#9cc2ce">How to run the bot?</font> </h2><br>  The first and easiest option is to go into the directory with executable files and set up python3 bot.py, but then when you close putty, the bot will turn off. <br><br>  The second option is to launch the bot using <a href="http://itman.in/ssh-screen/">screen</a> - a module that creates parallel desktops, but then the bot will not restart automatically in the event of a crash, and this happens often - several times a week due to the night restart of the telegram servers (at 3:00 AM MSC). <br><br>  The third method is <a href="https://4te.me/post/shpargalka-systemd/">systemd</a> ‚Äî the system manager, a daemon for initializing other daemons on Linux.  Simply put, systemd will launch the bot and restart it in case of a crash. <br><br>  Install systemd: <br><br><pre> <code class="hljs swift">apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install systemd</code> </pre><br>  Create a file on your PC with the name bot.service with the following content: <br><br><pre> <code class="hljs pgsql">[Unit] Description=Telegram bot <span class="hljs-string"><span class="hljs-string">'Town Wars'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">After</span></span>=syslog.target <span class="hljs-keyword"><span class="hljs-keyword">After</span></span>=network.target [Service] <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>=simple <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>=root WorkingDirectory=/usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/bin/bot ExecStart=/usr/bin/python3 /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/bin/bot/bot.py RestartSec=<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Restart</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">always</span></span> [Install] WantedBy=multi-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.target</code> </pre><br>  And load it into the desired directory: <br><br><pre> <code class="hljs ruby">pscp.exe <span class="hljs-string"><span class="hljs-string">"C:\Users\Ilya\PycharmProjects\Bot\bot.service"</span></span> root@123.<span class="hljs-number"><span class="hljs-number">123.12</span></span>.<span class="hljs-number"><span class="hljs-number">12</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/etc/systemd/system</span></span></code> </pre><br>  Next, you need to register 4 commands in the server console: <br><br><pre> <code class="hljs pgsql">systemctl daemon-reload systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> bot systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> bot systemctl status bot</code> </pre><br>  In my case, due to certain implementation errors, and specifically multithreading, I had to transfer the function for calculating the battles (battle_counter.py) into a separate daemon. <br><br><pre> <code class="hljs pgsql">[Unit] Description=Battle counter <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> telegram bot <span class="hljs-string"><span class="hljs-string">'Town Wars'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">After</span></span>=syslog.target <span class="hljs-keyword"><span class="hljs-keyword">After</span></span>=network.target [Service] <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>=simple <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>=root WorkingDirectory=/usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/bin/bot ExecStart=/usr/bin/python3 /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/bin/bot/battle_counter.py RestartSec=<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Restart</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">always</span></span> [Install] WantedBy=multi-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.target</code> </pre><br>  After that, a message should appear about this content: <br><br><img src="https://habrastorage.org/webt/pc/gx/ai/pcgxaim0y0ulfuzmdq2_yxrgsfo.jpeg"><br><br>  Your bot is up and ready to go! <br><br><h2>  <font color="#9cc2ce">ACKNOWLEDGMENTS</font> </h2><br>  This was my first relatively large project and I ran into a huge number of new problems for me.  I want to express my gratitude to <b>Yurii Drake</b> , who helped me deal with them! <br><br><h2>  <font color="#9cc2ce">LINKS</font> </h2><br>  <a href="https://telegram.org/">Telegram</a> <br>  <a href="https://core.telegram.org/bots">Telegram bot</a> <br>  <a href="https://core.telegram.org/bots/api">Official telegram documentation</a> <br>  <a href="https://tlgrm.ru/docs/bots/api">Informal documentation</a> <br>  <a href="">PyTelagramBotAPI</a> <br><br>  <a href="https://ru.wikipedia.org/wiki/VPS">Vds</a> <br>  <a href="http://qref.sourceforge.net/quick/ch-tutorial.ru.html">Debian GNU / Linux</a> <br>  <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/">Putty</a> <br>  <a href="http://ustanovkaos.ru/rabota-v-sisteme/komandnaya-stroka-windows.html">Windows Command Prompt</a> <br>  <a href="http://ixrevo.me/mac-os-x-terminal/">Mac Command Prompt</a> <br><br>  <a href="http://itman.in/ssh-screen/">Screen</a> <br>  <a href="https://4te.me/post/shpargalka-systemd/">Systemd</a> </div><p>Source: <a href="https://habr.com/ru/post/347106/">https://habr.com/ru/post/347106/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347094/index.html">Ship oranges barrels. Golang Releases</a></li>
<li><a href="../347096/index.html">Analyze it. Mista.ru</a></li>
<li><a href="../347098/index.html">Kubernetes success stories in production. Part 7: BlackRock</a></li>
<li><a href="../347100/index.html">#NotNULL Series - Twig</a></li>
<li><a href="../347104/index.html">Report c St. Petersburg Scala MeetUp 2017.3</a></li>
<li><a href="../347108/index.html">Peter Hinchens: The Psychology of Software Architecture</a></li>
<li><a href="../347110/index.html">Attention! S in Ethereum stands for Security. Part 3. Solidity in practice</a></li>
<li><a href="../347112/index.html">US exchanges accused of illegally providing benefits to high-frequency traders</a></li>
<li><a href="../347114/index.html">Let there be rock: PHDays 8 will host a music festival</a></li>
<li><a href="../347118/index.html">VMware Dispatch: a new framework for working with serverless applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>