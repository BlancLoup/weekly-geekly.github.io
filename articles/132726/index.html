<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Manage a large group of hosts using http requests</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suppose we have 100-150 client machines (well, for example, information terminals) and we need to periodically send some commands to execute (update, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Manage a large group of hosts using http requests</h1><div class="post__text post__text-html js-mediator-article"> Suppose we have 100-150 client machines (well, for example, information terminals) and we need to periodically send some commands to execute (update, clear, reboot, etc.), you can use l2tp tunnels, you can use ssh, but we will simpler!  We will use the usual get requests to our server. <br><br><img src="https://habrastorage.org/storage1/3dc0f86b/e61f0d68/f2e62ba9/6ee5f06a.png"><br>  In this article, we will look at the simplest example of implementation, but it is easily completed and reworked for personal needs. <br><a name="habracut"></a><br><br>  And so, on the server we need Apache + php + MySQL.  On clients we have enough bash'a and wget'a. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I'll start with the description of the client part. <br>  Each client will have a unique ID, it will be needed to communicate with the database.  The ID can either be statically assigned to each client, or generated from such system parameters as the serial number of the processor or MAC, or the hard drive serial number and the like, or take the md5 sum from everything at once.  Here is one of the options for implementation. <br><br> <code>#!/bin/bash <br> scpu=`lshw -C cpu|grep serial|awk '{print $2}'` <br> macu=`ifconfig eth0|grep HWaddr|awk '{print $5}'` <br> mbs=`lshw|grep "configuration: uuid"|awk '{print $2}'` <br> echo $scpu $macu $mbs&gt;/tmp/idu.key <br> md5sum /tmp/idu.key|awk '{print $1}' <br></code> <br>  But the script to collect commands from the north, it will run cron'om at the intervals we need.  For example, once a minute. <br><br> <code><a href="https://192.168.3.92/id_task.php"></a> #!/bin/bash <br> idu=`/scripts/idu.sh <br> wget --no-check-certificate -q -O /tmp/task.md 192.168.3.92/id_task.php$ <br> echo "TASK `cat /tmp/task.md`" <br> task=`cat /tmp/task.md` <br> task1="11" <br> if [[ "$task1" &lt; "$task" ]] <br> then <br> touch /opt/apps/tasks/`echo $task` <br> fi <br></code> <br>  Its meaning is that it gives a request to the database, and that one passes the value of the delivered task, after which the script creates a file of the same name which will subsequently be processed by the following script.  This system is made so that the script queries and execution can work independently.  In our case, this was done so that tasks could be set not only by the server, but also by the terminal GUI and some other system scripts. <br>  Actually, an example script processing task. <br><br> <code>#!/bin/bash <br> taskfile="/opt/apps/tasks/open_l2tp.tsk" <br> if [ -f $taskfile ] <br> then <br> echo "Open L2PT" <br> rm $taskfile <br> /etc/init.d/xl2tpd start <br> fi <br> #    <br></code> <br>  As you can see, everything is implemented very simply. <br><br>  Now let's talk about the server side. <br>  First, we have a table with information on customers, it wakes look like this. <br><br> <code>NAME OP ID <br> term1 ( 41) 7d6f4f92f10a9b3bb3 <br> term2 ( 32) 2b0fa075e3ca1b4ee9 <br></code> <br>  In our example, this table is not useful to us, but in practice it is very useful.  The first column is the name of the client machine (hostname), the second is the description, the third is its ID, by which the server identifies it. <br>  Secondly, the base in which we will set tasks for customers.  It looks like this. <br><br> <code>ID TASK STAT <br> 2b0fa075e3ca1b4ee9 open_l2tp.tsk is_done <br> 7d6f4f92f10a9b3bb3 open_l2tp.tsk wait <br></code> <br>  In it, we will also have 3 columns.  The first is the ID, the second is the task set, the third is the execution status. <br>  Add an entry to the table with the status ‚Äúwait‚Äù, the client takes the task and changes the status to ‚Äúis done‚Äù.  After that, the record can be sent or deleted, or simply left in this table.  And we will be processing a simple php script to process requests to this database. <br><br> <code>&lt;? <br> $ID = $_GET['ID']; <br> $dbcnx=@mysql_connect(localhost,base,*********); <br> mysql_select_db(TERM, $dbcnx); <br> $ath=mysql_query("select * from term_task where ID='$ID' and STATUS='wait';"); <br> $term=mysql_fetch_array($ath); <br> $TASK=$term['TASK']; <br> $ath=mysql_query("UPDATE term_task SET STATUS='is done', DATA_S='$DATE' WHERE ID='$ID' and STATUS='wait';"); <br> echo $TASK; <br> ?&gt; <br></code> <br>  If the information is important and secret, then https can be used, and if the information is completely secret, the transmitted data can be encrypted with AES-256 and the like.  For example using mcrypt. <br><br>  Well, that's all.  I hope someone will find this useful. </div><p>Source: <a href="https://habr.com/ru/post/132726/">https://habr.com/ru/post/132726/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132719/index.html">Captcha What's again?</a></li>
<li><a href="../132720/index.html">Content providers. Interaction with contacts</a></li>
<li><a href="../132721/index.html">Games, squeezed out of the NES maximum (part 3, final)</a></li>
<li><a href="../132723/index.html">Panasonic KX-TGP500 DECT</a></li>
<li><a href="../132725/index.html">Coin keeper. C # iPhone Application</a></li>
<li><a href="../132727/index.html">Materialized views as a means of controlling data integrity.</a></li>
<li><a href="../132728/index.html">A practical example of using Backbone</a></li>
<li><a href="../132729/index.html">Introduction to ASP.NET MVC 4 New Features</a></li>
<li><a href="../132730/index.html">Slowly but surely Cleverbot bypasses Suzette</a></li>
<li><a href="../132731/index.html">SMS templates for programmers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>