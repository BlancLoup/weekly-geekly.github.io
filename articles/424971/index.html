<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Habrokast "Sunset Manually" # 1. We are trying to set up an environment for developing toys under Windows</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Just got the idea - you need to find some kind of hobby. Otherwise, you can move out of the coils. And since I‚Äôm a very useless person, I don‚Äôt know h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Habrokast "Sunset Manually" # 1. We are trying to set up an environment for developing toys under Windows</h1><div class="post__text post__text-html js-mediator-article"><p>  Just got the idea - you need to find some kind of hobby.  Otherwise, you can move out of the coils.  And since I‚Äôm a very useless person, I don‚Äôt know how to poke buttons, this will be my hobby: at least once a week to make a stream with writing a toy.  After stream record is published on Habr√©.  (You can try to post on Habr live straight, but it is very difficult). </p><br><p>  Writing is very feedback driven - if someone needs an explanation, then I can explain as I can.  If you have any suggestions, I will try to take into account.  On Habr√© read all the comments to the last, in other places - as it will. </p><br><p>  The first pancake is here: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ggJNfH0YxjQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Under the cut - a thesis description for those who just broke to spend an hour and a half to watch. </p><a name="habracut"></a><br><h1 id="napravlyayuschie-idei">  Guiding ideas </h1><br><p>  The first interesting aspect is that I want to write everything without the grummers.  How does an ordinary javist do?  There was a problem - figachish in the dependence of the airgame, and he solves the problem for you.  The price of this is because of such a swine project turns into a pigsty, and no one can exactly determine what is happening.  I want to try to write without this pig farm, clean and neat.  Perhaps this is impossible - please report in the comments. </p><br><p>  Second aspet.  I've been kodil on java and php all my life.  There was the experience of developing toys, but only the server side with the answer over the network, and never - a real desktop application in C ++.  Therefore, in essence it will be a freak show - a person who does not understand the question will try to somehow describe in his own words what is happening. </p><br><p>  No, all this has no practical significance.  This is not to move out of the coils, and to motivate adult bearded uncles, too, take up the keyboard and gash some toy. </p><br><h1 id="rutina-nanosit-udar-v-pyatak">  Rutina strikes a nickle </h1><br><p>  Unfortunately, programming never begins with easy and enjoyable entertainment.  Initially, there is a period of painful digging in the settings of the environment and the IDE. </p><br><p>  The first thing I understand about Visual Studio is a great tool for a professional, but it makes a very frustrating impression on a beginner.  After Eclipse and IntelliJ IDEA everything, you know, is some kind of unnatural, lilac and hopeless with re-subduction.  The matter is not in any way VS, it‚Äôs about me :-) </p><br><p>  And with the plugins there is always some kind of trouble. </p><br><p><img src="https://habrastorage.org/webt/-z/e1/z8/-ze1z8o1vfvv8l-yf4dygjwp9z0.png"><br></p><br><p>  Therefore, by a strong-willed decision, we reject Vizhalki and see what else is there.  Vim, Emacs, and other editors who do not understand the source structure are sent by the forest.  The very first attempt to use Eclipse failed, so the <a href="https://www.jetbrains.com/clion/nextversion/">CLion</a> tool was <a href="https://www.jetbrains.com/clion/nextversion/">chosen</a> . </p><br><p>  The problem with CLion is that it still does not know how to fully work with the Visual Studio compiler.  If you try to do something in it, it will be like this: </p><br><p><img src="https://habrastorage.org/webt/qs/tw/zn/qstwznygzmnqsvnuprpp2vsnkvi.png"><br></p><br><p>  Of course, there would be a thread in the goshniki and start screaming in a hysterical voice that there will be enough debug prints for everyone.  But we will not listen to them, of course. </p><br><p>  Therefore, you need what CLion can do well, and this is MinGW. </p><br><h1 id="vybiraem-mingw">  Choose MinGW </h1><br><p>  There is a large <a href="http://mingw-w64.org/doku.php/download">version table</a> . </p><br><p><img src="https://habrastorage.org/webt/7e/oz/xs/7eozxslal4qzr-t_-eje2mnsp1g.png"><br></p><br><p>  And it shows that it makes sense to look only at Cygwin and Msys2.  Msys2 is some kind of weird - it has few committers, the packages lie on one of the authors' <a href="">own githubs</a> .  On the other hand, it is really cool - there is a fresh compiler and a lot of packages.  This is crucial. </p><br><p> The installation consists in squeezing next-next-ok, and then repeatedly running the update command ( <code>pacman -Syu</code> , as in Archlinux) with restarting the Msys2 terminal, until he says that everything turned out in the best possible way. </p><br><p>  If you simply install Msys2 according to the instructions and try to add it to CLion, not a single toolchain will be found.  You need to install it yourself; this is done with the <code>pacman -S mingw-w64-x86_64-toolchain</code> command. </p><br><p>  After installing this package, CLion launches helloworld (which is automatically generated when creating a new project) and debugging works in it. </p><br><h1 id="proverka-vozmozhnosti-1-prostoe-okno">  Check feature # 1: simple window </h1><br><p>  First of all, I want to understand if at least some desktop application will start.  Still, this is not the native PlatformSDK, but MinGW. </p><br><p>  For this, an <a href="https://gist.github.com/olegchir/a95fd16137255471c549798e8220c92d">uncomplicated prog</a> would be suitable, drawing a window using WinPi. </p><br><p>  And yes, with MinGW it starts up.  But with the Visual Studio toolchain, it pours some errors, but I didn‚Äôt deal with them, because why, if the target platform is already working with us? </p><br><h1 id="proverka-vozmozhnosti-2-treugolnik-s-sheyderom">  Check feature # 2: triangle with shader </h1><br><p>  It is clear that to write something viable is not enough to display pixels on the window.  It is brake, inconvenient, there are no fancy stuff.  In short, we need DirectX. </p><br><p>  The key question about CLion + MinGW is exactly that.  If they can not use DirectX, then go to the trash. </p><br><p>  For testing, a <a href="http://www.directxtutorial.com/Lesson.aspx%3Flessonid%3D11-4-5">very short tutorial</a> consisting of only two files was loaded: in one, all C ++ code, in the other - a shader.  The challenge is to stumble it to work. </p><br><p>  In addition to single-file, this tutorial is very good because it tells how it works on the fingers.  Perhaps this article should be transferred to Habr (write in the comments). </p><br><p>  The finished result is <a href="https://github.com/holy-shit/clion-directx-example">here GitHub</a> .  Here I will describe what problems met. </p><br><h1 id="melochi-i-musor">  Little things and trash </h1><br><p>  Many L-lines have become just lines.  You can delete small letters L. In many places, you need to replace NULL with 0 so that it does not fall. </p><br><p>  Despite the fact that <code>set(CMAKE_CXX_STANDARD 17)</code> used <code>set(CMAKE_CXX_STANDARD 17)</code> , nothing interesting happened to this plan at all, nothing fell apart. </p><br><h1 id="zagolovki-i-liby">  Headers and libs </h1><br><p>  The point, of course, is that this example is a very ancient one, written at a time long before Windows 10. DirectX is no longer in a separate DirectX SDK as it was at the time of our ambiguous youth, but is stuffed directly into the Windows SDK. </p><br><p>  Therefore, the first thing to do is to run <a href="https://visualstudio.microsoft.com/vs/community/">the Visual Studio installer</a> and check that the latest version of the Windows SDK is installed. </p><br><p>  The second question is in the headlines. </p><br><pre> <code class="hljs css"><span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">d3d11</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt; <span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">d3dx11</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt; <span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">d3dx10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt;</code> </pre> <br><p>  They are no more, you need something like: </p><br><pre> <code class="hljs css"><span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">d3d9</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt; <span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">d3d10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt; <span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">d3d11</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt; <span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxgi</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt;</code> </pre> <br><p>  And then in CMakeLists add the search to them at the end of the file: </p><br><pre> <code class="hljs lisp">set(<span class="hljs-name"><span class="hljs-name">LIBS</span></span> d3d9 d3d11 d3dcompiler_43) target_link_libraries(<span class="hljs-name"><span class="hljs-name">src</span></span> ${LIBS})</code> </pre><br><h1 id="otsutstvuyuschie-api">  Missing APIs </h1><br><p>  Previously, there was <a href="https://docs.microsoft.com/en-us/windows/desktop/direct3d9/d3dxcolor">such a structure</a> : </p><br><pre> <code class="hljs pgsql">typedef struct D3DXCOLOR { <span class="hljs-type"><span class="hljs-type">FLOAT</span></span> r; <span class="hljs-type"><span class="hljs-type">FLOAT</span></span> g; <span class="hljs-type"><span class="hljs-type">FLOAT</span></span> b; <span class="hljs-type"><span class="hljs-type">FLOAT</span></span> a; } D3DXCOLOR, *LPD3DXCOLOR;</code> </pre> <br><p>  And it is no more.  However, in all the places where it was really needed, it turned out to replace <code>D3DXCOLOR(0.0f, 0.2f, 0.4f, 1.0f)</code> by <code>{0.0f, 0.2f, 0.4f, 1.0f}</code> . </p><br><p>  The problem was more interesting with <code>D3DX11CompileFromFile</code> .  She is no more! </p><br><p>  In the article <a href="https://blogs.msdn.microsoft.com/chuckw/2013/08/20/living-without-d3dx/">Living without D3DX, they</a> suggested replacing it with <code>D3DCompileFromFile</code> . </p><br><p><img src="https://habrastorage.org/webt/is/fg/ji/isfgji5yhbnbmrti5kspe3dpfsm.png"><br></p><br><p>  But here's the problem, <code>D3DCompileFromFile</code> is also inaccessible for some reason too! </p><br><p>  A small investigation revealed that Microsoft‚Äôs documentation suggests using a very new version of the API: </p><br><p><img width="500" src="https://habrastorage.org/webt/0-/qf/te/0-qfteyli_cyyfbjnnbuedmkgza.png"><br></p><br><p>  And MinGW sends us into the past for several years: </p><br><p><img src="https://habrastorage.org/webt/rr/jh/zm/rrjhzmmraelyvknnqoudt74okm4.png"><br></p><br><p>  However, in the 32-bit version there is a newer header, but I didn‚Äôt figure out how to add it to 64-bits.  32 bits probably did not give up in FIG. </p><br><p>  On the one hand, this is very sad, because it foreshadows hemorrhagic relations with MinGW in the future.  I wonder who mantelins all these cases. </p><br><p>  On the other hand, if you take the missing <code>D3DCompile</code> and the present <code>D3DCompileFromFile</code> : </p><br><pre> <code class="hljs objectivec">HRESULT WINAPI D3DCompileFromFile( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> LPCWSTR pFileName, in_opt <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> D3D_SHADER_MACRO pDefines, in_opt ID3DInclude pInclude, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> LPCSTR pEntrypoint, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> LPCSTR pTarget, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UINT</span></span> Flags1, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UINT</span></span> Flags2, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> ID3DBlob ppCode, out_opt ID3DBlob ppErrorMsgs );</code> </pre> <br><pre> <code class="hljs objectivec">HRESULT WINAPI D3DCompile( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> LPCVOID pSrcData, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> SIZE_T SrcDataSize, in_opt LPCSTR pSourceName, in_opt <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> D3D_SHADER_MACRO pDefines, in_opt ID3DInclude pInclude, in_opt LPCSTR pEntrypoint, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> LPCSTR pTarget, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UINT</span></span> Flags1, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UINT</span></span> Flags2, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> ID3DBlob ppCode, out_opt ID3DBlob ppErrorMsgs );</code> </pre> <br><p>  it turns out that there is only a difference: </p><br><pre> <code class="hljs objectivec"> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> LPCWSTR pFileName,</code> </pre> <br><p>  vs </p><br><pre> <code class="hljs objectivec"> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> LPCVOID pSrcData, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> SIZE_T SrcDataSize, in_opt LPCSTR pSourceName,</code> </pre> <br><p>  Unfortunately, I do not know C ++, so I knew how to do it myself: I just added the file reading and redirecting this data to <code>D3DCompile</code> . </p><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> WINAPI D3DCompileFromFile(const <span class="hljs-type"><span class="hljs-type">char</span></span> *filename, const D3D_SHADER_MACRO *defines, ID3DInclude *<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>, const <span class="hljs-type"><span class="hljs-type">char</span></span> *entrypoint, const <span class="hljs-type"><span class="hljs-type">char</span></span> *target, UINT sflags, UINT eflags, ID3DBlob **shader, ID3DBlob **error_messages) { SIZE_T data_size; <span class="hljs-type"><span class="hljs-type">char</span></span>* buffer; ifstream infile; infile.<span class="hljs-keyword"><span class="hljs-keyword">open</span></span>(filename, ios::binary); infile.seekg(<span class="hljs-number"><span class="hljs-number">0</span></span>, ios::<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>); data_size = infile.tellg(); infile.seekg(<span class="hljs-number"><span class="hljs-number">0</span></span>, ios::beg); buffer = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-type"><span class="hljs-type">char</span></span>[data_size]; infile.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(buffer, data_size); infile.<span class="hljs-keyword"><span class="hljs-keyword">close</span></span>(); D3DCompile(buffer, data_size,filename, defines, <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>,entrypoint, target, sflags, eflags, shader, error_messages); }</code> </pre> <br><p>  The only important difference between the <code>D3DX11CompileFromFile</code> in the darkness of ages and our self-made <code>D3DCompileFromFile</code> is that the new API has no <code>ID3DX11ThreadPump</code> as a parameter.  Is this something asynchronous, maybe some kind of trappool?  However, it was not used in the tutorial, there is 0 in its place. </p><br><h1 id="itogi">  Results </h1><br><p>  A bunch of DirectX + MinGW + Msys2 + CLion is viable enough to cut down a simple game.  It is possible not only to use basic WinPi, but also to draw, and even with shaders. </p><br><p>  In general, everything.  I remind that the simple result <a href="https://github.com/holy-shit/clion-directx-example">lies on GitHub</a> . </p><br><p>  Please remember that this is not my code, but a modified text <a href="http://www.directxtutorial.com/Lesson.aspx%3Flessonid%3D11-4-5">from the tutorial</a> - however, I hope that its use is fair and targeted.  But nevertheless, that is why there is no <a href="https://opensource.org/licenses/UPL">normal license there</a> . </p><br><p><img src="https://habrastorage.org/webt/ji/3h/7j/ji3h7j7vvgdtvzfyn1duwiopfwo.png"><br></p><br><h1 id="fidbek">  Feedback </h1><br><p>  Please write in the comments your comments and suggestions.  For this, everything is done, listen to what you say.  Especially if you are a seasoned igroprogrammer, straight bison, a bison, and do not fit into the thread in size.  Be sure to go and write something. </p><br><p>  I remind you that I, like any other blogger, eat likes and designs.  The more furiously you will arry up the arrow under this post, the more likely the next post and stream will be released. </p><br><pre> <code class="hljs">                </code> </pre> <br><p>  ¬© Alexander Raevsky </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/424971/">https://habr.com/ru/post/424971/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../424961/index.html">MTA-STS for Postfix</a></li>
<li><a href="../424963/index.html">Zuckerberg Finance: Building Tools for Science Together</a></li>
<li><a href="../424965/index.html">Develop React applications using ReasonReact</a></li>
<li><a href="../424967/index.html">Closures in javascript for beginners</a></li>
<li><a href="../424969/index.html">Node.js Part 9 Guide: Working with the File System</a></li>
<li><a href="../424973/index.html">Face Detection Video: Raspberry Pi and Neural Compute Stick</a></li>
<li><a href="../424975/index.html">SIEM depths: out-of-box correlations. Part 2. Data schema as a reflection of the ‚Äúworld‚Äù model</a></li>
<li><a href="../424977/index.html">Learning from mistakes: optimizing applications in the App Store and Google Play</a></li>
<li><a href="../424979/index.html">Elm. Comfortable and awkward. Http, Task</a></li>
<li><a href="../424981/index.html">Easter eggs-text RPG code in Google search engine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>