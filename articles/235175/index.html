<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We do authorization on Codeigniter 2.0 using ajax and HMVC</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, dear Habrachititeli. 
 Not so long ago, I was faced with the task of implementing the authorization widget on the site. The idea is no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We do authorization on Codeigniter 2.0 using ajax and HMVC</h1><div class="post__text post__text-html js-mediator-article"><h5>  Good afternoon, dear Habrachititeli. </h5><br>  Not so long ago, I was faced with the task of implementing the authorization widget on the site.  The idea is not new, I would even say banal, but either I didn‚Äôt google well, or the solution was so obvious that there was no point in writing about it.  In any case, even for newbies, this can cause problems, which is why I decided to write this article. <br><br>  So, to begin with, to understand how this is all implemented, you need to get acquainted (for those who are not familiar) with the HMVC extension for Codeigniter.  You can <a href="http://habrahabr.ru/post/130387/">do</a> it <a href="http://habrahabr.ru/post/130387/">here</a> . <br><br>  I will try to do everything very clearly, so I'll start with the project file structure: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/c93/697/e77/c93697e77f28466abbb2bf92e1abf980.png" alt="image"><br><a name="habracut"></a><br>  As you can see, I did not specify the entire file system, but the structure that we need. <br><br>  We submit the output of our authorization form to Modules / widgets, thereby using HMVC, but I implemented all the logic in application / controllers and application / models.  Why did I do that?  Honestly, I do not know.  You could of course do all this in Modules / widgets, but I decided to do just that.  Nobody bothers you in your own way. <br><br>  So let's break down the file system <br><br>  application / controllers / user - the controller in which ajax processing of the authorization and exit events takes place. <br>  application / model / userModel - the model that checks for the existence of the user, and gives the desired array with user data. <br>  application / modules / widgets / login / controllers / login - the widget controller where session data will be transmitted. <br>  application / modules / widgets / login / controllers / userLogin - type of authorization widget. <br>  application / views / layout / head, application / views / layout / footer - the header containing the beginning of the document and the footer <br>  application / views / header - Hader of our site, in which the authorization widget is displayed.  We don‚Äôt have the controllers that output all of this, but I think this is so obvious. <br>  js / custom / scripts is our script file, where we will call ajax methods. <br>  and of course the jquery library. <br><br>  Well, it's time to start.  We start by creating our widget in application / modules / widgets / login / controllers / login <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! defined(<span class="hljs-string"><span class="hljs-string">'BASEPATH'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(<span class="hljs-string"><span class="hljs-string">'No direct script access allowed'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomWidgets</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MX_Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userLogin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;load-&gt;view(<span class="hljs-string"><span class="hljs-string">'userLogin'</span></span>); } }</code> </pre> <br><br>  Create a view of our widget: <br><br><pre> <code class="php hljs">&lt;form role=<span class="hljs-string"><span class="hljs-string">"form"</span></span> id=<span class="hljs-string"><span class="hljs-string">"login-form"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">login</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">input</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">login</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">placeholder</span></span></span><span class="hljs-class">=" "&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">input</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">password</span></span></span><span class="hljs-class">"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pass</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">placeholder</span></span></span><span class="hljs-class">=" "&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">signIn</span></span></span><span class="hljs-class">"&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre><br><br>  Now pass it to our header view: <br><br><pre> <code class="php hljs">&lt;div id=<span class="hljs-string"><span class="hljs-string">"header"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">row</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">col</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xs</span></span></span><span class="hljs-class">-3" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">account</span></span></span><span class="hljs-class">"&gt; &lt;?=</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Modules</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">run</span></span></span><span class="hljs-class">('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">widgets</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">login</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">login</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">userLogin</span></span></span><span class="hljs-class">')?&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">col</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xs</span></span></span><span class="hljs-class">-9"&gt; &lt;!--  --&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre><br><br>  On the example of my project, after styling, of course, you should have something like this: <br><br><img src="https://habrastorage.org/files/2f5/f83/45a/2f5f8345a10e4355b3775b1c64ce02a0.png" alt="image"><br><br>  So, it's time to write our authorization.  Provided, of course, that before that you yourself implemented it. <br><br>  Let's first go to the user controller and create a blank there with two methods: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MX_Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;load-&gt;model(<span class="hljs-string"><span class="hljs-string">'userModel'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ajax_login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ajax_logout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre><br><br>  We will do the preparation in advance in our userModel model: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! defined(<span class="hljs-string"><span class="hljs-string">'BASEPATH'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(<span class="hljs-string"><span class="hljs-string">'No direct script access allowed'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TemplateModel</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CI_Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    public function __construct() { parent::__construct(); $this-&gt;load-&gt;database(); } //  public function check_user($log) { } public function user_login($login) { } }</span></span></code> </pre><br><br>  Now we are ready to send form data ajax.  So do it! <br><br><pre> <code class="javascript hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Ajax login $('#account').on('click', '#signIn', function(){ var params = $('#login-form').serialize(); console.log(params); //  ,       ,  .   . $.post('user/ajax_login', params, function(data){ if(data == 'denied') { //   ,    ,    alert('    '); } else { $('#login-form').remove(); $('#account').append(data); } }); }); });</span></span></code> </pre><br><br>  We passed the data, let's process it in the ajax_login method: <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ajax_login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $log[<span class="hljs-string"><span class="hljs-string">'login'</span></span>] = trim(strip_tags($_POST[<span class="hljs-string"><span class="hljs-string">'login'</span></span>])); $log[<span class="hljs-string"><span class="hljs-string">'pass'</span></span>] = sha1(md5($_POST[<span class="hljs-string"><span class="hljs-string">'pass'</span></span>])); $check = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;TemplateModel-&gt;check_user($log); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($check) { $data[<span class="hljs-string"><span class="hljs-string">'user_info'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;TemplateModel-&gt;user_login($log[<span class="hljs-string"><span class="hljs-string">'login'</span></span>]); $ses_data = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'login'</span></span> =&gt; $data[<span class="hljs-string"><span class="hljs-string">'user_info'</span></span>][<span class="hljs-string"><span class="hljs-string">'login'</span></span>], ); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;session-&gt;set_userdata($ses_data); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'denied'</span></span>; } }</code> </pre><br><br>  At the moment, there are dark spots, but we will disperse them now.  Go to our model, and create a method check_user, where we pass our array $ log <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_user</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($log)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;where(<span class="hljs-string"><span class="hljs-string">'login'</span></span>, $log[<span class="hljs-string"><span class="hljs-string">'login'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;where(<span class="hljs-string"><span class="hljs-string">'password'</span></span>, $log[<span class="hljs-string"><span class="hljs-string">'pass'</span></span>]); $query = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;get(<span class="hljs-string"><span class="hljs-string">'user'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($query-&gt;num_rows &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>; } }</code> </pre><br><br>  In this method, we check whether such fields exist, and if their number is greater than 0, then we return TRUE. <br><br>  Next, in the $ data ['user_info'] array, we return the work of the user_login method, to which we transfer the data of the $ log ['login'] array <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">user_login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($login)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;where(<span class="hljs-string"><span class="hljs-string">'login'</span></span>, $login); $query = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;get(<span class="hljs-string"><span class="hljs-string">'energy_user'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $query-&gt;row_array(); }</code> </pre><br><br>  And finally, we write the values ‚Äã‚Äãwe need in the session.  And after the line: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;session-&gt;set_userdata($ses_data);</code> </pre><br><br>  insert the magic line, which gives the result we need: <br><br><pre> <code class="php hljs">redirect(base_url().<span class="hljs-string"><span class="hljs-string">'widgets/login/login/userLogin'</span></span>);</code> </pre><br><br>  Here, in fact, almost everything, it remains only to transfer the session values ‚Äã‚Äãto our widget controller: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! defined(<span class="hljs-string"><span class="hljs-string">'BASEPATH'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(<span class="hljs-string"><span class="hljs-string">'No direct script access allowed'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomWidgets</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MX_Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userLogin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $data[<span class="hljs-string"><span class="hljs-string">'user_info'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;session-&gt;userdata(<span class="hljs-string"><span class="hljs-string">'login'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;load-&gt;view(<span class="hljs-string"><span class="hljs-string">'userLogin'</span></span>,$data); } }</code> </pre><br><br>  Now everything works with us!  Almost profit.  It remains to make a similar LogOut.  Further I will give 2 code sections.  I think you can figure out where to insert them. <br><br>  But before that, you need to slightly modify the appearance of our widget: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($user_info)):<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;div id=<span class="hljs-string"><span class="hljs-string">"userWidget"</span></span>&gt; &lt;span&gt;, <span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span>=$user_info<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/span&gt;&lt;br&gt; &lt;a href=<span class="hljs-string"><span class="hljs-string">""</span></span>&gt;   &lt;/a&gt; &lt;button type=<span class="hljs-string"><span class="hljs-string">"button"</span></span> href=<span class="hljs-string"><span class="hljs-string">"&lt;?=base_url()?&gt;user/logout"</span></span> id=<span class="hljs-string"><span class="hljs-string">"logout"</span></span>&gt;&lt;/button&gt; &lt;/div&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span><span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;form role=<span class="hljs-string"><span class="hljs-string">"form"</span></span> id=<span class="hljs-string"><span class="hljs-string">"login-form"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">login</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">input</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">login</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">placeholder</span></span></span><span class="hljs-class">=" "&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">input</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">password</span></span></span><span class="hljs-class">"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pass</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">placeholder</span></span></span><span class="hljs-class">=" "&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">signIn</span></span></span><span class="hljs-class">"&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">endif</span></span></span><span class="hljs-class">;?&gt;</span></span></code> </pre><br><br>  Here are the 2 promised code points: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ajax_logout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $logout = $_POST[<span class="hljs-string"><span class="hljs-string">'logout'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($logout) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;session-&gt;unset_userdata(<span class="hljs-string"><span class="hljs-string">'login'</span></span>); redirect(base_url().<span class="hljs-string"><span class="hljs-string">'widgets/login/login/userLogin'</span></span>); } }</code> </pre><br><br><pre> <code class="php hljs">$(<span class="hljs-string"><span class="hljs-string">'#account'</span></span>).on(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-string"><span class="hljs-string">'#logout'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ $.post(<span class="hljs-string"><span class="hljs-string">'user/logout'</span></span>, {logout : <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#userWidget'</span></span>).remove(); $(<span class="hljs-string"><span class="hljs-string">'#account'</span></span>).append(data); }); });</code> </pre><br><br>  In general, this is all I wanted to talk about.  Of course, you can finish a lot, for example, if you are in your personal account, accidentally or even specifically pressed the exit button in the widget, and so on. <br><br>  I will be glad to hear the criticism of professionals. </div><p>Source: <a href="https://habr.com/ru/post/235175/">https://habr.com/ru/post/235175/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../235161/index.html">Overview of the most interesting materials on data analysis and machine learning ‚Ññ11 (August 25 - September 1, 2014)</a></li>
<li><a href="../235165/index.html">Review of educational resources by September 1</a></li>
<li><a href="../235169/index.html">Import Spine 2D animations in Unity 3D and linking effects to bones using 2D Toolkit</a></li>
<li><a href="../235171/index.html">Does a programmer need specialized education? What do they think in Yandex</a></li>
<li><a href="../235173/index.html">Exoskeleton from scrap materials</a></li>
<li><a href="../235177/index.html">Automate the installation of Powerchute Business Edition</a></li>
<li><a href="../235179/index.html">Yota for office - what to choose</a></li>
<li><a href="../235181/index.html">Introduction to Size Classes in Xcode 6</a></li>
<li><a href="../235183/index.html">Update Inforza and monitoring of open tenders for digital services</a></li>
<li><a href="../235185/index.html">How to increase website conversion (on the example of Nike)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>