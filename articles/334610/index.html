<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>When will there be enough IP addresses for everyone?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The number of IP addresses for devices available in the global network via the IPv4 protocol has reached about 4.3 billion and is almost exhausted due...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>When will there be enough IP addresses for everyone?</h1><div class="post__text post__text-html js-mediator-article">  The number of IP addresses for devices available in the global network via the IPv4 protocol has reached about 4.3 billion and is almost exhausted due to the IP address length of 32 bits.  128 bits are involved in the IPv6 address space, which makes the number of addressable devices almost infinite.  IPv4 and IPv6 do not have direct and simple compatibility with each other.  It is because of this quick and cheap transition to IPv6 only will not.  Fearfully?  Well no.  You just need to embark on this road - and sooner or later we will enter the era of "clean" IPv6.  Is it good or bad? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5e1/0bc/3f9/5e10bc3f9a60b635d9a668e6d0e64a08.jpg" alt="image"><br><br><a name="habracut"></a>  Recently, MTS subscribers in the Central Federal District have had the opportunity to try out Internet access using IPv6.  For one session of this protocol, the subscriber is issued addressing in two standards at once: IPv4 and IPv6.  This mode is called Dual-Stack.  In order for your device to work with IPv6, you need to connect the free service "Access to IPv6", as well as make some settings on the subscriber terminal.  In this post, our expert Oleg Ermakov, his nickname on Khabrhab - <a href="https://habrahabr.ru/users/eov/" class="user_link">eov,</a> will tell you more about the new service.  Give him the word. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Hello!  My story will consist of two parts.  The first describes the user settings and ways to control that everything is going according to plan.  The second one already gives a brief insight into the technology: as it is done on the cellular operator‚Äôs network in the 3GPP-access field.  The non-3GPP segment will not be affected.  This is a topic for a separate article. <br><br>  <b>Part I</b> <br><br>  As a result of switching to a new protocol, the subscriber has the following: <br><br>  1. Services that work with IPv6 addressing will receive and transmit traffic WITHOUT using <a href="https://ru.wikipedia.org/wiki/NAT">NAT</a> .  I don‚Äôt know if everyone has come across the fact that the search query on Google sometimes needs to enter the Captcha code, or Google refuses to search at all.  The reason is that Google believes that there are too many requests from one public IP, and this is perceived by it as a robotic survey. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b66/11e/b6a/b6611eb6a8201cfc6bc336e2a4d4f033.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/df6/6b2/046/df66b204630981bea6f0fd01b68c8312.png" alt="image"><br><br>  2. The subscriber will receive a public IPv6 address, and ‚Äúincoming‚Äù traffic from the Internet will be available to it.  Now, due to the use of NAT, this is not easy. <br><br>  3. The subscriber who <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B5%25D1%2582%25D0%25B5%25D1%2580%25D0%25B8%25D0%25BD%25D0%25B3">"distributes" the Internet</a> will get the opportunity for each device that is located behind the "distributor" to have its IPv6 address.  I propose to discuss the pros and cons of this in the comments ... <br><br>  I don‚Äôt hide the fact that we (the operator) also gain from the transition to IPv6: the more subscribers switch to IPv6, the less IPv4 addresses will be required for NAT / PAT broadcasts.  I am sure that 99% of subscribers do not think that as a result, they will incur the financial costs of purchasing additional IPv4 space. <br><br>  I foresee the question: ‚ÄúWhen will this service become available to subscribers throughout the country‚Äù?  I answer.  We are working on it and will try to launch access to most of the network by the end of this summer. <br><br>  On our site there is a <a href="http://www.corp.mts.ru/mob_connect/internet/internet_phone/additionally_services/ipv6">setup instruction</a> , general terms are written there.  Additionally I want to clarify a few points: <br><br>  1. While Dual-Stack works only on devices with Android OS, Windows and on some routers.  In the near future, IPv6 can be enabled on Apple mobile devices.  However, to be able to work with iOS devices, we need to pass a series of additional tests.  Please treat this with understanding and be patient.  For now, you can get IPv6 on Apple devices by connecting to a ‚Äúmobile access point‚Äù with a working IPv6 service via Wi-Fi. <br><br>  2. At the current stage, the service is primarily focused on advanced users who understand what they are doing and why.  You join high technology, and we study your customer experience, which is extremely important at this stage.  We expect to receive feedback from users, refine and improve the service.  In the future, we plan to simplify the connection and abandon the ‚Äúservice‚Äù as such, and make the IPv6 functionality available in the default phone settings ‚Äúout of the box‚Äù.  Ideally, the transition to IPv6 in MTS mobile networks is planned to be seamless. <br><br>  3. In the connection settings in the MANDATORY order, you need to specify the APN internet.mts.ru and the type of IPv4v6 protocol (this is IMPORTANT).  The main sign of the correct indication of the APN is that the subscriber is issued an IPv4 address from the range 10.0.0.0/8 <a href="https://tools.ietf.org/html/rfc1918">RFC1918</a> , and not from the range 100.64.0.0/10 <a href="https://tools.ietf.org/html/rfc6598">RFC6598</a> .  If IPv4 or IPv6 is selected in the phone settings, the network will display exactly what was requested (IPv4 OR IPv6).  In the first case, everything will work on IPv4, and in the second - most of the Internet resources will become unavailable simply because not all have switched to IPv6.  If everything is done correctly, then two IPv4 and IPv6 (Dual-Stack) addresses will be issued.  We do not intentionally plan to extend the solution to the ‚Äúwrong settings‚Äù (with the wrong APN).  In doing so, we proceed from the principle of "do no harm." <br><br>  4. To access Internet resources in IPv6 addressing, it is necessary that the DNS system also works as expected.  For subscriber sessions with IPv4v6 issued and IPv6 DNS server.  The presence of IPv6 DNS servers is not necessary, because IPv4 servers successfully reolve AAAA records.  When connecting to the network, we issue both servers solely to ensure that everything is ‚Äúfeng shui‚Äù. <br><br>  5. Pay special attention to the fact that the subscriber is given a public IPv6 address (actually a block of / 64 addresses), which is accessible from the Internet!  Do not neglect the elementary security measures.  It is highly desirable to install antivirus and firewall. <br><br>  Thus, subscribers have an IPv4 and IPv6 address.  Rezolving of Internet resources is performed on both IPv4 and IPv6.  The case for applications.  In our experience, the Google Chrome browser primarily uses the IPv6 protocol for resources that have the ability to work on IPv6.  For example, such popular resources as <a href="http://yandex.ru/">Yandex</a> and <a href="http://google.com/">Google</a> have long been working on IPv6. <br><br>  For verification, you can use the test-ipv6.com resource.  If everything is configured correctly, the test will show a score of 10 out of 10. <br><br>  If this is not the case, then you need to make sure that traffic optimizers are turned off in the browser settings. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/831/4a5/88d/8314a588d5501ce99110b1e16f30feed.png" alt="image"><br><br>  <b>Part II</b> <br><br>  Here we dive into the professional field.  Those who prefer to restrict the applied part of the story, please comment or write in a personal question.  I will say right away that I cannot help everyone, but I am ready to consider particularly interesting cases.  Thank you for understanding. <br><br>  IPv6 as such appeared in 1998 and is described in <a href="https://tools.ietf.org/html/rfc2460">RFC2460</a> , support for IPv6 in mobile networks appeared in the recommendations of 3GPP Rel99 (2000).  Widespread technology has not received.  Probably then, few in the world knew what IPv6 is, and there was no shortage of IPv4 addresses.  After 10 years, there was no urgent need, so we conducted internal testing, but did not implement it. <br><br>  Beginning with 3GPP Rel8 for LTE networks, the Dual-Stack era is emerging.  The benefits are obvious.  Dual-Stack makes technologies such as <a href="https://tools.ietf.org/html/rfc6146">NAT64</a> and <a href="https://tools.ietf.org/html/rfc6147">DNS64 unnecessary</a> , while maintaining ‚Äúbackward compatibility‚Äù with networks on IPv4, in effect, making a smooth transition between technologies. <br><br>  It became better, and it could already be used.  Unfortunately, when establishing a connection, the network raises two PDP contexts and inefficiently uses network resources. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/40e/c2c/6c9/40ec2c6c92cc53429ac82780a2197e49.png" alt="image"><br><br>  Dual-Stack further developed in 3GPP Rel9.  It has added support for 2G / 3G networks and it has the opportunity to issue an IPv4 and IPv6 address within the same PDP context (bearer-a).  This technology is used on the MTS network. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb6/5ca/049/cb65ca04993a6698a18bd2812cf61acc.png" alt="image"><br><br>  If you look a little deeper, you can say that 3GPP Rel10 describes <a href="https://www.ietf.org/rfc/rfc6653.txt">DHCPv6 Prefix Delegation</a> technology <a href="https://www.ietf.org/rfc/rfc6653.txt">(DHCPv6-PD)</a> .  Now the need for its use in the mobile network is not obvious.  If there are specific proposals - write in the comments or in a personal. <br><br>  In order for the technology to work, support for the necessary functionality on the HLR / HSS, SGSN / MME, GGSN / PGW, PCRF, OCS, CDR collector network elements, and, of course, on the transport network was included. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/59b/0c3/07b/59b0c307b6d7ef149a6ae574c13b3d17.png" alt="image"><br><br>  <b>HLR / HSS</b> <br>  Connecting a service causes the protocol type in the APN settings from IPv4 to IPv4v6 (or both) to be changed in the HLR and in the HSS.  The specification of TS 29.272 (Rel9) literally states the following: <br><br><div class="spoiler">  <b class="spoiler_title">7.3.62 PDN-Type ...</b> <div class="spoiler_text">  7.3.62 PDN-Type <br>  The PDN-Type AVP is a type of enumerated and indicates the address type of PDN.  The following values ‚Äã‚Äãare defined: <br><br>  IPv4 (0) <br>  This can be accessed only in <br>  IPv4 mode. <br><br>  IPv6 (1) <br>  This value can be accessed only in IPv6 mode. <br><br>  IPv4v6 (2) <br>  It can be accessed both by the IPS4 and by the UEs supporting dualstack IPv4v6. <br><br>  IPv4_OR_IPv6 (3) <br>  This is a case of supporting dualstack IPv4v6.  It would be noted that the PDN Types, ie, IPv4 only, IPv6 only or IPv4v6 (or dualstack).  This is not the case for the APN subscription context of the authorization mechanism between HSS and MME. <br></div></div><br>  As you may have guessed, we use option 2. <br><br>  <b>SGSN / MME</b> <br>  Configuring these devices for IPv6 support is simple; it is essentially limited to activating the appropriate license and enabling dual-address-pdp support for SGSN and MME services, as well as in the RNC settings connected to the SGSN. <br><br>  <b>PGW / GGSN</b> <br>  All is not so simple.  Upgrades are: <br>  - interfaces in the direction of the transport network (address-family ipv6 rises), and IP routing is prescribed; <br>  - prescribed ip-pool, from which subscribers are given addresses; <br>  - IPv6 support on APN is activated; <br>  - prescribes IPv6 DNS, which will be issued to the subscriber when connected. <br><br>  <b>PCRF / OCS</b> <br>  PGW is exchanged with PCRF and OCS using the Diameter protocol (Gx and Gy interfaces, respectively).  The peculiarity of IPv6 activation is that AVP Framed-IPv6-Prefix appears in this signaling exchange and one more AVP PDP-Address with IPv6 address is added.  Accordingly, PCRF and OCS must accept and take them into account (save). <br><br>  <b>CDR collector</b> <br>  It is expected that the format of the CDR records has changed.  The subscriber‚Äôs IPv4 address moved to the servedPPPPDNAddressExt field, and the IPv6 address will be recorded in the servedPDPPDNAddress (this field initially supported both IPv4 and IPv6). <br><br><div class="spoiler">  <b class="spoiler_title">recordType ...</b> <div class="spoiler_text">  recordType PGWRECORD <br>  servedIMSI 25001 ********** <br>  p-GWAddress 213.87.xx <br>  chargingID 15934348563 <br>  servingNodeAddress 213.87.xx <br>  accessPointNameNI internet.mts.ru <br>  pdpPDNType IPV4 + IPV6 <br>  servedPDPPDNAddress 2a00: 1fa0: 800 :: 5c: 7ef: 201 <br>  servedPDPPDNAddressExt 10.21.12.11 <br>  servinggNodePLMNIdentifier 250, 01 <br>  servedIMEISV 35915 *********** <br>  rATType eUTRAN <br>  mSTimeZone + 03:00, <br></div></div><br>  <b>Transportation network</b> <br>  Address-family ipv6 rises and routing is written. <br><br><div class="spoiler">  <b class="spoiler_title">Useful links to our topic</b> <div class="spoiler_text">  <a href="https://www.ripe.net/about-us/press-centre/understanding-ip-addressing">https://www.ripe.net/about-us/press-centre/understanding-ip-addressing</a> <br>  <a href="http://www.cisco.com/c/dam/en_us/solutions/industries/docs/gov/IPv6_WP.pdf">http://www.cisco.com/c/dam/en_us/solutions/industries/docs/gov/IPv6_WP.pdf</a> <br>  <a href="https://yarique.bitbucket.io/ipv6_ru/ipv6_ru.htm">https://yarique.bitbucket.io/ipv6_ru/ipv6_ru.htm</a> <br>  <a href="https://www.ietf.org/rfc/rfc7278.txt">https://www.ietf.org/rfc/rfc7278.txt</a> <cut></cut><br></div></div><br>  In conclusion, I want to ask you a question. </div><p>Source: <a href="https://habr.com/ru/post/334610/">https://habr.com/ru/post/334610/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334594/index.html">‚ÄúBad advice‚Äù: How to lose a customer or the 7 best farewell phrases</a></li>
<li><a href="../334596/index.html">ZFS is the best file system (yet)</a></li>
<li><a href="../334598/index.html">Features of migration from RISC to x86 in Russia: now we are kept by the old banking software of the DOS and Netware times</a></li>
<li><a href="../334604/index.html">Hack Sleep. Repeat</a></li>
<li><a href="../334608/index.html">In the second quarter, a 40% increase in the number of attacked devices was recorded.</a></li>
<li><a href="../334612/index.html">Translation of Hans Buvald‚Äôs article ‚ÄúBasic Test Design Principles‚Äù</a></li>
<li><a href="../334616/index.html">6 tips on launching a start-up designer anything</a></li>
<li><a href="../334618/index.html">Traffic Sign Recognition with CNN: Image Preprocessing Tools</a></li>
<li><a href="../334620/index.html">Red Team: teamwork during penetration testing</a></li>
<li><a href="../334626/index.html">How much does it cost to translate Habr?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>