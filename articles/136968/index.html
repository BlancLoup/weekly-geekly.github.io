<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The Tale of Cocos2d-android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It so happened that I had to port the game with ios. The framework did not have to choose, they became Cocos2d. Before the use of the framework, I had...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The Tale of Cocos2d-android</h1><div class="post__text post__text-html js-mediator-article">  It so happened that I had to port the game with ios.  The framework did not have to choose, they became Cocos2d.  Before the use of the framework, I had a chance to read reviews about it and they were alarming.  But as always hoping for the best.  And so, this story will be about your experience in porting and using this framework.  This post will be useful to those who are eyeing Cocos2s-android. <br><a name="habracut"></a><br><br><h4>  The thought of how it should be </h4><br><br>  In my humble opinion, the architecture of any game should be designed according to the least platform dependent scheme.  For example, using Cocos2dx you can write a cross-platform graphical part of the game (in C ++) and then with minimal effort connect it to a project on any OS that supports this language (Android, Symbian, Meego, Bada, I don‚Äôt know about IOS, but I also think ).  Of course, you will have to face the features of the OS, but efforts will be less than rewriting code from one language to another and encounter differences in the framework port. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  As it was </h4><br><br>  And it was all very different.  The code was on Obj-C, I had to port on Android to Java (then I didn‚Äôt even know about at least hope in the form of NDK from the crystax <a href="https://habrahabr.ru/users/crystax/" class="user_link">habrauser</a> ).  On the Internet you can find two Cocos2d-iphone ports for Android: <br><ol><li>  <a href="http://code.google.com/p/cocos2d-android/">Cocos2d-android</a> Hmm, I really do not say anything about this project.  Build from January 2010.  Perhaps all! </li><li>  <a href="http://code.google.com/p/cocos2d-android-1/">Cocos2d-android-1</a> This project claims on its page that the project in paragraph 1 is developing too slowly, so the author decided to create his own.  As I understood it, the project <a href="http://code.google.com/p/cocos2d-android/">code.google.com/p/cocos2d-android was forked,</a> and based on it, the version with the prefix "-1" is being sawn.  Therefore, this project was chosen for work. <br></li></ol><br><br><h4>  A little bit about the architecture of the game and framework </h4><br><br>  The framework operates with layers and scenes.  Honestly, I still do not understand what the difference is between them.  Is that the logic: the scene may include several layers.  Let's leave this question for the comments of experts on this framework. <br><br>  I admit, I have never had a chance to develop games.  There was only a fan-project and it was swept as much as 3D.  Therefore, I cannot comment on the chosen architecture. <br><br>  The game consisted of a set of layers.  Control and transitions between layers managed one scene.  The whole game was based on the principle of singleton.  There is one object that stores in memory all game settings and downloaded data about levels.  Level data is stored in xml.  Each time at each launch, this file is parsed and a singleton is created, which stores all this and access to which is always available.  There is only one activit in the project, which contains a slightly glided GLSurfaceView view: <br><pre><code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CCGLSurfaceView mGLSurfaceView; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> SCREEN_WIDTH = <span class="hljs-number"><span class="hljs-number">480</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> SCREEN_HEIGHT = <span class="hljs-number"><span class="hljs-number">320</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); requestWindowFeature(Window.FEATURE_NO_TITLE); getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN); getWindow().setFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON, WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON); mGLSurfaceView = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CCGLSurfaceView(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); CCDirector director = CCDirector.sharedDirector(); director.attachInView(mGLSurfaceView); director.setDeviceOrientation(CCDirector.kCCDeviceOrientationLandscapeLeft); SCREEN_WIDTH = director.winSize().width; SCREEN_HEIGHT = director.winSize().height; CCDirector.sharedDirector().getActivity().setContentView(mGLSurfaceView); CCDirector.sharedDirector().setDisplayFPS(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); CCDirector.sharedDirector().setAnimationInterval(<span class="hljs-number"><span class="hljs-number">1.0f</span></span> / <span class="hljs-number"><span class="hljs-number">60</span></span>); CCScene scene = CCScene.node(); IntroScene intro = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntroScene(); scene.addChild( intro ); CCDirector.sharedDirector().runWithScene(scene); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPause</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onPause(); CCDirector.sharedDirector().onPause(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onResume(); CCDirector.sharedDirector().onResume(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDestroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDestroy(); CCDirector.sharedDirector().end(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBackPressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       } }</span></span></code> </pre> <br>  As a whole, a typical architecture for an android application and nothing unusual, but Cocos2d handlers are added to callbacks.  It should be noted that when using 32-bit images with a gradient, the gradient begins to float.  Attempts to fix it did not lead to anything.  The standard way for android (when overriding the onAttachedToWindow activation method and specifying the desired color palette) did not help.  All distorted and flew sizes and colors.  8-bit pictures didn't help either.  Hmm, such things. <br><br><h4>  Problems in the port framework that got out </h4><br><br>  The first trabl was described in the paragraph above, and here all the rest. <br>  <i>The layer is not displayed on the screen.</i>  In the practice of using this framework, there is such a scheme for creating a scene: <br><pre> <code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainScene</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CCLayer</span></span></span><span class="hljs-class"> </span></span>{ public <span class="hljs-type"><span class="hljs-type">MainScene</span></span>(){ <span class="hljs-comment"><span class="hljs-comment">// ,    } public static CCScene scene() { CCScene scene = CCScene.node(); //CCLayer layer = MainScene.node(); //BUG in Cocos CCLayer layer = new MainScene(); scene.addChild(layer); return scene; } }</span></span></code> </pre><br>  So, in the version of the framework for ios, the signed line is and works great.  I found a solution in the form of creating a new instance of the scene, but not the fact that it is correct. <br><br>  Moving on. <br>  There was a need to create a custom view, which will turn over the game levels beautifully.  In the IOS version, this is implemented simply: the class is inherited from the UIScrollView and added on top of the graphics drawing view (GLSurfaceView).  GLSurfaceView has an addView () method.  <i>There is no such method in the port for android, and in general, perhaps, you cannot add your view in any way.</i>  This should be remembered. <br><br>  <i>Sound.</i>  When using SoundEngine, IllegalStateException is constantly popping up, which is really caught.  This is probably all.  No, this is gut!  The tree of objects of exceptions is created, it rushes, is intercepted.  Yes, what is the performance of the game, what are you talking about? <br><br>  <i>White stripe instead of a picture in a layer.</i>  The game used custom dialogs that were a layer added on top of another layer.  Nothing unusual.  In addition, sometimes, instead of pictures with menu buttons, a white bar popped up.  Code one to one as in the ios version.  Well, it would show up on weak devices, but this thing also shows up on top models.  In issues on GoogleCode, there is a problem with the garbage collector.  It seems to me that this refers to it, because when comparing the appearance of this error, a line appeared with the collection of objects by the garbage collector.  Either my hands are crooked (which is quite likely), or the port does not take into account the peculiarities of the Android architecture. <br><br>  <i>The names of the methods and classes of the framework.</i>  That's what surprised me so much is the naming of classes and methods in the port.  This fun is simple.  The main classes are named the same as in the IOS version, but for example, the class of working with sound is called differently (SoundEngine instead of SimpleAudioEngine).  The methods lost their prefixes, not all of course, but many.  Sit and guess it or not.  You watch source codes and you understand, losing time.  A strange decision was chosen by the author, IMHO. <br><br>  <i>The _rotate field or any other class field.</i>  Nothing special: an angle value is assigned to the field of the inherited class.  Everything is identical to the ios version, but the sprite flew out of the playing field.  A few hours were spent on debag and other whistles.  As it turned out, such assignments should be avoided.  Properties were replaced with setters and it all worked.  The magic of porting and more! <br><br>  <i>The operation of the algorithm.</i>  Very important point.  The logic of the movement of the main character was implemented using an accelerometer.  Pretty standard reception.  But there was a serious bug that interfered with the correct passage of the level.  The bottom line is: Cocos2d by tick updates the game data, graphics, and more.  To do this, you need to write a method in the class: public void update (float delta).  And here once again came the difference in the architecture of the two operating systems.  Because of the delays associated with garbage collection (and it was frequent, because many objects, many textures), the delta was huge and ruined the entire algorithm, which simply led to terrible consequences.  Experimentally, the required delta was chosen for the correct operation of the algorithm, and if it is larger, then it was simply truncated to the desired one. <br><br><h4>  Conclusion </h4><br><br>  Of the highlights, that's all.  But it should also be added that not all classes are ported to Android, and many already ported ones contain stubs.  In my opinion, this framework is far from the best candidate for developing games for Android.  There are more successful candidates.  Although, how many people - so many opinions. <br><br>  May the force be with you! <br><br>  <b>UPD</b> <br>  At the request of the workers, I specify the FREE frameworks to which attention should be paid.  But there are many others.  Simply these contain more materials on StackOverflow and on the Internet as a whole. <br><br><ul><li>  <a href="http://www.andengine.org/">Andengine</a> </li><li>  <a href="http://libgdx.badlogicgames.com/">Libgdx</a> </li></ul><br><br>  About AndEngine I remember already there was a series of tutorials on Habr√©.  So the most useful information will help find Google and habrapoisk. </div><p>Source: <a href="https://habr.com/ru/post/136968/">https://habr.com/ru/post/136968/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136960/index.html">Browsers entangled in the block model for tables</a></li>
<li><a href="../136962/index.html">1 / 4KB of storage space</a></li>
<li><a href="../136963/index.html">The craigslist foundation donated a $ 100,000 Perl programming language</a></li>
<li><a href="../136964/index.html">Evernote Android Update: auto-caps, saving in edit mode and more</a></li>
<li><a href="../136965/index.html">Conference TEL-2012, Kazan</a></li>
<li><a href="../136969/index.html">Improvements to working with PDF in Evernote for Windows</a></li>
<li><a href="../136970/index.html">Truly personalized search</a></li>
<li><a href="../136972/index.html">Speech by the founder and CMO Badoo at the DLD conference</a></li>
<li><a href="../136973/index.html">Important results of 2011</a></li>
<li><a href="../136974/index.html">Upload progress using PHP 5.4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>