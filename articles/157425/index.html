<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ELB vs Nginx</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi again! 

 I had a smart task for research, and I want to share my results with the community. The meaning of the problem is to determine the best N...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ELB vs Nginx</h1><div class="post__text post__text-html js-mediator-article">  Hi again! <br><br>  I had a smart task for research, and I want to share my results with the community.  The meaning of the problem is to determine the best NGINX deployment option in AWS EC2 / VPC.  It should be the best from many sides, especially from the side of high availability and speed of response.  Especially important factor is the speed of processing SSL requests, so tests for SSL performance were conducted. <br><br>  All instances are on the same VPC network, ELB also rises on the same network. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Several variations of deployment were considered, but the choice fell on 2 main configurations, tests on which I conducted. <br><br><h4>  Configuration 1. ELB </h4><br><img src="https://habrastorage.org/storage2/01e/b92/040/01eb920407012c485b2f004675f069da.png"><br><a name="habracut"></a><br>  Benefits: <br><ul><li>  The usual scheme for many applications.  ELB stands in front of two or more NGINX instances, allows traffic to pass, thereby making the configuration highly reliable (HA).  If one of the nodes fails, the traffic does not go to it. </li><li>  Easy scalable layout. </li></ul><br>  Disadvantages: <br><ul><li>  Plus one hop to the network. </li><li>  Not under control. </li></ul><br><h4>  Configuration 2. NGINX </h4><br><img src="https://habrastorage.org/storage2/5ce/fbb/695/5cefbb6955d7a18fdeb86c4aa7b13b9d.png"><br><br>  Benefits: <br><ul><li>  Direct access to the balancer without foreign proxies. </li><li>  Full control over the infrastructure. </li></ul><br>  Disadvantages: <br><ul><li>  Configuring high reliability is complicated by the use of heartbeat checks and communication between servers. </li><li>  Hard to scale </li></ul><br><h4>  Testing </h4><br>  Testing took place on m1.medium instances (3.75 GiB memory, 2 EC2 Compute Unit (1 virtual core with 2 EC2 Compute Unit)).  As a web server, nginx with a default page was used.  The test was conducted from another AWS region using Apache Bench: 6 competing users asked 400 times a page.  The test was repeated 100 times in each case. <br><br>  So, 4 tests were carried out.  Both configurations responded to http and https requests. <br><br><h4>  Non-SSL </h4><br>  The tests are aimed at identifying the effect of ELB on the response rate of the structure.  It is assumed that the configuration with the ELB will be slower to respond, because  there is an additional node on the network.  But you also need to take into account the fact that there can be more than one (in our case 2) NGINX instances that can be more productive than one for ELB. <br><br><h5>  Average Response Time Graph </h5><br><img src="https://habrastorage.org/storage2/a5b/c6d/270/a5bc6d2702a0b9a86351a5dfe35c66cc.png"><br><br>  The average result of all answers (in ms): <br>  ELB: <b>209.586</b> <br>  NGINX: <b>207.934</b> <br><br><h5>  findings </h5><br>  As you can see, the results are almost the same.  Although the NGINX configuration on the graph is constantly faster than ELB, a difference of 1-2% is absolutely acceptable.  And since the ELB configuration is much easier to configure, more stable and has almost the same response time as NGINX, we can give it preference. <br><br><h4>  SSL </h4><br>  Tests are aimed at finding out the performance of configurations regarding SSL encryption.  In the ELB SSL configuration, encryption is performed by ELB; in the NGINX configuration, one NGINX balancer. <br><br><h5>  Average Response Time Graph </h5><br><img src="https://habrastorage.org/storage2/073/ede/499/073ede49980b09af1a14e179a140391c.png"><br><br>  The average result of all answers (in ms): <br>  ELB: <b>455.921</b> <br>  NGINX: <b>437.745</b> <br><br><h5>  findings </h5><br>  At the beginning of testing, ELB was significantly behind in the responses.  But after the 30th query, we see an increase in performance.  This is because ELB has been vertically scaled.  After increasing the computing power, the performance became almost the same, as can be seen from the graph. <br><br>  As you know, ELB is a m1.micro instance that can be vertically scaled if it does not cope with the tasks.  It is not controlled in any way and is done automatically.  But, thanks to the partnership with AWS, you can achieve the installation of a minimum ELB shape, and for example, ELB will never be less than m1.medium.  This is done in order to maximize the speed of the infrastructure.  If you use this enterprise option, the choice of location for SSL encryption depends on the ease of configuration and other factors.  So far these questions have not been considered, but the test results have shown that both configurations are approximately equivalent. <br><br><h4>  Afterword </h4><br>  Performance tests were performed on configurations with and without using ELB in AWS EC2 / VPC.  Indicators suggest that the presence of an ELB has very little effect on response time, although it thereby facilitates the tuning of highly available solutions.  Also, with the use of additional AWS options, it doesn‚Äôt matter in what place to handle SSL.  In other cases, with sufficient power ( <i>at least not t1.micro</i> ), it should not be carried out at ELB. <br><br>  If you have other interesting ideas on how to compare these configurations, I‚Äôm open to them.  Now everything is running and you can easily run a few more tests. <br><br>  <b>UPD</b> <br>  Tests were conducted for HAproxy.  As expected, HAproxy is slightly faster than NGINX. <br>  Request average timing: <br><ul><li>  HAproxy: <b>203.345</b> ms </li><li>  ELB over HAproxy: <b>204.97</b> ms </li></ul><br>  The overall picture is as follows: <br><img src="https://habrastorage.org/storage2/aa1/567/09a/aa156709a116c6474d8aa554f96936ab.png"></div><p>Source: <a href="https://habr.com/ru/post/157425/">https://habr.com/ru/post/157425/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../157413/index.html">NASA has announced a service to help monitor the position of the ISS</a></li>
<li><a href="../157415/index.html">Panoramic video from the cab of a Formula 1 car</a></li>
<li><a href="../157419/index.html">AWS: New SDK for PHP 2.0.0</a></li>
<li><a href="../157421/index.html">Palm i705 Review</a></li>
<li><a href="../157423/index.html">"Blind operator" - unsuccessful joke or alarm?</a></li>
<li><a href="../157427/index.html">Attempting to install Windows Phone 8 SDK in Windows 7</a></li>
<li><a href="../157429/index.html">Opened large online electronics store accepting Bitcoin</a></li>
<li><a href="../157439/index.html">Hewlett Packard becomes a platinum member of the Linux Foundation</a></li>
<li><a href="../157441/index.html">Dell XPS 14 Laptop Review</a></li>
<li><a href="../157443/index.html">Enot J141-M Tablet Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>