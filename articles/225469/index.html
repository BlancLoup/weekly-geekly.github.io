<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Recoder - another look at the NSI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over the years, the company usually comes to the fact that many directories on one topic (for example, ‚ÄúHobby‚Äù or ‚ÄúGender‚Äù) are stored in completely u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Recoder - another look at the NSI</h1><div class="post__text post__text-html js-mediator-article">  Over the years, the company usually comes to the fact that many directories on one topic (for example, ‚ÄúHobby‚Äù or ‚ÄúGender‚Äù) are stored in completely unimaginable formats in different systems, preventing effective integration and data exchange. <br><br>  The traditional approach to solving this problem recommends creating a single version of the Hobby directory and setting up exchange flows into (and from) it for all information systems.  We decided to go the other way and create a decentralized open-source NSI - Perekoder. <br><br>  Want to know exactly what we did and what role Lucene and Apache CXF play in our product? <br><a name="habracut"></a><br><h4>  How is the task of storing directories usually solved? <br></h4><br>  The IT director decides to stop the species diversity of directories, and the company begins to build a single directory.  It will be designed to combine all possible types of corporate data and finally put an end to ‚Äúpatchwork automation‚Äù and ‚Äúhistorical heritage‚Äù. <br>  If we solve the problem, then immediately for everything, right? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And no. <br><br>  They will not write about the terrible drawbacks of centralization in the presentations of large Western companies that really want to sell you multi-million software, and will not say in press releases.  But starting such a project, you will embark on a long tedious implementation that will go on for years.  Because the entities that you will lead to the same standard have a different nature.  And this makes it pointless to unite them in a single system. <br><br>  Do not believe - see for yourself the table with the data types that are usually found in the company: <br><table><tbody><tr><td>  What describe </td><td>  Table, machine, etc. </td><td>  Physical, legal entities, PE / IP. </td><td>  Attributes of entities: education, profession, etc. </td></tr><tr><td>  Attribute truth criteria </td><td>  Objective (there is a real machine on which to look) </td><td>  Objective (there is a real person or company who can ask everything) </td><td>  Subjective (expert opinion, which may not be entirely right, or the system) </td></tr><tr><td>  The size </td><td>  Medium (tens of thousands of units) </td><td>  Medium or large (hundreds of thousands and millions of records) </td><td>  Small (thousands of units) </td></tr><tr><td>  Number of attributes </td><td>  Average (attributes of inventories) </td><td>  Average (client attributes) </td><td>  Small (in most cases, the structure type id - name) </td></tr><tr><td>  How do existing objects change over time? </td><td>  Seldom </td><td>  Constantly change (change of address, marital status, gender ...) </td><td>  Unpredictably change depending on the needs of the information system or business process </td></tr></tbody></table><br>  In practice, the fastest and most successful implementations occur in those companies that separately solve the problem of inventories, separately - the task of building a directory of counterparties, and somehow they deal with classifiers. <br><br>  Product information management (PIM) is usually implemented for goods and materials, Customer Data Integration (CDI) is used for contractors, but something interesting happens with classifiers: they are often separately implemented with MDIs and a single version of the truth is formed. <br><br>  Is it correct to implement the NSI and create a single version of the classifiers?  Or you can solve this problem differently? <br><br><h4>  Is it good to have a single version of the truth for classifiers? <br></h4><br>  When converting classifiers to a single type, one of the scenarios usually occurs: <br><ol><li>  A monster reference book is created that takes into account all the combinations in the source systems.  This complex reference book is difficult to modify, requires lengthy approvals, and over time it is slowly being slaughtered. </li><li>  It creates a single directory, which contains a stripped-down version of the truth that suits everyone.  Who worked in a large company, he knows that the search for "the truth, arranging a swan, cancer and pike" rarely ends successfully, and if it ends, it requires many, many hours of fierce meetings. </li></ol><br>  In general, a single version of the truth is usually expensive. <br><br>  In addition, with a single standard, there is always the problem of the ‚Äúgray zone‚Äù.  This is the difference between the values ‚Äã‚Äãin the source systems and the values ‚Äã‚Äãof the coveted single version of the truth, which was personally confirmed by a specially appointed expert.  The presence of the "gray zone" and the need to work with it leads to the emergence of numerous workflows and alternative flows, which is a significant part of the functionality (read the cost) of the NSI. <br><br>  But also business is not always ready to wait for numerous approvals for years.  Therefore, as a result, the data begins to be forwarded ‚Äúunder the table‚Äù, using ‚Äútemporary‚Äù recoding (what it is, we will tell below). <br><br><h4>  Is it possible not to create a single version of the truth? </h4><br>  A natural question arises: if a single version of the truth costs so much, can we do without it? <br><br>  It is possible - there are organizations in which the NSIs are not implemented.  Looking carefully, you will find in these organizations a lot of small correspondence tables between the ‚ÄúGender‚Äù, ‚ÄúEducation‚Äù directories, etc. in different systems.  They will be stored in Oracle, then on the bus, or even directly in the code for downloads-unloadings and exports-imports.  Because correspondence tables are the most natural way to solve a problem, when the same domain is indicated differently for different people or systems. <br><br>  In other words, you can force all people on earth to speak Esperanto (create a unified version of the truth), or you can invite a Chinese-German medical translator (make a correspondence table) to negotiate Chinese and German doctors. <br><br>  Therefore, we decided to make a simultaneous translator who understands the language of any system and allows them to agree on the same concepts as part of a business process.  We called the correspondence tables transcoding, and the system itself - the recoder. <br><br>  The main purpose of the recoder is to keep copies of reference books of source systems and transcoding between them. <br><br><h4>  How it all works </h4><br><ul><li>  At the beginning of work, the Recoder reads directories from the databases of the source systems and saves their copies to their base for subsequent automatic synchronization.  We work with Sybase, MariaDB, Vertica, MS SQL Server, MySQL, Oracle, PostgreSQL. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/131/c6c/568/131c6c5688bc0970b32c08bbd4b1f6c2.png"><br>  <i>Prufpik</i> <br><br></li><li>  In the recoder interface, the operator sets up the correspondence tables of reference records.  For example, if the male sex in one system is entered as ‚ÄúM‚Äù, and in the other as ‚Äú1‚Äù, then the operator assigns these two values ‚Äã‚Äãto the correspondence, creating a transcoding. <br></li><li>  Now, in the process of exchanging information with another system, any system can request the Transcoder via SOAP or REST interface to transfer the value from its classifier to the target system language or translate the received data into its own dialect. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/585/4c2/202/5854c2202269967351b1bdd39f780db3.png"><br>  <i>Transcoding from the ‚ÄúDocument Type‚Äù reference book of a certain banking system (ABS) to the ‚ÄúDUL Type‚Äù reference book for CRM.</i>  <i>The international passport corresponds to the general civil passport, the driver's license corresponds to other documents.</i>  <i>ABS and CRM do not need to integrate with the master directory, everyone is happy.</i> <br><br></li><li>  The recoder is initially designed for a load of up to one thousand recodings per second in order to satisfy all the participants of the information exchange: bus, ETL scripts, servicing real-time procedures, macros in Excel, space station, etc. <br></li></ul><br><br><h4>  What can be done using the recoder <br></h4><br>  Can and should: <br><ul><li>  Manage directories, groups of directories and transcoding (create, edit and delete). </li><li>  Configure periodic synchronization of the recoder directories with source systems. </li><li>  Perform online transcoding and retrieve source directory values ‚Äã‚Äãvia SOAP and REST interfaces. </li><li>  Receive automatic alerts about changes in source directories.  If suddenly there is a value for which there is no conversion, SOAP / REST will return an error and notify all interested parties. </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/903/6f8/c7e/9036f8c7e268c6c99fee9e6b60c26609.png"><br>  <i>Classifier "Customer service program", in which the attributes are for some reason called non-Russian words Description and Full Description</i> <br><br><h4>  What is under the hood? </h4><br>  The system is divided into modules to isolate the API, business logic and storage from each other.  The IoC binder between the components is the Spring Framework. <br><br>  Technological scheme of data streams can be represented as follows: <br><img src="https://habrastorage.org/getpro/habr/post_images/2cd/eb0/82e/2cdeb082e98c78292ddbea524f7887d0.png"><br><br>  As you can see, services do not interact directly with the database at all.  Instead, all the work (read / write) goes with the Lucene index, and the results of write operations are additionally written to the base.  What is it done for?  Everything is simple: the main task of the system is to find the transcoding as quickly as possible (correspondence between the records in a pair of directories), and such an architecture most effectively copes with this on large amounts of data.  Plus, we get a full-text search for all the data "out of the box."  Of course, it would be possible to use higher-level solutions, such as Elasticsearch or Solr, but they have their drawbacks, the fight against which is more expensive than writing your own code. <br><br>  In order to ensure the integrity of information, data is modified in one transaction in the search index and in the database.  Moreover, the interfaces are designed so that the business logic of the application knows only about the index, and the DBMS can be replaced with another solution with minimal modifications.  In fact, you need to implement a couple of classes and add them to the classpath - everything else will be done by Spring and the class-compiling factories (runtime code compiling). <br><br>  The framework for SOAP and RESTfull interfaces is Apache CXF, which makes it easy to customize the versioning API (if you suddenly need to change it) and interpose in any phase of processing incoming / outgoing messages. <br><br><h4>  Source </h4><br>  <a href="https://github.com/hflabs/perecoder">github.com/hflabs/perecoder</a> <br><br><h4>  Test stand </h4><br>  <a href="http://rcd.hflabs.ru/rcd/admin/login/">rcd.hflabs.ru/rcd/admin/login</a> <br>  Login: admin <br>  Password: demo <br><br><h4>  Documentation </h4><br>  <a href="http://confluence.hflabs.ru/x/RICSCg">confluence.hflabs.ru/x/RICSCg</a> <br><br><h4>  What's next </h4><br>  We started the implementation of the recoder with several customers. <br>  We welcome your comments on the functionality: what you like, what doesn't, what is not clear. <br>  Well, if this product will be useful to you, it means that we did not waste time writing this article;) </div><p>Source: <a href="https://habr.com/ru/post/225469/">https://habr.com/ru/post/225469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../225453/index.html">Modio: children's application for designing toys for printing on 3D printers</a></li>
<li><a href="../225457/index.html">Creating audio plug-ins, part 3</a></li>
<li><a href="../225459/index.html">Tips on maintaining a mobile application for a novice developer</a></li>
<li><a href="../225463/index.html">Classcraft turns school lessons into a huge role-playing game - with a shareware model.</a></li>
<li><a href="../225465/index.html">WWDC 2014. Report for Thursday</a></li>
<li><a href="../225471/index.html">Mover.io: service for cloud migrations</a></li>
<li><a href="../225473/index.html">Cellular automata with komonad</a></li>
<li><a href="../225477/index.html">Gamers are more educated and sociable than those who laugh at them</a></li>
<li><a href="../225479/index.html">M-LAG as an alternative to STP and stack</a></li>
<li><a href="../225481/index.html">Parsing the address bar (street [house]) using Golang and Postgis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>