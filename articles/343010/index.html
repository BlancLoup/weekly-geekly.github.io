<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Renga BIM API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! In this article, I will discuss the Renga BIM system API. You can read about the system itself here , here you can also request a version for n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Renga BIM API</h1><div class="post__text post__text-html js-mediator-article">  Hello!  In this article, I will discuss the Renga BIM system API.  You can read about the system itself <a href="http://rengabim.com/">here</a> , here you can also request a version for non-commercial use.  In short, Renga is a three-dimensional computer-aided design system in architecture and construction.  In it, the designer / architect / designer works with the information model of the building, gets associative drawings, specifications, in general, creates a project. <br><br><img src="https://habrastorage.org/webt/1f/of/by/1fofbyv9oizfrkvcw8-v9m4i-ao.png"><br><br><h3>  Why do you need a CAD-system API </h3><br>  First, as usual, some water. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The development of extensions for CAD systems is quite common, since in any design there are various areas, sections and standards for the design documentation that require different highly specialized functionality.  In addition, there are tasks of integration with the programs of calculation, visualization, workflow and many others.  Output - the creation of plug-ins that extend the functionality of the system. <br><a name="habracut"></a><br><h3>  Simple extension example </h3><br>  Let us analyze the main steps to create an extension.  You will need VisualStudio and confidence that you know C ++ (now the Renga C ++ API, but in the future we have a transition to COM, we will support .Net extensions). <br><br>  So, in steps: <br><br><ol><li>  Download the SDK <a href="http://rengabim.com/sdk">from here</a> , unpack it in a convenient place. </li><li>  Create a simple dll with default settings, let's call MyPlugin. </li><li>  In additional include folders and additional lib folders, add the path to RengaSDK, add RengaApi.lib and RengaBase.lib to the included libraries. </li><li>  Now we write the minimal implementation.  In essence, the C ++ extension to Renga is a regular dll library with an export function that returns a pointer to the IPlugin interface.  Therefore, all we need to do: <br><br>  a) Create a class inherited from this interface.  In the class, we implement both methods of the interface start and stop, these methods will be called after loading and before unloading, respectively.  We'll leave the implementation empty for now. <br><br>  b) Implement the export function returning a pointer to the IPlugin interface.  For this, you can use the EXPORT_PLUGIN macro. </li><li>  Create an extension description file called MyPlugin.rnedesc with the following text: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RengaPlugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Name</span></span></span><span class="hljs-tag">&gt;</span></span>MyPlugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Vendor</span></span></span><span class="hljs-tag">&gt;</span></span>Vendor name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Vendor</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Copyright</span></span></span><span class="hljs-tag">&gt;</span></span>Copyright text<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Copyright</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RequiredAPIVersion</span></span></span><span class="hljs-tag">&gt;</span></span>1.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RequiredAPIVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PluginFilename</span></span></span><span class="hljs-tag">&gt;</span></span>MyPlugin.dll<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PluginFilename</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RengaPlugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </li><li>  In order for the extension to appear in Renga in the Renga installation folder in the Plugins folder, create the folder MyPlugin, into which we put our dll and the description file. <br></li></ol><br>  If everything is done correctly, then when Renga is launched in the settings dialog in the ‚ÄúExtensions‚Äù section, our extension will appear, which does nothing. <br><br>  Let's make him calculate the amount of brick needed to build walls in a building.  The consumption rate we take this - 400 pieces per cubic meter, taking into account the seams. <br><br>  1. First, create a button in the main application bar.  Let's do it right in the initialize method. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> MyPlugin::initialize(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">wchar_t</span></span> * pluginPath) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> countBricksAction = rengaapi::UIControls::createAction(); countBricksAction.setToolTip(rengabase::String(<span class="hljs-string"><span class="hljs-string">L"    "</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> primaryPanelExtension = rengaapi::UIControls::createToolPanelExtension(); primaryPanelExtension.addToolButton(countBricksAction); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  2. Next, we will implement the button click handler, create a class CountBricksHandler, a successor from the interface rengaapi :: IInvokable.  Create it in the MyPlugin class and set it as a button handler. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//CountBricksHandler.h #pragma once #include &lt;RengaAPI/IInvokable.h&gt; class CountBricksHandler : public rengaapi::IInvokable { public: void invoke(); }; //CountBricksHandler.cpp #include "stdafx.h" #include "CountBricksHandler.h" void CountBricksHandler::invoke() {}</span></span></code> </pre><br>  3. Declare the m_countBricksHandler field in the private section of the MyPlugin class, set as the handler for countBricksAction. <cut></cut><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> countBricksAction = rengaapi::UIControls::createAction(); countBricksAction.setToolTip(rengabase::String(<span class="hljs-string"><span class="hljs-string">L"Count bricks in walls"</span></span>)); countBricksAction.setTriggerHandler(&amp;m_countBricksHandler);</code> </pre><br>  4. Now it remains to realize the calculation of the number of bricks in the walls.  Let's create a simple class - a calculator that will count the volume of the ‚ÄúBrick‚Äù material used in the walls, and give the quantity depending on the transferred consumption rate.  Call the calculation in the Invoke method of the button handler. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//BricksCounter.h #pragma once namespace rengaapi { class Wall; } class BricksCounter { public: BricksCounter(int consumptionRatePerM3); int calculateBricks(); private: double calculateBricksVolume(); double calculateBricksVolumeInSingleWall(rengaapi::Wall* pWall); int calculateBricksCountInVolume(double bricksVolume); private: int m_consumptionRatePerM3; };</span></span></code> </pre><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//BricksCounter.cpp #include "stdafx.h" #include "BricksCounter.h" #include &lt;RengaAPI/Project.h&gt; #include &lt;RengaAPI/ModelObjectTypes.h&gt; #include &lt;RengaAPI/Wall.h&gt; #include &lt;RengaAPI/Materials.h&gt; const wchar_t* c_briksMaterialName = L""; BricksCounter::BricksCounter(int consumptionRatePerM3) : m_consumptionRatePerM3(consumptionRatePerM3) { } int BricksCounter::calculateBricks() { double bricksVolume = calculateBricksVolume(); int bricksNumber = calculateBricksInVolume(bricksVolume); return bricksNumber; } double BricksCounter::calculateBricksVolume() { double result = 0.0; assert(rengaapi::Project::hasProject()); auto allObjects = rengaapi::Project::model().objects(); for (auto objectIt = allObjects.begin(); objectIt != allObjects.end(); ++objectIt) { if ((*objectIt)-&gt;type() == rengaapi::ModelObjectTypes::WallType) { rengaapi::Wall* pWall = dynamic_cast&lt;rengaapi::Wall*&gt;(*objectIt); assert(pWall != nullptr); result += calculateBricksVolumeInSingleWall(pWall); } } return result; } double BricksCounter::calculateBricksVolumeInSingleWall(rengaapi::Wall * pWall) { auto materialId = pWall-&gt;material(); rengaapi::LayeredMaterial wallMaterial; rengaapi::Materials::layeredMaterial(materialId, wallMaterial); auto materialLayers = wallMaterial.layers(); auto layerQuantityCollection = pWall-&gt;quantities().materialQuantities(); double bricksVolume = 0.0; for (size_t i = 0; i &lt; materialLayers.size(); ++i) { if (materialLayers.get(i).material().name_() == rengabase::String(c_briksMaterialName)) { auto oVolumeMeasure = layerQuantityCollection.get(i).netVolume(); if (oVolumeMeasure.hasValue()) { bricksVolume += oVolumeMeasure.getValue()-&gt;inMeters3(); } } } return bricksVolume; } int BricksCounter::calculateBricksInVolume(double bricksVolume) { return static_cast&lt;int&gt;(bricksVolume * m_consumptionRatePerM3); }</span></span></code> </pre><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// CountBricksHandler.cpp #include "stdafx.h" #include "CountBricksHandler.h" #include "BricksCounter.h" #include &lt;RengaAPI/Project.h&gt; #include &lt;RengaAPI/Message.h&gt; const int c_bricksConsumptionRatePerM3 = 400; void CountBricksHandler::invoke() { if (!rengaapi::Project::hasProject()) { rengaapi::Message::showMessageBox(rengaapi::Message::Info, rengabase::String(L" MyPlugin"), rengabase::String(L" .    .")); } else { BricksCounter counter(c_bricksConsumptionRatePerM3); int bricksCount = counter.calculateBricks(); std::wstring message = std::wstring(L"   , : ") + std::to_wstring(bricksCount); rengaapi::Message::showMessageBox(rengaapi::Message::Info, rengabase::String(L" MyPlugin"), rengabase::String(message.data())); } }</span></span></code> </pre><br>  The full extension code is <a href="https://github.com/RengaSoftware/MyPlugin">here.</a> <br><br><img src="https://habrastorage.org/webt/ki/oh/ip/kiohipspfypy7od454-td8uos9o.jpeg"><br><br><h3>  More about Renga extensions </h3><br>  In principle, everything to get started with the API Renga is in the SDK (http://rengabim.com/sdk/), there are also examples of all the main features. <br><br>  Also, as examples, we have developed an <a href="https://github.com/RengaSoftware/ModelExplorer">extension</a> for viewing the model in the form of a hierarchical structure (tree) and an <a href="https://github.com/RengaSoftware/ModelFilter">extension</a> for filtering model objects according to various criteria.  These extensions are available both in assembled form and in the form of source code; you can use it as an example or modify it to your taste.  In addition, third-party developers have created extensions for 3D rendering and for exporting to 3D PDF.  These and new extensions are looking for <a href="http://rengabim.com/application/">here</a> . <br><cut></cut><br><h3>  What API allows </h3><br>  Now API Renga allows: <br><br><ul><li>  Export a 3D representation of objects in the form of a polygonal mesh (mesh representation), divided into groups, so that, for example, you can distinguish the facade of the wall from the end. </li><li>  Add controls to the Renga user interface (well, and respond to them, of course). </li><li>  Get the parameters and design characteristics of three-dimensional model objects (volumes, areas, dimensions, etc.). </li><li>  Create custom properties, assign them to model objects, change the value. </li><li>  Manage visibility and highlight model objects. </li></ul><br>  Today this is all, we will be happy to answer your questions.  Write under Renga, generate ideas, develop with us! <br><br> <a href=""><img src="https://habrastorage.org/webt/e5/87/cn/e587cnttujkspuelzmduuefvl6w.jpeg"></a>  Evgeny Tyan, Lead Programmer, Renga Software. </div><p>Source: <a href="https://habr.com/ru/post/343010/">https://habr.com/ru/post/343010/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343000/index.html">Diagnostics of industrial electric motors and generators on the spectrum of current consumption and prevention of accidents</a></li>
<li><a href="../343002/index.html">Review of music software code defects. Part 4. Ardour</a></li>
<li><a href="../343004/index.html">The second wave that covered us. The standard that was waiting</a></li>
<li><a href="../343006/index.html">Russian AI Cup: Participant's Toolkit</a></li>
<li><a href="../343008/index.html">Development of sustainability strategies</a></li>
<li><a href="../343012/index.html">Scrum is not only in development - we use a flexible methodology in organizing an IT festival for children and parents</a></li>
<li><a href="../343014/index.html">Slight discrepancy</a></li>
<li><a href="../343016/index.html">Ray casting in the web world today</a></li>
<li><a href="../343018/index.html">13 conclusions that I made, after 4 years of using Ext JS</a></li>
<li><a href="../343020/index.html">Heisenbug 2017 Moscow Program Review: How many testers are needed to run tests at a nuclear power plant?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>