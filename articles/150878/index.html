<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New data sources for Teiid, part 2: we write a translator</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous section, we briefly examined how to describe a data source using DDL. But what if the source uses a specific protocol? If direct data ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New data sources for Teiid, part 2: we write a translator</h1><div class="post__text post__text-html js-mediator-article"> In the <a href="http://habrahabr.ru/post/150765/" title="New data sources for Teiid, part 1: use DDL">previous section,</a> we briefly examined how to describe a data source using DDL.  But what if the source uses a specific protocol?  If direct data display is not enough?  If we want to add data preprocessing or an embedded procedure?  There is a way: write a translator. <br><br>  In general, a translator consists of 4 parts (classes).  It is a successor of the <a href="http://docs.jboss.org/teiid/8.0.0.Final/apidocs/org/teiid/translator/ExecutionFactory.html"><code>ExecutionFactory</code></a> class and implementations of the <a href="http://docs.jboss.org/teiid/8.0.0.Final/apidocs/org/teiid/translator/ResultSetExecution.html"><code>ResultSetExecution</code></a> , <a href="http://docs.jboss.org/teiid/8.0.0.Final/apidocs/org/teiid/translator/ProcedureExecution.html"><code>ProcedureExecution</code></a> and <a href="http://docs.jboss.org/teiid/8.0.0.Final/apidocs/org/teiid/translator/UpdateExecution.html"><code>UpdateExecution</code></a> ;  In addition, Teiid's standard translators, for convenience, distinguish the metadata processor in a separate class, although it does not implement any interface and is not inherited from anything.  Consider everything in order. <a name="habracut"></a><br><br><h2>  Components of the translator </h2><br><ul><li>  <strong><code>ExecutionFactory</code></strong> is the starting point of the translator, the place where its name and description are specified, its properties (properties), SQL constructs that it supports are described, metadata are generated (that is, descriptions of tables and procedures that the translator implements are created), and if necessary, instances of the above interfaces are created, directly performing the processing of SELECT, INSERT / UPDATE / DELETE queries and calls to embedded procedures. </li><li>  <strong><code>ResultSetExecution</code></strong> is an interface whose implementations are used to process SELECT queries.  Implementations may not be available in the translator. </li><li>  <strong><code>ProcedureExecution</code></strong> - an interface whose implementations are used to handle calls to embedded procedures.  Implementations may not be available in the translator. </li><li>  <strong><code>UpdateExecution</code></strong> is an interface whose implementations are used to process INSERT / UPDATE / DELETE requests.  Implementations may not be available in the translator. </li></ul><br>  Further we will move on these points. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Basic settings </h2><br>  In order for Teiid to see our translator, we need a <em>META-INF \ services \ org.teiid.translator.ExecutionFactory file</em> in which we add the line in the resulting <em>jar'E</em> to which we add: <br><blockquote><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">ru</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.habrahabr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.HabrExecutionFactory</span></span></code> </pre></blockquote><br>  In addition, for JBoss 7 in the file <em>% JBOSS_HOME% / standalone / configuration / standalone.xml</em> (or <em>[..] domain [..]</em> ) you need to add this: <br><blockquote><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">subsystem</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urn:jboss:domain:teiid:1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> [..] <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">translator</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habrahabr"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">module</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru.habrahabr"</span></span></span><span class="hljs-tag">/&gt;</span></span> [..]</code> </pre> </blockquote><br>  Here we indicate to the server in which module our translator is located.  It is clear that the jar with our translator needs to be placed in the <em>ru.habrahabr</em> module. <br><br>  And here, as in the previous article, we need to register the data source for the translator. <br><blockquote><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">subsystem</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urn:jboss:domain:resource-adapters:1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> [...] <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resource-adapters</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resource-adapter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span>teiid-connector-ws.rar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transaction-support</span></span></span><span class="hljs-tag">&gt;</span></span>NoTransaction<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transaction-support</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connection-definitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connection-definition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.teiid.resource.adapter.ws.WSManagedConnectionFactory"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jndi-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"java:/habrDS"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">enabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">use-java-context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pool-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habr-ds"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config-property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"EndPoint"</span></span></span><span class="hljs-tag">&gt;</span></span>http://habrahabr.ru/api/profile/<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config-property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connection-definition</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connection-definitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resource-adapter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resource-adapters</span></span></span><span class="hljs-tag">&gt;</span></span> [...]</code> </pre> </blockquote><br><br><h2>  Model Description </h2><br>  In the simplest case, when no parameters are set for either the model or the translator, the model description in the vdb file will look like this: <br><blockquote><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habr"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habr"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">translator-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habrahabr"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connection-jndi-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"java:/habrDS"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </blockquote><br>  Everything. <br><br>  If you need to set the properties of the translator, you will have to describe the translator-heir: <br><blockquote><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habr"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habr"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">translator-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habrahabr2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connection-jndi-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"java:/habrDS"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">translator</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habrahabr2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habrahabr"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"defaultUser"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"elfuegobiz"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">translator</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </blockquote><br><br>  And if you also need to specify the parameters for the metadata collector, one more line will be added: <br><blockquote><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habr"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habr"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">translator-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habrahabr2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connection-jndi-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"java:/habrDS"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"importer.convertToUppercase"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">translator</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habrahabr2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"habrahabr"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"defaultUser"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"elfuegobiz"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">translator</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </blockquote><br><br><h2>  ExecutionFactory </h2><br>  Here we can do this: <br><ol><li>  Set the name and description of the translator. </li><li>  Describe the properties of the translator. </li><li>  Describe the SQL constructs that we will support. </li><li>  Create metadata of supported tables and procedures. </li><li>  Create instances of classes to process requests. </li></ol><br>  So let's go. <br><br><h4>  The name and description of the translator </h4><br><blockquote><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ru.habrahabr; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.resource.cci.ConnectionFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.teiid.translator.ExecutionFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.teiid.translator.Translator; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.teiid.translator.WSConnection; <span class="hljs-meta"><span class="hljs-meta">@Translator</span></span>(name = <span class="hljs-string"><span class="hljs-string">"habrahabr"</span></span>, description = <span class="hljs-string"><span class="hljs-string">"A translator for Habrahabr API"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HabrExecutionFactory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExecutionFactory</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConnectionFactory</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WSConnection</span></span></span><span class="hljs-class">&gt; </span></span>{ }</code> </pre> </blockquote><br>  The <code>Translator</code> annotation marks the class as a translator class, the <code>name</code> parameter specifies the name under which it will be visible in the system, and <code>description</code> - an arbitrary text description.  We set the parameters for inheritance based on the fact that we use the standard WS connector Teiid. <br><br><h4>  Translator properties </h4><br>  Above, in the <strong>‚ÄúModel Description‚Äù</strong> chapter <strong>,</strong> we specified the <code>defaultUser</code> property value for the translator.  Now we implement it in the translator code. <br><blockquote><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.teiid.translator.TranslatorProperty; [..] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String defaultUser; <span class="hljs-meta"><span class="hljs-meta">@TranslatorProperty</span></span>(description=<span class="hljs-string"><span class="hljs-string">"Default user name"</span></span>, display=<span class="hljs-string"><span class="hljs-string">"Default user name to use for table queries"</span></span>, required=<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefaultUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> defaultUser; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDefaultUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String defaultUser)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.defaultUser = defaultUser; }</code> </pre> </blockquote><br>  The getter <code>TranslatorProperty</code> annotation provides a short and detailed description of the property.  If this property is required, you can add the parameter <code>required=true</code> to the annotation. <br><br>  When instantiating a translator, Teiid will automatically fill this field with the value from the translator description in the vdb file. <br><br><h4>  Support for SQL constructs </h4><br>  The <code>ExecutionFactory</code> class has many methods with a <code>supports*</code> mask that return a <code>boolean</code> value indicating whether the translator supports this feature or not.  Features that the translator does not support, Teiid implements by its own means.  For example, if the translator does not know how to handle the function aggregate <code>sum()</code> , then Teiid will request data from the translator, and then it will calculate the sum itself. <br><br>  To change these settings, almost all of them need to overlap, only for a few there are corresponding setters that can be called in the constructor.  For example, if we want to implement support for <code>count(*)</code> queries and the <code>limit &lt;&gt;</code> constructions, then we will block the corresponding methods and return <code>true</code> to them: <br><blockquote><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">supportsAggregatesCountStar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">supportsRowLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre> </blockquote><br>  It makes sense to implement all these possibilities if the data source itself has an API for their implementation.  However, our translator will be quite simple - we might write a more complex translator in the next article if the audience expresses interest in the topic at all. <br><br><h4>  Metadata tables and procedures </h4><br>  To describe the tables and procedures implemented in the translator, the <code>ExecutionFactory</code> class has a special <a href="http://docs.jboss.org/teiid/8.0.0.Final/apidocs/org/teiid/translator/ExecutionFactory.html"><code>getMetadata(MetadataFactory metadataFactory, WSConnection conn)</code></a> method <a href="http://docs.jboss.org/teiid/8.0.0.Final/apidocs/org/teiid/translator/ExecutionFactory.html"><code>getMetadata(MetadataFactory metadataFactory, WSConnection conn)</code></a> that needs to be overridden and implemented.  We receive a copy of the <a href="http://docs.jboss.org/teiid/8.0.0.Final/apidocs/org/teiid/metadata/MetadataFactory.html"><code>MetadataFactory</code></a> class, which has methods for creating tables, procedures, and much more, as well as an object of an already established connection to our web service: if we need to request data about, for example, the number and names of tables from our source.  In our case, we know in advance what we want to implement: <br><blockquote><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMetadata</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MetadataFactory metadataFactory, WSConnection conn)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> TranslatorException </span></span>{ Table table = metadataFactory.addTable(<span class="hljs-string"><span class="hljs-string">"habr"</span></span>); metadataFactory.addColumn(<span class="hljs-string"><span class="hljs-string">"login"</span></span>, DefaultDataTypes.STRING, table); metadataFactory.addColumn(<span class="hljs-string"><span class="hljs-string">"karma"</span></span>, DefaultDataTypes.FLOAT, table); metadataFactory.addColumn(<span class="hljs-string"><span class="hljs-string">"rating"</span></span>, DefaultDataTypes.FLOAT, table); metadataFactory.addColumn(<span class="hljs-string"><span class="hljs-string">"ratingposition"</span></span>, DefaultDataTypes.LONG, table); Procedure proc = metadataFactory.addProcedure(<span class="hljs-string"><span class="hljs-string">"getHabr"</span></span>); metadataFactory.addProcedureParameter(<span class="hljs-string"><span class="hljs-string">"username"</span></span>, TypeFacility.RUNTIME_NAMES.STRING, Type.In, proc); metadataFactory.addProcedureParameter(<span class="hljs-string"><span class="hljs-string">"ratingposition"</span></span>, TypeFacility.RUNTIME_NAMES.LONG, Type.ReturnValue, proc); metadataFactory.addProcedureParameter(<span class="hljs-string"><span class="hljs-string">"rating"</span></span>, TypeFacility.RUNTIME_NAMES.FLOAT, Type.ReturnValue, proc); metadataFactory.addProcedureParameter(<span class="hljs-string"><span class="hljs-string">"karma"</span></span>, TypeFacility.RUNTIME_NAMES.FLOAT, Type.ReturnValue, proc); metadataFactory.addProcedureParameter(<span class="hljs-string"><span class="hljs-string">"login"</span></span>, TypeFacility.RUNTIME_NAMES.STRING, Type.ReturnValue, proc); }</code> </pre> </blockquote><br>  We described a table with four fields and a procedure with one parameter and four return values.  Because  we cannot pass a parameter to the table; the table will return data for the <code>defaultUser</code> parameter, which we have assigned to the translator during configuration.  Everything is simpler with the procedure, here we can both pass a parameter and get several values ‚Äã‚Äãin response.  I note in parentheses that procedures can return not only a fixed number of returned values, but also a whole table, like <code>ResultSetExecution</code> : for this, when describing parameters, you need to use <code>Type.Result</code> type, and also implement <a href="http://docs.jboss.org/teiid/8.0.0.Final/apidocs/org/teiid/translator/ResultSetExecution.html"><code>next()</code></a> method in the handler. <br><br><h4>  Handlers </h4><br>  To handle calls to our procedure and requests to our table, we must provide handlers.  For example, in this way. <br><blockquote><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ResultSetExecution </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createResultSetExecution</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QueryExpression command, ExecutionContext executionContext, RuntimeMetadata metadata, WSConnection connection)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> TranslatorException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HabrResultSetExecution((Select) command, connection); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ProcedureExecution </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProcedureExecution</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Call command, ExecutionContext executionContext, RuntimeMetadata metadata, WSConnection connection)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> TranslatorException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HabrProcedureExecution(command, connection); }</code> </pre> </blockquote><br>  If we have several tables or procedures and want to provide different handlers for different ones, we can do checks in these methods: <br><blockquote><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ResultSetExecution </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createResultSetExecution</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QueryExpression command, ExecutionContext executionContext, RuntimeMetadata metadata, WSConnection connection)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> TranslatorException </span></span>{ String tableName = ((NamedTable) command.getProjectedQuery().getFrom().get(<span class="hljs-number"><span class="hljs-number">0</span></span>)). getMetadataObject().getName(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"habr"</span></span>.equalsIgnoreCase(tableName)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HabrResultSetExecution((Select) command, connection); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"hrenabr"</span></span>.equalsIgnoreCase(tableName)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HrenabrResultSetExecution((Select) command, connection); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ProcedureExecution </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProcedureExecution</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Call command, ExecutionContext executionContext, RuntimeMetadata metadata, WSConnection connection)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> TranslatorException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"getHabr"</span></span>.equalsIgnoreCase(command.getProcedureName())) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HabrProcedureExecution(command, connection); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"getHrenabr"</span></span>.equalsIgnoreCase(command.getProcedureName())) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HrenabrProcedureExecution(command, connection); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre> </blockquote><br>  But in our translator, we will not do that: there is no need. <br><br><h4>  Oh yes ... little street magic </h4><br>  The attentive reader probably noticed that so far we have never used the property of the <code>importer.convertToUppercase</code> model, which we have registered in the configuration.  The Teiid code uses this nice feature, and we use it: <br><blockquote><pre> <code class="java hljs">[..] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> convertToUppercase; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isConvertToUppercase</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> convertToUppercase; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setConvertToUppercase</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> convertToUppercase)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.convertToUppercase = convertToUppercase; } [..] <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMetadata</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MetadataFactory metadataFactory, WSConnection conn)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> TranslatorException </span></span>{ [..] PropertiesUtils.setBeanProperties(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, metadataFactory.getImportProperties(), <span class="hljs-string"><span class="hljs-string">"importer"</span></span>); }</code> </pre> </blockquote><br>  As you can easily guess by the code, the <code>PropertiesUtils.setBeanProperties</code> method can prefix the properties that are passed from the model configuration to the <code>MetadataFactory</code> and are available via the <code>metadataFactory.getImportProperties()</code> , and fill the specified <em>POJO</em> with them, taking into account type conversion and checking for the presence of properties in general.  So  we get a convenient way to transfer configuration parameters to the code. <br><br><h2>  ResultSetExecution </h2><br>  To begin with, we will write a simple method that will parse the input data and form a table row for output, and add it to our <code>HabrExecutionFactory</code> class. <br>  It also takes into account the value of our property <code>convertToUppercase</code> and, if it is set to <code>true</code> , the login is converted to uppercase letters. <br><blockquote><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> List&lt;Object&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">extractResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DataSource dataSource)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> TranslatorException </span></span>{ List&lt;Object&gt; results = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Object&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { DocumentBuilderFactory xmlFact = DocumentBuilderFactory.newInstance(); DocumentBuilder builder; builder = xmlFact.newDocumentBuilder(); Document doc = builder.parse(dataSource.getInputStream()); dataSource.getInputStream().close(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> XPath xpath = XPathFactory.newInstance().newXPath(); Node node = (Node) xpath.compile(<span class="hljs-string"><span class="hljs-string">"/habrauser/login"</span></span>).evaluate(doc, XPathConstants.NODE); String login = node.getTextContent(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (convertToUppercase) login = login.toUpperCase(); results.add(login); node = (Node) xpath.compile(<span class="hljs-string"><span class="hljs-string">"/habrauser/karma"</span></span>).evaluate(doc, XPathConstants.NODE); results.add(Float.valueOf(node.getTextContent())); node = (Node) xpath.compile(<span class="hljs-string"><span class="hljs-string">"/habrauser/rating"</span></span>).evaluate(doc, XPathConstants.NODE); results.add(Float.valueOf(node.getTextContent())); node = (Node) xpath.compile(<span class="hljs-string"><span class="hljs-string">"/habrauser/ratingPosition"</span></span>).evaluate(doc, XPathConstants.NODE); results.add(Long.valueOf(node.getTextContent())); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TranslatorException(e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> results; }</code> </pre> </blockquote><br>  Now you can write the class <code>HabrResultSetExecution</code> : <br><blockquote><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HabrResultSetExecution</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResultSetExecution</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> WSConnection conn; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> closed; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DataSource dataSource; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HabrResultSetExecution</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Select query, WSConnection conn)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.conn = conn; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> TranslatorException </span></span>{ closed = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Dispatch&lt;DataSource&gt; dispatch = conn.createDispatch(HTTPBinding.HTTP_BINDING, defaultUser, DataSource.class, Mode.MESSAGE); dispatch.getRequestContext().put(MessageContext.HTTP_REQUEST_METHOD, <span class="hljs-string"><span class="hljs-string">"GET"</span></span>); dataSource = dispatch.invoke(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TranslatorException(e); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;?&gt; next() <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> TranslatorException, DataNotAvailableException { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (closed) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; closed = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> extractResult(dataSource); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ closed = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cancel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> TranslatorException </span></span>{ closed = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }</code> </pre> </blockquote><br>  The <code>execute()</code> method is called by the system to execute the request.  In our implementation, it performs a request to the service, using the connection passed to it, and stores an instance of the DataSource in the field.  After that, the system calls the <code>next()</code> method until it returns <code>null</code> .  In the first call, the method passes the saved DataSource to the <code>extractResult()</code> method, which does all the work and also generates a data row: <code>List&lt;?&gt;</code> , Each of whose elements corresponds to a field in the DB row.  Because  we have only one line of data; on the second and subsequent calls we return <code>null</code> . <br><br><h2>  ProcedureExecution </h2><br>  This class works in a similar way.  There are only two differences: <br><ul><li>  The <code>execute()</code> method uses the user name passed in the parameter procedure to call the service. </li><li>  instead of the <code>next()</code> method, the system selects data through the <code>getOutputParameterValues()</code> method (which is called only once per call);  The <code>next()</code> method, as I mentioned earlier, can be called if the procedure can return a result set </li></ul><br><blockquote><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HabrProcedureExecution</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProcedureExecution</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Call procedure; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> WSConnection conn; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DataSource dataSource; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HabrProcedureExecution</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Call procedure, WSConnection conn)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.procedure = procedure; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.conn = conn; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> TranslatorException </span></span>{ List&lt;Argument&gt; arguments = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.procedure.getArguments(); String username = (String) arguments.get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getArgumentValue().getValue(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Dispatch&lt;DataSource&gt; dispatch = conn.createDispatch(HTTPBinding.HTTP_BINDING, username, DataSource.class, Mode.MESSAGE); dispatch.getRequestContext().put(MessageContext.HTTP_REQUEST_METHOD, <span class="hljs-string"><span class="hljs-string">"GET"</span></span>); dataSource = dispatch.invoke(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TranslatorException(e); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;?&gt; getOutputParameterValues() <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> TranslatorException { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> extractResult(dataSource); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;?&gt; next() <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> TranslatorException, DataNotAvailableException { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cancel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> TranslatorException </span></span>{ } }</code> </pre> </blockquote><br><br><h2>  UpdateExecution </h2><br>  We will probably implement this handler in the next article if the audience shows interest in the topic at all. <br><br><h2>  Conclusion </h2><br>  So we got to this point.  Now we only have two things to do: <br><ol><li>  execute these queries here: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> habr.habr; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> w.* <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">call</span></span> habr.getHabr(username=&gt;<span class="hljs-string"><span class="hljs-string">'elfuegobiz'</span></span>)) w;</code> </pre></li><li>  say: it was cool =) </li></ol></div><p>Source: <a href="https://habr.com/ru/post/150878/">https://habr.com/ru/post/150878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../150873/index.html">Porting games for iOS on BlackBerry PlayBook</a></li>
<li><a href="../150874/index.html">Fake maker threatens Apple with iPhone 5 design trial</a></li>
<li><a href="../150875/index.html">The correct chair for daily work at the computer</a></li>
<li><a href="../150876/index.html">Freelander PD10 - finally a tablet with 3G and GPS</a></li>
<li><a href="../150877/index.html">Philips THE SPECKED with a braided cable: Headphones that do not get confused?</a></li>
<li><a href="../150879/index.html">Co-founder of The Pirate Bay will be given to Sweden</a></li>
<li><a href="../150881/index.html">Withdraw money from PayPal to the card: Instructions for Dummies</a></li>
<li><a href="../150882/index.html">Levels for Sokoban</a></li>
<li><a href="../150883/index.html">Who owns the downloaded music after your death?</a></li>
<li><a href="../150884/index.html">GoDaddy's radical decision to fight conservatives</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>