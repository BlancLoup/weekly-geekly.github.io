<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Website without backend: user authentication in BaaS parse.com through social networks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I will deploy the world every morning, like a rubber band on a golf ball, and roll it back in the evening. If you really ask, I will show you how to d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Website without backend: user authentication in BaaS parse.com through social networks</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  I will deploy the world every morning, like a rubber band on a golf ball, and roll it back in the evening.  If you really ask, I will show you how to do it. </blockquote>  <i>R. Bradbury</i> <br><br>  <b>UPDATE: Parse <a href="https://habrahabr.ru/post/276135/">will not work</a> by 2017.</b> <br><br><h4>  Introduction </h4><br>  This article describes the Backend-as-a-Service approach to storing and processing data.  The advantages and disadvantages of a representative of such an approach, the parse.com service, are described.  Briefly presented user authentication service through social.  uLogin networks.  The main purpose is to show how these two services can interact, so that the project does not require user registration by username and password, but at the same time, the ability to authorize users to act on objects remains. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  About BaaS and parse.com </h4><br>  <i><a href="https://parse.com/">Parse.com</a></i> is one of the most popular backend-as-a-service (BaaS) providers.  BaaS approach allows you to not raise your server for storing and processing application data.  This is used in mobile development and in the regular web.  <i>Parse.com</i> has its own SDK for several platforms, including server ones.  But I will talk about javascript. <br><br>  The ability to work with the database via javascript without raising your server opens up excellent opportunities, for example, for the Single page application (SPA), which can be hosted on Github Pages, Bitbucket and many other free ones.  The first question that I had when I heard about working with the database from the client code is the delimitation of access rights, since the keys are well known.  After <i>reviewing the parse.com</i> documentation, I found out that user authorization is used for this.  Each user has his own login and password.  The SDK has methods for registering a new user by login and password, and authentication using the same data.  You can add email, while <i>parse.com</i> itself can send customized emails to verify email. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Sample code with registration</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> user = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Parse.User(); user.set(<span class="hljs-string"><span class="hljs-string">"username"</span></span>, <span class="hljs-string"><span class="hljs-string">"my name"</span></span>); user.set(<span class="hljs-string"><span class="hljs-string">"password"</span></span>, <span class="hljs-string"><span class="hljs-string">"my pass"</span></span>); user.set(<span class="hljs-string"><span class="hljs-string">"email"</span></span>, <span class="hljs-string"><span class="hljs-string">"email@example.com"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// other fields can be set just like with Parse.Object user.set("phone", "415-392-0202"); user.signUp(null, { success: function(user) { // Hooray! Let them use the app now. }, error: function(user, error) { // Show the error message somewhere and let the user try again. alert("Error: " + error.code + " " + error.message); } });</span></span></code> </pre> <br></div></div><br><br>  Access rights are differentiated by ACLs that can be assigned to created objects.  For example, set the object access to public reading, but leaving the editing only to an authorized user.  Additionally, you can set restrictions on methods for working with the table.  For example, you can allow everyone to write to a table, but prohibit reading to everyone except a certain group (in cases of logging, for example).  In addition, the administrator is provided with a master key with which you can get full access from the client application.  But in the SPA this is unacceptable, since the key can not be hidden.  Of course, there is an admin panel where you can edit charts, perform CRUD operations on all data. <br>  Admin: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/abd/19c/803/abd19c80321e9294cb8b580355278c3d.png" alt="image"></a> <br><br><h4>  Formulation of the problem </h4><br>  User authentication only by login and password can now look rough.  Therefore, <i>parse.com</i> has in its SDK the class <i>Parse.FacebookUtils</i> , with which you can link user accounts with social.  network.  But this is the only social network that can be used via the <i>parse.com</i> SDK in javascript.  There is Twitter, but <a href="https://www.parse.com/questions/twitter-login-via-javascript-api">not for</a> <a href="https://www.parse.com/questions/twitter-login-connect-sign-in-with-javascript-sdk">javascript</a> .  What to do if you really want to authenticate users through other social services.  network? <br><br><h4>  Cloud code </h4><br>  <i>Parse.com</i> , fortunately, provides not only data storage, but also the ability to execute some code on their server.  Fichu they called <a href="https://parse.com/docs/cloud_code_guide">Cloud Code</a> .  The code of created functions is inaccessible for users, which means it can be used when building requests signed by a secret key.  But this is not particularly useful. <br><br>  I began to choose services that have ready user authorization widgets for sites, and stopped at <a href="https://ulogin.ru/">uLogin</a> .  A few words about the choice.  Once I caught the eye of Loginza, but I was not satisfied with them, because there they asked me to enter my login and password, even to log in via Twitter.  Perhaps there were some others, soc.  applications that requested access to writing tweets (omg, enrages).  So, <i>uLogin</i> has a good set of social <i>services</i> .  networks, ready-made widget, return <i>accessToken</i> in javascript callback-functions, and also allows you to create your own social.  user authentication applications. <br><br>  Since parse.com asks to register users by login and password, I came to the conclusion that this pair can be obtained using the data returned by uLogin.  To do this, you need to create the file clound / main.js in your application, in which you need to define a function.  Let's call it ‚ÄúgetCredentials‚Äù. <br><pre> <code class="javascript hljs">Parse.Cloud.define(<span class="hljs-string"><span class="hljs-string">"getCredentials"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">request, response</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> token = request.params.token; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userLogin, userPassword; response.success({<span class="hljs-string"><span class="hljs-string">'username'</span></span>: userLogin, <span class="hljs-string"><span class="hljs-string">'password'</span></span>: userPassword}); });</code> </pre><br><br>  The <i>uLogin</i> service allows <a href="https://ulogin.ru/help.php">you</a> to <a href="https://ulogin.ru/help.php">customize the</a> list of fields that it will return.  But among the obligatory there are: <br>  <i>network</i> - user social network identifier, <br>  <i>profile</i> - user <i>profile</i> address (link to his page on the social network, if you can get it), <br>  <i>uid</i> - a unique user identifier within the social network, <br>  <i>identity</i> is a globally unique user id. <br><br>  <i>identity</i> is, as a rule, also a url, similar to <i>profile</i> , so I decided to glue the username (here <i>username</i> ) from the <i>network</i> and <i>uid</i> . <br>  For the password, something more secret is needed, so I decided to use the hash from <i>identity</i> , <i>token</i> , <i>secret</i> as a password. <br>  <i>identity</i> for uniqueness, <i>token</i> for secrecy, because  Each entry in <i>uLogin</i> will create a new token, known only to the user and to <i>uLogin</i> itself, and the <i>secret</i> - salt, stored in the application settings. <br>  This approach is bad because with each new entry through <i>uLogin</i> , there will be a new <i>token</i> , and therefore a new password.  Therefore, you need to save each time a new user password.  However, <i>parse.com</i> saves the session for a long time after the user has logged in, so there is no need to authenticate each time.  <a href="">Ready Cloud Code</a> . <br><br>  The solution is rather suspicious in quality, but in some cases it is quite efficient.  For example, if you refuse to log in users by their usernames and passwords.  But even in this case, the method can be improved and stop updating the user's password after receiving the token.  As another option, it is to use a random string as a temporary password instead of a hash (the awareness of this came a little later). <br><br>  Of course, a temporary password is issued after confirmation of the token, by receiving data from <i>uLogin</i> .  After that, we determine whether we have a user with this login.  If not, then register.  We write him the data from the social.  network (pseudonym, avatar) in the repository, return a couple of username and password. <br>  Interaction with <i>uLogin</i> and c <i>parse.com</i> takes place via https, all data is accessible only to the user himself. <br><br>  Client Authentication <br>  It takes quite a bit of code to get an authenticated user at parse.com. <br>  Connect the uLogin widget <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"//ulogin.ru/js/ulogin.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"uLogin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-ulogin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display=small;fields=first_name,last_name;providers=vkontakte,odnoklassniki,mailru,facebook;hidden=other;redirect_uri=&amp;callback=authCallback"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Add callback function code. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> user; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.authCallback = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">token</span></span></span><span class="hljs-function">) </span></span>{ Parse.Cloud.run(<span class="hljs-string"><span class="hljs-string">'getCredentials'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">token</span></span>: token}, { <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ Parse.User.logIn(data.username, data.password, { <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ user = Parse.User.current(); }, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">user, error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//handle it } }); } }); };</span></span></code> </pre><br>  Here is the call to the previously written server function " <i>getCredentials</i> " in Cloud Code. <br>  The next time the user logs in using <i>var user = Parse.User.current ();</i>  You can determine whether the user is authenticated or not.  If so, then the uLogin widget should be hidden. <br><br><h4>  Pros and cons of a single-page application using parse.com </h4><br><h6>  pros </h6><br><ul><li>  There is no server to support. </li><li>  Free 20GB for files, 20GB for data, 2TB traffic, 30 requests per second, no limit on the number of users </li><li>  Ability to execute js code on server </li><li>  Work with files (create, get content, get url) </li><li>  A good ready analytics with graphs, events, and more. </li></ul><br><br><h6>  Minuses: </h6><br><ul><li>  Delay in receiving data </li><li>  No automatic backup (there is a button to create a dump) </li><li>  There is no automatic cleaning of unused files (there is a button for this) </li><li>  The need for design to reduce the number of requests to the backend </li><li>  Dependence on two external services: parse.com and uLogin (the second dependency can be easily replaced with its own server) </li></ul><br><br><h6>  Comment: </h6><br>  It is possible to write other clients to the same publicly available data.  If the client side allows user authentication through uLogin, then there are no barriers to managing user data.  The disadvantage is that the limit on the number of requests is total. <br><br><h4>  Demo project </h4><br>  Looking at imhonet, bookmix, livelib, I had the idea to make my own service for storing read books.  The main goal of which is a list of books, without unnecessary gusts like ratings, purchases, covers.  When choosing such services, you are interested in the reliability of data storage, so that it does not work out that the project closes in a year or two, and the data will be lost.  Therefore, when developing my service, I decided to use external free data warehouses, that is, BaaS.  This will not pay for hosting, do not worry about the problems of software updates.  Statics planned to keep on Github Pages.  But once the service became dependent on parse.com, then he decided to use hosting too.  For the SPA I decided to use AngularJS, as I knew him and knew what I needed from him.  Connoisseurs of separation of entities will notice strange dependencies between them, but with each project on AngularJS I will learn something new about it.  Now I know how to do better.  Rewrite only from academic purposes considered superfluous. <br><br>  Some may say that the registration of users only through social.  network may entail serious difficulties to restore access to the project in case of loss of access to social.  network.  This problem could be solved by setting uLogin so that he asked for the user's email (and verified it himself), and then restore access by email.  But there is no such thing in the demo project, since the list of books read is publicly available, which means that in case of serious problems, you can simply duplicate it to another account. <br><br>  <a href="">Source</a> <br>  <a href="http://www.knigopis.com/">Demo</a> <br><br>  PS: The demo is my production, it will not be turned off. <br><br>  <b>Upd</b> : there was no habraeffect, there is still a lot of limit (click to enlarge) <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f33/4f8/ece/f334f8ecec0651d1e197b3d9c561449a.png" alt="image"></a> </div><p>Source: <a href="https://habr.com/ru/post/248511/">https://habr.com/ru/post/248511/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248501/index.html">Why do we need an understandable language?</a></li>
<li><a href="../248503/index.html">JetBrains products at last year's prices</a></li>
<li><a href="../248505/index.html">Repository pattern. Basics and explanations</a></li>
<li><a href="../248507/index.html">WebSocket RPC or how to write a live web browser application</a></li>
<li><a href="../248509/index.html">Qt Android and system audio control dialog</a></li>
<li><a href="../248517/index.html">CMakeProjectManager2: a bit of convenience when working with CMake in Qt Creator</a></li>
<li><a href="../248519/index.html">PID problem 1 zombie reaping in Docker</a></li>
<li><a href="../248521/index.html">We collect bad data - 2. 1.5 years later, about how not to publish open data</a></li>
<li><a href="../248525/index.html">Workflow in Document Approval System</a></li>
<li><a href="../248527/index.html">How to write great pull requests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>