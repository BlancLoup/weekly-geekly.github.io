<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP error and exception handling</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This ‚Äúsmall‚Äù article is a development of the topic covered in this article. 
 As you know, PHP was born a long time ago and already then the question ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP error and exception handling</h1><div class="post__text post__text-html js-mediator-article">  This ‚Äúsmall‚Äù article is a development of the topic covered in <a href="http://micronby.habrahabr.ru/blog/47628.html">this</a> article. <br>  As you know, PHP was born a long time ago and already then the question arose of what to do with the errors that occurred.  Perl, which is the undoubted progenitor of PHP by default, did not have any error handling system.  When any error occurred, the server threw out the 500th error and that was it.  Therefore, Warnings, Fatal Errors and Notices were a real breakthrough in alleviating the already hard work of a programmer.  However, as time went on, the PHP mechanisms did not change, and technologies, as is known, do not like to stand still. <br><a name="habracut"></a><br>  And here in PHP 5.0, finally, in the arsenal of programmers appeared such a powerful tool as an exception or Exception.  There are many advantages of Exception, I will describe only a few (perhaps, I express myself inaccurately or even illiterately, but I was just too lazy to look for scientific terms to describe the advantages, because they are described in their own words): <br><ul><li>  Pass-through generation  This means that the occurrence of an exception somewhere in the code will lead to a sequential exit from the control structures and functions before the first catch block or before the main function (with the corresponding error in the stream) of the main script </li><li>  The ability to override the main class Exception through inheritance </li><li>  Ability to handle several types of exceptions simultaneously </li></ul><br>  The handling of standard PHP errors is extremely limited: <ul><li>  You can block with @ </li><li>  You can set your handler with set_error_handler </li><li>  You can generate your error using trigger_error </li></ul><br>  It is clear that the standard error handling mechanism is outdated and is present in the language only for compatibility reasons. <br>  In this small article I will try to highlight how error handling can be made universal by transferring it to the use of the exception mechanism. <br>  The main idea: we put our handler for standard errors and throw an exception in it: <br><blockquote><ol><li>  <font color="#ff0000">&lt;? php</font> </li><li>  <font color="blue">class</font> MyException extends Exception { </li><li>  <font color="blue">public</font> <font color="blue">function</font> __construct ($ message, $ errorLevel = 0, $ errorFile = <font color="#A31515">''</font> , $ errorLine = 0) { </li><li>  parent :: __ construct ($ message, $ errorLevel); </li><li>  $ <font color="blue">this</font> -&gt; file = $ errorFile; </li><li>  $ <font color="blue">this</font> -&gt; line = $ errorLine; </li><li>  } </li><li>  } </li><li>  <font color="blue">set_error_handler</font> ( <font color="blue">create_function</font> ( <font color="#A31515">'$ c, $ m, $ f, $ l'</font> , <font color="#A31515">'throw new MyException ($ m, $ c, $ f, $ l);'</font> ), E_ALL); </li><li>  <font color="#ff0000">?&gt;</font> </li></ol>  <font color="gray">* This source code was highlighted with <a href="http://source.virtser.net/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br>  This code must be placed in a separate file and connect it only once.  The MyException class extends the standard Exception class by adding two additional parameters to the constructor: the file and the line number with an error. <br>  The set_error_handler function sets as an error handler a dynamically created lambda function (callback), which generates an exception in case of an error.  I especially ask you to pay attention to the second parameter of the set_error_handler function.  This parameter is very important, since it determines for which types of errors a custom (that is, our) handler will be called, and for which standard ones.  In this example, I set the value to E_ALL, which means that the handler will be called for all types of errors. <br>  If we do not want to handle some types of errors, for example, Notice, then we can easily indicate this: <br><blockquote>  <font><font color="blue">set_error_handler</font> ( <font color="blue">create_function</font> ( <font color="#A31515">'$ c, $ m, $ f, $ l'</font> , <font color="#A31515">'throw new MyException ($ m, $ c, $ f, $ l);'</font> ), E_ALL &amp; ~ E_NOTICE);</font>  <font color="gray">* This source code was highlighted with <a href="http://source.virtser.net/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br>  However, the ideal approach, as it seems to me, is the handling of all errors, but for some types, in particular, notice, it would be advisable not to throw an exception, but simply to display information on the screen: <br><blockquote>  <font><font color="blue">set_error_handler</font> ( <font color="blue">create_function</font> ( <font color="#A31515">'$ c, $ m, $ f, $ l'</font> , <font color="#A31515">'if ($ c === E_NOTICE) {echo'</font> This <font color="blue">is</font> notice: <font color="#A31515">'. $ m} else {throw new MyException ($ m, $ c, $ f, $ l);} '</font> ), E_ALL);</font>  <font color="gray">* This source code was highlighted with <a href="http://source.virtser.net/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br>  Now consider an example close to life.  Task: <br>  There is a registration form on the site, it is necessary to implement with the help of exceptions, the processing of validation errors and the issuance of appropriate warnings to the user. <br>  There are actually two difficulties here: <br><ol><li>  Display all errors at once, not one by one. </li><li>  Separate validation error handling from other exception handling </li></ol><br>  Decision: <br>  The main difficulty here for us will be the very notorious advantage of Exception, which is that when throwing an exception, there is a exit from the control structures to the first catch block (or to the end of the script).  In order to circumvent this pitfall, we define a new descendant class FormFieldsListException, in which we implement an error accumulation mechanism, and we will only throw an exception after validating all the fields.  In the FormFieldsListException class, we define the protected member $ _list in which we will store the data.  To simplify working with the $ _list array, we indicate that the class will implement two interfaces: ArrayAccess to access the elements of the array and Iterator to work in a loop.  When initializing the validation verification method, we create a FormFieldsListException object, and then, as errors are detected, add them to the FormFieldsListException object, as in a regular array. <br><blockquote><ol><li>  &lt;? php </li><li>  <font color="blue">class</font> FormFieldsListException extends Exception implements ArrayAccess, Iterator { </li><li>  <font color="blue">protected</font> $ _list = array (); </li><li></li><li>  <font color="blue">public</font> <font color="blue">function</font> __construct () { </li><li>  } </li><li></li><li>  <font color="blue">public</font> <font color="blue">function</font> offsetExists ($ index) { </li><li>  <font color="blue">return</font> isset ($ <font color="blue">this</font> -&gt; _ list [$ index]); </li><li>  } </li><li></li><li>  <font color="blue">public</font> <font color="blue">function</font> offsetGet ($ index) { </li><li>  <font color="blue">return</font> $ <font color="blue">this</font> -&gt; _ list [$ index]; </li><li>  } </li><li></li><li>  <font color="blue">public</font> <font color="blue">function</font> offsetSet ($ index, $ value) { </li><li>  <font color="blue">if</font> (isset ($ index)) { </li><li>  $ <font color="blue">this</font> -&gt; _ list [$ index] = $ value; </li><li>  } </li><li>  <font color="blue">else</font> { </li><li>  $ <font color="blue">this</font> -&gt; _ list [] = $ value; </li><li>  } </li><li>  } </li><li></li><li>  <font color="blue">public</font> <font color="blue">function</font> offsetUnset ($ index) { </li><li>  unset ($ <font color="blue">this</font> -&gt; _ list [$ index]); </li><li>  } </li><li></li><li>  <font color="blue">public</font> <font color="blue">function</font> current () { </li><li>  <font color="blue">return</font> current ($ <font color="blue">this</font> -&gt; _ list); </li><li>  } </li><li></li><li>  <font color="blue">public</font> <font color="blue">function</font> key () { </li><li>  <font color="blue">return</font> key ($ <font color="blue">this</font> -&gt; _ list); </li><li>  } </li><li></li><li>  <font color="blue">public</font> <font color="blue">function</font> next () { </li><li>  <font color="blue">return</font> next ($ <font color="blue">this</font> -&gt; _ list); </li><li>  } </li><li></li><li>  <font color="blue">public</font> <font color="blue">function</font> rewind () { </li><li>  <font color="blue">return</font> reset ($ <font color="blue">this</font> -&gt; _ list); </li><li>  } </li><li></li><li>  <font color="blue">public</font> <font color="blue">function</font> valid () { </li><li>  <font color="blue">return</font> ( <font color="blue">bool</font> ) $ <font color="blue">this</font> -&gt; current (); </li><li>  } </li><li>  } </li><li>  ?&gt; </li></ol>  <font color="gray">* This source code was highlighted with <a href="http://source.virtser.net/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br>  After the end of the validation procedure, we check if any error messages were entered.  If so, we ‚Äúthrow‚Äù the prepared exception object. <br>  To catch an exception, we use two catch blocks: for FormFieldsListException and for all other exceptions.  This allows you to specify different types of actions when different types of exceptions occur. <br><blockquote><ol><li>  &lt;? php </li><li>  <font color="blue">function</font> validateForm () { </li><li>  $ e = <font color="blue">new</font> FormFieldsListException (); </li><li>  <font color="blue">if</font> ($ errorInFirstField) { </li><li>  $ e [] = <font color="#A31515">'Error in first field'</font> ; </li><li>  } </li><li>  <font color="blue">if</font> ($ errorInSecondField) { </li><li>  $ e [] = <font color="#A31515">'Error in second field'</font> ; </li><li>  } </li><li>  <font color="blue">if</font> (( <font color="blue">bool</font> ) $ e-&gt; current ()) { </li><li>  <font color="blue">throw</font> $ e; </li><li>  } </li><li>  } </li><li></li><li>  <font color="blue">try</font> { </li><li>  validateForm (); </li><li>  } </li><li>  <font color="blue">catch</font> (FormFieldsListException $ error) { </li><li>  echo <font color="#A31515">'&lt;b&gt; Errors in the fields &lt;/ b&gt;: &lt;br /&gt;'</font> ; </li><li>  <font color="blue">foreach</font> ($ error <font color="blue">as</font> $ e) { </li><li>  echo $ e.  <font color="#A31515">'&lt;br /&gt;'</font> ; </li><li>  } </li><li>  } </li><li>  <font color="blue">catch</font> (Exception $ error) { </li><li>  echo <font color="#A31515">'Not validation error!</font>  <font color="#A31515">'</font> . $ error-&gt; getMessage (); </li><li>  } </li><li>  ?&gt; </li></ol>  <font color="gray">* This source code was highlighted with <a href="http://source.virtser.net/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br>  So here!  :) <br>  A properly designed exception system can seriously simplify the programmer‚Äôs life, especially when developing applications using the MVC pattern.  As a little research has shown, the PHP5 exception handling system carries considerable reserves for upgrading and use in specific situations. <br>  <strong>PS</strong> : Some of the programmers I showed this article consider the use of exceptions to validate forms, to put it mildly, not the best option (by the way, I would ask readers who are ‚Äúin the subject‚Äù to comment on this), so please consider this example just a learning example, not a guide to action. <br>  <strong>PPS</strong> : Many thanks to comrade <a href="https://habrahabr.ru/users/ashofthedream/" class="user_link">ashofthedream</a> , the dispute with which prompted me to study exceptions in more detail. <br><br>  <strong>UPD</strong> : Moved to <a href="http://habrahabr.ru/blog/php/">PHP</a> Blog </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/30399/">https://habr.com/ru/post/30399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303978/index.html">18 free photo stocks that will save your ad</a></li>
<li><a href="../30398/index.html">Testing Perl programs for beginners. Test Anything Protocol (TAP)</a></li>
<li><a href="../303984/index.html">Disadvantages of pure functional programming</a></li>
<li><a href="../303986/index.html">PSReadLine install syntax highlighting in PowerShell console</a></li>
<li><a href="../303988/index.html">A compilation of lessons for a novice JavaScript game developer.</a></li>
<li><a href="../303990/index.html">How smart service SMS handler works (shows only important information)</a></li>
<li><a href="../303994/index.html">Why is it sometimes better to buy a ready-made software product than to develop your</a></li>
<li><a href="../303998/index.html">Create your tags in RSpec tests</a></li>
<li><a href="../304000/index.html">Vidom - blazingly fast alternative to React</a></li>
<li><a href="../304004/index.html">‚ÄúWhy did I quit algorithmic trading for web startups?‚Äù: The story of a US developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>