<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DataPower Training Course</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The material was prepared in collaboration with the user wedmeed 


 In 2017, when our project began in Vietnam, we were faced with a new beast IBM Da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DataPower Training Course</h1><div class="post__text post__text-html js-mediator-article"><p>  The material was prepared in collaboration with the user <a href="https://habr.com/ru/users/wedmeed/" class="user_link">wedmeed</a> </p><br><p>  In 2017, when our project began in Vietnam, we were faced with a new beast IBM DataPower.  IBM DataPower is a product that is a gateway between clients and backends, intended for filtering, routing, enrichment or other transformations of messages passing through it (hereinafter referred to as queries).  It was necessary to study quickly, there was no time for the buildup, so we were asked to familiarize ourselves with it, after which there were many hours of Skype conferences with our colleague from Moscow, who shared their knowledge and experience with this product. <br></p><br><p>  Independent training was based on studying the documentation and watching educational videos from the Internet - and then a trick was waiting for me.  I almost could not find information in Russian.  By the way, my knowledge of English at that time was not at the highest level; moreover, it was my first project and, probably, these factors complicated my life.  This inspired me to write a tutorial article in Russian and in the simplest possible way for novice developers who have encountered this product and are trying to quickly understand its basics.  The article will not free you from reading the documentation, but it will make life easier in the early stages of understanding how it works. <br></p><br><p>  It is also worth noting that the structure given in practice will be close to the real project, which will allow you to use it as a base, expanding and complementing it to your requirements.  In conclusion, the ‚ÄúTheory‚Äù sections will contain a few words about the project already implemented, as well as some features that are worth paying attention to. </p><br><img src="https://habrastorage.org/webt/rm/at/lk/rmatlkcfuvcjxvgireijushp7yc.jpeg"><br><a name="habracut"></a><br><h2>  Part 1. Installing DataPower with Docker Toolbox </h2><br><p>  Install and run the Docker Toolbox application.  Immediately after launch, you will see the IP address of the machine at which DataPower will be available in the future: <br></p><br><img src="https://habrastorage.org/webt/zs/qa/wn/zsqawn2jksqp8j8gfl5gwslnks4.png"><br><br><p>  To start the image, you need to change some settings of the virtual machine (relevant for the IDG.2018.4.1.0 version) and restart it: <br></p><br><ol><li>  Stop the docker-machine with the command: <br><br><pre><code class="plaintext hljs">docker-machine stop</code> </pre> </li><li>  System -&gt; Motherboard -&gt; Main memory: minimum 4096Mb; <br></li><li>  System -&gt; Processor: at least 2; <br></li><li>  Display -&gt; Screen -&gt; Video memory: at least 128Mb; <br></li><li>  Start the docker-machine with the command: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="plaintext hljs">docker-machine start</code> </pre> <br>  <i>Note.</i>  <i>If you are prompted to restart "docker-machine env" - run:</i> <br><br><pre> <code class="plaintext hljs">docker-machine env</code> </pre> </li><li>  Next, you need to download the IBM DataPower image: <br><br><pre> <code class="plaintext hljs">docker pull ibmcom/datapower</code> </pre> </li><li>  Then start the docker-container with the following command: <br><br><pre> <code class="plaintext hljs">docker run -it \ -v $PWD/config:/drouter/config \ -v $PWD/local:/drouter/local \ -e DATAPOWER_ACCEPT_LICENSE=true \ -e DATAPOWER_INTERACTIVE=true \ -p 9090:9090 \ -p 3630:3630 \ -p 9022:22 \ -p 7170:7170 \ --name idg \ ibmcom/datapower</code> </pre></li><li>  After completing the command, press Enter and enter <b>admin / admin</b> as the login and password <br></li><li>  To launch the Web Management Interface, use the following commands: <br><br><pre> <code class="plaintext hljs">co</code> </pre> <br>  and <br><br><pre> <code class="plaintext hljs">web-mgmt 0 9090</code> </pre> </li><li>  After all these steps, perform in the browser <a href="https://192.168.99.100:9090/">https://192.168.99.100:9090/</a> <br></li></ol><br><h2>  Part 2. Domains </h2><br><h3>  2.1.  Theory </h3><br><p>  Domains in DataPower allow you to separate administration and development tools, as well as provide security. <br></p><br><p>  After installation, there is only a default domain from which application domains can be created.  For each domain has its own configuration settings. <br></p><br><p>  Some shared resources and settings can only be defined in the default domain, these include network interfaces, users and access control, application domains, and others. <br></p><br><p>  The application domain is the development section for request processing services.  The services defined in it cannot be shared with another application domain.  Application domains can be restarted separately and independently from each other, without the need to completely restart DataPower. <br></p><br><p>  You can create, restart, reset, suspend, resume or delete domains.  For more information on all administration features, please refer to the official documentation. <br></p><br><p>  A little about the implemented project.  We used 3 domains: <br></p><br><ul><li>  default - the default domain containing shared resources and parameters; </li><li>  trunk is the primary domain containing everything needed to process requests; </li><li>  settings - the domain of settings and security; local files contain information about service routing rules and security parameters. </li></ul><br><p>  The need to transfer all settings to a separate domain arose in connection with the search for a simpler deployment path.  As in many projects of the dev environment, test and prod were separated, and the removal to a separate domain of settings allowed to set all main domains from the dev environment in other environments through export / import, without the risk of losing the environment settings. <br></p><br><h3>  2.2.  Practice </h3><br><ul><li>  In the search field, enter "domain", select "Application Domain" and click "Add" <br><img src="https://habrastorage.org/webt/uo/k_/gs/uok_gsaxjifcklt56rs9wmiujhm.png"></li><li>  Here you need to specify the domain name, comment (if desired) and activate auditing and logging.  Fill in the fields and apply the changes. <br><img src="https://habrastorage.org/webt/3b/6w/ts/3b6wtsfrlvxcxgb7jgpkmm6u1rq.png"></li><li>  Similarly, add another domain "trunk" </li><li>  Go to Review changes <br><img src="https://habrastorage.org/webt/p-/nh/cp/p-nhcpeur45dhrzahmpffom9pq8.png"></li><li>  and save the domain configuration <br><img src="https://habrastorage.org/webt/1u/8n/si/1u8nsi-zblkkqdsrpa7lnqcgw8g.png"></li><li>  You can check the status of created objects by going to the default domain in the navigation tree in Status -&gt; Main -&gt; Object Status <br><img src="https://habrastorage.org/webt/uz/qo/q4/uzqoq4kek4qdgkfkhovrjmiridm.png"></li><li>  Select <b><i>View by: types</i></b> <br><img src="https://habrastorage.org/webt/fj/5_/6z/fj5_6zg-kidxhkt5as0omzfvsiw.png"></li><li>  Find the Application Domain in the list and check the status of the objects: each of them should be saved, turned on and in the up state.  If so, proceed to the next chapter. </li></ul><br><img src="https://habrastorage.org/webt/xa/ii/kj/xaiikjxfdhsy19lez-rxo2xmeug.png"><br><br><h2>  Part 3. Queue managers </h2><br><p>  The queue manager is not a required component of IBM DataPower, but using the MQ example you can show the power of this product.  We will use MQ from IBM.  During the testing described in Chapter 6, we will need to send a message to the local queue manager.  In this article I will do this with the rfhutil utility, but you can use any method available to you.  For testing, you will need to create a connection from DP to your local queue manager using the MQ Queue Manager. </p><br><cut></cut><br><h3>  3.1.  Theory </h3><br><p>  The queue manager provides data exchange between the gateway and remote queue managers. </p><br><p>  You can also customize the MQ Queue Manager Group, which will improve system resiliency.  This can be useful, for example, if you want to connect a client to any of a set of working queue managers and in some other cases that you can see in the official documentation. </p><br><p>  From the experience of the project, it is worth noting only one feature: at one time we wanted to try to implement load balancing by means of DataPower, in particular, using groups of queue managers, but in practice we did not find such an opportunity.  An alternative solution is to create a cluster of queue managers. </p><br><br><h3>  3.2.  Practice </h3><br><h4>  3.2.1.  Training </h4><br><ol><li>  Install WebSphere MQ; </li><li>  Create a local queue manager LOCAL_DP_QM, available on port 3630; </li><li>  Configure the DP.SVRCONN channel; <br><br><p>  When creating a channel, you may find the following commands helpful: </p><br><pre> <code class="plaintext hljs">strmqm LOCAL_DP_QM /*  mq*/ runmqsc LOCAL_DP_QM /*   mq*/ DEFINE CHANNEL (DP.SVRCONN) CHLTYPE(SVRCONN) MCAUSER('evlasenko') /* */ SET CHLAUTH('DP.SVRCONN') TYPE(USERMAP) CLNTUSER('evlasenko') USERSRC(channel) ADDRESS('*') ACTION(ADD) /*      */ SET CHLAUTH(DP.SVRCONN) TYPE(BLOCKUSER) USERLIST('nobody') /*   */ ALTER LISTENER (SYSTEM.DEFAULT.LISTENER.TCP) TRPTYPE(TCP) PORT(3630) control(QMGR) /*    3630*/ ALTER AUTHINFO (SYSTEM.DEFAULT.AUTHINFO.IDPWOS) AUTHTYPE(IDPWOS) CHCKCLNT(OPTIONAL) /* */ REFRESH SECURITY TYPE(CONNAUTH) /*  */ endmqm LOCAL_DP_QM /*  mq*/ strmqm LOCAL_DP_QM /*  mq*/ END</code> </pre><br></li><li>  Create the queues DP.IIB.REQIN and DP.IIB.RESIN </li><li>  Run rfhutil under the username for which you created the channel.  In the line Queue Manager Name (to connect to) list: <br><br><pre> <code class="plaintext hljs">DP.SVRCONN/TCT/127.0.0.1(3630)</code> </pre> <br></li><li>  Try to load the list of queue names; there should not be any errors in the message window.  Channel connection test passed. <br></li></ol><br><h4>  3.2.2.  Create IBM MQ Queue Manager </h4><br><ol><li>  Switch to the trunk domain. </li><li>  In the search type MQ, select IBM MQ Queue Manager and click add. </li><li>  You need to specify the name (TEST_QM), the hostname of the queue manager, the name of the queue manager and the name of the channel, as well as a timeout.  Configure and save your changes. <br><img src="https://habrastorage.org/webt/di/sg/x1/disgx1dt8szkq9uoicnlepcn9lg.png"><br></li></ol><br><p>  Check the status of the queue manager object in the same way as checking the status of domains.  To do this, from the trunk domain, select Object Status and filter the View by: types.  In the IBM MQ Queue Manager section, find the corresponding object and check its status. </p><br><h2>  Part 4. Multiprotocol gateways </h2><br><h3>  4.1.  Theory </h3><br><p>  Multi-Protocol Gateway (MPG) is a multi-protocol gateway that allows receiving requests from clients using various protocols and then transferring them to a remote server using various protocols.  The protocol used by the client may not match the protocol used by the remote access server. </p><br>  In the main MPG settings you can define the following components: <br><br><ul><li>  XML Manager - manages the compilation and caching of style sheets (xsl, xslt), document caching. </li><li>  Policy - consists of rules, each of which defines a set of actions applied to a message passing through a gateway. </li><li>  Settings front and back side (setting url, types of incoming and outgoing messages, timeouts and other). </li></ul><br><p>  A few words about the project: </p><br><p>  In the project implementation, 4 multiprotocol gateways are used (routing, 2 transformational for different end systems and an additional one designed to receive files from the settings domain).  The diagram below shows the general interaction scheme: </p><br><img src="https://habrastorage.org/webt/p9/ea/yb/p9eayb25jpeoiazqjd0sitssuf4.png"><br><p>  The number of MPGs may vary depending on the overall solution architecture.  In our case, DataPower is in front of an integration bus (IIB) and microservices that have significant differences in interfaces (json / http against xml / mq), so the transformational MPG was decided to do for each specific backend and call it appropriately.  We work with json / http for all clients, so there is one routing MPG.  Basic MPGs consist of 3 message processing rules ‚Äî request, response, and errors.  Each rule consists of the necessary actions, such as transformation, logging, routing, and others. </p><br><p>  From features - if in policy you use action ConvertQueryParamToXML, then be attentive to InputConversion.  If you set the Default Encoding value to JSON and try to send a GET request, you will be surprised to find that the message has not undergone any transformations indicated by you and you will not find any traces of it.  This feature will help to overcome the creation of a separate rule for GET requests. </p><br><h3>  4.2.  Practice </h3><br><h4>  4.2.1.  Training </h4><br><p>  All the necessary files for the work can be found at <a href="">https://github.com/EvgenyaVlasenko/IBM_DataPower.git</a> <br></p><h4>  4.2.1.1.  Trunk domain </h4><br><ol><li>  Switch to the trunk domain. </li><li>  In the control panel, select File Management. </li><li>  In the local directory, create the following directory structure and place the corresponding files in it (each file contains a brief description of what functions it performs, as well as a more detailed look at this later in the article). <br><img src="https://habrastorage.org/webt/oj/am/i9/ojami90qdgg81ojuyr88pmeuzd0.png"><br></li></ol><br><h4>  4.2.1.2.  Domain settings </h4><br><ol><li>  Go to domain settings. </li><li>  In the control panel, select File Management. </li><li>  In the local directory, create the following directory structure and place the corresponding files in it (a short description is also contained inside the files). <br><img src="https://habrastorage.org/webt/mf/9r/ne/mf9rnemyu8mcb01ad_wi6__ozj0.png"><br></li></ol><br><h3>  4.2.2.  Create GetFileMPG </h3><br><p>  First we will create a simple auxiliary MPG that will return files from the settings domain. </p><br><ol><li>  Go to domain settings. </li><li>  In the control panel, select Multi-Protocol Gateway and click create. </li><li>  Specify a name (GetFileMPG), a description (optional) and the type of backend (dynamic).  In fact, since the call to the backend will not actually be, but will only return a file from the local system, in this example, you can specify any type of backend. <br><img src="https://habrastorage.org/webt/ds/g7/5g/dsg75gxvgo-7caldbmytubddg6i.png"><br></li><li>  Set the request and response types.  Explicit specification of types will reduce the number of built-in checks.  Specifying the type of Pass through will allow you not to create a rule (in this case for the transformation of the response).  If we specify the Request Type too Pass through, we will not be able to process the message in any way.  This option does not suit us, so we limit the type of request using Non-XML. <br><br><img src="https://habrastorage.org/webt/qx/nx/l_/qxnxl_j3ki9e8hcc215zropuix8.png"><br></li><li>  Click on + and select HTTP Handler to create a new Front Side Protocol. <br><br><img src="https://habrastorage.org/webt/dc/gq/pq/dcgqpqgpx284pxkoqdqhivwjbku.png"><br></li><li>  Here you should specify the name, ip-address, port and list of allowed methods.  Should pay attention to the ip-address.  If you specify 0.0.0.0, then everyone can access this gateway.  If 127.0.0.1 - only other gateways within the same DataPower.  Since there are security settings among the settings, we use the second option.  Fill in the fields and click "Apply", the protocol will automatically be added to the gateway. <br><br><img src="https://habrastorage.org/webt/xn/y5/-r/xny5-rfrolidwemexqwg25-tkec.png"><br></li><li>  Click on + to add a new policy. <br><br><img src="https://habrastorage.org/webt/ju/y0/q6/juy0q6_osmjfnwd2v5xev97wvta.png"><br></li><li>  Fill in the policy name "GetFilePolicy". <br></li><li>  Create a new rule, fill in the name and direction of the rule.  Since there is actually no backend, but only the required file is returned, the rule will be only one (client to server). <br><br><img src="https://habrastorage.org/webt/cv/4c/z_/cv4cz_dfzc5sjxu4i7as6iluzne.png"><br></li><li>  Double-click on the Match action to configure it, select an existing rule and apply the changes.  Ideologically correct here would be to establish a restriction for being able to receive only Get-requests, but within the framework of the learning task, you can choose an existing one. <br></li><li>  Add another action, GatewayScript, by dragging it onto the rule, and configure it.  As a transformation, a prepared file will be used, which in the local: /// file system will find the file by name from the URI of the incoming request and place it in the message body.  The result of the operation will be passed directly to the output buffer of the rule.  Save the changes. <br><br><img src="https://habrastorage.org/webt/ai/pr/va/aiprvaljftoye2gr5tf1xjf4s_u.png"><br></li><li>  The final result of the policy should look like this: <br><br><img src="https://habrastorage.org/webt/rm/q0/on/rmq0onkkkvygnyevy574vsgz3ns.png"><br></li><li>  The creation of the MPG is complete, save the changes. <br></li><li>  You can check the success of its creation using Object Status, similar to checking the status of domains and the queue manager.  To do this, from the settings domain, select Object Status and filter View by: services.  In the ‚ÄúMulti-Protocol Gateway‚Äù section, find the corresponding object and check its status. <br></li><li>  You cannot call this MPG from the outside, as you protected it with ip.  Temporarily change the ip from 127.0.0.1 to 0.0.0.0 and the port from 7171 to 7170 and run the following query: <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/trunk/route/routeRules.xml"</code> </pre><br></li><li>  You should get the following answer: <br><br><img src="https://habrastorage.org/webt/e5/m8/3n/e5m83ngxz17e8lahsicaxs6lj5s.png"><br></li><li>  Again, change the ip and port to the original 127.0.0.1:7171. <br></li></ol><br><h4>  4.2.3.  Creating RoutingMPG </h4><br><p>  Now create a RoutingMPG.  Based on the input request and the routing rules, it will determine where and with what parameters the request should be sent. </p><br><ol><li>  Switch to the trunk domain. </li><li>  Create a new Multi-Protocol Gateway in accordance with clauses 2-10 of section 4.2.2 using the following values: <br><ul><li>  3 - name: RoutingMPG, type of backend: Dynamic (to be able to route requests to different MPGs, if necessary). </li><li>  4 - Rq: Non-xml, Rs: Non-xml. </li><li>  6 - name: RoutingHTTP_FSH, ip: 0.0.0.0, port: 7170, + Get method. </li><li>  8 - Name: RoutingPolicy. </li><li>  9 - name: RoutingPolicy_rule_req, direction: Client to Server. </li></ul><br></li><li>  Add another action to route the request. To do this, drag the action ‚ÄúRoute‚Äù to the rule, double-click it to configure it, fill in the fields and apply the changes.  The route.xsl file receives the routing settings file from the settings domain through the previously created GetFileMPG.  After that, based on the URI, the settings that are necessary for this operation are already selected from the file.  Some of them are used for routing, and some are added to headers for use in other MPGs.  The input and output parameters define the way to work only with the message body and do not affect headers and variables in any way.  Therefore: input from null - since no information from the message body is used for routing.  The output is null - since the result of the transformation is only a change in the service information. <br><br><img src="https://habrastorage.org/webt/bb/q0/nh/bbq0nh2dtogav5pyfoeneb3t66m.png"><br></li><li>  Similarly, create 2 more rules and save all changes: <br><ul><li>  Direction: Server-client, name: RoutingPolicy_rule_resp; <br>  Transformation: Input INPUT, Output NULL, transformation file local: ///RoutingMPG/transform/resp.xslt.  The resp.xslt file receives the http-response transformation MPG status and explicitly sets it to the response RoutingMPG.  If this is not done, the default code will be 200, even if an error has occurred in the transformation MPG. <br></li><li>  Direction: Error, name: RoutingPolicy_rule_error; <br>  Transformation: Input INPUT, Output PIPE (according to the documentation, using PIPE between two adjacent action nodes as INPUT and OUTPUT can eliminate additional processing and reduce the amount of memory used), the transformation file is local: ///RoutingMPG/transform/errors.xsl.  The errors.xsl file receives the error code and text from the response from the transformational MPG and generates a JSON error message in the format expected by the client. <br></li></ul><br></li><li>  The final result of the policy should look like this: <br><br><img src="https://habrastorage.org/webt/um/kx/x-/umkxx-3kwx3hi1dzmc1e80ko-wa.png"><br></li><li>  The creation of the MPG is complete, save the changes. <br></li><li>  Using, for example, the curl utility, run the following query: <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/dp/test/transformMessage"</code> </pre> <br></li><li>  If you get the following error, then everything is correct.  This error means that the message was successfully received and processed, but an attempt to call the backend (in this case, IIBMPG) was unsuccessful.  Go to the next step. <br><br><img src="https://habrastorage.org/webt/8g/iq/tl/8giqtlzspsyix66vnl7mkcxnelk.png"><br></li></ol><br><h4>  4.2.4.  Create IIBMPG </h4><br><p>  The next step is to create a transformational MPG.  Suppose the external system is in JSON request format, and the internal is XML.  We need to convert the input message so that the internal system can understand it.  It is worth noting that this is not always a simple transformation of the entire message.  Often it is required to transmit a truncated or supplemented message, sometimes with a completely reworked structure. </p><br><ol><li>  Switch to the trunk domain. </li><li>  Create a new Multi-Protocol Gateway in accordance with clauses 2-10 of section 4.2.2 using the following values: <br><ul><li>  3 - Name: IIBMPG, Backend Type: Dynamic </li><li>  4 - Rq: JSON, Rs: XML </li><li>  6 - name: IIBHTTP_FSH, ip: 127.0.0.1 (only requests from the same DataPower), port: 7172, + Get method </li><li>  8 - Name: IIBPolicy </li><li>  9 - name: IIBPolicy_rule_req, direction: Client to Server </li></ul><br></li><li>  Add a description.  The IIBRuleRoute.xsl file based on the X-DP Transform-Name in the request headers receives from the local: ///IIB/route/IIBRouteRules.xml file the request, response and error transformation files for this service and sets their values ‚Äã‚Äãto the corresponding context variables var: // context / IIB / reqTransform, var: // context / IIB / ansTransform, var: // context / IIB / errTransform.  Also, other values ‚Äã‚Äãfrom headers (url, uri, expire, timeout) are placed in context variables. <br><br><img src="https://habrastorage.org/webt/xo/6b/ek/xo6bekae8dsumpvosfe5xnbhneg.png"><br></li><li>  Add another action by dragging Advanced onto your rule and selecting from the Convert Query Params to XML list, configure.  You need to add a new input conversion map, giving it a name (cmnJSONParseCNVM) and the required type (JSON). <br><br><img src="https://habrastorage.org/webt/ir/az/gb/irazgbszkybdgjkor1otjvrllqc.png"><br><br><img src="https://habrastorage.org/webt/yd/tk/2x/ydtk2xhbveh4j6z1gsweidcyhak.png"><br></li><li>  Add a transformation after the standard conversion and configure it.  To specify the transformation file in this case, the variable set in the previous conversion is used.  This is done so that the transformation is universal, and the file itself is substituted on the fly, depending on the input message.  The message body is ready.  The next action we need to route the message, the body of the message will not change, so create a variable dpvar_1 and save the result in it.  It is this variable that we point to the input to the Results action.  Save the changes. <br><br><img src="https://habrastorage.org/webt/yz/cf/do/yzcfdogrjturkuvvmqx7bio_ex4.png"><br></li><li>  Add a routing action and set the following parameters.  The IIBURLRoute.xsl file gets the values ‚Äã‚Äãof context variables, some of them sets the request as service variables, and from the others it forms the URI for the request to the target system, which also saves it into the service variable. <br><br><img src="https://habrastorage.org/webt/kl/vk/cf/klvkcfgcro60wznqwo0ibxdncys.png"><br></li><li>  Similarly, create 2 more rules and save all changes: <br><ul><li>  Direction: Server-client, name: IIBPolicy_rule_resp; <br>  Transformation: Input INPUT, Output PIPE, var: // context / IIB / ansTransform transformation file (context variable for on-the-fly transformation transformation substitution). </li><li>  Direction: Error, name: IIBPolicy_rule_error; <br>  Transformation: Input NULL, Output PIPE, var: // context / IIB / errTransform transformation file (context variable for on-the-fly transformation of the error transformation). </li></ul><br></li><li>  The final result of the policy should look like this: <br><img src="https://habrastorage.org/webt/qi/d9/7u/qid97ursvmwifemzxbfdtudjkjc.png"><br></li><li>  The creation of the MPG is complete, save the changes. <br></li></ol><br><h2>  Part 5. Testing </h2><br><h3>  5.1.  Training </h3><br><ol><li>  Download, for example, the rfhutil utility to read and write messages to a queue; </li><li>  Test files are located in the tests folder of the same directory as the project files. </li></ol><br><h3>  5.2.  Health check </h3><br><ol><li>  Send the request using the curl utility (for the request below, the current directory should be the same as example.json). <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/dp/test/transformMessage" -H "Content-Type: application/json" --data-binary @example.json</code> </pre> <br></li><li>  Open 2 instances of the rfhutil utility and subtract the message from the DP.IIB.REQIN queue with the first instance; <br></li><li>  Go to the MQMD tab and copy the MessageID; <br></li><li>  In the second instance, open the rs.xml file, in the MQMD tab, paste the message identifier into the CorrelID and put the message in the DP.IIB.RESIN queue; <br></li><li>  You should get a similar answer: <br><br><img src="https://habrastorage.org/webt/mn/kj/xj/mnkjxj0lyafkvo7hjgpyytuytee.png"><br></li><li>  Repeat steps 1-3; <br></li><li>  In the second instance, open the rs_error.xml file and send a message to the queue filling in correllId; <br></li><li>     <br><br><img src="https://habrastorage.org/webt/_y/i5/hb/_yi5hbw1lnrfwsuryyln9z3rdic.png"><br></li></ol><br><h2>  6.  </h2><br><h3>  6.1.  Theory </h3><br><p> Log Targets   ,         . <br></p><br><p>     Log Targets    .     ,      4     1000Kb,      .              2-4    .       ,        .  , DataPower,  , ,   ,        ,      ,      -  MPG,     . <br></p><br><h3>  6.2.  Practice </h3><br><ol><li>    trunk; </li><li>    Log Target   ; </li><li>      : <br><ul><li> (IIB_LOG); </li><li> (File); </li><li>  (Text); </li><li>  timestamp(zulu); </li><li>   (logtemp:///IIB.log ‚Äî  IIBMPG); </li><li>  (1000). <br><img src="https://habrastorage.org/webt/ev/sm/mj/evsmmjxy8m6suwkbaeojvgcudf8.png"><br></li></ul><br></li><li>   .        MPG   IIBMPG. <br><br><img src="https://habrastorage.org/webt/lq/vl/5l/lqvl5lvc_w8powdnufq6emgjgwc.png"><br></li><li>    ,     ,    (  ,        ). <br><br><img src="https://habrastorage.org/webt/ia/tu/98/iatu98v3l0fioelwktk8uwu-6fw.png"><br></li><li>         ; <br></li><li>    ; <br></li><li>          . <br></li><li>      Log Targets    MPG. <br></li><li>   : <br><ul><li>             , ,         . <br><br><img src="https://habrastorage.org/webt/z2/ix/vt/z2ixvtjk8eidxsfbbe6mmfcecnc.png"><br></li><li>        . <br><br><img src="https://habrastorage.org/webt/go/ik/wl/goikwl1pdvlzhiyd_d7gqpffzo8.png"><br></li></ul><br></li></ol><br><h2>  7.  -    </h2><br><ol><li>       ‚Äì  ,   .    ‚Äì  ,   ,     -    . <br></li><li>      .       View Logs.      ,  ¬´  ¬ª, ¬´   ¬ª     . <br></li><li>       .           .       MPG       Show Probe -&gt; Enable Probe.         .   ,        . <br><br><img src="https://habrastorage.org/webt/re/6s/mh/re6smhejkm-i8cdmmeky6ch6cmy.png"><br></li><li>   ,      . <br></li></ol><br><p>     ‚Äì    . <br></p></div><p>Source: <a href="https://habr.com/ru/post/442686/">https://habr.com/ru/post/442686/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442674/index.html">Information security instances on attackdefense.com platform</a></li>
<li><a href="../442676/index.html">Where dreams lead: Underground</a></li>
<li><a href="../442678/index.html">The largest project in stereolithography: a 3D mammoth skeleton printed on a 3D printer</a></li>
<li><a href="../442680/index.html">Sensory replacement technologies will allow you to see the world with the help of sounds: how the neuroplasticity of the human brain works</a></li>
<li><a href="../442682/index.html">What to collect and how to build a C ++ project</a></li>
<li><a href="../442688/index.html">Is data analysis on Scala a harsh necessity or a pleasant opportunity?</a></li>
<li><a href="../442690/index.html">Moon mission "Bereshit" - selfie against the backdrop of the Earth</a></li>
<li><a href="../442692/index.html">Blockchain without intermediaries: how we sent securities to a distributed registry</a></li>
<li><a href="../442694/index.html">One of the streaming giants launched in India and attracted a million users in a week.</a></li>
<li><a href="../442696/index.html">S for Security: Internet Security of Things and reports on InoThings ++ 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>