<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with modules</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Task: 
 Use a class in which you can add new methods of exposure so that you can use them later. In this case, separate these methods by different fil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with modules</h1><div class="post__text post__text-html js-mediator-article"><img src="http://zcn.ru/examples/images/class.png" align="left">  Task: <br>  Use a class in which you can add new methods of exposure so that you can use them later.  In this case, separate these methods by different files. <br>  Imagine a spacecraft in which are used: <br>  a) movement methods associated with the engine <br>  b) energy charging methods associated with its solar panels <br>  c) etc. <br><br>  There are options: <br>  1) Creating variables in the object and initializing them through __construct, as new classes. <br>  But, when creating each new object, we get a decrease in performance and constant modification of the class (which may complicate the work of several programmers). <br>  2) Work through functions __ call, __ get, __ set. <br>  3-10 times slower operation of these functions.  Especially when calling call_user_func_array with parameters. <br><br>  I offer my version. <br>  Fast, optimized, but there is a small difficulty in debugging. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this habratopic I will touch on the topics: <br>  1. Overloading <br>  2. Acceleration of loading modules.  Combining modules. <br>  3. Optimization <br><a name="habracut"></a><br><h3>  Alternative approach </h3><br>  We can combine all modules into one file, while merging the same classes into one. <br><br>  For this, I wrote a module that I will analyze a little later. <br><br>  To work with the module, it is used (similar to the Singleton pattern) - the <b>mods</b> function.  It initializes the module and looks like this: <br><blockquote><code><font color="black"><font color="#008000">/**</font> <br> <font color="#008000">*    modules</font> <br> <font color="#008000">*</font> <br> <font color="#008000">* @return &lt;modules&gt; - </font> <br> <font color="#008000">*/</font> <br> <br> <font color="#0000ff">function</font> mods(){ <br> <font color="#0000ff">static</font> $mod; <br> <font color="#0000ff">if</font> (!isset($mod)) <br> $mod= <font color="#0000ff">new</font> modules; <br> <font color="#0000ff">return</font> $mod; <br> }</font></code> </blockquote> <br>  For operation of the merging module, two cache files are used. <br><br>  One of them is necessary in order to store all the plug-in classes (in the serialize form).  From them, with the help of the __autoload function, the necessary ones are selected that are necessary for work. <br>  The second file is all the necessary modules merged together in a php file.  It is just being loaded, instead of all modules. <br><br>  Initialization of these two files occurs at the beginning, when the module is initialized: <br><blockquote> <code><font color="black">mods()-&gt;cache( <font color="#A31515">'cache.data'</font> ) <br> -&gt;phpcache( <font color="#A31515">'cache.php'</font> );</font></code> </blockquote>  Files can be set different.  I, for example, on different pages of the site (on which different modules are used), use different phpcache files. <br><br>  By combining all the files into one, downloading files is faster.  (plus, I advise you to install eAccelerator for yourself, so that the files load instantly) <br><br>  But, it is also necessary to add modules that are loaded into the system (this works as a simple include): <br><blockquote> <code><font color="black">mods()-&gt;include_php( <font color="#A31515">'modules/mod1.php'</font> );</font></code> </blockquote>  And at the end convert the modules into one file, loading it: <br><blockquote> <code><font color="black">mods()-&gt;include_modules();</font></code> </blockquote> <br><h3>  An example of working with modules </h3><blockquote> <code><font color="black"><font color="#008000">//     (   )</font> <br> define ( <font color="#A31515">'PHP_DEBUG_MODE'</font> ,1); <br> <br> <font color="#008000">//        php-</font> <br> mods()-&gt;cache( <font color="#A31515">'cache.file'</font> ) <br> -&gt;phpcache( <font color="#A31515">'cache.php'</font> ); <br> <br> <font color="#008000">// </font> <br> <font color="#0000ff">if</font> (PHP_DEBUG_MODE==1){ <br> $files = glob($moddir. <font color="#A31515">'/*.inc'</font> ); <br> <font color="#0000ff">foreach</font> ($files <font color="#0000ff">as</font> $file){ <br> mods()-&gt;include_php($file); <br> } <br> <br> <font color="#008000">//  </font> <br> mods()-&gt;include_modules();</font></code> </blockquote> <br>  I want to draw attention to define <b>PHP_DEBUG_MODE</b> .  There is no need to study all modules to check changes every time.  Therefore, when the modules inside will not change, you can disable this check (by equating <b>PHP_DEBUG_MODE</b> to 0), leaving only the connection of the ready cache-php module (include_modules) containing all the necessary classes. <br><br><h3>  What happens </h3>  1) Merging classes. <br><blockquote> <code><font color="black"><font color="#008000">//file_A.php</font> <br> <font color="#0000ff">class</font> A{ <br> <font color="#0000ff">public</font> $start; <br> <br> <font color="#0000ff">function</font> start(){ <br> $ <font color="#0000ff">this</font> -&gt;start=1; <br> } <br> }</font></code> </blockquote> <blockquote> <code><font color="black"><font color="#008000">//file_B.php</font> <br> <font color="#0000ff">class</font> A{ <br> <font color="#0000ff">private</font> $stop; <br> <br> <font color="#0000ff">function</font> stop(){ <br> $ <font color="#0000ff">this</font> -&gt;stop=1; <br> } <br> }</font></code> </blockquote>  Result: <br><blockquote> <code><font color="black"><font color="#008000">//result_cache.php</font> <br> <font color="#0000ff">class</font> A{ <br> <font color="#0000ff">public</font> $start; <br> <font color="#0000ff">private</font> $stop; <br> <br> <font color="#0000ff">function</font> start(){ <br> $ <font color="#0000ff">this</font> -&gt;start=1; <br> } <br> <br> <font color="#0000ff">function</font> stop(){ <br> $ <font color="#0000ff">this</font> -&gt;stop=1; <br> } <br> }</font></code> </blockquote> <br><br>  2) Merging functions within classes <br><blockquote> <code><font color="black"><font color="#008000">//file_A.php</font> <br> <font color="#0000ff">class</font> A{ <br> <font color="#0000ff">public</font> $start; <br> <br> <font color="#0000ff">function</font> __construct(){ <br> $ <font color="#0000ff">this</font> -&gt;start=1; <br> } <br> }</font></code> </blockquote> <blockquote> <code><font color="black"><font color="#008000">//file_B.php</font> <br> <font color="#0000ff">class</font> A{ <br> <font color="#0000ff">public</font> $stop; <br> <br> <font color="#0000ff">function</font> __construct(){ <br> $ <font color="#0000ff">this</font> -&gt;stop=1; <br> } <br> }</font></code> </blockquote>  Result: <br><blockquote> <code><font color="black"><font color="#008000">//result_cache.php</font> <br> <font color="#0000ff">class</font> A{ <br> <font color="#0000ff">public</font> $stop; <br> <font color="#0000ff">public</font> $start; <br> <br> <font color="#0000ff">function</font> __construct(){ <br> $ <font color="#0000ff">this</font> -&gt;stop=1; <br> $ <font color="#0000ff">this</font> -&gt;start=1; <br> } <br> }</font></code> </blockquote> <br><br><h3>  Implementation </h3><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">/**</font> <br> <font color="#008000">*   </font> <br> <font color="#008000">*</font> <br> <font color="#008000">* @param &lt;string&gt; $class -   </font> <br> <font color="#008000">*/</font> <br> <br> <font color="#0000ff">function</font> __autoload($ <font color="#0000ff">class</font> ){ <br> mods()-&gt;putclass($ <font color="#0000ff">class</font> ); <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*    modules</font> <br> <font color="#008000">*</font> <br> <font color="#008000">* @return &lt;modules&gt; - </font> <br> <font color="#008000">*/</font> <br> <br> <font color="#0000ff">function</font> mods(){ <br> <font color="#0000ff">static</font> $mod; <br> <font color="#0000ff">if</font> (!isset($mod)) <br> $mod= <font color="#0000ff">new</font> modules; <br> <font color="#0000ff">return</font> $mod; <br> } <br> <br> <font color="#0000ff">class</font> modules{ <br> <font color="#0000ff">private</font> $dataclass=array(); <br> <font color="#0000ff">private</font> $datacache_date=0; <br> <font color="#0000ff">private</font> $datacache_name= <font color="#0000ff">null</font> ; <br> <font color="#0000ff">private</font> $classesfile= <font color="#0000ff">null</font> ; <br> <font color="#0000ff">private</font> $classesfiledate=0; <br> <font color="#0000ff">private</font> $classesincluded= <font color="#0000ff">false</font> ; <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*     </font> <br> <font color="#008000">*</font> <br> <font color="#008000">* @param &lt;string&gt; $file - + </font> <br> <font color="#008000">*/</font> <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">function</font> cache($file){ <br> $ <font color="#0000ff">this</font> -&gt;datacache_name=$file; <br> <font color="#0000ff">if</font> (file_exists($file)){ <br> $ <font color="#0000ff">this</font> -&gt;datacache_date=filemtime($file); <br> } <br> <font color="#0000ff">return</font> $ <font color="#0000ff">this</font> ; <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*  php-  </font> <br> <font color="#008000">*</font> <br> <font color="#008000">* @param &lt;string&gt; $file - + </font> <br> <font color="#008000">*/</font> <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">function</font> phpcache($file){ <br> $ <font color="#0000ff">this</font> -&gt;classesfile=$file; <br> <font color="#0000ff">if</font> (file_exists($file)) <br> $ <font color="#0000ff">this</font> -&gt;classesfiledate=filemtime($file); <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*    </font> <br> <font color="#008000">*</font> <br> <font color="#008000">* @param &lt;string&gt; $file -   </font> <br> <font color="#008000">*/</font> <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">function</font> include_php($file){ <br> <font color="#0000ff">if</font> (!file_exists($file)){ <br> $ <font color="#0000ff">this</font> -&gt;fatalerror( <font color="#A31515">'no include file \'&lt;b&gt;'</font> .$file. <font color="#A31515">'&lt;/b&gt;\''</font> ); <br> } <br> <br> <font color="#0000ff">if</font> ($ <font color="#0000ff">this</font> -&gt;datacache_date&lt;filemtime($file)){ <br> $ <font color="#0000ff">this</font> -&gt;loadcachedata(); <br> $ <font color="#0000ff">this</font> -&gt;removefile($file); <br> $ <font color="#0000ff">this</font> -&gt;parsephp(file_get_contents($file),$file); <br> file_put_contents($ <font color="#0000ff">this</font> -&gt;datacache_name,serialize($ <font color="#0000ff">this</font> -&gt;dataclass)); <br> <font color="#0000ff">if</font> ($ <font color="#0000ff">this</font> -&gt;classesfiledate!=0){ <br> unlink($ <font color="#0000ff">this</font> -&gt;classesfile); <br> $ <font color="#0000ff">this</font> -&gt;classesfiledate=0; <br> } <br> }elseif ($ <font color="#0000ff">this</font> -&gt;classesfiledate!=0 &amp;&amp; $ <font color="#0000ff">this</font> -&gt;classesfiledate&lt;filemtime($file)){ <br> unlink($ <font color="#0000ff">this</font> -&gt;classesfile); <br> $ <font color="#0000ff">this</font> -&gt;classesfiledate=0; <br> } <br> <br> <font color="#0000ff">return</font> $ <font color="#0000ff">this</font> ; <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*      </font> <br> <font color="#008000">*/</font> <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">function</font> include_modules(){ <br> <font color="#0000ff">if</font> (!$ <font color="#0000ff">this</font> -&gt;classesincluded){ <br> <font color="#0000ff">if</font> (!file_exists($ <font color="#0000ff">this</font> -&gt;classesfile)){ <br> $ <font color="#0000ff">this</font> -&gt;loadcachedata(); <br> file_put_contents($ <font color="#0000ff">this</font> -&gt;classesfile, <font color="#A31515">"&lt;?\n"</font> .$ <font color="#0000ff">this</font> -&gt;printclass( <font color="#A31515">''</font> ). <font color="#A31515">"\n?&gt;"</font> ); <br> } <br> include_once($ <font color="#0000ff">this</font> -&gt;classesfile); <br> $ <font color="#0000ff">this</font> -&gt;classesincluded= <font color="#0000ff">true</font> ; <br> } <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*    </font> <br> <font color="#008000">*</font> <br> <font color="#008000">* @param &lt;string&gt; $file -  </font> <br> <font color="#008000">*/</font> <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">function</font> removefile($file){ <br> <font color="#0000ff">foreach</font> ($ <font color="#0000ff">this</font> -&gt;dataclass <font color="#0000ff">as</font> $key=&gt;&amp;$ <font color="#0000ff">class</font> ){ <br> <font color="#0000ff">foreach</font> ($ <font color="#0000ff">class</font> [0] <font color="#0000ff">as</font> $name=&gt;$vars) <br> <font color="#0000ff">if</font> ($name==$file) <br> unset($ <font color="#0000ff">class</font> [0][$name]); <br> <font color="#0000ff">foreach</font> ($ <font color="#0000ff">class</font> [1] <font color="#0000ff">as</font> $fk=&gt;&amp;$ <font color="#0000ff">function</font> ){ <br> <font color="#0000ff">foreach</font> ($ <font color="#0000ff">function</font> <font color="#0000ff">as</font> $name=&gt;$vars) <br> <font color="#0000ff">if</font> ($name==$file) <br> unset($ <font color="#0000ff">function</font> [$name]); <br> <font color="#0000ff">if</font> ($ <font color="#0000ff">function</font> ==array()) <br> unset($ <font color="#0000ff">class</font> [1][$fk]); <br> } <br> <br> <font color="#0000ff">if</font> ($ <font color="#0000ff">class</font> [0]==array() &amp;&amp; $ <font color="#0000ff">class</font> [1]==array()) <br> unset($ <font color="#0000ff">this</font> -&gt;dataclass[$key]); <br> } <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*  PHP-</font> <br> <font color="#008000">*</font> <br> <font color="#008000">* @param &lt;string&gt; $class -  </font> <br> <font color="#008000">* @return &lt;string&gt; - </font> <br> <font color="#008000">*/</font> <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">function</font> printclass($ <font color="#0000ff">class</font> = <font color="#A31515">''</font> ){ <br> <font color="#0000ff">if</font> ($ <font color="#0000ff">class</font> == <font color="#A31515">''</font> ){ <br> $ <font color="#0000ff">string</font> =implode( <font color="#A31515">"\n"</font> ,$ <font color="#0000ff">this</font> -&gt;dataclass[ <font color="#A31515">''</font> ][0]); <br> <font color="#0000ff">foreach</font> ($ <font color="#0000ff">this</font> -&gt;dataclass[ <font color="#A31515">''</font> ][1] <font color="#0000ff">as</font> $fname=&gt;$ <font color="#0000ff">function</font> ) <br> $ <font color="#0000ff">string</font> .= <font color="#A31515">"\nfunction "</font> .$fname. <font color="#A31515">"{\n"</font> .implode( <font color="#A31515">"\n"</font> ,$ <font color="#0000ff">function</font> ). <font color="#A31515">"\n}"</font> ; <br> <font color="#0000ff">return</font> $ <font color="#0000ff">string</font> ; <br> } <br> <br> <font color="#0000ff">foreach</font> ($ <font color="#0000ff">this</font> -&gt;dataclass <font color="#0000ff">as</font> $classname=&gt;$data){ <br> $name=preg_split( <font color="#A31515">'/\s/'</font> , $classname); <br> <br> <font color="#0000ff">if</font> ($name[0]==$ <font color="#0000ff">class</font> ){ <br> $ <font color="#0000ff">string</font> = <font color="#A31515">'class '</font> .$classname. <font color="#A31515">'{'</font> .implode( <font color="#A31515">"\n"</font> ,$data[0]); <br> <font color="#0000ff">foreach</font> ($data[1] <font color="#0000ff">as</font> $fname=&gt;$ <font color="#0000ff">function</font> ) <br> $ <font color="#0000ff">string</font> .= <font color="#A31515">"\nfunction "</font> .$fname. <font color="#A31515">"{\n"</font> .implode( <font color="#A31515">"\n"</font> ,$ <font color="#0000ff">function</font> ). <font color="#A31515">"\n}"</font> ; <br> <br> <font color="#0000ff">return</font> $ <font color="#0000ff">string</font> . <font color="#A31515">'}'</font> ; <br> } <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*    cache-</font> <br> <font color="#008000">*/</font> <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">function</font> loadcachedata(){ <br> <font color="#0000ff">if</font> ($ <font color="#0000ff">this</font> -&gt;dataclass!=array()) <br> <font color="#0000ff">return</font> ; <br> <br> <font color="#0000ff">if</font> (file_exists($ <font color="#0000ff">this</font> -&gt;datacache_name)) <br> $ <font color="#0000ff">this</font> -&gt;dataclass=unserialize(file_get_contents($ <font color="#0000ff">this</font> -&gt;datacache_name)); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">function</font> classfiles($ <font color="#0000ff">class</font> ){ <br> <font color="#0000ff">foreach</font> ($ <font color="#0000ff">this</font> -&gt;dataclass <font color="#0000ff">as</font> $classname=&gt;$data){ <br> $name=preg_split( <font color="#A31515">'/\s/'</font> , $classname); <br> <br> <font color="#0000ff">if</font> ($name[0]==$ <font color="#0000ff">class</font> ){ <br> $keys=array(); <br> <font color="#0000ff">foreach</font> ($data[1] <font color="#0000ff">as</font> $dat) <br> $keys=array_merge(array_keys($data[0]),$keys); <br> <font color="#0000ff">return</font> implode( <font color="#A31515">", "</font> ,array_unique(array_merge(array_keys($data[0]),$keys))); <br> } <br> } <br> } <br> <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*   .</font> <br> <font color="#008000">*    php-cache .</font> <br> <font color="#008000">*</font> <br> <font color="#008000">* @param &lt;string&gt; $class -  </font> <br> <font color="#008000">*/</font> <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">function</font> putclass($ <font color="#0000ff">class</font> ){ <br> <font color="#0000ff">if</font> (!$ <font color="#0000ff">this</font> -&gt;classesincluded){ <br> $ <font color="#0000ff">this</font> -&gt;includemodules(); <br> <font color="#0000ff">if</font> (class_exists($ <font color="#0000ff">class</font> , <font color="#0000ff">false</font> )) <br> <font color="#0000ff">return</font> ; <br> } <br> <br> $ <font color="#0000ff">this</font> -&gt;loadcachedata(); <br> <br> <font color="#0000ff">if</font> (($evclass=$ <font color="#0000ff">this</font> -&gt;printclass($ <font color="#0000ff">class</font> ))!== <font color="#0000ff">false</font> ){ <br> file_put_contents($ <font color="#0000ff">this</font> -&gt;classesfile, <font color="#A31515">"&lt;?\n"</font> .$evclass. <font color="#A31515">"\n?&gt;"</font> ,FILE_APPEND); <br> chmod($ <font color="#0000ff">this</font> -&gt;classesfile,0777); <br> <font color="#0000ff">if</font> (@eval($evclass)=== <font color="#0000ff">false</font> ){ <br> $ <font color="#0000ff">this</font> -&gt;fatalerror( <font color="#A31515">'Error in class &lt;b&gt;'</font> .$ <font color="#0000ff">class</font> . <font color="#A31515">'&lt;/b&gt; in file &lt;b&gt; '</font> .$ <font color="#0000ff">this</font> -&gt;classfiles($ <font color="#0000ff">class</font> ). <font color="#A31515">'&lt;/b&gt;'</font> ); <br> } <br> } <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*    </font> <br> <font color="#008000">*</font> <br> <font color="#008000">* @param &lt;string&gt; $classname -  </font> <br> <font color="#008000">* @param &lt;array&gt; $class -  </font> <br> <font color="#008000">* @param &lt;string&gt; $filename -  ,   </font> <br> <font color="#008000">*/</font> <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">function</font> mergeclass($classname,$ <font color="#0000ff">class</font> ,$filename){ <br> <font color="#0000ff">if</font> (!isset($ <font color="#0000ff">this</font> -&gt;dataclass[$classname][0][$filename])){ <br> $ <font color="#0000ff">this</font> -&gt;dataclass[$classname][0][$filename]= <font color="#A31515">''</font> ; <br> } <br> <br> $ <font color="#0000ff">this</font> -&gt;dataclass[$classname][0][$filename].=$ <font color="#0000ff">class</font> [0]; <br> <font color="#0000ff">if</font> (!isset($ <font color="#0000ff">this</font> -&gt;dataclass[$classname][1])) <br> $ <font color="#0000ff">this</font> -&gt;dataclass[$classname][1]=array(); <br> <br> <font color="#0000ff">foreach</font> ($ <font color="#0000ff">class</font> [1] <font color="#0000ff">as</font> $fname=&gt;$ <font color="#0000ff">function</font> ){ <br> <font color="#0000ff">if</font> (!isset($ <font color="#0000ff">this</font> -&gt;dataclass[$classname][1][$fname][$filename])) <br> $ <font color="#0000ff">this</font> -&gt;dataclass[$classname][1][$fname][$filename]= <font color="#A31515">''</font> ; <br> $ <font color="#0000ff">this</font> -&gt;dataclass[$classname][1][$fname][$filename].=$ <font color="#0000ff">function</font> ; <br> } <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*  php ,      </font> <br> <font color="#008000">*</font> <br> <font color="#008000">* @param &lt;string&gt; $php -  </font> <br> <font color="#008000">* @param &lt;string&gt; $filename -  </font> <br> <font color="#008000">*/</font> <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">function</font> parsephp($php,$filename){ <br> <font color="#0000ff">if</font> (($pos=strpos($php, <font color="#A31515">'&lt;?'</font> ))!== <font color="#0000ff">false</font> ){ <br> $pos+=2; <br> <font color="#0000ff">if</font> (strtolower(substr($php,$pos,3))== <font color="#A31515">'php'</font> ) <br> $pos+=3; <br> } <br> <font color="#0000ff">if</font> (!preg_match_all( <font color="#A31515">'/((?:[^\'"\/$]|([\'"])(?:\\\\[\s\S]|[\s\S])*\2|\/[^*]|\/\*[\s\S]*\*\/|\$[^;\'"(){}\s]++)*)([{};]|\?&gt;|$|\s(function)\s|\s(class)\s)/DSU'</font> ,$php,$scobe,PREG_SET_ORDER|PREG_OFFSET_CAPTURE,$pos)) <br> <font color="#0000ff">return</font> ; <br> <br> <font color="#0000ff">for</font> ($i=0,$j=count($scobe);$i&lt;$j;$i++){ <br> <font color="#0000ff">if</font> (isset($scobe[$i][5]) &amp;&amp; $scobe[$i][5][0]== <font color="#A31515">'class'</font> &amp;&amp; $i&lt;$j-1 &amp;&amp; $scobe[$i+1][3][0]== <font color="#A31515">'{'</font> ){ <br> <font color="#008000">//is class</font> <br> $newclass=array( <font color="#A31515">''</font> ,array()); <br> <br> <font color="#0000ff">for</font> ($x=$i+2;$x&lt;$j;$x++){ <br> $test=&amp;$scobe[$x][3][0]; <br> <br> <font color="#0000ff">if</font> (isset($scobe[$x][4][0]) &amp;&amp; $scobe[$x][4][0]== <font color="#A31515">'function'</font> &amp;&amp; $x&lt;$j-1 &amp;&amp; $scobe[$x+1][3][0]== <font color="#A31515">'{'</font> ){ <br> <br> $name=$scobe[$x+1][1][0]; <br> $ <font color="#0000ff">function</font> = <font color="#A31515">''</font> ; <br> <font color="#0000ff">for</font> ($x+=2,$sco=1;$x&lt;$j;$x++){ <br> $test=&amp;$scobe[$x][3][0]; <br> <font color="#0000ff">if</font> ($test== <font color="#A31515">'{'</font> ) <br> ++$sco; <br> elseif ($test== <font color="#A31515">'}'</font> ) <br> <font color="#0000ff">if</font> (--$sco==0) <br> <font color="#0000ff">break</font> ; <br> $ <font color="#0000ff">function</font> .=$scobe[$x][0][0]; <br> } <br> <font color="#0000ff">if</font> ($x==$j) <br> $ <font color="#0000ff">this</font> -&gt;fatalerror( <font color="#A31515">'error parsing function'</font> .$name. <font color="#A31515">' in class &lt;b&gt;'</font> .$scobe[$i+1][1][0]. <font color="#A31515">'&lt;/b&gt;, not found }'</font> ); <br> <br> $newclass[1][$name]=$ <font color="#0000ff">function</font> ; <br> }elseif ($test== <font color="#A31515">';'</font> ) <br> $newclass[0].=$scobe[$x][0][0]; <br> elseif ($test== <font color="#A31515">'}'</font> ) <br> <font color="#0000ff">break</font> ; <br> <font color="#0000ff">else</font> $ <font color="#0000ff">this</font> -&gt;fatalerror( <font color="#A31515">'error parsing '</font> .$test. <font color="#A31515">' in class &lt;b&gt;'</font> .$scobe[$i+1][1][0]. <font color="#A31515">'&lt;/b&gt;'</font> ); <br> } <br> <br> $ <font color="#0000ff">this</font> -&gt;mergeclass($scobe[$i+1][1][0],$newclass,$filename); <br> <br> $i=$x; <br> } <font color="#0000ff">else</font> { <br> <font color="#0000ff">if</font> ($scobe[$i][3][0]== <font color="#A31515">'?&gt;'</font> ) <br> $ <font color="#0000ff">this</font> -&gt;mergeclass( <font color="#A31515">''</font> ,array($scobe[$i][1][0],array()),$filename); <br> <font color="#0000ff">else</font> <br> $ <font color="#0000ff">this</font> -&gt;mergeclass( <font color="#A31515">''</font> ,array($scobe[$i][0][0],array()),$filename); <br> } <br> } <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*   </font> <br> <font color="#008000">*</font> <br> <font color="#008000">* @param &lt;string&gt; $error -  </font> <br> <font color="#008000">*/</font> <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">function</font> fatalerror($error){ <br> trigger_error($error. <font color="#A31515">"&lt;br/&gt;\n"</font> , E_USER_ERROR); <br> die(); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Use on health. </div><p>Source: <a href="https://habr.com/ru/post/57024/">https://habr.com/ru/post/57024/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../57013/index.html">In search of the real Bill Gates. Part two</a></li>
<li><a href="../57014/index.html">RapidShare Lottery</a></li>
<li><a href="../57015/index.html">Conficker Test</a></li>
<li><a href="../57018/index.html">Emotional intelligence</a></li>
<li><a href="../57019/index.html">Domestic enterprises inhibit the development of Runet</a></li>
<li><a href="../57025/index.html">Symbian Foundation Announces Plans to Launch Platforms</a></li>
<li><a href="../57029/index.html">SPTD 1.58 - Windows 7 beta support</a></li>
<li><a href="../57032/index.html">We work with bookmarks in a new way.</a></li>
<li><a href="../57033/index.html">Winner of ImagineCup in Belarus</a></li>
<li><a href="../57035/index.html">Dating in the future - promo video domain .tel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>