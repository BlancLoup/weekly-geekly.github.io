<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing GUI Applications Using OCR</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Functional testing of the interface (GUI) of applications is a very important task, necessary, but not always trivial. The main question is: how to si...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing GUI Applications Using OCR</h1><div class="post__text post__text-html js-mediator-article">  Functional testing of the interface (GUI) of applications is a very important task, necessary, but not always trivial.  The main question is: how to simulate the user?  A simple, ordinary user who will have to work with your software directly from day to day. <br><br>  It would seem, and here the recognition of texts? <br><a name="habracut"></a><br><h2>  How and what they usually test and automate </h2><br><div class="spoiler">  <b class="spoiler_title">In general, this is a boring text, based mostly on experience.</b> <div class="spoiler_text">  Usually repelled from the software that needs to be automated.  For example, for Win applications, you can look towards MSAA and its development of UI Automation.  This framework recognizes the controls and screen text quite well through the API.  Web applications can be "poked" by Selenium or WatiN, etc. <br><br>  Such methods are not always suitable, for example, when a user works with an application through a remote desktop, or a Web application is stuffed with third-party controllers (ActiveX, Java applets, etc.). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Very well, this issue is described <a href="https://en.wikipedia.org/wiki/Graphical_user_interface_testing">here</a> , and the list of software is <a href="https://en.wikipedia.org/wiki/List_of_GUI_testing_tools">here</a> . <br></div></div><br><h2>  Idea </h2><br><blockquote>  we will go the other way ¬© Mayakovsky </blockquote><br>  But what if you take a screenshot, remember some area and as a test recognize the text in this area.  If there is an expected text in the specified area, then you can click there. <br><br>  It sounds good, you have to try. <br><br><h2>  And the thorny path of implementation </h2><br>  First you need to choose the engine for text recognition or write it yourself.  Writing for yourself is a non-trivial task, so let's take something ready and preferably Open Source.  Well, for starters, <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25BF%25D1%2582%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B5_%25D1%2580%25D0%25B0%25D1%2581%25D0%25BF%25D0%25BE%25D0%25B7%25D0%25BD%25D0%25B0%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D1%2581%25D0%25B8%25D0%25BC%25D0%25B2%25D0%25BE%25D0%25BB%25D0%25BE%25D0%25B2">read the manuals</a> . <br><br>  There is such a miracle called Tesseract OCR.  And to it there is an API wrapper on .NET!  It sounds simple, but not everything is so simple: take a picture, recognize and ... nothing - Tesseract did not see the text in our picture!  To be more precise, I did not see <b>a</b> picture on a <b>piece</b> . <br><br><div class="spoiler">  <b class="spoiler_title">How to take a picture of a rectangular area of ‚Äã‚Äãthe screen</b> <div class="spoiler_text"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Bitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAreaFromScreen</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Rectangle area</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rectangle(area.X, area.Y, area.Width, area.Height); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bmp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bitmap(rect.Width, rect.Height, PixelFormat.Format24bppRgb); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> g = Graphics.FromImage(bmp)) g.CopyFromScreen(rect.Left, rect.Top, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, bmp.Size, CopyPixelOperation.SourceCopy); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bmp; }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">A piece of 'bad' code that didn't recognize anything</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RecognizeText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Bitmap source</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> page = engine.Process(source, PageSegMode.SingleLine)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = page.GetText(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conf = page.GetMeanConfidence(); threshold = conf; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { Trace.TraceError(e.ToString()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } }</code> </pre><br></div></div><br>  Rummaging a bit <strike>into the intricacies and mechanisms of recognition</strike> on the Internet, I found this: <a href="http://stackoverflow.com/questions/9480013/image-processing-to-improve-tesseract-ocr-accuracy">stackoverflow.com/questions/9480013/image-processing-to-improve-tesseract-ocr-accuracy</a> . <br><br>  So, you must first do: <br><br><blockquote>  1. fix DPI (if needed) 300 DPI is minimum <br>  2. fix text size (eg 12 pt should be ok) <br>  3. try to fix text lines (deskew and dewarp text) <br>  4. try to fix illumination of image (eg no no dark part of image <br>  5. binarize and de-noise image <br></blockquote><br>  And only then try to recognize something there! <br><br>  Here the <a href="http://www.aforgenet.com/framework/">AForge.NET library</a> came to <a href="http://www.aforgenet.com/framework/">our rescue</a> .  It is, by the way, Open Source, like Tesseract. <br><br><div class="spoiler">  <b class="spoiler_title">a piece of 'good' magic code with AForge</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string RecognizeText(Bitmap source) { try { var seq = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FiltersSequence(); seq.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ResizeBilinear(source.Width * <span class="hljs-number"><span class="hljs-number">2</span></span>, source.Height * <span class="hljs-number"><span class="hljs-number">2</span></span>)); seq.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Grayscale(<span class="hljs-number"><span class="hljs-number">0.2126</span></span>, <span class="hljs-number"><span class="hljs-number">0.7152</span></span>, <span class="hljs-number"><span class="hljs-number">0.0722</span></span>)); seq.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OtsuThreshold()); seq.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Threshold(<span class="hljs-number"><span class="hljs-number">100</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span> = seq.Apply(source); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var page = engine.Process(<span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>, PageSegMode.SingleLine)) { var <span class="hljs-type"><span class="hljs-type">text</span></span> = page.GetText(); var conf = page.GetMeanConfidence(); threshold = conf; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">text</span></span>; } } catch (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { Trace.TraceError(e.ToString()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ""; } }</code> </pre><br></div></div><br>  I will explain the points: <br><br><ol><li>  DPI - the screenshot of the DPI norms is enough for us; </li><li>  fix text size - it depends on the font size, sometimes it is necessary to increase, sometimes to make it thicker or taller.  ResizeBilinear to help; </li><li>  try to fix text lines - it depends on the accuracy of the selected area of ‚Äã‚Äãthe screen.  Select the text sightingly, trying not to catch "artifacts" - handmade; </li><li>  try to fix illumination of image - Grayscale and that's it! </li><li>  binarize and de-noise image - we binarize and despair (!) OtsuThreshold and Threshold (100). </li></ol><br>  Now much better. <br><br>  The kernel of the program is ready, it remains <strike>quite a bit and everything will be cool</strike> to write an application with some semblance of a test designer, where you can mark out the screen area and save in a kind of test plan.  And write a test player.  <strike>Business, for 15 minutes.</strike> Of course, I had to tinker here, but this is the topic of another article. <br><br>  In the end, combining everything together, we got a simple test designer and a simple player. <br><br><h2>  And now the screenshot from which nothing is clear and video without sound </h2><br>  This is a screenshot of that part of the program, which I call Test Designer! <br><br><img src="https://habrastorage.org/files/a45/da6/195/a45da61957084bf6a40de76b68b41e51.png"><br><br>  And this is a video of the program's work - we are recording a simple test and launching it! <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/BnzUTg_nbpE%3Ffeature%3Doembed&amp;xid=17259,1500004,15700021,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg1wh0K8EWGxOJLxNYdNb7hhB3_og" frameborder="0" allowfullscreen=""></iframe><br><br>  That's all! <br><br>  Oh yes! <br><br><h2>  Sources, TTH and other </h2><br>  Project sources: <a href="https://github.com/skaeff/miranda-tester">github.com/skaeff/miranda-tester</a> <br>  Build version with English and Russian dictionaries: <a href="">github.com/skaeff/miranda-tester/blob/master/miranda-tester-net40-compiled.7z</a> <br><br>  Brief summary: <br><br><ol><li>  Tesseract OCR <a href="https://github.com/tesseract-ocr/tesseract">github.com/tesseract-ocr/tesseract</a> - OCR library; </li><li>  AForge.Net <a href="http://www.aforgenet.com/">www.aforgenet.com</a> - image processing library; </li><li>  A bit of logic written in C #. </li></ol><br>  And yes, for the screenshot, press Shift + Esc. </div><p>Source: <a href="https://habr.com/ru/post/280984/">https://habr.com/ru/post/280984/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280972/index.html">AppCode release 2016.1: improved support for Swift and C ++</a></li>
<li><a href="../280974/index.html">Creating an expert system in Wi! Mi 1.1</a></li>
<li><a href="../280976/index.html">About the Perforce Helix version control system</a></li>
<li><a href="../280978/index.html">Innovations C # 7</a></li>
<li><a href="../280980/index.html">How big operators make big money on big data?</a></li>
<li><a href="../280986/index.html">Fast transit traffic analysis</a></li>
<li><a href="../280988/index.html">4 PostCSS Myths</a></li>
<li><a href="../280990/index.html">Launch of Google Auto service in Russia</a></li>
<li><a href="../280994/index.html">MSA and StoreEasy News</a></li>
<li><a href="../280996/index.html">Development under tvOS: tips & tricks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>