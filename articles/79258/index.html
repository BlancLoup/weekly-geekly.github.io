<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Calculate dynamic expressions in C # 4.0 with dynamic</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. 
 Yesterday I published on Habr√© a translation of an article about one of the new features of the fourth version of C # 4.0 - the dynamic keywo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Calculate dynamic expressions in C # 4.0 with dynamic</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/a39/765/9ab/a397659ab24b85cade1529cc2ec7cb36.gif" align="left">  Hello. <br>  Yesterday I published on Habr√© a <a href="http://habrahabr.ru/blogs/net/79139/">translation of an article</a> about one of the new features of the fourth version of C # 4.0 - the dynamic keyword.  There was a heated discussion in the comments, the main reasons for which were two things: the performance of the speakers and the area of ‚Äã‚Äãtheir application.  In this article I will not touch upon the first question, but I will try to give an example of how a new opportunity allows you to solve a very real problem in a couple of hours with minimal effort. <br><a name="habracut"></a><br><br><h1>  Prehistory </h1><br>  For a better understanding of the task, I will briefly describe to you my first commercial project, which I and my colleagues were engaged in two years ago.  Our task was to implement in C # 2.0 a kind of object classifier, which answered the question of whether a certain document (let it be something like a tax return) meets a certain criterion.  The criterion was a complex predicate, which was formed by officers of the state service responsible for processing these documents and helped to highlight in the stream of documents those to which the service should have paid closer attention.  Well, why should they not pay attention, I will not tell you, however, it is not difficult to guess :) So, the expression was stuffed by the officer through a special editor on the Ajax, after which it could be used in two ways: used in runtime to check the object in memory or generate SQL A query that allowed you to select objects that meet the criteria from the database.  The first regime was subsequently removed from the system, but I still remember how difficult and at the same time interesting it was to implement it.  Then everything about everything took us several months.  Thanks to the new features of the C # 4.0 language, I was able to recreate a similar (although, of course, much more primitive) classifier of objects in just a couple of hours. <br><br><h1>  Implementation </h1><br>  So let's get started.  As is known, any expression is in its essence a tree whose nodes are constants, variables, operators, and functions.  Our classifier will be such a tree that will receive an object and give an answer, whether our object belongs to this class. <br>  First, select the base class for the top of the expression tree: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> ExpressionNode <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">abstract</font> dynamic Evaluate(); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> <font color="#0000ff">void</font> HandleObject( <font color="#0000ff">object</font> obj) <br> { <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">abstract</font> <font color="#2B91AF">IEnumerable</font> &lt;ExpressionNode&gt; GetChildren(); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The Evaluate method calculates the value for the given vertex and the entire subtree, the vertex of which it is.  Notice that the value returned by this method has a dynamic type.  HandleObject allows you to process the object before the calculation in order to store the necessary data.  GetChildren is used to navigate the tree. <br>  Class for constants: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> Constant : ExpressionNode <br> { <br> <font color="#0000ff">private</font> <font color="#0000ff">readonly</font> dynamic _value; <br> <br> <font color="#0000ff">public</font> Constant(dynamic <font color="#0000ff">value</font> ) <br> { <br> _value = <font color="#0000ff">value</font> ; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> dynamic Evaluate() <br> { <br> <font color="#0000ff">return</font> _value; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#2B91AF">IEnumerable</font> &lt;ExpressionNode&gt; GetChildren() <br> { <br> <font color="#0000ff">yield</font> <font color="#0000ff">break</font> ; <br> } <br> } <br> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  A constant is a very simple vertex of an expression that stores a value and returns it if necessary. <br>  The class that provides access to the properties of the object being processed (variables of our expression): <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> ObjectProperty : ExpressionNode <br> { <br> <font color="#0000ff">private</font> dynamic _value = <font color="#0000ff">null</font> ; <br> <font color="#0000ff">private</font> <font color="#0000ff">readonly</font> <font color="#0000ff">string</font> _name; <br> <font color="#0000ff">private</font> <font color="#0000ff">bool</font> _propertyNotFound; <br> <br> <font color="#0000ff">public</font> ObjectProperty( <font color="#0000ff">string</font> name) <br> { <br> _name = name; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> HandleObject( <font color="#0000ff">object</font> obj) <br> { <br> <font color="#0000ff">try</font> <br> { <br> _value = obj.GetType().GetProperty(_name).GetValue(obj, <font color="#0000ff">new</font> <font color="#0000ff">object</font> [0]); <br> } <br> <font color="#0000ff">catch</font> (Exception ex) <br> { <br> _propertyNotFound = <font color="#0000ff">true</font> ; <br> _value = <font color="#0000ff">null</font> ; <br> } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> dynamic Evaluate() <br> { <br> <font color="#0000ff">if</font> (_propertyNotFound) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> PropertyNotFoundException(); <br> } <br> <font color="#0000ff">return</font> _value; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#2B91AF">IEnumerable</font> &lt;ExpressionNode&gt; GetChildren() <br> { <br> <font color="#0000ff">yield</font> <font color="#0000ff">break</font> ; <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Very similar to the constant, but the value is calculated for each new object during its processing.  Note that if the object has no property, the exception will be thrown only at the stage of calculation, and not at the stage of processing.  This feature allows you to create complex expressions with lazy calculations. <br>  To check whether a property exists on an object, the following function is used: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> HasPropertyChecker : ExpressionNode <br> { <br> <font color="#0000ff">private</font> <font color="#0000ff">readonly</font> <font color="#0000ff">string</font> _name; <br> <font color="#0000ff">private</font> <font color="#0000ff">bool</font> _result; <br> <br> <font color="#0000ff">public</font> HasPropertyChecker( <font color="#0000ff">string</font> name) <br> { <br> _name = name; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> dynamic Evaluate() <br> { <br> <font color="#0000ff">return</font> _result; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#2B91AF">IEnumerable</font> &lt;ExpressionNode&gt; GetChildren() <br> { <br> <font color="#0000ff">yield</font> <font color="#0000ff">break</font> ; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> HandleObject( <font color="#0000ff">object</font> obj) <br> { <br> _result = obj.GetType().GetProperty(_name) != <font color="#0000ff">null</font> ; <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The remaining vertices of the expression are operators; they can be of three types: unary, binary, and aggregator. <br>  Base class for unary: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> UnaryOperator : ExpressionNode <br> { <br> <font color="#0000ff">private</font> <font color="#0000ff">readonly</font> ExpressionNode _argument; <br> <font color="#0000ff">protected</font> UnaryOperator(ExpressionNode arg) <br> { <br> _argument = arg; <br> } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">abstract</font> dynamic EvaluateUnary(dynamic arg); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> dynamic Evaluate() <br> { <br> <font color="#0000ff">return</font> EvaluateUnary(_argument.Evaluate()); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#2B91AF">IEnumerable</font> &lt;ExpressionNode&gt; GetChildren() <br> { <br> <font color="#0000ff">yield</font> <font color="#0000ff">return</font> _argument; <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  And the simplest example of such an operator is logical negation: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">[Operator( <font color="#A31515">"not"</font> )] <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> Not : UnaryOperator <br> { <br> <font color="#0000ff">public</font> Not( <font color="#0000ff">params</font> ExpressionNode[] args) : <font color="#0000ff">this</font> (args[0]) { Debug.Assert(args.Length == 1); } <br> <font color="#0000ff">public</font> Not(ExpressionNode arg) : <font color="#0000ff">base</font> (arg) { } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">override</font> dynamic EvaluateUnary(dynamic arg) <br> { <br> <font color="#0000ff">return</font> !arg; <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Notice that the statement is marked with a special attribute that defines its name.  It will come in handy later to form an XML-based tree. <br>  The basic binary operator and its example, the addition operator: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> BinaryOperator : ExpressionNode <br> { <br> <font color="#0000ff">private</font> <font color="#0000ff">readonly</font> ExpressionNode _argument1; <br> <font color="#0000ff">private</font> <font color="#0000ff">readonly</font> ExpressionNode _argument2; <br> <br> <font color="#0000ff">protected</font> BinaryOperator(ExpressionNode arg1, ExpressionNode arg2) <br> { <br> _argument1 = arg1; <br> _argument2 = arg2; <br> } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">abstract</font> dynamic EvaluateBinary(dynamic arg1, dynamic arg2); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> dynamic Evaluate() <br> { <br> <font color="#0000ff">return</font> EvaluateBinary(_argument1.Evaluate(), _argument2.Evaluate()); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#2B91AF">IEnumerable</font> &lt;ExpressionNode&gt; GetChildren() <br> { <br> <font color="#0000ff">yield</font> <font color="#0000ff">return</font> _argument1; <br> <font color="#0000ff">yield</font> <font color="#0000ff">return</font> _argument2; <br> } <br> } <br> <br> [Operator( <font color="#A31515">"add"</font> )] <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> Add : BinaryOperator <br> { <br> <font color="#0000ff">public</font> Add( <font color="#0000ff">params</font> ExpressionNode[] args) : <font color="#0000ff">this</font> (args[0], args[1]) { Debug.Assert(args.Length == 2); } <br> <font color="#0000ff">public</font> Add(ExpressionNode arg1, ExpressionNode arg2) : <font color="#0000ff">base</font> (arg1, arg2) { } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">override</font> dynamic EvaluateBinary(dynamic arg1, dynamic arg2) <br> { <br> <font color="#0000ff">return</font> arg1 + arg2; <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  And, finally, the basic aggregation operator and its example, the logical "AND": <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> AgregateOperator : ExpressionNode <br> { <br> <font color="#0000ff">private</font> <font color="#0000ff">readonly</font> ExpressionNode[] _arguments; <br> <br> <font color="#0000ff">protected</font> AgregateOperator( <font color="#0000ff">params</font> ExpressionNode[] args) <br> { <br> _arguments = args; <br> } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">abstract</font> dynamic EvaluateAgregate( <font color="#2B91AF">IEnumerable</font> &lt;dynamic&gt; args); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> dynamic Evaluate() <br> { <br> <font color="#0000ff">return</font> EvaluateAgregate(_arguments.ConvertAll(x =&gt; x.Evaluate())); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#2B91AF">IEnumerable</font> &lt;ExpressionNode&gt; GetChildren() <br> { <br> <font color="#0000ff">return</font> _arguments; <br> } <br> } <br> <br> [Operator( <font color="#A31515">"and"</font> )] <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> And : AgregateOperator <br> { <br> <font color="#0000ff">public</font> And( <font color="#0000ff">params</font> ExpressionNode[] args) : <font color="#0000ff">base</font> (args) { } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">override</font> dynamic EvaluateAgregate( <font color="#2B91AF">IEnumerable</font> &lt;dynamic&gt; args) <br> { <br> <font color="#0000ff">foreach</font> (dynamic arg <font color="#0000ff">in</font> args) <br> { <br> <font color="#0000ff">if</font> (!arg) <br> { <br> <font color="#0000ff">return</font> arg; <br> } <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The whole tree (in the form of a link to a vertex-root) is stored in a wrapper class: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> BooleanExpressionTree <br> { <br> <font color="#0000ff">public</font> BooleanExpressionTree(ExpressionNode root) <br> { <br> Root = root; <br> } <br> <br> <font color="#0000ff">public</font> ExpressionNode Root { <font color="#0000ff">get</font> ; <font color="#0000ff">private</font> <font color="#0000ff">set</font> ; } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">bool</font> EvaluateOnObject(dynamic obj) <br> { <br> <font color="#0000ff">lock</font> ( <font color="#0000ff">this</font> ) <br> { <br> PrepareTree(obj, Root); <br> <font color="#0000ff">return</font> ( <font color="#0000ff">bool</font> )Root.Evaluate(); <br> } <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">void</font> PrepareTree(dynamic obj, ExpressionNode node) <br> { <br> node.HandleObject(obj); <br> <font color="#0000ff">foreach</font> (ExpressionNode child <font color="#0000ff">in</font> node.GetChildren()) <br> { <br> PrepareTree(obj, child); <br> } <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The expressions themselves are stored as XML and are generated in runtime.  Who cares how this happens, you can look at the source - everything is trivial. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Test objects </h1><br>  So, for testing, I prepared several different classes (yes, they are strange, but, believe me, it‚Äôs more interesting with them than with tax returns): <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> Human <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">object</font> Legs { <font color="#0000ff">get</font> { <font color="#0000ff">return</font> <font color="#0000ff">new</font> <font color="#0000ff">object</font> (); } } <br> <font color="#0000ff">public</font> <font color="#0000ff">object</font> Hands { <font color="#0000ff">get</font> { <font color="#0000ff">return</font> <font color="#0000ff">new</font> <font color="#0000ff">object</font> (); } } <br> <font color="#0000ff">public</font> <font color="#0000ff">int</font> LegsCount { <font color="#0000ff">get</font> { <font color="#0000ff">return</font> 2; } } <br> <font color="#0000ff">public</font> <font color="#0000ff">int</font> HandsCount { <font color="#0000ff">get</font> { <font color="#0000ff">return</font> 2; } } <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> Name { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> OldMan : Human <br> { <br> <font color="#0000ff">public</font> <font color="#2B91AF">DateTime</font> BirthDate { <font color="#0000ff">get</font> { <font color="#0000ff">return</font> <font color="#0000ff">new</font> <font color="#2B91AF">DateTime</font> (1933, 1, 1); } } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> Baby : Human <br> { <br> <font color="#0000ff">public</font> <font color="#2B91AF">DateTime</font> BirthDate { <font color="#0000ff">get</font> { <font color="#0000ff">return</font> <font color="#0000ff">new</font> <font color="#2B91AF">DateTime</font> (2009, 1, 1); } } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> Animal <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">int</font> LegsCount { <font color="#0000ff">get</font> { <font color="#0000ff">return</font> 4; } } <br> <font color="#0000ff">public</font> <font color="#0000ff">object</font> Tail { <font color="#0000ff">get</font> { <font color="#0000ff">return</font> <font color="#0000ff">new</font> <font color="#0000ff">object</font> (); } } <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> Name { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> Dog : Animal <br> { <br> <font color="#0000ff">public</font> <font color="#2B91AF">DateTime</font> BirthDate { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Create instances of test objects: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">static</font> <font color="#2B91AF">IEnumerable</font> &lt; <font color="#0000ff">object</font> &gt; PrepareTestObjects() <br> { <br> <font color="#2B91AF">List</font> &lt; <font color="#0000ff">object</font> &gt; objects = <font color="#0000ff">new</font> <font color="#2B91AF">List</font> &lt; <font color="#0000ff">object</font> &gt;(); <br> objects.Add( <font color="#0000ff">new</font> Human { Name = <font color="#A31515">"Some Stranger"</font> }); <br> objects.Add( <font color="#0000ff">new</font> OldMan { Name = <font color="#A31515">"Ivan Petrov"</font> }); <br> objects.Add( <font color="#0000ff">new</font> OldMan { Name = <font color="#A31515">"John Smith"</font> }); <br> objects.Add( <font color="#0000ff">new</font> Baby { Name = <font color="#A31515">"Vasya Pupkin"</font> }); <br> objects.Add( <font color="#0000ff">new</font> Baby { Name = <font color="#A31515">"Bart Simpson"</font> }); <br> objects.Add( <font color="#0000ff">new</font> Dog { Name = <font color="#A31515">"Sharik"</font> , BirthDate = <font color="#0000ff">new</font> <font color="#2B91AF">DateTime</font> (2004, 11, 11) }); <br> objects.Add( <font color="#0000ff">new</font> Dog { Name = <font color="#A31515">"Old Zhuchka"</font> , BirthDate = <font color="#0000ff">new</font> <font color="#2B91AF">DateTime</font> (1900, 11, 11) }); <br> <font color="#0000ff">return</font> objects; <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h1>  Expressions </h1><br>  Examples of expressions used in testing: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">IsHuman: <br> <font color="#0000ff">&lt;</font> <font color="#800000">and</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">has-property</font> <font color="#ff0000">name</font> <font color="#0000ff">="Hands"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">has-property</font> <font color="#ff0000">name</font> <font color="#0000ff">="Legs"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">not</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">has-property</font> <font color="#ff0000">name</font> <font color="#0000ff">="Tail"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">not</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">equals</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">property</font> <font color="#ff0000">name</font> <font color="#0000ff">="HandsCount"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">constant</font> <font color="#ff0000">value</font> <font color="#0000ff">="2"</font> <font color="#ff0000">type</font> <font color="#0000ff">="int"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">equals</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">equals</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">property</font> <font color="#ff0000">name</font> <font color="#0000ff">="LegsCount"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">constant</font> <font color="#ff0000">value</font> <font color="#0000ff">="2"</font> <font color="#ff0000">type</font> <font color="#0000ff">="int"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">equals</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">and</font> <font color="#0000ff">&gt;</font> <br> IsNotAmerican: <br> <font color="#0000ff">&lt;</font> <font color="#800000">and</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">has-property</font> <font color="#ff0000">name</font> <font color="#0000ff">="Name"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">or</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">like</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">property</font> <font color="#ff0000">name</font> <font color="#0000ff">="Name"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">constant</font> <font color="#ff0000">value</font> <font color="#0000ff">="Ivan"</font> <font color="#ff0000">type</font> <font color="#0000ff">="string"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">like</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">like</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">property</font> <font color="#ff0000">name</font> <font color="#0000ff">="Name"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">constant</font> <font color="#ff0000">value</font> <font color="#0000ff">="Vasya"</font> <font color="#ff0000">type</font> <font color="#0000ff">="string"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">like</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">or</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">and</font> <font color="#0000ff">&gt;</font> <br> IsOld: <br> <font color="#0000ff">&lt;</font> <font color="#800000">and</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">has-property</font> <font color="#ff0000">name</font> <font color="#0000ff">="BirthDate"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">gt</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">sub</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">constant</font> <font color="#ff0000">value</font> <font color="#0000ff">="2009-12-23"</font> <font color="#ff0000">type</font> <font color="#0000ff">="datetime"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">property</font> <font color="#ff0000">name</font> <font color="#0000ff">="BirthDate"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">sub</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">constant</font> <font color="#ff0000">value</font> <font color="#0000ff">="22000.00:00:00"</font> <font color="#ff0000">type</font> <font color="#0000ff">="timespan"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">gt</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">and</font> <font color="#0000ff">&gt;</font> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  I think it is clear from the appearance of XML that they check these expressions (they are purposely primitive, like the objects themselves, so as not to bore readers with unnecessary complexity).  Here is how these expressions classify the generated objects: <br><blockquote>  <b>Test Is Human:</b> <br>  Some Stranger - True <br>  Ivan Petrov - True <br>  John Smith - True <br>  Vasya Pupkin - True <br>  Bart Simpson - True <br>  Sharik - False <br>  Old Zhuchka - False <br>  <b>Test Is Old:</b> <br>  Some Stranger - False <br>  Ivan Petrov - True <br>  John Smith - True <br>  Vasya Pupkin - False <br>  Bart Simpson - False <br>  Sharik - False <br>  Old Zhuchka - True <br>  <b>Test Is Not American:</b> <br>  Some Stranger - False <br>  Ivan Petrov - True <br>  John Smith - False <br>  Vasya Pupkin - True <br>  Bart Simpson - False <br>  Sharik - False <br>  Old Zhuchka - False <br></blockquote><br><br><h1>  findings </h1><br>  The speakers introduced to C # completely new features that allow you to quickly, using minimal code, to implement a number of non-trivial tasks, such as the computation of dynamic expressions.  This feature often has to be paid for with performance, but sometimes it should be ignored, in return for a compact, well-readable code that is easy to debug and maintain.  Of course, in this case, you can do with standard means of reflection, apply code generation or even use another, possibly initially dynamic language (the same Python), but, IMHO, the use of speakers in this case is the simplest and most beautiful solution. <br>  Download the code <a href="">here</a> (60 Kb). <br> <a href="http://progg.ru/%25D0%2592%25D1%258B%25D1%2587%25D0%25B8%25D1%2581%25D0%25BB%25D1%258F%25D0%25B5%25D0%25BC-%25D0%25B4%25D0%25B8%25D0%25BD%25D0%25B0%25D0%25BC%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B5-%25D0%25B2%25D1%258B%25D1%2580%25D0%25B0%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F-%25D0%25BD%25D0%25B0-C-40-%25D1%2581-%25D0%25BF%25D0%25BE%25D0%25BC%25D0%25BE%25D1%2589%25D1%258C%25D1%258E-dynamic-NET-%25D0%25A5%25D0%25B0%25D0%25B1%25D1%2580%25D0%25B0%25D1%2585%25D0%25B0%25D0%25B1%25D1%2580"><img alt="Progg it" src="http://progg.ru/image.axd?url=http%3A%2F%2Fhabrahabr.ru%2Fblogs%2Fnet%2F79258%2F"></a> <br><br></div><p>Source: <a href="https://habr.com/ru/post/79258/">https://habr.com/ru/post/79258/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../79253/index.html">The true face of the QWERTY internet provider</a></li>
<li><a href="../79254/index.html">Programming passion</a></li>
<li><a href="../79255/index.html">The most notable films of 2009</a></li>
<li><a href="../79256/index.html">Opera 10.50 and CSS hacks</a></li>
<li><a href="../79257/index.html">OpenGL vs. Direct3D Comparison</a></li>
<li><a href="../79260/index.html">Why I love programming</a></li>
<li><a href="../79262/index.html">data: URI and performance, or how to slow down Firefox 10 (ten) times</a></li>
<li><a href="../79263/index.html">Online Hunting (2)</a></li>
<li><a href="../79265/index.html">ReSharper 5 beta released</a></li>
<li><a href="../79266/index.html">Workshop API Yandex.Maps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>