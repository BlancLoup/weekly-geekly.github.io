<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We log context of exceptions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the eve of the Day of the programmer and in the footsteps of the Day of the tester, I want to talk about how to simplify the lives of both of them ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We log context of exceptions</h1><div class="post__text post__text-html js-mediator-article">  On the eve of the <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D0%25BD%25D1%258C_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2581%25D1%2582%25D0%25B0">Day of the programmer</a> and in the footsteps of the <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D0%25BD%25D1%258C_%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D1%2589%25D0%25B8%25D0%25BA%25D0%25B0">Day of the tester,</a> I want to talk about how to simplify the lives of both of them in their common cause - software development and debugging. <br>  Namely, I‚Äôll talk about how to make C ++ exceptions more informative, and error logging more compact. <br><a name="habracut"></a><br>  After a year and a half of working with Java, I‚Äôm used to exceptions that contain StackTrace like <br><blockquote><pre> Exception in thread "main" java.lang.IllegalStateException: A book has a null property
         at com.example.myproject.Author.getBookIds (Author.java:38)
         at com.example.myproject.Bootstrap.main (Bootstrap.java:14)
 Caused by: java.lang.NullPointerException
         at com.example.myproject.Book.getId (Book.java:22)
         at com.example.myproject.Author.getBookIds (Author.java:35)
         ... 1 more
</pre></blockquote><br>  Switching to C ++, I was struck after a while by the uninformativeness of exceptions in terms of identifying the causes of the error and further debugging.  It was necessary to log the passage of all the important points of the program, so that according to the logs it was clear exactly where something went wrong and led to the exception. <br>  Next, I present a simplified evolution of logging through which I went through myself. <br><div class="spoiler">  <b class="spoiler_title">The source program, which we will debug and improve</b> <div class="spoiler_text"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> runtime_error(<span class="hljs-string"><span class="hljs-string">"foo throw because zero argument"</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a)</span></span></span><span class="hljs-function"> </span></span>{ foo(a - <span class="hljs-number"><span class="hljs-number">10</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; i++) { bar(i); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> exception &amp;e) { <span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Caught exception: "</span></span> &lt;&lt; e.what() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br></div></div><br>  In this form, without knowing anything about the call path <b>foo</b> and the function <b>bar, it is</b> very difficult to understand what to do with the received exception. <br><blockquote>  Caught exception: throw away </blockquote><br><div class="spoiler">  <b class="spoiler_title">Add a little logs</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Calling foo("</span></span> &lt;&lt; a - <span class="hljs-number"><span class="hljs-number">10</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">")"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; foo(a - <span class="hljs-number"><span class="hljs-number">10</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; i++) { <span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Calling bar("</span></span> &lt;&lt; i &lt;&lt; <span class="hljs-string"><span class="hljs-string">")"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; bar(i); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> exception &amp;e) { <span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Caught exception: "</span></span> &lt;&lt; e.what() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Result of performance:</b> <div class="spoiler_text"><blockquote>  Calling bar (0) <br>  Calling foo (-10) <br>  Calling bar (1) <br>  Calling foo (-9) <br>  Calling bar (2) <br>  Calling foo (-8) <br>  Calling bar (3) <br>  Calling foo (-7) <br>  Calling bar (4) <br>  Calling foo (-6) <br>  Calling bar (5) <br>  Calling foo (-5) <br>  Calling bar (6) <br>  Calling foo (-4) <br>  Calling bar (7) <br>  Calling foo (-3) <br>  Calling bar (8) <br>  Calling foo (-2) <br>  Calling bar (9) <br>  Calling foo (-1) <br>  Calling bar (10) <br>  Calling foo (0) <br>  Caught exception: throw away <br></blockquote></div></div><br>  Now it is clear what happened, but the log turned out to be too cluttered.  But let's imagine a nightmare into which it will turn into, if the program has to process all the files in the directory, each file has 5 lines of log and an exception occurred after 1000 files.  Total - 5000 lines of the log about how everything is fine, and 10 lines of the error log. <br>  During the reading of this log, the curses of fellow developers and testers, who read my log instead of a holiday and write a bug report, will drive my karma to minus infinity. <br>  That means you have to log only the ‚Äúerroneous‚Äù branches of execution. <br>  It is obvious that at the time of the function call it is unknown it will end normally or throw an exception.  This means that the recording in the log will have to be postponed until exiting the function and analyzing the program execution progress. <br><div class="spoiler">  <b class="spoiler_title">Like so</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { foo(a - <span class="hljs-number"><span class="hljs-number">10</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> exception &amp;e) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> msg = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-string"><span class="hljs-string">"calling foo("</span></span>) + to_string(a - <span class="hljs-number"><span class="hljs-number">10</span></span>) + <span class="hljs-string"><span class="hljs-string">") failed"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> runtime_error(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(e.what()) + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + msg); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; i++) { bar(i); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> exception &amp;e) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> msg = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-string"><span class="hljs-string">"calling bar("</span></span>) + to_string(i) + <span class="hljs-string"><span class="hljs-string">") failed"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> runtime_error(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(e.what()) + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + msg); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> exception &amp;e) { <span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Caught exception: "</span></span> &lt;&lt; e.what() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br><blockquote>  Caught exception: throw away <br>  calling foo (0) failed <br>  calling bar (10) failed <br></blockquote></div></div><br>  Now testers can easily write a bug report and attach a beautiful, informative and clean log to it.  But the program has become ugly and has lost all the beauty of exceptions - the ability to spread the working code and error handling.  In fact, we returned almost to checking the return codes of the function and the cruel times of pure C. And I want a beautiful solution that allows you to use to create a clean log and not to disfigure the program.  Those.  Someone must analyze and secure what is happening for us when leaving the function.  Here we come to the aid of the approach <a href="http://habrahabr.ru/post/148781/">already described</a> on Habr√©, namely, the recording of logs when calling the destructor. <br><br>  So the requirements for the logging class: <br><ol><li>  Set message for log </li><li>  Message output, only in case of exception. </li></ol><br>  This is where the <b>bool uncaught_exception ()</b> function comes in, which says whether there is an unhandled exception. <br><div class="spoiler">  <b class="spoiler_title">ExceptionContext class</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExceptionContext</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ExceptionContext(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;msg); ~ExceptionContext(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> message; }; ExceptionContext::ExceptionContext(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;msg): message(msg) {} ExceptionContext::~ExceptionContext() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::uncaught_exception()) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; message &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Usage example</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">ExceptionContext </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"calling foo("</span></span></span></span><span class="hljs-function"><span class="hljs-params">) + to_string(a - </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">) + </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">")"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; foo(a - <span class="hljs-number"><span class="hljs-number">10</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; i++) { <span class="hljs-function"><span class="hljs-function">ExceptionContext </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"calling bar("</span></span></span></span><span class="hljs-function"><span class="hljs-params">) + to_string(i) + </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">")"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; bar(i); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> exception &amp;e) { <span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Caught exception: "</span></span> &lt;&lt; e.what() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>;http:<span class="hljs-comment"><span class="hljs-comment">//habrahabr.ru/topic/edit/266729/# } return 0; }</span></span></code> </pre><br><blockquote>  calling foo (0) <br>  calling bar (10) <br>  Caught exception: throw away </blockquote></div></div><br>  It can be seen that this option combines the compactness of the log (we log only the fallen branch of execution) with the compactness of the program (the main code and exception handling are spaced out, logging is inserted into the main code in one line).  Now both the developers and testers have stopped cursing me. <br>  In fact, the main goal has already been achieved, but one can take the path of many further improvements, including those described at the end of the <a href="http://habrahabr.ru/post/148781/">post</a> already mentioned. <br>  I will consider only two points: <br><ol><li>  Interaction with other loggers </li><li>  Thread safety </li></ol><br>  Printing the log directly to <b>cerr</b> can be inconvenient <b>because</b> it is impossible to get the accumulated context with such difficulty to duplicate it somewhere else (yes, at least to the developer‚Äôs mail, since we have significantly reduced its volume!).  Again, if there are other logging tools or multi-threaded execution, there may be unpleasant special effects like mixed log lines.  Therefore, now the <b>ExceptionContext</b> class will be stored inside the logs, and issued outside on demand, in the manner <a href="http://www.tutorialspoint.com/java/lang/throwable_printstacktrace.htm">printStackTrace</a> from Java. <br><br><div class="spoiler">  <b class="spoiler_title">Thread safe option (using C ++ 11)</b> <div class="spoiler_text"><pre> <code class="hljs ruby"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExceptionContext</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">public</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExceptionContext</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std::string</span></span></span><span class="hljs-class"> &amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">);</span></span> ~ExceptionContext(); static void Print(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>!    cerr   . <span class="hljs-symbol"><span class="hljs-symbol">private:</span></span> std::string message; static thread_local std::string global_context; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>!      . }; ExceptionContext::ExceptionContext(const std::string &amp;msg): message(msg) {} ExceptionContext::~ExceptionContext() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (std::uncaught_exception()) { global_context += message + std::string(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); } } void ExceptionContext::Print() { std::cerr &lt;&lt; global_context &lt;&lt; std::endl; global_context.clear(); } thread_local std::string ExceptionContext::global_context = std::string(<span class="hljs-string"><span class="hljs-string">""</span></span>);</code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And the catch block in the main program now looks like this: <br><pre> <code class="hljs cpp"> <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> exception &amp;e) { <span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Caught exception: "</span></span> &lt;&lt; e.what() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; ExceptionContext::Print(); }</code> </pre><br></div></div><br>  From C ++ 11, the <b>thread_local</b> modifier is used here, which guarantees that in each execution thread the <b>global_context</b> object will have its own, despite the fact that it is a static member of the class and must be the same for all instances. <br><br>  Have a good weekend, clean code, readable logs and other successes in work! </div><p>Source: <a href="https://habr.com/ru/post/266729/">https://habr.com/ru/post/266729/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266715/index.html">Borrowing and time in Rust</a></li>
<li><a href="../266717/index.html">Study: Almost all popular firewalls miss XSS attacks</a></li>
<li><a href="../266719/index.html">Screentendo - Generate levels for Super Mario Bros based on screen content.</a></li>
<li><a href="../266721/index.html">Z-Desk - geometric constructions in space</a></li>
<li><a href="../266727/index.html">About a Data Science Problem</a></li>
<li><a href="../266731/index.html">Run a mega-manual from Stackoverflow</a></li>
<li><a href="../266733/index.html">Why SMS is limited to 160 characters, and Twitter messages - 140 characters?</a></li>
<li><a href="../266735/index.html">Snaql. Raw SQL in Python projects</a></li>
<li><a href="../266743/index.html">Python 3.5; async / await</a></li>
<li><a href="../266745/index.html">Vim-like control with xmodmap</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>