<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We consider brackets on Oracle SQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started with the fact that on the codeforces.ru site in the next Codeforces Round I saw an interesting puzzle ‚ÄúBracket sequence‚Äù and didn‚Äôt wan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We consider brackets on Oracle SQL</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/12e/97a/708/12e97a7083d1642ec18c49e37a1d5459.png"><br>  It all started with the fact that on the <a href="http://codeforces.ru/">codeforces.ru</a> site in the next Codeforces Round I saw an interesting puzzle <a href="http://codeforces.ru/contest/223/problem/A">‚ÄúBracket sequence‚Äù</a> and didn‚Äôt want to solve it in an ‚Äúuninteresting way‚Äù. <br><br>  Briefly, the conditions of the problem are reduced to finding in the line consisting only of the characters "(", ")", "[" and "]", the correct bracket sequence containing as many as possible brackets "[". <br><br><a name="habracut"></a><br>  To begin with, we turn our flat line into a more convenient hierarchical representation: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> brackets <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-string"><span class="hljs-string">'[[)]([][][][[()[()[()()]]]])]'</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>(b,<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) q, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> curr_pos, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span> prev_pos <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> brackets <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>(b,<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span></code> </pre> <br>  Each line will contain the next bracket, the position of the current bracket and the position of the previous bracket.  With this you can already do something. <br><br>  It remains to find all the correct bracket sequences.  This is where the fun begins. <br>  Since to determine the correctness of the expression we do not have a stack in which you can store parentheses, we had to go to the ‚Äútrick‚Äù. <br><br>  Let us find all possible sequences starting with ‚Äú(‚Äù or ‚Äú[‚Äù (the rest are incorrect by default). For each such sequence, we define the position of the first and last brackets and the ‚Äúnesting level‚Äù of the last bracket, ie: <br><pre> "(" "1st - level"
      "(" "2nd - level"
       .. ... .. .. 
       "]" "2nd - level"
 .. ... .. ...
</pre><br><ul><li>  The level increases if: the bracket opens, but there is nothing before it, or there was any opening; </li><li>  The level does not change if the bracket is opened, and before it was closed, or if the bracket is closed, and before it was opened; </li><li>  The level decreases if the bracket is closed, and before it was closed; </li></ul><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> brackets <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-string"><span class="hljs-string">'[[)]([][][][[()[()[()()]]]])]'</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual) , all_brackets <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>(b,<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) q, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> curr_pos, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> prev_pos <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> brackets <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>(b,<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span>(sys_connect_by_path(q,<span class="hljs-string"><span class="hljs-string">'-'</span></span>), <span class="hljs-string"><span class="hljs-string">'-'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, q, <span class="hljs-keyword"><span class="hljs-keyword">connect_by_root</span></span>(curr_pos) start_pos, curr_pos end_pos, <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">']'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">')'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">']'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">']'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">']'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connect_by_root</span></span>(curr_pos) <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connect_by_root</span></span>(curr_pos), curr_pos) bracket_level <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> all_brackets <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> curr_pos = prev_pos <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span></code> </pre><br>  Using this data, we can determine the ‚Äúpest‚Äù bracket that makes the correct sequence wrong.  To do this, we look through all the received sequences, and when the next bracket ‚Äúappears‚Äù, we will find the previous bracket, which is on the same level with the current one (Thanks to Oracle for the analytical function lag).  An incorrect sequence is obtained if one of the following situations occurs on one of the levels: <br><ul><li>  closed bracket is closed </li><li>  the parenthesis closes the square </li><li>  square bracket covers the round </li></ul><br>  Any opening parenthesis at this iteration cannot break the sequence. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> brackets <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-string"><span class="hljs-string">'[[)]([][][][[()[()[()()]]]])]'</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual) , all_brackets <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>(b,<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) q, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> curr_pos, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span> prev_pos <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> brackets <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>(b,<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>), brackets_comb <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span>(sys_connect_by_path(q,<span class="hljs-string"><span class="hljs-string">'-'</span></span>), <span class="hljs-string"><span class="hljs-string">'-'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, q, <span class="hljs-keyword"><span class="hljs-keyword">connect_by_root</span></span>(curr_pos) start_pos, curr_pos end_pos, <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">']'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">')'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">']'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">']'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">']'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connect_by_root</span></span>(curr_pos) <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connect_by_root</span></span>(curr_pos), curr_pos) bracket_level <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> all_brackets <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> curr_pos = prev_pos <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> start_pos, end_pos, <span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> q = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> lag(q) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level, end_pos) = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> lag(q) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level, end_pos) = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> lag(q) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level, end_pos) = <span class="hljs-string"><span class="hljs-string">']'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> q = <span class="hljs-string"><span class="hljs-string">']'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> lag(q) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level, end_pos) = <span class="hljs-string"><span class="hljs-string">'['</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> lag(q) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level, end_pos) = <span class="hljs-string"><span class="hljs-string">']'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> lag(q) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level, end_pos) = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> lag(q) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level, end_pos) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> bracket_level &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">'not ok!'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> brackets_comb bc</code> </pre><br>  Thus, for each set of sequences starting from one position (start_pos) and ordered by the number of parentheses, we found the first incorrect sequence. <br>  In each such set of sequences, we ‚Äúdiscard‚Äù the sequence after the ‚Äúwrong‚Äù one, and for all the remaining ones we check that the opened parentheses are closed (for this it is enough to count the number of opened and closed brackets of each type). <br>  As a result, it remains to find the one, or maybe not the only, <i><b>her</b></i> (no, not the girl of your dreams, as you might think), the bracket sequence with the maximum number ‚Äú[‚Äù. <br><br>  All request: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> brackets <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-string"><span class="hljs-string">'[[]])[([[]][[(]])]'</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual) , all_brackets <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>(b,<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) q, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> curr_pos, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span> prev_pos <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> brackets <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>(b,<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>), brackets_comb <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span>(sys_connect_by_path(q,<span class="hljs-string"><span class="hljs-string">'-'</span></span>), <span class="hljs-string"><span class="hljs-string">'-'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, q, <span class="hljs-keyword"><span class="hljs-keyword">connect_by_root</span></span>(curr_pos) start_pos, curr_pos end_pos, <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">']'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">')'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">']'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (q = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">']'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> q = <span class="hljs-string"><span class="hljs-string">']'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connect_by_root</span></span>(curr_pos) <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connect_by_root</span></span>(curr_pos), curr_pos) bracket_level <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> all_brackets <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> curr_pos = prev_pos <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span>), brackets_comb_status <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> start_pos, end_pos, <span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> q = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> lag(q) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level, end_pos) = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> lag(q) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level, end_pos) = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> q = <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> lag(q) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level, end_pos ) = <span class="hljs-string"><span class="hljs-string">']'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> q = <span class="hljs-string"><span class="hljs-string">']'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> lag(q) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level, end_pos) = <span class="hljs-string"><span class="hljs-string">'['</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> lag(q) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level, end_pos) = <span class="hljs-string"><span class="hljs-string">']'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> q = <span class="hljs-string"><span class="hljs-string">'['</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> lag(q) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level, end_pos) = <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> lag(q) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, bracket_level, end_pos) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> bracket_level &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">'not ok!'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> brackets_comb bc) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">str</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>, cnt <span class="hljs-string"><span class="hljs-string">" ["</span></span>, start_pos <span class="hljs-string"><span class="hljs-string">" "</span></span>, end_pos <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, start_pos, end_pos, <span class="hljs-keyword"><span class="hljs-keyword">length</span></span>(regexp_replace(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>,<span class="hljs-string"><span class="hljs-string">'[\)\(]'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>))/<span class="hljs-number"><span class="hljs-number">2</span></span> cnt, <span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">length</span></span>(regexp_replace(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>,<span class="hljs-string"><span class="hljs-string">'[\)\(]'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>))/<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>) best_cnt <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, start_pos, end_pos, nvl( lag( <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> = <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ignore</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nulls</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> start_pos, end_pos), <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> brackets_comb_status ) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> = <span class="hljs-string"><span class="hljs-string">'ok'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">length</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">replace</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>,<span class="hljs-string"><span class="hljs-string">'['</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>)) = <span class="hljs-keyword"><span class="hljs-keyword">length</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">replace</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>,<span class="hljs-string"><span class="hljs-string">']'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">length</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">replace</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>,<span class="hljs-string"><span class="hljs-string">'('</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>)) = <span class="hljs-keyword"><span class="hljs-keyword">length</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">replace</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>,<span class="hljs-string"><span class="hljs-string">')'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>)) ) <span class="hljs-keyword"><span class="hljs-keyword">result</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> best_cnt = cnt</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/151895/">https://habr.com/ru/post/151895/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../151887/index.html">Variable Numeric Objects</a></li>
<li><a href="../151890/index.html">Neurobiology and artificial intelligence: part two - intelligence and presentation of information in the brain</a></li>
<li><a href="../151891/index.html">Dangerous 0-day vulnerability in iOS 5.1.1 and 6</a></li>
<li><a href="../151892/index.html">Disturbing bells: when your disk is better to carry to repair</a></li>
<li><a href="../151894/index.html">Apple stole "clock" in iOS 6 from the Swiss railways</a></li>
<li><a href="../151897/index.html">CUDA: block synchronization</a></li>
<li><a href="../151898/index.html">A look at the Modern (Metro) Windows interface (Phone / RT) 8</a></li>
<li><a href="../151899/index.html">Lumia can be taken from Nokia to try - for two weeks</a></li>
<li><a href="../151902/index.html">Red pill does not exist</a></li>
<li><a href="../151903/index.html">Worldwide IP Surveillance Industry Leader Supported Ivideon</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>