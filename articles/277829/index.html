<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The movement of the robot to a point with given coordinates</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Welcome, dear habravchane! 
 Our research team, which is called the Student Design Bureau of the ITMO University ICS Department, continues to develop ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The movement of the robot to a point with given coordinates</h1><div class="post__text post__text-html js-mediator-article">  Welcome, dear habravchane! <br>  Our research team, which is called the Student Design Bureau of the ITMO University ICS Department, continues to develop courses in robotics, and wants to share one of the latest projects on Lego NXT. <br><br>  Previously, we published the course <a href="https://habrahabr.ru/post/220045/">‚ÄúPractical Robotics‚Äù</a> on the NXT.  Now this course is used to teach students in the department and on the <a href="https://openedu.ru/course/ITMOUniversity/ROBCTR/">‚ÄúOpen Education‚Äù</a> platform.  Fragments of this course were also published with a detailed description of actions for <a href="https://habrahabr.ru/post/178103/">identifying an engine model</a> and <a href="https://habrahabr.ru/post/193272/">calculating a controller for a Segway robot</a> . <br>  This time it was decided to implement a detour detour by a robot with a differential drive.  The design of the robot is quite simple: two wheels with engines, a gyroscope and a pair of ultrasonic sensors.  To estimate the distance traveled, encoders on the motor shaft are used, for orientation of the robot, its angular velocity is measured by a gyroscope and the angle of rotation is calculated, and the distance to the obstacle is measured by ultrasonic range finders. <br><img src="https://habrastorage.org/files/b8b/5f5/952/b8b5f5952883487a82c395b61ceda2e2.jpg"><br><a name="habracut"></a><br>  It should be noted that the figure indicates <img src="https://habrastorage.org/getpro/habr/post_images/265/f8f/1b8/265f8f1b8f8cbc8ce37c14a9eea506a7.png">  - distance to the target point; <img src="https://habrastorage.org/getpro/habr/post_images/ef4/7a9/1ae/ef47a91aebbca10c36a8119d22294198.png">  - azimuth, the angle between the axis OX and the direction to the target; <img src="https://habrastorage.org/getpro/habr/post_images/4b2/6a8/3a0/4b26a83a09534554a9e418b264ab59e2.png">  - the course of the robot; <img src="https://habrastorage.org/getpro/habr/post_images/55f/4c8/864/55f4c886486edcbd0e9d0f67e9e7341d.png">  - heading angle, the difference between the course and azimuth;  v is the linear velocity of the robot.  The robot moves due to the movement of two separately driven wheels.  And such a kinematic scheme has a certain mathematical description: <br><img src="https://habrastorage.org/getpro/habr/post_images/065/76d/029/06576d02945d92cfb51d6469f09dfb07.png"><br>  Where <img src="https://habrastorage.org/getpro/habr/post_images/7ee/410/b73/7ee410b73b9ba5c694124b7ef5ead891.png">  - the corresponding angular velocity of rotation of the wheels, x, y - the corresponding coordinates, R - the radius of the wheel, B - the distance between the wheels. <br><br>  In principle, moving to a point with given coordinates can be solved using a P-controller, but in practice this will not be enough.  Although everything works just fine in the model below: <br><img src="https://habrastorage.org/files/bbe/8d6/f8b/bbe8d6f8b58345ac86fa3128bcb579ee.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The task is set as follows: the robot must reach the given coordinates <img src="https://habrastorage.org/getpro/habr/post_images/449/dfa/27f/449dfa27fab661c5d0ed44ef5908e430.png">  . <br>  When solving the problems of mobile robots navigation, two main approaches are used. <br><ul><li>  Global - determination of the absolute coordinates of the device when driving on long routes.  The trajectory is chosen before the start of the movement based on the information received. </li><li>  Local - determination of device coordinates in relation to a certain (usually starting) point.  Planning sets only a small segment of the trajectory, at the end point of which a further trajectory is chosen. </li></ul><br>  There are many local navigation methods, such as: <br><ul><li>  histogram of the vector field <a href="http://eewebt.technion.ac.il/LABS1/control/info/Projects/Students/2011/Nir%2520Malka/Book/Experiment%2520Library/VFH%2520article%2520-%2520%2520reading%2520material%2520for%2520Doch%2520Mechin.pdf">Borenstein &amp; Koren 1991</a> ; </li><li>  <a href="http://ijr.sagepub.com/content/5/1/90.full.pdf%2Bhtml">Khatib</a> potential field <a href="http://ijr.sagepub.com/content/5/1/90.full.pdf%2Bhtml">, 1986</a> ;  <a href="https://www.researchgate.net/profile/Matteo_Rubagotti/publication/224262155_Time-optimal_sliding-mode_control_of_a_mobile_robot_in_a_dynamic_environment/links/0a85e5375d317bc2cd000000.pdf">Rubagotti, Vedova, &amp; Ferrara, 2011</a> ; </li><li>  diagram of close distances <a href="https://www.researchgate.net/profile/Javier_Minguez/publication/3299419_Nearness_Diagram_%2528ND%2529_Navigation_Collision_Avoidance_in_Troublesome_Scenarios/links/0c96052bffd05e4de7000000.pdf">Minguez &amp; Montano, 2004</a> ; </li><li>  tangential avoidance <a href="http://www.scielo.br/scielo.php%3Fpid%3DS0103-17592008000400003%26script%3Dsci_arttext">Ferreira, Pereira, Vassallo, Filho and Filho, 2008</a> . </li></ul><br>  Let us dwell on the latter method.  Having searched the network for information on how to control such a robot, one can find <a href="http://www.sciencedirect.com/science/article/pii/S0005109815000655">an article by</a> A. Matveyeva, professor at the Department of Theoretical Cybernetics, St. Petersburg State University.  and prof. Savkin A.V.  from the University of New South Wales, Sydney, Australia about the robot navigation algorithm among moving and deformable obstacles.  In the article, the authors argue that the most appropriate method for solving our problem is, in fact, the method of tangential avoidance, described by Mario Sarcinelli, professor of the Federal University of Espirintu-Santo, Vitoria, Brazil, whom we had the honor of meeting <a href="http://www.ifmo.ru/ru/viewnews/5320/studenty_brazilskih_vuzov_i_universiteta_itmo_budut_uchitsya_robototehnike_drug_u_druga.htm">our team in Brazil</a> . <br><br>  To begin, let us describe the mathematical model describing the robot's navigation to the target, in polar coordinates: <br><img src="https://habrastorage.org/getpro/habr/post_images/eaa/768/65b/eaa76865bc85a3ad96b9742409a3a9db.png"><br><br>  In fact, the robot can be fully controlled using angular and linear velocity values. <img src="https://habrastorage.org/getpro/habr/post_images/5f0/447/f87/5f0447f874049a5d6bbf3329a9f62e0b.png">  therefore it is necessary to find such values ‚Äã‚Äãso that the condition of the task is satisfied. <img src="https://habrastorage.org/getpro/habr/post_images/449/dfa/27f/449dfa27fab661c5d0ed44ef5908e430.png">  .  For this, the article proposes to use the apparatus of the Lyapunov function.  This will be a quadratic function that includes the distance to the target and the course angle: <br><img src="https://habrastorage.org/getpro/habr/post_images/4a4/a1f/a7f/4a4a1fa7f4684dd082fae061d2a454c4.png"><br><br>  The time derivative should not be positive so that the distance to the target and the course angle do not increase.  The derivative is as follows: <br><img src="https://habrastorage.org/getpro/habr/post_images/7e1/d33/5e7/7e1d335e7bb966f5db370fc37acf8db0.png"><br><br>  Expressing the derivative through the mathematical model proposed above, we obtain: <br><img src="https://habrastorage.org/getpro/habr/post_images/d95/3ed/4da/d953ed4dac021ed28bc0681d6cf188f0.png"><br><br>  This derivative is negatively determined if we choose the following velocity values ‚Äã‚Äãas the control action: <br><img src="https://habrastorage.org/getpro/habr/post_images/54a/fd9/b5c/54afd9b5c6188ef3fa24d3f8389e0f5e.png"><br><br>  All this will allow the robot to achieve its goal, but so far only in the absence of obstacles.  To avoid obstacles, it is necessary to amend the calculation of the course angle: <br><img src="https://habrastorage.org/getpro/habr/post_images/813/579/42d/81357942d964788c21cc2e945c260287.png"><br>  Where <img src="https://habrastorage.org/getpro/habr/post_images/c5f/c10/204/c5fc102046c1f57f513c78dca755fa7e.png">  - the ratio of the proportional component of the course angle, <img src="https://habrastorage.org/getpro/habr/post_images/05b/2c9/67b/05b2c967b10dab3800e95655e15e1a2a.png">  - distance to the obstacle <img src="https://habrastorage.org/getpro/habr/post_images/d42/07e/59a/d4207e59a94cbc12f772d80bbaf4289f.png">  - the minimum distance to the obstacle. <br><br>  With the help of the above method, the movement from point to point with a detour of obstacles was realized.  The results are shown in the video, the error is due to wheel slip. <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Wpk0HBXIJpQ%3Ffeature%3Doembed&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh15W2oRtV_0X9xsVkHcQRVVNf2yQ" frameborder="0" allowfullscreen=""></iframe><br>  We also added an integral component for calculating the linear velocity to compensate for the friction of the motors.  In the video below you can see that the robot quite accurately reaches the target in the vicinity of 3 centimeters. <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/MLOJLobqQgo%3Ffeature%3Doembed&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhy69OJutod84xs7JLXO4LJL2SesQ" frameborder="0" allowfullscreen=""></iframe><br>  The following is an example of a final program in the NXC c-like language: <br><div class="spoiler">  <b class="spoiler_title">Program code</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RAD_WHEEL 0.028 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   #define DEG2RAD PI / 180 #define LEFT OUT_C #define RIGHT OUT_B #define GYRO S1 #define LIMIT 20 //     #define K_I 50 //      #define K_P 0.1 //      #define ERROR 0.03 //     task main() { int rotA, rotB, //   pwmLeft, pwmRight, //    distS3, distS2, distMax, kDist, //     currentTime, previousTime, dt, //  gyroSpeed, gyroOffset, //        fileSize = 30640; float course, courseAngle, bearing, //  (psi),   (alpha),  (theta) xCoord, yCoord, //     delthaX, delthaY, //  length, intLength, //   ,   path, prevPath, delthaPath, //      xRef = -1, yRef = 0, //    baseSpeed = 0, control = 0, //     k = 20; string s; //     byte handle; //   SetSensorLowspeed(S2); SetSensorHTGyro(GYRO); //     ,  DeleteFile("data.txt"); CreateFile("data.txt", fileSize, handle); Wait(50); //  ,   (/) gyroOffset = SensorHTGyro(GYRO); course = 0; previousTime = CurrentTick(); while (true) { //      distS3 = LIMIT - SensorUS(S3); distS2 = LIMIT - SensorUS(S2); //    (   ,    ) if (distS3 &lt; 0 ) distS3 = 0; if (distS2 &lt; 0 ) distS2 = 0; if (distS2 &gt; distS3) distMax = distS2; else distMax = distS3; kDist = sign(distS2 - distS3); currentTime = CurrentTick(); dt = currentTime - previousTime; previousTime = currentTime; //    (/) gyroSpeed = SensorHTGyro(GYRO) - gyroOffset; //   course = course + gyroSpeed * PI * dt / 1000.0 / 180.0; //      rotA = MotorRotationCount(LEFT); rotB = MotorRotationCount(RIGHT); //       path = (rotA + rotB) * DEG2RAD * RAD_WHEEL / 2; //       delthaPath = path - prevPath; //      prevPath = path; //   X xCoord = xCoord + delthaPath * cos(course); //   Y yCoord = yCoord + delthaPath * sin(course); //    X delthaX = xRef - xCoord; //    Y delthaY = yRef - yCoord; //   bearing = atan2(delthaY, delthaX); //    courseAngle = bearing - course - K_P * kDist * distMax; //     if (abs(courseAngle) &gt; PI) courseAngle = courseAngle - sign(courseAngle) * 2 * PI; //     length = sqrt (delthaY * delthaY + delthaX * delthaX); intLength = intLength + length * dt / 1000; if (intLength &gt; 10) intLength = 10; //    baseSpeed = 100 * tanh (length) * cos (courseAngle) + K_I * intLength; if (abs(baseSpeed) &gt; 40) baseSpeed = sign (baseSpeed) * 40; //    control = k * courseAngle + sin(courseAngle) * baseSpeed / length; //    if (abs(control) &gt; 30) control = sign(control)*30; //    float  integer,    pwmLeft = baseSpeed + control; //    float  integer,    pwmRight = baseSpeed - control; if (abs(pwmLeft) &gt; 100) pwmLeft = sign (pwmLeft) * 100; if (abs(pwmRight) &gt; 100) pwmLeft = sign (pwmRight) * 100; //   OnFwd(LEFT, pwmLeft); OnFwd(RIGHT, pwmRight); ClearScreen(); //     NXT NumOut(0, 8, distS3); NumOut(0, 0, distS2); //     s = NumToStr(xCoord) + " " + NumToStr(yCoord) + " " + NumToStr(bearing) + " " + NumToStr(course); //    WriteLnString(handle, s, fileSize); //      if(abs(length) &lt; ERROR) { Off(OUT_BC); break; } Wait(5); } }</span></span></span></span></code> </pre> <br></div></div><br>  This task is included in the discipline of robotics for the first and second year of our department, which in addition to it includes a segway, an inverted pendulum on a trolley, a Kapitsa pendulum, and a three-stage manipulator.  As you can see, even with such simple equipment it is quite possible to disassemble serious robotic tasks. </div><p>Source: <a href="https://habr.com/ru/post/277829/">https://habr.com/ru/post/277829/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277819/index.html">How does Google Search work?</a></li>
<li><a href="../277821/index.html">How Dodo Pizza Delivers Pizza Using Microsoft Azure Cloud</a></li>
<li><a href="../277823/index.html">Subtleties Javascript / Node.js. Increase productivity tenfold</a></li>
<li><a href="../277825/index.html">DIY connector for ESP8266 ESP-12</a></li>
<li><a href="../277827/index.html">Robert Metcalfe: EtherNet's dad, a great engineer and fig predictor (but he answered for the words)</a></li>
<li><a href="../277833/index.html">Welcome to MoscowJS February 25</a></li>
<li><a href="../277835/index.html">Character Story: Sound, Advertising and Language Managers in Unity3D</a></li>
<li><a href="../277845/index.html">What could be the stack of technologies for trading options on the Moscow Stock Exchange</a></li>
<li><a href="../277847/index.html">Decorators in typescript: weapon versus complexity or useless whistle?</a></li>
<li><a href="../277849/index.html">Exchange colocation: when speed matters</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>