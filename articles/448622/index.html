<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP GR8: Will JIT improve PHP 8 performance</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PHP is one of the major development languages ‚Äã‚Äãin Badoo. In our data centers, thousands of processor cores are busy executing millions of lines of PH...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP GR8: Will JIT improve PHP 8 performance</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/bw/fj/lk/bwfjlk2iy2btywbt8rqmlsok_-i.jpeg"><br><br>  <i>PHP is one of the major development languages ‚Äã‚Äãin Badoo.</i>  <i>In our data centers, thousands of processor cores are busy executing millions of lines of PHP code.</i>  <i>We are closely following the innovations and are actively looking for ways to improve performance, since in our volumes even a small optimization leads to a significant saving of resources.</i>  <i>One of the main news in the field of performance PHP - the emergence of JIT in the eighth version of the language.</i>  <i>This, of course, could not remain without our attention, and we translated an article about what is JIT, how it will be implemented in PHP, why it was decided to do and what to expect from it.</i> <br><br>  If you didn‚Äôt come out of the cave or didn‚Äôt come from the past (in this case, welcome), then you already know that there will be a JIT in PHP 8: a few days ago the voting was quiet and peaceful, and the overwhelming majority of participants were in favor of implementation, so everything . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In a fit of joy, you can even portray a few crazy movements as in the photo (this, by the way, is called the ‚ÄúDITROIT JIT‚Äù: <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/ip/gp/gk/ipgpgk3stro-ora0on1jhgbxg-y.jpeg"><br><br>  Now sit down and read this myth-breaking article.  I want to clarify the misunderstanding related to what is a JIT and how it is useful, and talk about how it works (but not too detailed, so that you do not get bored). <br><br>  Since I do not know who will read the article, I will go from simple to complex questions.  If you already know the answer to the question in the title, you can safely skip the appropriate chapter. <br><br><h1>  What is JIT? </h1><br>  PHP is implemented on a virtual machine basis (we call it Zend VM).  The language compiles the PHP source code into instructions that the virtual machine understands (this is called the compilation stage).  The virtual machine instructions obtained at the compilation stage are called opcodes.  At runtime, Zend VM executes opcodes, thereby performing the required work. <br><br>  This circuit works great.  In addition, tools like APC (earlier) and OpCach√© (today) cache the results of the compilation stage, so this stage is performed only when necessary. <br><br>  In short, JIT is a just in time compilation strategy (at the right moment), in which the code is first translated into an intermediate representation, which is then turned into machine code, dependent on the architecture, during execution. <br><br>  In PHP, this means that the JIT will consider the instructions received at the compilation stage for the virtual machine as an intermediate representation and issue machine code that will not be executed by Zend VM, but by the processor itself. <br><br><h1>  What does PHP need JIT for? </h1><br>  Shortly before the advent of PHP 7.0, the main focus of the work of the PHP team was the performance of the language.  Most of the major changes in PHP 7.0 were contained in the PHPNG patch, which greatly improved how PHP uses memory and processor.  Since then, each of us has to glance at the performance of the language. <br><br>  After the release of PHP 7.0, performance improvements continued: the hash table was optimized (the main data structure in PHP), the specialization of certain opcodes in Zend VM and the specialization of certain sequences in the compiler were introduced, the Optimizer (OpCache component) was constantly improved and many other changes were implemented. <br><br>  The harsh truth is that as a result of all these optimizations, we are rapidly approaching the limits of performance improvement opportunities. <br><br>  Please note that by ‚Äúthe limit of opportunities for improvement,‚Äù I mean the fact that the compromises that will have to be made for the sake of further improvements no longer look attractive.  When it comes to performance optimization, we always talk about trade-offs.  Often, for performance, we have to sacrifice simplicity.  Everyone would like to think that the simplest code is also the fastest, but in the modern world of C programming this is not the case.  The fastest is most often the code that is prepared to take advantage of the internal structure of the architecture or the structures built into the platform / compiler.  Simplicity alone does not guarantee better performance. <br><br>  Therefore, at this stage, the best way to squeeze out of PHP even more performance is the implementation of JIT. <br><br><h1>  JIT will speed up my site? </h1><br>  In all likelihood, slightly. <br><br>  Perhaps this is not the answer you expected.  The fact is that, in general, PHP applications are limited by input / output (I / O bound), and JIT works best with code that is limited by the processor (CPU bound). <br><br><h1>  What does "limited by I / O and processor" mean? </h1><br>  To describe the characteristics of the overall performance of a code or application, we use the terms "input-output limited" and "processor limited". <br><br>  The simplest definition is: <br><br><ul><li>  I / O-bound code will work much faster if we find a way to improve (reduce, optimize) I / O operations; <br></li><li>  processor-bound code will work much faster if we find a way to improve (reduce, optimize) instructions executed by the processor or magically increase the processor's clock frequency. <br></li></ul><br>  Code and application can be limited by input / output, by processor, or both. <br><br>  In general, PHP applications tend to be limited by input-output: their main bottleneck is often input-output operations ‚Äî connection, reading and writing to the database, caches, files, sockets, etc. <br><br><h1>  What does the processor-specific PHP code look like? </h1><br>  Perhaps some PHP programmers are not familiar with processor-bound code due to the very nature of most PHP applications: they usually act as a link to a database or cache, pick up and give out small amounts of HTML / JSON / XML responses. <br><br>  You can look at your codebase and find a lot of code that has nothing to do with I / O, code that calls functions that are not related to I / O.  And you may be confused that this does not make your application processor-bound, although its code contains more lines that do not work with I / O than they do. <br><br>  The fact is that PHP is one of the fastest interpreted languages.  There is no noticeable difference between calling a function that does not use I / O in Zend VM and in native code.  Of course, there is some difference, but both the machine code and Zend VM use the calling convention (call convention), so it doesn‚Äôt matter <code>-___()</code> you call <code>-___()</code> in the opcodes or in the machine code - this will not have a noticeable effect on the performance of the entire application that makes the call. <br><br>  <i>Note: To put it simply, the calling convention is a sequence of instructions executed <b>before</b> entering another function.</i>  <i>In both cases, the calling convention passes arguments to the stack.</i> <br><br>  You ask: ‚ÄúWhat about cycles, tail calls (tail calls) and other things‚Äù?  PHP is smart enough - and with the OpCache Optimizer component turned on, your code will be magically transformed into a more efficient version of what you wrote. <br><br>  It should be noted here that the JIT will not change the Zend VM calling convention.  This is done because PHP should be able to switch between JIT and VM modes at any time (so we decided to keep the current agreements).  As a result, any calls you see everywhere using JIT will not work much faster. <br><br>  If you want to see how the processor-specific PHP code looks like, look here: <a href="https://github.com/php/php-src/blob/master/Zend/bench.php">https://github.com/php/php-src/blob/master/Zend/bench.php</a> .  This is an extreme example, but it shows that all the grandeur of JIT is revealed in mathematics. <br><br><h1>  Did you have to make such an extreme compromise in order to speed up mathematical calculations in PHP? </h1><br>  Not.  We did this for the sake of expanding the range of language applications (and expanding to a significant one). <br><br>  We don't want to brag, but PHP dominates the web.  If you are doing web development and do not consider using PHP in your next project, then you are doing something wrong (according to a very biased PHP developer). <br><br>  At first glance it may seem that the acceleration of mathematical calculations in PHP has a very narrow application.  However, this opens the way for us, for example, to machine learning, 3D rendering, 2D rendering (GUI) and data analysis. <br><br><h1>  Why it cannot be implemented in PHP 7.4? </h1><br>  Above, I called JIT an extreme compromise, and I really think so: this is one of the most complex compiling strategies among all existing ones, if not the most difficult.  JIT implementation is a significant increase in complexity. <br><br>  If you ask Dmitry, the author of JIT, if he made PHP difficult, he will answer: ‚ÄúNo, I hate complexity‚Äù (this is a quote). <br><br>  In essence, ‚Äúcomplex‚Äù means ‚Äúthat which we do not understand.‚Äù  And today, few of the language developers really understand the current implementation of JIT. <br><br>  Work on PHP 7.4 is progressing rapidly, and the introduction of JIT into this version will lead to the fact that only a few will be able to debug, correct and improve the language.  This is not acceptable to those who voted against JIT in PHP 7.4. <br><br>  Before the release of PHP 8, many of us will understand the JIT implementation.  There are features that we want to implement, and tools that we want to rewrite for the eighth version, so we need to understand the JIT first.  We need this time, and we are very grateful that the majority voted to give it to us. <br><br>  Complicated is not synonymous with terrible.  Complicated can be beautiful as a star nebula, and this is about JIT.  In other words, even when in our team 20 people begin to understand JIT as well as Dmitry, this will not change the complexity of the very nature of JIT. <br><br><h1>  PHP development slow down? </h1><br>  There is no reason to think so.  We have enough time, so it can be argued that by the time PHP 8 is ready, there will be enough among us who have mastered the JIT enough to work no less efficiently than today, when it comes to correcting errors and developing PHP. <br><br>  When you try to relate this to the idea of ‚Äã‚Äãthe initial complexity of JIT, remember that most of the time we spend on introducing new features takes to discuss them.  Most often, when working on features and fixing errors, writing code takes minutes or hours, and discussions take weeks or months.  In rare cases, the code has to be written for hours or days, but even then discussions always last longer. <br><br>  That's all I wanted to say. <br><br><blockquote>  And since we are talking about performance, I invite my colleague Pavel Murzakov to the report on May 17 at the <a href="https://phprussia.ru/2019/abstracts/5154">PHP Russia</a> conference <a href="https://phprussia.ru/2019/abstracts/5154">.</a>  Pasha knows how to squeeze the last CPU second from the PHP code! </blockquote></div><p>Source: <a href="https://habr.com/ru/post/448622/">https://habr.com/ru/post/448622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448604/index.html">GameBoy on C #</a></li>
<li><a href="../448608/index.html">How to take the first steps in robotics?</a></li>
<li><a href="../448610/index.html">DIY: How we did a ‚Äúlive‚Äù schedule for Codefest X</a></li>
<li><a href="../448618/index.html">Douglas-Pecker Algorithm</a></li>
<li><a href="../448620/index.html">T + Conf 2019 is around the corner</a></li>
<li><a href="../448624/index.html">See the data? Not. So I do not see, but they are. We destroy data on SSD-drives, and even restore the speed</a></li>
<li><a href="../448626/index.html">DDoS to help: how we conduct stress and stress tests</a></li>
<li><a href="../448628/index.html">Soviet technical aesthetics and technology</a></li>
<li><a href="../448632/index.html">Is Java now paid? Dispel rumors (or not?)</a></li>
<li><a href="../448634/index.html">Ukrainian lessons</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>