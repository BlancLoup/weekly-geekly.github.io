<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing distributed systems - an interview with Andrei Satarin, Yandex</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Testing of distributed systems differs significantly from testing centralized. Few testers can boast of serious knowledge and experience in this area....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing distributed systems - an interview with Andrei Satarin, Yandex</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/650/b1e/a52/650b1ea5277d4d2ea960281c26d37e30.png"></div><br>  Testing of distributed systems differs significantly from testing centralized.  Few testers can boast of serious knowledge and experience in this area. <br><br><img align="left" src="https://habrastorage.org/files/50d/0db/1d2/50d0db1d2df4479c955046fa2e5b21d8.png">  I talked to the speaker of the <a href="http://heisenbug.ru/">Heisenbug 2016 Moscow</a> conference, <strong>Andrei Satarin</strong> ( <a href="https://twitter.com/asatarin">twitter.com/asatarin</a> ).  Andrei participated in testing projects at Mail.ru, at Kaspersky Lab, at Deutsche Bank, and now he is testing distributed systems in Yandex.  The article will be useful not only to people who are engaged in testing, but also to developers.  If you have never touched the question of testing distributed systems, welcome under the hood. <br><br>  Andrey Satarin: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <em>... they kill the nodes right during business hours and the developers are watching ...</em> <br><a name="habracut"></a><br><h2>  Methods and features of testing distributed systems </h2><br>  <strong>- What methods and strategies for testing distributed systems exist?</strong>  <strong>What is the difference?</strong> <br><br>  - In addition to the well-known classical approaches (unit testing, system testing, integration testing) for distributed systems there are additional approaches that are designed to detect complex defects. <br><br>  The approach of fault injection is very popular.  When the system works, we add failures with the help of special programs and mechanisms: failures of disks or entire machines, maybe network failures, failures of internal components of the system under test.  Since the vast majority of distributed systems must be resistant to this kind of failure, at least in some limited scale, the system should not stop its work or show any anomalies in the work.  In essence, this is testing for fault tolerance, since this is one of the most important non-functional requirements for distributed systems.  The more machines that work, the higher the likelihood of an individual problem for one of them.  For example, if a thousand cars are involved, then, conventionally speaking, the disks will fly out once a week.  The system is obliged to survive such situations in no way noticing them. <br><br>  There are more academic approaches, for example, formal verification (formal verification).  In distributed systems, there are internal algorithms and protocols that allow it to work.  They themselves are quite complex, but guarantee some invariants that must always be achieved, regardless of any system failures, reordering of packets in the network and anything else.  The essence of the approach lies in the fact that, based only on the description of the algorithm in a special language, its correctness is verified.  This gives confidence that the algorithm that is used, provided that it is correctly implemented, will work. <br><br>  In 2015, an academic article from Microsoft Research " <a href="https://www.microsoft.com/en-us/research/publication/ironfleet-proving-practical-distributed-systems-correct/">Proving Practical Distributed Systems Correct</a> " was published, where they described the model of the distributed storage system, then using special tools, checked this model for correctness, and then generated the code, which immediately worked. <br><br>  <strong>- What features need to be considered when testing distributed systems?</strong> <br><br>  - The peculiarity is that it is important to understand which particular invariants are guaranteed by the system under test.  For example, now popular nosql databases, which may be more high-performance, but they do not support transactions.  That is, their consistency level is lower than that of classical (MySql, PostgreSQL, Oracle).  And, when testing of such a distributed system, such as a nosql database, occurs, it is important that there is an understanding of which invariants it supports.  From this depend on the anomalies that will be observed in the tests.  In complex tests, for example, when there are several competitive writers and readers, you can see many different states.  In other words, you need to understand what effects can be observed in the system, and what - not. <br><br><h2>  Non-functional requirements play the most significant role. </h2><br>  <strong>- What are the typical mistakes people make when testing distributed systems?</strong> <br><br>  - The most common mistake is not to check all the guarantees that the system should provide, in which case the system becomes untested.  The second error, which can be costly, is not testing for failure of some part of the system.  By experience, if in a distributed system some subsystem was not tested for fault injection, then there are a little more than a lot of bugs there. <br><br>  <strong>- What metrics and characteristics of a distributed system is important to test and why?</strong> <br><br>  - From the non-functional requirements, firstly, fault tolerance (fault tolerance), and secondly, this performance (perfomance).  For distributed systems, non-functional requirements play the most significant role compared to functional requirements.  Fault tolerance comes first, because first the system should work, and if it does not work, the rest is not so important. <br><br>  <strong>- How important is test performance?</strong>  <strong>Is it necessary to take into account possible network delays when developing tests for a distributed system?</strong> <br><br>  - It depends on the types of tests in question.  If these are unit tests, then performance is important.  In the general case, of course, it is better to have quick tests (as they say, it is better to be healthy and rich).  This is true for functional tests.  For non-functional tests that check, for example, consistency or resistance to failure, the performance of tests is important for the more frequent manifestation of defects.  For example, if a defect manifests itself once per million operations, the more often these operations occur, the more often the defect manifests itself.  If it takes an hour, then this is perfectly acceptable.  If it takes several days, then the search for such defects becomes a problem. <br><br><h2>  98% of all defects can be reproduced only on 3 nodes </h2><br>  <strong>- Is it necessary to create special clusters for testing, or can we use ‚Äúcombat‚Äù clusters that are in production?</strong>  <strong>How to determine the optimal size of the test cluster?</strong> <br><br>  - Most often it is used test cluster.  If we talk about testing on combat servers, the most widely known example is the company Netflix, which actively promotes its approach, called the " <a href="http://techblog.netflix.com/2011/07/netflix-simian-army.html">simian army</a> ", that is, the army of macaques.  It lies in the fact that they do fault injection in production.  They kill the nodes right in working hours and the developers are watching that the system does not degrade.  But here we must understand that such an opportunity appears only from a certain scale.  If the system works on 10-20 nodes, then testing in this way means that there will be a degradation of 5-10%.  In production, not everyone is ready for such sacrifices.  In addition, there may be some kind of service level agreement (SLA) and such testing may be expensive due to its violation.  In any case, even if there is a practice of testing in production, there is a huge test infrastructure that catches most of the defects.  The advantage of testing in production is that there is no need to repeat the productive environment. <br><br>  Regarding the size of the test cluster.  If the system is distributed, then it must be greater than one - this is a restriction from below.  On the topic of limitations above, there is an article ‚Äú <a href="https://www.usenix.org/conference/osdi14/technical-sessions/presentation/yuan">Simple Testing Can Prevent Most Critical Failures,</a> ‚Äù which examines the question of what errors exist in distributed systems.  According to the article, the researchers came to the conclusion that 98% of all defects can be reproduced on just 3 nodes.  Specifically, in our work we use more, usually the test cluster consists of 8 nodes, but this is due to the internal structure of our system. <br><br>  <strong>- How to deal with complete or partial failures of a distributed system during testing?</strong> <br><br>  - Probably, there are no special ways to deal with this, because in the test environment the scales are much smaller.  If bad iron strongly interferes, it can be simply excluded from the test environment.  We had a case when a failure occurred in the test gland, but we were rather glad about this, since it allowed us to find some unusual defects.  Since the distributed system must be fault tolerant, even in tests it should not cause any problems. <br><br>  <strong>- What specific technologies and tools are used to create a test environment?</strong>  <strong>To automate testing?</strong> <br><br>  - The test environment depends on the technologies that are used for development, and on technologies that are familiar to the team.  We, for example, actively use Python, because it is well suited for such tasks and our testers know it.  It is simple in terms of writing tests, high enough so that you can write on it is understandable.  In my opinion, he has a little "trouble" with concurrency, but this problem is solved.  The system itself is developed in C ++, but it is rather difficult to use it for high-level tests, since it will not work out quickly and easily to develop it, and in tests it is important that the speed of development is important. <br><br>  Regarding test automation.  A test repository is usually built, which automatically runs on a dedicated server.  We use TeamCity and some of our internal developments for this. <br><br>  <strong>- Do you have anything else you would like to add on the topic?</strong> <br><br>  - I would like to add that on testing of distributed systems there is a huge amount of materials, both academic and those close to the industry, a huge variety of approaches and methods of testing.  The search for methods and their improvement does not stop for a day.  This topic is constantly evolving - and this is precisely what makes it interesting. <br><br><hr><br>  You can listen to more reports on testing on December 10 at the Radisson Slavyanskaya Hotel at the <a href="http://heisenbug.ru/">Heisenbag</a> conference.  <a href="http://heisenbug.ru/registration/">Registration is</a> still open. <br><br>  Topics for presentations: <br><br><ul><li>  <a href="http://heisenbug.ru/talks/no-such-thing-as-manual-testing-and-other-confusions/">No Such Thing as Manual Testing and Other Confusions</a> </li><li>  <a href="http://heisenbug.ru/talks/appium-automation-for-apps/">Appium: Automation for Apps</a> </li><li>  <a href="http://heisenbug.ru/talks/kak-nauchit-robotov-igrat-v-igry/">How to teach robots to play games?</a> </li><li>  <a href="http://heisenbug.ru/talks/hero-s-journey-to-perfect-system-tests-eight-assessment-criteria-for-tests/">Tips' Architecture Designs</a> </li><li>  <a href="http://heisenbug.ru/talks/page-objects-luchshe-menshe-da-luchshe/">Page Objects - less is better</a> </li><li>  <a href="http://heisenbug.ru/talks/testirovanie-raspredelennyh-sistem/">Testing Distributed Systems</a> </li><li>  <a href="http://heisenbug.ru/talks/testirovanie-android-prilozheniya-juno-s-ci-unit-integration-i-functional/">Testing Android ‚Äì Juno apps with: CI, Unit, Integration, and Functional (UI) tests.</a>  <a href="http://heisenbug.ru/talks/testirovanie-android-prilozheniya-juno-s-ci-unit-integration-i-functional/">100% Kotlin, 90% + RxJava, Spek, JUnit, DSL for UI tests</a> </li><li>  <a href="http://heisenbug.ru/talks/combining-manual-and-automated-testing-process-and-tools/">Combining manual and automated testing: process and tools</a> </li><li>  <a href="http://heisenbug.ru/talks/spisok-pokupok-chto-nuzhno-ne-zabyt-pri-zapuske-jmeter-testov/">Shopping list: what you need to remember when running JMeter tests</a> </li><li>  <a href="http://heisenbug.ru/talks/staticheskij-vynos-mozga-chto-skryvayut-analizatory-koda/">Static brain removal: what do code analyzers hide?</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/313908/">https://habr.com/ru/post/313908/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313892/index.html">Tensor expansions and their applications. Lecture in Yandex</a></li>
<li><a href="../313894/index.html">In search of the limit. 6 myths of efficiency, which I dispelled, working 14 hours a day for a month</a></li>
<li><a href="../313898/index.html">As we Wednesday Arduino on 8051, or OS on one process</a></li>
<li><a href="../313904/index.html">Mitch Kapor: business in the lotus position, second life and electronic frontier</a></li>
<li><a href="../313906/index.html">[Bookmark] Zoo neural network architectures. Part 2</a></li>
<li><a href="../313910/index.html">1C magic XDTO-packages on the example of integration with GIS utilities</a></li>
<li><a href="../313916/index.html">Creating materials for Unity in Substance Designer</a></li>
<li><a href="../313918/index.html">Impressive Ellipsis (The Mighty Ellipsis)</a></li>
<li><a href="../313922/index.html">Scrolling content by touching and dragging on jQuery</a></li>
<li><a href="../313924/index.html">The infrastructure of the communication center from the kettle, or the next construction of server - part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>