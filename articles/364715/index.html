<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Matrix clock</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes an idea in your head ripens over the years. The subconscious mind absorbs the interesting things, lays it down on the shelves, accumulates t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Matrix clock</h1><div class="post__text post__text-html js-mediator-article">  Sometimes an idea in your head ripens over the years.  The subconscious mind absorbs the interesting things, lays it down on the shelves, accumulates the critical mass, until all this finally results in something interesting. <br><br>  It happened at that time.  In the space-time continuum, a beautiful, but already useless ‚ÄúHandbook of mini- and micro-computers‚Äù, a red LED array of 5x8 and the birthday of a programmer friend came together. <br><br>  How can you not make a watch?  And not just binary, but some pozakovyristey? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/14b/c89/b9e/14bc89b9ea6640f89d84b11f56bcf2a3.JPG"><br><a name="habracut"></a><br><h4>  purpose </h4><br>  The main goal was not just to show the time, but to show it so that I had to solve a small puzzle, have fun between diving into the code.  The brain for a moment falls out of the usual decimal everyday life, so that after a few thoughtful math seconds come back, <s>watch the time on the computer</s> and continue programming. <br><br><h4>  Iron </h4><br>  Then I also didn‚Äôt have the habit of documenting such simple schemes (which I regret very much), so I just took out my favorite tiny2313 from the desk drawer, warmed up the soldering iron, and rushed! <br><br><div class="spoiler">  <b class="spoiler_title">Approximate scheme</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/efb/d90/7a7/efbd907a70644518b557110d0c8180bd.png"><br>  Transistors, if I'm not mistaken - KT361 from old stocks.  The findings of the matrix are connected so that it is more convenient to solder.  If you still do not understand what is happening here - I can only recommend a great site respected <a href="http://geektimes.ru/users/dihalt/" class="user_link">DiHalt</a> : <a href="http://easyelectronics.ru/">easyelectronics</a> </div></div><br>  As a timing chain, I used an internal RC frequency generator, which, of course, cannot be done, but the past experience of creating a room clock showed that calibration by week deviation can achieve an accuracy of five minutes per year.  Although, maybe I was just lucky. <br><br><h4>  Display modes </h4><br>  First of all, naturally, I implemented a <b>binary mapping</b> .  Rather, binary decimal ( <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B2%25D0%25BE%25D0%25B8%25D1%2587%25D0%25BD%25D0%25BE-%25D0%25B4%25D0%25B5%25D1%2581%25D1%258F%25D1%2582%25D0%25B8%25D1%2587%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BA%25D0%25BE%25D0%25B4">BCD</a> ).  So it is possible to read information from the clock a little faster, so any housewife who is accustomed to recalculate the change in the store will cope with such a display after a small workout (I taught my favorite humanitarian to count on fingers up to 1023, which she is very pleased about). <br><br><img src="https://habrastorage.org/files/97c/892/928/97c89292803f4b008451930a9da902ee.png"><br><div class="spoiler">  <b class="spoiler_title">Small explanatory animation</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/8c7/df0/10b/8c7df010b205441e82affaee00b88b69.gif"></div></div><br>  While visiting the telecommunications museum, I noticed how numbers are easily coded in Morse code.  Replaced dots with LEDs on, and dashes with disabled ones.  It turned out the <b>display in Morse code</b> - very simple and clear.  Honestly, this is my favorite mode!  It still makes you think, but the smooth flow of time from one rank to another just fascinates. <br><br><img src="https://habrastorage.org/files/b51/f1b/b26/b51f1bb2611f4b31b0b2b3d9f3bfc426.png"><br><div class="spoiler">  <b class="spoiler_title">Small explanatory animation and Morse code excerpt.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d47/528/5ac/d475285acf144c22b44a7cdeaa6b2ce5.png"><br><br><img src="https://habrastorage.org/files/1ec/41c/c0d/1ec41cc0d09748eb986cb765521f6c07.gif"></div></div><br>  Well, and then I seriously wondered if it was possible to emulate an analog clock with just 40 LEDs?  After all, they have a remarkable advantage - they are clear to all.  Even the corner of the eye can determine the approximate time, well, a closer look allows you to find out the exact time. <br><br>  A few stripped sheets, a bunch of tried-on code, and an <b>analog display</b> solution was found!  I am not sure that the housewife with a swoop will understand everything, but the goal is achieved: after a small workout, you can determine with a cursory time with an accuracy of up to three minutes, a closer look - up to 12 seconds. <br><br><img src="https://habrastorage.org/files/284/175/ba6/284175ba67354df1afa1b975abd3f46f.png"><br><div class="spoiler">  <b class="spoiler_title">Small explanatory animation</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/9b2/ab3/8a7/9b2ab38a74a4466ba2204e2af531294c.gif"></div></div><br><img src="https://habrastorage.org/files/a2c/aa6/390/a2caa6390c624981b29239d0f6a91b7a.JPG"><br>  <i>On the clock - midnight.</i>  <i>To visually highlight the "hour" dial - the current hour is shown by the disabled LED on the luminous circle.</i> <br><br>  To look at the clock was even more interesting, the time display method changes at midnight (optional).  Time and display are configured using a pair of buttons on a simple algorithm, a block diagram of which is attached.  True, the owner of the watch noted that the easiest and most convenient way to set the exact time is to turn them on at midnight. <br><br>  After that, it was time for a long and painful cutting and gluing of the directory.  It was necessary to do everything literally page by page, traces of hackwork immediately appeared in the form of waviness.  It took almost a week!  The cut-out repeated the outline of the matrix, the board, the protruding parts, the word was made exactly so as to carefully wrap up all the electronics. <br><br>  Buttons and algorithm settings are hidden in the rear turn.  Stickers on the buttons for the "blind" (looking only at the display) settings have added a new owner of the clock. <br><br><div class="spoiler">  <b class="spoiler_title">Instructions for use</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/567/cf4/398/567cf4398c4e44c798f6f16a5d56b33c.JPG"></div></div><br>  Of course, some ideas for improvement come after the device is <s>given to the customer</s> .  The contact of the power supply was not stable enough, it would be great to close the matrix with a light filter and make emergency power from a removable battery ... But this is next time, otherwise everything works fine. <br><br>  But the story about the clock of their current owner <a href="http://geektimes.ru/users/fformula/" class="user_link">FFormula</a> , recorded at my request. <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/7w375vo29to%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjz_9K2WvmxALjfEPzOw4iOe66YDg" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Future plans </h4><br>  There was a place for a wall clock, a <a href="https://ru.wikipedia.org/wiki/DCF77">DCF77</a> receiver was bought, <a href="https://ru.wikipedia.org/wiki/SNTP">SNTP</a> synchronization was assumed as a reserve (with the help of <a href="http://geektimes.ru/post/241054/">ESP8266</a> ), this project will take into account past experience, think of new insidious time display methods ... For example, make the main UNIX time mode that will immediately solve the problem date display :) <br><br><div class="spoiler">  <b class="spoiler_title">Caution code!</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// 2008.09.02 18:05 -&gt; 2008.09.23 22:39 // Fuse bits: div8 disabled #include &lt;avr/io.h&gt; #include &lt;avr/pgmspace.h&gt; #include &lt;avr/interrupt.h&gt; #define F_CPU 8000000UL // 8 MHz #include &lt;util/delay.h&gt; #define countStart 9 // manually adjusted after one week #define typeCount 3 volatile unsigned char sec, keys, oldkeys, colSet, type, automatic = 0xff; volatile unsigned int time; typedef struct bitfield{ unsigned char point:1; unsigned char settings:1; unsigned char blink:1; }bitfield; bitfield flag; volatile char col = 0; #define C3 PD2 #define C5 PD3 #define C4 PD4 #define C1 PD5 #define C2 PD6 unsigned char c[5] = { (1&lt;&lt;C1), (1&lt;&lt;C2), (1&lt;&lt;C3), (1&lt;&lt;C4), (1&lt;&lt;C5) }; #define R2 PB7 #define R4 PB6 #define R1 PB5 #define R3 PB4 #define R7 PB3 #define R5 PB2 #define R8 PB1 #define R6 PB0 unsigned char r[8] = { (1&lt;&lt;R1), (1&lt;&lt;R2), (1&lt;&lt;R3), (1&lt;&lt;R4), (1&lt;&lt;R5), (1&lt;&lt;R6), (1&lt;&lt;R7), (1&lt;&lt;R8) }; #define CC ((1&lt;&lt;C1)|(1&lt;&lt;C2)|(1&lt;&lt;C3)|(1&lt;&lt;C4)|(1&lt;&lt;C5)) #define B0 PD0 #define B1 PD1 unsigned char display[5]; unsigned char clock[4]; //**************** // Time calculation and visualisation //**************** ISR (TIMER0_OVF_vect) { TCNT0 = countStart; time ++; col++; if (col == 5) col = 0; PORTD |= CC; PORTD &amp;= ~c[col]; PORTB = display[col]; if (time == 2000) { time = 0; if (flag.point) // half second { flag.point = 0; if (colSet&gt;1) sec++; if (sec == 60) { sec = 0; clock[0]++; if (clock[0] == 10) { clock[0] = 0; clock[1]++; if (clock[1] == 6) { clock[1] = 0; clock[2]++; if ((clock[2] == 4)&amp;&amp;(clock[3] == 2)) { clock[2] = 0; clock[3] = 0; if (automatic) type++; } if (clock[2] == 10) { clock[2] = 0; clock[3]++; } } } } } else { flag.point = 1; } } } //**************** // Init section //**************** void Init (void) { ACSR = (1&lt;&lt;ACD); //Turn Off ANA_COMP //clock[3] = 1; //clock[2] = 2; //clock[1] = 0; //clock[0] = 0; //type = 1; //flag.settings = 0; //flag.blink = 0; colSet = 4; oldkeys = 0b11; //DDRA = 0; //PORTA = 0xFF; DDRD = ~((1&lt;&lt;0)|(1&lt;&lt;1)); PORTD = 0b11; DDRB = 0xFF; TCCR0B = (1&lt;&lt;CS01); // presc. 8 TCNT0 = countStart; // 256-8 = 250; 8*250/8 000 000 = 0.00025 TIMSK = (1&lt;&lt;TOIE0); sei(); } //**************** // Keyboard and time setup //**************** void CheckKeyboard (void) { keys = PIND&amp;0b11; if (keys != 0b11) { _delay_ms(5); if (((PIND&amp;0b11) == keys)&amp;&amp;(keys!=0b11)) { oldkeys = keys; } } else if (oldkeys != 0b11) { if (oldkeys == 0b10) { if ((flag.settings == 0)&amp;&amp;(flag.blink == 0)) { flag.blink = 1; } else if (flag.blink) { flag.blink = 0; flag.settings = 1; colSet = 0; } else if (flag.settings) { if (colSet == 4) { colSet = 0; } else if (colSet == 2) { colSet=4; flag.settings = 0; } else { colSet++; } } } else if (oldkeys == 0b01) { if (flag.blink) { flag.blink = 0; automatic = ~automatic; } else if (flag.settings) { clock[colSet]++; if (colSet &lt; 2) sec = 0; if ((colSet==0)&amp;&amp;(clock[0]==10)) { clock[0] = 0; } else if ((colSet==1)&amp;&amp;(clock[1]==6)) { clock[1] = 0; } else if ((colSet==2)&amp;&amp;(clock[2]==10)) { clock[2]=0; clock[3]++; } else if (((colSet==2)&amp;&amp;(clock[3]==2))&amp;&amp;(clock[2]==4)) { clock[2]=0; clock[3]=0; } } else { type ++; } } oldkeys = 0b11; } } //**************** // Service functions //**************** unsigned char bcd (unsigned char a) { return (((a / 10) &lt;&lt; 4)|(a%10)); } unsigned char transform (unsigned char a) { unsigned char temp, i; temp = 0; for (i = 0; i&lt;8; i++) if (a &amp; (1&lt;&lt;i)) temp |= r[i]; return ~temp; } //**************** // BCD Visualisation //**************** void DigitalCode(void) { display[4] = transform(bcd(sec)); if ((colSet == 0)&amp;&amp;(flag.point)) { display [3] = 0xf0; } else if ((colSet == 1)&amp;&amp;(flag.point)) { display [3] = 0x0f; } else if ((flag.point)&amp;&amp;(flag.blink)) display[3] = 0xFF; else display[3] = 0; display[2] = transform((clock[1]&lt;&lt;4)|(clock[0])); if ((colSet == 2)&amp;&amp;(flag.point)) display[1] = 0xFF; else if ((flag.point)&amp;&amp;(flag.blink)) display[1] = 0xFF; else display[1] = 0; display[0] = transform((clock[3]&lt;&lt;4)|(clock[2])); } //**************** // Analog clocks //**************** unsigned char hours [12][3] PROGMEM = { {(1&lt;&lt;6)|(1&lt;&lt;5)|(0&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(0&lt;&lt;5)|(0&lt;&lt;4)|(0&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2)}, {(1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(0&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(0&lt;&lt;5)|(0&lt;&lt;4)|(0&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2)}, {(1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(0&lt;&lt;2), (1&lt;&lt;6)|(0&lt;&lt;5)|(0&lt;&lt;4)|(0&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2)}, {(1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(0&lt;&lt;5)|(0&lt;&lt;4)|(0&lt;&lt;3)|(0&lt;&lt;2), (1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2)}, {(1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(0&lt;&lt;5)|(0&lt;&lt;4)|(0&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(0&lt;&lt;2)}, {(1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(0&lt;&lt;5)|(0&lt;&lt;4)|(0&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(0&lt;&lt;3)|(1&lt;&lt;2)}, {(1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(0&lt;&lt;5)|(0&lt;&lt;4)|(0&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(1&lt;&lt;5)|(0&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2)}, {(1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(0&lt;&lt;5)|(0&lt;&lt;4)|(0&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(0&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2)}, {(1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(0&lt;&lt;5)|(0&lt;&lt;4)|(0&lt;&lt;3)|(1&lt;&lt;2), (0&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2)}, {(1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2), (0&lt;&lt;6)|(0&lt;&lt;5)|(0&lt;&lt;4)|(0&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2)}, {(0&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(0&lt;&lt;5)|(0&lt;&lt;4)|(0&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2)}, {(1&lt;&lt;6)|(0&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(0&lt;&lt;5)|(0&lt;&lt;4)|(0&lt;&lt;3)|(1&lt;&lt;2), (1&lt;&lt;6)|(1&lt;&lt;5)|(1&lt;&lt;4)|(1&lt;&lt;3)|(1&lt;&lt;2)} }; unsigned char mins [20][2] = { {0, (1&lt;&lt;4)}, {0, (1&lt;&lt;3)}, {0, (1&lt;&lt;2)}, {0, (1&lt;&lt;1)}, {1, (1&lt;&lt;1)}, {2, (1&lt;&lt;1)}, {3, (1&lt;&lt;1)}, {4, (1&lt;&lt;1)}, {4, (1&lt;&lt;1)}, {4, (1&lt;&lt;3)}, {4, (1&lt;&lt;4)}, {4, (1&lt;&lt;5)}, {4, (1&lt;&lt;6)}, {4, (1&lt;&lt;7)}, {3, (1&lt;&lt;7)}, {2, (1&lt;&lt;7)}, {1, (1&lt;&lt;7)}, {0, (1&lt;&lt;7)}, {0, (1&lt;&lt;6)}, {0, (1&lt;&lt;5)} }; unsigned char mmins[3] = { 0, (1&lt;&lt;4), (1&lt;&lt;5)|(1&lt;&lt;3) }; unsigned char anal (unsigned char line) { unsigned char res, min, mmin, hr; res = 0; if (((sec / 12) == (4 - line))&amp;&amp;flag.point) res = 1; if (flag.settings) res = 0; if (flag.point) if (flag.blink) res = 1; else if ((colSet == 0)&amp;&amp;(line &gt; 1)) res = 1; else if ((colSet == 1)&amp;&amp;(line % 4)) res = 1; else if ((colSet == 2)&amp;&amp;(line &lt;3)) res = 1; min = (clock[1]*10+clock[0]); mmin = min % 3; min = min / 3; hr = (clock[3]*10+clock[2]) % 12; if (mins[min][0] == line) res |= mins[min][1]; switch (line) { case 1: { res |= pgm_read_byte(&amp;(hours[hr][0])); break; } case 2: { res |= mmins[mmin]; res |= pgm_read_byte(&amp;(hours[hr][1])); break; } case 3: { res |= pgm_read_byte(&amp;(hours[hr][2])); break; } } return transform(res); } void AnalogCode(void) { display[0] = anal(0); display[1] = anal(1); display[2] = anal(2); display[3] = anal(3); display[4] = anal(4); } //**************** // Morse Visualisation //**************** unsigned char morseArray[5][10] PROGMEM= { {0, 0, 0, 0, 0, 1, 1, 1, 1, 1}, {0, 0, 0, 0, 1, 1, 1, 1, 1, 0}, {0, 0, 0, 1, 1, 1, 1, 1, 0, 0}, {0, 0, 1, 1, 1, 1, 1, 0, 0, 0}, {0, 1, 1, 1, 1, 1, 0, 0, 0, 0} }; unsigned char morse(unsigned char line) { unsigned char res, temp, temp1; temp = bcd(sec); temp1 = ((temp &amp; 0xf0)&gt;&gt;4); temp &amp;= 0x0f; res = (pgm_read_byte(&amp;(morseArray[line][temp]))&lt;&lt;0)|(pgm_read_byte(&amp;(morseArray[line][temp1]))&lt;&lt;1); res |= (pgm_read_byte(&amp;(morseArray[line][clock[0]]))&lt;&lt;3)|(pgm_read_byte(&amp;(morseArray[line][clock[1]]))&lt;&lt;4); res |= (pgm_read_byte(&amp;(morseArray[line][clock[2]]))&lt;&lt;6)|(pgm_read_byte(&amp;(morseArray[line][clock[3]]))&lt;&lt;7); if (flag.point) if (flag.blink) res |= (1&lt;&lt;2)|(1&lt;&lt;5); else if (colSet == 2) res |= (1&lt;&lt;5); else if (((colSet == 0)&amp;&amp;(line&gt;1))||((colSet == 1)&amp;&amp;(line&lt;3))) res |= (1&lt;&lt;2); return transform(res); } void MorseCode(void) { display[0] = morse(0); display[1] = morse(1); display[2] = morse(2); display[3] = morse(3); display[4] = morse(4); } //**************** // Type selection //**************** void PrintPrepare (void) { // Prepare display[]; if (type == typeCount) type = 0; switch (type) { case 1: { DigitalCode(); break; } case 2: { AnalogCode(); break; } case 0: { MorseCode(); break; } } if ((flag.blink)&amp;&amp;automatic) if (flag.point) display[0] &amp;= ~((1&lt;&lt;R8)|(1&lt;&lt;R7)); else display[0] |= ((1&lt;&lt;R8)|(1&lt;&lt;R7)); } void main(void) { Init(); for (;;) { CheckKeyboard(); PrintPrepare(); } }</span></span></code> </pre> </div></div></div><p>Source: <a href="https://habr.com/ru/post/364715/">https://habr.com/ru/post/364715/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../364705/index.html">Two cherished rules blocking torrents for mikrotik</a></li>
<li><a href="../364707/index.html">Cars will be one of the platforms for the next version of Android</a></li>
<li><a href="../364709/index.html">Roskomnadzor is trying to block pages, groups and events in VC related to Navalny</a></li>
<li><a href="../364711/index.html">Hyperloop project is going according to plan</a></li>
<li><a href="../364713/index.html">Facebook and Twitter refuse to block supporters of Navalny even under the threat of a total ban in the Russian Federation</a></li>
<li><a href="../364717/index.html">The Apple Store online is back with a 30% increase in prices.</a></li>
<li><a href="../364719/index.html">VKontakte now blocks not only pirated music, but also pirated music</a></li>
<li><a href="../364721/index.html">BlackBerry and Boeing are working on a tamper-proof smartphone</a></li>
<li><a href="../364723/index.html">EU helps to create energy efficient software</a></li>
<li><a href="../364725/index.html">HECTOR: a robot stick from the University of Bielefeld</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>