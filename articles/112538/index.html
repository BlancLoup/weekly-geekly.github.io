<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Uploading files using HTML5 and how many times we said bad words</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The task was to find or create a file uploader on a server that uses the capabilities of HTML5 for multiloading. The loader should: 


- send any para...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Uploading files using HTML5 and how many times we said bad words</h1><div class="post__text post__text-html js-mediator-article">  The task was to find or create a file uploader on a server that uses the capabilities of HTML5 for multiloading.  The loader should: <br><ul><li>  send any parameters with the file using the POST method; </li><li>  send cookies; </li><li>  provide the ability to select several files at once (or several thousand - here, as the user wants); </li><li>  send files in groups; </li><li>  Files are collected in groups up to a certain number of megabytes, or up to a certain number of files in a group;  (this is due to the fact that the server has a limit on the size of the POST request and the number of files in one package) </li></ul><br>  It is precisely because of the lack of experience with flash, that only JavaScript was chosen to create the bootloader. <br><br><h5>  So what came of it </h5><br><a name="habracut"></a><br>  First there was a search: SWFupload, Uploadify and others were studied.  Perhaps not too well, but each of them did not meet all the requirements. <br><br>  Bugs, bugs, bugs.  Some versions of Flash cannot control the variable name.  SWFupload does not send cookies, but it does have a cookie collector, and it sends them only with GET or POST methods.  However, we have a CMS on the server that checks the user's session precisely on the basis of cookies, so Flash was discarded and a solution was selected using HTML5. <br>  Since FileApi is only supported by FF 3.0+, Chrome and Safari 4+, we‚Äôll analyze the intricacies of working with these browsers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Subtlety number 1</b> <br><br>  Getting the contents of a file in Chrome using readAsBinaryString. <br>  When using this method, we are faced with an incomprehensible problem that all files come beaten, the size of which is about 1.5 times the original size.  We didn‚Äôt manage to overcome this problem, so for chrome (as well as safari) we used FormData. <br><br>  To send a group of files + some data using the POST method in FF (up to 4.0), we create a multipart / form-data: <br> <code>Content-Type: multipart/form-data; boundary=------multipartformboundary1295790618 <br> \r\n <br> --------multipartformboundary1295790618 <br> \r\n <br> Content-Disposition: form-data; name='user_files[]';filename='My_File1.jpg' <br> \r\n <br> Content-Type: application/octet-stream <br> \r\n <br> \r\n <br>   <br> \r\n <br> --------multipartformboundary1295790618 <br> \r\n <br> Content-Disposition: form-data; name='user_files[]';filename='My_File2.jpg' <br> \r\n <br> Content-Type: application/octet-stream <br> \r\n <br> \r\n <br>   <br> \r\n <br> --------multipartformboundary1295790618 <br> \r\n <br> Content-Disposition: form-data; name='my_param' <br> \r\n <br> \r\n <br> Param_value <br> \r\n <br> --------multipartformboundary1295790618 <br> \r\n <br> Content-Disposition: form-data; name='my_param' <br> \r\n <br> \r\n <br> Param_value <br> \r\n <br> --------multipartformboundary1295790618-- <br> \r\n</code> <br> <br>  <b>Subtlety number 2</b> <br><br>  The definition of FormData support can be checked as follows: <br> <code>function isFormDataSupported() { <br> return (window.FormData); <br> } <br></code> <br><br>  <b>Subtlety number 3</b> <br><br>  FF 3.0 / 3.5 and FF 3.6 use different functions to get the contents of the files: <br>  FF 3.0 / 3.5: readAsBinary () <br>  FF 3.6: getAsBinary () <br><br>  <b>Subtlety number 4</b> <br><br>  There is also a difference in sending files via XMLHttpRequest: <br>  for FormData, you need to send using the send () method, and to send files received by the getAsBinary () method or using readAsBinaryString, you must send with the sendAsBinary () method. <br><br>  <b>Subtlety number 5</b> <br><br>  FF rarely triggers the progress event of XMLHttpRequest, as opposed to chrome or Safari.  In fact, at FF, the progress event sometimes did not work at all with very fast connection or on localhost. <br><br>  <b>Subtlety number 6</b> <br><br>  At the abort event, the XMLHttpRequest in FF also triggers the error event.  With this you need to be especially careful if you have a handler for errors there - this may cause additional questions to the user. <br><br>  <b>Subtlety number 7</b> <br><br>  For PHP, I advise you to pay attention to the following settings in php.ini: <br><br>  post_max_size is the maximum size of POST. <br>  upload_max_filesize - maximum file size. <br>  max_file_uploads - the maximum number of downloaded files. <br><br>  If you use our script, do not forget to change the script for your server settings. <br><br>  <a href="http://jsupload.gatar.ru/">Demo for uploading images (worth filter by extensions)</a> <br>  <a href="">Download demo</a> <br>  <a href="http://www.slideshare.net/timdream/html5-ajax-fileupload">Good presentation on AJAX downloads</a> <br><br>  <b>UPDATE:</b> <br><br>  <b>Subtlety number 8</b> (thanks to <a href="https://habrahabr.ru/users/soltpain/" class="user_link">soltpain</a> for noticing this bug) <br><br>  In Windows, there is another caveat in choosing a set of files through [input type = file multiple]: <br>  The number of files available for selection depends on the total length of the names of the selected files.  For chromium - 256 characters, for FF - 4096 (the length is not a single file, but the total length of the names, that is, if there are files whose name consists of 20 characters, then in chrome you can select a maximum of 10 files).  In Linux, everything is fine. <br><br>  Bug description: <br>  <a href="http://codereview.chromium.org/4198004">codereview.chromium.org/4198004</a> </div><p>Source: <a href="https://habr.com/ru/post/112538/">https://habr.com/ru/post/112538/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../112531/index.html">Choosing a mass mailing service</a></li>
<li><a href="../112532/index.html">15,000 day unix era</a></li>
<li><a href="../112535/index.html">What is 1G, 2G, 3G, 4G and everything in between?</a></li>
<li><a href="../112536/index.html">Screw GTD to Remember The Milk</a></li>
<li><a href="../112537/index.html">Russian game Doodle God is a worldwide partner of LG and # 6 rated WP7</a></li>
<li><a href="../112539/index.html">Job management</a></li>
<li><a href="../112541/index.html">Well settled!</a></li>
<li><a href="../112542/index.html">New design apple.com</a></li>
<li><a href="../112544/index.html">Amazon announces service to send email (Amazon SES)</a></li>
<li><a href="../112548/index.html">SED outside offices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>