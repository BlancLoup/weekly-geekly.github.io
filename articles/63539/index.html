<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>6 ways to merge list of lists</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We came here in our office as the most beautiful conversation and quickly put together a list of lists in Python. Really how? 

 Even this seemingly t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>6 ways to merge list of lists</h1><div class="post__text post__text-html js-mediator-article">  We came here in our office as the most beautiful conversation and quickly put together a list of lists in Python.  Really how? <br><br>  Even this seemingly trivial task can be solved in several ways that differ significantly in speed and expressiveness. <br><br>  <b>OPTION 1</b> <br>  Everyone knows that the elements of the list can be iterated through in a loop, and that elements can be added to the end.  This leads us to the first solution: <br><blockquote>  <font color="#ff7700">def</font> listmerge1 <font>(</font> lstlst <font>)</font> : <br>  <font color="#008000">all</font> = <font>[</font> <font>]</font> <br>  <font color="#ff7700">for</font> lst <font color="#ff7700">in</font> lstlst: <br>  <font color="#ff7700">for</font> el <font color="#ff7700">in</font> lst: <br>  <font color="#008000">all</font> .  <font>append</font> <font>(</font> el <font>)</font> <br>  <font color="#ff7700">return</font> <font color="#008000">all</font> </blockquote><br>  Not only did the function stretch as much as 6 lines, but in addition it is also not effective. <br>  Let's try to improve it in both senses: speed and beauty (‚Äúpythonic way‚Äù). <br><a name="habracut"></a><br>  <b>OPTION2</b> <br>  Here we recall that in Python there is an operator "+" for strings and we get: <br><blockquote>  <font color="#ff7700">def</font> listmerge2 <font>(</font> lstlst <font>)</font> : <br>  <font color="#008000">all</font> = <font>[</font> <font>]</font> <br>  <font color="#ff7700">for</font> lst <font color="#ff7700">in</font> lstlst: <br>  <font color="#008000">all</font> = <font color="#008000">all</font> + lst <br>  <font color="#ff7700">return</font> <font color="#008000">all</font> </blockquote><br>  This is the slowest implementation.  The puncture is that in this form the operator "+" in each step creates a new list object, which is thrown out in the next step, etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>OPTION 3</b> <br>  It is easy to fix, it is necessary to replace the "+" with a form that does not create a new list, but adds to the old one.  This is the "+ =" operator, but I prefer to write the "extend" method explicitly. <br><br>  So we got the fastest option, but not the shortest. <br><blockquote>  <font color="#ff7700">def</font> listmerge3 <font>(</font> lstlst <font>)</font> : <br>  <font color="#008000">all</font> = <font>[</font> <font>]</font> <br>  <font color="#ff7700">for</font> lst <font color="#ff7700">in</font> lstlst: <br>  <font color="#008000">all</font> .  <font>extend</font> <font>(</font> lst <font>)</font> <br>  <font color="#ff7700">return</font> <font color="#008000">all</font> </blockquote><br>  I will write all subsequent decisions through lambda expressions, since they consist of one expression.  The name of the argument is abbreviated to ll, it does not reduce readability in the one-line code. <br><blockquote>  <font color="#808080"># via anonymous function</font> <br>  listmerge = <font color="#ff7700">lambda</font> ll: simple-statement <br>  <font color="#808080"># equivalent to</font> <br>  <font color="#ff7700">def</font> listmerge <font>(</font> ll <font>)</font> : <br>  <font color="#ff7700">return</font> simple-statement </blockquote><br>  <b>OPTION 4</b> <br>  Using the built-in functions of working with lists, you can rewrite version 2 in the style of functional programming: <br><blockquote>  listmerge4a = <font color="#ff7700">lambda</font> ll: <font color="#008000">reduce</font> <font>(</font> <font color="#ff7700">lambda</font> a, b: a + b, ll, <font>[</font> <font>]</font> <font>)</font> <br>  listmerge4b = <font color="#ff7700">lambda</font> ll: <font color="#008000">sum</font> <font>(</font> ll, <font>[</font> <font>]</font> <font>)</font> </blockquote><br>  He is a little bit faster, but still inhibitory, for the same reason as his iterative relative.  Here "lambda a, b: a + b" is an anonymous function of two arguments that simply returns their sum.  Option B is just a shortcut built into Python for easy calculation of the sum of the elements.  This option is the shortest. <br><br>  Personally, I do not like neither the shortest (speed) nor the fastest (beauty).  Let's try to find a compromise. <br><br>  <b>OPTION5</b> <br>  Using list expressions: <br><blockquote>  listmerge5 = <font color="#ff7700">lambda</font> ll: <font>[</font> el <font color="#ff7700">for</font> lst <font color="#ff7700">in</font> ll <font color="#ff7700">for</font> el <font color="#ff7700">in</font> lst <font>]</font> </blockquote><br>  Not much longer than the previous one, but radically faster.  The variant is undoubtedly beautiful, although the nested list expressions are not always clear at first glance. <br><br>  <b>OPTION6</b> <br>  And what if you try to rewrite the fastest version in the functional style?  Easy: <br><blockquote>  listmerge6 = <font color="#ff7700">lambda</font> s: <font color="#008000">reduce</font> <font>(</font> <font color="#ff7700">lambda</font> d, el: d. <font>extend</font> <font>(</font> el <font>)</font> <font color="#ff7700">or</font> d, s, <font>[</font> <font>]</font> <font>)</font> </blockquote><br>  Note " <b>d.extend (el) or d</b> " we had to add the " <b>or</b> " operator; the <b>extend</b> method returns <b>None</b> .  In terms of speed, it is practically not inferior to the fastest method No. 3 (the difference in speed is literally a few percent and in my opinion is not significant). <br><br>  In my opinion, the " <b>editorial choice</b> " should be awarded option <b>number 6</b> ) <br><br>  For measuring the speed of small pieces of code in Python there is a <b>timeit</b> library.  Here is an example of code testing options 3, 5 and 6 (the fastest and most beautiful). <br><blockquote>  <font color="#ff7700">import</font> <font color="#dc143c">timeit</font> <br><br>  variants = <font>{</font> <br>  <font color="#483d8b">'Reduce'</font> : <br>  <font color="#483d8b">'listmerge = lambda s: reduce (lambda d, el: d.extend (el) or d, s, [])'</font> , <br>  <font color="#483d8b">'Iterate'</font> : <br>  <font color="#483d8b">"" "</font> <font color="#483d8b"><br></font>  <font color="#483d8b">def listmerge (lstlst):</font> <font color="#483d8b"><br></font>  <font color="#483d8b">all = []</font> <font color="#483d8b"><br></font>  <font color="#483d8b">for lst in lstlst:</font> <font color="#483d8b"><br></font>  <font color="#483d8b">all.extend (lst)</font> <font color="#483d8b"><br></font>  <font color="#483d8b">return all</font> <font color="#483d8b"><br></font>  <font color="#483d8b">"" "</font> , <br>  <font color="#483d8b">'Comprehension'</font> : <br>  <font color="#483d8b">'listmerge = lambda ll: [x for lst in ll for x in lst]'</font> , <br>  <font>}</font> <br><br>  initstr = <font color="#483d8b">'lstlst = [range (i) for i in range (1000)] <font color="#000099">\ n</font> gc.enable ()'</font> <br><br>  <font color="#ff7700">def</font> <font color="#dc143c">test</font> <font>(</font> variants, initstr, n = <font color="#ff4500">100</font> <font>)</font> : <br>  <font color="#ff7700">print</font> <font color="#483d8b">"Test repeats n ="</font> , n, <font color="#483d8b">"times <font color="#000099">\ n</font> INITSTR:"</font> , initstr, <font color="#483d8b">" <font color="#000099">\ n</font> <font color="#000099">\ n</font> "</font> <br>  <font color="#ff7700">for</font> k, v <font color="#ff7700">in</font> variants.  <font>iteritems</font> <font>(</font> <font>)</font> : <br>  <font color="#ff7700">print</font> k, <font color="#483d8b">"-"</font> , <font color="#dc143c">timeit</font> .  <font>Timer</font> <font>(</font> <font color="#483d8b">"listmerge (lstlst)"</font> , initstr + <font color="#483d8b">" <font color="#000099">\ n</font> "</font> + v <font>)</font> .  <font color="#dc143c">timeit</font> <font>(</font> n <font>)</font> <br>  <font color="#ff7700">print</font> <br><br>  <font color="#dc143c">test</font> <font>(</font> variants, initstr, <font color="#ff4500">100</font> <font>)</font> </blockquote><br>  An example of running a test time.  It can be seen that the difference in speed between the iterative and functional variants is vanishingly small.  The variant on the list expressions is noticeably slower (there is no way out of error here), but the size of our lists is huge, for applications that are not critical to speed, it also has the right to life. <br> <code>Test repeats n = 100 times <br> INITSTR: lstlst=[range(i) for i in range(1000)] <br> gc.enable() <br> <br> Iterate - 1.56133103371 <br> Reduce - 1.57647109032 <br> Comprehension - 7.5749669075 <br></code> <br><br>  <b>HOMEWORK</b> <br>  I propose to solve / discuss the more complex task of expanding nested lists to a linear one. <br>  Example: <br><blockquote>  <font color="#808080">Source list:</font> <br>  <font>[</font> <font color="#ff4500">7</font> , <font>[</font> <font>[</font> <font>[</font> <font>[</font> <font color="#ff4500">2</font> <font>]</font> <font>]</font> <font>]</font> , <font>[</font> <font>[</font> <font>[</font> <font>]</font> <font>]</font> , <font>[</font> <font color="#ff4500">4</font> <font>]</font> <font>]</font> , <font>[</font> <font color="#ff4500">4</font> , <font color="#ff4500">5</font> , <font>[</font> <font color="#ff4500">6</font> , <font color="#ff4500">7</font> <font>]</font> <font>]</font> , <font color="#ff4500">8</font> <font>]</font> <br>  <font color="#808080"># Result:</font> <br>  <font>[</font> <font color="#ff4500">7</font> , <font color="#ff4500">2</font> , <font color="#ff4500">4</font> , <font color="#ff4500">4</font> , <font color="#ff4500">5</font> , <font color="#ff4500">6</font> , <font color="#ff4500">7</font> , <font color="#ff4500">8</font> <font>]</font> </blockquote><br><br>  <b>UPD:</b> Answer <a href="http://habrahabr.ru/blogs/python/63539/">habrahabr.ru/blogs/python/63539/#comment_1764419</a> <br><br>  <b>UPD2:</b> <br>  <b>OPTION 6B</b> (from an anonymous commentator in LJ) <br><blockquote>  <font color="#ff7700">import</font> <font color="#dc143c">operator</font> <br>  listmerge6b = <font color="#ff7700">lambda</font> s: <font color="#008000">reduce</font> <font>(</font> <font color="#dc143c">operator</font> . <font>iadd</font> , s, <font>[</font> <font>]</font> <font>)</font> </blockquote></div><p>Source: <a href="https://habr.com/ru/post/63539/">https://habr.com/ru/post/63539/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../63530/index.html">You always break our toys!</a></li>
<li><a href="../63531/index.html">Did the Russian Post receive a dilom for information technology?</a></li>
<li><a href="../63534/index.html">Almost native Direct3D in VirtualBox</a></li>
<li><a href="../63537/index.html">Opera portal - now in Russian</a></li>
<li><a href="../63538/index.html">What to write the program?</a></li>
<li><a href="../63541/index.html">Miniature GSM2Wifi Hotspot - MIFI-2352</a></li>
<li><a href="../63543/index.html">JQuery checkbox categories tree</a></li>
<li><a href="../63545/index.html">Bing + twitter</a></li>
<li><a href="../63547/index.html">Electronic ruler</a></li>
<li><a href="../63550/index.html">EduMandriva 2009 Spring Addon Released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>