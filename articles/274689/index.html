<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Calculation of binomial coefficients in C (C ++) and Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When solving problems of combinatorics, it is often necessary to calculate the binomial coefficients. Bin Newton, i.e. decomposition  also uses binomi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Calculation of binomial coefficients in C (C ++) and Python</h1><div class="post__text post__text-html js-mediator-article">  When solving problems of combinatorics, it is often necessary to calculate the binomial coefficients.  Bin Newton, i.e.  decomposition <img src="https://habrastorage.org/getpro/habr/post_images/fad/203/7ac/fad2037acc6dff013bb9e1b5307eb82c.png" alt="image">  also uses binomial coefficients.  For their calculation, you can use the formula expressing the binomial coefficient through factorials: <img src="https://habrastorage.org/getpro/habr/post_images/01d/df4/164/01ddf4164554f2f65f67842dd8ea7dbf.png" alt="image">  or use the recurrence formula: <img src="https://habrastorage.org/getpro/habr/post_images/3f1/8bd/ee1/3f18bdee1558db7cb7b6b6c3458cda5f.png" alt="image">  From the Newton binomial and the recurrent formula, it is clear that the binomial coefficients are integers.  On this example, I wanted to show that even when solving a simple task, you can step on a rake. <br><a name="habracut"></a>  Before proceeding to the writing of calculation procedures, consider the so-called Pascal triangle. <br><pre><code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  or he, but in a slightly different form.  In the left column of the row, the value of n <img src="https://habrastorage.org/getpro/habr/post_images/fb5/4b1/c46/fb54b1c461f0baa8fac06559581c2350.png" alt="image">  for k = 0..n <br><pre> <code class="cpp hljs"> n   <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-number"><span class="hljs-number">70</span></span> <span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">84</span></span> <span class="hljs-number"><span class="hljs-number">126</span></span> <span class="hljs-number"><span class="hljs-number">126</span></span> <span class="hljs-number"><span class="hljs-number">84</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">210</span></span> <span class="hljs-number"><span class="hljs-number">252</span></span> <span class="hljs-number"><span class="hljs-number">210</span></span> <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span> <span class="hljs-number"><span class="hljs-number">330</span></span> <span class="hljs-number"><span class="hljs-number">462</span></span> <span class="hljs-number"><span class="hljs-number">462</span></span> <span class="hljs-number"><span class="hljs-number">330</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">66</span></span> <span class="hljs-number"><span class="hljs-number">220</span></span> <span class="hljs-number"><span class="hljs-number">495</span></span> <span class="hljs-number"><span class="hljs-number">792</span></span> <span class="hljs-number"><span class="hljs-number">924</span></span> <span class="hljs-number"><span class="hljs-number">792</span></span> <span class="hljs-number"><span class="hljs-number">495</span></span> <span class="hljs-number"><span class="hljs-number">220</span></span> <span class="hljs-number"><span class="hljs-number">66</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">78</span></span> <span class="hljs-number"><span class="hljs-number">286</span></span> <span class="hljs-number"><span class="hljs-number">715</span></span> <span class="hljs-number"><span class="hljs-number">1287</span></span> <span class="hljs-number"><span class="hljs-number">1716</span></span> <span class="hljs-number"><span class="hljs-number">1716</span></span> <span class="hljs-number"><span class="hljs-number">1287</span></span> <span class="hljs-number"><span class="hljs-number">715</span></span> <span class="hljs-number"><span class="hljs-number">286</span></span> <span class="hljs-number"><span class="hljs-number">78</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">91</span></span> <span class="hljs-number"><span class="hljs-number">364</span></span> <span class="hljs-number"><span class="hljs-number">1001</span></span> <span class="hljs-number"><span class="hljs-number">2002</span></span> <span class="hljs-number"><span class="hljs-number">3003</span></span> <span class="hljs-number"><span class="hljs-number">3432</span></span> <span class="hljs-number"><span class="hljs-number">3003</span></span> <span class="hljs-number"><span class="hljs-number">2002</span></span> <span class="hljs-number"><span class="hljs-number">1001</span></span> <span class="hljs-number"><span class="hljs-number">364</span></span> <span class="hljs-number"><span class="hljs-number">91</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">105</span></span> <span class="hljs-number"><span class="hljs-number">455</span></span> <span class="hljs-number"><span class="hljs-number">1365</span></span> <span class="hljs-number"><span class="hljs-number">3003</span></span> <span class="hljs-number"><span class="hljs-number">5005</span></span> <span class="hljs-number"><span class="hljs-number">6435</span></span> <span class="hljs-number"><span class="hljs-number">6435</span></span> <span class="hljs-number"><span class="hljs-number">5005</span></span> <span class="hljs-number"><span class="hljs-number">3003</span></span> <span class="hljs-number"><span class="hljs-number">1365</span></span> <span class="hljs-number"><span class="hljs-number">455</span></span> <span class="hljs-number"><span class="hljs-number">105</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">560</span></span> <span class="hljs-number"><span class="hljs-number">1820</span></span> <span class="hljs-number"><span class="hljs-number">4368</span></span> <span class="hljs-number"><span class="hljs-number">8008</span></span> <span class="hljs-number"><span class="hljs-number">11440</span></span> <span class="hljs-number"><span class="hljs-number">12870</span></span> <span class="hljs-number"><span class="hljs-number">11440</span></span> <span class="hljs-number"><span class="hljs-number">8008</span></span> <span class="hljs-number"><span class="hljs-number">4368</span></span> <span class="hljs-number"><span class="hljs-number">1820</span></span> <span class="hljs-number"><span class="hljs-number">560</span></span> <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br><br>  In full accordance with the recurrent value formula <img src="https://habrastorage.org/getpro/habr/post_images/a7e/83b/515/a7e83b5159606d91c7818769f95ffbc5.png" alt="image">  equal to 1 and any number is equal to the sum of the number above it and the number ‚Äúabove it + step to the left‚Äù.  For example, in the 7th line the number is 21, and in the 6th line the numbers are 15 and 6: 21 = 15 + 6.  It is also seen that the values ‚Äã‚Äãin the line are symmetric about the middle of the line, i.e. <img src="https://habrastorage.org/getpro/habr/post_images/ab7/4be/30e/ab74be30e9a36caa1e9e54d40462b59c.png" alt="image">  .  This is the symmetry property of the Newton binomial with respect to a and b and it can be seen in the factorial formula. <br>  Below for binomial coefficients <img src="https://habrastorage.org/getpro/habr/post_images/fb5/4b1/c46/fb54b1c461f0baa8fac06559581c2350.png" alt="image">  I will also use the C (n, k) representation (it is easier to type it, and the picture-formula can not be inserted everywhere. <br><br><h4>  Calculation of binomial coefficients using a factorial formula </h4><br>  since the binomial coefficients are non-negative, we will use the unsigned type in the calculations. <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   n unsigned fakt(int n) { unsigned r; for (r=1;n&gt;0;--n) r*=n; return r; } //  C(n,k) unsinged bci(int n,int k) { return fakt(n)/(fakt(k)*fakt(nk)); }</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Call the function bci (10,4) - it will return 210 and this is the correct value of the coefficient C (10.4).  So the calculation problem is solved?  Yes solved.  But not really.  We did not answer the question: <b>for what maximum values ‚Äã‚Äãof n, k will bci function correctly?</b>  Before we begin to look for the answer, let's agree that the type used by us is unsigned int 4-byte and the maximum value is 2 <sup>32</sup> -1 = 4'294'967'295.  For what n, k C (n, k) exceed it?  We turn to the triangle of Pascal.  It can be seen that the maximum values ‚Äã‚Äãare reached in the middle of the line  with k = n / 2.  If n is even, then there is one maximum value, and if n is odd, then there are two.  The exact value of C (34.17) is 2333606220, and the exact value of C (35.17) is 4537567650, i.e.  already more than the maximum unsigned int. <br>  We write a test procedure <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (n=<span class="hljs-number"><span class="hljs-number">10</span></span>;n&lt;=<span class="hljs-number"><span class="hljs-number">35</span></span>;++n) <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%u %u"</span></span>,n,bci(n,n/<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  C++   cout&lt;&lt;n&lt;&lt;" "&lt;&lt;bci(n,n/2)&lt;&lt;endl; }</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Run it and see</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">252</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">462</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">924</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">532</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">34</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br></div></div><br>  The value in the next line should be about 2 times greater than the previous one.  Therefore, the last correctly calculated coefficient (see the triangle above) is C (12.6). Although unsigned int holds 4 billion, values ‚Äã‚Äãless than 1000 are calculated correctly. Those times why so?  It's all about our bci procedure, more precisely in the string that first calculates a large number in the numerator, and then divides it into a large number in the denominator.  To calculate C (13,6), first 13 is calculated! And this number is&gt; 6 billion and it does not fit into an unsigned int. <br>  How to optimize the calculation <img src="http://mathurl.com/j74tvlm.png" alt="image">  ?  Very simple: open the 13!  and reduce the numerator and denominator by 7!  The result is <img src="http://mathurl.com/jhpmg2w.png" alt="image">  .  Let's program the calculation using this formula. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bci</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> k)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k&gt;n/<span class="hljs-number"><span class="hljs-number">2</span></span>) k=nk; <span class="hljs-comment"><span class="hljs-comment">//    k, nk..    C(n,k)=C(n,nk) if (k==1) return n; if (k==0) return 1; unsigned r=1; for (int i=1; i&lt;=k;++i) { r*=n-k+i; r/=i; } return r; }</span></span></code> </pre><br>  : <br><div class="spoiler">  <b class="spoiler_title">and test again</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">252</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">462</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">924</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">1716</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">3432</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">6435</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12870</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">24310</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">48620</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">92378</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">184756</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">352716</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">705432</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">1352078</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">2704156</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">5200300</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">10400600</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">20058300</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">40116600</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">77558760</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">155117520</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-number"><span class="hljs-number">14209041</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">28418082</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">39374192</span></span> <span class="hljs-number"><span class="hljs-number">34</span></span> <span class="hljs-number"><span class="hljs-number">78748384</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">79433695</span></span></code> </pre><br><br></div></div><br>  Clearly better, the error occurred when calculating C (31.15).  The reason is clear - all the same overflow.  First, multiply by 31 (op-pa - overflow, then divide by 15).  And what if to use the recursive formula?  There only addition, overflow should not be. <br>  Well, try: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bcr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> k)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k&gt;n/<span class="hljs-number"><span class="hljs-number">2</span></span>) k=nk; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k==<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k==<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bcr(n<span class="hljs-number"><span class="hljs-number">-1</span></span>,k)+bcr(n<span class="hljs-number"><span class="hljs-number">-1</span></span>,k<span class="hljs-number"><span class="hljs-number">-1</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (n=<span class="hljs-number"><span class="hljs-number">10</span></span>;n&lt;=<span class="hljs-number"><span class="hljs-number">35</span></span>;++n) <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%u %u"</span></span>,n,bcr(n,n/<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  C++   cout&lt;&lt;n&lt;&lt;" "&lt;&lt;bcr(n,n/2)&lt;&lt;endl; }</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Test result</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">252</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">462</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">924</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">1716</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">3432</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">6435</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">12870</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">24310</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">48620</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">92378</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">184756</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">352716</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">705432</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">1352078</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">2704156</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">5200300</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">10400600</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">20058300</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">40116600</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">77558760</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">155117520</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-number"><span class="hljs-number">300540195</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">601080390</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">1166803110</span></span> <span class="hljs-number"><span class="hljs-number">34</span></span> <span class="hljs-number"><span class="hljs-number">2333606220</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">242600354</span></span></code> </pre><br></div></div><br>  Everything that got into unsigned int was considered correct.  That's just a line with n = 34 was considered about a minute.  When calculating C (n, n / 2), two recursive calls are made, so the calculation time depends exponentially on n.  What to do - it turns out either inaccurate or slow.  Output - in the use of 64 bit variables. <br><br>  Comment on the results of discussions: a section was added at the end of the article, where a simple and fast version of <b>‚Äúbcr with memorization‚Äù of</b> one of the participants in the discussion is given. <br><br><h4>  Using 64 bit types to calculate C (n, k) </h4><br>  Replace in the bci unsigned int function with unsigned long long and test it in the range n = 34..68.  n = 34 is the maximum value that bci is correctly considered, and C (68.34) ~ 2.8 * 10 <sup>19</sup> no longer fits into an unsigned long long ~ 1.84 * 10 <sup>19</sup> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bcl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> k)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k&gt;n/<span class="hljs-number"><span class="hljs-number">2</span></span>) k=nk; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k==<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k==<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> r=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">1</span></span>; i&lt;=k;++i) { r*=n-k+i; r/=i; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (n=<span class="hljs-number"><span class="hljs-number">34</span></span>;n&lt;=<span class="hljs-number"><span class="hljs-number">68</span></span>;++n) <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%llu %llu"</span></span>,n,bcl(n,n/<span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//  C++   cout&lt;&lt;n&lt;&lt;" "&lt;&lt;bcl(n,n/2)&lt;&lt;endl; }</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Test result</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">34</span></span> <span class="hljs-number"><span class="hljs-number">2333606220</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">4537567650</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">9075135300</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span> <span class="hljs-number"><span class="hljs-number">17672631900</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">35345263800</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span> <span class="hljs-number"><span class="hljs-number">68923264410</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">137846528820</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> <span class="hljs-number"><span class="hljs-number">269128937220</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">538257874440</span></span> <span class="hljs-number"><span class="hljs-number">43</span></span> <span class="hljs-number"><span class="hljs-number">1052049481860</span></span> <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">2104098963720</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-number"><span class="hljs-number">4116715363800</span></span> <span class="hljs-number"><span class="hljs-number">46</span></span> <span class="hljs-number"><span class="hljs-number">8233430727600</span></span> <span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-number"><span class="hljs-number">16123801841550</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">32247603683100</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">63205303218876</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">126410606437752</span></span> <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">247959266474052</span></span> <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">495918532948104</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">973469712824056</span></span> <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">1946939425648112</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-number"><span class="hljs-number">3824345300380220</span></span> <span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-number"><span class="hljs-number">7648690600760440</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">15033633249770520</span></span> <span class="hljs-number"><span class="hljs-number">58</span></span> <span class="hljs-number"><span class="hljs-number">30067266499541040</span></span> <span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">59132290782430712</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">118264581564861424</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">232714176627630544</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> <span class="hljs-number"><span class="hljs-number">465428353255261088</span></span> <span class="hljs-number"><span class="hljs-number">63</span></span> <span class="hljs-number"><span class="hljs-number">321255810029051666</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">66050867754679844</span></span> <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">454676336121653775</span></span> <span class="hljs-number"><span class="hljs-number">66</span></span> <span class="hljs-number"><span class="hljs-number">350360427585442349</span></span> <span class="hljs-number"><span class="hljs-number">67</span></span> <span class="hljs-number"><span class="hljs-number">23341572944240599</span></span> <span class="hljs-number"><span class="hljs-number">68</span></span> <span class="hljs-number"><span class="hljs-number">46683145888481198</span></span></code> </pre><br></div></div><br>  We see that the error occurs when n = 63 for the same reason as in bci.  First multiply by 63 (and overflow), then division by 31. <br><h4>  Further improvement of accuracy and calculation for n&gt; 67 </h4><br>  The error occurred when n = 63, and when n = 68, the result no longer fits into unsigned64.  Therefore, it can be said that ‚Äúup to n &lt;= 62, the bcl function is correct, a further increase in accuracy requires either int128 or a long arithmetic‚Äù.  And if a very high accuracy is not needed, but I want to consider the binomial coefficients for n = 100 ... 1000?  Again, we take the bci procedure and change the unsigned int types to double in it: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bcd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> k)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k&gt;n/<span class="hljs-number"><span class="hljs-number">2</span></span>) k=nk; <span class="hljs-comment"><span class="hljs-comment">//    k, nk..    C(n,k)=C(n,nk) if (k==1) return n; if (k==0) return 1; double r=1; for (int i=1; i&lt;=k;++i) { r*=n-k+i; r/=i; } return ceil(r-0.2); //    ,    //    :   ,      //    . -   0.5   round   } void testd() { for (n=50;n&lt;=1000;n+=50) printf("%d %.16e\n",n,bcd(n,n/2)); //  C++   cout&lt;&lt;n&lt;&lt;" "&lt;&lt;bcd(n,n/2)&lt;&lt;endl; }</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Test result</b> <div class="spoiler_text">  50 1.2641060643775200e + 014 <br>  100 1.0089134454556417e + 029 <br>  150 9.2826069736708704e + 043 <br>  200 9.0548514656103225e + 058 <br>  250 9.1208366928185793e + 073 <br>  300 9.3759702772827310e + 088 <br>  350 9.7744946171567713e + 103 <br>  400 1.0295250013541435e + 119 <br>  450 1.0929255500575370e + 134 <br>  500 1.1674431578827770e + 149 <br>  550 1.2533112137626624e + 164 <br>  600 1.3510794199619429e + 179 <br>  650 1.4615494992533863e + 194 <br>  700 1.5857433585316801e + 209 <br>  750 1.7248900341772600e + 224 <br>  800 1.8804244186835327e + 239 <br>  850 2.0539940413411323e + 254 <br>  900 2.2474718820660189e + 269 <br>  950 2.4629741379276902e + 284 <br>  1000 2.7028824094543663e + 299 <br></div></div><br>  Even for n = 1000 it was possible to count!  Overflow double will occur when n = 1030. <br>  The discrepancy between the bcd calculation and the exact value starts with n = 57.  It is small - only 8. With n = 67, the deviation is 896. <br><h4>  For extreme sports and "Olympians" </h4><br>  In principle, for practical problems, the accuracy of the bcd function is sufficient, but in olympiad problems, tests are often given ‚Äúon the verge‚Äù.  Those.  theoretically, there may be a problem where double accuracy is not enough and C (n, k) fits into an unsigned long long barely.  How to avoid overflow for such extreme cases?  You can use a recursive algorithm.  But if he counted a minute for n = 34, then he would count years 100 for n = 67. You can memorize the calculated values ‚Äã‚Äã(see Addition after publishing). You can also use recursion not for all n and k, but only for ‚Äúbig enough‚Äù.  Here is the calculation procedure that counts correctly for n &lt;= 67.  Sometimes for n&gt; 67 with small k (for example, it considers C (82.21) = 1.83 * 10 <sup>19</sup> ). <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bcl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> k)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k&gt;n/<span class="hljs-number"><span class="hljs-number">2</span></span>) k=nk; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k==<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k==<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> r; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n+k&gt;=<span class="hljs-number"><span class="hljs-number">90</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//    ,   r=bcl(n-1,k); r+=+bcl(n-1,k-1); } else { r=1; for (int i=1; i&lt;=k;++i) { r*=n-k+i; r/=i; } } return r; }</span></span></code> </pre><br>  In one of the olympiad tasks I needed to calculate a lot of C (n, k) for n&gt; 70, i.e.  They obviously did not fit into an unsigned long long.  Naturally, I had to use "long arithmetic" (my own).  For this task, I wrote a ‚Äúrecursion with memory‚Äù: the calculated coefficients were stored in the array and there was no exponential increase in the calculation time. <br><br><h4>  Supplement after publication </h4><br>  When discussing, options with memorization of calculated values ‚Äã‚Äãare often mentioned.  I have a code with dynamic memory allocation, but I did not bring it.  For the time being, here is the simplest and most effective of the <b>chersanya</b> comment: <a href="http://habrahabr.ru/post/274689/">http://habrahabr.ru/post/274689/#comment_8730359http://habrahabr.ru/post/274689/#comment_8730359</a> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> bcr_cache[N_MAX][K_MAX] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bcr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> k)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k&gt;n/<span class="hljs-number"><span class="hljs-number">2</span></span>) k=nk; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k==<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k==<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bcr_cache[n][k] == <span class="hljs-number"><span class="hljs-number">0</span></span>) bcr_cache[n][k] = bcr(n<span class="hljs-number"><span class="hljs-number">-1</span></span>,k)+bcr(n<span class="hljs-number"><span class="hljs-number">-1</span></span>,k<span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bcr_cache[n][k]; }</code> </pre><br>  If the program should use [almost] all the coefficients of Pascal's triangle (to some level), then the reduced recursive algorithm with memorization is the fastest way.  Similar code is also suitable for unsigned long long and even for long arithmetic (although there, probably, it is better to dynamically calculate and allocate the required amount of memory).  Specific values ‚Äã‚Äãfor N_MAX can be: <br>  35 - count all coefficients C (n, k), n &lt;35 for unsigned int (32 bits) <br>  68 - count all coefficients C (n, k), n &lt;68 for unsigned long long (64 bits) <br>  200 - calculate the coefficients C (n, k), n &lt;200 and some k for unsigned long long (64 bits).  For example, for C (82.21) = ~ 1.83 * 10 <sup>19</sup> <br>  K_MAX - this can be N_MAX / 2 + 1, but not more than 35, since C (68,34) is unsigned long long abroad. <br>  For simplicity, you can always take K_MAX = 35 and not think ‚Äúgo in - not go in‚Äù (until we go to numbers with a bit depth&gt; 64 bits). <br><h4>  Calculation of binomial coefficients in Python </h4><br>  This supplement appeared about the weather after the publication of the article.  The author began to learn Python and for the training I solve the olimpiadnye tasks made earlier in C ++.  For tasks related to exact / long calculations, one has to either contrive in every way (as in the calculations of binomial coefficients), in order to avoid early overflow, or accept the loss of accuracy (by going to double type) or write (or search) long arithmetic.  In Python, long arithmetic is already there, so memorization is sufficient to calculate the binomial coefficients.  We will memorize them in the list (passed to the function as a papameter). <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     ,  / #     bcs  ,   n=4  k=2 def Binc(bcs,n,k): if (k&gt;n): return 0 if k&gt;n//2: k=nk #      -   if k==0: return 1 if k==1: return n while len(bcs)&lt;n-3: #   for i in range(len(bcs),n-3): r=[] for j in range(2,i//2+3): r.append(Binc(bcs,i+3,j-1)+Binc(bcs,i+3,j)) bcs.append(r) r=bcs[n-4] if len(r)&lt;k-1: #   for i in range(len(r),k-1): r.append(Binc(bcs,n-1,k-1)+Binc(bcs,n-1,k)) return bcs[n-4][k-2] #   #    C(1000,500) bcs=[] #     t1=time.clock() print(Binc(bcs,1000,500)) t2=time.clock() print(t2-t1) #        for n in range(0,16): print("n=%2d " % n,end="") for k in range(0,n+1): print("%5d" % Binc(bcs,n,k),end="") print()</span></span></code> </pre><br><br>  Here is the output (without label) <br>  270288240945436569515614693625975275496152008446548287007392875106625428705522193898612483924502370165362606085021546104802209750050679917549894219699518475423665484263751733356162464079737887344364574161119497604571044985756287880514600994219426752366915856603136862602484428109296905863799821216320 <br>  0.4200884663301988 <br>  Less than half a second for this ratio <br>  <b>C (68.34) (remember</b> , it does not fit into a long long) is calculated in 0.017 seconds and is equal to 28453041475240576740 </div><p>Source: <a href="https://habr.com/ru/post/274689/">https://habr.com/ru/post/274689/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../274679/index.html">Criminals who devastated ATMs with the help of the Tyupkin virus are caught</a></li>
<li><a href="../274681/index.html">Summary of registered second-level domains in the .RU zone</a></li>
<li><a href="../274683/index.html">jQuery plugin for building block mosaic</a></li>
<li><a href="../274685/index.html">VoIP + Cisco Packet Tracer</a></li>
<li><a href="../274687/index.html">IBDesignable magic or extend Interface Builder functionality in Xcode</a></li>
<li><a href="../274695/index.html">New WhatsApp vulnerability: a wave of emoticons that can block an application</a></li>
<li><a href="../274697/index.html">Results of the contest on programming on JS: Mail filters</a></li>
<li><a href="../274703/index.html">Security Week 01: Javascript Ransommer, $ 100k for a bug in Adobe Flash, an encrypted bright future</a></li>
<li><a href="../274705/index.html">Spark local mode: handling large files on a regular laptop</a></li>
<li><a href="../274707/index.html">The total capacity of LeaseWeb networks reached 5 Tbit / s: instant dedicated servers in the Netherlands from $ 39 only a week</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>