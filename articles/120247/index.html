<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Touchpad and keyboard from the handy device on Windows Mobile</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Do you have a communicator with WM and the need to control your PC with it? 

 Maybe you want to spend some tricky presentation that requires a mouse ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Touchpad and keyboard from the handy device on Windows Mobile</h1><div class="post__text post__text-html js-mediator-article">  Do you have a communicator with WM and the need to control your PC with it? <br><br>  Maybe you want to spend some tricky presentation that requires a mouse in your pocket? <br><img src="https://habrastorage.org/storage/habraeffect/7e/e8/7ee8fb0ae07561da2988e8771fc65f06.jpg" alt="image"><br><br>  Ok, you need a cat (there are pictures). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you are only interested in the final product, but not technical details, I recommend not to go to the FAQ section without stopping. <br><a name="habracut"></a><br><h4>  Concept </h4><br>  Task: Turn the WM-communicator into a full-fledged touchpad and keyboard, and at the same time gain the ability to control any win-system with its help. <br>  In general, a managed system may not be win, but more on that below. <br>  As a transport, we will use UDP / IP over Wi-Fi, or (for connoisseurs) Bluetooth. <br>  What is required for this: <ul><li>  capture input from the default keyboard of the device; </li><li>  using the touchscreen communicator to emulate: <ul><li>  the usual touchpad, with scrolls and clicks; </li><li>  mouse wheel; </li><li>  mouse buttons (with the ability to move the cursor while holding the click for drag'n'drop); </li></ul></li><li>  an application on a managed system (server) capable of writing to the keyboard and mouse stream the data received from the device; </li><li>  protocol of the client application exchange with the server on the managed system. </li></ul>  In order, the client part is <br><br><h4>  WM application </h4><br>  Written under the <b>.NET Compact Framework 3.5</b> on <b>C #</b> , tested on <b>HTC HD2</b> with <b>WM 6.5</b> . <br>  The client application does not use any vendor-specific API, so it should work on all devices with WM 5 and 6. <br>  The principle of capturing input from the keyboard and touchscreen is extremely simple: <ol><li>  Create some kind of control, and stretch it to fit the window (Dock = Fill); </li><li>  We put a focus on him; </li><li>  Subscribe to KeyDown, KeyUp, KeyPress events to intercept keystrokes; </li><li>  MouseDown, MouseUp, MouseMove for touchpad emulation. </li></ol><br><h5>  Touchpad </h5><br>  A little about the terms in which the principle of touchpad emulation is expressed - they are used in the further description: <ul><li>  Static Move - if the user has pulled his finger to the border of the touchpad and left it there, the controlled cursor will slowly crawl in the direction of that border.  Convenient for dragging the cursor with a clicked click; </li><li>  Scroll - the user ran his finger over a particular region at the edge of the touchpad, which is interpreted as a scrolling wheel; </li><li>  Scroll Pad is the ‚Äúspecial region‚Äù mentioned above at the edge of the touchpad.  If the finger starts moving on it, then scrolling is activated, otherwise it works like a normal touchpad. </li><li>  Inertial Scrolling - the user activated scrolling, and removed his finger, without stopping his movement.  Scrolling will be performed further at the same speed without user intervention, until he is able to touch the touchpad again. </li><li>  Click and Drag - clicked, removed the finger, and immediately pressed again - now you can steer the cursor with the click pressed. </li></ul>  The touchpad logic is implemented in the MouseHandler class, here it is: <br><img src="https://habrastorage.org/storage/habraeffect/ab/3a/ab3a0c96181f830ee9b9d3a22dd20cd9.png" alt="image"><br>  ConfigApply and ConfigStore are irrelevant;  All MouseHandler work comes down to handling its events, whose purpose as a whole is clear from the names. <br><br><h5>  Keyboard </h5><br>  The device is trivial: <br><img src="https://habrastorage.org/storage/habraeffect/52/e4/52e40edf62b440956553d5f6f381dc7b.png" alt="image"><br>  Developments: <ul><li>  OnKeyCommand - received a control character, <a href="http://msdn.microsoft.com/en-us/library/dd375731">one of these</a> .  In general, they are standardized. </li><li>  OnKeyUnicode - received a printable character.  K.O.  notices that in unicode. </li></ul><h5>  Customer </h5><br>  Class whose task is to generate control messages for sending to the server: <br><img src="https://habrastorage.org/storage/habraeffect/4d/d0/4dd087301ceac694b3247747d4d24b10.png" alt="image"><br>  We get the requested action through a method of the type KeyboardCommand (), MouseMove (), etc;  form the message, send it to the socket via the OnPacketSend event. <br><br><h5>  Configs </h5><br>  The user is presented with a unique opportunity to edit their configs in the root XML format. <br>  How the application implements work with them, see for yourself if anyone is interested.  I do not want to talk about it. <br><img src="https://habrastorage.org/storage/habraeffect/32/ea/32ea2f74ecbf236856ee7b0bdd5f7c51.jpg" alt="image"><br><br>  Screen: <br> <a href=""><img src="https://habrastorage.org/storage/habraeffect/b1/3f/b13ffaee87efc42e445a05597ebdcdac.png" alt="image"></a> <br><br>  The purpose of the main configs fields, which is not obvious from the name: <ul><li>  buttonRightClickHold - show the right-click lock button.  Those.  when you press it, the right click sticks until you press again.  By default, the button is not shown. </li><li>  buttonSettings - show the button for calling the concise editor of configs, whose screenshot is available above.  By default, this button is for some reason turned on. </li><li>  clickAndDragDelay - the time during which you need to re-click on the touchpad to get Click and Drag (description above). </li><li>  locationUpdateInterval - the cursor position update interval, in milliseconds. </li><li>  staticSpeed ‚Äã‚Äã- Static Move speed, pixels per packet. </li><li>  staticBoundsRelative - field boundaries where Static Move is activated;  set relative to the total size of the window. </li><li>  scrollInMousePixels - sensitivity Scroll Pad;  the smaller the number, the higher the sensitivity. </li></ul><h5>  Interface </h5><br>  When drawing the interface, I was inspired by the popular picture of Kazimir Malevich: <br> <a href=""><img src="https://habrastorage.org/storage/habraeffect/f0/d9/f0d9424df72c7b768e4842c772bb408a.png" alt="image"></a> <a href=""><img src="https://habrastorage.org/storage/habraeffect/d3/11/d3118505d0e57d1853f2fc011bb7acb6.png" alt="image"></a> <br>  Since the GUI is considered to be a self-documenting user interface, I still left button labels (screen on the left), which disappear after the first touch of the touchpad (screen on the right). <br>  Yes, I have not said: this black field on the screen is the touchpad;  the purpose of the buttons should be obvious from their name.  Using the keyboard, too, should not cause questions. <br>  The portrait orientation of the window is used to save screen space for the touchpad;  at the same time the use of the touchpad itself is assumed in the landscape (but it is customizable). <br><br><h4>  Server </h4><br>  The first attempt to create a more or less cross-platform server using python and <a href="http://www.rutherfurd.net/python/sendkeys/">SendKeys</a> failed because it turned out that SendKeys does not know Unicode.  How to work from a python with a mouse, I did not even look. <br>  The second attempt (successful) was using WinAPI from a console application in C, where the work of writing commands to the mouse and keyboard stream is performed using the <a href="http://msdn.microsoft.com/en-us/library/ms646310%2528VS.85%2529.aspx">SendInput</a> function. <br>  A simple console application that listens to a UDP socket and periodically calls SendInput () is not worth considering.  I note only that it practically does not consume system resources (especially when the client is disabled), so that it can be kept running all the time. <br><br>  As far as portability is concerned, it is not difficult to write a platform-specific application for any other platform (the audience would need it), since a simple to implement command is used to deliver commands to the managed system <br><br><h4>  Protocol </h4><br>  Data is transmitted only from the client to the server, no confirmation or return commands are provided. <br>  Any command is sent in a fixed-size frame consisting of the following fields: <ul><li>  header - 3 bytes, the string "d2k" </li><li>  packet sequence number (to avoid packet repetition during broadcasting, which is used by default) - 1 byte </li><li>  command type (control character, unicode character, move mouse, etc) - 1 byte </li><li>  these commands (cursor coordinates, character code, etc) - 4 bytes, little endian </li></ul>  Default port 12358 (selection prompted by a <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D1%2581%25D0%25BB%25D0%25B5%25D0%25B4%25D0%25BE%25D0%25B2%25D0%25B0%25D1%2582%25D0%25B5%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C_%25D0%25A4%25D0%25B8%25D0%25B1%25D0%25BE%25D0%25BD%25D0%25B0%25D1%2587%25D1%2587%25D0%25B8">sequence</a> fragment). <br><br><h4>  FAQ </h4><br>  <b>Q:</b> Ok, I want to use Device2Keyboard.  What do I need to do for this? <br>  <b>A:</b> Download the client and server application on the links at the end of the post, and run them.  The default settings assume that the communicator and the server must be on the same subnet, since the client has the default server address 255.255.255.255:12358 (broadcast IP address).  Everything will work out of the box, no additional configuration is required. <br><br>  <b>Q:</b> I do not want to use wireless interfaces.  How to be? <br>  <b>A:</b> Connect the communicator to a managed PC with ActiveSync installed, leaving the default client settings.  Everything will work. <br><br>  <b>Q:</b> I fixed a click by executing Drag'n'Drop, but the connection to the server was interrupted, and the click remained clamped.  What to do? <br>  <b>A:</b> Wait 3 seconds.  If the server does not receive a command to set the state of mouse clicks from the client during this time, it will release all held buttons. <br><br>  <b>Q:</b> When the mouse cursor is moved for a long time, my network will fall down due to the terrible traffic, right? <br>  <b>A: The</b> default frequency of updating the cursor position is 10 ms (100 times per second);  packet size (3 + 1 + 1 + 4) == 9 bytes, + overhead UDP / IP frame 28 bytes, we get 37 bytes in 1 message, or 3.6 kbit / s.  If the mouse does not move, its position is not updated.  The answer is negative. <br><br><h4>  Conclusion </h4><br>  Application for WM and desktop, installation do not require: <a href="">dl.dropbox.com/u/3815390/dev2kbd/bin/bin.7z</a> <br>  Sources: <a href="">dl.dropbox.com/u/3815390/dev2kbd/src/src.7z</a> <br>  The application and its sources are distributed under the <a href="http://ru.wikipedia.org/wiki/WTFPL">WTFPL</a> license. <br>  Photo from the title, source: <a href="http://migdal-or.livejournal.com/55703.html">migdal-or.livejournal.com/55703.html</a> </div><p>Source: <a href="https://habr.com/ru/post/120247/">https://habr.com/ru/post/120247/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../120239/index.html">ASUS Padfone first-hand: smart tablet on Computex</a></li>
<li><a href="../120240/index.html">Client for Lenta.ru for Android</a></li>
<li><a href="../120244/index.html">Firefox 6 integrates a Workspace extension for previewing scripts</a></li>
<li><a href="../120245/index.html">CUPP Computing Introduces Hybrid Netbook</a></li>
<li><a href="../120246/index.html">Samsung in the photographic market</a></li>
<li><a href="../120248/index.html">Offline Maps / Android Navigation</a></li>
<li><a href="../120249/index.html">June 8 - Java developers meeting with Rendell Thomas</a></li>
<li><a href="../120252/index.html">HTML5 Presentation</a></li>
<li><a href="../120254/index.html">Microsoft does not consider cookiejacking a serious threat.</a></li>
<li><a href="../120257/index.html">Hacking keys for money - estimate based on the Bitcoin network</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>