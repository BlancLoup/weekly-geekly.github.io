<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Modern JWT authorization for modern Kode framework Node.js</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The authorization task arises in almost every Node.js project, however, in order to properly configure it, you need to connect a large number of modul...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Modern JWT authorization for modern Kode framework Node.js</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/9f1/065/544/9f1065544cd44b658d69b7697b2a9bd9.png" alt="image"><br>  The authorization task arises in almost every Node.js project, however, in order to properly configure it, you need to connect a large number of modules and collect a bunch of information from different sources. <br><br>  In this article, I will describe a complete authorization solution based on JSON Web Token (JWT) for Node.js and Koa with the storage of password hashes in MongoDB.  The reader is expected to have a basic knowledge of Node.js and how to work with MongoDB through Mongoose. <br><a name="habracut"></a><br>  A few words about what exactly will be discussed and why. <br><br>  <b>Why Koa.</b>  Despite the much greater popularity of the Express framework, <a href="http://koajs.com/">Koa</a> provides the ability to write applications using the modern async / await syntax.  Using async / await instead of callbacks is a big enough incentive to get a closer look at this framework. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Why JWT.</b>  The approach to authorization using sessions can already be called obsolete, since it does not allow its use in mobile applications and where there is no support for cookies.  Also problems with sessions can arise in cluster systems.  JWT authorization does not have these disadvantages, and has several additional advantages.  Read more about JWT <a href="https://jwt.io/introduction/">here.</a> <br><br>  The article will consider a complete authorization solution using: <br><br><ol><li>  passport.js.  The de facto standard for working with authorization in Node.js projects </li><li>  password hashing and hash storage in MongoDB database </li><li>  authentication for REST API </li><li>  authentication for socket.io, which is usually a more complex topic than p.3 </li></ol><br>  To preserve the educational value of the article in the code there will be no extended checks for errors and exceptions, which often make the code less understandable.  Therefore, before using code examples in production, you need to work on error handling and control of client input. <br><br><h3>  So, let's begin </h3><br>  1. <b>Connect the Koa.</b>  Unlike Express, Koa is a lighter framework and therefore is usually used with a number of additional modules. <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Koa = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'koa'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  const Router = require('koa-router'); //  const bodyParser = require('koa-bodyparser'); //   POST  const serve = require('koa-static'); // ,      index.html    const logger = require('koa-logger'); //      .   . const app = new Koa(); const router = new Router(); app.use(serve('public')); app.use(logger()); app.use(bodyParser());</span></span></code> </pre> <br>  2. <b>Connect <a href="http://passportjs.org/">Passport.js</a></b> .  Passport.js allows you to flexibly configure authorization using different mechanisms called Strategies (local, social networks etc.).  Currently, the library has more than 300 strategies. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> passport = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'koa-passport'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// passport  Koa const LocalStrategy = require('passport-local'); //   const JwtStrategy = require('passport-jwt').Strategy; //   JWT const ExtractJwt = require('passport-jwt').ExtractJwt; //   JWT app.use(passport.initialize()); //  passport app.use(router.routes()); //   const server = app.listen(3000);//     3000</span></span></code> </pre><br>  3. <b>Connect work with JWT.</b>  In a nutshell, JWT is just JSON in which, for example, a user's email can be stored.  This JSON is signed by a secret key that does not allow this email to be changed, although it allows it to be read. <br><br>  Thus, when you receive from a JWT client, you are sure that the user you came for is the one who claims to be himself (provided that his JWT was not stolen by someone, but this is another story). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> jwtsecret = <span class="hljs-string"><span class="hljs-string">"mysecretkey"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    JWT const jwt = require('jsonwebtoken'); //   JWT  hhtp const socketioJwt = require('socketio-jwt'); //   JWT  socket.io</span></span></code> </pre><br>  4. <b>Connect <a href="">socket.io.</a></b>  In a nutshell, socket.io is a module for applications that react to changes occurring on the server, for example, it can be used for chat.  If the server and browser support the WebSockets protocol, then socket.io will use it, otherwise it will look for other mechanisms for implementing two-way communication between the browser and the server. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> socketIO = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'socket.io'</span></span>);</code> </pre><br>  5. We <b>connect MongoDB</b> for storage of objects of users. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mongoose = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mongoose'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//      MongoDB const crypto = require('crypto'); //  node.js     ,  ..   .</span></span></code> </pre><br><h3>  Now let's run it all together. </h3><br>  The user object ( <b>user</b> ) will consist of its name, e-mail and password hash. <br><br>  To convert a password obtained from a POST request into a hash that will be stored in the database, the concept of virtual fields is used.  A virtual field is a field that is in the Mongoose model, but which is not in the MongoDB database. <br><br><pre> <code class="javascript hljs">mongoose.Promise = <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  Mongoose    mongoose.set('debug', true); //  Mongoose       .     mongoose.connect('mongodb://localhost/test'); //    test   .   ,    .</span></span></code> </pre><br>  We create the scheme and model for the User: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> userSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mongoose.Schema({ <span class="hljs-attr"><span class="hljs-attr">displayName</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">email</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">required</span></span>: <span class="hljs-string"><span class="hljs-string">' e-mail'</span></span>, <span class="hljs-attr"><span class="hljs-attr">unique</span></span>: <span class="hljs-string"><span class="hljs-string">' e-mail  '</span></span> }, <span class="hljs-attr"><span class="hljs-attr">passwordHash</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">salt</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, }, { <span class="hljs-attr"><span class="hljs-attr">timestamps</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); userSchema.virtual(<span class="hljs-string"><span class="hljs-string">'password'</span></span>) .set(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">password</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._plainPassword = password; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (password) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.salt = crypto.randomBytes(<span class="hljs-number"><span class="hljs-number">128</span></span>).toString(<span class="hljs-string"><span class="hljs-string">'base64'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.passwordHash = crypto.pbkdf2Sync(password, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.salt, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-string"><span class="hljs-string">'sha1'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.salt = <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.passwordHash = <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>; } }) .get(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._plainPassword; }); userSchema.methods.checkPassword = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">password</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!password) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.passwordHash) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> crypto.pbkdf2Sync(password, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.salt, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-string"><span class="hljs-string">'sha1'</span></span>) == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.passwordHash; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> User = mongoose.model(<span class="hljs-string"><span class="hljs-string">'User'</span></span>, userSchema);</code> </pre><br>  For a deeper understanding of the mechanism of working with password hashes, you can read about the <b>pbkdf2Sync</b> command in the Node.js <a href="https://nodejs.org/api/crypto.html">dock</a> <br><br><h4>  We configure work with Passport.js </h4><br>  The user authorization process is as follows: <br><br>  <b>Step 1.</b> A new user is registered and a record is created about him in the MongoDB database. <br>  <b>Step 2. The</b> user logs in with the password on the site and upon successful input of the login and password receives JWT. <br>  <b>Step3.</b>  The user enters an arbitrary resource, sends his JWT, by which he is authorized without entering a password. <br><br>  The configuration mechanism of Passport.js consists of two stages: <br><br>  <b>Stage 1.</b> Setting up Strategies.  Upon successful authorization, the strategy returns the user object described earlier in the userSchema schema. <br>  <b>Step 2.</b> Using the user object obtained in step 1 for further actions, for example, creating a JWT for it. <br><br><h4>  <b>Stage 1</b> </h4><br>  Customize Passport Local Strategy.  In more detail, how the strategy works can be read on <a href="https://github.com/jaredhanson/passport-local">here</a> . <br><br><pre> <code class="javascript hljs">passport.use(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LocalStrategy({ <span class="hljs-attr"><span class="hljs-attr">usernameField</span></span>: <span class="hljs-string"><span class="hljs-string">'email'</span></span>, <span class="hljs-attr"><span class="hljs-attr">passwordField</span></span>: <span class="hljs-string"><span class="hljs-string">'password'</span></span>, <span class="hljs-attr"><span class="hljs-attr">session</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">email, password, done</span></span></span><span class="hljs-function">) </span></span>{ User.findOne({email}, (err, user) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> done(err); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!user || !user.checkPassword(password)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> done(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, {<span class="hljs-attr"><span class="hljs-attr">message</span></span>: <span class="hljs-string"><span class="hljs-string">'     .'</span></span>}); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> done(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, user); }); } ) );</code> </pre><br>  Customize Passport JWT Strategy.  In more detail, how the strategy works can be read on <a href="https://github.com/themikenicholson/passport-jwt">here</a> . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  JWT  Header const jwtOptions = { jwtFromRequest: ExtractJwt.fromAuthHeader(), secretOrKey: jwtsecret }; passport.use(new JwtStrategy(jwtOptions, function (payload, done) { User.findById(payload.id, (err, user) =&gt; { if (err) { return done(err) } if (user) { done(null, user) } else { done(null, false) } }) }) );</span></span></code> </pre><br><h4>  <b>Stage 2</b> </h4><br>  We will create a REST API that will work with the user object. <br><br>  The API will consist of three endpoints that correspond to the three steps of the authorization process described above. <br><br>  Post request for / user - creates a new user.  Usually this API is called when a new user is registered.  In the body of the request, we expect JSON with the name, mail and password of the user. <br><br><pre> <code class="javascript hljs">router.post(<span class="hljs-string"><span class="hljs-string">'/user'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span>(ctx, next) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ctx.body = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> User.create(ctx.request.body); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { ctx.status = <span class="hljs-number"><span class="hljs-number">400</span></span>; ctx.body = err; } });</code> </pre><br>  Post request for / login creates a JWT to use.  In the body of the request, we expect to receive JSON in which the mail and password of the user will be.  In production, it is logical to issue JWT also when registering a user. <br><br><pre> <code class="javascript hljs">router.post(<span class="hljs-string"><span class="hljs-string">'/login'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span>(ctx, next) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> passport.authenticate(<span class="hljs-string"><span class="hljs-string">'local'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, user</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (user == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { ctx.body = <span class="hljs-string"><span class="hljs-string">"Login failed"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//--payload -            const payload = { id: user.id, displayName: user.displayName, email: user.email }; const token = jwt.sign(payload, jwtsecret); //  JWT ctx.body = {user: user.displayName, token: 'JWT ' + token}; } })(ctx, next); });</span></span></code> </pre><br>  A GET request for / custom checks for a valid JWT. <br><br><pre> <code class="javascript hljs">router.get(<span class="hljs-string"><span class="hljs-string">'/custom'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span>(ctx, next) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> passport.authenticate(<span class="hljs-string"><span class="hljs-string">'jwt'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, user</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (user) { ctx.body = <span class="hljs-string"><span class="hljs-string">"hello "</span></span> + user.displayName; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ctx.body = <span class="hljs-string"><span class="hljs-string">"No such user"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"err"</span></span>, err) } } )(ctx, next) });</code> </pre><br>  Now let's make the final chord for setting up authorization for socket.io.  The problem here is that the WebSockets protocol runs on top of tcp, not http and the REST API mechanisms do not apply to it.  Fortunately, for it there is a module socketio-jwt, which allows you to quite concisely describe the authorization through JWT. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> io = socketIO(server); io.on(<span class="hljs-string"><span class="hljs-string">'connection'</span></span>, socketioJwt.authorize({ <span class="hljs-attr"><span class="hljs-attr">secret</span></span>: jwtsecret, <span class="hljs-attr"><span class="hljs-attr">timeout</span></span>: <span class="hljs-number"><span class="hljs-number">15000</span></span> })).on(<span class="hljs-string"><span class="hljs-string">'authenticated'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">socket</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'    : '</span></span> + socket.decoded_token.displayName); socket.on(<span class="hljs-string"><span class="hljs-string">"clientEvent"</span></span>, (data) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(data); }) });</code> </pre><br>  More details about authorization via JWT for socket.io can be read <a href="https://auth0.com/blog/auth-with-socket-io/">here</a> . <br><br><h3>  Conclusion </h3><br>  Using the code above, you can build a working Node.js application using a modern authorization approach.  Of course, in production, you will need to add a number of checks, which are usually standard for this kind of application. <br><br>  The full version of the code with a description of how to test it can be viewed in <a href="https://github.com/waubau/koa_jwt_auth">GitHub.</a> </div><p>Source: <a href="https://habr.com/ru/post/324066/">https://habr.com/ru/post/324066/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324052/index.html">Another algorithm for recovering blurred images</a></li>
<li><a href="../324056/index.html">The path to the dream</a></li>
<li><a href="../324060/index.html">What is Resizable Concurrent Map</a></li>
<li><a href="../324062/index.html">Count to three</a></li>
<li><a href="../324064/index.html">5 reasons to enter the international marketplace</a></li>
<li><a href="../324068/index.html">How to feed cattle. Advice to the head of the developer unit</a></li>
<li><a href="../324070/index.html">FPGA Image Filtering</a></li>
<li><a href="../324072/index.html">Software defined storage: compare 7 solutions</a></li>
<li><a href="../324076/index.html">Mitap MSK.NET Community</a></li>
<li><a href="../324078/index.html">Report from Data Fest‚Å¥ February 11-12</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>