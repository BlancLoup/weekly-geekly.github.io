<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Arduino and aquarium</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is common in the north of Italy and tropical fish? But you never know what? - the reader will say. And he will be right. Therefore, I will clarif...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Arduino and aquarium</h1><div class="post__text post__text-html js-mediator-article">  What is common in the north of Italy and tropical fish?  But you never know what?  - the reader will say.  And he will be right.  Therefore, I will clarify: it will be about Arduino, more precisely about the automation of aquarium maintenance. <br>  It all started with the fact that the vacation was inexorably approaching.  On vacation, I usually want to change the situation.  But aquarium fish may not understand this.  Not only that - they can not forgive.  And I ordered a new filter, an automatic feeder and a timer for household appliances.  But the timer was not available.  Therefore, I decided to wander around the site of almost the only store (and this is in the city, which is considered a million-plus!) Radio components and devices, and ran into Arduino Uno for 154 UAH.  (~ $ 20).  More than once read about the device, but in the hands, as they say, did not hold.  Bought.  And from this moment begins the history of trial, error and victory. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">For those who did not face Arduino - I will explain.</b> <div class="spoiler_text">  <i>This is a hardware and software platform.</i>  <i>Iron is based on an Atmel ATmega microcontroller and is equipped with a variety of I / O ports.</i>  <i>The software part is the development environment and a set of libraries.</i>  <i>Iron, of course, costs some money (in fact, prices, even for originals from Italy, are affordable), and software is free.</i>  <i>Downloaded from the official site.</i>  <i>With the help of software, you can control I / O ports.</i>  <i>Present ports with <a href="http://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B8%25D1%2580%25D0%25BE%25D1%2582%25D0%25BD%25D0%25BE-%25D0%25B8%25D0%25BC%25D0%25BF%25D1%2583%25D0%25BB%25D1%258C%25D1%2581%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BC%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D1%258F%25D1%2586%25D0%25B8%25D1%258F">PWM</a> .</i> <i><br></i>  <i>Working with Arduino is pretty easy due to the presence of many libraries.</i>  <i>For example, there are libraries for working with temperature sensors, digital and graphic (yes!) Displays, various protocols, etc.</i>  <i>In general, you need to connect to one or more ports of Arduino whose electronic circuit you want to manage (or with which you need to receive data), download the appropriate library (if it is not in the standard package), write a program using the Arduino language (based on the Wiring language) Arduino development environment (based on the Processing environment).</i>  <i>Fill the compiled program via USB into the Arduino's iron memory, and, voila!</i>  <i>- we get the desired result (if everything is done correctly).</i>  <i>And, yes, the program remains in the memory of the piece of iron even after turning off the power.</i> <i><br></i> <br></div></div><br>  The most important task that I wanted to delegate to Arduino is to control the lighting on a schedule.  Yes, from the cannon on the sparrows, but for a guest from Italy (actually from China, but this does not matter) I have some big plans. <br>  Until now, the aquarium was illuminated with an energy-saving light bulb, it was necessary to turn it on and off manually.  It is clear that the strict time regime was not maintained, especially on weekends.  Now, in order to simplify the task and make lighting more durable, it was decided to switch to 12V LEDs.  I bought a meter of waterproof LED strip.  Collected the scheme: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9e4/d48/4f6/9e4d484f6b7b8ccc6e619425c969df1a.jpg" alt="image" width="300"><br><br>  The field-effect transistor dropped out of a non-working computer power supply unit.  In general, I tried to use as much as possible what was available at hand.  But you can take almost any, for example IRFBC30.  The resistor is needed to ensure the reliability of the circuit: the ultralow currents "go to the ground" and the field effect transistor opens and closes only at high and low states at the Arduino pin.  It is also recommended that a limiting resistor be set to a hundred or second ohm between the gate and the port pin, but in this scheme it can be neglected. <br>  <i><b>UPDATE!</b></i>  <i>The comments are still very insistent on the limiting resistor.</i>  <i>Well, let's listen.</i>  <i>We put a 100 Ohm resistor between the Arduino pin and the gate.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Then I found an Internet program in the open spaces (this example was inserted only to explain the structure of the program ‚Äúon fingers‚Äù): <br><br><div class="spoiler">  <b class="spoiler_title">Program for beginners</b> <div class="spoiler_text"><pre><code class="hljs ruby">int ledPin = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     <span class="hljs-number"><span class="hljs-number">5</span></span> void setup() { pinMode(ledPin, OUTPUT); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      () } void loop() { digitalWrite(ledPin, HIGH); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-number"><span class="hljs-number">1</span></span>  digitalWrite(ledPin, LOW); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   delay(<span class="hljs-number"><span class="hljs-number">5000</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-number"><span class="hljs-number">5</span></span>  }</code> </pre> <br></div></div><br>  Earned!  The LEDs flash occasionally. <br><br>  Small explanations to the program. <br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> setup()</code> </pre>  - this function is launched at each start of the iron. <br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>()</code> </pre>  - fulfills in a cycle. <br>  The rest is clear from the comments. <br>  Then there was the question of time synchronization.  After all, when you turn off the power and turn it on again, the program will start from scratch.  Considered three options: use homemade UPS (which is not so cheap and easy to implement);  synchronize with the Internet (the corresponding board is more expensive than my Arduino);  synchronize with the clock.  Pretty soon I found the RTC (real time clock, yes, it sounds weird in Russian) on the World Wide Web compatible with Arduino. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5d4/80b/0d9/5d480b0d94624ada12c88074800333a4.jpg" alt="image" width="350"><br><br>  Very simple scheme.  Resistors can be set from 4.7 to 10 kŒ©.  You will also need a DS1307 clock chip and a 32768 Hz clock quartz, battery.  The holder for the battery (CR 2032) picked up with the packaging of a computer motherboard.  Since historically on the board I already had a transistor for the LED control circuit soldered, I placed the clock nearby. <br>  If suddenly after assembling the watches it is impossible to set the time on the clock or they ‚Äústand‚Äù, then check the correctness of the connections and their quality.  It is necessary to move one wiring from the chip - and the clock behaves badly.  And yes, place the DS1307 on a DIP panel. <br>  The clock must be initialized, i.e.  set the correct date and time.  This can be done as follows. <br><br><div class="spoiler">  <b class="spoiler_title">Clock initialization program</b> <div class="spoiler_text"><pre> <code class="hljs dos">#include &lt;Wire.h&gt; #include &lt;DS1307.h&gt; void setup() { Serial. begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>); RTC.stop(); //  RTC.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DS1307_SEC, <span class="hljs-number"><span class="hljs-number">0</span></span>); //  RTC.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DS1307_MIN, <span class="hljs-number"><span class="hljs-number">36</span></span>); //  RTC.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DS1307_HR, <span class="hljs-number"><span class="hljs-number">15</span></span>); //  RTC.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DS1307_DOW, <span class="hljs-number"><span class="hljs-number">2</span></span>); //   RTC.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DS1307_DATE, <span class="hljs-number"><span class="hljs-number">4</span></span>); /   RTC.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DS1307_MTH, <span class="hljs-number"><span class="hljs-number">1</span></span>); //  RTC.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DS1307_YR, <span class="hljs-number"><span class="hljs-number">14</span></span>); //  RTC.<span class="hljs-built_in"><span class="hljs-built_in">start</span></span>(); //  } void loop() { Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(RTC.get(DS1307_HR, true)); //       Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(":"); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(RTC.get(DS1307_MIN, false)); //     Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(":"); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(RTC.get(DS1307_SEC, false)); //     Serial.println(" "); delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); }</code> </pre><br></div></div><br>  DS1307 library can be downloaded <a href="">here</a> . <br>  After the program is loaded into the controller, it is possible to observe in the console (Serial Monitor, Ctrl + Shift + M) how time ‚Äúruns‚Äù. <br><br>  But back to our schemes and parts. <br>  Then I saw a DS18B20 digital thermometer wiring diagram transmitting data via the 1-Wire interface.  There is even a special Arduino library for this thermometer that allows the tightrope walker and fast forward of Bavaria to easily obtain temperature data in a readable form.  Connected, played-played - shows -127 ‚Å∞.  It turned out that the connection scheme is wrong (and I chose a scheme with active power).  The thermometer documentation helped.  Moral: the scheme on the site is good, and the official documentation is better. <br><br>  Below is the correct scheme.  You can connect multiple thermometers to a single 1-Wire line.  It is advisable to use a coaxial cable. <br><img src="http://vsesovety.info/sites/default/files/Arduino-termp.jpg" alt="image" width="450"><br><br><div class="spoiler">  <b class="spoiler_title">A small lyrical digression.</b> <div class="spoiler_text"><br>  I did everything wrong in this project: I soldered temporary schemes as ideas arrived, then I adjusted the connections for the case, the corpus, took the parts I had in my hands and practically did not leave room for adding functionality - once everything would have to be done anew ( and still had to!).  Therefore, I urge you to do the opposite: <br>  1) determine the functionality; <br>  2) determine the details; <br>  3) select the case on the basis of the first two points; <br>  4) dilute the fee based on the first three points. <br>  And so it is necessary to do in almost any electronic project. <br>  If there is a need to test this or that idea - use special prototyping boards and a set of connections.  Yes, I know their prices bite.  But believe me, save a lot of time and nerves. <br></div></div><br>  Then came the turn of the display (well, how to be without displaying the same temperature?).  I took the standard text two lines of 16 characters.  Hooked up.  It worked.  He displayed the readings of the thermometer and the clock.  I understood that time was not spent in vain.  The backlight significantly heated the display, so it turned off. <br><img src="https://habrastorage.org/getpro/habr/post_images/d0e/e7e/e57/d0ee7ee577441f147cc235f1d3cb11c8.jpg" alt="Arduino display"><br>  Display wiring diagram. <br><br>  A trimmer is needed to set the display contrast.  Button K1 provides power to the backlight. <br>  The 4th pin of the display is the address signal line.  Known as A0 or RS.  Depending on whether it is 0 or 1, the display understands whether we have a command on the data line like ‚Äúmove the cursor‚Äù or the character code to display. <br>  The 6th pin of the display is the data access permission line.  Known as E or Enable.  When this line becomes a unit, the display executes the command or outputs a character from the data line. <br>  The 11th, 12th, 13th, and 14th display pins are data lines.  Known as DB4, DB5, DB6, DB7. <br><br>  Clock and display "in the gland." <br><img src="https://habrastorage.org/getpro/habr/post_images/dfc/25d/e83/dfc25de83a61f55da68dbd9ab0b0c093.jpg" alt="Arduino display" width="500"><br><br>  Now it‚Äôs the turn of the power supply, since before that I used two different power supplies: 5V for the display and the clock, and 9V for the Arduino and the LEDs.  Again, there was a power supply for 24V, 1.7 A at hand. I‚Äôll say right away that this is not enough for the + Arduino LEDs.  It is better to take the PSU at 3A, and control the brightness using PWM.  To get the 5 and 10V I needed, I assembled the shemk on the LM317T.  Why 10V?  According to the Arduino documentation, it‚Äôs better not to power more than 12V, LEDs with less voltage should also last longer.  Therefore, I decided to get 10V.  In fact, it was 10.4V.  Again - did not split hairs and collected at a minimum of parts.  Scheme. <br><img src="https://habrastorage.org/getpro/habr/post_images/b84/b71/de6/b84b71de6a3d80aec0e3421f5f258da3.jpg" alt="image" width="450"><br><br>  But if there is time, desire and opportunity, it is still better to assemble a full-fledged impulse power supply unit that would give out at 10-11V to 2-2.5A. <br>  Since the LM317 heat up appreciably, I attached them to the radiator from PII (remember, were there any such slot CPUs from Intel?), Resistors were hinged.  Filled the whole thing epoxy.  Attention: the LM317 housing is connected to the output leg, so if you mount the LM317 for different voltages on one radiator, then at least N-1 chips must be isolated from the radiator.  And all is better.  From the side of the radio parts, I covered the radiator with a plastic cover, and left the ribs ‚Äúbare‚Äù.  Caught on the eyes of a 9-pin RS232 served as a power connector from the output of the stabilizer. <br><br>  It's time to put it all together.  And then came the difficulty.  Although not.  Difficulties came when I began to change the temporary connecting wires to permanent.  Such, multi-core, I took from the four-wire telephone cables that came to hand. <br>  Spacious housing with a margin in size is, as for me, indecently expensive - $ 10 or more.  If I spread the board under the case - there would be no problems, and so I had to improvise.  I took the body Maszczyk KM51.  The circuit board had to be divided into two parts, Arduino attached to the cover.  And all because of the fact that it was too lazy to remake. <br>  It turned out that's what. <br><img src="https://habrastorage.org/getpro/habr/post_images/e4d/288/ede/e4d288edebdd37a29e392e85ab37bc61.jpg" alt="image"><br><br>  Yes, it looks, to put it mildly, not so hot.  But you just had to adjust the board to the dimensions and openings of the case, solder pins into it and put Arduino on them.  It would be beautiful and reliable.  In general - <i>do not do</i> as in the photo above. <br><br>  In this performance, all this did not work for long - the hack did not survive the weekly vacation.  So I had to redo it. <br>  This time I took a suitable board and placed pins on it to connect the Arduino.  Or rather two boards, since on the controller board there are two connectors on each side and the distance of 2.54 mm is not maintained for the entire row of pins.  It turned out not very aesthetically pleasing, but it works. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/41c/300/210/41c30021017ddaf26b7dc251fb80a79e.jpg" alt="image" width="500"><br><br>  Placed items. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/908/37a/33e/90837a33ecd74c73fa7e26c8933ae1d5.jpg" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/ec1/de9/5b5/ec1de95b5371fad57e24f340f186f4fe.jpg" alt="image"><br><br><div class="spoiler">  <b class="spoiler_title">In the collection.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/905/b56/1f8/905b561f8997c3cd3725b1ac5f5f8e0f.jpg" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/20e/7fd/e1a/20e7fde1a4bf7629174df17004fe002c.jpg" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/8c4/f41/997/8c4f4199798af30ae86cd2a799c3b01b.jpg" alt="image"><br></div></div><br>  There are three connectors on the board: thermal sensors, LEDs, power supply (just in case you soldered a larger connector, all of a sudden it will be necessary to supply more than one voltage in the future).  On the case: USB, Arduino power supply directly (not used), power to the whole circuit (+ 12V). <br>  This time I gave up two voltages, and gave one - because the Arduino issues 5V to one of the connectors.  True - the current there is rather weak, but for the operation of the clock and the display is enough.  Through a microbutton (visible in the photo above), he supplied power to the backlight.  Now you can briefly highlight the screen. <br>  I bought another thermometer and changed the program to reflect the display of two temperatures: in the aquarium and in the room.  To connect the DS18B20, it is better to use a cable with a shielding ‚Äúminus‚Äù, but there wasn‚Äôt any one at hand - the same telephone four-core wire took all. <br><br><div class="spoiler">  <b class="spoiler_title">The final program.</b> <div class="spoiler_text"><pre> <code class="hljs ruby">/* *<span class="hljs-regexp"><span class="hljs-regexp">/ #include &lt;Wire.h&gt; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     #include &lt;OneWire.h&gt; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      1-Wire #include &lt;DS1307.h&gt; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       DS1307 #include &lt;LiquidCrystal.h&gt; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      LCD   #include &lt;DallasTemperature.h&gt; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       18B20 #define TempPin 2 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ pin    int ledPin = 3; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  ,   pin 3 LiquidCrystal lcd(6, 7, 10, 11, 12, 13); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  OneWire oneWire(TempPin); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ ,        DallasTemperature tempSensor(&amp;oneWire); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       long tmIntv = 1000; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/        long tempIntv = 30000; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   ,     long prvMlsTm = 0; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       long prvMlsTemp = 0; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       long prvMlsLght = 0; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       long lghtIntv = 60000; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   /</span></span>  , <span class="hljs-number"><span class="hljs-number">1</span></span>  int lghtStat = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  ,   <span class="hljs-number"><span class="hljs-number">1</span></span> int upLghtTime = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-number"><span class="hljs-number">8</span></span>  int downLghtTime = <span class="hljs-number"><span class="hljs-number">17</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-number"><span class="hljs-number">17</span></span>  int isNight = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   , ..     int prevSec = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       /<span class="hljs-regexp"><span class="hljs-regexp">/   Arduino void setup(){ pinMode(ledPin, OUTPUT); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      () tempSensor.begin(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  lcd.begin(16, 2); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/,   16     lcd.print("Time:"); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ "Time" if (upLghtTime &gt; downLghtTime) { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   isNight = 1; } } void printTemp () { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    float aTemp; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  float rTemp; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  tempSensor.requestTemperatures(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      rTemp = tempSensor.getTempCByIndex(0); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       0 aTemp = tempSensor.getTempCByIndex(1); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       1 lcd.setCursor(0, 1); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   lcd.print("R: "); lcd.print(rTemp); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   lcd.setCursor(7, 1); lcd.print(" A: "); lcd.print(aTemp); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   lcd.setCursor(15, 1); lcd.print(" "); lcd.home(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  ,     32  } void light () { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   int hr; int isLght = <span class="hljs-number"><span class="hljs-number">0</span></span>; hr = RTC.get(DS1307_HR, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isNight == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hr &gt;= upLghtTime &amp;&amp; hr &lt; downLghtTime) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  isLght = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { isLght = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(hr - upLghtTime &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     ,     isLght = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(hr &lt; downLghtTime) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   ,     isLght = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { isLght = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } } /<span class="hljs-regexp"><span class="hljs-regexp">/  :   ? if((isLght == 1) &amp;&amp; (lghtStat == 0)) { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/          lghtStat = 1; digitalWrite(ledPin, HIGH); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/,       } else { if(isLght == 0 &amp;&amp; lghtStat == 1) { lghtStat = 0; digitalWrite(ledPin, LOW); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/,       } } } void printTime () { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/-     int hr; int minut; int sec; lcd.setCursor(7, 0); hr = RTC.get(DS1307_HR, true); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  if( hr &lt; 10) { lcd.print('0'); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  0    10 } lcd.print(hr); lcd.print(":"); minut = RTC.get(DS1307_MIN, false); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  if( minut &lt; 10) { lcd.print('0'); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  0    10 } lcd.print(minut); lcd.print(":"); sec = RTC.get(DS1307_SEC, false); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  if( sec &lt; 10) { lcd.print('0'); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  0    10 } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  ,    ,        -   if(prevSec == sec) { RTC.start(); } prevSec = sec; lcd.print(sec); } void loop() /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    { unsigned long currentMillis = millis(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  ,     delay(),      , /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    -  /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/          /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/        ,    if(currentMillis - prvMlsTm &gt; tmIntv) { prvMlsTm = currentMillis; printTime(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ -      } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/        ,    if(currentMillis - prvMlsTemp &gt; tempIntv) { prvMlsTemp = currentMillis; printTemp(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       /</span></span> ,    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(currentMillis - prvMlsLght &gt; lghtIntv) { prvMlsLght = currentMillis; light(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> -   /  } }</code> </pre><br></div></div><br>  Download libraries here: <a href="">DallasTemperature</a> , <a href="">OneWire</a> . <br>  The need to turn on / off the aquarium lighting is checked every minute, the temperature - every 30 seconds, and the time is updated every second. <br><br>  The converted device has worked for a week without any complaints. <br><br>  Again, in a good way, it was necessary to do a little wrong, and get rid of the wires in general.  But I was too lazy to buy a slightly smaller display (I blocked the hole for fastening the case) and spread the board.  But if we take, for example, double-sided glass fiber (one-sided, it is hardly possible to manage, given the number of connectors on the controller and the display), to separate the connections, then it is quite possible to get something like this: <br><br><div class="spoiler">  <b class="spoiler_title">Implementation option</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/2ac/c4b/511/2acc4b51102da83463c688143d15c26e.jpg" alt="image"><br></div></div><br>  When the summer comes, and it happens to be hot here, I also plan to implement the fan control for cooling the aquarium based on the thermometer reading.  I consider two options: 12V fans with switching on in the same way as the backlight, or 230V AC fan.  In this case, instead of the LEDs, a relay with a control voltage of + 12V and switching 230V is included in the circuit. <br><img src="https://habrastorage.org/getpro/habr/post_images/8a4/a97/b3d/8a4a97b3da607c96e88c36c022639cc7.jpg" alt="image" width="300"><br>  In the same way, it is possible to control the heating of the aquarium in winter by switching on a heater in the relay circuit. <br><br>  What else can be improved from what is already there?  For example, turn the backlight on and off gradually using the PWM output.  In this case, with a certain interval, you must perform: <br><br> <code>analogWrite(pin, value);</code> <br> <br>  where pin is the port number of the Arduino, and value varies from 0 to 255 when turned on and from 255 to 0 if the aquarium light is turned off. <br>  You may also need to turn on the lighting manually.  I have a separate lamp for this, but if there is none, it can be implemented with the help of an Arduino.  The idea in this case is as follows.  One of the inputs of the Arduino through a non-latching button to apply voltage from the output + 5V.  Connect the ‚Äúground‚Äù to the same input through a 10 kŒ© resistor.  Then monitor the button press: <br><br><pre> <code class="hljs ruby">int isLight = <span class="hljs-number"><span class="hljs-number">0</span></span>; buttonState = digitalRead(buttonPin); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buttonState == HIGH) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isLight == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   isLight == <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   isLight == <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br><br>  where buttonPin is the port number to which the button is connected;  isLight is a variable that remembers the current state and when you click on the button it changes to the opposite.  In this code it is necessary to enable the corresponding on / off lines of the LEDs after the comment.  The first time you press the button, the light will turn on, and when it is pressed again, it will turn off. <br>  You can still, and probably need to automate the feeding with the help of Arduino.  After all, sold feeders are either expensive or do not have the necessary functionality, or both. <br>  And, of course, about good, it would be necessary to implement the installation of the interval of the lighting without flashing Arduino.  For example, assign two or even one buttons to it. <br><br>  And this is not all that can be implemented on the Arduino.  Even with the Arduino Uno, there is the potential for both managing and retrieving data when servicing an aquarium.  And this is without significant time and money. </div><p>Source: <a href="https://habr.com/ru/post/212519/">https://habr.com/ru/post/212519/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../212507/index.html">Why language Verilog microcontroller programmer</a></li>
<li><a href="../212509/index.html">ASUS Transformer Book Trio: tested in humans</a></li>
<li><a href="../212511/index.html">JetPoint. Big data</a></li>
<li><a href="../212513/index.html">Firefox introduces shared account and updates sync system.</a></li>
<li><a href="../212517/index.html">Where and how will search for extraterrestrial life after Mars</a></li>
<li><a href="../212521/index.html">Asynchronous queues in the code</a></li>
<li><a href="../212523/index.html">Datacenter at the Russian border: Excursion to the Viikinm√§ki Datacenter</a></li>
<li><a href="../212525/index.html">About programmer communities</a></li>
<li><a href="../212529/index.html">Plan 9 operating system published under GPLv2</a></li>
<li><a href="../212531/index.html">Work with usb video camera in Linux. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>