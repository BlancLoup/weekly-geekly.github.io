<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to teach scanners to scan silently by buttons without windows and crutches?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How to make scanners in general (it will be about Canoscan LIDE 210) silently click a button to scan a file with the necessary parameters in the desir...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to teach scanners to scan silently by buttons without windows and crutches?</h1><div class="post__text post__text-html js-mediator-article">  How to make scanners in general (it will be about Canoscan LIDE 210) silently click a button to scan a file with the necessary parameters in the desired folder? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/71d/b52/2df/71db522df7aa815e24b2a9e2e965a378.jpg" alt="image"></div><br><br>  In my opinion, this is the most common task, and to solve it, the manufacturer gives us the most uncommon solutions. <br>  In the next versions, manufacturers will probably add something like ‚Äúsend scan to facebook‚Äù or ‚Äúshare on Twitter‚Äù to their software, but to make a quiet mode, set up once and scan without any windows ... we will not live to see it before. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At the end of the article is a ready-made utility that allows you to scan from any button of any scanner to any folder without any manifestation on the screen.  And now let's start with how we managed to realize this ... <a name="habracut"></a><br><br>  Without native software, the Canoscan LIDE 210 buttons do not want to work.  And with the native - cause terrible indignation.  It is impossible to scan by buttons without opening the native application.  To change the software, yes there is nothing.  Secretaries because of the stress they have to look at cats because of this 5% more time, maybe that's why they are so popular? (Cats)).  I came across this problem three years ago in a previous scanner model, I ran into this problem today.  I read the comments of many people vybeshennyh this problem. <br><br>  <i>We have an A5 Plusteck 550 passport scanner in the office, it‚Äôs really three times more expensive, but its software silently knows how to do what is indicated in its settings from the buttons.</i>  <i>Thank God that almost all scanners have long supported polling standards TWAIN and WIA.</i>  <i>This means that in the windows family they should work without their software and generally without installing any manufacturer drivers.</i> <br><br>  We can tear down if desired all standard software.  We will work through <s>our own windowless application via WIA</s> (download <a href="http://www.gssezisoft.com/main/product/cmdtwain/">CmdTwain</a> <s>or, at the end of the article, our <a href="https://habr.com/ru/post/200528/">utility</a></s> ). <br><br>  Method 1 is more theory.  I recommend all the same <a href="https://habr.com/ru/post/200528/">method 2</a> <br><br>  It is written in c # due to the number of ready-made examples.  It works very simple: <br><br><ul><li>  Search for the first scanner in the system. </li><li>  Saves the scan to the directory whose address is passed by the parameter. </li><li>  Allows you to assign yourself to any button of the scanner through a standard Windows interface </li></ul><br><br>  With the first two points is clear, and the third we just consider in this article.  From the desktop, the utility works fine.  We launch it, it searches for a scanner, and scans it into the folder that was specified by the parameter at startup.  But we need to ensure that it is invoked by a button from the scanner, and not by a click from the desktop.  It is best to put it somewhere in this window: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/145/a33/864/145a33864d7051eeadeeb4b4bd4c5c98.png" alt="image"><br><br>  To be honest, information about this is quite small, Google did not reveal to me America as well as msdn.  There are several sources (hi icopy), but they are not working ... But somehow, the Canon manufacturer (in this case, MP Navigator EX 4.0, and in the screenshot above, Photoshop) managed to do it and we will try to find out how. <br><br><h4>  Finding a solution </h4><br>  All the necessary entries are stored in the registry (and where else?) And we will use the free <b>Regshot</b> application ( <a href="http://sourceforge.net/projects/regshot/">http://sourceforge.net/projects/regshot/</a> ) to search for changes.  It allows you to remove two registry snapshots and show changes. <br>  We take a snapshot of the registry before installing MP Navigator EX 4.0 and after, and save the result of the comparison in html file for analysis. <br><br>  I will not give all the log that we received.  From it, two keys in the registry were interesting for us. <br><h4>  Method 1. </h4><br><br><pre><code class="hljs tex">HKLM<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SYSTEM</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CurrentControlSet</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Control</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Class</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span>6BDD1FC6-810F-11D0-BEC7-08002BE2092F}<span class="hljs-tag"><span class="hljs-tag">\</span></span></code> </pre> <br><br>  This branch is responsible for scanners and webcams.  It contains, in the form of folders, your USB connections for image pickup devices. <br>  If the device is connected to any USB port for the first time, a folder with the next sequence number and a nested hierarchy inherent to the connected device type is created.  Different scanners may have different sections. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/de2/7c4/573/de27c45739e9d9470db369383c2a43f5.png" alt="image"><br><br>  When connecting Canoscan LIDE 210, a directory 0014 was created with two subfolders of DeviceData and Events.  If your scanner supports 5 buttons, in the Events folder you will see each of them even with a description of the action in the key values.  (however, not everything is so logical, see below) <br><br>  If you connect the scanner for the first time via this USB, then the PushButtonPushed sections will be empty.  Otherwise, you will find folders with names in the form of a GUID and keys with a description of the associated software, links to the executable file TP. <br>  This folder is a designated event through the Windows interface in the properties of the scanner.  Delete folders with GIUD keys, the binding will be reset.  You can delete them without problems. <br><br>  <i>But you can not delete the folder 0014 in any case.</i>  <i>They are not restored even when driver drivers are run and will not work with wia anymore.</i>  <i>Verified by</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/08c/16a/85a/08c16a85abfe7ceebf7b9a0bed45f25a.png" alt="image"><br><br>  You can repeat this folder yourself by changing the GUID of the partition and the path to the executable file.  Similarity logic works here.  Only a GUID come up unique. <br><br>  Like that: <br><pre> <code class="hljs pgsql">Windows Registry Editor <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span> <span class="hljs-number"><span class="hljs-number">5.00</span></span> [HKEY_LOCAL_MACHINE\<span class="hljs-keyword"><span class="hljs-keyword">SYSTEM</span></span>\CurrentControlSet\Control\<span class="hljs-keyword"><span class="hljs-keyword">Class</span></span>\{<span class="hljs-number"><span class="hljs-number">6</span></span>BDD1FC6<span class="hljs-number"><span class="hljs-number">-810</span></span>F<span class="hljs-number"><span class="hljs-number">-11</span></span>D0-BEC7<span class="hljs-number"><span class="hljs-number">-08002</span></span>BE2092F}\<span class="hljs-number"><span class="hljs-number">0014</span></span>\Events\PushButtonPushed1\{<span class="hljs-number"><span class="hljs-number">9927</span></span>FCDF<span class="hljs-number"><span class="hljs-number">-2047</span></span><span class="hljs-number"><span class="hljs-number">-4571</span></span>-B318<span class="hljs-number"><span class="hljs-number">-762646</span></span>A98111}] "Name"="Notepad salo" "Desc"="Notepad" "Icon"="sti.dll,0" "Cmdline"="C:\\Project1.exe /StiDevice:%1 /StiEvent:%2"</code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/249/4f8/21e/2494f821e0a13f0b3073560da5df5bf4.png" alt="image"><br><br>  <b>Changes to the system will take effect after reconnecting the USB connector.</b> <br><br>  <i>Project1.exe application output parameters% 1 and% 2</i> <br>  Now we can admire that our test application has appeared in the event binding window: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa1/553/cf7/aa1553cf744520bd7adcdba586409a7b.png" alt="wia"><br><br>  <s><i>However, I don‚Äôt understand the fact that at least in the registry we created a folder with the path before launching our application, at the root of whose parent is ‚ÄúButton for sending an email‚Äù in the windows button binding window, our application is available for another event.</i></s>  <s><i>Why so ... I have not fully figured out.</i></s> <br><br>  By clicking on the scanner button, we see our console application displaying the parameters.  Hooray. <br><img src="https://habrastorage.org/getpro/habr/post_images/7f3/9ef/f49/7f39eff49eb9c8c289262838137a9d26.png" alt="wia"><br><br><a name="nmnm"></a><h4>  Method 2 </h4><br><br><pre> <code class="hljs tex">HKEY_LOCAL_MACHINE<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SYSTEM</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ControlSet</span></span></span></span>001<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Control</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StillImage</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Events</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">STIProxyEvent</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span></span></code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/017/1ae/801/0171ae8014d3ba009cccca5eda82a97f.png" alt="STIProxyEvent"><br><br>  What are the Proxy Events? <br>  The section created in this directory allows you to globally be accessible to your application in the scan properties for linking to buttons.  It allows you to assign an event to the current connected scanner via the Windows interface. <br><br>  <i>In the first case, you will have to guess on which folder (0014 in our case) your scanner is hanging.</i> <br><br>  Enough to write in this section, and your application will be available for all events, and when you bind the WIA driver makes a copy of the STIProxyEvent to the desired button on the scanner. <br><br>  A <b>reboot is required for the</b> changes to take effect <b>.</b>  (changed the path to the application? Similarly - reboot.) Or restart the WIA service. <br><br><pre> <code class="hljs pgsql">Windows Registry Editor <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span> <span class="hljs-number"><span class="hljs-number">5.00</span></span> [HKEY_LOCAL_MACHINE\<span class="hljs-keyword"><span class="hljs-keyword">SYSTEM</span></span>\ControlSet001\Control\StillImage\Events\STIProxyEvent\{<span class="hljs-number"><span class="hljs-number">9927</span></span>FCDF<span class="hljs-number"><span class="hljs-number">-2047</span></span><span class="hljs-number"><span class="hljs-number">-4571</span></span>-B318<span class="hljs-number"><span class="hljs-number">-762646</span></span>A98111}] "Name"="" "Desc"="" "Icon"="sti.dll,0" "Cmdline"=" C:\\twia\\WIATest.exe C:\\scans"</code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/cbc/4f6/d58/cbc4f6d580689ea7467937572844101d.gif" alt="image"><br><br>  As you can see in the picture above, we can hang on any key our utility, which works fine. <br><br>  The event assignment is simply a copy of the directory from the <b>STIProxyEvent</b> to the corresponding <b>PushButtonPushed</b> folder described in the first case. <br><br><h4>  Total </h4><br><br><ul><li>  You should understand that when you change the USB connector to another, you will have to repeat the binding of events to the buttons.  This is not a flaw, it works even with official products.  Changed the connector - the mood of the button. </li><li>  The registry branch STIProxyEvent is needed only as a master.  At the time it is assigned to the application buttons, WIA copies the section from the EventProxy branch to the desired event folder of the scanner button. </li><li>  In the properties of the scan, in the events, the drop-down list with applications for linking to the scanner buttons is built from 2 branches, with STIProxyEvent and all PushButtonPushed folders located in the parent directory. </li><li>  Brightness, dpi and other settings through the utility is not necessary.  She uses the default profile that is configured here. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/c10/ad8/812/c10ad8812bfb9a7cb52b911fc51aa6a9.png" alt="image"><br><br>  That's probably all.  With other scanners, I think everything will be the same for - wia.  Delete the standard software is not necessary. <br>  And yet, duplicate registry branches for 64 bit systems is not necessary.  They somehow do it themselves - conveniently) <br><br>  It's nice when such a mess, you can so neatly settle. <br><br> <b><a name="a"></a></b>  <b>Utility (win7-64 and win 8-64):</b> <br>  Open with the help of the archiver (7zip, etc.) a picture or rename to zip <div class="spoiler">  <b class="spoiler_title">Installation</b> <div class="spoiler_text">  1) Unpack the archive in the right place (for example C: \ wiatest) <br><br>  2) Run via cmd.exe <br>  "C: \ wiatest \ WIATest.exe reg C: \ 1221" <br><br>  Where <br>  <b>reg</b> - make an entry in the registry.  (This is the second paragraph of the article) <br>  <b>and the second parameter</b> ‚ÄúC: \ 1221‚Äù is the desired way to save your scans. <br><br>  3) Reboot and assign the desired scanner button in the Control Panel -&gt; devices and printers-&gt; right click on the scanner -&gt; scan properties -&gt; Events for "4 cats".  Now this button on the scanner will save scans in ‚ÄúC: \ 1221‚Äù. <br><br>  You can simply make a shortcut with one parameter ‚ÄúC: \ wiatest \ WIATest.exe C: \ 1221‚Äù then the utility will simply scan into the folder ‚ÄúC: \ 1221‚Äù or any other. <br></div></div><br><br>  Not yet available for download.  There is a bug. <br><br>  <b>UPDATE.</b>  11/08/13 <br><br>  1) <b>Canon mp280</b> reviews initially somehow crookedly works through the image wizard.  It scans only 1/4 of the A4 format with hard copying wherever possible in A4 format.  They say this bug is treated by updating drivers. <br><br>  The reader of the article and the owner of this device was offered a solution to repeat the idea through VBscript compiled in exe.  <a href="http://pastebin.com/ce5d8yFi">pastebin.com/ce5d8yFi</a> </div><p>Source: <a href="https://habr.com/ru/post/200528/">https://habr.com/ru/post/200528/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200512/index.html">Football Manager 2014 released and available under Linux</a></li>
<li><a href="../200514/index.html">IGoogle closed</a></li>
<li><a href="../200516/index.html">We aim from the gun</a></li>
<li><a href="../200518/index.html">Tape is still the leader in data backup</a></li>
<li><a href="../200522/index.html">Look: Android vs iOS</a></li>
<li><a href="../200530/index.html">The best startups of the Runet or the composition of the semi-finalists Web Ready 2013</a></li>
<li><a href="../200532/index.html">Coursera Launches Learning Hubs ‚Äî Physical Premises for Online Courses</a></li>
<li><a href="../200534/index.html">Automatic exclusion from the distribution of non-working email addresses</a></li>
<li><a href="../200538/index.html">Device Server - interface converter or simple Tibbo PLC?</a></li>
<li><a href="../200540/index.html">Spread of epidemics: Social media analysis VS. Google Flu Query Analysis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>