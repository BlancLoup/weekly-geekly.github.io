<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We lay virtual networks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Since the Internet (or rather, ARPAnet) has been a small American grid, a lot of kissel has flowed. Now the network is a large unsafe place where prot...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We lay virtual networks</h1><div class="post__text post__text-html js-mediator-article">  Since the Internet (or rather, ARPAnet) has been a small American grid, a lot of kissel has flowed.  Now the network is a large unsafe place where protecting your data is one of the priorities.  About how less afraid I‚Äôll tell you in this little opus. <br><a name="habracut"></a><br><br><h4>  1. Suppose ... </h4><br>  We have two wonderful jobs, one at the office at work and the other at home.  And we have the task of how convenient it is to take files from work to home and from home to work.  Carry on a CD?  Inconvenient.  Wear on a flash drive?  You torture to copy every time.  And suddenly it is not known what files will be needed today?  Carry all at once?  Not an option.  Especially in the courtyard of the 21st century, the Internet is as fast as ever, and there are unlimited rates in almost every city (well, if not now, then in the foreseeable future they will definitely be).  So what to do?  Combine computers into a local network and quietly copy files, connect to a remote desktop and even play games (well, you never know, whoever wants it). <br><br><h4>  2. What ... </h4><br>  With the help of the free program OpenVPN, we will combine our two computers (and maybe more) into a single virtual network.  All transmitted data will be securely encrypted using Blowfish with a key of up to 448 bits (hacking with the current power of computers is simply unrealistic). <br>  OpenVPN is best put together with the GUI.  You can download all this miracle from the <a href="http://openvpn.se/download.html">official site OpenVPN GUI</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  3. How to ... </h4><br>  So, we have two computers.  One of them has an external IP-address (well, most likely home, because in offices they often sit at firewalls), and the other is hidden behind NAT.  It's clear that it will be problematic to connect to the computer that is hidden behind the NAT, especially if you want to download files from it.  Because the server OpenVPN we choose a home computer, and as the client will be our office PC.  So let's get started. <br><br><h4>  4. Installation </h4><br>  Installing OpenVPN is simple and does not require special knowledge.  Next next next finish.  Actually setting is much more interesting. <br><br><h4>  5. Technical description of the task </h4><br>  Preparation for action is complete.  Now is the time to describe technically how all this will act. <br>  We have: <br>  Home computer A with external address $ HOMEIP; <br>  Office computer B is closed with a firewall and does not have an external address; <br>  It is necessary: <br>  Office computer B should connect to computer A using TCP protocol on port 12345. The virtual network will have the address 10.0.1.0/24, where 10.0.1.1 is the home computer and 10.0.1.2 is the office one.  Authorization should take place on certificates without using passwords. <br><br><h4>  6. Server </h4><br>  OpenVPN is installed by default in C: \ Program Files \ OpenVPN.  We start the console (cmd.exe and go to the directory C: \ Program Files \ OpenVPN \ easy-rsa and execute the init-config.bat there. <br><br> <code>C:\Program Files\OpenVPN\easy-rsa&gt;init-config.bat <br> <br> C:\Program Files\OpenVPN\easy-rsa&gt;copy vars.bat.sample vars.bat <br>  : 1. <br> <br> C:\Program Files\OpenVPN\easy-rsa&gt;copy openssl.cnf.sample openssl.cnf <br>  : 1. <br></code> <br>  Now open the vars.bat configuration file and bring it to the following form: <br> <code>@echo off <br> set HOME=%ProgramFiles%\OpenVPN\easy-rsa <br> set KEY_CONFIG=openssl.cnf <br> set KEY_DIR=keys <br> set KEY_SIZE=2048 <br> set KEY_COUNTRY=RU <br> set KEY_PROVINCE=MSK <br> set KEY_CITY=Moskow <br> set KEY_ORG=Kremlin <br> set KEY_EMAIL=none@net.com <br></code> <br>  Here: <br>  <b>KEY_DIR</b> - directory where keys will be stored; <br>  <b>KEY_SIZE</b> - the length of the RSA key used for the signature; <br>  <b>KEY_COUNTRY</b> - country code; <br>  <b>KEY_PROVINCE</b> - region code (provinces, regions, etc.) <br>  <b>KEY_CITY</b> - city; <br>  <b>KEY_ORG</b> - organization; <br>  <b>KEY_EMAIL</b> - email address; <br>  Now, to generate the necessary keys and certificates, run the following commands in sequence: <br> <code>vars.bat <br> clean-all.bat <br> build-ca.bat <br> build-dh.bat <br> build-key-server.bat homepc <br></code> <br>  As a result, the console will have something like this: <br> <code>C:\Program Files\OpenVPN\easy-rsa&gt;vars <br> <br> C:\Program Files\OpenVPN\easy-rsa&gt;clean-all.bat <br>  : 1. <br>  : 1. <br> <br> C:\Program Files\OpenVPN\easy-rsa&gt;build-ca.bat <br> Loading 'screen' into random state - done <br> Generating a 2048 bit RSA private key <br> ...+++ <br> ....................+++ <br> writing new private key to 'keys\ca.key' <br> ----- <br> You are about to be asked to enter information that will be incorporated <br> into your certificate request. <br> What you are about to enter is what is called a Distinguished Name or a DN. <br> There are quite a few fields but you can leave some blank <br> For some fields there will be a default value, <br> If you enter '.', the field will be left blank. <br> ----- <br> Country Name (2 letter code) [RU]: <br> State or Province Name (full name) [MSK]: <br> Locality Name (eg, city) [Moskow]: <br> Organization Name (eg, company) [Kremlin]: <br> Organizational Unit Name (eg, section) []: <br> Common Name (eg, your name or your server's hostname) []:server <br> Email Address [none@net.com]: <br> <br> C:\Program Files\OpenVPN\easy-rsa&gt;build-dh.bat <br> Loading 'screen' into random state - done <br> Generating DH parameters, 2048 bit long safe prime, generator 2 <br> This is going to take a long time <br> ...........+........++* <br> <br> C:\Program Files\OpenVPN\easy-rsa&gt;build-key-server.bat homepc <br> Loading 'screen' into random state - done <br> Generating a 2048 bit RSA private key <br> ...........................................................+++ <br> .......................+++ <br> writing new private key to 'keys\homepc.key' <br> ----- <br> You are about to be asked to enter information that will be incorporated <br> into your certificate request. <br> What you are about to enter is what is called a Distinguished Name or a DN. <br> There are quite a few fields but you can leave some blank <br> For some fields there will be a default value, <br> If you enter '.', the field will be left blank. <br> ----- <br> Country Name (2 letter code) [RU]: <br> State or Province Name (full name) [MSK]: <br> Locality Name (eg, city) [Moskow]: <br> Organization Name (eg, company) [Kremlin]: <br> Organizational Unit Name (eg, section) []: <br> Common Name (eg, your name or your server's hostname) []:homepc <br> Email Address [none@net.com]: <br> <br> Please enter the following 'extra' attributes <br> to be sent with your certificate request <br> A challenge password []: <br> An optional company name []: <br> Using configuration from openssl.cnf <br> Loading 'screen' into random state - done <br> Check that the request matches the signature <br> Signature ok <br> The Subject's Distinguished Name is as follows <br> countryName :PRINTABLE:'RU' <br> stateOrProvinceName :PRINTABLE:'MSK' <br> localityName :PRINTABLE:'Moskow' <br> organizationName :PRINTABLE:'Kremlin' <br> commonName :PRINTABLE:'homepc' <br> emailAddress :IA5STRING:'none@net.com' <br> Certificate is to be certified until Aug 11 12:51:16 2018 GMT (3650 days) <br> Sign the certificate? [y/n]:y <br> <br> 1 out of 1 certificate requests certified, commit? [y/n]y <br> Write out database with 1 new entries <br> Data Base Updated <br> <br> C:\Program Files\OpenVPN\easy-rsa&gt; <br></code> <br>  The key generation for the server is complete.  Copy the following <b>ca.crt, homepc.key, homepc.crt and dh2048.pem files</b> from the OpenVPN \ easy-rsa \ keys directory to the OpenVPN \ config \ directory.  Then we create the OpenVPN server config \ config \ server.ovpn (if you have Vista, then first create a config for example on the desktop, and then copy it into the config directory).  In it we hammer the following: <br> <code>############################ <br> #    OpenVPN    <br> mode server <br> # TLS <br> tls-server <br> # , udp  tcp-server <br> proto tcp-server <br> #   ,TUN - , TAP -  <br> dev tap <br> #     <br> port 12345 <br> #   <br> ca ca.crt <br> #  <br> cert homepc.crt <br> #  <br> key homepc.key <br> #  - <br> dh dh2048.pem <br> #  <br> ifconfig 10.0.1.1 255.255.255.0 <br> # , 3    <br> verb 3 <br> #  , 256   <br> keysize 256 <br> #  , blowfish <br> cipher BF-CBC <br> #   <br> comp-lzo <br></code> <br>  Save, then click on it with the right mouse button, and select the launch using OpenVPN (well, or open with OpenVPN, if the config has the extension txt).  The server will start and be ready to maintain connections. <br><br><h4>  7. Customer. </h4><br>  To work with clients, we will generate a single file containing the keys and certificates we need.  To do this, in the server console (for example, after generating its keys), execute the <b>vars.bat command</b> and then <b>build-key-pkcs12.bar officepc</b> .  We get something like this: <br> <code>C:\Program Files\OpenVPN\easy-rsa&gt;build-key-pkcs12.bat officepc <br> Loading 'screen' into random state - done <br> Generating a 2048 bit RSA private key <br> ................................................................................ <br> .......+++ <br> ...+++ <br> writing new private key to 'keys\officepc.key' <br> ----- <br> You are about to be asked to enter information that will be incorporated <br> into your certificate request. <br> What you are about to enter is what is called a Distinguished Name or a DN. <br> There are quite a few fields but you can leave some blank <br> For some fields there will be a default value, <br> If you enter '.', the field will be left blank. <br> ----- <br> Country Name (2 letter code) [RU]: <br> State or Province Name (full name) [MSK]: <br> Locality Name (eg, city) [Moskow]: <br> Organization Name (eg, company) [Kremlin]: <br> Organizational Unit Name (eg, section) []: <br> Common Name (eg, your name or your server's hostname) []:officepc <br> Email Address [none@net.com]: <br> <br> Please enter the following 'extra' attributes <br> to be sent with your certificate request <br> A challenge password []: <br> An optional company name []: <br> Using configuration from openssl.cnf <br> Loading 'screen' into random state - done <br> DEBUG[load_index]: unique_subject = "yes" <br> Check that the request matches the signature <br> Signature ok <br> The Subject's Distinguished Name is as follows <br> countryName :PRINTABLE:'RU' <br> stateOrProvinceName :PRINTABLE:'MSK' <br> localityName :PRINTABLE:'Moskow' <br> organizationName :PRINTABLE:'Kremlin' <br> commonName :PRINTABLE:'officepc' <br> emailAddress :IA5STRING:'none@net.com' <br> Certificate is to be certified until Aug 11 13:17:22 2018 GMT (3650 days) <br> Sign the certificate? [y/n]:y <br> <br> 1 out of 1 certificate requests certified, commit? [y/n]y <br> Write out database with 1 new entries <br> Data Base Updated <br> Loading 'screen' into random state - done <br> Enter Export Password: <br> Verifying - Enter Export Password: <br> <br> C:\Program Files\OpenVPN\easy-rsa&gt; <br></code> <br>  <b>Note!</b>  It is not necessary to enter the password at the last stage of generation.  Personally, I just hit Enter. <br>  Now copy the <b>officepc.p12</b> file from the OpenVPN \ easy-rsa \ keys directory to the OpenVPN \ config directory <b>LOCATED ON THE CLIENT'S MACHINE</b> .  And we create a config on the client‚Äôs machine, for example client.ovpn, with the following contents: <br> <code>#    <br> dev tap <br> # TLS <br> tls-client <br> #   <br> remote $HOMEIP 12345 <br> #  <br> proto tcp-client <br> #  <br> ifconfig 10.0.1.2 255.255.255.0 <br> #  <br> comp-lzo <br> #  <br> verb 3 <br> #   <br> pkcs12 cert.p12 <br> #  <br> comp-lzo <br> #  <br> keysize 256 <br> #  <br> cipher BF-CBC <br></code> <br>  Everything.  Setup is over.  Run the configuration file on the client (open with OpenVPN).  Our virtual network is ready. <br>  <b>PS</b> If I didn‚Äôt say anything, or what moments are incomprehensible I will add and expand the post.  Welcome) <br></div><p>Source: <a href="https://habr.com/ru/post/36845/">https://habr.com/ru/post/36845/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../368437/index.html">Animated video of the rotation of an exoplanet around its star</a></li>
<li><a href="../368439/index.html">Earth and space with the ISS</a></li>
<li><a href="../36844/index.html">We prepare professionals from Brazilian system from Junior Developer (2nd series)</a></li>
<li><a href="../368441/index.html">PayPal has blocked the accounts of residents of Crimea</a></li>
<li><a href="../368449/index.html">Smart Cottage # 1. ITEAD's Sonoff Modules</a></li>
<li><a href="../368451/index.html">Developers say hello!</a></li>
<li><a href="../368453/index.html">Students from the University of Tokyo have created a robotic arm that wins a person in the game "Stone, Scissors, Paper" with one hundred percent probability</a></li>
<li><a href="../368455/index.html">Engineers have developed a metamaterial, giving a three-dimensional object a flat view.</a></li>
<li><a href="../368457/index.html">The development of SD cards: as the recording speed increased from 2 to 30 megabytes per second</a></li>
<li><a href="../368459/index.html">In the United States for the first time was fined $ 1,100 drone operator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>