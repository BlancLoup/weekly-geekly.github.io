<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unicorn interested in KDE</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="KDE (short for K Desktop Environment) is a desktop environment, mainly for Linux and other UNIX-like systems. If in simple terms, this is the thing th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unicorn interested in KDE</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/6c3/075/1fa/6c30751fa263c71f4f37084e62f9ef95.png" align="left"><br>  KDE (short for K Desktop Environment) is a desktop environment, mainly for Linux and other UNIX-like systems.  If in simple terms, this is the thing that is responsible for all graphic design.  The environment is based on the Qt cross-platform user interface development toolkit.  The development involved several hundred programmers from around the world, committed to the idea of ‚Äã‚Äãfree software.  KDE offers a complete set of user environment applications that allow you to interact with the operating system in a modern graphical interface.  Let's see what KDE has under the hood. <br><a name="habracut"></a><br>  The following packages <a href="http://www.viva64.com/go.php%3Furl%3D1441">of the KDE project</a> version 4.14 were checked with <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> 5.19 in the OpenSUSE Factory: <ul><li>  KDE PIM Libraries </li><li>  KDE Base Libraries </li><li>  KDE Base Apps </li><li>  KDE Development </li></ul><br><h2>  KDE PIM Libraries </h2><br>  <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression is always true.  Probably the '&amp;&amp;' operator should be used here.  incidenceformatter.cpp 2684 <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> PartStat { .... Accepted, Tentative, .... }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formatICalInvitationHelper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... a = findDelegatedFromMyAttendee( inc ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( a ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( a-&gt;status() != Attendee::Accepted || <span class="hljs-comment"><span class="hljs-comment">//&lt;== a-&gt;status() != Attendee::Tentative ) { //&lt;== html += responseButtons( inc, rsvpReq, rsvpRec, helper ); break; } } .... }</span></span></code> </pre> <br>  The expression is always true.  The reason may be a typo or incorrect programmer logic.  It may be necessary to use the '&amp;&amp;' operator here. <br><br>  Similar suspicious place: <ul><li>  V547 Expression is always true.  Probably the '&amp;&amp;' operator should be used here.  incidenceformatter.cpp 3293 </li></ul><br>  <a href="http://www.viva64.com/ru/d/0197/">V593</a> Consider reviewing the A = B == C 'kind.  The expression is calculated as the following: 'A = (B == C)'.  kio_ldap.cpp 535 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> LDAPProtocol::del( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> KUrl &amp;_url, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (id = mOp.del( usrc.dn() ) == <span class="hljs-number"><span class="hljs-number">-1</span></span>) ) { LDAPErr(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } ret = mOp.waitForResult( id, <span class="hljs-number"><span class="hljs-number">-1</span></span> ); .... }</code> </pre> <br>  The priority of the comparison operator (==) is higher than the priority of the assignment operator (=).  Due to luck, the condition is fulfilled as conceived, but then the incorrect value of the identifier 'id', equal to 0, is used. <br><br>  <a href="http://www.viva64.com/ru/d/0205/">V595</a> The 'incBase' pointer was used before it was verified against nullptr.  Check lines: 2487, 2491. incidenceformatter.cpp 2487 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formatICalInvitationHelper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... incBase-&gt;shiftTimes( mCalendar-&gt;timeSpec(), ....); Incidence *existingIncidence = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( incBase &amp;&amp; helper-&gt;calendar() ) { .... } .... }</code> </pre> <br>  The dereferencing of the 'incBase' pointer is done before checking it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://www.viva64.com/ru/d/0239/">V622</a> Consider inspecting the 'switch' statement.  It's possible that the operator is missing.  listjob.cpp 131 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ListJob::doStart() { Q_D( ListJob ); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ( d-&gt;option ) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">//&lt;== case IncludeUnsubscribed: d-&gt;command = "LIST"; break; case IncludeFolderRoleFlags: d-&gt;command = "XLIST"; break; case NoOption: default: d-&gt;command = "LSUB"; } .... }</span></span></code> </pre> <br>  In the 'switch' statement block, the first statement is not a 'case'.  This leads to the fact that the code fragment will never get control.  In the best case, the operator 'break' remained after the incomplete removal of the old condition, but in the worst case, another 'case' was missing here. <br><br>  <a href="http://www.viva64.com/ru/d/0340/">V701</a> realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'lexBuf.strs' is lost.  Consider assigning realloc () to a temporary pointer.  vcc.y 638 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lexAppendc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> c)</span></span></span><span class="hljs-function"> </span></span>{ lexBuf.strs = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) <span class="hljs-built_in"><span class="hljs-built_in">realloc</span></span>(lexBuf.strs, (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>) .... + <span class="hljs-number"><span class="hljs-number">1</span></span>); lexBuf.strs[lexBuf.strsLen] = c; .... }</code> </pre> <br>  This expression is potentially dangerous: it is recommended that the result of the realloc function be stored in another variable.  The realloc () function changes the size of a block of memory.  In case of an error, the pointer to the old memory area will be lost. <br><br>  Anyway, this code is bad.  There is no proof that the function realloc () returned.  The pointer is immediately dereferenced in the next line. <br><br>  Similar places: <ul><li>  V701 realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'mods' is lost.  Consider assigning realloc () to a temporary pointer.  ldapoperation.cpp 534 </li><li>  V701 realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'mods [i] -&gt; mod_vals.modv_bvals' is lost.  Consider assigning realloc () to a temporary pointer.  ldapoperation.cpp 579 </li><li>  V701 realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'ctrls' is lost.  Consider assigning realloc () to a temporary pointer.  ldapoperation.cpp 624 </li><li>  V701 realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'fp-&gt; s' is lost.  Consider assigning realloc () to a temporary pointer.  vobject.c 1055 </li><li>  V701 realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'lexBuf.strs' is lost.  Consider assigning realloc () to a temporary pointer.  vcc.y 635 </li><li>  V701 realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'lexBuf.strs' is lost.  Consider assigning realloc () to a temporary pointer.  vcc.y 643 </li><li>  V701 realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'bytes' is lost.  Consider assigning realloc () to a temporary pointer.  vcc.y 928 </li><li>  V701 realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'fp-&gt; s' is lost.  Consider assigning realloc () to a temporary pointer.  vobject.c 1050 </li></ul><br><h2>  KDE Base Libraries </h2><br>  <a href="http://www.viva64.com/ru/d/0112/">V523</a> The 'then' statement is equivalent to the 'else' statement.  kconfig_compiler.cpp 1051 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString &amp;type, ....)</span></span></span><span class="hljs-function"> </span></span>{ QString t = <span class="hljs-string"><span class="hljs-string">"new "</span></span>+cfg.inherits+<span class="hljs-string"><span class="hljs-string">"::Item"</span></span> + ....; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( type == <span class="hljs-string"><span class="hljs-string">"Enum"</span></span> ) t += <span class="hljs-string"><span class="hljs-string">", values"</span></span> + name; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !defaultValue.isEmpty() ) { t += <span class="hljs-string"><span class="hljs-string">", "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( type == <span class="hljs-string"><span class="hljs-string">"String"</span></span> ) t += defaultValue; <span class="hljs-comment"><span class="hljs-comment">//&lt;== else t+= defaultValue; //&lt;== } t += " );"; return t; }</span></span></code> </pre> <br>  The same true and false branch of the 'if' operator looks extremely suspicious.  If the code still does not contain a typo, then it can be simplified, for example, as follows: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !defaultValue.isEmpty() ) t += <span class="hljs-string"><span class="hljs-string">", "</span></span> + defaultValue;</code> </pre> <br>  Similar place: <ul><li>  V523 The 'then' statement is equivalent to the 'else' statement.  installation.cpp 589 </li></ul><br>  <a href="http://www.viva64.com/ru/d/0205/">V595</a> The 'priv-&gt; slider' pointer was used before it was verified against nullptr.  Check lines: 786, 792. knuminput.cpp 786 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> KDoubleNumInput::spinBoxChanged(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> val) { .... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> slidemin = priv-&gt;slider-&gt;minimum(); <span class="hljs-comment"><span class="hljs-comment">//&lt;== const double slidemax = priv-&gt;slider-&gt;maximum(); //&lt;== .... if (priv-&gt;slider) { //&lt;== priv-&gt;slider-&gt;blockSignals(true); priv-&gt;slider-&gt;setValue(qRound(slidemin + rel * (....))); priv-&gt;slider-&gt;blockSignals(false); } }</span></span></code> </pre> <br>  The pointer de  priv ‚Äôis dereferenced before checking it <br><br>  Similar dangerous places: <ul><li>  V595 The 'm_instance' pointer was used before it was counted against nullptr.  Check lines: 364, 376. ksystemtimezone.cpp 364 </li><li>  V595  Check lines: 778, 783. knewfilemenu.cpp 778 </li></ul><br>  <a href="http://www.viva64.com/ru/d/0265/">V646</a> Consider inspecting the application's logic.  It's possible that 'else' keyword is missing.  karchive.cpp 187 <br><pre> <code class="cpp hljs">*<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> KArchive::close() { .... <span class="hljs-comment"><span class="hljs-comment">// if d-&gt;saveFile is not null then it is equal to d-&gt;dev. if ( d-&gt;saveFile ) { closeSucceeded = d-&gt;saveFile-&gt;finalize(); delete d-&gt;saveFile; d-&gt;saveFile = 0; } if ( d-&gt;deviceOwned ) { //&lt;== delete d-&gt;dev; // we created it ourselves in open() } .... }</span></span></code> </pre> <br>  This code snippet may indicate the omission of the 'else' keyword, or it is simply extremely delusive and confusing code design. <br><br>  <a href="http://www.viva64.com/ru/d/0276/">V655</a> The strings was concatenated but are not utilized.  Consider inspecting the expression.  entrydetailsdialog.cpp 225 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> EntryDetails::updateButtons() { .... foreach (....) { QString text = info.name; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!info.distributionType.trimmed().isEmpty()) { text + <span class="hljs-string"><span class="hljs-string">" ("</span></span> + info.distributionType.trimmed() + <span class="hljs-string"><span class="hljs-string">")"</span></span>;<span class="hljs-comment"><span class="hljs-comment">//&lt;== } QAction* installAction = installMenu-&gt;addAction(KIcon("dialog-ok"), text); installAction-&gt;setData(info.id); } .... }</span></span></code> </pre> <br>  The analyzer detected an unused union of string variables.  Perhaps the code should be like this: <br><pre> <code class="cpp hljs">text += <span class="hljs-string"><span class="hljs-string">" ("</span></span> + info.distributionType.trimmed() + <span class="hljs-string"><span class="hljs-string">")"</span></span>;</code> </pre> <br>  Similar places: <ul><li>  V655 The strings was concatenated but are not utilized.  Consider inspecting the expression.  itemsgridviewdelegate.cpp 365 </li><li>  V655 The strings was concatenated but are not utilized.  Consider inspecting the expression.  itemsviewdelegate.cpp 159 </li></ul><br>  <a href="http://www.viva64.com/ru/d/0344/">V705</a> It is possible that ‚Äúelse‚Äù block was forgotten or commented out, thus altering the program's operation logics.  entrydetailsdialog.cpp 149 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> EntryDetails::entryChanged(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> KNS3::EntryInternal&amp; entry) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(m_entry.previewUrl(EntryInternal::PreviewSmall1).isEmpty()){ ui-&gt;previewBig-&gt;setVisible(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-comment"><span class="hljs-comment">//&lt;== if (!m_entry.previewUrl((....)type).isEmpty()) { .... } .... }</span></span></code> </pre> <br>  The design of this code fragment also looks ambiguous.  Was there an ‚Äúelse if‚Äù construct planned here, or just forgot to remove the 'else'? <br><br>  <a href="http://www.viva64.com/ru/d/0228/">V612</a> An unconditional 'return' within a loop.  bufferfragment_p.h 94 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">BufferFragment </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">split</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> c, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* start)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (*start &lt; len) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> end = indexOf(c, *start); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (end == <span class="hljs-number"><span class="hljs-number">-1</span></span>) end = len; <span class="hljs-function"><span class="hljs-function">BufferFragment </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">line</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d + (*start), end - (*start))</span></span></span></span>; *start = end + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> line; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BufferFragment(); }</code> </pre> <br>  Was it worth writing a loop because of one iteration?  Or do not have a conditional operator? <br><br>  <a href="http://www.viva64.com/ru/d/0340/">V701</a> realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'd' is lost.  Consider assigning realloc () to a temporary pointer.  netwm.cpp 596 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Z</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NETRArray</span></span></span><span class="hljs-class">&lt;Z&gt;:</span></span>:reset() { sz = <span class="hljs-number"><span class="hljs-number">0</span></span>; capacity = <span class="hljs-number"><span class="hljs-number">2</span></span>; d = (Z*) <span class="hljs-built_in"><span class="hljs-built_in">realloc</span></span>(d, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Z)*capacity); <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>( (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*) d, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Z)*capacity ); }</code> </pre> <br>  As in KDE PIM Libraries, it is not recommended to use a single pointer with the realloc () function, as the pointer to the old memory area may be lost if the memory cannot be increased. <br><br>  Similar places: <ul><li>  V701 realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'handlers' is lost.  Consider assigning realloc () to a temporary pointer.  kxerrorhandler.cpp 94 </li><li>  V701 realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'buffer' is lost.  Consider assigning realloc () to a temporary pointer.  netwm.cpp 528 </li><li>  V701 realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'd' is lost.  Consider assigning realloc () to a temporary pointer.  netwm.cpp 608 </li><li>  V701 realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'ptr' is lost.  Consider assigning realloc () to a temporary pointer.  kdesu_stub.c 119 </li><li>  V701 realloc () possible leak: when realloc () fails in allocating memory, the original pointer 'addr.generic' is lost.  Consider assigning realloc () to a temporary pointer.  k3socketaddress.cpp 372 </li></ul><br><h2>  KDE Base Apps </h2><br>  <a href="http://www.viva64.com/ru/d/0090/">V501</a> There are identical sub-expressions' mimeData-&gt; hasFormat (QLatin1String ("application / x-kde-ark-dndextract-service"))).  iconview.cpp 2357 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IconView::dropEvent(QGraphicsSceneDragDropEvent *event) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mimeData-&gt;hasFormat(QLatin1String( <span class="hljs-string"><span class="hljs-string">"application/x-kde-ark-dndextract-service"</span></span>)) &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">//&lt;== mimeData-&gt;hasFormat(QLatin1String( "application/x-kde-ark-dndextract-service"))) //&lt;== { const QString remoteDBusClient = mimeData-&gt;data( QLatin1String("application/x-kde-ark-dndextract-service")); const QString remoteDBusPath = mimeData-&gt;data( QLatin1String("application/x-kde-ark-dndextract-path")); .... } .... }</span></span></code> </pre> <br>  The analyzer detected the same conditional expression.  According to the body of the conditional operator, it is logical to assume that the condition should be like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mimeData-&gt;hasFormat(QLatin1String( <span class="hljs-string"><span class="hljs-string">"application/x-kde-ark-dndextract-service"</span></span>)) &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">//&lt;== mimeData-&gt;hasFormat(QLatin1String( "application/x-kde-ark-dndextract-path "))) //&lt;== { .... }</span></span></code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0205/">V595</a> The 'm_view' pointer was used before it was verified against nullptr.  Check lines: 797, 801. kitemlistcontroller.cpp 797 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> KItemListController::mouseDoubleClickEvent(....) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QPointF pos = transform.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(event-&gt;pos()); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = m_view-&gt;itemAt(pos); <span class="hljs-comment"><span class="hljs-comment">// Expand item if desired - See Bug 295573 if (m_mouseDoubleClickAction != ActivateItemOnly) { if (m_view &amp;&amp; m_model &amp;&amp; ....) { const bool expanded = m_model-&gt;isExpanded(index); m_model-&gt;setExpanded(index, !expanded); } } .... }</span></span></code> </pre> <br>  In KDE projects, there are many places where the pointer that came into the function is first used to initialize local variables, and later it is checked before dereferencing. <br><br>  <a href="http://www.viva64.com/ru/d/0255/">V637</a> Two opposite conditions were encountered.  The second condition is always false.  Check lines: 410, 412. kebsearchline.cpp 410 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> KViewSearchLine::slotColumnsRemoved(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QModelIndex &amp;, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> first, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> last) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d-&gt;treeView) updateSearch(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d-&gt;listView-&gt;modelColumn() &gt;= first &amp;&amp; d-&gt;listView-&gt;modelColumn() &lt;= last) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d-&gt;listView-&gt;modelColumn()&gt;last) <span class="hljs-comment"><span class="hljs-comment">//&lt;== kFatal()&lt;&lt;"...."&lt;&lt;endl; updateSearch(); } } }</span></span></code> </pre> <br>  Nested condition will always be false.  It can be assumed that such a condition was relevant before some edits. <br><br>  <a href="http://www.viva64.com/ru/d/0275/">V654</a> The condition 'state! = 1' of loop is always true.  passwd.cpp 255 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PasswdProcess::ConversePasswd(....) { .... state = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (state != <span class="hljs-number"><span class="hljs-number">1</span></span>) { line = readLine(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (line.isNull()) { <span class="hljs-comment"><span class="hljs-comment">// No more input... OK return 0; } if (isPrompt(line, "password")) { // Uh oh, another prompt. Not good! kill(m_Pid, SIGKILL); waitForChild(); return PasswordNotGood; } m_Error += line + '\n'; // Collect error message } .... }</span></span></code> </pre> <br>  The value of the 'state' variable does not change in the loop, therefore, the only condition to stop is the call 'return'. <br><br><h2>  KDE Development </h2><br>  <a href="http://www.viva64.com/ru/d/0090/">V501</a> There are identical sub-expressions 'file == rhs.file' operator.  pp-macro.cpp 44 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> pp_macro::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>==(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pp_macro&amp; rhs) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(completeHash() != rhs.completeHash()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name == rhs.name &amp;&amp; file == rhs.file &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">//&lt;== file == rhs.file &amp;&amp; //&lt;== sourceLine == rhs.sourceLine &amp;&amp; defined == rhs.defined &amp;&amp; hidden == rhs.hidden &amp;&amp; function_like == rhs.function_like &amp;&amp; variadics == rhs.variadics &amp;&amp; fixed == rhs.fixed &amp;&amp; defineOnOverride == rhs.defineOnOverride &amp;&amp; listsEqual(rhs); }</span></span></code> </pre> <br>  The analyzer found several places with repeated conditional expressions.  Some of this may well be a serious typo. <br><br>  More places like this: <ul><li>  V501 There are identical sub-expressions "tokenKind == Token_not_eq"  operator.  builtinoperators.cpp 174 </li><li>  V501 There are identical sub-expressions '! Context-&gt; owner ()'  operator.  typeutils.cpp 194 </li></ul><br>  <a href="http://www.viva64.com/ru/d/0205/">V595</a> The 'parentJob () -&gt; cpp ()' pointer was used against nullptr.  Check lines: 437, 438. cppparsejob.cpp 437 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CPPInternalParseJob::run() { .... <span class="hljs-function"><span class="hljs-function">QReadLocker </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parentJob()-&gt;parentPreprocessor() ? </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">: parentJob()-&gt;cpp()-&gt;language()-&gt;parseLock())</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//&lt;== if(.... || !parentJob()-&gt;cpp()) //&lt;== return; .... }</span></span></code> </pre> <br>  And in this project there was a place with a pointer dereference until it was checked. <br><br>  Another place: <ul><li>  V595 The 'parentContext ()' pointer was used before it was verified against nullptr.  Check lines: 692, 695. context.cpp 692 </li></ul><br>  <a href="http://www.viva64.com/ru/d/0159/">V564</a> The '&amp;' operator is applied to bool type value.  You've probably forgotten to include the operator.  usedecoratorvisitor.cpp 40 <br><pre> <code class="cpp hljs">DataAccess::<span class="hljs-function"><span class="hljs-function">DataAccessFlags </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeToDataAccessFlags</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ DataAccess::DataAccessFlags ret = DataAccess::Read; TypePtr&lt; ReferenceType &gt; reftype=type.cast&lt;ReferenceType&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(reftype &amp;&amp; reftype-&gt;baseType() &amp;&amp; !reftype-&gt;baseType()-&gt;modifiers() &amp; <span class="hljs-comment"><span class="hljs-comment">//&lt;== AbstractType::ConstModifier) ret |= DataAccess::Write; return ret; }</span></span></code> </pre> <br>  Authors should know whether the error is here or not, but the '&amp;' operator looks suspicious.  Note that the expression "! Reftype-&gt; baseType () -&gt; modifiers ()" is of the type 'bool'. <br><br>  <a href="http://www.viva64.com/ru/d/0146/">V555</a> The expression 'm_pos - backOffset&gt; 0' will work as 'm_pos! = BackOffset'.  pp-stream.cpp 225 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rpp::Stream::peekLastOutput(uint backOffset) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(m_pos - backOffset &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_string-&gt;at(m_pos - backOffset - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  It is not entirely correct to compare the difference between unsigned numbers and zero, because a negative result can be interpreted as a very large positive number.  In order not to get a giant index in the condition body, it is better to write the condition as follows: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(m_pos &gt; backOffset) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_string-&gt;at(m_pos - backOffset - <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br>  Similar place: <ul><li>  V555 The expression 'nextOffset - currentOffset&gt; 0' will work as 'nextOffset! = CurrentOffset'.  pp-location.cpp 211 </li></ul><br><h2>  Conclusion </h2><br>  The huge audience of KDE users and product developers plays a big role in terms of testing, but it is also worth paying attention to various code analyzers.  However, judging by the publications on the Internet, at least Coverity is already used to check the KDE source codes.  It is because of this that PVS-Studio finds very few suspicious places. <br><br>  Using static analysis regularly, you can save a lot of time on solving more useful tasks.  Also, control over the quality of the code can be shifted to others, for example, using the new service: <a href="http://www.viva64.com/go.php%3Furl%3D1440">regular auditing of C / C ++ code</a> . <br><br><h2>  This article is in English. </h2><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Svyatoslav Razmyslov.  <a href="http://www.viva64.com/en/b/0283/">The Unicorn Getting Interested in KDE</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected the answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio and CppCat, version 2014</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/238493/">https://habr.com/ru/post/238493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../238483/index.html">Why do you need a mouse if you have a keyboard?</a></li>
<li><a href="../238485/index.html">Design in the browser</a></li>
<li><a href="../238487/index.html">Sample Magic Spring Data JPA Audit and Version</a></li>
<li><a href="../238489/index.html">Hello from Namibia. Rethinking Postocard Postcards</a></li>
<li><a href="../238491/index.html">Control any AV technology from your phone. IR transceiver for JACK 3.5</a></li>
<li><a href="../238495/index.html">Let me give you back?</a></li>
<li><a href="../238497/index.html">About encodings and code pages</a></li>
<li><a href="../238499/index.html">Sale of electronic books for 99 rubles</a></li>
<li><a href="../238501/index.html">My experience in building 1-Wire industrial network</a></li>
<li><a href="../238505/index.html">English words. Methods and methods of memorization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>