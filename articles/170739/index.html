<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HMVC in the namespace</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, a lot has been said about the MVC design scheme, almost all popular PHP frameworks have long since switched to this scheme. As for Kohana , ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HMVC in the namespace</h1><div class="post__text post__text-html js-mediator-article">  Recently, a lot has been said about the <a href="http://ru.wikipedia.org/wiki/MVC">MVC</a> design scheme, almost all popular PHP frameworks have long since switched to this scheme.  As for <a href="http://kohanaframework.org/">Kohana</a> , starting from version 3, a hierarchical MVC - <a href="http://ru.wikipedia.org/wiki/HMVC">HMVC</a> scheme has been implemented.  The advantages of HMVC are clear to everyone and we will not discuss them here. <br><br>  As a person who wanted to change the status of ‚Äúamateur programmer‚Äù to ‚Äúprofessional programmer‚Äù, I decided that I had already learned enough PHP and it‚Äôs time to start working with frameworks, the choice of my very first framework fell on Kohana, since  it implements the HMVC, well, in general, it is much praised for its simplicity. <br><br>  In reality, everything turned out to be not easy, but the absence of isolation of the MVC triads was especially straining, the triads were broken up into parts and placed in different folders.  In my understanding, the <i>Model-View-Controller</i> triad should be isolated from other triads, and be in the same folder, of course, this could be implemented in Kohana, but everything will look very clumsy and confusing.  It was also not clear why not use such a great <b>PHP</b> feature as a namespace?  I looked through some more HMVC-frameworks, but not to one ‚Äúthe soul did not lay down‚Äù.  Then I decided to independently implement HMVC. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Immediately set several directives: <br><ul><li>  Namespace must be used </li><li>  Class autoloading works on namespace </li><li>  You can add multiple folders to autoload. </li><li>  Each application has its own folder, which is installed autoload </li><li>  Each triad, including templates, is placed in a separate folder, respectively, are in its namespace </li><li>  By default, the MVC parts are named by their names, <i>Controller</i> , <i>Model</i> and <i>View</i> , in each folder of the triad there should be a <i>templates</i> folder for templates </li><li>  Very simple routing, the URI is simply broken into an array </li><li>  <i>Controller</i> is similar to <i>Kohana_Controller</i> </li><li>  <i>The controller</i> receives information about what they want from it in the constructor, parses the information of the URI array, and then starts the <i>action ()</i> method </li><li>  The <i>action ()</i> method checks the object's methods and starts <i>action_) ()</i> accordingly <i>.</i> </li><li>  Generate HTML, performed by the <i>render ()</i> controller method </li></ul><br><br>  Then he added a few more: <br><ul><li>  Routing is performed by the extended controller, it splits the URI into an array, first checks its <i>actions</i> , if it does not find it, it searches for a registered controller </li><li>  The result of the model is saved in the controller, passed to the <i>View</i> , when created in the controller's <i>render ()</i> method </li><li>  The <i>action</i> method <i>()</i> public, created by the controller, you can once again run and generate HTML </li><li>  <i>View</i> is similar to <i>Kohana_View</i> , for an application, <i>View</i> needs to be ‚Äúpulled out‚Äù into the global namespace using inheritance, at the same time having configured a little, all other <i>View</i> must be the heirs of the global <i>View</i> </li><li>  <i>Controllers</i> and <i>View</i> must know in which folder and in which namespace they are located, for this they are inherited from the special class <i>NameSpaceAdapter</i> , this is necessary for the correct search for <i>View</i> from the controller, as well as the <i>templates</i> folder from the parent <i>View</i> </li><li>  The main template for each triad is <i>template.php</i> </li><li>  The controllers automatically send their <i>action</i> to <i>View</i> ; based on this information, the <i>View</i> from the main <i>template.php</i> itself searches for the desired <i>action.php</i> template, so <i>action_template ()</i> should not be, this will cause the templates to loop. </li><li>  For administration, you can create templates with the prefix <i>admin_action.php</i> , which can only be called if the constant ADMIN is set </li></ul><br><br>  The result was a small HMVC structure, <i>Model</i> does not matter, so the code does not cite, I can only say that I tend to the static class. <br><a name="habracut"></a><br>  So, the very first class of <b>Autoload</b> : <br><div class="spoiler">  <b class="spoiler_title">To uncover</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Autoload</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $dirs=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-comment"><span class="hljs-comment">//      ! static function add( $dir ){ if( !in_array($dir,self::$dirs) ){ self::$dirs[]=$dir; } } static function findClass( $className ){ $path=str_replace('\\','/',$className).'.php'; foreach( self::$dirs as $dir ){ $file=$dir.$path; if( is_file($file) ){ return $file; } } return false; } static function loadClass( $className ){ if( $file=self::findClass( $className ) ){ require $file; } } } spl_autoload_register( '\\Autoload::loadClass' ); Autoload::add( __DIR__.'/');</span></span></code> </pre> <br></div></div><br>  Class <b>NameSpaceAdapter</b> : <br><div class="spoiler">  <b class="spoiler_title">To uncover</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">lib</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NameSpaceAdapter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDirectory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dirname( \Autoload::findClass( get_class(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>) ) ).<span class="hljs-string"><span class="hljs-string">'/'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNameSpace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ $c=trim(str_replace(<span class="hljs-string"><span class="hljs-string">'\\'</span></span>,<span class="hljs-string"><span class="hljs-string">' '</span></span>,get_class(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>))); $path=explode(<span class="hljs-string"><span class="hljs-string">' '</span></span>,$c); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( count($path) ){ array_pop($path); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">'\\'</span></span>.implode(<span class="hljs-string"><span class="hljs-string">'\\'</span></span>,$path)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre><br></div></div><br>  <b>Controller</b> class: <br><div class="spoiler">  <b class="spoiler_title">To uncover</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">lib</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NameSpaceAdapter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $view_data=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $params=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $action=<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $uri=<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $a_uri=null , $controller_uri=null )</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;uri=$controller_uri; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( is_array($a_uri) &amp;&amp; count($a_uri) ){ $action=$a_uri[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( is_numeric($action) ){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;action=<span class="hljs-string"><span class="hljs-string">'show'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;params=$a_uri; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;action=array_shift($a_uri); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;params=$a_uri; } }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;action=<span class="hljs-string"><span class="hljs-string">'index'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;action(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $action=null, array $params=null)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( $action ) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;action=$action; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( $params ) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;params=$params; $method=<span class="hljs-string"><span class="hljs-string">'action_'</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;action; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !\method_exists(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>,$method) ){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;action=<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     $method='action404'; } if( $this-&gt;before_action() ){ $this-&gt;$method(); }else{ $this-&gt;setError('e  '); } return $this; } protected function before_action(){ return true; } //      -  protected function before_view(){ } //     -  protected function action404(){ $this-&gt;setError('  '); } protected function action_index(){ throw new \Exception('&lt;pre&gt; index  '); } protected function action_show(){ throw new \Exception('&lt;pre&gt; show  '); } protected function setError( $message ){ $this-&gt;action='error'; //    error.php $this-&gt;view_data['title']=''; $this-&gt;view_data['message']=$message; } public function render(){ $this-&gt;before_view(); //  View,      ,  NameSpaceAdapter $viewClass=$this-&gt;getNameSpace().'\\View'; $view=new $viewClass(); if( is_array($this-&gt;view_data) &amp;&amp; count($this-&gt;view_data) ){ foreach( $this-&gt;view_data as $key=&gt;$value ){ $view-&gt;set($key,$value); } } if( $this-&gt;action ) $view-&gt;set('action',$this-&gt;action); $view-&gt;set('uri',('/'.$this-&gt;uri)); if( defined('ADMIN') ){ // admin_action.php if( $this-&gt;action ) $view-&gt;set('admin_action','admin_'.$this-&gt;action); } return $view-&gt;render(); } public function __toString(){ return $this-&gt;render(); } }</span></span></code> </pre><br></div></div><br>  <b>Main</b> class - Controller extension: <br><div class="spoiler">  <b class="spoiler_title">To uncover</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">lib</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lib</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $controllers=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-comment"><span class="hljs-comment">//array( 'uri'=&gt;array( 'title'=&gt;'','class'=&gt;''),... protected $content_controller; //   protected $auth_class='\\lib\\auth\\BasicAdmin'; // ,   function __construct(){ $this-&gt;checkAdmin(); $this-&gt;init(); $a_uri=$this-&gt;read_URI(); $this-&gt;call_controller($a_uri); } protected function read_URI(){ $arr=explode('?',$_SERVER["REQUEST_URI"]); $uri=$arr[0]; $dirt_uri=explode('/',$uri); $a_uri=array(); foreach( $dirt_uri as $i){ if( !empty($i) ) $a_uri[]=$i; } return $a_uri; } protected function call_controller($a_uri){ /*       action,  action ,           ,  ,  ,      $this-&gt;content_controller      ,    action404   $a_uri ,       ,   index */ //   , ..       action $this-&gt;action=null; $this-&gt;params=null; if( is_array($a_uri) &amp;&amp; count($a_uri) ){ $method='action_'.$a_uri[0]; //    ,     action_show if( method_exists($this,$method) || is_numeric($a_uri[0]) ){ parent::__construct($a_uri); }else{ //  ,   $controller_uri=array_shift( $a_uri ); if( isset($this-&gt;controllers[ $controller_uri ]) ){ $this-&gt;content_controller=new $this-&gt;controllers[ $controller_uri ]['class']( $a_uri , $controller_uri ); }else{ $this-&gt;action404(); } } }else{ parent::__construct(); //   action_index } } protected function checkAdmin(){ $auth=new $this-&gt;auth_class(); if( $auth-&gt;login() ){ define('ADMIN',true); $this-&gt;prepareForAdmin(); //     } } public function render(){ /*     View,    AJAX,         AJAX    content- */ if( defined('AJAX') ){ if( $this-&gt;content_controller ){ return $this-&gt;content_controller-&gt;render(); }else{ return ' -   '; } }else{ if( $this-&gt;content_controller ) $this-&gt;view_data['content']=$this-&gt;content_controller-&gt;render(); //$this-&gt;view_data['controllers']=$this-&gt;controllers; return parent::render(); } } public function action_ajax(){ /*   uri /ajax/...   AJAX */ define('AJAX',true); $this-&gt;call_controller( $this-&gt;params); //   } public function action_login(){/*        login.php */} public function action_logout(){ $auth=new $this-&gt;auth_class(); $auth-&gt;logout(); $this-&gt;action('index'); } public function init(){ /*   */} protected function prepareForAdmin(){/*     */} }</span></span></code> </pre><br></div></div><br>  <b>View</b> class: <br><div class="spoiler">  <b class="spoiler_title">To uncover</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">lib</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NameSpaceAdapter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $public_uri; <span class="hljs-comment"><span class="hljs-comment">//  ,   ,     static $scripts=array(); //   ,    static $styles=array(); //   ,    static $global_data=array(); //   protected $data=array(); //  ,     protected $templates_dir='templates'; //    ,    protected $template='template.php'; //     ,    action='template' static function render_styles(){ /*   ,         \View::render_styles() */ $html=''; if( is_array(static::$styles) &amp;&amp; count(static::$styles) ){ foreach( static::$styles as $style ){ $html.='&lt;link href="'.static::$public_uri.'styles/'.$style.'" rel="stylesheet" type="text/css" /&gt;'."\n"; } } return $html; } static function render_scripts(){ $html=''; if( is_array(static::$scripts) &amp;&amp; count(static::$scripts) ){ foreach( static::$scripts as $script ){ $html.='&lt;script language="javascript" src="'.static::$public_uri.'scripts/'.$script.'"&gt;&lt;/script&gt;'."\n"; } } return $html; } protected function getActionFile(){ $dir=$this-&gt;getDirectory().$this-&gt;templates_dir.'/'; if( defined('ADMIN') &amp;&amp; isset($this-&gt;data['admin_action']) ){ //  admin_action.php $file=$dir.$this-&gt;data['admin_action'].'.php'; if( !file_exists($file) ) $file=$dir.$this-&gt;data['action'].'.php'; }elseif( isset($this-&gt;data['action']) ){ $file=$dir.$this-&gt;data['action'].'.php'; } if( $file &amp;&amp; file_exists($file)){ return $file; }else{ return null; } } public function set( $name, $value=null ){ if( is_array($name) ){ foreach( $name as $key=&gt;$value ){ $this-&gt;data[$key]=$value; } }else{ $this-&gt;data[$name]=$value; } return $this; } public function render(){ /*           (templates),       template.php,  admin_template.php    View::$global_data -    */ $dir=$this-&gt;getDirectory().$this-&gt;templates_dir.'/'; if( defined('ADMIN') ){ $template=$dir.'admin_'.$this-&gt;template; //   admin_template.php if( !file_exists($template) ) $template=$dir.$this-&gt;template; }else{ $template=$dir.$this-&gt;template; } extract( static::$global_data ); extract( $this-&gt;data, EXTR_OVERWRITE ); $public_uri=static::$public_uri; ob_start(); require ($template); return ob_get_clean(); } static function microRender( $template, $data ){ /*        ,   ""  template.php */ $dir=dirname( \Autoload::findClass(get_called_class()) ); $file=$dir.'/templates/'.$template.'.php'; if( file_exists($file) ){ if( is_array($data) ) extract($data); ob_start(); require ($file); return ob_get_clean(); }else{ return "     $file&lt;br&gt;"; } } public function __toString(){ return $this-&gt;view-&gt;render(); } }</span></span></code> </pre><br></div></div><br><br>  Further, a very brief implementation example. <br><br>  Implementation of the main controller: <div class="spoiler">  <b class="spoiler_title">To uncover</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">main</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lib</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $controllers=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'pages'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'title'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'class'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'\\pages\\Controller'</span></span> ) ); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action_index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ $static_page=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \static_pages\Controller(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'get_page'</span></span>,<span class="hljs-string"><span class="hljs-string">'index'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view_data[<span class="hljs-string"><span class="hljs-string">'content'</span></span>]=$static_page-&gt;render(); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action_about</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ $static_page=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \static_pages\Controller(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'get_page'</span></span>,<span class="hljs-string"><span class="hljs-string">'about'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view_data[<span class="hljs-string"><span class="hljs-string">'content'</span></span>]=$static_page-&gt;render(); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action_contacts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ $static_page=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \static_pages\Controller(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'get_page'</span></span>,<span class="hljs-string"><span class="hljs-string">'contacts'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view_data[<span class="hljs-string"><span class="hljs-string">'content'</span></span>]=$static_page-&gt;render(); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareForAdmin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( defined(<span class="hljs-string"><span class="hljs-string">'ADMIN'</span></span>) ){ <span class="hljs-comment"><span class="hljs-comment">//    ,     uri   $this-&gt;controllers['banners']=array( 'title'=&gt;'', 'class'=&gt;'\\banners\\Controller' ); $this-&gt;controllers['static_pages']=array( 'title'=&gt;' ', 'class'=&gt;'\\static_pages\\Controller' ); } return true; } protected function before_view(){ if( !defined('AJAX') ){ /*          View */ } } }</span></span></code> </pre><br></div></div><br>  View main controller, about the same look View the rest of the triads <br><div class="spoiler">  <b class="spoiler_title">To uncover</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">main</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>::$scripts[<span class="hljs-string"><span class="hljs-string">'jquery'</span></span>]=<span class="hljs-string"><span class="hljs-string">'jquery-1.9.0.js'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>::$styles[<span class="hljs-string"><span class="hljs-string">'main'</span></span>]=<span class="hljs-string"><span class="hljs-string">'main.css'</span></span>; } }</code> </pre><br></div></div><br>  An example of the main template.php <i>template</i> called controller <br><div class="spoiler">  <b class="spoiler_title">To uncover</b> <div class="spoiler_text"><pre> <code class="php hljs">&lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">='</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pages</span></span></span><span class="hljs-class">'&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class">( $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">file</span></span></span><span class="hljs-class">=$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getActionFile</span></span></span><span class="hljs-class">() )</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> $file; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span>; } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;/div&gt;</code> </pre><br></div></div><br><br>  The resulted code is part of my project "in the evenings", it is a little cut off in a habr-editor, therefore something can not work, it is not ready to spread demo - it is not present yet. <br><br>  So I got what I wanted: <br><ul><li>  CNC </li><li>  ease </li><li>  namespaces </li><li>  triads are located in isolation, including patterns </li><li>  administration can be embedded directly in the triad using the <i>admin_</i> prefix for templates </li><li>  low connectivity between controller classes -&gt; View and main controller -&gt; controller, as well as View -&gt; template </li><li>  automatic routing, it can be made more flexible by blocking <i>action404 ()</i> </li><li>  easy to implement AJAX requests </li><li>  You can very easily connect your own set of scripts and styles for each controller. </li></ul><br>  True, there is no model and caching, and also, you need to think very well about security. <br>  I would like to hear the opinion of professionals about the shortcomings, and maybe not even reinvent the wheel. </div><p>Source: <a href="https://habr.com/ru/post/170739/">https://habr.com/ru/post/170739/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../170729/index.html">Automatic differentiation "on the fingers"</a></li>
<li><a href="../170731/index.html">Details about Geeksphone Peak</a></li>
<li><a href="../170733/index.html">In the Internet from under DosBox. Text and graphic browsers for Dos</a></li>
<li><a href="../170735/index.html">About compilers and interpreters</a></li>
<li><a href="../170737/index.html">The attendance of the ‚Äúdead‚Äù Megaupload is almost equal to the traffic Mega</a></li>
<li><a href="../170743/index.html">Controller for smart greenhouses</a></li>
<li><a href="../170745/index.html">Why sometimes you shouldn‚Äôt reinvent the wheel</a></li>
<li><a href="../170747/index.html">New domain zones such as ".cadillac," ".vegas," and ".music." will appear in April</a></li>
<li><a href="../170749/index.html">Making a VoIP GSM Gateway from Tp-link mr-3020 and Huawei E-171 - part one</a></li>
<li><a href="../170751/index.html">Nagios vs Icinga. The real story of one of the ‚Äúhottest‚Äù branches in free software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>