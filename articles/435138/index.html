<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to take control of network infrastructure. Part Three Network security</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Since this chapter is quite voluminous, I decided to publish it in parts. 
 Network security Part one. 



 It makes no sense to talk about the comple...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to take control of network infrastructure. Part Three Network security</h1><div class="post__text post__text-html js-mediator-article">  <i>Since</i>  <i>this chapter is quite voluminous, I decided to publish it in parts.</i> <i><br></i>  <i>Network security</i>  <i>Part one.</i> <br><br><img src="https://habrastorage.org/webt/ic/zl/ob/iczlobsie0nn35wca5rfggwbory.jpeg" alt="image"><br><br>  It makes no sense to talk about the complete elimination of security risks.  We basically can not reduce them to zero.  You also need to understand that in an effort to make the network more and more secure, our solutions are becoming more and more expensive.  It is necessary to find a reasonable compromise for your network between price, complexity and security. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Of course, the security design is organically integrated into the overall architecture and the security solutions used affect the scalability, reliability, manageability, ... of the network infrastructure, which should also be taken into account. <br><br>  But let me remind you that now we are not talking about creating a network.  In accordance with our <a href="https://habr.com/post/433614/">initial conditions</a> , we have already chosen a design, equipment has been selected, and infrastructure has been created, and at this stage, we should, if possible, ‚Äúlive‚Äù and find solutions in the context of the previously chosen approach. <br><br>  Our task now is to identify the risks associated with security at the network level and reduce them to a reasonable value. <a name="habracut"></a><br><br><h1>  Network security audit </h1><br>  If ISO 27k processes are implemented in your organization, then security audits and network changes should be organically incorporated into the overall processes within this approach.  But these standards are not about specific solutions, not about configuration, not about design ... There are no definite advice, there are no standards dictating in detail what your network should be, this is the complexity and beauty of this task. <br><br>  I would single out a few possible network security audits: <br><br><ul><li>  equipment configuration audit (hardening) </li><li>  security design audit </li><li>  access audit </li><li>  process audit </li></ul><br><h1>  Hardware Configuration Audit (hardening) </h1><br>  It seems that in most cases this is the best starting point for auditing and improving the security of your network.  IMHO, this is a good demonstration of the Pareto law (20% of the efforts give 80% of the result, and the remaining 80% of the efforts - only 20% of the result). <br><br>  The bottom line is that we usually have recommendations from vendors regarding the ‚Äúbest practices‚Äù on security when configuring equipment.  This is called ‚Äúhardening‚Äù. <br><br>  You can also often find a questionnaire (or create it yourself), based on these recommendations, which will help you determine how your equipment configuration corresponds to these ‚Äúbest practices‚Äù and make changes to your network according to the result.  This will allow you to quite easily, virtually without costs, significantly reduce security risks. <br><blockquote>  Some examples for some Cisco operating systems. <br><br>  <a href="https://www.cisco.com/c/en/us/support/docs/ip/access-lists/13608-21.html">Cisco IOS Configuration Hardening</a> <br>  <a href="https://tools.cisco.com/security/center/resources/increase_security_ios_xr_devices.html">Cisco IOS-XR Configuration Hardening</a> <br>  <a href="https://tools.cisco.com/security/center/resources/securing_nx_os.html">Cisco NX-OS Configuration Hardening</a> <br>  <a href="https://www.cisco.com/c/en/us/td/docs/solutions/Enterprise/Security/Baseline_Security/securebasebook/appendxD.html">Cisco Baseline Security Check List</a> <br><br>  Based on these documents, a list of configuration requirements for each type of equipment can be created.  For example, for a Cisco N7K VDC these requirements might look like <a href="https://www.dropbox.com/s/hnat6yriyptigzb/7k_hard.xlsx%3Fdl%3D0">this</a> . </blockquote><br>  In this way, configuration files can be created for different types of active equipment in your network infrastructure.  Further, manually or using automation, you can ‚Äúfill‚Äù these configuration files.  How to automate this process will be discussed in detail in another series of articles on orchestration and automation. <br><br><h1>  Audit security design </h1><br>  Typically, the following segments are present in one form or another in an enterprise network: <br><br><ul><li>  DC (Public services DMZ and Intranet data center) </li><li>  Internet access </li><li>  Remote access VPN </li><li>  WAN edge </li><li>  Branch </li><li>  Campus (Office) </li><li>  Core </li></ul><br>  The names are taken from the <a href="https://www.cisco.com/c/en/us/td/docs/solutions/Enterprise/Security/SAFE_RG/SAFE_rg/chap1.html">Cisco SAFE</a> model, but it is not necessary, of course, to attach to these names and to this model.  Still, I want to talk about the essence and not to link in the formalities. <br><br>  For each of these segments, security requirements, risks, and, accordingly, solutions will be different. <br><br>  Consider each of them separately for problems that you may encounter in terms of security design.  Of course, again, I repeat that in no way this article claims to be complete, which is difficult to achieve in this really deep and multifaceted topic (if at all possible), but reflects my personal experience. <br><br>  There is no perfect solution (at least now).  It is always a compromise.  But it is important that the decision to apply one or another approach was made consciously, with an understanding of both its advantages and disadvantages. <br><br><h2>  Data center </h2><br>  The most critical security segment. <br>  And, as usual, there is also no universal solution.  It all depends on the network requirements. <br><br><h3>  Need or not firewall? </h3><br>  It would seem that the answer is obvious, but everything is not quite as clear as it may seem.  And not only the <b>price</b> can affect your choice. <br><blockquote>  Example 1. <b>Delays.</b> <br><br>  If between some network segments low latency is an essential requirement that, for example, is true in the case of an exchange, then between these segments we will not be able to use firewalls.  It is difficult to find studies on delays in firewalls, but only a few switch models can provide delays of less than or about 1 mksec, so I think that if microseconds are important for you, then firewalls are not for you. </blockquote><blockquote>  Example 2. <b>Performance.</b> <br><br>  The bandwidth of top L3 switches is usually an order of magnitude higher than the bandwidth of the most productive firewalls.  Therefore, in the case of high-intensity traffic, you will also likely have to let this traffic bypass firewalls. </blockquote><br><blockquote>  Example 3. <b>Reliability.</b> <br><br>  Firewalls, especially modern NGFW (Next-Generation FW) - complex devices.  They are much more complex than L3 / L2 switches.  They provide a large number of services and configuration capabilities, so it is not surprising that their reliability is much lower.  If service continuity is critical for the network, then you may have to choose what will lead to better availability ‚Äî firewall security or simplicity of a network built on switches (or various factories) using ordinary ACLs. </blockquote>  In the case of the above examples, you are likely (as usual) to find a compromise.  Look towards the following solutions: <br><br><ul><li>  If you decide not to use firewalls inside the data center, then you need to consider how to limit access to the perimeter as much as possible.  For example, you can open only the necessary ports from the Internet (for client traffic) and administrative access to the data center only from jump hosts.  On jump hosts, perform all necessary checks (authentication / authorization, antivirus, logging, ...) </li><li>  You can use logical partitioning of the data center network into segments, like the scheme described in PSEFABRIC <a href="https://github.com/nihole/PSEFABRIC/wiki/p002-design">example p002</a> .  In this case, the routing must be configured so that traffic that is sensitive to delays or high-intensity traffic goes ‚Äúinside‚Äù one segment (in the case of p002, VRF-a) and does not go through the firewall.  Traffic between different segments will still go through the firewall.  You can also use route leaking between VRFs to avoid redirecting traffic through the firewall. </li><li>  You can also use firewall in transparent mode and only for those VLANs where these factors (latency / performance) are not significant.  But you need to carefully study the limitations associated with the use of this mode for each vendor. </li><li> You might consider using the service chain architecture.  This will allow to send only necessary traffic through the firewall.  Theoretically it looks beautiful, but I have never seen this solution in production.  We tested the service chain for the Cisco ACI / Juniper SRX / F5 LTM about 3 years ago, but at that time this solution seemed ‚Äúraw‚Äù to us </li></ul><br><h3>  Protection level </h3><br>  Now you need to answer the question, what tools do you want to use to filter traffic.  Here are some of the features that are commonly present in NGFW (for example, <a href="https://docs.paloaltonetworks.com/pan-os/8-0/pan-os-admin/policy/security-profiles.html">here</a> ): <br><br><ul><li>  stateful firewalling (default) </li><li>  application firewalling </li><li>  threat prevention (antivirus, anti-spyware, and vulnerability) </li><li>  URL filtering </li><li>  data filtering (content filtering) </li><li>  file blocking (file types blocking) </li><li>  dos protection </li></ul><br>  And also not everything is clear.  It would seem that the higher the level of protection, the better.  But you also need to consider that <br><br><ul><li>  the more of the above firewall functions you use, the more natural it will be (licenses, additional modules) </li><li>  the use of some algorithms can significantly reduce the throughput of the firewall, as well as increase delays, see for example <a href="https://www.paloaltonetworks.com/products/secure-the-network/next-generation-firewall/pa-7000-series">here</a> </li><li>  like any complex solution, the use of complex protection methods can reduce the reliability of your solution, for example, when using application firewalling I have encountered blocking some quite standard applications (dns, smb) </li></ul><br>  As usual, you need to find the best solution for your network. <br><br>  It is impossible to unambiguously answer the question what protection functions may be required.  Firstly, because of course it depends on the data that you transmit or store and try to protect.  Secondly, in reality, often the choice of remedies is a matter of faith and trust to the vendor.  You do not know the algorithms, you do not know how effective they are and you cannot fully test them. <br><br>  Therefore, in critical segments, using solutions from different companies can be a good solution.  For example, you can enable antivirus on the firewall, but also use anti-virus protection (of another manufacturer) locally on the hosts. <br><br><h3>  Segmentation </h3><br>  This is a logical segmentation of the data center network.  For example, partitioning into VLANs and subnets is also a logical segmentation, but we will not consider it because of its obviousness.  Interesting is the segmentation taking into account such entities as FW security zones, VRFs (and their analogues for various vendors), logical devices (PA VSYS, Cisco N7K VDC, Cisco ACI Tenant, ...), ... <br><blockquote>  An example of such a logical segmentation and currently demanded data center design is given in <a href="https://github.com/nihole/PSEFABRIC/wiki/p002-design">p002 of the PSEFABRIC project</a> . </blockquote>  Having defined the logical parts of your network, you can further describe how traffic flows between different segments, on which devices filtering will be performed and by what means. <br><br>  If there is no clear logical partitioning in your network and the rules for applying security policies for different data streams (flow) are not formalized, this means that when opening this or that access, you are forced to solve this problem, and with a high probability you will solve it every time differently. <br><br>  Often, segmentation is based only on FW security zones.  Then you need to answer the following questions: <br><br><ul><li>  what security zones do you need </li><li>  what level of protection do you want to apply to each of these zones </li><li>  will intra-zone traffic be allowed by default </li><li>  if not, which traffic filtering policies will be applied within each of the zones </li><li>  what traffic filtering policies will be applied for each pair of zones (source / destination) </li></ul><br><h3>  TCAM </h3><br>  Often there is the problem of insufficient TCAM (Ternary Content Addressable Memory), both for routing and for access.  IMHO, this is one of the most important issues when choosing equipment, so you need to treat this issue with the proper degree of accuracy. <br><br><blockquote>  Example 1. Forwarding Table TCAM. <br><br>  Let's take a look at the <a href="https://paloaltonetworks.pl/pa-7000/">Palo Alto 7k</a> firewall. <br>  See that IPv4 forwarding table size * = 32K <br>  At the same time, this number of routes is common for all VSYSs. <br><br>  Suppose that, in accordance with your design, you decide to use 4 VSYS. <br>  Each of these BGP VSYSs is connected to two PE MPLS clouds that you use as BB.  Thus, 4 VSYSs exchange all specific routes with each other and have a farwarding table with approximately the same set of routes (but different NHs).  Since  each VSYS has 2 BGP sessions (with the same settings), then each route received via MPLS has 2 NH and, accordingly, 2 FIB entries in the Forwarding Table.  If we assume that this is the only firewall in the data center and it should know about all routes, then this will mean that the total number of routes in our data center can not be more than 32K / (4 * 2) = 4K. <br><br>  Now, if we assume that we have 2 data centers (with the same design), and we want to use VLANs that are ‚Äústretched‚Äù between data centers (for example, for vMotion), then to solve the routing problem, we must use host routes. But this means that for 2 data centers we will have no more than 4096 possible hosts and, of course, this may not be enough. </blockquote><blockquote>  Example 2. TCAM ACL. <br><br>  If you plan to filter traffic on L3 switches (or other solutions that use L3 switches, for example, Cisco ACI), then when choosing equipment you should pay attention to the ACL TCAM. <br><br>  Suppose you want to control accesses on the Cisco Catalyst 4500 SVI interfaces. Then, as you can see from <a href="https://www.cisco.com/c/en/us/support/docs/switches/catalyst-4000-series-switches/66978-tcam-cat-4500.html">this article</a> , you can use only 4096 lines of TCAM to control the outgoing (as well as incoming) traffic on the interfaces.  That when using TCAM3 will give you about 4,000 thousand ACE (ACL lines). </blockquote>  In case you are faced with the problem of insufficient TCAM, then, first of all, of course, you need to consider the possibility of optimization.  So, in case of a problem with the size of the Forwarding Table, you need to consider the possibility of aggregating routes.  In the case of a problem with the size of a TCAM for accesses, an audit of accesses, deletion of obsolete and intersecting records, and possibly a review of the procedure for opening accesses (will be discussed in detail in the chapter on access auditing). <br><br><h3>  High availability </h3><br>  The question is whether to use HA for firewalls or to put two independent boxes ‚Äúin parallel‚Äù and in case one of them crashes traffic through the second? <br><br>  It would seem that the answer is obvious - use HA.  The reason why this question still arises is that, unfortunately, the theoretical and advertising 99 and several nines after the comma percent of accessibility in practice are far from being so rosy.  HA - logically quite a complicated thing, and on different equipment, and with different vendors (there were no exceptions), we caught problems and bugs and stopped the service. <br><br>  In the case of using HA, you will be able to turn off individual nodes, switch between them without stopping the service, which is important, for example, when upgrading, but at the same time you have a far from zero chance that both nodes will break at the same time, and that the upgrade will not be as smooth as the vendor promises (this problem can be avoided if you have the opportunity to test the upgrade on laboratory equipment). <br><br>  If you do not use HA, then from the point of view of double breakage your risks are much lower (since you have 2 independent firewalls), but since  sessions are not synchronized, then each time there is a switch between these firewalls, you will lose traffic.  You can, of course, use stateless firewalling, but then the meaning of using a firewall is largely lost. <br><br>  Therefore, if as a result of the audit you found lonely firewalls, and you are thinking about increasing the reliability of your network, then HA, of course, is one of the recommended solutions, but you should also take into account the disadvantages associated with this approach and, perhaps, for your network more appropriate would be another solution. <br><br><h3>  Ease of management (managability) </h3><br>  In principle, HA is also about controllability.  Instead of configuring the 2 boxes separately and solving the configuration synchronization problem, you manage them in many ways as if you had one device. <br><br>  But maybe you have a lot of data centers and a lot of firewalls, then this question arises at a new level.  And the question is not only about configuring, but also about <br><br><ul><li>  backup configurations </li><li>  updates </li><li>  upgrades </li><li>  monitoring </li><li>  logging </li></ul><br>  And all this can be solved by centralized management systems. <blockquote>  So, for example, if you use Palo Alto firewalls, then <a href="https://www.paloaltonetworks.com/products/management/panorama">Panorama</a> is such a solution. <br></blockquote><br>  <i>To be continued.</i> </div><p>Source: <a href="https://habr.com/ru/post/435138/">https://habr.com/ru/post/435138/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435126/index.html">Experience in organizing and conducting corporate conferences for analysts</a></li>
<li><a href="../435128/index.html">Pi-Sonos: a hobby out of control</a></li>
<li><a href="../435132/index.html">Nomad: problems and solutions</a></li>
<li><a href="../435134/index.html">Simplify working with databases in Qt using QSqlRelationalTableModel</a></li>
<li><a href="../435136/index.html">Sergey and the scientific method</a></li>
<li><a href="../435142/index.html">Examining Tracing with eBPF: Guide and Examples</a></li>
<li><a href="../435144/index.html">Introduction to Spring Boot: Creating a Simple Java REST API</a></li>
<li><a href="../435148/index.html">Own bash DHCP server</a></li>
<li><a href="../435150/index.html">Clinical trials on the threshold - an interview with Aubrey de Gray</a></li>
<li><a href="../435152/index.html">Apple and Qualcomm patent dispute led to a halt in sales of iPhone 7 and 8 in Germany</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>