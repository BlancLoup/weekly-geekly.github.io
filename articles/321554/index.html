<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About ranks and virtualization in RAM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In continuation of the heading "admin summary" I would like to understand the nuances of the RAM technology of modern iron: in the register memory, ra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About ranks and virtualization in RAM</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/f75/a72/646/f75a72646e1049718c46f8394609ded8.jpg" alt="image alt text"></p><br><p>  In continuation of the heading "admin summary" I would like to understand the nuances of the RAM technology of modern iron: in the register memory, ranks, memory banks and so on.  Let us take a closer look at the reliability of data storage in memory and those technologies that relieve administrators of <strong>BSOD</strong> sorrows <strong>innumerable</strong> times a day. <a name="habracut"></a></p><br><h1 id="starye-pesni-pro-novye-tipy">  Old songs about new types </h1><br><p>  Today on the market there are mainly DDR SDRAM memory modules: DDR2, DDR3, DDR4.  Different generations differ among themselves by a number of characteristics - in general, each next generation is "faster, higher, stronger", and for the curious, here is a sign: </p><br><p><img src="https://habrastorage.org/files/715/2ca/443/7152ca4431c24a16b0de5f6e432a6853.jpg" alt="image alt text"></p><br><p>  For selecting the correct memory, the modules themselves are of greater interest: </p><br><ul><li><p>  RDIMM is a registered (buffered) memory.  Convenient for installing a large amount of RAM compared to unbuffered modules.  Of the minuses - lower performance; </p><br></li><li><p>  UDIMM (unregistered DRAM) - unregistered or unbuffered memory is random access memory that does not contain any buffers or registers; </p><br></li><li><p>  LRDIMM - these modules provide higher speeds with higher capacity compared to dual-rank or four-rank RDIMM modules, due to the use of additional memory buffer chips; </p><br></li><li><p>  HDIMM (HyperCloud DIMM, HCDIMM) - modules with virtual ranks that have greater density and provide a higher speed of work.  For example, 4 physical ranks in such modules can be represented for the controller as 2 virtual ones; </p><br></li><li>  FBDIMM is a fully buffered DIMM with high reliability, speed and density. </li></ul><br><p>  Attempting to use these types at the same time can cause a variety of unfortunate consequences, including damage to the motherboard or the memory itself.  But it is possible to use the same type of modules with different characteristics, since they are backward compatible on the clock frequency.  True, the final frequency of the memory subsystem will be limited by the capabilities of the slowest module or memory controller. </p><br><p>  For all types of SDRAM memory there is a common set of basic characteristics affecting the volume and performance: </p><br><ul><li><p>  frequency and mode of operation; </p><br></li><li><p>  rank; </p><br></li><li>  timings </li></ul><br><p>  Of course, there are actually more differences, but to build a properly working system, you can limit yourself to these. </p><br><h1 id="chastota-i-rezhim-raboty">  Frequency and mode of operation </h1><br><p>  It is clear that the higher the frequency - the higher the overall memory performance.  But the memory will still not work faster than the controller on the motherboard allows it.  In addition, all modern modules are able to work in multi-channel mode, which increases the overall performance <a href="https://www.kingston.com/ru/memory/resources/performance_benchmark">up to four times</a> . </p><br><p>  Modes of operation can be divided into four groups: </p><br><ul><li><p>  Single Mode - single channel or asymmetric.  It turns on when only one memory module is installed in the system or all modules differ from each other.  In fact, it means the absence of multi-channel access; </p><br></li><li><p>  Dual Mode - dual channel or symmetrical.  Memory slots are grouped by channels, each of which is set to the same amount of memory.  This allows you to increase the speed of work by 5-10% in games, and up to 70% in heavy graphics applications.  Memory modules must be installed in pairs on different channels.  Motherboard manufacturers usually highlight paired slots in one color; </p><br></li><li><p>  Triple Mode - three-channel mode.  Modules are installed in groups of three - for each of the three channels.  <strong>The following modes work similarly</strong> : four-channel (quad-channel), eight-channel (8-channel memory), etc. </p><br></li><li>  Flex Mode - allows you to increase the performance of RAM when installing two modules of different sizes, but with the same frequency. </li></ul><br><p>  For maximum performance, it is better to install the <strong>same</strong> modules with the maximum possible frequency for the system.  At the same time, use the installation in pairs or groups - depending on the available multi-channel operation mode. </p><br><h1 id="rangi-dlya-pamyati">  Ranks for memory </h1><br><p>  A rank is a memory area of ‚Äã‚Äãseveral 64-bit memory chips (72 bits with ECC, which we will talk about later).  Depending on the design, the module can contain one, two or four ranks. </p><br><blockquote>  You can learn this parameter from the markings on the memory module.  For example, Kingston can easily calculate the number of ranks by one of the three letters in the middle of the marking: S (Single - one-rank), D (Dual - two-rank), Q (Quad - four-rank). </blockquote><p>  An example of a complete decoding of <a href="http://www.kingston.com/ru/memory/valueram/valueram_decoder">markings</a> on Kingston modules: </p><br><p><img src="https://habrastorage.org/files/af8/4db/8e4/af84db8e48ab4dc79723f4af15efd4a8.jpg" alt="image alt text"></p><br><p>  Server motherboards are limited by the total number of memory ranks they can work with.  For example, if the maximum can be set to eight ranks with four dual-rank modules already installed, then the memory cannot be added to the free slots. </p><br><p>  Before buying modules, it makes sense to clarify what types of memory the server processor supports.  <a href="http://www.kingston.com/ru/business/server_solutions/best_practices/maximizing_memory">For example</a> , Xeon E5 / E5 v2 supports one-, two-, and four-rank register DIMM (RDIMM) modules, LRDIMM, and non-buffered ECC DIMM (ECC UDIMM) DDR3.  And the <a href="https://servermall.ru/catalog/model-hp-dl120-gen9/498-1/">Xeon E5 v3 processors</a> support single- and two-rank register DIMM modules as well as LRDIMM DDR4. </p><br><h1 id="nemnogo-pro-skuchnye-abbreviatury-taymingov">  A bit about boring timings abbreviations </h1><br><p>  Timings or memory latency (CAS Latency, CL) - the amount of delay in cycles from the arrival of a command to its execution.  The numbers of timings indicate the parameters of the following operations: </p><br><ul><li><p>  <strong>CL</strong> (CAS Latency) - the time that elapses between a processor requesting some data from the memory and the time when the data is issued by the memory; </p><br></li><li><p>  <strong>tRCD</strong> (RAS to CAS delay) - the time that must elapse from the moment the matrix row is accessed (RAS) until the matrix column (CAS) is accessed with the necessary data; </p><br></li><li><p>  <strong>tRP</strong> (RAS Precharge) - the interval from closing access to one row of the matrix, and before starting to access another; </p><br></li><li><p>  <strong>tRAS</strong> - pause to return memory to the waiting state of the next request; </p><br></li><li>  <strong>CMD</strong> (Command Rate) - the time from the activation of the memory chip to accessing it with the first command. </li></ul><br><p>  Of course, the lower the timings - the better for speed.  But for low latency, you will have to pay with a clock frequency: the lower the timings, the lower the clock frequency allowed for the memory.  Therefore, the right choice would be the "golden mean". </p><br><p>  There are also special more expensive modules marked "Low Latency", which can operate at a higher frequency at low timings.  When expanding memory, it is advisable to select modules with timings similar to those already installed. </p><br><h1 id="raid-dlya-operativnoy-pamyati">  RAID for RAM </h1><br><p>  Errors in the storage of data in RAM are inevitable.  They are classified as hardware failures and irregular errors (malfunctions).  A parity memory is able to detect an error, but is unable to correct it. </p><br><p>  For the correction of irregular errors, the ECC-memory is used, which contains an additional chip for detecting and correcting errors in individual bits. </p><br><p>  The error correction method works as follows: </p><br><ol><li><p>  When writing 64 bits of data to a memory cell, a checksum of 8 bits is calculated. </p><br></li><li><p>  When the processor reads the data, the checksum of the received data is calculated and compared with the original value.  If the amounts do not match - this is an error. </p><br></li><li>  If the error is one bit, then the wrong bit is corrected automatically.  If two-bit, the corresponding message for the operating system is transmitted. </li></ol><br><p>  <strong>Advanced ECC</strong> technology is capable of correcting multi-bit errors in a single chip, and it is possible to recover data with it even if the entire DRAM module fails. </p><br><p><img src="https://habrastorage.org/files/911/80b/2ae/91180b2ae51d45c7a0c6750b584c1b01.jpg" alt="image alt text"></p><br><p>  <em>Error correction needs to be separately enabled in the BIOS</em> </p><br><p>  Most server memory modules are register (buffered) - they contain data transfer control registers. </p><br><p>  Registers also allow you to install large amounts of memory, but because of them additional delays in the work.  The fact is that each reading and writing is buffered in the register for one clock cycle before it gets from the memory bus to the DRAM chip, so the register memory is slower than the register memory for one clock cycle. </p><br><p><img src="https://habrastorage.org/files/fd0/c67/2a1/fd0c672a1ab4402296afa40483f9d649.jpg" alt="image alt text"></p><br><p>  <em>Source - <a href="">nix.ru</a></em> </p><br><p>  All register modules and fully buffered memory also support ECC, but the reverse is not always true.  For reasons of reliability, it is better for the server to use the register memory. </p><br><h1 id="mnogoprocessornye-sistemy-i-pamyat">  Multiprocessor systems and memory </h1><br><p>  For correct and fast operation of several processors, each of them needs to allocate its own memory bank for direct access.  It is better to read about the organization of these banks in a particular server in the documentation, but the general rule is this: we distribute the memory equally between banks and in each set modules of the same type. </p><br><blockquote>  If you had to install modules into the server with a lower frequency than the motherboard requires, you need to include additional wait cycles in the BIOS when the processor is working with memory. </blockquote><p>  To automatically account for all the rules and recommendations for installing modules, you can use special utilities from the vendor.  For example, HP has an <a href="https://h22195.www2.hpe.com/DDR4memoryconfig/Home/Legal">Online DDR4 (DDR3) Memory Configuration Tool</a> . </p><br><h1 id="itogo">  Total </h1><br><p>  Instead of a spatial conclusion, I‚Äôll give general guidelines for choosing a memory: </p><br><ul><li><p>  For HP multiprocessor servers, it is recommended to use only the register memory with the error correction function (ECC RDIMM), and for uniprocessor servers - unbuffered with ECC (UDIMM).  The UDIMM strips for HP servers are best chosen from the same manufacturer to avoid spontaneous reboots. </p><br></li><li><p>  In the case of RDIMM, it is better to choose single- and two-rank modules (1rx4, 2rx4).  For optimal performance, use dual-rank memory modules in 1 or 2 DIMM configurations per channel.  Creating a configuration of 3 DIMMs with the installation of modules in the third memory bank significantly reduces performance. </p><br></li><li>  For the same reasons of maximum speed, it is desirable to avoid using four-rank RDIMM memory, since it reduces the frequency to 1066 MHz in configurations with one module per channel, and up to 800 MHz in configurations with two modules per channel.  Fair for servers based on Intel Xeon 5600 and Xeon E5 / E5 v2. </li></ul><br><p>  <strong>The list is short, but here everything is necessary and least obvious.</strong>  <strong>Of course, the old-world RTFM principle has not been canceled.</strong> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/321554/">https://habr.com/ru/post/321554/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321544/index.html">Events and streams. Part 1</a></li>
<li><a href="../321546/index.html">C # language is almost functional</a></li>
<li><a href="../321548/index.html">How smart contracts will change our lives</a></li>
<li><a href="../321550/index.html">It's hard to be a junior</a></li>
<li><a href="../321552/index.html">The first application on Spring Boot + ReactJS</a></li>
<li><a href="../321558/index.html">Is it worth it for a IT start-up cofounder to learn programming?</a></li>
<li><a href="../321560/index.html">Comparison of solutions for balancing high-load systems</a></li>
<li><a href="../321562/index.html">Signing resource identifiers and protecting APIs against DDoS attacks</a></li>
<li><a href="../321564/index.html">It is finished! Procedural macros in Rust 1.15</a></li>
<li><a href="../321566/index.html">From zero experience to 6-digit salary: a play in 8 acts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>