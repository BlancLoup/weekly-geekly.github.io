<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple domain based on ROSA Enterprise Linux Server and Samba 3 with roaming profile support</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 

 Continuation of a series of tutorials. Previous parts: 
 " Deploying DNS / DDNS and DHCP server on ROSA Enterpise Linux Server in a fe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple domain based on ROSA Enterprise Linux Server and Samba 3 with roaming profile support</h1><div class="post__text post__text-html js-mediator-article">  <b>Introduction</b> <br><br>  Continuation of a series of tutorials.  Previous parts: <br>  " <a href="http://habrahabr.ru/post/167367/">Deploying DNS / DDNS and DHCP server on ROSA Enterpise Linux Server in a few minutes</a> " <br>  " <a href="http://habrahabr.ru/post/168183/">Mail server based on ROSA Server Enterpise Linux in a few minutes</a> " <br><br>  As I wrote in one of the previous articles, in a more or less large company, sooner or later there is a need for centralization.  One of the generally accepted practices in this case is the need to create a unified authentication service to control accounts and policies. <br><a name="habracut"></a><br>  So what do we need?  We will consider that we have already installed ROSA Enterpirse Linux Server (hereinafter referred to as RELS) and ROSA Directory Server (hereinafter referred to as RDS) on it.  We also stipulate network details in advance. <br>  The server is located at 192.168.100.1.  It will be assigned a FQDN rels.int.  The server and other computers are located on the 192.168.100.0/24 subnet.  The main DNS server will be located in the same domain where it will be given the name named.rosa.int. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Beginning of work</b> <br><br>  Before starting the configuration, make sure that the <b>hostname -f</b> command gives something like: <br><blockquote>  user @ rels ~ $ hostname -f <br>  rels </blockquote><br>  If any error appears like ‚ÄúHost name not found‚Äù, then open the / etc / hosts file and set the FQDN name manually.  In our case, it will look like this: <br><blockquote>  cat / etc / hosts <br>  192.168.100.1 rels rels.int </blockquote><br>  If this is not done, then during the installation of the necessary components, you can catch an error message due to the fact that the ROSA Directory Server cannot find the FQDN of the server.  Because of this, further installation of RDS components will be interrupted. <br><br>  <b>Installation and Setup</b> <br><br>  If you installed the server from scratch by specifying ROSA Directory Server in the list of components, then on the desktop after logging in you can see the ROSA Server Setup icon (hereinafter referred to as RSS).  We launch it and our view shows the login page to the initial setup and installation of the RDS components. <br>  If it turned out that you installed RELS without an RDS component, then for this we need to <b>install the</b> following packages with the <b>yum install</b> command: <br><br>  mss-modules-base <br>  mmc-agent <br>  python-mmc-base <br>  python-mmc-core <br><br>  The remaining missing packages should be pulled up as dependencies.  If everything is done correctly, then two icons will appear in the ‚ÄúAdministration‚Äù section of the main menu: ROSA Server Setup and ROSA Management Console. <br><br><img src="https://habrastorage.org/storage2/686/255/6c9/6862556c948a9ef6d8a68e082eac524f.jpg"><br><br>  After starting the RSS, for further setup, click on the link ‚ÄúGo to ROSA Server Setup‚Äù.  By the way, since this is a web configurator, it is possible to configure not on the server itself, but from the local network from the system administrator's computer.  To do this, contact: <a href="https://xn--ip__-73dbnojbb1kdcjb/">ip_address_server</a> : 8000 / mss /.  For example, in our case it will be <a href="https://192.168.100.1/">192.168.100.1</a> : 8000 / mss /. <br><br><img src="https://habrastorage.org/storage2/951/c25/46a/951c2546a636fafc5052ddb21ff944eb.jpg"><br><br>  After selecting the item ‚ÄúGo to ROSA Server Setup‚Äù, a message about untrusted connection will appear.  Ignore the warning and add our server certificate to security exceptions.  Then, in the window that opens, enter the username and password of the root user. <br><br><img src="https://habrastorage.org/storage2/950/bf4/7d4/950bf47d4f58bfde515b0897f833f64a.jpg"><br><br>  After entering the credentials, we get to the page with two separate blocks: <br><br><ul><li>  ROSA Directory Server </li><li>  Server Services and Tools </li></ul><br><br>  The section ‚ÄúServer Services and Tools‚Äù is not required for us now, so we choose ROSA Directory Server.  After selecting the required item, we will go to the section with a list of components that can be additionally installed via the ROSA Server Setup web interface.  To install the PDC components, we need to select two items: ‚ÄúSamba PDC and file server‚Äù and ‚ÄúDNS server with RDS backend‚Äù.  After selecting the desired components, click "Install components" at the very bottom. <br><br><img src="https://habrastorage.org/storage2/050/870/d53/050870d536f985737fc7a9217d7cbd69.jpg"><br><br>  Next, there will be a window confirming the choice of installed components, and then, as a next step, you can directly observe the process of checking and installing additional components, if they have not been installed before. <br><br><img src="https://habrastorage.org/storage2/49a/5c5/327/49a5c532776169f3d4f2daa6385aeddc.jpg"><br><br>  The next step is to have the initial settings process for the LDAP server, Samba, and DNS server.  All the settings we discussed at the very beginning of the article.  If you forgot, you can return to the beginning of the article.  The only note is that you must enter the password in the ‚ÄúRDS Password‚Äù column.  We will need this password in the future to access the server management console and, ideally, it should not be the same as the root user password, or the password for ROSA Server Setup. <br><br><img src="https://habrastorage.org/storage2/022/640/549/02264054944742e4abcd9459459a2be6.jpg"><br><br>  You should also be careful when setting the checkbox "Password Policy". <br>  This point should be considered very carefully.  When specifying the ‚Äúuse password policy‚Äù option, the passwords you specify must be at least eight characters in length and contain letters and numbers.  Otherwise, it will not be accepted.  Also, if you specify the ‚ÄúPassword Policy‚Äù option, the time limit for using the password and account validity will be applied to the user being created.  All settings related to the password policy can be further changed in the user management panel.  The expiration date of the administrator account is, by default, 27 years. <br><br>  The Netbios name for our server, which will be displayed in the Network Neighborhood, can be arbitrarily set, but for convenience, it is the same as the host name.  About the password and login of the domain administrator, I think, there is no need to explain.  Click "Continue", confirm your actions in the next step of the wizard by pressing the "Perform configuration" button and the initial setup is complete. <br>  To complete the deployment of the domain, we will need to carry out a small additional configuration of the DNS server.  To do this, open the main menu and find the Administration&gt; ROSA Management Console.  If you are setting up a server from a local network, the configuration console is available at <a href="http://xn--ip__-73dblchtcb7i4acl8i/mmc/">ip_your_server / mmc</a> . <br>  After entering the root username and password, which we set up during the initial configuration of the ROSA Directory Server, we will go to the server settings management page. <br><br><img src="https://habrastorage.org/storage2/e88/0af/1b6/e880af1b67e105a7fbc6a6846737f3dd.jpg"><br><br>  If you look at the screen, then on the right we will see the ‚ÄúNetwork‚Äù section, where the menu items responsible for DNS server settings are listed below.  Click "Add DNS-zone" and go to the section responsible for adding DNS zones.  Actually, the settings are presented in the illustration below.  I repeat, we described the necessary parameters at the very beginning of the article.  Everything is configured extremely simple.  It is impossible to make a mistake, since the entered parameters are checked for correctness. <br><br><img src="https://habrastorage.org/storage2/5a5/c19/fe9/5a5c19fe9aadf9c95db33e18ed6a765c.jpg"><br><br>  After clicking on the "Create" button at the bottom of the screen, a notification about the successful creation of the zone will appear.  After that, you need to restart the DNS server by going to the ‚ÄúNetwork Services Management‚Äù section. <br>  The next step is to configure the server to work with roaming user profiles. <br>  To do this, you need to login as root on the server and edit the contents of /etc/samba/smb.conf.  We are looking for the # profiles # section there and bring it to this form: <br><blockquote>  logon path = \\% N \ profiles \% U <br>  logon drive = Z: </blockquote><br>  The drive letter can be any, just not busy with something else.  Now go to the very end of the smb.conf file and fully uncomment the contents of the [profiles] section.  By default, user profiles will be stored in / home / samba / profiles /% username%.  At will, paths can always be redefined.  After all edits, save the changes and restart the Samba daemon. <br>  It is time to go to create a user, in addition to the already created user admin, to test the domain. <br>  Go to the main page of the ROSA Management Console and select the item ‚ÄúAdd user‚Äù.  In the opened window with the form, fill in the fields with the username and password. <br><br><img src="https://habrastorage.org/storage2/74c/4f9/6c5/74c4f96c5d19da12e7406e4e885f91ea.jpg"><br><br>  At the very bottom of the form, do not forget to uncheck the ‚ÄúAccess to mail‚Äù box if you have not previously <a href="http://habrahabr.ru/post/168183/">configured your mail server</a> .  Otherwise, without filling in the ‚ÄúMailing Address‚Äù field you will not be able to create an account. <br><br><img src="https://habrastorage.org/storage2/f84/ba9/52b/f84ba952b6c2a10546d117b2df7edf10.jpg"><br><br>  After clicking ‚ÄúConfirm‚Äù the account will be created.  If you have a Windows machine, you will be able to log into the newly created domain. <br>  Windows XP operating systems connect to this domain without any problems.  But before connecting, it is recommended to do the following: log in as a local administrator on a Windows computer, then run gpedit.msc.  In the group policy that opens, find the Computer Configuration&gt; Administrative Templates&gt; System&gt; User Profiles section (in Russian-language Windows, this will be Computer Configuration&gt; Administrative Templates&gt; System&gt; User Profiles).  There, find the item ‚ÄúDo not check for Roaming Profile Folders‚Äù (in the Russian version of Windows ‚ÄúDo not check user rights of the roaming profile directories‚Äù) and set it to Enabled, then restart the computer and connect to the domain. <br>  For computers running Windows 7, some actions are also required.  It will be necessary for the local administrator to import the following .reg file before entering the domain: <a href="https://bugzilla.samba.org/attachment.cgi%3Fid%3D4988%26action%3Dview">bugzilla.samba.org/attachment.cgi?id=4988&amp;action=view</a> Then restart.  Additional details on using Windows 7 in the Samba domain can be found here: <a href="https://wiki.samba.org/index.php/Windows7">wiki.samba.org/index.php/Windows7</a> <br>  By default, the Samba server also provides file server storage capabilities.  In the initial configuration we described above, the Public directory opens for access. <br>  Now we will configure the server so that it connects this share automatically for each user. <br>  Go to the directory / home / samba / netlogon and create a file there logon.bat with the following contents: <br><blockquote>  NET USE H: / DEL / YES <br>  NET USE H: \\ Rels \ public </blockquote><br>  We save and try to enter the user created by us.  In My Computer, you will see a mounted H drive: which is actually a share. <br>  For further work in a real enterprise network, I recommend reconfiguring paths for user directories like ‚ÄúMy Documents‚Äù so that they are stored on a network drive without having to drag the entire profile content over the network each time the user connects.  Since this moment is somewhat beyond the scope of the article, I leave it to you for homework.  :) <br><br>  <b>Conclusion</b> <br><br>  That's it.  You have a ready-made full-fledged authentication server based on Samba 3 for Windows and Linux machines.  Of course, this does not pretend to be a full replacement of Active Directory from Microsoft, but nevertheless, some additional functionality based on this can be screwed. <br>  In advance of answering the question about creating a tool for deploying and managing a domain on the Samba 4 base, which can completely replace Active Directory - yes, it is planned.  But I cannot name the deadlines yet. <br><br>  Questions, reasonable criticism and comments are traditionally welcome. </div><p>Source: <a href="https://habr.com/ru/post/169127/">https://habr.com/ru/post/169127/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169115/index.html">Learn entrepreneurship with the Imagine Cup. Submission of applications until February 15, 2013</a></li>
<li><a href="../169117/index.html">Build js, redjs builder</a></li>
<li><a href="../169121/index.html">A beautiful console for working with git under Windows</a></li>
<li><a href="../169123/index.html">Write us a program ...</a></li>
<li><a href="../169125/index.html">Ext JS 4 Grid "on the fingers"</a></li>
<li><a href="../169129/index.html">Cisco 1603 Router</a></li>
<li><a href="../169131/index.html">Modern bootkit technology and detailed analysis of Win32 / Gapz</a></li>
<li><a href="../169133/index.html">Well, quite a small note on getopts</a></li>
<li><a href="../169135/index.html">Pluginator.ru - plugin service for livestreet</a></li>
<li><a href="../169137/index.html">We invite mobile developers and startups on AppClub {build, monetize} # 4 in Kiev</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>