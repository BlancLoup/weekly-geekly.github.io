<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Enterprise-class cloud storage based on NGINX Plus and Minio</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article describes how to configure the reverse proxy server NGINX or NGINX Plus as a load balancer for object storage (object storage) based on M...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Enterprise-class cloud storage based on NGINX Plus and Minio</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/172/a9b/796/172a9b796cbd472c9fc91e4d67b982ac.png"><br><p>  This article describes how to configure the <a href="https://www.nginx.com/resources/glossary/reverse-proxy-server/%3Futm_source%3Denterprise-grade-cloud-storage-nginx-plus-minio%26utm_medium%3Dblog%26utm_campaign%3DCloud">reverse proxy server</a> NGINX or NGINX Plus as a <a href="https://www.nginx.com/resources/glossary/cloud-load-balancing/%3Futm_source%3Denterprise-grade-cloud-storage-nginx-plus-minio%26utm_medium%3Dblog%26utm_campaign%3DCloud">load balancer</a> for object storage (object storage) based on <a href="https://minio.io/">Minio</a> . </p><a name="habracut"></a><br><h2 id="proektirovanie-hranilischa-obektov">  Designing a storage facility </h2><br><p>  Almost any application needs storage, but the requirements for this component of the system can vary greatly.  Consider, for example, the document repository: it is possible that at the initial stages of work it will not have to handle a large number of read requests, but may later need scaling.  Another application (such as, for example, an image gallery) already from the moment of launch should be able to quickly serve a large number of requests and scale as needed. </p><br><p>  These subtleties complicate the process of organizing storage.  But everything is not so bad: with the advent of object storage (object storage) as the standard way of storing unstructured data (largely due to the need to use HTTP), the process of standardizing the operation of the application with the storage began. </p><br><p>  But the question still remains: how to organize sharpened for your application and at the same time flexible storage of objects? </p><br><p>  Since working with the object storage implies the use of HTTP servers and clients, it is necessary to select a suitable web server (for example, that does not need an NGINX representation) to serve HTTP traffic.  A lightweight and highly scalable object storage server can be used as a backend.  For this role, <a href="https://minio.io/">Minio</a> is great.  The flexibility of such a system is a key factor in creating a corporate-level service. </p><br><p>  With NGINX Plus, administrators can not only configure incoming traffic balancing, but also caching, throttling, SSL / TLS termination, and even traffic filtering based on various parameters.  Minio, on the other hand, offers lightweight object storage compatible with <a href="https://aws.amazon.com/s3/">Amazon S3</a> . </p><br><p>  Minio is designed to accommodate unstructured data, such as photos, videotapes, log files, backup copies, as well as images of virtual machines and containers.  Its small size allows it to be included in the stack of applications similar to Node.js, Redis, and MySQL.  Minio also supports <a href="https://docs.minio.io/docs/distributed-minio-quickstart-guide">distributed mode (distributed mode)</a> , which provides the ability to connect multiple disk objects to a single storage server, including those located on different machines. </p><br><p>  In this article, we will look at several scenarios for using NGINX Plus in combination with Minio, which allow you to set up a highly scalable, fault-tolerant and stable storage of enterprise-class objects. </p><br><h2 id="nginx-plus-v-kachestve-obratnogo-proksi-i-balansirovschika-nagruzki">  NGINX Plus as a reverse proxy and load balancer </h2><br><p>  NGINX Plus is primarily known as reverse proxy.  But do you need a reverse proxy for Minio?  Let's look at several usage scenarios: </p><br><ul><li>  If one or more Minio servers are faced with the NGINX Plus reverse proxy, it is possible to move the Minio server instances to other machines / sites without the need to change the client settings. </li><li>  NGINX Plus can balance incoming traffic and distribute it evenly to instances of the <a href="https://docs.minio.io/docs/distributed-minio-quickstart-guide">distributed Minio server</a> . </li><li> The NGINX Plus proxy server can be part of a fault-tolerant storage facility created using the <a href="https://docs.minio.io/docs/minio-client-complete-guide"><code>mirror</code></a> command from the Minio Client ( <code>mc</code> ). </li></ul><br><p>  NGINX Plus performs reverse traffic proxying by sending requests to an internal server, which is set by the <a href="http_proxy_module.html"><code>proxy_pass</code></a> directive.  In the following fragment of the configuration file, a single Minio instance is running on <code>localhost</code> and is available at <strong><a href="http://localhost:9000/">http: // localhost: 9000</a></strong> .  All requests to the top-level directory (/) on <strong>www.example.com</strong> , coming to port 80, are sent to Minio.  NGINX Plus explicitly sets the <code>Host</code> header to equal this value in the original request. </p><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> www.example.com; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$http_host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://localhost:9000; } }</code> </pre> <br><p>  If there are several Minio servers, it makes sense to configure traffic balancing by listing these servers in the <a href="http_upstream_module.html"><code>upstream</code></a> configuration block and specifying this group in the <code>proxy_pass</code> directive directive: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">upstream</span></span> minio_servers { <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> minio-server-<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">9000</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> minio-server-<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">9000</span></span>; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> www.example.com; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$http_host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://minio_servers; } }</code> </pre> <br><p>  For more information about configuring NGINX or NGINX Plus as a proxy for Minio, see the Minio <a href="https://docs.minio.io/docs/distributed-minio-quickstart-guide">documentation</a> . </p><br><h2 id="zavershenie-ssltls">  SSL / TLS termination </h2><br><p>  Recently, HTTPS has become the default protocol for transmitting most of the web traffic, so for Minio it makes sense to deploy an HTTPS server right away.  NGINX Plus as an HTTPS server is easy to set up.  The first thing you need is an SSL / TLS certificate that you can get and integrate into NGINX Plus using Let's Encrypt. </p><br><p>  Next, you should edit the NGINX Plus configuration file, where you need to specify the <code>ssl</code> parameter in the <a href="http_core_module.html"><code>listen</code></a> directive, which is located in the <code>server</code> block, and then register the files with <a href="http_ssl_module.html">the server certificate and private key</a> : </p><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> www.example.com; <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> <span class="hljs-number"><span class="hljs-number">301</span></span> https://www.example.com<span class="hljs-variable"><span class="hljs-variable">$request_uri</span></span>; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">443</span></span> ssl; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> www.example.com; <span class="hljs-attribute"><span class="hljs-attribute">ssl_certificate</span></span> www.example.com.crt; <span class="hljs-attribute"><span class="hljs-attribute">ssl_certificate_key</span></span> www.example.com.key; <span class="hljs-attribute"><span class="hljs-attribute">ssl_protocols</span></span> TLSv1 TLSv1.<span class="hljs-number"><span class="hljs-number">1</span></span> TLSv1.<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_ciphers</span></span> HIGH:!aNULL:!MD5; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$http_host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://localhost:9000; } }</code> </pre> <br><p>  For more information on completing SSL / TLS, see the <a href="https://www.nginx.com/resources/admin-guide/nginx-ssl-termination/%3Futm_source%3Denterprise-grade-cloud-storage-nginx-plus-minio%26utm_medium%3Dblog%26utm_campaign%3DCloud">NGINX Plus Admin Guide</a> . </p><br><h2 id="keshirovanie">  Caching </h2><br><p>  Object storage servers are usually not very fast, but this does not mean that client requests are processed slowly.  When caching is enabled on the NGINX Plus server, it saves frequently requested data and can immediately return it to the client without redirecting the request to an internal server. </p><br><p>  Here is how it works.  The NGINX Plus server's web cache is located between the client and the Minio server, and a copy of each file requested from the repository is stored in it.  If the requested file is in the cache, NGINX immediately returns it without referring to Minio.  This reduces the response time for the client and the load on the Minio server. </p><br><p>  To configure the NGINX Plus cache to work with Minio, the directives <a href="http_proxy_module.html"><code>proxy_cache_path</code></a> and <a href="http_proxy_module.html"><code>proxy_cache</code></a> .  The <code>proxy_cache_path</code> directive sets the location and configuration of the cache, and <code>proxy_cache</code> activates it.  Additional information can be found in <a href="https://www.nginx.com/blog/nginx-caching-guide/%3Futm_source%3Denterprise-grade-cloud-storage-nginx-plus-minio%26utm_medium%3Dblog%26utm_campaign%3DCloud">A Guide to Caching with NGINX and NGINX Plus</a> . </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">proxy_cache_path</span></span> /path/to/cache levels=<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span> keys_zone=my_cache:<span class="hljs-number"><span class="hljs-number">10m</span></span> max_size=<span class="hljs-number"><span class="hljs-number">10g</span></span> inactive=<span class="hljs-number"><span class="hljs-number">60m</span></span> use_temp_path=<span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-section"><span class="hljs-section">server</span></span> { ... <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_cache</span></span> my_cache; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$http_host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://localhost:9000; } }</code> </pre> <br><h2 id="drosselirovanie-throttling">  Throttling </h2><br><p>  There are cases when, based on business requirements or security concerns, some http clients need to be a little ‚Äústrangled‚Äù.  NGINX Plus allows you to limit the available bandwidth, the number of requests and connections. </p><br><p>  To limit the bandwidth, use the <a href="http_core_module.html"><code>limit_rate</code></a> directive.  In the following example, the download speed is limited to 200 Kb per second: </p><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { ... <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /images/ { <span class="hljs-attribute"><span class="hljs-attribute">limit_rate</span></span> <span class="hljs-number"><span class="hljs-number">200k</span></span>; ... } }</code> </pre> <br><p>  To limit the number of requests, use the <a href="http_limit_req_module.html"><code>limit_req</code></a> and <a href="http_limit_req_module.html"><code>limit_req_zone</code></a> , similar to this example, in which each unique IP address is limited to 10 requests per second with peaks to 20 requests. </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">limit_req_zone</span></span> <span class="hljs-variable"><span class="hljs-variable">$binary_remote_addr</span></span> zone=my_req_limit:<span class="hljs-number"><span class="hljs-number">10m</span></span> rate=10r/s; <span class="hljs-section"><span class="hljs-section">server</span></span> { ... <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /images/ { <span class="hljs-attribute"><span class="hljs-attribute">limit_req</span></span> zone=my_req_limit burst=<span class="hljs-number"><span class="hljs-number">20</span></span>; ... } }</code> </pre> <br><p>  To limit the number of connections, use the directives <a href="http_limit_conn_module.html"><code>limit_conn</code></a> and <a href="http_limit_conn_module.html"><code>limit_conn_zone</code></a> .  In the following example, each unique IP address is limited to five simultaneous connections. </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">limit_conn_zone</span></span> <span class="hljs-variable"><span class="hljs-variable">$binary_remote_addr</span></span> zone=my_conn_limit:<span class="hljs-number"><span class="hljs-number">10m</span></span>; <span class="hljs-section"><span class="hljs-section">server</span></span> { ... <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /images/ { <span class="hljs-attribute"><span class="hljs-attribute">limit_conn</span></span> my_conn_limit <span class="hljs-number"><span class="hljs-number">5</span></span>; ... } }</code> </pre> <br><p>  For more information, see the <a href="https://www.nginx.com/resources/admin-guide/restricting-access/%3Futm_source%3Denterprise-grade-cloud-storage-nginx-plus-minio%26utm_medium%3Dblog%26utm_campaign%3DCloud">NGINX Plus Admin Guide</a> . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  In this article, we have demonstrated several features of NGINX Plus, which allow load balancing (in particular, for the Minio Object Storage Server).  A bunch of NGINX Plus and Minio allows you to customize a flexible storage of objects, tailored to the needs of your application. </p><br><p>  This article was originally published <a href="https://www.nginx.com/blog/enterprise-grade-cloud-storage-nginx-plus-minio/">on the Nginx blog</a> . </p><br><p>  You can find us on Slack: <a href="http://slack.minio.io/">slack.minio.io</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/324086/">https://habr.com/ru/post/324086/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324072/index.html">Software defined storage: compare 7 solutions</a></li>
<li><a href="../324076/index.html">Mitap MSK.NET Community</a></li>
<li><a href="../324078/index.html">Report from Data Fest‚Å¥ February 11-12</a></li>
<li><a href="../324080/index.html">Atomic payments for parking fees in Lamoda</a></li>
<li><a href="../324082/index.html">Data Science Weekend. Speaker presentations</a></li>
<li><a href="../324088/index.html">Create the perfect search string</a></li>
<li><a href="../324090/index.html">Search for the way in tower defense games</a></li>
<li><a href="../324092/index.html">How dangerous shortened links and how to protect against it</a></li>
<li><a href="../324098/index.html">Common Bird Census, or bioinformatics in ornithology. Project in good hands</a></li>
<li><a href="../324100/index.html">Welcome to the new Hardaton</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>