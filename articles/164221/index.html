<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The noexcept compile time specifier in C ++ 11</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With the new C ++ standard, many interesting and useful improvements have appeared, one of which is the noexcept compile-time specifier, which tells t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The noexcept compile time specifier in C ++ 11</h1><div class="post__text post__text-html js-mediator-article">  With the new C ++ standard, many interesting and useful improvements have appeared, one of which is the noexcept compile-time specifier, which tells the compiler that the function will not throw exceptions.  If you are interested in the advantages of this specifier and are not afraid of C ++ code - welcome under cat. <br><a name="habracut"></a><br><h4>  Reducing the size of the binary file </h4><br>  Let's consider the following example, in which comments explain what the code is generated by the compiler: <br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; class my_class { int i_; public: explicit my_class (int i) : i_(i) {} int get() const { return i_; } }; inline int operator+(const my_class&amp; v1, const my_class&amp; v2) { return v1.get() + v2.get(); } int main() { int res = 0; try { //      var0  , //       res  -1 my_class var0(10); //      var1  , //       //  var0,     //   res  -1 my_class var1(100); //     , //       res  -1 //   var1  var0    , //     . res = (var1 + var0 &gt; 0 ? 0 : 1); } catch (...) { std::cerr &lt;&lt; " "; res = -1; } return res; }</span></span></span></span></code> </pre> <br>  Too much code is generated by the compiler, isn't it?  It is because of this swelling of the code that in some large corporations (we will not point fingers at <a href="">Google</a> ), when developing in C ++, the use of exceptions is prohibited.  Another example is the <a href="http://gcc.gnu.org/codingconventions.html">development rules for GCC</a> since version 4.8 (yes, GCC is now being developed using C ++, see <a href="http://gcc.gnu.org/gcc-4.8/changes.html">changes for 4.8</a> ). <br><br>  Let's modify the class my_class so that it uses noexcept and see what the compiler can generate: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">my_class</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i_; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">explicit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_class</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i_</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i_; } }; <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>+(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> my_class&amp; v1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> my_class&amp; v2) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v1.get() + v2.get(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// std::terminate   my_class var0(10); // std::terminate   my_class var1(100); // std::terminate   int res = (var1 + var0 &gt; 0 ? 0 : 1); //   var1  var0 return res; }</span></span></code> </pre><br><br>  Note that std :: cerr is no longer used, and therefore the compiler will be able to remove a very large piece of code.  But even without this, the amount of generated code has become less. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Unfortunately, we looked at the perfect compiler.  In practice, things may not be so great: the feature is quite new, not all compilers are able to use it well for optimizations. <br>  Also, some compilers <u>sometimes</u> and without noexcept can determine if a class or method will throw exceptions. <br><br>  Here are the results of compiling different versions of the same class on GCC 4.7.2: <br>  1) The initial class, the body of main from the first variant, the flags -std = c ++ 0x -fno-inline -O2: 5280 bytes <br>  2) Optimization class, main body from the second variant, flags -std = c ++ 0x -fno-inline -O2: 4800 bytes <br><br>  3) Optimization class, main body from the first variant, flags -std = c ++ 0x -fno-inline -O2: 5280 bytes <br>  4) Optimization class, main body from the first variant without iostream, flags -std = c ++ 0x -fno-inline -O2: 4800 bytes <br>  5) Optimization class, main body from the second option + iostream is turned on, -std = c ++ 0x -fno-inline -O2 flags: 5280 bytes <br><br>  * The -std = c ++ 0x flag includes the features of C ++ 11, which is required to use noexcept. <br>  ** When repeating the experiment, do not forget to remove the debug information from the binary file. <br><br>  Comparing the first two lines we get the expected size improvement in the case of a perfect compiler. <br>  The third, fourth and fifth lines show that the compiler and without noexcept could be optimized to our second option, and only could not throw out the extra declarations used in the iostream header file. <br><br>  Let's cheat a little, and we will spread the method main () and the implementation of my_class on different files, so that the compiler is more difficult to optimize. <br>  Results: <br>  The initial class, the body of the main from the first option, the flags -std = c ++ 0x -fno-inline -O2: 6952 bytes <br>  Optimization class, main body from the first variant, -std = c ++ 0x -fno-inline -O2 flags: 5288 bytes <br><br>  <u>Total: a</u> gain of 23.9% after adding three noexcept. <br><br><h4>  Acceleration of standard algorithms </h4><br>  For many people using C ++ 11, this part of the <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2010/n3050.html">N3050</a> standard may be a big surprise (at the moment this standard is not implemented in all leading compilers).  If in short, it says that standard algorithms and containers should not use move assignment and move construction if these methods can throw exceptions.  Than it can threaten we consider on an example: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//       move assignment class move_fast_copy_slow { //      public: move_fast_copy_slow(move_fast_copy_slow&amp;&amp;); // 1 move_fast_copy_slow(const move_fast_copy_slow&amp;); // 2 move_fast_copy_slow&amp; operator=(move_fast_copy_slow&amp;&amp;); // 3 move_fast_copy_slow&amp; operator=(const move_fast_copy_slow&amp;); // 4 };</span></span></code> </pre><br><br>  If methods 1 and 3 are not marked with noexcept, then standard containers will use the slower methods 2 and 4. As a result, working with containers std :: vector and std :: deque can slow down by a couple of orders of magnitude.  In addition, this slowdown will affect all types inherited or using move_fast_copy_slow as a member. <br><br><h4>  Compatibility </h4><br>  At the time of this writing, not all leading compilers support noexcept.  Use the BOOST_NOEXCEPT macro from the boost library instead of noexcept for code portability. <br><br><h4>  Underwater rocks </h4><br>  By standard, noexcept is not part of the function type, but when using virtual functions, all overloaded functions should have the same or more stringent exception specification.  That is, the following code will not be collected: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">base</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{} }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">derived</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> base { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ derived d; base *p = &amp;d; p-&gt;foo(); }</code> </pre><br>  There will be an error like "error: looser throw specifier for virtual void derived :: foo ()". <br>  So be prepared for the fact that if you are the author of the library and added the noexcept specification to the proprietary function, the code will no longer be collected from the users of your library. <br>  Also be prepared for the fact that your exception classes with the overloaded method what () and inherited from the standard ones may not compile if they are not marked with noexcept: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">my_exception</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">what</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">throw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  ++11   noexcept  throw() return "my_exception::what()"; } };</span></span></code> </pre><br><h4>  Conclusion </h4><br>  The noexcept compile time specifier greatly reduces the size of the final file and speeds up the program.  The main thing when using noexcept is not to overdo it.  Remember that if a function marked with noexcept throws an exception out, then your program will call std :: terminate () and exit, without even deigning to call destructors for already created variables. </div><p>Source: <a href="https://habr.com/ru/post/164221/">https://habr.com/ru/post/164221/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../164205/index.html">ION Piano Apprentice - controller for Garage Band</a></li>
<li><a href="../164207/index.html">"It works - do not touch." Should I break the rules?</a></li>
<li><a href="../164213/index.html">How do you feel about anonymity on the Internet?</a></li>
<li><a href="../164215/index.html">Wireless data transmission, ISM range</a></li>
<li><a href="../164217/index.html">Introduction to developing games for Windows 8 using XNA and MonoGame</a></li>
<li><a href="../164223/index.html">New Year's Report Habrapost</a></li>
<li><a href="../164225/index.html">ReactOS 2012</a></li>
<li><a href="../164227/index.html">ICANN expert: domains for pornography and sexual minorities do not violate anyone‚Äôs rights</a></li>
<li><a href="../164229/index.html">Learning programming through the game or how to quickly collect all the honey</a></li>
<li><a href="../164231/index.html">What makes it a natural bullshit in the current investment model</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>