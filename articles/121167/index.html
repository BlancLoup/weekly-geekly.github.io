<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Story about ExecJS or how to execute javascript in Ruby</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suppose you are writing a cool webdvant project on rails. You have a friend Petya - a strong programmer in javascript. As Petya writes a lot and defia...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Story about ExecJS or how to execute javascript in Ruby</h1><div class="post__text post__text-html js-mediator-article">  Suppose you are writing a cool webdvant project on rails.  You have a friend Petya - a strong programmer in javascript.  As Petya writes a lot and defiantly, he decided to make his life easier and came up with a new language with a beautiful and simple syntax that will be broadcast in javascript. <br>  Even Petya is a big fan of green tea, so he called his new language GreenTeaScript. <br><br>  Besides Petit, you have one more programmer-on-javascript friend Vasya.  Vasya once thought of writing a program that would parse JS on AST, optimize it, and then compile it back into beautiful, structured code, cutting off any unnecessary and formatting according to Crawford.  He called his brainchild BeautifyJS.  By the way, BeautifyJS was also able to assemble AST into minimized compressed code and did it faster and better than other alternatives existing in nature. <br><br>  Since both Petya and Vasya did not know how to program anything other than javascript, they wrote their products on it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And here again, let us assume, the first in the world had the idea to fasten these wonderful pieces to their cool web-dance project on the tracks.  You really liked writing frontend in GreenTeaScript, and compressing scripts with BeautifyJS would certainly speed up the site. <br><br>  Now the fun begins. <a name="habracut"></a><br><br><h4>  Javascriptore </h4><br>  Both programs are written in javascript, but we need to somehow perform them from the rail.  Fast googling tells you that in Macosi, which you, say, use, there is JavaScriptCore built into the system, which can be launched from the console with the command <code>/System/Library/Frameworks/JavaScriptCore.framework/Versions/A/Resources/jsc</code> .  You quickly write a class that takes a piece of javascript, feeds this thing, parses the result and voila - everything works!  Nishtyak. <br><br><h4>  JScript </h4><br>  You show the project prototype to the investor from your laptop, the investor likes it, but he says that it is necessary to start in a week.  Damn, in a week you will not have time to finish the entire function, so you decide to hire programmer Dima as your assistant. <br>  And Dima, a programmer, uses the Windows operating system, so his MacOS JavaScriptCore doesn't work.  Dima quickly googles and finds a solution - <a href="http://msdn.microsoft.com/en-us/library/9bbdkx3k.aspx">JScript</a> , after which he writes alongside a second class for working under Windows.  And all again nishtyak and works.  This time under Makos and under Windows. <br><br><h4>  Nodejs </h4><br>  For a week you somehow manage to finish everything you need, the investor is very pleased and gives the command to start.  Happily bought a Linux server, is deployed, and then everything breaks down.  Well, right, you forgot to foresee the possibility of executing javascript under Linux. <br>  It does not matter, the solution comes quickly enough.  You just need to put on the NodeJS server and add existing classes to work with it.  No sooner said than done.  Now all this bodyaga works in Linux too. <br><br><h4>  therubyracer </h4><br>  The project is rapidly gaining popularity, a queue of investors is accumulating under the door, wanting to urgently dump you a heap of money, and the server stops cope.  You hire a sysadmin, whose tasks will include the installation and configuration of new servers.  The sysadmin boldly gets down to business, rolls in 5 new servers, deploit them and everything breaks again.  It turns out that on the new servers the version of NodeJS is slightly different from the one on the first server.  It also lies not in <code>/bin/node</code> , but in <code>/usr/local/bin/node</code> .  And in general, according to the administrator, external dependencies are not cool and we must, they say, get rid of them. <br>  You are armed with a ‚ÄúC ++ from scratch in 3 hours‚Äù textbook and feel free to sit down to write a new gem that would allow you to use the NodeJS V8 engine directly from Ruby.  As a result, you get <a href="https://github.com/cowboyd/therubyracer">therubyracer</a> .  When installed, the gem collects its own V8 of the required version in its sandbox and uses it directly.  Lepote! <br>  Now you can clear out that mountain of crutches, which was responsible for the execution of javascript and replace all this with a beautiful class that therubyracer simply uses.  One version is registered everywhere in Gemfile.lock, everything works quickly and equally in all operating systems, everyone is happy. <br><br><h4>  therubyrhino </h4><br>  Once you read article on Habr√© about JRuby.  In the article, among other things, it is written that they say, JRuby is very fast and generally cool.  As an experiment, you decide to run your project on JRuby and drive benchmarks.  Naturally, everything shuts up on therubyracer, which does not work under JRuby. <br>  So you collect a new gem on your knee, <a href="https://github.com/cowboyd/therubyrhino">therubyrhino</a> , which in general does the same thing as therubyracer, but uses Mozilla's Java-based engine and works in JRuby.  Chased benchmarks and calmed down, in general. <br><br><h4>  Together </h4><br>  The project grows up and out, the number of servers increases, you hire 5 new programmers per week.  Each new programmer you buy a computer, and then half a day you tell how to install a compiler with all the reasons for therubyracer to assemble.  And then it‚Äôs still going to be 10 minutes. You sadly remember the days when everything worked on the built-in JavaScriptCore without any compilers right away. <br><br>  Why all this long story?  And to the fact that the new Rails 3.1 adds support for CoffeeScript and UglifyJS by default.  This is almost the same as our imaginary GreenTeaScript and BeautifyJS, only real-life.  And the Rails Core Team ran into the same problems as we, only for real. <br><br>  How did they get rid of them?  They wrote <a href="https://github.com/sstephenson/execjs">ExecJS</a> - an ingenious gem that allows you to use all possible ways to execute javascript from Ruby without adding any dependencies.  He checks each of the methods for accessibility, and then suggests using the best one found. <br>  Thus, the developer on macos will all run via JavaScriptCore, in his neighbor on Windows via JScript, and under Linux it will try to cling to NodeJS or politely suggest to put therubyracer. <br><br>  Everything works like this: <br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'rubygems'</span></span> <span class="hljs-comment"><span class="hljs-comment">#      1.8 require 'execjs' #      jsfunc = &lt;&lt;JS function square(n){ return n*n; } JS #   context = ExecJS.compile(jsfunc) #     context.call('square', 10) # =&gt; 100 #     ExecJS.eval 'Math.pow(10, 2)' # =&gt; 100</span></span></code> </pre><br><br>  As you can see, everything is quite transparent and simple.  It is not necessary to go into details, it just works in the most optimal way available. <br><br>  Thus, it turns out that chasing javascript to Ruby is now simpler than steamed turnip.  In my opinion, this is very cool! </div><p>Source: <a href="https://habr.com/ru/post/121167/">https://habr.com/ru/post/121167/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121158/index.html">Master class in Kiev, June 18 (Sat)</a></li>
<li><a href="../121159/index.html">Installing Asp.Net on Linux (nginx + mono + xsp)</a></li>
<li><a href="../121162/index.html">Testing. Start</a></li>
<li><a href="../121165/index.html">Documentary Foundation announces release of LibreOffice 3.4.0</a></li>
<li><a href="../121166/index.html">Without Agents.com - Is it possible to rent / rent an apartment without intermediaries?</a></li>
<li><a href="../121169/index.html">Architecture of intelligent transport systems on the example of US DoT ITS</a></li>
<li><a href="../121171/index.html">Yesterday's ban - tomorrow's exclusive</a></li>
<li><a href="../121175/index.html">Company NOX Audio has released hi-tech headphones with Android</a></li>
<li><a href="../121176/index.html">Mozilla promises to make Firefox less voracious.</a></li>
<li><a href="../121178/index.html">ASUS and Intel are sponsors of Sensation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>