<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cyto: creating a level editor, adapting to the iPhone and other utilities</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! We continue to share our practical experience in developing games for iOS from scratch. In this case, there were a lot more pitfalls than we...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cyto: creating a level editor, adapting to the iPhone and other utilities</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  We continue to share our practical experience in developing games for iOS from scratch.  In this case, there were a lot more pitfalls than we could have imagined when we began development.  Disrupting the deadlines, unnatural (at first glance) requirements of publishers and Apple, crooked free engines ... This is only part of what we had to spend our time and energy on. <br><br><img src="https://habrastorage.org/storage2/556/8fc/ea4/5568fcea4446618fbf36be990f3a94a8.jpg"><br><br>  In the last <a href="http://habrahabr.ru/company/room_8_studio/blog/171665/">article</a> we talked about the choice of the engine and how we achieved high-quality pictures and the natural behavior of the elastic shell of our main character.  Below, we will talk about our level editor and touch on the burning topic of how to mercilessly trim your child to an acceptable size, as well as adapt the game for a miniature iPhone screen reader.  And finally, we will give a few more useful tips for which they themselves would have given the left kidney a year ago. <br>  Carefully, under the cut a lot of pictures! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  In this article we tell exactly the technical details of the development, so if anyone is interested to know where it came from, how the idea developed and why it is worthwhile to appreciate the advice of publishers - read our <a href="http://www.iphones.ru/iNotes/292148">Dev Story</a> on iphones.ru. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/8TZNals5cuM%3Ffeature%3Doembed&amp;xid=25657,15700002,15700019,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhhv90ywe_KJucgKry7B4Fhhe9c-qw" frameborder="0" allowfullscreen=""></iframe><br>  <i>One of the first gameplay videos Cyto.</i>  <i>Compare with the release version - <a href="http://www.youtube.com/watch%3Fv%3DunDiOzxU-pw%26amp%3Bfeature%3Dplayer_embedded">click</a></i> <br><br><h4>  <b>How to make a level design nice</b> </h4><br><img src="https://habrastorage.org/storage2/8d1/eab/dc6/8d1eabdc6978ef524530fcf9576b9494.jpg"><br><br>  When it came time to make up the levels for the game, we realized that this process takes us an unrealistic lot of time.  All changes were made blindly in the level file, but in order to check what happened, it was necessary to completely recompile the project, which, by that time, had already become quite large.  It took half a day to assemble one more or less imputed level.  We had a choice - to spend a lot of time and energy on drawing up levels or to allocate some time to create a visual editor and forget about the problems with level design.  The choice was obvious.  However, the time for this eventually went away, of course, twice as much as planned.  Having spent twice as long as we expected, we built our Level Editor, with blackjack and whores. <br><br><img src="https://habrastorage.org/storage2/7c2/d5f/2ad/7c2d5f2ad7bcdfeb19d3065800077713.jpg"><br><br>  Embedding the ability to edit existing functionality turned out to be another entertainment.  Whatever game you do, be sure to include the ability to edit, save and load game objects at an early stage, and the more flexible this feature is, the better.  The debug console, by the way, also does not hurt, although we did not add it.  How to organize work with the level editor depends on the specific project.  For us, the most convenient approach was editing the levels directly on the iPad.  You can play the "freshly picked" level right away, literally with one tap. <br><br><img src="https://habrastorage.org/storage2/845/c90/54f/845c9054f5649700bf03739ec32ee593.jpg"><br><br>  We decided to use a very simple workflow: <br><br><img src="https://habrastorage.org/storage2/b45/b7d/dec/b45b7ddec03d3e460285cd68d6a28e35.jpg"><br><br>  The database of levels is stored on the FTP server, all devices are synchronized with it and store a local copy of the database.  After the work on the level is completed, it can be downloaded to the server.  This makes it possible for several level designers to simultaneously participate in the process, as well as work quietly on the levels in the absence of the Internet, being, for example, in an airplane (there have been cases), and when a network appears, simply upload the results of your work to the server. <br><br>  After all the levels are ready, they are already manually pulled from the server and added to the project - the approved levels in the build are always separated from the edited ones, thus eliminating the possibility of accidentally changing the finished level. <br><br><img src="https://habrastorage.org/storage2/010/c31/8a0/010c318a0d2c72997d94d446b2f9bd5d.jpg"><br><br>  By the way, the indispensable thing was the small preview pictures of the locations, which are stitched by the editor directly into the level file.  Without them, it would have been impossible to sort through several hundred Levels. <br><br>  We paid a lot of attention to the convenience of creating and editing.  Level Editor turned out to be more like an app from the App Store than an internal development tool.  When we completed it, creating levels was as enjoyable as playing them. <br><br><img src="https://habrastorage.org/storage2/b68/be1/a09/b68be1a09f3569d445667739960a0d69.jpg"><br><br><h4>  <b>Trim the game five times</b> </h4><br>  One unexpected surprise was waiting for us at the end of the development.  When we started working with Chillingo Publisher, they emphasized the importance of the ‚Äú <a href="https://developer.apple.com/news/index.php%3Fid%3D03202012a">keep within 50MB</a> ‚Äù <a href="https://developer.apple.com/news/index.php%3Fid%3D03202012a">item</a> .  Not for nothing almost all the top games on the App Store are less than 50 meters.  There is no exact statistics on this, but it may well be that the size of the application is much more important than the minimum supported version of iOS. <br><br><img src="https://habrastorage.org/storage2/d4b/353/993/d4b3539937d0fb67f167b23460ec61c3.jpg"><br><br>  We knew about the limit for cellular networks before, but did not give it enough attention.  By that time, the Cyto build was over 150MB.  The size of the application had to be reduced three times!  "This is unreal ... It is not worth it ...", - we thought and started optimizing the size.  It turned out to be quite real, although not so easy. <br><br>  After examining the size distribution for different resources in the application, it turned out that the largest places were occupied by huge atlases with animations of game objects.  We wanted to make the world of each level pack unique, with its own graphic elements and colors.  For each of the worlds, their cells, backgrounds, portals were painted - each pack had a completely original art. <br><br><img src="https://habrastorage.org/storage2/66e/4e2/49a/66e4e249ae44e55ac5b1918db34c60e1.jpg"><br><br>  In some places we tried to set the color to the sprites (there is such a function in cocos2d).  It was terrible.  Repainting objects with embedded coconut means was no good.  We wanted to achieve the same effect as in Photoshop, where you can completely change the hue of the image without losing any details. <br><br><img src="https://habrastorage.org/storage2/290/6ad/41b/2906ad41b14b5c1c16837b2f344d58a2.jpg"><br><br>  It turned out to be sufficient to apply the HSV color model, and everything fell into place.  Although it was possible to perform all these color manipulations directly in the shader (by that time Cyto had already moved to cocos2d 2.0 for a long time), this would mean a constant extra load on the device.  Since during the game we did not need to dynamically change the colors of the objects, it was decided to change the color of the texture immediately when it was loaded. <br><br><img src="https://habrastorage.org/storage2/5f2/ab1/ac4/5f2ab1ac4b7322c633d4977ab49db619.jpg"><br><br>  Googling a bit, we found some ready-made solutions for converting from RGB to HSV, for example, <a href="http://www.cocos2d-iphone.org/forum/topic/30623">here</a> .  Screwing this to the test case, we realized that this is exactly what we wanted.  As a result, the necessary colors were beautifully substituted for each pack and our designers were extremely pleased with the result. <br><br>  Nevertheless, even using one set of basic objects for all packs, we could not keep within the required size.  All the same, there were huge atlases with separate animations of objects that should be unique for each world. <br><br><img src="https://habrastorage.org/storage2/23f/f88/8ac/23ff888ac6f5588ea8917f11b444f58f.png"><br><br>  The most effective approach was to replace the frame-by-frame animation of entire objects with software animation of individual elements of these objects, although it had to be done with a hard code.  But as a result, we also received a bonus in the form of the dynamism and liveliness of these animations - there is practically no cycling in them, everything moves randomly within the specified limits.  In addition, an object composed of several small elements looks much better when scaled than a similar object drawn by one sprite. <br><br><img src="https://habrastorage.org/storage2/cdd/aa9/803/cddaa9803e253605496138fc60fbefe7.jpg"><br>  <i>Something like this atlases before and after optimization</i> <br><br>  Another trick that had to go - the backgrounds in the menu and in levels.  All of them, in fact, are made in a fairly small resolution and only under SD screens, no @ 2x pictures.  The fact is that the textures in the coconut with an increase are filtered in such a way that it turns out quite beautiful and, most importantly, free blur.  The main thing is to prepare the source code correctly so that they already have minimal blurring and no sharp lines, otherwise you will get a picture with blurred squares instead of a blur. <br><br><img src="https://habrastorage.org/storage2/a76/29e/5f8/a7629e5f850ac45df9b18db909d48ae9.jpg"><br><br>  For some textures, we additionally added a program blur.  It occurs, as well as repainting, at the stage of loading the texture.  We took <a href="http://www.cocos2d-iphone.org/forum/topic/11745">AWTextureFilter as a basis</a> . <br><br>  As a result, we got our own sprite, which can be repainted and blur, and working with it is limited to just one line: <br> <code>CCSpriteExtended *myAwesomeSprite = [CCSpriteExtended spriteWithFile:@"image.png" hueShift:120.0 saturationMult:2.0 valueMult:1.0 blurSize:4];</code> <br> <br><img src="https://habrastorage.org/storage2/a52/76b/53c/a5276b53ca41ad3aa981b47b914699a2.png"><br><br>  There remained the last step - to optimize the already significantly ‚Äúthinner‚Äù game resources.  And again, it did not take long to search.  We came across two free utilities that work in pairs - <a href="http://pngmini.com/">ImageAlpha</a> and <a href="http://imageoptim.com/">ImageOptim</a> .  The result of their work is simply amazing!  In some cases, they can reduce the file size by 80-90%, with almost no deterioration in image quality. <br><br>  After all these tricks, we were surprised to find for ourselves that the build was reduced from 150 to 30 megabytes.  5 times!  There is nothing impossible and it makes no sense to reinvent the wheel - you only need to correctly apply the solutions from which we are separated only by a single search query. <br><br><h4>  <b>IPhone Screen Adaptation</b> </h4><br>  Cyto - first of all, a game for iPad.  On the iPhone, of course, you can play and some even like the iPhone version more, but, in our opinion, the sensations are a bit different.  It's still a game that requires maximum interaction with it, and even a slightly extended iPhone 5 screen will not give half of those sensations that can be obtained by playing on the iPad. <br><br>  However, the adaptation of the game for a small screen had to work hard.  The first thing was added zoom camera.  The player can bring the scene a little closer to more accurately aim.  I had to experiment a lot with the zoom level.  At first I wanted to make it possible to bring the camera to the maximum, as far as art allowed.  As it turned out, this did not add anything to the player except for a heap of inconvenience, although it looked very nice ... Therefore, we decided to limit the zoom as much as possible. <br><br>  <i>You can never do and evaluate something in isolation from the overall picture, you need to look at the result in the aggregate.</i>  <i>Even if some thing seems to be super brilliant, but spoils at least some part of the overall result, it must be safely thrown away.</i>  <i>Especially scrupulous about this should be approached in the issue of gameplay.</i>  <i>If any element that does not make the gameplay better worsens even a small part of it, this should by no means be left as it is.</i> <br><br>  After watching a couple of levels on a small screen, it immediately became clear that you can‚Äôt just take and reduce the levels from the iPad to the iPhone.  Urgently had to adapt the levels.  The levels on both platforms look the same, but if you look closely, they differ in details. <br><br>  Levels on the iPhone were created in the editor on the iPad.  We added the ability to display a frame corresponding to the actual size of the level on the iPhone screen.  Moreover, the same level was immediately adjusted to the resolution of the iPhone 5, and for older devices. <br><br><img src="https://habrastorage.org/storage2/d10/a98/57e/d10a9857eaba7fba426b216673a69507.jpg"><br><br>  Immediately on the iPad, you can try to play in the iPhone-new level - as seen in the screenshots, the picture on the iPad is no different from that on the iPhone.  However, the biggest difficulty was not just to pack the same level in space almost one and a half times smaller.  Although the pictures look identical, the gameplay on the tablet is fundamentally different from that on the phone, where the player covers with his finger almost a quarter of the location. <br><br>  As a result, the iPhone version of the game turned out to be quite ‚Äúplayable‚Äù, although far from ideal in our understanding.  By the way, the statistics of the distribution of devices on which people play Cyto were a surprise for us: the number of iPhones exceeds the iPad by 20%, although we focused mainly on the iPad platform.  Apparently, it affects the fact that the application is universal, and the number of iPhones on the market significantly exceeds the iPad. <br><br><h4>  <b>Conclusion</b> </h4><br>  We turn to the conclusions.  If we sum up all of the above, then the main thing that we have learned over the entire development period is that the <b>main component of the project‚Äôs success is implementation, not the idea.</b>  Contrary to popular belief, it doesn‚Äôt matter what inspired the game designer when creating the project.  The main thing - that he could eventually show the players.  And, no matter how important and ingenious some ideas would seem, if they do not make your gameplay better - they are worth nothing.  And on the other hand, if even the most banal and all-used element will help improve your gameplay - apply it in your game. <br><br>  In addition, novice developers (and ourselves a year ago) would like to advise the following things: <br><br><ul><li>  <b>Never try to tie the gameplay to the game world, the plot, etc.</b>  Thereby, you drive yourself into tight frames and dig a hole in your game, from which it will be very difficult to get out.  If it is interesting to play the prototype of squares, circles and triangles, you can move on.  Come up with as many varied game mechanics as possible.  Having a good gameplay, you can pull on almost any plot.  On the contrary - it is very difficult.  In Cyto, we went the wrong way, dotted with a rake in the form of a ready-made game world, character and plot.  And it was a great lesson for us. </li><li>  <b>Really evaluate your strength and timing.</b>  We planned to make the game in a couple of months, and spent several times more.  We were lucky and we were able to complete the project.  And for most startups, unfortunately, reassessing their strength is tantamount to failure.  Be honest with yourself, ask yourself, can you bring it to the end? </li><li>  <b>Design patterns are good, but they are not a panacea.</b>  And patterns for patterns is not good at all.  As it turned out, in games it‚Äôs not really where to use them, the structure is too specific.  Than to foster an inappropriate pattern and turn around an already complex code, it is better to try to think over the functionality in advance, try to take into account all the details, and then it will be much easier.  And yes, no one canceled the code comments. </li><li>  <b>Use tools to help you better organize your workflow.</b>  Bug tracker, wiki, task lists, agile / scrum - all this will help you to be more effective, but only if it really helps and fits.  Do not use these tools just because someone advised them to you or to follow the latest trends.  Try, experiment! </li></ul><habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/174301/">https://habr.com/ru/post/174301/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../174293/index.html">Bridging the gap between System Center and VMware with the new Veeam Management Pack 6.0</a></li>
<li><a href="../174295/index.html">Why problems arise in communications in big cities and how they are solved</a></li>
<li><a href="../174297/index.html">Fuel - the world's smallest "emergency" charger</a></li>
<li><a href="../174299/index.html">The Third Round of Windows Phone Next App Star Voting Round Started</a></li>
<li><a href="../1743/index.html">"Corbina" reduced fee for "Home Internet"</a></li>
<li><a href="../174303/index.html">AppClub {build, monetize} # 5 will gather mobile experts and startups again</a></li>
<li><a href="../174305/index.html">Layout Automation</a></li>
<li><a href="../174307/index.html">Practical use of the Advanced Camera API</a></li>
<li><a href="../174309/index.html">Video analytics: a pragmatic view</a></li>
<li><a href="../174311/index.html">Digest of upcoming IT events for April 2013</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>