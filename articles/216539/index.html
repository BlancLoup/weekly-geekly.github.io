<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating your WebRTC application on the 1C-Bitrix platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the open spaces of Habr, articles about WebRTC technology are increasingly published , several good articles have already been written on how to st...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating your WebRTC application on the 1C-Bitrix platform</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/d69/b6e/451/d69b6e451a91228a5e739d90750ef697.jpg"><br><br>  In the open spaces of Habr, articles about WebRTC technology <a href="http://habrahabr.ru/search/%3Fq%3Dwebrtc">are</a> increasingly <a href="http://habrahabr.ru/search/%3Fq%3Dwebrtc">published</a> , several good articles have already been written on how to start working with WebRTC technology (for example: <a href="http://habrahabr.ru/post/187270/">one</a> , <a href="http://habrahabr.ru/post/198632/">two</a> ). <br><br>  In this article I want to tell how using WebRTC and Bitrix technologies to create my own multimedia web application. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Little about technology </h4><br>  The WebRTC technology appeared relatively recently, the first draft was submitted in November 2012 and in just a year the technology reached a good level and it can and should be used. <br><br>  The technology offers developers the opportunity to create multimedia web applications (video / audio calls) without the need to download and install additional plugins. <br>  Its goal is to build a unified platform for real-time communication that will work in any browser and on any operating system. <br><br>  Most recently, the list of supported applications was very small and consisted of only one browser: Google Chrome. <br>  Over the past year, this list has expanded considerably and almost all modern browsers have begun to support technology. <br><br>  Currently these are: Mozilla Firefox 27+ and WebKit-based browsers - Google Chrome 29+, Opera 18+, Yandex Browser 13+. <br>  It is hoped that Safari should be on the list soon, as the company joined the WebRTC working group in <a href="https://twitter.com/dontcallmeDOM/status/434448884262117376">February 2014</a> . <br><br>  Unfortunately, Microsoft does not plan to implement WebRTC and is creating its own <a href="http://html5labs.interoperabilitybridges.com/cu-rtc-web/cu-rtc-web.htm">CU-RTC-Web</a> technology, but they may make their technology more or less <a href="http://blogs.msdn.com/b/interoperability/archive/2013/01/17/ms-open-tech-publishes-html5-labs-prototype-of-a-customizable-ubiquitous-real-time-communication-over-the-web-api-proposal.aspx">compatible</a> . <br>  For Internet Explorer users, we suggest releasing a desktop application based on Chromium and offering it to browser users without the support of this technology. <br><br>  I talked about how we use WebRTC technologies and about the work of the desktop application at the <b>Winter Partner Conference 1C-Bitrix</b> , you can watch my report <a href="http://conf.1c-bitrix.ru/winter2014/agenda/broadcast/">online</a> or download the <a href="">video</a> . <br><br><br><h4>  How does WebRTC work? </h4><br>  In fact, everything works <a href="http://habrahabr.ru/company/bitrix/blog/206200/">very simply</a> , literally three points. <br><br>  1. The user is asked for permission to use the video camera and microphone; <br>  2. We connect with another user (who also gave permission to use the equipment), exchanging with him data about codecs and ip addresses for direct connection; <br>  3. Show the video and play the sound; <br><br><img src="https://habrastorage.org/getpro/habr/post_images/364/59f/782/36459f782b5fa6f89d2d829f8d1daf8b.jpg" height="156"><img src="https://habrastorage.org/getpro/habr/post_images/5b9/317/a10/5b9317a10f5dd929e51f894d099d637c.jpg" height="156"><img src="https://habrastorage.org/getpro/habr/post_images/ae9/873/d39/ae9873d392043ab55fe6bbce7eb58422.jpg" height="156"><br><br>  Is everything so simple?  Yeah almost :) <br><br>  The WebRTC technology does not provide tools for the initial binding of users, it is this part that you have to do yourself, this part is called ‚ÄúSignaling‚Äù or ‚ÄúSignaling Protocol‚Äù. <br><br><br><h4>  What is the "Signaling Protocol"? </h4><br>  Signaling protocol or Signaling means the organization of communications between users for the exchange of commands and data. <br><br>  In the simplest scheme, you need to organize the processing of the following commands: <br>  1. invite - Invitation to call (the user is calling you, answer or not); <br>  2. answer - Answer the call; <br>  3. decline - Cancel the call; <br>  4. busy - The user is busy with another call; <br>  5. ready - The user is ready to exchange data; <br>  6. signaling - data exchange; <br><br>  The above are just basic commands, there may actually be more of them: <br>  - join ‚Äî connect to an existing conversation; <br>  - wait - online user, wait for a response; <br>  - waitTimeout - another user did not wait for a response; <br>  - errorAccess - the user has technical problems; <br>  - reconnect - the user was unable to establish a connection, reconnection is required; <br><br>  What will happen when you receive a command, what messages will be displayed and what the interface will be, you decide, for your business objectives. <br><br><br><h4>  I understood everything, I want to create an application! </h4><br>  To work with WebRTC, you need to understand that while this is not an approved <a href="http://dev.w3.org/2011/webrtc/editor/webrtc.html">standard</a> , the API is <a href="http://www.webrtc.org/interop">slightly different</a> in different browsers. <br>  It is also worth thinking about how to organize a realtime transport for signaling, think about how to bypass <a href="http://en.wikipedia.org/wiki/NAT_traversal">NAT,</a> and read instructions on how <a href="http://www.html5rocks.com/en/tutorials/webrtc/basics/">to make</a> it all <a href="http://www.html5rocks.com/en/tutorials/webrtc/basics/">work</a> . <br><br>  After reading the lines above, you most likely have already lost the desire to make the WebRTC application and almost closed the page <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bba/f10/905/bbaf10905ac3c1e0c9ee5556bec76bdf.jpg" height="200"><br><br>  <b>But set aside the panic!</b>  We already have everything in the product, see for yourself: <br><br>  1. On the basis of our module Push &amp; Pull and the module for the nginx server - <a href="https://github.com/wandenberg/nginx-push-stream-module">nginx-push-stream-module</a> , you can organize the signal protocol in real time, how to work with them in detail is written in <a href="http://dev.1c-bitrix.ru/community/blogs/hazz/work-with-push-and-pull.php">my</a> Bitrix <a href="http://dev.1c-bitrix.ru/community/blogs/hazz/work-with-push-and-pull.php">blog.</a> not satisfied, you can easily replace it with another product (for example, <a href="http://socket.io/">Socket.io</a> ); <br><br>  2. To bypass NATA, we created a cloud service that is available to all product users at <b>turn.calls.bitrix24.com</b> ; <br><br>  3. In the core of the product, we have added a special <b>core_webrtc</b> library which will hide from you a discrepancy in the API and most of the logic of WebRTC operation (the library is available in the ‚ÄúMain Module‚Äù from version 14.0.15); <br><br>  <u>and the most pleasant</u> <br><br>  4. We have developed a special component in which all the logic is implemented so that you can quickly penetrate and start writing your application (the component is available in the Push &amp; Pull module starting from version 14.1.5); <br><br><br><h4>  Run the demo application </h4><br>  In the ‚ÄúPush &amp; Pull‚Äù module (/ bitrix / modules / pull /) since version 14.1.5, a <b>demo</b> folder has appeared in it at the moment two examples: <br>  1. An example of working with the ‚ÄúPush &amp; Pull‚Äù module; <br>  2. Example of working with WebRTC; <br><br>  I wanted to talk about the second one: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca3/f65/0dc/ca3f650dc80e1796e2bc2048e5ba029b.png"><br><br>  To get started, follow these steps: <br>  1. Copy the component from the folder / bitrix / modules / pull / demo / webrtc / compontents /, for example, here / bitrix / compontens / yourcompanyprefix / <br>  2. Copy the page / bitrix / modules / pull / demo / webrtc / html /, for example, to the root of your site; <br>  3. Configure the Push &amp; Pull module to work with the Queue Server; <br>  4. Register two users; <br><br>  Everything, now you can go to this page under two different users and start calling each other! <br><br><br><h4>  The best documentation is the source code. </h4><br>  I will briefly describe the purpose of each function that is used in demo_webrtc.js (located in the component), everything else, I hope, will be clear from the source code. <br><br>  To better understand the component and how it works, read these two articles, it will help you to more easily navigate: <br>  <a href="http://dev.1c-bitrix.ru/community/blogs/hazz/jscore-register-extention.php">Creating your own JS library: JS, CSS, Phrases, Dependencies.</a> <br>  <a href="http://dev.1c-bitrix.ru/community/blogs/hazz/work-with-push-and-pull.php">Work with the module "Push &amp; Pull"</a> <br><br><div class="spoiler">  <b class="spoiler_title">WebRTC: Initialization</b> <div class="spoiler_text">  <b>YourCompanyPrefix.webrtc ()</b> <br>  This is the class for working with WebRTC. It describes the default values ‚Äã‚Äãand work with Signaling. <br>  To the note: BX.garbage will work when leaving the page or reloading, thus you can terminate the call. <br><br>  <b>BX.inheritWebrtc (YourCompanyPrefix.webrtc);</b> <br>  This function must be performed immediately after initialization, it will inherit all the base classes of our base library BX.webrtc <br></div></div><br><div class="spoiler">  <b class="spoiler_title">WebRTC: UserMedia API</b> <div class="spoiler_text">  <b>YourCompanyPrefix.webrtc.startGetUserMedia</b> <br>  Function to request access to the video camera and microphone <br><br>  <b>YourCompanyPrefix.webrtc.onUserMediaSuccess</b> <br>  This function is called when the ‚ÄúSuccessful Access to Equipment‚Äù event is triggered. <br><br>  <b>YourCompanyPrefix.webrtc.onUserMediaError</b> <br>  This function is called when the ‚ÄúError while accessing equipment‚Äù event is triggered. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">WebRTC: PeerConnection API</b> <div class="spoiler_text">  <b>YourCompanyPrefix.webrtc.setLocalAndSend</b> <br>  The function sets the meta-information about the current user and transfers it to another user. <br>  <b>YourCompanyPrefix.webrtc.onRemoteStreamAdded</b> <br>  This function is called when the ‚ÄúRemote media stream received‚Äù event is triggered, to display it in the video tag. <br><br>  <b>YourCompanyPrefix.webrtc.onRemoteStreamRemoved</b> <br>  This function is called when the ‚ÄúRemote media stream disconnected‚Äù event is triggered, to turn it off in the video tag. <br><br>  <b>YourCompanyPrefix.webrtc.onIceCandidate</b> <br>  This function is called when the event "On the need to transfer meta-information about codecs, ip and other information" to another user is triggered. <br><br>  <b>YourCompanyPrefix.webrtc.peerConnectionError</b> <br>  The function is called when there is an error creating a connection between users. <br><br>  <b>YourCompanyPrefix.webrtc.peerConnectionReconnect</b> <br>  The function sends a request to attempt to reconnect the user to an existing session, for example, due to an error <br><br>  <b>YourCompanyPrefix.webrtc.deleteEvents</b> <br>  The function clears all changed variables for a new call. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">WebRTC: Signaling API</b> <div class="spoiler_text">  <b>YourCompanyPrefix.webrtc.callInvite</b> <br>  Function to send another user's invitation to a video call <br><br>  <b>YourCompanyPrefix.webrtc.callAnswer</b> <br>  The function to send confirmation for the installation of a video call <br><br>  <b>YourCompanyPrefix.webrtc.callDecline</b> <br>  Function to send cancel or end video call <br><br>  <b>YourCompanyPrefix.webrtc.callCommand</b> <br>  The function to send other commands to another user (the user is ready to connect, the user is busy, etc.) <br></div></div><br><div class="spoiler">  <b class="spoiler_title">WebRTC: Basic Commands (from core_webrtc.js)</b> <div class="spoiler_text">  <b>YourCompanyPrefix.webrtc.ready</b> <br>  Check if WebRTC is available in the current browser <br><br>  <b>YourCompanyPrefix.webrtc.signalingReady</b> <br>  Check whether Signaling is available on the current page <br><br>  <b>YourCompanyPrefix.webrtc.toggleAudio</b> <br>  Microphone On / Off <br><br>  <b>YourCompanyPrefix.webrtc.toggleVideo</b> <br>  Turn on / off camera <br>  <b>YourCompanyPrefix.webrtc.onIceConnectionStateChange</b> <br>  The function is called when the event "Setting a connection" <br><br>  <b>YourCompanyPrefix.webrtc.onSignalingStateChange</b> <br>  The function is called when the event "Change communication state" <br><br>  <b>YourCompanyPrefix.webrtc.attachMediaStream</b> <br>  The function to set the video / audio stream in the video tag <br><br>  <b>YourCompanyPrefix.webrtc.log</b> <br>  Logging function <br></div></div><br><hr><br>  I hope this article will be useful to you. <br>  If you have any questions, write in the comments. </div><p>Source: <a href="https://habr.com/ru/post/216539/">https://habr.com/ru/post/216539/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../216525/index.html">On the crest of technology: a meeting in joy - does it happen?</a></li>
<li><a href="../216527/index.html">Dictionary of words</a></li>
<li><a href="../216533/index.html">Hosting provider vs. DDoS attack. REG.RU Solution - Professional Outsourcing</a></li>
<li><a href="../216535/index.html">Reporter reputation management, or Who is to blame and what to do if your newsletter gets into spam?</a></li>
<li><a href="../216537/index.html">MNP: How it all works *</a></li>
<li><a href="../216543/index.html">Is it easy to become an analyst?</a></li>
<li><a href="../216545/index.html">Intel INDE Media Pack</a></li>
<li><a href="../216547/index.html">E-commerce trends: Foreign players come to Russia</a></li>
<li><a href="../216549/index.html">We collect the best in the collection and share with others.</a></li>
<li><a href="../216551/index.html">Sony VAIO Tap 11 - 2-in-1 Tablet and Laptop</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>