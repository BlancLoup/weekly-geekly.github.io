<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to connect Yii Framework and Doctrine 2 ORM?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I really like the Yii Framework. It is fast, convenient, flexible. I like how the ActiveRecord pattern is implemented in it. But there are cases when ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to connect Yii Framework and Doctrine 2 ORM?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/c13/8ed/525/c138ed52553f803328ead2f79d73a9fb.jpg"><br><br>  I really like the Yii Framework.  It is fast, convenient, flexible.  I like how the ActiveRecord pattern is implemented in it.  But there are cases when business logic, and, to be precise, domain logic, is very complex and is constantly growing and modifying.  In such cases, it is more convenient to use the DataMapper pattern. <br><br>  At the same time, I like Doctrine 2 ORM.  This is probably the most powerful ORM for PHP, which has the widest functionality.  Yes, perhaps it is ‚Äúheavy‚Äù and slows down the application.  But when starting a development, first of all, you should think about the architecture of the application, since <i>‚Äúpremature optimization is the root of all ills‚Äù</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thus, once I had the idea to link 2 of these interesting tools to me.  How this was done is described below. <br><a name="habracut"></a><br><h4>  Install the required libraries </h4><br>  It was decided to link Doctrine and Yii by creating the corresponding DoctrineComponent component, which would provide access to the Doctrine functions. <br><br>  First of all, in the protected folder of the framework, the vendor folder was created, where the Doctrine 2 ORM code was downloaded.  You can install Doctrine using Composer or simply by downloading / sloping the source from <a href="https://github.com/doctrine/doctrine2">the Doctrine project's GitHub.</a> <br>  Also, for ORM to work correctly, <a href="https://github.com/doctrine/dbal">Doctrine Database Abstraction Layer</a> and <a href="https://github.com/doctrine/common">Doctrine Common</a> will be needed (when installing Doctrine 2 ORM using Composer, these dependencies are automatically tightened). <br><br>  In addition, I advise that in order to work with Doctrine 2 ORM via the console, install the Symfony component in the same folder as the vendor 2 (for working with Doctrine via the console) and <a href="https://github.com/symfony/Yaml">Yaml</a> (if you wish to describe entities on Yaml) <br><br>  Thus, at this stage, the following project structure should be obtained: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d75/7f8/688/d757f8688b111300e6c289d55f749626.png"><br><br><h4>  Creating the <b>DoctrineComponent</b> Component </h4><br>  Now you can go directly to creating the DoctrineComponent component.  Below I will give the entire component code, since it is rather small.  This code should be located in the protected / components folder in the DoctrineComponent.php file. <br><br><div class="spoiler">  <b class="spoiler_title">DoctrineComponent.php file code</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">EntityManager</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Configuration</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Driver</span></span>\<span class="hljs-title"><span class="hljs-title">AnnotationDriver</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">Common</span></span>\<span class="hljs-title"><span class="hljs-title">Annotations</span></span>\<span class="hljs-title"><span class="hljs-title">AnnotationReader</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">Common</span></span>\<span class="hljs-title"><span class="hljs-title">Annotations</span></span>\<span class="hljs-title"><span class="hljs-title">AnnotationRegistry</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoctrineComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $em = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $basePath; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $proxyPath; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $entityPath; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $driver; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $user; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $password; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $host; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $dbname; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;initDoctrine(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initDoctrine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Yii::setPathOfAlias(<span class="hljs-string"><span class="hljs-string">'Doctrine'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getBasePath() . <span class="hljs-string"><span class="hljs-string">'/vendor/Doctrine'</span></span>); $cache = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Doctrine\Common\Cache\FilesystemCache(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getBasePath() . <span class="hljs-string"><span class="hljs-string">'/cache'</span></span>); $config = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Configuration(); $config-&gt;setMetadataCacheImpl($cache); $driverImpl = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnnotationDriver(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnnotationReader(), <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getEntityPath()); AnnotationRegistry::registerAutoloadNamespace(<span class="hljs-string"><span class="hljs-string">'Doctrine\ORM\Mapping'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getBasePath() . <span class="hljs-string"><span class="hljs-string">'/vendor'</span></span>); $config-&gt;setMetadataDriverImpl($driverImpl); $config-&gt;setQueryCacheImpl($cache); $config-&gt;setProxyDir(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getProxyPath()); $config-&gt;setProxyNamespace(<span class="hljs-string"><span class="hljs-string">'Proxies'</span></span>); $config-&gt;setAutoGenerateProxyClasses(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $connectionOptions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'driver'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getDriver(), <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getUser(), <span class="hljs-string"><span class="hljs-string">'password'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getPassword(), <span class="hljs-string"><span class="hljs-string">'host'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getHost(), <span class="hljs-string"><span class="hljs-string">'dbname'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getDbname() ); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;em = EntityManager::create($connectionOptions, $config); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBasePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($basePath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;basePath = $basePath; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBasePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;basePath; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setEntityPath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($entityPath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;entityPath = $entityPath; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getEntityPath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;entityPath; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setProxyPath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($proxyPath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;proxyPath = $proxyPath; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProxyPath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;proxyPath; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDbname</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($dbname)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;dbname = $dbname; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDbname</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;dbname; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDriver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($driver)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;driver = $driver; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDriver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;driver; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setHost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($host)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;host = $host; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;host; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;password = $password; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;password; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;user = $user; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;user; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> EntityManager */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getEntityManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;em; } }</code> </pre> <br></div></div><br>  The main part of the component is enclosed in the <code>initDoctrine</code> method.  Let's sort out the code in more detail. <br><br><pre> <code class="php hljs">$cache = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Doctrine\Common\Cache\FilesystemCache(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getBasePath() . <span class="hljs-string"><span class="hljs-string">'/cache'</span></span>); $config = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Configuration(); $config-&gt;setMetadataCacheImpl($cache);</code> </pre><br><br>  With this code, we set the method for caching the metadata of the entities from Doctrine.  In an amicable way, the type of caching (in this case, <code>FilesystemCache</code> ) should be better made into the parameters of the component, which we could change when configuring the component. <br><br><pre> <code class="php hljs">$driverImpl = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnnotationDriver(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnnotationReader(), <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getEntityPath()); AnnotationRegistry::registerAutoloadNamespace(<span class="hljs-string"><span class="hljs-string">'Doctrine\ORM\Mapping'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getBasePath() . <span class="hljs-string"><span class="hljs-string">'/vendor'</span></span>); $config-&gt;setMetadataDriverImpl($driverImpl);</code> </pre><br><br>  Using the code above, a driver is installed to read the entity metadata. <br><br><pre> <code class="php hljs"> $config-&gt;setQueryCacheImpl($cache); $config-&gt;setProxyDir(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getProxyPath()); $config-&gt;setProxyNamespace(<span class="hljs-string"><span class="hljs-string">'Proxies'</span></span>); $config-&gt;setAutoGenerateProxyClasses(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre><br><br>  In the code above, we set the caching method for requests (first line), the remaining lines are the setting of the Proxy for Doctrine (path, namespace, installation of automatic generation of Proxy classes) <br><br><pre> <code class="php hljs">$connectionOptions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'driver'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getDriver(), <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getUser(), <span class="hljs-string"><span class="hljs-string">'password'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getPassword(), <span class="hljs-string"><span class="hljs-string">'host'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getHost(), <span class="hljs-string"><span class="hljs-string">'dbname'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getDbname() ); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;em = EntityManager::create($connectionOptions, $config);</code> </pre><br><br>  The code above defines the options for connecting to the database.  These parameters are set when the component is connected (it will be shown later how to connect the component). <br>  And at the end EntityManager is created with certain earlier <code>$connectionOptions</code> and <code>$config</code> , with which you can work with our entities. <br><br><h4>  How to connect DoctrineComponent to the project? </h4><br>  Let's move on to connecting the <code>DoctrineComponent</code> to the project. <br>  It is quite simple to do this - you just need to make changes to the project configuration file (usually it is main.php) <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'components'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'doctrine'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'DoctrineComponent'</span></span>, <span class="hljs-string"><span class="hljs-string">'basePath'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../'</span></span>, <span class="hljs-string"><span class="hljs-string">'proxyPath'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../proxies'</span></span>, <span class="hljs-string"><span class="hljs-string">'entityPath'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../entities'</span></span> ), <span class="hljs-string"><span class="hljs-string">'driver'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pdo_mysql'</span></span>, <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dbuser'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dbpassword'</span></span>, <span class="hljs-string"><span class="hljs-string">'host'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>, <span class="hljs-string"><span class="hljs-string">'dbname'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'somedb'</span></span> ), <span class="hljs-comment"><span class="hljs-comment">// ... );</span></span></code> </pre><br><br>  Now our component will be available through <code>Yii::app()-&gt;doctrine</code> , and we can get the <code>EntityManager</code> through <code>Yii::app()-&gt;doctrine-&gt;getEntityManager()</code> <br><br>  But with this use of the component, a problem arises in the method hints for the <code>EntityManager</code> object.  For this, the following solution was invented: <br><pre> <code class="php hljs">lass MainController extends Controller { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $entityManager = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> Doctrine\ORM\EntityManager */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getEntityManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(is_null(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;entityManager)){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;entityManager = Yii::app()-&gt;doctrine-&gt;getEntityManager(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;entityManager; } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre><br><br>  Each controller is now inherited from <code>MainController</code> and thus, in each controller, you can call the <code>$this-&gt;getEntityManager()</code> method to get an entity manager, and the IDE will now work with method hints for the <code>EntityManager</code> , which is undoubtedly a plus. <br><br><h4>  Doctrine console configuration </h4><br>  It is very convenient to work with Doctrine through its console.  But for this you need to write code to run it.  This code is shown below.  I put the file to start the console in the protected / commands folder.  It would also be very good to implement the <code>doctrine</code> command to start the console even more simply, but I haven‚Äôt done it yet. <br><br>  Sample <code>doctrine.php</code> file for working with the Doctrine console. <br><div class="spoiler">  <b class="spoiler_title">File code doctrine.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// change the following paths if necessary $yii = __DIR__ .'path/to/yii.php'; $config = __DIR__ . 'path/to/config/console.php'; require_once($yii); Yii::createWebApplication($config); Yii::setPathOfAlias('Symfony', Yii::getPathOfAlias('application.vendor.Symfony')); $em = Yii::app()-&gt;doctrine-&gt;getEntityManager(); $helperSet = new \Symfony\Component\Console\Helper\HelperSet(array( 'db' =&gt; new \Doctrine\DBAL\Tools\Console\Helper\ConnectionHelper($em-&gt;getConnection()), 'em' =&gt; new \Doctrine\ORM\Tools\Console\Helper\EntityManagerHelper($em) )); \Doctrine\ORM\Tools\Console\ConsoleRunner::run($helperSet);</span></span></code> </pre><br></div></div><br><br>  To start the Doctrine console, simply go to the commands folder and execute <code>php doctrine.php</code> . <br><br><h4>  Validating models and using models in a GridView widget. </h4><br>  Those who worked with Doctrine 2 ORM know that in fact there are no models in their generally accepted concept (with validation methods, data acquisition from databases, business logic included, etc.), and this functionality is actually divided into 2 parts - <code>Entity</code> and <code>Repository</code> .  <code>Entity</code> typically includes business logic, and in <code>Repository</code> , methods for retrieving data from a database using DBAL Doctrine (or entity manager, or other methods). <br><br><h5>  Validation of models </h5><br>  Thus, in my opinion, it would be logical to include data validation in the class of a specific entity. <br>  Consider the <code>User</code> entity as an example. <br>  In order not to reinvent the wheel, it was decided that it would be nice to use the already built-in validation of models from Yii, and specifically from the <code>CModel.</code> class <code>CModel.</code> <br><br>  To do this, you can simply inherit the User entity from the CModel class.  An example of such an entity with the described validation rules is below: <br><br><div class="spoiler">  <b class="spoiler_title">User Entity Code</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * User * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table(name="user") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity(repositoryClass="UserRepository") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\HasLifecycleCallbacks */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> integer * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(name="id", type="integer", nullable=false) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Id * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\GeneratedValue(strategy="IDENTITY") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $id; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(name="name", type="string", length=255, nullable=false) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $name; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(name="password", type="string", length=255, nullable=false) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $password; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(name="email", type="string", length=255, nullable=false) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $email; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(name="role", type="string", length=255, nullable=false) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $role; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \DateTime * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(name="created", type="datetime", nullable=false) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $created; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \DateTime * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(name="modified", type="datetime", nullable=false) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $modified; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'name, password'</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span>), <span class="hljs-comment"><span class="hljs-comment">// ... ); } public function attributeNames() { return array( 'id'=&gt;'id', 'name'=&gt;'name', 'email'=&gt;'email', 'created'=&gt;'created', 'updated'=&gt;'updated' ); } public function attributeLabels() { return array( 'description' =&gt; 'Description', 'createdString' =&gt; 'Creation Date' ); } // ... }</span></span></code> </pre><br><br>  Now I will give an example of how to work with this validation (an example of creating a new user below): <br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Creates a new model. * If creation is successful, the browser will be redirected to the 'view' page. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $user = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User(); $userData = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;get(<span class="hljs-string"><span class="hljs-string">'User'</span></span>); $course-&gt;setAttributes($userData); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!is_null($userData) &amp;&amp; $user-&gt;validate()) { $user-&gt;setName($userData[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]); <span class="hljs-comment"><span class="hljs-comment">// ...      $this-&gt;getEntityManager()-&gt;persist($user); $this-&gt;getEntityManager()-&gt;flush(); $this-&gt;redirect(array('view','id'=&gt;$user-&gt;getId())); } $this-&gt;render('create',array( 'model'=&gt;$user, )); }</span></span></code> </pre><br></div></div><br><br><h5>  Using models in a GridView widget </h5><br>  One of the main charms of Yii are, in my opinion, widgets, and especially the various Grid, which go to Yii from the box. <br>  But the only caveat is that they work with <code>ActiveRecord</code> (I mean the <code>GridView</code> widget).  And personally, I would like to get them to work with Doctrine and entities.  For this you can use the <code>Repository</code> . <br><br>  When using the <code>GridView</code> there are 2 bottlenecks - the <code>dataProvider</code> and <code>filter</code> properties.  And here I sing odes to Yii developers - in order for <code>GridView</code> work with some data other than <code>ActiveRecord</code> , it is enough that the object transferred to the <code>GridView</code> as a <code>dataProvider</code> correctly implements the <code>IDataProvider</code> interface (this interface should be implemented in our <code>UserRepository</code> ), and the object passed to <code>filter</code> must inherit from <code>CModel</code> (our <code>User</code> entity is already well suited for this). <br><br>  I will not give the entire implementation of the <code>UserRepository</code> , I will outline only the general scheme. <br><div class="spoiler">  <b class="spoiler_title">BaseRepository class code</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">EntityRepository</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IDataProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_id; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_data; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_keys; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_totalItemCount; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_sort; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_pagination; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $modelClass; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $model; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $keyAttribute; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_criteria; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_countCriteria; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $data; <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateTotalItemCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... } public function getPagination($className='CPagination'){ //... } public function setPagination($value){ //... } public function setSort($value){ //... } public function getData($refresh=false){ //... } public function setData($value){ //... } public function getKeys($refresh=false){ //... } public function setKeys($value){ //... } public function getItemCount($refresh=false){ //... } public function getTotalItemCount($refresh=false){ //... } public function setTotalItemCount($value){ //... } public function getCriteria(){ //... } public function setCriteria($value){ //... } public function getCountCriteria(){ //... } public function setCountCriteria($value){ //... } public function getSort($className='CSort'){ //... } protected function fetchKeys(){ //... } private function _getSort($className){ //... } }</span></span></code> </pre><br></div></div><br><br>  The above is an example implementation of a base repository.  In fact, the implementation of many methods can be found in the Yii class <code>CActiveDataProvider</code> which implements the <code>IDataProvider</code> interface.  In the <code>UserRepository</code> we only have to define 2 methods (sample code below): <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_id = <span class="hljs-string"><span class="hljs-string">'UserRepository'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Fetches the data from the persistent data storage. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array list of data items */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... } /** * Calculates the total number of data items. * @return integer the total number of data items. */ protected function calculateTotalItemCount() { //... } }</span></span></code> </pre><br><br><h4>  Summary </h4><br>  Above, I cited one of their ways of how to work in a bunch of Yii + Doctrine 2 ORM.  Many may say that because of Doctrine 2 ORM, Yii will lose its advantages, but we should not forget that Doctrine has a huge amount of tools for optimization and caching, and no one forbids rewriting too slow or intense queries on Plain SQL. <br>  But in such a bundle we win in the architectural solution and in my opinion, the code becomes clearer from this. <br><br>  I would be very grateful if, in the comments, you shared your options on how to implement the DataMapper pattern, some other ORMs in Yii, about your ways of solving the growth of business logic in ActiveRecord models in Yii, about subject-oriented programming using Yii. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/208182/">https://habr.com/ru/post/208182/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../208172/index.html">10 rules of the Zen programmer</a></li>
<li><a href="../208174/index.html">Pattern recognition. Potential function method</a></li>
<li><a href="../208176/index.html">Tribute to HIEW</a></li>
<li><a href="../208178/index.html">Generation of random numbers of high digit capacity</a></li>
<li><a href="../208180/index.html">Do arduino be one. Part 1</a></li>
<li><a href="../208184/index.html">Cheap organization of a second PC in the apartment</a></li>
<li><a href="../208186/index.html">Dynamic programming in templates</a></li>
<li><a href="../208188/index.html">Guided Acoustic Levitation: Another Example</a></li>
<li><a href="../208192/index.html">Unicode crash in Python3</a></li>
<li><a href="../208196/index.html">Hire people in DevOps and other bad ideas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>