<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What to cache?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All This could be the end of the article, since this axiom is repeated from year to year in forums and conferences and wanders from text to text on al...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What to cache?</h1><div class="post__text post__text-html js-mediator-article">  <b>All</b>  This could be the end of the article, since this axiom is repeated from year to year in forums and conferences and wanders from text to text on all technical resources.  However, this capacious "Everything" does not explain the details.  After all, there is a fairly wide layer of programmers, engines and projects that cope with the task without memkesh and sharding.  But the load moment comes, and it is necessary to understand. <br>  For such people, I disassembled for parts this is the universal answer of high-loaded projects. <br>  We limit ourselves to studying the system for the web.  Simply put, on the usual usual site.  Whether you use a ready-made CMS, or have already grown to a <acronym>frame</acronym> , or have written from scratch the code for a non-standard project - the same elements will always be the main elements of the process of receiving and returning data.  I will consider them from the point of view of where it is possible to cache. <br><img src="https://habrastorage.org/getpro/habr/post_images/45c/160/01d/45c16001dd0642cbd228ba0eafef343e.png" alt="Stages of issue"><br><a name="habracut"></a><br><h5>  Database </h5><br>  Even if you have a file database, there is a driver (right?) Who is responsible for issuing the necessary information. <br>  What we have here?  Usually it is inefficient to locate the data alphabetically, so the best minds have already invented a huge number of methods, methods and hacks for high-speed information delivery on a platter.  And you should know that databases do not just enter indexes, but cache them, cache query results, optimize the structure of relational tables, and try once again not to scan tons of data.  But, faith in geniuses is one thing, and checking the configuration file for the inclusion of these mechanisms is the duty of every developer!  If you have a separate server administrator (or servers), then at the first fixed one, make him tighten the nuts in the settings of your most important node.  Examine memory usage, fragmentation, and disk space availability for temporary files. <br>  Timely competent query caching can give you enough time in a fast-growing project, for tightening the nuts at all subsequent stages. <br>  This optimization is available to all participants of the regatta with full access to the hosting and will have to deal with the topic, sooner or later. <br>  There is another smart full-size cache called a database replica.  But it is unlikely that you will read this article if your project already has such a complex structure as the master database, its replica, web server, file server and statistics collection group.  In any case, a separate database for reading with a stretch can be considered a cache. <br><br><h5>  Logic (or our Code, which we are proud of) </h5><br>  The programming language does not matter.  It is just a tool for processing the received data.  Even if you do not have a modular structure and the entire project is one file, you still work with the data. <br>  If your code is yours, then you must include your head while writing the code.  The apologists of the rapid development and the holy ORM will say that there is nothing to look for and it is better to cache somewhere else.  There is a grain of truth, however, what kind of monsters do not give birth to the cursors! <br>  So, what should we pay attention to when we are already looking at the code? <br><ul><li>  Optimize database queries.  Why pull all the data when you need only the index and date?  The smaller the request, the easier it is to cache it. </li><li>  Using the database utilities, determine the so-called slow queries.  Think about indexes in tables or in rescheduling requests and the necessary data for caching this does not apply, but since we're here, <em>wouldn't it be true</em> right now? </li><li>  After stabilization of the code, look where you refer to the database twice for the same or similar data.  It may be better to make one query thicker, but then the data obtained is used in several modules / functions / cycles?  This is not caching yet, but further optimization ‚Äî taking complex or massive computational results into a cache (into a database or file) as a serialized array, or whatever is convenient for you, will be very useful.  And then the intermediate calculations will be carried out faster, less expensive and more comfortable for the site, tasks on the schedule and API. </li><li>  Collect all the little things that usually hang out in a session, in variables, in cookies in one place (if the security policy allows) and refer to such a notebook.  This is better than calling the file system, calling the class methods that call the function of the general class, which gives the user login or, oh, horror, pulls the base with a simple query.  After all, you are not sure that reading the session comes from the RAM and not from the session file?  Or maybe the admin without a request made the session in the database and did not take this into account?  Or the code logic implies the internalization through tons of abstractions and calls to subfunctions, and you need to return the word "Recycle" to the Ajax three times. </li></ul><br>  Engage code is recommended last.  That is: the business is established, the base is optimized, the external cache works, everything is in order, we are expanding.  Cache data in this node should be at the stage of optimizing the cost of expanding the server part, or when a narrow mathematical part does not have time to process large data streams.  This happens in the cumbersome marketing plans of network companies, generating reports on elaborate statistics and other such things.  The result of the optimization will be just a reduction of the load on the not very loaded server and will delay the time of purchase of the balancer and the second server. <br>  If you are still sitting on the CMS and start thinking about optimizing it, then it‚Äôs time to rewrite the engine for your high-load needs or buy more RAM.  No money?  Then urgently engage in the monetization of the resource, and not picking the depths of the code! <br><br><h5>  Template engine </h5><br>  It seems to be the code, but a bit more specialized.  This element is almost always present and is also important for our research. <br>  What is a pattern?  This is a kind of construction that serves as the raw material for creating code for subsequent compilation.  The only difference is that in this code a huge number of tags, lines and links, which are interspersed with fragments of logic.  The thing is quite understandable, but I noticed that many beginners do not delve into the details of the work of smarti and blitz.  And in vain! <br><blockquote>  If rude.  This template engine first looks for previously compiled code (or checks its relevance).  If it doesn‚Äôt exist, it re-processes the template, writes the file (sometimes deleting the previous one).  Sometimes, the developer simply forgets to enable similar caching of templates (in the working version it is inconvenient to clean the cache).  Worse, when the option is enabled, but the lifetime of the precompiled file is small.  Then the delay is irregular and it is difficult to ‚Äúcatch‚Äù it for a beginner.  Syndrome "I do not slow down." </blockquote><br>  Understand the caching capabilities of your template engine, select the optimal update intervals (if necessary).  In extreme cases, set a task in the schedule for the forced update of this cache at night, so as not to get out of the peak.  Examine the speed characteristics of the drive where the caches are stored.  Maybe it makes sense and there is an opportunity to make in RAM? <br>  Setting up caching of this stage is required at the beginning of the project development.  But the search for optimal values ‚Äã‚Äãcan already be transferred to after tuning the base and introducing the issue caching. <br>  For those who sit on the finished CMS, there is not enough space for fantasy.  However, check what is used (algorithm or finished product), check where the template cache is stored and how it behaves will not be superfluous. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Result </h5><br>  His Majesty the generated page should be delivered to the client as quickly as possible with the necessary relevance.  And here we can think of something separately, for example, file caching or favorite many memkes. <br>  If all of you are still reading this article with interest, then your project, most likely, has already encountered problems with slowing down, but is still alive and working as usual. <br>  For aksakals of project implementation and site building, there is nothing new in setting up a memkesh cluster and their problems rest on the relevance of the sample.  But, I hasten to surprise you, there are a huge number of projects of normal size, in which the hands of the webmaster have not yet reached the normal normal cache in noSQL DB.  First, they raised the project as best they could, and formed the idea on the fly.  Then it might have been trite not to have enough money for the second server, where it would be worthwhile to bring our plump database.  There are a huge number of people who are well versed in business, design, write good texts.  They raised the project, but now the forces go deep into the administration <em>* nix</em> to install the memkesh anymore. <br>  In short, if you grew out of a diaper, the first thing to do is to cache the page that is ready after the template engine.  First static.  Then static fragments of dynamic pages.  Next, look for your bottle neck.  If you do not have permissions to set up the key-value storage, at first make yourself the main file cache of the most requested pages.  Even such a primitive thing will save more than months of optimization on previous nodes. <br>  Users of content management systems should look in the bins for a caching module for their version.  Or even the most successful version of it.  For example, MODx immediately includes a mechanism for file caching of both entire pages and individual chunks and snippets.  But there is a module that instead of file storage offers to use memokish. <br><br><h5>  Balancer </h5><br>  If you do not have it yet, it will appear with time.  With his appearance, the entire crap from above will be called a backend, and our subtitle will be called the frontend.  In fairness, it must be said that the file caching of the result and the frontend of the architect‚Äôs quirks can be located either side by side or in reverse order.  But let's not complicate taxonomy simple article for a beginner. <br>  The task of the balancer is to arrange the queue of ordinary requests between all backends, determine by request type where to send it, etc.  The main optimization at this stage is the return of static elements, bypassing all heavy barricades from the web serer with logic and a database with data.  These are mainly pictures, style sheets, documents.  You can set up a separate file cache, which will not be given by the backend, but directly by the balancer.  You just need to arrange the delivery of html (js, css, xml) pages along the right path in a timely manner. <br>  You can write your own module with personalized logic for caching backend results.  After all, the answer is not necessarily kilomegabyte.  It is possible to remember JSON with the current best player or the last admin tweet in the memory of the balancer server at once. <br>  To resort to the introduction of the balancer itself is possible in the early stages of project development.  Jengenix before Apache will not eat much, and the scalability of the project will grow. <br><br><h5>  Customer </h5><br>  He, too, is subjected to our persuasion to remember something and not to once again ask us busy to torment all the demons of the system.  And the browsers themselves are successfully trying to rid the remote server of unnecessary suffering.  Locally cached graphic files and other multimedia.  Remember login-password pairs, last visited resources and so on.  But we can make an even more advanced version: after all, we know what we want from our page! <br>  In the minimum version, we can count on storing any personalized trifles in cookies.  Flash has some megabyte margin for overclocking.  HTML5 gives us an even bigger ground for storing little notes in the format of huge Talmuds.  Save the client-side secure information and modify the page with JavaScript.  Trash, last sent messages, current ammunition and so on. <br>  It is even better when you untie the logic of your application from the familiar PHP and transfer it to the side of our favorite user.  The script itself is cached by the browser (and the pre-bullet will be given by Engenix) and calmly on the server side will calculate the statistics of personal data (purchases, bonuses, killed monsters) from the local cache. <br><br><h4>  We will summarize </h4><br>  I hope for all startups, businessmen, and not techies, the phrase in the title and the short answer now mean much more than just having to pay money to solve the problem.  We have reviewed the general scheme of the usual web project in the context of giving a single response to the user and now we understand what and when and in what direction we can optimize with caching.  Before setting programmers to optimize the code, it is already possible to safely analyze the effectiveness of purchasing RAM or introducing a new server with a balancer and a memo on it. <br>  How and what exactly to cache is another question.  Where and when, I think you can already determine: <br><ol><li>  Quickly configure the basic trivia in the database configuration, check the caching of the template engine and | or CMS.  If possible, immediately adjust the balancer and organize the return of statics bypassing the web server. </li><li>  We cache the result (statics, dynamic fragments, full cache) into files or key-value storage. </li><li>  We deeply study our database and set up the most efficient query caching, we perform key optimization.  Maybe it's time to introduce a replica. </li><li>  We study the insides of our template maker, optimize parameters.  Perhaps changing the familiar Smarty to a faster, but difficult to implement Blitz.  We reduce and accelerate file operations at this level. </li><li>  We eliminate jambs and excess of our code.  We optimize work with data from the database and put in order work with trifles. </li><li>  In the working code and the developed business logic of the project we begin to transfer to the client's side routine operations, personalization and its processing. </li></ol><br>  And do not forget: caching is not the only method of project optimization! </div><p>Source: <a href="https://habr.com/ru/post/129623/">https://habr.com/ru/post/129623/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129614/index.html">Using the Facebook Graph API in Java</a></li>
<li><a href="../129615/index.html">Extreme secrecy: how Apple devices guard</a></li>
<li><a href="../129616/index.html">Droider Show # 9. The fire!</a></li>
<li><a href="../129617/index.html">Olympiad "Perspective in IT"</a></li>
<li><a href="../129621/index.html">Features of the interaction of hosting companies with law enforcement agencies in different countries</a></li>
<li><a href="../129625/index.html">To the Urals for startups</a></li>
<li><a href="../129627/index.html">Traceroute: about reading output</a></li>
<li><a href="../129628/index.html">Logically transparent neural networks and the production of explicit knowledge from data</a></li>
<li><a href="../129629/index.html">Startup Genome Report Extra about premature scaling can now be read in Russian</a></li>
<li><a href="../129630/index.html">Online HTML5-Converter for Android / iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>