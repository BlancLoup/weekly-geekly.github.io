<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automating the assembly of iOS applications using Fastlane</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How often do we, iOS developers, have to build an application to load in  iTunes Connect  App Store Connect ? During the active beta testing phase of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automating the assembly of iOS applications using Fastlane</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/wq/g0/si/wqg0sidq6m0evuhqkna1wmrr0ro.jpeg"></div><br><p>  How often do we, iOS developers, have to build an application to load in <del>  iTunes Connect </del>  <strong>App Store Connect</strong> ?  During the active beta testing phase of the application, you need to quickly fix bugs and deliver an updated build for testing.  And also you need to download certificates, Provision Profiles, click on a lot of different checkboxes and buttons with each new build. </p><br><p>  Fortunately, there is such a great tool as <a href="https://fastlane.tools/">fastlane</a> , which helps us automate the mobile developer‚Äôs manual actions. </p><br><p>  In this post, I‚Äôll tell you what fastlane is and how to quickly start using it in your iOS projects. </p><a name="habracut"></a><br><h2 id="vvedenie">  Introduction </h2><br><h3 id="chto-eto">  What is it? </h3><br><p>  <a href="https://docs.fastlane.tools/">Fastlane</a> is a tool to automate the processes of building and displaying mobile <strong>iOS</strong> and <strong>Android</strong> applications, which also includes generating <strong>screenshots</strong> , running <strong>Unit / UI tests</strong> , sending messages to <strong>Slack</strong> , connecting to <strong>Crashlytics</strong> and many other useful things that make life easier. </p><br><h3 id="kakoy-profit">  What is the profit? </h3><br><p>  It will take no more than two hours to initialize the basic commands to automate the display of the application, for example, to publish to the App Store or TestFlight, but in the future it will save a lot of time, because  the whole process will be started by a single call from the command line. </p><br><p>  <strong>ATTENTION:</strong> To complete all the steps, you need an Apple Developer subscription, as access to App Store Connect is not available for free accounts. </p><br><h2 id="ustanovka">  Installation </h2><br><h3 id="ustanavlivaem-samfastlane">  Install yourself fastlane </h3><br><p>  First, install / upgrade to the latest version of Xcode Command Tools: </p><br><pre><code class="bash hljs">$ xcode-select --install</code> </pre> <br><p>  Install the gem fastlane: </p><br><pre> <code class="bash hljs">$ sudo gem install fastlane -NV <span class="hljs-comment"><span class="hljs-comment">#   brew $ brew cask install fastlane</span></span></code> </pre> <br><h3 id="dobavlyaem-vproekt">  Add to the project </h3><br><p>  In the root directory of the project run: </p><br><pre> <code class="bash hljs">$ sudo fastlane init</code> </pre> <br><p>  Fastlane will offer us variants of pre-installed scripts depending on what we want: </p><br><p><img src="https://habrastorage.org/webt/nc/ba/54/ncba54ocu3t99jlklc1mrgk9ppu.png"></p><br><p>  We will choose the 4th option, since  We will register all the necessary commands for our situation: </p><br><p><img src="https://habrastorage.org/webt/nc/ba/54/ncba54ocu3t99jlklc1mrgk9ppu.png"></p><br><p>  Done!  The <strong>fastlane</strong> folder and the <strong>gemfile</strong> file <strong>have</strong> been successfully installed into our project. </p><br><h3 id="pered-tem-kak-prodolzhim">  Before we continue </h3><br><p>  If the <strong>shell</strong> profile <strong>locale is</strong> not <strong>UTF-8</strong> , then there will be problems with building and loading builds.  Go to your shell profile file ( <em>~ / .bashrc</em> , <em>~ / .bash_profile</em> , <em>~ / .profile</em> or <em>~ / .zshrc</em> ) and add the following lines: </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> LC_ALL=en_US.UTF<span class="hljs-number"><span class="hljs-number">-8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> LANG=en_US.UTF<span class="hljs-number"><span class="hljs-number">-8</span></span></code> </pre> <br><p>  Now everything is ready to write the direct steps of assembly automation. </p><br><h2 id="kak-eto-rabotaet">  How it works </h2><br><p>  First, find out what fastlane does: its main commands and how we describe what needs to be done. </p><br><h3 id="komandy-actions">  Commands (Actions) </h3><br><p>  Fastlane includes many useful commands that simplify the life of a developer: </p><br><ul><li>  <a href="https://docs.fastlane.tools/actions/cert/">cert</a> : automatically downloads and installs the necessary certificates (Distribution, Development) for signing the collected applications; </li><li>  <a href="https://docs.fastlane.tools/actions/increment_build_number/">increment_build_number</a> : increases the build number by 1, or changes to the value specified in the build_number parameter </li><li>  <a href="https://docs.fastlane.tools/actions/sigh/">sigh</a> : automatically downloads and installs all necessary provision profiles; </li><li>  <a href="https://docs.fastlane.tools/actions/snapshot/">snapshot</a> : runs UI tests and takes screenshots that can be used when submitting for review in the App Store; </li><li>  <a href="https://docs.fastlane.tools/actions/gym/">gym</a> : collects the archive and, here, the final ipa of your application; </li><li>  <a href="https://docs.fastlane.tools/actions/scan/">scan</a> : everything is simple - runs target tests; </li><li>  <a href="https://docs.fastlane.tools/actions/deliver/">deliver</a> : sends ipa, screenshots, metadata straight to the App Store; </li><li>  <a href="https://docs.fastlane.tools/actions/pilot/">pilot</a> : loads fresh ipa on beta test in TestFlight.  Also with the help of this command you can manage testers. </li><li>  and <a href="https://docs.fastlane.tools/actions/">many others</a> </li></ul><br><h3 id="fastfile">  Fastfile </h3><br><p>  The <em>fastlane</em> folder contains <em>Fastfile</em> and <em>Appfile</em> .  In the Appfile, we will write the values ‚Äã‚Äãrequired for building and publishing: Bundle IDs, App ID, Team ID, and others.  In <em>Fastfile,</em> we will describe our scripts.  After the initial installation, it looks like this: </p><br><pre> <code class="hljs pgsql">default_platform(:ios) platform :ios <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span> "Description of what the lane does" lane :custom_lane <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> actions here: https://docs.fastlane.tools/actions <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><ul><li>  <strong>default_platform (: ios)</strong> - set the default platform so as not to specify it from the command line. </li><li>  <strong>platform: ios do ... end</strong> - describes the "lanes" for the iOS platform. </li><li>  <strong>desc "Description of what the lane does"</strong> - a brief description of the "lane".  A list of all the "lanes" with descriptions can be viewed using the <code>$ fastlane lanes</code> . </li><li>  <strong>lane: custom_lane do ... end</strong> : Lane (path, strip) is, more simply, a method.  He has a name, parameters and body.  In the body, we will call the commands we need to build, display, run tests, etc. Lanes are invoked from the command line by calling <code>$ fastlane [lane_name] [parameters]</code> .  It is with a call to one of the lanes that the execution of the automated steps begins. </li></ul><br><h2 id="avtomatiziruem-vygruzku-na-testflight">  We automate unloading on TestFlight </h2><br><p>  Let's start with setting a clear name to our lane.  Rename <strong>custom_lane</strong> to <strong>testflight_lane</strong> .  Now it is clear that the result of the execution of this script will be a loaded fresh assembly in <em>TestFlight</em> . </p><br><pre> <code class="hljs ruby">default_platform(<span class="hljs-symbol"><span class="hljs-symbol">:ios</span></span>) platform <span class="hljs-symbol"><span class="hljs-symbol">:ios</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> desc <span class="hljs-string"><span class="hljs-string">"Builds, achieves and uploads ipa to TestFlight"</span></span> lane <span class="hljs-symbol"><span class="hljs-symbol">:testflight_lane</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-comment"><span class="hljs-comment"># Actions end end</span></span></code> </pre> <br><h3 id="konfiguriruem-appfile">  Configuring Appfile </h3><br><p>  In order for each time you run the script not to enter the bundle application and Apple ID, we write them in the <em>Appfile</em> : </p><br><pre> <code class="java hljs">app_identifier <span class="hljs-string"><span class="hljs-string">"ru.ee.shishko.TheHatGame"</span></span> apple_id <span class="hljs-string"><span class="hljs-string">"ee.shishko@gmail.com"</span></span></code> </pre> <br><h3 id="sertifikaty-i-provision-profiles">  Certifications and Provision Profiles </h3><br><p>  Add the <strong>cert</strong> and <strong>sigh commands</strong> to install certificates and provision profiles, respectively: <br>  ( <strong>Note</strong> : if your application is not in App Store Connect, then you need to add the <strong>produce</strong> command with the <em>app_name</em> parameter) </p><br><pre> <code class="hljs pgsql">default_platform(:ios) platform :ios <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span> "Builds, achieves and uploads ipa to TestFlight" lane :testflight_lane <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> #      App Store <span class="hljs-keyword"><span class="hljs-keyword">Connect</span></span>: # produce ( # app_name: "MyAppName" # ) cert sigh <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Run our script using the <code>$ fastlane testflight_lane</code> </p><br><p>  When you start Fastlane will ask us to enter the password for the account, enter it.  This will only be required once - fastlane will remember it and you will not need to enter anything during the next launches. <br>  This is what the output looks like when fastlane successfully completes the script: </p><br><img src="https://habrastorage.org/webt/or/2l/ws/or2lwspazqstxd-7k9ezqsjht9c.png"><br><br><p>  Now the certificate and provision profiles are downloaded and installed.  It remains to put down in the General contribution of the desired target: </p><br><img src="https://habrastorage.org/webt/ps/cd/ak/pscdakt-l2qpnqvwq2r89hvbabk.png"><br><br><h3 id="sborka-prilozheniya">  Build the application </h3><br><p>  Add the command <strong>increment_build_number</strong> to increase the build number.  If your main <em>.xcodeproj</em> file is not in the root folder, then specify the path for it in the <em>xcodeproj</em> parameter: </p><br><pre> <code class="hljs pgsql">default_platform(:ios) platform :ios <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span> "Builds, achieves and uploads ipa to TestFlight" lane :testflight_lane <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> cert sigh increment_build_number #   .xcodeproj     , : # # increment_build_number( # xcodeproj: "./path/to/MyApp.xcodeproj" # ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  To work with an increase in the build number, you need to go to <em>Build Settings / Versioning</em> and set the <strong>Versioning System</strong> to <strong>Apple Generic</strong> and <strong>Current Project Version</strong> to <strong>1</strong> : </p><br><img src="https://habrastorage.org/webt/bw/tb/kq/bwtbkqg5iqt5q0xfbatjw3ivawc.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>  Add a <strong>gym</strong> command that collects the <em>ipa</em> file of our application: <br><br></p><br><img src="https://habrastorage.org/webt/f-/qt/j6/f-qtj6schbypq7jyzhq6tjfauks.png"><br><br><p>  Among the parameters, you can specify where ipa ( <em>output_directory</em> ) will be put, name ipa ( <em>output_name</em> ), scheme ( <em>scheme</em> ), whether to do Clean ( <em>clean</em> ) and some others.  We will not specify anything in the parameters - fastlane will set the default parameters, collect and sign ipa, but again: if you want and need, you can specify everything in detail: </p><br><pre> <code class="hljs pgsql">default_platform(:ios) platform :ios <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span> "Builds, achieves and uploads ipa to TestFlight" lane :testflight_lane <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> cert sigh increment_build_number gym #    : # # gym( # workspace: "TheHatGame.xcworkspace", # scheme: "TheHatGame", # <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>: "Release", # clean: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, # output_directory: "./build", # output_name: "TheHatGame.ipa", # codesigning_identity: "iPhone Distribution: Evgeny Shishko" # ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><h3 id="vygruzka-na-testflight">  Upload to TestFlight </h3><br><p>  To load <em>ipa</em> into <em>TestFlight</em> we will use <em>Pilot</em> : </p><br><img src="https://habrastorage.org/webt/h4/n6/xc/h4n6xccia6ooeywy4tx__lc2wz0.png"><br><p>  Using <strong>Pilot</strong> you can: </p><br><ul><li>  unload and distribute assemblies; </li><li>  add and remove beta testers; </li><li>  get information about testers and their devices; </li><li>  export testers information to .csv in order to import them into another project. </li></ul><br><p>  We will use its main function: sending assemblies to the <em>Apple Store Connect</em> . </p><br><p>  Let's add to the <em>testflight_lane a</em> call to <strong>upload_to_testflight</strong> with the parameters <em>skip_submission</em> (we will use only for loading the ipa file) and <em>skip_waiting_for_build_processing</em> (we do not wait for the end of processing'a): </p><br><pre> <code class="hljs ruby">default_platform(<span class="hljs-symbol"><span class="hljs-symbol">:ios</span></span>) platform <span class="hljs-symbol"><span class="hljs-symbol">:ios</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> desc <span class="hljs-string"><span class="hljs-string">"Builds, achieves and uploads ipa to TestFlight"</span></span> lane <span class="hljs-symbol"><span class="hljs-symbol">:testflight_lane</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> cert sigh increment_build_number gym upload_to_testflight( <span class="hljs-symbol"><span class="hljs-symbol">skip_submission:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">skip_waiting_for_build_processing:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><h3 id="zapuskaem-itogovyy-skript">  Run the final script </h3><br><p>  We save our changes and run from the console: </p><br><pre> <code class="hljs ruby">$ fastlane testflight_lane</code> </pre> <br><p>  At the stage of sending to testflight in the console, you will need to enter an <em>app-specific</em> password (which is required for authorization in the <em>Application Loader</em> ).  You can find it in your <a href="https://appleid.apple.com/account/manage">Apple ID</a> dashboard by generating it by clicking on "Generate Password": </p><br><img src="https://habrastorage.org/webt/fr/eu/7u/freu7ujllv__iqbgsukj1fjzdz0.png"><br><p>  After entering the password, the fresh build will be successfully loaded into TestFlight and the execution of fastlane will end there: </p><br><img src="https://habrastorage.org/webt/6b/25/mn/6b25mnty46qop8dj6okomr_goeq.png"><br><br><p>  The status of the new version can be viewed in the App Store Connect: </p><br><img src="https://habrastorage.org/webt/gi/we/y2/giwey2wzln0c5itsbpqboxm9mke.png"><br><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  That's all!  I would like to note that in this article we have, in the most general case, tried the possibilities of fastlane.  In connection with this, I attach a survey: would you, habrovchane, be interested in posts about the <strong>detailed use of the</strong> mentioned and other useful commands in fastlane and advanced chips in setting up scripts? </p><br><p>  An application with the fastlane setting provided can be found <a href="https://github.com/eeshishko/TheHatGame">here</a> . </p></div><p>Source: <a href="https://habr.com/ru/post/424023/">https://habr.com/ru/post/424023/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../424011/index.html">We push parameters into unsafe operations in a safe code</a></li>
<li><a href="../424015/index.html">On both sides of the barricades: hiring mobile application developers</a></li>
<li><a href="../424017/index.html">Tackling the Difficult: A Roadmap for Effective Collaboration</a></li>
<li><a href="../424019/index.html">Old computer, Windows 7, 1 GB RAM, DirectX 9 video card, Firefox and Internet</a></li>
<li><a href="../424021/index.html">The complexities of self-learning programming and how to overcome them</a></li>
<li><a href="../424025/index.html">Routing in a large application on React</a></li>
<li><a href="../424027/index.html">We study Adversarial Tactics, Techniques & Common Knowledge (ATT @ CK). Enterprise Tactics. Part 2</a></li>
<li><a href="../424029/index.html">And again about laziness</a></li>
<li><a href="../424031/index.html">Reactive programming with JAX-RS</a></li>
<li><a href="../424033/index.html">What is it like to do Kotlin: an interview with Andrei Breslav</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>