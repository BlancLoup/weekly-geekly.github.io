<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Does your monitoring system scream when routing changes?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suppose you are an Internet provider or you have your own network with dynamic routing, then the actual subject ... 
 A reasonable question, why? Ther...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Does your monitoring system scream when routing changes?</h1><div class="post__text post__text-html js-mediator-article">  Suppose you are an Internet provider or you have your own network with dynamic routing, then the actual subject ... <br>  A reasonable question, why?  There are many reasons to keep logs of changes, and the monitoring system should yell for the simple reason that no one is immune from error.  About the error under the cat, but for now, if you know how routing works, carefully analyze and answer the question in the figure. <br><img src="https://habrastorage.org/storage2/f55/fbe/64f/f55fbe64f07e4a6a2074c05a4956f88a.png"><br><a name="habracut"></a><br><br>  The correct answer to the question is through router 3.3.3.3, simply because the prefix through this router is longer.  When deciding which of the two routes will win, the prefix is ‚Äã‚Äãalways checked first.  If there are two routes to the host with the same prefix, then the route with a higher priority routing protocol wins, if the routing protocols are the same, then the internal routing protocol metrics will be taken into account. <br>  But we were a little distracted, in fact, I wanted to tell a long story, about 2006, about how I accidentally got the opportunity to intervene in the routing of my provider, and what can be done in such a case. <br><br><h4>  How the error was revealed. </h4><br>  It all started with the fact that I had to configure IDS <a href="http://www.snort.org/">snort</a> .  It was necessary to catch packages on demark-e with the provider.  Therefore, it was configured to mirror the port on the switch, which included the provider.  The internal interface of the snort server was on the local network; the external interface smelled mirror traffic from demark.  Naturally, in such cases, when setting up, tcpdump or something similar is always launched.  When I began to analyze what I received tcpdump, an interesting thing came to light - the provider's router periodically sent <a href="http://ru.wikipedia.org/wiki/EIGRP">EIGRP</a> HELLO multicast packets to me. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  How can you make a mistake. </h4><br>  At first I was interested in how this could happen.  I didn‚Äôt work with EIGRP before, but I quickly found out that when EIGRP is configured by default, all interfaces are switched to active mode and the routers immediately start searching for routing neighbors using multicast.  You can globally transfer all interfaces to passive mode and make only certain of them active.  You can leave all interfaces active and transfer unnecessary (those that look at clients) to passive mode.  The provider used the second approach.  Most likely, someone from the network administrators of the provider was mistaken and did not put the interface that was looking at me into passive mode. <br>  It became clear how this could happen.  Suppose you are configuring, at this moment you are distracted by a 5 minute phone call, you return to work and you understand that everything has already been configured and everything works.  Save the configuration, but forget that you did not put the interface into passive mode. <br><br><h4>  Options for operating errors. </h4><br>  It turned out that I can configure EIGRP in myself and join the provider‚Äôs routing.  Naturally, I was interested in how this can be used.  The more I thought about it, the more interesting it became. <br>  I must say that I had an excellent relationship with the provider.  The employees of the provider have informed us that, in principle, they are not against the fact that we will try to hack them and will not complain.  The main thing is not to break anything, and in case we find something, tell them.  All people are all wrong.  They are tested for penetration free of charge, and we have a cool testing ground. <br>  Therefore, I called the provider, said that I had found something, that I would say the next day, but for now I‚Äôm experimenting.  If they see what I'm doing, let them cover me.  In fact, it was interesting to find out if my interference with the routing is detected or not.  Not found.  But let's see what can be done in this case. <br><br><h5>  Steal traffic. </h5><br>  This is trite.  Having picked up EIGRP, I immediately picked up their routing table.  Having it available, it is easy to find out which subnet is free, register it on your router and get a channel that is not limited by traffic or speed.  I used it a little. <br><br><h5>  Capture any of the used client subnets. </h5><br>  You can register on your router any of the subnets present in the routing table.  If you break this subnet into several, with a longer prefix, then the traffic will go to you, and not to the client‚Äôs provider. <br>  There may be many uses.  For example, you can effectively hide the traces of their illegal activities.  To test the concept, I really captured the IP addresses of dialup clients.  They do not mind if anything, they can reconnect and get a different IP. <br>  Another example is to grab the provider's DNS server IP address for the time being and replace the DNS server server with its own.  In this case, you can even (oh, horror !!!) steal passwords from classmates.  Of course, it is difficult to make sure that you are not figured out, but now this is not the point. <br>  And let's think about what symptoms of failure the client sees whose network is being captured.  For verification, I deployed <a href="http://www.gns3.net/">GNS3</a> .  Here is the network. <br><img src="https://habrastorage.org/storage2/9b9/0a8/967/9b90a8967a23ff7b9197e6b5d42426c5.png"><br>  But what happens when there is a route on R1 with a longer prefix to the subnet specified on its interface - 192.168.0.0/24, and in the case when it is not there. <br><img src="https://habrastorage.org/storage2/e57/d71/993/e57d71993aa44d8c3969ec2f41c3f43d.png"><br>  The client simply does not see his default gateway at the third level. <br>  Therefore, if you are very angry, then, for example, you can arrange a beautiful, arrogant and sophisticated DoS network administrators of the provider, depriving them of the ability to manage their own network. <br>  Did you know that the ‚Äútrue administrators‚Äù of the provider like to sit in a white subnet, behind a reliable firewall, which they themselves have configured?  At the same time, the ability to access network device management is only from this subnet.  Of course, not always, but so often do. <br>  To carry out an attack, you need to know in which subnet they are sitting.  To do this, you can send a link to the network administrator of the provider to a cool image on your server.  And when several smiles come back, see the IP address of the server logs.  You can use other similar methods, social engineering has not been canceled. <br>  Further split this subnet several subnets and register them on your router.  Everything, ahtung is provided, the Internet has been lost for the network administrators of the provider.  From the administrators of the provider it seems that their default gateway has dropped.  That is, its MAC is visible, but it is not pinged and is not available on management ports (telnet, ssh, www).  You can, perhaps, connect to the console.  It is difficult to calculate even the fact that you are attacked, it is more like a hardware failure, or an operating system crash on the router.  Cruel, but beautiful, right? <br><br><h4>  Conclusion </h4><br>  Monitoring changes in routing is not in vain considered to be the best practice.  Of course, you should not give a loud notification when routes change in the network, but IMHO, you should set up a notification that a new router participating in dynamic routing has appeared on the network. <br><br>  PS Take care of <s>your</s> routing, Senya. </div><p>Source: <a href="https://habr.com/ru/post/135615/">https://habr.com/ru/post/135615/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135609/index.html">Did you use multiple C ++ inheritance in real projects?</a></li>
<li><a href="../13561/index.html">Full-size model of the Scopedog robot</a></li>
<li><a href="../135611/index.html">Droider Show # 22. Results of the year</a></li>
<li><a href="../135613/index.html">YouTube search in Unity</a></li>
<li><a href="../135614/index.html">Rails 3.x SOAP Server (WashOut)</a></li>
<li><a href="../135617/index.html">IBM PS / 2 L40 SX</a></li>
<li><a href="../135618/index.html">China fights phishers at state level</a></li>
<li><a href="../135619/index.html">We write our blog with the framework of Fat-Free Framework</a></li>
<li><a href="../13562/index.html">Bloglines completely redone</a></li>
<li><a href="../135621/index.html">German police sent 440 thousand hidden SMS to spy on citizens</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>