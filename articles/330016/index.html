<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>QEMU-KVM under LXC</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As usual - circumstances dictate the rules. This time we install Proxmox and Libvirt on the same server. 


 Faced another challenge - the customer se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>QEMU-KVM under LXC</h1><div class="post__text post__text-html js-mediator-article">  <b>As usual - circumstances dictate the rules.</b>  This time we install Proxmox and Libvirt on the same server. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6d/fc7/c31/e6dfc7c31c09d90c3fa9c96218b8901d.jpg" alt="image" width="300"></div><br>  Faced another challenge - the customer set the condition to deploy a stand on an existing, conflicting infrastructure.  He has a Proxmox cluster, we have Libvirt <br><br>  The solution to the forehead did not help, an attempt to install libvirtd required the removal of proxmox.  Without hesitation, they decided to write off.  Look under the cut an elegant solution as to climb a tree and do not tear anything. <br><a name="habracut"></a><br>  Briefly about us - WriteX Team.  We work with Linux since 2000 under the motto - nothing is impossible for Linux.  No sooner said than done.  let's think  Development options: compile libvirt or go to container.  Google as usual helped, found a very useful article: <a href="https://stgraber.org/2014/01/01/lxc-1-0-security-features/">stgraber.org/2014/01/01/lxc-1-0-security-features</a> and see that, in principle, you can donate any device to the container.  We look (without the permission of the author, but not removing the links. A little copy-paste): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs swift"> <span class="hljs-type"><span class="hljs-type">LXC</span></span>      # <span class="hljs-type"><span class="hljs-type">Default</span></span> cgroup limits lxc.cgroup.devices.deny = a ## <span class="hljs-type"><span class="hljs-type">Allow</span></span> any mknod (but not using the node) lxc.cgroup.devices.allow = <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> *:* m lxc.cgroup.devices.allow = b *:* m ## /dev/null and zero lxc.cgroup.devices.allow = <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span> rwm lxc.cgroup.devices.allow = <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span> rwm ## consoles lxc.cgroup.devices.allow = <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span> rwm lxc.cgroup.devices.allow = <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> rwm ## /dev/{,u}random lxc.cgroup.devices.allow = <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">8</span></span> rwm lxc.cgroup.devices.allow = <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">9</span></span> rwm ## /dev/pts<span class="hljs-comment"><span class="hljs-comment">/* lxc.cgroup.devices.allow = c 5:2 rwm lxc.cgroup.devices.allow = c 136:* rwm ## rtc lxc.cgroup.devices.allow = c 254:0 rm ## fuse lxc.cgroup.devices.allow = c 10:229 rwm ## tun lxc.cgroup.devices.allow = c 10:200 rwm ## full lxc.cgroup.devices.allow = c 1:7 rwm ## hpet lxc.cgroup.devices.allow = c 10:228 rwm ## kvm lxc.cgroup.devices.allow = c 10:232 rwm</span></span></code> </pre> <br>  look, device codes on dom0, <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># ls -lah /dev/kvm crw-rw-rw- 1 root kvm 10, 232  1 11:55 /dev/kvm</span></span></code> </pre><br>  and further, we allow all the devices we need and create them in a container: <br><br><pre> <code class="hljs swift">mknod /dev/net/tun <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span> mknod /dev/kvm <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">232</span></span></code> </pre><br>  we start the system and put everything we need in our container - without violating anything at the customer.  In my opinion - cool! <br><br>  Ready to catch tomatoes, but only after full awareness of the depth of creativity ;-) <br><br>  <b>Links to materials:</b> <br><ul><li>  <a href="https://stgraber.org/2014/01/01/lxc-1-0-security-features/">stgraber.org/2014/01/01/lxc-1-0-security-features</a> </li><li>  <a href="http://vasilisc.com/lxc-1-0-security-features">vasilisc.com/lxc-1-0-security-features</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/330016/">https://habr.com/ru/post/330016/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330006/index.html">Understanding Array.prototype.reduce () and Recursion Using the Example of Apple Pie</a></li>
<li><a href="../330008/index.html">How not to give the algorithm to sell the bank</a></li>
<li><a href="../330010/index.html">HPE 3PAR StoreServ 9450</a></li>
<li><a href="../330012/index.html">Attack on AB test: recipe 'R' + t (101) + 'es46'</a></li>
<li><a href="../330014/index.html">NeoQUEST-2017: what awaits the guests at the jubilee "confrontation"?</a></li>
<li><a href="../330018/index.html">Writing a Babel plugin</a></li>
<li><a href="../330024/index.html">Oracle SystemTap</a></li>
<li><a href="../330026/index.html">Amazon Alexa Skill Smart Home with Open Source ioBroker Home Automation Platform</a></li>
<li><a href="../330028/index.html">Integration SaltStack and Telegram</a></li>
<li><a href="../330030/index.html">Dynamic Angular or manipulate correctly</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>