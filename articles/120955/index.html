<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zabbix, monitoring last mile ports and optimizing work with the database using partitioning</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Working with the largest provider of the Russian Federation faced with the situation that the subscriber is contacting problems in the recent past, i....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zabbix, monitoring last mile ports and optimizing work with the database using partitioning</h1><div class="post__text post__text-html js-mediator-article">  Working with the largest provider of the Russian Federation faced with the situation that the subscriber is contacting problems in the recent past, i.e.  Yesterday everything was bad, but now it worked.  What to do in this case?  There are options to use monitoring systems that will collect key parameters of all subscriber lines and store them for some time, and the TP operator will be able to easily access this data to solve such situations.  Also, having these data, you can give an automatic expert assessment for each subscriber line, and if you wish, on xDSL, automatically select the most appropriate profile.  Using the same data, you can identify defective lines or lines with unsatisfactory parameters and eliminate possible problems of subscribers even before they contact the TP. <br>  At first glance, the task is not complicated, but when the amount of equipment easily oversteps thousands of access nodes, and the number of subscriber ports can amount to tens of thousands, some features of setting up and running such a system appear, with maximum automation. <br>  If interested, welcome under the cat. <br><br><a name="habracut"></a><br>  There was only one HP server with two processors and 4 cores on board, the memory was 10G, Raid5 132G 15000 SAS. <br>  The main number of subscriber ports are ADSL ports on various DSLAMs, both high-capacity ‚Äî up to 576 ports per ‚Äúbasket‚Äù and low-port ports ‚Äî from 16 to 64 ports, depending on the configuration. <br><br><h3>  Determine how we will monitor and build triggers </h3><br>  What can I get with dslam'a?  Almost everything, the only question is how to do it.  For me, the surest way is a snmp survey.  The trouble was that the MIB files for most of the glands are not accessible to mere mortals due to the manufacturer's tricks with entering into heaps of contracts and other obstacles that I don‚Äôt understand (to the honor of the huawei mibs, they still sent them without various contracts, but for another supplier I can not get).  If your situation is similar to mine then we take snmpwalk and analyze everything that the piece of hardware produces, and it will give out a lot of text megabytes.  The analysis of the received oid is a very laborious process.  Well, if there are ready-made templates for zabbix or there is a mib (then templates of them can be made quickly and easily by reading this topic ‚Äúconnect any piece of hardware that has an MIB‚Äù <a href="http://habrahabr.ru/blogs/sysadm/85156/">habrahabr.ru/blogs/sysadm/85156</a> ) <br>  After we received the templates, we need to determine what we will collect, with what frequency and how long to store.  All these parameters are eventually set in the working template which we will bind to the glands. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      My set was not very large, for example, for a large capacity dslam, the parameters collected from the first port <br> <a href=""><img src="https://habrastorage.org/storage/fbbbaf0c/67bc438c/faba47aa/84fedd60.png"></a> <br><br> <code>1.01ifAtucFfrADSL 1.01ifAtucFrADSL   <br> 1.01ifAtucLossADSL    <br> 1.01ifDownSnrADSL 1.01ifUpSnrADSL  <br> 1.01ifDownSpeedADSL 1.01ifUpSpeedADSL      <br>   ,         <br> 1.01ifOperPhysicalStatADSL    <br> 1.01ifOperStatADSL  </code> <br> <br>  And an additional template with elements that can be included. <br> <a href=""><img src="https://habrastorage.org/storage/b0a47c97/ee1f6977/fe314ada/a9b7a426.png"></a> <br> <code>1.01ifDownAttenuationADSL 1.01ifUpAttenuationADSL    <br> 1.01ifDownOutputPowerADSL 1.01ifUpOutputPowerADSL   <br> 1.01ifDownSpeedMaxADSL 1.01ifUpSpeedMaxADSL     <br> 1.01ifProfSpeedADSL   </code> <br> <br>  If you use the data described above, you can write a trigger that will take the current profile, the maximum speed and the current speed and based on this data, if the speed specified by the profile is lower than the real one and the maximum achievable, suggest or independently change the profile to another with a lower speed, and vice versa if the maximum speed is higher than the real one and higher than the one set in the profile, then suggest changing or changing the profile to another one with a higher speed. <br><br>  I note that these triggers did not take root because of the banal clogging of all the recommendations for changing profiles at ports, but I was afraid to give it to the automation. <br><br>  There is one more variant of very useful triggers, these are triggers on the magnitude of noise, on attenuation, on the change in time (delta function) of the number of errors and reconnects and other joys that can very much <s>deliver to subscribers to</s> get subscribers.  Again, these triggers did not catch on for the same reason.  It is heavy on your soul when you have a couple of hundred ports considered unsatisfactory.  ;) <br><br>  For nodes using the FTTx technology, the collected parameters are somewhat different, now only the delta function of the number of errors on the subscriber port was collected, if they are more than a certain value over a period of time, we deduce the port as a list of those requiring attention. <br>  Here is an example of data collected from a single port. <br> <a href=""><img src="https://habrastorage.org/storage/aabcd513/1eebb92e/cc39769c/cea89cd0.png"></a> <br>  Data can be represented as a graph over time. <br> <a href=""><img src="https://habrastorage.org/storage/6c54c1dd/a249d811/74dfe7fd/fc1e7136.png"></a> <br><br>  I also had some interesting Chinese Edge-core switches from which I got rid of in favor of Huawei, so with them I made such a template that interrogated the measurement results of subscriber cables with a reflectometer and analyzing the results produced a list of ports with faulty UTPs.  These measurements could be carried out by sending a command to the snmp glands either using a zabix script or with a crown.  I did not finish this template due to the replacement of all the hedgehogs on the huyavay. <br><br>  The overall picture and the approach to monitoring I think are clear, if there are more specific questions, for some not very lighted moments, then ask, I will try to answer. <br><br><h3>  Let's proceed to setting up the database under Zabbix </h3><br>  At the moment, the last stable 1.8.5 branch can be downloaded from the official site <a href="http://www.zabbix.com/download.php">www.zabbix.com/download.php</a> <br>  I will not give instructions on how to install it and do the initial setup, as it is on the website <a href="http://www.zabbix.com/documentation/start">www.zabbix.com/documentation/start</a> <br><br>  I have everything on Ubuntu server 10.04 64 bit.  Postgresql 8.4 was originally used as a database. Further 9.0 has now been moved to MySQL 5.5, installed on the server according to the official manual and a small doping file.  Reason for moving support partitioning table <a href="http://dev.mysql.com/doc/refman/5.5/en/partitioning.html">dev.mysql.com/doc/refman/5.5/en/partitioning.html</a> "(well, I couldn‚Äôt get postgres to work as fast as the muscle didn‚Äôt fight, I don‚Äôt know how to prepare it, Shl partition table is in the post-regression, but it is implemented somewhat differently than in the muscle). <br><br>  MySQL configuration is not complicated and is well described on the forum. Here is an example of the topic on which I set up MySQL <a href="http://www.zabbix.com/forum/showthread.php%3Ft%3D12407">www.zabbix.com/forum/showthread.php?t=12407</a> <br><br>  I will note the key mandatory option <br> <code>innodb_file_per_table <br></code> <br>  The default engine must be set innodb, utf-8 encoding. <br>  If you are very curious lay out config. <br><br>  Zabbix stores in the database a set of values; the main large tables are hystory * and trend * <br>  Initially, in the history tables I had up to 500 million records and this table weighed about 40 gigs with an index file, which caused some performance problems. <br>  Data collected from subscriber ports are stored on average for about 3 days.  Old data is removed by the housekeeper, leaving fragmented tables after that.  I do not need to explain how bad it is. <br>  What to do in this case?  The answer is - use partition table with time division.  For this, I used the experience from the blog of the Brazilian comrade <a href="http://zabbixzone.com/zabbix/partitioning-tables/">zabbixzone.com/zabbix/partitioning-tables</a> <br>  He proposes to divide the table into 2 types: large - with division by days, and not very large - with division by months. <br>  Here are the tables by day: <br><ul><li>  history </li><li>  history_log </li><li>  history_str </li><li>  history_text </li><li>  history_uint </li></ul><br>  and divided by month: <br><ul><li>  acknowledges </li><li>  alerts </li><li>  auditlog </li><li>  events </li><li>  service_alarms </li><li>  trends </li><li>  trends_unit </li></ul><br><br>  I already had a set up monitoring system and in order to add what my friend suggested, the following actions had to be done (they are almost the same as in the above mentioned blog). <br><br>  First we make a dump of each table that we are going to change. <br> <code>mysqldump --no-create-info --lock-tables zabbix history_str &gt; 09.06.2011_history_str.sql</code> <br> <br>  Clear the above tables from the data. <br>  Slightly changing table structures <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `acknowledges` <font color="#0000ff">DROP</font> <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> , <font color="#0000ff">ADD</font> <font color="#0000ff">KEY</font> `acknowledgedid` (`acknowledgeid`); <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `alerts` <font color="#0000ff">DROP</font> <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> , <font color="#0000ff">ADD</font> <font color="#0000ff">KEY</font> `alertid` (`alertid`); <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `auditlog` <font color="#0000ff">DROP</font> <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> , <font color="#0000ff">ADD</font> <font color="#0000ff">KEY</font> `auditid` (`auditid`); <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `events` <font color="#0000ff">DROP</font> <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> , <font color="#0000ff">ADD</font> <font color="#0000ff">KEY</font> `eventid` (`eventid`); <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `service_alarms` <font color="#0000ff">DROP</font> <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> , <font color="#0000ff">ADD</font> <font color="#0000ff">KEY</font> `servicealarmid` (`servicealarmid`); <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `history_log` <font color="#0000ff">DROP</font> <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> , <font color="#0000ff">ADD</font> <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> (`itemid`,`id`,`clock`); <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `history_log` <font color="#0000ff">DROP</font> <font color="#0000ff">KEY</font> `history_log_2`; <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `history_text` <font color="#0000ff">DROP</font> <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> , <font color="#0000ff">ADD</font> <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> (`itemid`,`id`,`clock`); <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `history_text` <font color="#0000ff">DROP</font> <font color="#0000ff">KEY</font> `history_text_2`;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  We create partition table with division by months till 2013 <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `acknowledges` PARTITION <font color="#0000ff">BY</font> RANGE( clock ) ( <br> PARTITION p201105 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-01 00:00:00")), <br> PARTITION p201106 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-07-01 00:00:00")), <br> PARTITION p201107 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-08-01 00:00:00")), <br> PARTITION p201108 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-09-01 00:00:00")), <br> PARTITION p201109 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-10-01 00:00:00")), <br> PARTITION p201110 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-11-01 00:00:00")), <br> PARTITION p201111 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-12-01 00:00:00")), <br> PARTITION p201112 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-01-01 00:00:00")), <br> PARTITION p201201 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-02-01 00:00:00")), <br> PARTITION p201202 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-03-01 00:00:00")), <br> PARTITION p201203 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-04-01 00:00:00")), <br> PARTITION p201204 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-05-01 00:00:00")), <br> PARTITION p201205 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-06-01 00:00:00")), <br> PARTITION p201206 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-07-01 00:00:00")), <br> PARTITION p201207 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-08-01 00:00:00")), <br> PARTITION p201208 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-09-01 00:00:00")), <br> PARTITION p201209 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-10-01 00:00:00")), <br> PARTITION p201210 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-11-01 00:00:00")), <br> PARTITION p201211 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-12-01 00:00:00")), <br> PARTITION p201212 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2013-01-01 00:00:00")) <br> ); <br> <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `alerts` PARTITION <font color="#0000ff">BY</font> RANGE( clock ) ( <br> PARTITION p201105 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-01 00:00:00")), <br> PARTITION p201106 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-07-01 00:00:00")), <br> PARTITION p201107 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-08-01 00:00:00")), <br> PARTITION p201108 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-09-01 00:00:00")), <br> PARTITION p201109 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-10-01 00:00:00")), <br> PARTITION p201110 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-11-01 00:00:00")), <br> PARTITION p201111 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-12-01 00:00:00")), <br> PARTITION p201112 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-01-01 00:00:00")), <br> PARTITION p201201 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-02-01 00:00:00")), <br> PARTITION p201202 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-03-01 00:00:00")), <br> PARTITION p201203 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-04-01 00:00:00")), <br> PARTITION p201204 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-05-01 00:00:00")), <br> PARTITION p201205 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-06-01 00:00:00")), <br> PARTITION p201206 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-07-01 00:00:00")), <br> PARTITION p201207 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-08-01 00:00:00")), <br> PARTITION p201208 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-09-01 00:00:00")), <br> PARTITION p201209 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-10-01 00:00:00")), <br> PARTITION p201210 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-11-01 00:00:00")), <br> PARTITION p201211 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-12-01 00:00:00")), <br> PARTITION p201212 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2013-01-01 00:00:00")) <br> ); <br> <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `auditlog` PARTITION <font color="#0000ff">BY</font> RANGE( clock ) ( <br> PARTITION p201105 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-01 00:00:00")), <br> PARTITION p201106 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-07-01 00:00:00")), <br> PARTITION p201107 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-08-01 00:00:00")), <br> PARTITION p201108 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-09-01 00:00:00")), <br> PARTITION p201109 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-10-01 00:00:00")), <br> PARTITION p201110 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-11-01 00:00:00")), <br> PARTITION p201111 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-12-01 00:00:00")), <br> PARTITION p201112 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-01-01 00:00:00")), <br> PARTITION p201201 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-02-01 00:00:00")), <br> PARTITION p201202 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-03-01 00:00:00")), <br> PARTITION p201203 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-04-01 00:00:00")), <br> PARTITION p201204 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-05-01 00:00:00")), <br> PARTITION p201205 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-06-01 00:00:00")), <br> PARTITION p201206 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-07-01 00:00:00")), <br> PARTITION p201207 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-08-01 00:00:00")), <br> PARTITION p201208 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-09-01 00:00:00")), <br> PARTITION p201209 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-10-01 00:00:00")), <br> PARTITION p201210 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-11-01 00:00:00")), <br> PARTITION p201211 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-12-01 00:00:00")), <br> PARTITION p201212 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2013-01-01 00:00:00")) <br> ); <br> <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `events` PARTITION <font color="#0000ff">BY</font> RANGE( clock ) ( <br> PARTITION p201105 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-01 00:00:00")), <br> PARTITION p201106 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-07-01 00:00:00")), <br> PARTITION p201107 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-08-01 00:00:00")), <br> PARTITION p201108 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-09-01 00:00:00")), <br> PARTITION p201109 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-10-01 00:00:00")), <br> PARTITION p201110 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-11-01 00:00:00")), <br> PARTITION p201111 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-12-01 00:00:00")), <br> PARTITION p201112 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-01-01 00:00:00")), <br> PARTITION p201201 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-02-01 00:00:00")), <br> PARTITION p201202 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-03-01 00:00:00")), <br> PARTITION p201203 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-04-01 00:00:00")), <br> PARTITION p201204 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-05-01 00:00:00")), <br> PARTITION p201205 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-06-01 00:00:00")), <br> PARTITION p201206 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-07-01 00:00:00")), <br> PARTITION p201207 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-08-01 00:00:00")), <br> PARTITION p201208 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-09-01 00:00:00")), <br> PARTITION p201209 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-10-01 00:00:00")), <br> PARTITION p201210 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-11-01 00:00:00")), <br> PARTITION p201211 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-12-01 00:00:00")), <br> PARTITION p201212 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2013-01-01 00:00:00")) <br> ); <br> <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `service_alarms` PARTITION <font color="#0000ff">BY</font> RANGE( clock ) ( <br> PARTITION p201105 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-01 00:00:00")), <br> PARTITION p201106 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-07-01 00:00:00")), <br> PARTITION p201107 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-08-01 00:00:00")), <br> PARTITION p201108 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-09-01 00:00:00")), <br> PARTITION p201109 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-10-01 00:00:00")), <br> PARTITION p201110 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-11-01 00:00:00")), <br> PARTITION p201111 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-12-01 00:00:00")), <br> PARTITION p201112 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-01-01 00:00:00")), <br> PARTITION p201201 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-02-01 00:00:00")), <br> PARTITION p201202 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-03-01 00:00:00")), <br> PARTITION p201203 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-04-01 00:00:00")), <br> PARTITION p201204 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-05-01 00:00:00")), <br> PARTITION p201205 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-06-01 00:00:00")), <br> PARTITION p201206 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-07-01 00:00:00")), <br> PARTITION p201207 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-08-01 00:00:00")), <br> PARTITION p201208 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-09-01 00:00:00")), <br> PARTITION p201209 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-10-01 00:00:00")), <br> PARTITION p201210 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-11-01 00:00:00")), <br> PARTITION p201211 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2012-12-01 00:00:00")), <br> PARTITION p201212 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2013-01-01 00:00:00")) <br> );</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  We create partition table with division by days <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `history_uint` PARTITION <font color="#0000ff">BY</font> RANGE( clock ) ( <br> PARTITION p20110603 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-03 00:00:00")), <br> PARTITION p20110604 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-04 00:00:00")), <br> PARTITION p20110605 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-05 00:00:00")), <br> PARTITION p20110606 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-06 00:00:00")), <br> PARTITION p20110607 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-07 00:00:00")), <br> PARTITION p20110608 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-08 00:00:00")), <br> PARTITION p20110609 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-09 00:00:00")), <br> PARTITION p20110610 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-10 00:00:00")), <br> PARTITION p20110611 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-11 00:00:00")) <br> ); <br> <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `history_log` PARTITION <font color="#0000ff">BY</font> RANGE( clock ) ( <br> PARTITION p20110603 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-03 00:00:00")), <br> PARTITION p20110604 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-04 00:00:00")), <br> PARTITION p20110605 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-05 00:00:00")), <br> PARTITION p20110606 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-06 00:00:00")), <br> PARTITION p20110607 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-07 00:00:00")), <br> PARTITION p20110608 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-08 00:00:00")), <br> PARTITION p20110609 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-09 00:00:00")), <br> PARTITION p20110610 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-10 00:00:00")), <br> PARTITION p20110611 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-11 00:00:00")) <br> ); <br> <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `history_text` PARTITION <font color="#0000ff">BY</font> RANGE( clock ) ( <br> PARTITION p20110603 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-03 00:00:00")), <br> PARTITION p20110604 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-04 00:00:00")), <br> PARTITION p20110605 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-05 00:00:00")), <br> PARTITION p20110606 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-06 00:00:00")), <br> PARTITION p20110607 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-07 00:00:00")), <br> PARTITION p20110608 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-08 00:00:00")), <br> PARTITION p20110609 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-09 00:00:00")), <br> PARTITION p20110610 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-10 00:00:00")), <br> PARTITION p20110611 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-11 00:00:00")) <br> ); <br> <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `history` PARTITION <font color="#0000ff">BY</font> RANGE( clock ) ( <br> PARTITION p20110603 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-03 00:00:00")), <br> PARTITION p20110604 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-04 00:00:00")), <br> PARTITION p20110605 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-05 00:00:00")), <br> PARTITION p20110606 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-06 00:00:00")), <br> PARTITION p20110607 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-07 00:00:00")), <br> PARTITION p20110608 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-08 00:00:00")), <br> PARTITION p20110609 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-09 00:00:00")), <br> PARTITION p20110610 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-10 00:00:00")), <br> PARTITION p20110611 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-11 00:00:00")) <br> ); <br> <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> `history_str` PARTITION <font color="#0000ff">BY</font> RANGE( clock ) ( <br> PARTITION p20110603 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-03 00:00:00")), <br> PARTITION p20110604 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-04 00:00:00")), <br> PARTITION p20110605 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-05 00:00:00")), <br> PARTITION p20110606 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-06 00:00:00")), <br> PARTITION p20110607 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-07 00:00:00")), <br> PARTITION p20110608 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-08 00:00:00")), <br> PARTITION p20110609 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-09 00:00:00")), <br> PARTITION p20110610 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-10 00:00:00")), <br> PARTITION p20110611 <font color="#0000ff">VALUES</font> <font color="#0000ff">LESS</font> <font color="#0000ff">THAN</font> (UNIX_TIMESTAMP("2011-06-11 00:00:00")) <br> );</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Restore the data of each table as follows (substituting for each table your own dump file name) <br> <code>mysql zabbix &lt; 09.06.2011_history_str.sql</code> <br> <br>  In the end result, the data will be stored very conveniently - every day / month in a separate file, a separate part of the table. <br><br> <code>ls -l /var/lib/mysql/zabbix/ |grep history_u <br> -rw-rw---- 1 mysql mysql 8628 2011-06-08 14:00 history_uint.frm <br> -rw-rw---- 1 mysql mysql 140 2011-06-08 14:00 history_uint.par <br> -rw-rw---- 1 mysql mysql 457179136 2011-06-07 11:34 history_uint#P#p20110605.ibd <br> -rw-rw---- 1 mysql mysql 557842432 2011-06-07 11:34 history_uint#P#p20110606.ibd <br> -rw-rw---- 1 mysql mysql 620756992 2011-06-07 11:34 history_uint#P#p20110607.ibd <br> -rw-rw---- 1 mysql mysql 629145600 2011-06-08 00:03 history_uint#P#p20110608.ibd <br> -rw-rw---- 1 mysql mysql 666894336 2011-06-09 00:08 history_uint#P#p20110609.ibd <br> -rw-rw---- 1 mysql mysql 423624704 2011-06-09 14:55 history_uint#P#p20110610.ibd <br> -rw-rw---- 1 mysql mysql 114688 2011-06-07 11:09 history_uint#P#p20110611.ibd <br> -rw-rw---- 1 mysql mysql 114688 2011-06-07 11:44 history_uint#P#p20110612.ibd <br> -rw-rw---- 1 mysql mysql 114688 2011-06-07 11:44 history_uint#P#p20110613.ibd <br> -rw-rw---- 1 mysql mysql 114688 2011-06-07 11:44 history_uint#P#p20110614.ibd <br> -rw-rw---- 1 mysql mysql 114688 2011-06-08 14:00 history_uint#P#p20110615.ibd <br> -rw-rw---- 1 mysql mysql 8688 2011-05-27 21:30 history_uint_sync.frm <br> -rw-rw---- 1 mysql mysql 131072 2011-05-27 21:30 history_uint_sync.ibd <br></code> <br><br>  Clearing old data is done with a simple command (substitute the table you need instead of `history_uint`) <br> <code>ALTER TABLE `history_uint` DROP PARTITION p20110604;</code> <br>  Adding a new part of the table <br> <code>ALTER TABLE `history_uint` ADD PARTITION (PARTITION p20110628 VALUES LESS THAN (UNIX_TIMESTAMP("2011-06-29 00:00:00")));</code> <br> <br>  Hands to clean the tables and add new ones as it is not interesting, again in the blog they offer a procedure for the tables divided by days, the code is taken here <a href="http://pastebin.com/ijyKkxLh">pastebin.com/ijyKkxLh in</a> order to save it for posterity, I will post it here without changes. <br><br><blockquote> <code><a href="http://zabbixzone.com/zabbix/partitioning-tables/"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">/************************************************************** <br> MySQL Auto Partitioning <font color="#0000ff">Procedure</font> <font color="#0000ff">for</font> Zabbix 1.8 <br> zabbixzone.com/zabbix/partitioning-tables <br> <br> Author: Ricardo Santos (rsantos <font color="#0000ff">at</font> gmail.com) <br> Version: 20110518 <br> **************************************************************/ <br> DELIMITER // <br> <font color="#0000ff">DROP</font> <font color="#0000ff">PROCEDURE</font> <font color="#0000ff">IF</font> <font color="#0000ff">EXISTS</font> `zabbix`.`create_zabbix_partitions` // <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> `zabbix`.`create_zabbix_partitions` () <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">CALL</font> zabbix.create_next_partitions("zabbix","history"); <br> <font color="#0000ff">CALL</font> zabbix.create_next_partitions("zabbix","history_log"); <br> <font color="#0000ff">CALL</font> zabbix.create_next_partitions("zabbix","history_str"); <br> <font color="#0000ff">CALL</font> zabbix.create_next_partitions("zabbix","history_text"); <br> <font color="#0000ff">CALL</font> zabbix.create_next_partitions("zabbix","history_uint"); <br> <font color="#0000ff">CALL</font> zabbix.drop_old_partitions("zabbix","history"); <br> <font color="#0000ff">CALL</font> zabbix.drop_old_partitions("zabbix","history_log"); <br> <font color="#0000ff">CALL</font> zabbix.drop_old_partitions("zabbix","history_str"); <br> <font color="#0000ff">CALL</font> zabbix.drop_old_partitions("zabbix","history_text"); <br> <font color="#0000ff">CALL</font> zabbix.drop_old_partitions("zabbix","history_uint"); <br> <font color="#0000ff">END</font> // <br> <font color="#0000ff">DROP</font> <font color="#0000ff">PROCEDURE</font> <font color="#0000ff">IF</font> <font color="#0000ff">EXISTS</font> `zabbix`.`create_next_partitions` // <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> `zabbix`.`create_next_partitions` (SCHEMANAME <font color="#0000ff">varchar</font> (64), TABLENAME <font color="#0000ff">varchar</font> (64)) <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">DECLARE</font> NEXTCLOCK <font color="#0000ff">timestamp</font> ; <br> <font color="#0000ff">DECLARE</font> PARTITIONNAME <font color="#0000ff">varchar</font> (16); <br> <font color="#0000ff">DECLARE</font> CLOCK <font color="#0000ff">int</font> ; <br> <font color="#0000ff">SET</font> @totaldays = 7; <br> <font color="#0000ff">SET</font> @i = 1; <br> createloop: LOOP <br> <font color="#0000ff">SET</font> NEXTCLOCK = DATE_ADD(NOW(), <font color="#0000ff">INTERVAL</font> @i <font color="#0000ff">DAY</font> ); <br> <font color="#0000ff">SET</font> PARTITIONNAME = DATE_FORMAT( NEXTCLOCK, <font color="#A31515">'p%Y%m%d'</font> ); <br> <font color="#0000ff">SET</font> CLOCK = UNIX_TIMESTAMP(DATE_FORMAT(DATE_ADD( NEXTCLOCK , <font color="#0000ff">INTERVAL</font> 1 <font color="#0000ff">DAY</font> ), <font color="#A31515">'%Y-%m-%d 00:00:00'</font> )); <br> <font color="#0000ff">CALL</font> zabbix.create_partition( SCHEMANAME, TABLENAME, PARTITIONNAME, CLOCK ); <br> <font color="#0000ff">SET</font> @i=@i+1; <br> <font color="#0000ff">IF</font> @i &gt; @totaldays <font color="#0000ff">THEN</font> <br> LEAVE createloop; <br> <font color="#0000ff">END</font> <font color="#0000ff">IF</font> ; <br> <font color="#0000ff">END</font> LOOP; <br> <font color="#0000ff">END</font> // <br> <font color="#0000ff">DROP</font> <font color="#0000ff">PROCEDURE</font> <font color="#0000ff">IF</font> <font color="#0000ff">EXISTS</font> `zabbix`.`drop_old_partitions` // <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> `zabbix`.`drop_old_partitions` (SCHEMANAME <font color="#0000ff">varchar</font> (64), TABLENAME <font color="#0000ff">varchar</font> (64)) <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">DECLARE</font> OLDCLOCK <font color="#0000ff">timestamp</font> ; <br> <font color="#0000ff">DECLARE</font> PARTITIONNAME <font color="#0000ff">varchar</font> (16); <br> <font color="#0000ff">DECLARE</font> CLOCK <font color="#0000ff">int</font> ; <br> <font color="#0000ff">SET</font> @mindays = 3; <br> <font color="#0000ff">SET</font> @maxdays = @mindays+4; <br> <font color="#0000ff">SET</font> @i = @maxdays; <br> droploop: LOOP <br> <font color="#0000ff">SET</font> OLDCLOCK = DATE_SUB(NOW(), <font color="#0000ff">INTERVAL</font> @i <font color="#0000ff">DAY</font> ); <br> <font color="#0000ff">SET</font> PARTITIONNAME = DATE_FORMAT( OLDCLOCK, <font color="#A31515">'p%Y%m%d'</font> ); <br> <font color="#0000ff">CALL</font> zabbix.drop_partition( SCHEMANAME, TABLENAME, PARTITIONNAME ); <br> <font color="#0000ff">SET</font> @i=@i-1; <br> <font color="#0000ff">IF</font> @i &lt;= @mindays <font color="#0000ff">THEN</font> <br> LEAVE droploop; <br> <font color="#0000ff">END</font> <font color="#0000ff">IF</font> ; <br> <font color="#0000ff">END</font> LOOP; <br> <font color="#0000ff">END</font> // <br> <font color="#0000ff">DROP</font> <font color="#0000ff">PROCEDURE</font> <font color="#0000ff">IF</font> <font color="#0000ff">EXISTS</font> `zabbix`.`create_partition` // <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> `zabbix`.`create_partition` (SCHEMANAME <font color="#0000ff">varchar</font> (64), TABLENAME <font color="#0000ff">varchar</font> (64), PARTITIONNAME <font color="#0000ff">varchar</font> (64), CLOCK <font color="#0000ff">int</font> ) <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">DECLARE</font> RETROWS <font color="#0000ff">int</font> ; <br> <font color="#0000ff">SELECT</font> <font color="#0000ff">COUNT</font> (1) <font color="#0000ff">INTO</font> RETROWS <br> <font color="#0000ff">FROM</font> `information_schema`.`partitions` <br> <font color="#0000ff">WHERE</font> `table_schema` = SCHEMANAME <font color="#0000ff">AND</font> `table_name` = TABLENAME <font color="#0000ff">AND</font> `partition_name` = PARTITIONNAME; <br> <br> <font color="#0000ff">IF</font> RETROWS = 0 <font color="#0000ff">THEN</font> <br> <font color="#0000ff">SELECT</font> CONCAT( "create_partition(", SCHEMANAME, ",", TABLENAME, ",", PARTITIONNAME, ",", CLOCK, ")" ) <font color="#0000ff">AS</font> msg; <br> <font color="#0000ff">SET</font> @ <font color="#0000ff">sql</font> = CONCAT( <font color="#A31515">'ALTER TABLE `'</font> , SCHEMANAME, <font color="#A31515">'`.`'</font> , TABLENAME, <font color="#A31515">'`'</font> , <br> <font color="#A31515">' ADD PARTITION (PARTITION '</font> , PARTITIONNAME, <font color="#A31515">' VALUES LESS THAN ('</font> , CLOCK, <font color="#A31515">'));'</font> ); <br> <font color="#0000ff">PREPARE</font> STMT <font color="#0000ff">FROM</font> @ <font color="#0000ff">sql</font> ; <br> <font color="#0000ff">EXECUTE</font> STMT; <br> <font color="#0000ff">DEALLOCATE</font> <font color="#0000ff">PREPARE</font> STMT; <br> <font color="#0000ff">END</font> <font color="#0000ff">IF</font> ; <br> <font color="#0000ff">END</font> // <br> <font color="#0000ff">DROP</font> <font color="#0000ff">PROCEDURE</font> <font color="#0000ff">IF</font> <font color="#0000ff">EXISTS</font> `zabbix`.`drop_partition` // <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> `zabbix`.`drop_partition` (SCHEMANAME <font color="#0000ff">varchar</font> (64), TABLENAME <font color="#0000ff">varchar</font> (64), PARTITIONNAME <font color="#0000ff">varchar</font> (64)) <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">DECLARE</font> RETROWS <font color="#0000ff">int</font> ; <br> <font color="#0000ff">SELECT</font> <font color="#0000ff">COUNT</font> (1) <font color="#0000ff">INTO</font> RETROWS <br> <font color="#0000ff">FROM</font> `information_schema`.`partitions` <br> <font color="#0000ff">WHERE</font> `table_schema` = SCHEMANAME <font color="#0000ff">AND</font> `table_name` = TABLENAME <font color="#0000ff">AND</font> `partition_name` = PARTITIONNAME; <br> <br> <font color="#0000ff">IF</font> RETROWS = 1 <font color="#0000ff">THEN</font> <br> <font color="#0000ff">SELECT</font> CONCAT( "drop_partition(", SCHEMANAME, ",", TABLENAME, ",", PARTITIONNAME, ")" ) <font color="#0000ff">AS</font> msg; <br> <font color="#0000ff">SET</font> @ <font color="#0000ff">sql</font> = CONCAT( <font color="#A31515">'ALTER TABLE `'</font> , SCHEMANAME, <font color="#A31515">'`.`'</font> , TABLENAME, <font color="#A31515">'`'</font> , <br> <font color="#A31515">' DROP PARTITION '</font> , PARTITIONNAME, <font color="#A31515">';'</font> ); <br> <font color="#0000ff">PREPARE</font> STMT <font color="#0000ff">FROM</font> @ <font color="#0000ff">sql</font> ; <br> <font color="#0000ff">EXECUTE</font> STMT; <br> <font color="#0000ff">DEALLOCATE</font> <font color="#0000ff">PREPARE</font> STMT; <br> <font color="#0000ff">END</font> <font color="#0000ff">IF</font> ; <br> <font color="#0000ff">END</font> // <br> DELIMITER ;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  It now remains to add this cron code every 3 days. <br>  the line in the crown config will look something like this <br> <code>0 6 */3 * * ___ mysql -B -h localhost -u zabbix -p zabbix -e "CALL create_zabbix_partitions();"</code> <br> <br>  With the configuration of the database is finished. <br><br><h3>  Set up the automatic binding of templates on the number of boards on the equipment </h3><br>  My glands are quite large and are scaled by adding cards with subscriber ports.  In order not to interrogate non-existing ports in the piece of iron, I broke all the templates into boards.  Added a detection rule that once a day knocks on a certain oid.  The answer from this question allows you to know whether the board is installed in the slot or not.  Scanning goes over the entire range of ip glands. <br> <a href=""><img src="http://habrastorage.org/storage/2f3fcde7/5867ac16/4e93f020/cf2bf046.png"></a> <br>  Added two actions that either bind the template of this card to the node, or untie the template from it, performing it depending on the value received during detection. <br> <a href=""><img src="http://habrastorage.org/storage/a9d01bc4/1a585005/a7ced3c6/6c9a37dc.png"></a> <br> <a href=""><img src="http://habrastorage.org/storage/82c52b86/5c64afb9/be46e498/be26a6eb.png"></a> <br><br>  By such simple actions we get rid of the tedious exercise of monitoring the number of installed cards in the access nodes. <br><br><h3>  What did we get? </h3><br>  Download proca and other different graphics below. <br>  On the database size chart, you can see two drops, the first drop is the first run of the procedure, the second drop in a day is a manual check of the procedure. <br> <a href=""><img src="http://habrastorage.org/storage/cb9d5393/784d5b5a/9a291051/ce816696.png"></a> <br> <a href=""><img src="http://habrastorage.org/storage/5fbfed66/b8777564/c9771294/782df6fb.png"></a> <br><br>  Brief quality characteristics <br> <a href=""><img src="http://habrastorage.org/storage/4a114241/f22874e1/ad66f275/e4ac895e.png"></a> <br><br>  As can be seen, resources allow you to lift the load without much damage to performance.  Previously, I dabbled in and brought the number of items to 300,000 and the number of received values ‚Äã‚Äãper second to 200. Now, everything superfluous and unnecessary from monitoring has been removed. <br><br><h3>  Minor bonus </h3><br>  Example of part of the FTTB network map <br> <a href=""><img src="http://habrastorage.org/storage/ec3faf4e/0bf6a300/5d67365f/1c90d71e.png"></a> <br><br>  Link control for a single corporate client <br> <a href=""><img src="http://habrastorage.org/storage/686543be/404ca117/b73aabe7/2a5fca6d.png"></a> <br><br>  Continuation will be if the topic is interesting)) <br><br>  PS I apologize for a somewhat confused presentation of the material. <br>  UPD: Corrected some spelling and grammatical errors. <br>  UPD2: Corrected many more spelling and grammatical errors, corrected lost links. </div><p>Source: <a href="https://habr.com/ru/post/120955/">https://habr.com/ru/post/120955/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../120947/index.html">Email marketing: plain / text</a></li>
<li><a href="../120949/index.html">Protection of copyright content at the state level</a></li>
<li><a href="../120951/index.html">Video from the RailsClub'Moscow conference (April 30, 2011)</a></li>
<li><a href="../120953/index.html">Russian voice TED</a></li>
<li><a href="../120954/index.html">New devices released: Yota One and Yota Many</a></li>
<li><a href="../120956/index.html">Google never ceases to amaze</a></li>
<li><a href="../120957/index.html">What can be made of cardboard?</a></li>
<li><a href="../120958/index.html">Local dictionaries in ABBYY Lingvo x5: constructor for translators and not only</a></li>
<li><a href="../120960/index.html">Vertical page scrolling with jQuery and cross-browser compatibility</a></li>
<li><a href="../120961/index.html">CPanel and Parallels Plesk Panel from the point of view of a hoster. Part Three and Last</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>