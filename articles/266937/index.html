<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Functional C #: Primitive obsession (primitive obsession)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the second article from the mini-series of articles about functional C #. 



- Functional C #: Immutability 
- Functional C #: Primitive obse...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Functional C #: Primitive obsession (primitive obsession)</h1><div class="post__text post__text-html js-mediator-article">  This is the second article from the mini-series of articles about functional C #. <br><br><ul><li>  <a href="http://habrahabr.ru/post/266873/">Functional C #: Immutability</a> <br></li><li>  <b>Functional C #: Primitive obsession</b> <br></li><li>  <a href="http://habrahabr.ru/post/267063/">Functional C #: Non-nullable reference types</a> <br></li><li>  <a href="http://habrahabr.ru/post/267231/">Functional C #: work with errors</a> <br></li></ul><a name="habracut"></a><br><h2>  What is primitive obsession? </h2><br>  In short, this is when mainly primitive types (string, int, etc.) are used to simulate an application domain.  For example, here‚Äôs how the Customer class might look like in a typical application: <br><br><pre><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Customer</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Customer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> email</span></span></span><span class="hljs-function">)</span></span> { Name = name; Email = email; } }</code> </pre> <br>  The problem here is that if you need to enforce some business rules, you have to duplicate the validation logic throughout the class code: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Customer { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string <span class="hljs-type"><span class="hljs-type">Name</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Customer(string <span class="hljs-type"><span class="hljs-type">name</span></span>, string email) { // <span class="hljs-keyword"><span class="hljs-keyword">Validate</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (string.IsNullOrWhiteSpace(<span class="hljs-type"><span class="hljs-type">name</span></span>) || <span class="hljs-type"><span class="hljs-type">name</span></span>.Length &gt; <span class="hljs-number"><span class="hljs-number">50</span></span>) throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArgumentException(‚Äú<span class="hljs-type"><span class="hljs-type">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> invalid‚Äù); // <span class="hljs-keyword"><span class="hljs-keyword">Validate</span></span> e-mail <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (string.IsNullOrWhiteSpace(email) || email.Length &gt; <span class="hljs-number"><span class="hljs-number">100</span></span>) throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArgumentException(‚ÄúE-mail <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> invalid‚Äù); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Regex.IsMatch(email, @‚Äù^([\w\.\-]+)@([\w\-]+)((\.(\w){<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>})+)$‚Äù)) throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArgumentException(‚ÄúE-mail <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> invalid‚Äù); <span class="hljs-type"><span class="hljs-type">Name</span></span> = <span class="hljs-type"><span class="hljs-type">name</span></span>; Email = email; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> ChangeName(string <span class="hljs-type"><span class="hljs-type">name</span></span>) { // <span class="hljs-keyword"><span class="hljs-keyword">Validate</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (string.IsNullOrWhiteSpace(<span class="hljs-type"><span class="hljs-type">name</span></span>) || <span class="hljs-type"><span class="hljs-type">name</span></span>.Length &gt; <span class="hljs-number"><span class="hljs-number">50</span></span>) throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArgumentException(‚Äú<span class="hljs-type"><span class="hljs-type">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> invalid‚Äù); <span class="hljs-type"><span class="hljs-type">Name</span></span> = <span class="hljs-type"><span class="hljs-type">name</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> ChangeEmail(string email) { // <span class="hljs-keyword"><span class="hljs-keyword">Validate</span></span> e-mail <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (string.IsNullOrWhiteSpace(email) || email.Length &gt; <span class="hljs-number"><span class="hljs-number">100</span></span>) throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArgumentException(‚ÄúE-mail <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> invalid‚Äù); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Regex.IsMatch(email, @‚Äù^([\w\.\-]+)@([\w\-]+)((\.(\w){<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>})+)$‚Äù)) throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArgumentException(‚ÄúE-mail <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> invalid‚Äù); Email = email; } }</code> </pre><br>  Moreover, exactly the same code tends to fall into the application layer: <br><br><pre> <code class="hljs pgsql">[HttpPost] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ActionResult CreateCustomer(CustomerInfo customerInfo) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ModelState.IsValid) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">View</span></span>(customerInfo); Customer customer = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Customer(customerInfo.Name, customerInfo.Email); // Rest <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> CustomerInfo { [Required(ErrorMessage = ‚Äú<span class="hljs-type"><span class="hljs-type">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> required‚Äù)] [StringLength(<span class="hljs-number"><span class="hljs-number">50</span></span>, ErrorMessage = ‚Äú<span class="hljs-type"><span class="hljs-type">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> too long‚Äù)] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string <span class="hljs-type"><span class="hljs-type">Name</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required(ErrorMessage = ‚ÄúE-mail <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> required‚Äù)] [RegularExpression(@‚Äù^([\w\.\-]+)@([\w\-]+)((\.(\w){<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>})+)$‚Äù, ErrorMessage = ‚ÄúInvalid e-mail address‚Äù)] [StringLength(<span class="hljs-number"><span class="hljs-number">100</span></span>, ErrorMessage = ‚ÄúE-mail <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> too long‚Äù)] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  Obviously, this approach violates the <a href="http://enterprisecraftsmanship.com/2015/09/11/dry-revisited/">principle of DRY</a> .  This principle tells us that <b>every part of the domain information should have a single authoritative source in the code of our application</b> .  In the example above, we have 3 such sources. <br><br><h2>  How to get rid of obsession with primitives? </h2><br>  To get rid of obsession with primitives, we have to add two new types that aggregate the validation logic.  This way we can get rid of duplication: <br><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Email</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> _value; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Email</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ _value = value; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Result&lt;Email&gt; Create(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> email) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.IsNullOrWhiteSpace(email)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Result.Fail&lt;Email&gt;(‚ÄúE-mail can't be empty‚Äù); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (email.Length &gt; <span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Result.Fail&lt;Email&gt;(‚ÄúE-mail is too <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>‚Äù); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Regex.IsMatch(email, @‚Äù^([\w\.\-]+)@([\w\-]+)((\.(\w){<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>})+)$‚Äù)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Result.Fail&lt;Email&gt;(‚ÄúE-mail is invalid‚Äù); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Result.Ok(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Email(email)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> implicit </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">operator</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Email email)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> email._value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object obj)</span></span></span><span class="hljs-function"> </span></span>{ Email email = obj as Email; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ReferenceEquals(email, null)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _value == email._value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHashCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _value.GetHashCode(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerName</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Result&lt;CustomerName&gt; Create(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> name) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.IsNullOrWhiteSpace(name)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Result.Fail&lt;CustomerName&gt;(‚ÄúName can't be empty‚Äù); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name.Length &gt; <span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Result.Fail&lt;CustomerName&gt;(‚ÄúName is too <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>‚Äù); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Result.Ok(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomerName(name)); } <span class="hljs-comment"><span class="hljs-comment">//     ,  Email }</span></span></code> </pre><br>  The advantage of this approach is that in the event of a change in the validation logic, we only need to reflect this change only once. <br><br>  Note that the Email class constructor is closed, so the only way to create an instance of it is to use the static Create method, which performs all the necessary validations.  This approach allows us to be confident that all instances of the Email class are in a valid state throughout their lives. <br><br>  Here is how the controller can use these classes: <br><br><pre> <code class="hljs pgsql">[HttpPost] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ActionResult CreateCustomer(CustomerInfo customerInfo) { Result&lt;Email&gt; emailResult = Email.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(customerInfo.Email); Result&lt;CustomerName&gt; nameResult = CustomerName.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(customerInfo.Name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (emailResult.Failure) ModelState.AddModelError(‚ÄúEmail‚Äù, emailResult.Error); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nameResult.Failure) ModelState.AddModelError(‚Äú<span class="hljs-type"><span class="hljs-type">Name</span></span>‚Äù, nameResult.Error); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ModelState.IsValid) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">View</span></span>(customerInfo); Customer customer = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Customer(nameResult.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>, emailResult.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>); // Rest <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> }</code> </pre><br>  Instances of Result &lt;Email&gt; and Result &lt;CustomerName&gt; explicitly tell us that the Create method can fail, and if so, we can find out the reason by reading the Error property. <br><br>  Here is how the Customer class looks after refactoring: <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Customer { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> CustomerName <span class="hljs-type"><span class="hljs-type">Name</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Email Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Customer(CustomerName <span class="hljs-type"><span class="hljs-type">name</span></span>, Email email) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-type"><span class="hljs-type">name</span></span> == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArgumentNullException(‚Äú<span class="hljs-type"><span class="hljs-type">name</span></span>‚Äù); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (email == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArgumentNullException(‚Äúemail‚Äù); <span class="hljs-type"><span class="hljs-type">Name</span></span> = <span class="hljs-type"><span class="hljs-type">name</span></span>; Email = email; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> ChangeName(CustomerName <span class="hljs-type"><span class="hljs-type">name</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-type"><span class="hljs-type">name</span></span> == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArgumentNullException(‚Äú<span class="hljs-type"><span class="hljs-type">name</span></span>‚Äù); <span class="hljs-type"><span class="hljs-type">Name</span></span> = <span class="hljs-type"><span class="hljs-type">name</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> ChangeEmail(Email email) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (email == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArgumentNullException(‚Äúemail‚Äù); Email = email; } }</code> </pre><br>  Almost all checks moved to Email and CustomerName.  The only remaining validation is a null check.  We will see how to get rid of it in the next article. <br><br>  So, what are the benefits of getting rid of obsession with primitives? <br><br><ul><li>  We create the only authoritative source of knowledge for each problem solved by our code.  No duplication, just clean and ‚Äúdry‚Äù (dry) code. <br></li><li>  More strict type system.  The compiler works with us with double force: now it is impossible to mistakenly assign an object of type CustomerName to the Email type, such code will not be compiled. <br></li><li>  No need to validate incoming values.  If we get an object of class Email or CustomerName, we can be 100% sure that it is in the correct state. <br></li></ul><br>  A small note.  Some developers tend to "wrap" and "deploy" primitive types several times during a single operation: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> oldEmail, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newEmail</span></span></span><span class="hljs-function">)</span></span> { Result&lt;Email&gt; oldEmailResult = Email.Create(oldEmail); Result&lt;Email&gt; newEmailResult = Email.Create(newEmail); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oldEmailResult.Failure || newEmailResult.Failure) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> oldEmailValue = oldEmailResult.Value; Customer customer = GetCustomerByEmail(oldEmailValue); customer.Email = newEmailResult.Value; }</code> </pre><br>  It is best to use custom types in the entire application, expanding them into primitives only when they go beyond the boundaries of the domain, for example, are saved to the database or rendered in HTML.  In your domain classes, try to always use custom types, the code in this case will be simpler and more readable: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Email oldEmail, Email newEmail</span></span></span><span class="hljs-function">)</span></span> { Customer customer = GetCustomerByEmail(oldEmail); customer.Email = newEmail; }</code> </pre><br><h2>  Restrictions </h2><br>  Unfortunately, the creation of wrapper types in C # is not so simple as in F #, for example.  This may change in C # 7 if pattern matching and record types are implemented at the language level.  Until then, we have to deal with the clumsiness of this approach. <br><br>  Because of this, some primitive types are not worth being wrapped.  For example, the type of "money amount" with a single invariant, indicating that the amount of money can not be negative, can be represented as a regular decimal.  This will lead to some duplication of validation logic, but even so, this approach will be a simpler solution, even in the long run. <br><br>  As usual, stick to common sense and weigh the pros and cons of solutions in each case. <br><br><h2>  Conclusion </h2><br>  With immutable and non-primitive types, we come closer to designing C # applications in a more functional style.  In the next article, we will discuss how to mitigate the billion dollar mistake. <br><br><h2>  Sources </h2><br><ul><li>  <a href="https://gist.github.com/vkhorikov/5f0c7167250edb17cd2f">Code with primitive obsession</a> <br></li><li>  <a href="https://gist.github.com/vkhorikov/063953c90f5d60ddc24b">Code without primitive obsession</a> <br></li></ul><br><h2>  The remaining articles in the cycle </h2><br><ul><li>  <a href="http://habrahabr.ru/post/266873/">Functional C #: Immutability</a> <br></li><li>  <b>Functional C #: Primitive obsession</b> <br></li><li>  <a href="http://habrahabr.ru/post/267063/">Functional C #: Non-nullable reference types</a> <br></li><li>  <a href="http://habrahabr.ru/post/267231/">Functional C #: work with errors</a> <br></li></ul><br>  English version of the article: <a href="http://enterprisecraftsmanship.com/2015/03/07/functional-c-primitive-obsession/">Functional C #: Primitive obsession</a> </div><p>Source: <a href="https://habr.com/ru/post/266937/">https://habr.com/ru/post/266937/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266925/index.html">A collection of practical PHP tasks to prepare for an interview</a></li>
<li><a href="../266927/index.html">A story about making friends with the Nexus Player (FUGU) and the Intel Mobile Development Kit</a></li>
<li><a href="../266929/index.html">Jii: configuration and scaling</a></li>
<li><a href="../266933/index.html">Hone the skills of the console</a></li>
<li><a href="../266935/index.html">About safety UEFI, part zero and first</a></li>
<li><a href="../266939/index.html">How to make friends HTML5 with mobile OS</a></li>
<li><a href="../266941/index.html">RailsClub 2015: Interview with Boris Goryachev</a></li>
<li><a href="../266943/index.html">Workflow architecture in SharePoint Server 2013: yesterday and today</a></li>
<li><a href="../266945/index.html">Practical training in pentest laboratories. Part 2</a></li>
<li><a href="../266947/index.html">The evolution of trading terminals: Mobile trading in the era of touch interfaces</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>