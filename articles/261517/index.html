<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Does XMPP suck?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have to admit that I decided to write this article very spontaneously, having read the article ‚ÄúXMPP sucks‚Äù and felt some closeness to the author‚Äôs ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Does XMPP suck?</h1><div class="post__text post__text-html js-mediator-article">  I have to admit that I decided to write this article very spontaneously, having read the article <a href="http://habrahabr.ru/post/259337/">‚ÄúXMPP sucks‚Äù</a> and felt some closeness to the author‚Äôs feelings, as I also use XMPR in one of our products.  Nevertheless, clenching my emotions into a fist, I nevertheless decided to simply state why I have mixed feelings about this protocol and spread out the pros and cons.  Also tell you what we have chosen for the server and client.  That's all for you, dear reader, to make the right choice <s>and pull out less hair</s> in your future projects. <br><a name="habracut"></a><br>  I work at <a href="https://www.thirdlane.com/">Thirdlane</a> , where we make products for VoIP and unified communications.  At one time, we chose a protocol for communication in one of our products.  At the moment of choosing a protocol, the question was simply: whether to write the protocol yourself, or use HMRD.  We did not consider other protocols.  After not long discussions, we chose HMRD, relying on the fact that it is a standard open protocol with extensive use, documentation, various implementations and extensions that on the surface seemed to meet 100% of our requirements.  Now, after quite a long time robots with HMRR, I can say that I am not sure that we have made the right choice.  However, I do not know what my feelings would be if we went the other way.  Of course, sitting in the evenings having a cup of tea, I sometimes dream of returning at that time and writing my own private protocol with blackjack and node.js, but alas.  Immediately remember the words of Socrates: <br><br>  <i>‚ÄúIf you marry, or don't marry, you will regret it anyway.‚Äù</i> <br><br>  At the moment of selection, the main advantages of the protocol seemed to us as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  This is an open protocol; </li><li>  There is a huge number of servers and clients for it; </li><li>  The ability to integrate the final product with the outside world; </li><li>  It is used in cool products: MS Lync, Cisco Jabber, Atlassian HipChat, etc ..; </li><li>  A huge number of extensions in the form of XEPs; </li><li>  Ability to extend the protocol. </li></ul><br>  Using XML as a format for data, we considered a drawback, but not critical, because we found the <a href="">stanza.io</a> library which makes it easy to convert XML into an easy-to-use JSON. <br><br><h4>  Client side </h4><br>  Since our product is focused on a web browser, we only have JS in our hands, we love it, it's cool, stylish, and finally.  If you look at the JS-libraries for working with XMPP, then we will see several handicrafts such as strophe, xmpp-ftw, JSJaC.  None of them appealed to me, unlike the aforementioned <a href="">stanza.io</a> , which I personally fell in love with at first sight.  The library is very well thought out and very cleanly written, supports all vital XEPs, it is easy and pleasant to work with it.  Its only drawback is weak documentation, which often required reading the source code.  But it was also useful. <br><br><h4>  Server side </h4><br>  Here, we also didn‚Äôt take long to make a choice, since at that moment there was no Stream Management or Web Socket transport in Openfire.  Ejabberd also dropped immediately, due to Erlang.  In addition, both products, being Open Source, tend to commercialize, which is not good.  Ultimately, we chose Prosody.  Smart, lightweight, written in a beautiful language Lua, responsive community, the project is not dead, each XEP is a separate module that is easy to connect / disconnect, the ability to easily write your own modules, well, in general, it is nice. <br><br>  <i>Protocol:</i> <br><br>  Here I will list only what seems to me important, and which I personally encountered. <br><br>  <i>XEP-0115: Entity Capabilities</i> <br><br>  This, of course, a big plus.  This thing allows us to find out which of the XEPs are implemented in the client of our interlocutor, whether to send him chat state notifications or not, well, or something else there. <br><br>  <i>XEP-0280: Message Carbons</i> <br><br>  This is also a great credit, it allows you to synchronize messages with all your devices, that is, if you are logged on to a laptop, mobile and desktop, then this will allow you to keep the correspondence in sync. <br><br>  <i>XEP-0308: Last Message Correction</i> <br><br>  This is just very convenient, fix ochepyatku in a message that has already been sent.  This is great, everyone uses it, everything is easier now, the harmarnats are calm. <br><br>  <i>XEP-0184: Message Delivery Receipts</i> <br><br>  This is just a song.  Together with stream management, it lets the user know that the message was sent and that the server received it, and lets you know that the message was delivered to the addressee.  Very useful, but, unfortunately, this information does not fall into the history of correspondence - "XEP-0313: Message Archive Management". <br><br>  <i>XEP-0313: Message Archive Management</i> <br><br>  This is sad ... This XEP is used to store history and its receipt.  First of all, you will never know whether any message was delivered if the client was closed.  Secondly, getting a story is an indication of what date you want and what is the limit.  As for me, paging would be more appropriate here.  Also, you can not organize a search for messages on the text on the server, which is also sad.  But in the presence of hands, this, of course, is solved with all sorts of crutches.  Here I fully agree with the author of the above article.  It is not clear how in the protocol this was missed. <br><br>  <i>XEP-0045: Multi-User Chat</i> <br><br>  This is the worst thing that happened with HMRR.  It is sadness and longing, pain and suffering, despondency and despair.  I will say this: the number of Satan is not 666, it is 0045. First of all, these are not group chats, this is an imitation of IRC.  Everything.  At this one could finish about 0045, but let's still figure out who is to blame and what to do?  Do you know how to enter the room?  Send a request to enter the room.  Do you know how to create a room?  Send a request to enter the room.  If it does not exist, it will be created.  The uniqueness of the server room name decides who wants it.  Like?  Wellcome to hell.  The person who created the room (well, or who has the right) sets the number of recent messages that will be sent to the client who enters the room.  Just entered, and you N messages from the group flew straight into the face.  The worst thing is that 0045 does not provide for the storage of offline participants.  A user is considered to have left the room as soon as he closes his client.  In order to return later to this room, you need to either remember her name, or use "XEP-0048: Bookmarks".  Imagine the situation now: you were invited to a group chat, you entered, talked and added this room to your bookmarks, and also indicated that you would enter this room automatically every time you log in.  Do you know what happens if this room was removed while you were offline?  When logging in, you will read the bookmarks and make ‚Äúthe entrance to the room‚Äù, and as we know that the creation is no different from the connection, it is correct!  You will create a new room.  Still?  I will have for you.  If the room is not specified as ‚Äúpersistent‚Äù, it will be deleted as soon as the last user closes the client or exits it.  These are the cases, who is to blame - it is clear, now the question is: what to do? <br><br>  We solved this problem as follows: all rooms are created and configured as <a href="http://xmpp.org/extensions/xep-0045.html">‚Äúmember-only‚Äù</a> and persistent.  In our client, we draw in the list of participants all those who have the right to enter the room.  As it turned out, Prosody prohibits getting such a list to all participants by default, although XEP says the opposite.  We discussed this with the developers of Prosody, I hope that they will agree and correct it.  In the meantime, we have our own change in the Prosody code.  We also had to make a change so that the user could exclude himself from this list (yes, by default, it is also impossible), which means his exit from the room.  They also wrote a custom module for Prosody, which monitors the change of the list of room users (room affiliation) and informs all participants of this.  In such an uncomplicated way, we have made conferences "almost like in Skype."  Interestingly, the XMPP community is now discussing a similar implementation of the MUC only using Pub / Sub, which was confirmed to me by one of the participants in the working group. <br><br>  <i>XEP-0085: Chat State Notifications</i> <br><br>  A useful thing, it's always good to know whether a user is typing or not, just a nice HER. <br><br>  <i>XEP-0198: Stream Management</i> <br><br>  It's just from the category of Mast-Hev.  For each of your bunch in the direction of the server, he will respond that he received it, so you know exactly what the message was sent for example.  It also allows you to use the protocol when the connection to the network is not stable, for example, if you are sitting on the phone and you sometimes lose the connection.  This will allow you to resume the connection, rather than re-login. <br><br><h4>  Conclusion </h4><br>  After all, I still find it difficult to explain why my feelings remained negative.  After all, we have ensured that everything worked beautifully.  Perhaps due to the fact that we expected that we would use a protocol in which there is everything and there would be no need to waste time on solving obvious problems.  But ‚Äúhaving been involved in a fight‚Äù, we came across a pile of pitfalls and not thoughtful realizations.  In the end, all the problems were solved, but as in that joke "the spoon was found, but the sediment remained."  Also, probably, because we spent a lot of time studying specifications, reading someone else's source code and putting in order HEPs that we didn‚Äôt fit, moreover, so that they remain backward compatible with native clients - that all together , there is a very not grateful occupation.  But, as I said, we have achieved the desired result.  I think it‚Äôs up to you to decide whether you‚Äôre ready to study complex specifications, dig into the bugs of their implementations in clients and servers.  If you make a great service, and even with integrations, then writing your own extensions is guaranteed.  Look at the same HipChat, he has a bunch of custom stanzas.  These are at least described in the documentation, and nobody knows what is under the hood of Lync or Jabber.  On the other hand, if you need basic functionality, then HMRP is exactly what you need.  A huge amount of everything out of the box, works 99% of cases. </div><p>Source: <a href="https://habr.com/ru/post/261517/">https://habr.com/ru/post/261517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261497/index.html">200 million checks per month or architecture and statistics of the CloudStats.me service</a></li>
<li><a href="../261507/index.html">"Pumping" notepad.exe</a></li>
<li><a href="../261509/index.html">Creating a scalable distributed application from scratch</a></li>
<li><a href="../261511/index.html">PSD parser or how to parse a Photoshop file in Java</a></li>
<li><a href="../261515/index.html">AllJoyn and Windows 10 - we make our devices speak the same language</a></li>
<li><a href="../261519/index.html">Acronis Backup Russia - First Look</a></li>
<li><a href="../261521/index.html">Setting tasks and calculating labor costs for the development of documentation in an IT company</a></li>
<li><a href="../261525/index.html">How to control response time or how fast your website loads?</a></li>
<li><a href="../261527/index.html">Mobile app design: why we work in @ 1x</a></li>
<li><a href="../261529/index.html">How to replace a homogeneous background with a transparent imagemagick</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>