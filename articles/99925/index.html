<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We combine two local networks via the Internet. Vpn lan to lan. Asus wl520gu + dd-wrt and FreeBSD + mpd5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 I am lucky to work in an organization that is developing, and from time to time new tasks arise that allow me to grow as well. This tim...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We combine two local networks via the Internet. Vpn lan to lan. Asus wl520gu + dd-wrt and FreeBSD + mpd5</h1><div class="post__text post__text-html js-mediator-article"> <b>Introduction</b> <br>  I am lucky to work in an organization that is developing, and from time to time new tasks arise that allow me to grow as well.  This time I needed to merge the head office and the second branch.  The task for me is not new, but I decided to approach it differently than before. <br>  Currently, FreeBSD + mpd5 is installed in the head office as a PPTP server.  In the first branch is similar (except for the fact that it is used as a vpn client).  There are also 8 points where one computer is installed on Windows XP OS ‚Äúclinging‚Äù to the head standard client of this OS. <br>  I need to create another tunnel between the two networks, but I cannot use my favorite FreeBSD OS, due to the limited space for installing a router in the second branch (this is a retail store, all the equipment is nestled on a narrow rack).  In addition, I wanted to try the dd-wrt firmware, which I had heard so much about, in action. <br><a name="habracut"></a><br>  <b>Start.</b> <br>  So we have: <br>  VPN server: FreeBSD 7.3 (Release i386) + mpd5 (Version 5.3) <br>  VPN client: Asus wl520gu + dd-wrt (DD-WRT v24-sp2 (10/10/09) vpn) <br>  * the same firmware is still standard, and dd-wrt is still to be ‚Äúscrewed‚Äù, which we will do. <br><br>  <b>Firmware router.</b> <br>  In many articles that I found, the authors for some reason omitted the description of the router's firmware process, citing the simplicity of this action.  I spent about half an hour reading the documentation on the official website, it was written very lucidly.  But I still describe, in steps, what I did. <br><br>  1. It is necessary to perform a hardware reset, the so-called 30/30/30.  This is necessary in order to get into engineering mode.  Get the ability to "fill" the firmware. <br>  When the power of the router is on, press the reset button, hold for 30 seconds, without releasing the button, turn off the power and hold for another 30 seconds, without releasing the button, turn on the power and hold the reset button again for 30 seconds. <br>  Hint: the default ip of the router is 192.168.1.1.  If you ping it before a hardware reset of 30/30/30, then ttl will be equal to 64, after resetting ttl becomes equal to 100. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      2. Download the firmware <a href="">dd-wrt.v24_mini_asus.trx</a> <br>  * other firmware / firmware for other router models are available at <a href="http://dd-wrt.com/site/support/router-database">dd-wrt.com/site/support/router-database</a> <br><br>  3. The next step is to download the downloaded firmware.  For this we need the utility tftp (tftp - trivial file transfer program).  Since I have Ubuntu installed on my netbook, installation is reduced to one command <br> <code>sudo aptitude install tftp</code> <br>  go to the folder with the firmware file <br> <code>cd </code> <br>  connect to the router <br> <code>tftp 192.168.1.1</code> <br>  select the binary mode <br> <code>mode binary</code> <br>  send the file with the firmware <br> <code>put dd-wrt.v24_mini_asus.trx</code> <br> <br>  Now <b>ATTENTION</b> , after the program informs you about the end of the file transfer process, turn on the stopwatch and <b>WAIT FOR FIVE EARTH MINUTES</b> . <br><br>  4. After 5 minutes, disconnect the piece of iron from the power supply, and wait 30-40 seconds.  Turn on, check, if during ‚Äúpinging‚Äù we see ttl = 64, then we can already be a little happy =) <br><br>  5. Let's go to <a href="http://192.168.1.1/">192.168.1.1</a> , we will be asked to change the username and password.  We are changing and rebooting the router again (I performed this step more due to reinsurance). <br><br>  Now you can climb on the web interface, believe it is very, very pleasant and interesting. <br><img src="http://unixadmins.su/index.php?action=dlattach;topic=160.0;attach=375;image" alt="image"><br><img src="http://unixadmins.su/index.php?action=dlattach;topic=160.0;attach=377;image" alt="image"><br><img src="http://unixadmins.su/index.php?action=dlattach;topic=160.0;attach=379;image" alt="image"><br><img src="http://unixadmins.su/index.php?action=dlattach;topic=160.0;attach=381;image" alt="image"><br><br>  Then you can upload some other firmware from dd-wrt using the web interface already.  In my case, this is dd-wrt.v24_vpn_generic.bin.  There is definitely nothing complicated, but do not forget about <b>FIVE EARTH MINUTES</b> =))) <br>  * here caring creators will show us a timer counting down seconds from 300 <br><br>  Then customize for yourself.  Again, the web interface is very good.  On each page there is a hint, do not apply to use! <br><br>  <b>VPN configuration</b> <br>  As a result of the experiments, the mpd5 config has taken the following form <br> <code>pptp_vpn_filial2: <br> create bundle static pptp1 <br> set ipcp ranges 10.255.255.11/32 10.255.255.12/32 <br> set ipcp dns 192.168.0.5 <br> set iface route 192.168.4.0/24 <br> set iface enable proxy-arp <br> set iface enable on-demand <br> set bundle enable compression <br> set ccp yes mppc <br> set mppc yes e128 <br> set mppc enable compress <br> set bundle enable crypt-reqd <br> set mppc yes stateless <br> create link static lpptp1 pptp <br> set link action bundle pptp1 <br> set link no pap <br> set link yes chap <br> set auth authname "onotole" <br> set auth password "ololololo" <br> set link mtu 1460 <br> set link keep-alive 0 0 <br> set link max-redial -1 <br> set pptp peer 172.17.59.12 <br> set link enable incoming</code> <br> <br>  ASUS settings on the screenshot <br><img src="http://unixadmins.su/index.php?action=dlattach;topic=160.0;attach=435;image" alt="image"><br>  That's probably all.  Traffic from the network to the network runs and is encrypted. <br><br>  - SMALL APDATE --- <br>  After the connection is established, dd-wrt'ovy pppd (in accordance with the configuration /tmp/pptpd_client/options.vpn) sends lcp echo requests every two seconds (for details see rfc 1661 ppp) and after the server does not respond to it for the third time sends Terminate-Request as a result, the connection is broken.  The lcp-echo-interval and lcp-echo-failure parameters in the config are responsible for this behavior.  We also need <s>to remove them to hell to</s> exclude, for this we go to the web interface Administration -&gt; Commands and drive in such a script: <br> <code>(while [ ! -f /tmp/pptpd_client/options.vpn ]; do sleep 10; done <br> sed /lcp/d /tmp/pptpd_client/options.vpn &gt; /tmp/pptpd_client/temp.vpn <br> cp /tmp/pptpd_client/temp.vpn /tmp/pptpd_client/options.vpn )&amp;</code> <br>  Click Save Start, after which we reboot the router. </div><p>Source: <a href="https://habr.com/ru/post/99925/">https://habr.com/ru/post/99925/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../99918/index.html">Approaches to extracting data from web resources</a></li>
<li><a href="../99919/index.html">Toshiba W100 libretto: the first laptop with a display instead of a keyboard</a></li>
<li><a href="../99920/index.html">Canobuvosti, 49th edition</a></li>
<li><a href="../99922/index.html">Football, soccer, pilau and movies</a></li>
<li><a href="../99923/index.html">Handling Excel Files Using Python</a></li>
<li><a href="../99928/index.html">Wireless video: external wireless video cards</a></li>
<li><a href="../99929/index.html">Toyota agreed with Alexander Severinsky</a></li>
<li><a href="../99931/index.html">Tools for assessing the status of development projects</a></li>
<li><a href="../99932/index.html">Video review of the best of low-cost Android backgrounds LG Optimus</a></li>
<li><a href="../99935/index.html">Sony's RayModeler 3D 3D Display Prototype</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>