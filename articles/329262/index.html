<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create a modern CI / CD chain using free cloud services</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The solution to the task of the developer can be difficult to find. But as soon as it is received, the author immediately wants to share it with the w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create a modern CI / CD chain using free cloud services</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/56f/7f2/f27/56f7f2f27b60494db942174510afe20f.jpeg"><br><img src="https://habrastorage.org/web/cd2/7b8/154/cd27b815499e4fe798591ef067a8216f.png"><br><br><p>  The solution to the task of the developer can be difficult to find.  But as soon as it is received, the author immediately wants to share it with the whole world, it‚Äôs so great to ‚Äúship‚Äù the code.  An unused program is nothing more than digital junk.  In order not to waste time on the unnecessary software, the modern developers supply the functionality in small portions, breaking the process into short iterations. </p><br><p>  This way of creating software is used in the Continuous Integration (Continuous Integration) and Continuous Deployment (Continuous Deployment) processes, or the CI / CD chain.  In this article we will go through all the steps of setting up such a chain, using free cloud services to build it. </p><a name="habracut"></a><br><p>  We will do the following: </p><br><ol><li>  Let's write a small program in Python (not Hello World). </li><li>  Create several automated tests. </li><li>  Post the code on github. </li><li>  Configure Travis CI to run automated tests all the time. </li><li>  We will set up the Better Code Hub for constant code quality check. </li><li>  Let's turn a Python program into a web application. </li><li>  Create a Docker image for the application. </li><li>  Let's place a Docker image on Docker Hub. </li><li>  Deploy the Docker image to Heroku. </li></ol><br><p>  In this article, I aim to demonstrate to the reader the main components of the modern software development chain, as well as how these components are combined into a single whole.  The text is not accented in any programming language or development methodology.  Some components may not match those used in your technology stack.  But even in this case, I would advise to go through all the proposed steps.  Having a common understanding of how a chain works from beginning to end, it will be much easier to tune it for yourself. </p><br><p>  To be completely honest with readers, I must announce that I am one of the developers of Better Code Hub. </p><br><h2 id="shag--1-pishem-generator-modnyh-fraz">  Step number 1: we write a fashionable phrase generator </h2><br><p>  So, we need a small program that we will run through all the stages of the chain - from laptop to cloud.  For this purpose, we will write in Python a generator of fashionable CI / CD phrases. </p><br><p>  Create a new directory 'cicd-buzz', inside - another one called 'buzz', and in it - the file 'generator.py', containing the code below. </p><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random buzz = (<span class="hljs-string"><span class="hljs-string">'continuous testing'</span></span>, <span class="hljs-string"><span class="hljs-string">'continuous integration'</span></span>, <span class="hljs-string"><span class="hljs-string">'continuous deployment'</span></span>, <span class="hljs-string"><span class="hljs-string">'continuous improvement'</span></span>, <span class="hljs-string"><span class="hljs-string">'devops'</span></span>) adjectives = (<span class="hljs-string"><span class="hljs-string">'complete'</span></span>, <span class="hljs-string"><span class="hljs-string">'modern'</span></span>, <span class="hljs-string"><span class="hljs-string">'self-service'</span></span>, <span class="hljs-string"><span class="hljs-string">'integrated'</span></span>, <span class="hljs-string"><span class="hljs-string">'end-to-end'</span></span>) adverbs = (<span class="hljs-string"><span class="hljs-string">'remarkably'</span></span>, <span class="hljs-string"><span class="hljs-string">'enormously'</span></span>, <span class="hljs-string"><span class="hljs-string">'substantially'</span></span>, <span class="hljs-string"><span class="hljs-string">'significantly'</span></span>, <span class="hljs-string"><span class="hljs-string">'seriously'</span></span>) verbs = (<span class="hljs-string"><span class="hljs-string">'accelerates'</span></span>, <span class="hljs-string"><span class="hljs-string">'improves'</span></span>, <span class="hljs-string"><span class="hljs-string">'enhances'</span></span>, <span class="hljs-string"><span class="hljs-string">'revamps'</span></span>, <span class="hljs-string"><span class="hljs-string">'boosts'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l, n = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> result = random.sample(l, n) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n == <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate_buzz</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> buzz_terms = sample(buzz, <span class="hljs-number"><span class="hljs-number">2</span></span>) phrase = <span class="hljs-string"><span class="hljs-string">' '</span></span>.join([sample(adjectives), buzz_terms[<span class="hljs-number"><span class="hljs-number">0</span></span>], sample(adverbs), sample(verbs), buzz_terms[<span class="hljs-number"><span class="hljs-number">1</span></span>]]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> phrase.title() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> generate_buzz()</code> </pre> <br><p>  Also create an empty ' <strong>init</strong> .py' file in this directory.  Now the project structure should look like this: </p><br><pre> <code class="python hljs">cicd-buzz/ buzz/ __init__.py generator.py</code> </pre> <br><p>  Go to the 'buzz' directory and run the script: </p><br><pre> <code class="bash hljs">[cicd-buzz/buzz] $ python generator.py End-To-End Devops Enormously Boosts Continuous Testing</code> </pre> <br><p>  Try several times - it's fun: </p><br><pre> <code class="bash hljs">[cicd-buzz/buzz] $ python generator.py Complete Continuous Improvement Enormously Improves Devops [cicd-buzz/buzz] $ python generator.py Modern Devops Remarkably Improves Continuous Testing</code> </pre> <br><h2 id="shag--2-sozdaem-avtomatizirovannye-testy">  Step # 2: Create Automated Tests </h2><br><p>  Continuous Delivery chains are needed only when many automated tests are written that help avoid the continuous shipment of poorly performing software.  To place unit tests, create the 'tests' folder in the project root directory.  Save the following code to the 'test_generator.py' file: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> buzz <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> generator <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_sample_single_word</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> l = (<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'bar'</span></span>, <span class="hljs-string"><span class="hljs-string">'foobar'</span></span>) word = generator.sample(l) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> word <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> l <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_sample_multiple_words</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> l = (<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'bar'</span></span>, <span class="hljs-string"><span class="hljs-string">'foobar'</span></span>) words = generator.sample(l, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> len(words) == <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> words[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> l <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> words[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> l <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> words[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> words[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_generate_buzz_of_at_least_five_words</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> phrase = generator.generate_buzz() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> len(phrase.split()) &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre> <br><p>  We will run the tests using the 'pytest' framework.  To install it, you need a Python Virtual Environment ('virtualenv').  Don't worry, it's easier to say than to say.  First <a href="http://python-guide-pt-br.readthedocs.io/en/latest/dev/virtualenvs/"><code>,     virtualenv</code></a> .  Next, run the following command in the project root directory: </p><br><pre> <code class="bash hljs">[cicd-buzz] $ virtualenv venv</code> </pre> <br><p>  As a result, a new directory 'venv' will be created.  To start using this environment, run: </p><br><pre> <code class="bash hljs">[cicd-buzz] $ <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> venv/bin/activate (venv) [cicd-buzz] $</code> </pre> <br><p>  Next, create a file called 'requirements.txt' and list the dependency on pytest there: </p><br><pre> <code class="hljs">pytest==3.0.6</code> </pre> <br><p>  To load the requirements listed in the requirements.txt, issue the 'pip' command: </p><br><pre> <code class="bash hljs">(venv) [cicd-buzz] $ pip install -r requirements.txt</code> </pre> <br><p>  The project root directory should look like this: </p><br><pre> <code class="hljs">cicd-buzz/ buzz/ requirements.txt tests/ venv/</code> </pre> <br><p>  Now, using the virtual environment, we can run tests from 'test_generator.py': </p><br><pre> <code class="bash hljs">(venv) [cicd-buzz] $ python -m pytest -v tests/test_generator.py</code> </pre> <br><p>  The output should look something like this: </p><br><pre> <code class="bash hljs">========== <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> session starts ========== platform darwin -- Python 2.7.10, pytest-3.0.6, py-1.4.32, pluggy-0.4.0 -- /Users/rob/projects/workspace/cicd-buzz/venv/bin/python cachedir: .cache rootdir: /Users/rob/projects/workspace/cicd-buzz, inifile: collected 3 items tests/test_generator.py::test_sample_single_word PASSED tests/test_generator.py::test_sample_multiple_words PASSED tests/test_generator.py::test_generate_buzz_of_at_least_five_words PASSED ========== 3 passed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.02 seconds ==========</code> </pre> <br><h2 id="shag--3-razmeschaem-kod-na-github">  Step 3: Post the code on GitHub </h2><br><p>  Log in to GitHub ( <a href="https://github.com/join">register</a> if you don't have an account yet), and create a new public repository 'cicd-buzz'. </p><br><p>  In the root directory of the project, create a '.gitignore' file containing one line: </p><br><pre> <code class="hljs">venv</code> </pre> <br><p>  This is to ensure that git does not add virtualenv to the repository.  And now it is time to locally initialize Git and send the code to GitHub: </p><br><pre> <code class="bash hljs">[cicd-buzz] $ git init [cicd-buzz] $ git add * [cicd-buzz] $ git commit -m <span class="hljs-string"><span class="hljs-string">"Initial commit"</span></span> [cicd-buzz] $ git remote add origin git@github.com:&lt;YOUR_GITHUB_USERNAME&gt;/cicd-buzz.git [cicd-buzz] $ git push -u origin master</code> </pre> <br><h2 id="shag--4-dlya-vypolneniya-testov-posle-kazhdogo-kommita-podklyuchaem-travis-ci">  Step 4: to perform tests after each commit we connect Travis CI </h2><br><p>  Travis CI is a Continuous Integration cloud service.  For public GitHub repositories it is free.  To get an account on Travis CI, just visit <a href="https://travis-ci.org/">https://travis-ci.org</a> and log in using your GitHub credentials. </p><br><p>  It is very easy to enable assembly for each Push and Pull repository requests in Travis CI.  To do this, just move the switch opposite the cicd-buzz repository (click on the 'Sync account' if the repository is not already in the list): </p><br><img src="https://habrastorage.org/web/60a/317/4a5/60a3174a52304597a8951f8aa9b36977.png"><br><p>  The final step in the activation procedure for Travis CI is to add the '.travis.yml' file to the project root directory.  For our buzz generator, it should contain: </p><br><pre> <code class="hljs mel">language: <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> script: - <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> -m pytest -v</code> </pre> <br><p>  Add this file to Git, commit and send the changes to Github: </p><br><pre> <code class="bash hljs">[cicd-buzz] $ git add .travis.yml [cicd-buzz] $ git commit -m <span class="hljs-string"><span class="hljs-string">"Add Travis CI configuration"</span></span> [cicd-buzz] $ git push</code> </pre> <br><p>  Go to <a href="https://travis-ci.org/dashboard">the Travis CI toolbar</a> .  Soon Travis will notify you of the code change and will begin to build / test the code.  In the output log you can see the results of unit tests: </p><br><img src="https://habrastorage.org/web/4bc/62c/74e/4bc62c74ea6a421988ca335152d51919.png"><br><br><h2 id="shag--5-dobavlyaem-v-cepochku-better-code-hub">  Step 5: Add Better Code Hub to the chain </h2><br><p>  Now that we have a well-oiled mechanism that constantly checks the performance of the code using automated tests, I really want to focus on the functionality and forget about the quality of the code.  Better Code Hub is a cloud service that checks the quality of the code according to 10 recommendations for creating supported modern code.  Better Code Hub constantly monitors development results (literally every push on GitHub) and reports situations where the quality of the code is at risk. </p><br><p>  Better Code Hub, like Travis CI, seamlessly integrates with GitHub.  To attach it to the repository, go to <a href="https://bettercodehub.com/">https://bettercodehub.com</a> and select the login button labeled 'Free'. </p><br><p>  Once you are logged in with your GitHub credentials, a list of your GitHub repositories will open.  Find 'cicd-buzz' and click the 'Play' button.  Better Code Hub will ask whether to launch the analysis with standard settings.  Click 'Go' and wait a few seconds, after which a report should appear on the screen. </p><br><img src="https://habrastorage.org/web/b4e/6d5/16e/b4e6d516ee6741f1a651ae2b3deed575.png"><br><p>  <em>Top of the report on the Better Code Hub</em> </p><br><p>  If you want the Better Code Hub to analyze after each Push and Pull requests (like Travis CI), click on the gear icon and slide the switch: </p><br><img src="https://habrastorage.org/web/110/50a/016/11050a016c1148b7bedfb23c5ee8989c.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2 id="shag--6-prevraschaem-buzz-generator-v-prostoe-veb-prilozhenie">  Step 6: Turn the buzz generator into a simple web application </h2><br><p>  Fine!  Now we have a continuous integration chain that checks the performance and quality of the code.  Next, you need to configure the continuous deployment of the passed test code. </p><br><p>  Since we will be deploying a web application on Heroku, to teach the buzz generator to accept HTTP requests and output HTML, we will make a wrapper for it in Python Flask.  Add the file 'app.py' to the root directory of the project, containing the following code: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> signal <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flask <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> buzz <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> generator app = Flask(__name__) signal.signal(signal.SIGINT, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s, f: os._exit(<span class="hljs-number"><span class="hljs-number">0</span></span>)) @app.route(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate_buzz</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> page = <span class="hljs-string"><span class="hljs-string">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;'</span></span> page += generator.generate_buzz() page += <span class="hljs-string"><span class="hljs-string">'&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> page <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: app.run(host=<span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>, port=os.getenv(<span class="hljs-string"><span class="hljs-string">'PORT'</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># port 5000 is the default</span></span></code> </pre> <br><p>  Also add another line to 'requirements.txt': </p><br><pre> <code class="hljs">pytest==3.0.6 Flask==0.12</code> </pre> <br><p>  And install a new dependency: </p><br><pre> <code class="bash hljs">(venv) [cicd-buzz] $ pip install -r requirements.txt</code> </pre> <br><p>  Now the web application can be launched with the following command: </p><br><pre> <code class="bash hljs">[cicd-buzz] $ python app.py * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</code> </pre> <br><p>  Open <a href="http://localhost:5000/">http: // localhost: 5000</a> in your browser and enjoy the results of your work.  To have a little fun, refresh the page several times. </p><br><img src="https://habrastorage.org/web/d1b/5de/035/d1b5de035dfb4788a4a3537b383e1d31.png"><br><br><p>  Finally, don't forget to add commits and submit changes to GitHub: </p><br><pre> <code class="bash hljs">[cicd-buzz] $ git add app.py [cicd-buzz] $ git add requirements.txt [cicd-buzz] $ git commmit -m <span class="hljs-string"><span class="hljs-string">"Step 5"</span></span> [cicd-buzz] $ git push</code> </pre> <br><p>  Now you can enjoy watching the Travis CI and Better Code Hub catch these changes and check the code. </p><br><h2 id="step-7-konteyneriziruem-prilozhenie-s-pomoschyu-docker">  Step 7: Contain the application with docker </h2><br><p>  Docker helps to make an easily deployable container out of our application.  For simple Python and Flask programs, this may seem redundant, but deploying code in the form of containers provides many benefits that become apparent as the project progresses and grows. </p><br><p>  If <a href="https://docs.docker.com/engine/getstarted/step_one/">you already have a Docker installed</a> , add to the root directory of the project 'Dockerfile' with the following contents: </p><br><pre> <code class="hljs dos">FROM alpine:<span class="hljs-number"><span class="hljs-number">3</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span> RUN apk add --update python py-pip <span class="hljs-built_in"><span class="hljs-built_in">COPY</span></span> requirements.txt /src/requirements.txt RUN pip install -r /src/requirements.txt <span class="hljs-built_in"><span class="hljs-built_in">COPY</span></span> app.py /src <span class="hljs-built_in"><span class="hljs-built_in">COPY</span></span> buzz /src/buzz <span class="hljs-built_in"><span class="hljs-built_in">CMD</span></span> python /src/app.py</code> </pre> <br><p>  Following these instructions, docker will take a basic alpine image, install Python and pip, and install our web application.  The last line instructs the docker to start the web application when the container is started. </p><br><p>  Now the Docker image should be assembled and run without any problems: </p><br><pre> <code class="bash hljs">[cicd-buzz] $ docker build -t cicd-buzz . [cicd-buzz] $ docker run -p 5000:5000 --rm -it cicd-buzz</code> </pre> <br><p>  Admire the results: </p><br><img src="https://habrastorage.org/web/0f1/302/274/0f1302274f214170b08ed8e7b1dca397.png"><br><p>  <em>CI / CD buzz generator running in a Docker container</em> </p><br><p>  Again, don't forget to commit and submit changes to GitHub: </p><br><pre> <code class="bash hljs">[cicd-buzz] $ git add Dockerfile [cicd-buzz] $ git commmit -m <span class="hljs-string"><span class="hljs-string">"Step 6"</span></span> [cicd-buzz] $ git push</code> </pre> <br><h2 id="shag--8-publikaciya-na-docker-hub">  Step 8: Posting on Docker Hub </h2><br><p>  Publishing Docker images in the registry, such as Docker Hub, makes it easy to deploy containers in different environments and roll back to previous versions.  To perform this step, you will need an account at <a href="https://docker.com/">https://docker.com</a> , as well as the file 'deploy_dockerhub.sh' in the new '.travis' directory in the project root: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS if [ "$TRAVIS_BRANCH" = "master" ]; then TAG="latest" else TAG="$TRAVIS_BRANCH" fi docker build -f Dockerfile -t $TRAVIS_REPO_SLUG:$TAG . docker push $TRAVIS_REPO_SLUG</span></span></code> </pre> <br><p>  Travis CI will execute this script at the end of each assembly, thus creating its Docker image.  Note the 3 environment variables.  They can be defined in the 'cicd-buzz' settings tab of the Travis CI repository: </p><br><img src="https://habrastorage.org/web/057/fa7/cb5/057fa7cb57a74e8aaddbeeeb52bd449a.png"><br><p>  <em>Environment Variables for Docker in Travis CI</em> </p><br><p>  To have Travis CI publish an image on the Docker Hub after each commit to the GitHub repository, change the '.travis.yml' as follows: </p><br><pre> <code class="hljs mel">sudo: required services: - docker language: <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> script: - <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> -m pytest -v after_success: - sh .travis/deploy_dockerhub.sh</code> </pre> <br><p>  After creating a commit and sending these changes to GitHub (as well as waiting until Travis CI finishes its work) you will be able to launch a container with a buzz generator directly from the Docker Hub: </p><br><pre> <code class="bash hljs">[cicd-buzz] $ docker run -p5000:5000 --rm -it &lt;YOUR_DOCKER_USERNAME&gt;/cicd-buzz:latest</code> </pre> <br><h2 id="shag--9-razvertyvanie-na-heroku">  Step # 9: Deploy to Heroku </h2><br><p>  Heroku is a cloud platform for hosting small, scalable web applications.  The service offers a free tariff plan, so go to <a href="https://signup.heroku.com/">https://signup.heroku.com</a> and register, if you have not done so before. </p><br><p>  Install the <a href="https://devcenter.heroku.com/articles/heroku-cli">Heroku Toolbelt console application</a> and run the following commands in the project root directory: </p><br><pre> <code class="bash hljs">[cicd-buzz] $ heroku login [cicd-buzz] $ heroku create Creating app‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>, ‚¨¢ fathomless-inlet-53225 https://fathomless-inlet-53225.herokuapp.com/ | https://git.heroku.com/fathomless-inlet-53225.git [cicd-buzz] $ heroku plugins:install heroku-container-registry [cicd-buzz] $ heroku container:login [cicd-buzz] $ heroku container:push web [cicd-buzz] $ heroku ps:scale web=1</code> </pre> <br><p>  After that, you should be able to access the application at the URL derived by the <code>heroku create</code> command. </p><br><img src="https://habrastorage.org/web/edd/575/eff/edd575eff90b47c8bac11a176459c811.png"><br><p>  <em>CI / CD buzz generator running on Heroku</em> </p><br><p>  Notice that the <code>heroku container:push web</code> command places on Heroku the same container that we posted on the Docker Hub. </p><br><p>  To automate the process of deploying each build of the <em>master</em> branch of our project, add the file 'deploy_heroku.sh' to the '.travis' directory: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh heroku plugins:install heroku-container-registry docker login -e _ -u _ --password=$HEROKU_API_KEY registry.heroku.com heroku container:push web --app $HEROKU_APP_NAME</span></span></code> </pre> <br><p>  Also add the following line to the '.travis.yml' file: </p><br><pre> <code class="hljs bash">after_success: ‚Äî sh .travis/deploy_dockerhub.sh ‚Äî <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> ‚Äú<span class="hljs-variable"><span class="hljs-variable">$TRAVIS_BRANCH</span></span>‚Äù = ‚Äúmaster‚Äù &amp;&amp; sh .travis/deploy_heroku.sh</code> </pre> <br><p>  Finally, add two more environment variables in the Travis CI.  <em>The Heroku API</em> can be found in 'Account Settings', and the <em>heroku App name</em> is found in the output of the <code>heroku create</code> command. </p><br><img src="https://habrastorage.org/web/7ae/9d9/1c1/7ae9d91c1da446068bdc1e1181e5f127.png"><br><br><p>  Create a commit and submit the changes to GitHub.  A new Docker image after a successful build should immediately get to the Docker Hub and Heroku. </p><br><h2 id="shag--10-cicd-dlya-pobedy">  Step number 10: CI / CD to win! </h2><br><p>  Now that we have a modern development chain set up, we can begin to deliver the functionality in small portions, performing short iterations.  For example, if we decide to make the landing page more attractive, a typical workflow will look like this: </p><br><ol><li>  Start by creating a new task: <a href="https://github.com/robvanderleek/cicd-buzz/issues/1">https://github.com/robvanderleek/cicd-buzz/issues/1</a> . </li><li>  Create a feature-branch for this task: <a href="https://github.com/robvanderleek/cicd-buzz/tree/issue-1">https://github.com/robvanderleek/cicd-buzz/tree/issue-1</a> . </li><li>  <em>Here is the magic of coding</em> . </li><li>  Follow Travis CI and Better Code Hub: <a href="https://github.com/robvanderleek/cicd-buzz/commits/issue-1">https://github.com/robvanderleek/cicd-buzz/commits/issue-1</a> . </li><li>  Test your application locally by running the most recent Docker image: <code>docker run --rm -p5000:5000 -it robvanderleek/cicd-buzz:issue-1</code> .  You can share this image with other people. </li><li>  If you are satisfied with the new functionality, open the pull request.  Now your code is ready to be delivered to production via the CI / CD chain: <a href="https://github.com/robvanderleek/cicd-buzz/pull/2">https://github.com/robvanderleek/cicd-buzz/pull/2</a> . </li></ol><br><img src="https://habrastorage.org/web/da1/781/fc7/da1781fc7e9e48e3943a9c400fc9a594.png"><br><p>  <em>Buzz generator repository branch in a local Docker container</em> </p><br><p>  Happy coding and shipping to production! </p><br><p>  References: </p><br><ol><li>  Original: <a href="https://medium.com/bettercode/how-to-build-a-modern-ci-cd-pipeline-5faa01891a5b">How to build a modern CI / CD pipeline</a> <a href="https://medium.com/bettercode/how-to-build-a-modern-ci-cd-pipeline-5faa01891a5b"><br></a>  <a href="https://medium.com/bettercode/how-to-build-a-modern-ci-cd-pipeline-5faa01891a5b">using free and hosted services</a> . </li><li>  <a href="https://github.com/robvanderleek/cicd-buzz">Project repository on GitHub</a> . </li></ol></div><p>Source: <a href="https://habr.com/ru/post/329262/">https://habr.com/ru/post/329262/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329252/index.html">Golos - study in practice. First conclusions</a></li>
<li><a href="../329254/index.html">Passing type map to function</a></li>
<li><a href="../329256/index.html">Selenium under Windows: everything from the beginning</a></li>
<li><a href="../329258/index.html">Backend I / O Performance: Node vs. PHP vs. Java vs. Go</a></li>
<li><a href="../329260/index.html">And let the tests themselves and support</a></li>
<li><a href="../329264/index.html">Continuous Integration (CI) for GitHub C / C ++ projects with CMake build</a></li>
<li><a href="../329266/index.html">‚ÄúI clicked something and everything disappeared‚Äù: how does technical support in retail work</a></li>
<li><a href="../329268/index.html">Microsoft will open data center in Johannesburg and Cape Town</a></li>
<li><a href="../329270/index.html">More simple bugs [Hell language]</a></li>
<li><a href="../329272/index.html">OKR: How to set goals and fulfill them at 70%</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>