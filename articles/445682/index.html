<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PVS-Studio for Java is sent to the path. Next stop - Elasticsearch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not for the first year, the PVS-Studio team keeps a blog about checking open-source projects with the same name static code analyzer. To date, more th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PVS-Studio for Java is sent to the path. Next stop - Elasticsearch</h1><div class="post__text post__text-html js-mediator-article"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e7d/542/517/e7d5425172ebed7d6953375ceefbd8b7.png" alt="Picture 1"></div><br>  Not for the first year, the PVS-Studio team keeps a blog about checking open-source projects with the same name static code analyzer.  To date, more than 300 projects have been verified, and more than 12,000 cases have been written to the database of errors found.  Initially, the analyzer was implemented to test C and C ++ code, then C # language support appeared.  Therefore, among the proven projects, a large part (&gt; 80%) falls on C and C ++.  More recently, Java has been added to the supported languages, which means that the doors to the new world are opening in front of PVS-Studio, and it's time to supplement the database with errors from Java projects. <br><br>  Java world is huge and diverse, so the eyes diverge when choosing a project to test a new analyzer.  Ultimately, the choice fell on the Elasticsearch full-text search engine and analytics.  This is a fairly successful project, and in successful projects it is doubly or even more pleasant to find mistakes.  So, what defects did PVS-Studio for Java detect?  On the result of the test and will be discussed in the article. <br><a name="habracut"></a><br><h2>  Superficial familiarity with Elasticsearch </h2><br>  <a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a> is an open source scalable full-text search and analysis engine.  It allows you to store large amounts of data, to conduct among them a quick search and analytics (almost in real time).  As a rule, it is used as a basic mechanism / technology that provides applications with complex functions and search requirements. <br><br>  Among the major sites that use Elasticsearch are Wikimedia, StumbleUpon, Quora, Foursquare, SoundCloud, GitHub, Netflix, Amazon, IBM, Qbox. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I think with acquaintance enough. <br><br><h2>  How was it </h2><br>  There were no problems with checking.  The sequence of actions is quite simple and did not take much time: <br><br><ul><li>  I downloaded Elasticsearch from <a href="https://github.com/elastic/elasticsearch">GitHub</a> ; </li><li>  I used the Java analyzer launch <a href="https://www.viva64.com/ru/m/0044/">instruction</a> and launched the analysis; </li><li>  Received a report analyzer, analyzed it and identified interesting cases. </li></ul><br>  Now let's get to the bottom line. <br><br><h2>  Caution!  NullPointerException is possible </h2><br>  <a href="https://www.viva64.com/ru/w/v6008/">V6008</a> Null dereference of 'line'.  GoogleCloudStorageFixture.java (451) <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> PathTrie&lt;RequestHandler&gt; defaultHandlers(....) { .... handlers.insert(<span class="hljs-string"><span class="hljs-string">"POST /batch/storage/v1"</span></span>, (request) -&gt; { .... <span class="hljs-comment"><span class="hljs-comment">// Reads the body line = reader.readLine(); byte[] batchedBody = new byte[0]; if ((line != null) || (line.startsWith("--" + boundary) == false)) // &lt;= { batchedBody = line.getBytes(StandardCharsets.UTF_8); } .... }); .... }</span></span></code> </pre> <br>  The error in this code snippet is that if you could not read the string from the buffer, then the <i>startsWith</i> method in the if statement condition will throw a <i>NullPointerException</i> exception.  Most likely, this is a typo, and when writing the condition I meant the operator <i>&amp;&amp;</i> instead of <i>||</i>  . <br><br>  <a href="https://www.viva64.com/ru/w/v6008/">V6008</a> Potential null dereference of 'followIndexMetadata'.  TransportResumeFollowAction.java (171), TransportResumeFollowAction.java (170), TransportResumeFollowAction.java (194) <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ResumeFollowAction.Request request, String clusterNameAlias, IndexMetaData leaderIndexMetadata, IndexMetaData followIndexMetadata, ....)</span></span></span><span class="hljs-function"> throws IOException </span></span>{ MapperService mapperService = followIndexMetadata != null <span class="hljs-comment"><span class="hljs-comment">// &lt;= ? .... : null; validate(request, leaderIndexMetadata, followIndexMetadata, // &lt;= leaderIndexHistoryUUIDs, mapperService); .... }</span></span></code> </pre> <br>  Another warning from the <a href="https://www.viva64.com/ru/w/v6008/">V6008</a> diagnostic.  Now the gaze riveted the object <i>followIndexMetadata</i> .  The <i>start</i> method takes several input arguments, among which is our suspect.  After that, based on the verification of our object for <i>null</i> , a new object is formed that participates in the further logic of the method.  Checking for <i>null</i> tells us that <i>followIndexMetadata</i> can still come from the outside by a null object.  Well, look further. <br><br>  Next, the validation method is called with pushing through a set of arguments (again, among which is the object in question).  And if you look at the implementation of the validation method, then everything falls into place.  Our potential null object is passed as the third argument to the <i>validate</i> method, where it is unconditionally dereferenced.  As a result, a potential <i>NullPointerException.</i> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( final ResumeFollowAction.Request request, final IndexMetaData leaderIndex, final IndexMetaData followIndex, </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">// &lt;= ....) { .... Map&lt;String, String&gt; ccrIndexMetadata = followIndex.getCustomData(....); // &lt;= if (ccrIndexMetadata == null) { throw new IllegalArgumentException(....); } .... }}</span></span></span></span></span></span></code> </pre> <br>  What arguments the <i>start</i> method is actually called in is unknown.  It is quite possible that all arguments are checked somewhere before the method call, and no dereferencing of the null object threatens us.  But, you see, such implementation of the code still looks rather unreliable and deserves attention. <br><br>  <a href="https://www.viva64.com/ru/w/v6060/">V6060</a> The 'node' reference was used against it.  RestTasksAction.java (152), RestTasksAction.java (151) <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildRow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Table table, boolean fullId, boolean detailed, DiscoveryNodes discoveryNodes, TaskInfo taskInfo)</span></span></span><span class="hljs-function"> </span></span>{ .... DiscoveryNode node = discoveryNodes.get(nodeId); .... <span class="hljs-comment"><span class="hljs-comment">// Node information. Note that the node may be null because it has // left the cluster between when we got this response and now. table.addCell(fullId ? nodeId : Strings.substring(nodeId, 0, 4)); table.addCell(node == null ? "-" : node.getHostAddress()); table.addCell(node.getAddress().address().getPort()); table.addCell(node == null ? "-" : node.getName()); table.addCell(node == null ? "-" : node.getVersion().toString()); .... }</span></span></code> </pre> <br>  Here another diagnostic rule worked, and the problem is the same: <i>NullPointerException</i> .  The rule is: ‚ÄúGuys, what are you doing?  How so?  Oh, trouble!  Why do you first use an object, and then in the next line of code check it for <i>null</i> ?! ‚Äù.  So it turns out here the dereference of the zero object.  Alas, even the comment of one of the developers did not help. <br><br>  <a href="https://www.viva64.com/ru/w/v6060/">V6060</a> The 'cause' reference was used before it was verified against null.  StartupException.java (76), StartupException.java (73) <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printStackTrace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Consumer&lt;String&gt; consumer)</span></span></span><span class="hljs-function"> </span></span>{ Throwable originalCause = getCause(); Throwable cause = originalCause; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cause instanceof CreationException) { cause = getFirstGuiceCause((CreationException)cause); } String message = cause.toString(); <span class="hljs-comment"><span class="hljs-comment">// &lt;= consumer.accept(message); if (cause != null) { // &lt;= // walk to the root cause while (cause.getCause() != null) { cause = cause.getCause(); } .... } .... }</span></span></code> </pre> <br>  Here we must take into account that the <i>getCause</i> method of the <i>Throwable</i> class may return <i>null</i> .  Further, the problem discussed above is repeated, and there is no point in explaining something in detail. <br><br><h2>  Meaningless terms </h2><br>  <a href="https://www.viva64.com/ru/w/v6007/">V6007</a> Expression 's.charAt (i)! =' \ T '' is always true.  Cron.java (1223) <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findNextWhiteSpace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i, String s)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; i &lt; s.length() &amp;&amp; (s.charAt(i) != <span class="hljs-string"><span class="hljs-string">' '</span></span> || s.charAt(i) != <span class="hljs-string"><span class="hljs-string">'\t'</span></span>); i++) { <span class="hljs-comment"><span class="hljs-comment">// intentionally empty } return i; }</span></span></code> </pre> <br>  The function in question returns the index of the first space, starting at index <i>i</i> .  What's wrong?  We have a warning from the analyzer that <i>s.charAt (i)! = '\ T' is</i> always true, which means that the expression will always be true <i>(s.charAt (i)! = '' || s.charAt (i)! = '\ t')</i> .  Is it so?  I think you yourself can easily verify this by substituting any character. <br><br>  As a result, this method will always return an index equal to <i>s.length ()</i> , which is not true.  I dare to suggest that this method lies slightly above all the fault: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skipWhiteSpace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i, String s)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; i &lt; s.length() &amp;&amp; (s.charAt(i) == <span class="hljs-string"><span class="hljs-string">' '</span></span> || s.charAt(i) == <span class="hljs-string"><span class="hljs-string">'\t'</span></span>); i++) { <span class="hljs-comment"><span class="hljs-comment">// intentionally empty } return i; }</span></span></code> </pre> <br>  This method was implemented, then copied and, making minor changes, got our wrong method <i>findNextWhiteSpace</i> .  The method was corrected, corrected, but not corrected.  To correct the situation, you must use the <i>&amp;&amp;</i> operator instead of <i>||</i>  . <br><br>  <a href="https://www.viva64.com/ru/w/v6007/">V6007</a> Expression 'remaining == 0' is always false.  PemUtils.java (439) <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> byte[] generateOpenSslKey(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] password, byte[] salt, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> keyLength) { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> copied = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> remaining; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (copied &lt; keyLength) { remaining = keyLength - copied; .... copied += bytesToCopy; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (remaining == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= break; } .... } .... }</span></span></code> </pre> <br>  From the condition of the cycle <i>copied &lt;keyLength</i> it can be noted that <i>copied</i> will always be less than <i>keyLength</i> .  Hence, a comparison for equality of the variable <i>remaining</i> with 0 is meaningless and will always give a false result, and therefore the conditional exit from the loop will not be performed.  Is this code worth removing, or is it still necessary to revise the logic of behavior?  I think only developers will be able to dot the i. <br><br>  <a href="https://www.viva64.com/ru/w/v6007/">V6007</a> Expression 'healthCheckDn.indexOf (' = ')&gt; 0' is always false.  ActiveDirectorySessionFactory.java (73) <br><br><pre> <code class="cpp hljs">ActiveDirectorySessionFactory(RealmConfig config, SSLService sslService, ThreadPool threadPool) throws LDAPException { super(...., () -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) { final String healthCheckDn = ....; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (healthCheckDn.isEmpty() &amp;&amp; healthCheckDn.indexOf(<span class="hljs-string"><span class="hljs-string">'='</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> healthCheckDn; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ....; }, ....); .... }</code> </pre> <br>  Again, meaningless expression.  According to the condition that the lambda expression <i>returns the</i> string variable <i>healthCheckDn</i> , the string <i>healthCheckDn</i> must be both empty and the string containing the '=' character not in the first position.  Fuh, sort of sorted out.  And as you correctly understood, it is impossible.  We will not understand the logic of the code, leave it to the discretion of the developers. <br><br>  I gave only some erroneous examples, but in addition there were plenty of cases of the <a href="https://www.viva64.com/ru/w/v6007/">V6007</a> diagnostic <a href="https://www.viva64.com/ru/w/v6007/">triggered</a> , which need to be considered separately and draw appropriate conclusions. <br><br><h2>  The method is small, but remote </h2><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> byte </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">char64</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)x &gt; index_64.length) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> index_64[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)x]; }</code> </pre> <br>  So, we have a tiny method from several lines.  But the bugs are not asleep!  Analysis of this method gave the following result: <br><br><ol><li>  V6007 Expression '(int) x &lt;0' is always false.  BCrypt.java (429) </li><li>  V6025 Possibly index '(int) x' is out of bounds.  BCrypt.java (431) </li></ol><br>  Problem N1.  The expression <i>(int) x &lt;0 is</i> always false (Yes, yes, again <a href="https://www.viva64.com/ru/w/v6007/">V6007</a> ).  The variable <i>x</i> cannot be negative, since it is of type <i>char</i> .  The type <i>char</i> is an unsigned integer.  This cannot be called a real mistake, but, nevertheless, verification is redundant and can be removed. <br><br>  Problem N2.  Possible overrun of the array, resulting in an <i>ArrayIndexOutOfBoundsException</i> exception.  Then a question arises that lies on the surface: ‚ÄúStand, but what about the index check?‚Äù <br><br>  So, we have a fixed-size array of 128 elements: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> final byte index_64[] = { <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-number"><span class="hljs-number">56</span></span>, <span class="hljs-number"><span class="hljs-number">57</span></span>, <span class="hljs-number"><span class="hljs-number">58</span></span>, <span class="hljs-number"><span class="hljs-number">59</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">61</span></span>, <span class="hljs-number"><span class="hljs-number">62</span></span>, <span class="hljs-number"><span class="hljs-number">63</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">21</span></span>, <span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">33</span></span>, <span class="hljs-number"><span class="hljs-number">34</span></span>, <span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">36</span></span>, <span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>, <span class="hljs-number"><span class="hljs-number">39</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">41</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">43</span></span>, <span class="hljs-number"><span class="hljs-number">44</span></span>, <span class="hljs-number"><span class="hljs-number">45</span></span>, <span class="hljs-number"><span class="hljs-number">46</span></span>, <span class="hljs-number"><span class="hljs-number">47</span></span>, <span class="hljs-number"><span class="hljs-number">48</span></span>, <span class="hljs-number"><span class="hljs-number">49</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">51</span></span>, <span class="hljs-number"><span class="hljs-number">52</span></span>, <span class="hljs-number"><span class="hljs-number">53</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span> };</code> </pre> <br>  When the variable <i>x</i> enters the input of the <i>char64</i> method, a check is made for the validity of the index.  Where is the gap?  Why is it still possible to exit the array? <br><br>  Check <i>(int) x&gt; index_64.length is</i> not entirely correct.  If the input method <i>char64</i> comes <i>x</i> with a value of 128, then the check will not protect against <i>ArrayIndexOutOfBoundsException</i> .  Perhaps this never happens in reality.  However, the check is written incorrectly, and the ‚Äúgreater‚Äù (&gt;) operator must be replaced with ‚Äúgreater than or equal to‚Äù (&gt; =). <br><br><h2>  Comparisons that tried </h2><br>  <a href="https://www.viva64.com/ru/w/v6013/">V6013</a> Numbers 'displaySize' and 'that.displaySize' are compared by reference.  Possibly an equality comparison was intended.  ColumnInfo.java (122) <br><br><pre> <code class="cpp hljs">.... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> final String table; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> final String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> final String esType; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> final Integer displaySize; .... @<span class="hljs-function"><span class="hljs-function">Override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == o) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o == null || getClass() != o.getClass()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } ColumnInfo that = (ColumnInfo) o; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> displaySize == that.displaySize &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= Objects.equals(table, that.table) &amp;&amp; Objects.equals(name, that.name) &amp;&amp; Objects.equals(esType, that.esType); }</span></span></code> </pre> <br>  The incorrectness here is that the <i>displaySize</i> objects of the <i>Integer</i> type are compared through the <i>==</i> operator, that is, they are compared by reference.  It is quite possible that the <i>ColumnInfo</i> objects will be compared, whose <i>displaySize</i> fields have different links, but the same content.  And in this case, the comparison will give us a negative result, while we expected the truth. <br><br>  I would venture to suggest that such a comparison could be the result of unsuccessful refactoring, and initially the <i>displaySize</i> field was of type <i>int</i> . <br><br>  <a href="https://www.viva64.com/ru/w/v6058/">V6058</a> The 'equals' function types of incompatible types: Integer, TimeValue.  DatafeedUpdate.java (375) <br><br><pre> <code class="cpp hljs">.... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> final TimeValue queryDelay; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> final TimeValue frequency; .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> final Integer scrollSize; .... <span class="hljs-function"><span class="hljs-function">boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isNoop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DatafeedConfig datafeed)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (frequency == null || Objects.equals(frequency, datafeed.getFrequency())) &amp;&amp; (queryDelay == null || Objects.equals(queryDelay, datafeed.getQueryDelay())) &amp;&amp; (scrollSize == null || Objects.equals(scrollSize, datafeed.getQueryDelay())) <span class="hljs-comment"><span class="hljs-comment">// &lt;= &amp;&amp; ....) }</span></span></code> </pre> <br>  Again, incorrect comparison of objects.  Now compare objects whose types are incompatible ( <i>Integer</i> and <i>TimeValue</i> ).  The result of this comparison is obvious, and it is always false.  It can be seen that class fields are compared in the same type with each other, only the field names need to be changed.  So, the developer decided to speed up the process of writing code with copy-paste, but by doing so he rewarded himself with a bug.  A getter for the <i>scrollSize</i> field is implemented in the <i>class</i> , so to correct the error, the correct solution would be to use the appropriate method: <i>datafeed .getScrollSize ()</i> . <br><br>  Consider a couple of examples of errors without any explanation.  The problem is already obvious. <br><br>  <a href="https://www.viva64.com/ru/w/v6001/">V6001</a> There are identical sub-expressions of the operator.  TermVectorsResponse.java (152) <br><br><pre> <code class="cpp hljs">@<span class="hljs-function"><span class="hljs-function">Override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object obj)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> index.equals(other.index) &amp;&amp; type.equals(other.type) &amp;&amp; Objects.equals(id, other.id) &amp;&amp; docVersion == other.docVersion &amp;&amp; found == other.found &amp;&amp; tookInMillis == tookInMillis <span class="hljs-comment"><span class="hljs-comment">// &lt;= &amp;&amp; Objects.equals(termVectorList, other.termVectorList); }</span></span></code> </pre> <br>  <a href="https://www.viva64.com/ru/w/v6009/">V6009</a> Function 'equals' receives an odd argument.  An object 'shardId.getIndexName ()' is used.  SnapshotShardFailure.java (208) <br><br><pre> <code class="cpp hljs">@<span class="hljs-function"><span class="hljs-function">Override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object o)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> shardId.id() == that.shardId.id() &amp;&amp; shardId.getIndexName().equals(shardId.getIndexName()) &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= Objects.equals(reason, that.reason) &amp;&amp; Objects.equals(nodeId, that.nodeId) &amp;&amp; status.getStatus() == that.status.getStatus(); }</span></span></code> </pre> <br><h2>  miscellanea </h2><br>  <a href="https://www.viva64.com/ru/w/v6006/">V6006</a> The object was not used.  The 'throw' keyword could be missing.  JdbcConnection.java (88) <br><br><pre> <code class="cpp hljs">@<span class="hljs-function"><span class="hljs-function">Override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAutoCommit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(boolean autoCommit)</span></span></span><span class="hljs-function"> throws SQLException </span></span>{ checkOpen(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!autoCommit) { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SQLFeatureNotSupportedException(....); } }</code> </pre> <br>  The bug is obvious and does not require clarification.  The developer created an exception, but does not forward it any further.  Such an anonymous exception will be successfully created, and also successfully and, most importantly, destroyed without a trace.  The reason is the absence of a <i>throw</i> statement. <br><br>  <a href="https://www.viva64.com/ru/w/v6003/">V6003</a> The use of if (A) {....} else if (A) {....} pattern was detected.  There is a possibility of logical error presence.  MockScriptEngine.java (94), MockScriptEngine.java (105) <br><br><pre> <code class="cpp hljs">@Override <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (context.instanceClazz.equals(FieldScript.class)) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (context.instanceClazz.equals(FieldScript.class)) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(context.instanceClazz.equals(TermsSetQueryScript.class)) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (context.instanceClazz.equals(NumberSortScript.class)) .... }</code> </pre> <br>  In the construction of a multiple <i>if-else,</i> one of the conditions is repeated twice, so the situation requires a competent review of the code. <br><br>  <a href="https://www.viva64.com/ru/w/v6039/">V6039</a> There are two 'if' statements with identical conditional expressions.  The first 'if' statement contains method return.  This means that the statement is senseless.  SearchAfterBuilder.java (94), SearchAfterBuilder.java (93) <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SearchAfterBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSortValues</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object[] values)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; values.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (values[i] == null) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (values[i] instanceof String) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (values[i] instanceof Text) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (values[i] instanceof Long) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (values[i] instanceof Integer) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (values[i] instanceof Short) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (values[i] instanceof Byte) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (values[i] instanceof Double) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (values[i] instanceof Float) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (values[i] instanceof Boolean) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= if (values[i] instanceof Boolean) continue; // &lt;= throw new IllegalArgumentException(....); } .... }</span></span></code> </pre> <br>  The same condition is used twice in a row.  Is the second condition superfluous, or is it necessary to use another type instead of <i>Boolean</i> ? <br><br>  <a href="https://www.viva64.com/ru/w/v6009/">V6009</a> Function 'substring' receives an odd arguments.  The 'queryStringIndex + 1' argument should not be greater than 'queryStringLength'.  LoggingAuditTrail.java (660) <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">LogEntryBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">withRestUriAndMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RestRequest request)</span></span></span><span class="hljs-function"> </span></span>{ final <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> queryStringIndex = request.uri().indexOf(<span class="hljs-string"><span class="hljs-string">'?'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> queryStringLength = request.uri().indexOf(<span class="hljs-string"><span class="hljs-string">'#'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (queryStringLength &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { queryStringLength = request.uri().length(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (queryStringIndex &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { logEntry.with(....); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { logEntry.with(....); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (queryStringIndex &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) { logEntry.with(...., request.uri().substring(queryStringIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-comment"><span class="hljs-comment">// &lt;= queryStringLength)); // &lt;= } .... }</span></span></code> </pre> <br>  Immediately consider an error scenario that can throw a <i>StringIndexOutOfBoundsException</i> .  An exception will occur when <i>request.uri ()</i> returns a string that contains the character '#' earlier than '?'.  In such a case, there are no checks in the method, and if this does happen, then trouble cannot be avoided.  Perhaps this will never happen because of the various checks of the <i>request</i> object outside the method, but in my opinion, the idea is not the best. <br><br><h2>  Conclusion </h2><br>  Over the years, PVS-Studio has helped to find defects in the code of commercial and free open-source projects.  More recently, Java has been added to support the languages ‚Äã‚Äãbeing analyzed.  And one of the first tests for our newcomer was the actively developing Elasticsearch.  We hope that this check will be useful for the project and interesting for readers. <br><br>  For PVS-Studio for Java to quickly adapt to a new world, new tests, new users, active feedback and customers are needed :).  So, I suggest, without delay, <a href="https://www.viva64.com/ru/pvs-studio-download/">download</a> and test our analyzer on your working draft! <br><br><p> <a href="https://habr.com/en/company/pvs-studio/blog/445674/"><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a> </p><br><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Maxim Stefanov.  <a href="https://habr.com/en/company/pvs-studio/blog/445674/">PVS-Studio for Java hits the road.</a>  <a href="https://habr.com/en/company/pvs-studio/blog/445674/">Next stop is Elasticsearch</a> </div><p>Source: <a href="https://habr.com/ru/post/445682/">https://habr.com/ru/post/445682/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445668/index.html">Neoquest 2019: ‚ÄúConnection to Heaven‚Äù</a></li>
<li><a href="../445670/index.html">Consequences of rewriting Firefox components on Rust</a></li>
<li><a href="../445672/index.html">Muon catalysis from the point of view of quantum chemistry. Part II: electronic vs. muon chemical bond</a></li>
<li><a href="../445676/index.html">New in git 3: closures</a></li>
<li><a href="../445678/index.html">4. Check Point Getting Started R80.20. Installation and Initialization</a></li>
<li><a href="../445684/index.html">Monoblock vs. modular UPS</a></li>
<li><a href="../445686/index.html">Developing an application for an old PDA (Cybiko Xtreme) in 2019</a></li>
<li><a href="../445692/index.html">An overview of the capabilities of PlayCanvas for creating Web VR applications</a></li>
<li><a href="../445696/index.html">How are robots created that can pass in the same place as we</a></li>
<li><a href="../445698/index.html">NanoCAD licensing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>