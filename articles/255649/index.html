<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Best approaches to moving a MATLAB code to a fixed point</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When converting a project from a floating point to a fixed point, engineers must determine the optimal data types at a fixed point. These data types m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Best approaches to moving a MATLAB code to a fixed point</h1><div class="post__text post__text-html js-mediator-article">  When converting a project from a floating point to a fixed point, engineers must determine the optimal data types at a fixed point.  These data types must meet the constraints of embedded hardware, while meeting the system requirements for computational accuracy.  Fixed-Point Designer helps you develop algorithms at a fixed point and convert algorithms from floating point to fixed point, automatically suggesting data types and arithmetic attributes at a fixed point.  At the same time, it is possible to compare simulation results at a fixed point up to a bit with the reference results at a floating point. <br><br>  This article outlines best practices for preparing a MATLAB code for conversion, directly converting a MATLAB code to a fixed point, and optimizing algorithms for efficiency and performance.  If you develop algorithms at a fixed point in MATLAB for later manual code writing or convert to a fixed point for automatic code generation, then the described techniques will help you turn your general-purpose MATLAB code into efficient code at a fixed point. <br><br>  <b>Preparing the code for transfer to a fixed point</b> <br>  There are three steps to take to ensure a smooth conversion process: <br><ol><li>  Separate the main algorithm from the rest of the code. </li><li>  Prepare code for instrumentation and acceleration. </li><li>  Check the functions used for fixed point support. </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  <b>Separation of the main algorithm from the rest of the MATLAB code</b> <br>  Usually the algorithm is accompanied by a code that prepares the input data and a code that creates graphs for verifying the results.  Since only the core of the algorithm needs to be converted to a fixed point, it will be more efficient to structure the code so that a separate test file creates inputs, calls the main algorithm and draws graphs of the results.  In this case, the main algorithm will also be in a separate file or files (Table 1). <br><br><table><tbody><tr><th>  Original code </th><th>  Modified code </th></tr><tr><td><pre><code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%   x = randn(100,1); %  y = zeros(size(x)); y(1) = x(1); for n=2:length(x) y(n) = y(n-1) + x(n); end %   yExpected = cumsum(x); plot(y-yExpected) title('')</span></span></code> </pre> </td><td>  Test file <br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%   x = randn(100,1); %  y = cumulative_sum(x); %   yExpected = cumsum(x); plot(y-yExpected) title('')</span></span></code> </pre> <br>  File with the algorithm. <br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cumulative_sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zeros</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(x)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function">=2:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n-1)</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br></td></tr></tbody></table><br>  Table 1. Code before and after the separation of the main algorithm from the test strapping. <br><br>  <b>Preparation of algorithmic code for instrumentation and acceleration</b> <br>  Instrumentation and acceleration simplify the conversion process.  Fixed-Point Designer is used to instrument code and record the minimum and maximum values ‚Äã‚Äãof all named and intermediate variables.  This tool can use recorded values ‚Äã‚Äãto suggest data types for use in fixed point code. <br><br>  Using Fixed-Point Designer, you can also speed up algorithms at a fixed point by creating a MEX file, and speed up the simulations required to verify the implementation at a fixed point relative to the original version. <br><br>  Instrumentation and acceleration rely on code generation technology, so before using them, you need to prepare the algorithm for generating code - even if you do not plan to use MATLAB Coder or HDL Coder to generate C code or HDL code. <br><br>  First, you need to define functions or constructions in your MATLAB code that are not supported for generating code (see <a href="http://www.mathworks.com/help/fixedpoint/language-and-functions-supported-for-code-acceleration.html">Language Support</a> for a list of supported functions and objects). <br><br>  There are two ways to automate this step: <br><br><ul><li>  Add directive <pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%#codegen</span></span></code> </pre>  at the beginning of the MATLAB file containing the core of your algorithm.  This directive tells the <a href="http://www.mathworks.com/help/fixedpoint/ug/using-the-matlab-code-analyzer-to-check-code-interactively-at-design-time.html">code analyzer</a> to mark functions and constructions that are not contained in a subset of the MATLAB language that is supported for generating code. </li><li>  Use the <a href="http://www.mathworks.com/help/fixedpoint/ug/check-code-using-the-code-generation-readiness-tool.html">code readiness checker</a> to create a report that detects function calls and data types that are not supported for code generation. </li></ul><br><br>  After preparing the algorithm for generating code, you can use the Fixed-Point Designer to instruct and speed up the code.  Use <br><pre> <code class="matlab hljs">buildInstrumentedMex</code> </pre>  to enable instrumentation to record the minimum and maximum values ‚Äã‚Äãof all the named and intermediate variables.  Also use <br><pre> <code class="matlab hljs">showInstrumentationResults</code> </pre>  to view a report on the generation of the code with the proposed data types at a fixed point.  Run <br><pre> <code class="matlab hljs">fiaccel</code> </pre>  to translate your MATLAB algorithm to a MEX file and speed up simulations at a fixed point. <br><br>  <b>Checking the support of a fixed point functions used in the algorithmic code</b> <br><br>  If you identify a function that is not supported for generating code, you have three options: <br><br><ol><li>  Replace the function with an equivalent function at a fixed point. </li><li>  Write your own equivalent function. </li><li>  Isolate an unsupported function using type casting to double on the input of the function, and type converting to a fixed point on the output. </li></ol><br>  Then you can continue converting the code to a fixed point, and return to the unsupported function when you have a suitable replacement (Table 2). <br><br><table><tbody><tr><th>  Original code </th><th>  Modified code </th></tr><tr><td><pre> <code class="matlab hljs">y = <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-built_in"><span class="hljs-built_in">exp</span></span>(x);</code> </pre><br></td><td><pre> <code class="matlab hljs">y = <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-built_in"><span class="hljs-built_in">exp</span></span>(double(x));</code> </pre><br></td></tr></tbody></table>  Table 2. Code before and after isolation of an operation in a floating point using a type conversion (reverse type conversion to a fixed point at the output is not shown). <br><br>  <b>Managing data types and limiting the growth of bit depth</b> <br>  In a fixed-point implementation, variables at a fixed point must remain in arithmetic with a limited width and must not arbitrarily turn into a floating point.  It is also important to prevent the <a href="http://www.mathworks.com/help/fixedpoint/gs/fixed-point-arithmetic_bt25flf-1.html">growth of digit capacity</a> . <br><br>  For example, consider the following code: <br><pre> <code class="matlab hljs">y = y + x(n)</code> </pre> <br><br>  This expression overwrites y with the value <pre> <code class="matlab hljs"> y + x(n)</code> </pre>  When you use data types at a fixed point in the code (for y and x), the data type y can change after overwriting, potentially leading to an increase in bit depth. <br><br>  Use the syntax to preserve the data type y. <pre> <code class="matlab hljs">(:) =</code> </pre>  (Table 3).  This syntax, known as index assignment, causes MATLAB to preserve the existing data type and the size of the array of a rewritable variable.  Expression <pre> <code class="matlab hljs">y(:) = y + x(n)</code> </pre>  will lead the expression to the right to the original data type y and prevent the growth of bit depth. <br><br><table><tbody><tr><th>  Original code </th><th>  Modified code </th></tr><tr><td><pre> <code class="matlab hljs">y = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> n=<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>(x) y = y + x(n); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br></td><td><pre> <code class="matlab hljs">y = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> n=<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>(x) y(:) = y + x(n); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br></td></tr></tbody></table>  Table 3. Code before and after using index assignment to prevent the growth of digit capacity. <br><br>  <b>Creating a table with types to separate data type definitions and algorithmic code</b> <br>  Separating data type definitions and algorithmic code simplifies the comparison of implementations at a fixed point and the transfer of the algorithm to other target equipment. <br><br>  To apply this best practice, do the following: <br><ol><li>  Use <br><pre> <code class="matlab hljs">cast(x,<span class="hljs-string"><span class="hljs-string">'like'</span></span>,y)</code> </pre>  or <br><pre> <code class="matlab hljs"><span class="hljs-built_in"><span class="hljs-built_in">zeros</span></span>(m,n,<span class="hljs-string"><span class="hljs-string">'like'</span></span>,y)</code> </pre>  to cast the variable type to the desired data type when first defining the variable. </li><li>  Create a table of type definitions, starting with the original data types used in the code ‚Äî usually a double-precision floating point ‚Äî the default data type in MATLAB (Table 4a). </li><li>  Before converting to a fixed point, add the single data type to the type table to look for inconsistencies and other problems (Table 4b). </li><li>  Verify the binding by running the code associated with each table with different data types and comparing the results. </li></ol><br><table><tbody><tr><th>  Original code </th><th>  Modified code </th></tr><tr><td><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%  n = 128; y = zeros(size(x));</span></span></code> </pre><br></td><td><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%  T = mytypes('double'); n = cast(128,'like',Tn); y = zeros(size(x),'like',Ty); %   function T = mytypes(dt) switch(dt) case 'double' Tn = double([]); Ty = double([]); end end</span></span></code> </pre><br></td></tr></tbody></table>  Table 4a.  The code before and after creating the data type table to separate the algorithmic code from the type definitions. <br><br><table><tbody><tr><th>  Original code </th><th>  Modified code </th></tr><tr><td><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%   function T = mytypes(dt) switch(dt) case 'double' Tn = double([]); Ty = double([]); end end</span></span></code> </pre><br></td><td><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%   function T = mytypes(dt) switch(dt) case 'double' Tn = double([]); Ty = double([]); case 'single' Tn = single([]); Ty = single([]); end end</span></span></code> </pre><br></td></tr></tbody></table>  Table 4b.  Code before and after adding a single precision data type to the type table. <br><br>  <b>Adding data types at a fixed point in the type table</b> <br>  After creating a table with data type definitions, you can add data types at a fixed point based on your conversion goals to a fixed point.  For example, if you plan to implement an algorithm in C, the word size of data types at a fixed point will be limited to multiples of 16. On the other hand, if you plan to implement in HDL, the word size is not limited. <br><br>  To get a set of suggested data types for your code, use the commands Fixed-Point Designer. <br><pre> <code class="matlab hljs">buildInstrumentedMex</code> </pre>  and <br><pre> <code class="matlab hljs">showInstrumentationResults</code> </pre>  (Table 5).  You will need a set of test vectors that uses the full range of types ‚Äî because the types proposed by Fixed-Point Designer are as good as the test effects.  A long simulation with a wide range of expected input data will result in the best data types offered.  Select the initial data set at a fixed point from those proposed in the code generation report (Figure 1). <br><br><img src="https://habrastorage.org/files/47d/178/aae/47d178aaefcd40b88ba6c880d697f8c9.jpg"><br>  Figure 1. The code generation report created by showInstrumentationResults with the proposed data types for variables in the filtering algorithm. <br><br>  Then you can customize the proposed types if necessary (Tables 5 and 6). <br><table><tbody><tr><th>  Algorithm Code </th><th>  Test file </th></tr><tr><td><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[y,z]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myfilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b,x,z)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zeros</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(x)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function">=1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:)</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[x(n); z(1:end-1)]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br></td><td><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%   b = fir1(11,0.25); t = linspace(0,10*pi,256)'; x = sin((pi/16)*t.^2); %    z = zeros(size(b')); %  buildInstrumentedMex myfilter ... -args {b,x,z} -histogram %  [y,z] = myfilter_mex(b,x,z); %  showInstrumentationResults myfilter_mex ... -defaultDT numerictype(1,16) -proposeFL</span></span></code> </pre><br></td></tr></tbody></table>  Table 5. A filtering algorithm and a test script for instrumenting and executing code and displaying the proposed data types at a fixed point for variables. <br><br><table><tbody><tr><th>  Algorithm Code </th><th>  Test file </th><th>  Type table </th></tr><tr><td><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[y,z]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myfilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b,x,z,T)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zeros</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(x)</span></span></span><span class="hljs-function">,'</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">like</span></span></span><span class="hljs-function">',</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ty</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function">=1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:)</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[x(n); z(1:end-1)]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br></td><td><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%   b = fir1(11,0.25); t = linspace(0,10*pi,256)'; x = sin((pi/16)*t.^2); %    %    T = mytypes('fixed16'); b = cast(b,'like',Tb); x = cast(x,'like',Tx); z = zeros(size(b'),'like',Tx); %  [y,z] = myfilter(b,x,z,T);</span></span></code> </pre><br></td><td><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mytypes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dt</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span><span class="hljs-function">' </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tb</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([])</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tx</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([])</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ty</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([])</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fixed16</span></span></span><span class="hljs-function">' </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tb</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([],true,16,15)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tx</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([],true,16,15)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ty</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([],true,16,14)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br></td></tr></tbody></table>  Table 6. Test script and filtering algorithm from Table 4 with data types at a fixed point. <br><br>  Run your algorithm with new data types at a fixed point and compare the output with the results of the reference algorithm at the floating point. <br><br>  <b>Data type optimization</b> <br>  Whether you chose your own types at a fixed point or used the proposed Fixed-Point Designer, always look for opportunities to optimize word sizes, fractional sizes, signality, and perhaps even <a href="http://www.mathworks.com/help/fixedpoint/ref/fimath.html">fimath</a> modes.  This can be done using scaled doubles by examining a histogram of variable values ‚Äã‚Äãor by testing various types of data from your type table. <br><br>  <b>Use scaled doubles to identify potential overflows</b> <br>  <a href="http://www.mathworks.com/help/fixedpoint/ug/fixed-point-numbers_bt3p32j-1.html">Scaled doubles</a> are hybrids of numbers in a floating point and a fixed point.  Fixed-Point Designer stores scaled doubles in the form of double precision numbers, but retains information about the word width, sign and word length.  To use scaled doubles, you need to set the data type overwriting property (DTO) (Table 7). <br><br><table><tbody><tr><th>  DTO installation </th><th>  Example </th></tr><tr><td>  DTO is installed locally using <pre> <code class="matlab hljs">numerictype</code> </pre>  'DataType' property </td><td><pre> <code class="matlab hljs">&gt;&gt; Ta = fi([], <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-string"><span class="hljs-string">'DataType'</span></span>, <span class="hljs-string"><span class="hljs-string">'ScaledDouble'</span></span>); &gt;&gt; a = cast(<span class="hljs-built_in"><span class="hljs-built_in">pi</span></span>, <span class="hljs-string"><span class="hljs-string">'like'</span></span>, Ta) a = <span class="hljs-number"><span class="hljs-number">3.1416</span></span> DataTypeMode: Scaled double: binary point scaling Signedness: Signed WordLength: <span class="hljs-number"><span class="hljs-number">16</span></span> FractionLength: <span class="hljs-number"><span class="hljs-number">13</span></span></code> </pre> </td></tr><tr><td>  DTO is installed globally using <pre> <code class="matlab hljs">fipref</code> </pre>  'DataTypeOverride' property </td><td><pre> <code class="matlab hljs">&gt;&gt; fipref(<span class="hljs-string"><span class="hljs-string">'DataTypeOverride'</span></span>, <span class="hljs-string"><span class="hljs-string">'ScaledDoubles'</span></span>); &gt;&gt; Ta = fi([], <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>); &gt;&gt; a = cast(<span class="hljs-built_in"><span class="hljs-built_in">pi</span></span>, <span class="hljs-string"><span class="hljs-string">'like'</span></span>, Ta) a = <span class="hljs-number"><span class="hljs-number">3.1416</span></span> DataTypeMode: Scaled double: binary point scaling Signedness: Signed WordLength: <span class="hljs-number"><span class="hljs-number">16</span></span> FractionLength: <span class="hljs-number"><span class="hljs-number">13</span></span></code> </pre> </td></tr></tbody></table>  Table 7. Methods for setting the data type rewriting property locally and globally. <br><br>  Remember to reset the global DTO if it is no longer needed with the command <br><pre> <code class="matlab hljs">reset(fipref)</code> </pre> <br><br>  Use buildInstrumentedMex to run your code and showInstrumentationResults to view the results.  In the code generation report, the values ‚Äã‚Äãthat would overflow are highlighted in red (Figure 2). <br><br><img src="https://habrastorage.org/files/497/a4c/d5c/497a4cd5c59944558f4c82b84716859b.jpg"><br>  Figure 2. Code generation report showing overflows using Scaled Doubles type (left) and histogram icon (right). <br><br>  <b>Checking the distribution of variable values</b> <br>  You can use the histogram to identify data types with values ‚Äã‚Äãthat are within the allowable range, out of range or below resolution (accuracy).  By clicking on the histogram icon, you can run the <a href="http://www.mathworks.com/help/fixedpoint/ref/numerictypescope.html">NumericTypeScope</a> and see the distribution of the values ‚Äã‚Äãobserved during the simulation for the selected variable (Figure 3). <br><br><img src="https://habrastorage.org/files/333/6ad/61a/3336ad61aae14d26ae499d6cd3d8ad8b.jpg"><br>  Figure 3. A histogram showing the distribution of values ‚Äã‚Äãof a variable that overflows (‚ÄúOutside range‚Äù), shown in red. <br><br>  <b>Testing various data types from a type table</b> <br>  You can add your own variations of data types at a fixed point in the type table (Table 8). <br><br><table><tbody><tr><th>  Algorithm Code </th><th>  Test file </th><th>  Type table </th></tr><tr><td><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[y,z]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myfilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b,x,z,T)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zeros</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(x)</span></span></span><span class="hljs-function">,'</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">like</span></span></span><span class="hljs-function">',</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ty</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function">=1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:)</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[x(n); z(1:end-1)]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre> <br></td><td><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mytest</span></span></span><span class="hljs-function"> %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fir1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(11,0.25)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">linspace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0,10*pi,256)</span></span></span><span class="hljs-function">'; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((pi/16)</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t</span></span></span><span class="hljs-function">.^2); %    %  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entrypoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('double',b,x)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y8</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entrypoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('fixed8',b,x)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y16</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entrypoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('fixed16',b,x)</span></span></span><span class="hljs-function">; %  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subplot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(3,1,1)</span></span></span><span class="hljs-function">;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t,x,'c',t,y0,'k')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">legend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('',' ')</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">title</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(' ')</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subplot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(3,2,3)</span></span></span><span class="hljs-function">;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t,y8,'k')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">title</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('8- . : ')</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subplot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(3,2,4)</span></span></span><span class="hljs-function">;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t,y0-double(y8)</span></span></span><span class="hljs-function">,'</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function">'); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">title</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('8- . : ')</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subplot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(3,2,5)</span></span></span><span class="hljs-function">;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t,y16,'k')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">title</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('16- . : ')</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlabel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(' ()</span></span></span><span class="hljs-function">') </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subplot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(3,2,6)</span></span></span><span class="hljs-function">;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t,y0-double(y16)</span></span></span><span class="hljs-function">,'</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function">'); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">title</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('16- . : ')</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlabel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(' ()</span></span></span><span class="hljs-function">') </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[y,z]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entrypoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt,b,x)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mytypes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b,'like',Tb)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x,'like',Tx)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zeros</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(b')</span></span></span><span class="hljs-function">,'</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">like</span></span></span><span class="hljs-function">',</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tx</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[y,z]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myfilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b,x,z,T)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre> <br></td><td><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mytypes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dt</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span><span class="hljs-function">' </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tb</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([])</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tx</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([])</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ty</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([])</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fixed8</span></span></span><span class="hljs-function">' </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tb</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([],true,8,7)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tx</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([],true,8,7)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ty</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([],true,8,6)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fixed16</span></span></span><span class="hljs-function">' </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tb</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([],true,16,15)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tx</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([],true,16,15)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ty</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([],true,16,14)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre></td></tr></tbody></table>  Table 8. Test script to study the effects of using different types of data at a fixed point from the type table for the filtering function. <br><br>  Comparison of the results of different iterations to verify the accuracy of the algorithm after each change (Figure 4). <br><br><img src="https://habrastorage.org/files/88b/a47/171/88ba4717195c4da39e0131d07aa68084.png"><br>  Figure 4. Graphs of the test script results from Table 8, showing the output and error after converting to 8-bit and 16-bit data types at a fixed point. <br><br>  <b>Algorithm optimization</b> <br><br>  There are three most common ways to optimize your algorithm to improve performance and generate more efficient C code. <br>  You can: <br><ul><li>  Use fimath properties to improve the efficiency of the generated code. </li><li>  Replace built-in functions with more efficient implementations at a fixed point. </li><li>  Implement division operations using other methods </li></ul><br><br>  <b>Using fimath properties to improve the efficiency of generated code</b> <br><br>  When using the fimath default settings, additional code can be generated to implement saturation during overflow, rounding, and arithmetic with complete precision (Table 9a). <br><br><table><tbody><tr><th>  MATLAB code </th><th>  Generated C code </th></tr><tr><td><pre> <code class="matlab hljs"> : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">adder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a,b)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function">  ,    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fimath</span></span></span><span class="hljs-function">  : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ta</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([],1,16,0)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tb</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([],1,16,0)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0,'like',Ta)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0,'like',Tb)</span></span></span><span class="hljs-function">;</span></span></code> </pre> <br></td><td><pre> <code class="matlab hljs">int adder(short a, short b) { int y; int i0; int i1; int i2; int i3; i0 = a; i1 = b; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((i0 &amp; <span class="hljs-number"><span class="hljs-number">65536</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { i2 = i0 | <span class="hljs-number"><span class="hljs-number">-65536</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { i2 = i0 &amp; <span class="hljs-number"><span class="hljs-number">65535</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((i1 &amp; <span class="hljs-number"><span class="hljs-number">65536</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { i3 = i1 | <span class="hljs-number"><span class="hljs-number">-65536</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { i3 = i1 &amp; <span class="hljs-number"><span class="hljs-number">65535</span></span>; } i0 = i2 + i3; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((i0 &amp; <span class="hljs-number"><span class="hljs-number">65536</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { y = i0 | <span class="hljs-number"><span class="hljs-number">-65536</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { y = i0 &amp; <span class="hljs-number"><span class="hljs-number">65535</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> y; }</code> </pre> <br></td></tr></tbody></table>  Table 9a.  The original MATLAB code and C code generated with fimath default settings. <br><br>  To make the generated code more efficient, you need to select such fixed-point arithmetic settings that are appropriate for your processor types.  Use the fimath properties to describe arithmetic, rounding methods, and overflow actions to define rules for performing arithmetic operations on your fi objects (Table 9b). <br><br><table><tbody><tr><th>  MATLAB code </th><th>  Generated C code </th></tr><tr><td><pre> <code class="matlab hljs"> : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">adder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a,b)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function">  ,    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fimath</span></span></span><span class="hljs-function">  : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ta</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([],1,16,0)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tb</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([],1,16,0)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0,'like',Ta)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0,'like',Tb)</span></span></span><span class="hljs-function">;</span></span></code> </pre> <br></td><td><pre> <code class="matlab hljs">int adder(short a, short b) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; }</code> </pre> <br></td></tr></tbody></table>  Table 9b.  The original MATLAB code and C code generated with fimath settings appropriate to the processor types. <br><br>  <b>Replacing built-in functions with fixed point implementations</b> <br>  Some MATLAB functions can be replaced to achieve a more efficient implementation at a fixed point.  For example, you can replace the built-in function with an interpolation table or a CORDIC implementation, which only requires iterative shift and sum operations. <br><br>  <b>The implementation of division operations in other ways</b> <br>  Division operations are often not fully supported by the hardware, and can lead to slow computations.  When your algorithm requires a division operation, consider replacing it with a faster alternative.  If the denominator is a power of two, use a bit shift;  for example, use bitsra (x, 3) instead of x / 8.  If the denominator is a constant, multiply by the reciprocal;  for example, use x * 0.2 instead of x / 5. <br><br>  <b>What's next?</b> <br>  After converting your code in a floating point to a fixed point using the best approaches described using Fixed-Point Designer, take the time to thoroughly test the implementation at a fixed point using realistic test inputs and compare the simulation results with bit accuracy to your floating point reference . </div><p>Source: <a href="https://habr.com/ru/post/255649/">https://habr.com/ru/post/255649/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255633/index.html">Nakapcha Mail.Ru - captcha, which is not shown</a></li>
<li><a href="../255637/index.html">Is there a USB in this MK?</a></li>
<li><a href="../255643/index.html">Online streaming. Monitoring: from server to application. System Center Operations Manager 2012 R2</a></li>
<li><a href="../255645/index.html">Again about AUTO_INCREMENT</a></li>
<li><a href="../255647/index.html">Levitron on Arduino</a></li>
<li><a href="../255651/index.html">Create a beautiful date / time / data picker in android</a></li>
<li><a href="../255653/index.html">Developing a cross-platform application using the Ionic Framework</a></li>
<li><a href="../255655/index.html">Video surveillance through 3 / 4G (part 1)</a></li>
<li><a href="../255657/index.html">Our devices to control the lighting in the smart home</a></li>
<li><a href="../255659/index.html">We pump over Stream API, or we need more sugar.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>