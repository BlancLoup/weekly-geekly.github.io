<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>EventTrace for Windows. High-speed transmission of driver debug messages over the network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are different debugging techniques: someone digs into the debugger, someone meditates, waiting for enlightenment, someone frantically changes th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>EventTrace for Windows. High-speed transmission of driver debug messages over the network</h1><div class="post__text post__text-html js-mediator-article">  There are different debugging techniques: someone digs into the debugger, someone meditates, waiting for enlightenment, someone frantically changes the code in the hope of good luck, but almost no one will refuse the file in which the last moments of the process life will be saved, what happened , in which threads, on which cores, at what time.  Carefully and pedantically saved debug information can save many working hours, especially when it comes to debugging the driver and hardware with which it works.  Well, in the case when the error is random and reproduced on 1 system out of 20 during the week, then without debugging information the meditation can be delayed. <br>  This article focuses on <a href="http://code.google.com/p/baical/">utilities</a> that help in intercepting debug messages of drivers running on several machines simultaneously and sending messages to the server for storage and analysis. <br><br><a name="habracut"></a><br><h4>  Prehistory </h4><br>  The <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb968803(v%3Dvs.85).aspx">EventTrace for Windows</a> technology was first included in Windows 2k and since then it has been a faithful companion of all subsequent operating systems, gradually penetrating an increasing number of software: from drivers to user applications. <br>  It is hard to say that it was a breakthrough, but the highlight of <abbr title="Event Trace for Windwows">ETW</abbr> is speed.  Tens of thousands of debug messages per second from the depths of the driver with a meager effect on performance gives room for the engineer‚Äôs imagination.  And if we add to this the detail and accuracy of the information received, then life begins to seem cloudless. <br>  Inspired by this feeling, we started the introduction.  The difficulties began almost immediately, and the name of these difficulties was <a href="http://msdn.microsoft.com/en-us/library/windows/hardware/ff553872(v%3Dvs.85).aspx">TraceView</a> .  This utility, designed to receive and view debug messages, stubbornly refused to do what it was created for. <br>  If the message delivery technology was worked out well enough - <abbr title="Event Trace for Windwows">ETW</abbr> easily swallowed tens of thousands, then it didn‚Äôt work out with receiving, it seemed that TraceView was created for its own needs by a lone engineer in the depths of the corporation and accidentally got into the DDK. <br><br><h4>  Problem </h4><br>  After another loss of the results of long-term tests, it was decided to classify all the difficulties that we faced, and look for an alternative that would suit us.  Those who wish to familiarize themselves with the list of reasons may find them under <div class="spoiler">  <b class="spoiler_title">spoiler</b> <div class="spoiler_text"><ul><li>  Work with large files (a file is considered large if it exceeds 25 megabytes).  Opening such a file takes considerable time; </li><li>  Loss of service data.  Regularly ETW, saving the file, forgets to write the service header.  Subsequently, having found such a file, you have to meditate for a long time over the hexadecimal editor, restoring the data.  This is especially offensive when the file contains information about an error that could not be reproduced for several days.  In Windows 8, this defect was promised to be fixed; </li><li>  In real-time, the message viewer only holds 65 thousand.  At first glance, this is a lot, but if you imagine that the driver sends at least 1 thousand messages per second, then all you can see is only 1 minute; </li><li>  Copy text messages.  You can copy the message only as a whole, there is no possibility to work with parts of the text; </li><li>  Search.  He is not; </li><li>  The backlight is made through the filtering window, the choice of color is carried out by its name: for example, "Gray - 50"; </li><li>  Filtration.  Applying a filter on previously saved data is not a trivial task; </li><li>  Profiles.  Creating a new profile is tedious and time consuming, overloaded with settings.  You cannot copy profiles using the utility; </li></ul><br></div></div><br>  The search gave no results, <a href="http://etviewer.codeplex.com/">ETViewer</a> was the closest to the requirements, but it did not cover all the necessary needs, besides, the work on it was abandoned and at the moment the list of developers is <a href="http://etviewer.codeplex.com/team/view">empty</a> . <br>  Hopes for a quick solution to our problems went to pieces.  To get used to this fact, it took time, during which we still used TraceView, accumulated strength and ideas. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Decision </h4><br>  The idea of ‚Äã‚Äãself-development was greeted by the management of our R &amp; D department with understanding and enthusiasm, but after drawing up a list of tasks and evaluation in parrots, it became obvious that we do not have such free resources.  It was about 6 person-months only for the most basic functionality.  And, as you know - the appetite comes with eating. <br>  Despite the series of ‚Äúfailures‚Äù, I could not throw it away and forget the idea.  Thus began a series of evenings almost a year when, coming from one job, I proceeded to another.  As a result of this work, the following applications and libraries appeared (the source code is distributed under the <a href="">Apache 2.0</a> license): <br><ul><li>  Baikal is a server framework application to which extension modules are connected (providers, storages, viewers); </li><li>  Angara - a client application that manages the <abbr title="Event Trace for Windwows">ETW</abbr> session, receives messages and forwards them to Baikal; </li><li>  P7.Trace - C ++ library responsible for processing debugging messages of the application being developed, and transferring them to Baikal.  In essence, this is an <abbr title="Event Trace for Windwows">ETW</abbr> replacement that can work on both Windows and Linux; </li></ul><br>  What is the highlight of all this good?  As with <abbr title="Event Trace for Windwows">ETW</abbr> , this is speed.  These are the millions of debug messages per second for modern home PCs.  For example: a duet of I7-870 and a gigabit network can swallow more than 2 million messages in the format: <br><pre><code class="cpp hljs">Trace(‚ÄúHere is my trace <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> here are my values: %d %d‚Äù, iVal1, iVal2);</code> </pre> <br>  In addition to the obvious format of the string and parameters, the following data is also transmitted: <br><ul><li>  The level of "anxiety" (trace, info, warning, error, etc); </li><li>  Time accurate to 100 nano seconds; </li><li>  The number of the processor on which the code was executed; </li><li>  ID of the current thread; </li><li>  Module ID; </li><li>  The name of the function, file, line number in the file; </li><li>  Serial number; </li><li>  Information about the process (name, ID, creation time); </li></ul><br><div class="spoiler">  <b class="spoiler_title">On the side of Baikal, it all looks like this</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/9ef/6b0/395/9ef6b03951a5243a7da29d24175b5308.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/9b2/0aa/fb6/9b20aafb61a86b94f9eb78006fad892e.png" alt="image"><br></div></div><br><br>  The second most important and convenience point is the centralized collection of debug messages.  I will give an example - the company in which I work develops both its hardware and almost all layers of software for it.  When developing and testing, a huge amount of time is spent on observing the zoo from several hardware, drivers and software.  Therefore, the ability to centrally monitor vital signs and, in the event of a failure, to restore a detailed picture of what happened is highly valued. <br>  Unfortunately, and perhaps fortunately, I cannot fit all possible information on all components into one article due to my time constraints.  Also overboard will be an overview of what is under the hood of <abbr title="Event Trace for Windwows">ETW</abbr> , but if you are interested, you can fill this gap with another article. <br><br><h4>  Angara </h4><br>  So I got in his story to the part for which it was started.  In this chapter I will discuss how to configure and run the Angar.  It is assumed that you are already familiar with <abbr title="Event Trace for Windwows">ETW</abbr> and that your driver has already been instrumented with similar messages. <br><br><h5>  ETW session options </h5><br>  The starting point of each <abbr title="Event Trace for Windwows">ETW</abbr> session is the Control GUID, there are similar lines in one of your source files: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//{63423ADB-D156-4281-BA74-8ACAEDDBD810} #define WPP_CONTROL_GUIDS \ WPP_DEFINE_CONTROL_GUID(ProviderGuid, (63423ADB, D156, 48d5, B0BC, 8ACAEDDBD810),\ WPP_DEFINE_BIT(DBG_PROVIDER) /* bit 0 = 0x00000001 */ \ /* You can have up to 32 defines. If you want more than that,\ you have to provide another trace control GUID */\ )</span></span></code> </pre><br>  We are interested in the value of WPP_DEFINE_CONTROL_GUID, which can be written in the form {63423ADB-D156-4281-BA74-8ACAEDDBD810}, remember it - it is still needed. <br><br>  The second most important element required from your driver will be the Trace Message Format File (TMF).  The file describes the format of debug messages, as well as contains additional information about the message.  The easiest way to get this file is to run the following command after successfully building your driver: <br><pre> <code class="dos hljs">Tracepdb.exe -f MyDriver.pdb -o MyTraceMessageFormatFile.tmf</code> </pre><br>  The ‚ÄúTracepdb.exe‚Äù utility comes with the DDK, the default path is the following: <i>C: \ WinDDK \ {Version} \ tools \ tracing \</i> <br><br><h5>  Settings.  Provider </h5><br>  So, we armed with the Control GUID and the TMF file - it‚Äôs time to edit the Hangar configuration file, it is called unpretentiously - ‚ÄúAngara.xml‚Äù and is in the same folder as the executable files.  Open it with any editor that understands UTF-16, and we can start editing. <br><br>  The first section of interest is dedicated to the <abbr title="Event Trace for Windwows">ETW</abbr> provider: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Provider</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TMF</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">GUID</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{63423ADB-D156-48d5-B0BC-8ACAEDDBD810}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Flags</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0xFFFFFFFFFFFFFFFF"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Filter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Platform</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"X32"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  There are only two required parameters: <br><ul><li>  TMF - path to the folder with the TMF files that you generated; </li><li>  GUID - the same Control GUID; </li></ul><br><br>  Important, but not obligatory parameters are the ‚ÄúFlags‚Äù and ‚ÄúLevel‚Äù parameters; they allow filtering currently unwanted messages on the driver side, thereby reducing the load on the <abbr title="Event Trace for Windwows">ETW</abbr> and the system as a whole. <br>  The remaining optional parameters are described in sufficient detail in the <a href="http://code.google.com/p/baical/wiki/Angara">documentation</a> , as well as in the XML file itself, and their description is unnecessary here. <br><br><h5>  Settings.  Network </h5><br>  The following section is dedicated to network connectivity: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P7Trace</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Address</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"localhost"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"9009"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Packet</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1472"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyChannel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Verbosity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  There is only one obligatory parameter ‚Äî Address; you must enter the IP address (IPv4 / IPv6) or the symbolic name of the PC on which the Baikal is running.  Optional parameters are described in detail in the <a href="http://code.google.com/p/baical/wiki/Angara">documentation</a> . <br><br><h5>  Settings.  Levels </h5><br>  The last section is a map on which the <abbr title="Event Trace for Windwows">ETW</abbr> message level is converted into a message level understandable to Baikal: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Levels</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Trace</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WPP</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TRACE_LEVEL_VERBOSE"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Trace</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Debug</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WPP</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TRACE_LEVEL_NONE"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Debug</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Info</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WPP</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TRACE_LEVEL_INFORMATION"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Info</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Warning</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WPP</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TRACE_LEVEL_WARNING"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Warning</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Error</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WPP</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TRACE_LEVEL_ERROR"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Error</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Critical</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WPP</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TRACE_LEVEL_FATAL"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WPP</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TRACE_LEVEL_CRITICAL"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Critical</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Levels</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  You need to edit this section only if you have redefined macros in the source code of your driver, for example like this: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Define debug levels #define NONE 0 // Tracing is not on #define FATAL 1 // Abnormal exit or termination #define ERROR 2 // Severe errors that need logging #define WARNING 3 // Warnings such as allocation failure #define INFO 4 // Includes non-error cases such as Entry-Exit #define TRACE 5 // Detailed traces from intermediate steps #define LOUD 6 // Detailed trace from every step</span></span></code> </pre><br><br>  In this case, the XML section will look as follows: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Levels</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Trace</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WPP</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LOUD"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Trace</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Debug</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WPP</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TRACE"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Debug</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Info</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WPP</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"INFO"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Info</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Warning</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WPP</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"WARNING"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Warning</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Error</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WPP</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ERROR"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Error</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Critical</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WPP</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FATAL"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Critical</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Levels</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h5>  Start </h5><br>  That's all, editing the configuration file is completed, you can start the launch.  In what order you will run Baikal and Angara - it does not matter, but it is reasonable to launch Baikal first to be able to accept all sent messages, just do not forget to politely ask your Firewall <b>not to block traffic between Angara and Baikal</b> . <br>  The launch of the hangar is very simple: <br><pre> <code class="dos hljs">Angara_32.exe Angara.xml # Angara_64.exe Angara.xml</code> </pre><br><br>  Example of Angara: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/o1sQ0u4dmEY%3Ffeature%3Doembed&amp;xid=25657,15700022,15700186,15700190,15700253,15700255,15700259&amp;usg=ALkJrhgYY2pNPu54yBK7I3eV_CU54Ar3Xg" frameborder="0" allowfullscreen=""></iframe><br>  <b>NB</b> : On older OSs (Windows 2k, XP), the ETW session cannot work stably without an intermediate file, so when starting the Hangar on these versions of the OS, remember that Angara will try to create several temporary files with a total size from 250 MB to 1 GB, in case failures - the process will end. <br><br><h4>  Appearance </h4><br>  The whole graphical interface, or rather its absence, can be described with the following picture: <br><img src="https://habrastorage.org/getpro/habr/post_images/9a4/03e/232/9a403e232cd33c8a804a1e7524e30ba5.png" alt="image"><br>  In addition to static information about the session, there are 12 different counters, a rather large and, at the moment, an excess amount of information.  They were needed at the stage of active debugging of the program and made it possible to accurately detect the problem area, now it is only a historical relic, which was left for the purpose of technical monitoring.  Counters are divided into 3 groups: <br><ul><li>  Main statistics (Angara): <br><ul><li>  Send - the number of sent messages </li><li>  Rejected - total (for all reasons) number of messages rejected to be sent </li><li>  Unknown - the number of unidentified messages, this counter increases each time a message arrives whose description cannot be found in the TMF files.  Possible reason - the lack of the necessary TMF file or the TMF file is outdated (it was not generated after the driver was compiled) </li><li>  TPS - estimated number of messages sent per second </li></ul><br></li><li>  Network statistics (P7): <br><ul><li>  Free mem.  - the percentage of free internal memory. </li><li>  Rej.  No connect.  - number of messages rejected for sending due to lack of connection with the server (Baikal) </li><li>  Rej.  No Memory - number of messages rejected for sending due to lack of memory </li><li>  Rej.  Internal - number of messages rejected for sending due to internal failures </li></ul><br></li><li>  ETW statistics: <br><ul><li>  Traces lost - the number of lost messages within ETW </li><li>  Buffers lost - the number of lost buffers inside the ETW </li><li>  RealT.  Buf.  lost - the number of lost real-time buffers inside ETW </li><li>  Broken Seq.  - the number of unaccounted ETW losses, monitoring occurs on the assumption that incoming message numbers increase linearly by one </li></ul><br></li></ul><br><br><h4>  Conclusion </h4><br>  This is where my story ends, I hope that the utilities presented here will facilitate the difficult but creative life of the developers of driver and application software. <br><br>  PS: Project <a href="http://code.google.com/p/baical/">site</a> with source codes and binary files, as well as English-language <a href="http://code.google.com/p/baical/wiki/Help">help</a> . <br>  PPS: Bai <b>c</b> al is not a random typo. </div><p>Source: <a href="https://habr.com/ru/post/156817/">https://habr.com/ru/post/156817/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../156805/index.html">A simple way to prepare reports based on rtf forms</a></li>
<li><a href="../156807/index.html">Easy copying of paper documents in Linux</a></li>
<li><a href="../156809/index.html">Optimization of games for iOS platform. Code vectorization</a></li>
<li><a href="../156811/index.html">Apple Push Notification Service Guide</a></li>
<li><a href="../156813/index.html">Webinar on the topic: How to avoid the 5 most common mistakes that lead to the failure of all startups?</a></li>
<li><a href="../156819/index.html">Pow - easy, fast, convenient</a></li>
<li><a href="../156821/index.html">Technology tracking and scanning using a conventional webcam</a></li>
<li><a href="../156825/index.html">Fair elections. Word cryptographers</a></li>
<li><a href="../156827/index.html">What programming language do you most often work in?</a></li>
<li><a href="../156831/index.html">Linus Torvalds offers 2560x1600 as a new standard for laptops</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>