<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Certificate Authority (CA) migration failed from Windows 2008R to Windows 2012 R2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, dear reader! 

 I will tell you about my nightmare, which I experienced migrating CA from Windows 2008R2 to Windows 2012 R2. There are...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Certificate Authority (CA) migration failed from Windows 2008R to Windows 2012 R2</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, dear reader! <br><br>  I will tell you about my nightmare, which I experienced migrating CA from Windows 2008R2 to Windows 2012 R2.  There are a lot of articles about this in the internet and there shouldn't have been any problems. <br><br>  Unfortunately, I‚Äôm not really Windows Admin, I‚Äôm more than * nix admin, but the task of CA migration was set - it needs to be done. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Under the cut, I will tell you how I went through this process and got not quite HappyEnd in the end. <br><a name="habracut"></a><br>  So let's go ... <br><br>  <b>Initial data:</b> <br>  <b>Source</b> - Windows 2008 R2 with Root CA <br>  <b>Target</b> - Windows 2012R2 <br><br>  Windows Server 2012R2 was already installed and minimally configured. <br><br>  <b>Initially, the action plan was as follows (shortened actions):</b> <br><br><ol><li>  Make Backup CA + Private Key and copy it to a common ball for both computers. </li><li>  We deduce target from the domain and we change IP </li><li>  Snapshot server </li><li>  Change IP at source </li><li>  We go to the new Windows 2012R2 server under the administrator - enter it into the domain with the same name and assign the old IP </li><li>  We set the role of Active Directory Certificate Service (CA, CA Web Enrollment, NDES, Online Responder) </li><li>  We specify that it is Enterprise CA </li><li>  Restore CA + Private Key from backup </li><li>  Happy end </li></ol><br>  Agree, well, nothing complicated.  And I started the implementation.  In fact, there were no problems and everything went like clockwork ... The service started, Certificate Templates appeared and the certificates themselves appeared.  In general, everything is OK.  So I went to bed.  In the morning there were no complaints about the work of CA, and therefore I thought that everything was working, and proceeded to other tasks.  In the process of solving them, I needed a certificate.  I created a .csr and went to <a href="https://vm_ca/certsvc">vm_ca / certsvc</a> to sign and get a certificate, and at that point an error occurred.  Unfortunately, I did not take a screenshot, but it said about mismatch user information and some other errors.  Well, that sailed - I thought.  I started to google, but unfortunately I did not find anything intelligible. <br><br>  In the evening, we decided to remove CA Windows 2012R2 and install everything in a new way and then made a mistake, instead of Enterprise CA, I chose the option Standalone CA (I already found out about my mistake later).  I did all the operations again ... everything went without errors - but when I selected the Certificate Templates folder - I get Element not found, although if I select Manage, then the templates are in place. <br><br>  I thought that I did not have enough rights for this CN = Certificate Templates, so with the help of ADSI Edit I gave Read for vm_ca $.  Restarted CertSvc and ... result: Element not found. <br><br>  Then I felt sad for 2 hours at night ... and CA does not work.  I turn off CA Windows 2012R2 and restore VM CA Windows 2008R2 from snapshot.  I return the server to AD (because when I try to log in under the domain account, there is an error in the relationship between the server and AD). <br><br>  Well, I think ... everything will now be OK, but alas ... all the same Certificate Templates - I get Element not found.  I will leave everything till the morning - for the morning of the evening is wiser. <br><br>  In the morning I googled by reading all sorts of articles - I decide to reinstall CA on the old server in the hope of solving the Element Not Found problem and issuing certificates via the Web. <br><br>  <b>The process is quite simple:</b> <br><br><ol><li>  Remove the role of CA </li><li>  Reboot </li><li>  We are waiting for the completion of the removal process </li><li>  Add the CA role (specify CA, CA Web Enrollment, NDES, Online Responder) </li><li>  We indicate that I have an Enterprise CA and I have a private key </li><li>  We are waiting for the completion of the installation and restore all of the backup, which we did at the very beginning. </li><li>  As usual, everything goes off with a bang - without errors and the service started </li></ol><br>  With a sinking heart, I clicked on Certificate Templates - and ... I got a list - this is already a small victory.  It remains to verify the work of issuing a certificate via the Web.  I follow the link: <a href="https://vm_ca/certsvc">vm_ca / certsvc</a> and click on Request a Certificate and then advanced certificate request ... I specify the .csr request and get the finished certificate.  Vydayu ... Restore CA happened. <br><br>  <b>Findings:</b> <br><br><ol><li>  Be sure to backup and snapshot </li><li>  Document your actions - this will help get everything back or find a mistake faster. </li></ol><br>  PS I will again have to try CA migration from Windows 2008R to Windows 2012R2. </div><p>Source: <a href="https://habr.com/ru/post/448402/">https://habr.com/ru/post/448402/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448388/index.html">Digital Dictation will be held in Russia for the first time</a></li>
<li><a href="../448390/index.html">How to make a watch for Ilona Mask</a></li>
<li><a href="../448392/index.html">Two approaches to structuring the Activity diagram</a></li>
<li><a href="../448398/index.html">Artificial intelligence, great and terrible</a></li>
<li><a href="../448400/index.html">Netplan and how to cook it properly</a></li>
<li><a href="../448408/index.html">DCIM - the key to data center management</a></li>
<li><a href="../448410/index.html">Google trackers are built into a number of official Russian electronic resources.</a></li>
<li><a href="../448416/index.html">The easiest way to make a chat in the iOS application</a></li>
<li><a href="../448420/index.html">From life with Kubernetes: How the HTTP server did not complain about the Spaniards</a></li>
<li><a href="../448422/index.html">E-Dobavki - Java and Spring Boot food supplement search service, written by my students</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>