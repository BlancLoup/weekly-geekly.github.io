<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Swift improve performSegueWithIdentifier or convenient router with storyboards</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A rare developer for iOS or OS X did not use storyboards and even fewer programmers did not transfer data between screens. 
 We all know the performSe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Swift improve performSegueWithIdentifier or convenient router with storyboards</h1><div class="post__text post__text-html js-mediator-article">  A rare developer for iOS or OS X did not use storyboards and even fewer programmers did not transfer data between screens. <br>  We all know the performSegueWithIdentifier method and the difficulty of working with it. <br><br>  Having started a project in Swift at one moment I felt hurt: ‚ÄúWhy should we use a wrapper for data transfer in a strictly-typed language?‚Äù <br>  After a couple of minutes, a vision of the solution was formed and, shortly, implementation. <br><br>  I thought for a long time whether to write about it, because the material is extremely small, but these 50 lines can help you a lot 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs swift">menuController?.performSegueWithIdentifier(changeItemIdentifier, sender: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { segue <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> controller = segue.destinationViewController <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">ChangeMenuItemController</span></span> controller.viewModel.sourceMenuItem = item }</code> </pre> <br><br>  Thus, it is easy to use storyboards and routers together.  Eliminate the growth of prepareForSegue and increase the code reading context.  At the same time, it does not force to abandon prepareForSegue in convenient situations. <br><br>  We will understand how this works?  I do not pretend to be unique, but I think the approach is interesting. <br><a name="habracut"></a><br><br>  1) Create a method similar to performSegueWithIdentifier, but with the optional parameter closure (configurate) <br>  2) Save the configurate <br>  3) Call the performSegueWithIdentifier method <br>  4) At the time of the call to prepareForSegue, it remains only to call the configurate <br><br>  You can write a class, but it is much more productive to write a category. <br>  The subtle point is to save the configurate and call it from prepareForSegue (which is important not to break with your actions). <br>  For preservation we will use associative links.  Instead of prepareForSegue, our method will be called, from where the configurate will be called and then the original method will be called. <br><br><div class="spoiler">  <b class="spoiler_title">High level code</b> <div class="spoiler_text"><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">ConfiguratePerformSegue</span></span> = (<span class="hljs-type"><span class="hljs-type">UIStoryboardSegue</span></span>) -&gt; () <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performSegueWithIdentifier</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(identifier: String, sender: AnyObject?, configurate: ConfiguratePerformSegue?)</span></span></span></span> { swizzlingPrepareForSegue() configuratePerformSegue = configurate performSegueWithIdentifier(identifier, sender: sender) }</code> </pre><br></div></div><br><br>  The implementation is very small, and it is easier to attach the code under the spoiler <br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Box</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value: <span class="hljs-type"><span class="hljs-type">Any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(<span class="hljs-number"><span class="hljs-number">_</span></span> value: <span class="hljs-type"><span class="hljs-type">Any</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.value = value } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AssociatedKey</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-type"><span class="hljs-type">ClosurePrepareForSegueKey</span></span> = <span class="hljs-string"><span class="hljs-string">"ClosurePrepareForSegueKey"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> token: dispatch_once_t = <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">ConfiguratePerformSegue</span></span> = (<span class="hljs-type"><span class="hljs-type">UIStoryboardSegue</span></span>) -&gt; () <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performSegueWithIdentifier</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(identifier: String, sender: AnyObject?, configurate: ConfiguratePerformSegue?)</span></span></span></span> { swizzlingPrepareForSegue() configuratePerformSegue = configurate performSegueWithIdentifier(identifier, sender: sender) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">swizzlingPrepareForSegue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { dispatch_once(&amp;<span class="hljs-type"><span class="hljs-type">AssociatedKey</span></span>.token) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> originalSelector = #selector(<span class="hljs-type"><span class="hljs-type">UIViewController</span></span>.prepareForSegue(<span class="hljs-number"><span class="hljs-number">_</span></span>:sender:)) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> swizzledSelector = #selector(<span class="hljs-type"><span class="hljs-type">UIViewController</span></span>.closurePrepareForSegue(<span class="hljs-number"><span class="hljs-number">_</span></span>:sender:)) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> instanceClass = <span class="hljs-type"><span class="hljs-type">UIViewController</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> originalMethod = class_getInstanceMethod(instanceClass, originalSelector) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> swizzledMethod = class_getInstanceMethod(instanceClass, swizzledSelector) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> didAddMethod = class_addMethod(instanceClass, originalSelector, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> didAddMethod { class_replaceMethod(instanceClass, swizzledSelector, method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { method_exchangeImplementations(originalMethod, swizzledMethod) } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closurePrepareForSegue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(segue: UIStoryboardSegue, sender: AnyObject?)</span></span></span></span> { configuratePerformSegue?(segue) closurePrepareForSegue(segue, sender: sender) configuratePerformSegue = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> configuratePerformSegue: <span class="hljs-type"><span class="hljs-type">ConfiguratePerformSegue?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> box = objc_getAssociatedObject(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, &amp;<span class="hljs-type"><span class="hljs-type">AssociatedKey</span></span>.<span class="hljs-type"><span class="hljs-type">ClosurePrepareForSegueKey</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">Box</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> box?.value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">ConfiguratePerformSegue</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { objc_setAssociatedObject(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, &amp;<span class="hljs-type"><span class="hljs-type">AssociatedKey</span></span>.<span class="hljs-type"><span class="hljs-type">ClosurePrepareForSegueKey</span></span>, <span class="hljs-type"><span class="hljs-type">Box</span></span>(newValue), objc_AssociationPolicy.<span class="hljs-type"><span class="hljs-type">OBJC_ASSOCIATION_RETAIN</span></span>) } } }</code> </pre><br></div></div><br><br>  That's all.  This is a very small hack that works on both objc and Swift. <br>  This not only does not violate the code you wrote earlier, but also allows you to combine both approaches or completely switch to configuration from blocks. <br>  It also allows you to make the dependence of the transitions between the screens in a special Router class and use together with storyboards <br><br>  upd: after communication laid out in the form of pod'a + use with auto- <i>destination destination</i> UIViewController. <br>  <a href="https://cocoapods.org/pods/PureSegue">cocoapods.org/pods/PureSegue</a> </div><p>Source: <a href="https://habr.com/ru/post/275783/">https://habr.com/ru/post/275783/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275767/index.html">Own browser - the way the mouse: Theory</a></li>
<li><a href="../275769/index.html">Work with geolocation in iOS 24/7</a></li>
<li><a href="../275771/index.html">Pets vs cattle</a></li>
<li><a href="../275779/index.html">Microsoft sent a request for appruv ChakraCore support implementation in Node.js along with the V8 engine</a></li>
<li><a href="../275781/index.html">The digest of interesting materials for the mobile developer # 137 (on January 18-24)</a></li>
<li><a href="../275785/index.html">How to use SQL DB in student Microsoft AZURE from Dreamspark</a></li>
<li><a href="../275787/index.html">VPLS. Label Distribution with BGP</a></li>
<li><a href="../275789/index.html">Tricky C # Questions</a></li>
<li><a href="../275795/index.html">Example of creating a web application using the Vaadin libraries</a></li>
<li><a href="../275797/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ195 (January 18 - 24, 2016)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>