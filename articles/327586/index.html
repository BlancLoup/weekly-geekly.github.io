<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cheeky telegram bot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, in trying to deal with nlp, I got the idea to write a simple telegram bot, which will speak like a cheeky gopnik. I.e: 


- give an answer t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cheeky telegram bot</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/2f0/ba6/72c/2f0ba672c79d458f8419daa903c936f9.png" align="left" width="260">  Recently, in trying to deal with nlp, I got the idea to write a simple telegram bot, which will speak like a cheeky gopnik.  I.e: </p><br><ul><li>  give an answer to the trigger word as ‚Äúwant‚Äù, ‚Äúin short‚Äù, ‚Äúno‚Äù, etc .; </li><li>  to answer a bold question with a question; </li><li>  respond obscene rhyme; </li><li>  if nothing fits and the bot is confused, respond with an evil phrase. </li></ul><br><p>  JavaScript was implemented with ES6 and Flow for implementation.  Perhaps Python would be better, since there are more stable and proven libraries for nlp under it.  But for JS there is <a href="">Az.js</a> , which is quite enough. </p><br><p>  To work with the Telegram API, <a href="https://github.com/yagop/node-telegram-bot-api">node-telegram-bot-api was used</a> . </p><br><p>  <strong>TLDR:</strong> <a href="http://t.me/swear_bot">bot</a> , <a href="https://github.com/nvbn/telegram-swear-bot/">source code</a> </p><br><p>  <strong>Carefully, there is obscene speech and implementation details under the cut!</strong> </p><a name="habracut"></a><br><p>  <a href="">The part with the implementation of the Telegram API is</a> not very interesting, and many articles have already been written about this, and I‚Äôll leave it out. </p><br><p>  I'll start right away with how the bot is trying to find the right answer.  <strong>The first method of finding an answer</strong> is the trigger word: </p><br><blockquote>  user: I want a new car! <br>  bot: Want to be harmless! </blockquote><p> First we have a list of pairs <code>[regexp, ]</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TRIGGERS = [ [<span class="hljs-regexp"><span class="hljs-regexp">/^[][]?$/i</span></span>, <span class="hljs-string"><span class="hljs-string">'  ,   !'</span></span>], [<span class="hljs-regexp"><span class="hljs-regexp">/^$/i</span></span>, <span class="hljs-string"><span class="hljs-string">' !'</span></span>], [<span class="hljs-regexp"><span class="hljs-regexp">/^(||||)$/i</span></span>, <span class="hljs-string"><span class="hljs-string">' !'</span></span>], ];</code> </pre> <br><p>  Then we have to break the message from the user into words: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getWords = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text: string</span></span></span><span class="hljs-function">): </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">[] =&gt;</span></span> Az.Tokens(text) .tokens .filter(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{type}</span></span></span><span class="hljs-function">) =&gt;</span></span> type === Az.Tokens.WORD) .map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{st, length}</span></span></span><span class="hljs-function">) =&gt;</span></span> text.substr(st, length).toLowerCase());</code> </pre> <br><p>  Go through all the triggers and return possible answers: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getByWordTrigger = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">*(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text: string</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Iterable</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> word <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> getWords(text)) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [regexp, answer] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> constants.TRIGGERS) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (word.match(regexp)) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> answer; } } } };</code> </pre> <br><p>  It came out very simple.  Now the time has come for the <strong>second method of finding an answer</strong> - to answer the question with a bold question: </p><br><blockquote>  user: When will we go home? <br>  bot: Are you fucking? </blockquote><p>  In order to determine whether a message is a question, we need to check it for the presence of a question mark at the end and for the presence of question words like "when", "where", etc .: </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getAnswerToQuestion = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text: string</span></span></span><span class="hljs-function">): </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">[] =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text.trim().endsWith(<span class="hljs-string"><span class="hljs-string">'?'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [constants.ANSWER_TO_QUESTION]; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> questionWords = getWords(text) .map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">word</span></span></span><span class="hljs-function">) =&gt;</span></span> Az.Morph(word)) .filter(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">morphs</span></span></span><span class="hljs-function">) =&gt;</span></span> morphs.length &amp;&amp; morphs[<span class="hljs-number"><span class="hljs-number">0</span></span>].tag.Ques); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (questionWords.length) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [constants.ANSWER_TO_QUESTION]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> []; } };</code> </pre> <br><p>  So, in case of a question, the bot will return a hard-core <code>constants.ANSWER_TO_QUESTION</code> . </p><br><p>  <strong>The third method of finding the answer</strong> - the answer obscene rhyme.  This method is the most difficult: </p><br><blockquote>  user: I want to go to Austria! <br>  bot: hyavstria <br>  user: he has a tractor <br>  bot: huyaktor </blockquote><p>  In short: we simply replace the first syllable of a noun or adjective with "xy" and a transformed vowel from a syllable, like "o" ‚Üí "", "a" ‚Üí "i", etc. </p><br><p>  To begin, we must be able to get the first syllable of the word.  It is not difficult: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getFirstSyllable = (word: string): <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = []; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> readVowel = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> letter <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> word) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isVowel = constants.VOWELS.indexOf(letter) !== <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readVowel &amp;&amp; !isVowel) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isVowel) { readVowel = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } result.push(letter); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result.join(<span class="hljs-string"><span class="hljs-string">''</span></span>); };</code> </pre> <br><p>  Then you need to replace the first syllable with "xy" + vowel, if possible: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getRhyme = (word: string): ?<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> morphs = Az.Morph(word); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!morphs.length) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {tag} = morphs[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!tag.NOUN &amp;&amp; !tag.ADJF) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> syllable = getFirstSyllable(word); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!syllable || syllable === word) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prefix = constants.VOWEL_TO_RHYME[last(syllable)]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> postfix = word.substr(syllable.length); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${postfix}</span></span></span><span class="hljs-string">`</span></span>; };</code> </pre> <br><p>  And finally, return all possible rhymes for words from the message: </p><br><pre> <code class="hljs vhdl">const getRhymes = (<span class="hljs-literal"><span class="hljs-literal">text</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>): <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>[] =&gt; getWords(<span class="hljs-literal"><span class="hljs-literal">text</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>(getRhyme) .filter(<span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>) .reverse();</code> </pre> <br><p>  <strong>The final method of finding an answer</strong> is to respond in confusion with a rude phrase: </p><br><blockquote>  user: wtf <br>  bot: what? </blockquote><p>  This method is more than simple, so it will be implemented in the function aggregating all methods: </p><br><pre> <code class="hljs mel">export <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] =&gt; { const answers = uniq([ ...getByWordTrigger(<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>), ...getAnswerToQuestion(<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>), ...getRhymes(<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>), ]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (answers.length) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> answers; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> constants.NO_ANSWERS; } };</code> </pre> <br><p>  And it's all.  <a href="http://t.me/swear_bot">Bot</a> , <a href="https://github.com/nvbn/telegram-swear-bot/">source code</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/327586/">https://habr.com/ru/post/327586/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327576/index.html">Self-sufficient controllers on Xamarin.Forms: "Re-use the code to the maximum!". Part 1</a></li>
<li><a href="../327578/index.html">How three schoolchildren hacked the source code of Final Fantasy V to localize it</a></li>
<li><a href="../327580/index.html">Microsoft itself</a></li>
<li><a href="../327582/index.html">How does the testing of the developers KOMPAS-3D</a></li>
<li><a href="../327584/index.html">Development: technical task on the site or concept?</a></li>
<li><a href="../327588/index.html">We are testing a new line of SSD VPS + a little insider from the life of a hoster</a></li>
<li><a href="../327590/index.html">Gixy - open source from Yandex, which will make configuring Nginx safe</a></li>
<li><a href="../327592/index.html">Results of the third round of the Russian Code Cup 2017</a></li>
<li><a href="../327594/index.html">How to use the HTTP API to send emails</a></li>
<li><a href="../327596/index.html">Tale of creating a classic RTS at home from scratch (Part 2: "Resurrection")</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>