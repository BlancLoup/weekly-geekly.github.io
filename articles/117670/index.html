<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Accelerate Visual Studio Part II. Compilation experiments</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My main working tool for the past 10 years is Microsoft Visual Studio. This is a great IDE (at least for C ++ and C #), which I do not know better tha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Accelerate Visual Studio Part II. Compilation experiments</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/6d9db5a2/91f3c104/911d2482/92fb4f79.png" align="left">  My main working tool for the past 10 years is Microsoft Visual Studio.  This is a great IDE (at least for C ++ and C #), which I do not know better than for desktop development for Windows.  Nevertheless, one of its drawbacks is well known - the drop in performance on large solutions.  I am currently working on a solution from 19 projects (about 4k files, 350k lines of code).  Compilation and other costs eat up a fair amount of time.  That is why I set out to conduct a large-scale study of ways to increase the speed of Visual Studio, separating myths from reality. <br><br>  I‚Äôll say right away that in the final I managed to reduce the compilation time of the solution from 4:24 minutes to less than one minute.  Details under the cut. <br><a name="habracut"></a><br><br><h4>  On your marks! </h4><br>  In the beginning, I was going to build a separate test machine with a ‚Äúclean‚Äù OS and only one installed program ‚Äî Visual Studio.  But then he decided that testing spherical horses in a vacuum would not be entirely true.  One way or another, any browser, antivirus, file manager, archiver, text editor, etc., will be installed on the programmer‚Äôs computer, which means the Studio will have to work with all this in the vicinity.  So, in this mode, we will test it on a regular developer‚Äôs computer (by reinstalling, however, for the sake of experiment purity, the operating system and installing the latest versions of the programs used in the work). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A set of experiments compiled on advice from the sites <a href="http://stackoverflow.com/">Stackoverfow</a> , <a href="http://stackoverflow.com/">RDN</a> , <a href="http://social.msdn.microsoft.com/Forums/en/categories">MSDN forums</a> , Google issue, and just from the head. <br><br>  The object of testing will be the time to complete the compilation of the solution.  Before each experiment, the entire project folder will be deleted, the code will be re-uploaded from the repository, and Visual Studio will reload.  Each experiment will be repeated three times, the result will be the average time.  After each experiment, the changes made are rolled back. <br><br>  If anyone is interested in the hardware configuration of my computer, so here it is: <br><img src="https://habrastorage.org/storage/40c9d6aa/2433c75b/dd5d9cad/b0e15b8b.png"><br>  + hard drive WD 500 GB, 7200 RPM, 16 MB cache <br>  + Win 7 Professional 32 bits with all possible updates <br>  + Visual Studio 2010 Professional with the first service pack <br>  In Windows, the maximum performance mode is turned on, Aero and all kinds of animations are disabled. <br><br>  Initial compilation time of my solution: <b>4 minutes 24 seconds</b> <br><br><h4>  Go! </h4><br><h5>  Temporary files - on RamDrive </h5><br>  It is believed that the slowest operations during the compilation of a solution are related to disk access.  This time can be reduced by using RamDrive for temporary files. <br>  <b>Result</b> : 4 minutes 13 seconds or -4.17% by the time of compilation. <br><img src="https://habrastorage.org/storage/b4bd9593/a60211d7/8b8faf15/4bcc00fa.png"><br>  <b>Conclusion</b> : there is a performance boost, albeit small.  If the amount of RAM allows, this advice can be applied in action. <br><br><h5>  The whole project is on RamDrive </h5><br>  If we managed to speed up the compilation a bit by dumping temporary files on RamDrive, it is possible to achieve even better results by moving the entire solution there (after all, more than 4000 files). <br>  <b>Result</b> : 3 minutes 47 seconds or -14.02% at compile time. <br><img src="https://habrastorage.org/storage/e1b3e220/beee7966/c253763d/94373e72.png"><br>  <b>Conclusion</b> : At first, this experiment seemed a bit dumb to me - storing the source code in RAM is not the best option (what if the power was lost?).  But, given the fact that there are no-breakers, as well as such versions of RamDrive, as from QSoft (with automatic duplication of modified files from RamDrive to the hard disk), they convinced me that option is possible.  You only need enough RAM (and, in an amicable way, 64-bit OS). <br><br><h5>  The whole project is on a flash drive. </h5><br>  Continuing the discussion about the speed of searching for files on a disk and more efficient random access operations for USB-drives, we try to put the entire project on a USB flash drive and compile it there. <br>  <b>Result</b> : 20 minutes and 5 seconds or + 356.44% at compile time <br><img src="https://habrastorage.org/storage/98d5d1b2/4bc9dbc8/fb8ee754/58eb10fe.png"><br>  <b>Conclusion</b> : the most disastrous experiment.  A flash drive is not able to cope with the squall of input / output operations that occur during compilation. <br><br><h5>  Enabling the ReadyBoost feature in Windows </h5><br>  Microsoft praises this feature precisely for improving performance when working with a large number of relatively small data blocks (our version).  Let's try. <br>  <b>Result</b> : 4 minutes 17 seconds or -2.65% at compile time. <br><img src="https://habrastorage.org/storage/b33d1a22/e044dcbe/424981eb/4eb9bc3a.png"><br>  <b>Conclusion</b> : quite normal way to accelerate work.  In addition to the need to insert a flash drive once and configure ReadyBoost, it has no other drawbacks, but it does provide some performance boost. <br><br><h5>  Change the number of simultaneously compiled projects </h5><br>  When installing, Visual Studio prescribes this number equal to the total number of processor cores in your PC.  Nevertheless, we can try to change it (this is done in the VS settings for C ++ projects) and evaluate the performance change.  Since in my computer there is a 4-core processor, initially this number was equal to four. <br>  <b>Result</b> : <br>  6 projects are compiled simultaneously - 4 minutes 34 seconds or + 3.79% by the time of compilation <br>  2 projects are compiled simultaneously - 4 minutes 21 seconds or -1.14% by the time of compilation <br><img src="https://habrastorage.org/storage/b7231898/0b3c8279/47fe9a31/516ba893.png"><br>  <b>Conclusion</b> : from the very beginning, I expected that an increase in the number of simultaneously compiled projects would not yield any performance gain (this was the case).  But that is why reducing it to two gave a small increase for me is not very clear.  Perhaps this is just a statistical error, and maybe when compiling 4 projects, Studio because of their dependencies loses time on some expectation, which happens less often when compiling just two projects.  If anyone else has thoughts on the topic - please in the comments. <br><br><h5>  Disabling build text in the Output window </h5><br>  Less text output when compiling - faster result. <br>  <b>Result</b> : 4 minutes 22 seconds or -0.76% by compile time <br><img src="https://habrastorage.org/storage/7b78f12d/87b0e2b2/6079ba42/5ed12358.png"><br>  <b>Conclusion</b> : the increase is so ridiculous that it is not even worth the comments.  It can be both real and random. <br><br><h5>  Empty basket </h5><br>  I read this tip on stackoverflow.  The argument was that during the compilation a lot of small files are created and deleted, and the deletion procedure in Windows is slower with a clogged basket.  Since I carried out all previous experiments with an empty basket, I had to do a reverse experiment - put 5,000 files in the basket with a total volume of 2 GB. <br>  <b>Result</b> : 4 minutes 23 seconds or + 0.38% at compile time. <br><img src="https://habrastorage.org/storage/d30888a7/2fba6023/bb6c1d11/7eae11ee.png"><br>  <b>Conclusion</b> : the compile time remains unchanged.  The theory has failed. <br><br><h5>  Compiler Key / MP </h5><br>  The / MP switch is also a parallel compilation, but no longer projects in the solution, but files inside each project. <br>  <b>Result</b> : 2 minutes 38 seconds or -40.15% by the time of compilation <br><img src="https://habrastorage.org/storage/c5c37a67/2ee3426a/963231bd/4eeebf78.png"><br>  <b>Conclusion</b> : this is one of the most significant achievements among all the experiments.  Of course, the gain is so high mainly due to the 4-coreness of my processor, but soon such (and even more nuclear processors) will become the norm in any computer, so it makes sense to turn on the option.  When it is turned on, the compiler honestly warns that it is not compatible with the / Gm (Enable Minimal Rebuild) key, which is scary at first - the thought arises that now with any change to any file, the solution will be fully recompiled.  So-nifiga like!  After changing one file with the code, as before, only this file will be recompiled, but not the entire solution.  All that the key does is determine the choice of the algorithm for determining the interrelationships of code files and header files in a project ( <a href="http://msdn.microsoft.com/en-us/library/kfz8ad09%2528v%3DVS.100%2529.aspx">more detailed</a> ).  Both algorithms are not bad and a significant performance increase from switching on / MP is many times greater than the drawbacks from turning off / Gm. <br><br><h5>  Remove solution folder from Windows search index </h5><br>  It is believed that changing files in folders that are indexed by the Windows search engine causes an increase in compilation time. <br>  <b>Result</b> : 4 minutes 24 seconds or no change in compile time. <br><img src="https://habrastorage.org/storage/1560f228/d6b342fe/55b4a4bf/70e10814.png"><br>  <b>Conclusion</b> : whether the indexing in Windows is done so well that it does not slow down the work of other programs with the disk, or if this influence is minimal, or I was just lucky and the compilation did not coincide in time with the indexing. <br><br><h5>  Unity builds </h5><br>  I told about this mechanism in the <a href="http://habrahabr.ru/blogs/vs/117663/">last article</a> . <br>  <b>Result</b> : 3 minutes 24 seconds or -22.73% by the time of compilation. <br><img src="https://habrastorage.org/storage/cceb6ab2/713d7967/7c197bd1/d871133d.png"><br>  <b>Conclusion</b> : reducing compile time significantly.  I have already written about all the advantages and disadvantages of this technique, you can decide whether to use it or not. <br><br><h5>  Completion of extra programs </h5><br>  The programs working in parallel with Studio eat memory and processor resources.  Closing them can have a positive effect on the speed of the Studio.  So, I close Skype, QIP, Dropbox, GTalk, DownloadMaster, Mysql server. <br>  <b>Result</b> : 4 minutes 15 seconds or -3.41% at compile time <br><img src="https://habrastorage.org/storage/9eb42152/c959cf13/d7b25555/9c7486ef.png"><br>  <b>Conclusion</b> : at compile time you will have to do without other programs.  No jokes and pornoes while it is compiled there.  It is unlikely that a complete rejection of all programs is possible for the developer, but you can create bat files that turn on / off all the excess and sometimes use them. <br><br><h5>  Disable Antivirus </h5><br>  If you have an antivirus installed on your system, then this <s>bastard is a</s> useful program that constantly checks all file operations.  Thus, each compiling file will be awarded the watchful eye of the watchful guard, which may slow down the compilation time.  Frankly, I was not sure how to set up my antivirus so that I could be sure that I ignored my project completely and simply deleted it.  Your antivirus may be configured as desired. <br>  <b>Result</b> : 3 minutes 32 seconds or -19.07% at compile time <br><img src="https://habrastorage.org/storage/0b8dfb00/3e34e0a2/6fd920f9/e97f2cbe.png"><br>  <b>Conclusion</b> : an amazing result.  For some reason I was sure that all these * .cpp.  * .h, * .obj files are completely ignored by the antivirus and only compiled executable programs will receive attention, which will not slow down the work very much.  However, the fact is - almost a minute of saving time. <br><br><h5>  Defragment the hard drive </h5><br>  File operations are performed faster on a defragmented disk, and compilation is a huge number of file operations.  I deliberately left this experiment for the last, because it is impossible to cancel the disk defragmentation, and I wanted to make the experiments as independent as possible. <br>  <b>Result</b> : 4 minutes 8 seconds or -6.06% at compile time <br><img src="https://habrastorage.org/storage/eff735e0/aea94182/d30a8d1c/7bba6fe0.png"><br>  <b>Conclusion</b> : practice is consistent with theory.  Set yourself a defragmentation in the scheduler and more often. <br><br><h4>  Ways that would probably help, but it didn't work out </h4><br><br><h5>  Switch to 64-bit Windows </h5><br>  There is an assumption that this would give some performance gains, but porting our project to x64, due to its specificity, does not have a very high priority and is not yet implemented.  Accordingly, there is nothing to test. <br><br><h5>  Upgrading processor, memory, replacing HDD with SSD or RAID </h5><br>  I must say that my test machine is not so bad and it is still far from a planned upgrade.  We work with what is.  According to reviews on the Internet, the installation of SSD has the greatest impact on compile time. <br><br><h5>  Delivering seldom-changing projects to a separate solution. </h5><br>  This has already been done.  If in your project this is not yet implemented - be sure to do it. <br><br><h5>  Xoreax's IncrediBuild or equivalent </h5><br>  The distribution of compilation between computers is already quite a cardinal step.  It requires the purchase of special software, serious configuration and some "turning inside out" the build process.  But in very large projects this may be the only possible option.  The site <a href="http://www.xoreax.com/">Xoreax's IncrediBuild</a> has data on productivity <a href="http://www.xoreax.com/">gains</a> , customer stories and a lot of <s>other spam with</s> various useful information on the topic. <br><br>  That's all I wanted to talk about how to speed up the compilation of solutions in Visual Studio, and in the next <a href="http://habrahabr.ru/blogs/vs/117675/">article</a> I will give some tips on how to speed up the work of the IDE itself. </div><p>Source: <a href="https://habr.com/ru/post/117670/">https://habr.com/ru/post/117670/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117661/index.html">Recover killed MBR and partition table</a></li>
<li><a href="../117662/index.html">The Program of Encouraging the Authors is ‚Äúpitfalls‚Äù about which it is better to learn in advance</a></li>
<li><a href="../117663/index.html">Accelerate Visual Studio Part I. Unity Builds</a></li>
<li><a href="../117664/index.html">Source Board - hosting code</a></li>
<li><a href="../117668/index.html">What we should build a network</a></li>
<li><a href="../117672/index.html">Widgets. Custom fonts</a></li>
<li><a href="../117674/index.html">We will get rid of unnecessary bla-bla-bla in emails</a></li>
<li><a href="../117675/index.html">Accelerate Visual Studio Part III. IDE performance</a></li>
<li><a href="../117677/index.html">Doc, is this rubbish ?! Here we need it</a></li>
<li><a href="../117678/index.html">"Enemies of the People" Massive Multi-User Socio-Political Platform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>