<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fast server side integration ASP.NET + Facebook</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It turned out that I had to face integration with Facebook on the ASP.NET platform. The integration needed a server-side, so it was decided to use the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fast server side integration ASP.NET + Facebook</h1><div class="post__text post__text-html js-mediator-article">  It turned out that I had to face integration with Facebook on the ASP.NET platform.  The integration needed a server-side, so it was decided to use the Facebook C # SDK. <br>  As it turned out, the process is not quite complicated, but it is important to understand the essence and principle. <br><a name="habracut"></a><br>  Firstly a small disclaimer - the example below does not claim to be the proud title of production.  His goal is to give a basic concept of the topic. <br><br>  We divide the example into several steps: <br><br><h4>  Step 0: Minimum Theory </h4><br>  In fact, the minimum theory is bad.  The theoretical part is important to understand, so as not to engage in copy-pasting without understanding what the code is doing. <br>  Details of authentication / authorization from Facebook can (and should) be read here - <a href="https://developers.facebook.com/docs/authentication/">developers.facebook.com/docs/authentication</a> <br>  In short, we are building a web application and we want: <br><ol><li>  To authenticate users through Facebook. </li><li>  Get access to user data (name, userpic). </li><li>  To get the opportunity to post on the wall of the user on behalf of our application. </li><li>  A million dollars in small bills and a helicopter. </li></ol><br>  Next, we look at how to implement the first three points. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To work points 2 and 3, we need a certain <b>access token</b> , which Facebook will issue only if item number one is successfully passed.  <b>access token</b> is a kind of confirmation of the access right that our application requested (and received) from the user. <br><br>  To get this in our web application will be a LOGIN button.  Clicking this button will open the standard Facebook authentication / authorization window.  If necessary, the user will go through the standard Facebook enter username / password.  Then he will be asked if he agrees to log in to the application XXX.  The final step is to ask whether the user agrees to authorize the application XXX on his behalf to do actions A, B, C. (In the older version of the authentication dialog, the last two steps were on the same screen, now they are two different screens).  After the user confirms all of the above, he will be redirected to the URL that we set at the very beginning of the process.  As a parameter, Facebook will add to this URL some code ( <b>code</b> ), which we use to get the cherished <b>access token</b> .  It is important to remember that from the moment you press the LOGIN button, everything happens in a pop-up window.  At the end of the authorization process, we will close it and reload the window with our web application. <br><br>  So let's get started. <br><br><h4>  Step 1: Create a Facebook Application </h4><br>  Go to <a href="https://developers.facebook.com/apps">developers.facebook.com/apps</a> <br>  Create a new app. <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/fb-01.png" alt="image"><br>  Specify the name of the application.  App Namespace can be left blank.  Carefully read and agree with the Facebook Platform Policies. <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/fb-02.png" alt="image"><br>  Remember (write) App ID and App Secret.  We still need them. <br>  Select the method of website integration.  We enter <b>http: // localhost: 12345 /</b> in the Site URL. authentication / authorization). <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/fb-03.png" alt="image"><br>  Everything.  With the Facebook finished. <br><br><h4>  Step 2: Create and configure the project, add the Facebook SDK. </h4><br>  In Visual Studio, create a new project.  For simplicity, I used the usual ASP.NET Web Application, with MVC everything is pretty identical.  We call our project FBIntegrationSample. <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/00.png" alt="image"><br><br>  Right click on References, select Add Library Package Reference ... <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/01.png" alt="image"><br><br>  Go to the section Online - All, and look for facebook.  We are interested in the three marked components.  If you need to install all three for MVC applications, for the usual ASP.NET Web Application, the top two are enough. <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/02.png" alt="image"><br><br>  Next little trick.  With the default settings, IIS will use different ports for each restart, which does not suit us.  Therefore, we go to the project properties, to the Web tab and set the specific port on which we want to start our server.  For example - 12345. <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/03.png" alt="image"><br><br>  The last step is to find an element called <b>&lt;facebookSettings /&gt;</b> in the <b>web.config</b> (usually at the very end of the file) and add the <b>appId</b> and <b>appSecret</b> obtained in the previous step. <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/04.png" alt="image"><br><br><h4>  Step 3: Code </h4><br>  Create a class <b>FBUser</b> , which will store user data (for simplicity, after receiving user data we will save the object in the session) <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/code-01.png" alt="image"><br><br>  Create a <b>Default.aspx</b> , which will have a login button and two elements for user data. <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/code-02.png" alt="image"><br><br>  In <b>Default.aspx.cx</b> we will try to pull the <b>FBUser</b> object <b>out</b> of the session.  If it didn't work out, create a link for the authorization window, otherwise use the user's data - we will show his name, userpic and even make a post on his wall. <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/code-03.png" alt="image"><br><br>  Create the <b>FBAuthHandler.cs</b> class.  Using the <b>Facebook C # SDK,</b> create a URL for the login window. <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/code-04.png" alt="image"><br><ul><li>  <b>redirectUrl</b> - the URL to which the redirection will be made at the end of the authorization process. </li><li>  <b>extendedPermissions</b> is what will allow us to perform various actions on behalf of the user (to post on his wall, etc.). </li><li>  <b>response_type</b> should be code.  Otherwise, Facebook will return us a token using the hash tag (#), i.e.  from the server side, we will not have access to it, and this absolutely does not suit us. </li><li>  <b>Display</b> - popup.  You can, of course, load the login window to the full screen instead of our application and then return to it, but this is not what we want. </li></ul><br>  <a href="https://developers.facebook.com/docs/reference/api/permissions/">More on extended permissions</a> <br>  <a href="https://developers.facebook.com/docs/reference/dialogs/">More about display</a> <br><br>  Add a second method to <b>FBAuthHandler.cs</b> , which will check if the response from <b>Facebook</b> is returned with the parameter we need. <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/code-05.png" alt="image"><br><br>  In case of success, we create the FBUser <b>object</b> and put it into the session. <br><br>  Add a little JavaScript in <b>Default.aspx</b> , which when you click on the login button will open a pop-up window with the URL we need. <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/code-06.png" alt="image"><br><br>  The last thing left for us is to create <b>FacebookOAuth.aspx</b> , which will be redirected to after the end of the authorization process.  It is important to remember that <b>FacebookOAuth.aspx</b> will open in a pop-up window, so we use this file to <br>  a.  Check whether the code is returned from Facebook.  If yes - we create the <b>FBUser</b> object. <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/code-07.png" alt="image"><br><br>  b.  Close the pop-up window and reload the main window. <br><img src="http://dl.dropbox.com/u/5249810/habrapost01/code-08.png" alt="image"><br><br><h4>  Step 4: Test </h4><br><img src="http://dl.dropbox.com/u/5249810/habrapost01/res-01.png" alt="image"><br><br><img src="http://dl.dropbox.com/u/5249810/habrapost01/res-02.png" alt="image"><br><br><img src="http://dl.dropbox.com/u/5249810/habrapost01/res-03.png" alt="image"><br><br><img src="http://dl.dropbox.com/u/5249810/habrapost01/res-04.png" alt="image"><br><br><img src="http://dl.dropbox.com/u/5249810/habrapost01/res-05.png" alt="image"><br><br>  Source code available here - <a href="">http://dl.dropbox.com/u/5249810/habrapost01/FBIntegrationSample.zip</a> </div><p>Source: <a href="https://habr.com/ru/post/134884/">https://habr.com/ru/post/134884/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134878/index.html">Meet the Gem. Part two</a></li>
<li><a href="../134879/index.html">"Ticking" clock with an alarm clock on the Atmega48 microcontroller</a></li>
<li><a href="../134880/index.html">Pro Wi-Fi in a dress, LED-linen and a pair of shoes</a></li>
<li><a href="../134881/index.html">ReactOS News Release # 89</a></li>
<li><a href="../134882/index.html">Sed, vari sed</a></li>
<li><a href="../134885/index.html">Detective story about SQL injection, sometimes blind</a></li>
<li><a href="../134886/index.html">How to overcome traditional problems in the implementation of Agile</a></li>
<li><a href="../134888/index.html">MsBuild Minimal Project</a></li>
<li><a href="../134890/index.html">Electronic signature in the browser using OpenSSL and SKZI Rutoken EDS</a></li>
<li><a href="../134891/index.html">Why IoC, DI and Kaiten :: Container Magic Pill are so rarely used in Perl</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>