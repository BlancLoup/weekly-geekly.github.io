<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Citrix XenServer Free 5.6 Security or "... you need to find a different hypervisor"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The further virtualization technologies develop, the more diverse ‚ÄúIT technology giants‚Äù are entering the market. Despite the fact that the Xen projec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Citrix XenServer Free 5.6 Security or "... you need to find a different hypervisor"</h1><div class="post__text post__text-html js-mediator-article">  The further virtualization technologies develop, the more diverse ‚ÄúIT technology giants‚Äù are entering the market.  Despite the fact that the Xen project itself has existed for a long time as an open source solution, an operating system with an integrated hypervisor like Citrix XenServer recently attracted the attention of Enterprise-level clients.  Initially, the OS was focused on low / mid-end enterprises and was designed to solve the problems of minimizing the costs of a multi-server architecture.  But in the development process, Citrix integrated into its hypervisor such vital things as High Availability and Likewise integration with Active Directory.  Thus, at the moment there are commercial versions of Citrix XenServer positioned as a real alternative to VMWare ESX / ESXi.  But, as you know, special security requirements are imposed on hypervisors.  This is because when a hypervisor is captured, it‚Äôs most likely that the company will lose not only it, but all the virtual machines. <br><br><img src="https://habrastorage.org/storage2/16c/802/f05/16c802f05d41022beba6f39e8113e7fa.jpg"><br><br><a name="habracut"></a><br>  More and more, vendors are releasing their documentation on how to configure both the system and the Hardening / Security Guide class manuals.  Citrix has released Common Criteria Security Target and User Security Guide documents.  These documents have a number of recommendations and advice, but have too little practical information.  In the CCST documentation, you can find a formal description of the protection object and a number of practical settings.  In User Security, the company described a common system security methodology.  Thus, a full-fledged Citrix Security Guide, which would fully cover all aspects, is unfortunately not available. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In 2011, Citrix was awarded the title Security Organization of the Year by ISSA.  It was emphasized that the term "Secured By Design" applies to Citrix products.  Perhaps some of the solutions from this company can be attributed to this category, but the study of their XenServer server products showed the presence of some specifics of their design and the peculiar interpretation of this term by a group of Citrix experts.  In our article, we will explore some aspects of using Citrix Free XenServer 5.6.0 and security issues that may possibly arise from the practical use of this system.  The choice of this particular version is due to a fairly high prevalence and popularity.  Much of what has been said below has not undergone any changes in the versions of the 6th family. <br><br>  The foundation of the entire hypervisor is XenAPI (XAPI).  This is a daemon executed by the system with superuser privileges and providing an interface for managing the system itself and the virtual machines.  Being a direct relative of the Red Hat Enterprise Linux operating system, the hypervisor inherited a number of standard solutions from the progenitor.  This is the PAM module responsible for connecting to XAPI. <br><br>  This module is configured by default to fully include the default settings from system-auth.  In practice, this means that any user who has an account in the system can execute XAPI requests with pool-admin privileges except for changing the root password using the API.  This feature of the system is documented and inherent in the Free and Advance versions.  According to Citrix policy, when using these XenServer options, you have a system with a ‚Äúsingle level‚Äù of the user, LSU (Local Super User).  This decision by Citrix seems doubtful as part of the ideology of building Enterprise-level products in its public understanding. <br><br>  This specificity creates some problems in terms of using the hypervisor as a multi-user system.  In order to create distinctions, it is necessary to adjust the PAM settings of the xapi module in such a way as to limit the circle of persons allowed to control the hypervisor.  There are a lot of possibilities for this, all standard PAM tools are at your disposal.  A description of the features of PAM and ideas for configuring XAPI security can be found in the <a href="http://debian.securedservers.com/kernel/pub/linux/libs/pam/Linux-PAM-html/Linux-PAM_SAG.html">‚ÄúThe Linux-PAM System Administrators Guide‚Äù</a> from Andrew G.Mortan and Thorsten Kukuk. <br><br>  Another specific feature of XAPI is the presence of remote control over HTTP / HTTPS in the system.  The daemon keeps ports 80 and 443 open on the administrative interface.  In this article, we will not consider multi-interface systems; this problem is a little less acute there, given the possibility of a physical separation of the control network.  But I would like to note that this layout is necessary for any production solution. <br><br><img src="https://habrastorage.org/storage2/52a/006/4fc/52a0064fc227cc403e7d66f65497ad2d.png"><br><br>  Quite often, the administrative interface is also common for data transfer and cascading of virtual machines.  Thus, any control over port 80 without using SSL tunnels allows an attacker to at least use a sniffer and get system settings, and how to maximize a successful code injection or intercept a management session.  As a solution, iptables is optimal.  In general, it is worth limiting the traffic arriving at 80 \ 443 ports in the system.  This issue is adequately addressed in a Citrix Common Criteria Evaluated Configuration Guide for Citrix XenServer 5.6, Platinum Edition. <br>  In order to clarify the next place of concern, dive a little deeper into the motor skills of Citrix XenServer.  For ease of access to virtual machines, the hypervisor uses the transfer of text / graphic guest consoles on XAPI.  To do this, use a small program vncterm.  The work ideology is approximately the following: When a console requests a XAPI tool, a fork of the <b>vncterm</b> process is <b>created</b> on the loopback interface and transmitted to the XAPI user. <br><br><img src="https://habrastorage.org/storage2/8dc/ef0/169/8dcef0169d956fd07aea14ae9f51f1ae.png"><br><br>  This happens with all hosts, including the hypervisor host itself.  With a few exceptions.  If you connect to a hypervisor host, instead of sending it for authentication, the Citrix authoring code is executed, giving you instant access to the local console as root. <br><br><img src="https://habrastorage.org/storage2/80f/c38/e44/80fc38e444b9ee87b183b671d8672321.png"><br><br>  Any user who has access to XAPI on the server without being tied to Active Directory will be able to get root access to the hypervisor host. <br><br>  As a secondary problem of vncterm, we note a single session for all.  That is, by creating a session on the guest system as root and forgetting to log out of the guest system, you will leave the open VNC channel.  The next time you request this guest, any XAPI user will receive that same open session.  Compromise system is inevitable.  Note that local user authentication also happens automatically on mingetty ‚Äìautologin root with automatic xsconsole loading. <br><br><img src="https://habrastorage.org/storage2/5b7/c91/a43/5b7c91a43d7746b256a1a6c9e05993ae.png"><br><br>  This is not critical, but sh code injection is theoretically possible.  Therefore, you should limit the issuance of superuser privileges in the system. <br><br>  Another problem is the transfer of virtual machines between servers in XenMotion mode.  It occurs through the 80th port of the system in plain-text mode.  Thus, the attacker has the ability to intercept data "on the fly."  The solution to this problem is only one - the use of IP level encryption.  But this is not the only problem with data transfer, - just by default, the iSCSI service transmits credentials in the clear.  This problem is solved by activating CHAP. <br><br>  Citrix XenServer uses several virtual machine storage modes: <s>as LVM and as VHD files.</s>  in the form of LVM sections or individual files.  The first mode can be regarded as conditionally safe, since only the superuser has the right to mount partitions.  But the <s>VHD</s> storage mode as separate files is another security issue.  The file is created with the standard umask from server scripts: rw-rr.  Thus, the virtual machine is available to any user of the system.  This problem is solved by the method of fixing the scripts, which will be described in Positive Technologies Citrix XenServer 5.6 Security Guide. <br><br>  Since the system is a descendant of RHEL, it inherited their RPM package management system along with the yum add-on.  Initially on the system, if you try the trivial ‚Äúyum update‚Äù, you will not receive system updates.  <s><i>Although clearly feel that behind a beautiful screensaver dinosaur hiding Linux</i></s> .  The problem is that Citrix is ‚Äã‚Äãblocking connectivity to CentOS repositories at the yum configuration level.  Of course, it is not a problem to turn them back on and perform a system update.  But this action will lead to the early rest of the hypervisor due to the fact that Citrix changed some standard things in the system to their ‚Äúreligiously-faithful‚Äù ones, and now the roll-up of updates leads to the system crash.  Since some packages in the system are detected by the security scanner as having vulnerabilities of the ‚Äúcritical‚Äù level (dhclient for example), the installation of updates becomes mandatory.  To solve such problems, you need a security scanner, yum, dump, and patience. <br><br>  I would like to note that from the general settings of the system ‚Äúout of the box‚Äù there is an important slip in the settings of the pam_unix.so module.  More specifically, it does not include the password storage mode in / etc / shadow. <br>  Thus, given the standard permissions on the / etc / passwd file, there is potential access to the system password hashes.  This also applies to the system's motor skills with NFS storages.  Citrix XenServer Administration Guide recommends setting the no_root_squash option on the NFS server.  Such a solution is standard for hypervisors, and such storage should be isolated from the outside world as much as possible using iptables tools or the like.  In addition, of course, you should adjust the file creation modes and remap the root user to a specialized system user. <br><br>  Thus, summing up as a whole, it turns out that the Citrix Free XenServer product in the initial configuration has several possible serious security problems "by design".  Many of them are common problems for the RHEL family, others are unique to this system.  Of course, from the point of view of Citrix, these are not problems, but architecture features of their hypervisor.  The security issues and the overall security methodology for this OS will be presented in the document Positive Technologies: Citrix XenServer Security Guide, which will be released in open beta testing in the near future. </div><p>Source: <a href="https://habr.com/ru/post/138622/">https://habr.com/ru/post/138622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138612/index.html">Internet blocked again in Iran</a></li>
<li><a href="../138615/index.html">Secure Payments with ActivateTo Codes (Part II)</a></li>
<li><a href="../138617/index.html">Communicator Huawei Honor - impressions of use</a></li>
<li><a href="../138619/index.html">MVC Application: Mail</a></li>
<li><a href="../138620/index.html">Combining mobile and fixed communications: how it works from the inside</a></li>
<li><a href="../138623/index.html">NFC tags from metro maps</a></li>
<li><a href="../138625/index.html">Sort: key vs cmp</a></li>
<li><a href="../138627/index.html">Django Meetup - March 1 in Moscow</a></li>
<li><a href="../138628/index.html">Black holes and gold mines on the web development market</a></li>
<li><a href="../138629/index.html">Development of a WEB project on Node.JS: Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>