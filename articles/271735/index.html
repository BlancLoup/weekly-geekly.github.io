<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing data to Teradata using DML</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you go right and straight, you will not get far ... 
 (Little Prince, Antoine de Saint-Exupery) 
 

 Recently, a colleague approached me with a req...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing data to Teradata using DML</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <i>If you go right and straight, you will not get far ...</i> <i><br></i>  <i>(Little Prince, Antoine de Saint-Exupery)</i> <i><br></i> <br></blockquote><br>  Recently, a colleague approached me with a request to somehow help with Teradata.  She is now actively implementing and the first step of this implementation is to download data on a daily basis.  You have to pour a lot and as soon as possible.  I was asked to find some alternative ways to load data into Teradata, which would not be very dependent on the resources allocated to the user.  In the course of this work, I had to become more closely acquainted with the .NET Data Provider for Teradata.  In the course of our acquaintance, some curious details were found out, the knowledge of which, in my opinion, can be very useful.  Since not everyone knows about Teradata, I will begin with a brief description of it. <br><a name="habracut"></a><br><br><h3>  What is Teradata </h3><br>  <b>From the point of view of a programmer who downloads and gets data from it:</b> <br>  Teradata is a large data repository that people are trying to optimize with using a software and hardware architecture.  The architecture focuses on concurrency. <br><br>  <b>From <a href="https://en.wikipedia.org/wiki/Teradata">Wikipedia</a></b> : <br>  Teradata is a massively parallel architecture.  Its technology consists of hardware, software, database, and consulting.  It can be recalled and analyzed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Data loading in Teradata </h3><br>  Downloading / Uploading large amounts of data to Teradata is suggested using <br>  <a href="https://en.wikipedia.org/wiki/Teradata">Teradata Load and Unload Utilities</a> .  There are currently the following utilities: <br><ul><li>  Teradata TPump </li><li>  Teradata FastLoad </li><li>  Teradata MultiLoad </li><li>  Teradata FastExport </li><li>  BTEQ </li></ul><br>  Our company uses mainly <a href="http://www.teradatatech.com/%3Fp%3D862">Teradata FastLoad</a> .  As <a href="https://ru.wikipedia.org/wiki/ETL">ETL we</a> use the product of the company <br>  <a href="https://www.informatica.com/products/data-integration.html">Informatica</a> . <br><br>  Compared with DML, the load / unload utilities in Teradata require a deeper immersion into the Teradata theory.  In particular: <br><ul><li>  need to be able to customize them </li><li>  know the principle of work </li><li>  take into account their specifics and the limitations that they impose on the tables in which they are being written </li><li>  Teradata administrator may impose a number of restrictions on their work </li></ul><br>  From here, the method of recording data using the Insert DML command is still relevant.  DML is more common, less demanding of settings and supported by Teradata.  I decided to check how effectively this command can be used.  For the purpose of the experiment, a test project was created, the purpose of which was to understand the principles of operation of the Terdata provider.  First of all, I tried to solve the problem in the forehead - read one line from Oracle and then insert it into Teradata, but this method turned out to be very slow.  In order to find the culprit, I upgraded the program - now she read from Oracle, creating a stream for each line that inserted data into Teradata.  For the rapidly growing number of threads, it became clear that the main culprit for the low speed was Insert operations in Teradata.  Realizing that inserting a single line takes a lot of time, I tried to insert several lines at once, separating ';'  insert commands.  The speed has increased significantly.  Increasing the number of lines inserted at one time I came to Exception: <br><br><pre><code class="sql hljs">[.NET Data Provider for Teradata][100056] Total size of parameters is greater than the max Data parcel size.</code> </pre> <br>  Having rummaged in source codes, I found the place where this exception occurred: <br><br><pre> <code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bodyLength &gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._maxParamRowSpace || bodyLength - num &gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._sessionContext[<span class="hljs-type"><span class="hljs-type">WpSessionContext</span></span>.<span class="hljs-type"><span class="hljs-type">SessionLimits</span></span>.<span class="hljs-type"><span class="hljs-type">MaxDataParcelSize</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">UtlTrace</span></span>.<span class="hljs-type"><span class="hljs-type">TraceException</span></span>((<span class="hljs-type"><span class="hljs-type">Exception</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">TdException</span></span>(<span class="hljs-string"><span class="hljs-string">"InvalidDataPclSize"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class">[0]))</span></span>;</code> </pre><br>  I didn‚Äôt manage to calculate the exact size of Data parcel, as the numbers, which in theory were sort of true, were broken about the practice, when I simply changed the number of fields and their type in the Insert operation.  But from the source, it is clear that an exception appears before accessing Teradata, inside the provider, which allows the loop to increase the number of Insert operations until the error occurs, since there is no waiting time from Teradata. <br><br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { numParamsInExec = _oneExec(ref com, numParamsInExec, ref <span class="hljs-built_in"><span class="hljs-built_in">err</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">err</span></span> == <span class="hljs-keyword"><span class="hljs-keyword">Const</span></span>.ERR_100056);</code> </pre><br>  Thus, we determine the maximum number of Insert operations at a time.  Next, perform the insertion of data packets, in the case of Exception 100056, reduce the size of the package.  This solution significantly increased the speed of writing data to Teradata, without using special utilities.  From here, this method can be used if you are limited in resources or to record relatively small amounts of data in Teradata. </div><p>Source: <a href="https://habr.com/ru/post/271735/">https://habr.com/ru/post/271735/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271725/index.html">Yandex announces its own weather forecasting technology Meteum. Accurate to home</a></li>
<li><a href="../271727/index.html">Draw, draw, draw: Inkscape 0.92 coming soon</a></li>
<li><a href="../271729/index.html">PythonDigest - issue number 100 and other great news</a></li>
<li><a href="../271731/index.html">OOP in 1C do it yourself. How to simulate your classes and objects, and why it is needed</a></li>
<li><a href="../271733/index.html">Why would a developer scoff at his own code</a></li>
<li><a href="../271737/index.html">Floating toolbar for text selection in Android Marshmallow: parsing innovations</a></li>
<li><a href="../271739/index.html">PostCSS quick start</a></li>
<li><a href="../271741/index.html">Welcome to GDG DevFest Omsk 2015</a></li>
<li><a href="../271745/index.html">Successful implementation of SIEM. Part 1</a></li>
<li><a href="../271747/index.html">Asterisk: Prioritizing VoIP traffic and reserving Internet access from two providers on MikroTik</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>