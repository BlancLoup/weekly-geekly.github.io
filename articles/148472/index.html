<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We build a report on the membership of users in AD groups: 4 problems in writing a Powershell script</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bill Stewart, scripting guru, in his article on WindowsITPro, describes the problems he had to face when writing a Powershell script that would deduce...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We build a report on the membership of users in AD groups: 4 problems in writing a Powershell script</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage2/1a4/bfb/7e6/1a4bfb7e6ada9924c5df1b9d5138a09d.png"><br>  Bill Stewart, scripting guru, in his <a href="http://www.windowsitpro.com/content1/topic/auditing-active-directory-users-groups-141463/catpath/scripting/page/1">article on WindowsITPro,</a> describes the problems he had to face when writing a Powershell script that would deduce user membership in Active Directory groups.  I had to make 4 improvements to make it work as it should.  You can find out how Bill implemented the group membership output, and you can download the Powershell script itself under the cat. <br><a name="habracut"></a><br>  <b>Link to the final script.</b> <br>  <a href="">www.windowsitpro.com/content/content/141463/141463.zip</a> <br><br>  I lost count, how many times have I met the question on the forums: ‚ÄúDoes anyone know how to get information about all users and their membership in groups in the AD domain?‚Äù.  Auditors and information security consultants also ask a similar question when they assess the Active Directory infrastructure (environment) in an organization.  Since this question is quite urgent, I decided to write a PowerShell script that would simplify this task. <br>  At first, I thought that writing a similar script was a couple of trifles, but on my way I encountered 4 obstacles that complicated my work.  I will describe these issues a little later, but first I would like to talk about the basics of using Microsoft.NET in Powershell when searching by AD. <br><br><h4>  Using .NET to search by AD </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Using .NET to search by AD, you can use the type accelerator in PowerShell to search for objects.  (Type accelerator - abbreviated name for .NET class).  For example, enter the following command to list all users in this domain: <br><br><pre><code class="vbscript hljs">PS C:\&gt; $searcher = <span class="hljs-string"><span class="hljs-string">"(&amp;(objectCategory=user)(objectClass=user))"</span></span> PS C:\&gt; $searcher.FindAll()</code> </pre> <br><br>  [ADSISearcher] is a type accelerator for a .NET System.DirectoryServices.DirectorySearcher object.  The string after this type accelerator sets the <b>SearchFilter</b> properties for this object to find all user objects, and the <b>FindAll</b> method starts the search.  At the exit, we get a list of <b>System.DirectoryServices.SearchResult</b> objects. <br>  Then we want to determine which group the user is in.  To find out, we can use the Properties collection from the <b>SearchResult</b> object and extract an object attribute such as memberof.  Using the $ searcher variable from the previous example, we can use the <b>FindOne</b> method (instead of <b>FindAll</b> ) to retrieve one result and display the user's membership in groups: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; $result = $searcher.FindOne() PS C:\&gt; $result.Properties[<span class="hljs-string"><span class="hljs-string">"memberof"</span></span>] | sort-object</code> </pre><br><br>  The first command finds the first user that matches the search filter, and the second command lists the groups the user is in. <br>  However, if you look closely at this list, you will notice the absence of an important detail: the user's primary group is not included in the <b>memberof</b> attribute.  I would like to get a complete list of groups (including the main group), which leads to the first problem. <br><br><h4>  Problem # 1: How to find the user's main group </h4><br><br>  There is a workaround for excluding the main group from the memberof attribute.  It is described in this article <a href="http://support.microsoft.com/kb/321360">support.microsoft.com/kb/321360 We</a> perform the following actions: <br><ol><li>  Connect to the user's object using the WinNT provider (instead of the LDAP provider). </li><li>  Retrieve the user attribute primaryGroupID. </li><li>  Extract user group names using the WinNT provider, which includes the main group. </li><li>  Search these groups in AD using their <b>sAMAccountName</b> attributes. </li><li>  Find the group in which the primaryGroupToken attribute matches the user attribute <b>primaryGroupID</b> . </li></ol><br>  The problem with this ‚Äúworkaround‚Äù is that it requires the WinNT provider script to connect to the user object.  That is, it is necessary that the script translate the distinguished name of the user (for example, CN = Ken Myer, OU = Marketing, DC = fabrikam, DC = com) to a format that the WinNT provider can use (for example, WinNT: // FABRIKAM / kenmyer, User). <br><br><h4>  Problem # 2: Translation from one name format to another </h4><br><br>  The <b>NameTranslate</b> object is a COM (ActiveX) object that uses the <b>IADsNameTranslate</b> interface, which translates the names of AD objects to alternate formats.  You can use the <b>NameTranslate</b> object by creating an object and then calling its Init method to initialize.  For example, list 1 shows the code of a VBScript script that the <b>NameTranslate</b> creates and initializes. <br><br>  Listing 1: Creating and initializing a NameTranslate object in VBScript <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> ADS_NAME_INITTYPE_GC = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> NameTranslate <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> NameTranslate = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"NameTranslate"</span></span>) NameTranslate.Init ADS_NAME_INITTYPE_GC, vbNull</code> </pre><br><br>  However, the <b>NameTranslate</b> object <b>does</b> not work as expected in PowerShell, as shown in Figure 1. <br><br><img src="https://habrastorage.org/storage2/c74/f17/ee1/c74f17ee1dfc34de6e976c2b4e94e25c.jpg"><br>  Figure 1: Unexpected behavior of the NameTranslate object in PowerShell <br><br>  The problem is that the <b>NameTranslate</b> object <b>does</b> not have a type library that .NET (and therefore PowerShell) uses to provide simple access to COM objects.  But fortunately, this problem can be circumvented: the .NET <b>InvokeMember</b> method allows PowerShell to get or set properties or call a method from a COM object that is not in the type library.  Listing 2 shows the Powershell equivalent of the VBScript script code shown in Table 1. <br><br>  List 2: Creating and initializing a NameTranslate object in PowerShell <br><br><pre> <code class="vbscript hljs">$ADS_NAME_INITTYPE_GC = <span class="hljs-number"><span class="hljs-number">3</span></span> $NameTranslate = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>-object -comobject NameTranslate [Void] $NameTranslate.GetType().InvokeMember(<span class="hljs-string"><span class="hljs-string">"Init"</span></span>, <span class="hljs-string"><span class="hljs-string">"InvokeMethod"</span></span>, $<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, $NameTranslate, ($ADS_NAME_INITTYPE_GC, $<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>))</code> </pre><br><br>  I wanted the script to solve another name problem.  The <b>memberof</b> attribute for user AD contains a list of distinguished names in which the user is a member, but instead I wanted to get the samaccountname attribute for each group.  The script uses the <b>NameTranslate</b> object to deal with this problem. <br><br><h4>  Problem # 3: What to do with special characters </h4><br><br>  Microsoft's documentation regarding distinguished names mentions that individual characters must be omitted (for example, with the prefix ‚Äú\‚Äù) in order to be interpreted in the right way (more detail is written in <a href="http://msdn.microsoft.com/en-us/library/aa366101.aspx">this article</a> ).  Fortunately, the COM object Pathname gives this opportunity.  The script uses the <b>Pathname</b> object to skip those distinguished names that contain special characters.  The Pathname object also requires the .NET method <b>InvokeMember</b> because, like the <b>NameTranslate</b> object, this object does not have a type library. <br><br><h4>  Problem # 4: Increase Productivity </h4><br><br>  If you look back at Problem # 1 (How to find the main group of a user), you will notice that a workaround requires searching for user groups.  Doing this procedure for multiple accounts, you will understand how it is not optimal.  Extracting the <b>samaccountname</b> attribute for each group in the <b>memberof</b> attribute I mentioned when considering Problem # 2 (Translation from one name format to another) is also suboptimal and time consuming.  To solve this problem, the script uses two global hash tables (global hash tables), which produce hashing results for improved performance. <br><br><h4>  Get-UsersAndGroups.ps1 </h4><br><br>  <a href="">Get-UsersAndGroups.ps1</a> is a ready-to-use Powershell script that displays a list of users and their group memberships.  The script command line syntax is as follows: <br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-UsersAndGroups [[-SearchLocation] &lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>[]&gt;] [-SearchScope &lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>&gt;]</code> </pre><br><br>  The <b>-SearchLocation</b> parameter represents one or more distinguished names for user accounts.  Because the distinguished name contains commas (,), they must be placed in brackets (single or double) each distinguished name so that PowerShell does not interpret them as an array.  The parameter name <b>-SearchLocation is</b> optional.  The script also accepts pipeline input;  each value from the pipeline must be a distinguished name to search for. <br>  The <b>-SearchScope</b> value indicates the possible search scale for AD.  This value should be one of the following: <i>Base</i> - Search is limited to the base object, not used;  <i>OneLevel</i> - search for the nearest child objects of the base object and <i>Subtree</i> - search by color.  If this value is not specified, then the default is Subtree.  Use the <b>-SearchScope OneLevel</b> if you want a specific unit (OU), but none of the OU is nested.  The script displays objects that contain the properties listed in Table 1. <br><br><img src="https://habrastorage.org/storage2/06e/314/4d2/06e3144d243ef049b5cd8aa55614f256.jpg"><br><br><h4>  Overcoming 4 problems </h4><br><br>  The script solves the above problems: <br><ul><li>  Problem # 1: How to find the main group of the user: The function <b>get-primarygroupname</b> returns the name of the main group of the user. </li><li>  Problem # 2: Translation from one name format to another: The script uses the <b>NameTranslate</b> COM object to perform a translation from one name format to another. </li><li>  Problem # 3: What to do with special characters: The script uses the <b>get-escaped function</b> , which uses the <b>Pathname</b> object to return distinguished names with inserted missing characters (where appropriate). </li><li>  Problem # 4: Improving performance: The script uses the <b>$ PrimaryGroups</b> and <b>$ Groups</b> hash tables.  The keys in the <b>$ PrimaryGroups</b> hash table are the identifiers of the main group and their values ‚Äã‚Äãare the <b>samaccountname</b> attributes of the main group. </li></ul><br><br><h4>  Simplify auditing groups and users </h4><br>  Writing the script Get-UsersAndGroups.ps1 was not so simple as it seemed to me at first glance, but it could not be done easier.  The simplest script application is the following command: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-UsersAndGroups | Export-CSV Report.csv -NoTypeInformation</code> </pre><br><br>  It creates a .csv file that contains a complete list of users and groups for this domain.  The name in its arsenal is such a script, we can quickly and easily create a report for groups and users. <br><br>  <b>Once again we duplicate the link to the final script.</b> <br>  <a href="">www.windowsitpro.com/content/content/141463/141463.zip</a> <br><br>  <b>The script itself:</b> <br><br><pre> <code class="vbscript hljs"># <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-UsersAndGroups.ps1 # Written by Bill Stewart (bstewart@iname.com) #requires -version <span class="hljs-number"><span class="hljs-number">2</span></span> &lt;# .SYNOPSIS Retreves users, <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> group membership <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> user, from Active Directory. .DESCRIPTION Retreves users, <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> group membership <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> user, from Active Directory. Note that <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> user<span class="hljs-comment"><span class="hljs-comment">'s primary group is included in the output, and caching is used to improve performance. .PARAMETER SearchLocation Distinnguished name (DN) of where to begin searching for user accounts; eg "OU=Information Technology,DC=fabrikam,DC=com". If you omit this parameter, the default is the current domain (eg, "DC=fabrikam,DC=com"). .PARAMETER SearchScope Specifies the scope for the Active Directory search. Must be one of the following values: Base (Limit the search to the base object, not used), OneLevel (Searches the immediate child objects of the base object), or Subtree (Searches the whole subtree, including the base object and all its child objects). The default value is Subtree. To search only a location but not its children, specify OneLevel. .OUTPUTS PSObjects containing the following properties: DN The user's distinguished name CN The user's common name UserName The user's logon name Disabled True if the user is disabled; false otherwise Group The groups the user is a member of (one object per group) #&gt; [CmdletBinding()] param( [parameter(Position=0,ValueFromPipeline=$TRUE)] [String[]] $SearchLocation="", [String][ValidateSet("Base","OneLevel","Subtree")] $SearchScope="Subtree" ) begin { $ADS_NAME_INITTYPE_GC = 3 $ADS_SETTYPE_DN = 4 $ADS_NAME_TYPE_1779 = 1 $ADS_NAME_TYPE_NT4 = 3 $ADS_UF_ACCOUNTDISABLE = 2 # Assume pipeline input if SearchLocation is unbound and doesn't exist. $PIPELINEINPUT = (-not $PSBOUNDPARAMETERS.ContainsKey("SearchLocation")) -and (-not $SearchLocation) # If -SearchLocation is a single-element array containing an emty string # (ie, -SearchLocation not specified and no pipeline), then populate with # distinguished name of current domain. In this case, input is not coming # from the pipeline. if (($SearchLocation.Count -eq 1) -and ($SearchLocation[0] -eq "")) { try { $SearchLocation[0] = ([ADSI] "").distinguishedname[0] } catch [System.Management.Automation.RuntimeException] { throw "Unable to retrieve the distinguished name for the current domain." } $PIPELINEINPUT = $FALSE } # These hash tables cache primary groups and group names for performance. $PrimaryGroups = @{} $Groups = @{} # Create and initialize a NameTranslate object. If it fails, throw an error. $NameTranslate = new-object -comobject "NameTranslate" try { [Void] $NameTranslate.GetType().InvokeMember("Init", "InvokeMethod", $NULL, $NameTranslate, ($ADS_NAME_INITTYPE_GC, $NULL)) } catch [System.Management.Automation.MethodInvocationException] { throw $_ } # Create a Pathname object. $Pathname = new-object -comobject "Pathname" # Returns the last two elements of the DN using the Pathname object. function get-rootname([String] $dn) { [Void] $Pathname.GetType().InvokeMember("Set", "InvokeMethod", $NULL, $Pathname, ($dn, $ADS_SETTYPE_DN)) $numElements = $Pathname.GetType().InvokeMember("GetNumElements", "InvokeMethod", $NULL, $Pathname, $NULL) $rootName = "" ($numElements - 2)..($numElements - 1) | foreach-object { $element = $Pathname.GetType().InvokeMember("GetElement", "InvokeMethod", $NULL, $Pathname, $_) if ($rootName -eq "") { $rootName = $element } else { $rootName += ",$element" } } $rootName } # Returns an "escaped" copy of the specified DN using the Pathname object. function get-escaped([String] $dn) { [Void] $Pathname.GetType().InvokeMember("Set", "InvokeMethod", $NULL, $Pathname, ($dn, $ADS_SETTYPE_DN)) $numElements = $Pathname.GetType().InvokeMember("GetNumElements", "InvokeMethod", $NULL, $Pathname, $NULL) $escapedDN = "" for ($n = 0; $n -lt $numElements; $n++) { $element = $Pathname.GetType().InvokeMember("GetElement", "InvokeMethod", $NULL, $Pathname, $n) $escapedElement = $Pathname.GetType().InvokeMember("GetEscapedElement", "InvokeMethod", $NULL, $Pathname, (0, $element)) if ($escapedDN -eq "") { $escapedDN = $escapedElement } else { $escapedDN += ",$escapedElement" } } $escapedDN } # Return the primary group name for a user. Algorithm taken from # http://support.microsoft.com/kb/321360 function get-primarygroupname([String] $dn) { # Pass DN of user to NameTranslate object. [Void] $NameTranslate.GetType().InvokeMember("Set", "InvokeMethod", $NULL, $NameTranslate, ($ADS_NAME_TYPE_1779, $dn)) # Get NT4-style name of user from NameTranslate object. $nt4Name = $NameTranslate.GetType().InvokeMember("Get", "InvokeMethod", $NULL, $NameTranslate, $ADS_NAME_TYPE_NT4) # Bind to user using ADSI's WinNT provider and get primary group ID. $user = [ADSI] "WinNT://$($nt4Name.Replace('\', '/')),User" $primaryGroupID = $user.primaryGroupID[0] # Retrieve user's groups (primary group is included using WinNT). $groupNames = $user.Groups() | foreach-object { $_.GetType().InvokeMember("Name", "GetProperty", $NULL, $_, $NULL) } # Query string is sAMAccountName attribute for each group. $queryFilter = "(|" $groupNames | foreach-object { $queryFilter += "(sAMAccountName=$($_))" } $queryFilter += ")" # Build a DirectorySearcher object. $searchRootDN = get-escaped (get-rootname $dn) $searcher = [ADSISearcher] $queryFilter $searcher.SearchRoot = [ADSI] "LDAP://$searchRootDN" $searcher.PageSize = 128 $searcher.SearchScope = "Subtree" [Void] $searcher.PropertiesToLoad.Add("samaccountname") [Void] $searcher.PropertiesToLoad.Add("primarygrouptoken") # Find the group whose primaryGroupToken attribute matches user's # primaryGroupID attribute. foreach ($searchResult in $searcher.FindAll()) { $properties = $searchResult.Properties if ($properties["primarygrouptoken"][0] -eq $primaryGroupID) { $groupName = $properties["samaccountname"][0] return $groupName } } } # Return a DN's sAMAccount name based on the distinguished name. function get-samaccountname([String] $dn) { # Pass DN of group to NameTranslate object. [Void] $NameTranslate.GetType().InvokeMember("Set", "InvokeMethod", $NULL, $NameTranslate, ($ADS_NAME_TYPE_1779, $dn)) # Return the NT4-style name of the group without the domain name. $nt4Name = $NameTranslate.GetType().InvokeMember("Get", "InvokeMethod", $NULL, $NameTranslate, $ADS_NAME_TYPE_NT4) $nt4Name.Substring($nt4Name.IndexOf("\") + 1) } function get-usersandgroups2($location) { # Finds user objects. $searcher = [ADSISearcher] "(&amp;(objectCategory=User)(objectClass=User))" $searcher.SearchRoot = [ADSI] "LDAP://$(get-escaped $location)" # Setting the PageSize property prevents limiting of search results. $searcher.PageSize = 128 $searcher.SearchScope = $SearchScope # Specify which attributes to retrieve ([Void] prevents output). [Void] $searcher.PropertiesToLoad.Add("distinguishedname") [Void] $searcher.PropertiesToLoad.Add("cn") [Void] $searcher.PropertiesToLoad.Add("samaccountname") [Void] $searcher.PropertiesToLoad.Add("useraccountcontrol") [Void] $searcher.PropertiesToLoad.Add("primarygroupid") [Void] $searcher.PropertiesToLoad.Add("memberof") # Sort results by CN attribute. $searcher.Sort = new-object System.DirectoryServices.SortOption $searcher.Sort.PropertyName = "cn" foreach ($searchResult in $searcher.FindAll()) { $properties = $searchResult.Properties $dn = $properties["distinguishedname"][0] write-progress "Get-UsersAndGroups" "Searching $location" -currentoperation $dn $cn = $properties["cn"][0] $userName = $properties["samaccountname"][0] $disabled = ($properties["useraccountcontrol"][0] -band $ADS_UF_ACCOUNTDISABLE) -ne 0 # Create an ArrayList containing user's group memberships. $memberOf = new-object System.Collections.ArrayList $primaryGroupID = $properties["primarygroupid"][0] # If primary group is already cached, add the name to the array; # otherwise, find out the primary group name and cache it. if ($PrimaryGroups.ContainsKey($primaryGroupID)) { [Void] $memberOf.Add($PrimaryGroups[$primaryGroupID]) } else { $primaryGroupName = get-primarygroupname $dn $PrimaryGroups.Add($primaryGroupID, $primaryGroupName) [Void] $memberOf.Add($primaryGroupName) } # If the user's memberOf attribute is defined, find the group names. if ($properties["memberof"]) { foreach ($groupDN in $properties["memberof"]) { # If the group name is aleady cached, add it to the array; # otherwise, find out the group name and cache it. if ($Groups.ContainsKey($groupDN)) { [Void] $memberOf.Add($Groups[$groupDN]) } else { $groupName = get-samaccountname $groupDN $Groups.Add($groupDN, $groupName) [Void] $memberOf.Add($groupName) } } } # Sort the ArrayList and output one object per group. $memberOf.Sort() foreach ($groupName in $memberOf) { $output = new-object PSObject $output | add-member NoteProperty "DN" $dn $output | add-member NoteProperty "CN" $cn $output | add-member NoteProperty "UserName" $userName $output | add-member NoteProperty "Disabled" $disabled $output | add-member NoteProperty "Group" $groupName $output } } } } process { if ($PIPELINEINPUT) { get-usersandgroups2 $_ } else { $SearchLocation | foreach-object { get-usersandgroups2 $_ } } }</span></span></code> </pre><br><br>  <a href="http://www.windowsitpro.com/content1/topic/auditing-active-directory-users-groups-141463/catpath/scripting/page/1">via WindowsITPro</a> <br><br>  <i>PS For a variety of reports on the structure and changes of AD, you can use the <b>NetWrix AD Change Reporter</b> .</i>  <i>The program allows you to be aware of changes in AD and at the same time does not require you to tediously work with logs or manual automation through scripts.</i>  <i>You can learn more about the program <a href="http://www.netwrix.com/tracking/track.html%3Fcampaign%3DNWX_HABR_ADPOWERSHELL_2012_08%26url%3Dru/landing.html%3Fproduct%3Dadcr">on the NetWrix website.</a></i> </div><p>Source: <a href="https://habr.com/ru/post/148472/">https://habr.com/ru/post/148472/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148459/index.html">Monitor the number of documents in Sphinx indexes</a></li>
<li><a href="../148462/index.html">HyperActive Record - under-ORM on CodeIgniter</a></li>
<li><a href="../148464/index.html">Google Engineering Calculator</a></li>
<li><a href="../148467/index.html">Qt + OpenCV. Runtime and Widget for CvCapture (video capture devices)</a></li>
<li><a href="../148471/index.html">Microsoft Office365: a classic in modern processing</a></li>
<li><a href="../148473/index.html">Cross-Vmny (CLR / JVM) Python Code</a></li>
<li><a href="../148474/index.html">The seminar ‚ÄúCreating an IT Startup‚Äù on July 29 in Gorky Park (Moscow)</a></li>
<li><a href="../148476/index.html">Launch trailer Metal War Online</a></li>
<li><a href="../148477/index.html">How I received a certificate of state registration of rights to a copyright object in Kazakhstan</a></li>
<li><a href="../148478/index.html">Creating graphs with pChart. Data from mysql</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>