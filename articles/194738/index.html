<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Guide to designing relational databases. Cascade delete data</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Addition to the cycle of translated articles. 
 Articles 1-3 , 4-6 , 7-9 , 10-13 , 14-15 

 The information in the article refers to the 5th part of t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Guide to designing relational databases. Cascade delete data</h1><div class="post__text post__text-html js-mediator-article">  <i>Addition to the cycle of translated articles.</i> <i><br></i>  <i>Articles <a href="http://habrahabr.ru/post/193136/">1-3</a> , <a href="http://habrahabr.ru/post/193284/">4-6</a> , <a href="http://habrahabr.ru/post/193380/">7-9</a> , <a href="http://habrahabr.ru/post/193756/">10-13</a> , <a href="http://habrahabr.ru/post/194714/">14-15</a></i> <br><br>  <i>The information in the article refers to the 5th part of the manual.</i> <i><br><br></i>  <i>In the comments one of the users reasonably reproached the lack of information about the cascade deletion of data.</i>  <i>Fill the gap.</i>  <i>The author of the articles has no information on this topic, so I wrote a short article about it.</i>  <i>It is quite logical to fit into the specified cycle.</i> <i><br></i>  <i>To begin with, in order to avoid confusion, it is worth saying that it is not so much and not only about cascading data deletion, but about the topic of referential integrity and foreign keys, of which cascading data deletion is a part.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Introduction </h4><br>  If you start from the philistine position of a person who develops databases, then foreign keys are convenient and simplify life (in most cases, there are always exceptions.).  Even being an ignoramus in the relational database theory, to the conscious need to use foreign keys, at a certain stage of its development, almost any practice comes (the statement is more relevant to beginners), which does not stand still in its development and continues to think.  Even if he does not yet know that what he needs is called a link by a foreign key, he begins to organize the data himself in a certain way, split it into separate tables and link them together.  So it becomes obvious. <br>  But when using foreign keys, even if you do not know such a definition, it becomes necessary to monitor the data to be bound.  The subject of this article is, if I may say so, a kind of satellite that follows such an organization of data.  And in this case it is already much more useful to know the theory, since  This can greatly simplify life in the process of working with the database. <br><a name="habracut"></a><br><h4>  Closer to the point. </h4><br>  Foreign keys were told in translations, I will not dwell on this.  I'll tell you about the "satellite". <br><br>  In case you don‚Äôt know the theory, you‚Äôll have to keep track of the data connections yourself.  An alternative option is to assign this task to the database.  What is the so-called data link tracking?  To understand, you need an example. <br><br>  We have some things.  They are scattered, a lot of them.  We want to clean up the mess.  Order is often classification (categorization) and inventory.  We want order, and we can work with databases and do not want to write anything on paper.  We write all things ‚Äúin a column‚Äù.  Next, we review the list and determine the categories to which things belong. <br><br>  Let this part of our things, the rest do not consider: <br><br><ul><li>  book 1 </li><li>  book 2 </li><li>  book 3 </li><li>  PC mouse </li><li>  keyboard </li><li>  a pen </li><li>  stapler </li></ul><br>  We define for ourselves that: <br><br>  <b>Book 1, book 2, book 3</b> - this is a book, oddly enough. <br>  <b>Computer mouse, keyboard</b> - this is computer peripherals. <br>  <b>Pen, stapler</b> - this is stationery. <br><br>  We create two tables in the database: <b>categories (categories)</b> and <b>stuff (things)</b> . <br><br>  Categories <br><br>  category_id |  name <br><br>  1 |  books <br>  2 |  computer peripherals <br>  3 |  stationery <br><br>  Stuff (things) <br><br>  stuff_id |  category_id |  name <br><br>  1 |  1 |  book 1 <br>  2 |  1 |  book 2 <br>  3 |  1 |  book 3 <br>  4 |  2 |  PC mouse <br>  5 |  2 |  keyboard <br>  6 |  3 |  a pen <br>  7 |  3 |  stapler <br><br>  PS Images from <a href="http://habrastorage.org/">habrastorage.org are</a> not displayed. <br><br>  Total: we have books, computer peripherals, stationery. <br><br>  We wanted to throw out or donate all our books, we don‚Äôt want to see these things as a category, at home, we like e-books.  We remove the category ‚Äúbook‚Äù from the category table.  At the same time, we have things from this category in another table, we refer to these categories in the table of things.  This is called a <b>violation of referential integrity</b> .  It would seem that we do not have a category, and therefore there are no books, but the entries in the table of things remain and there are a lot of things, and in the future the situation can repeat and repeat, and then we will have a mess, a lot of unnecessary information and all the ensuing consequences both in the convenience of working with our information, and in the technical part when working with the database (for example, searching for information).  And here comes the understanding that we need to work with two tables, to watch out in which cases the connections can be broken, broken and make some gestures, and there are two options: do it yourself or, here knowledge is power, we can shift this headache on the database. <br><br>  In the framework of the relational data model, the table of categories is an ancestor, and the table of things is a descendant.  Everything is clear, as a parent and child.  Moreover, cases in which connections can be broken are also identified (take and use).  Our case is not the only one. <br><br>  Relationships can break (if we speak in the "correct" language - referential integrity may be broken) in the following cases: <br><br><ul><li>  the foreign key (reference to the identifier in the category table) is updated in the descendant row.  We update the category (number, identifier of this category) for some thing, and we are mistaken, there is no such category.  And ... we have a thing suspended in the air. </li><li>  a new child string is added.  Add a new thing, but it does not belong to any category.  By the way, we can add a category without things.  We have a database so arranged that a thing cannot be without a category, but a category can, because it does not refer to a thing. </li><li>  delete ancestor line  This is exactly what happened in our case.  They removed the category, but things remained. </li><li>  primary key update in ancestor string.  We changed the category identifier, and the former identifier is referenced by certain things.  Bottom line: some of the things again in limbo. </li></ul><br><br>  Means to maintain the referential integrity of SQL ( <i>I‚Äôll say right away, beforehand when you need it, you will understand; if we talk about MySQL RDBMS, then using these tools together with foreign keys is possible only for InnoDB tables; you can use foreign keys in MyISAM, creating a certain data structure, but then the whole headache of keeping track of the connection falls on the user</i> ) allows you to handle these cases. <br><br>  And this is how these problems are solved (in the order of listing): <br><br><ul><li>  When updating the child table, the new value of the foreign key is checked.  If the specified value is not among the primary keys of the ancestor table, an error is returned. <br>  In our case, if we change a category number for a thing, but it does not exist. </li><li>  When adding a new child string.  If the specified foreign key value does not exist among the primary keys of the parent table, an error is returned. <br>  In our case, if we add a thing and specify the number of a non-existent category for it. </li></ul><br><br>  Now the last two.  Here the situation is more interesting. <br><br><ul><li>  Delete ancestor line.  In our case, if we delete a category, and things in the table of things will refer to it.  There may be several solutions to the problem.  Which of them to do is decided by the database developer (you indicate). <br><br>  1) when deleting a category, you can delete all related items. <br>  2) prohibit the deletion of categories while some things refer to them. <br>  3) for things that refer to the category being deleted, specify the value NULL as a reference to the category. <br>  4) for things that refer to the category being deleted, specify a default value other than NULL. <br></li><li>  In the case of updating the primary key in the ancestor row, the options similar to the previous ones. </li></ul><br>  Now about the cascade deletion of data, which was mentioned at the beginning. <br>  When specifying the deletion and / or update rules in SQL, certain syntactic structures are used: <br><br> <code>FOREIGN KEY [key_name] (col1, ‚Ä¶) REFERENCES table (table_col, ‚Ä¶) <br> [ON DELETE {CASCADE|SET NULL|NO ACTION|RESTRICT|SET DEFAULT}] <br> [ON UPDATE {CASCADE|SET NULL|NO ACTION|RESTRICT|SET DEFAULT}]</code> <br> <br>  Where optional constructions <b>ON DELETE</b> and <b>ON UPDATE</b> allow you to specify the same solutions to the problem, which are discussed above.  And these keywords call them: <br><br>  <b>CASCADE</b> - when you delete or update an entry in the ancestor table that contains the primary key, the entries with references to this value in the descendant table are automatically deleted or updated.  In our case, if we delete a category, then all things belonging to this category in the table of things will be deleted.  If we update the identifier of the category, then the things that refer to this category will also change the identifier to a new one. <br>  <i>That, cascade, but, as you can see, not only removal.</i> <br><br>  <b>SET NULL</b> - when deleting or updating an entry in the ancestor table that contains the primary key, the foreign key values ‚Äã‚Äãin the descendant table are set to NULL. <br>  <i>In our case, if we delete or update the category identifier in the category table, then all things that were referenced belong to this category in the field with the category identifier will be set to NULL.</i> <br><br>  <b>NO ACTION</b> - when deleting or updating an entry in the ancestor table that contains the primary key, no action will be taken in the child table. <br>  <i>In our case, if we delete or update the category identifier in the category table, this will not affect the table of things in any way.</i> <br><br>  <b>RESTRICT</b> - if there are records in the child table that refer to the existing primary key in the child table, then if you delete or update the record with the primary key in the ancestor table, an error will be returned. <br>  <i>In our case, if we try to update or change the category identifier, while there are things related to this category, we will get an error.</i> <br><br>  <b>SET DEFAULT</b> - here it is clear from the name that when you delete or update an entry in the ancestor table that contains the primary key, the default value will be set in the descendant table of the corresponding entries.  There is one ‚ÄúBUT‚Äù.  MySQL RDBMS does not use this keyword. <br><br>  And now again - to cascade delete data.  Why is it at the hearing?  Why was asked about him in the first place, despite the fact that it is only one of.  Probably because cascading data deletion is the most common solution to a problem. </div><p>Source: <a href="https://habr.com/ru/post/194738/">https://habr.com/ru/post/194738/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194728/index.html">The digest of interesting news and materials from the world of PHP over the past two weeks, number 26 (September 8-22, 2013)</a></li>
<li><a href="../194730/index.html">Apple Touch ID - fingerprint scanner in iPhone 5S hacked</a></li>
<li><a href="../194732/index.html">Chaos Computer Club hack Touch ID</a></li>
<li><a href="../194734/index.html">Add Motion Blur Effect to WPF Applications</a></li>
<li><a href="../194736/index.html">Stop typing!</a></li>
<li><a href="../194740/index.html">Sooner or later we will have to do it.</a></li>
<li><a href="../194742/index.html">How we shot NY 41x41</a></li>
<li><a href="../194746/index.html">AJAX in Joomla components! 2.5</a></li>
<li><a href="../194748/index.html">Overview of the stand-case with a Micro USB keyboard for a 7 "tablet</a></li>
<li><a href="../194750/index.html">Another tacacs +</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>