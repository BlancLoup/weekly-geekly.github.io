<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Shaders of dissolution and exploration of the world</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 1: Dissolve Shader 
 The dissolution shader returns a beautiful effect, and it is also easy to create and understand; today we will make it in th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Shaders of dissolution and exploration of the world</h1><div class="post__text post__text-html js-mediator-article"><h1>  Part 1: Dissolve Shader </h1><br>  <strong>The dissolution shader</strong> returns a beautiful effect, and it is also easy to create and understand;  today we will make it in the <strong>Unity Shader Graph</strong> , and also write to <strong>HLSL</strong> . <br><br>  Here is an example of what we will create: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ce4/46c/b99/ce446cb9949fdee3ed4b29d121aa1c89.gif"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  How it works </h1><br>  To create a <strong>dissolve</strong> shader, we‚Äôll have to <strong>work</strong> with the <strong>AlphaClipThreshold</strong> value in the Shader Graph shader or use the HLSL function called <strong>clip</strong> . <br><br>  In fact, we will order the shader <strong>not to render a pixel</strong> based on the <strong>texture</strong> and the transmitted <strong>value</strong> .  We need to know the following: the <strong>white parts dissolve faster</strong> . <br><a name="habracut"></a><br>  We will use this texture: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1cc/f52/1cd/1ccf521cdd1ba16cdaa45b33ae50fec4.png"></div><br>  You can create your own - straight lines, triangles, whatever you like!  Just remember that the <strong>white parts dissolve faster</strong> . <br><br>  I created this texture in Photoshop using the ‚ÄúClouds‚Äù filter. <br><br>  Even if you are only interested in Shader Graph and you know nothing about HLSL, I still recommend reading this part, because it is useful to understand how Unity Shader Graph works inside. <br><br><hr><br><h1>  HLSL </h1><br>  In HLSL, we use the <strong>clip (x)</strong> function.  The <strong>clip (x)</strong> function discards all pixels with a value less than <strong>zero</strong> .  Therefore, if we call <strong>clip (-1)</strong> , we will be sure that the shader will never render this pixel.  More information about the <strong>clip</strong> can be found in <a href="https://docs.microsoft.com/it-it/windows/desktop/direct3dhlsl/dx-graphics-hlsl-clip">Microsoft Docs</a> . <br><br><h4>  Properties </h4><br>  The shader needs two properties, <strong>Dissolve Texture</strong> and <strong>Amount</strong> (which will indicate the overall process of execution).  As is the case with other properties and variables, you can call them as you please. <br><br><pre><code class="hljs erlang-repl">Properties { //Your other properties //[...] //Dissolve shader properties _DissolveTexture(<span class="hljs-string"><span class="hljs-string">"Dissolve Texture"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} _Amount(<span class="hljs-string"><span class="hljs-string">"Amount"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span> }</code> </pre> <br>  Do not forget to add the following after CGPROGRAM SubShader (in other words, declare variables): <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sampler2D</span></span> _DissolveTexture; <span class="hljs-attribute"><span class="hljs-attribute">half</span></span> _Amount;</code> </pre> <br>  Also, don't forget.  that their names must match the names in the Properties section. <br><br><h4>  Function </h4><br>  We start the <strong>Surface</strong> or <strong>Fragment</strong> function by sampling the <strong>dissolve texture</strong> and get <strong>the red value</strong> .  PS Our texture is preserved in <strong>grayscale</strong> , that is, its values <strong>R</strong> , <strong>G</strong> and <strong>B</strong> are equal, and you can <strong>choose any of them</strong> .  For example, <strong>white</strong> is <strong>(1,1,1)</strong> , <strong>black</strong> is <strong>(0,0,0)</strong> . <br><br>  In my example, I use a surface shader: <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> surf (Input IN, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { half dissolve_value = tex2D(_DissolveTexture, IN.uv_MainTex).r; <span class="hljs-comment"><span class="hljs-comment">//Get how much we have to dissolve based on our dissolve texture clip(dissolve_value - _Amount); //Dissolve! //Your shader body, you can set the Albedo etc. //[...] }</span></span></code> </pre> <br>  <strong>And that's it!</strong>  We can apply this process to any available shader and turn it into a <strong>dissolution shader</strong> ! <br><br>  Here is the standard Surface Shader of the Unity engine, turned into a <strong>two-sided</strong> <strong>dissolution shader:</strong> <br><br><pre> <code class="hljs pgsql">Shader "Custom/DissolveSurface" { Properties { _Color ("Color", Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex ("Albedo (RGB)", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Glossiness ("Smoothness", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.5</span></span> _Metallic ("Metallic", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.0</span></span> //Dissolve properties _DissolveTexture("Dissolve Texutre", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Amount("Amount", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span> } SubShader { Tags { "RenderType"="Opaque" } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> Cull <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> //Fast way <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> turn your material <span class="hljs-type"><span class="hljs-type">double</span></span>-sided CGPROGRAM #pragma surface surf Standard fullforwardshadows #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> sampler2D _MainTex; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; }; half _Glossiness; half _Metallic; fixed4 _Color; //Dissolve properties sampler2D _DissolveTexture; half _Amount; <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { //Dissolve <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> half dissolve_value = tex2D(_DissolveTexture, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex).r; clip(dissolve_value - _Amount); //Basic shader <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> fixed4 c = tex2D (_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex) * _Color; o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; } ENDCG } FallBack "Diffuse" }</code> </pre> <br><hr><br><h1>  Shader graph </h1><br>  If we need to create this effect using the Unity <strong>Shader Graph</strong> , then we need to use the <strong>AlphaClipThreshold</strong> value (which works differently than the <strong>clip (x)</strong> from HLSL).  In this example, I created a PBR shader. <br><br>  The <strong>AlphaClipThreshold</strong> function tells the shader to discard all pixels whose value is less than its <strong>Alpha</strong> value.  For example, if it is <strong>0.3f</strong> , and our alpha value is <strong>0.2f</strong> , then the shader <strong>will not render</strong> this pixel.  <strong>You</strong> can read about the <strong>AlphaClipThreshold</strong> function in the <strong>Unity documentation</strong> : <a href="https://github.com/Unity-Technologies/ShaderGraph/wiki/PBR-Master-Node">PBR Master Node</a> and <a href="https://github.com/Unity-Technologies/ShaderGraph/wiki/Unlit-Master-Node">Unlit Master Node</a> . <br><br>  Here is our ready shader: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1b9/368/ede/1b9368ede92dad1544f3ca702a2924ad.png"></div><br>  We sample the <strong>dissolution texture</strong> and get <strong>the red value</strong> , then add it to the <strong>Amount</strong> value (which is a property that I added to indicate the overall process, value 1 means complete dissolution) and connect it to <strong>AlphaClipThreshold</strong> .  <strong>Done!</strong> <br><br>  If you want to apply it to any existing shader, just <strong>copy the</strong> <strong>node connections</strong> in <strong>AlphaClipThreshold</strong> (do not miss the necessary properties!).  You can also make it <strong>two-way</strong> and get an even more beautiful result! <br><br><hr><br><h1>  Dissolution shader with contours </h1><br>  And if you try to add <strong>contours</strong> to it?  Let's do it! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c59/0db/e64/c590dbe64e954bdc6c7ce1154726e80b.gif"></div><br>  We cannot work with the already dissolved pixels, because after dropping <em>them they disappear forever</em> .  Instead, we can work with ‚Äúalmost dissolving‚Äù values! <br><br>  In <strong>HLSL,</strong> this is very simple, just add a few lines of code after calculating the <strong>clip</strong> : <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> surf (Input IN, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-comment"><span class="hljs-comment">//[...] //After our clip calculations if (dissolve_value - _Amount &lt; .05f) //outline width = .05f o.Emission = fixed3(1, 1, 1); //emits white color //Your shader body, you can set the Albedo etc. //[...] }</span></span></code> </pre> <br>  <strong>Done!</strong> <br><br>  When working with <strong>Shader Graph, the</strong> logic is slightly different.  Here is the finished shader: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e26/288/1ef/e262881ef6ad042856b345ba2d9f2765.png"></div><br><hr><br>  We can create very <strong>cool effects</strong> with a simple <strong>dissolution shader</strong> ;  You can experiment with <strong>different textures</strong> and <strong>values</strong> , as well as come up with something else! <br><br><h1>  Part 2: World Explorer Shader </h1><br>  The <strong>world exploration</strong> shader (or " <strong>world dissolution shader</strong> ", or <strong>global dissolution</strong> ") allows us to hide all the objects of the scene equally based on their distance from the position; now we will create such a shader in the <strong>Unity Shader Graph</strong> and write it to <strong>HLSL</strong> . <br><br>  Here is an example of what we will create: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/228/7bb/169/2287bb1692d36eae92224f36359648a3.gif"></div><br><hr><br><h2>  Distance as parameter </h2><br>  Suppose we need to <strong>dissolve an object</strong> in the scene if it is <strong>too far from the player</strong> .  We have already announced the <strong>_Amount</strong> parameter, which controls the process of disappearing / dissolving an object, so we need to replace it with the distance between the object and the player. <br><br>  For this we need to take the position of <strong>Player</strong> and <strong>Object</strong> . <br><br><h3>  Player position </h3><br>  <strong>The process</strong> will be the same for <strong>Unity Shader Graph</strong> , and for <strong>HLSL</strong> : we need to transfer the player's position in the code. <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//Updates the _PlayerPos variable in all the shaders //Be aware that the parameter name has to match the one in your shaders or it wont' work Shader.SetGlobalVector("_PlayerPos", transform.position); //"transform" is the transform of the Player }</span></span></code> </pre> <br><hr><br><h2>  Shader graph </h2><br><h4>  The position of the object and the distance to it </h4><br>  With the Shader Graph, we can use the Position and Distance nodes. <br><br><ul><li>  <a href="https://github.com/Unity-Technologies/ShaderGraph/wiki/Position-Node">documentation on the Position node</a> . </li><li>  <a href="https://github.com/Unity-Technologies/ShaderGraph/wiki/Distance-Node">documentation for the node Distance</a> . </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b1/cdb/078/7b1cdb078a844a10451317e40a14df7c.png"></div><br>  PS In order for this system to work with Sprite Renderers, you need to add the _MainTex property, sample it and connect it with albedo.  You can read my previous tutorial <a href="https://www.febucci.com/tutorials/shaders/sprite-diffuse-shader/">Sprites diffuse shader</a> (which uses shader graph). <br><br><hr><br><h2>  HLSL (surface) </h2><br><h4>  Object position </h4><br>  In HLSL, we can add the <strong>worldPos</strong> variable to our <strong>Input</strong> structure to get the vertex positions of the objects. <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Input</span></span></span><span class="hljs-class"> </span></span>{ float2 uv_MainTex; float3 worldPos; <span class="hljs-comment"><span class="hljs-comment">//add this and Unity will set it automatically };</span></span></code> </pre> <br>  On <a href="https://docs.unity3d.com/Manual/SL-SurfaceShaders.html">the Unity documentation page,</a> you can find out what other built-in parameters you can add to the Input structure. <br><br><h4>  Apply distance </h4><br>  We need to use the distance between the objects and the player as the dilution value.  For this, you can use the built-in <strong>distance</strong> function ( <a href="https://docs.microsoft.com/it-it/windows/desktop/direct3dhlsl/dx-graphics-hlsl-distance">Microsoft documentation</a> ). <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> surf (Input IN, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { half dissolve_value = tex2D(_DissolveTexture, IN.uv_MainTex).x; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dist = distance(_PlayerPos, IN.worldPos); clip(dissolve_value - dist/ <span class="hljs-number"><span class="hljs-number">6</span></span>f); <span class="hljs-comment"><span class="hljs-comment">//"6" is the maximum distance where your object will start showing //Set albedo, alpha, smoothness etc[...] }</span></span></code> </pre> <br><h3>  Result (3D) </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/868/f5c/2e8/868f5c2e803708138c71f84c95e3390c.gif"></div><br><h3>  Result (2D) </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/289/380/e2b/289380e2ba53cbe569621821affc7009.gif"></div><br>  As you can see, the objects dissolve ‚Äúlocally‚Äù, we did not get a uniform effect, because we get the ‚Äúdissolution value‚Äù from the texture sampled with the UV of each object.  (In 2D this is less noticeable). <br><br><hr><br><h3>  3D LocalUV Dissolve Shader on HLSL </h3><br><pre> <code class="hljs pgsql">Shader "Custom/GlobalDissolveSurface" { Properties { _Color ("Color", Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex ("Albedo (RGB)", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Glossiness("Smoothness", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.5</span></span> _Metallic("Metallic", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.0</span></span> _DissolveTexture("Dissolve texture", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Radius("Distance", <span class="hljs-type"><span class="hljs-type">Float</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> //distance <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> we <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> reveal the objects } SubShader{ Tags { "RenderType" = "Opaque" } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> Cull <span class="hljs-keyword"><span class="hljs-keyword">off</span></span> //material <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> two sided CGPROGRAM #pragma surface surf Standard fullforwardshadows #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> sampler2D _MainTex; sampler2D _DissolveTexture; //texture <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> we <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> the dissolve <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float3 worldPos; //Built-<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> world position }; half _Glossiness; half _Metallic; fixed4 _Color; float3 _PlayerPos; //"Global Shader Variable", contains the Player Position <span class="hljs-type"><span class="hljs-type">float</span></span> _Radius; <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { half dissolve_value = tex2D(_DissolveTexture, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex).x; <span class="hljs-type"><span class="hljs-type">float</span></span> dist = distance(_PlayerPos, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos); clip(dissolve_value - dist/ _Radius); fixed4 c = tex2D (_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex) * _Color; o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; } ENDCG } FallBack "Diffuse" }</code> </pre> <br><h3>  Sprites Diffuse - LocalUV Dissolve Shader on HLSL </h3><br><pre> <code class="hljs pgsql">Shader "Custom/GlobalDissolveSprites" { Properties { [PerRendererData] _MainTex("Sprite Texture", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Color("Tint", Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) [MaterialToggle] PixelSnap("Pixel snap", <span class="hljs-type"><span class="hljs-type">Float</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> [HideInInspector] _RendererColor("RendererColor", Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) [HideInInspector] _Flip("Flip", Vector) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) [PerRendererData] _AlphaTex("External Alpha", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} [PerRendererData] _EnableExternalAlpha("Enable External Alpha", <span class="hljs-type"><span class="hljs-type">Float</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> _DissolveTexture("Dissolve texture", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Radius("Distance", <span class="hljs-type"><span class="hljs-type">Float</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> //distance <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> we <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> reveal the objects } SubShader { Tags { "Queue" = "Transparent" "IgnoreProjector" = "True" "RenderType" = "Transparent" "PreviewType" = "Plane" "CanUseSpriteAtlas" = "True" } Cull <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> Lighting <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> ZWrite <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> Blend One OneMinusSrcAlpha CGPROGRAM #pragma surface surf Lambert vertex:vert nofog nolightmap nodynlightmap keepalpha noinstancing #pragma multi_compile _ PIXELSNAP_ON #pragma multi_compile _ ETC1_EXTERNAL_ALPHA #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "UnitySprites.cginc" struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; fixed4 color; float3 worldPos; //Built-<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> world position }; sampler2D _DissolveTexture; //texture <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> we <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> the dissolve <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> float3 _PlayerPos; //"Global Shader Variable", contains the Player Position <span class="hljs-type"><span class="hljs-type">float</span></span> _Radius; <span class="hljs-type"><span class="hljs-type">void</span></span> vert(<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> o) { v.vertex = UnityFlipSprite(v.vertex, _Flip); #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> defined(PIXELSNAP_ON) v.vertex = UnityPixelSnap(v.vertex); #endif UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, o); o.color = v.color * _Color * _RendererColor; } <span class="hljs-type"><span class="hljs-type">void</span></span> surf(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutput o) { half dissolve_value = tex2D(_DissolveTexture, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex).x; <span class="hljs-type"><span class="hljs-type">float</span></span> dist = distance(_PlayerPos, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos); clip(dissolve_value - dist / _Radius); fixed4 c = SampleSpriteTexture(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex) * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.color; o.Albedo = c.rgb * ca; o.Alpha = ca; } ENDCG } Fallback "Transparent/VertexLit" }</code> </pre> <br>  PS To create the last shader, I copied the standard Unity Sprites-Diffuse shader and added the ‚Äúdissolve‚Äù part described earlier in this part of the article.  All standard shaders can be found <a href="https://unity3d.com/get-unity/download/archive">here</a> . <br><br><hr><br><h2>  Making the effect uniform </h2><br>  To make the effect homogeneous, we can use global coordinates (world position) as the UV coordinates of the dissolution texture.  It is also important to set <strong>Wrap = Repeat</strong> in the dissolution texture parameters so that we can repeat the texture without noticing it (make sure the texture is seamless and repeats well!) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7db/b9f/e0e/7dbb9fe0e582bf7a63b2dccfb43a9b9b.png"></div><br><h4>  HLSL (surface) </h4><br><pre> <code class="hljs delphi">half dissolve_value = tex2D(_DissolveTexture, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos / <span class="hljs-number"><span class="hljs-number">4</span></span>).x; <span class="hljs-comment"><span class="hljs-comment">//I modified the worldPos to reduce the texture size</span></span></code> </pre> <br><h4>  Shader graph </h4><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/787/167/9c6/7871679c66cab1c842fe02c5ce523884.png"></div><br><h3>  Result (2D) </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/428/b34/425/428b344254f3e80ef68b63ba8754dfa2.gif"></div><br>  This is the result: we can see that the dissolution texture is now uniform for the whole world. <br><br>  This shader is already <strong>ideal for 2D games</strong> , but for <strong>3D objects</strong> it needs to be <strong>improved</strong> . <br><br><h3>  The problem with 3D-objects </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/231/1f4/09b/2311f409be1ca990c276895eb8e49695.png"></div><br>  As you can see, the shader does not work for ‚Äúnon-vertical‚Äù edges, and it distorts the texture strongly.  So it turns out because.  that UV coordinates need a value of float2, and if we pass worldPos, then it receives only X and Y. <br><br>  If this problem is eliminated by applying calculations to display the texture on all faces, we will come to a new problem: when darkened, objects will intersect with each other, and will not remain homogeneous. <br><br>  The solution will be difficult to understand for beginners: you need to get rid of the texture, generate three-dimensional noise in the world and get the ‚Äúvalue of dissolution‚Äù from it.  In this post I will not explain the generation of 3D noise, but you can find a bunch of ready-to-use functions! <br><br>  Here is an example of a noise shader: <a href="https://github.com/keijiro/NoiseShader">https://github.com/keijiro/NoiseShader</a> .  You can also learn how to generate noise here: <a href="https://thebookofshaders.com/11/">https://thebookofshaders.com/11/</a> and here: <a href="https://catlikecoding.com/unity/tutorials/noise/">https://catlikecoding.com/unity/tutorials/noise/</a> <br><br>  I will define my surface function as follows (assuming that you have already written the part with noise): <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> dist = distance(_PlayerPos, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos); //"abs" because you have <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> make sure that the noise <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">between</span></span> the range [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>] //you can remove "abs" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> your noise <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">between</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>] //<span class="hljs-keyword"><span class="hljs-keyword">also</span></span>, replace "NOISE_FUNCTION_HERE" <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> your <span class="hljs-number"><span class="hljs-number">3</span></span>D noise <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>. half dissolve_value = abs(NOISE_FUNCTION_HERE(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dist &gt; _Radius) { <span class="hljs-type"><span class="hljs-type">float</span></span> clip_value = dissolve_value - ((dist - _Radius) / _Radius); clip(clip_value); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clip_value &lt; <span class="hljs-number"><span class="hljs-number">0.05</span></span>f) o.Emission = float3(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); } fixed4 c = tex2D (_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex) * _Color; o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br>  A brief reminder of HLSL: Before using / calling a function, it must be written / declared. <br><br>  PS If you want to create a shader using Unity Shader Graph, then you need to use Custom Nodes (and generate noise by writing the code in HLSL).  I will tell about Custom Nodes in the future tutorial. <br><br><h3>  Result (3D) </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ce6/a89/ad3/ce6a89ad324ff4a03d4bfabf1a694024.gif"></div><br><hr><br><h2>  Adding contours </h2><br>  To add contours, you need to repeat the process from the previous part of the tutorial. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/228/7bb/169/2287bb1692d36eae92224f36359648a3.gif"></div><br><hr><br><h2>  Inverted effect </h2><br>  And if we want to reverse this effect?  (Objects should disappear if a player is nearby) <br><br>  We just need to change one line: <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float</span></span> dist = _Radius - distance(_PlayerPos, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos);</code> </pre> <br>  (The same process applies to Shader Graph). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/579/86c/1f9/57986c1f96a56f1ec478b64c89be3eba.gif"></div></div><p>Source: <a href="https://habr.com/ru/post/427401/">https://habr.com/ru/post/427401/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../427391/index.html">Junior Tips: Build Good Habits</a></li>
<li><a href="../427393/index.html">Security analysis of corporate wireless network</a></li>
<li><a href="../427395/index.html">"Let me explain: or why a programmer needs a mathematician." A book about how not to be bored in math lectures</a></li>
<li><a href="../427397/index.html">Development of acoustic dataset for training neural network</a></li>
<li><a href="../427399/index.html">Working with data when building an API based on GraphQL</a></li>
<li><a href="../427403/index.html">API ReportingObserver: a look at the code of web pages from a new point of view</a></li>
<li><a href="../427405/index.html">ES2018 - finally promis method</a></li>
<li><a href="../427407/index.html">Meta-clustering with error minimization, and why I think the brain works that way</a></li>
<li><a href="../427409/index.html">The book "Brilliant Agile. Flexible project management with Agile, Scrum and Kanban</a></li>
<li><a href="../427413/index.html">Fight for resources, part 4: Remarkably coming out</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>