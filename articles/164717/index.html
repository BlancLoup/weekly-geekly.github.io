<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optimize SQL Server performance using indexes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 As you know, indexes increase productivity similarly to the table of contents or subject index in the book. After reading a few article...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optimize SQL Server performance using indexes</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  As you know, <a href="http://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D0%25B4%25D0%25B5%25D0%25BA%25D1%2581_(%25D0%25B1%25D0%25B0%25D0%25B7%25D1%258B_%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D1%2585)">indexes</a> increase productivity similarly to the table of contents or subject index in the book.  After reading a few articles on the Internet and a couple of chapters from books, I would like to know how indices help increase the speed of data retrieval from SQL Server.  Consider an example. <a name="habracut"></a><br>  For this we need two tables linked by a foreign key.  There will be 10,000 rows in the main table, 1,000,000 in the second. The first table will contain a primary key and 2 columns with text, the second table will contain a primary key, 2 text fields, 2 numeric fields, a date, a calculated column and a foreign key. <br><br><h5>  Database structure </h5><br><div class="spoiler">  <b class="spoiler_title">DB structure</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">"maintable"</span></span>( <span class="hljs-string"><span class="hljs-string">"ID"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span> (<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span> (<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">"secondtable"</span></span> ( <span class="hljs-string"><span class="hljs-string">"ID"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-string"><span class="hljs-string">"sname"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span> (<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">"sdescr"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span> (<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">"somefirstnumber"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"somesecondnumber"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"somedatetime"</span></span> DATETIME <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">"howmanyhours"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"newdate"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATEADD</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">HOUR</span></span>, <span class="hljs-string"><span class="hljs-string">"howmanyhours"</span></span>, <span class="hljs-string"><span class="hljs-string">"somedatetime"</span></span>), <span class="hljs-string"><span class="hljs-string">"mainID"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_SecondToMain <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">"mainID"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> <span class="hljs-string"><span class="hljs-string">"maintable"</span></span> (<span class="hljs-string"><span class="hljs-string">"ID"</span></span>) ); <span class="hljs-comment"><span class="hljs-comment">--  CREATE PROCEDURE "insertintomain" @Name NVARCHAR (50), @Descr NVARCHAR (100) AS INSERT INTO "SimpleIndex"."dbo"."maintable" ("name", "description") VALUES (@Name, @Descr); GO CREATE PROCEDURE "insertintosecond" @Sname NVARCHAR(50), @Sdescr NVARCHAR(100), @Firstnumber INT, @Secondnumber INT, @SomeDT DATETIME, @Hours INT, @MainID INT AS INSERT INTO "SimpleIndex"."dbo"."secondtable" ( "sname", "sdescr", "somefirstnumber", "somesecondnumber", "somedatetime", "howmanyhours", "mainID") VALUES ( @Sname, @Sdescr,@Firstnumber, @Secondnumber, @SomeDT, @Hours, @MainID) GO</span></span></code> </pre> <br></div></div><br><br><h5>  Insert data </h5><br>  It is clear that just do not insert a million lines, use C #. <br><div class="spoiler">  <b class="spoiler_title">Create a simple console application.</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Data; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Data.SqlClient; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">SimpleAddingRandomRecordsToDatabase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alphabet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//      string alphabet = "abcdefgh ijklmnopqrst uvwxyz    "; //    Encoding enc = Encoding.UTF8; var bytes = enc.GetBytes(alphabet); alphabet = enc.GetString(bytes); return alphabet; } static int alphlen = alphabet().Length; static string getRandomString(int lenth, int rndparam, bool allowspacebars) { string str = ""; Random rand = new Random(rndparam); for (int i = 0; i &lt; lenth; i++) { int num = rand.Next(alphlen); str = str + alphabet()[num]; } if (!allowspacebars) { str = str.Replace(" ", ""); } return str; } static void Main(string[] args) { string result; Console.WriteLine(" 1   "); result = Console.ReadLine(); if (result.Equals("1")) { //   SqlConnection cn = new SqlConnection(); SqlConnectionStringBuilder cs = new SqlConnectionStringBuilder(); cs.IntegratedSecurity = true; cs.DataSource = @"KONSTANTIN\KONSTANTINSQL"; cs.InitialCatalog = "SimpleIndex"; cn.ConnectionString = cs.ToString(); cn.Open(); //  10 000     int i2 = 0; for (int i = 0; i &lt; 10000; i++) { SqlCommand cm = cn.CreateCommand(); cm.CommandType = CommandType.StoredProcedure; cm.CommandText = "insertintomain"; i2++; cm.Parameters.Add(new SqlParameter("Name", getRandomString(50, i2, false))); i2++; cm.Parameters.Add(new SqlParameter("Descr", getRandomString(100, i2, true))); cm.ExecuteNonQuery(); } // 1 000 000 ,     i2 = 0; for (int i = 0; i &lt; 1000000; i++) { Random rand = new Random(); DateTime dt = DateTime.Now; dt = dt.AddHours((-1) * rand.Next(2000)); SqlCommand cm = cn.CreateCommand(); cm.CommandType = CommandType.StoredProcedure; cm.CommandText = "insertintosecond"; i2++; cm.Parameters.Add(new SqlParameter("Sname", getRandomString(50, i2, false))); i2++; cm.Parameters.Add(new SqlParameter("Sdescr", getRandomString(100, i2, true))); i2++; Random rand2 = new Random(i2); cm.Parameters.Add(new SqlParameter("Firstnumber", rand2.Next(10000))); i2++; rand2 = new Random(i2); cm.Parameters.Add(new SqlParameter("Secondnumber", rand2.Next(100))); cm.Parameters.Add(new SqlParameter("SomeDT", dt)); i2++; rand = new Random(i2); cm.Parameters.Add(new SqlParameter("Hours", rand.Next(30))); i2++; rand = new Random(i2); cm.Parameters.Add(new SqlParameter("MainID", rand.Next(9999)+1)); cm.ExecuteNonQuery(); } cn.Close(); Console.WriteLine(" ."); } } } }</span></span></code> </pre><br></div></div><br>  Run the console application, click "1" and wait.  It took me 15-20 minutes to insert. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Description of Results </h4><br>  In this section, we will look at sample queries in indexed and non-indexed columns. <br>  One clustered index is created implicitly - this is the primary key. <br><br><h5>  Primary Key Search </h5><br>  Perform a search for a row by the primary key, pointing to a specific row number of ten thousand: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">"maintable"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">"ID"</span></span> = <span class="hljs-number"><span class="hljs-number">3823</span></span>;</code> </pre>  Time spent searching: <b>1,523 seconds</b> . <br>  The second request took <b>0.9 seconds</b> , and the third - <b>0.1 seconds</b> . <br><br>  Perform the second query with high selectivity from the same table: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">"maintable"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">"ID"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">5000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">6000</span></span>;</code> </pre>  The first request took <b>0.3 seconds</b> , the second <b>0.26 seconds</b> , the third <b>0.25 seconds</b> . <br><br>  Now we will execute similar requests to the table containing one million records.  For a specific line number: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">"secondtable"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">"ID"</span></span> = <span class="hljs-number"><span class="hljs-number">728472</span></span>;</code> </pre>  Time spent on search: <b>1.4 seconds</b> , the second query showed <b>1.36 seconds.</b>  .  Next will be the average request time. <br><br>  The primary key columns already have an index, so it‚Äôs likely that the performance increase will not work.  Based on the results, we can say that repeated queries with the same parameters increase the search speed. <br><br><h5>  Pattern Search </h5><br>  Consider a text search by pattern with indexed and non-indexed columns: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">"maintable"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">"name"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'%'</span></span>;</code> </pre>  Without an index, such a query is executed in <b>0.172 seconds</b> out of 10,000 rows.  With index <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> NONCLUSTERED <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> iName <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-string"><span class="hljs-string">"maintable"</span></span> (<span class="hljs-string"><span class="hljs-string">"name"</span></span>)</code> </pre>  this is done in <b>0.112 seconds</b> , and with a <b>composite index</b> containing the ‚Äúname‚Äù and ‚Äúdescription‚Äù fields, the request took <b>0.09 seconds</b> . <br><br>  Request <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">"maintable"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">"name"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'%dc%'</span></span>;</code> </pre>  runs in <b>0.172 seconds with no index</b> and <b>0.112 seconds with an index</b> . <br><br>  Perform a pattern search on a table containing a million entries. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">"secondtable"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">"sname"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'%'</span></span>;</code> </pre>  This query <b>without indexing</b> would take an average of <b>1.7 seconds</b> , whereas <b>with a</b> column <b>index it</b> would take <b>0.15 seconds</b> . <br><br><h5>  Search by date </h5><br>  To begin with we will execute request of small selectivity <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">"secondtable"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">"somedatetime"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-string"><span class="hljs-string">'2012-26-11 11:30:00'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-string"><span class="hljs-string">'2012-26-11 11:32:00'</span></span></code> </pre>  <b>Without an index,</b> it takes an average of <b>0.7 seconds</b> , <b>indexed - 0.22 seconds</b> . <br><br>  Request high selectivity (420600 rows) <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">"secondtable"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">"somedatetime"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-string"><span class="hljs-string">'2012-26-11 11:30:00'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-string"><span class="hljs-string">'2012-31-12 11:32:00'</span></span></code> </pre>  <b>Without an index - 19.219 seconds</b> , <b>with an index of</b> the date field only - <b>9.9 seconds</b> . <br><br><h5>  Query by date on calculated column </h5><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">"secondtable"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">"newdate"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-string"><span class="hljs-string">'2012-26-11 11:30:00'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-string"><span class="hljs-string">'2012-31-12 11:32:00'</span></span></code> </pre>  This query <b>without an index</b> will take <b>12.2 seconds</b> , whereas <b>with an index - 9.75</b> .  It is important to note that the original column containing the date has already been indexed. <br><br><h5>  Join tables </h5><br>  When combining tables, it is advised to always index a column that is a foreign key.  In the following example, we will verify that this is indeed the case. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> NONCLUSTERED <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> iFK <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-string"><span class="hljs-string">"secondtable"</span></span> (<span class="hljs-string"><span class="hljs-string">"mainID"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-string"><span class="hljs-string">"sname"</span></span>, <span class="hljs-string"><span class="hljs-string">"somefirstnumber"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">"maintable"</span></span> M <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-string"><span class="hljs-string">"secondtable"</span></span> S <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> M.<span class="hljs-string"><span class="hljs-string">"ID"</span></span> = S.<span class="hljs-string"><span class="hljs-string">"mainID"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> M.<span class="hljs-string"><span class="hljs-string">"ID"</span></span> = <span class="hljs-number"><span class="hljs-number">8271</span></span></code> </pre>  Such a request returns 101 lines.  <b>Without an index - 0.422 seconds</b> , and <b>with an index - 0.122 seconds</b> .  As we see, the query speed has increased more than three times.  Consider the remaining queries related to the merge. <br><br>  But the index does not always increase performance.  For example, a query (420,000 lines) <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-string"><span class="hljs-string">"sname"</span></span>, <span class="hljs-string"><span class="hljs-string">"somefirstnumber"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">"maintable"</span></span> M <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-string"><span class="hljs-string">"secondtable"</span></span> S <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> M.<span class="hljs-string"><span class="hljs-string">"ID"</span></span> = S.<span class="hljs-string"><span class="hljs-string">"mainID"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> S.<span class="hljs-string"><span class="hljs-string">"somedatetime"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-string"><span class="hljs-string">'2012-26-11 11:30:00'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-string"><span class="hljs-string">'2012-31-12 11:32:00'</span></span>;</code> </pre>  showed identical results without an index, with an index of only a foreign key, a foreign key and a date, with a composite index simultaneously including these two columns - approximately <b>6.8 seconds</b> . <br><br><h5>  Combining with pattern matching </h5><br>  Perform a merge with a pattern search among a million entries: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-string"><span class="hljs-string">"sname"</span></span>, <span class="hljs-string"><span class="hljs-string">"somefirstnumber"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">"maintable"</span></span> M <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-string"><span class="hljs-string">"secondtable"</span></span> S <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> M.<span class="hljs-string"><span class="hljs-string">"ID"</span></span> = S.<span class="hljs-string"><span class="hljs-string">"mainID"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">"sname"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'%'</span></span>;</code> </pre>  <b>Without indices, the</b> query will take <b>0.766 seconds</b> and return 5 rows. <br>  With a foreign key index only - <b>0.4 sec.</b>  ; <br>  With a text field index only - <b>0.125 sec.</b>  ; <br>  With foreign key index and text field index - <b>0.109 sec.</b>  ; <br>  With a composite index containing foreign key and text field - <b>0.35 sec.</b>  . <br><br><h4>  Comparison of results </h4><br>  Consider the results in the form of graphs.  The vertical axis shows the <u>elapsed time</u> ( <i>and not the speed!</i> ). <br>  1. Sampling on the primary key.  Since there is already a clustered index, consider a large and small selective sample from one table: <br><img src="https://habrastorage.org/storage2/198/ce4/6c5/198ce46c5767e13a0c212d5b7585d934.png"><br>  From this graph it is clear that sampling a large amount of data is processed faster. <br><br>  2. Search by primary key with join of tables.  The following graph shows that foreign key indexing speeds up a search operation by more than three times: <br><img src="https://habrastorage.org/storage2/d82/f3d/ccf/d82f3dccf62a799a8bd7f2c746195c4b.png"><br><br>  3. Search by text template.  From the graph it is clear that the performance grows many times, if you use an index with a large amount of data: <br><img src="https://habrastorage.org/storage2/be7/ebf/12a/be7ebf12ad9e5ad5eaaeb5bd9daef7e4.png"><br><br>  4. Search by date.  Indices significantly increase performance for both small and large samples within the same table: <br><img src="https://habrastorage.org/storage2/ed2/ad1/083/ed2ad108350306b2e887774b28a4df2e.png"><br>  Combining tables and searching by date showed similar results with and without indices. <br><br>  5. Search by calculated column.  The index also reduces search time. <br><img src="https://habrastorage.org/storage2/8e7/116/445/8e711644585db89fce124d24a3065f03.png"><br><br>  6. Search by pattern with association.  The text field index and both indexes significantly increase performance: <br><img src="https://habrastorage.org/storage2/20a/a76/562/20aa76562c774de6c8814fe5d0f816f6.png"><br><br><h4>  Let's sum up </h4><br>  After analyzing the results, we can say that: <br><ul><li>  It is desirable to index foreign keys, it threatens with a significant increase in performance; </li><li>  Separately indexed columns of text, date, numbers increase the speed of queries; </li><li>  Indexes work better with tables that contain a large number of rows; </li><li>  Indexes work best when sampling a large number of rows; </li><li>  Indexes work poorly with calculated columns; </li><li>  In merging queries, it is necessary to index the foreign key and the column by which the search will occur; </li><li>  The index does not help if the WHERE clause contains search conditions for two tables; </li><li>  Indexes do not affect the speed of insertion of data. </li></ul><br><br>  So, we see that indexing significantly increases SELECT queries, however, indexes take up additional memory and periodically need to be rebuilt.  The optimal solution is difficult to find, so developers and database administrators spend a lot of time searching for the golden mean, and besides, indices need to be reorganized.  But still, if you have a large amount of data, the answer, whether to use indexes or not, is obvious. </div><p>Source: <a href="https://habr.com/ru/post/164717/">https://habr.com/ru/post/164717/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../164703/index.html">AWS: Semifinalists Startup Contest</a></li>
<li><a href="../164705/index.html">WPF, WinForms: draw Bitmap with> 15000 FPS. Hardcore tricks Part 1</a></li>
<li><a href="../164707/index.html">Drupal: we write the parser for Feeds</a></li>
<li><a href="../164709/index.html">Work with Freebase from .NET</a></li>
<li><a href="../164711/index.html">Simulation of life in the Darwinbots system. I. First acquaintance</a></li>
<li><a href="../164721/index.html">Porting Qt4 application to Qt5</a></li>
<li><a href="../164725/index.html">Experience creating a game for smartphones</a></li>
<li><a href="../164727/index.html">How to add realism to path tracing</a></li>
<li><a href="../164729/index.html">Tricks sysadmins</a></li>
<li><a href="../164731/index.html">Solve 9 Windows Server 2008 management tasks using PowerShell. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>