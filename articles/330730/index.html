<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Win32 / Industroyer: A New Threat to Industrial Control Systems</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Win32 / Industroyer is a sophisticated malware designed to disrupt business processes in industrial control systems (ICS), particularly in electrical ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Win32 / Industroyer: A New Threat to Industrial Control Systems</h1><div class="post__text post__text-html js-mediator-article">  Win32 / Industroyer is a sophisticated malware designed to disrupt business processes in industrial control systems (ICS), particularly in electrical substations. <br><br>  The creators of Win32 / Industroyer are distinguished by high qualifications and a deep understanding of industrial control systems and communication protocols in the power industry.  It is unlikely that anyone could write and test similar software without access to specialized equipment used in the target environment. <br><br><img src="https://habrastorage.org/web/de2/0db/39c/de20db39cea24c0e803a07e4dca18785.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  The authors of the malware implemented support for four industrial protocols described in the following standards: <br><br><ul><li>  IEC 60870-5-101 (IEC 101) </li><li>  IEC 60870-5-104 (IEC 104) </li><li>  IEC 61850 </li><li>  OLE for Process Control Data Access (OPC DA) </li></ul><br>  In addition, the authors of Industroyer have developed a tool for performing DoS attacks (denial-of-service-denial of service) aimed at certain relay protection devices, in particular, the Siemens SIPROTEC line. <br><br>  Win32 / Industroyer features are impressive.  If you compare it with the tools that were used <a href="https://habrahabr.ru/company/eset/blog/274503/">in attacks on the Ukrainian power grid</a> in 2015 and led to massive power outages on December 23, 2015 (BlackEnergy, KillDisk and other components, including legitimate remote access software), it can be argued that there is a cyber group behind Industroyer higher level.  The authors have created a malicious program that allows you to directly control switches and circuit breakers in a network of electrical substations.  By some indications, we assume that Industroyer may be associated with a power outage in Kiev in December 2016.  However, this was not confirmed at the time of writing the report, and the investigation is ongoing.  The infection vector has not yet been established. <br><br>  Industroyer consists of several modules, the description and analysis of which are presented in the following sections of the report.  Before turning to the details, we offer a simplified diagram that shows the relationship between the components of a malicious program. <br><br><img src="https://habrastorage.org/web/fc2/a5b/e1c/fc2a5be1c362441ba833accc6bacd6fd.png"><br>  <i>Figure 1. Simplified diagram of Win32 / Industroyer components.</i> <br><br>  Some components (including the data eraser) are similar in concept to the tools used in the BlackEnergy attacks on Ukrainian energy companies in 2015.  However, we do not see the connection between past attacks and the code of the new malware. <br><br><h3>  Main backdoor </h3><br>  The main component of the Industroyer, the main backdoor, is used by attackers to control the rest of the program. <br><br>  As befits a backdoor, this component is quite simple.  It connects to a remote C &amp; C server via HTTPS and receives commands from the attackers.  All studied samples are hard-coded to use the same proxy address located in the local network.  Thus, the backdoor is clearly designed to work in a particular organization.  It is also worth mentioning that most backdoor C &amp; C servers use Tor. <br><br>  Perhaps the most interesting feature of the backdoor is that attackers can set a specific hour when the malware will be active.  For example, you can modify the backdoor so that it accesses the C &amp; C server during off-hours.  This complicates detection based only on the inspection of network traffic.  However, all samples studied so far worked around the clock. <br><br><img src="https://habrastorage.org/web/862/1cd/fa5/8621cdfa5ac2424583b14ca5383e9a1c.png"><br>  <i>Figure 2. Decompiled code of the main backdoor with the ability to set the time.</i> <br><br>  After connecting to the remote C &amp; C server, the main backdoor sends the following data to the POST request: <br><br><ul><li> GUID string (globally-unique identifier) ‚Äã‚Äãfor the current hardware profile, obtained using the <code>GetCurrentHwProfile</code> function </li><li>  malware version - 1.1e </li><li>  hard-coded sample ID </li><li>  the result of any previously received command </li></ul><br>  A hard-coded ID is used by attackers as an identifier for an infected machine.  Among all the samples studied, we found the following ID values: <br><br><ul><li>  DEF </li><li>  DEF-C </li><li>  DEF-WS </li><li>  DEF-EP </li><li>  DC-2-TEMP </li><li>  DC-2 </li><li>  CES-McA-TEMP </li><li>  CES </li><li>  SRV_WSUS </li><li>  SRV_DC-2 </li><li>  SCE-WSUS01 </li></ul><br>  The main backdoor supports the following commands: <br><img src="https://habrastorage.org/web/08f/6b4/35d/08f6b435d85b48cb8a956e3d0f2336ae.png"><br><br>  Having obtained administrator rights, attackers can upgrade the installed backdoor to a more privileged version, which runs as a <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms685967(v%3Dvs.85).aspx">Windows service program</a> .  To do this, they need to select an existing non-critical Windows process and replace the <code>ImagePath</code> registry parameter with the path to the new binary backdoor file. <br><br>  The functionality of the main backdoor, which runs as a Windows service, is identical to that described.  But there are two small differences: the name of the version of the backdoor (1.1s instead of 1.1e) and the obfuscation of the code.  The code for this version of the backdoor is mixed with unnecessary assembler commands. <br><br><img src="https://habrastorage.org/web/cbd/c8a/fcf/cbdc8afcf348495d82ff210ac7651d38.png"><br>  <i>Figure 3. Obfuscated assembler code for the main backdoor working as a Windows service.</i> <br><br><h3>  Additional backdoor </h3><br>  An additional backdoor provides an alternative resiliency mechanism that allows attackers to restore access to the target network if the main backdoor is detected and / or deactivated. <br><br>  The backdoor is a trojanized version of the Windows Notepad application.  This is a full-featured application, but virus writers have added malicious code to it, which is executed every time it is launched.  Further, having received administrator rights, attackers can manually replace malicious Notepad with legitimate ones. <br><br>  The added malicious code is heavily obfuscated.  After decryption, it connects to a remote C &amp; C server (different from the C &amp; C main backdoor) and loads the payload.  It has a shellcode format that is loaded directly into memory and executed.  In addition, the added code decrypts the Windows Notepad source code stored at the end of the file, and then passes execution to it ‚Äî this is how the application works properly. <br><br><img src="https://habrastorage.org/web/d7e/308/504/d7e30850437b46c48f42db0db53124c5.png"><br>  <i>Figure 4. Comparison of the original Notepad binary code (left) and backdoor.</i> <br><br><h3>  Launcher component </h3><br>  The component is a separate executable file designed to run the payload and the data eraser component. <br><br>  The launch component contains a specific time and date.  In the studied samples, two dates were set: December 17 and 20, 2016.  As soon as one of the two dates comes, the component creates two streams.  The first one tries to load the malicious DLL, the second one waits for one or two hours (depending on the version of the component), and then it tries to load the data eraser component.  Both threads have the highest priority of <code>THREAD_PRIORITY_HIGHEST</code> , which means they get a higher share of CPU resources. <br><br>  The name of the malicious DLL is added by the attackers through the command line parameter provided in one of the main backdoor commands (‚ÄúExecute the shell command‚Äù).  The name of the data eraser file is always <code>haslo.dat</code> .  The expected command lines are: <br><br> <code>%LAUNCHER%.exe %WORKING_DIRECTORY% %PAYLOAD%.dll %CONFIGURATION%.ini</code> <br> <br>  Each command line argument indicates the following: <br><br>  ‚Ä¢ <code>%LAUNCHER%.exe</code> is the name of the startup component file. <br>  ‚Ä¢ <code>%WORKING_DIRECTORY%</code> - directory where the malicious DLL and configuration is stored <br>  ‚Ä¢ <code>%PAYLOAD%.dll</code> is the name of the malicious DLL file <br>  ‚Ä¢ <code>%CONFIGURATION%.ini</code> is the file in which the configuration data of a specific payload is stored.  The path to this file is passed to the malicious DLL launch component. <br><br>  The payload and data eraser component are standard Windows DLL files.  To be loaded by the startup component, they must export the <code>Crash</code> function as shown in Figure.  five. <br><br><img src="https://habrastorage.org/web/3b3/96c/99f/3b396c99f2ae4ba3a1d6659a5cf8b2cd.png"><br>  <i>Figure 5. An example of a malicious DLL with the internal name <code>Crash101.dll</code> and the exported <code>Crash</code> function.</i> <br><br><h3>  Component 101 </h3><br>  The malicious DLL with the file name <code>101.dll</code> is named after the international standard IEC 101 (aka <a href="https://en.wikipedia.org/wiki/IEC_60870-5">IEC 60870-5-101</a> ), which describes a protocol for monitoring and controlling electrical power systems.  The protocol provides communication between industrial control systems and remote terminal units (Remote Terminal Units - RTUs).  Data is exchanged via serial connection. <br><br>  Component 101 partially implements the protocol described in the IEC 101 standard. It is capable of communicating with the RTU and any other device that supports this protocol. <br><br>  After execution, component 101 analyzes the configuration stored in the INI file.  A configuration can contain several entries: process name, Windows device names (usually COM ports), number of ranges, and range values ‚Äã‚Äãfor information object addresses (IOA).  An IOA is a number that identifies a particular data item in a device.  In fig.  6 shows the configuration file of component 101 with two defined IOA ranges: 10-15 and 20-25. <br><br><img src="https://habrastorage.org/web/734/bbf/ac9/734bbfac96e5475aa9df58a689c5a7dc.png"><br>  <i>Figure 6. Sample component configuration 101.</i> <br><br>  The name of the process specified in the configuration belongs to the application, which, as the attackers assume, works in the victim's system.  This should be the application that the machine uses to communicate with the RTU over a serial connection.  Component 101 attempts to complete this process and accesses the specified device using the Windows API functions <code>CreateFile</code> , <code>WriteFile</code> and <code>ReadFile</code> .  The first COM port from the configuration file is used for the actual connection, the other two are open to prevent other processes from accessing.  Thus, component 101 can take control of the RTU device. <br><br>  The component iterates over all IOA ranges.  For each IOA, it creates packets of select and execute commands with a one-position ( <code>C_SC_NA_1</code> ) and two-position command ( <code>C_DC_NA_1</code> ) and sends it to the RTU device.  The main purpose of the component is to change the value of the On / Off switch for the single-point and two-position IOA command type.  So, at the first stage, the component tries to switch IOA to Off, to the second - On, at the final stage - to return to Off. <br><br><img src="https://habrastorage.org/web/caa/4a3/ae1/caa4a3ae16924b2c9479a1f2bd76655a.png"><br>  <i>Figure 7. Example of a disassembled payload packet in Kaitai Struct WebIDE.</i> <br><br><h3>  Component 104 </h3><br>  The DLL with the file name <code>104.dll</code> is named after the standard IEC 104 ( <a href="https://en.wikipedia.org/wiki/IEC_60870-5">IEC 60870-5-104</a> ).  The IEC 104 protocol complements IEC 101 to transmit data over TCP / IP.  Due to the flexible configuration, the component can be configured to attack under various equipment.  Fig.  8 shows what the configuration file might look like. <br><br><img src="https://habrastorage.org/web/abe/26e/ea4/abe26eea4cc64ef59b44936fdfaa8271.png"><br>  <i>Fig.</i>  <i>8. Sample component configuration dll file 104.</i> <br><br>  After executing the DLL, component 104 will attempt to read the configuration file.  The path to the configuration file is taken from the loader component. <br><br>  The configuration contains a <code>STATION</code> section, followed by properties that determine the operation of component 104. The configuration may contain multiple <code>STATION</code> entries. <br><br>  Our analysis of this component shows the following possible configuration options: <br><br><img src="https://habrastorage.org/web/300/e8c/cd8/300e8ccd888447d78a02658cf68913df.png"><br><br>  After reading the configuration file, component 104 creates a process for each fragment of <code>STATION</code> , one for each.  In each such process, component 104 will attempt to contact the specified IP address using the protocol described in IEC 104. Before establishing the connection, it will attempt to complete the legitimate process that should be responsible for communicating with the device.  This happens only if the <code>stop_comm_service</code> property <code>stop_comm_service</code> registered in the configuration.  By default, component 104 terminates the process with the name <code>D2MultiCommService.exe</code> , or with the name specified in its configuration. <br><br>  The basic idea of ‚Äã‚Äãusing component 104 is relatively simple.  It communicates with the specified IP and starts sending packets with the ASDU address specified in its configuration.  The purpose of this data exchange is to communicate with IOA one-type commands.  In the configuration file, an attacker can define the <code>operation</code> property to indicate how IOA addresses of a single position type will be polled. <br><br>  The first such <code>operation</code> mode is <code>range</code> .  Hackers use it to detect possible IOA in the device of interest.  They have to apply this approach because the protocol described in the IEC 104 standard does not provide a definite method for obtaining this information. <br><br>  <code>range</code> works in two stages.  During the first, after receiving the IOA range from the configuration file, component 104 connects to the target IP address and polls the specified IOA.  To each of these IOAs, component 104 sends packets of select and execute commands to change state and check whether the given IOA is of a single-position command type. <br><br><img src="https://habrastorage.org/web/e7d/ce5/63f/e7dce563f4894f82a0d518b908cd697d.png"><br>  <i>Fig.</i>  <i>9. An example of a packet of component 104 decoded in Wireshark.</i> <br><br>  As soon as all possible IOAs from a certain range are polled, component 104 proceeds to the second stage of the <code>range</code> mode.  If the ability to write to the logs is enabled, the component will write <code>Starting only success</code> .  The rest of the second stage consists in an endless cycle of using previously detected single-position IOA type.  In the loop, the component continuously sends packets of select and execute commands.  In addition, if the <code>change</code> option is defined, the component switches the On / Off state between stages of the cycle. <br><br>  In fig.  10 shows the log file that component 104 issued during our analysis.  From it, we see that the component interrogated IOA from 10 to 15 and, when IOA of the single-position type were detected, began their use in a loop.  In the configuration, the <code>change</code> option was turned on, so that between cycles the component switched the switch value from On to Off and wrote it to the log. <br><br><img src="https://habrastorage.org/web/e08/2f4/4d0/e082f44d003f4ce5a993208432d2e164.png"><br>  <i>Fig.</i>  <i>10. Example of log component 104.</i> <br><br>  The second mode of <code>operation</code> is <code>shift</code> .  It is very similar to <code>range</code> mode.  The attacker defines the range of IOA and changeable values ‚Äã‚Äãin the configuration file.  After activating component 104, everything happens exactly the same way as in the range mode;  however, as soon as all IOA in a certain range are polled, it begins polling a new range.  The new range is calculated by adding the default range and the shift values. <br><br>  The third <code>operation</code> - <code>sequence</code> mode.  Can be used by hackers after they know the values ‚Äã‚Äãof all IOA single-point type of commands supported by the connected device.  This component will immediately begin executing an infinite loop, transferring the selection and execution packets to the IOA specified in the configuration file. <br><br>  In addition to the ability to write to the log, component 104 can output debugging information to the console, as shown in fig.  eleven. <br><br><img src="https://habrastorage.org/web/982/22a/bce/98222abce31a41bfa47f503346642f69.png"><br>  <i>Fig.</i>  <i>11. The output to the console component 104.</i> <br><br><h3>  Component 61850 </h3><br>  Unlike components 101 and 104, it exists as a separate malicious tool consisting of an executable file called <code>61850.exe</code> and DLL <code>61850.dll</code> .  Named after the <a href="https://en.wikipedia.org/wiki/IEC_61850">IEC 61850 standard</a> .  This standard describes the protocol used to exchange data between devices from different manufacturers that perform the functions of protection, automation, measurement, monitoring and control of automation systems of electrical substations.  This is a complex and reliable protocol, but component 61850 uses only a small number of its parameters to lead to devastating consequences. <br><br>  After executing the DLL, the 61850 component tries to read the configuration file, whose path is provided by the launch component.  A separate default version takes the configuration from <code>i.ini</code> .  It is expected that the configuration file contains a list of IP addresses of devices that can communicate using the protocol described in the IEC 61850 standard. <br><br>  If the configuration file is not found, component 61850 numbers all connected network adapters to define their TCP / IP subnet masks.  The component then numbers all possible IP addresses for each of the subnet masks and tries to connect to port 102 of each address.  Thus, the component can automatically detect suitable devices in the network. <br><br>  In another case, if the configuration file is found and contains the target IP addresses, the component connects to port 102 via these addresses and those found automatically. <br>  As soon as this component connects to the target host, it sends a connection request packet using a connection-oriented transport protocol, as shown in Figure 2.  12. <br><br><img src="https://habrastorage.org/web/c7a/dc4/80a/c7adc480a820488b898a0f69e1070777.png"><br>  <i>Fig.</i>  <i>12 Decoded connection request packet in Wireshark.</i> <br><br>  If the target device responds properly, component 61850 sends the <code>InitiateRequest</code> packet using the <a href="https://en.wikipedia.org/wiki/Manufacturing_Message_Specification">Production Message Specification</a> (MMS).  If the expected response is received, it sends an MMS request to <code>getNameList</code> .  Thus, the component lists the names of the objects in the virtual production device (VMD). <br><br>  This component 61850 then numbers the components found in the previous step and sends domain-specific <code>getNameList</code> requests with each object name.  Thus, the component numbers the named variables in a specific domain. <br><br><img src="https://habrastorage.org/web/e30/e4a/c37/e30e4ac37f6f4cc4a9bcda3d8f49295f.png"><br>  <i>Fig.</i>  <i>13. Decoded MMS request <code>getNameList</code> in Wireshark.</i> <i><br></i> <br>  Then the 61850 component parses the information obtained in response to these requests, and searches for variables that contain the following string sequences: <br><br><ul><li>  CSW, CF, Pos and Model </li><li>  CSW, ST, Pos and stVal </li><li>  CSW, CO, Pos, Oper, but not $ T </li><li>  CSW, CO, Pos, SBO, but not $ T </li></ul><br>  The CSW sequence is the name of a logical node that is used to control circuit breakers and switches. <br><br>  For variables that contain the Model or stVal sequences, component 61850 sends an additional MMS request <code>Read</code> .  For some of these variables, the component can also send an MMS <code>Write</code> request, which will change their current state. <br><br>  Component 61850 will create a file with its operation logs, containing IP addresses, MMS domains, named variables and the state of the nodes (open or closed) of its targets. <br><br><h3>  OPC DA component </h3><br>  The OPC DA component implements the client for the protocol described in the <a href="https://en.wikipedia.org/wiki/OPC_Data_Access">OPC Data Access</a> specification.  <a href="https://en.wikipedia.org/wiki/Open_Platform_Communications">OPC (OLE for Process Control)</a> is a software standard and specification based on Microsoft technologies such as OLE, COM, and DCOM.  The part related to data access (DA) of the OPC specification allows real-time data exchange between distributed components according to the client-server model. <br><br>  This component exists as a separate malicious tool with the file name <code>OPC.exe</code> and DLL, which uses the functionality of both 61850 and OPC DA components.  The internal name of the DLL in the exported PE table is <code>OPCClientDemo.dll</code> , which suggests that this component can be based on the open source project <a href="https://sourceforge.net/projects/opcclient/">OPC Client</a> . <br><br><img src="https://habrastorage.org/web/c0d/485/fea/c0d485fea69e443b9e28c33ad825ffb0.png"><br>  <i>Fig.</i>  <i>14. Table PE shows the internal DLL name of the OPC DA component.</i> <br><br>  The OPC DA component does not require any configuration file.  After an attacker executes, it numbers all OPC servers using the <code>ICatInformation::EnumClassesOfCategories</code> with the category identifier <code>CATID_OPCDAServer20</code> and <code>IOPCServer::GetStatus</code> to determine which ones are running. <br><br>  The following component uses the <code>IOPCBrowseServerAddressSpace</code> interface to number all OPC server elements.  In a special way, it searches for elements that contain the following sequences in the name: <br><br><ul><li>  ctlSelOn </li><li>  ctlOperOn </li><li>  ctlSelOff </li><li>  ctlOperOff </li><li>  \ Pos and stVal </li></ul><br>  Element names suggest that the attackers are interested in OPC elements provided by OPC servers that relate to <a href="http://new.abb.com/">ABB</a> solutions, such as the <a href="http://new.abb.com/substation-automation/products/software/microscada-pro">MicroSCADA</a> line.  In fig.  Figure 15 shows a sample of OPC elements that contain names with similar string sequences.  This list of OPC items is obtained from the OPC process object lists tool from ABB. <br><br><img src="https://habrastorage.org/web/d31/188/46d/d3118846d12b4ba5bded2db19c03dab6.png"><br>  <i>Fig.</i>  <i>15. An example of the names of OPC elements in the IN field, obtained with the tool of the lists of objects of the OPC process.</i> <br><br>  Attackers use the <code>Abdul</code> line when adding a new OPC group.  Perhaps this line is used by attackers as a slang name for ABB solutions. <br><br><img src="https://habrastorage.org/web/aed/9a6/08d/aed9a608d94842db9f58205322681539.png"><br>  <i>Fig.</i>  <i>16. Disassembled code of the OPC DA component, which uses the <code>Abdul</code> string.</i> <br><br>  At the final stage, the OPC DA component tries to change the state of the detected OPC elements using the <code>IOPCSyncIO</code> interface, setting the value 0x01 twice. <br><br><img src="https://habrastorage.org/web/0b5/06e/29c/0b506e29c27a4d529233e369e9f2a0b8.png"><br>  <i>Fig.</i>  <i>17. Disassembled code of an OPC DA component that uses the <code>IOPCSyncIO</code> interface.</i> <br><br>  The component writes the name of the OPC server, the state of the name of the OPC element, the quality code and the value in the log file.  Recorded values ‚Äã‚Äãare separated by the following header lines: <br><br><ul><li>  [* ServerName:% SERVERNAME%] [State: Before] </li><li>  [* ServerName:% SERVERNAME%] [State: After ON] </li><li>  [* ServerName:% SERVERNAME%] [State: After OFF] </li></ul><br><h3>  Data eraser component </h3><br>  The Data Wiper component is a destructive component that is used in the final stage of an attack.  Hackers use this component to cover their tracks and complicate the recovery process. <br><br>  The file name of this component is <code>haslo.dat</code> or <code>haslo.exe</code> , it can be executed by the start component, or used as a separate malicious tool. <br><br>  After execution, the component tries to number all the keys in the registry, which lists the Windows services. <br><br> <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services</code> <br> <br>  It tries to set the value of the <code>ImagePath</code> registry with an empty string in each detected entry.  This will cause the operating system to stop loading. <br><br>  The next step is to delete the contents of the file.  The component numbers files with certain extensions on all drives connected to the computer, from C: \ to Z: \.  It should be noted that during the numbering component skips files located in a subdirectory that contain the word <code>Windows</code> in the name. <br><br>  The component replaces the file contents with meaningless information obtained from the contents of the new allocated memory.  To perform this operation properly, the component tries to rewrite the files twice.  The first attempt occurs when the file is detected on the drive.  If the first attempt is unsuccessful, the component makes a second attempt, but before that it terminates all processes, except those included in the list of critical system processes.  The list of processes is shown in Fig.  18. <br><br>  To speed up the erasing process, the component overwrites only part of the contents of the file at its beginning.  The amount of information that will be rewritten depends on the size of the file.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The smallest amount of information will be rewritten for files of 1 Mb (4096 bytes) and less. </font><font style="vertical-align: inherit;">The largest amount of information will be rewritten for files of 10 Mb (32768 bytes) and less. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally, this component tries to terminate all processes, including system ones, except its own. </font><font style="vertical-align: inherit;">This will cause the system to stop responding and eventually fail.</font></font><br><br><img src="https://habrastorage.org/web/23c/99b/b73/23c99bb7341e478780f33ff963e05704.png"><br>  <i>Fig.</i> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18. List of processes that are not completed during the second attempt. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File name masks that the eraser component rewrites:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SYS_BASCON.COM </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .v </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .PL </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .paf </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .v </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .XRF </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .trc </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .SCL </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .bak </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .cid </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .scd </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .pcmp </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .pcmi </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .pcmt </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .xml </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .CIN </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .ini </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .prj </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .cxm </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .elb </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .epl </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .mdf </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .ldf </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .bak </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .bk </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .bkp </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .log </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .zip </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .rar </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .tar </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .7z </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .exe </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * .dll </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This list contains file name extensions that are used in a standard environment, such as Windows binaries (.exe / .dll), archives (.7z /.tar/.rar/.zip), backup files (.bak / .bk /. bkp), Microsoft SQL server files (.mdf / .ldf) and various configuration files (.ini / .xml). </font><font style="vertical-align: inherit;">In addition, the component erases files that can be used in industrial control systems, for example, written using </font></font><a href="https://en.wikipedia.org/wiki/Substation_Configuration_Language"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">substation configuration description language</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (.scl / .cid / .scd), as well as files and extensions that are used by ABB products. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, a file called </font></font><code>SYS_BASCON.COM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ABB is used for storing information with a configuration, and files with an extension </font></font><code>.paf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><code>Product Authorization File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) for storing information under licenses for ABB MicroSCADA products.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Additional tools: port scanner </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The attacker's arsenal includes a port scanner, which can be used to map the network and search for computers related to their attack. </font><font style="vertical-align: inherit;">What is interesting, instead of using existing software, hackers have created their own port scanner. </font><font style="vertical-align: inherit;">As can be seen from fig. </font><font style="vertical-align: inherit;">19, they can assign a range of IP addresses and a range of network ports to be scanned by this tool.</font></font><br><br><img src="https://habrastorage.org/web/e8f/b8f/b98/e8fb8fb9806f4767a388a85935b10076.png"><br>  <i>Fig.</i> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19. An example of using the port scanner.</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Additional Tools: DoS Tool </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another tool from the hacker‚Äôs arsenal is a Denial of Service (DoS) tool aimed at Siemens SIPROTEC devices. </font><font style="vertical-align: inherit;">The tool exploits the </font></font><a href="https://ics-cert.us-cert.gov/advisories/ICSA-15-202-01"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2015-5374</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vulnerability </font><font style="vertical-align: inherit;">to cause a device to hang. </font><font style="vertical-align: inherit;">As soon as this vulnerability is exploited, the device will stop responding to any commands until it is rebooted manually. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To exploit this vulnerability, attackers have hard-coded IP addresses of devices in the DoS tool. </font><font style="vertical-align: inherit;">When used, the tool sends specially created packets on port 50000 to the target IP address using UDP (User Datagram Protocol). </font><font style="vertical-align: inherit;">The UDP packet contains only 18 bytes.</font></font><br><br><img src="https://habrastorage.org/web/b9f/c88/4eb/b9fc884eb5144046a0d6fae250008e01.png"><br>  <i>Fig.</i> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20. The contents of the UDP packet involved in using the vulnerability CVE-2015-5374.</font></font></i> <br><br><h3>  Conclusion </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The investigation of power outages in Kiev in December 2016 has not yet been completed. At the moment there is no evidence that Industroyer was the direct cause of the failure. However, we believe this version is quite likely, since the malware allows you to directly control circuit breakers and circuit breakers in the network of electrical substations using ICS protocols, and also contains an activation time stamp on December 17, 2016, on the day of power failure.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can safely say that the Win32 / Industroyer family is an advanced and sophisticated malware aimed at industrial control systems. </font><font style="vertical-align: inherit;">The problem is that hardware is only a tool in the hands of even more advanced and highly skilled intruders. </font><font style="vertical-align: inherit;">The cyber group behind Industroyer can adapt the program to any such environment. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The widespread industrial protocols that Industroyer uses were created decades ago without security considerations. </font><font style="vertical-align: inherit;">Thus, any interference of hackers in the work of the industrial network, where these protocols are applied, will certainly lead to serious consequences.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Infection Indicators (IoCs) </font></font></h3><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1 hashes: </font></font></b> <font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">IP addresses of C &amp; C servers:</font></b></font><br> <code>F6C21F8189CED6AE150F9EF2E82A3A57843B587D <br> CCCCE62996D578B984984426A024D9B250237533 <br> 8E39ECA1E48240C01EE570631AE8F0C9A9637187 <br> 2CB8230281B86FA944D3043AE906016C8B5984D9 <br> 79CA89711CDAEDB16B0CCCCFDCFBD6AA7E57120A <br> 94488F214B165512D2FC0438A581F5C9E3BD4D4C <br> 5A5FAFBC3FEC8D36FD57B075EBF34119BA3BFF04 <br> B92149F046F00BB69DE329B8457D32C24726EE00 <br> B335163E6EB854DF5E08E85026B2C3518891EDA8</code> <br> <br> <b><font style="vertical-align: inherit;"></font></b> <br> <code>195.16.88[.]6 <br> 46.28.200[.]132 <br> 188.42.253[.]43 <br> 5.39.218[.]152 <br> 93.115.27[.]57 <br></code> <br>  Attention!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Most of the servers with these IP addresses were part of the Tor network, which means that using indicators can give a false positive match. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can ask additional questions or submit malware samples related to Win32 / Industroyer by emailing threatintel@eset.com.</font></font></i> </div><p>Source: <a href="https://habr.com/ru/post/330730/">https://habr.com/ru/post/330730/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330720/index.html">Reform SQL-based approach in DAO</a></li>
<li><a href="../330722/index.html">Preparing git reset correctly</a></li>
<li><a href="../330724/index.html">Turing Completeness Generic Java Types</a></li>
<li><a href="../330726/index.html">How to scale bitcoin blockchain</a></li>
<li><a href="../330728/index.html">The digest of interesting materials for the mobile developer # 207 (June 05-12)</a></li>
<li><a href="../330732/index.html">A very rude approach to determining a person‚Äôs language (or how to understand a person‚Äôs language from a normal corporate base)</a></li>
<li><a href="../330736/index.html">Crazy Artificial Intelligence</a></li>
<li><a href="../330738/index.html">Neuroclot: Part 4 - Final Model and Product Code</a></li>
<li><a href="../330740/index.html">Neurocoole Part 3. About chick marking</a></li>
<li><a href="../330744/index.html">One programming lesson</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>