<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Upload progress using PHP 5.4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Currently, there are many options for determining the progress of a file download: both with the help of client technologies and with the help of serv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Upload progress using PHP 5.4</h1><div class="post__text post__text-html js-mediator-article">  Currently, there are many options for determining the progress of a file download: both with the help of client technologies and with the help of server technologies.  An example of client technologies is swfupload using Flash, an example of server technologies is nginx_uploadprogress_module. <br>  The upcoming release of PHP presents us with a gift in the form of a native tool for determining the progress of downloading a file. <br>  We will deal with it. <a name="habracut"></a><br><br>  PHP is still in the RC stage, but it will soon appear on dedicated servers, VDS and especially daring hosting.  In any case, in the uncertain future, PHP 5.4 will become the main branch, and PHP 5.3 will be declared deprecated. <br>  Let's start with the form: <br><br><pre><code class="php hljs">&lt;form action=<span class="hljs-string"><span class="hljs-string">""</span></span> method=<span class="hljs-string"><span class="hljs-string">"POST"</span></span> enctype=<span class="hljs-string"><span class="hljs-string">"multipart/form-data"</span></span>&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"&lt;?=ini_get("</span></span>session.upload_progress.name<span class="hljs-string"><span class="hljs-string">")?&gt;"</span></span> value=<span class="hljs-string"><span class="hljs-string">"uniqueValue"</span></span> /&gt;&lt;br /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"file"</span></span> name=<span class="hljs-string"><span class="hljs-string">"file"</span></span> /&gt;&lt;br /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> /&gt; &lt;/form&gt;</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The only remarkable place in it is a hidden field with the name PHP_SESSION_UPLOAD_PROGRESS (which can be changed, therefore it is defined here through a function).  And any unique value. <br><br>  Place the form in the iframe on the target page. <br>  And put our script to determine the percentage of loading: <br><br><pre> <code class="php hljs">&lt;script src=<span class="hljs-string"><span class="hljs-string">"https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span></span>&gt;&lt;/script&gt; &lt;script&gt; $(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $.get(<span class="hljs-string"><span class="hljs-string">'?ajax'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function"> </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#ajax'</span></span>).html(data); }); }, <span class="hljs-number"><span class="hljs-number">500</span></span>); }); &lt;/script&gt; &lt;div id=<span class="hljs-string"><span class="hljs-string">"ajax"</span></span>&gt;&lt;/div&gt;</code> </pre><br>  For an asynchronous request, I used the jQuery library to reduce the code and improve its readability. <br>  In this case, everything that we get from asynchronous requests, I put in a block with the identifier ajax. <br><br>  And the last part is the server handler for the asynchronous request: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SESSION[<span class="hljs-string"><span class="hljs-string">"upload_progress_uniqueValue"</span></span>])) { $progress = $_SESSION[<span class="hljs-string"><span class="hljs-string">"upload_progress_uniqueValue"</span></span>]; $percent = round(<span class="hljs-number"><span class="hljs-number">100</span></span> * $progress[<span class="hljs-string"><span class="hljs-string">'bytes_processed'</span></span>] / $progress[<span class="hljs-string"><span class="hljs-string">'content_length'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Upload progress: $percent%&lt;br /&gt;&lt;pre&gt;"</span></span> . print_r($progress, <span class="hljs-number"><span class="hljs-number">1</span></span>) . <span class="hljs-string"><span class="hljs-string">'&lt;/pre&gt;'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'no uploading'</span></span>; }</code> </pre> <br>  This is a debug option, and it contains unnecessary data for the working draft.  But we just want to look at them and also throw out in response. <br><br>  We put it all on one page, the code is small (half a page) and therefore I will post it right here: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> session_start(); $uploadName = <span class="hljs-string"><span class="hljs-string">'test'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   if (isset($_GET['ajax'])) { //   if (isset($_SESSION["upload_progress_$uploadName"])) { //      $progress = $_SESSION["upload_progress_$uploadName"]; $percent = round(100 * $progress['bytes_processed'] / $progress['content_length']); echo "Upload progress: $percent%&lt;br /&gt;&lt;pre&gt;" . print_r($progress, 1) . '&lt;/pre&gt;'; } else { echo 'no uploading'; } exit; } elseif (isset($_GET['frame'])) { //   </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;form action="" method="POST" enctype="multipart/form-data"&gt; &lt;input type="hidden" name="</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=ini_get("session.upload_progress.name")</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">" value="</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$uploadName</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">" /&gt;&lt;br /&gt; &lt;input type="file" name="file" /&gt;&lt;br /&gt; &lt;input type="submit" /&gt; &lt;/form&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> } else { </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;iframe src="?frame" height="100" width="500"&gt;&lt;/iframe&gt; &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"&gt;&lt;/script&gt; &lt;script&gt; $(function() { setInterval(function() { //   $.get('?ajax', function(data) { //    $('#ajax').html(data); //     }); }, 500); }); &lt;/script&gt; &lt;div id="ajax"&gt;&lt;/div&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> }</span></span></code> </pre> <br>  Imposition is invalid - it is specially reduced for an example as much as possible. <br><br>  Screenshot for clarity: <br><img src="http://mepic.ru/up/pic_b/3c9622a606b22ff68b309aa9fab49d6a.png"><br><br>  The article provides basic information that can be found in the documentation, but since this is not the case in current, up-to-date documentation, and even more so in books, I thought it would be useful for PHP developers. </div><p>Source: <a href="https://habr.com/ru/post/136974/">https://habr.com/ru/post/136974/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136968/index.html">The Tale of Cocos2d-android</a></li>
<li><a href="../136969/index.html">Improvements to working with PDF in Evernote for Windows</a></li>
<li><a href="../136970/index.html">Truly personalized search</a></li>
<li><a href="../136972/index.html">Speech by the founder and CMO Badoo at the DLD conference</a></li>
<li><a href="../136973/index.html">Important results of 2011</a></li>
<li><a href="../136976/index.html">Pay authors, not copywriters</a></li>
<li><a href="../136977/index.html">What hosting is not enough in Russia?</a></li>
<li><a href="../136979/index.html">Help, my database is corrupt. Now what?</a></li>
<li><a href="../136980/index.html">Cordless, 2nd edition</a></li>
<li><a href="../136983/index.html">Oil Rush: official release</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>