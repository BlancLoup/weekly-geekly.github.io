<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CI: continuous integration in 5 minutes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Having read the article to the very end, you will guess why the beaver in the box was chosen as the CCDV. 

 All health, comrades Habrozhiteli. Most r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CI: continuous integration in 5 minutes</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/55/3n/iz/553nize7l2wmt9q7ydf2ixfv7zy.jpeg"><br>  <i>Having read the article to the very end, you will guess why the beaver in the box was chosen as the CCDV.</i> <br><br>  All health, comrades Habrozhiteli.  Most recently, I faced the need to raise and configure the Continuous Integration service (hereinafter referred to as CI) on one very small project, which is very indirectly related to my work.  Time was not running out, so I decided to try something new (previously I used only Travis and Jenkins).  The main selection criterion was: ‚Äúsimplicity and speed of system deployment on an integration server‚Äù. <br><br>  Under the cut is a small story and the resulting tool for CI, written in two evenings on Bash. <br><a name="habracut"></a><br><h3>  Idea </h3><br>  Maybe I was looking badly, maybe I wanted to sacrifice bicycles to the god, but I didn‚Äôt see any CI service that could just be thrown onto the server, put a couple of webhooks into Github configuration and forget about DevOps.  Therefore, I decided not to spend time searching any more (and I spent about 1-2 hours), but to write something simple on Bash. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The idea was as follows: <i>to write the simplest <b>CI-trigger</b> on Bash, which will run along the chain (pipe) of the functions configured from another (configuration) script.</i> <br><br>  The advantages of this solution are obvious: <br><br><ul><li>  You can write it in ten minutes </li><li>  It will be very flexible. </li><li>  Nothing is required to deploy CI, except for transferring the CI-trigger file and configuration to the integration server. </li></ul><br>  I think about the downsides of this decision, you yourself guessed it.  I will give only a few: <br><br><ul><li>  No easy to use and customize GUI </li><li>  There are no ready-made solutions and plug-ins. You‚Äôll have to write everything to Bash or those available for it to call. </li><li>  Some knowledge of project preparation, deployment and testing is required. </li></ul><br><h3>  Implementation </h3><br>  The CI-trigger itself is elementary: <br><br><div class="spoiler">  <b class="spoiler_title">CI-trigger</b> <div class="spoiler_text"><pre><code class="bash hljs">config=`<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span>`/ci.config <span class="hljs-comment"><span class="hljs-comment">#    log=`pwd`/ci.log #  - #   # ... #   - function ci_bootstrap { return 0 } function ci_update { return 0 } function ci_analyse { return 0 } function ci_build { return 0 } function ci_unit_test { return 0 } function ci_deploy { return 0 } function ci_test { return 0 } function ci_archive { return 0 } function ci_report { return 0 } function ci_error { return 0 } #      . $config &amp;&amp;\ ( \ ci_bootstrap &amp;&amp;\ ci_update &amp;&amp;\ ci_analyse &amp;&amp;\ ci_build &amp;&amp;\ ci_unit_test &amp;&amp;\ ci_deploy &amp;&amp;\ ci_test &amp;&amp;\ ci_archive &amp;&amp;\ ci_report || ci_error ) 1&gt;&gt;$log 2&gt;&amp;1</span></span></code> </pre> <br></div></div><br>  <i>I did not give the full script code, omitting the logic for parsing command line arguments, since this is trivial and irrelevant to the task (at the end of the article there will be a link to the project repository where you can see the source code without abbreviations).</i> <br><br>  As you can see, it all comes down to declaring 9 <b>integration functions</b> called pipelining to perform integration when the CI-trigger starts.  Both output pipelines are combined in a single <b>log file</b> , which acts as a report on the results of the integration. <br><br>  Before executing the integration pipeline, a <b>configuration script</b> is invoked on behalf of CI-tirgger ( <code>. $config</code> Config), allowing it to redefine any functions.  This is the whole ‚Äúmagic‚Äù of the solution.  Due to the fact that the configuration script is written in Bash, we can use any logic to perform the integration, simply by grouping it into functions. <br><br><div class="spoiler">  <b class="spoiler_title">Configuration example</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#     cd my-project #     function ci_bootstrap { mysql -uadmin -pmy_pass -e "DROP DATABASE db; CREATE DATABASE db" } #     function ci_update { if test -d .git; then return git pull else return git clone https://github.com/vendor/project ./ fi } #  function ci_build { return npm install &amp;&amp; npm run build } #    function ci_unit_test { return npm run unit_test } #   function ci_deploy { return mysql -uadmin -pmy_pass db &lt; migration/schema.sql &amp;&amp;\ mysql -uadmin -pmy_pass db &lt; migration/data.sql } #     function ci_report { return mail -s "CI report" my@mail.com &lt; $log } #    function ci_error { echo "== Error ==" return mail -s "CI report" my@mail.com &lt; $log }</span></span></code> </pre><br></div></div><br>  Now we just have to adjust the logic of the CI-trigger call in accordance with our requirements. <br><br><h4>  Periodic call </h4><br>  To do this, just configure Cron, for example: <br><br><div class="spoiler">  <b class="spoiler_title">crontab</b> <div class="spoiler_text"><pre> <code class="bash hljs">0 0 * * * /home/user/ci/trigger</code> </pre><br></div></div><br><h4>  Call at change </h4><br>  This solution requires the implementation of the mechanism responsible for listening to the port of the integration server with a CI-trigger call when accessing it.  I suggest using netcat and the following simple bash script for this: <br><br><div class="spoiler">  <b class="spoiler_title">Listening port</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -ne <span class="hljs-string"><span class="hljs-string">"HTTP/1.0 200 OK\r\n\r\n"</span></span>; } | nc -v -l -p 8000 &amp;&amp; /home/user/ci/trigger <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br></div></div><br>  Now you need to configure the version control system used by us to execute an HTTP request to this port with each push commits, for example using Curl: <br><br><div class="spoiler">  <b class="spoiler_title">.git / hooks / post-commit</b> <div class="spoiler_text"><pre> <code class="bash hljs">curl -X POST http://ci-server.com:8000</code> </pre><br></div></div><br><h3>  Links and all that </h3><br>  Naturally, this solution is far from ideal, you will have to ‚Äúwork with your hands‚Äù a lot in order to use it in a large project, but for a quick launch of the CI service it is quite suitable (I think so!). <br><br><ul><li>  <a href="http://github.com/bashka/beaver">Project repository</a> </li><li>  <a href="https://github.com/bashka/beaver">Brief documentation</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/341818/">https://habr.com/ru/post/341818/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341808/index.html">The book "Scala. Professional programming</a></li>
<li><a href="../341810/index.html">Alt-text guide from a visually impaired web developer</a></li>
<li><a href="../341812/index.html">In the footsteps of CyberCrimeCon 2017: Trends and development of high-tech crime</a></li>
<li><a href="../341814/index.html">Welcome to Sberbank Data Science Day November 11</a></li>
<li><a href="../341816/index.html">Meet NoteCAD</a></li>
<li><a href="../341822/index.html">A complete guide to writing a utility for Go</a></li>
<li><a href="../341824/index.html">Taming "dinosaur", or CI / CD and IBM System i</a></li>
<li><a href="../341826/index.html">Denis Litvinov (COO FunCorp): Product Metrics for US Mobile Applications</a></li>
<li><a href="../341828/index.html">UE4 for Unity developers: creating 2D games</a></li>
<li><a href="../341830/index.html">Using Singleton in Unity3D</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>