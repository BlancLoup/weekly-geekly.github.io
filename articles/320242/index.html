<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Clean Recycler Adapter. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 Lists, lists, lists ... Vertical, horizontal, combined. Virtually no mobile application is complete without them. Moreover, applicati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Clean Recycler Adapter. Part 1</h1><div class="post__text post__text-html js-mediator-article"><h3>  Introduction </h3><br><img src="https://habrastorage.org/files/435/af0/97f/435af097f3c44919b78274e0dd14851b.png"><br><br>  Lists, lists, lists ... Vertical, horizontal, combined.  Virtually no mobile application is complete without them.  Moreover, applications often consist of lists only. <br><br>  And if in the ‚Äúhomogeneous‚Äù lists there is nothing terrible, then different types of cells can already raise questions, the main of which are: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  how to make cell types changing and scaling easier </li><li>  how to minimize the number of places to change, reducing the risk of potential errors </li><li>  how to get rid of <i>if-else</i> ugliness </li><li>  how to get rid of ugly type checks and dangerous type conversions </li></ul><a name="habracut"></a><br><h3>  What's wrong with <i>if-else</i> </h3><br>  In general, in ‚Äúifakhs‚Äù (here are constructions of the form like <i>-else</i> and <i>switch-case</i> ) there is nothing terrible ... as long as they are used for binary choices (for example, the notorious check for null).  But when the number of options exceeds two answers, then this is a reason to think about what is wrong with the code and how to fix it. <br><br>  So why the abundance of choice operators is bad? <br><br>  Well, firstly, because "ifs" in one place almost always generate "ifs" and in other places of the code.  Thus, we obtain from one to infinity (in the limit) editing places.  And if you need to make changes, it's very easy to forget to change ‚Äúone more place‚Äù. <br><br>  Secondly, if you look at the situation again in the limit, then we can get an infinite number of choices.  That in the code of the ‚Äúmain‚Äù class will look ugly and will become a place of potential (and very likely) errors. <br><br>  And thirdly, the multitude of ‚ÄúIphas‚Äù is in essence a moveton, a sign that from an architectural point of view, things are not so rosy as it seemed at first glance. <br><br>  So how can you fix the situation? <br><br>  There are at least two ways to solve the problem. <br><br>  First, use the so-called ‚Äútabular method‚Äù (Steve McConnell ‚ÄúPerfect Code‚Äù) and replace the selection logic with a set of prepared data.  Which, firstly, eliminates the amount of ugly code, and secondly, allows you to use external sources to provide these same data, thereby eliminating the need to make changes to the code itself. <br><br>  Secondly, you can use the factory pattern (Banda of Four ‚ÄúDesign Patterns‚Äù) and encapsulate the logic of choice in one place - in the factory (besides the main duty - hiding the generation of new objects of the same type - the factory can also encapsulate the logic of choice).  This does not eliminate the ‚Äúiphs‚Äù completely, as the previous method, but reduces the number of such places to one.  Accordingly, the code becomes more beautiful and easy to maintain, because  in the case of changes, it will need to be done in exactly one place. <br><br><h3>  What's wrong with type checking </h3><br>  The type check itself doesn‚Äôt mean anything bad.  Moreover, looking through the source code even from the largest players in the world of android, I often ran across such checks. <br><br>  But still a type check, in my opinion, is an omission in architecture (by the way, Scott Myers agrees with me).  And if there is an opportunity to get rid of such checks, then it must be done. <br><br>  How? <br><br>  The first thing that comes to mind is the familiar ‚Äútabular method.‚Äù  You can, for example, prepare a collection of type <i>map</i> , where you can preassign a type match. <br><br>  And the second.  But there are no such clear recommendations.  Everything will depend on the specific case.  You can try to use Java Generics where possible.  You can look very closely at such a property of the system as polymorphism.  As the saying goes, ‚ÄúInterfaces still working everywhere‚Äù. <br><br><h3>  What's wrong with casting </h3><br>  Although the type conversion can be found even in the Android SDK (for example, <i>findViewById ()</i> or <i>getSystemService ()</i> ), this does not make this procedure safe.  Type casting always carries the potential threat of dropping an application by <i>ClassCastException</i> . <br><br>  Wrapping ‚Äúcastes‚Äù in <i>try-catch</i> blocks is not the best way out.  First, this design itself looks rather ugly.  And secondly, such a problem is quite difficult to catch, because  There are no drops, and the application behaves unpredictably. <br><br><div class="spoiler">  <b class="spoiler_title">As an option</b> <div class="spoiler_text">  A good solution, by the way, is setting up Fabric to send all non-fatal exceptions.  There are situations where the labor costs for the ‚Äúright‚Äù solution outweigh the benefits of using it.  Therefore, as I have repeatedly repeated, this is an occasion to think about how to fix the situation.  And if the decision is too ‚Äúexpensive‚Äù, then ... this is a reason to think. <br></div></div><br>  In any case, type casting is not the best choice.  And it is better to avoid it. <br><br>  How? <br><br>  Of the basic recipes, this is Java Generics and polymorphism.  It is also useful to take into account the existence of the Visitor pattern (a gang of four ‚ÄúDesign Patterns‚Äù). <br><br><h3>  ‚ÄúTraditional‚Äù approach </h3><br>  Deal with the problems.  Now let's remember how the task of displaying a ‚Äúheterogeneous‚Äù list is solved in the ‚Äútraditional‚Äù way.  ‚ÄúTraditional‚Äù is it because, firstly, the Internet prompts us to act this way, and secondly, according to my personal observations, the overwhelming number of juniors and the non-overwhelming number of midls do exactly that. <br><br>  For example, we have three types of cells: <br><br><div class="spoiler">  <b class="spoiler_title">ProgressVo.java</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Just a marker for progress header/footer. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProgressVo</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">AdVo.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AdVo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String title; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String description; <span class="hljs-comment"><span class="hljs-comment">// Getters, Setters, Builder, etc. }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">UserVo.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserVo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String firstName; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String lastName; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String age; <span class="hljs-comment"><span class="hljs-comment">// Getters, Setters, Builder, etc. }</span></span></code> </pre> <br></div></div><br>  First you need to declare constants for each cell type: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TYPE_PROGRESS = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TYPE_AD = <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TYPE_USER = <span class="hljs-number"><span class="hljs-number">30</span></span>;</code> </pre> <br>  Further, respectively, you need to determine the cell type for each specific position (in order to avoid hell with the calculation of positions, with arbitrary locations of different types of cells in the list, it is easiest to use an untyped collection): <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemViewType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ Object item = itemList.get(position); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ProgressVo) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TYPE_PROGRESS; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> AdVo) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TYPE_AD; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> UserVo) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TYPE_USER; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoSuchRecyclerItemTypeException(); } }</code> </pre> <br>  And create the appropriate holder: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewType)</span></span></span><span class="hljs-function"> </span></span>{ LayoutInflater inflater = LayoutInflater.from(parent.getContext()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (viewType == TYPE_PROGRESS) { View view = inflater.inflate(R.layout.cell_progress, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UsersRecyclerAdapter.ProgressViewHolder(view); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (viewType == TYPE_AD) { View view = inflater.inflate(R.layout.cell_ad, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UsersRecyclerAdapter.AdViewHolder(view); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (viewType == TYPE_USER) { View view = inflater.inflate(R.layout.cell_user, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UsersRecyclerAdapter.UserViewHolder(view); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoSuchRecyclerViewTypeException(); } }</code> </pre> <br>  And then also connect our holder with the data: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (holder <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ProgressViewHolder) { <span class="hljs-comment"><span class="hljs-comment">// Do nothing. } else if (holder instanceof AdViewHolder) { ((AdViewHolder) holder).bind((AdVo) itemList.get(position)); } else if (holder instanceof UserViewHolder) { ((UserViewHolder) holder).bind((UserVo) itemList.get(position)); } }</span></span></code> </pre> <br>  The whole class looks like this: <br><br><div class="spoiler">  <b class="spoiler_title">UsersUglyRecyclerAdapter.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersUglyRecyclerAdapter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Adapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TYPE_PROGRESS = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TYPE_AD = <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TYPE_USER = <span class="hljs-number"><span class="hljs-number">30</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List itemList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UsersUglyRecyclerAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ itemList.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProgressVo()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemViewType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ Object item = itemList.get(position); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ProgressVo) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TYPE_PROGRESS; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> AdVo) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TYPE_AD; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> UserVo) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TYPE_USER; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoSuchRecyclerItemTypeException(); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewType)</span></span></span><span class="hljs-function"> </span></span>{ LayoutInflater inflater = LayoutInflater.from(parent.getContext()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (viewType == TYPE_PROGRESS) { View view = inflater.inflate(R.layout.cell_progress, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UsersRecyclerAdapter.ProgressViewHolder(view); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (viewType == TYPE_AD) { View view = inflater.inflate(R.layout.cell_ad, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UsersRecyclerAdapter.AdViewHolder(view); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (viewType == TYPE_USER) { View view = inflater.inflate(R.layout.cell_user, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UsersRecyclerAdapter.UserViewHolder(view); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoSuchRecyclerViewTypeException(); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (holder <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ProgressViewHolder) { <span class="hljs-comment"><span class="hljs-comment">// Do nothing. } else if (holder instanceof AdViewHolder) { ((AdViewHolder) holder).bind((AdVo) itemList.get(position)); } else if (holder instanceof UserViewHolder) { ((UserViewHolder) holder).bind((UserVo) itemList.get(position)); } } @Override public int getItemCount() { return itemList.size(); } public void setUsers(List&lt;UserVo&gt; users) { itemList.clear(); itemList.addAll(users); decorateItemList(); notifyDataSetChanged(); } private void decorateItemList() { int listSize = itemList.size(); int shift = 0; for (int i = 1; i &lt; listSize; i++) { if (i % 7 == 0) { itemList.add(i + shift, new AdVo()); shift++; } } itemList.add(new ProgressVo()); } protected static class ProgressViewHolder extends RecyclerView.ViewHolder { public ProgressViewHolder(View itemView) { super(itemView); } } protected static class AdViewHolder extends RecyclerView.ViewHolder { public AdViewHolder(View itemView) { super(itemView); } public void bind(AdVo ad) { // Bind ad... } } protected static class UserViewHolder extends RecyclerView.ViewHolder { public UserViewHolder(View itemView) { super(itemView); } public void bind(UserVo user) { // Bind user... } } }</span></span></code> </pre> <br></div></div><br>  What do we have in the end?  Three places with the logic of choice, the abundance of ‚Äúiofof‚Äù, type checks and type conversions.  In case of need to make changes, we already have 4 places for this (without taking into account the creation of a new holder when scaling). <br><br>  As if disorder and all that.  Let's understand how to fix the situation. <br><br><h3>  Cleaner approach </h3><br>  There may be several ways to solve this problem.  In this article, we use the adaptation of the ‚Äútabular method‚Äù, where the ‚Äútable‚Äù will be the <i>enum</i> . <br><br>  Our goal is to bring the code in a ‚Äúsingle line‚Äù view: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemViewType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CellType.get(itemList.get(position)).type(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CellType.get(viewType).viewHolder(parent); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ CellType.get(itemList.get(position)).bind(holder, itemList.get(position)); }</code> </pre> <br>  So, first we need to determine the types of cells used: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CellType { PROGRESS, AD, USER }</code> </pre> <br>  Let's start with what we need to determine the type of cell and create the corresponding holder: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CellType { PROGRESS { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> R.layout.cell_progress; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent)</span></span></span><span class="hljs-function"> </span></span>{ LayoutInflater inflater = LayoutInflater.from(parent.getContext()); View view = inflater.inflate(R.layout.cell_progress, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProgressViewHolder(view); } }, AD { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> R.layout.cell_ad; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent)</span></span></span><span class="hljs-function"> </span></span>{ LayoutInflater inflater = LayoutInflater.from(parent.getContext()); View view = inflater.inflate(R.layout.cell_ad, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AdViewHolder(view); } }, USER { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> R.layout.cell_user; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent)</span></span></span><span class="hljs-function"> </span></span>{ LayoutInflater inflater = LayoutInflater.from(parent.getContext()); View view = inflater.inflate(R.layout.cell_user, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UserViewHolder(view); } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent)</span></span></span></span>; }</code> </pre> <br>  I want to note that the cell markup <i>id is</i> used as the <i>viewType</i> .  Thus, firstly, there is no need to define constants, and secondly, unique <i>id</i> exclude conflict situations.  Some libraries can reserve certain constants for themselves or the current code-base does it.  And such things are easily forgotten, which ultimately leads to unpleasant consequences. <br><br>  Since  android SDK in the <i>getItemViewType ()</i> and <i>onBindViewHolder ()</i> methods uses the item's position in the collection, and in the <i>onCreateViewHolder ()</i> method is the <i>viewType</i> variable, then we need two methods to get the corresponding <i>enum</i> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CellType { PROGRESS { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ProgressVo; } ... }, AD { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> AdVo; } ... }, USER { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> UserVo; } ... }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> CellType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (CellType cellType : CellType.values()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cellType.is(item)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cellType; } } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoSuchRecyclerItemTypeException(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> CellType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (CellType cellType : CellType.values()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cellType.type() == viewType) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cellType; } } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoSuchRecyclerViewTypeException(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object item)</span></span></span></span>; ... }</code> </pre> <br>  The <i>is ()</i> method in this case is used only for ‚Äúinternal needs‚Äù. <br><br>  It remains only to associate the holder with the data: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CellType { PROGRESS { ... <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder, Object item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Do nothing. } }, AD { ... @Override void bind(RecyclerView.ViewHolder holder, Object item) { try { AdViewHolder adViewHolder = (AdViewHolder) holder; AdVo ad = (AdVo) item; adViewHolder.bind(ad); } catch (ClassCastException e) { L.printStackTrace(e); } } }, USER { ... @Override void bind(RecyclerView.ViewHolder holder, Object item) { try { UserViewHolder userViewHolder = (UserViewHolder) holder; UserVo user = (UserVo) item; userViewHolder.bind(user); } catch (ClassCastException e) { L.printStackTrace(e); } } }; ... abstract void bind(RecyclerView.ViewHolder holder, Object item); }</span></span></code> </pre> <br>  The resulting class looks like this: <br><br><div class="spoiler">  <b class="spoiler_title">UsersRecyclerAdapter.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersRecyclerAdapter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Adapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List itemList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UsersRecyclerAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ itemList.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProgressVo()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemViewType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CellType.get(itemList.get(position)).type(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CellType.get(viewType).viewHolder(parent); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ Object item = itemList.get(position); CellType.get(item).bind(holder, item); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> itemList.size(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;UserVo&gt; users)</span></span></span><span class="hljs-function"> </span></span>{ itemList.clear(); itemList.addAll(users); decorateItemList(); notifyDataSetChanged(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorateItemList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> listSize = itemList.size(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> shift = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; listSize; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i % <span class="hljs-number"><span class="hljs-number">7</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { itemList.add(i + shift, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AdVo()); shift++; } } itemList.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProgressVo()); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CellType { PROGRESS { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ProgressVo; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> R.layout.cell_progress; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent)</span></span></span><span class="hljs-function"> </span></span>{ LayoutInflater inflater = LayoutInflater.from(parent.getContext()); View view = inflater.inflate(R.layout.cell_progress, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProgressViewHolder(view); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder, Object item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Do nothing. } }, AD { @Override boolean is(Object item) { return item instanceof AdVo; } @Override int type() { return R.layout.cell_ad; } @Override RecyclerView.ViewHolder viewHolder(ViewGroup parent) { LayoutInflater inflater = LayoutInflater.from(parent.getContext()); View view = inflater.inflate(R.layout.cell_ad, parent, false); return new AdViewHolder(view); } @Override void bind(RecyclerView.ViewHolder holder, Object item) { try { AdViewHolder adViewHolder = (AdViewHolder) holder; AdVo ad = (AdVo) item; adViewHolder.bind(ad); } catch (ClassCastException e) { L.printStackTrace(e); } } }, USER { @Override boolean is(Object item) { return item instanceof UserVo; } @Override int type() { return R.layout.cell_user; } @Override RecyclerView.ViewHolder viewHolder(ViewGroup parent) { LayoutInflater inflater = LayoutInflater.from(parent.getContext()); View view = inflater.inflate(R.layout.cell_user, parent, false); return new UserViewHolder(view); } @Override void bind(RecyclerView.ViewHolder holder, Object item) { try { UserViewHolder userViewHolder = (UserViewHolder) holder; UserVo user = (UserVo) item; userViewHolder.bind(user); } catch (ClassCastException e) { L.printStackTrace(e); } } }; static CellType get(Object item) { for (CellType cellType : CellType.values()) { if (cellType.is(item)) { return cellType; } } throw new NoSuchRecyclerItemTypeException(); } static CellType get(int viewType) { for (CellType cellType : CellType.values()) { if (cellType.type() == viewType) { return cellType; } } throw new NoSuchRecyclerViewTypeException(); } abstract boolean is(Object item); abstract int type(); abstract RecyclerView.ViewHolder viewHolder(ViewGroup parent); abstract void bind(RecyclerView.ViewHolder holder, Object item); } protected static class ProgressViewHolder extends RecyclerView.ViewHolder { public ProgressViewHolder(View itemView) { super(itemView); } } protected static class AdViewHolder extends RecyclerView.ViewHolder { public AdViewHolder(View itemView) { super(itemView); } public void bind(AdVo ad) { // Bind ad... } } protected static class UserViewHolder extends RecyclerView.ViewHolder { public UserViewHolder(View itemView) { super(itemView); } public void bind(UserVo user) { // Bind user... } } }</span></span></code> </pre> <br></div></div><br><h3>  A little more ‚Äúpurity‚Äù </h3><br>  Alternatively, type checking can be replaced by another ‚Äútabular method‚Äù.  You can use the <i>map</i> collection to check the type match. <br><br>  Remove the <i>is ()</i> method and initialize the corresponding <i>map</i> collection: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CellType { ... <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Map&lt;Class, CellType&gt; typeTable = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { typeTable.put(ProgressVo.class, PROGRESS); typeTable.put(AdVo.class, AD); typeTable.put(UserVo.class, USER); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> CellType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> typeTable.get(item.getClass()); } ‚Ä¶ }</code> </pre> <br>  This approach should be considered as an alternative.  Those.  This is such a half-measure (the question was solved with a type check, but did not affect the type conversion), which also simplifies the <i>enum</i> contract. <br><br>  What does it threaten with? <br><br>  And the fact that it is possible in the heat of <s>battle to</s> make changes is very easy to forget about this <i>typeTable</i> and get <i>NPE</i> . <br><br>  Supporting the ‚Äúfull‚Äù contract (this is the <i>is ()</i> method), this situation is excluded. <br><br><h3>  Conclusion </h3><br>  So what we got at the exit? <br><br>  Begin with this: <br><br><div class="spoiler">  <b class="spoiler_title">Ugly Adapter</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TYPE_PROGRESS = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TYPE_AD = <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TYPE_USER = <span class="hljs-number"><span class="hljs-number">30</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemViewType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ Object item = itemList.get(position); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ProgressVo) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TYPE_PROGRESS; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> AdVo) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TYPE_AD; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> UserVo) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TYPE_USER; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoSuchRecyclerItemTypeException(); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewType)</span></span></span><span class="hljs-function"> </span></span>{ LayoutInflater inflater = LayoutInflater.from(parent.getContext()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (viewType == TYPE_PROGRESS) { View view = inflater.inflate(R.layout.cell_progress, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UsersRecyclerAdapter.ProgressViewHolder(view); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (viewType == TYPE_AD) { View view = inflater.inflate(R.layout.cell_ad, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UsersRecyclerAdapter.AdViewHolder(view); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (viewType == TYPE_USER) { View view = inflater.inflate(R.layout.cell_user, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UsersRecyclerAdapter.UserViewHolder(view); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoSuchRecyclerViewTypeException(); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (holder <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ProgressViewHolder) { <span class="hljs-comment"><span class="hljs-comment">// Do nothing. } else if (holder instanceof AdViewHolder) { ((AdViewHolder) holder).bind((AdVo) itemList.get(position)); } else if (holder instanceof UserViewHolder) { ((UserViewHolder) holder).bind((UserVo) itemList.get(position)); } }</span></span></code> </pre> <br></div></div><br>  And they came to this: <br><br><div class="spoiler">  <b class="spoiler_title">Clean adapter</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemViewType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CellType.get(itemList.get(position)).type(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CellType.get(viewType).holder(parent); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ Object item = itemList.get(position); CellType.get(item).bind(holder, item); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CellType { PROGRESS { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ProgressVo; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> R.layout.cell_progress; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">holder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent)</span></span></span><span class="hljs-function"> </span></span>{ LayoutInflater inflater = LayoutInflater.from(parent.getContext()); View view = inflater.inflate(R.layout.cell_progress, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProgressViewHolder(view); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder, Object item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Do nothing. } }, AD { @Override boolean is(Object item) { return item instanceof AdVo; } @Override int type() { return R.layout.cell_ad; } @Override RecyclerView.ViewHolder holder(ViewGroup parent) { LayoutInflater inflater = LayoutInflater.from(parent.getContext()); View view = inflater.inflate(R.layout.cell_ad, parent, false); return new AdViewHolder(view); } @Override void bind(RecyclerView.ViewHolder holder, Object item) { try { AdViewHolder adViewHolder = (AdViewHolder) holder; AdVo ad = (AdVo) item; adViewHolder.bind(ad); } catch (ClassCastException e) { L.printStackTrace(e); } } }, USER { @Override boolean is(Object item) { return item instanceof UserVo; } @Override int type() { return R.layout.cell_user; } @Override RecyclerView.ViewHolder holder(ViewGroup parent) { LayoutInflater inflater = LayoutInflater.from(parent.getContext()); View view = inflater.inflate(R.layout.cell_user, parent, false); return new UserViewHolder(view); } @Override void bind(RecyclerView.ViewHolder holder, Object item) { try { UserViewHolder userViewHolder = (UserViewHolder) holder; UserVo user = (UserVo) item; userViewHolder.bind(user); } catch (ClassCastException e) { L.printStackTrace(e); } } }; static CellType get(Object item) { for (CellType cellType : CellType.values()) { if (cellType.is(item)) { return cellType; } } throw new NoSuchRecyclerItemTypeException(); } static CellType get(int viewType) { for (CellType cellType : CellType.values()) { if (cellType.type() == viewType) { return cellType; } } throw new NoSuchRecyclerViewTypeException(); } abstract boolean is(Object item); abstract int type(); abstract RecyclerView.ViewHolder holder(ViewGroup parent); abstract void bind(RecyclerView.ViewHolder holder, Object item); }</span></span></code> </pre> <br></div></div><br>  Let's walk on the questions indicated at the beginning of the article. <br><br><ul><li>  make it easy to change and scale cell types </li><li>  minimize the number of places to change, reducing the risk of potential errors </li></ul><br>  We have exactly one place to make changes to existing cells (under the rapidly changing customer desires) and to add new ones.  Moreover, when adding a new type of cell it is possible that we will forget something, because  required to maintain the current contract enum.  Simple and safe. <br><br><ul><li>  get rid of <i>if-else</i> ugliness </li></ul><br>  The cumbersome and ugly logic of choice is no longer there.  No, and three places where this logic was used.  The risk of error in this regard is excluded.  Yes, and colleagues now do not laugh. <br><br><ul><li>  get rid of ugly type checks and dangerous type conversions </li></ul><br>  This question has partially remained open in this article.  As they say, not all at once. <br><br>  Three and a half of the four questions are resolved.  So why did I suggest this method if it does not solve all the questions? <br><br>  Well, firstly, the information on one article and so in abundance. <br><br>  Secondly, this approach solves most issues and simplifies code development and maintenance. <br><br>  And thirdly, this method is very simple, concise and fast.  Those.  The balance of labor is the benefit here, which is definitely on the benefit side.  And we get a considerable benefit. <br><br>  Yes, the topic looks somewhat <s>holistic</s> and ambiguous and can cause controversy.  But since  Since the lists take almost a key role in mobile applications, and the Android SDK does not provide a beautiful way to work with different types of cells out of the box, then I considered it necessary to share one of the good ways to solve this problem. <br><br>  See you in the second part, where we will talk about how to get rid of type checks and type casting. <br><br><h3>  Update </h3><br>  Forced to write a small explanation of the article, because  In the comments I met some misunderstanding.  The article presents an <i>idea</i> , shows the <i>approach</i> to solving the problem.  As simple as possible, as simple as possible (one class, enum, explicit local variables, etc.). <br><br>  The implementation of this idea may be different, based on personal preferences.  But, as practice has shown, people are waiting for a ready-made solution from the article.  Those.  not a problem solving <i>method</i> , but a concrete <i>implementation of</i> this method. <br><br>  Well, take note. <br><br>  In the comments, comrade r_ii turned on the brain and showed his realization of the idea.  Below I will share my (in order to anticipate the next wave of possible questions I will immediately include in the code and the option of processing clicks). <br><br><div class="spoiler">  <b class="spoiler_title">My realization of the idea</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersArbitraryCellAdapter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArbitraryCellAdapter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ProgressArbitraryCell progressArbitraryCell = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProgressArbitraryCell(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AdArbitraryCell adArbitraryCell = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AdArbitraryCell(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UserArbitraryCell userArbitraryCell = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UserArbitraryCell(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UsersArbitraryCellAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ arbitraryCellSelector.addCell(progressArbitraryCell); arbitraryCellSelector.addCell(adArbitraryCell); arbitraryCellSelector.addCell(userArbitraryCell); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Observable&lt;AdVo&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asAdObservable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adArbitraryCell.asAdObservable(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Observable&lt;UserVo&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asUserObservable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> userArbitraryCell.asUserObservable(); } <span class="hljs-comment"><span class="hljs-comment">// Set Users, Ads, Progress... } public abstract class ArbitraryCellAdapter extends RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt; { protected ArbitraryCellSelector arbitraryCellSelector = new ArbitraryCellSelector(); protected List itemList = new ArrayList(); @Override public final int getItemViewType(int position) { return arbitraryCellSelector.getCell(itemList.get(position)).type(); } @Override public final RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) { return arbitraryCellSelector.getCell(viewType).holder(parent); } @Override public final void onBindViewHolder(RecyclerView.ViewHolder holder, int position) { Object item = itemList.get(position); arbitraryCellSelector.getCell(item).bind(holder, item); } @Override public final int getItemCount() { return itemList.size(); } } public abstract class ArbitraryCellHolder&lt;T&gt; extends RecyclerView.ViewHolder { public ArbitraryCellHolder(View itemView) { super(itemView); ButterKnife.bind(this, itemView); } public abstract void bind(T item); } public final class ArbitraryCellSelector { private List&lt;Cell&gt; cellList = new ArrayList&lt;&gt;(); public void addCell(Cell cell) { cellList.add(cell); } public void removeCell(Cell cell) { cellList.remove(cell); } public Cell getCell(Object item) { for (Cell cell : cellList) { if (cell.is(item)) { return cell; } } throw new NoSuchRecyclerRowException(); } public Cell getCell(int viewType) { for (Cell cell : cellList) { if (cell.type() == viewType) { return cell; } } throw new NoSuchRecyclerRowException(); } public interface Cell { boolean is(Object item); int type(); RecyclerView.ViewHolder holder(ViewGroup parent); void bind(RecyclerView.ViewHolder holder, Object item); } } public class AdArbitraryCell implements ArbitraryCellSelector.Cell { private PublishSubject&lt;AdVo&gt; adPublishSubject = PublishSubject.create(); @Override public boolean is(Object item) { return item instanceof AdVo; } @Override public int type() { return R.layout.cell_ad; } @Override public RecyclerView.ViewHolder holder(ViewGroup parent) { LayoutInflater inflater = LayoutInflater.from(parent.getContext()); View view = inflater.inflate(R.layout.cell_ad, parent, false); return new AdViewHolder(view); } @Override public void bind(RecyclerView.ViewHolder holder, Object item) { try { AdViewHolder adViewHolder = (AdViewHolder) holder; AdVo ad = (AdVo) item; adViewHolder.bind(ad); } catch (ClassCastException e) { L.printStackTrace(e); } } public Observable&lt;AdVo&gt; asAdObservable() { return adPublishSubject; } protected class AdViewHolder extends ArbitraryCellHolder&lt;AdVo&gt; { @BindView(R.id.ad_text_view) protected TextView adTextView; public AdViewHolder(View itemView) { super(itemView); } @Override public void bind(AdVo item) { adTextView.setText(item.getTitle()); itemView.setOnClickListener(view -&gt; adPublishSubject.onNext(item)); } } } // Other arbitrary cells...</span></span></code> </pre><br></div></div><br>  Comrade zagayevskiy drew attention to the library of Hannes Dorfmann, which is called AdapterDelegates.  The approach looks solid, the solution is elegant.  Recommend. </div><p>Source: <a href="https://habr.com/ru/post/320242/">https://habr.com/ru/post/320242/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320232/index.html">R Development: Cycle Mysteries</a></li>
<li><a href="../320234/index.html">Learning lessons from 7 games born on gamejams</a></li>
<li><a href="../320236/index.html">‚ÄúA‚Äù means ‚ÄúAstral‚Äù. Interview with Ivan Polyakov (Apus Software)</a></li>
<li><a href="../320238/index.html">How We Implemented DevOps: Publishing an Image to Docker Hub Using Visual Studio Team Services</a></li>
<li><a href="../320240/index.html">Basic planning tools and ways to implement them</a></li>
<li><a href="../320244/index.html">CodingFuture + Puppet. Part VI: Topical Blacklists and Secure Knock</a></li>
<li><a href="../320246/index.html">Designer folder designer. Create backups</a></li>
<li><a href="../320248/index.html">Focusing on security: building a cloud-managed network using Cisco Meraki MX equipment</a></li>
<li><a href="../320250/index.html">The future of mobile is not applications, but browsers</a></li>
<li><a href="../320252/index.html">Interaction between Blue Print (Interface, Cast To)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>