<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ruby 2.0 Lazy Enumerable</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, my Enumerable::Lazy patch has been accepted into ruby ‚Äã‚Äãtrunk. This means that in ruby ‚Äã‚Äã2.0 we can: 


 a = [1,2,3,4,2,5].lazy.map { |x| x ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ruby 2.0 Lazy Enumerable</h1><div class="post__text post__text-html js-mediator-article"> Recently, my <code>Enumerable::Lazy</code> patch has been <a href="http://bugs.ruby-lang.org/projects/ruby-trunk/repository/revisions/34951">accepted</a> into ruby ‚Äã‚Äãtrunk.  This means that in ruby ‚Äã‚Äã2.0 we can: <br><pre> <code class="ruby hljs">a = [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>].lazy.map { <span class="hljs-params"><span class="hljs-params">|x|</span></span> x * <span class="hljs-number"><span class="hljs-number">10</span></span> }.select { <span class="hljs-params"><span class="hljs-params">|x|</span></span> x &gt; <span class="hljs-number"><span class="hljs-number">30</span></span> } <span class="hljs-comment"><span class="hljs-comment">#=&gt;    a.to_a #=&gt; [40, 50],     .</span></span></code> </pre><a name="habracut"></a><br><h4>  What for? </h4><br>  Ruby is beautiful, and, being an imperative language, it nevertheless allows us to write elegant "functional" code.  For example: <br><pre> <code class="ruby hljs">data.map(&amp;<span class="hljs-symbol"><span class="hljs-symbol">:split</span></span>).map(&amp;<span class="hljs-symbol"><span class="hljs-symbol">:reverse</span></span>)</code> </pre><br>  Looks much more readable than: <br><pre> <code class="ruby hljs">data.map { <span class="hljs-params"><span class="hljs-params">|l|</span></span> l.split.reverse }</code> </pre><br>  However, the first example is inefficient: transforming <code>data</code> , Ruby passes through the data twice, generating an intermediate array.  As long as the amount of data is small, this deficiency is not critical.  But suppose we parse a huge file: <br><pre> <code class="ruby hljs">File.open(<span class="hljs-string"><span class="hljs-string">"text"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|f|</span></span> f.each.flat_map(&amp;<span class="hljs-symbol"><span class="hljs-symbol">:split</span></span>).grep(<span class="hljs-regexp"><span class="hljs-regexp">/ruby/</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  In this case, double pass through the array is not allowed.  Fortunately, with the advent of <code>Enumerable::Lazy</code> this is no longer a problem.  Lazy versions of the <code>map</code> , <code>select</code> and many other functions, redefined in the <code>Enumerable::Lazy</code> class, do not perform the calculation immediately.  Instead, they return an instance of <code>Enumerable::Lazy</code> , allowing you to build chains of lazy evaluation. <br><br><h5>  Update </h5><br>  Now, when most of the work on Enumerator :: Lazy is finished, I decided to test what kind of gain it actually gives.  The results were disappointing (for the first time with a benchmark I was mistaken - hence the optimistic comment from below).  On average, the lazy Enumerator is 4 (!) Times slower than operations on ordinary arrays.  This is due to the fact that when calculating a lazy chain, the operation to call a block occurs too often.  <a href="http://bugs.ruby-lang.org/issues/6183">Watch the discussion at ruby-lang.org</a> .  Despite this - the benefits of a lazy enumerator are the same - this is an elegant and readable code, while due to the slowness, the number of user cases is reduced. <br>  A good example was given by Yusuke Endoh: <br><pre> <code class="ruby hljs">a = [] Prime.each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|x|</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x % <span class="hljs-number"><span class="hljs-number">4</span></span> != <span class="hljs-number"><span class="hljs-number">3</span></span> a &lt;&lt; x <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a.size == <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  using laziness turns into: <br><pre> <code class="ruby hljs">Prime.lazy.select {<span class="hljs-params"><span class="hljs-params">|x|</span></span> x % <span class="hljs-number"><span class="hljs-number">4</span></span> == <span class="hljs-number"><span class="hljs-number">3</span></span> }.take(<span class="hljs-number"><span class="hljs-number">10</span></span>).to_a</code> </pre><br><h4>  When? </h4><br>  It‚Äôs hard to say who was the first to figure out how to use lazy calculations in Ruby with <code>Enumerator</code> .  Perhaps <a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/19679">this post in</a> 2008 was one of the first.  The idea of ‚Äã‚Äãimplementation is simple and based on the remarkable property of the Enumerator objects ‚Äî they can be chained together.  Since then, <a href="http://railsillustrated.com/how-to-be-lazy-in-ruby-and-why-you-should.html">many</a> <a href="http://www.michaelharrison.ws/weblog/%3Fp%3D163">articles</a> have been <a href="http://spin.atomicobject.com/2011/03/31/enumerating-ruby-lazy-chains/">published</a> , and comments have been added to enumerator.c with explanations of the idea.  <a href="http://bugs.ruby-lang.org/issues/708">The debate on ruby-lang</a> lasted more than three years, and finally <a href="http://bugs.ruby-lang.org/issues/708">Matz voted</a> to <a href="http://bugs.ruby-lang.org/issues/4890">implement Yataka Hara</a> . <br>  It proposed the method <code>Enumerable::lazy</code> , which "wraps" the array into an instance of <code>Enumerable::Lazy</code> , which, in turn, is used to build a lazy chain.  A <a href="http://bugs.ruby-lang.org/issues/4890">patch request</a> for C was voiced and I immediately accepted the call.  By the way, I recently became interested in functional programming, and to dig into the insides of Ruby was very interesting.  As a result, I was honored to <a href="https%253A%252F%252Fgithub.com%252Fruby%252Fruby%252Fpull%252F101%26amp%3Bsa%3DD%26amp%3Bsntz%3D1%26amp%3Busg%3DAFQjCNF_J2ITFxxFNmh6c_OGokfGzjnmjQ">request pool</a> , which, after a minor refactoring, was <a href="http://bugs.ruby-lang.org/projects/ruby-trunk/repository/revisions/34951">adopted a</a> few days ago.  Vmerdzhili it to the trunk and it will be released in Ruby 2.0 ( <a href="http://bugs.ruby-lang.org/projects/ruby-trunk/versions/6">see roadmap</a> ). <br><br><h4>  How? </h4><br><h5>  Enumerator (skip if you know) </h5><br>  For those who do not know what an ordinary Enumerator is and what it is eaten with: <br><pre> <code class="ruby hljs">enum = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>].each puts enum.<span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-comment"><span class="hljs-comment">#=&gt; 1 puts enum.next #=&gt; 2 puts enum.next #=&gt; StopIteration exception raised enum = Enumerator.new do |yielder| yielder &lt;&lt; 1 yielder &lt;&lt; 2 end puts enum.next #=&gt; 1 puts enum.next #=&gt; 2 puts enum.next #=&gt; StopIteration exception raised enum = "xy".enum_for(:each_byte) enum.each { |b| puts b } # =&gt; 120 # =&gt; 121 o = Object.new def o.each yield yield 'hello' yield [1, 2] end enum = o.to_enum p enum.next #=&gt; nil p enum.next #=&gt; 'hello' p enum.next #=&gt; [1, 2] enum = %w{foo bar baz}.map puts enum.with_index { |w, i| "#{i}:#{w}" } # =&gt; ["0:foo", "1:bar", "2:baz"] #     a = [1, 2, 3] some_method(a.enum_for) [1,2,3].cycle.take(10) #=&gt; [1, 2, 3, 1, 2, 3, 1, 2, 3, 1]</span></span></code> </pre><br>  As you may have guessed, the <code>#to_enum</code> and <code>#enum_for</code> are in the <code>Kernel</code> module, which means they are available to any object.  Examples are taken from <a href="">enumerator.c</a> , if you can look at it interestingly here: <a href="">test / ruby ‚Äã‚Äã/ test_enumerator.rb</a> .  The enumerator's internal guitars probably deserve a separate post, but it is worth noting that all this magic with the <code>next</code> implemented with the help of Fiber. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Lazy enumerator </h5><br>  To understand how Enumerable :: Lazy works, just look at this code: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enumerable</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Lazy</span></span></span><span class="hljs-class"> &lt; Enumerator </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">obj</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">super</span></span></span><span class="hljs-class">() </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yielder</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">obj</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">each</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">block_given?</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yield</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yielder</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">else</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yielder</span></span></span><span class="hljs-class"> &lt;&lt; val </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">map</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Lazy</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yielder</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yielder</span></span></span><span class="hljs-class"> &lt;&lt; yield(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enumerable::Lazy</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">([1,2,3]) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">map</span></span></span><span class="hljs-class"> { |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> * 10 }.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">map</span></span></span><span class="hljs-class"> { |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> - 1 } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">puts</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#=&gt; 9 puts a.next #=&gt; 19</span></span></span></span></code> </pre><br>  This is a typical Ruby implementation proposed by <a href="">Yutaka</a> .  But pay attention - in this example I do not use <code>&amp;block</code> as a parameter of the method (to convert to Proc and call a <code>call</code> ).  Instead, we can <code>yield</code> it right inside the block for <code>each</code> ! <code>block_given?</code>  also works as it should.  Moreover, being inside a block, we can still call <code>self</code> (like <code>return</code> ).  Wow, isn't it?  <a href="http://yehudakatz.com/2010/02/07/the-building-blocks-of-ruby/">A wonderful post on this topic</a> from Yehuda Katz ( <a href="http://yehudakatz.com/2012/01/10/javascript-needs-blocks/">another one</a> ). <br>  The code itself is quite simple, but let's look at it in more detail: As already mentioned, the main idea is in building a chain.  Therefore, <code>Enumerable::Lazy#map</code> creates a new instance of <code>Enumerable::Lazy</code> passing it the "previous" object as an argument.  When you call <code>to_a</code> ( <code>next</code> , <code>each</code> with a block, <code>take</code> , etc.), the calculation is performed: Ruby goes back to the beginning of the chain (Fig. 1), gets the next value from the original object and returns it to the outside, sequentially modifying the lazy methods ( in the same order in which they were "hung"). <br><img src="http://dl.dropbox.com/u/6508492/Enumerators_pic.png"><br>  Fig.1 Chain lazy enumerators. <br><br><h5>  C patch </h5><br>  My <a href="https://github.com/ruby/ruby/pull/101">patch on C</a> completely repeats implementation on Ruby.  Except for the fact that instead of calling <code>super</code> directly inside <code>lazy_initialize</code> I create and initialize a generator ( <code>Enumerator::Generator</code> ), which is passed as an argument to the enumerator. <br>  In the <a href="">final patch,</a> <a href="https://github.com/nobu">nobu</a> slightly refactored the code: he divided the if-else condition inside the function block into two separate methods ( <code>lazy_init_block_i</code> and <code>lazy_init_block</code> ), and transferred the conditions to <code>lazy_initialize</code> . <br>  Also, instead of passing Ruby an array as a parameter to a function block, it constructs a regular C array with parameters.  Accordingly, it is no longer necessary to use <code>rb_ary_entry</code> to get the <code>yielder</code> and the value inside the block. <br>  For example, this: <br><pre> <code class="hljs pgsql">static <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> lazy_map_func(<span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> val, <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> m, <span class="hljs-type"><span class="hljs-type">int</span></span> argc, <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> *argv) { <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> result = rb_funcall(rb_block_proc(), id_call, <span class="hljs-number"><span class="hljs-number">1</span></span>, rb_ary_entry(val, <span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rb_funcall(rb_ary_entry(val, <span class="hljs-number"><span class="hljs-number">0</span></span>), id_yield, <span class="hljs-number"><span class="hljs-number">1</span></span>, result); }</code> </pre><br>  turned into this: <br><pre> <code class="hljs pgsql">static <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> lazy_map_func(<span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> val, <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> m, <span class="hljs-type"><span class="hljs-type">int</span></span> argc, <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> *argv) { <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> result = rb_yield_values2(argc - <span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;argv[<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rb_funcall(argv[<span class="hljs-number"><span class="hljs-number">0</span></span>], id_yield, <span class="hljs-number"><span class="hljs-number">1</span></span>, result); }</code> </pre><br>  Frankly, I was an absolute newcomer to Ruby's guts, so it took two weekends to write this rather trivial pull request.  Moreover, at first I tried to go the other way: trying to save blocks of lazy methods as in the enumerator itself.  <a href="https://github.com/ruby/ruby/pull/100/files">The first crazy pull rekvest watch here</a> .  When <code>Enumerator#next</code> was called, all the processes were "applied" one by one over the next value.  The lazy <code>map</code> and <code>select</code> worked fine, but when I tried to correct <code>Enumerator#each</code> , I realized that somehow it turns out too difficult (or not?). <br>  You have a hard nut to get here, so if you plan to patch something in Ruby, there are a <a href="http://www.ruby-doc.org/docs/ProgrammingRuby/html/ext_ruby.html">lot of</a> <a href="http://tenderlovemaking.com/2009/12/18/writing-ruby-c-extensions-part-1/">great</a> <a href="http://clalance.blogspot.com/2011/01/writing-ruby-extensions-in-c-part-1.html">articles</a> .  As a bonus, <a href="http://railsillustrated.com/how-to-be-lazy-in-ruby-and-why-you-should.html">another article</a> about why we should be lazy. <br><br><h4>  findings </h4><br>  Now <code>Enumerator::Lazy</code> has in its arsenal <code>select</code> , <code>map</code> , <code>reject</code> , <code>grep</code> (added by the first patch), <code>flat_map</code> , <code>zip</code> , <code>take</code> , <code>take_while</code> , <code>drop</code> , <code>drop_while</code> , <code>cycle</code> (recently added <a href="https://github.com/shugo">shugo</a> ).  The development and discussion of the API is actively continuing, but if you want to get lazy right now, all you need to do is compile Ruby from the trunk and enjoy it. <br><br><h5>  Note: </h5><ul><li>  <code>Enumerable::Lazy</code> now become <code>Enumerator::Lazy</code> </li><li>  <code>super()</code> in the ruby ‚Äã‚Äãexample should be called this way - with parentheses, otherwise ruby ‚Äã‚Äãwill automatically pass all arguments to it </li></ul><br>  PS This is a translation of <a href="http://blog.railsware.com/2012/03/13/ruby-2-0-enumerablelazy/">my article</a> from English. </div><p>Source: <a href="https://habr.com/ru/post/140362/">https://habr.com/ru/post/140362/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140354/index.html">Save file change history</a></li>
<li><a href="../140357/index.html">C ++ 11 User Literals</a></li>
<li><a href="../140358/index.html">Online Store Integration with Google Merchant</a></li>
<li><a href="../140360/index.html">The Pirate Bay goes to the sky</a></li>
<li><a href="../140361/index.html">Amazon buys robots company for $ 775 million</a></li>
<li><a href="../140363/index.html">What should a cyclist do in winter?</a></li>
<li><a href="../140364/index.html">What we do online. Alternative version</a></li>
<li><a href="../140367/index.html">The evening of Badoo at RHS ++ will end with the drawing of iPad 3!</a></li>
<li><a href="../140368/index.html">Overview Typesafe Stack 2.0 and an introduction to the model of actors on the example of Akka 2.0</a></li>
<li><a href="../140369/index.html">PHP warning / notice messages in the JS console + secret button</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>