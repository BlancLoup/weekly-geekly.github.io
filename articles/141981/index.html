<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Instrumenting Google Chrome via the WebSocket API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Interaction with browsers has never been a job for the faint of heart: about half a dozen different APIs, different IPC mechanisms, and different capa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Instrumenting Google Chrome via the WebSocket API</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/eab/8c7/6e5/eab8c76e5c3808f9f8c87c98ade279df.jpg" alt="image" align="left">  Interaction with browsers has never been a job for the faint of heart: about half a dozen different APIs, different IPC mechanisms, and different capabilities from different providers.  Projects such as <a href="http://google-opensource.blogspot.com/2009/05/introducing-webdriver.html">WebDriver</a> , trying to abstract from this complexity, besides on the Web you can <a href="https://github.com/search%3Futf8%3D%25E2%259C%2593%26q%3Dheadless%26repo%3D%26langOverride%3D%26start_value%3D1%26type%3DRepositories%26language%3D">find dozens of</a> other "headless" drivers using WebKit or other engines.  Currently, even <a href="http://dvcs.w3.org/hg/webdriver/raw-file/tip/webdriver-spec.html">the W3C specification on WebDriver</a> is in the works. <br><br><h4>  Google Chrome Instrumentation </h4><br>  However, while creating a common solution is a complex task, it turned out that Chrome instrumentation is very simple - as I recently discovered while researching some issues related to network delays.  Starting with version 18, Chrome now supports <a href="https://developers.google.com/chrome-developer-tools/docs/protocol/1.0/index">remote debugging protocol v1.0</a> , which provides all the features of the browser using the usual WebSocket! <br><pre><code class="bash hljs">/Applications/Path To/Google Chrome --remote-debugging-port=9222 <span class="hljs-comment"><span class="hljs-comment"># OSX $&gt; curl localhost:9222/json</span></span></code> </pre> <br><pre> <code class="javascript hljs">[ { <span class="hljs-string"><span class="hljs-string">"devtoolsFrontendUrl"</span></span>: <span class="hljs-string"><span class="hljs-string">"/devtools/devtools.html?host=localhost:9222&amp;page=1"</span></span>, <span class="hljs-string"><span class="hljs-string">"faviconUrl"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"thumbnailUrl"</span></span>: <span class="hljs-string"><span class="hljs-string">"/thumb/chrome://newtab/"</span></span>, <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"New Tab"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"chrome://newtab/"</span></span>, <span class="hljs-string"><span class="hljs-string">"webSocketDebuggerUrl"</span></span>: <span class="hljs-string"><span class="hljs-string">"ws://localhost:9222/devtools/page/1"</span></span> } ]</code> </pre><a name="habracut"></a><br>  First, we enable <a href="http://blog.chromium.org/2011/05/remote-debugging-with-chrome-developer.html">remote debugging in Chrome</a> (disabled by default).  From now on, Chrome provides an HTTP server that allows you to control all open tabs.  Each tab is an isolated process and, therefore, works with its WebSocket, the path to which is accessible through the attribute <code>webSocketDebuggerUrl</code> .  Let's try to do something about it (translator's note: Ruby authoring code, but this is not fundamental): <br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'em-http'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'faye/websocket'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'json'</span></span> EM.run <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-comment"><span class="hljs-comment"># Chrome runs an HTTP handler listing available tabs conn = EM::HttpRequest.new('http://localhost:9222/json').get conn.callback do resp = JSON.parse(conn.response) puts "#{resp.size} available tabs, Chrome response: \n#{resp}" # connect to first tab via the WS debug URL ws = Faye::WebSocket::Client.new(resp.first['webSocketDebuggerUrl']) ws.onopen = lambda do |event| # once connected, enable network tracking ws.send JSON.dump({id: 1, method: 'Network.enable'}) # tell Chrome to navigate to twitter.com and look for "chrome" tweets ws.send JSON.dump({ id: 2, method: 'Page.navigate', params: {url: 'http://twitter.com/#!/search/chrome?q=chrome&amp;' + rand(100).to_s} }) end ws.onmessage = lambda do |event| # print event notifications from Chrome to the console p [:new_message, JSON.parse(event.data)] end end end</span></span></code> </pre><br><br>  In this example, we tell Chrome to enable tracking and notification of network traffic, and then tell it to search Twitter.  At the same time, Chrome will send us dozens of network notifications: initial page selection, notifications for each sub-resource, XHR, and so on (for example, the <code>Network.responseReceived</code> <a href="https://gist.github.com/2331998">event</a> ).  In fact, if you leave the Web page open, you will also see long polling events generated for new tweets.  <a href="https://developers.google.com/chrome-developer-tools/docs/protocol/1.0/network">Tons of information</a> , all at your disposal. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Remote debugging (and more) with Chrome </h4><br>  The above example illustrates a very simple interaction with the Network API, but the protocol provides much more features.  You can work with the JavaScript debugger, control the V8 virtual machine, modify and learn the DOM, and track the chronology of events, and more than half a dozen <a href="https://developers.google.com/chrome-developer-tools/docs/protocol/1.0/index">other features</a> .  Finally, although it‚Äôs cool to manage a desktop browser, browser management on your phone is even cooler: <a href="http://googleblog.blogspot.com/2012/02/introducing-chrome-for-android.html">Chrome for Android</a> provides <a href="https://developers.google.com/chrome/mobile/">all the same features</a> . </div><p>Source: <a href="https://habr.com/ru/post/141981/">https://habr.com/ru/post/141981/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141974/index.html">Ruby NoName Podcast S04E07</a></li>
<li><a href="../141976/index.html">The Source Tag Entry Tool has appeared.</a></li>
<li><a href="../141977/index.html">Applied for domain zone .MOSCOW and.MOSKVA</a></li>
<li><a href="../141978/index.html">Astronauts, do not be offended by us!</a></li>
<li><a href="../141980/index.html">How do you write code comments?</a></li>
<li><a href="../141982/index.html">180,000</a></li>
<li><a href="../141983/index.html">Signals and Slots in Qt5</a></li>
<li><a href="../141984/index.html">Japanese are developing ATM with biometrics</a></li>
<li><a href="../141986/index.html">Do you consider yourself a jack of all trades in the household?</a></li>
<li><a href="../141987/index.html">Work with Command Line in .Net</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>