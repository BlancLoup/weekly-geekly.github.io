<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interrogation of counters technical accounting for GSM channel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Task: schedule a device for technical metering of electricity using a GSM modem. 

 I did not choose iron, they chose it before me, but I got to blind...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interrogation of counters technical accounting for GSM channel</h1><div class="post__text post__text-html js-mediator-article">  Task: schedule a device for technical metering of electricity using a GSM modem. <br><br>  I did not choose iron, they chose it before me, but I got to blind from this system of remote polling.  So, the source of information about the wasted electricity was Socomec Diris A40 (hereinafter - the meter). <br><br><img src="http://savepic.ru/10209758.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The device can measure a lot of things, I stopped at reading hundreds of registers, starting with the decimal address 1792 to 1891. The interface is also not the piece of hardware I have chosen: the communication module is an RS485 gateway using the JBUS / MODBUS¬Æ protocol.  Protocol "Modbus-like" with distinction in register numbering. <br><a name="habracut"></a><br>  GSM modems manufactured by Siemens - MC35i (hereinafter simply modems).  Like these ones: <br><br><img src="http://savepic.ru/10205662.jpg" alt="image"><br><br>  There are a lot of articles about them, it is easy to find documentation.  Managed by AT commands.  No longer available.  Cinterion MC52iT Terminal came to replace him.  It still seems to be buy.  Power supply and antenna included.  For the RS232toRS485 conversion, such a generally cheap piece of hardware was chosen.  She copes with her task. <br><br><img src="http://savepic.ru/10194398.jpg" alt="image"><br><br>  The block diagram of the planned system will look as follows: <br><br><img src="http://savepic.ru/10197470.jpg" alt="image"><br><br>  I called a straight cable a cable where all the pins match each other at the beginning and at the end.  For example, pin 2 is connected to pin 2. I called a cross-over cable, where pin 2 is connected to pin 3, and pin 3 with pin 2. <br><br>  For the survey, it was supposed to use MasterOPC Universal Modbus Server, which lives <a href="http://www.insat.ru/">here</a> and is free if you want to poll no more than 32 tags (some say ‚Äútags‚Äù, I like ‚Äútags‚Äù more).  Its beauty is that it has settings that allow you to use a modem for polling.  Such a two in one.  This is the only program I have found with such features.  For example, in ibaPDA I did not find such opportunities. <br><br>  Nothing happened with MasterOPC Universal Modbus Server.  Rather, it turned out to be half: when connected to the meter by wire, everything is fine, when connected via modem, the received packets for some reason (it's still a mystery to me, who knows, write) look like this: <br><br>  Request: 05/13/2016 14: 12: 56.408 Notebook :: DirisA40 (adr5) :( COM5) Tx: [0008] 05 03 07 0A 00 01 A4 F8 <br>  Answer: 05/13/2016 14: 12: 56.401 Notebook :: DirisA40 (adr5) :( COM5) Rx: [0013] F1 EB FF FD B7 00 05 03 02 13 86 C5 16 <br><br>  As you can see from the answer, the necessary information is present there: 05 03 02 13 86 C5 16. It is also clear that there is also an outsider: F1 EB FF FD B7 00. <br><br>  If you are interested, a parser can be used to decrypt packets.  I, for example, use CAS_Modbus_RTU_Parser.  It's free and that‚Äôs great.  There are also online parsers.  For example: <a href="http://modbus.rapidscada.net/">http://modbus.rapidscada.net/</a> . <br><br>  I did not know how to get rid of this ‚Äúgarbage‚Äù, so I wrote a program on LabView (perhaps it would be more correct to say ‚Äúpainted‚Äù).  It cuts off unnecessary bits from the received packet and then decrypts the Modbus packet.  What is this LabView can be read <a href="https://habrahabr.ru/post/57859/">here</a> .  In general, to my surprise, to my surprise, there were quite a few articles about LabView.  This is the result of this interface: <br><br><img src="http://savepic.ru/10173918.jpg" alt="image"><br><br><img src="http://savepic.ru/10170846.jpg" alt="image"><br><br>  The help text is as follows.  The program is designed to poll counters DirisA40.  You must install the LabVIEW Run-Time Engine (once) before running the executable file.  The program can work in two modes: <br><br>  1) direct survey <br>  2) modem polling <br><br>  The default polling mode: polling 100 registers starting with register 1792. <br>  The format of the data registers is word. <br>  Modbus default address is 5. <br>  Direct polling is started by pressing the START button. <br><br>  A modem poll is scheduled (5 minutes by default) and starts after pressing the ‚ÄúSTART‚Äù and ‚ÄúRecord‚Äù buttons.  The poll schedule should not be less than 1 minute and more than 60 minutes.  In the pressed state, the ‚ÄúSTART‚Äù button is signed as ‚ÄúPolling in progress‚Äù.  In the pressed state, the ‚ÄúWrite‚Äù button is signed as ‚ÄúRecording in progress‚Äù. <br><br>  The checkbox "Consider conversion factors" is intended for scaling the read register value by the formula X * Factor + Offset.  The values ‚Äã‚Äãof Factor and Offset are recorded in the same columns of the table of settings and selection of registers for recording.  The recording takes place in a text file in the same directory where the executable file of the following format is located - date date data.txt (For example: 05/21/2016 22_12 data.txt).  If the recording was made using a modem, the data file name will look like this: 06/08/2016 9_47 data__modem.txt.  When you first try to write a file, you can change the file name.  The recording is made in the same file until the button ‚ÄúRecording in progress‚Äù is pressed.  Registers with checked checkboxes in the settings table are written to the file.  You can change the status of the checkbox in the settings table using a double click.  The resulting register values ‚Äã‚Äãare displayed in the settings table with the column "Value".  On the ‚ÄúCharts‚Äù tab, you can configure the display of any register value from the settings table.  The color of the graphic curve corresponds to the color of the frame around the selected tag.  Tags that need to be turned off from the build must be set to ‚Äúsave‚Äù or any other register with a value of 0. The device's web interface is published _http: // computername: 8000 / DirisA40.html and is available only through explorer if LabVIEW Run-Time is installed Engine. <br><br>  In the process of writing / drawing the following auxiliary programs were used. <br><br>  To emulate the operation of the counter, a free DevEmu program was used.  I learned about it from the <a href="http://plc-blog.com.ua/devemu_emulator_modbus">blog of Alexei</a> , who described her work and application well.  For which he thanks a lot. <br><br>  For emulation of the connection with the meter, trial versions of various programs were used, which are called Serial Port Splitter.  There are quite a few of them, the trial period of two such splitters was enough for me to write the above program. <br><br>  PS: While I was writing this opus, apparently, a colleague, wrote an article on the same topic: <a href="https://geektimes.ru/post/277358/">geektimes.ru/post/277358</a> . </div><p>Source: <a href="https://habr.com/ru/post/395421/">https://habr.com/ru/post/395421/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../395411/index.html">No one clicked on 6 out of 10 links on Twitter (they are retweeted instead)</a></li>
<li><a href="../395413/index.html">Oculus Rift developers without preliminary announcements removed DRM protection</a></li>
<li><a href="../395415/index.html">The 3DO Company and 3DO Interactive Multiplayer (Panasonic and not only)</a></li>
<li><a href="../395417/index.html">How much information can be transmitted through the CPU fan</a></li>
<li><a href="../395419/index.html">Ask Ethan # 61: how far does gravity go?</a></li>
<li><a href="../395423/index.html">Hedgehog - a talking bird [if with an MP3 player]</a></li>
<li><a href="../395425/index.html">NASA Announces X-57 Maxwell Electric Aircraft</a></li>
<li><a href="../395427/index.html">The fall of Ethereum cryptocurrency and the dubious future of decentralized organizations</a></li>
<li><a href="../395429/index.html">Civilization V will be used for training in schools</a></li>
<li><a href="../395431/index.html">June free webinars from MediaTek Labs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>