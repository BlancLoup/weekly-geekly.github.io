<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Practical experience with Bitmap means Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, on duty, I was faced with one task: it was necessary to invent and implement the design of a media player for Android. And if to thin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Practical experience with Bitmap means Android</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/2a781124/3b39a35d/8c45a8e7/cda982fe.png"><br>  Not so long ago, on duty, I was faced with one task: it was necessary to invent and implement the design of a media player for Android.  And if to think over and organize more or less tolerable placement of controls and information turned out to be no tricky business, then I had to think carefully to introduce some zest to the design.  Fortunately, in stock I had such an element as a picture with an album cover of the melody being played.  It was he who had to add color to the whole picture. <br>  However, being simply displayed among the buttons and inscriptions, the cover looked like a paper sticker pasted on the screen.  I realized that without image processing is not enough. <br><a name="habracut"></a><br>  Some thoughts about what could be thought up here were crowned with the decision to make the effect of reflection and shadow on the cover image.  At once I will make a reservation that the practical implementation of reflection is not my original idea.  I spied it in the found English-language <a href="http://www.inter-fuser.com/2009/12/android-reflections-with-bitmaps.html">article</a> .  In this post, I just want to give some insight into the manipulations performed on the image, my additions to the processing process and note some nuances of working with Bitmap in Android. <br>  So at the entrance I had a bitmap with a picture.  To start, I created an empty Bitmap the size of the original image, which later was supposed to become the same cover, but with a shadow applied to it. <br><pre><code class="java hljs">width = sourceBitmap.getWidth(); height = sourceBitmap.getHeight(); Bitmap gradCover; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { gradCover = Bitmap.createBitmap(width, height, config); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (OutOfMemoryError e) { gradCover = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre> <br>  This method creates a mutable (importantly) Bitmap. <br>  Here it is necessary to note that when working with Bitmaps it is necessary to closely monitor the memory.  We'll have to catch exceptions.  And one more thing: studying with the profiler showed that before calling the createBitmap () method, the garbage collector works.  Consider this if speed is critical in your application. <br><br>  Next, I created a canvas and painted on it the original image. <br><pre> <code class="java hljs">Canvas canvas = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Canvas(gradCover); canvas.drawBitmap(sourceBitmap, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">//Free up memory, associated with the original bitmap sourceBitmap.recycle();</span></span></code> </pre> <br>  In this place, I note that always, as soon as the Bitmap is not needed, it must be destroyed using the recycle () method.  The fact is that an object of this type is just a link to the memory with the image itself and looks very small for the garbage collector (although in fact it takes a lot of memory).  This can cause the memory to end at the most inopportune moment. <br><br>  After all the preparation, I painted on the canvas with a shade. <br><pre> <code class="java hljs">Paint paint = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Paint(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] colors = {<span class="hljs-number"><span class="hljs-number">0xffffffff</span></span>, <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span>, <span class="hljs-number"><span class="hljs-number">0xb0c0c0c0</span></span>, <span class="hljs-number"><span class="hljs-number">0xb0c0c0c0</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> radius = (((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) width * (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) width) / <span class="hljs-number"><span class="hljs-number">4</span></span> + (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) height * (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) height) / ((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) width); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fullRadius = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (<span class="hljs-number"><span class="hljs-number">1.92</span></span> * radius); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] positions = {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0.499f</span></span>, <span class="hljs-number"><span class="hljs-number">0.511f</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}; RadialGradient shader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RadialGradient((width - radius), <span class="hljs-number"><span class="hljs-number">0</span></span>, fullRadius, colors, positions, Shader.TileMode.CLAMP); paint.setShader(shader); paint.setXfermode(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PorterDuffXfermode(PorterDuff.Mode.DST_IN)); canvas.drawRect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, width, height, paint); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] linColors = {<span class="hljs-number"><span class="hljs-number">0x00ffffff</span></span>, <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span>, <span class="hljs-number"><span class="hljs-number">0xff000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x00000000</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] linPositions = {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0.03f</span></span>, <span class="hljs-number"><span class="hljs-number">0.97f</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}; LinearGradient vertical = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinearGradient(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, height, linColors, linPositions, Shader.TileMode.CLAMP); paint.setShader(vertical); paint.setXfermode(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PorterDuffXfermode(PorterDuff.Mode.DST_IN)); canvas.drawRect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, width, height, paint); LinearGradient horizontal = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinearGradient(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, width, <span class="hljs-number"><span class="hljs-number">0</span></span>, linColors, linPositions, Shader.TileMode.CLAMP); paint.setShader(horizontal); paint.setXfermode(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PorterDuffXfermode(PorterDuff.Mode.DST_IN)); canvas.drawRect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, width, height, paint);</code> </pre> <br>  RadialGradient in my case represents a shadow falling in a semicircle from the upper right corner of the image to the center of the bottom face.  He needs to set the center (may go beyond the image), the radius, the sequence of colors and the distance from the center along the radius for each color.  For the shadow, a change in alpha in colors on the radius was used. <br>  LinearGradient was used to fade the edges of the picture.  Its application is very similar to RadialGradient.  It is necessary to set the beginning and end of the line along which the gradient will go, the colors and their positions on this line. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Finally, I started drawing the reflection.  By this time, I already had a Bitmap with gradBitmap shadows.  Again, it was necessary to create a canvas, create an empty image (this time a third longer than the original one), place it on the canvas and apply a Bitmap with shadows on top of it. <br><pre> <code class="java hljs">Bitmap refCover = Bitmap.createBitmap(width, height + height / <span class="hljs-number"><span class="hljs-number">3</span></span>, Bitmap.Config.ARGB_8888); Canvas refCanvas = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Canvas(refCover); refCanvas.drawBitmap(gradCover, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>);</code> </pre> <br><br>  After some preparations, the most interesting began.  I created a matrix that flips the image upwards.  With its help I created Bitmap from a third of the original one and put it on the canvas under the original image. <br><pre> <code class="java hljs">Matrix matrix = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matrix(); matrix.preScale(<span class="hljs-number"><span class="hljs-number">1</span></span>, -<span class="hljs-number"><span class="hljs-number">1</span></span>); Bitmap reflectionImage = Bitmap.createBitmap(gradCover, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span> * height / <span class="hljs-number"><span class="hljs-number">3</span></span>, width, height / <span class="hljs-number"><span class="hljs-number">3</span></span>, matrix, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); refCanvas.drawBitmap(reflectionImage, <span class="hljs-number"><span class="hljs-number">0</span></span>, height, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); reflectionImage.recycle();</code> </pre> <br>  By the way, a brief note: there are several createBitmap methods in the Bitmap class, and only one of them creates mutable Bitmaps on which to draw.  The rest for drawing ON them are not suitable. <br><br>  Finally, a transparent gradient is applied to give a reflection effect. <br><pre> <code class="java hljs">Paint refPaint = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Paint(); LinearGradient refShader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinearGradient(<span class="hljs-number"><span class="hljs-number">0</span></span>, height, <span class="hljs-number"><span class="hljs-number">0</span></span>, height + height / <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0xc0ffffff</span></span>, <span class="hljs-number"><span class="hljs-number">0x00ffffff</span></span>, Shader.TileMode.CLAMP); refPaint.setShader(refShader); refPaint.setXfermode(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PorterDuffXfermode(PorterDuff.Mode.DST_IN)); refCanvas.drawRect(<span class="hljs-number"><span class="hljs-number">0</span></span>, height, width, refCover.getHeight() + height, refPaint);</code> </pre> <br>  The paint is applied to the part of the pattern that is a reflection. <br><br>  Everything.  I received a refCover - Bitmap, which shows the album cover with shadow, smooth edges and reflection. <br><br>  PS In this article, it was not the fact of the achievement of visual effects that was important to me, but the means of obtaining them and the nuances associated with them.  If for someone the things described here are obvious - fine.  All the rest, I hope the article will help in writing their applications for Android. <br><br>  UPD: pictures before and after <br><img src="https://habrastorage.org/storage/8e8f4039/5b35dc08/a6f2da25/c56c13b0.png"><img src="https://habrastorage.org/storage/e15735b9/2fd83f59/91fae5f6/0cb25180.png"></div><p>Source: <a href="https://habr.com/ru/post/107757/">https://habr.com/ru/post/107757/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../107750/index.html">Automatypewriter: what happens if you add an artificial intelligence to a typewriter</a></li>
<li><a href="../107752/index.html">"Evacuation Plan": just caught a glitch Yandex traffic jams</a></li>
<li><a href="../107754/index.html">Updates or become an Odessa citizen for free</a></li>
<li><a href="../107755/index.html">Per month I pay for Internet access</a></li>
<li><a href="../107756/index.html">Apple lovers love flash</a></li>
<li><a href="../107761/index.html">Citrix HDX technology: 2 megabits per second for 3D remote work</a></li>
<li><a href="../107764/index.html">How to create a website for mobile devices</a></li>
<li><a href="../107765/index.html">The affiliate network ‚ÄúWhere is the Elephant?‚Äù Unites online stores and themed sites</a></li>
<li><a href="../107766/index.html">Mathematical language for operations with infinity</a></li>
<li><a href="../107767/index.html">Opera Mobile 10.1 Beta for Android released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>