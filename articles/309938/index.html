<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We get rid of binary dependencies with composite assembly in Gradle 3.1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the very beginning of Gradle, there were 2 ways to split your assembly into components: through binary dependencies and using multi-project assem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We get rid of binary dependencies with composite assembly in Gradle 3.1</h1><div class="post__text post__text-html js-mediator-article"><p>  From the very beginning of Gradle, there were 2 ways to split your assembly into components: through binary dependencies and using multi-project assembly.  Each of these methods has its pros and cons.  In the case of binary dependencies, it becomes necessary to publish artifacts, which complicates assembly.  In the case of multi-project assembly, it becomes <br>  more difficult to isolate components from each other. </p><br><h3 id="kompozitnye-sborki">  Composite assemblies </h3><br><p>  In the upcoming version 3.1 in Gradle, a new approach to organizing assemblies consisting of several components appears: <em>composite assemblies</em> ( <em>original</em> Composite Builds). </p><br><p>  Composite assemblies allow you to: </p><br><ul><li>  Quickly put the corrected version of the source code of the library into another project without having to build it, publish and edit the build. </li><li>  To divide large projects into several small, isolated assemblies, on each of which you can work both individually and simultaneously. </li><li> Separate plugin development for the build system from the project that uses it (similar to <code>buildSrc</code> ) </li></ul><br><a name="habracut"></a><br><p>  Let us analyze a simple example of using a new feature. </p><br><p>  To do this, create a simple project: </p><br><pre> <code class="bash hljs">--app/ |-src/main/java/Main.java |-build.gradle - lib/ |-src/main/java/A.java |-build.gradle |-settings.gradle</code> </pre> <br><h4 id="libbuildgradle">  lib / build.gradle: </h4><br><pre> <code class="hljs pgsql">apply plugin: <span class="hljs-string"><span class="hljs-string">'java'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> "ru.shadam" <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> "1.0" task <span class="hljs-keyword"><span class="hljs-keyword">wrapper</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Wrapper</span></span>) { gradleVersion = <span class="hljs-string"><span class="hljs-string">'3.1-rc-1'</span></span> }</code> </pre> <br><h4 id="appbuildgradle">  app / build.gradle </h4><br><pre> <code class="hljs pgsql">apply plugin: <span class="hljs-string"><span class="hljs-string">'java'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'application'</span></span> mainClassName=<span class="hljs-string"><span class="hljs-string">'Main'</span></span> dependencies { compile <span class="hljs-string"><span class="hljs-string">'ru.shadam:lib1:1.0'</span></span> } task <span class="hljs-keyword"><span class="hljs-keyword">wrapper</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Wrapper</span></span>) { gradleVersion = <span class="hljs-string"><span class="hljs-string">'3.1-rc-1'</span></span> }</code> </pre> <br><p>  Now, if we try to start the <code>app</code> using the command <code>./gradlew run</code> Gradle will swear at an unresolved dependency: </p><br><pre> <code class="hljs pgsql">$ ./gradlew run :compileJava FAILURE: Build failed <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> an <span class="hljs-keyword"><span class="hljs-keyword">exception</span></span>. * What went wrong: Could <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> resolve <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> dependencies <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> <span class="hljs-string"><span class="hljs-string">':compileClasspath'</span></span>. &gt; Cannot resolve <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> dependency ru.shadam:lib1:<span class="hljs-number"><span class="hljs-number">1.0</span></span> because <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> repositories are defined. Required <span class="hljs-keyword"><span class="hljs-keyword">by</span></span>: project : * Try: Run <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-comment"><span class="hljs-comment">--stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. BUILD FAILED Total time: 1.027 secs</span></span></code> </pre> <br><p>  But, if we add a new flag - include-build, then Gradle will automatically resolve dependencies: </p><br><pre> <code class="hljs vbscript">$ ./gradlew run --include-build ../lib1 [composite-build] Configuring build: C:\Users\sala\projects\gradle-compose\lib1 :compileJava :lib1:compileJava UP-<span class="hljs-keyword"><span class="hljs-keyword">TO</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> :lib1:processResources UP-<span class="hljs-keyword"><span class="hljs-keyword">TO</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> :lib1:classes UP-<span class="hljs-keyword"><span class="hljs-keyword">TO</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> :lib1:jar UP-<span class="hljs-keyword"><span class="hljs-keyword">TO</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> :compileJava UP-<span class="hljs-keyword"><span class="hljs-keyword">TO</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> :processResources UP-<span class="hljs-keyword"><span class="hljs-keyword">TO</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> :classes UP-<span class="hljs-keyword"><span class="hljs-keyword">TO</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> :run Hello BUILD SUCCESSFUL Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">1.092</span></span> secs</code> </pre> <br><h3 id="prodvinutye-varianty-ispolzovaniya">  Advanced use cases. </h3><br><p>  <strong>We build --include-build into a script</strong> </p><br><p>  The above option is more suitable for one-time use - here and now.  Each time you do not want to specify the flags - even if you sew them in a wrapper. </p><br><p>  For this, gradle suggests using a configuration using settings.gradle.  So, the above flag can be replaced with the following settings.gradle: </p><br><pre> <code class="hljs cs">includeBuild(<span class="hljs-string"><span class="hljs-string">'../lib1'</span></span>)</code> </pre> <br><p>  <strong>Substitutions</strong> </p><br><p>  What if in the project that you want to include are not listed coordinates of the artifact?  (group, version) </p><br><p>  The substitutions come to the rescue: </p><br><pre> <code class="hljs pgsql">includeBuild(<span class="hljs-string"><span class="hljs-string">'../lib1'</span></span>) { dependencySubstitution { substitute(<span class="hljs-string"><span class="hljs-string">'ru.shadam:lib1'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> project(<span class="hljs-string"><span class="hljs-string">':'</span></span>) } }</code> </pre> <br><p>  This feature allows you to substitute any dependency on <code>ru.shadam:lib1</code> dependency on the <code>lib1</code> project. </p><br><p>  <strong>Dependencies between tasks</strong> </p><br><p>  In the case of a composite assembly, projects are isolated from each other, so you cannot declare dependencies between assemblies directly. </p><br><p>  In this regard, a new syntax for accessing the included assemblies has appeared.  For example, you can define a dependency on the task of the included build: </p><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">task</span></span> run { <span class="hljs-attribute"><span class="hljs-attribute">dependsOn</span></span> gradle.includedBuild(<span class="hljs-string"><span class="hljs-string">'lib1'</span></span>).task(<span class="hljs-string"><span class="hljs-string">':jar'</span></span>) }</code> </pre> <br><h3 id="chto-poka-ne-rabotaet">  What is not working yet? </h3><br><ul><li>  Projects that have published artifacts that do not conform to the default configuration are not supported as included projects.  <a href="https://docs.gradle.org/3.1-rc-1/userguide/composite_builds.html">link</a> </li><li>  Currently there is no support in IDE (but project generation is supported using the <code>./gradlew idea</code> command) </li><li>  Native builds are not supported. </li></ul><br><h3 id="plany-komandy">  Team plans </h3><br><ul><li>  Add the ability to call tasks directly from included builds. </li><li>  Add the ability to simultaneously run the included assembly </li><li>  Add detection of changes to included builds when the <code>-t</code> flag is used. </li><li>  Make an implicit buildSrc project included in the build. </li></ul><br><h3 id="ispolzovannye-materialy">  Used materials </h3><br><ul><li>  <a href="https://docs.gradle.org/3.1-rc-1/userguide/composite_builds.html">Documentation</a> </li><li>  <a href="https://github.com/saladinkzn/gradle-compose">Repository with examples</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/309938/">https://habr.com/ru/post/309938/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309922/index.html">Writing Hello World on FASM</a></li>
<li><a href="../309928/index.html">Customize Windows Store for Business</a></li>
<li><a href="../309930/index.html">Arguments for function tree</a></li>
<li><a href="../309934/index.html">How to get a lot of server for little money: options for the earth and the cloud</a></li>
<li><a href="../309936/index.html">Overview of Node.js packages for parsing command line options</a></li>
<li><a href="../309940/index.html">Azure Active Directory now in the new ARM portal</a></li>
<li><a href="../309942/index.html">Presenter Template in Laravel</a></li>
<li><a href="../309944/index.html">Useful properties of jitter</a></li>
<li><a href="../309948/index.html">IOS 10 security settings you should pay attention to</a></li>
<li><a href="../309954/index.html">Samsung Solid State Drives: Gaining Momentum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>