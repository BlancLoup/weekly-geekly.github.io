<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Details of the implementation of RSTP and proprietary Extended Ring Redundancy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the net you can find a lot of materials about the RSTP protocol. In this article, I propose to compare the RSTP protocol with the proprietary proto...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Details of the implementation of RSTP and proprietary Extended Ring Redundancy</h1><div class="post__text post__text-html js-mediator-article">  On the net you can find a lot of materials about the RSTP protocol.  In this article, I propose to compare the RSTP protocol with the proprietary protocol from <a href="http://www.phoenixcontactpro.ru/">Phoenix Contact</a> - Extended Ring Redundancy. <a name="habracut"></a><br><br>  <b>RSTP implementation details</b> <br><br>  <b>General information</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>Convergence time</i> - 1-10 s <br>  <i>Possible topologies</i> - any <br><br>  It is widely believed that RSTP allows you to combine switches only in a ring: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/06a/c26/c94/06ac26c94f7fb9be45a183ef2aac876f.png" alt="image"></div><br>  But RSTP allows you to connect switches in an arbitrary way.  For example, RSTP can handle this topology. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/87e/e81/9b8/87ee819b8b89c24e214a8573e6eb77a8.png" alt="image"></div><br><br>  <b>Operating principle</b> <br><br>  RSTP reduces any topology to a tree.  One of the switches becomes the center of the topology - the root switch.  The root switch passes the largest amount of data through itself. <br><br>  The principle of operation of RSTP is as follows: <br><br><ol><li>  power is supplied to the switches; </li><li>  root switch is selected; </li><li>  other switches determine the fastest path to the root switch; </li><li>  the remaining channels are blocked and become backup. </li></ol><br>  <i>Choosing a root switch</i> <br><br>  Switches with RSTP exchange BPDU packets.  BPDU is a service packet that contains RSTP information.  BPDUs are of two types: <br><br><ul><li>  Configuration BPDU. </li><li>  Topology Change Notification. </li></ul><br>  Configuration BPDU is used to build the topology.  It is sent only by the root switch.  Configuration BPDU contains: <br><br><ul><li>  Sender ID (Bridge ID); </li><li>  Root Bridge ID; </li><li>  ID of the port from which this packet is sent (Port ID); </li><li>  the cost of the route to the root switch (Root Path Cost). </li></ul><br>  Topology Change Notification can send any switch.  They are sent in case of a change in topology. <br><br>  After switching on, all switches consider themselves root.  They begin to send BPDU packets.  As soon as the switch receives a BPDU with a smaller Bridge ID than its own, it will no longer consider itself root. <br><br>  Bridge ID consists of two values ‚Äã‚Äã- the MAC address and Bridge Priority.  We cannot change the MAC address.  Bridge Priority defaults to 32768. If you do not change Bridge Priority, the switch with the lowest MAC address becomes the root switch.  The switch with the lowest MAC address is the oldest and possibly not the most efficient.  It is recommended that you manually identify the root switch topology.  To do this, you need to configure a small Bridge Priority on the root switch (for example, 0).  You can also define a backup root switch by giving it a slightly larger Bridge Priority (for example, 4096). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/242/b85/2d0/242b852d0b147b875c6bdfe5e1600486.png" alt="image"><br>  <i>Choosing the path to the root switch</i> <br><br>  The root switch sends BPDU packets to all active ports.  BPDU has a Path Cost field.  Path Cost denotes the cost of the path.  The higher the cost of the path, the longer the packet is transmitted through it.  When BPDU passes through a port, a cost is added to the Path Cost field.  The added number is called Port Cost. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/717/cf0/a68/717cf0a68e19c5fbe87a10c1ed2f65fc.png" alt="image"><br><br>  Adds a specific value to Path Cost when a BPDU passes through a port.  That value that adds is called Port Cost (Port Cost) and can be determined both manually and automatically.  Port Cost can be determined either manually or automatically. <br><br>  When a non-root switch has several alternative paths to the root, it chooses the fastest one.  He compares the path cost of these paths.  The port from which the BPDU came with the lowest Path Cost becomes the root (Root Port). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cac/60b/7d3/cac60b7d311b5e0ca0ed94b36ee68acb.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/acd/9e2/4ec/acd9e24ec51ed08b515bd4c92e44aa66.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/829/cd7/23e/829cd723eb421c92047fe52e32126f4a.png" alt="image"><br><br>  The cost of ports that are assigned automatically can be viewed in the table: <br><div class="scrollable-table"><table><tbody><tr><th>  Port data rate </th><th>  Port cost </th></tr><tr><th>  10 Mb / s </th><th>  2 000 000 </th></tr><tr><th>  100 Mb / s </th><th>  200,000 </th></tr><tr><th>  1 Gb / s </th><th>  20,000 </th></tr><tr><th>  10 Gb / s </th><th>  2,000 </th></tr></tbody></table></div><br>  <i>Roles and statuses of ports</i> <br><br>  Switch ports have several statuses and port roles. <br><br>  <i>Port statuses (for STP):</i> <br><br><ul><li>  Disabled - inactive. </li><li>  Blocking - listens to BPDU, but does not transmit.  Data does not transfer. </li><li>  Listening - listens and transmits BPDUs.  Data does not transfer. </li><li>  Learning - listens and transmits BPDUs.  Prepares for data transfer - fills the table of MAC-addresses. </li><li>  Forwarding - transmits data, listens and transmits BPDUs. </li></ul><br>  STP convergence time - 30-50 seconds.  After switching on the switch, all ports go through all statuses.  Each status port is a few seconds.  Because of this principle, STP has such a long convergence time.  RSTP has fewer port statuses. <br><br>  Port statuses (for RSTP): <br><br><ul><li>  Discarding - inactive. </li><li>  Discarding - listens to BPDU, but does not transmit.  Data does not transfer. </li><li>  Discarding - listens and transmits BPDU.  Data does not transfer. </li><li>  Learning - listens and transmits BPDUs.  Prepares for data transfer - fills the table of MAC-addresses. </li><li>  Forwarding - transmits data, listens and transmits BPDUs. </li><li>  In RSTP, the statuses Disabled, Blocking and Listening are combined into one - Discarding. </li></ul><br>  Port Roles: <br><br><ul><li>  Root port - the port through which data is transmitted.  It serves as the fastest path to the root switch. </li><li>  Designated port - the port through which data is transmitted.  Defined for each LAN segment. </li><li>  Alternate port - the port through which data is not transmitted.  It is an alternative path to the root switch. </li><li>  Backup port - the port through which data is not transmitted.  It is a backup path for a segment where one port with RSTP support is already connected.  Backup port is used if two switch channels are connected to the same segment (read the hub). </li><li>  Disabled port - RSTP is disabled on this port. </li></ul><br>  The selection of Root Port is described above.  How is Designated port selected? <br><br>  First, let's define what a LAN segment is.  The LAN segment is a collision domain.  For a switch or router, each port forms a separate collision domain.  A LAN segment is a channel between switches or routers.  If we talk about the hub, then at the hub all the ports are in the same collision domain. <br><br>  Only one Designated Port is assigned to one segment. <br><br>  In the case of segments where there are already Root Portes, everything is clear.  The second port of the segment becomes the Designated Port. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/90d/a93/c94/90da93c9429b808d2d0bb02f4036324a.png" alt="image"><br><br>  But there are backup channels where there will be one Designated Port and one Alternate Port.  How will they get out?  Designated Port will become the port with the lowest Path Cost to the root switch.  If Path Cost is equal, then Designated Port will be the port that is located on the switch with the lowest Bridge ID.  If the Bridge ID is equal, then the Designated Port becomes the port with the lowest number.  The second port will be alternate. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bdc/d30/b52/bdcd30b52cbab4d54d7fc1bbb8485ee5.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/da0/d20/707/da0d207078b57efdeef4c1a257562f7c.png" alt="image"><br><br>  The last moment remains: when is the port assigned to the Backup role?  As already stated above, the Backup port is used only when two channels of the switch are connected to the same segment, that is, to the hub.  In this case, the Designated Port is selected exactly according to the same criteria: <br><br><ul><li>  Smallest Path Cost to Root Switch. </li><li>  Smallest Bridge ID. </li><li>  Smallest Port ID. </li></ul><br>  <b>Maximum number of devices on the network</b> <br><br>  The IEEE 802.1D standard does not impose strict requirements on the number of devices on a LAN with RSTP.  But the standard recommends using no more than 7 switches in one branch (no more than 7 hops), i.e.  no more than 15 in the ring.  When this value is exceeded, the time of network convergence begins to increase. <br><br>  <b>ERR implementation details.</b> <br><br>  <b>General information</b> <br><br>  <i>Convergence time</i> <br><br>  ERR convergence time is 15 ms.  With the maximum number of switches in the ring and the presence of pairing rings - 18 ms. <br><br>  <i>Possible topologies</i> <br><br>  ERR does not allow to freely merge devices as RSTP.  ERR has clear topologies that can be used: <br><br><ul><li>  Ring </li><li>  Duplicate ring </li><li>  Pair up to three rings </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/125/858/d74/125858d743b4e6e848052923b2f90277.png" alt="image"><br>  <i>Ring</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b79/ede/2db/b79ede2dbfe55886ca1129a50b58c730.png" alt="image"><br><br>  When all switches are combined into one ring in ERR, then on each switch you need to configure the ports that will be involved in building the ring. <br><br>  <i>Double ring</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/648/3e7/76e/6483e776ed1d649f973d2022cf0abd81.png" alt="image"><br><br>  Switches can be combined into a double ring, which greatly increases the reliability of the ring. <br><br>  Double Ring Restrictions: <br><br><ul><li>  Double ring cannot be used to pair switches with other rings.  For this you need to use Ring Coupling. </li><li>  Double ring cannot be used for mating ring. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/48c/db9/ff7/48cdb9ff7bc45b8268034f23fb2bce44.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/7e5/393/800/7e539380086a8486d27c638d4c03688a.png" alt="image"><br>  <i>Pairing rings</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7e9/990/047/7e9990047607cb429cd69431ddc37dd7.png" alt="image"><br><br>  When pairing in the network can be no more than 200 devices. <br><br>  Pairing rings means combining the remaining rings into another ring. <br><br>  If a ring connects to a pairing ring through a single switch, this is called <b>pairing rings through a single switch</b> .  If two switches from a local ring are connected to a pairing ring, this will be a <b>pairing through two switches</b> . <br><br>  When pairing through one switch on the device, both ports are enabled.  The convergence time in this case will be approximately 15-17 ms.  With such a pairing, the pairing switch will be a point of failure, since  having lost this switch, the whole ring is lost at once.  Pairing through two switches avoids this. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1b4/29d/8ba/1b429d8bab7fd9cf93a92021b7a227c5.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/1b4/29d/8ba/1b429d8bab7fd9cf93a92021b7a227c5.png" alt="image"><br><br>  It is possible to match duplicated rings. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/45f/703/1b6/45f7031b6b8822df0813ae82686d87a9.png" alt="image"><br><br>  <i>Path control</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/45f/703/1b6/45f7031b6b8822df0813ae82686d87a9.png" alt="image"><br><br>  The Path Control function allows you to configure the ports through which data will be transmitted in the normal mode of operation.  If the channel fails and the network is rebuilt to the backup topology, then after the restoration of the channel, the network will be rebuilt back to the specified topology. <br><br>  This feature saves redundant cable.  Moreover, the topology used for troubleshooting will always be known. <br><br>  The basic topology switches to the backup in 15 ms.  Re-switching when restoring the network will take about 30 ms. <br><br>  Limitations: <br><br><ul><li>  Cannot be used with dual ring. </li><li>  The feature must be enabled on all switches in the network. </li><li>  One of the switches is configured as a Path Control wizard. </li><li>  Automatic transition to the main topology after recovery is carried out after 1 second by default (this parameter can be changed using SNMP in the range from 0 s to 99 s). </li></ul><br>  <b>Operating principle</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1b5/7ef/537/1b57ef5379bc2b0550cd05a48825dd27.png" alt="image"><br><br>  ERR principle of operation <br><br>  For example, consider the six switches - 1-6.  Switches are united in a ring.  Each switch uses two ports to connect to the ring and stores their status.  Switches send port status to each other.  These device data are used to set the initial state of the ports. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ec8/8f1/5cb/ec88f15cb32e92bb205c9a756c0f9e68.png" alt="image"></div><br>  Ports have only two roles - <b>Blocked</b> and <b>Forwarding</b> . <br><br>  The switch with the highest MAC address blocks the port.  All other ports in the ring transmit data. <br><br>  If the Blocked port stops working, then the next port with the highest MAC address becomes Blocked. <br><br>  After booting, switches begin to send Ring Protocol Data Unit (R-PDU).  R-PDU is transmitted using multicast.  The R-PDU is a service message, as is the BPDU in RSTP.  The R-PDU contains the switch port statuses and its MAC address. <br><br>  <i>Algorithm of actions in case of channel failure</i> <br>  When the link fails, the switches send an R-PDU to notify you of the port status change. <br><br>  <i>Algorithm of actions during the restoration of the channel</i> <br>  When the failed link is brought into service, the switches send an R-PDU to notify you of the port status change. <br><br>  The switch with the highest MAC address becomes the new root switch. <br><br>  The failed channel becomes backup. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ead/5bd/fee/ead5bdfee75a47f0dfc783e0eea292d8.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/db9/b5e/45d/db9b5e45dd952fc69742e7abb2a6ba7e.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/160/511/ad2/160511ad24c1cc4c3a7e5f7ab598e84e.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/221/270/d89/221270d89679a9ea06e216011c51d7ef.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/331/df7/9d4/331df79d409410fd2463f906a14e4fd6.png" alt="image"><br><br>  After recovery, one of the channel ports remains blocked, and the second is transferred to the forwarding state.  A blocked port becomes the port with the highest speed.  If the speeds are equal, then the switch port with the highest MAC address will be blocked.  This principle allows you to block a port that goes from the blocked state to the forwarding state at maximum speed. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/66c/f32/c0a/66cf32c0a1a5ee61316376da012d3065.png" alt="image"><br><br>  <b>Maximum number of devices on the network</b> <br><br>  The maximum number of switches in the ERR ring is 200. <br><br>  <b>ERR and RSTP interaction</b> <br><br>  RSTP can be used in conjunction with ERR.  But the RSTP ring and the ERR ring should intersect only through one switch. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d77/a18/be4/d77a18be4ffe465f745172364cdd472c.png" alt="image"><br><br>  <b>Summary</b> <br><br>  ERR is great for organizing sample topologies.  For example, a ring or double ring. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c8/f07/0ec/0c8f070ecc027f321a0ff9498f4e15b3.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ab7/8b9/360/ab78b936098e7df21e5a00de109e3db9.png" alt="image"><br><br>  Similar topologies are often used for redundancy at industrial sites. <br><br>  Moreover, with the help of ERR, the second topology can be implemented less reliably, but more budget.  This can be done using a duplicate ring. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/05a/e45/824/05ae4582401223aa996f263ca3dfdbaf.png" alt="image"><br><br>  But it is not always possible to apply ERR.  There are quite exotic schemes.  With one of our customers, we tested the following topology. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e61/2b3/efc/e612b3efcf6654463cf7bb6bb6d3ce10.png" alt="image"><br><br>  In this case, ERR is not possible to apply.  For this scheme we used RSTP.  The customer had a strict time requirement for convergence - less than 3 s.  To achieve this time it was necessary to clearly define the root switches (main and backup), as well as the cost of ports in manual mode. <br><br>  As a result, ERR significantly gains in convergence time, but does not provide the flexibility that RSTP provides. </div><p>Source: <a href="https://habr.com/ru/post/460633/">https://habr.com/ru/post/460633/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460621/index.html">Tic Tac Toe, Part 4: Interacting with the Flask backend using HTTP</a></li>
<li><a href="../460623/index.html">About torture of Julian Assange</a></li>
<li><a href="../460629/index.html">The probability that 2 miners have the same world</a></li>
<li><a href="../46063/index.html">‚ÄúAttention Profile‚Äù and ‚ÄúFavorite Authors‚Äù</a></li>
<li><a href="../460631/index.html">Around the badge for 80 days: on the other side OFFZONE</a></li>
<li><a href="../460635/index.html">CLRium # 6: Concurrency</a></li>
<li><a href="../460637/index.html">Light control on ZigBee</a></li>
<li><a href="../46064/index.html">The British encroached on the "Classmates"</a></li>
<li><a href="../460641/index.html">YouTokenToMe: tool for quick tokenization of text from the VKontakte Team</a></li>
<li><a href="../460645/index.html">Doing well, doing badly: writing ‚Äúevil‚Äù code with Go, part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>