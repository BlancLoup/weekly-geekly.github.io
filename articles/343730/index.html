<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write DSL in Koltin</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Small introduction 
 Hello! I often hang out on Medium and find a lot of useful articles from foreign developers. On one of these days, I was looking ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write DSL in Koltin</h1><div class="post__text post__text-html js-mediator-article"><h3>  Small introduction </h3><br>  Hello!  I often hang out on Medium and find a lot of useful articles from foreign developers.  On one of these days, I was looking for something on DSL at Kotlin for myself and came across a series of articles on what DSL is at Kotlin and how to work with it.  Before reading, I had a superficial notion of DSL, since I occasionally came across them.  While reading the article, I liked the simplicity of the description and the submission of examples from the author so that at the end of the reading I decided to translate this pair of articles for you.  Of course, with the approval of the author :) Well, let's start. <a name="habracut"></a><br><br><h3>  Briefly about DSLs.  What is it? </h3><br>  For starters, you can spy the definition from Wikipedia <br><blockquote>  <b>Domain-specific language (DSL)</b> is a computer language specialized for a specific application.  It differs from general purpose languages ‚Äã‚Äã(GPL), which are widely used in many areas. </blockquote>  In principle, DSL is a language that focuses on one particular part of an application; on the other hand, general purpose languages ‚Äã‚Äãsuch as Kotlin and Java can be used in other parts of the application.  There are several DSL with which you probably already know, for example, SQL.  If you look at SQL, you can see that it looks almost like a regular sentence in English, so that it becomes quite <b>readable</b> , <b>understandable</b> and <b>expressive</b> : <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Person.name, Person.age <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> Person.age <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> <br>  There are no special criteria that would distinguish a DSL from a normal API, but we often notice one difference: The use of a specific structure or grammar.  This makes the code more understandable for a person who is easy to understand, not only for developers, but also for people who are less savvy in terms of programming languages. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  DSLs with Kotlin </h3><br>  Now, let's figure out how we can create DSL with some Kotlin language features and what advantages does this bring to us? <br><br>  When we create DSL in some universal programming language, such as Kotlin, we actually mean <b>internal DSL</b> .  After all, we do not create an independent syntax, but simply set up a specific way to use this language.  And it is this that gives us the advantage of using code that we already know, and allows us to add different operators, such as <i>for loops,</i> to our DSL. <br><br>  In addition, Kotlin offers several ways to create a cleaner syntax and helps to avoid using too many unnecessary characters.  And in this first part we will look at three features: <br><br><ul><li>  Using lambdas outside method brackets </li><li>  Lambda with arguments (receivers) </li><li>  Extension functions (from the translator: these are the Extension functions, which everyone has heard about, probably) </li></ul><br>  How to use it all - it will become clearer in a minute when we create several examples. <br><br>  To make everything as clear as possible, in this part I will use a simple model to create our DSL.  We should not create DSL when creating a class.  That would be superfluous.  A good place to use DSL can be <b>a configuration class</b> or <b>a library interface</b> , where the user does not need to know about the models. <br><br><h3>  Now let's write our first DSL </h3><br>  In this section, we will create a simple DSL that can create an object of class <i>Person</i> .  Note - this is just <b>an example</b> .  So here is an example of what we are going to get at the end of this lesson: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">val</span></span> person = person { <span class="hljs-attribute"><span class="hljs-attribute">name</span></span> = <span class="hljs-string"><span class="hljs-string">"John"</span></span> age = <span class="hljs-number"><span class="hljs-number">25</span></span> address { <span class="hljs-attribute"><span class="hljs-attribute">street</span></span> = <span class="hljs-string"><span class="hljs-string">"Main Street"</span></span> number = <span class="hljs-number"><span class="hljs-number">42</span></span> city = <span class="hljs-string"><span class="hljs-string">"London"</span></span> } }</code> </pre><br>  You can immediately notice that the code above itself describes itself and is easy to understand.  Even a person who has no developer experience can read this and even make his own edits.  To understand how we can recreate this, we will take a few steps.  Here is the model with which we start: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> age: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> address: Address? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> street: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> number: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> city: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>)</code> </pre><br>  Obviously, this is not the purest model we can write.  But we want to have <i>immutable properties (val)</i> .  And before that we will get in the next parts of this series. <br><br>  The first thing we do is create a new file.  In it we will keep the DSL separately from the actual classes in our model.  Let's start by creating some constructor function for our <i>Person</i> class.  Looking at the result we want to have, we see that all the properties of the <i>Person</i> class are defined in the code block.  But in fact, these braces mean lambda.  Here we use the first of the three above-mentioned features of the Kotlin language: <b>Using lambdas outside the brackets of the method</b> . <br><br>  If the last parameter of the function is lambda, then we can use it outside the brackets.  And if you have only one parameter that is lambda, then you can completely remove the brackets.  This means that <i>person {...} is the</i> same as <i>person ({...})</i> .  This leads to less syntactic pollution in our DSL.  Now we will write the first version of our function. <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">person</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Person</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>): Person { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> p = Person() block(p) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p }</code> </pre><br>  So.  Here we have a function that creates a Person object.  This requires a lambda, which has an object that we create in line 2. When we execute this lambda in line 3, we expect the object to receive the necessary properties for it before we return the object in line 4. Now let's see how we can use the function we wrote: <br><br><pre> <code class="hljs pgsql">val person = person { it.name = "John" it.age = <span class="hljs-number"><span class="hljs-number">25</span></span> }</code> </pre><br>  Since lambda takes only one argument, we can access the person through <i>it</i> .  It looks pretty good, but this is not the end.  In fact, this is not exactly what we want to see in our DSL.  Especially when we are going to add additional layers of objects.  This leads us to the next Kotlin function we mentioned: <b>Lambdas with arguments (receivers)</b> . <br><br>  In the definition of the person function, we can add a <b>receiver</b> to the lambda.  Thus, we can access only the functions of this receiver in this lambda.  Since the functions are in the receiver's domain, we can simply execute the lambda on the receiver instead of substituting it as an argument for the lambda. <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">person</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Person</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>): Person { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> p = Person() p.block() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p }</code> </pre><br>  And yet it can be written easier.  For example, using the <i>apply</i> function provided by Kotlin. <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">person</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Person</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>): Person = Person().apply(block)</code> </pre><br>  Now we can remove <i>it</i> from our DSL. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">val</span></span> person = person { <span class="hljs-attribute"><span class="hljs-attribute">name</span></span> = <span class="hljs-string"><span class="hljs-string">"John"</span></span> age = <span class="hljs-number"><span class="hljs-number">25</span></span> }</code> </pre><br>  Looks great, right?  :) We are almost done.  But we missed one point - the <i>Address</i> class.  In our desired result, it is very similar to the <i>person</i> function we just created.  The only difference here is that we have to assign it as the <i>address</i> for the Person object.  In order to do this, we will use the last of the three Kotlin functions mentioned above: <b>Extension functions</b> . <br><br>  Extension functions give you the ability to add functions to classes without access to the source code of the class itself.  This is ideal for creating an <i>Address</i> object and assigns it directly to the <i>address</i> in <i>Person</i> .  Here is the final version of our DSL file (for now). <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">person</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Person</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>): Person = Person().apply(block) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> Person.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">address</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Address</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) { address = Address().apply(block) }</code> </pre><br>  We added the <i>address</i> function to <i>Person</i> , which takes a lambda with <i>Address</i> as a receiver, just like we did with the <i>person</i> constructor function.  Then it sets the created <i>Address</i> object in the property of the <i>Person</i> class.  Now we have created a DSL to create our model. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">val</span></span> person = person { <span class="hljs-attribute"><span class="hljs-attribute">name</span></span> = <span class="hljs-string"><span class="hljs-string">"John"</span></span> age = <span class="hljs-number"><span class="hljs-number">25</span></span> address { <span class="hljs-attribute"><span class="hljs-attribute">street</span></span> = <span class="hljs-string"><span class="hljs-string">"Main Street"</span></span> number = <span class="hljs-number"><span class="hljs-number">42</span></span> city = <span class="hljs-string"><span class="hljs-string">"London"</span></span> } }</code> </pre><br>  This is the first part of a long series on how to write DSLs in Kotlin.  In the second part, we‚Äôll talk about adding collections, using the Builder template and @DslMarker annotation.  There is a real-life example using GsonBuilder. <br><br><hr><br>  You can find the original article here: <a href="https://proandroiddev.com/writing-dsls-in-kotlin-part-1-7f5d2193f277">Writing DSLs in Kotlin (part 1)</a> <br>  Author of the original series of articles: <a href="https://proandroiddev.com/%40dumazy">Fr√© Dumazy</a> </div><p>Source: <a href="https://habr.com/ru/post/343730/">https://habr.com/ru/post/343730/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343718/index.html">Sound settings in Ubuntu</a></li>
<li><a href="../343720/index.html">Strong typing in non-strict tests</a></li>
<li><a href="../343724/index.html">PLATO: the history of the world's first e-learning system</a></li>
<li><a href="../343726/index.html">Hinton's capsule nets</a></li>
<li><a href="../343728/index.html">Unity game, open source</a></li>
<li><a href="../343732/index.html">Corporate "stuffing" for small networks</a></li>
<li><a href="../343736/index.html">Avtomatny workshop - 2. Example "Crossing", the mathematical transformations of TK in OA</a></li>
<li><a href="../343738/index.html">We understand what was discovered there in the problem of queens</a></li>
<li><a href="../343740/index.html">Security Week 48: Root Access for Diligence, Miner Consultant and Trial Macro Malware</a></li>
<li><a href="../343744/index.html">We integrate smartcontract into the web application on Nodejs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>