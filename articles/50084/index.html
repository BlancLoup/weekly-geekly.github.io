<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Home file hosting based on Sinatra and DataMapper. Part 2 - Advanced features.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first article, I talked about how to write a simple web application using Sinatra and DataMapper. This time we will add many new features and i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Home file hosting based on Sinatra and DataMapper. Part 2 - Advanced features.</h1><div class="post__text post__text-html js-mediator-article">  In the <a title="Creating a file sharing. Part one." href="http://habrahabr.ru/blogs/ruby/50031/">first article,</a> I talked about how to write a simple web application using Sinatra and DataMapper.  This time we will add many new features and improve the code as a whole. <br><a name="habracut"></a><br><h1>  Preliminary preparation </h1><br>  In this section, we will prepare the ground for all future research. <br><br>  So, last time we got an application with the following file structure: <br><br><pre> /
   myapp.rb
   views /
     list.erb
   files /
</pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this case, all the code is in the same file myapp.rb.  In my opinion, this is very inconvenient and ugly, so this time we will start by creating folders and files, some of which will be useful to us in the course of the story.  I have the following structure: <br><br><pre>  /
   files /
   lib /
     tasks /
   manual /
   public /
   test /
   views /
</pre><br><br>  In the files folder we have files that are accessible from the outside.  In the lib folder there are libraries.  The tasks folder will contain rake-tasks.  In the manual folder, we will put the files, bypassing the web interface.  Public - storage of files sent to the browser directly.  In the test, we put, oddly enough, tests.  Finally, views are already familiar to us - there are templates for generating HTML pages (as long as we have only one). <br><br>  Now let's install Sinatra locally (directly to the folder with the application) - this will allow us not to worry about installing Sinatra gem.  To do this, download the Sinatra code from the git repository.  To do this, you must have <a href="http://git-scm.com/">git</a> installed: <br><br><pre>  cd lib
 git clone git: //github.com/bmizerany/sinatra.git
 rm -rf sinatra / .git
 rm sinatra / .gitignore
 cd ..
</pre><br><br>  We will place the main code of our application in the init.rb file, having previously changed its beginning to this: <br><br><pre>  require 'rubygems'
 require File.expand_path (File.dirname (__ FILE__) + '/ lib / sinatra / lib / sinatra')
 require File.expand_path (File.dirname (__ FILE__) + '/ lib / config')
 require 'ftools'
 require 'dm-core'
 require 'dm-validations'
 require 'dm-timestamps'
</pre><br><br>  This code connects Sinatra and the configuration file config.rb from the lib folder - we‚Äôll now create and write the following code in it (not doing anything yet): <br><br><pre>  configure do
   # Here will be the configuration settings for Sinatra
 end </pre><br><br>  Then Rakefile comes in handy - a special file for the rake utility, which tells it where to get the tasks.  A file named Rakefile (without extension) located in the root directory should contain the following: <br><br><pre>  require 'rake'
 require 'rake / testtask'
 require 'rake / rdoctask'
 
 Dir ["# {File.dirname (__ FILE __)} / lib / tasks / ** / *. Rake"]. Sort.each {| ext |  load ext} </pre><br><br>  In it, we simply load all the rake files from the lib / tasks directory and its subdirectories (the regular expression /**/*.rake is used for this). <br><br><h2>  Separate the code </h2><br>  The application code that lies in one file is not only inconvenient, but also wrong :) Therefore, now we will start by putting our StoredFile class into a separate one, sorry for the pun, file.  In the lib folder we should have the file stored_file.rb with the following contents: <br><br><pre>  require 'dm-core'
 require 'dm-validations'
 require 'dm-timestamps'

 DataMapper.setup (: default, "sqlite3: // # {Dir.pwd} /files.sqlite3")

 class StoredFile
   include DataMapper :: Resource

   property: id, Integer,: serial =&gt; true # primary serial key
   property: filename, String,: nullable =&gt; false # cannot be null
   property: created_at, DateTime
  
   default_scope (: default) .update (: order =&gt; [: created_at.desc])
 end

 DataMapper.auto_upgrade!
</pre><br><br>  And at the end of the countless require in init.rb we add the line <br><br><pre>  require 'lib / stored_file' </pre><br><br>  The functionality of our application has not changed a bit, but now it looks a little more decent. <br><br><h1>  Viva la Haml! </h1><br>  In the first version of the application, we used the language Erb (Embedded RuBy) for generating HTML pages, which is HTML-code with included fragments of Ruby-code.  This approach is traditional in Rails, but we are engaged in marginal solutions :) In this regard, I decided to use <a title="Haml" href="http://haml.hamptoncatlin.com/">Haml</a> as a language for templates. <br><br>  Haml is a markup language that preaches beauty, as the main deity of the pattern.  Indeed, the Haml code, in my opinion, looks nicer (and they say that it works faster).  Another important feature of Haml is that it will not allow you not to close the tag (because you will not use explicit HTML tags at all) <br><br>  Installation is simple: <br><br><pre>  sudo gem install haml </pre><br><br>  Let's create the list.haml file in our views directory and fill it with content.  Haml is similar to Python in that it uses indentation in the code as block delimiters (in HTML, closing tags are used for this, and in Erb, the end keyword is used).  So the html code <br><br><pre>  &lt;div&gt;
 &lt;span&gt; Some text &lt;/ span&gt;
 &lt;/ div&gt;
 &lt;ul&gt;
 &lt;li&gt; Item 1 &lt;/ li&gt;
 &lt;li&gt; Item 2 &lt;/ li&gt;
 &lt;/ ul&gt; </pre><br><br>  On Haml looks like this: <br><br><pre>  % div
   % span some text
 % ul
   % li Item 1
   % li Item 2 </pre><br><br>  That, you see, is much shorter. <br><br>  A little about the syntax, which is useful to us: <br><br><pre>  % TAG </pre><br>  Creates a &lt;TAG /&gt; or &lt;TAG&gt; &lt;/ TAG&gt; tag - depending on the tag (for hr the first option will be chosen, for a - the second one) <br><br><pre>  % TAG CONTENT </pre><br>  Creates a &lt;TAG&gt; CONTENT &lt;/ TAG&gt; tag. <br><br><pre> % TAG
   CONTENT
</pre><br>  Turns into &lt;tag&gt; CONTENT &lt;tag&gt;.  In this case, CONTENT may also contain the operator% and any other operators. <br><br>  The syntax for defining attributes is the same as for Ruby hashes: <br><br><pre>  % span {: class =&gt; "header",: id =&gt; "news_135",: style =&gt; "float: left"} The elk ate 3 kilograms of dog food and barked! </pre><br>  It will become &lt;span class = "header" id = "news_135" style = "float: left"&gt; Elk ate 3 kilograms of dog food and barked! &lt;/ Span&gt; <br><br>  In fact, to define a class and id, there is a simpler syntax (very similar to CSS): <br><pre>  % span.header # news_135 Another Yellow Title </pre><br><br>  And to create divs with the right class, it's still easier: <br><pre>  .content =% div.content =% div {: class =&gt; "content"} = &lt;div class = "content"&gt; </pre><br><br>  Now interject here Ruby.  To execute a line of code (equivalent to &lt;%%&gt; in Erb), put a "-" in front of it: <br><pre>  - str = @ my_object.get_some_string </pre><br><br>  To turn the result into a string, use the operator "=": <br><pre>  - now = Time.now
 = now </pre><br>  Displays the current time. <br><br>  Of course, you can use = bundled with tag operators: <br><pre>  % span # current_time = Time.now </pre><br><br>  And the last thing we need to know for writing our Haml template is the "!!!" operator.  By default, it creates a DOCTYPE Transitional.  And we don‚Äôt need more of it. <br><br><h2>  We write a template </h2><br>  I got the following template to display a list of files and a new file upload form: <br><pre> !!!
 % html {: xmlns =&gt; "http://www.w3.org/1999/xhtml"}
   % head
     % title faylopomoyka named after me
     % meta {: "http-equiv" =&gt; "content-type",: content =&gt; "text / html; charset = UTF-8"}
   % body
     .main
		 - if @ files.empty?
		   % h1 No files.
		 - else
		   .list
		     % h1 File List
		     % table {: cellspacing =&gt; 0}
		       % tr
		         % th file
		         % th Uploaded
		         % th Remove
		       - @ files.each do | file |
		         % tr
		           % td.filename
		             % a {: href =&gt; "/#{file.id}",: title =&gt; file.filename} = file.filename
		           % td.created_at = file.created_at.strftime ("% d% b")
		           % td.delete
		             % a {: href =&gt; "/#{file.id}/delete",: title =&gt; "Delete"} Delete
		 .upload
		   % h1 add
		   % form {: name =&gt; "new_file",: enctype =&gt; "multipart / form-data",: method =&gt; "post",: action =&gt; "/"}
		     % input {: name =&gt; "file",: type =&gt; "file"}
		     % br
		     % input {: type =&gt; "submit",: value =&gt; "Download"}
</pre><br><br>  I can not fail to note that the resulting pattern is very elegant (especially if you have a text editor with the backlight of the Haml syntax). <br><br><h2>  Separate the layout from the template </h2><br>  Let's imagine that we may also need other views for our application (and we will need them) - we will not write a common header with "!!!", "% html" and so on in everyone.  To solve this problem in Sinatra, as in Rails, there is a layouts mechanism.  A layout can be viewed as a top-level template ‚Äî the contents of the template are inserted into the layout and together they go to the user. <br><br>  To use the layout, we just need to place the layout.haml file in the views folder and it will automatically start being used by our application.  By the way, we could also create layout layout.erb, which would be used for Erb templates. <br><br>  The following code will be transferred from the template to the layout: <br><br><pre>  !!!
 % html {: xmlns =&gt; "http://www.w3.org/1999/xhtml"}
   % head
     % title faylopomoyka named after me
     % meta {: "http-equiv" =&gt; "content-type",: content =&gt; "text / html; charset = UTF-8"}
   % body
     .main
       = yield </pre><br>  New here is only the line "= yield" at the end.  It, as again in the case of Erb layouts, causes the Haml template to be processed in the place of its call (that is, inside a div with the main class).  The code that we placed in layout.haml, of course, must be removed from the list.haml. <br><br>  Everything!  Now we are solid people and use Haml as a language for templates.  The only thing left to do is to tell Sinatra that it is necessary to output not list.erb, but list.haml.  To do this, go to our init.rb, and replace the line ‚Äúerb: list‚Äù with ‚Äúhaml: list‚Äù.  Now that's all - we use Haml and enjoy life. <br><br>  Although, I‚Äôm probably ready to put some money on the fact that you didn‚Äôt succeed and Sinatra gave you an error message related to the data in the template or layout file.  The thing is this: Haml works only with templates and layouts, in which 2 spaces are used as indentation - just spaces, not tabs, for example.  And exactly 2. Correct it and, most likely, the error will disappear.  In particular, if you copied the code directly from the page, then you definitely have tabs instead of spaces. <br><br><h1>  Hiding links from prying eyes </h1><br>  I have already explained why users should not be given the opportunity to know the id of the file they are downloading, so I will not dwell on this.  Now it's time to solve this problem.  As download addresses, we will use the forty <a href="http://ru.wikipedia.org/wiki/SHA-1">-</a> character <a href="http://ru.wikipedia.org/wiki/SHA-1">SHA-1</a> digest (digest) on behalf of the file as its identifier.  To do this, we do the following: <br>  Add to stored_file.rb a new field to store the digest: <br><pre>  property: sha, String </pre><br>  At the end of the file we have written ‚ÄúDataMapper.auto_upgrade!‚Äù, Which means that the database will be automatically updated by DataMapper. <br><br>  Open the file init.rb and change all the blocks except the first one (get '/'): <br><pre>  post '/' do
   tempfile = params ['file'] [: tempfile]
   filename = params ['file'] [: filename] digest = Digest :: SHA1.hexdigest (filename) # Calculate digest
   @file = StoredFile.create: filename =&gt; filename,: sha =&gt; digest # Write the file name and search in the database
   File.copy (tempfile.path, "./files/#{@file.id}.upload")
   redirect '/'
 end

 # download file 
   get '/: sha' do # now look for files by sha value, not by id
   @file = StoredFile.first: sha =&gt; params [: sha]
   send_file "./files/#{@file.id}.upload",: filename =&gt; @ file.filename,: type =&gt; 'Application / octet-stream'
 end

 # delete file
   get '/: sha / delete' do # and delete also by sha, not by id
   @file = StoredFile.first: sha =&gt; params [: sha]
   File.delete ("./ files/#{@file.id}.upload")
   @ file.destroy
   redirect '/'
 end </pre><br><br>  It remains to change our template: <br><pre> % td.filename
   % a {: href =&gt; "/ # {&lt;strong&gt; file.sha &lt;/ strong&gt;}",: title =&gt; file.filename} = file.filename
 % td.created_at = file.created_at.strftime ("% d% b")
 % td.delete
   % a {: href =&gt; "/#{&lt;strong&gt;file.sha&lt;/strong&gt;}/delete",: title =&gt; "Delete"} Delete
</pre><br><br>  Done!  Now our links look like this: <br><pre>  localhost: 4567 / 1c62e8aa8072c8a3cd5df1ba49bb4513bc1d8a88 </pre><br><br><h2>  Add download count and file size </h2><br>  This is a very simple point.  We will store the number of downloads and file size in the database, which means we need to expand our description of the class StoredFile: <br><pre>   property: downloads, Integer,: default =&gt; 0
   property: filesize, Integer,: nullable =&gt; false
</pre><br><br>  Upload and download file now look like this: <br><br><pre> post '/' do
   tempfile = params ['file'] [: tempfile]
   filename = params ['file'] [: filename]
   digest = Digest :: SHA1.hexdigest (filename)
   @file = StoredFile.create: filename =&gt; filename,: sha =&gt; digest,: filesize =&gt; File.size (tempfile.path)

   File.copy (tempfile.path, "./files/#{@file.id}.upload")
   redirect '/'
 end

 get '/: sha' do
   @file = StoredFile.first: sha =&gt; params [: sha]
   @ file.downloads + = 1
   @ file.save

   send_file "./files/#{@file.id}.upload",: filename =&gt; @ file.filename,: type =&gt; 'Application / octet-stream'
 end
</pre><br><br>  We will display the new data as follows: <br><pre>       % tr
         % th file
         % th Uploaded
         % th Downloaded

         % th Remove
       - @ files.each do | file |
         % tr
           % td.filename
             % a {: href =&gt; "/#{file.sha}",: title =&gt; file.filename} = file.filename
             = "(# {file.filesize / 1024} Kb)"
          
           % td.created_at = file.created_at.strftime ("% d% b")
           % td.downloads = file.downloads
          
           % td.delete
             % a {: href =&gt; "/#{file.sha ƒ±/delete",: title =&gt; "Delete"} Delete </pre><br><br><h1>  Some javascript </h1><br>  This section is not directly related to the study of basic technologies, but it does allow a little more to get used to the new ‚Äúvalue system‚Äù.  Agree that deleting the file without any confirmations is not the best solution even for home use: you can click randomly.  Therefore, we add confirmation when trying to delete a file. <br><br>  In the public folder, create a script.js file with the following elementary content: <br><pre>  function ORLY () {
	 return confirm ('Are you sure');
 }
</pre><br><br>  Then we include this javascript file layout: <br><pre>     % meta {: "http-equiv" =&gt; "content-type",: content =&gt; "text / html; charset = UTF-8"}
     % script {: type =&gt; "text / javascript",: src =&gt; "/script.js"}

   % body </pre><br><br>  And in our template we make a small edit: <br><pre> % td.delete
   % a {: href =&gt; "/#{file.sha-/delete",: title =&gt; "Delete",: onclick =&gt; "return ORLY ();"} Delete
</pre><br><br>  Thus, when you click the "Delete" button, we will be asked if we are sure, and this is an extra chance to come to its senses. <br><br><h1>  Automatically search and add new files. </h1><br>  Let's return to the original formulation of the problem: a file sharing service with a convenient interface, running on a home server.  While at home, it‚Äôs not so convenient to go to a ‚Äúwebsite‚Äù and upload a file ‚Äî it‚Äôs much easier to drop it into a shared folder so that it will be added to our list. <br><br>  Luckily, this is easy if we use <a href="http://rake.rubyforge.org/">Rake</a> - the equivalent of Make for Ruby.  This utility allows you to create so-called tasks (tasks) that are executed with the rake command TASK NAME.  When launched, rake searches for the Rakefile file in the current directory and executes the commands specified in it, then searches for the task with the specified name and executes it. <br><br>  What is rake task?  This is nothing more than a specially designed Ruby code.  In our case, the rake task will take all the files from the manual directory and simulate their loading in the usual way (that is, copy them into the files folder and create the necessary records in the database). <br><br>  In case you suddenly have no Rake (which is unlikely), the installation is done in the traditional way for Ruby: <br><pre>  sudo gem install rake </pre><br><br>  So, our Rakefile file that we created at the beginning tells Rake that it needs to load all the files with the .rake extension from the lib / tasks directory.  So it is there that we create our file, which we call manual_monitor.rake.  We will write the following to it: <br><br><pre>  require 'ftools'
 require 'lib / datamapper / stored_file'

 desc "Checks directory 'manual' and uploads all files from it"
 task: manual_monitor do
   Dir ["manual / *"]. Each do | path |
     file = File.new (path)
     filename = File.basename (file.path)
     digest = Digest :: SHA1.hexdigest (filename)
     stored_file = StoredFile.create: filename =&gt; filename,: sha =&gt; digest,: filesize =&gt; File.size (file.path)
     File.move (path, "./files/#{stored_file.id}.upload")
     puts "File # {path} succesfully uploaded. ID = # {stored_file.id}"
   end
 end
</pre><br><br>  First we connect ftools (file utilities) and our stored_file.rb (describing the StoredFile class - we will need to work with the database. Next is the description of the check_files task. As you might guess, in general, the task is described as: <br><pre>  task: TASK_NAME do
   CODE
 end
</pre><br>  The optional command desc in front of the task allows you to set an arbitrary text description for the task (you can view it with the command ‚Äúrake --tasks‚Äù) <br><br>  Inside the task itself, we do almost the same thing as in the code that loads the file through the browser, but with a couple of differences: <br><ol><li>  We work with all files from the manual directory. </li><li>  We move the file from manual to files (so as not to process it again) </li></ol><br><br>  You can check how our task works by placing a file in the manual folder and invoking the command <br><pre>  rake manual_monitor </pre><br>  Rake should report that the file was copied successfully.  Through the web interface, we can make sure that it is. <br><br>  Now we need to learn how to call our team automatically.  I considered two options: through crontab and through a Ruby daemon.  You and I, of course, are perverts and outcasts, but in this case I didn‚Äôt reinvent the wheel (and just use up system resources) and just used a crontab.  However, if someone is interested in the launch option through the Ruby daemon, I can tell you about it. <br><br>  My crontab looks like this <br><pre> * / 1 * * * * cd / path / to / my / app /;  rake manual_monitor
</pre><br>  That is, the command is executed every minute. <br><br><h2>  Whew! </h2><br>  Initially, I planned to meet one article, but practice has shown that even two are few.  In the third part, I plan to talk about: <br><ul><li>  Normal authorization (to allow everyone to download files, but forbid anyone to download and delete them) </li><li>  Auxiliary methods (helpers) </li><li>  How to add a delay when downloading (so that you can make sure that you have come to the right link and do not download a hundred megabyte file via GPRS) </li><li>  Configuration </li><li>  Creating CSS with SASS </li><li>  Code testing </li><li>  Performance scores </li></ul><br><br>  Right now I have written a list and I already doubt that it will be enough for me to have three parts ... But if you want to learn something else - write in the comments, we will understand :) <br><br>  Once again, thank you for your attention! <br></div><p>Source: <a href="https://habr.com/ru/post/50084/">https://habr.com/ru/post/50084/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../50068/index.html">Arbitrary html code in Zend_Form</a></li>
<li><a href="../50071/index.html">Turning a PDA into a USB WLAN adapter</a></li>
<li><a href="../50072/index.html">Post in the sandbox, or I forgot that I have an account for a long time.</a></li>
<li><a href="../50073/index.html">Why do I need virtualka?</a></li>
<li><a href="../50074/index.html">iPhone as a WiFi joystick</a></li>
<li><a href="../50085/index.html">Ruby on Rails step by step. # 2 Workplace and first application</a></li>
<li><a href="../50087/index.html">When to use AJAX?</a></li>
<li><a href="../50091/index.html">FreeSWITCH. Perhaps the future of telephony is already with us?</a></li>
<li><a href="../50094/index.html">Overloading methods in php?</a></li>
<li><a href="../50095/index.html">Sending user comments of the site to you on Jabber</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>