<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>H.265 / HEVC. Intel Architecture Optimization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The current situation in the field of media codecs can be described in just a few words: simple solutions have exhausted themselves. Every year the ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>H.265 / HEVC. Intel Architecture Optimization</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/5c7/10e/83d/5c710e83da36455da640764f838bcc9c.png"><br>  The current situation in the field of media codecs can be described in just a few words: simple solutions have exhausted themselves.  Every year the material for coding is becoming increasingly difficult, and the requirements for the quality of the result are getting higher and higher.  Under these conditions, when a frontal attack no longer produces an effect, the optimization of coding and media playback for specific platforms using their most advanced features is of particular importance.  We can show what can be achieved by such optimization using the example of the promising H.265 codec.  As a target platform, consider an Intel server solution ‚Äî the Xeon processor. <br><a name="habracut"></a><br><h4>  Brief Description of H.265 / HEVC </h4>  H.265 / HEVC (High-Efficiency Video Coding) is the latest video codec standard developed jointly by the International Telecommunication Union ITU-T and ISO / IEC.  The goal of this standard is to increase compression efficiency and reduce data loss.  H.265 / HEVC, compared with the previous standard H.264 / AVC, has twice the degree of compression with equal subjective image quality.  HEVC technology allows video providers to stream high-quality video with less network load. <br>  Note the main functional innovations applied in H.265: <br><ul><li>  Special features for random access and splicing digital streams.  In H.264 / MPEG-4 AVC, the digital stream must always begin with an IDR addressing block, and random access is supported in HEVC. </li><li>  The image is divided into coding tree units (CTU), each of which contains coding tree blocks (CTB) of luminance and chroma.  All previous video coding standards used a fixed array size for luma samples ‚Äî 16 √ó 16.  HEVC supports CTB blocks of various sizes, which are selected depending on the needs of the encoder in terms of memory and processing power. </li><li>  Each coding block (CB) can be recursively divided into conversion blocks (TB).  The separation is determined by the residual quadtree.  Unlike previous standards in HEVC, a single TB block can span multiple prediction blocks (PBs) for cross predicted coding units (CUs). </li><li>  Directional prediction with 33 different orientation directions for transformation blocks (TB) ranging in size from 4 √ó 4 to 32 √ó 32.  The possible direction of prediction is all 360 degrees.  HEVC supports various intraframe prediction encoding techniques. <br></li></ul><br>  H.265 / HEVC imposes extremely high computational power requirements on both client devices and internal transcoding servers. <br><br><h4>  HEVC Performance Issues </h4>  The existing <a href="http://hevc.hhi.fraunhofer.de/">HEVC Test Model</a> (HM) project implements only the core functionality of the standard;  actual performance is still far from what is needed in a real environment.  Two main disadvantages of this project: <br><ul><li>  Lack of parallel circuit. </li><li>  Inefficient setting vectorization. </li></ul><br><br><img src="https://habrastorage.org/files/a9a/8cd/a01/a9a8cda0120d4ce399dc31571faea1db.png"><br>  <i>Figure 1. HM project profile - parallel threading</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/e52/c73/a4e/e52c73a4e5fd4512a196565d8d6a4047.png"><br>  <i>Figure 2. HM project profile - resource intensive code</i> <br><br>  This HEVC codec consumes, compared to H.264, 100 times more CPU resources on the server side and 10 times more on the client side. <br>  The H.265 / HEVC codec attracted the attention of many companies and organizations around the world, which resulted in optimizing its performance and actual development.  There are several open source projects. <br><ul><li>  <a href="https://github.com/OpenHEVC/openHEVC">OpenHEVC</a> (compatible with HM10.0, decoder optimization) </li><li>  <a href="http://code.google.com/p/x265/">x265</a> (compatible with HM, parallelization and vectoring) </li></ul><br>  To evaluate the performance of the x265 encoder on a platform with Intel¬Æ Xeon¬Æ processors (E5-2680, 2.7 GHz, 8 * 2 physical cores, codenamed Sandy Bridge), we launched a video with a resolution of 720p and a frequency of 24 frames per second.  The x265 developers have done a lot of work to optimize the original standard in order to parallelize the processing of tasks and data.  However, our test showed that the codec can use only 6 cores in a system with 32 logical cores (with SMT enabled).  Thus, the codec is far from fully using the resources of modern multi-core platforms. <br><br><img src="https://habrastorage.org/files/2e6/908/c79/2e6908c7994940ba990ccf65a411db79.png"><br>  <i>Figure 3. CPU load in X.265 project</i> <br><br><img src="https://habrastorage.org/files/5c7/10e/83d/5c710e83da36455da640764f838bcc9c.png"><br>  <i>Figure 4. X.265 Project with Intel¬Æ SIMD Configuration</i> <br><br>  The x265 project also used Intel¬Æ SIMD instructions (autogeneration by the compiler), which increased performance by more than 70%.  Together with further optimization of the compiler options, the Intel compiler provides a doubling of performance on the IA platform.  However, the performance of the encoder is still significantly lower than what is required for a real-time encoder, especially for high-definition video with a resolution of 1080p. <br>  Below we show the results achieved by the Chinese company Strongene with the support of Intel specialists on the way to optimizing <a href="http://xhevc.com/en/hevc/decoder/download.jsp">the H.265 / HEVC codec</a> created by it for various Intel platforms. <br><br><h4>  HEVC Optimization for Intel¬Æ Xeon ‚Ñ¢ Platform </h4>  The main part of the most resource-intensive video and image processing functions consists of intensive block data calculations.  To optimize them, you can use Intel¬Æ SIMD vectorization instructions.  In the encoder as part of the Strongene codec, according to the profiling data, using Intel SSE instructions, you can manually vectorize all the most demanding functions, such as low-complexity frame interpolation with motion compensation;  integer conversion without transposition;  Hadamard transform;  calculating the sums of absolute differences (SAD) / squared differences (SSD) with the least redundant memory use.  We have included Intel SSE instructions in the form of intrinsic functions, as shown in Fig.  five. <br><br><img src="https://habrastorage.org/files/458/dcb/2db/458dcb2dbf344666816f3e13e3eeeb63.png"><br>  <i>Figure 5. Example of enabling Intel¬Æ SIMD / SSE instructions in the Stongene codec</i> <br><br>  The developers of Strongene rewrote all resource-intensive functions in order to achieve the greatest increase in the performance of the encoder.  In fig.  Figure 6 shows our profiling data in 1080p video coding scenarios using HEVC.  It can be seen that 60% of resource-intensive functions are processed by Intel SIMD instructions. <br><br><img src="https://habrastorage.org/files/628/921/b6a/628921b6a9d64ea88ec8c74ecd69c877.png"><br>  <i>Figure 6. Profiling Strogene coding functions</i> <br><br>  Intel AVX2 instructions with calculating 256-bit integer values ‚Äã‚Äãhave twice the performance compared to the previous Intel SSE code, working with 128-bit values.  Intel AVX2 instruction set supported by platform <br>  Intel Xeon (Haswell), the release of which began in 2014.  To assess the performance of the integrated functions of the Intel AVX2, we use the common calculation of the sum of absolute differences for the 64 * 64 block. <br><br>  <i>Table 1. Intel¬Æ SSE and Intel¬Æ AVX2 Implementation Results</i> <table><tbody><tr><th>  CPU cycles </th><th>  Source </th><th>  Intel¬Æ SSE </th><th>  Intel¬Æ AVX2 </th></tr><tr><td>  Run 1 </td><td>  98877 </td><td>  977 </td><td>  679 </td></tr><tr><td>  Run 2 </td><td>  98463 </td><td>  1092 </td><td>  690 </td></tr><tr><td>  Run 3 </td><td>  98152 </td><td>  978 </td><td>  679 </td></tr><tr><td>  Run 4 </td><td>  98003 </td><td>  943 </td><td>  679 </td></tr><tr><td>  Run 5 </td><td>  98118 </td><td>  954 </td><td>  678 </td></tr><tr><td>  The average </td><td>  98322,6 </td><td>  988.8 </td><td>  681 </td></tr><tr><td>  Acceleration </td><td>  1.00 </td><td>  99.44 </td><td>  144.38 </td></tr></tbody></table><br>  As can be seen in Table 1, the use of Intel SSE and Intel AVX2 instructions provides a 100-fold increase in performance, while the Intel AVX2 code wins an additional 40% compared with Intel SSE. <br>  As we saw earlier, in most existing implementations, not all cores of multicore platforms are used.  Building on the latest Intel Xeon multi-core architecture with parallel dependencies between CTB-based algorithms, Strongene developers propose replacing the original OWF and WPP methods with a parallel IFW structure and then developing a three-level flow control scheme to ensure that the IFW structure of all CPU cores is used to accelerate HEVC coding . <br><br><img src="https://habrastorage.org/files/ccd/c40/d55/ccdc40d55a864ed8b10c96eb070d3bf9.png"><br>  <i>Figure 7. Parallel streaming and CPU usage in the Strongene encoder</i> <br><br>  Due to the use of the WHP parallel structure and the full implementation of Intel SIMD instructions, respectively, at the task level and data level, the Strongene encoder developers managed to achieve a very significant performance improvement on x86 processors for 1080p video using the computing resources of all cores, as shown in Fig.  eight. <br><br><h4>  Further configuration using SMT / HT </h4>  Also of interest is the dependence of the performance of the codec on the inclusion of simultaneous multithreading (SMT) in the system, which is widespread on all platforms with the Intel architecture, also called hypertreaming technology (HT). <br><br>  <i>Table 2. Encoding speed Strongene HEVC on Intel¬Æ Xeon¬Æ platform</i> <br><img src="https://habrastorage.org/files/27f/cd1/010/27fcd1010c00433b84e0c9e0433b3b2a.png"><br>  As can be seen from the table (shown in yellow) on the Ivy Bridge platform (Intel Xeon E5-2697 v2 processor for disabled SMT HEVC video coding with 1080p resolution is performed in real time! <br><br>  Having achieved a tremendous increase in performance, we continued to explore the coding capabilities of Strongene HEVC on the Ivy Bridge platform, focusing on flow rates and quality issues. <br><br>  <i>Table 3. Performance comparison of H.264 and H.265 codecs</i> <br><img src="https://habrastorage.org/files/0b2/473/871/0b24738718ac4210a30a8be77761265c.png"><br>  Table 3 shows that the H.265 / HEVC codec reduces the amount of data by 50% while maintaining the same video quality. <br><br>  H.265 / HEVC is likely to become the most popular video standard in the next decade.  Multiple applications and multimedia products currently support HEVC.  In this document, we implemented a full-featured, real-time HEVC solution based on CPU on Intel platforms with new IA technologies.  Our optimized solution based on Intel processors is deployed at Xunlei, a company that provides video services over the Internet, and will contribute to the widespread adoption and distribution of H.265 / HEVC technology. </div><p>Source: <a href="https://habr.com/ru/post/242781/">https://habr.com/ru/post/242781/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242767/index.html">ECMAScript 6 Promises</a></li>
<li><a href="../242771/index.html">What mobile apps can I give to an online store and a retail company in general? Figures in the studio ...!</a></li>
<li><a href="../242773/index.html">Real time ecommerce</a></li>
<li><a href="../242775/index.html">Watch November 12 and 13 live broadcast of the virtual event Connect (); for developers!</a></li>
<li><a href="../242779/index.html">New Raspberry Pi model introduced: Model A + priced at $ 20</a></li>
<li><a href="../242787/index.html">Encoders / Modulators from ZeeVee</a></li>
<li><a href="../242789/index.html">Financial data transfer methods: FIX protocol</a></li>
<li><a href="../242791/index.html">How Internet advertising works: Traffic arbitration</a></li>
<li><a href="../242795/index.html">As in Yandex use PyTest and other frameworks for functional testing.</a></li>
<li><a href="../242797/index.html">Publisher List for Mobile Game Developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>