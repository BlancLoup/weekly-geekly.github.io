<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>URL Scheme: Checking the presence of an installed application in Javascript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently I encountered the need to determine whether the URL Scheme is registered in the browser in order, depending on the result, to show either the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>URL Scheme: Checking the presence of an installed application in Javascript</h1><div class="post__text post__text-html js-mediator-article">  Recently I encountered the need to determine whether the URL Scheme is registered in the browser in order, depending on the result, to show either the application download button or the direct URL to launch it. <br><br>  It turned out that there are no standard mechanisms for this.  But since users did not want to pay attention to the Download button and the red inscription about the need to pre-install the application, I had to look for options.  This will be discussed below. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I just want to warn you that there was not a single method that worked in at least two browsers consistently the same.  Therefore, lovers of beautiful cross-browser solutions will be disappointed - the article is full of hacks (please do not minus it, it‚Äôs sickening, but the task is the task). <br><br>  First, create our links. <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"runlink"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myapp://command_line_parameters"</span></span></span><span class="hljs-tag">&gt;</span></span>Run<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"downloadlink"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display:none;"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://mysite.com/download/app.exe"</span></span></span><span class="hljs-tag">&gt;</span></span>Download<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Now we will create a common function that will determine the browser and launch the corresponding handler.  Well, another auxiliary, which will display a request to download the application and download it in case of a positive response. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initApplicationLink</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">runlink, downloadlink</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   var func = null; if (navigator.userAgent.indexOf('Firefox')&gt;=0 ) func = checkFirefox; else if (navigator.userAgent.indexOf('Opera')&gt;=0 ) func = checkOpera; else if (navigator.userAgent.indexOf('Chrome')&gt;=0 ) func = checkChrome; else if (navigator.userAgent.indexOf('Safari')&gt;=0 ) func = checkSafari; if ( func!=null ) { //   Download $(downloadlink).hide(); //          $(runlink).on('click', function(){ func(runlink, downloadlink); //   ,        return false; }); } else { //        Download $(downloadlink).show(); } } function downloadConfirmation(downloadlink) { if ( confirm('You need to install our application first. Do you really want to download it now?') ) document.location = $(downloadlink).attr('href'); }</span></span></code> </pre><br><br>  Let's start with Firefox and Opera, as they provide a 100% reliable and beautiful exclusion mechanism in this matter.  But, unfortunately, the implementation is still different. <br><br>  Firefox has the simplest solution. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkFirefox</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">runlink, downloadlink</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,      URL var f = createFrame(); try { f.contentWindow.location = $(runlink).attr('href'); } catch (e) { //  URL   ,      downloadConfirmation(downloadlink); } //     deleteFrame(f); }</span></span></code> </pre><br><br>  Opera is not much different from Firefox, except that it catches the exception not at the time of an attempt to load a URL with an unregistered protocol into the frame, but at the time of an attempt to access an undefined frame attribute (contentWindow.location). <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkOpera</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">runlink, downloadlink</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f = createFrame(); f.contentWindow.location = $(runlink).attr(<span class="hljs-string"><span class="hljs-string">'href'</span></span>); setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">//        // ( something   -) if ( f.contentWindow.location!='something' ) {} } catch (e) { downloadConfirmation(downloadlink); } deleteFrame(f); }, 0); }</span></span></code> </pre><br><br>  The createFrame () and deleteFrame () functions for Firefox and Opera: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'iframe'</span></span>); f.style.display = <span class="hljs-string"><span class="hljs-string">'none'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.appendChild(f); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.removeChild(f); }</code> </pre><br><br>  Safari for Windows also knows how to catch exceptions, but with a hidden frame this number failed.  Alternatively, you can use a regular window.  The solution is not elegant, but working. <br><br>  Safari for MacOS with exceptions, apparently, is not friendly.  Therefore, it is necessary to apply the purely crutch method here.  The trick is to check the focus of our browser window after launching the application.  If the application was successfully launched, the window lost focus, and we recorded this fact in the handler of this event.  If the application did not open, then the window still has focus. <br><br>  Unfortunately, this method is not 100% stable.  For example, if during the timeout the browser did not have time to open the application, or vice versa - the user managed to close the application before the timeout occurred, and the window again received focus.  As a result, such options translate into the next unpleasant picture.  A window pops up with a download suggestion, and after a second the application starts.  Or vice versa - the application starts, the user immediately closes it, and a window appears with a download suggestion.  Therefore, increasing or decreasing the timeout is almost equally bad (the increase is still slightly better, because in most cases the user will not instantly close the newly opened application).  In practice, the most acceptable timeout is one second. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkSafari</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">runlink, downloadlink</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( navigator.userAgent.indexOf(<span class="hljs-string"><span class="hljs-string">'Windows'</span></span>)&gt;=<span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-comment"><span class="hljs-comment">//        URL var w = window.open($(runlink).attr('href'), '', 'width=50, height=50'); setTimeout(function(){ try { //        if ( w.location!='about:blank' ) {} w.close(); window.focus(); } catch (e) { w.close(); window.focus(); downloadConfirmation(downloadlink); } }, 1000); } else { //  MacOS    iOS document.location = $(runlink).attr('href'); setTimeout(function(){ //   -  ,     if ( window.isFocused ) downloadConfirmation(downloadlink); }, 1000); } } //         window.isFocused = true; $(window).on('focus', function(){ window.isFocused = true; }) .on('blur', function(){ window.isFocused = false; });</span></span></code> </pre><br><br>  Chrome turned out to be fully compatible with Safari under MacOS, except for a timeout (Safari took almost a second to launch the application, while Chrome launched it in less than 250 milliseconds). <br><br>  (In practice, the timeout method is very much dependent on the load on the computer when the application is started. I got into situations with Chrome and Safari, when the application did not have time to start, and a window was displayed prompting you to download, after which the application was started. Again, the problem with timeout described above). <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkChrome</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">runlink, downloadlink</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.location = $(runlink).attr(<span class="hljs-string"><span class="hljs-string">'href'</span></span>); setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.isFocused ) downloadConfirmation(downloadlink); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); }</code> </pre><br><br>  Well, finally, Internet Explorer did not show a stable result with all the efforts.  Safari for Windows is technically suitable for IE (with the opening of a small window).  But it was not possible to get at least 50% stability.  Therefore, IE went to the ‚Äúother browsers‚Äù branch, which does not do any checks, but simply displays both links ‚Äî to launch and load the application.  (I would be grateful if someone could tell me how to use IE). <br><br>  Now we just need to initialize our links. <br><br><pre> <code class="javascript hljs">initApplicationLink(<span class="hljs-string"><span class="hljs-string">'.runlink'</span></span>, <span class="hljs-string"><span class="hljs-string">'.downloadlink'</span></span>);</code> </pre><br><br>  <i><b>Note:</b> The solution was tested in the latest versions of Chrome, Firefox, Opera, Safari and IE on Windows and MacOS platforms.</i>  <i>In mobile browsers, tests were not conducted, but the option with a timeout may well be workable on Android and iOS.</i> </div><p>Source: <a href="https://habr.com/ru/post/182484/">https://habr.com/ru/post/182484/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../182474/index.html">Print history: the evolution of ideas and technologies (Part 1)</a></li>
<li><a href="../182476/index.html">Review of the first desktop IP phone on the Android platform - Grandstream GXP2200</a></li>
<li><a href="../182478/index.html">As I went to the sea with blue ... Just5</a></li>
<li><a href="../18248/index.html">Competition of poems about the "Witcher"</a></li>
<li><a href="../182482/index.html">Waiting for new MacBook Pro Retina or thinking about integrated graphics</a></li>
<li><a href="../182488/index.html">Can I cash in on users? 3 easy ways to increase application monetization</a></li>
<li><a href="../182494/index.html">Microsoft released another set of updates, June 2013</a></li>
<li><a href="../1825/index.html">BitTorrent's popularity is growing by leaps and bounds</a></li>
<li><a href="../18250/index.html">Hang your mouse on the Christmas tree in the new year!</a></li>
<li><a href="../182502/index.html">High Availability Optical Ring</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>