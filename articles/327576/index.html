<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Self-sufficient controllers on Xamarin.Forms: "Re-use the code to the maximum!". Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Even as an idea, Xamarin.Forms appealed to all WPF developers: the popularity of creating applications for Android and iOS grew, WPF became a relic, a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Self-sufficient controllers on Xamarin.Forms: "Re-use the code to the maximum!". Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/774/134/a41/774134a41de44aaabcd90f2242c1e32e.jpg"><br><br>  Even as an idea, Xamarin.Forms appealed to all WPF developers: the popularity of creating applications for Android and iOS grew, WPF became a relic, and the relevance of WPF developers steadily sought to zero - Forms sounded like salvation.  There is a hope that we, with our knowledge of XAML and MVVM pattern, will be needed by someone.  Of course, initially Xamarin.Forms was raw, with a lot of bugs and the absence of some vital things (remember at least input control without the possibility of specifying maxwith). <br><br>  Three years have passed and Microsoft acquired Xamarin.  Now he delivers it with Visual Studio, and as a result: there are fewer bugs, and more out of the box capabilities.  But one problem remained: applications with a single interface are not obtained native.  That is, if there is a difference in the interfaces of Android and iOS, the developer faces the pain of creating separate ViewModel for each platform ... and these are only flowers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But we at <a href="http://www.mobiledimension.ru/">Mobile Dimension</a> specialize in enterprise applications, and in this case, the unity of the interface is a plus.  Moreover, when a company has many solutions for different purposes, even entire functional controllers (authorization form or product catalog) should look the same. <br><a name="habracut"></a><br>  In such a situation, I want to be able to reuse the code not only in different platforms, but also on different projects.  Accordingly, it is necessary to provide self-sufficiency of the controllers, i.e.  a controller that exists with all its business logic functions, interaction with the REST API, caching, etc. Moreover, such controllers should be independent of the presence of other controllers.  It is necessary to create a situation in which the controller lives its own life and causes (invoke) some events when something happens. <br><br>  Looking ahead, I note that everything looks simple and natural, but this approach came to us after long weeks of code refactoring, where the data layer was initially strongly separated from the interface layer with business logic.  With this classic approach, everything is great: it is clear which module is responsible for what, the threshold for entering a new developer is low.  However, when a project grows to several dozens of controllers, each of which interacts with the others, there are unexpected errors associated with the entanglement of calls to methods of different controllers.  This all eventually led us to the so-called ‚Äúhell of viewmodels‚Äù. <br><br>  It is unraveled thanks to the approach through services and subscriptions to changes in these services.  Those.  we do not focus on the fact that the data layer was completely independent of logic or interface, but on the fact that a particular controller was absolutely indelible from other controllers. <br><br>  Today I will show the simplest example - authorization.  Imagine that we have a REST point for authorization.  We create a controller that can authorize users in all systems in the company.  Its interface is implemented once.  All requirements for styles are indicated in the markup in the authorization controller: <br><br>  <b>Authorization Control Markup</b> <br><pre><code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ActivityIndicator</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.RowSpan</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalOptions</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FillAndExpand"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalOptions</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FillAndExpand"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Red"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IsEnabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IsVisible</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding IsLoading}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IsRunning</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Large"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalOptions</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CenterAndExpand"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalOptions</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CenterAndExpand"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Horizontal"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Entry</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Login, Mode=TwoWay}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalOptions</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CenterAndExpand"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalOptions</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FillAndExpand"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OK"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalOptions</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CenterAndExpand"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding RegisterCommand}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BackgroundColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Red"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TextColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"White"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The imposition of such a controller is the most difficult part of its creation: it is necessary to take into account the fact that it must be adaptive to any container where it may later end up.  Literally beware of any particular value, trying to stretch the content.  Here the Grid will help us with its automatic content stretching by cells and Vertical / HorizontalOptions.  Unfortunately, ViewBox (a control that stretches content) from UWP to Forms has not yet been implemented, however such an initiative was proposed and can be cast on the developers page of Xamarin, where users literally prioritize the features that will be included in the next Xamarin.Forms builds. <br><br>  Then we implement the ViewModel, in which the authorization service method from the business logic is called. <br><br>  <b>ViewModel Registration</b> <br><pre> <code class="xml hljs">IAuthorizationService _authorizationService; public AuthorizationViewModel() { this.RegisterCommand = new Command(async () =&gt; { await Registration(); }); _authorizationService = Core.DI.Container.GetInstance<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IAuthorizationService</span></span></span><span class="hljs-tag">&gt;</span></span>(); } private async Task Registration() { IsLoading = true; await _authorizationService.Login(Login); IsLoading = false; } private string _login; public string Login { get { return _login; } set { _login = value; RaizePropertyChanged(nameof(Login));} } //INotifyPropertyChanged realization</code> </pre> <br>  <b>Using the controller</b> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">local:AuthorizationView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">WidthRequest</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalOptions</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CenterAndExpand"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalOptions</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Center"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  You can subscribe to change this service from anywhere in the application and process it accordingly.  The service is only responsible for the raise. <br><br>  <b>Subscribe to a controller event</b> <br><pre> <code class="xml hljs">var authorizationService = Core.DI.Container.GetInstance<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IAuthorizationService</span></span></span><span class="hljs-tag">&gt;</span></span>(); authorizationService.AuthorizationChanged += AuthorizationService_ AuthorizationChanged;</code> </pre> <br>  This controller can be added to any other place in the project, to any container of any size - it will look good everywhere, because we have taken care of the layout. <br><br>  Read <a href="https://habrahabr.ru/company/mobile_dimension/blog/331196/">in part 2</a> : more complex controllers and their interaction with each other. <br><br>  <a href="https://github.com/MobileDimension/XamarinControllsToolkit">Github link</a> <br><br><img src="https://habrastorage.org/files/131/561/5a0/1315615a06664dabbe582d354fff5bbf.gif" height="400" align="left" alt="image"><img src="https://habrastorage.org/files/a65/250/cb0/a65250cb042442169574b54f2857cf4e.gif" height="400" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/327576/">https://habr.com/ru/post/327576/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327566/index.html">Seven times ALTER one DROP</a></li>
<li><a href="../327568/index.html">Contextual interview. Notes for the design of the study</a></li>
<li><a href="../327570/index.html">DevTools in the browser Vivaldi 1.10.289.3</a></li>
<li><a href="../327572/index.html">Comparison of GPT and MBR partition structures</a></li>
<li><a href="../327574/index.html">Simple and fast C / C ++ server with C # client: TCP version</a></li>
<li><a href="../327578/index.html">How three schoolchildren hacked the source code of Final Fantasy V to localize it</a></li>
<li><a href="../327580/index.html">Microsoft itself</a></li>
<li><a href="../327582/index.html">How does the testing of the developers KOMPAS-3D</a></li>
<li><a href="../327584/index.html">Development: technical task on the site or concept?</a></li>
<li><a href="../327586/index.html">Cheeky telegram bot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>