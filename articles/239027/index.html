<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lumia SensorCore SDK: new opportunities for developing mobile applications. Part 2: Creating the Application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, everyone! 

 In the previous article, we reviewed the Lumia SensorCore SDK and its components, which allow you to create applications that t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lumia SensorCore SDK: new opportunities for developing mobile applications. Part 2: Creating the Application</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/821/247/069/8212470695614f5799e30e9178a43c8c.png"><br><br>  Good day, everyone! <br><br>  In the <a href="http://habrahabr.ru/company/microsoft/blog/238761/">previous article,</a> we reviewed the <b>Lumia</b> <b>SensorCore</b> <b>SDK</b> and its components, which allow you to create applications that track user activity in the minimum power consumption mode. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article, we will look at the <b>practical use of the</b> <a href="http://developer.nokia.com/lumia/nokia-apis/sensorcore">SensorCore SDK</a> to create an application that sends notifications according to the location of the device.  We will discuss the recommendations of working with the new SDK, and see how to generate and use dummy data, as well as API simulators. <br><a name="habracut"></a><br>  As an example of using the <a href="http://developer.nokia.com/lumia/nokia-apis/sensorcore">SensorCore SDK</a> , let's take the idea of ‚Äã‚Äãan application that <b>sends a notification depending on the location of the device</b> .  The <b>Place</b> <b>Monitor</b> <b>API</b> tool is great for this purpose. <br><br>  As described in the previous article, to use applications with the SensoreCore SDK, a device must have certain software and hardware features.  This condition imposes additional requirements for such applications.  For example, it is necessary to <b>develop scenarios for handling situations</b> when the phone does not meet the relevant requirements, but the application is installed on it: <br><br><img src="https://habrastorage.org/files/b0e/bcc/f8d/b0ebccf8d5264eb3883cacb4d45adbd8.jpg" width="254"><br><br>  In another situation, when collecting the necessary information is disabled by the user, <b>quick access to connecting the</b> settings should be provided (Fig. 1-2), as well as a scenario in which the user <b>refuses to connect them</b> (Fig. 3) - for example, the application should stop correctly : <br><br><img src="https://habrastorage.org/files/33b/4ce/6ad/33b4ce6add68484aa785ee9c242b336a.png"><br><br>  Next, consider an example of creating an application using best development practices using the <a href="http://developer.nokia.com/lumia/nokia-apis/sensorcore">SensorCore SDK</a> . <br><br><h3>  Create an application </h3><br>  There are some general guidelines on how to use SensorCore in order to ensure the stability and compatibility of the application with the device on which it will be installed. <br><br>  Below are examples of initialization, error handling, and application lifecycle management: <br><br><ol><li>  Create a <b>Blank App (Windows Phone)</b> project in C # using Visual Studio 2013 (Update 3). <br></li><li>  We are connecting the SensorCore SDK to the project: <b>Tools-&gt; NuGet Package Manager-&gt; Manage NuGet Packages</b> <br><br> <a href="http://http:"><img src="https://habrastorage.org/files/799/056/820/7990568204b9432b97507c043ac23f3e.png"></a> <br><br>  Click <b>Install</b> for all components. <br><br>  Thus in the project links to <b>Lumia</b> libraries were added <b>.</b>  <b>Sense</b> , <b>lumia.</b>  <b>Sense.</b>  <b>Testing</b> and <b>Microsoft</b> <b>Visual</b> <b>C ++ 2013</b> <b>Runtime</b> <b>Package</b> <b>for</b> <b>Windows</b> <b>Phone</b> . <br></li><li>  To access the API, you must declare the SensorCore HID device and the ability to access it in the application manifest. <br><br>  Installing the SDK adds these features to Package.appxmanifest <b>automatically:</b> <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DeviceCapability</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"location"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">m2:DeviceCapability</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"humaninterfacedevice"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">m2:Device</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vidpid:0421 0716"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">m2:Function</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"usage:ffaa 0001"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">m2:Function</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"usage:ffee 0001"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">m2:Function</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"usage:ffee 0002"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">m2:Function</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"usage:ffee 0003"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">m2:Function</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"usage:ffee 0004"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">m2:Device</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">m2:DeviceCapability</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></li><li>  In order for the SDK to work correctly, you need to switch the platform to <b>x86</b> in the Configuration Manager: <b>Build -&gt;</b> <b>Configuration</b> <b>manager</b> <br><br> <a href="http://http:"><img src="https://habrastorage.org/files/ce0/a41/20d/ce0a4120d58d46808b88e6e5de9294f5.png"></a> <br><br>  It should be noted that when testing an application on the device, the <b>Active</b> <b>solution</b> <b>platform</b> should be set to <b>ARM</b> . <br></li><li>  To use the SensoreCore SDK tools, we will connect the following libraries: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows.UI.Popups; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Lumia.Sense; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Lumia.Sense.Testing;</code> </pre><br></li></ol><br><h3>  SensoreCore Initialization </h3><br>  It is not always possible or convenient to work with actual SensorCore API when developing your application: you can <b>test certain</b> application or user interface <b>logic</b> with predefined data, or if you run your application in a Windows Phone emulator, then actual SensorCore interfaces are not available at all.  In such cases, <b>you must use the SensorCore simulator</b> . <br><br>  It is easy to replace the actual SensorCore API with a simulator, just add to the class ‚ÄúSimulator‚Äù identifier: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PlaceMonitor _placeMonitor;=&gt; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PlaceMonitorSimulator _placeMonitor;</code> </pre><br>  But in order to make it easier to switch between the actual class and the class of the simulator, it is most convenient to use an <b>alias for the class</b> , and in the project refer to it with the keyword Monitor. <br>  For example: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//using Monitor = Lumia.Sense.PlaceMonitor; using Monitor = Lumia.Sense.Testing.PlaceMonitorSimulator;</span></span></code> </pre><br><h3>  Initialization of the necessary equipment support </h3><br>  Since the work of the Lumia SensorCore SDK is based on the hardware capabilities of the phone, which not all devices have, the first thing to consider when developing is to <b>check whether the device supports the necessary SensorCore equipment</b> . <br><br>  If there is a scenario for an application in which the use of the SensorCore SDK is not necessary, then it would be nice to adjust the appearance of the UI controls accordingly. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Monitor.IsSupportedAsync())</code> </pre><br>  Note that while the PlaceMonitorSimulator class is being used, the property is not supported, and at this stage the <b>corresponding code must be commented out</b> , but when used in the real API application, it should be activated again: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//if (await Monitor.IsSupportedAsync()) { // Init SensorCore if (await CallSensorcoreApiAsync(async () =&gt; { monitor = await Monitor.GetDefaultAsync(); })) { Debug.WriteLine("PlaceMonitor initialized."); // Update list of known places UpdateKnownPlacesAsync(); HomeButton.IsEnabled = true; WorkButton.IsEnabled = true; FrequentButton.IsEnabled = true; CurrentButton.IsEnabled = true; } else { Application.Current.Exit(); } // Focus on home OnHomeClicked(null, null); } /* else { MessageDialog dialog; dialog = new MessageDialog("Your device doesn't support Motion Data. Some functionality will be disabled", "Information"); dialog.Commands.Add(new UICommand("Ok")); await dialog.ShowAsync(); HomeButton.IsEnabled = false; WorkButton.IsEnabled = false; FrequentButton.IsEnabled = false; }*/</span></span></code> </pre><br><br><h3>  Secure Call Lumia SensorCore SDK </h3><br>  When calling the API, it is important to check that the required settings ( <b>Location data / Motion data</b> ) are turned on and there will be no exception. <br>  To do this, use the <b>wrapper</b> that you need to define when you call the SensorCore SDK and which will take care of such situations: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CallSensorcoreApiAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Func&lt;Task&gt; action</span></span></span><span class="hljs-function">)</span></span> { Exception failure = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> action(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { failure = e; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (failure != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (SenseHelper.GetSenseError(failure.HResult)) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SenseError.LocationDisabled: MessageDialog dialog = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MessageDialog(<span class="hljs-string"><span class="hljs-string">"Location has been disabled. Do you want to open Location settings now?"</span></span>, <span class="hljs-string"><span class="hljs-string">"Information"</span></span>); dialog.Commands.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UICommand(<span class="hljs-string"><span class="hljs-string">"Yes"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> cmd =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> SenseHelper.LaunchLocationSettingsAsync())); dialog.Commands.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UICommand(<span class="hljs-string"><span class="hljs-string">"No"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> dialog.ShowAsync(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Threading.ManualResetEvent(<span class="hljs-literal"><span class="hljs-literal">false</span></span>).WaitOne(<span class="hljs-number"><span class="hljs-number">500</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SenseError.SenseDisabled: dialog = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MessageDialog(<span class="hljs-string"><span class="hljs-string">"Motion data has been disabled. Do you want to open Motion data settings now?"</span></span>, <span class="hljs-string"><span class="hljs-string">"Information"</span></span>); dialog.Commands.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UICommand(<span class="hljs-string"><span class="hljs-string">"Yes"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> cmd =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> SenseHelper.LaunchSenseSettingsAsync())); dialog.Commands.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UICommand(<span class="hljs-string"><span class="hljs-string">"No"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> dialog.ShowAsync(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Threading.ManualResetEvent(<span class="hljs-literal"><span class="hljs-literal">false</span></span>).WaitOne(<span class="hljs-number"><span class="hljs-number">500</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: dialog = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MessageDialog(<span class="hljs-string"><span class="hljs-string">"Failure: "</span></span> + SenseHelper.GetSenseError(failure.HResult), <span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> dialog.ShowAsync(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre><br>  Now the monitor.CallSensorcoreApiAsync wrapper is ready for accessing the SensorCore SDK, so the SDK call is secure. <br><br>  Before using any SensorCore SDK API, you must initialize it with a call to <b>GetDefaultAsync</b> .  Initialization can be accomplished using the shell described above: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> CallSensorcoreApiAsync(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { monitor = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Monitor.GetDefaultAsync(); }))</code> </pre><br>  If the call to the SensorCore APIs fails, the application will stop at this stage. <br><br><h3>  Activation and deactivation of sensors </h3><br>  In Windows XAML applications, <b>the control model is different</b> from Silverlight applications, so connecting and disconnecting sensors is handled differently. <br><br>  Add a handler for the <b>VisibilityChanged</b> event, where we will activate and deactivate PlaceMonitor when the application is sent to the background or when it is in focus again. <br><br>  <b>Windows XAML:</b> <br><br><pre> <code class="cs hljs">Window.Current.VisibilityChanged += <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (oo, ee) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (monitor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ee.Visible) { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> CallSensorcoreApiAsync(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> monitor.DeactivateAsync(); }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> CallSensorcoreApiAsync(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> monitor.ActivateAsync(); }); } } };</code> </pre><br>  <b>For</b> <b>Silverlight</b> <b>applications,</b> <b>do the following:</b> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (monitor == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Initialize(); } <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> monitor.ActivateAsync(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatingFrom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigatingCancelEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> monitor.DeactivateAsync(); }</code> </pre><br><br><h3>  Error processing </h3><br>  All Lumia SensorCore SDK errors cause exceptions, detailed information about which can be obtained using the <b>SenseHelper.GetSenseError ()</b> function <b>.</b> <br><br>  As mentioned above, applications using the SensorCore SDK can also be installed on devices that do not support the SDK functionality. <br>  In such an application, a <b>scenario</b> should be described <b>for the case when none of the data collection sensors is available</b> .  If an application cannot function without the SensorCore SDK, this feature should be indicated <b>in the application description in the</b> <b>Windows</b> <b>Phone Store</b> . <br><br><h3>  Data for testing </h3><br>  Each dummy API has data for processing and playback by default, and is also <b>able to accept recorded data</b> as input. <br><br>  To simulate your own data from the sensor, you can use the SenseRecorder class: <br><br><pre> <code class="cs hljs">PlaceMonitor monitor = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> PlaceMonitor.GetDefaultAsync(); SenseRecorder recorder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SenseRecorder(monitor); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> recorder.StartAsync(); <span class="hljs-comment"><span class="hljs-comment">// ...   ... await recorder.StopAsync(); await recorder.GetRecording().SaveAsync();</span></span></code> </pre><br>  <i>SenseRecording.SaveAsync ()</i> starts viewing the document to display the recorded data and offers to save it in the Documents folder on the phone.  You can retrieve the saved file from this folder by attaching the phone to the computer using Windows Explorer. <br><br>  Next, we link the record with the project, loading it using the <i>SenseRecording.LoadFromFileAsync ()</i> function <i>,</i> and then using the <i>GetDefaultAsync ()</i> function, passing the data to the simulator: <br><br><pre> <code class="cs hljs">SenseRecording recording = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> SenseRecording.LoadFromFileAsync(<span class="hljs-string"><span class="hljs-string">"myData.txt"</span></span>); PlaceMonitorSimulator simulator = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> PlaceMonitorSimulator.GetDefaultAsync(recording);</code> </pre><br>  By default, the entry is configured in such a way that the first event trigger is registered immediately after launch.  If you need to define these records as fixed earlier or later, then for the function <i>GetDefaultAsync ()</i> you can set your own time for the start of the simulator: <br><br><pre> <code class="cs hljs">PlaceMonitorSimulator simulator = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> PlaceMonitorSimulator.GetDefaultAsync(recording, DateTime.Now - TimeSpan.FromDays(<span class="hljs-number"><span class="hljs-number">2</span></span>));</code> </pre><br>  The simulator reproduces the recorded data indefinitely, so that the recording can be used as a two-day history or vice versa, as data that will be received only two days after the launch of the application. <br><br>  It is worth noting that when the application switches to the background, the recording of test data stops and can continue only when activated, since the SenseRecording class does not work in the background. <br><br><h3>  Background task </h3><br>  In the case of the implementation of the idea of ‚Äã‚Äãthis application, it is necessary to use a background task, since the notification from the application that ‚Äúthe user has returned home‚Äù should occur <b>at the entrance to the geofence of the frequently visited place</b> , when the application is not running. <br><br>  To create such a task, there is a standard algorithm: <br><ul><li>  Creating a background task; </li><li>  Announcing it in the application manifest; </li><li>  Register a background task in the app. </li></ul><br>  Let's proceed to its implementation: <br><br>  Add a new <b>Windows</b> <b>Runtime</b> <b>Component</b> project to the solution: <br><br> <a href="http://http:"><img src="https://habrastorage.org/files/9b5/9f0/a39/9b59f0a399ba48c7a3712970c8c2732f.png"></a> <br><br>  Rename the automatically generated Class1.cs to GeofenceBackgroundTask and inherit the IBackgroundTask interface. <br><br>  Do not forget to connect the corresponding namespace: <b>using Windows.ApplicationModel.Background</b> <br><br>  Add the Run method required for any background task to this class: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IBackgroundTaskInstance taskInstance</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   var toastTemplate = ToastTemplateType.ToastText02; var toastXML = ToastNotificationManager.GetTemplateContent(toastTemplate); var textElements = toastXML.GetElementsByTagName("text"); textElements[0].AppendChild(toastXML.CreateTextNode("Welcome again!")); var toast = new ToastNotification(toastXML); ToastNotificationManager.CreateToastNotifier().Show(toast); }</span></span></code> </pre><br>  Add a link to the background task project: <b>right</b> <b>click</b> <b>-&gt; References-&gt; Add Reference</b> <br><br> <a href="http://http:"><img src="https://habrastorage.org/files/733/dd3/b92/733dd3b9275745bab7d678110f354e29.png"></a> <br><br>  Select and click OK. <br><br>  Declare the background task in Package.appxmanifest: <br><br>  On the <b>Declarations-&gt; Available declarations</b> tab <b>: Background Task-&gt; Add</b> <br><br> <a href="http://http:"><img src="https://habrastorage.org/files/244/9e4/de3/2449e4de3ca04104becfbec1cedd3cd2.png"></a> <br><br>  Mark <b>Properties: Location</b> , fill in the <b>Entry point</b> with the name of the class with the namespace: <b>BackgroundTask.GeofenceBackgroundTask.</b> <br><br>  Add the following method to register the background task: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegisterBackgroundTask</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> backgroundAccessStatus = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> BackgroundExecutionManager.RequestAccessAsync(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> geofenceTaskBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BackgroundTaskBuilder() { Name = <span class="hljs-string"><span class="hljs-string">"GeofenceBackgroundTask"</span></span>, TaskEntryPoint = <span class="hljs-string"><span class="hljs-string">"BackgroundTask.GeofenceBackgroundTask"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> trigger = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LocationTrigger(LocationTriggerType.Geofence); geofenceTaskBuilder.SetTrigger(trigger); geofenceTaskBuilder.Register(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { Debug.WriteLine(e); } }</code> </pre><br>  We register the task, for this we call the previous method in the application: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> RegisterBackgroundTask();</code> </pre><br>  As a result, we receive a notification from the application in the background when entering the geo-zone of a frequently visited place: <br><br><img src="https://habrastorage.org/files/771/d81/fcc/771d81fcc53041f58bdebc2a454c8f8d.png" width="226"><br><br><h3>  Conclusion </h3><br>  In addition to the existing capabilities in Windows Phone 8.1, with the Lumia SensorCore SDK, developers <b>get advanced functionality</b> to create applications in which users will be able to receive and analyze information about their vital functions, while <b>consuming the minimum amount of energy from the</b> phone. <br><br>  Developers can apply the experience of using new APIs from already existing <a href="http://developer.nokia.com/resources/library/Lumia/sensorcore-sdk/samples.html">examples of</a> real-world applications, which are also available for download in the Windows Phone Store.  As well as using <a href="http://developer.nokia.com/resources/library/sensorcore-api-ref/index.html">detailed documentation</a> for the new SDK. <br><br><h3>  useful links </h3><br>  <b>Lumia SensorCore SDK:</b> <br><br><ul><li>  <a href="http://www.nuget.org/packages/LumiaSensorCoreSDK/">Download link SDK</a> </li><li>  <a href="http://developer.nokia.com/lumia/nokia-apis/sensorcore">Description Lumia SensorCore SDK</a> </li><li>  <a href="http://developer.nokia.com/resources/library/sensorcore-api-ref/index.html">Detailed documentation: API references</a> </li><li>  <a href="http://developer.nokia.com/resources/library/Lumia/sensorcore-sdk/samples.html">Application examples</a> </li></ul><br>  <a href="http://www.microsoftvirtualacademy.com/">Microsoft Virtual Academy (MVA) Training Courses</a> <br>  <a href="https://dev.windows.com/ru-ru/dashboard">Windows Development Center</a> <br>  <a href="http://aka.ms/getvsrus">Download free or trial Visual Studio 2013</a> <br>  <a href="http://habrahabr.ru/company/microsoft/blog/238761/">Lumia SensorCore SDK: Part 1. Overview</a> </div><p>Source: <a href="https://habr.com/ru/post/239027/">https://habr.com/ru/post/239027/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../239011/index.html">Testing Effort Planning - Report from SQA Days 15</a></li>
<li><a href="../239013/index.html">Caesar III: game loop</a></li>
<li><a href="../239015/index.html">New Ruby Books</a></li>
<li><a href="../239023/index.html">The FLIR One: What can a thermal imager for a phone?</a></li>
<li><a href="../239025/index.html">WebMarkupMin: Minimize KnockoutJS and AngularJS views</a></li>
<li><a href="../239029/index.html">Placebo-buttons in everyday life and in web design</a></li>
<li><a href="../239031/index.html">There is a version of Popcorn Time for iOS</a></li>
<li><a href="../239033/index.html">KolibriOS Digest # 7: how we spent the winter winter</a></li>
<li><a href="../239035/index.html">WoodyMac - the wooden constructor of the future</a></li>
<li><a href="../239037/index.html">Smart antennas help make 5G affordable (part 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>