<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up a proxy on the firmware Tomato</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I will start, perhaps, with the main thing - for which, in fact, I personally need a proxy server. Our provider (I think, like all others) has interna...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up a proxy on the firmware Tomato</h1><div class="post__text post__text-html js-mediator-article"> I will start, perhaps, with the main thing - for which, in fact, I personally need a proxy server.  Our provider (I think, like all others) has internal resources, access to which is possible only from a computer connected to this provider.  Earlier, I used the scheme: white IP at the computer, proxy server (CCProxy) and did not turn off the computer.  The idea that a proxy server could be installed on a router for a long time, since Linux is on routers, the question was only in implementation.  Squid is too heavy for this task, because I need a simple and practical solution, and just recently, I came across one program - <i>srelay</i> , which performs traffic forwarding through HTTP and SOCKS proxies. <br><a name="habracut"></a><br>  So, now let's proceed to setting up the router, in my case it is NETGEAR WNR-3500L-RUS and Tomato firmware (modification of the firmware does not matter).  This article is designed for advanced users and is considered.  that a person already knows how to handle the command line, putty and knows what he is doing. <br><br>  First, you need to make sure that the proxy always works and does not depend on the flash drives on anything else, that is, we will place the program in the memory of the router. , the program for the proxy is enough. <br><br>  So, go to <b>Administration / JFFS</b> , turn on the <b>Enable</b> checkbox and click Format / Erase, wait a while, and click <b>Save</b> . <br>  When the JFFS partition is formatted and mounted, you will have access to the <i>/ jffs</i> folder, then put the <i>srelay</i> program <i>here</i> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To download the program (the file is located by me on my Google site for convenience, already compiled from optware), run the following script in the <b>Tools / System</b> section: <br><br> <code>wget "http://sites.google.com/site/denserru/Home/srelay/srelay?attredirects=0&amp;d=1" -O "/jffs/srelay" <br> chmod +x /jffs/srelay</code> <br> <br>  Now we have the <i>srelay</i> program in the jffs section, which is in the memory of the router, it remains to configure the ports, the autorun program and its parameters. <br>  Program parameters can be seen by the command: <br><br> <code>root@denser-router:/tmp/home/root# /jffs/srelay -h <br> srelay 0.4.6 2003/04/13 (Tomo.M) <br> usage: srelay [options] <br> options: <br> -c file config file <br> -ii/f listen interface IP[:PORT] <br> -m num max child/thread <br> -o min idle timeout minutes <br> -p file pid file <br> -a np auth methods n: no, p:pass <br> -u file srelay password file <br> -f run into foreground <br> -r resolve client name in log <br> -s force logging to syslog <br> -t disable threading <br> -b avoid BIND port restriction <br> -v show version and exit <br> -h show this help and exit <br></code> <br><br>  We will need the following ones: <br><br> <code>/jffs/srelay -i :9999 -t -a pP@ssW0rD</code> <br> <br>  Where 9999 is the port to be used for connection, use any other than the standard one.  <b>P @ ssW0rD</b> replace with the password that will be used for authorization (note the letter <b>p</b> in front of the password), the username when accessing the proxy is root.  Add this line to the <b>Execute When Mounted</b> field so that the program starts when the JFFS partition is initialized with the specified parameters, namely: <br><ul><li>  work on HTTP, SOCKS4 and SOCKS5 protocols </li><li>  authorization on port <b>9999</b> user: <b>root</b> , password: <b>P @ ssW0rD</b> . </li></ul><br>  Approximately it should look like in the end: <br><br><img src="https://habrastorage.org/storage1/c780280e/f1d47d54/de8a3664/720384cc.png"><br><br>  Now, let's add a rule to the <b>Firewall</b> to open port 9999, to do this, switch to the <b>Administration / Scripts</b> section, the <b>Firewall</b> tab, and add the following through the line break: <br><br> <code>iptables -I INPUT -p tcp --dport 9999 -j ACCEPT</code> <br> <br>  It will look something like this: <br><br><img src="https://habrastorage.org/storage1/2a4acad7/e34da1bb/1b88129d/31d3cc3e.png"><br><br>  Now we reboot the router and check the operation of the program using any available method, for example, a browser.  I hope you find this instruction useful to me. <br><br>  It was noticed that after a long work, the program could be closed, for these purposes I put the program <i>monit</i> , but this is the topic of another article. <br><br>  Materials used: <br><br>  1. Sources of the program itself - <a href="http://socks-relay.sourceforge.net/">socks-relay.sourceforge.net</a> <br>  2. Essay on one of the users - <a href="http://www.linksysinfo.org/index.php%3Fthreads/a-socks-proxy-server-for-tomato.23898/">www.linksysinfo.org/index.php?threads/a-socks-proxy-server-for-tomato.23898</a> </div><p>Source: <a href="https://habr.com/ru/post/133984/">https://habr.com/ru/post/133984/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133979/index.html">How do you pronounce python (in Russian)?</a></li>
<li><a href="../133980/index.html">JSF GUI Development Experience</a></li>
<li><a href="../133981/index.html">Memory model in the examples and not only</a></li>
<li><a href="../133982/index.html">Habrahabr - winner ROTOR 2011</a></li>
<li><a href="../133983/index.html">Impressive Solids: making a game in C # under OpenGL, part I</a></li>
<li><a href="../133987/index.html">Choosing a distributed file system for Linux. A few words about Ceph and the rest</a></li>
<li><a href="../133988/index.html">Gingerbread holds 50.51% of the market for Android smartphones</a></li>
<li><a href="../133989/index.html">System of settings and change of versions of programs: evolution of viable forms</a></li>
<li><a href="../133990/index.html">OpenOffice COM Automation: Reading Clipboard Content</a></li>
<li><a href="../133991/index.html">US court rejected Apple‚Äôs claim against Samsung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>