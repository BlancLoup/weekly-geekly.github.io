<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dynamic programming and lazy computing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dynamic programming is a rather important approach in solving many complex problems, based on splitting a task into subtasks and solving these subtask...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dynamic programming and lazy computing</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D0%25BD%25D0%25B0%25D0%25BC%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Dynamic programming</a> is a rather important approach in solving many complex problems, based on splitting a task into subtasks and solving these subtasks once, even if they are part of several other subtasks.  For people who are just beginning to master functional programming, the question often arises: ‚Äú <i>How to avoid re-solving subtasks if you do not use variables to save the results?</i>  ".  In this question, one feature of functional programming ‚Äî the absence of variables ‚Äî makes it difficult to cache the results of solving subtasks, but another feature will help ‚Äî lazy calculations. <br><a name="habracut"></a><br>  Consider the problem of finding watersheds: <br><blockquote>  Given a map of the area, represented by a rectangular matrix of heights (for example, integers).  From each cell, water will drain into one of the neighboring cells (north, east, south, west) with the lowest height if <br>  it is less than the height of this cell.  Otherwise, this cell is called a drain.  It is necessary to mark equally all the cells of the map, the water from which will flow into the same drain. <br></blockquote><br>  Thus, to find the drain of a single cell, you need to find the drain of its neighbor (if it is not a drain itself), and it is clear that water from several different cells can collect and flow along the same route into one drain. <br>  A rather simple recursive algorithm comes to mind: <br><blockquote><pre> drainOf cell = 
   case lowestNeighbourOf cell of
     Nothing ‚Üí cell
     Just nb ‚Üí drainOf nb
</pre></blockquote><br>  But in this case, the drain of each cell will be calculated many times, which can not but depress. <br>  In this case, lazy calculations will help us: their essence is that the expression will not be calculated until its result is needed elsewhere, and after the calculation the result will be reused if necessary. <br>  That's what we need! <br>  The question arises: if in Haskell all (almost) calculations are lazy, then why won't the above code cache intermediate results? <br>  The thing is that the following expression code is different and the function will be called twice! <br><blockquote><pre> print (drainOf cell)
 print (drainOf cell)
</pre></blockquote><br>  But in the following code, the function will be called only once: <br><blockquote><pre> let drain = drainOf cell
 print drain
 print drain
</pre></blockquote><br>  Those.  we need to somehow indicate that we mean the same expressions, then lazy calculations will work for us. <br><blockquote><pre> cells = ((1,1), (width, height))

 altitude :: (int, int) ‚Üí int

 - here it is, an array of drains of all cells!  But it is calculated lazily
 - i.e.  for now this is only a list of calls to the drainOf function, but not its results.
 drains = array cells [(cell, drainOf cell) |  cell ‚Üê range cells]
  
 drainOf cell = 
   case lowestNeighbourOf cell of
     Nothing ‚Üí cell
     Just nb ‚Üí drains!  nb - appeal to the element of the array of stocks
     - here at the first call, the calculation of drainOf will occur,
     - and at the second - the return of the cached result

 lowestNeighbourOf (x, y) =
   let neighbors = filter (inRange cells) [ 
                         (x, y-1), (x + 1, y), (x, y + 1), (x-1, y)]
       lowest = minimumBy (compare`on`altitude) neighbors
   in
       if altitude lowest ‚â• altitude (x, y)
             then Nothing
             else just lowest
</pre></blockquote><br>  That's all, I hope you have become clearer what lazy calculations are. <br><br>  <b>UPD:</b> I decided to add the full program and its output, so as not to be unfounded. <br><blockquote><pre>
 import Data.Array
 import Debug.Trace (trace)
 import Control.Monad (forM_)
 import Data.List (minimumBy, transpose)
 import Data.Function (on)

 - simple data -

 cells = ((1,1), (3,3))

 altitudes = listArray cells $ concat $ transpose [
     [10, 8, 10],
     [15, 3, 15],
     [20, 25, 20]]

 - common functions -

 altitude :: (int, int) ‚Üí int
 altitude cell = altitudes!  cell

 lowestNeighbourOf (x, y) =
   let neighbors = filter (inRange cells) [ 
                         (x, y-1), (x + 1, y), (x, y + 1), (x-1, y)]
       lowest = minimumBy (compare`on`altitude) neighbors
   in
       if altitude lowest ‚â• altitude (x, y)
             then Nothing
             else just lowest

 printArray arr =
     let ((sx, sy), (ex, ey)) = bounds arr
         printRow y = forM_ [sx..ex] (Œª x ‚Üí putStr (show (arr! (x, y)) ++ "\ t"))
     in
         forM_ [sy..ey] (Œª y ‚Üí printRow y "putStrLn" ")

 main = 
   do printArray altitudes
      putStrLn "- drains -------------"
      printArray drains
      putStrLn "- drains ‚Ä≤ ------------"
      printArray drains ‚Ä≤

 - simple recursion -

 drains = array cells [(cell, drainOf cell) |  cell ‚Üê range cells]

 drainOf cell |  trace ("drainOf" ++ show cell) False = undefined
 drainOf cell = 
   case lowestNeighbourOf cell of
     Nothing ‚Üí cell
     Just nb ‚Üí drainOf nb

 - lazy caching -

 drains ‚Ä≤ = array cells [(cell, drainOf ‚Ä≤ cell) |  cell ‚Üê range cells]

 drainOf ‚Ä≤ cell |  trace ("drainOf ‚Ä≤" ++ show cell) False = undefined
 drainOf ‚Ä≤ cell = 
   case lowestNeighbourOf cell of
     Nothing ‚Üí cell
     Just nb ‚Üí drains ‚Ä≤!  nb
</pre></blockquote><br>  Result: <br><blockquote><pre> 10 8 10	
 15 3 15	
 20 25 20	
 - drains -------------
 drainOf (1,1)
 drainOf (2.1)
 drainOf (2.2)
 drainOf (2.1)
 drainOf (2.2)
 drainOf (3.1)
 drainOf (2.1)
 drainOf (2.2)
 (2.2) (2.2) (2.2)	
 drainOf (1,2)
 drainOf (2.2)
 drainOf (2.2)
 drainOf (3.2)
 drainOf (2.2)
 (2.2) (2.2) (2.2)	
 drainOf (1,3)
 drainOf (1,2)
 drainOf (2.2)
 drainOf (2,3)
 drainOf (2.2)
 drainOf (3.3)
 drainOf (3.2)
 drainOf (2.2)
 (2.2) (2.2) (2.2)	
 - drains' ------------
 drainOf '(1,1)
 drainOf '(2,1)
 drainOf (2.2)
 drainOf '(3,1)
 (2.2) (2.2) (2.2)	
 drainOf (1,2)
 drainOf '(3,2)
 (2.2) (2.2) (2.2)	
 drainOf (1,3)
 drainOf (2,3)
 drainOf '(3.3)
 (2.2) (2.2) (2.2)	
</pre></blockquote><br>  As you can see, the first variant calculated the drain of each cell again and again, whereas the second variant did it exactly once. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/130945/">https://habr.com/ru/post/130945/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130935/index.html">How to bypass the security code on ipad2 using the smart cover</a></li>
<li><a href="../130936/index.html">Making Releases with Maven in Java</a></li>
<li><a href="../130937/index.html">Deploy billing for a small network from scratch</a></li>
<li><a href="../130938/index.html">How does knowing MVP help save a startup time and effort?</a></li>
<li><a href="../130943/index.html">Logitech Squeezebox Radio - for those who love radio and the Internet</a></li>
<li><a href="../130946/index.html">Ants AI Challenge. Tutorial novice bosses</a></li>
<li><a href="../130947/index.html">As a web studio does not quarrel with the customer</a></li>
<li><a href="../130949/index.html">Use ResourceLoader in MediaWiki</a></li>
<li><a href="../130951/index.html">Windows 8 early performance tests</a></li>
<li><a href="../130955/index.html">Old-new games. Release 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>