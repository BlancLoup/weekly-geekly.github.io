<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"The most serious opportunity I, of course, consider a multimaster," - Ivan Frolkov on the development of Postgres Pro EE</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dear colleagues, we are glad to offer you the second issue of our new column ‚Äúinterviews with database developers‚Äù. We talked with Ivan Frolkov , the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"The most serious opportunity I, of course, consider a multimaster," - Ivan Frolkov on the development of Postgres Pro EE</h1><div class="post__text post__text-html js-mediator-article"> <i>Dear colleagues, we are glad to offer you the second issue of our new column ‚Äúinterviews with database developers‚Äù.</i>  <i>We talked with <b><a href="http://pgday.ru/ru/2017/speakers/113%3Futm_source%3D_habr%26utm_medium%3Dpost%26utm_campaign%3Dfrolkov">Ivan Frolkov</a></b> , the developer of Postgres Professional.</i>  <i>Ivan has been involved in application development for databases for over 20 years.</i>  <i>Today, Ivan will secure a veil of secrecy and tell about new interesting possibilities of the ‚Äúdomestic Posgres‚Äù, Postgres Pro: EE.</i> <br><br><img src="https://habrastorage.org/web/40a/8c7/260/40a8c7260727482b93829fc2ead4decd.jpg"><br><br>  <b><i>PG Day: Tell me a little, please, how long have you been working on databases and, generally, in a profession, in what roles, and so on.</i></b> <br><a name="habracut"></a><br>  <b>IV</b> : I started to deal with databases, it was 93 years old and we did such a terrible thing as the register of shareholders.  We had then, if anyone remembers, voucher privatization.  We wrote it on a clipper.  Then, in general, there were no special options: Fox Pro, Clipper and, in my opinion, everything. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For some legal reasons, our company was from several branches, which duplicated each other.  I had to exchange information with them.  They also had this register of shareholders written on the clipper.  There were a lot of private individuals, voucher privatization, everything.  What particularly shocked me, the first few screens consisted simply of binary garbage, as if the data files were beating there, there was all sorts of rubbish.  After rubbish there were just empty fields, and then names, surnames and patronymic began.  I then asked myself: how much can we trust what seems normal to us, having just such garbage at the very beginning?  This was the first I had a sound judgment - was the year 94th.  Then I went to work at a company that served the Ministry of Finance of the Russian Federation.  I was responsible for maintaining the register of auditors of the Russian Federation, then there were registries, certificates, licenses to perform audit operations.  We had SQL Server 6.0, 6.5, 7.0 and Delphi. <br><br>  Then I poflanilstvuyu somewhat.  Then I ended up in Mail.Ru.  I did postcards, newsletters, answers.  After Mail.Ru engaged in startups.  Everything was connected to databases in one form or another.  In the end, I was also in a kind of startup, but professional.  I‚Äôm doing PostgresSQL databases, mostly query optimization and writing various documents, which, frankly speaking, made me very tired. <br><br>  <b><i>PG Day: you say that you are engaged in query optimization.</i></b>  <b><i>What do you mean by that?</i></b>  <b><i>What is Postgres Pro responsible for there?</i></b>  <b><i>As far as I know, certain patches, versions ideologically invented by you</i> .</b> <br><br>  <b>IV</b> : Ideologically, I walked for a long time and screamed that Postgres had very bad partitioning.  Finally, sectioning was done, and I, naturally, drove it from earlier versions.  Now it shows itself very well.  Only two very critical things remain: there are no global indices and there are no separate partitioned indexes.  And it does not work well with the number of sections over 20-30 thousand.  The bases are now large, and I would like to have hundreds of thousands, up to a million sections for very large volumes.  The guys are trying, I go and Noah, they write.  I hope to somehow influence. <br><br>  The second thing I influenced was the alienable tables.  Perhaps, I invented them, and realized Nastya Lubennikova, thank her very much for that.  The idea is that on one server, you can prepare a table with data, ‚Äúprovacuum‚Äù it, build indexes, statistics, disconnect and connect to another server already ready. <br><br>  I am directly involved in integration with applications.  The only thing I can say for <b>.net</b> I do not write, fortunately or unfortunately.  I come across <b>Java</b> , <b>PHP</b> .  And I still fall down "Here we have a request, it would be necessary to somehow overclock it."  I overclock it.  I was also given improvised guys.  Guys smart, I like.  Here we are overclocking. <br><br>  <b><i>PG Day: At the upcoming PG Day you are going to read a very detailed master class about the Enterprise version of Postgres Pro that you are developing.</i></b>  <b><i>How did it happen that it is you who are reading this master class, which is dedicated to the functionality of this version?</i></b>  <b><i>And my second question: is it really so full of new features that it is worthy of a master-class for hours?</i></b> <br><br>  <b>IV</b> : I have always considered myself an application programmer.  Not the one who writes the DBMS, but the one who uses it.  I think that the master class will be focused primarily on people who write the code directly.  Not the code that is in the DBMS, but when Marya Ivanna comes in and says ‚ÄúI clicked something and everything disappeared‚Äù. <br><br>  How interesting is the version to the developer?  Yes, there are very interesting opportunities.  I already mentioned alienable tables.  This task arose from the requirements of a single client, who periodically dumped data at such a speed that he simply did not have time to insert them into the database.  Hence the requirement of a large number of sections in the table, for very large amounts of data. <br><br>  Also, from my point of view, we made a very small and very pleasant pg_variables module.  These are session variables.  They live during the session and locally for the session.  In general, on the one hand, there is nothing supernatural.  On the other hand, for some reason this has not yet been done.  This, in particular, is also critical for users who are migrating from Oracle, because there are batch variables there.  In Postgres, this is not so good. <br><br>  The third thing: we are actively developing <b>multimaster</b> .  This is really a true multimaster.  Generally speaking, I considered quite a lot of any money, not specifically the banking ‚Äúoperden‚Äù the notorious, but billing and other things.  The owner or management is eager to know exactly what is happening with money and how.  Therefore, I deal with issues of transactional integrity and consistent data representation with great attention.  In our master it is really provided.  He is really a master-master.  Everything works fine.  There is no quackery there.  To resolve conflicts, you have to roll back a transaction that could not be executed. <br><br>  Now he pulled up nicely, right before his eyes is improving.  This was shown by the story with one of our clients, he has a rather catchy logic in hibernate.  He cannot say about some transactions whether they are reading or writing.  His task worked fine, and it worked on the multimaster 2.5 times faster than on the bare vanilla Postgres. <br><br>  <b><i>PG Day: Yes, it sounds very impressive.</i></b>  <b><i>You mentioned the problem of resolving conflicts between nodes, that the transaction is rolled back, and so on.</i></b>  <b><i>It always seemed to me that the operation of the multimaster implies that there will be problems and they need to be somehow solved: to intervene manually in order to restore normal functioning</i> .</b> <br><br>  <b>IV</b> : In this case, when performing multimaster operations, <b>synchronous replication</b> actually occurs and then an honest, perfectly normal <b>two-phase commit</b> .  Yes, it is heavier than the usual commit, no one argues.  But, on the other hand, in the case of a large number of readings, this gives a gain, because there we get at least three ‚Äúnodes‚Äù in the multimaster and, accordingly, the reading performance <b>increases three times</b> .  Yes, I should note that it is very relevant for such cases, the JDBC driver allows you to list different servers in the connection string.  That is, in case of failure, for example, it can automatically reconnect. <br><br>  He may be behind the net performance of vanilla, still need to synchronize with other servers.  Naturally, this imposes some restrictions.  But, on the other hand, we get it really working, disaster-proof solution. <br><br>  Another possibility is the <b>compression of tables</b> , which are focused mainly on reading.  True, there is another kind of vacuum, called the garbage collector.  For example, most of the huge tables that I came across are, in fact, append-only tables.  State structures, for example.  They have an event, they register them.  There are many events, but the event has occurred, and it is unchanged.  And in this case, data compression basically gives a noticeable gain on I / O.  Here even we are not talking about the size of the disk, because the disks are now large, but then we are winning very much on reading, on input-output. <br><br>  <b><i>PG Day: Do you have any feature of the enterprise version, which is your personal favorite?</i></b> <br><br>  <b>IV</b> : Oddly enough, I like the most from the point of view that I have to sit down and write code for something, the simple pg_variables.  It is no claims, but convenient.  The most serious opportunity I, of course, consider a multimaster. <br><br>  <b><i>PG Day: As far as I remember, in terms of the master class that you stated, there was an item about nested transactions and autonomous transactions.</i></b>  <b><i>Briefly tell what you have planned on this issue?</i></b> <br><br>  <b>IV</b> : The first possibility using autonomous transactions, which is usually required, is <b>logging</b> .  The user performs such and such an operation, all of a sudden he rollback occurs, all data is lost.  Maybe he wants to do something bad and it would be nice to take this into account.  With autonomous transactions, we can register this operation within individual transactions, completely independent of the main operation.  There is still such a subtle point when nothing can be done without this autonomous transaction or without an external application.  For example, I ran into this when it was necessary to send bitcoins. <br><br><img align="left" width="400" src="https://habrastorage.org/web/1b4/51b/e3c/1b451be3cbfb44a28154cf9e7e132244.jpg">  What is the situation in bitcoins?  There is a global ledger book, a blockchain is called, transactions are written into it: from such an account such an amount of money.  Absolutely standard.  Everything is a little trickier, but for simplicity, let's assume that this is so.  The problem is that the transaction becomes true when it is confirmed by other participants in the exchange.  That is, when we send a transaction, we do not know whether it has passed or not.  We sent money, and it is possible that they will need to be re-sent.  On this may run once a month, suppose.  We perform the operation of sending money, and then the transaction took and rolled back.  Yes, we are honest people, we will not do double-spending, but it‚Äôs somehow strange to be laid in the code for an honest word, so we cannot roll it back, nor check whether it has passed or not. <br><br>  <b>The two-phase commit</b> does not work out for obvious reasons, and if we could check, then we could implement the idempotency property that we sent already, and we will no longer.  That is, as a result, we don‚Äôt know the result of the execution.  We can send only once and hope that everything will be fine.  In the framework of the DBMS, we can not do it.  When a transaction is rolled back, from the point of view of the application programmer, it seems like there was nothing, so, on the one hand, we have to fix the fact of payment attempt, and on the other, everything is lost during rollback. <br><br>  <b><i>PG Day: Without third-party help no longer understand.</i></b> <br><br>  <b>IV</b> : If we do this from an application program, we can open a second connection and attempt to send to register with a separate transaction.  And first we register what we are trying to send, and then send.  Inside a DBMS without autonomous transactions, this is unfortunately impossible to do.  With autonomous transactions, this is completely realizable.  What else?  This is the second task that arises - to avoid re-execution of canceled operations. <br><br>  I will also talk about the interesting possibility of <b>scheduler</b> - the execution of tasks on a schedule.  It is available from pl / pgsql, so you can call queries, plus it is still interesting in tasks.  You can send a task for execution.  What is interesting in our sheduler?  Our tasks may depend on one another.  That is, such a task will not be completed before others are completed. <br><br>  <b><i>PG Day: that is, already some kind of business logic can be programmed in this way.</i></b> <br><br>  <b>IV</b> : Yes, if you remember, I had ordered messages in <b>mbus</b> . <br>  That's just the implementation of the same logic.  That is, we can carry out a certain operation in several steps.  In case it fails, we must, again, roll it back in a few steps.  For him, now they make the user interface, let's see what happens.  So far, it is available only in the API. <br><br>  <i><b>PG Day: sounds very impressive, a lot of interesting things.</b></i>  <i><b>We have some participants expressed skepticism that it would not be just a marketing report, where you will tell that all these features are very cool.</b></i>  <i><b>Do you plan any practice, examples, so that participants can make sure that this is really cool?</b></i>  <i><b>Can we expect a demonstration with illustrative examples?</b></i> <br><br>  <b>IV</b> : I am planning.  I do not plan to distribute the Postgres Pro EE version, but I will show everything on my computer.  On the topic of what cool features, I will naturally tell.  Why then tell at all if it were bad? <br><br>  The master class will be interesting especially for people and organizations that are really thinking about using our product.  I hope that this seminar will be useful for exactly in order to dispel any fears, to show new opportunities, and maybe even to demonstrate problems that are not yet recognized. <br><br>  If I wanted to do marketing, I would first of all say that we have a FSTEC license, and for one customer we made a project with a secrecy of ‚Äústate secret‚Äù.  Yes, not everyone needs it - even, perhaps, very few people, but who needs it - those really need it.  In addition, we can process personal data at the highest level (‚ÄúGroup 1 - special categories of personal data, which include information about the nationality and race of the subject, religious, philosophical or political beliefs, information about the health and intimate life of the subject‚Äù).  For medicine, this limitation may well be critical.  If I were engaged in marketing, I would tell this.  Because for a number of applications, these are simply killer requirements.  But I will not. <br><br>  <i><b>PG Day: What would you advise to beginners DBA, what technology to look at, whose articles and blogs to read?</b></i> <br><br>  <b>IF</b> : <br>  1. Carefully read the book Architecture of a Database System. <br>  2. No less attentively to study the documentation for the used DBMS. <br>  3. To study the basics of accounting.  First, it is just purely practical, and secondly, it will be clear where the requirements for the DBMS came from ... <br>  4. Keep track of all major DBMS, the benefit of their little. <br>  5. I highly recommend that you familiarize yourself with them - first of all with Oracle and DB2, especially since this will be enough for a long time - things are very serious. <br><br>  I personally read the Postgres mailing lists, but I don‚Äôt think this is a must-read for everyone. <br><br>  <b><i>PGDay: And in conclusion, in terms of use for work and in personal life, what operating systems, applications and technology do you use?</i></b> <br><br>  <b>IV</b> : Nothing unexpected - at home I have an old laptop with Windows 10, otherwise my wife and daughter will not understand, and the little traveling one with ubuntu is a plus, home for there because of ubuntu there, in principle, will not go, everything is mine.  At work - the usual Debian.  From applications - the most important application for a programmer is Word (or Libre Office), as is well known;  and so - vi, psql, pgAdmin3 and Netbeans - I got used to it. <br><br>  <i>Development of a new fork is a large-scale task.</i>  <i>Unfortunately, we could not fit all the details about domestic development in the framework of a 30-minute conversation.</i>  <i>Friends, be sure to ask your questions, Ivan and his colleagues will be very happy.</i>  <i>Well, we are in a hurry to invite everyone in to <a href="http://pgday.ru/ru/2017%3Futm_source%3D_habr%26utm_medium%3Dpost%26utm_campaign%3Dfrolkov">PG Day'17 Russia</a> .</i>  <i>Ivan will hold a workshop <b><a href="http://pgday.ru/ru/2017/request/registration%3Futm_source%3Dhabr%26utm_medium%3Dpost%26utm_campaign%3Dfrolkov%26talkId%3D131">Postgres Pro Enterprise for developers</a></b> , in which he will tell in detail about the fork options that have already been mentioned in the interview, and many others.</i>  <i>You will also find many interesting reports from Ivan‚Äôs colleagues: Oleg Bartunov, Alexander Korotkov, Ivan Panchenko, and other Postgres Professional specialists.</i> <i><br><br></i>  <i>See you at <a href="http://pgday.ru/ru/2017/request/registration%3Futm_source%3D_habr%26utm_medium%3Dpost%26utm_campaign%3Dfrolkov"><b>PG Day'17 Russia</b></a> !</i> </div><p>Source: <a href="https://habr.com/ru/post/328442/">https://habr.com/ru/post/328442/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328430/index.html">New tools for organizing effective teamwork</a></li>
<li><a href="../328432/index.html">How we published an iOS video chat app on the App Store</a></li>
<li><a href="../328434/index.html">Explore RxJava 2 for Android</a></li>
<li><a href="../328436/index.html">Bash scripts, part 11: expect and automate interactive utilities</a></li>
<li><a href="../328440/index.html">Do I need to experiment in the development process?</a></li>
<li><a href="../328444/index.html">ONTAP 9.2: new functionality</a></li>
<li><a href="../328446/index.html">Cellular communication even in the taiga: three generations of mobile base stations</a></li>
<li><a href="../328448/index.html">29 reports DotNext 2017 Piter: From .NET Standard and containers to security and performance</a></li>
<li><a href="../328450/index.html">Implementation of simultaneous scrolling in all directions</a></li>
<li><a href="../328452/index.html">United Dev Conf 2017: results and useful materials</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>