<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Smart home, as I sunk to such. Part 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first part, we figured out why everything was needed and how I had come to this, and in the second part we talked about software. It is time to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Smart home, as I sunk to such. Part 3</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/cfd/ecf/d82/cfdecfd826bd53ffa4567990ab9e8cad.png" align="right"><br>  In the <a href="http://habrahabr.ru/post/158911/">first</a> part, we figured out why everything was needed and how I had come to this, and in the <a href="http://habrahabr.ru/post/167797/">second part we</a> talked about software.  It is time to dwell on the most favorite habravchanami section DIY - on the gland.  So, we take textolite, ferric chloride, a soldering iron ... But no, stop, open the board editor.  About a soldering iron, where to put it, and where better it is not necessary, others will tell me better.  And I will tell you what boards and sensors work for the benefit of my smart home. <br><br><a name="habracut"></a><br><br><h4>  Tire </h4><br>  I use a four-wire telephone cable as a bus. <br>  All cables are crimped plugs TP6P4C (RJ11). <br><img src="https://habrastorage.org/getpro/habr/post_images/1a1/f9d/4a5/1a1f9d4a58ebcf844d360a14f72575e3.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/473/2c6/359/4732c6359964f8a38c79fd880b839941.jpg"><br>  Connections and branches occur via standard telephone connectors and splitters. <br><img src="https://habrastorage.org/getpro/habr/post_images/f63/d97/05e/f63d9705e996dec25a4aceb0eaf6069e.jpg"><br>  Pinout made in accordance with the first purchased cards 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  (green) - 12V </li><li>  (white) - 1-wire data </li><li>  (brown) - ground </li><li>  (yellow) - not used </li></ol><br>  In the first boards I purchased, the 4th contact was not used and, accordingly, did not switch in the end devices, therefore, it remained unused.  In some schemes, 18V is supplied to the fourth contact.  But, if I did everything from scratch, then I let 5V in there to power the thermal sensors. <br><br><h4>  Thermal Sensors DS18B20 </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/3e4/f0b/f26/3e4f0bf26c0dcc20a99863dd622d252d.jpg"><br>  Not knowing about the features of working on parasitic power (blocking the bus from 0.3 to 1.5 seconds when prompted), I just connected pin 1 to ground, and pin 2 to 1-wire. <br>  Now I add new sensors in places where there are other boards from which you can take 5V.  In the future, I want to equip old sensors with power conversion circuits and power them correctly. <br>  Thus, the ‚Äúcorrect‚Äù connection scheme looks like this: <br><ul><li>  Leg 1 - ground </li><li>  Leg 2 - to 1-wire bus </li><li>  Leg 3 - 5V </li></ul><br><br><h4>  DS2413 boards </h4><br>  As I said earlier, I bought the first boards.  I bought them here <a href="http://www.ab-log.ru/smart-house/1-wire-modules/2ch-module">www.ab-log.ru/smart-house/1-wire-modules/2ch-module</a> <br>  The only disadvantage of this board, at that time, was the lack of transit of the fourth line, but now it has been fixed and it is present.  As a pleasant feature, you can note the presence of LEDs, which is very convenient for debugging.  On my boards I was too lazy to do wiring for LEDs, so I had to be debugged with a tester. <br>  Schemes of the first homemade boards were peeped here <a href="http://www.benuks.ru/oborud.html">www.benuks.ru/oborud.html#9</a> <br><div class="spoiler">  <b class="spoiler_title">Scheme</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/9d1/1fb/d85/9d11fbd85038cc55153983d702f318e2.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Pay</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/fe8/ffb/019/fe8ffb0190a571d502f806a2f848ff31.png"></div></div><br>  Actually, according to the functionality, they are completely identical to the purchased ones and are a dual-channel switch for controlling the load 220V. <br><br><h4>  DS2408 boards </h4><br>  There was already where to turn fantasy. <br>  The idea of ‚Äã‚Äãthe first board on the DS2408 arose when I did the lighting in the kitchen.  I wanted to make four independent zones of lighting and circuit boards on the DS2413, it would take two pieces.  As a result, the scheme was born on the DS2408 which, in fact, differed only in the replicated MOC3043M + BT138 groups.  He brought all eight, three, so to speak, for future development.  (Unfortunately, the scheme was not preserved.) <br><br>  The following two boards on the DS2408 were read only data.  The first one receives data from the opening sensors of all windows and the door to the loggia, the second one receives data from door locks and motion sensors in the common corridor and near the door. <br><div class="spoiler">  <b class="spoiler_title">Scheme</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/8f3/dcc/408/8f3dcc408e57df365029cf2e20578707.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Pay</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/8f8/1e5/e5a/8f81e5e5a50d6d3b010ba038441840d0.png"></div></div><br><br>  When I started messing around with the DS2408, I got the idea to make one combined board per room.  Depending on the needs of a particular room in control systems, one board is distributed on the DS2408 where some of the contacts are responsible for managing the load, and some for reading the data.  For example, for the bathroom and the nursery, boards were made with the ability to control two sources and read data from six. <br><div class="spoiler">  <b class="spoiler_title">Scheme</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/4e8/7ad/ca9/4e87adca93cf4760348d4104b9f8333a.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Pay</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/027/cf6/bfb/027cf6bfb55181350a4b4d71b1cf9f70.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Appearance of the finished board</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/31a/fc5/827/31afc58272e0bca2d5f9011deb84c40a.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/fd8/b79/c19/fd8b79c19944963709459a6dcab244f3.jpg"></div></div>  Two control outputs are the first and second group of light bulbs.  Two readers are data from two switches, one motion sensor, one door sensor, two in reserve. <br>  I want to note that there is one serious shortcoming in this board, which complicates installation and maintenance.  I brought to the terminals only one pin 5V, 12V, GND, and, for example, contacts 5V, are needed in each sensor.  I had to connect several wires to one, which is inconvenient and unreliable. <br><br><h5>  Constructor </h5><br>  Experienced readers already know this, and attentive, probably, have already noticed that all schemes have some common modules.  Actually, having understood this, one can quite easily design a chamber for one‚Äôs own needs, knowing, in essence, only a course of electricity from the school curriculum. <br><br>  Let's analyze in detail on the basis of my last board, since it contains all these conditional modules. <br><img src="https://habrastorage.org/getpro/habr/post_images/77a/dff/444/77adff444315b3cd3535cc0f39575b60.png"><br><ol><li>  Connectors </li><li>  Power module </li><li>  Chip 1-wire with strapping </li><li>  Reading module </li><li>  Control module </li></ol><br><h5>  Connectors </h5><br>  You can just draw conclusions to the board and hang up the connectors on the wires (in the purchase cards it was exactly like that), but it seemed to me not very convenient, and in the following boards I soldered these: <br><img src="https://habrastorage.org/getpro/habr/post_images/766/7ad/2bd/7667ad2bd30bff79bd7845956c161fb1.jpg"><br><br><h5>  Power module </h5><br>  The main component here is the 78L05 chip, a wonderful thing that, from any input voltage in the range from 7V to 20V, gives us the necessary 5V. <br><img src="https://habrastorage.org/getpro/habr/post_images/98a/faa/748/98afaa748c56001701dc1fdde035493e.png"><br>  It happens in different cases, it just so happened that there were always different types available and I had to use all types. <br><br><ul><li>  Vin - 12V </li><li>  GND - land </li><li>  Vout - to board power </li></ul><br><br>  The auxiliary elements are fitted with a piping of capacitors (two solid-state and one electrolytic) for stabilization. <br><br><h5>  Chip 1-wire with strapping </h5><br>  The chip itself. <br><img src="https://habrastorage.org/getpro/habr/post_images/e8c/469/c93/e8c469c938814b666d64c87fb48df637.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/d4c/eca/073/d4ceca0738dcf91b95bfb93c5952b44d.jpg"><br>  In this case, the DS2408 is connected as follows: <br><ul><li>  Leg 3 - 5V </li><li>  Leg 4 - to 1-wire bus </li><li>  Leg 5 - land </li><li>  Legs 2, 7, 8, 9, 11, 12, 13, 14 - bidirectional input / output, that is, the very legs to which the reading or control modules are connected, depending on what we need </li></ul><br>  The pull-up resistor and the zener diode were on the source board and in the documentation for the chip, I do not know their exact purpose. <br><br><h5>  Reading module </h5><br>  It's actually just contacting the legs with a connector for ease of installation plus a pull-up resistor (without it, even very weak pickups can generate enough voltage for a false positive) <br><br><h5>  Control module </h5><br>  It consists of two main elements: the optocoupler MOC3043M and the simistor BT138. <br>  The optocoupler is needed for electrical isolation (so that the 220V network is not connected in any way and does not affect the control network). <br><img src="https://habrastorage.org/getpro/habr/post_images/abc/555/395/abc5553950813cf85ea9d2732aa25724.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/574/ff5/1d1/574ff51d164a3d90898be61f4dea8cd9.jpg"><br><ul><li>  Leg 1 - 5V </li><li>  Leg 2 - to exit 1-wire </li><li>  Leg 4 - to the triac </li><li>  Leg 6 - 220V </li></ul><br>  Principle of operation: when the value 1 appears in the corresponding register of DS2408, the corresponding leg is connected to ground.  In the circuit from the leg 1 to the leg 2, a current begins to flow, a diode lights up inside, and closes the circuit between the legs 4 and 6, applying voltage to the triac. <br><br>  A triac is needed to control the load with AC power, since the optocoupler itself cannot hold a high load. <br><img src="https://habrastorage.org/getpro/habr/post_images/e52/417/38e/e5241738ed4b15e8baf87c7becc19284.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/eda/e33/a50/edae33a5059c6361605458a3c50fa432.jpg"><br><ul><li>  Leg 1 - 220V </li><li>  Leg 2 - load output </li><li>  Leg 3 - from optocouplers </li></ul><br>  The principle of operation is similar to that of a transistor in a circuit with direct current, when voltage is applied to leg 3, the circuit between legs 1 and 2 is closed <br><br><h4>  Door and window opening sensors </h4><br>  As I wrote earlier, as opening sensors, I used unmarked Soviet reed switches plus neodymium magnets of 1x10 mm. <br>  The wiring diagram is simple to ugliness, one contact per 5V second per contact read on the board. <br>  If I did not have reed switches with magnets, I would buy, for example, such sensors: <br><img src="https://habrastorage.org/getpro/habr/post_images/90b/5b7/99e/90b5b799e5c1f7e0189a060cf206d155.jpg"><br>  In fact, these are the same reed switches and magnets, only packed in a case. <br><br><h4>  Motion sensors. </h4><br>  As a motion sensor, you can use almost any security motion sensor, as long as it can be powered from 12V and switch 5V (and most of them).  In stores, you need to ask the security sensor, since, if you say about lighting control, you will slip a sensor that 220V switches and is powered by them, and such a sensor, without dancing with a tambourine, cannot be connected to the system in question. <br><img src="https://habrastorage.org/getpro/habr/post_images/542/a66/7df/542a667df45f9e166d9b4ff8cbe24be4.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/0af/d00/5d2/0afd005d29a6256d6a969ea4b63556fb.jpg"><br>  The sensors usually have seven contacts, for the needs of the smart home I used four of them <br><ul><li>  T2, T1 - tamper contacts, which are responsible for unauthorized opening.  In my case, I did not connect, as unnecessary. </li><li>  NC, C, NO - sensor contacts.  I used normally open contact NO and C. They connect to 5V and read contact on the board, respectively. </li><li>  -12V + - sensor power supply.  It's all clear. </li></ul><br><br><h4>  Leakage sensors </h4><br>  As the experiment showed, if two contacts (5V + contact reading from the board) are inserted into the water, the contact is considered closed, so it does not bother.  The old Soviet telephone "noodles" with partially exposed (along the entire length from different sides) wires, and that's the whole leakage sensor. <br><img src="https://habrastorage.org/getpro/habr/post_images/5ed/67d/290/5ed67d290a50b42de4200f387a1827fb.jpg"><br><br><h4>  Connecting classic switches </h4><br>  I have not taken root pushbutton switches (which are returned), because in rooms where there are several light sources with a group of switches and only a part is turned on, it is problematic to turn off the remaining ones, since the household does not have a logical connection to the button-lamp in the brain. <br>  I have the usual keyboards.  Down-&gt; off, up-&gt; on.  If the light was previously turned on or off by a computer, you need to click back there.  But in any case, if you need to turn off, then the end position of all switches at the bottom and vice versa. <br>  The switch is connected to the gap between 5V and the readout contact on the board. <br><br><h4>  Backup power circuit </h4><br>  Let me remind you that the inclusion of light occurs as follows: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d37/0a7/45c/d370a745cd8db30bd6bbe5f26deea8cd.png"><br><br>  One of the main drawbacks of such a system with centralized control is that when the central node (server) fails, the control of the light becomes impossible.  You can, of course, transfer the on / off logic to the board with the controller, but on the 1-wire base this is not possible.  Therefore, for such emergency cases, I added a small switch connected in parallel with the electronic key.  The switch is located on the case in which the board is packed.  In the event of an accident (by the way, such an accident occurred immediately after the release of the first part of the article), you can forcibly close the circuit using a switch, this is certainly not very inconvenient, but the light is still present during the server repair. <br><br><h4>  CCTV </h4><br>  There is already no iron DIY, but probably worth mentioning. <br>  For video capture, I used the cheapest, at that time, ORIENT SDVR-404 board. <br><img src="https://habrastorage.org/getpro/habr/post_images/75a/d37/295/75ad37295757c5b794f141d078b3afc6.jpg"><br>  At that moment it seemed that more than one camera was not needed.  There are three cameras now.  And I‚Äôd better take a board with four processors instead of one. <br>  The cameras are Chinese noname, but, in principle, they are enough for my needs. <br><img src="https://habrastorage.org/getpro/habr/post_images/450/c91/251/450c912516726dd5902d2ab8f5f6e097.jpg"><br><br><h4>  Conclusion </h4><br>  That's all iron.  As you can see, nothing complicated, scary or mysterious.  I hope my articles came in handy to you and may have made me build my system. <br><br>  <i>Special thanks to all those who wrote to me, asked questions and asked for the continuation, without you this part could not be.</i> <br><br>  Update: <br>  Laid out source boards in github <br>  <a href="https://github.com/sashacmc/smarthome-1wire">github.com/sashacmc/smarthome-1wire</a> <br><br>  Update 2: <br>  Continued here: <a href="https://geektimes.ru/post/289273/">Smart home, as I have come to this.</a>  <a href="https://geektimes.ru/post/289273/">Part 4</a> </div><p>Source: <a href="https://habr.com/ru/post/198842/">https://habr.com/ru/post/198842/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../198830/index.html">Yandex has learned to recognize and combine a series of images.</a></li>
<li><a href="../198832/index.html">Highscreen Omega Prime Mini: ‚Äúweekly‚Äù smartphone with five color panels (announcement! No review)</a></li>
<li><a href="../198836/index.html">An example of using a static analyzer</a></li>
<li><a href="../198838/index.html">20 free add-ons for Visual Studio</a></li>
<li><a href="../198840/index.html">Google-calendar as a replacement for a blackboard with leaves</a></li>
<li><a href="../198844/index.html">Fujitsu Servers: Autumn Update</a></li>
<li><a href="../198850/index.html">The technical task: why the wording ‚ÄúMake as here‚Äù does not work?</a></li>
<li><a href="../198854/index.html">From the creators of Indexisto - ‚ÄúSearch for Habr II‚Äù</a></li>
<li><a href="../198856/index.html">FailConf-2013: conference on errors in IT business</a></li>
<li><a href="../198858/index.html">Universal Electronic Card (UEC) and its future</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>