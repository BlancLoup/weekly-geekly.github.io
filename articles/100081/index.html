<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Maintaining a balance between functionality and compatibility when developing an application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Android application developers, who are oriented when developing to all released devices, are surely familiar with this scheme: 



 On July 1, 2010, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Maintaining a balance between functionality and compatibility when developing an application</h1><div class="post__text post__text-html js-mediator-article"><img src="http://3.bp.blogspot.com/_GTM_W5mVPTU/TDubc_TmyeI/AAAAAAAAAIM/f8WzYnjSEac/s400/cute.jpg" alt="image"><br><br>  Android application developers, who are oriented when developing to all released devices, are surely familiar with this scheme: <br><br><img src="http://3.bp.blogspot.com/_GTM_W5mVPTU/TDuZX7I2-PI/AAAAAAAAAH8/1tSYEfsZHbA/s400/versions.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      On July 1, 2010, this was the statistics of the running Android versions.  With the release of new versions of Android, developers began to think: add new features to the application, provided by the new version, or make it available on as many devices as possible. <br><br>  Experienced developers have already made sure that these two options are mutually exclusive, and maintaining a balance between them can be painful.  In this article I will show you that this is not the case. <br><a name="habracut"></a><br>  A few weeks ago, in our article, we looked at how to handle multitouch on Android 2.0 (Eclair) and above, by getting a simple demo application at the end.  In this article we will remake our application so that it works correctly on all versions, up to Android 1.5.  You can get the source code of the old application on <a href="http://code.google.com/p/android-touchexample/">Google Code</a> . <br><br><h4>  Problems in the manifest </h4><br>  The <b>uses-sdk tag</b> in AndroidManifest.xml can be specified with two parameters: <b>minSdkVersion</b> and <b>targetSdkVersion</b> .  With this you can say that the application is ready to work on older versions, but at the same time it can work on new ones.  Now you can use new SDKs for development.  But if you use the functionality of the new platform directly, this is what you can see in the system logs: <br><br><blockquote><code>E/dalvikvm(  792): Could not find method android.view.MotionEvent.getX, referenced from method com.example.android.touchexample.TouchExampleView.onTouchEvent <br> W/dalvikvm(  792): VFY: unable to resolve virtual method 17: Landroid/view/MotionEvent;.getX (I)F <br> W/dalvikvm(  792): VFY:  rejecting opcode 0x6e at 0x0006 <br> W/dalvikvm(  792): VFY:  rejected Lcom/example/android/touchexample/TouchExampleView;.onTouchEvent (Landroid/view/MotionEvent;)Z <br> W/dalvikvm(  792): Verifier rejected class Lcom/example/android/touchexample/TouchExampleView; <br> D/AndroidRuntime(  792): Shutting down VM <br> W/dalvikvm(  792): threadid=3: thread exiting with uncaught exception (group=0x4000fe70)</code> <br> </blockquote><br><br>  We incorrectly specified <b>minSdkVersion</b> , and here it is the result.  We developed our application on SDK 8 (Froyo), but leaving the parameter <b>minSdkVersion = ‚Äù3‚Äù</b> (Cupcake), we would say to the application that we are aware of our intentions, and we will not ask for the impossible.  If we leave everything as it is - our users with old versions of the SDK will see an ugly error message.  Of course, mobs of offended users will rate your application in the Market for 1 star.  To avoid this, we must make secure access to the functions of the new platform without angry checks on older versions of the system. <br><br><img src="http://1.bp.blogspot.com/_GTM_W5mVPTU/TDuZhUtehSI/AAAAAAAAAIE/lurNNKAy_qU/s1600/error.png" alt="image"><br><br><h4>  Reflection method </h4><br>  Many developers are already familiar with the practice of solving this problem with the help of reflection.  Reflection allows the code to interact with the runtime environment and determine when target methods or classes exist, and call them, or create an instance without touching them directly. <br><br>  The perspective of requests for functions of other platforms, either purposefully or conditionally referring to reflections, is not good.  This is ugly.  It is slow.  This is cumbersome.  First of all, its intensive use in code will turn it into garbage that is inconvenient for further support.  What if I say that there is a way to write apps for Android 1.5 (Cupcake) using 2.2 (Froyo) using one code and not using reflections? <br><br><h4>  Delayed loading </h4><br>  Researcher Bill Pugh published and distributed a method of writing singletones in Java with all the advantages of using deferred loading of ClassLoaders.  <a href="http://en.wikipedia.org/wiki/Singleton_pattern">A</a> Wikipedia <a href="http://en.wikipedia.org/wiki/Singleton_pattern">material</a> explaining this method.  The code looks like this: <br><br><blockquote> <code><font color="#0000ff">public</font> <font color="#0000ff">class</font> Singleton <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#666666">// Private constructor prevents instantiation from other classes</font> &lt;br/&gt; <br> <font color="#0000ff">private</font> Singleton <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">{</font> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#ff0000">/**&lt;br/&gt; <br> * SingletonHolder     Singleton.getInstance() &lt;br/&gt; <br> *     SingletonHolder.INSTANCE,  .&lt;br/&gt; <br> */</font> &lt;br/&gt; <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">class</font> SingletonHolder <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final Singleton INSTANCE <font color="#000080">=</font> <font color="#0000dd">new</font> Singleton <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> Singleton getInstance <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> SingletonHolder. <font color="#007788">INSTANCE</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#008000">}</font></code> </blockquote> <br><br>  A very important part of his work is described in the comments.  Java classes are loaded and initialized at the first access - it creates for the first time instances of a class or gets access to a method or one of its static fields.  This is important for us because the classes are checked by the virtual machine only when they are loaded, not before.  Now we have everything to write Android applications without using the reflection method. <br><br><h4>  Compatibility Design </h4><br>  As it turned out, in practice it is quite simple.  As a rule, you want your application to degrade correctly on older versions of the platform, removing some functions, or developing alternative ones.  Since the Android functionality is only related to the API version, you only have one thing that you should keep track of when designing compatibility. <br><br>  In most cases, this support option can be implemented as a simple class hierarchy.  You can design your application to access version-sensitive functions using a version-independent interface or abstract classes.  A subclass in an interface designed to run on new versions of the platform can support new system capabilities, and subclasses designed to run on older versions of the platform should provide application functionality in alternative ways. <br><br><h4>  Putting principles into practice </h4><br>  At the beginning of this article, I said that we will redo the previously created application for working with multitouch from API version 3 (Cupcake) to version 8 (Froyo).  In a previously published article, I noted that <b>GestureDetectors</b> is a useful model for abstracting the processing of sensor events.  Then I did not understand how quickly it is implemented and tested.  We can remake version-dependent elements of the demo application and implement all of this with the abstract <b>GestureDetector</b> . <br><br>  Before we get started, we must change our manifest to declare API version 3 support using <b>minSdkVersion</b> in the <b>uses-sdk</b> tag.  Keep in mind that we are still focused on version 8, this should also be noted in the <b>targetSdkVersion</b> parameter of your manifest.  Now our manifesto will look like this: <br><br><blockquote> <code><a href="http://schemas.android.com/apk/res/android%2522"></a> <font color="#009900"><font color="#000000">&lt;?xml</font> <font color="#000066">version</font> = <font color="#ff0000">"1.0"</font> <font color="#000066">encoding</font> = <font color="#ff0000">"utf-8"</font> <font color="#000000">?&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;manifest</font> <font color="#000066">xmlns:android</font> = <font color="#ff0000">"schemas.android.com/apk/res/android"</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000066">package</font> = <font color="#ff0000">"com.example.android.touchexample"</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000066">android:versionCode</font> = <font color="#ff0000">"1"</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000066">android:versionName</font> = <font color="#ff0000">"1.0"</font> <font color="#000000">&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;application</font> <font color="#000066">android:icon</font> = <font color="#ff0000">"@drawable/icon"</font> <font color="#000066">android:label</font> = <font color="#ff0000">"@string/app_name"</font> <font color="#000000">&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;activity</font> <font color="#000066">android:name</font> = <font color="#ff0000">".TouchExampleActivity"</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000066">android:label</font> = <font color="#ff0000">"@string/app_name"</font> <font color="#000000">&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;intent-filter <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;action</font> <font color="#000066">android:name</font> = <font color="#ff0000">"android.intent.action.MAIN"</font> <font color="#000000">/&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;category</font> <font color="#000066">android:name</font> = <font color="#ff0000">"android.intent.category.LAUNCHER"</font> <font color="#000000">/&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;/intent-filter <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;/activity <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;/application <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;uses-sdk</font> <font color="#000066">android:minSdkVersion</font> = <font color="#ff0000">"3"</font> <font color="#000066">android:targetSdkVersion</font> = <font color="#ff0000">"8"</font> <font color="#000000">/&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;/manifest <font color="#000000">&gt;</font></font></font></code> </blockquote> <br><br>  Our <b>TouchExampleView</b> class <b>is</b> not compatible with Android versions up to Froyo due to the use of the <b>ScaleGestureDetector</b> , and is not compatible with versions below Eclair due to the use of the new <b>MotionEvent</b> method that reads data from a multitouch.  We must abstract this functionality into classes that will not be loaded on versions that do not support this functionality.  To do this, we will create a new class, call it <b>VersionedGestureDetector</b> . <br><br>  In the example application, the user has 2 gestures available, dragging and dragging (scale).  Therefore, <b>VersionedGestureDetector</b> must define two events: <b>onDrag</b> and <b>onScale</b> .  <b>TouchExampleView</b> should receive an instance of the <b>VersionedGestureDetector</b> class corresponding to the platform version, filter incoming events through it, and respond accordingly to <b>onDrag</b> and <b>onScale</b> . <br><br>  The first version of <b>VersionedGestureDetector</b> will be: <br><br><blockquote> <code><font color="#0000ff">public</font> abstract <font color="#0000ff">class</font> VersionedGestureDetector <font color="#008000">{</font> &lt;br/&gt; <br> OnGestureListener mListener <font color="#008080">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#0000ff">public</font> abstract boolean onTouchEvent <font color="#008000">(</font> MotionEvent ev <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#0000ff">public</font> interface OnGestureListener <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onDrag <font color="#008000">(</font> <font color="#0000ff">float</font> dx, <font color="#0000ff">float</font> dy <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onScale <font color="#008000">(</font> <font color="#0000ff">float</font> scaleFactor <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#008000">}</font></code> </blockquote> <br><br>  First, the application starts with the simplest functionality, focused on Cupcake.  For simplicity in this example, we will implement support for each version using a static inner class in the <b>VersionedGestureDetector</b> .  Of course, you can do this the way you want, while using the delayed load technique shown above, or equivalent.  Do not touch classes that directly use functionality that is not supported by this version of the platform. <br><br><blockquote> <code><font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">class</font> CupcakeDetector extends VersionedGestureDetector <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">float</font> mLastTouchX <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">float</font> mLastTouchY <font color="#008080">;</font> &lt;br/&gt; <br> @Override&lt;br/&gt; <br> <font color="#0000ff">public</font> boolean onTouchEvent <font color="#008000">(</font> MotionEvent ev <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">switch</font> <font color="#008000">(</font> ev. <font color="#007788">getAction</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">case</font> MotionEvent. <font color="#007788">ACTION_DOWN</font> <font color="#008080">:</font> <font color="#008000">{</font> &lt;br/&gt; <br> mLastTouchX <font color="#000080">=</font> ev. <font color="#007788">getX</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> mLastTouchY <font color="#000080">=</font> ev. <font color="#007788">getY</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">break</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#0000ff">case</font> MotionEvent. <font color="#007788">ACTION_MOVE</font> <font color="#008080">:</font> <font color="#008000">{</font> &lt;br/&gt; <br> final <font color="#0000ff">float</font> x <font color="#000080">=</font> ev. <font color="#007788">getX</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> final <font color="#0000ff">float</font> y <font color="#000080">=</font> ev. <font color="#007788">getY</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> mListener. <font color="#007788">onDrag</font> <font color="#008000">(</font> x <font color="#000040">-</font> mLastTouchX, y <font color="#000040">-</font> mLastTouchY <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> mLastTouchX <font color="#000080">=</font> x <font color="#008080">;</font> &lt;br/&gt; <br> mLastTouchY <font color="#000080">=</font> y <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">break</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#008000">}</font></code> </blockquote> <br><br>  This is a simple implementation of the organization of an <b>onDrag</b> event when the pointer moves around the screen.  The values ‚Äã‚Äãthat it takes are equal to the traversed path pointer for X and Y. <br><br>  Starting with the Eclair version, we must clearly track the pointer identifier to prevent the appearance of additional pointers that go beyond the screen.  The basic implementation of <b>onTouchEvent</b> in <b>CupcakeDetector</b> can track pointer movements, but with two tricks.  We must add the <b>getActiveX</b> and <b>getActiveY methods</b> to get the corresponding coordinates and redefine them in the <b>EclairDetector</b> to get the correct coordinates of the pointer. <br><blockquote> <code>&lt;br/&gt; <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">class</font> CupcakeDetector extends VersionedGestureDetector <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">float</font> mLastTouchX <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">float</font> mLastTouchY <font color="#008080">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#0000ff">float</font> getActiveX <font color="#008000">(</font> MotionEvent ev <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> ev. <font color="#007788">getX</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#0000ff">float</font> getActiveY <font color="#008000">(</font> MotionEvent ev <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> ev. <font color="#007788">getY</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> @Override&lt;br/&gt; <br> <font color="#0000ff">public</font> boolean onTouchEvent <font color="#008000">(</font> MotionEvent ev <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">switch</font> <font color="#008000">(</font> ev. <font color="#007788">getAction</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">case</font> MotionEvent. <font color="#007788">ACTION_DOWN</font> <font color="#008080">:</font> <font color="#008000">{</font> &lt;br/&gt; <br> mLastTouchX <font color="#000080">=</font> getActiveX <font color="#008000">(</font> ev <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> mLastTouchY <font color="#000080">=</font> getActiveY <font color="#008000">(</font> ev <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">break</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#0000ff">case</font> MotionEvent. <font color="#007788">ACTION_MOVE</font> <font color="#008080">:</font> <font color="#008000">{</font> &lt;br/&gt; <br> final <font color="#0000ff">float</font> x <font color="#000080">=</font> getActiveX <font color="#008000">(</font> ev <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> final <font color="#0000ff">float</font> y <font color="#000080">=</font> getActiveY <font color="#008000">(</font> ev <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> mListener. <font color="#007788">onDrag</font> <font color="#008000">(</font> x <font color="#000040">-</font> mLastTouchX, y <font color="#000040">-</font> mLastTouchY <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> mLastTouchX <font color="#000080">=</font> x <font color="#008080">;</font> &lt;br/&gt; <br> mLastTouchY <font color="#000080">=</font> y <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">break</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#008000">}</font></code> </blockquote> <br><br>  Now <b>EclairDetector</b> , redefined by new <b>getActiveX</b> and <b>getActiveY methods</b> .  Most of this code should be familiar to you from the original example described at the beginning of the article. <br><blockquote> <code>&lt;br/&gt; <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">class</font> EclairDetector extends CupcakeDetector <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">int</font> INVALID_POINTER_ID <font color="#000080">=</font> <font color="#000040">-</font> <font color="#0000dd">1</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">private</font> <font color="#0000ff">int</font> mActivePointerId <font color="#000080">=</font> INVALID_POINTER_ID <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">private</font> <font color="#0000ff">int</font> mActivePointerIndex <font color="#000080">=</font> <font color="#0000dd">0</font> <font color="#008080">;</font> &lt;br/&gt; <br> @Override&lt;br/&gt; <br> <font color="#0000ff">float</font> getActiveX <font color="#008000">(</font> MotionEvent ev <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> ev. <font color="#007788">getX</font> <font color="#008000">(</font> mActivePointerIndex <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> @Override&lt;br/&gt; <br> <font color="#0000ff">float</font> getActiveY <font color="#008000">(</font> MotionEvent ev <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> ev. <font color="#007788">getY</font> <font color="#008000">(</font> mActivePointerIndex <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> @Override&lt;br/&gt; <br> <font color="#0000ff">public</font> boolean onTouchEvent <font color="#008000">(</font> MotionEvent ev <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> final <font color="#0000ff">int</font> action <font color="#000080">=</font> ev. <font color="#007788">getAction</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">switch</font> <font color="#008000">(</font> action <font color="#000040">&amp;</font> MotionEvent. <font color="#007788">ACTION_MASK</font> <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">case</font> MotionEvent. <font color="#007788">ACTION_DOWN</font> <font color="#008080">:</font> &lt;br/&gt; <br> mActivePointerId <font color="#000080">=</font> ev. <font color="#007788">getPointerId</font> <font color="#008000">(</font> <font color="#0000dd">0</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">break</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">case</font> MotionEvent. <font color="#007788">ACTION_CANCEL</font> <font color="#008080">:</font> &lt;br/&gt; <br> <font color="#0000ff">case</font> MotionEvent. <font color="#007788">ACTION_UP</font> <font color="#008080">:</font> &lt;br/&gt; <br> mActivePointerId <font color="#000080">=</font> INVALID_POINTER_ID <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">break</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">case</font> MotionEvent. <font color="#007788">ACTION_POINTER_UP</font> <font color="#008080">:</font> &lt;br/&gt; <br> final <font color="#0000ff">int</font> pointerIndex <font color="#000080">=</font> <font color="#008000">(</font> ev. <font color="#007788">getAction</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#000040">&amp;</font> MotionEvent. <font color="#007788">ACTION_POINTER_INDEX_MASK</font> <font color="#008000">)</font> &lt;br/&gt; <br> <font color="#000080">&gt;&gt;</font> MotionEvent. <font color="#007788">ACTION_POINTER_INDEX_SHIFT</font> <font color="#008080">;</font> &lt;br/&gt; <br> final <font color="#0000ff">int</font> pointerId <font color="#000080">=</font> ev. <font color="#007788">getPointerId</font> <font color="#008000">(</font> pointerIndex <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">if</font> <font color="#008000">(</font> pointerId <font color="#000080">==</font> mActivePointerId <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#666666">// This was our active pointer going up. Choose a new</font> &lt;br/&gt; <br> <font color="#666666">// active pointer and adjust accordingly.</font> &lt;br/&gt; <br> final <font color="#0000ff">int</font> newPointerIndex <font color="#000080">=</font> pointerIndex <font color="#000080">==</font> <font color="#0000dd">0</font> <font color="#008080">?</font> <font color="#0000dd">1</font> <font color="#008080">:</font> <font color="#0000dd">0</font> <font color="#008080">;</font> &lt;br/&gt; <br> mActivePointerId <font color="#000080">=</font> ev. <font color="#007788">getPointerId</font> <font color="#008000">(</font> newPointerIndex <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> mLastTouchX <font color="#000080">=</font> ev. <font color="#007788">getX</font> <font color="#008000">(</font> newPointerIndex <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> mLastTouchY <font color="#000080">=</font> ev. <font color="#007788">getY</font> <font color="#008000">(</font> newPointerIndex <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#0000ff">break</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> mActivePointerIndex <font color="#000080">=</font> ev. <font color="#007788">findPointerIndex</font> <font color="#008000">(</font> mActivePointerId <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> super. <font color="#007788">onTouchEvent</font> <font color="#008000">(</font> ev <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#008000">}</font></code> </blockquote> <br>  <b>EclairDetector</b> calls <b>super.onTouchEvent</b> after determining the pointer ID, runs <b>CupcakeDetector</b> to determine the drag event.  Multiplatform should not be a reason for code duplication. <br><br>  Finally, let's add the <b>ScaleGestureDetector</b> , which will implement support for the scaling gesture for Froyo.  In order to avoid moving during scaling, we need to add a few changes to the <b>CupcakeDetector</b> .  Some touchscreens have scaling issues, so we need to take this into account. <br>  We will add the method <b>shouldDrag</b> to <b>CupcakeDetector</b> which will check before sending the <b>onDrag</b> event. <br><br>  The final version of <b>CupcakeDetector</b> : <br><br><blockquote> <code><font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">class</font> CupcakeDetector extends VersionedGestureDetector <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">float</font> mLastTouchX <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">float</font> mLastTouchY <font color="#008080">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#0000ff">float</font> getActiveX <font color="#008000">(</font> MotionEvent ev <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> ev. <font color="#007788">getX</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#0000ff">float</font> getActiveY <font color="#008000">(</font> MotionEvent ev <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> ev. <font color="#007788">getY</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> &lt;br/&gt; <br> boolean shouldDrag <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> @Override&lt;br/&gt; <br> <font color="#0000ff">public</font> boolean onTouchEvent <font color="#008000">(</font> MotionEvent ev <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">switch</font> <font color="#008000">(</font> ev. <font color="#007788">getAction</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">case</font> MotionEvent. <font color="#007788">ACTION_DOWN</font> <font color="#008080">:</font> <font color="#008000">{</font> &lt;br/&gt; <br> mLastTouchX <font color="#000080">=</font> getActiveX <font color="#008000">(</font> ev <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> mLastTouchY <font color="#000080">=</font> getActiveY <font color="#008000">(</font> ev <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">break</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#0000ff">case</font> MotionEvent. <font color="#007788">ACTION_MOVE</font> <font color="#008080">:</font> <font color="#008000">{</font> &lt;br/&gt; <br> final <font color="#0000ff">float</font> x <font color="#000080">=</font> getActiveX <font color="#008000">(</font> ev <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> final <font color="#0000ff">float</font> y <font color="#000080">=</font> getActiveY <font color="#008000">(</font> ev <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#0000ff">if</font> <font color="#008000">(</font> shouldDrag <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> mListener. <font color="#007788">onDrag</font> <font color="#008000">(</font> x <font color="#000040">-</font> mLastTouchX, y <font color="#000040">-</font> mLastTouchY <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> &lt;br/&gt; <br> mLastTouchX <font color="#000080">=</font> x <font color="#008080">;</font> &lt;br/&gt; <br> mLastTouchY <font color="#000080">=</font> y <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">break</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#008000">}</font></code> </blockquote> <br><br>  <b>EclairDetector</b> remains unchanged.  <b>FroyoDetector</b> below.  <b>shouldDrag</b> should return a positive value while inactive scaling. <br><br><blockquote> <code><font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">class</font> FroyoDetector extends EclairDetector <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">private</font> ScaleGestureDetector mDetector <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">public</font> FroyoDetector <font color="#008000">(</font> Context context <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> mDetector <font color="#000080">=</font> <font color="#0000dd">new</font> ScaleGestureDetector <font color="#008000">(</font> context,&lt;br/&gt; <br> <font color="#0000dd">new</font> ScaleGestureDetector. <font color="#007788">SimpleOnScaleGestureListener</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> @Override <font color="#0000ff">public</font> boolean onScale <font color="#008000">(</font> ScaleGestureDetector detector <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> mListener. <font color="#007788">onScale</font> <font color="#008000">(</font> detector. <font color="#007788">getScaleFactor</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#008000">}</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> @Override&lt;br/&gt; <br> boolean shouldDrag <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> <font color="#000040">!</font> mDetector. <font color="#007788">isInProgress</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> @Override&lt;br/&gt; <br> <font color="#0000ff">public</font> boolean onTouchEvent <font color="#008000">(</font> MotionEvent ev <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> mDetector. <font color="#007788">onTouchEvent</font> <font color="#008000">(</font> ev <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> super. <font color="#007788">onTouchEvent</font> <font color="#008000">(</font> ev <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#008000">}</font></code> </blockquote> <br><br>  Now we have a gesture detector implementation, now we have to find a way to create it.  Let's create the <b>VersionedGestureDetector</b> method. <br><br><blockquote> <code><font color="#0000ff">public</font> <font color="#0000ff">static</font> VersionedGestureDetector newInstance <font color="#008000">(</font> Context context,&lt;br/&gt; <br> OnGestureListener listener <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> final <font color="#0000ff">int</font> sdkVersion <font color="#000080">=</font> Integer. <font color="#007788">parseInt</font> <font color="#008000">(</font> Build. <font color="#007788">VERSION</font> . <font color="#007788">SDK</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> VersionedGestureDetector detector <font color="#000080">=</font> null <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">if</font> <font color="#008000">(</font> sdkVersion <font color="#000080">&lt;</font> Build. <font color="#007788">VERSION_CODES</font> . <font color="#007788">ECLAIR</font> <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> detector <font color="#000080">=</font> <font color="#0000dd">new</font> CupcakeDetector <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> <font color="#0000ff">else</font> <font color="#0000ff">if</font> <font color="#008000">(</font> sdkVersion <font color="#000080">&lt;</font> Build. <font color="#007788">VERSION_CODES</font> . <font color="#007788">FROYO</font> <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> detector <font color="#000080">=</font> <font color="#0000dd">new</font> EclairDetector <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> <font color="#0000ff">else</font> <font color="#008000">{</font> &lt;br/&gt; <br> detector <font color="#000080">=</font> <font color="#0000dd">new</font> FroyoDetector <font color="#008000">(</font> context <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> detector. <font color="#007788">mListener</font> <font color="#000080">=</font> listener <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> detector <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font></code> </blockquote> <br><br>  Since we focus on Cupcake, we still do not have access to <b>Build.VERSION.SDK_INT</b> .  Instead, we should use the now outdated <b>Build.VERSION.SDK</b> . <br><br>  Our <b>VersionedGestureDetector is</b> ready, now we need to combine it with <b>TouchExampleView</b> , which has become much shorter. <br><br><blockquote> <code><font color="#0000ff">public</font> <font color="#0000ff">class</font> TouchExampleView extends View <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">private</font> Drawable mIcon <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">private</font> <font color="#0000ff">float</font> mPosX <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">private</font> <font color="#0000ff">float</font> mPosY <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">private</font> VersionedGestureDetector mDetector <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">private</font> <font color="#0000ff">float</font> mScaleFactor <font color="#000080">=</font> <font>1. <font color="#007788">f</font></font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">public</font> TouchExampleView <font color="#008000">(</font> Context context <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000dd">this</font> <font color="#008000">(</font> context, null, <font color="#0000dd">0</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#0000ff">public</font> TouchExampleView <font color="#008000">(</font> Context context, AttributeSet attrs <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000dd">this</font> <font color="#008000">(</font> context, attrs, <font color="#0000dd">0</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#0000ff">public</font> TouchExampleView <font color="#008000">(</font> Context context, AttributeSet attrs, <font color="#0000ff">int</font> defStyle <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> super <font color="#008000">(</font> context, attrs, defStyle <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> mIcon <font color="#000080">=</font> context. <font color="#007788">getResources</font> <font color="#008000">(</font> <font color="#008000">)</font> . <font color="#007788">getDrawable</font> <font color="#008000">(</font> R. <font color="#007788">drawable</font> . <font color="#007788">icon</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> mIcon. <font color="#007788">setBounds</font> <font color="#008000">(</font> <font color="#0000dd">0</font> , <font color="#0000dd">0</font> , mIcon. <font color="#007788">getIntrinsicWidth</font> <font color="#008000">(</font> <font color="#008000">)</font> , mIcon. <font color="#007788">getIntrinsicHeight</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> mDetector <font color="#000080">=</font> VersionedGestureDetector. <font color="#007788">newInstance</font> <font color="#008000">(</font> context, <font color="#0000dd">new</font> GestureCallback <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> @Override&lt;br/&gt; <br> <font color="#0000ff">public</font> boolean onTouchEvent <font color="#008000">(</font> MotionEvent ev <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> mDetector. <font color="#007788">onTouchEvent</font> <font color="#008000">(</font> ev <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> @Override&lt;br/&gt; <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onDraw <font color="#008000">(</font> Canvas canvas <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> super. <font color="#007788">onDraw</font> <font color="#008000">(</font> canvas <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> canvas. <font color="#007788">save</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> canvas. <font color="#007788">translate</font> <font color="#008000">(</font> mPosX, mPosY <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> canvas. <font color="#007788">scale</font> <font color="#008000">(</font> mScaleFactor, mScaleFactor <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> mIcon. <font color="#007788">draw</font> <font color="#008000">(</font> canvas <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> canvas. <font color="#007788">restore</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#0000ff">private</font> <font color="#0000ff">class</font> GestureCallback implements VersionedGestureDetector. <font color="#007788">OnGestureListener</font> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onDrag <font color="#008000">(</font> <font color="#0000ff">float</font> dx, <font color="#0000ff">float</font> dy <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> mPosX <font color="#000040">+</font> <font color="#000080">=</font> dx <font color="#008080">;</font> &lt;br/&gt; <br> mPosY <font color="#000040">+</font> <font color="#000080">=</font> dy <font color="#008080">;</font> &lt;br/&gt; <br> invalidate <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onScale <font color="#008000">(</font> <font color="#0000ff">float</font> scaleFactor <font color="#008000">)</font> <font color="#008000">{</font> &lt;br/&gt; <br> mScaleFactor <font color="#000040">*</font> <font color="#000080">=</font> scaleFactor <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#666666">// Don't let the object get too small or too large.</font> &lt;br/&gt; <br> mScaleFactor <font color="#000080">=</font> Math. <font color="#007788">max</font> <font color="#008000">(</font> <font>0.1f</font> , Math. <font color="#007788">min</font> <font color="#008000">(</font> mScaleFactor, <font>5.0f</font> <font color="#008000">)</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> invalidate <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br> <font color="#008000">}</font></code> </blockquote> <br><br><h4>  Conclusion </h4><br>  So we adapted our application to work correctly on Android 1.5 through the best new features provided by the platform, and without a single use of reflections.  The same principles can be applied to any new Android feature, allowing your application to run on older versions of Android: <br><ul><li>  <b>ClassLoader</b> loads classes deferred by checking them on first access. </li><li>  Functionality and interface, depending on the version of the platform. </li><li>  A version-dependent implementation based on the platform-specific version at runtime.  This eliminates the <b>ClassLoader</b> from using classes that cannot be implemented correctly. </li></ul><br><br>  To see the final version - visit the ‚ÄúCupcake‚Äù section on <a href="http://code.google.com/p/android-touchexample/">Google Code</a> . <br><br><h4>  Additional Information </h4><br>  In this example, we did not offer an alternative path for the user, using the OS, released before Froyo, <b>since the ScaleGestureDetector</b> became available only in 2.2.  For real applications, we would suggest an alternative way.  Traditionally, Android phones have hard zoom buttons.  The <a href="http://developer.android.com/reference/android/widget/ZoomControls.html">ZoomControls</a> and <a href="http://developer.android.com/reference/android/widget/ZoomButtonsController.html">ZoomButtonsController classes</a> will help you implement this path.  Realization of this will be an exercise for the reader. </div><p>Source: <a href="https://habr.com/ru/post/100081/">https://habr.com/ru/post/100081/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../100075/index.html">WTF is a SuperColumn? Introduction to the Cassandra Data Model</a></li>
<li><a href="../100076/index.html">Introducing the fastest VP8 decoder in the world: ffvp8</a></li>
<li><a href="../100077/index.html">Solar drone set a new record - 2 weeks in the air</a></li>
<li><a href="../100078/index.html">Definition of IP geography - are there accurate services?</a></li>
<li><a href="../100080/index.html">IPad Emulator</a></li>
<li><a href="../100084/index.html">Interesting board for ASUS HTPC</a></li>
<li><a href="../100085/index.html">AmbilightUSB</a></li>
<li><a href="../100086/index.html">Share - the first ever open source repository</a></li>
<li><a href="../100087/index.html">Efika mx</a></li>
<li><a href="../100089/index.html">Web store</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>