<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Solving the puzzle Galakub on Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the new year I bought my puzzle nephew Galakub. The task is to assemble a cube of 4x4x4 size from different parts. The total amount of parts, just...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Solving the puzzle Galakub on Python</h1><div class="post__text post__text-html js-mediator-article">  For the new year I bought my puzzle nephew Galakub.  The task is to assemble a cube of 4x4x4 size from different parts.  The total amount of parts, just, 4x4x4.  Before giving it was necessary to assemble a puzzle.  A beautiful symmetrical solution was found quickly enough.  But it became interesting only this decision or not.  Intuition suggested that the only thing, but I wanted to check. <br><img src="https://habrastorage.org/files/9bf/74e/247/9bf74e2473ea4910a27c6586356c9709.JPG"><br><br>  I decided to quickly sip the script to iterate through all the options.  Ideally, it was necessary to catch up to Putin‚Äôs New Year‚Äôs speech.  The situation was aggravated by the fact that the code was written on the MacBook of my parents.  Putting some libraries on it is a bigger job than writing the program itself. <br><br>  The code turned out to be surprisingly beautiful and understandable.  It is convenient to explain.  Maybe the text will be useful, for example, to learn Python. <br><a name="habracut"></a><br>  All the parts were represented as 4x4x4 tensors. <br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zero_vector</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span>] * <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zero_matrix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [zero_vector() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zero_tensor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [zero_matrix() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>)]</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The cube is coded with the letter ‚ÄúQ‚Äù, the corner is encoded with the letter ‚ÄúJ‚Äù, and the blockhead is ‚ÄúZ‚Äù. <br><img src="https://habrastorage.org/files/1b9/534/add/1b9534add3904536bf8dbc81625fa20e.JPG"><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_tensor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> tensor = zero_tensor() lines = data.splitlines() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">2</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): line = lines[z * <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span> + y] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> line[x] == <span class="hljs-string"><span class="hljs-string">'*'</span></span>: tensor[z][y][x] = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tensor J = parse_tensor(<span class="hljs-string"><span class="hljs-string">""" ***. *... .... .... ***. *... .... .... """</span></span>) Q = parse_tensor(<span class="hljs-string"><span class="hljs-string">""" **.. **.. .... .... **.. **.. .... .... """</span></span>) Z = parse_tensor(<span class="hljs-string"><span class="hljs-string">""" *... *... .... .... *... ***. .**. .... """</span></span>) &gt;&gt;&gt; J [[[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]], [[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]], [[<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]], [[<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]]]</code> </pre><br>  To make it easier to look at tensors (and you will need to look at them a lot and carefully), the show_tensor function of the inverse function parse_tensor was written: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show_tensor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): value = tensor[z][y][x] <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> { <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-string"><span class="hljs-string">'*'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-string"><span class="hljs-string">'.'</span></span> }[value], <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show_tensors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensors)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tensor <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tensors: show_tensor(tensor) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> &gt;&gt;&gt; show_tensors([J, Q, Z]) * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * . . * * . . . . . . . . . . * * . . * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * . . . * . . . . . . . . . . . * . . . * * * . . . . . . . . . . . . . . * * . . . . . . . . . . . . . . . . . . . . . . . . .</code> </pre><br>  Next you had to generate all possible positions for each part.  Rotation along the X and Y axis by 90 degrees is reduced to a permutation of the axes. <br><img src="https://habrastorage.org/files/7f3/a09/a6b/7f3a09a6ba9d463ba7dabc7140df1557.JPG"><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rotate_by_x</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor)</span></span></span><span class="hljs-function">:</span></span> rotated = zero_tensor() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): rotated[z][y][x] = tensor[y][-z - <span class="hljs-number"><span class="hljs-number">1</span></span>][x] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rotated <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rotate_by_y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor)</span></span></span><span class="hljs-function">:</span></span> rotated = zero_tensor() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): rotated[z][y][x] = tensor[x][y][-z - <span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rotated</code> </pre><br>  In order not to duplicate the cycles, you can start the function transform_tensor, it will come in handy more than once: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transform_tensor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor, function)</span></span></span><span class="hljs-function">:</span></span> transformed = zero_tensor() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): transformed[z][y][x] = function(tensor, x, y, z) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> transformed <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rotate_by_x</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> transform_tensor(tensor, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> _, x, y, z: _[y][-z - <span class="hljs-number"><span class="hljs-number">1</span></span>][x]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rotate_by_y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> transform_tensor(tensor, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> _, x, y, z: _[x][y][-z - <span class="hljs-number"><span class="hljs-number">1</span></span>])</code> </pre><br>  Let's see what happens: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply_transformation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor, transformation, times=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(times): tensor = transformation(tensor) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tensor <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show_transformation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor, transformation)</span></span></span><span class="hljs-function">:</span></span> show_tensors([ tensor, transformation(tensor), apply_transformation(tensor, transformation, times=<span class="hljs-number"><span class="hljs-number">2</span></span>), apply_transformation(tensor, transformation, times=<span class="hljs-number"><span class="hljs-number">3</span></span>), apply_transformation(tensor, transformation, times=<span class="hljs-number"><span class="hljs-number">4</span></span>), ]) &gt;&gt;&gt; show_transformation(J, rotate_by_x) * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * . . . * * * . . . . . . . . . * . . . * * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * . . . * . . . . . . . . . . . * * * . * * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * * . * . . . . . . . . . . . * * * . * . . . . . . . . . . . * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . &gt;&gt;&gt; show_transformation(J, rotate_by_y) * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * . . * * . . * * . . . . . . . . . . . . . . * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * * . * * * . . . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * . . * * . . * * . . . . . . * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</code> </pre><br>  The rotation along the Z axis can be surprisingly obtained by rotating along the X and Y axes. You only need to rotate in different directions, so you have to enter the direction in rotate_by_y: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rotate_by_y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor, direction=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> direction == <span class="hljs-number"><span class="hljs-number">1</span></span>: function = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> _, x, y, z: _[x][y][-z - <span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: function = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> _, x, y, z: _[-x - <span class="hljs-number"><span class="hljs-number">1</span></span>][y][z] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> transform_tensor(tensor, function) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rotate_by_z</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rotate_by_y(rotate_by_x(rotate_by_y(tensor, direction=<span class="hljs-number"><span class="hljs-number">-1</span></span>)))</code> </pre><br>  Let's see what happens: <br><img src="https://habrastorage.org/files/0d7/bf9/820/0d7bf98206d84f118ec140a581a78335.JPG"><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>show_transformation(J, rotate_by_z) * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * . . * * . . . . . . . . . . . * . . . * . . . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * . . . * . . . . . . . . . * * * . * * * . . . . . . . . . . . . . . . . . . . . . . . . * . . . * . . . . . . . . . . . * . . . * . . . . . . . . . . . * * . . * * . . . . . . . . . . * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</code> </pre><br>  Well, besides rotations, there are more shifts.  With the transform_tensor function, it‚Äôs very simple to make a translation shift: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shift_by_x</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> transform_tensor(tensor, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> _, x, y, z: _[z][y][(x + <span class="hljs-number"><span class="hljs-number">1</span></span>) % <span class="hljs-number"><span class="hljs-number">4</span></span>])</code> </pre><br>  The only problem is that there are non-existent details: <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>show_transformation(J, shift_by_x) * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * . * * * . * . . . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * . * * * . * * . . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</code> </pre><br>  Therefore, the decision will have to complicate.  We will make a shift only if there is an empty space for the transfer.  You need to add code to calculate the projection of the tensor and check the matrix for emptiness: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project_tensor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor, function)</span></span></span><span class="hljs-function">:</span></span> projection = zero_matrix() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): projection[i][j] = function(tensor, i, j) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> projection <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project_by_x</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> project_tensor(tensor, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> _, z, y: tensor[z][y][<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project_by_y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> project_tensor(tensor, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> _, z, x: tensor[z][<span class="hljs-number"><span class="hljs-number">0</span></span>][x]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project_by_z</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> project_tensor(tensor, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> _, y, x: tensor[<span class="hljs-number"><span class="hljs-number">0</span></span>][y][x]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_empty_matrix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(matrix)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> matrix[i][j]: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre><br>  Now the shift will look like this: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shift_by_x</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> is_empty_matrix(project_by_x(tensor)): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> transform_tensor(tensor, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> _, x, y, z: _[z][y][(x + <span class="hljs-number"><span class="hljs-number">1</span></span>) % <span class="hljs-number"><span class="hljs-number">4</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tensor</code> </pre><br>  Now, if the part rests on the border, nothing happens: <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>show_transformation(J, shift_by_x) * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * * . * * * . . . . . . . . . * . . . * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</code> </pre><br>  True, it is not possible to generate all possible details.  We need to add another direction and make shifts in both directions each time.  <a href="https://github.com/alexanderkuk/galacube/blob/master/main.py">The final version</a> is on Gitkhab. <br><br>  Well, to get all possible positions for each part, you need to go through all the angles of rotation and all the dimensions of the shifts: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate_permutations</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x_rotations <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y_rotations <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z_rotations <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x_shifts <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">3</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x_direction <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y_shifts <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">3</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y_direction <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z_shifts <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">3</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z_direction <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>): permutation = apply_transformation(tensor, rotate_by_x, times=x_rotations) permutation = apply_transformation(permutation, rotate_by_y, times=y_rotations) permutation = apply_transformation(permutation, rotate_by_z, times=z_rotations) permutation = apply_transformation(permutation, shift_by_x, direction=x_direction, times=x_shifts) permutation = apply_transformation(permutation, shift_by_y, direction=y_direction, times=y_shifts) permutation = apply_transformation(permutation, shift_by_z, direction=z_direction, times=z_shifts) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> permutation</code> </pre><br>  Many combinations are duplicated.  For example, it is useless to rotate a cube, it does not add new combinations: <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>Qs = list(generate_permutations(Q)) &gt;&gt;&gt; show_tensors(sample(Qs, <span class="hljs-number"><span class="hljs-number">10</span></span>)) * * . . * * . . . . . . . . . . * * . . * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * . . * * . . . . . . . . . . * * . . * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * . . * * . . . . . . . . . . * * . . * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * . . * * . . . . . . . . . . * * . . * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * . . * * . . . . . . . . . . * * . . * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</code> </pre><br>  To leave only unique options, it is necessary to define a function that assigns a number to the tensor.  To do this, you can represent the 4x4x4 tensor as a binary 64-bit number: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hash_tensor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensor)</span></span></span><span class="hljs-function">:</span></span> hash = <span class="hljs-number"><span class="hljs-number">0</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): index += <span class="hljs-number"><span class="hljs-number">1</span></span> hash += tensor[z][y][x] * <span class="hljs-number"><span class="hljs-number">2</span></span> ** index <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash</code> </pre><br>  Now leaving unique combinations is simple: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unique_tensors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tensors)</span></span></span><span class="hljs-function">:</span></span> hashes = set() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tensor <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tensors: hash = hash_tensor(tensor) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> hash <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hashes: <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> tensor hashes.add(hash) Zs = list(unique_tensors(generate_permutations(Z))) Js = list(unique_tensors(generate_permutations(J))) Qs = list(unique_tensors(generate_permutations(Q))) &gt;&gt;&gt; show_tensors(sample(Qs, <span class="hljs-number"><span class="hljs-number">10</span></span>)) . . . . . . . . . . . . . . . . . . . . . . . . * * . . * * . . . . . . . . . . * * . . * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * . . * * . . . . . . . . . . * * . . * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * . . * * . . . . . . . . . . * * . . * * . . . . . . . . . . . . . . . . . . * * . . * * . . . . . . . . . . * * . . * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * . . * * . . . . . . . . . . * * . . * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . * * . . * * . . . . . . . . . . * * . . * * . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</code> </pre><br>  Due to the fact that the cube is small, there are not so many options: <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>len(Zs), len(Js), len(Qs) (<span class="hljs-number"><span class="hljs-number">288</span></span>, <span class="hljs-number"><span class="hljs-number">432</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>)</code> </pre><br>  The most primitive search for a solution could be: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Zs, Js, Qs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Z1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Zs: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Z2 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Zs: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Z3 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Zs: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> J1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Js: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> J2 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Js: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> J3 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Js: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Q1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Qs: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Q2 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Qs: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> tensors_intersect(Z1, Z2, Z3, J1, J2, J3, Q1, Q2): <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> Z1, Z2, Z3, J1, J2, J3, Q1, Q2</code> </pre><br>  But this is too stupid, you will need to go through 288 <sup>3</sup> 432 <sup>3</sup> 27 <sup>2</sup> options.  There is an exit.  After, for example, the first part is fixed, it is necessary to ignore all variants in which the second part intersects with the first one.  In a head-on decision, this is not the case.  Even if Z1 and Z2 overlap, all the other 6 subcycles will work.  The better solution will look like this: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solve_</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path, done, hashes, todo)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> hash <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hashes: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> tensors_intersect(done, hash): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> todo: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> solution <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> solve_(path + [hash], union_hashes(done, hash), todo[<span class="hljs-number"><span class="hljs-number">0</span></span>], todo[<span class="hljs-number"><span class="hljs-number">1</span></span>:]): <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> solution <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> path + [hash] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Zs, Js, Qs)</span></span></span><span class="hljs-function">:</span></span> done = zero_tensor() todo = [Z_hashes] * <span class="hljs-number"><span class="hljs-number">3</span></span> + [J_hashes] * <span class="hljs-number"><span class="hljs-number">3</span></span> + [Q_hashes] * <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> solution <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> solve_([], done, todo[<span class="hljs-number"><span class="hljs-number">0</span></span>], todo[<span class="hljs-number"><span class="hljs-number">1</span></span>:]): <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> solution</code> </pre><br>  But there is another nuance.  The tensors_intersect function looks like this: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tensors_intersect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a[z][y][x] <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> b[z][y][x]: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre><br>  She works for a long time.  There is a way out again.  The function that matches the tensor to the corresponding number was chosen very well.  If we use these numbers, and not tensors, the check for intersection will look like this: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tensor_hashes_intersect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a &amp; b</code> </pre><br>  Finding solutions will change a bit: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">union_tensor_hashes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a | b <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unhash_tensor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hash)</span></span></span><span class="hljs-function">:</span></span> tensor = zero_tensor() index = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">4</span></span>): index += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> hash &amp; <span class="hljs-number"><span class="hljs-number">2</span></span> ** index: tensor[z][y][x] = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tensor <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solve_</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path, done, hashes, todo)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> hash <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hashes: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> tensor_hashes_intersect(done, hash): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> todo: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> solution <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> solve_(path + [hash], union_tensor_hashes(done, hash), todo[<span class="hljs-number"><span class="hljs-number">0</span></span>], todo[<span class="hljs-number"><span class="hljs-number">1</span></span>:]): <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> solution <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> path + [hash] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Zs, Js, Qs)</span></span></span><span class="hljs-function">:</span></span> Z_hashes = [hash_tensor(_) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Zs] J_hashes = [hash_tensor(_) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Js] Q_hashes = [hash_tensor(_) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Qs] done = hash_tensor(zero_tensor()) todo = [Z_hashes] * <span class="hljs-number"><span class="hljs-number">3</span></span> + [J_hashes] * <span class="hljs-number"><span class="hljs-number">3</span></span> + [Q_hashes] * <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> solution <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> solve_([], done, todo[<span class="hljs-number"><span class="hljs-number">0</span></span>], todo[<span class="hljs-number"><span class="hljs-number">1</span></span>:]): <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> [unhash_tensor(_) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> solution]</code> </pre><br>  Run: <br><pre> <code class="python hljs">solutions = list(solve(Zs, Js, Qs))</code> </pre><br>  We wait six hours and get 576 solutions.  Naturally a lot of duplicate.  We leave only unique and get 8 options: <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>show_tensors(unique_tensors(solution_tensor(_) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> solutions)) <span class="hljs-comment"><span class="hljs-comment"># # # * # * * * * * . . * * . . # # # * # * * * # * . . # * . . . . # # . . * * # * * * # * * * . . # # . . # # # # # # # # * * . . # # . . # # # # # * # # # * . . # # . . * * # * * * # * * * # # # # # * * * # * . . * * . . # # * * # * * * # * . . * * . . # # . . # # . . # # # # * * # # # # . . * * . . * * * # * * * # * # # # * * * # . . * # . . * # * # # # * * * # . . * * . . * * * * # # * * * # . . * # . . * * # # # # * * * # . . * # . . * * # # . . * * . . * * * # * * * # # # . . # # . . * # # # * # # # * * . . # * . . # * * * # # * * * * . . # * . . # * * * # # # # # * * * # * * * . . * * . . # # # # # * # # # * . . # # . . # # # # * * # # # # . . # # . . # # # * * * # * * * . . * * . . # # # * . . # * . . # * * * # # # * * * . . * * . . # * * * # # # * * # # # * # # # # # . . # # . . * * * # * * * # * * . . # # . . . . * * . . * # * * * # # # # # . . * * . . * # * * * # * * # # . . * * . . * * * * * # * # # # . . * # . . * # * * * # * # # # * * * # * * * # * * . . # # . . * * # # # # # # # # . . # # . .</span></span></code> </pre><br>  Unfortunately, these are all possible rotations of the very variant that was found manually.  That is, Galakub has only one solution. </div><p>Source: <a href="https://habr.com/ru/post/274527/">https://habr.com/ru/post/274527/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../274511/index.html">Benchmark 32 and 64-bit versions of browsers: faster, stronger, higher?</a></li>
<li><a href="../274513/index.html">Meet-up "Productive work of the front-end developer in the conditions of legacy-code support": transition to Dart</a></li>
<li><a href="../274515/index.html">Meet-up ‚ÄúProductive work of a front-end developer under conditions of legacy-code support‚Äù: talking about useful tools</a></li>
<li><a href="../274519/index.html">Programming microcomputer LEGO NXT Mindstorms 2.0. Introduction</a></li>
<li><a href="../274523/index.html">Angular 2 vs. React: And there will be blood</a></li>
<li><a href="../274529/index.html">Sound Manager for small games and prototypes on Unity</a></li>
<li><a href="../274533/index.html">Deanonymization of a programmer is possible not only through the source code, but also through a compiled binary file</a></li>
<li><a href="../274535/index.html">Animation of falling snow on Canvas is more effective than animation on DOM several times.</a></li>
<li><a href="../274539/index.html">Configure logrotate + access to collect logs via SFTP</a></li>
<li><a href="../274545/index.html">Method Swizzling and Swift: but there is a nuance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>