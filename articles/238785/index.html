<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Holy Grail on steroids: total synchronization and isomorphic JavaScript on Swarm.js</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today on Habr√©, we present the technology of a replicated model that allows you to create collaborative and realtime web applications as easily as loc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Holy Grail on steroids: total synchronization and isomorphic JavaScript on Swarm.js</h1><div class="post__text post__text-html js-mediator-article">  Today on Habr√©, we present the technology of a replicated model that allows you to create collaborative and realtime web applications as easily as local desktop applications.  We believe that when developing applications, real-time data synchronization should be available in the same way as a TCP stream, an HTTP request, or a current from an outlet ‚Äî immediately and without question.  HTML5 applications written in <a href="https://github.com/gritzko/swarm">Swarm</a> , in terms of autonomy, locality and download speed are not inferior to native ones. <br>  Using the Swarm library, over the weekend we do more than a month before we did without Swarm.  What is more important - we can do what we could not do at all without it.  We offer this synchronization library for free. <br><br><img src="https://habrastorage.org/files/05a/538/2bb/05a5382bb9024b52bc4a939117bd7048.jpg"><br><br>  Today we post <a href="http://ppyr.us/">TodoMVC ++</a> , a reactive <a href="http://www.slideshare.net/spikebrehm/2014-0313fluent">HolyGrail-</a> on-steroid application <a href="https://github.com/gritzko/todomvc-swarm">written</a> in Swarm + <a href="http://facebook.github.io/react/">React</a> .  I will give a list of features demonstrated in the application: <br><a name="habracut"></a><br><ul><li>  Instant download - the page is drawn on the server and comes to the client, like compressed HTML;  then, the code and data are pulled up and the page is animated.  <a href="http://nerds.airbnb.com/isomorphic-javascript-future-web-apps/">Isomorphic javascript</a> in action. </li><li>  Caching data in WebStorage - allows you to both speed up the download and work offline, without losing work. </li><li>  Offline work - the data is already clear, and if we add cache manifest, then the HTML5 application can load and work without the Internet! </li><li>  Real-time synchronization - open several bookmarks (synchronization via WebStorage) or open the same page on your phone / ipad / other browser (WebSocket). </li><li>  Difficult to synchronize data structures (yes, yes, it is a difficult-syn-hro-ne-zi-ru-e-we-e). </li></ul><br>  In general, the application is written without any reference to the network, as a simple (local) MVC application.  Synchronization and caching occurs entirely at the Swarm library level, and the application works with local Backbone-like model objects. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, here is the application itself: <a href="http://ppyr.us/">ppyr.us.</a> <br>  Here is the code: <a href="https://github.com/gritzko/todomvc-swarm">github.com/gritzko/todomvc-swarm</a> <br><br>  A detailed analysis of the application and the library is in the following material, and now there are a lot of letters about replicas, CRDT and the theoretical basis. <br><br>  Today, synchronization is highly demanded on both the client and the server.  In the server economy of the Internet giants, more and more various storages and data processing facilities appear that require synchronization.  The principle of one big database, as a source of truth, is <a href="https://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying">difficult to scale</a> .  But we are talking, first of all, about the client.  Today, an ordinary user has got a lot of devices.  When the data that he sees on the laptop screen does not match the data on the iPhone screen - the user becomes upset.  Synchronization of replicas is needed everywhere, and we believe that the data synchronization system (SD) will soon be the same IT content as a database. <br><br>  The specificity of the current moment is that even industry leaders finished their synchronization decisions only up to the ‚Äútype of work‚Äù stage.  GDocs does not quite work offline, GTalk and Skype systematically lose cues from the chat history, Evernote is famous for a wide variety of bugs.  And these are the leaders.  In general, the problem of synchronization is surprisingly complex and multifaceted.  Take Evernote.  If Evernote were a local application, a student could write his 80/20 subset.  Just like having MySQL and PHP, Zuckerberg wrote facebook. <br><br>  What is the fundamental complexity of synchronization?  Let's understand how classic replication and synchronization technologies work, how they maintain the identity of replicas.  The simplest approach is to do everything through the center.  All write operations are flocked to the central database, new results of read operations go back from the center.  It seems to be safe and easy, but soon the difficulties start coming from three sides. <br><ol><li>  concurrency - while the response to the previous operation was going on, the client managed to do something else, and how to combine it now is not quite clear, </li><li>  scaling scheme, where all operations go through one point, </li><li>  functioning on a bad internet when the center does not respond to customers or responds slowly. </li></ol><br><br>  The first typical step of scaling this scheme is replication according to the master-slave principle, as it is <a href="http://redis.io/topics/replication">implemented</a> in a <a href="http://dev.mysql.com/doc/refman/5.0/en/replication-howto.html">typical</a> <a href="http://docs.mongodb.org/manual/core/master-slave/">database</a> .  The wizard puts the operations into a linear log and distributes this log to slaves who apply it to their data replicas in the same linear order and get the same result.  This helps to scale the reading, but adds an eventual consistency element, since  Slaves are updated with some lag.  The problem of recording remains - all records go through the same center.  Linearization can be stretched to distributed replicas using the consensus algorithm, such as <a href="http://en.wikipedia.org/wiki/Paxos_(computer_science)">Paxos</a> or <a href="http://raftconsensus.github.io/">Raft</a> , but even there the ‚Äúleader‚Äù makes linearization, i.e.  all the same center.  When the center does shut up, they start horizontal scaling - they cut the base into ‚Äúshards‚Äù.  There is already linearization, and with it the entire <a href="http://en.wikipedia.org/wiki/ACID">ACID</a> , breaks into a thousand small ACID'ikov. <br><br>  Well, the center and linearization are not compatible with offline work.  You can, of course, say that offline will not be soon, but the fact is that offline happens and happens regularly.  If we tweet or like something, it can be suffered, and if something is more serious, then it is unlikely.  If, for example, the waiter has touched the wire with a foot and the Internet has disappeared, then we cannot drive customers out of the restaurant until the admin arrives in a car with flashing lights, and we also cannot serve for free (example from Max Nalsky, co-founder of <a href="http://en.iiko.ru/">IIKO</a> ). <br><br>  Moreover, all these adventures on the server side still do not affect the client side.  The client simply waits until the servers agree on everything and report the result.  In the notorious project, <a href="https://www.meteor.com/">Meteor</a> tried to make clients synchronize in real time, actually caching MongoDB to the client.  For everything to be lively, waiting for the server to respond was masked by the latency compensation trick.  The client rolls the operation into its cache, sends it to the server, the server responds if it has succeeded, and if not, sends a correction.  The approach is more than doubtful.  ‚Äú-Lust, did you put the car in the garage?  ‚ÄúYes, in part!‚Äù <br><br>  This is such a complicated story with linearization.  Well, the more interesting it is to look at popular solutions that are scored on linearization.  There are two good examples - <a href="http://git-scm.com/">Git</a> and CouchDB.  Git was written by Linus Torvalds, who was the ‚Äúcenter‚Äù among Linux developers.  This is probably why he felt well that the center is slow, the center does not scale.  In git, synchronization occurs according to the master-master principle.  The data is presented as a digraph of versions, all parallel versions need to be smoothed once.  Scaling - perfect, offline - no problem.  Approximately the same in <a href="http://couchdb.apache.org/">CouchDB</a> .  There are attempts to bring CouchDB-like logic to the client - pouchdb and hood.ie. <br><br>  Something completely new in this area is <a href="http://highscalability.com/blog/2010/12/23/paper-crdts-consistency-without-concurrency-control.html">CRDT</a> , and we‚Äôre talking about it today, sorry for the long introduction.  CRDT is Convergent / Commutative / Cloud Replicated Data Types.  The overall design of CRDT is to use partial order instead of linearization.  Operations can occur in parallel on many replicas, and some operations are competitive - i.e.  occurred on different replicas, not knowing about each other, none of them are ‚Äúfirst‚Äù, and on different replicas they are attached in a different order.  If the data structures used withstand such easy reordering of operations that do not violate cause-effect relationships, then all the problems associated with the center simply evaporate. <br><br>  Another question is - are there many such CRDT data structures?  As it turned out, the entire computational consumer goods ‚Äî variables, arrays, associative arrays ‚Äî are completely realized in the form of CRDT.  And if we count money?  Is this when linearization and ACID guarantees are needed?  Alas, oh, it turned out that the new is well forgotten old.  It turned out that the data structures used in bookkeeping - accounts, balances - are quite CRDT.  Indeed, during the Renaissance period, when accounting traditions were formed, there was no Internet, so they got out without linearization. <br><br>  CRDT's big, glowing opportunity is live replicas that are fully functional even in the absence of a connection to the center.  Well, the immediate application of all operations, without jogging to the center.  Such autonomy and speed is especially relevant in two cases.  First, for mobile devices - they are used on the go, with an unreliable Internet.  CRDT allows you to store data for future use, and work quietly locally, with background synchronization.  Secondly, for applications with the collaboration function, especially in real time (we think about Google Docs, Apple iCloud).  In such applications, the ‚Äústate‚Äù is large and rapidly changing, and each run to the server and back is a nail in the coffin. <br><br>  There are also non-CRDT technologies that allow working with data offline.  Its synchronization API offers <a href="https://www.dropbox.com/developers/datastore">Dropbox</a> , there is <a href="http://strongloop.com/strongblog/node-js-replication-mobile-offline-sync-loopback/">StrongLoop</a> , <a href="https://www.firebase.com/">Firebase,</a> etc., their sea.  All these solutions work on the principle of Last-Write-Wins (LWW) - each entry is assigned a timestamp, an entry with a larger tag rubs the old ones.  On the same principle is built <a href="http://cassandra.apache.org/">Cassandra</a> .  And in our Swarm library, the most <a href="">popular</a> primitive is the <a href="">LWW object</a> .  The advantage of Swarm are those data structures that are not solved through LWW.  For example, text while editing. <br><br>  In general, in the looking glass of distributed systems, the opposite is true.  In ordinary programming languages, the simplest operation is the increment of a variable, ++.  Working with arrays is a little harder, and objects and associative collections are even more complicated.  In distributed systems, everything is exactly the opposite!  LWW objects and associative containers are not difficult.  Linear structures (arrays, text) are very complex, and counters are extremely complex.  This can be seen in the example of Cassandra, where LWW objects were made first and foremost, and the counters still seem to be finished. <br><br><img src="https://habrastorage.org/files/607/e74/18b/607e7418bd36491690195498b5003d60.jpg"><br><br>  Get to the point.  We decided to write TodoMVC in Swarm + React to show the library in action.  Actually, the <a href="https://github.com/andreypopp/todomvc-flux-swarm">first TodoMVC</a> on Swarm + React was written in July by Andrei Popp less than in a day, but that code was not ‚Äúidiomatic‚Äù.  This time, we added linear collections ( <a href="">Vector</a> ), server rendering and a bunch of all sorts of goodies.  Moreover, the usual TodoMVC seemed bored and useless.  For example, looking at React + flux TodoMVC, it is very difficult to understand why the authors nagged all these tricks in the simplest application.  Therefore, we have added one feature - recursiveness.  By pressing Tab, the user goes to the nested "child" list.  Also, we adapted the interface for realtime synchronization.  Such an application already represents at least some practical benefit.  Also, they began to show the status of the application in the URL - for easy sharing between users.  In general, it was difficult for us to stop.  Compared to the development of real-time projects in the past, in the face of Swarm we had a sort of clade sword, and all the time itching to kill someone else. <br><br>  A detailed analysis of the application and the library - in the following material. <br><br>  Follow the updates on the <a href="http://twitter.com/swarm_js">@swarm_js</a> project <a href="http://twitter.com/swarm_js">twitter</a> . </div><p>Source: <a href="https://habr.com/ru/post/238785/">https://habr.com/ru/post/238785/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../238771/index.html">‚ÄúBleed the mind. Inexpensive. Is there any sense of a mask for lucid dreams?</a></li>
<li><a href="../238775/index.html">Windows 10 Technical Preview is available for download.</a></li>
<li><a href="../238777/index.html">Epson Contest Reminder for Android Developers</a></li>
<li><a href="../238779/index.html">IDE Atom from GitHub. Published roadmap to version 1.0</a></li>
<li><a href="../238783/index.html">What will happen if you mix nuts, Arduino, OpenCV and Delphi. Part 2</a></li>
<li><a href="../238787/index.html">Go to the global pile without traffic jams. Explore memory managers</a></li>
<li><a href="../238793/index.html">Drupal 8 beta</a></li>
<li><a href="../238795/index.html">We read Habr by mail</a></li>
<li><a href="../238797/index.html">What can we expect from 14 nanometers?</a></li>
<li><a href="../238801/index.html">Media Center with IPTV from laptop and monitor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>