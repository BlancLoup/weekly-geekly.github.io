<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DDoS from an unexpected direction or ‚Äúare PS bots afraid?‚Äù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to tell an interesting story about the interaction with search engines, and in particular with the bots of the great and powerful Yandex. 

 Pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DDoS from an unexpected direction or ‚Äúare PS bots afraid?‚Äù</h1><div class="post__text post__text-html js-mediator-article">  I want to tell an interesting story about the interaction with search engines, and in particular with the bots of the great and powerful Yandex. <br><br>  Preamble.  I have a dedicated server on which the order of several dozen sites is spinning.  There were never any problems, the machine is vigorous, new.  A few days ago I received a report that everything was ‚Äústuck‚Äù.  I had to do a remote reboot.  I later noticed that the CPU load rose to 60% from 10% and began to stay at this level.  Of course, I was wary, but it was not enough. <br><a name="habracut"></a><br>  And yesterday everything hangs completely.  Reboot - progruz and again complete calm.  All sites go out of access.  After monitoring the processes, I saw mysql loading at 99.9%.  I was surprised, I went to look for the site from which such download is coming.  I found, weed out other requests and saw that someone was hammering hard at 40k requests per second, overloading the poor database with ‚ÄúI can‚Äôt do it myself‚Äù.  I start digging logs and see the subnets from which these requests come.  I connect to the server, I register DROP in iptables according to the mask / 24, and everything is normalized. <br><br>  I noticed that the ddaser sends the Yandex-bot identification.  Slightly this surprised, but you never know.  I decided to check, and it turned out that the two subnets that I had to ban were owned by Yandex spiders. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After a thorough study of why and what the bots did on the site with such frenzy, it became clear that the bots had reached the unclosed filter of products and sped off an incredible pile of pages, which they began to scroll through for indexing.  Why some sort of cut-off did not work for them like that - it is not clear.  The site with this filter works for more than three years and there were no problems. <br><br>  At the moment, the filter is closed from indexing via htaccess, the bots are unbanned, and I am waiting for a response from Yandex support. <br><br><div class="spoiler">  <b class="spoiler_title">A small piece of logs</b> <div class="spoiler_text">  [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; show = 50 &amp; page = 7 &amp; page = 5 &amp; show = 10 &amp; page = 4 &amp; page = 6 HTTP / 1.1" 200 102 "-" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  87.250.244.29 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; show = 50 &amp; page = 7 &amp; page = 5 &amp; show = 10 &amp; page = 4 &amp; page = 1 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  87.250.244.16 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; show = 50 &amp; page = 7 &amp; page = 5 &amp; show = 10 &amp; page = 4 &amp; page = 2 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  141.8.141.140 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 111 &amp; show = 50 &amp; page = 1 &amp; page = 23 &amp; show = 30 &amp; page = 37 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  87.250.244.16 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 111 &amp; show = 50 &amp; page = 1 &amp; page = 23 &amp; show = 30 &amp; page = 26 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  141.8.141.140 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 111 &amp; show = 50 &amp; page = 1 &amp; page = 23 &amp; show = 30 &amp; page = 25 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  141.8.141.139 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 111 &amp; show = 50 &amp; page = 1 &amp; page = 23 &amp; show = 30 &amp; page = 24 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  87.250.244.29 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 111 &amp; show = 50 &amp; page = 1 &amp; page = 23 &amp; show = 30 &amp; page = 20 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  87.250.244.16 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 111 &amp; show = 50 &amp; page = 1 &amp; page = 23 &amp; show = 30 &amp; page = 21 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  141.8.141.140 - - [29 / Oct / 2015: 13: 57: 10] ‚ÄúGET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 5 &amp; show = 10 &amp; page = 3 &amp; show = 50 &amp; page = 1 &amp; page = 3 &amp; page = 6 &amp; page = 23 HTTP / 1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  141.8.141.139 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 1 &amp; page = 3 &amp; show = 30 &amp; page = 1 &amp; page = 3 &amp; page = 37 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  87.250.244.29 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 5 &amp; page = 4 &amp; page = 1 &amp; page = 2 &amp; page = 111 HTTP / 1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  87.76.13.189 - - [29 / Oct / 2015: 13: 57: 10] ‚ÄúGET / HTTP / 1.1‚Äù 200 102 "-" "Mozilla / 5.0 (Windows NT 6.3; WOW64) AppleWebKit / 537.36 (KHTML, like Gecko) Chrome / 46.0.2490.80 Safari / 537.36 " <br>  87.250.244.16 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 8 &amp; page = 7 &amp; page = 8 &amp; page = 6 &amp; page = 4 &amp; page = 5 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  141.8.141.140 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 8 &amp; page = 7 &amp; page = 8 &amp; page = 6 &amp; page = 4 &amp; page = 7 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  141.8.141.139 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 8 &amp; page = 7 &amp; page = 8 &amp; page = 6 &amp; page = 4 &amp; page = 6 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  87.250.244.29 - - [29 / Oct / 2015: 13: 57: 10] ‚ÄúGET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 8 &amp; page = 7 &amp; page = 8 &amp; page = 6 &amp; page = 4 &amp; page = 1 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  87.250.244.16 - - [29 / Oct / 2015: 13: 57: 10] ‚ÄúGET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 8 &amp; page = 7 &amp; page = 8 &amp; page = 6 &amp; page = 4 &amp; page = 2 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  141.8.141.138 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 4 &amp; show = 50 &amp; show = 10 &amp; show = 30 &amp; page = 37 HTTP / 1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  141.8.141.143 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 1 &amp; show = 50 &amp; page = 4 &amp; show = 30 &amp; page = 37 HTTP / 1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  141.8.141.137 - - [29 / Oct / 2015: 13: 57: 10] ‚ÄúGET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; show = 30 &amp; page = 1 &amp; page = 3 &amp; page = 2 &amp; page = 3 &amp; page = 1 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  141.8.141.132 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; show = 30 &amp; page = 1 &amp; page = 3 &amp; page = 2 &amp; page = 3 &amp; page = 6 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  87.250.244.15 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; show = 30 &amp; page = 1 &amp; page = 3 &amp; page = 2 &amp; page = 3 &amp; page = 4 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  87.250.244.38 - - [29 / Oct / 2015: 13: 57: 10] ‚ÄúGET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; show = 30 &amp; page = 1 &amp; page = 3 &amp; page = 2 &amp; page = 3 &amp; page = 5 HTTP /1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; + http: //yandex.com/bots) " <br>  87.250.244.14 - - [29 / Oct / 2015: 13: 57: 10] "GET / catalog / kotli /? 176 &amp; filter = 1 &amp; fldX = 0 &amp; page = 8 &amp; page = 6 &amp; show = 10 &amp; page = 7 &amp; page = 9 &amp; show = 30 &amp; page = 11 &amp; show = 50 HTTP / 1.1 "200 102" - "" Mozilla / 5.0 (compatible; YandexBot / 3.0; <br></div></div><br>  And I understand, if I were more prudent, there would be no such problems.  But still. <br><br>  Thank. </div><p>Source: <a href="https://habr.com/ru/post/270297/">https://habr.com/ru/post/270297/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270287/index.html">GDG DevFest Nizhny Novgorod 2015</a></li>
<li><a href="../270289/index.html">Java Gauss Method</a></li>
<li><a href="../270291/index.html">About Swift, and why my big projects will be on Objective-C for some (maybe long) time</a></li>
<li><a href="../270293/index.html">We create an interactive vector scheme of the Moscow metro</a></li>
<li><a href="../270295/index.html">Security Week 45: escape from the sandbox, bypassing EMET through WOW64, breaking into 000webhost</a></li>
<li><a href="../270299/index.html">Workflow automation for a small development team (Part 1)</a></li>
<li><a href="../270301/index.html">Grow Big: Simple Tips for New Business Application Makers</a></li>
<li><a href="../270307/index.html">A cryptographic program encrypts user files offline.</a></li>
<li><a href="../270309/index.html">Creating a plugin for Intellij IDEA. Notes and small tips</a></li>
<li><a href="../270311/index.html">Utility for the developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>