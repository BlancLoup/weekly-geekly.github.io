<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write a primitive and useless compiler</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I believe that every programmer should write his own compiler. 

 I myself have long believed that the creation of compilers is the lot of the elite, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write a primitive and useless compiler</h1><div class="post__text post__text-html js-mediator-article">  I believe that every programmer should write his own compiler. <br><br>  I myself have long believed that the creation of compilers is the lot of the elite, and the mere mortal programmer cannot comprehend this science.  I will try to prove that it is not. <br><br>  In the post, we will look at how you can write your own C-like language compiler in less than an hour, using only 300 lines of code.  As a bonus, this includes the code of the virtual machine, in which the source code will be compiled into the bytecode. <br><a name="habracut"></a><br>  The compiler will be written in Python.  I love this language, but the code can be sometimes clumsy.  If something is wrong - write in a personal. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Yes, the compiler is completely brazenly based on Tiny-C. <br><br><h2>  Grammar </h2><br>  Before we begin, let's define what our language will be able to do. <br>  He will be able to do very little: <br><br>  - the only data type is int <br>  - all variables are global.  There are 26 variables in total (az) <br>  - of the mathematical operations, only "+" and "-" are supported. <br>  - the only comparison operator - is a "&lt;" <br>  - from the language structures - conditional statements if, if / else, while, do / while <br><br>  Everything.  No arrays, functions, structures.  Here is the grammar of our language: <br><br><pre> <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">program</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "if" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "if" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "else" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "while" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "do" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "while" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "{" { </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> } "}" | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ";" | ";" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "(" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ")" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">test</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "=" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">test</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "+" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "-" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">int</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "a" | "b" | ... | "z" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">int</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, { </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "0" | "1" | ... | "9"</span></span></code> &lt;statement&gt; "else" &lt;statement&gt; | <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">program</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "if" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "if" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "else" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "while" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "do" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "while" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "{" { </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> } "}" | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ";" | ";" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "(" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ")" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">test</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "=" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">test</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "+" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "-" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">int</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "a" | "b" | ... | "z" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">int</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, { </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "0" | "1" | ... | "9"</span></span></code> " &lt;paren-expr&gt; | <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">program</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "if" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "if" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "else" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "while" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "do" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "while" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "{" { </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> } "}" | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ";" | ";" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "(" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ")" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">test</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "=" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">test</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "+" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "-" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">int</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "a" | "b" | ... | "z" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">int</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, { </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "0" | "1" | ... | "9"</span></span></code> | <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">program</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "if" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "if" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "else" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "while" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "do" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "while" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "{" { </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> } "}" | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ";" | ";" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "(" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ")" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">test</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "=" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">test</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "+" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "-" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">int</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "a" | "b" | ... | "z" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">int</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, { </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "0" | "1" | ... | "9"</span></span></code> | <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">program</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "if" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "if" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "else" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "while" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "do" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "while" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | "{" { </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">statement</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> } "}" | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ";" | ";" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "(" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ")" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">test</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "=" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">test</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "+" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sum</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> "-" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">term</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">int</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> | </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">paren-expr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "a" | "b" | ... | "z" </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">int</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, { </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ::= "0" | "1" | ... | "9"</span></span></code> </pre><br>  This is a record in the form of grammar <a href="http://en.wikipedia.org/wiki/Extended_Backus%25E2%2580%2593Naur_Form">EBNF</a> .  That's what this record roughly means. <br><br>  A program is a single statement. <br>  Operators are conditional (if..else ...), cyclic (while ...) and just operators (for example, "a = 2 + 3"). <br>  Conditional and cyclic contain expression and body condition (as operator).  Normal operators end with a semicolon.  Operators can be grouped in braces, then obtain a compound statement. <br>  Expressions are either a sum or a variable assignment. <br>  Here the sum is a sequence of additions and subtractions of terms. <br>  A term is a number, variable or expression in brackets. <br>  Variables are characters from a to z.  Numbers are a set of numbers from 0 to 9. <br><br>  All these difficulties are needed in order to tell the compiler exactly how to automatically analyze the source code.  For example, we met the word ‚Äúif‚Äù - it means that the expression in brackets goes on, and the operator follows. <br><br><h2>  Lexical analyzer </h2><br>  The compiler receives a text file (source).  <a href="http://en.wikipedia.org/wiki/Lexical_analysis">The lexical analyzer</a> is needed in order to highlight the tokens file.  Those.  The line ‚Äúa = 3 + 42;‚Äù the lexical analyzer should represent in the form ‚Äúidentifier: a‚Äù, ‚Äúoperator =‚Äù, ‚Äúnumber 3‚Äù, ‚Äúoperator +‚Äù, ‚Äúnumber 42‚Äù, ‚Äúsymbol;‚Äù.  The lexical analyzer works only with a sequence of letters, i.e.  for him the line ‚Äúab if =‚Äù also makes sense and is absolutely correct. <br><br>  So, our lexical analyzer should recognize the following tokens: <br><br>  - numbers <br>  - identifiers-variables <br>  - keywords: if, else, while, do <br>  - symbols +, -, &lt;, =, {,}, (,) ,; <br>  - end of file <br><br>  Here is what its source code looks like: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Lexer</span></span></span><span class="hljs-class">:</span></span> NUM, ID, IF, ELSE, WHILE, DO, LBRA, RBRA, LPAR, RPAR, PLUS, MINUS, LESS, \ EQUAL, SEMICOLON, EOF = range(<span class="hljs-number"><span class="hljs-number">16</span></span>) <span class="hljs-comment"><span class="hljs-comment">#    SYMBOLS = { '{': LBRA, '}': RBRA, '=': EQUAL, ';': SEMICOLON, '(': LPAR, ')': RPAR, '+': PLUS, '-': MINUS, '&lt;': LESS } #   WORDS = { 'if': IF, 'else': ELSE, 'do': DO, 'while': WHILE } #  ,    ch = ' ' # ,   -   def error(self, msg): print 'Lexer error: ', msg sys.exit(1) def getc(self): self.ch = sys.stdin.read(1) def next_tok(self): self.value = None self.sym = None while self.sym == None: if len(self.ch) == 0: self.sym = Lexer.EOF elif self.ch.isspace(): self.getc() elif self.ch in Lexer.SYMBOLS: self.sym = Lexer.SYMBOLS[self.ch] self.getc() elif self.ch.isdigit(): intval = 0 while self.ch.isdigit(): intval = intval * 10 + int(self.ch) self.getc() self.value = intval self.sym = Lexer.NUM elif self.ch.isalpha(): ident = '' while self.ch.isalpha(): ident = ident + self.ch.lower() self.getc() if ident in Lexer.WORDS: self.sym = Lexer.WORDS[ident] elif len(ident) == 1: self.sym = Lexer.ID self.value = ord(ident) - ord('a') else: self.error('Unknown identifier: ' + ident) else: self.error('Unexpected symbol: ' + self.ch)</span></span></code> </pre><br>  The method next_tok () analyzer receives the next token.  The type of the token can be obtained from the sym attribute, and its value (if it is a variable or a number) from the value attribute. <br><br>  The analyzer ignores spaces, checks whether the current character is a special character of the language, if not, checks if it is a number or identifier.  Those.  upon encountering the number 1, the analyzer will continue to read the characters until it encounters a non-numeric character.  Similarly, identifiers are checked (there instead of numbers of letters). <br><br><h2>  Parser </h2><br>  This is probably the most difficult component of our compiler.  His task, using tokens received from a lexical analyzer, is to form <a href="http://en.wikipedia.org/wiki/Abstract_syntax_tree">a kind of tree</a> in which hierarchy and relationships display the structure of the code.  For example: <br><br><pre> <code class="hljs php"><span class="hljs-string"><span class="hljs-string">"if (a &lt; 0) a = 5;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> +-LESS | +-<span class="hljs-keyword"><span class="hljs-keyword">VAR</span></span>(a) | +-NUM(<span class="hljs-number"><span class="hljs-number">0</span></span>) +-SET +-<span class="hljs-keyword"><span class="hljs-keyword">VAR</span></span>(a) +-NUM(<span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre><br><br>  The tree that is built by the parser consists of nodes.  A node has a type (IF, LESS, SET, VAR ...), a value (if it is a number or a variable) and several child nodes of operands (in the code - op1, op2, op3).  For if, they store the condition and then / else branches, for loops, the condition and the body of the loop. <br><br>  To describe the nodes, we introduce the Node class.  Here is the code for the parser class and the Node class: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Node</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, kind, value = None, op1 = None, op2 = None, op3 = None)</span></span></span><span class="hljs-function">:</span></span> self.kind = kind self.value = value self.op1 = op1 self.op2 = op2 self.op3 = op3 <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parser</span></span></span><span class="hljs-class">:</span></span> VAR, CONST, ADD, SUB, LT, SET, IF1, IF2, WHILE, DO, EMPTY, SEQ, EXPR, PROG = range(<span class="hljs-number"><span class="hljs-number">14</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, lexer)</span></span></span><span class="hljs-function">:</span></span> self.lexer = lexer <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, msg)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'Parser error:'</span></span>, msg sys.exit(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">term</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.lexer.sym == Lexer.ID: n = Node(Parser.VAR, self.lexer.value) self.lexer.next_tok() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> self.lexer.sym == Lexer.NUM: n = Node(Parser.CONST, self.lexer.value) self.lexer.next_tok() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.paren_expr() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">summa</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> n = self.term() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> self.lexer.sym == Lexer.PLUS <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> self.lexer.sym == Lexer.MINUS: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.lexer.sym == Lexer.PLUS: kind = Parser.ADD <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: kind = Parser.SUB self.lexer.next_tok() n = Node(kind, op1 = n, op2 = self.term()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> n = self.summa() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.lexer.sym == Lexer.LESS: self.lexer.next_tok() n = Node(Parser.LT, op1 = n, op2 = self.summa()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.lexer.sym != Lexer.ID: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.test() n = self.test() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n.kind == Parser.VAR <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> self.lexer.sym == Lexer.EQUAL: self.lexer.next_tok() n = Node(Parser.SET, op1 = n, op2 = self.expr()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">paren_expr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.lexer.sym != Lexer.LPAR: self.error(<span class="hljs-string"><span class="hljs-string">'"(" expected'</span></span>) self.lexer.next_tok() n = self.expr() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.lexer.sym != Lexer.RPAR: self.error(<span class="hljs-string"><span class="hljs-string">'")" expected'</span></span>) self.lexer.next_tok() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">statement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.lexer.sym == Lexer.IF: n = Node(Parser.IF1) self.lexer.next_tok() n.op1 = self.paren_expr() n.op2 = self.statement() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.lexer.sym == Lexer.ELSE: n.kind = Parser.IF2 self.lexer.next_tok() n.op3 = self.statement() <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> self.lexer.sym == Lexer.WHILE: n = Node(Parser.WHILE) self.lexer.next_tok() n.op1 = self.paren_expr() n.op2 = self.statement(); <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> self.lexer.sym == Lexer.DO: n = Node(Parser.DO) self.lexer.next_tok() n.op1 = self.statement() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.lexer.sym != Lexer.WHILE: self.error(<span class="hljs-string"><span class="hljs-string">'"while" expected'</span></span>) self.lexer.next_tok() n.op2 = self.paren_expr() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.lexer.sym != Lexer.SEMICOLON: self.error(<span class="hljs-string"><span class="hljs-string">'";" expected'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> self.lexer.sym == Lexer.SEMICOLON: n = Node(Parser.EMPTY) self.lexer.next_tok() <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> self.lexer.sym == Lexer.LBRA: n = Node(Parser.EMPTY) self.lexer.next_tok() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> self.lexer.sym != Lexer.RBRA: n = Node(Parser.SEQ, op1 = n, op2 = self.statement()) self.lexer.next_tok() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: n = Node(Parser.EXPR, op1 = self.expr()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.lexer.sym != Lexer.SEMICOLON: self.error(<span class="hljs-string"><span class="hljs-string">'";" expected'</span></span>) self.lexer.next_tok() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.lexer.next_tok() node = Node(Parser.PROG, op1 = self.statement()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.lexer.sym != Lexer.EOF): self.error(<span class="hljs-string"><span class="hljs-string">"Invalid statement syntax"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> node</code> </pre><br>  This parser works recursively, starting with the method parse (). <br>  At first, it creates a "Program" node, a child node which becomes the main operator of the program. <br><br>  Operators are formed in the statement () method.  In this method, the first token is checked and, depending on it, an if, if / else, while, do / while, compound statement (if it starts with a curly bracket) or just a single statement, terminated by a semicolon, is formed. <br><br>  When constructing operators, the methods expr () are used - get the expression and paren_expr () - get the expression in brackets. <br><br>  Expressions are built from checks that are built from sums that consist of terms.  And the terms are in turn composed of numbers, variables, and expressions in parentheses.  The house that Jack built. <br><br>  Such is the recursion.  As you can see, the methods correspond to the concepts described above grammar. <br><br>  At the output of the parse () method, we obtain an object of class Node, which contains the tree of our program.  This tree can now be converted to machine code. <br><br><h2>  Machine code </h2><br>  We will compile in a simple bytecode our special virtual machine.  The virtual machine will stack because  They are much easier register.  Here are her possible instructions: <br><br><pre> <code class="hljs 1c">FETCH x -      x STORE x -    x     PUSH n -  <span class="hljs-built_in"><span class="hljs-built_in"></span></span> n    POP -  <span class="hljs-built_in"><span class="hljs-built_in"></span></span>    ADD -       SUB -       LT -       (a &lt; b).  - <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> JZ a - <span class="hljs-keyword"><span class="hljs-keyword"></span></span>    <span class="hljs-number"><span class="hljs-number">0</span></span> - <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   a. JNZ a - <span class="hljs-keyword"><span class="hljs-keyword"></span></span>    <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> - <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   a. JMP a - <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   a HALT -  </code> </pre><br>  For example, operators ¬´a = 2;  b = 5; "is converted into the following sequence of instructions: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">PUSH</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> STORE <span class="hljs-number"><span class="hljs-number">0</span></span> PUSH <span class="hljs-number"><span class="hljs-number">5</span></span> STORE <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  The virtual machine code is very simple.  It is all described in the run method: <br><br><pre> <code class="python hljs">IFETCH, ISTORE, IPUSH, IPOP, IADD, ISUB, ILT, JZ, JNZ, JMP, HALT = range(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VirtualMachine</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, program)</span></span></span><span class="hljs-function">:</span></span> var = [<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">26</span></span>)] stack = [] pc = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: op = program[pc] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pc &lt; len(program) - <span class="hljs-number"><span class="hljs-number">1</span></span>: arg = program[pc+<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> op == IFETCH: stack.append(var[arg]); pc += <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == ISTORE: var[arg] = stack.pop(); pc += <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == IPUSH: stack.append(arg); pc += <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == IPOP: stack.append(arg); stack.pop(); pc += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == IADD: stack[<span class="hljs-number"><span class="hljs-number">-2</span></span>] += stack[<span class="hljs-number"><span class="hljs-number">-1</span></span>]; stack.pop(); pc += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == ISUB: stack[<span class="hljs-number"><span class="hljs-number">-2</span></span>] -= stack[<span class="hljs-number"><span class="hljs-number">-1</span></span>]; stack.pop(); pc += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == ILT: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> stack[<span class="hljs-number"><span class="hljs-number">-2</span></span>] &lt; stack[<span class="hljs-number"><span class="hljs-number">-1</span></span>]: stack[<span class="hljs-number"><span class="hljs-number">-2</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: stack[<span class="hljs-number"><span class="hljs-number">-2</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span> stack.pop(); pc += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == JZ: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> stack.pop() == <span class="hljs-number"><span class="hljs-number">0</span></span>: pc = arg <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: pc += <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == JNZ: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> stack.pop() != <span class="hljs-number"><span class="hljs-number">0</span></span>: pc = arg <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: pc += <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == JMP: pc = arg; <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == HALT: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'Execution finished.'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">26</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> var[i] != <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'%c = %d'</span></span> % (chr(i+ord(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)), var[i])</code> ] - = stack [-1]; <code class="python hljs">IFETCH, ISTORE, IPUSH, IPOP, IADD, ISUB, ILT, JZ, JNZ, JMP, HALT = range(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VirtualMachine</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, program)</span></span></span><span class="hljs-function">:</span></span> var = [<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">26</span></span>)] stack = [] pc = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: op = program[pc] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pc &lt; len(program) - <span class="hljs-number"><span class="hljs-number">1</span></span>: arg = program[pc+<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> op == IFETCH: stack.append(var[arg]); pc += <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == ISTORE: var[arg] = stack.pop(); pc += <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == IPUSH: stack.append(arg); pc += <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == IPOP: stack.append(arg); stack.pop(); pc += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == IADD: stack[<span class="hljs-number"><span class="hljs-number">-2</span></span>] += stack[<span class="hljs-number"><span class="hljs-number">-1</span></span>]; stack.pop(); pc += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == ISUB: stack[<span class="hljs-number"><span class="hljs-number">-2</span></span>] -= stack[<span class="hljs-number"><span class="hljs-number">-1</span></span>]; stack.pop(); pc += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == ILT: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> stack[<span class="hljs-number"><span class="hljs-number">-2</span></span>] &lt; stack[<span class="hljs-number"><span class="hljs-number">-1</span></span>]: stack[<span class="hljs-number"><span class="hljs-number">-2</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: stack[<span class="hljs-number"><span class="hljs-number">-2</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span> stack.pop(); pc += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == JZ: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> stack.pop() == <span class="hljs-number"><span class="hljs-number">0</span></span>: pc = arg <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: pc += <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == JNZ: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> stack.pop() != <span class="hljs-number"><span class="hljs-number">0</span></span>: pc = arg <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: pc += <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == JMP: pc = arg; <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> op == HALT: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'Execution finished.'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">26</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> var[i] != <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'%c = %d'</span></span> % (chr(i+ord(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)), var[i])</code> </pre><br>  It remains to write the compiler itself - a code generator. <br><br><h2>  Compiler </h2><br>  The crown of our creation.  Here is its source code: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Compiler</span></span></span><span class="hljs-class">:</span></span> program = [] pc = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, command)</span></span></span><span class="hljs-function">:</span></span> self.program.append(command) self.pc = self.pc + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, node)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> node.kind == Parser.VAR: self.gen(IFETCH) self.gen(node.value) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> node.kind == Parser.CONST: self.gen(IPUSH) self.gen(node.value) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> node.kind == Parser.ADD: self.compile(node.op1) self.compile(node.op2) self.gen(IADD) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> node.kind == Parser.SUB: self.compile(node.op1) self.compile(node.op2) self.gen(ISUB) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> node.kind == Parser.LT: self.compile(node.op1) self.compile(node.op2) self.gen(ILT) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> node.kind == Parser.SET: self.compile(node.op2) self.gen(ISTORE) self.gen(node.op1.value) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> node.kind == Parser.IF1: self.compile(node.op1) self.gen(JZ); addr = self.pc; self.gen(<span class="hljs-number"><span class="hljs-number">0</span></span>); self.compile(node.op2) self.program[addr] = self.pc <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> node.kind == Parser.IF2: self.compile(node.op1) self.gen(JZ); addr1 = self.pc; self.gen(<span class="hljs-number"><span class="hljs-number">0</span></span>) self.compile(node.op2) self.gen(JMP); addr2 = self.pc; self.gen(<span class="hljs-number"><span class="hljs-number">0</span></span>) self.program[addr1] = self.pc self.compile(node.op3) self.program[addr2] = self.pc <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> node.kind == Parser.WHILE: addr1 = self.pc self.compile(node.op1) self.gen(JZ); addr2 = self.pc; self.gen(<span class="hljs-number"><span class="hljs-number">0</span></span>) self.compile(node.op2) self.gen(JMP); self.gen(addr1); self.program[addr2] = self.pc <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> node.kind == Parser.DO: addr = self.pc self.compile(node.op1) self.compile(node.op2) self.gen(JNZ); self.gen(addr); <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> node.kind == Parser.SEQ: self.compile(node.op1) self.compile(node.op2) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> node.kind == Parser.EXPR: self.compile(node.op1); self.gen(IPOP) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> node.kind == Parser.PROG: self.compile(node.op1); self.gen(HALT) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.program</code> </pre><br>  The gen () method adds a new byte (command or argument) to the program (list of bytes). <br>  In the compile () method, the entire program is built.  In fact, this method recursively traverses the node tree.  and for each type of node generates the corresponding code. <br><br>  Note the trick in conditional statements and loops.  After JMP / JZ, we first write 0, and when the branch itself is compiled and the address we need to go to is known, in order not to execute this branch, we change the value 0 to the actual address. <br><br><h2>  We are testing </h2><br>  <a href="https://gist.github.com/1415759">Here</a> is the complete source code compiler.  I used the script engine to run and test (I read Lexer from stdin): <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" i = 3;"</span></span> | ./cc.py <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" { a=3; b=5; }"</span></span> | ./cc.py <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" { a = 1; b = 2; c = a + b; }"</span></span> | ./cc.py <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" { a = 5; b = 2; c = a - b; }"</span></span> | ./cc.py <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" { a = 5; b = 2; c = b &lt; a; }"</span></span> | ./cc.py <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" { a = 5; if (a &lt; 10) a = 33; }"</span></span> | ./cc.py <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" { a = 5; if (10 &lt; a) a = 33; else { a = 1; b = 2; } }"</span></span> | ./cc.py <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" { a = 10; do { a = a - 2;} while (3 &lt; a); }"</span></span> | ./cc.py <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" { a = 1; b = 5; while (a &lt; b) { a = a + 3; }}"</span></span> | ./cc.py</code> </pre><br>  Answers machine gave out seems to be correct. <br><br><h2>  What's next? </h2><br>  Our compiler has no applications.  But the experience gained. <br>  I hope you want to write your own compiler even more.  Then it is better to start with languages ‚Äã‚Äãwith simple syntax, for example.  <a href="http://en.wikipedia.org/wiki/Tiny_BASIC">TinyBasic</a> or <a href="http://en.wikipedia.org/wiki/PL/0">PL / 0</a> . <br>  If you want to read the source code of other compilers, then I advise you to pay attention to the work of Bellard ( <a href="http://bellard.org/otcc/">otcc</a> ), <a href="">tinyc</a> , <a href="http://bellard.org/tcc/">tcc</a> , <a href="http://www.cpm.z80.de/small_c.html">smallC</a> , <a href="http://www.cpm.z80.de/small_c.html">lcc</a> . </div><p>Source: <a href="https://habr.com/ru/post/133780/">https://habr.com/ru/post/133780/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133772/index.html">Hacking HDCP copy protection using MitM attacks</a></li>
<li><a href="../133775/index.html">Release IDE Arduino 1.0!</a></li>
<li><a href="../133776/index.html">Extensions for Google Chrome. Part one. Getting started</a></li>
<li><a href="../133777/index.html">Live Nyancat in your terminal</a></li>
<li><a href="../133778/index.html">Performance Comparison JSON-serializer for .NET</a></li>
<li><a href="../133781/index.html">MySQL query optimization using custom variables</a></li>
<li><a href="../133782/index.html">Google translate + Asterisk IVR</a></li>
<li><a href="../133783/index.html">What operating systems and distributions do you use on the servers?</a></li>
<li><a href="../133784/index.html">Getting Realization Experience. Part 1 of 2</a></li>
<li><a href="../133787/index.html">Creating a highly sensitive directional antenna with phased arrays or why specialists go abroad</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>