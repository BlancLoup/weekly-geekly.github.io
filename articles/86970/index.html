<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The first steps into the world of programming under nanoCAD</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When free nanoCAD 2.0 was released last November, we said that the release version already has application development tools. In particular, for the m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The first steps into the world of programming under nanoCAD</h1><div class="post__text post__text-html js-mediator-article">  When free nanoCAD 2.0 was released last November, we said that the release version already has application development tools.  In particular, for the majority of users it is possible to quickly write utilities and small applications using scripts (scripts) based on ActiveX Automation (Java-script or VB-script).  But who knows how to seize this opportunity?  :-) <br>  I propose to make joint first steps into the world of programming under nanoCAD and create a small program that interacts with the user via the command line and automatically draws lines in a given order on the working drawing nanoCAD.  Starting from this script and giving free rein to your imagination, you can make your own application, which, for example, automatically makes a diploma for you :-) <br>  In this demo, we should get something like this: <br> <a href=""><img src="http://www.archicad.ru/assets/images/habr/vbsimgmainsmall.png"></a> <br>  And we need the following for this: <br><ul><li>  nanoCAD 2.0 (can be downloaded on the website <a href="http://www.nanocad.ru/">nanocad.ru</a> or <s>torrents.ru</s> <a href="http://rutracker.org/forum/viewtopic.php%3Ft%3D2453755">rutracker.org</a> ); </li><li>  any text editor (i use <a href="http://notepad-plus.sourceforge.net/ru/site.htm">notepad ++</a> ). </li></ul><br>  By the way, are you looking for an interesting job related to programming?  We have open vacancies: <a href="http://habrahabr.ru/company/nanosoft/vacancies/">http://habrahabr.ru/company/nanosoft/vacancies/</a> <br><a name="habracut"></a><br><h2>  Formulation of the problem </h2><br>  In what language is it not important to write the executed script: nanoCAD supports both Java script and Visual Basic Script.  For this article, I chose VB, since lately I have been using it more often. <br>  When I reflected on the basis of what to demonstrate the work of the VB script, I had a desire to translate any LISP script to a VB script, demonstrating in such a way that this is possible.  Searching the Internet, I came across a course project ‚Äú <a href="http://works.tarefer.ru/50/100097/index.html">Developing a LISP program for constructing Sierpinski‚Äôs i-th order curves</a> ‚Äù.  It contains a fairly detailed algorithm that explains how to use the recursive functions to construct the figure shown in Figure 1. Let's do the same, but on VBS. <br><table><tbody><tr><td> <a href=""><img src="http://www.archicad.ru/assets/images/habr/vbsimg02sml.png"></a> </td></tr><tr><td>  Figure 1. The 4th order Sierpinski curve, by the example of which we consider the principles of programming under nanoCAD. </td></tr></tbody></table><br><br><h2>  Program structure </h2><br>  VBS-program under nanoCAD does not imply any input function - the script starts to run from the first lines to the end.  The basic procedure of the program is quite simple - one cycle.  Let's start with it: <br><table><tbody><tr><th>  LISP code </th><th>  VBS Code </th></tr><tr><td><code>( setq h ( div *SquareSize* 4 ) ) <br> ( setq x0 ( div *MaxX* 2 ) ) <br> ( setq y0 ( + ( div *MaxY* 2 ) h ) ) <br> <br> do (( i 1 )) <br> (( eql i ( + Count 1 ) ) 'Done ) <br> ( setq x0 ( - x0 h ) ) <br> ( setq h ( div h 2 ) ) <br> ( setq y0 ( + y0 h ) ) <br> ( setq Px x0 Py y0 ) <br> <br> ( A i ) <br> ( Line 1 h ) <br> ( B i ) <br> ( Line 3 h ) <br> ( C i ) <br> ( Line 5 h ) <br> ( D i ) <br> ( Line 7 h ) <br> ( setq i ( + i 1 )) )</code> <br> </td><td> <code>h = SquareSize \ 4 <br> x0 = MaxX \ 2 <br> y0 = h + MaxY \ 2 <br> <br> for i = 1 to count <br> <br> x0 = x0 - h <br> h = h \ 2 <br> y0 = y0 + h <br> Px = x0 <br> Py = y0 <br> A(i) <br> Line 1, h <br> B(i) <br> Line 3, h <br> C(i) <br> Line 5, h <br> D(i) <br> Line 7, h <br> next</code> <br> </td></tr></tbody></table><br>  From the code (and from the description of the course project) we see that the Sierpinski curve is constructed by four recursive functions: they are called A (), B (), C () and D () functions.  Plus, there is a specialized function Line (Direction, Size), which simply draws a regular line at the desired scale and angle.  The definitions of these functions are performed by conventional means of VBS ‚Äî for example, function A () will look like this on LISP and VBS: <br><table><tbody><tr><th>  LISP code </th><th>  VBS Code </th></tr><tr><td> <code>defun A ( k ) <br> ( cond ( ( &gt; k 0 ) <br> ( A ( - k 1 ) ) <br> ( Line 1 h ) <br> ( B ( - k 1 ) ) <br> ( Line 0 ( * 2 h ) ) <br> ( D ( - k 1 ) <br> ( Line 7 h ) <br> ( A ( - k 1 ) ) <br> ) )</code> <br> </td><td> <code>Sub A(k) <br> if k &gt; 0 then <br> A(k-1) <br> Line 1, h <br> B(k-1) <br> Line 0, 2 * h <br> D(k-1) <br> Line 7, h <br> A(k-1) <br> End If <br> End Sub</code> <br> </td></tr></tbody></table><br>  These additional five functions are placed at the end of the main script.  It remains only to learn how to display graphics in nanoCAD and how to interact with the user. <br><br><h2>  The first steps </h2><br>  First, the VB script is a plain text file with the .vbs extension.  It can be invoked in the nanoCAD environment using the VBS command (see Figure 2, respectively, the Java script using the JS command).  Everything is simple - we specify the path to the script and, if it is written without errors, then it is executed.  If errors are made in the script, a message about this will appear on the command line. <br><table><tbody><tr><td><img src="http://www.archicad.ru/assets/images/habr/vbsimg01.png"></td></tr><tr><td>  Figure 2. Java and Visual Basic scripts are invoked by the JS and VBS commands, respectively. </td></tr></tbody></table><br>  VB syntax is absolutely standard, so feel free to use DIM, SET, FOR-NEXT, IF-THEN-ELSE, variable declarations, arrays, standard functions (such as CStr () or MsgBox ()), function declarations and / or integer division operations .  Everything should work and especially I will not teach it :-) <br>  To access the current open drawing, use ThisDrawing.  Moreover, if we plan to draw in the model space (ie, in the main drawing, the Model tab), then we define the ModelSpace collection through the following structure: <br><table><tbody><tr><td> <code>Dim ms <br> Set ms = ThisDrawing.ModelSpace</code> </td> </tr></tbody></table><br>  Access to the command line is via the Utility object.  In particular, the following script displays a classic greeting on the command line: <br><table><tbody><tr><td> <code>Dim ut <br> Set ut = ThisDrawing.Utility <br> ut.Prompt(", !")</code> </td> </tr></tbody></table><br>  Using the functions GetInteger (), GetPoint (), GetString (), GetReal (), GetEntity (), GetDistance (), GetAngle (), and some others, you can request data from the command line.  For example, like this: <br><table><tbody><tr><td> <code>Do <br> count = ThisDrawing.Utility.GetInteger("   (&gt;=1)") <br> Loop While count &lt;= 0 <br> <br> For i = 1 to count <br> point = ThisDrawing.Utility.GetPoint("0,0,0", "  ‚Ññ" &amp; i) <br> Next</code> </td> </tr></tbody></table><br>  Knowing where to display the data and how to interact with the user, we can begin to create a more meaningful program. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Basic functions </h2><br>  What other functions can be used in the program under nanoCAD?  In general, all those defined by the DWG file structure: creating a line, arc, circle, hatching, obtaining a point, polar coordinates, operations with opening / closing a file, working with layers, variables, etc.  These functions are usually described in the DWG SDK documentation: either Autodesk ( <a href="http://www.autodesk.com/">www.autodesk.com</a> , Developer Center section), or the Open Design Alliance ( <a href="http://www.opendwg.org/">http://www.opendwg.org/</a> , DWGdirect section). <br>  We will actively use the AddLine (startpoint, endpoint) function, which creates a regular 2D line.  Also in your scripts you can use: <br><ul><li>  AddCircle (center, radius) - circle; </li><li>  AddArc (center, radius, startangle, endangle) - arc; </li><li>  AddEllipse (center, majoraxis, radiusratio) - ellipse; </li><li>  AddPolyline (verticeslist) - polyline; </li><li>  AddText (textstring, insertionpoint, height) is a single-line text; </li><li>  AddMText (insertionpoint, width, text) - multiline text; </li></ul><br>  All coordinates that you transmit to nanoCAD can be three-dimensional.  In this case, initially it should be a three-dimensional array, but it is more convenient to transfer a line of the form "x, y, z", where - x, y, z are three-dimensional coordinates.  Those.  like this: <br><table><tbody><tr><td> <code>Dim ms <br> Set ptStr = CStr(x)+","+CStr(y)+","+CStr(y)</code> </td> </tr></tbody></table><br>  Even in my script, I decided to lay out the lines in different layers.  To do this, I created two new layers at the beginning of the program, and then changed the active layer: <br><table><tbody><tr><td> <code>Set oLyrLine1 = ThisDrawing.Layers.Add("") <br> Set oLyrLine2 = ThisDrawing.Layers.Add("") <br> ... <br> case 5: <br> Set oLyr = oLyrLine1 <br> case 6: <br> Set oLyr = oLyrLine2 <br> ... <br> oLine.Layer = oLyr.Name</code> </td> </tr></tbody></table><br><h2>  Result </h2><br>  This is what we get as a result - see figure 3. Of course, this result does not give practical utility (except aesthetic pleasure), but gives food for thought and self-improvement. <br><table><tbody><tr><td> <a href=""><img src="http://www.archicad.ru/assets/images/habr/vbsimg03sml.png"></a> </td></tr><tr><td>  Figure 3. Java and Visual Basic scripts are invoked by the JS and VBS commands, respectively. </td></tr></tbody></table><br><br>  The demo script can be downloaded here: <a href="">demoscript.rar</a> .  Download, unzip, for example, on C: \, open in a text editor, study and run for execution in nanoCAD 2.0.  And a little advice: do not set the order of the curves above 4 - hang :-) </div><p>Source: <a href="https://habr.com/ru/post/86970/">https://habr.com/ru/post/86970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../86960/index.html">Google Chrome usability: MRU tabs switching</a></li>
<li><a href="../86961/index.html">HDD box from dead power supply</a></li>
<li><a href="../86965/index.html">Liqpay: invoicing by SMS, proudly called POS-terminal</a></li>
<li><a href="../86966/index.html">March 12 - the first in Russia webinar ‚ÄúAVG Technologies. Antivirus protection products. Overview"</a></li>
<li><a href="../86967/index.html">Testing web projects. jsFUnit</a></li>
<li><a href="../86972/index.html">New version of Lotus Symphony 3.0 - more functionality and stability</a></li>
<li><a href="../86977/index.html">Implement Polling on Google App Engine</a></li>
<li><a href="../86978/index.html">Requirements for the layout for drupal</a></li>
<li><a href="../86979/index.html">Bringing to mind Windows Media Center with the add-on - Media Browser</a></li>
<li><a href="../86980/index.html">SMS backup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>