<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As we predicted an outflow, approaching it as a natural disaster.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes, in order to solve a problem, you just have to look at it from a different angle. Even if the last 10 years have solved such problems in the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As we predicted an outflow, approaching it as a natural disaster.</h1><div class="post__text post__text-html js-mediator-article">  Sometimes, in order to solve a problem, you just have to look at it from a different angle.  Even if the last 10 years have solved such problems in the same way with different effects, it is not a fact that this method is the only one. <br><br>  There is such a topic as customer churn.  A thing is inevitable, because customers of any company can, for a variety of reasons, take and stop using its products or services.  Of course, for a company, the outflow is a natural, but not the most desirable, action, so everyone tries to minimize this outflow.  And even better is to predict the likelihood of an outflow of a particular category of users, or a specific user, and suggest some steps to hold. <br><br>  Analyze and try to keep the client, if possible, you need, at least for the following reasons: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <b>attracting new customers is more expensive than retention procedures</b> .  To attract new customers, as a rule, you need to spend some money (advertising), while existing customers can be activated with a special offer with special conditions; </li><li>  <b>understanding customer care reasons is key to improving products and services</b> . </li></ul><br>  There are standard approaches to predict churn.  But at one of the championships on AI, we decided to take and try the Weibull distribution for this.  It is most often used for survival analysis, weather forecasting, disaster analysis, industrial engineering, and the like.  Weibull distribution is a special distribution function, parameterized by two parameters <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x3BB;</mo></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.355ex" height="2.057ex" viewBox="0 -780.1 583.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMATHI-3BB" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo>Œª</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-1"> Œª </script>  and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMATHI-6B" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> k </script>  . <br><br> <a href="https://habr.com/ru/company/rostelecom/blog/444694/"><img src="https://habrastorage.org/webt/aq/g8/a0/aqg8a0b7d5eha5dgdrxtfvogwcm.png" width="400"></a> <br>  <i>Wikipedia</i> <br><br>  In general, the thing is entertaining, but for predicting the outflow, and indeed in Fintech, which is not used so often.  Under the cut, we‚Äôll tell you how we (the Laboratory of Data Mining) did this by winning gold in the Artificial Intelligence Championship in the nomination ‚ÄúAI in banks‚Äù. <br><a name="habracut"></a><br><h2>  About outflow in general </h2><br>  Let's take a quick look at what a customer churn is and why it is so important.  For business, customer base is important.  New clients come to this base, for example, having learned about a product or service from advertising, they live for some time (they actively use products) and after a while cease to use.  This period is called the ‚ÄúCustomer Lifecycle‚Äù (English Customer Lifecycle) is a term describing the steps that a customer goes through when he becomes aware of a product, makes a purchase decision, pays, uses and becomes a loyal consumer, and ultimately stops using one reason or another products.  Accordingly, the outflow is the final stage of the client's life cycle, when the client ceases to use the services, and for business this means that the client has ceased to make a profit and in general any benefit. <br><br>  Each bank customer is a specific person who chooses a particular bank card specifically for his needs.  Often travels - useful card with miles.  Buys a lot - hello, card with cashback.  Buys a lot in specific stores - and for this there is already a special affiliate plastic.  Of course, sometimes the card is selected and the criterion of "The cheapest service."  In general, there are enough variables. <br><br>  And another person chooses the bank itself - is there any point in choosing a bank card whose branches are only in Moscow and the region when you are from Khabarovsk?  Whether the card of such a bank is at least 2 times more profitable, the presence of bank branches nearby is still an important criterion.  Yes, 2019 is already here and digital is our everything, but a number of issues with some banks can be solved only in the branch.  Plus, again, some part of the population trusts a physical bank much more, and not an application in a smartphone, this should also be taken into account. <br><br>  As a result, a person may have many reasons for rejecting bank products (or the bank itself).  I changed jobs, and the card rate changed from payroll to "For mere mortals", which is less profitable.  Moved to another city where there are no bank branches.  Did not like communication with unqualified cashier in the office.  That is, there may even be much more reasons for closing an account than for using a product. <br><br>  And the client can not just explicitly express his intention - to come to the bank and write a statement, but simply stop using the products without terminating the contract.  Here, to understand these problems, it was decided to use machine learning and AI. <br><br>  Moreover, customer churn can occur in any industry (telecom, Internet service providers, insurance companies, in general, wherever there is a customer base and periodic transactions). <br><br><h2>  What we did </h2><br>  First of all, it was necessary to describe a clear boundary - how long do we begin to consider the client gone?  From the point of view of the bank that provided us with the data for work, the client's activity status was binary - it is either active or not.  There was an ACTIVE_FLAG flag in the ‚ÄúActivity‚Äù table, the value of which could be either ‚Äú0‚Äù or ‚Äú1‚Äù (respectively, ‚ÄúInactive‚Äù and ‚ÄúActive‚Äù).  And everything is good, but the person is such that he can actively use some time, and then fall out of the number of active people for a month - he fell ill, went to another country to rest, or even went to test a card of another bank.  Or after a long period of inactivity, once again start using the services of the bank <br><br>  Therefore, we decided to call the inactivity period a certain continuous period of time, during which the flag for it was set to ‚Äú0‚Äù. <br><br><img src="https://habrastorage.org/webt/z8/02/rs/z802rsv-4dlnhqqr9xk23ooyzu4.png"><br><br>  Clients transition from inactive to active after periods of inactivity of various lengths.  We have an opportunity to calculate the degree of empirical value ‚Äúreliability of periods of inactivity‚Äù - that is, the probability that a person will again begin using the products of the bank after temporary inactivity. <br><br>  For example, this graph shows the resumption of activity (ACTIVE_FLAG = 1) of clients after several months of inactivity (ACTIVE_FLAG = 0). <br><br><img src="https://habrastorage.org/webt/vi/xo/cq/vixocqqdpx_txxmdfbvqjaioc-i.png"><br><br>  Here we will slightly clarify the data set we started working with.  So, the bank provided aggregated information for 19 months in the following tables: <br><br><ul><li>  ‚ÄúActivity‚Äù - monthly transactions of clients (via cards, in the Internet bank and in a mobile bank), including payroll and turnover information. </li><li>  "Cards" - data on all the cards that the customer has, with a detailed tariff scale. </li><li>  "Contracts" - information about the client's contracts (both open and closed): loans, deposits, etc., with an indication of the parameters of each. </li><li>  "Clients" - a set of demographic data (gender and age) and the availability of contact information. </li></ul><br>  To work we needed all the tables, except for the "Map". <br><br>  The difficulty here was more than that - in these data the bank did not indicate what kind of activity was carried out on the cards.  That is, we could understand whether there were transactions or not, but we could no longer determine their type.  Therefore, it was unclear whether the client was withdrawing cash, whether he was paid a salary, or whether he was spending money on purchases.  And we did not have data on account balances, which would be useful. <br><br>  The sample itself was unbiased - at this time for 19 months the bank did not make any attempts to retain customers and minimize churn. <br><br>  So, about the periods of inactivity. <br><br>  To formulate the definition of outflow, you must select the period of inactivity.  To create an outflow prediction at time <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi><mi>t</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.679ex" height="1.937ex" viewBox="0 -728.2 723 834" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMATHI-74" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMATHI-74" x="361" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-3"> tt </script>  , you must have a customer history of at least 3 months in the interval <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mi>t</mi><mo>&amp;#x2212;</mo><mn>3</mn><mo>;</mo><mi>t</mi><mo>&amp;#x2212;</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.013ex" height="2.66ex" viewBox="0 -832 5172.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMATHI-74" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMAIN-2212" x="862" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMAIN-33" x="1862" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMAIN-3B" x="2363" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMATHI-74" x="2808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMAIN-2212" x="3392" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMAIN-31" x="4393" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMAIN-5D" x="4893" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mi>t</mi><mo>‚àí</mo><mn>3</mn><mo>;</mo><mi>t</mi><mo>‚àí</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-4"> [t - 3; t - 1] </script>  .  Our history was limited to 19 months, so we decided to take a period of inactivity of 6 months, if it exists.  And for the minimum period for a qualitative forecast they took 3 months.  Figures in 3 and 6 months we took empirically based on the analysis of the behavior of customer data. <br><br>  We formulated the definition of churn as follows: client churn month <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMATHI-6B" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> k </script>  this is the first month with ACTIVE_FLAG = 0, where at least six zeros from this month go in the field ACTIVE_FLAG, in other words, the month since which the client has been inactive for 6 months. <br><br><img src="https://habrastorage.org/webt/dr/h8/cl/drh8clajw5h0q5adiei2q4tdvva.png"><br>  <i>Number of customers left</i> <br><br><img src="https://habrastorage.org/webt/z_/fu/1x/z_fu1xlznamfpfcypdacnqyzzpg.png"><br>  <i>Number of customers remaining</i> <br><br><h2>  How is considered to be outflow </h2><br>  In such competitions, and indeed in practice, the outflow is often predicted in this way.  The client uses products and services at different time intervals, data on interaction with him are represented as a feature vector of fixed length n.  Most often this information includes: <br><br><ul><li>  User-specific data (demographic data, marketing segment). </li><li> The history of using banking products and services (these are actions of customers that are always tied to a specific time or period of the interval we need). </li><li>  External data, if they managed to get - for example, reviews from social networks. </li></ul><br>  And after that, the definition of churn is derived, its own for each task.  Then use the machine learning algorithm, which predicts the likelihood of leaving the client <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMATHI-6B" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-6"> k </script>  based on a vector of factors <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>X</mi><mi>n</mi></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.215ex" height="2.057ex" viewBox="0 -780.1 1384.4 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMATHI-58" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMATHI-6E" x="1215" y="513"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>X</mi><mi>n</mi></msup></math></span></span><script type="math/tex" id="MathJax-Element-7"> X ^ n </script>  .  For learning the algorithm, use one of the well-known frameworks for the construction of ensembles of decision trees, <a href="https://xgboost.readthedocs.io/en/latest/">XGBoost</a> , <a href="https://github.com/Microsoft/LightGBM">LightGBM</a> , <a href="https://github.com/catboost/catboost">CatBoost,</a> or their modifications. <br><br>  The algorithm itself is not bad, but it is precisely in terms of forecasting outflow that it has several serious drawbacks. <br><br><ul><li>  <b>He does not possess the so-called "memory</b> . <b>"</b>  The input of the model receives a specified number of signs that correspond to the current point in time.  In order to lay information on the history of changes in parameters, it is necessary to calculate special features that characterize changes in parameters over time, for example, the number or amount of banking transactions over the past 1,2,3 months.  Such an approach can only partially reflect the nature of temporary changes. </li><li>  <b>Fixed horizon prediction.</b>  The model is able to predict the outflow of clients only for a predetermined period of time, for example, the forecast for one month ahead.  If a forecast is required for a different period of time, for example, for three months, then you need to rebuild the training sample and retrain the new model. </li></ul><br><h2>  Our approach </h2><br>  We decided right away that we would not use standard approaches.  In the championship, in addition to us, another 497 people registered, each of whom had a good experience behind them.  So trying to do something in a standard way under such conditions is not a good idea. <br><br>  And we began to solve the problems facing the binary classification model by predicting the probability distribution of customer churn time.  A similar approach can be seen <a href="https://ragulpr.github.io/assets/draft_master_thesis_martinsson_egil_wtte_rnn_2016.pdf">here</a> , it allows you to more flexibly predict the outflow and test more complex hypotheses than in the classical approach.  We chose the <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D1%2581%25D0%25BF%25D1%2580%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%2592%25D0%25B5%25D0%25B9%25D0%25B1%25D1%2583%25D0%25BB%25D0%25BB%25D0%25B0">Weibull distribution</a> for its widespread use in survival analysis as a family of distributions modeling time outflows.  Customer behavior can be viewed as a kind of survival. <br><br>  Here are examples of Weibull probability density distributions depending on parameters. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x3BB;</mo></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.355ex" height="2.057ex" viewBox="0 -780.1 583.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMATHI-3BB" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo>Œª</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-8"> Œª </script>  and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMATHI-6B" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-9"> k </script>  : <br><br><img src="https://habrastorage.org/webt/9j/xt/6w/9jxt6wjvljkqk7h8-0urxy64bru.png"><br><br>  This is the probability distribution density of a customer‚Äôs outflow of three different customers over time.  Time is presented in months.  In other words, this graph shows when the outflow of a client is likely to occur in the next two months. As you can see, a client with a distribution has a greater potential to leave before clients with Weibull (2, 0.5) and Weibull (3.1) distributions. <br><br>  The result is a model that for each client for any <br>  Month predicts the parameters of the Weibull distribution, which best reflects the onset of the probability of an outflow over time.  If more: <br><br><ul><li>  Target features on the training set are the time remaining until the outflow in a particular month for a particular client. </li><li>  If there is no outflow indicator for the client, we assume that the outflow time is more than the number of months, starting from the current and to the end of our history. </li><li>  Model used: recurrent neural network with LSTM-layer. </li><li>  As a loss function, we use the negative logarithmic likelihood function for the Weibull distribution. </li></ul><br>  Here are the advantages of this method: <br><br><ul><li>  The probabilistic distribution, in addition to the obvious possibility of binary classification, allows to predict different events flexibly, for example, will the client cease to use the services of a bank for 3 months.  Also, if necessary, various metrics can be averaged over this distribution. </li><li>  The recurrent neural network LSTM has a memory and effectively uses the entire history available.  With the expansion or refinement of history accuracy increases. </li><li>  The approach can be easily scaled when splitting time intervals into smaller ones (for example, when splitting months into weeks). </li></ul><br>  But it is not enough to create a good model, you also need to properly assess its quality. <br><br><h2>  How to evaluate the quality </h2><br>  We chose Lift Curve as a metric.  It is used in business for such cases due to clear interpretation, it is well described <a href="http://www2.cs.uregina.ca/~dbd/cs831/notes/lift_chart/lift_chart.html">here</a> and <a href="https://www.information-management.com/news/why-lift">here</a> .  If we describe the meaning of this metric in one sentence, it will turn out ‚ÄúHow many times the algorithm makes a better prediction at the first <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/rostelecom/blog/444694/&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHv8WKSx_fRqf0Lar7BtfyTCv0Sw#MJMATHI-6B" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-10"> k </script>  % than randomly. " <br><br><h2>  We train models </h2><br>  The competition conditions did not establish a specific quality metric by which one can compare different models and approaches.  Moreover, the definition of the concept of outflow may be different and may depend on the formulation of the problem, which, in turn, is determined by business goals.  Therefore, in order to understand which method is better, we have trained two models: <br><br><ol><li>  Frequently used binary classification approach using a decisive tree ensemble machine learning algorithm ( <a href="https://github.com/Microsoft/LightGBM">LightGBM</a> ); </li><li>  Model Weibull-LSTM </li></ol><br>  The test sample consisted of 500 pre-selected customers who were not in the training sample.  For the model, hyper-parameters were selected using cross-validation broken down by customers.  For training each model used the same sets of features. <br><br>  Due to the fact that the model does not have a memory, special features were taken for it, showing the ratio of changes in the parameters of one month to the average value of the parameters over the past three months.  What characterized the rate of change of values ‚Äã‚Äãover the last period of three months.  Without this, the Random Forest-based model would be in a losing position relative to Weibull-LSTM. <br><br><h2>  Than LSTM with Weibull distribution is better than approach based on ensemble of decision trees </h2><br>  It's all just a couple of pictures visually. <br><br><img src="https://habrastorage.org/webt/wq/ul/jp/wquljpjw0rwhzl6zrawpt3mivkq.png"><br>  <i>Lift Curve comparison for classic algorithm and Weibull-LSTM</i> <br><br><img src="https://habrastorage.org/webt/g2/qc/do/g2qcdo7jy459ro6ulkdmlmicaqk.png"><br>  <i>Monthly Lift Curve metric comparison for classic algorithm and Weibull-LSTM</i> <br><br>  In general, LSTM does the classic algorithm in almost all cases. <br><br><h2>  Outflow prediction </h2><br>  The model based on the recurrent neural neural network with LSTM-cells with Weibull distribution can predict outflow in advance, for example, predict the client‚Äôs departure within the next n months.  Consider the case for n = 3. In this case, for each month the neural network must correctly determine whether the client leaves, starting from the next month and up to the n-th month.  In other words, it must correctly determine whether the client will remain after n months.  This can be considered a prediction in advance: the prediction of the moment when the client has just started thinking about leaving. <br><br>  Compare the Lift Curve for Weibull-LSTM 1, 2 and 3 months before the outflow: <br><br><img src="https://habrastorage.org/webt/wq/ul/jp/wquljpjw0rwhzl6zrawpt3mivkq.png"><br><br>  We have already written above that the forecasts that are made for clients who are not active for some time are also important.  Therefore, here we will add to the sample such cases when a departed client has already been inactive for one or two months, and check that Weibull-LSTM correctly classifies such cases as outflow.  Since such cases were present in the sample, we expect the network to cope well with them: <br><br><img src="https://habrastorage.org/webt/g3/ny/sa/g3nysak-rqeskiijrddvo5gilfu.png"><br><br><h2>  Customer retention </h2><br>  Actually, this is the main thing that can be done with the information that such and such clients are preparing to stop using the product.  Speaking of building a model that could offer something useful to customers in order to keep them - this will not work if you don‚Äôt have a history of such attempts that would end well. <br><br>  We did not have such a story, so we decided this. <br><br><ol><li>  We build a model that defines interesting products for each client. </li><li>  In each month we run the classifier and determine potentially leaving customers. </li><li>  Parts of customers offer a product, according to the model of paragraph 1, we remember our actions. </li><li>  A few months later, we are looking at which of these potentially leaving customers have left and who have remained.  Thus we form a learning sample. </li><li>  We teach the model on the story obtained in paragraph 4. </li><li>  Optionally, repeat the procedure, replacing the model from clause 1 with the model obtained in clause 5. </li></ol><br>  The usual A / B testing can be used as a test of the quality of such retention - we divide clients who potentially leave into two groups.  We offer products to one based on our retention model; we offer nothing to the second.  We decided to train a model that could be useful already at point 1 of our example. <br><br>  We wanted to make segmentation as interpretable as possible.  To do this, we chose several signs that could be easily interpreted: the total number of transactions, wages, total turnover of the account, age, gender.  The signs from the ‚ÄúMaps‚Äù table were not taken into account as uninformative, and the signs from Table 3 ‚ÄúContracts‚Äù were not considered because of the complexity of processing in order to avoid data leakage between the validation set and the training set. <br><br>  Clustering was carried out using Gaussian mixture models.  Information criterion Akaike allowed to determine 2 optimum.  The first optimum corresponds to 1 cluster.  The second optimum, less pronounced, corresponds to 80 clusters.  For this result, we can draw the following conclusion: it is extremely difficult to divide the data into clusters without a priori given information.  For better clustering, we need data that describes each client in detail. <br><br>  Therefore, the task of training with a teacher was considered in order to offer each individual client a product.  The following products were considered: ‚ÄúTerm Deposit‚Äù, ‚ÄúCredit Card‚Äù, ‚ÄúOverdraft‚Äù, ‚ÄúConsumer Credit‚Äù, ‚ÄúCar Loan‚Äù, ‚ÄúMortgage‚Äù. <br><br>  In the data there was another type of product: ‚ÄúCurrent Account‚Äù.  But we did not consider him because of the low information content.  For users who are bank customers, i.e.  did not stop using his products; a model was built that predicted what product they might be interested in.  A logistic regression was chosen as a model, and the Lift value for the first 10 percentiles was used as a quality assessment metric. <br><br>  The quality of the model can be estimated in the figure. <br><br><img src="https://habrastorage.org/webt/rw/0-/eg/rw0-egqx09j2qznktsnf8ighvby.png"><br>  <i>Results of product recommendation model for customers</i> <br><br><h2>  Total </h2><br>  This approach brought us the first place in the nomination ‚ÄúAI in banks‚Äù in the Championship on AI of the RAIF-Challenge 2017. <br><br><img src="https://habrastorage.org/webt/bu/ps/57/bups57u_w9e1bdcmdzzkbs8bwlg.png" width="1000"><br><br>  Apparently, the main thing was still to approach the problem from the not very familiar side, and to use the method that is customarily used for other situations. <br><br>  Although a massive user outflow may well be a disaster for services. <br><br>  This method can be noted and for any other area where it is important to take into account the outflow, not a single bank.  For example, we used it to calculate our own outflow - in the Siberian and St. Petersburg branches of Rostelecom. <br><br>  <i>"Laboratory of Data Mining" company "Search portal" Sputnik "</i> </div><p>Source: <a href="https://habr.com/ru/post/444694/">https://habr.com/ru/post/444694/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444684/index.html">We work with neural networks: checklist for debugging</a></li>
<li><a href="../444686/index.html">Waves Smart Assets: Black and White Lists, Interval Trading</a></li>
<li><a href="../444688/index.html">Please stop talking about the repository template with Eloquent</a></li>
<li><a href="../444690/index.html">How researchers at Uber apply and scale knowledge about human behavior</a></li>
<li><a href="../444692/index.html">MOSDROID # 16 Sulfur at Redmadrobot</a></li>
<li><a href="../444696/index.html">Increasing the density of containers on a node using PFCACHE technology</a></li>
<li><a href="../444700/index.html">Random databases. Oracle Enterprise Data Quality Quality - Corporate Vault Shield and Sword</a></li>
<li><a href="../444702/index.html">New vulnerabilities have been discovered in Android and Google Photos, allowing users to steal data</a></li>
<li><a href="../444704/index.html">Opportunities nanoCAD SPDS Construction site in construction and reconstruction projects in cramped conditions</a></li>
<li><a href="../444710/index.html">We understand the protocol of consensus Stellar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>