<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a ‚Äúisland of network freedom‚Äù based on VPS in 30 minutes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In connection with the entry into force of the sensational law 149-FZ, many people in Habravchan had a question: what will happen next? Is it possible...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a ‚Äúisland of network freedom‚Äù based on VPS in 30 minutes</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/436/3d3/f1a/4363d3f1a43b36ef53e012018a100580.png" align="right">  In connection with the entry into force of the sensational law 149-FZ, many people in Habravchan had a question: what will happen next?  Is it possible that an analogue of the Great China Firewall will appear in Russia, which will block everything and everyone?  In this tutorial, I would like to consider one of the most effective and secure ways to ensure your freedom of information - your own VPS server, located far abroad and connected to you using an encrypted VPN tunnel.  Unlike tor or i2p, the confidentiality of the transmitted information is guaranteed, it is unlikely that anyone will try to decrypt your data or organize a raid on a foreign server (unless of course you are not a world-class hacker). <a name="habracut"></a><br><br><h4>  Which VPS to choose? </h4><br>  Free :) Strangely enough, but there are such, for example, a <a href="http://freevps.us/thread-1645.html">list of free VPS hosting sites</a> that I use.  Basically, these are all trial options for a period of 1 month, but nothing prevents you from choosing another trial service in a month, since the list is large.  But no one guarantees anything; if you need guaranteed confidentiality, choose paid servers in the Netherlands, the Czech Republic, Egypt and other safe countries.  But I chose the American server, firstly it was the most convenient of the freebies, and secondly, all this was started not only for security, but also for buying Nexus 7 through the Play Store (another useful application). <br>  You also need to look at the presence of a ‚Äúwhite‚Äù IP address and the way of server virtualization.  The latter is not so important in the method I chose, but if with servers with an isolated kernel (for example KVM) problems with the missing modules usually do not occur, then if the kernel is common and unmodifiable (for example, OpenVZ), you need to contact technical support (see below).  And when registering, it is better to choose a debian-like system, it is simpler and the instructions below are written for it.  The rest is up to you. <br><br><h4>  Installation and configuration </h4><br>  It took you about 15 minutes to read the first two paragraphs, search and register a VPS, the same number remained.  After you received / paid for the vps server, you need to do something with it, namely, to raise the VPN on it.  For this, I used OpenVPN - free, safe and quick to set up.  If you choose a VPS based on the popular OpenVZ - rather, write to the TP, so that you will have modules for iptables, NAT and tun enabled, the first two most likely already exist, but it is unlikely that tun.  While technical support is working (I hope it will not be so fast and will not restart the VPS at a critical moment, I personally was lucky), we will connect to it, install and configure OpenVPN: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>apt-get install openvpn</code> <br> <br>  Then there are two ways: fast and reliable. <br><br><h5>  Quick way </h5><br>  This method uses a static key-password, but it is not secure.  We generate the key: <br><br> <code>cd /etc/openvpn</code> <br> <code>openvpn --genkey --secret static.key</code> <br> <br>  Save it to your computer (cat + Ctrl-V) and create the /etc/openvpn/tun0.conf config: <br><br><pre> <code class="hljs objectivec">/etc/openvpn/tun0.conf: dev tun0 ifconfig <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> secret /etc/openvpn/<span class="hljs-keyword"><span class="hljs-keyword">static</span></span>.key</code> </pre> <br><h5>  Reliable way </h5><br>  This method enables TLS / SSL encryption on the server, but it is longer to configure.  Copy the kitchen to create keys and certificates in the folder with openvpn: <br><br> <code>cd /etc/openvpn</code> <br> <code>mkdir easy-rsa</code> <br> <code>cp -R /usr/share/doc/openvpn/examples/easy-rsa/2.0/* easy-rsa/</code> <br> <code>chmod -R +x easy-rsa/</code> <br> <br>  Initialize the script: <br><br> <code>cd easy-rsa/</code> <br> <code>source ./vars</code> <br> <code>./clean-all</code> <br> <br>  We will create a CA certificate and key, we will be asked to enter data about the certificate, we will enter any, albeit dummy: <br><br> <code>./build-ca</code> <br> <br>  Create a certificate / key for the server <br><br> <code>./build-key-server server</code> <br> <br>  Generate keys for encrypting an SSL / TSL connection <br><br> <code>./build-dh</code> <br> <br>  And create the keys for yourself: <br><br> <code>./build-key myname</code> <br> <br>  The folder / etc / openvpn / easy-rsa / keys now has all the necessary keys, for authorization we need only myname.crt, myname.key (our own certificate with key) and ca.crt (CA certificate) <br><br>  Create and edit your favorite text editor /etc/openvpn/tun.conf configuration file: <br><br><pre> <code class="hljs pgsql">port <span class="hljs-number"><span class="hljs-number">1194</span></span> proto udp #     ,  proto tcp dev tun ca /etc/openvpn/easy-rsa/keys/ca.crt #   cert /etc/openvpn/easy-rsa/keys/<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.crt key /etc/openvpn/easy-rsa/keys/<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.key #    dh /etc/openvpn/easy-rsa/keys/dh1024.pem <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> #   ,     ifconfig-pool-persist ipp.txt keepalive <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">120</span></span> comp-lzo #  ,       persist-key persist-tun status /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/openvpn-status.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> #   <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/openvpn.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> verb <span class="hljs-number"><span class="hljs-number">3</span></span> #    push "dhcp-option DNS 8.8.8.8" #    DNS   </code> </pre> <br><h4>  Check </h4><br>  Now you can run the OpenVPN server: <br><br> <code>service openvpn start</code> <br> <br>  If everything is successful, then we will be able to connect to the server using the certificates and keys downloaded above (do not forget LZO compression on the client, if enabled on the server!).  And if not, then the logs are likely to be something like <br>  Note: Cannot open TUN / TAP dev / dev / net / tun: No such file or directory <br>  This means that technical support does not work well and did not include the tun module.  And if everything is good, we will be able to ping VPS, but the Internet will not exist yet, for this we need NAT: <br><br> <code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code> <br> <code>echo net.ipv4.ip_forward=1 &gt;&gt; /etc/sysctl.conf</code> <br> <code>iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o venet0 -j SNAT --to-source SERVER_IP</code> <br> <br>  If you selected a different subnet, then specify it instead of 192.168.1.0/24.  Instead of venet0, specify the interface (hello ifconfig), which looks to the Internet, and instead of SERVER_IP, specify the external IP address of the VPS.  Now you can save iptables settings: <br><br> <code>iptables-save &gt; /etc/iptables.rules</code> <br> <br>  In /etc/rc.local: <br><br> <code>iptables-restore &lt; /etc/iptables.rules</code> <br> <br>  Put on openvpn autoload and restart openvpn server: <br><br> <code>update-rc.d openvpn defaults</code> <br> <code>service openvpn restart</code> <br> <br>  Everything!  I told you that we will manage in 30 minutes? </div><p>Source: <a href="https://habr.com/ru/post/157547/">https://habr.com/ru/post/157547/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../157533/index.html">PLC error search sequence</a></li>
<li><a href="../157537/index.html">Python performance. Easy way</a></li>
<li><a href="../157539/index.html">Dnevnik.ru now on Habrahabr</a></li>
<li><a href="../157541/index.html">Features of "national" routing</a></li>
<li><a href="../157545/index.html">Rake, or 5 typical Asterisk configuration errors</a></li>
<li><a href="../157551/index.html">Samsung has announced a new line of PCs based on Windows 8</a></li>
<li><a href="../157555/index.html">ISTQB certification for testers: why and how</a></li>
<li><a href="../157559/index.html">Veeam ONE 6.5: New operational monitoring capabilities of VMware vSphere and Microsoft Hyper-V</a></li>
<li><a href="../157561/index.html">We optimize ... we parallelize ... we take off!</a></li>
<li><a href="../157565/index.html">Internet acquiring "for dummies"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>