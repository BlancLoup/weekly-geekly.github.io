<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Spreadsheet over Google Maps</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 Have you ever needed to display large data sets with reference to a map? At work, I needed to display orders grouped by latitude and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Spreadsheet over Google Maps</h1><div class="post__text post__text-html js-mediator-article"><h1 id="vvedenie">  Introduction </h1><br><p>  Have you ever needed to display large data sets with reference to a map?  At work, I needed to display orders grouped by latitude and longitude.  And not just a static table, but a dynamic one, with different details for a different map approximation. </p><br><p>  Unfortunately (or fortunately?), I did not find ready-made solutions.  Google Maps allows you to overlay markers and shapes on maps, but these methods provide too little information.  With Yandex cards it turned out no better.  But Google Maps has a custom overlay mechanism with HTML content.  And to encapsulate this work with maps and overlays, I created the GMapsTable JavaScript library.  Perhaps someone it will be interesting or useful.  <a href="http://www.aivanf.com/static/gmt/example.html">Working example</a> </p><br><p><img src="https://www.aivanf.com/static/gmt/gmt_s0.jpg" alt="screen0"></p><a name="habracut"></a><br><p><img src="https://www.aivanf.com/static/gmt/gmt_s1.jpg" alt="screen1"></p><br><div class="spoiler">  <b class="spoiler_title">Conventions</b> <div class="spoiler_text"><p>  To avoid confusion, the zoom parameter will be called the map approximation, and the scale - the scale.  The first relates to the Google Maps API, and the second to the described library. </p></div></div><br><h1 id="zadacha-v-celom">  Overall task </h1><br><p>  So what do we have?  Some data source (for example, a server with a database that processes and sends data in JSON format) and a web page with JavaScript that requests data and visualizes it on Google Maps. </p><br><p>  The data are of an accumulative nature (in my case, each area can be assigned to: the number of orders, customers, and the average amount).  Therefore, the data can and should be displayed with different details for different approximations. </p><br><p>  Main content of HTML page for GMapsTable: </p><br><pre><code class="html hljs xml">.. <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span>: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://maps.googleapis.com/maps/api/js?key=YOUR_KEY"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.aivanf.com/static/gmt/gmapstable.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> .. <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span>: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  GMapsTable allows to abstract from interaction with GoogleMaps API.  You only need to provide the appropriate object with the data.  Time to go to javascript!  To use GMapsTable, you only need to get the DataContainer object for your div map: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// : ID div' //    GoogleMaps, //    var container = new DataContainer("map", { zoom: 9, center: {lat: 55.7558, lng: 37.6173}, mapTypeId: 'roadmap' });</span></span></code> </pre> <br><p>  And then you need to pass a couple of functions: </p><br><pre> <code class="javascript hljs">container.dataLoader = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">scale, borders</span></span></span><span class="hljs-function">) </span></span>{ ...  container.processData(some_data); } container.scaler = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">zoom</span></span></span><span class="hljs-function">) </span></span>{ ... return - ; }</code> </pre> <br><p>  But what exactly is to write inside functions? .. First, let's figure out how GMapsTable works. </p><br><h1 id="data-dlya-datacontainer">  Data for DataContainer </h1><br><p>  <code>DataContainer</code> deals with the display of your data and takes care of when it should be updated.  At the very beginning and when the approximation and the boundaries of the ‚Äúcamera‚Äù change, it tries to use the stored data, and if not, it calls the <code>dataLoader</code> function.  You need to generate an object with data and pass it to the DataContainer.processData function.  The structure of the object should be as follows: </p><br><pre> <code class="javascript hljs">data: { <span class="hljs-attr"><span class="hljs-attr">minLat</span></span>: float, <span class="hljs-attr"><span class="hljs-attr">difLat</span></span>: float, <span class="hljs-attr"><span class="hljs-attr">minLon</span></span>: float, <span class="hljs-attr"><span class="hljs-attr">difLon</span></span>: float, <span class="hljs-attr"><span class="hljs-attr">scale</span></span>: int, <span class="hljs-attr"><span class="hljs-attr">table</span></span>: [ [value, value, ...], [value, value, ...], ... ], <span class="hljs-attr"><span class="hljs-attr">tocache</span></span>: boolean }</code> </pre> <br><p>  The <code>value</code> can be a number, a string, or any object if you specify your own table cell formatting function.  The scale ( <code>sale</code> ) is an integer indicating how many parts the latitude and longitude units should be divided.  The <code>tocache</code> parameter specifies whether data for the current scale should be saved and no longer requested. </p><br><div class="spoiler">  <b class="spoiler_title">Sample data object</b> <div class="spoiler_text"><pre> <code class="javascript hljs">data: { <span class="hljs-attr"><span class="hljs-attr">minLat</span></span>: <span class="hljs-number"><span class="hljs-number">55.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">difLat</span></span>: <span class="hljs-number"><span class="hljs-number">2.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">minLon</span></span>: <span class="hljs-number"><span class="hljs-number">37.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">difLon</span></span>: <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">scale</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">table</span></span>: [ [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] ], <span class="hljs-attr"><span class="hljs-attr">tocache</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br><p>  Here the data covers the area from 55.0, 37.0 to 57.0, 38.0 and divide each unit of latitude and longitude into 2 parts (it turns out that one cell of latitude-longitude is divided into 4 parts).  It also indicates here that for a given scale this is complete data, and they should be saved for future use. </p></div></div><br><h1 id="perevod-priblizheniya-v-masshtab">  Zoom to scale </h1><br><p>  Zoom is the Google Maps API parameter, an integer between 1 (world map) and 22 (street).  It is inconvenient and impractical to request and store data for each approximation unit, therefore GMapsTable converts it to a scale - a number indicating how many parts the latitude and longitude unit should be divided into. </p><br><h1 id="sohranenie-dannyh">  Saving data </h1><br><p>  To display when changing the scale was instant, GMapsTable stores data sets for some (or all) scales.  For example, I had coordinates with almost all of Russia - about 42 thousand cells for a scale of 10 (500 KB, it is fairly easily stored and processed in my desktop browser) and 17 million for a scale of 200 (several MB, causing significant suspension) .  Therefore, the server estimates the number of cells of all data, and if there are few of them, it sends data from the entire database, otherwise only for the requested region.  It turns out this algorithm: </p><br><p><img src="https://www.aivanf.com/static/gmt/gmt_usage.png" alt="GMapsTable table update algorithm"></p><br><p>  Borders ( <code>bounds</code> ) is a JavaScript object with <code>minlat, maxlat, minlon, maxlon</code> ‚Äî current Google Maps boundaries and a good indent. </p><br><p>  In your implementation of the <code>dataLoader</code> you can safely ignore the arguments if there is no need to use different granularities for different scales or if your data does not cover such a large region.  Just transfer the data and their boundaries in latitude and longitude and <code>scale</code> , how much you break the units of latitude-longitude.  But for the <code>dataLoader</code> completeness, I suggest this behavior of the <code>dataLoader</code> function (or the server it is accessing): </p><br><p><img src="https://www.aivanf.com/static/gmt/gmt_load.png" alt="GMapsTable data object generation algorithm"></p><br><h1 id="spisok-vseh-parametrov">  List of all parameters </h1><br><p>  You can specify the following parameters for the DataContainer: </p><br><p>  1) <u><code>scaler(zoom)</code></u> - converts an approximation from GoogleMaps to a scale for GMapsTable.  Both are integers. </p><br><p>  2) <u><code>dataLoader(scale, borders)</code></u> - called when new data is needed.  Must pass a data object to <u><code>DataContainer.processData(data)</code></u> . </p><br><p>  The <u><code>borders</code></u> argument is a JavaScript object with the <code>minlat, maxlat, minlon, maxlon</code> ‚Äî the current borders of Google Maps and a good indent. </p><br><p>  3) <u><code>tableBeforeInit(map, table, data)</code></u> - called before the table begins to fill with cells.  The <u><code>map</code></u> argument is a Google Maps object, <u><code>table</code></u> is the HTML element of the created table, and <u><code>data</code></u> is the <u><code>data</code></u> object you provided for the current scale.  Here you can set up a table, some variables using current data or current map parameters. </p><br><p>  4) <u><code>cellFormatter(td, val)</code></u> - called to fill the cell.  <u><code>td</code></u> is an HTML element, a table cell.  <u><code>val</code></u> is data from your data object.  Here you can easily customize the display of several values ‚Äã‚Äãor fill color in accordance with any parameters. </p><br><p>  5) <u><code>boundsChangedListener(zoom)</code></u> - called when the boundaries of Google Maps change. </p><br><p>  6) <u><code>minZoomLevel</code></u> , <u><code>maxZoomLevel</code></u> - variables for the minimum and maximum map approximation.  Integers between 1 (world map) and 22 (street). </p><br><p>  For successful operation DataContainer only the first two functions are necessary. </p><br><h1 id="primer-i-ishodniki">  Sample and source </h1><br><p>  A full and well-commented example of use: <a href="http://www.aivanf.com/static/gmt/example.html">HTML-page</a> and <a href="">JS-code</a> . <br>  And also there is a <a href="https://github.com/AivanF/GMapsTable">GMapsTable in GitHub</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/330920/">https://habr.com/ru/post/330920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330906/index.html">Daniel Story Comics</a></li>
<li><a href="../330910/index.html">Russian Minesweeper - multiplayer version of the game "Sapper"</a></li>
<li><a href="../330914/index.html">Entertainment for intellectuals: playing ‚ÄúWhat? Where? It depends?</a></li>
<li><a href="../330916/index.html">Cloud Expo Asia Hong Kong - report from the largest IT exhibition in Asia</a></li>
<li><a href="../330918/index.html">Create faster and more optimized WordPress sites</a></li>
<li><a href="../330922/index.html">Rich Notifications, utm-tags, webhook and other innovations PushAll</a></li>
<li><a href="../330926/index.html">Startup of the day (May 2017)</a></li>
<li><a href="../330928/index.html">IT Management: What ITSM is and the ServiceNow Platform</a></li>
<li><a href="../330930/index.html">It is a little about ServiceNow, ITSM and ServiceDesk in a format of selection of useful materials</a></li>
<li><a href="../330932/index.html">40 unusual questions asked at the interview at Apple</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>