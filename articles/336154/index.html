<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Log storage for a cloud platform. ELK implementation experience</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A source 


 Hello! Today we will continue to talk about Technoserv Cloud cloud storage , but in terms of operation. No IT infrastructure is complete ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Log storage for a cloud platform. ELK implementation experience</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/3f0/2a5/52c/3f02a552cc86489ca75ae2be2bbf67e6.png"><br><p>  <em><a href="https://www.digitalocean.com/community/tutorials/how-to-install-elasticsearch-logstash-and-kibana-elk-stack-on-ubuntu-14-04">A source</a></em> </p><br><p>  Hello!  Today we will continue to talk about <a href="https://habrahabr.ru/company/technoserv/blog/329338/">Technoserv Cloud cloud storage</a> , but in terms of operation.  No IT infrastructure is complete without monitoring and management tools, and our cloud is no exception.  For everyday monitoring tasks, we use open source products, one of which is <a href="https://www.elastic.co/products">the ELK stack</a> .  In this article, we will explain how log monitoring is organized in our cloud, and how ELK helped us pass the PCI DSS audit. </p><a name="habracut"></a><br><p>  The task of centralized collection and analysis of logs can arise at any stage of the product life cycle.  In the case of Technoserv Cloud's cloud storage, the need for a single console to view logs became apparent even before launching the solution into operation; at the start of the project, a tool was needed to quickly identify problems in the systems used.  As such a tool, the ELK stack was chosen - an easy to configure and use open source product with the ability to scale. </p><br><p>  ELK is the main tool of our engineers for viewing platform logs: Elasticsearch collects logs from all servers and network equipment in use.  We are convinced that there is not a lot of logs, so our systems make log entries with the maximum level of debugging.  To receive events, use <a href="https://www.elastic.co/products/beats">Beats</a> : filebeat and winlogbeat, syslog and SNMP traps.  Networking also collects Netflow traffic information.  To date, our ELK stack processes around 1000 incoming entries per second with peaks up to 10,000 entries, while the provisional resources should be enough for a 2- / 3-fold increase in the flow of logs. </p><br><h2 id="arhitektura">  Architecture </h2><br><p>  Reliability is one of the key requirements for the systems used.  For this reason, ELK was installed in a fault-tolerant configuration: it is important for us to be sure that the logs will continue to be collected if some of the servers are unavailable. </p><br><table><thead><tr><th>  VM number </th><th>  Purpose </th><th>  Used software </th></tr></thead><tbody><tr><td>  2 </td><td>  Load balancers </td><td>  Keepalived + HAproxy + nginx </td></tr><tr><td>  four </td><td>  Receive and process incoming logs </td><td>  Logstash </td></tr><tr><td>  3 </td><td>  Master nodes of Elasticsearch cluster </td><td>  Elasticsearch </td></tr><tr><td>  6 </td><td>  Data nodes of Elasticsearch cluster </td><td>  Elasticsearch </td></tr><tr><td>  one </td><td>  User interface </td><td>  Kibana </td></tr></tbody></table><br><p>  This is the architecture of our ELK installation: </p><br><img src="https://habrastorage.org/web/38c/254/d4a/38c254d4ab024cb3860508f45fa5149c.png"><br><br><h2 id="realizaciya">  Implementation </h2><br><p>  HAproxy and nginx are used as traffic balancers, their fault tolerance is achieved using <a href="http://www.keepalived.org/">keepalived</a> , an application implementing the VRRP (Virtual Router Redundancy Protocol) routing protocol.  Keepalived is configured in a simple configuration from the master and backup node, so incoming traffic comes to the node that currently owns the virtual IP address.  Further traffic balancing in Logstash and Elasticsearch is performed using the <a href="https://ru.wikipedia.org/wiki/Round-robin_(%25D0%25B0%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC)">round-robin</a> algorithm (we still use simple solutions). </p><br><p>  For Logstash and Elasticseach, fault tolerance is achieved by redundancy: the system will continue to operate correctly even in the event of the failure of several servers.  Such a scheme is easy to configure and allows you to easily scale each of the installed components of the stack. </p><br><p>  Now we use four Logstash servers, each of which performs a full cycle of input data processing.  In the near future, we plan to split the Logstash servers according to the Input and Filter roles, and also add a RabbitMQ cluster to buffer the data sent from Logstash.  Using a message broker will eliminate the risk of data loss in the event of a disconnection between Logstash and Elasticsearch. <br>  The configuration of Elasticsearch is also simple, we use three master nodes and six data nodes. </p><br><p>  Kibana is the only component that is not reserved, since the exit of the "kibana" from the system does not affect the processes of collecting and processing logs.  To restrict access to the console, the <a href="https://github.com/elasticfence/kibana-auth-plugin">kibana-auth-plugin is used</a> , and with the help of the <a href="http://www.elastichq.org/index.html">Elastic HQ</a> plugin we can monitor the status of the Elasticsearch cluster in the web interface. </p><br><p> <a href="" title="High resolution available on click"><img src="https://habrastorage.org/web/fb0/2ee/287/fb02ee287787442fbddfb0794e0eb0a5.png"></a> </p><br><br><h2 id="netflow">  Netflow </h2><br><p>  As noted above, in addition to logs, we collect <a href="https://ru.wikipedia.org/wiki/Netflow">Netflow</a> statistics using <a href="https://www.elastic.co/guide/en/logstash/2.4/plugins-codecs-netflow.html">the boxst plugin logstash</a> .  Customized views help on-duty administrators obtain current traffic data.  It is an important tool for diagnosing network problems, since Netflow allows you to get detailed information about traffic flows within a network in cases where the network equipment logs are not enough.  The screenshot below shows the Kibana view for Netflow: diagrams show the addresses involved in traffic exchanges and the amount of received / transmitted data. </p><br><p> <a href="" title="High resolution available on click"><img src="https://habrastorage.org/web/5ae/c27/5af/5aec275afe0544afa9303091cd3c5d4b.png"></a> </p>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2 id="kontrol-sobytiy-ib">  IS event control </h2><br><p>  In May of this year, we solved the task of passing the <a href="https://ru.wikipedia.org/wiki/PCI_DSS">PCI DSS</a> certification - the data security standard of the payment card industry.  One of the requirements for compliance with this standard is the availability of an information security event monitoring system.  At the time of certification, the ELK stack was already working and collecting data from most of the equipment in use, so it was decided to use it as an information security event monitoring system.  In preparation for the audit, all system components of Technoserv Cloud were configured to send security events to ELK, including the following: </p><br><p>  ‚Ä¢ any access to customer data; <br>  ‚Ä¢ all actions performed with the use of administrative authority on servers and network equipment of the cloud platform; <br>  ‚Ä¢ any access to the event logs of Technoserv Cloud system components; <br>  ‚Ä¢ any user access to the system components of the platform; <br>  ‚Ä¢ add, change and delete accounts; <br>  ‚Ä¢ starting and stopping system components of the platform; <br>  ‚Ä¢ creation and deletion of system level objects. </p><br><p>  To demonstrate the presence of the above events in the system, Kibana views were prepared.  The screenshots below show attempts by users to access our servers and records about the execution of commands from under sudo. </p><br><p> <a href="" title="High resolution available on click"><img src="https://habrastorage.org/web/849/0e5/dc1/8490e5dc162649dc808e1160095a2309.png"></a> <br>  <em>Recorded unsuccessful access attempts</em> </p><br><p> <a href="" title="High resolution available on click"><img src="https://habrastorage.org/web/868/674/180/868674180afa48d98682bb5e4fcba363.png"></a> <br>  <em>Execution of commands on behalf of the superuser</em> </p><br><h2 id="podvodya-itogi">  Summing up </h2><br><p>  A centralized console for working with events allows you to effectively manage your IT infrastructure.  In our case with ELK we achieved the following goals: </p><br><p>  ‚Ä¢ using a single console for working with log entries, reduced the time to diagnose problems and, therefore, reduced the time of service unavailability; <br>  ‚Ä¢ using Kibana views to get information about the platform as a whole; <br>  ‚Ä¢ implemented PCI DSS requirements for recording and storing security events. </p></div><p>Source: <a href="https://habr.com/ru/post/336154/">https://habr.com/ru/post/336154/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336138/index.html">System IEEE Software Taggant: protection against false positives antivirus</a></li>
<li><a href="../336140/index.html">Auto-optimization of virtual reality or what is the difference between reproducing, timewarp and spacewarp</a></li>
<li><a href="../336142/index.html">Unscientific revolution: how not to go broke on fake innovations</a></li>
<li><a href="../336144/index.html">We measure the dynamics of mentioning entities in the information field</a></li>
<li><a href="../336152/index.html">Parallels Desktop for Mac 13: Ready for macOS High Sierra</a></li>
<li><a href="../336156/index.html">Python memory management</a></li>
<li><a href="../336158/index.html">How to remove ads from Android apps</a></li>
<li><a href="../336160/index.html">Some functional programming techniques in Python</a></li>
<li><a href="../336162/index.html">Nginx in the work of DevOps / Administrator. Dark side of power</a></li>
<li><a href="../336164/index.html">Pentestit Corporate Laboratories: Practical Information Security Skills</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>