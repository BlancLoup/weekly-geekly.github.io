<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with Arduino's COM port from a Java application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sap, Habr. Perhaps people starting arduino will be interested in how to quickly and easily organize the transfer of information between a microcontrol...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with Arduino's COM port from a Java application</h1><div class="post__text post__text-html js-mediator-article">  Sap, Habr.  Perhaps people starting arduino will be interested in how to quickly and easily organize the transfer of information between a microcontroller and a Java application.  This bundle opens up a bunch of interesting possibilities for collecting and processing data from sensors, managing various whistles, and creating their first IoT projects. <br><br>  Recently, on the Internet, I stumbled upon a very simple <a href="https://sourceforge.net/projects/javaarduinolibrary/files/%3Fsource%3Ddirectory">Java-Arduino Communication Library.</a>  Not finding publications on this topic here, I decided to share with you the experience of using.  To work, we will need the <a href="https://www.arduino.cc/en/Main/Software">Arduino IDE</a> , <a href="https://www.jetbrains.com/idea/download/">IntelliJ IDEA</a> , <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">Java SE Development Kit</a> and, in fact, the microcontroller itself (I tested it on the Chinese Arduino Nano and <a href="http://amperka.ru/product/strela">Strela</a> based on Leonardo Leonardo, everything worked perfectly for both). <br><a name="habracut"></a><br>  The task is simple - we will create a console application that, when launched, establishes a Serial connection with a microcontroller and waits for the user to enter a string in an infinite loop.  Depending on the entered string, the following options are possible: <br><br><ul><li>  "On" - the microcontroller includes an integrated LED; </li><li>  "Off" - the microcontroller turns off the built-in LED; </li><li>  "Exit" - the microcontroller turns off the built-in LED, and the application exits. </li></ul><br><h3>  Sketch for the microcontroller </h3><br>  Building a system, let's start by writing and uploading a sketch to Arduino Nano.  Nothing too complicated.  In the ‚Äúsetup‚Äù block, we configure the pin with the LED and the Serial-port, and in the ‚Äúloop‚Äù block we listen to the Serial-port for incoming bytes.  Depending on the received value, we perform this or that operation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Sketch source code</b> <div class="spoiler_text"><pre><code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/* ‚Ññ13       Uno, * Mega, Nano, Leonardo, Mini  . */</span></span> #define LED_PIN = <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { // <span class="hljs-type"><span class="hljs-type">Serial</span></span>-   <span class="hljs-number"><span class="hljs-number">9600</span></span> /c <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); //       pinMode(LED_PIN, OUTPUT); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { //   <span class="hljs-type"><span class="hljs-type">Serial</span></span>-   ()    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-type"><span class="hljs-type">Serial</span></span>.available() != <span class="hljs-number"><span class="hljs-number">0</span></span>) { //     () byte b = <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); //   <span class="hljs-string"><span class="hljs-string">'1'</span></span>,    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b == <span class="hljs-number"><span class="hljs-number">49</span></span>) digitalWrite(LED_PIN, HIGH); //   <span class="hljs-string"><span class="hljs-string">'0'</span></span>,    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b == <span class="hljs-number"><span class="hljs-number">48</span></span>) digitalWrite(LED_PIN, LOW); }</code> </pre> <br></div></div><br>  A little explanation and attention is required only to check the conditions (b == 49) and (b == 48).  If you do not understand why, then welcome under the spoiler: <br><br><div class="spoiler">  <b class="spoiler_title">The answer to the main question of life, the universe and all that</b> <div class="spoiler_text">  The thing is that when sending a symbol (Chr) '1' to the microcontroller via a Serial-connection, <a href="">ASCII is used</a> , in which the character '1' is encoded with an integer decimal value (Dec) 49. When reading a character with a microcontroller, the value of the character is '1' assigned to the integer variable byte b.  That is, in fact, the value of b is 49. <br></div></div><br>  To check at this stage, you can send 1 and 0 from the monitor built into the Arduino IDE. If the LED on the board does not turn on / off, then look for the error in your sketch. <br><br><h3>  Java application </h3><br>  Now run IntelliJ IDEA and create a new Java project.  To work, you need to connect two additional libraries: <a href="https://sourceforge.net/projects/javaarduinolibrary/files/">jSerialComm-1.3.11.jar and arduino.jar</a> .  How to add downloaded jar-archives can be read <a href="http://javadevblog.com/kak-dobavit-biblioteku-jar-fajl-v-proekt-intellij-idea.html">here</a> . <br><br>  The entire application will consist of a single class: <br><br><div class="spoiler">  <b class="spoiler_title">Java source code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> arduino.Arduino; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Scanner; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppMain</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> InterruptedException </span></span>{ Scanner scanner = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Scanner(System.in); Arduino arduino = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Arduino(<span class="hljs-string"><span class="hljs-string">"COM52"</span></span>, <span class="hljs-number"><span class="hljs-number">9600</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> connected = arduino.openConnection(); System.out.println(<span class="hljs-string"><span class="hljs-string">" : "</span></span> + connected); Thread.sleep(<span class="hljs-number"><span class="hljs-number">2000</span></span>); label_1: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (scanner.hasNext()) { String s = scanner.nextLine(); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (s) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"on"</span></span>: arduino.serialWrite(<span class="hljs-string"><span class="hljs-string">'1'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"off"</span></span>: arduino.serialWrite(<span class="hljs-string"><span class="hljs-string">'0'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"exit"</span></span>: arduino.serialWrite(<span class="hljs-string"><span class="hljs-string">'0'</span></span>); arduino.closeConnection(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> label_1; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: System.out.println(s + <span class="hljs-string"><span class="hljs-string">" -   "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } }</code> </pre></div></div><br>  To work with the COM port, an Arduino class object is created.  The constructor takes two parameters: <br><br><ol><li>  String portDescrition - COM port name </li><li>  int baud_rate - transfer rate </li></ol><br>  It is better to specify these parameters immediately in the constructor, but you can set them separately using setters.  The name of the COM port can be viewed in the Arduino IDE, or in the device manager.  The transfer speed must match the one specified in the ‚Äúsetup‚Äù block of the sketch for the microcontroller, in this case 9600 baud / c: <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> setup() { // <span class="hljs-type"><span class="hljs-type">Serial</span></span>-   <span class="hljs-number"><span class="hljs-number">9600</span></span> /c <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); //       pinMode(LED_PIN, OUTPUT); } }</code> </pre> <br>  Next, you need to establish a connection using the openConnection () method.  The method returns true if the connection is successful.  We will output this value to the console to make sure that the actions performed are correct. <br><br>  <b>Important:</b> after opening the connection, you must pause using the Thread.sleep () method, in this case 2000 milliseconds.  Arduino Nano turned out to be a real brawl compared to Strela, which could be sent immediately after the connection was established.  It is possible that your controller will need even more time.  Therefore, if the connection is established, the data is sent, but does not come, then first of all increase the amount of pause. <br><br>  Now we enter an infinite loop and start waiting for input from the user: <br><br><pre> <code class="java hljs"> label_1: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (scanner.hasNext()) { String s = scanner.nextLine(); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (s) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"on"</span></span>: arduino.serialWrite(<span class="hljs-string"><span class="hljs-string">'1'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"off"</span></span>: arduino.serialWrite(<span class="hljs-string"><span class="hljs-string">'0'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"exit"</span></span>: arduino.serialWrite(<span class="hljs-string"><span class="hljs-string">'0'</span></span>); arduino.closeConnection(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> label_1; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: System.out.println(s + <span class="hljs-string"><span class="hljs-string">" -   "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre> <br>  When you enter the next string and press "enter", it is read and saved in the variable String s.  Depending on the value of this string, the switch statement sends the character '1' or '0' to the microcontroller using the serialWrite (char c) method.  Do not forget that when the microcontroller receives these symbols and stores them in an integer variable, you will get 49, or 48). <br><br>  In general, you can use the following overloaded methods of the Arduino class to send data: <br><br><ol><li>  public void serialWrite (String s); </li><li>  public void serialWrite (char c); </li><li>  public void serialWrite (String s, int noOfChars, int delay); </li><li>  public void serialWrite (char c, int delay); </li></ol><br>  As you can see, you can send the entire string, the character and part of the characters of the string (noOfChars).  In the latter two methods, you can specify a pause after sending the next character.  However, the string will still be sent character by character (or, to be more precise, bit by bit).  Therefore, if you do not transmit any particular value (for example, the angle to which the connected servo drive is to be installed), then it is easier to send just one character. <br><br>  At the end of the program, it is desirable to close the COM-port using the close.connection () method so that when you restart the program you do not get an error related to the fact that the COM port is still busy, and to exit from an infinite loop waiting for a string, use the operator break with the <b>label_1</b> label, which allows you to exit the loop, preceded by the corresponding label: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"exit"</span></span>: arduino.serialWrite(<span class="hljs-string"><span class="hljs-string">'0'</span></span>); arduino.closeConnection(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> label_1;</code> </pre><br>  That's all for today.  I hope the article will be something useful for you.  Soon I will try to write the following one, which will consider the possibility of not only sending, but also receiving data from the microcontroller using the example of a more applied and functional application. </div><p>Source: <a href="https://habr.com/ru/post/340630/">https://habr.com/ru/post/340630/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340612/index.html">Classes of matrices and vectors in Delphi</a></li>
<li><a href="../340616/index.html">OSX / Proton backdoor distributed with Trojanized Elmedia Player</a></li>
<li><a href="../340618/index.html">Security Week 42: KRACK WiFi, a hole in Intel processors, 250 Oracle patches</a></li>
<li><a href="../340620/index.html">A bug in finding emails on Mail.Ru</a></li>
<li><a href="../340626/index.html">The world in which IPv6 is well invented</a></li>
<li><a href="../340632/index.html">Chess for common development: the history of the development program</a></li>
<li><a href="../340634/index.html">We write a simple counter of unique words in Python with a GUI on Tkinter</a></li>
<li><a href="../340638/index.html">Purchase of a modern Intel server with NVMe P4800X</a></li>
<li><a href="../340642/index.html">Add Basic Auth to a SOAP request using ksoap2-android</a></li>
<li><a href="../340646/index.html">Traveling from Moscow to Kazan through St. Petersburg or the process of developing an algorithm for finding all paths</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>