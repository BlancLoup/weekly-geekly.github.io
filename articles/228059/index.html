<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We are friends with your software with antiviruses: how to avoid false positives</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post I want to talk about how the problem of false triggering antivirus on our product was solved. 



 If you have no such problems, but you ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We are friends with your software with antiviruses: how to avoid false positives</h1><div class="post__text post__text-html js-mediator-article">  In this post I want to talk about how the problem of false triggering antivirus on our product was solved. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a89/1b7/e3f/a891b7e3f466fb9d41b85754fe87dfed.jpg"><br><br>  If you have no such problems, but you are planning to protect your software with a tread - I recommend you to familiarize yourself with the material, since most likely you will have to go through the same. <br><a name="habracut"></a><br><h4>  Step 1. Code signing </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/e8d/1d4/58d/e8d1d458d4bced17fb9ce66665aa5365.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The most effective way is to sign your executable files, if this is not done, the antiviruses will scan them with a special bias. <br><br>  In order to convince of the importance of this step, <a href="http://alexander-bagel.blogspot.ru/">Alexander (Rouse_) Bagel</a> kindly shared a good <a href="http://rouse.drkb.ru/other.php">example</a> .  In the application under test, the protector is not used, there is no access to the Internet, it performs only one function - it counts CRC32 files.  Let's compare the reports of <a href="https://www.virustotal.com/ru/file/a681be72921d760abc06f2d76287f4409b2711817f3d159e71f3e3a332fe15c6/analysis/1403193892/">signed</a> and <a href="https://www.virustotal.com/ru/file/8c12490e1902b894dcf9d8e7fa983cabbf907812c37f46e857bbae289cf82e38/analysis/1403193095/">unsigned</a> files: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/707/df4/ca3/707df4ca31c4ad0d6a20abdb5ff17f25.png"><br><br>  I think this is a sufficient argument in favor of the signature. <br><br>  I will not describe the technical side of obtaining a certificate and signing the file.  I received a certificate in the <a href="https://startssl.com/">startssl</a> (bribed with a price and Russian-language support) for a Class 1 person for $ 100 for two years without any red tape.  To obtain a certificate for an LLC (Class 2), it was difficult to find a notary lawyer in Moscow who would send his opinion by digitally signed Class 2 e-mail ... <br><br>  Approval of antiviruses is only a side advantage of the signed software, but the main charms are an increase in customer confidence, they say, ‚ÄúHaving CPU means not a collective farm!‚Äù.  Also, antiviruses, firewalls and UAC will not warn about the increased threat. <br><br><h4>  Step 2. Angry letters </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/f4d/39d/e94/f4d39de94945579899dce6f4a5d6e984.jpg"><br><br>  A file is signed or not, but if someone swears at a virus counter (hereinafter VT), it‚Äôs time to write letters.  Find out where to send complaints about false positives help special lists: <br><br><ul><li>  <a href="http://www.geekstogo.com/forum/topic/273320-where-to-submit-false-positives-to-antivirus-and-security-vendors/">www.geekstogo.com/forum/topic/273320-where-to-submit-false-positives-to-antivirus-and-security-vendors</a> </li><li>  <a href="http://forum.sysinternals.com/malware-policy-please-read_topic11134.html">forum.sysinternals.com/malware-policy-please-read_topic11134.html</a> </li><li>  <a href="http://www.segura.ca/files.html">www.segura.ca/files.html</a> </li><li>  <a href="http://www.techsupportalert.com/content/how-report-malware-or-false-positives-multiple-antivirus-vendors.htm">www.techsupportalert.com/content/how-report-malware-or-false-positives-multiple-antivirus-vendors.htm</a> </li></ul><br><br>  Be prepared that the reaction of virlabovtsev to treatment takes a couple of weeks. <br><br><h4>  Step 3. Automatic check of VirusTotal on the build server </h4><br>  If you do not use mounted protections, then everything is simple, collected the release, uploaded it to VT, wrote off complaints and that's it.  But in the case of the use of protectors there is an option to reduce the number of false positives without sending abuses. <br><br>  A bit of theory.  When recompiling the same source code, the contents of the exe file does not change (except for time stamps in the headers).  Therefore, rebuilding and re-sending to VT will not solve the situation with false positives: the one who cursed will curse again. <br><br>  It is quite another thing when using a protector (in my case VMProtect), which at each file processing forms a unique virtual machine (instructions, handlers) and the corresponding virtualized code.  This unique data can either contain the signatures of a virus, or not, hence the likelihood that the anti-virus will miss the file after re-protecting it. <br><br>  Re-protection takes less time than waiting for a response from the Virlabians, but they have to do a truly hellish routine with their hands, because re-protecting 20 times in anticipation of a miracle is quite a working scenario.  To automate this process, the VirusTotalScan utility was written, which will be discussed further. <br><br><h5>  We use VirusTotalScan </h5><br>  You can download the <a href="">link</a> .  The program is console, the result of the work is returned by the exit code: there are no 0 viruses, 1-virus is found, 2-something else happened.  Call syntax: <br><br><pre><code class="hljs markdown">VirusTotalScan.exe api<span class="hljs-emphasis"><span class="hljs-emphasis">_key _</span></span> [<span class="hljs-string"><span class="hljs-string">/ignore [_</span></span>][<span class="hljs-symbol"><span class="hljs-symbol"> ...</span></span>]] api<span class="hljs-emphasis"><span class="hljs-emphasis">_key   VirusTotal API _</span></span>     _  ,   </code> </pre> <br><br>  To use the required access key to the VirusTotal API, which can be obtained on the site <a href="https://virustotal.com/">virustotal.com</a> after registration: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/105/649/6a9/1056496a9c5f0a0ba480c48842416e93.png"><br><br>  I will give the integration into the build server by my example, the build uses a .bat script: <br><br><pre> <code class="hljs vbscript">:VMPROTECT <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> EXIST <span class="hljs-string"><span class="hljs-string">"~program.exe"</span></span> DEL <span class="hljs-string"><span class="hljs-string">"~program.exe"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rem</span></span>    echo Compiling <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> WMProtect VMProtect_Con.exe <span class="hljs-string"><span class="hljs-string">"program.exe"</span></span> <span class="hljs-string"><span class="hljs-string">"~program.exe"</span></span> -pf <span class="hljs-string"><span class="hljs-string">"program.exe.vmp"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> ERRORLEVEL <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ERROR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rem</span></span>    signtool.exe ... :VirusTotalScan <span class="hljs-keyword"><span class="hljs-keyword">rem</span></span>     VirusTotal <span class="hljs-keyword"><span class="hljs-keyword">rem</span></span>   Qihoo<span class="hljs-number"><span class="hljs-number">-360</span></span>  CMC VirusTotalScan.exe <span class="hljs-number"><span class="hljs-number">1</span></span>fe0ef5feca2f84eb450bc3617f839e317b2a686af4d651a9bada77a522201b0 <span class="hljs-string"><span class="hljs-string">"~program.exe"</span></span> /ignore <span class="hljs-string"><span class="hljs-string">"Qihoo-360"</span></span> <span class="hljs-string"><span class="hljs-string">"CMC"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rem</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> ERRORLEVEL <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> VirusTotalScan <span class="hljs-keyword"><span class="hljs-keyword">rem</span></span>  ,  <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> ERRORLEVEL <span class="hljs-number"><span class="hljs-number">1</span></span> ( echo Vireses finded. RECOMPILE. <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> VMPROTECT ) <span class="hljs-keyword"><span class="hljs-keyword">rem</span></span>  ,   <span class="hljs-keyword"><span class="hljs-keyword">rem</span></span>    DEL <span class="hljs-string"><span class="hljs-string">"program.exe"</span></span> COPY <span class="hljs-string"><span class="hljs-string">"~program.exe"</span></span> <span class="hljs-string"><span class="hljs-string">"program.exe"</span></span> DEL <span class="hljs-string"><span class="hljs-string">"~program.exe"</span></span></code> </pre><br><br>  From the example, everything should be clear.  Ironically, the program itself received one false positive, wrote off the complaint - now I wait a couple of weeks for a decision. <br><br><h4>  Conclusion </h4><br>  In conclusion, I want to thank <a href="http://alexander-bagel.blogspot.ru/">Alexander</a> , with whose filing the article began, and to warn you - it is not always possible to resolve the issue with the Virlabians. </div><p>Source: <a href="https://habr.com/ru/post/228059/">https://habr.com/ru/post/228059/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../228041/index.html">Storage Performance</a></li>
<li><a href="../228043/index.html">Mobile marketing: how to distinguish "live" traffic from "garbage"</a></li>
<li><a href="../228047/index.html">8 things that are not worth living in Silicon Valley</a></li>
<li><a href="../228049/index.html">Preemptive multitasking on Z80 assembler</a></li>
<li><a href="../228055/index.html">New technology allowed paralyzed man to control his own hand</a></li>
<li><a href="../228061/index.html">Traffic Inspector and competitors: who to whom?</a></li>
<li><a href="../228063/index.html">Experience with Roskomnadzor of personal data operators over the past year</a></li>
<li><a href="../228065/index.html">Dell prepares for the arrival of ARM processors in servers (part 2)</a></li>
<li><a href="../228067/index.html">PyCon Russia 2014 - two days of python-happiness</a></li>
<li><a href="../228069/index.html">Yii 1.1.15 (security fix)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>