<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hiding the process in Windows Task Manager</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Intro 
 Often, anonymity and secrecy play a key role in the successful implementation of any actions both in reality and in virtuality, particularly i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hiding the process in Windows Task Manager</h1><div class="post__text post__text-html js-mediator-article"><h5>  Intro </h5><br>  Often, anonymity and secrecy play a key role in the successful implementation of any actions both in reality and in virtuality, particularly in operating systems.  This article will discuss how to become anonymous in Windows OS.  All information is provided for informational purposes only. <br><br>  So, we will try to hide from the user's eyes in the Windows Task Manager.  The way in which we will achieve this is extremely simple with respect to those that are based on intercepting nuclear (often undocumented) functions and on creating our own drivers. <br><blockquote>  <b><u>The essence of the method:</u></b> search for the Task Manager window -&gt; search in it for a child window (list) containing the names of all processes -&gt; delete our process from the list. </blockquote><br><br>  As you can see, no manipulations will be carried out with our process: it worked as it did and will work for itself.  As a standard ordinary Windows user, as a rule, does not use any other tools to view the running processes on his computer, this will only play into our hands.  The process will not be detected in most cases. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>What was used for research:</b> <br><br>  1) <a href="http://www.radarsync.com/software/s204004-">Spy ++</a> from Microsoft (to study the hierarchy of child windows Task Manager) <br>  2) <a href="http://www.ollydbg.de/">OllyDBG</a> to view the functions used by the dispatcher to get a snapshot of processes. <br>  3) Actually, <u>taskmng.exe</u> itself (Task Manager) <br><a name="habracut"></a><br>  For writing code, we will use the Delphi environment.  Rather, Delphi will be more convenient in our case than C ++.  But this is only my <s>humble</s> opinion. <br><br>  Well, first of all we will try to find out what the list of processes is and how it works.  From a half-view, it is clear that this is a normal window of the SysListView32 class (list), which is updated at a frequency of 2 frames per second (every 0.5 seconds).  We look at the hierarchy of windows: <br><br><img src="https://habrastorage.org/storage2/944/237/9a9/9442379a9a24b2ce6a05008907be8b02.png"><br><br>  As you can see, the list of processes, in fact, is the usual window of the ‚ÄúSysListView32‚Äù class, which is a child of the ‚ÄúProcesses‚Äù window (tab), which is also a child of the main Task Manager window.  We have only a double level of nesting.  In addition, the list has one child window of the ‚ÄúSysHeader32‚Äù class, which, as it is not difficult to guess, is the title (field marker) for the list of processes. <br>  Since we have a regular list, we have a whole set of <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ff485960(v%3Dvs.85).aspx">macros</a> at our disposal <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ff485960(v%3Dvs.85).aspx">to manage its contents.</a>  Their diversity, at first glance, delights.  But many of them work only from the parent process, that is, in order for us to use them, it will be necessary to imitate, as if they are executed in the parent process.  But not everyone has such a property, in particular, the <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb761237(v%3Dvs.85).aspx">ListView_DeleteItem</a> macro command, which deletes an item from the list-window (the ‚ÄúSysListView32‚Äù class). <br>  We will use it in the process of <b>our</b> application.  This function receives the index of the element to be deleted by the second parameter. <br>  Now we need to somehow figure out what kind of index the element has with the label of the hidden process in the task manager.  To do this, we need to somehow pull out all the elements from the list of processes in the task manager (labels with the names of the processes) and consistently compare them with the name of the process that we want to hide. <br><br>  Using macros of the <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb774982(v%3Dvs.85).aspx">ListView_GetItemText</a> type, our actions would be approximately as follows: <br><br><blockquote>  1) Memory allocation in task manager process ( <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366890(v%3Dvs.85).aspx">VirtualAllocEx</a> ) <br>  2) Sending the Task Manager child window a message LVM_GETITEMTEXT ( <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms644950(v%3Dvs.85).aspx">SendMessage</a> ) <br>  3) Write to the selected memory area of ‚Äã‚Äãthe Task Manager information about the item in the list ( <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms681674(v%3Dvs.85).aspx">WriteProcessMemory</a> ) <br>  4) Reading from the dispatcher‚Äôs memory the information that interests us about the process ( <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms680553(v%3Dvs.85).aspx">ReadProcessMemory</a> ) <br></blockquote><br><br>  Using this method, you can easily "shoot yourself in the foot" by counting the offset bytes from the beginning of the various structures used in the code.  Also, this method will be quite difficult for those who are not very deep in WinAPI, so we immediately remove it to the side.  In other matters, to find the implementation of this method on the Internet will not be difficult.  Instead, I will suggest that you form your own list of processes, and already focusing on it, look for the coveted process index in the Task Manager process list. <br><br>  Microsoft decided not to worry about the tool called Task Manager, and used the usual WinAPI functions to get all the processes in the system.  We look at <b>taskmng.exe superficially</b> under the debugger: <br><br><img src="https://habrastorage.org/storage2/56b/0c6/790/56b0c67905dab64fd5f2b71d7c3561f0.png"><br><br>  We see the use of the WinAPI <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms682489(v%3Dvs.85).aspx">CreateToolHelp32SnapShot</a> function. <br>  Everyone knows that this function can be used not only to obtain a snapshot of processes, but also process flows or modules, for example.  But in this case it is unlikely.  It is unlikely that they will use something like the enumerator of processes ( <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms682629(v%3Dvs.85).aspx">EnumProcesses</a> ). <br>  We stopped at the fact that we want to create our own list of processes and look for our process in it.  To do this, use the function found in the debugger.  If we open the task manager on the ‚ÄúProcesses‚Äù tab, we note that all processes are sorted alphabetically for easy retrieval.  Therefore, we need to get a list of the names of all processes in the system <u>and sort them in ascending order in alphabetical order</u> .  Let's start writing code in Delphi. <br><br>  To begin with, we will create a demo window application with two timers: the first one will reshape the list with processes with the same frequency with which the Windows Task Manager does it (every two seconds);  the second will trigger 1000 times per second and will serve to track the update of the list of processes in the manager and, therefore, the appearance of our hidden process.  Also add a button to the form. <br><br><h5>  Code: </h5><br><pre><code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ind:integer; h:Thandle; last_c:integer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> th:THandle; entry:PROCESSENTRY32; b:boolean; i,new_ind:integer; plist:TStringList; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//   plist:=TStringList.Create; //    th := CreateToolHelp32SnapShot(TH32CS_SNAPPROCESS,0); entry.dwSize:=sizeof(PROCESSENTRY32); b:=Process32First(th,entry); while(b) do begin plist.Add(entry.szExeFile); b:=Process32Next(th,entry); end; //  ,    //   ,     plist.Sort; last_c:=plist.Count; //     'explorer.exe' for i:=1 to plist.Count-1 do if(LowerCase(plist[i])='explorer.exe') then new_ind:=i-1; //     if(new_ind&lt;&gt;ind) then ListView_DeleteItem(h,ind); ind:=new_ind; plist.Free; //        if(Form1.Timer2.Enabled=false) then Form1.Timer2.Enabled:=true; end; procedure TForm1.HideProcessButton(Sender: TObject); begin //     'SysListView32' h:=FindWindow(nil,'  Windows'); h:=FindWindowEx(h,0,nil,''); h:=FindWindowEx(h,0,'SysListView32',nil); //      Timer1.Enabled:=true; end; procedure TForm1.Timer1Timer(Sender: TObject); begin UpdateList(); end; procedure TForm1.Timer2Timer(Sender: TObject); begin //     if(ListView_GetItemCount(h)&gt;last_c) then ListView_DeleteItem(h,ind); last_c:=ListView_GetItemCount(h); end;</span></span></code> </pre> <br><br>  That's the whole code. <br>  We hide, for example, in the Task Manager the process of the Task Manager itself: <br><br>  Here it is: <br><br><img src="https://habrastorage.org/storage2/10b/287/389/10b287389c4b21148f0962e9df2069d4.png"><br><br>  And by clicking on the "Hide process" button, the process disappears from the list: <br><br><img src="https://habrastorage.org/storage2/5bc/034/80e/5bc03480e82217d3befbcef0df023d4d.png"><br><br>  All traces of presence in the system are erased, and he calmly runs as usual somewhere in the depths of the processor :) <br><br><h5>  Outro </h5><br>  Well, I think this way deserves to exist, though it requires minor improvements.  Yes, of course, it cannot be used to hide the process from the system itself, but hiding in the standard Windows tool, which is used by the lion‚Äôs share of all users, is not bad either. <br>  I hope I managed to interest you at least a little bit with this topic. <br><br>  See you later!  And may the power of anonymity be with you ... </div><p>Source: <a href="https://habr.com/ru/post/180933/">https://habr.com/ru/post/180933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../180923/index.html">Simple JSON Schema validator for Objective-C</a></li>
<li><a href="../180925/index.html">Introduction to Wolfram Mathematica</a></li>
<li><a href="../180927/index.html">Server Visualization: NodeJS + D3.js + PhantomJS</a></li>
<li><a href="../180929/index.html">One of the six remaining in working condition Apple-1 computers sold for $ 671,400</a></li>
<li><a href="../180931/index.html">In open offices, employees are more often ill and worse off.</a></li>
<li><a href="../180935/index.html">Writing your template engine in Python</a></li>
<li><a href="../180937/index.html">New look at old MS Ajax</a></li>
<li><a href="../180939/index.html">Decorators in PHP. Implementation of the extension</a></li>
<li><a href="../180941/index.html">Using RESTful Controllers for AngularJS Resources</a></li>
<li><a href="../180943/index.html">Microsoft has patented the achievement system for watching TV.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>