<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MVC 2: Complete Localization Guide</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we will look at all aspects of localizing an ASP.NET MVC based web application. I am using the latest available MVC 2 RC 2 version at...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MVC 2: Complete Localization Guide</h1><div class="post__text post__text-html js-mediator-article"><img src="http://img695.imageshack.us/img695/3133/aspnetmvc2.png" alt="image" align="left">  In this article, we will look at all aspects of localizing an ASP.NET MVC based web application.  I am using the latest available MVC 2 RC 2 version at the time of writing this topic. <br><br>  Before we begin, I would like to thank the MVC team, great job guys, I enjoy the process of writing web applications when I use this framework.  I was looking for a framework of this type, after some experience with Ruby on Rails. <br><br>  We will consider the following issues: <br><ol><li>  Validation of views </li><li>  Simple crop switching mechanism </li><li>  Localization of model validation messages </li><li>  Localization of the DisplayName attribute </li><li>  Cache and localization </li></ol>  To work, you will need Visual Studio 2008 Express and ASP.NET MVC 2 RC2, as well as create a new MVC 2 web project. <br><a name="habracut"></a><br><h3>  View localization </h3><br>  Of course, resource files will be used for localized text, but we will not use standard asp.net folders for storage. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I suggest the following directory structure: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1b4/3d2/885/1b43d2885ef68a1c78951f21fbdaf3c8.png" alt="image"><br><br>  <b>Views</b> - resource files for aspx pages.  <b>Models</b> - resource files for localizing view models. <br><br>  The Views directory contains subfolders for each controller in which resource files are located (the number of files depends on the set of supported languages). <br><br>  <b>Models</b> contains subdirectories for each view model group.  For the generated Account models (LogOn, Register, ChangePassword), we have an Account folder and resource files for each language culture. <br><br><h4>  Resource files </h4><br>  A few words about the rules for naming resource files.  Resource files have the following name format: <br>  [RESOURCE-NAME]. [CULTURE] .resx <br><br>  RESOURCE-NAME is the file name.  It can be absolutely anyone.  It is used to group when we have several resource files with the same resource-name - they constitute a single resource with different cultures specified in CULTURE. <br><br>  CULTURE - indicator of the resource file culture.  Cultures are of two types: <b>neutral</b> and <b>accurate</b> .  Neutral cultures consist only of a language code ( <b>en</b> , <b>ru</b> , <b>de</b> , etc.).  Exact cultures consist of a language code and a region code ( <b>en-US</b> , <b>en-UK</b> ) <br><br>  There is also a special meaning for resource files that have no culture defined, they are called ‚Äúdefault‚Äù or ‚Äúfall-back‚Äù cultures.  As you can guess by name, they are used for resource files if the text was not found in a specific culture resource file or when there is no file for a given culture.  I strongly recommend that you use the basic resource files, especially if the user has the ability to somehow install an unsupported culture. <br><br>  A few examples of resource files: <br><br>  MyStrings.en-US.resx - US English <br><br>  MyStrings.en-UK.resx - English United Kingdom <br><br>  MyStrings.en.resx - neutral English (default for English) <br><br>  MyStrings.ru.resx - neutral Russian <br><br>  MyStrings.resx - the base resource file. <br><br>  Great, now we are ready to localize something and see how it works.  I will show you a small example of the localization of the header in the created web application.  In the example I will use two languages: English (by default) and neutral Russian, but you can use any other languages. <br><br>  First of all, create a folder structure, as I described above, we will need resource files for the parent Site.Master page.  I will create a <b>Shared</b> directory in <b>Resources \ Views</b> and add two resource files: <br><br>  <b>SharedStrings.resx</b> - the basic resource file with data in English. <br><br>  <b>SharedStrings.ru.resx</b> - the basic resource file with data in Russian. <br><br>  Add and fill in the ‚ÄúTitle‚Äù property in both files. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/975/82f/4ff/97582f4ff2c7ffe8c030285004aa2ced.png" alt="image"><br><br>  <b>Important!</b>  Make sure that the <b>access modifiers</b> for each resource file are set to <b>public</b> .  Also check that the resource files have the value of the ‚ÄúCustom Tool‚Äù property equal to <b>‚ÄúPublicResXFileCodeGenerator‚Äù</b> .  Otherwise, resource files will not be compiled and available. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/81a/343/b7e/81a343b7e3e54cbb7f02ae321449ba74.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/fbd/7cb/81f/fbd7cb81f42947c91d65e47261c6c071.png" alt="image"><br><br>  A few words about the resource file namespace.  The files created in this way will have the following namespace: <br><br>  <font color="#333399">[PROJECT-NAME] .Resources.Views.Shared</font> <br><br>  To improve readability and compliance with the naming rules, I changed the properties of the <b>Custom Tool Namespace</b> of resource files to <b>ViewRes</b> (for view resource files). <br><br>  It's time to make changes to the Site.Master page. <br><br><blockquote><code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">="title"</font> <font color="#0000ff">&gt;</font> <br> <br> <font color="#0000ff">&lt;</font> <font color="#800000">h1</font> <font color="#0000ff">&gt;</font> My MVC Application <font color="#0000ff">&lt;/</font> <font color="#800000">h1</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font></font></code> </blockquote>  change to <br><blockquote> <code><font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">="title"</font> <font color="#0000ff">&gt;</font> <br> <br> <font color="#0000ff">&lt;</font> <font color="#800000">h1</font> <font color="#0000ff">&gt;</font> <font>&lt;%</font> =ViewRes.SharedStrings.Title <font>%&gt;</font> <font color="#0000ff">&lt;/</font> <font color="#800000">h1</font> <font color="#0000ff">&gt;</font> <br> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font></code> </blockquote> <br>  Run the application and make sure that everything works and you see the title in the right place (it should now be read from the resource file).  If everything works, let's move on to showing how to change the culture. <br><br>  To change the culture, we need to change the CurrentCulture and CurrentUICulture properties of the CurrentThread object for <b>each</b> request !!!  To do this, we will place the code that changes the culture in the <font color="#333399">Application_AcquireRequestState</font> <b>Global.asax</b> method (this method is an event handler and is called for each request) <br><br>  Add the following code to the Global.asax.cs file: <br><blockquote> <code><font color="black"><font color="#0000ff">protected</font> <font color="#0000ff">void</font> Application_AcquireRequestState( <font color="#0000ff">object</font> sender, <font color="#2B91AF">EventArgs</font> e) <br> { <br> <font color="#008000">//Create culture info object</font> <br> CultureInfo ci = <font color="#0000ff">new</font> CultureInfo( <font color="#A31515">"en"</font> ); <br> <br> System.Threading.Thread.CurrentThread.CurrentUICulture = ci; <br> System.Threading.Thread.CurrentThread.CurrentCulture = CultureInfo.CreateSpecificCulture(ci.Name); <br> }</font> <br></code> </blockquote><br>  Run the application again and make sure that it works.  Next, we change the string parameter of the CulturInfo constructor (in my case it will be ‚Äúru‚Äù) and rerun the project.  You should have the following: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e4b/3f1/b9a/e4b3f1b9a158f75ca1a1c5b2487182b6.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6fb/244/076/6fb2440767bd7f34a3c3ea90b6bbbbc0.png" alt="image"><br><br>  That's all.  We localized the Site.Master title and you can do this with any text. <br><br><h3>  Simple crop switching mechanism </h3><br>  In the previous chapter, we successfully localized the application title, but there was no possibility to change the culture in real time.  Now we are going to create a mechanism that will help us monitor culture settings in real time. <br><br>  The repository for the user-selected culture will be the session object.  And to change the culture, post links for each language on the master page.  Clicking links will trigger some action in the Account controller, which changes the session value to the corresponding culture. <br><br>  Add the following code to the AccountController class: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> ActionResult ChangeCulture( <font color="#0000ff">string</font> lang, <font color="#0000ff">string</font> returnUrl) <br> { <br> Session[ <font color="#A31515">"Culture"</font> ] = <font color="#0000ff">new</font> CultureInfo(lang); <br> <font color="#0000ff">return</font> Redirect(returnUrl); <br> }</font></code> </blockquote> <br>  We have an action method with two parameters, the first is the culture code, the second is the address for redirecting the user back to the original page.  All you need is to set a new collection culture for the session, but do not forget to add a check of the received user data to prevent the installation of an unsupported culture. <br><br>  Now create a simple user control that contains references to cultures.  Add a new partial view (partial view) to the <b>Views \ Shared</b> directory, name the file <i>CultureChooserUserControl.ascx</i> and paste the following into it: <br><blockquote> <code><font color="black"><font>&lt;%</font> = Html.ActionLink( <font color="#A31515">"English"</font> , <font color="#A31515">"ChangeCulture"</font> , <font color="#A31515">"Account"</font> , <br> <font color="#0000ff">new</font> { lang = <font color="#A31515">"en"</font> , returnUrl = <font color="#0000ff">this</font> .Request.RawUrl }, <font color="#0000ff">null</font> ) <font>%&gt;</font> <br> <font>&lt;%</font> = Html.ActionLink( <font color="#A31515">""</font> , <font color="#A31515">"ChangeCulture"</font> , <font color="#A31515">"Account"</font> , <br> <font color="#0000ff">new</font> { lang = <font color="#A31515">"ru"</font> , returnUrl = <font color="#0000ff">this</font> .Request.RawUrl }, <font color="#0000ff">null</font> ) <font>%&gt;</font></font> <br></code> </blockquote><br>  So, we have created two links, the first for English, and the second for Russian.  It's time to put this control on the Site.Mater page.  I will add it in, next to the login form. <br><br>  Find and replace in the &lt;div id = "logindisplay"&gt; code with the following: <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">="logindisplay"</font> <font color="#0000ff">&gt;</font> <br> <font>&lt;%</font> Html.RenderPartial( <font color="#A31515">"LogOnUserControl"</font> ); <font>%&gt;</font> <br> <font>&lt;%</font> Html.RenderPartial( <font color="#A31515">"CultureChooserUserControl"</font> ); <font>%&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font></font></code> </blockquote> <br>  What is left to do?  And the most important thing remains, we place the object of information about the culture in the session, but do not use it anywhere.  Again make changes to the Global.asax.cs file Application_AcquireRequestState method: <br><blockquote> <code><font color="black"><font color="#0000ff">protected</font> <font color="#0000ff">void</font> Application_AcquireRequestState( <font color="#0000ff">object</font> sender, <font color="#2B91AF">EventArgs</font> e) <br> { <br> <font color="#008000">//     </font> <br> <font color="#0000ff">if</font> ( <font color="#2B91AF">HttpContext</font> .Current.Session != <font color="#0000ff">null</font> ) <br> { <br> CultureInfo ci = (CultureInfo) <font color="#0000ff">this</font> .Session[ <font color="#A31515">"Culture"</font> ]; <br> <font color="#008000">// ,     </font> <br> <font color="#008000">//    </font> <br> <font color="#008000">//     </font> <br> <font color="#0000ff">if</font> (ci == <font color="#0000ff">null</font> ) <br> { <br> <font color="#008000">//    -  </font> <br> <font color="#0000ff">string</font> langName = <font color="#A31515">"en"</font> ; <br> <font color="#008000">//    HTTP </font> <br> <font color="#0000ff">if</font> ( <font color="#2B91AF">HttpContext</font> .Current.Request.UserLanguages != <font color="#0000ff">null</font> &amp;&amp; <font color="#2B91AF">HttpContext</font> .Current.Request.UserLanguages.Length != 0) <br> { <br> <font color="#008000">// </font> <br> langName = <font color="#2B91AF">HttpContext</font> .Current.Request.UserLanguages[0].Substring(0, 2); <br> } <br> ci = <font color="#0000ff">new</font> CultureInfo(langName); <br> <font color="#0000ff">this</font> .Session[ <font color="#A31515">"Culture"</font> ] = ci; <br> } <br> <font color="#008000">//    </font> <br> Thread.CurrentThread.CurrentUICulture = ci; <br> Thread.CurrentThread.CurrentCulture = CultureInfo.CreateSpecificCulture(ci.Name); <br> } <br> }</font></code> </blockquote> <br>  Having launched the application, we will get the next page, clicking on the links will reload the page with the selected culture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5db/db0/cd0/5dbdb0cd0a683a0f00992dc722c1b80b.png" alt="image"><br><br><h3>  Localization of model validation messages </h3><br>  I found an excellent solution to this problem, published by Phil Haak, but since this article should be a complete guide, I can not touch on this issue, and there are certain ambiguities that I would like to clarify.  But above all, I recommend reading the <a href="http://haacked.com/archive/2009/12/07/localizing-aspnetmvc-validation.aspx">post by Phil Haak</a> <br><br>  I will explain how to localize validation messages for the Account model, especially for RegistrationModel.  I also want to describe how to localize validation messages to Membership, which are registered directly in the code of the AccountController controller. <br><br>  So, let's create <i>ValidationStrings.resx</i> and <i>ValidationStrings.ru.resx</i> in the <b>Resources \ Models \ Account</b> folder (make sure that the access modifiers are public).  As you may have guessed, we will store validation messages in these files. <br><br>  I created the following properties in both files (example English): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fca/fca/e56/fcafcae56b19e03cb497f6210ef32adc.png" alt="image"><br><br>  We need to change our models as follows (example RegisterModel): <br><blockquote> <code><font color="black">[PropertiesMustMatch( <font color="#A31515">"Password"</font> , <font color="#A31515">"ConfirmPassword"</font> , <br> ErrorMessageResourceName = <font color="#A31515">"PasswordsMustMatch"</font> , <br> ErrorMessageResourceType = <font color="#0000ff">typeof</font> (ValidationStrings))] <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> RegisterModel <br> { <br> [Required(ErrorMessageResourceName = <font color="#A31515">"Required"</font> , ErrorMessageResourceType = <font color="#0000ff">typeof</font> (ValidationStrings))] <br> [DisplayName( <font color="#A31515">"Username"</font> )] <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> UserName { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> [Required(ErrorMessageResourceName = <font color="#A31515">"Required"</font> , ErrorMessageResourceType = <font color="#0000ff">typeof</font> (ValidationStrings))] <br> [DataType(DataType.EmailAddress)] <br> [DisplayName( <font color="#A31515">"Email"</font> )] <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> Email { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> [Required(ErrorMessageResourceName = <font color="#A31515">"Required"</font> , ErrorMessageResourceType = <font color="#0000ff">typeof</font> (ValidationStrings))] <br> [ValidatePasswordLength(ErrorMessageResourceName = <font color="#A31515">"PasswordMinLength"</font> ,ErrorMessageResourceType = <font color="#0000ff">typeof</font> (ValidationStrings))] <br> [DataType(DataType.Password)] <br> [DisplayName( <font color="#A31515">"Password"</font> )] <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> Password { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <br> [Required(ErrorMessageResourceName = <font color="#A31515">"Required"</font> , ErrorMessageResourceType = <font color="#0000ff">typeof</font> (ValidationStrings))] <br> [DataType(DataType.Password)] <br> [DisplayName( <font color="#A31515">"Confirm password"</font> )] <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> ConfirmPassword { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> }</font></code> </blockquote> <br>  We will add the <i>ErrorMessageResourceName</i> and <i>ErrorMessageResourceType properties</i> to the <i>Required</i> , <i>PropertiesMustMatch</i> and <i>ValidatePasswordLength</i> attributes, where <i>ErrorMessageResourceType</i> is the type of resource class in which messages are stored, and <i>ErrorMessageResourceName</i> is the property name.  Unfortunately, there is no strictly typed version of the property reading, so make sure that these magic strings have the correct values. <br><br>  We are almost at the goal, the detail remained small.  We have two own validation attributes <i>PropertiesMustMatchAttribute</i> and <i>ValidatePasswordLenghtAttribute</i> , in which we have to change <i>CultureInfo.CurrentUICulture</i> in the <i>FormatErrorMessage</i> method to <i>CultureInfo.CurrentCulture</i> , otherwise in our case it will earn nothing. <br><br>  Run the application, go to the registration page, select the language for changing the culture and get approximately the following when sending an empty form: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f0/182/9b1/2f01829b1fb605ec679b3c1e3a1486b1.png" alt="image"><br><br>  Oh, as you noticed, we forgot to localize the property names in the view models and got a little porridge.  To do this, we need to localize the values ‚Äã‚Äãof the DisplayName attribute, but this is not as simple as it seems at first glance.  I will talk about this in the next chapter, and now let's finish the remaining detail.  This is the localization of validation messages Membership API. <br><br>  Open AccountController and navigate to the end of the file, there should be an ErrorCodeToString method that creates an error message if the user registration failed.  All messages are hard coded.  All we need to do is create the appropriate properties for each message in the already created ValidationStrings resource file and put them there instead of text in the ErrorCodeToString method. <br><br>  That's all with the validation model.  It's time for DisplayName! <br><br><h3>  Localization of the DisplayName attribute </h3><br>  As we noted in the previous chapter, the DisplayName value participates in validation messages that use parameters for formatting.  Another reason to think about the DisplayName attribute is the text field labels in the HTML form, they were created with the participation of the DisplayName value. <br><br>  The real problem is that the DisplayName does not support localization; there is no way to associate it with the resource file, from where it will take the value. <br><br>  This means that we need to extend the DisplayNameAttribute and rewrite the DisplayName property so that it returns the localized name.  I created an inherited class and called it LocalizedDisplayName. <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> LocalizedDisplayNameAttribute : DisplayNameAttribute <br> { <br> <font color="#0000ff">private</font> PropertyInfo _nameProperty; <br> <font color="#0000ff">private</font> Type _resourceType; <br> <br> <font color="#0000ff">public</font> LocalizedDisplayNameAttribute( <font color="#0000ff">string</font> displayNameKey) <br> : <font color="#0000ff">base</font> (displayNameKey) <br> { <br> <br> } <br> <br> <font color="#0000ff">public</font> Type NameResourceType <br> { <br> <font color="#0000ff">get</font> <br> { <br> <font color="#0000ff">return</font> _resourceType; <br> } <br> <font color="#0000ff">set</font> <br> { <br> _resourceType = <font color="#0000ff">value</font> ; <br> <font color="#008000">// nameProperty,     set'</font> <br> _nameProperty = _resourceType.GetProperty( <font color="#0000ff">base</font> .DisplayName, BindingFlags.Static | BindingFlags.Public); <br> } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">string</font> DisplayName <br> { <br> <font color="#0000ff">get</font> <br> { <br> <font color="#008000">//,nameProperty null      </font> <br> <font color="#0000ff">if</font> (_nameProperty == <font color="#0000ff">null</font> ) <br> { <br> <font color="#0000ff">return</font> <font color="#0000ff">base</font> .DisplayName; <br> } <br> <br> <font color="#0000ff">return</font> ( <font color="#0000ff">string</font> )_nameProperty.GetValue(_nameProperty.DeclaringType, <font color="#0000ff">null</font> ); <br> } <br> } <br> }</font></code> </blockquote> <br>  An important detail is the understanding that we need to read the value of a property every time it is requested, so the GetValue method is called in the get'er of the DisplayName property, and not in the constructor. <br><br>  To store the displayed names, I created the <i>Names.resx</i> and <i>Names.ru.resx</i> resource files in the <b>Resources \ Models \ Account</b> folder and created the following properties. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/706/505/922/70650592202611bb799ef5bf5e1b9931.png" alt="image"><br><br>  Now we need to replace the DisplayName attribute with LocalizedDisplayName and provide the class type of the resource.  The modified RegisterModel code will look like this: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">[PropertiesMustMatch( <font color="#A31515">"Password"</font> , <font color="#A31515">"ConfirmPassword"</font> , <br> ErrorMessageResourceName = <font color="#A31515">"PasswordsMustMatch"</font> , <br> ErrorMessageResourceType = <font color="#0000ff">typeof</font> (ValidationStrings))] <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> RegisterModel <br> { <br> [Required(ErrorMessageResourceName = <font color="#A31515">"Required"</font> , ErrorMessageResourceType = <font color="#0000ff">typeof</font> (ValidationStrings))] <br> [LocalizedDisplayName( <font color="#A31515">"RegUsername"</font> , NameResourceType = <font color="#0000ff">typeof</font> (Names))] <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> UserName { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <br> [Required(ErrorMessageResourceName = <font color="#A31515">"Required"</font> ,ErrorMessageResourceType = <font color="#0000ff">typeof</font> (ValidationStrings))] <br> [DataType(DataType.EmailAddress)] <br> [LocalizedDisplayName( <font color="#A31515">"RegEmail"</font> , NameResourceType = <font color="#0000ff">typeof</font> (Names))] <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> Email { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <br> [Required(ErrorMessageResourceName = <font color="#A31515">"Required"</font> , ErrorMessageResourceType = <font color="#0000ff">typeof</font> (ValidationStrings))] <br> [ValidatePasswordLength(ErrorMessageResourceName = <font color="#A31515">"PasswordMinLength"</font> , <br> ErrorMessageResourceType = <font color="#0000ff">typeof</font> (ValidationStrings))] <br> [DataType(DataType.Password)] <br> [LocalizedDisplayName( <font color="#A31515">"RegPassword"</font> , NameResourceType = <font color="#0000ff">typeof</font> (Names))] <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> Password { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <br> [Required(ErrorMessageResourceName = <font color="#A31515">"Required"</font> , ErrorMessageResourceType = <font color="#0000ff">typeof</font> (ValidationStrings))] <br> [DataType(DataType.Password)] <br> [LocalizedDisplayName( <font color="#A31515">"RegConfirmPassword"</font> , NameResourceType = <font color="#0000ff">typeof</font> (Names))] <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> ConfirmPassword { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <br> }</font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Run the application and make sure that it works, it should look like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/512/7ea/52a/5127ea52a925087b33e90d3695c494f6.png" alt="image"><br><br><h3>  Cache and localization </h3><br>  A strange chapter, isn't it?  Are you thinking how to combine caching and localization?  Well, let's imagine the following scenario: open HomeController and add the OutputCache attribute to the Index action method: <br><blockquote> <code><font color="black">[OutputCache(Duration=3600, VaryByParam= <font color="#A31515">"none"</font> )] <br> <font color="#0000ff">public</font> ActionResult Index() <br> { <br> ViewData[ <font color="#A31515">"Message"</font> ] = <font color="#A31515">"Welcome to ASP.NET MVC!"</font> ; <br> <br> <font color="#0000ff">return</font> View(); <br> }</font></code> </blockquote> <br>  Launch the application and try to change the language on the Index page to check that the title is still loyal. <br><br>  Damn it!  You probably thought that caching and lokazilatsiya can not be used together?  Do not worry, there is a solution to this problem :) <br><br>  What do you know about OutputCache, or rather, what do you know about the VaryByCustom property?  It's time to use it. <br><br>  When we request the Index page for the first time, OutputCache caches the page.  In the second query (when we click on the language selection link) OutputCache thinks that nothing has changed and returns the result from the cache, therefore the page is not re-created.  That's why the choice of language did not work.  To resolve this problem, we need to somehow tell OutputCache that the version of the page has changed (as in the case when the action gets a certain parameter and we pass it to the properties of VaryByParam). <br><br>  VaryByCustom is an ideal candidate for our solution to the problem and there is a special method in the System.Web.HttpApplication class in the Global.asax.cs file.  We will rewrite the standard implementation of this method: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">string</font> GetVaryByCustomString( <font color="#2B91AF">HttpContext</font> context, <font color="#0000ff">string</font> <font color="#0000ff">value</font> ) <br> { <br> <font color="#0000ff">if</font> ( <font color="#0000ff">value</font> .Equals( <font color="#A31515">"lang"</font> )) <br> { <br> <font color="#0000ff">return</font> Thread.CurrentThread.CurrentUICulture.Name; <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">base</font> .GetVaryByCustomString(context, <font color="#0000ff">value</font> ); <br> }</font></code> </blockquote> <br>  First, the method checks if the value of the parameter matches ‚Äúlang‚Äù (no special value, a simple string that is used as the value of VaryByCustom) and, if so, returns the name of the current culture.  Otherwise, it returns the value of the standard implementation. <br><br>  Now we add the VaryByCustom property with the value ‚Äúlang‚Äù to each OutputCache attribute that you want to use in localization and that's it.  The updated Index action method is as follows: <br><br><blockquote> <code><font color="black">[OutputCache(Duration=3600,VaryByParam= <font color="#A31515">"none"</font> , VaryByCustom= <font color="#A31515">"lang"</font> )] <br> <font color="#0000ff">public</font> ActionResult Index() <br> { <br> ViewData[ <font color="#A31515">"Message"</font> ] = <font color="#A31515">"Welcome to ASP.NET MVC!"</font> ; <br> <font color="#0000ff">return</font> View(); <br> }</font></code> </blockquote> <br>  Try to start the application again and enjoy working the switching of crops. <br><br>  We finished the last chapter and, I hope, I did not miss anything. </div><p>Source: <a href="https://habr.com/ru/post/86331/">https://habr.com/ru/post/86331/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../86324/index.html">Are you ready to pay for the SMS notification service?</a></li>
<li><a href="../86326/index.html">USB 3.0 - it won't hurt us!</a></li>
<li><a href="../86327/index.html">March 5 - Softkey and PROMT company hold a free webinar ‚ÄúPROMT 8.5: solution of any translation task‚Äù</a></li>
<li><a href="../86329/index.html">TDU2: massive open online races</a></li>
<li><a href="../86330/index.html">PHP collaboration application with Kannel SMS Gateway</a></li>
<li><a href="../86332/index.html">Cross on Russian Science</a></li>
<li><a href="../86333/index.html">How I caught a hacker 2</a></li>
<li><a href="../86335/index.html">Chronicles Ubisoft: fashionable protection lasted a day</a></li>
<li><a href="../86337/index.html">How to register for the Third Minsk Startup Weekend?</a></li>
<li><a href="../86338/index.html">Minsk StartUp Weekend: New Perspectives for IT Projects</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>