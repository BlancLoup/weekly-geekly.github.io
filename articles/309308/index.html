<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Wi-Fi positioning "cheap and cheerful." About the frequency of measurements or is Wi-Fi positioning possible in real time?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the third, while the final article in the Wi-Fi series of positioning is ‚Äúcheap and cheerful‚Äù: when specialized client devices and specialized...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Wi-Fi positioning "cheap and cheerful." About the frequency of measurements or is Wi-Fi positioning possible in real time?</h1><div class="post__text post__text-html js-mediator-article">  This is the third, while the final article in the Wi-Fi series of positioning is ‚Äúcheap and cheerful‚Äù: when specialized client devices and specialized infrastructure are not used, but only publicly available personal devices (smartphones, tablets, laptops) and the usual Wi-Fi infrastructure are used. <br><br>  In the first two articles, I focused on the accuracy and accuracy of positioning, without touching upon the issue of frequency of measurements.  If the Client is in a static position, the frequency of measurements is not critical, and if the Client moves, then the frequency of measurements starts to play a significant role. <br><br>  The starting point when calculating the frequency of measurements is such a characteristic as the characteristic speed of movement of Customers.  For a person it is 5km / h or 1.5 m / s.  To ensure real-time positioning, the time interval between two measurements should not exceed twice the positioning accuracy, which allows you to build sufficiently accurate for practical purposes the trajectory of movement. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The accuracy of the classic positioning of the tests conducted in the previous article was about five meters with 90% confidence.  In this case, the frequency of measurements should be at least 6.6 s (or 13.3 seconds for an accuracy of 10 meters).  It now remains to find out what the actual measurement frequency is and whether it corresponds to the stated positioning accuracy. <br><br>  For tests using a smartphone on Android 4.4.4 and a laptop with Windows 7. <br><br>  Well, the goal is clear, the means are clear, let's get started! <br><a name="habracut"></a><br>  In specialized positioning systems, the frequency of measurements can be controlled at the level of operation of the wireless adapter drivers and software, adjusting the information transfer intervals, thereby adjusting to the client‚Äôs characteristic speed and positioning accuracy. <br><br>  With personal Wi-Fi devices (smartphones, tablets, laptops) the situation is different: we can only work with what is defined in the IEEE 802.11-2012 standards, the manufacturer's drivers, operating system settings. <br><br><h3>  Frequency of measurements, and what is it? </h3><br>  Access points (TDs) use a Wi-Fi client (Client) signal positioning (RSSI) for positioning.  I will name the presence on the TD of one measured signal level of the Customer Measurement. <br><br>  To solve the positioning problem, it is necessary to have at least one Measurement from three access points.  So that there is no confusion, I will call such a set a Sample. <br><br><h3>  Is it difficult to get a sample? </h3><br>  The access points, the Samples of which form the Sample, generally operate on three different channels, say, first, sixth and 11th (this is connected with the work of the IEEE 802.11 standards). <br><br>  In accordance with the IEEE 802.11 standards, the Wi-Fi adapter can be in one of three states: <br><br>  - transmission (Tx) <br>  - reception (Rx) <br>  - monitoring (CCA - Clear Channel Assessment) <br><br>  If the AP does not transmit or receive, it is in the monitoring mode of its channel (in particular, to assess the virtual (CCA-CS, Carrier Sense) and physical (CCA-ED, Energy Detect) channel occupancy). <br>  If the Client is in the zone of confident reception of one access point, then it transmits and receives on one channel.  Returning to what the Sample is formed from, the question arises how the Sample is formed if the Client works only in one channel and the Measurements must be on three different channels? <br><br><img src="https://habrastorage.org/files/93c/3e8/de2/93c3e8de23764e819b80788bd24ed460.png" alt="image"><br><br>  Modern access points spend a small amount of time on monitoring adjacent channels, but since the main task of access points is customer service, and monitoring of all channels occurs consistently, the time spent on an adjacent channel is very small.  For example, in Cisco infrastructure, the access point bypasses all channels in 16 seconds.  In this case, the probability of "catching" The customer is measured on the adjacent channel is small.  Therefore, we dismiss this method. <br><br>  For the monitoring of adjacent channels, manufacturers often use additional radio.  These technologies include Cisco FastLocation.  The monitoring module goes through all possible channels, but it is much longer on each channel.  But again, this luxury is not available to us under the terms of the task.  In more detail, Cisco FastLocation technology, I am going to devote a separate article. <br><br><h3>  Where did the sample come from then ?! </h3><br>  In a wireless environment, there are a huge number of processes that go unnoticed by the user.  There are three types of packets (Data, Control, Management) and at least 39 types of frames, and there is only one frame (and one mode of operation of the wireless client) that allows you to solve the problem. <br><br>  This is active scanning mode, when the Client is actively (sending Probe Request packets) scanning all available channels for the presence of a suitable wireless network.  Probe Request, as a management frame, is sent at maximum power and at the lowest transmission rate.  It is this mode that allows access points operating on other channels to get the Measurement from the Client and form a Sample. <br><br><img src="https://habrastorage.org/files/0df/88d/1e3/0df88d1e3adf4b5b80a881cb3fd711b8.png" alt="image"><br><br><h3>  Why does the client send these requests? </h3><br><br>  There are at least two modes of operation when scanning is used: <br><br>  1. When the client selects a suitable access point to connect to the wireless network <br>  2. When the client selects a suitable access point during the transition from point to point (during roaming) <br><br>  The client has two mechanisms for scanning the radio environment: <br><br>  - passive scanning <br>  - active scanning <br><br>  In the first case, the wireless client listens to beacon packets (sent every 102.4 ms by default), in the second case it sends a probe request and waits for a probe response. <br><br>  Obviously, this is a matter of choosing between the scanning speed and the energy expended on it (the most expensive mode of operation of a wireless client is transmission). <br><br><h3>  Passive scan </h3><br>  Suppose we scan in the 2.4 GHz band in Russia, where 13 channels are allowed.  The wireless client receiver should obviously be at least 102.4ms (the standard interval between beacon packets) in monitoring mode on each channel.  The full scan cycle takes around 1.4s. <br><br><h3>  Active scan </h3><br>  The client sends a request to the channel (Probe Request).  Access points operating on this channel and having heard the request, respond to it with information about the available wireless segments (SSID). <br><br>  A request can be directed (containing a specific SSID) - directed probe request, in this case, the AP should respond with information only about that SSID (if it is on it). <br><br>  A request can be omnidirectional (Null Probe Request), in this case, the AP that has heard this packet must provide information on all configured SSIDs. <br><br>  The client sends a Probe Request on the first channel and launches ProbeTimer.  The value of ProbeTimer is not standardized and may vary depending on the implementation of network adapter drivers, but in general it is 10ms.  During this time, the wireless client processes responses (Probe Response from TD).  Then it goes to the next channel and so on all channels.  Then decides which TD to connect to. <br><br>  The full scan cycle in this case takes about 130ms, which is about an order of magnitude less than passive scanning. <br><br>  Each manufacturer chooses the type of scan and the conditions of its application.  Also in the operating system itself may be options that allow you to select a particular mode. <br><br><h3>  What frequency of scanning by Probe Request can I expect? </h3><br>  From my point of view, after connecting to the SSID and being in the zone of confident reception of one access point, the Client should not send a Probe Request at all. <br><br>  The Cisco vendor says that the transmission interval can be from 10 seconds to 5 minutes, depending on the type of client, OS, driver, battery, customer activity (http://www.cisco.com/c/en/us/td /docs/wireless/controller/technotes/8-0/CMX_FastLocate_DG/b_CMX-FastLocate-DG.html). <br><br>  It turns out that the theory is somewhat contrary to practice, so tests are needed here. <br><br><h3>  Probe Request Parcel Frequency Measurement </h3><br>  First, tests were subjected to a laptop in a static position, connected to the network, the maximum consumption mode.  On one profile, I had ‚Äúconnect automatically‚Äù and ‚Äúconnect, even if the network does not broadcast my name (SSID). <br><br>  The result showed that the system sends an omnidirectional Probe request to all channels about once a minute regardless of anything. <br><br><img src="https://habrastorage.org/files/722/d3c/9d9/722d3c9d9c884d92ad3b97f0c64d1795.png" alt="image"><br><img src="https://habrastorage.org/files/337/ec0/cb1/337ec0cb1f1f4bb189926f03dc558c6d.png" alt="image"><br><br>  That is, the system, being in a static position, in the zone of confident reception of one TD, still sends Probe request to all channels every minute (for each request all access points send a probe response, which generates considerable traffic).  In Maximum Battery Life mode, the laptop showed the same result. <br>  It is also clear that each time the Client sends more than one request, but several at once, with a very small time interval. <br><br><h3>  Is there a correlation between the sending rate of the Probe Request and the sampling rate of the Cisco CMX? </h3><br>  The number of Probe Request and the number of samples on the Cisco CMX match.  Moreover, it is clear from the logs that several Measurements come once a minute (as the analyzer shows), but CMX obviously combines such requests (and does it right), as the counter increased every minute by one.  It looked like this: <br><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:43</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:43</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:43</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:43</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:43</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:43</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:44</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:44</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:44</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:44</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:44</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:45</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:45</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:45</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:45</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:45</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:46</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:14</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:46</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:14</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:46</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:14</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:46</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:14</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:46</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:14</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:47</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:47</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:47</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:47</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:47</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:48</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:48</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:48</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016 <span class="hljs-selector-tag"><span class="hljs-selector-tag">TIMESTAMP</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Fri</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Aug</span></span> 26 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:48</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MSK</span></span> 2016</code> </pre> <br><h3>  Frequency of measurements in motion </h3><br>  In motion, the periodicity changed and a connection with the roaming moment appeared.  As the analyzer showed, before the moment of roaming, the laptop sent a Probe Request to all channels, that is, it performed an active scanning procedure. <br><br><img src="https://habrastorage.org/files/490/f38/448/490f38448c7d4b4daea2792dd1129f93.png" alt="image"><br><br>  Here an interesting effect arises: the faster a person moves, the more often roaming occurs.  But, unfortunately, roaming occurs somewhat less frequently than every 10 meters (doubled accuracy).  The client keeps ‚Äúuntil the last‚Äù for the access point and only at the last moment switches to a new one.  As a result, roaming occurred no less than every 15‚Äì20 meters, which is approximately twice as much as required, as a result, we have a not very reliable trajectory of movement (see the previous article). <br><br>  Next, I conducted tests with a smartphone based on Android 4.4.4.  The smartphone has two modes of operation: active and sleep.  In sleep mode, there are several options for work.  For the tests, I used the loudest mode ‚ÄúNever‚Äù. <br><br><img src="https://habrastorage.org/files/637/e92/891/637e92891e404e0fa77f54afa6be9b22.png" alt="image"><br><br>  The results were as follows. <br><br><img src="https://habrastorage.org/files/226/e84/c82/226e84c821c14c1d8b73930b7674383f.png" alt="image"><br><br>  If the smartphone was in place, and I did not use it, the delays were about 500-600 seconds.  Even during the period of active surfing, the delays were about 100 seconds.  A more frequent update was obtained by viewing the wireless networks (at that moment requests were sent. <br><br>  In motion, the results were similar to a laptop, that is, there was a direct connection between sending packages and roaming. <br><br><h3>  Main conclusions </h3><br>  <strong>1.</strong> In classic Wi-Fi positioning, measurements are made by Probe Request packets. <br><br>  <strong>2.</strong> On personal devices (laptops, tablets, smartphones), the frequency of sending a Probe Request depends on a large number of factors: device type, OS, driver type and settings, battery status, client activity and can be from 5 seconds to 10 minutes.  But! <br><br>  <strong>3.</strong> There is a direct link between the speed of movement of the client (roaming frequency) and the frequency of sending Probe Request.  If the client is in a static position, then the frequency of measurements is small (but she doesn‚Äôt need a big one!).  And in the case of movement, Probe Request starts to form on the roaming event.  But! <br><br>  <strong>4.</strong> The frequency of sending a Probe Request for roaming is insufficient (more than twice the positioning accuracy) and with uniform motion it can be 10-15 seconds (and it takes at least 5-10 seconds), which leads to a deterioration of positioning accuracy in motion not less than twice. <br><br><h3>  What should pay attention </h3><br>  Many manufacturers are trying to optimize the performance of their devices to increase the operating time of the device and the first candidate for optimization is the ‚Äúactive scan‚Äù mode.  This also leads to the fact that such devices as the iPhone and Android, too, have rarely used this mode of operation, but in the case of roaming, they have not yet departed from using Probe Request. <br><br>  Unfortunately, IEEE 802.11k protocol, which is included in the new version of the 802.11-2012 standard, also comes to the aid of manufacturers.  This standard assumes exactly the function that active scanning is currently performing when roaming. <br><br>  Due to the active work of manufacturers towards lower power consumption and the introduction of the 802.11k standard, one can hardly expect improvements in this direction. <br><br>  There remains a use case for measuring data packets (Data frame).  In this case, we logically come to the consideration of Cisco FastLocaton technology in the next article. <br><br>  PS Below is a small digression about active Wi-Fi tags, about which, if you can work with them, there will be a separate article. <br><br>  In the case of the use of active Wi-Fi tags, we can customize their work, as we need.  The software is configured in such a way that the label is always in sleep mode, wakes up with a certain periodicity to send a Probe Request to all channels, and then falls asleep.  With this mode of operation, you can achieve the required update frequency and the required battery life. <br><br>  Here is <a href="http://www.esp8266.com/viewtopic.php%3Ff%3D11%26t%3D1507%26start%3D8">an example of an</a> active tag that wakes up every 90 seconds to send a Probe Request, running on two AA batteries for about 27 days. <br><br>  PPS Small add.  Support for the 802.11k protocol can both worsen and improve Wi-Fi positioning.  While nothing more specifically I can not say, because the topic has not been studied, I will try to sanctify in the future. </div><p>Source: <a href="https://habr.com/ru/post/309308/">https://habr.com/ru/post/309308/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309298/index.html">The book "ES6 and not only"</a></li>
<li><a href="../309300/index.html">What to read about Angular 2</a></li>
<li><a href="../309302/index.html">Batch Normalization to accelerate neural network learning</a></li>
<li><a href="../309304/index.html">Analysis of the modifications of the extortioner TorrentLocker</a></li>
<li><a href="../309306/index.html">Webpack manual</a></li>
<li><a href="../309310/index.html">The main business of Google began to suffer due to the high popularity of mobile applications.</a></li>
<li><a href="../309312/index.html">The network published a database of 98 million Rambler accounts</a></li>
<li><a href="../309314/index.html">Cisco DNA Architecture - IT in Digital Business</a></li>
<li><a href="../309316/index.html">Clear boy Zone.js</a></li>
<li><a href="../309318/index.html">4 types of memory leaks in javascript and how to deal with them</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>