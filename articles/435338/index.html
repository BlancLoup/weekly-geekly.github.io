<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create an electronic timekeeping races</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On weekdays, I have been developing corporate software for 17 years, I had many different hobbies, but in the end I found something that has been hold...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create an electronic timekeeping races</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/getpro/habr/post_images/c30/b65/2e1/c30b652e145bbb04e3824324671c30d9.jpg" alt="185282-11516937085b2ed4ea7e36b" width="1552" height="598"></p><br><p>  On weekdays, I have been developing corporate software for 17 years, I had many different hobbies, but in the end I found something that has been holding for 5 years and is not going to let go.  Since 2013, I devote most of my free time to motocross and enduro on off-road motorcycles, including regularly participating in amateur competitions.  After an unsuccessful drop in June 2017, I ended up in the hospital with a complete fracture of the right humerus.  I left the hospital, came to my senses and it became clear that the ride would not work for another two or three months, but the habit of activity remained.  Then I decided that I should try to organize the race for my friends myself.  From a technical point of view, I was interested in timing, about how I make my own system and spend the race read under the cut. </p><a name="habracut"></a><br><p>  During the month in the evenings he wrote the first version of the judicial program.  I used C # and WPF for implementation, simply because I know them better and I don‚Äôt have to waste time studying the documentation.  The program could record participants with start numbers, divided into classes and races.  During the race, it was necessary to keep up with our hands to drive in the number of the participant who was driving through the finish line.  Everything worked well, and given the small number of participants in the first race (about 40 people), it was easy to count all hands. </p><br><p>  However, as a programmer, I wanted more automation, I don‚Äôt like manual chore, and it‚Äôs already quite difficult to write down a race with a hundred participants.  As a result, in 2017 he spent another stage, where there were already 3 separate classes and more than a hundred participants, the event was quite successful and it was decided to use an electronic serif for the next season. </p><br><p><img width="990" height="546" src="https://habrastorage.org/getpro/habr/post_images/8eb/9ca/8bd/8eb9ca8bdcd5800e2583a565b292244e.png" alt="_racelog01"></p><br><p>  The picture shows a modern version of the program with support for RFID and remote control from a smartphone.  In the first version there were much less elements. </p><br><h1>  Equipment selection </h1><br><p>  Of course, this topic is not new, there are many ready-made options, but most of them are not very suitable for the price.  For example, the professional racing timekeeping system from the Italian company AMB costs approximately ‚Ç¨ 13,000 and has 20 rolling transponders in the set.  Each additional chip costs 100 ‚Ç¨ and they are disposable, that is, after 3-5 years, when the battery dies in them, it cannot be replaced by a regular method.  The rest of the system is excellent, is used in all world races, has an accuracy of up to thousandths of a second, and so on.  For a hobbyist who organizes races for friends in his free time, this system is not suitable.  I also found a lot of ready-made timekeeping systems for marathons, triathlon and other similar competitions.  Systems used RFID tags.  But they were confused by the specifics - people finish the marathon at best at a speed of 20 km / h, and in motocross it is customary to give a finish on the largest springboard, which is entered at a speed of 70-80 km / h.  But the price of RFID tags about 11 rubles per piece allowed to distribute them in any quantity. </p><br><h1>  We use RFID </h1><br><p>  In general, the RFID technology was not originally designed for notching races, if you read the specifications of the chips and readers, you can find restrictions on the speed of the chip relative to the antenna in a few meters per second.  But I knew that such a system had been successfully used for many years in the famous racing series xsr-moto.ru, in which I myself participated many times and had their RFID tags on the helmet.  Sergey Mindin, the organizer of the series, kindly shared the information and pointed me to the website motosponder.com, where he acquired his mark. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/d0c/34b/5b7/d0c34b5b7744e4d65f7914c0f70cb87d.jpg"><br><br><p>  This helped determine the choice of the first reader - Alien Technology F800, because I knew that it would work in the conditions I needed.  In addition to Alien, I considered Imping Speedway Revolution R420 and looking at the quality of the SDK and the documentation was going to buy it.  But in the end I stopped at the F800 as a deliberately proven solution. </p><br><p>  The reader cost me about $ 1600, I bought in Moscow, I immediately bought two antennas and 5 meter RF cables to them.  An unpleasant surprise was the price of RF cables.  A 10 meter cable will cost more than the antenna itself, and it is also easy to break it, for example, bend or crush it with your foot. </p><br><p>  Solution: buying a complete set of equipment and software from motosponder for $ 3500 is expensive and not sports.  It is necessary to buy only the equipment, which cost about $ 2,200, and write the software yourself.  What can there be difficult?  :) </p><br><p>  Looking at the prices above, a logical question arises: was it possible to save?  Buy a Chinese reader, the prices of which start from $ 200. Such thoughts were, but there was also a thought that I had very limited time, and the stability of the final design and ease of development was important.  Before that, I had no practical experience with RFID and had no idea what physical limitations I might face.  Therefore, the idea of ‚Äã‚ÄãChinese readers was postponed, but not forgotten. </p><br><h1>  RFID Options Overview </h1><br><p>  RFID is the generic name for a whole family of technologies that differ in frequency and data exchange protocol. </p><br><ul><li>  LF RFID - kilohertz range, low range and speed of reading. </li><li>  HF 14 MHz - usually these are ‚Äúmagnetic‚Äù passes to the building, intercom keys, contactless payment cards, NFC phones.  In general, a very common frequency, but the connection radius is up to one meter.  Again, not suitable for my case.  However, I know one perfectly working timekeeping system built on smartphones and metro cards.  Only to mark the rider, he must stop and the judge must attach the phone to the label. </li><li>  UHF ~ 840 - 930 MHz is the range on which all the timekeeping systems of mass events are built.  In optimal conditions, the tags are read at a distance of more than 10 meters, the data transfer speed is enough to read tags 50 or more times per second, the waves of these frequencies are not so much absorbed by water as the next band. </li><li>  UHF 2.4 GHz - maybe I was looking badly, but I concluded that this frequency is an invention of the Chinese, because I did not find such readers from brand manufacturers.  In any case, I decided not to use this frequency, because it is too well silenced by water, mud, fog and other interferences. </li></ul><br><p>  A little more detailed description of frequencies and standards can be found at the following link <a href="http://rfidcenter.ru/page/frequencies-ranges/">rfidcenter.ru/page/frequencies-ranges</a> </p><br><h1>  UHF RFID </h1><br><p>  And so, I concluded that the best option for my application is the UHF band, depending on regional restrictions, it will be frequencies from about 840 to 930 MHz and the number of channels from 2 to 30. </p><br><p>  My F800 is designed for the European region and is configured to operate in the range of 865-867 MHz.  Together with the reader, I bought several different tags, they all had the long-range characteristics according to the manufacturer‚Äôs description, the specific range and reading speed are usually not written anywhere.  highly dependent on conditions.  I spent quite a few experiments reading different tags, in different numbers and antenna configurations.  Here are the concise conclusions: </p><br><ul><li>  In the open area, if you precisely orient the tag to the antenna, it is quite possible to get a stable reading at a distance of 10 meters. </li><li>  The shape of the field at the antenna looks like a drop, so the most confident reading is obtained at a distance of 3-5 meters from the antenna - in the widest part of the drop.  Of course, the shape of the radiation pattern depends on the antenna model, I used flat panel antennas with a declared gain of 10dbi, <a href="http://antenna31.ru/%3Fproduct%3Drfid-panelnaya-antenna-pa868-10-rhcp">60/65</a> ¬∞ <a href="http://antenna31.ru/%3Fproduct%3Drfid-panelnaya-antenna-pa868-10-rhcp">antenna31.ru/?product=rfid-panelnaya-antenna-pa868-10-rhcp</a> </li><li>  Antennas are circular and linear polarized.  With linear polarization, the reading range is much longer, but the orientation of the label must coincide with the orientation of the antenna. </li><li>  All ‚Äúlong-range‚Äù tags work approximately equally.  Here you need to clarify that I used the labels of one brand - Alien, maybe they are all on the same chip. </li><li>  Include the maximum transmit power is not always the optimal solution.  At home in a small room, due to the reflections, the reading speed dropped very much.  The same can happen in open space, if two antennas look at each other, they will work like a mirror. </li><li>  In general, with RFID, more problems happen from too much power and reading range than vice versa.  If you "shine" in the field at maximum power, you can get a lot of random readings from a large area (tens of square meters).  Therefore, it is important to adjust the power and location of the antennas so that the reading is carried out on the smallest area. </li><li>  The speed of reading tags depends on their number in the field of view of the reader.  Captain statement, but I changed specific numbers for optimal conditions: <ul><li> One mark - 50-70 / s </li><li>  5 or more tags - 250-280 / s </li><li>  Approximately 280 reads per second - this is the limit for any number of tags in the field, and of course, if there are several dozen tags, the speed will drop dramatically due to collisions </li></ul></li><li>  The label on a real motorcycle moving at a speed of more than 80 km / h is readable, but not in any position, it is desirable that the label and antenna be oriented in such a way as to look a little at each other.  For example, the antenna is slightly directed towards the rider, and the label is pasted somewhere on the front of the motorcycle.  At lower speeds, the mark and antenna can be strictly perpendicular to the track. </li></ul><br><p>  At this stage, everything looked good, 50 readings per second meant that the average time between reads was 20 milliseconds, but this also had to be checked.  The program for collecting statistics was supplemented by calculating the time difference between readings; it derived the worst, best time, and eight fractions measured in milliseconds.  It turned out that the reader is reading far from evenly.  This is explained by the protocol, according to which the reader must stop broadcasting for at least 10 milliseconds every few seconds.  This is how the test looked for two labels in the field: </p><br><p><img width="653" height="147" src="https://habrastorage.org/getpro/habr/post_images/f61/340/d22/f61340d22b6d957005392c0f285e552e.png" alt="_alien-rfid-tag-stat"></p><br><ul><li>  44 ms - the worst </li><li>  20 ms - tenth decile </li><li>  1 ms is the best </li><li>  3.2 ms - average time </li><li>  104 reads per second </li></ul><br><p>  That is, in 5 test seconds most of the readings went with a gap of one millisecond, and then silence of 44 milliseconds.  This is an unpleasant feature for racing, for 44 milliseconds at a speed of 20 meters per second, the driver passes 80 centimeters and, in case of interference, can simply drive past the antenna.  Approximately this situation was reproduced in the real test described above.  And there is also a solution - to direct the antennas in the direction of the racers, then the space, and hence the time for reading, greatly increases.  And of course you need to add spare ways to track riders, for example: video recording, a person with a piece of paper and a pencil, a person who enters numbers into the program with his hands. </p><br><h1>  Finish Line Configuration </h1><br><p>  It's one thing to read tags with an antenna on the table, and another in a real race from the racers.  I considered two main options for the configuration of the finish line. </p><br><p>  The first - antennas are located on tripods on the sides of the track.  Ideally, antennas generally stand only on one side and ‚Äúshine‚Äù across the track.  But at the same time the location of the marks on the racers becomes asymmetrical, it is impossible, for example, to start the race in the opposite direction.  In addition, reading from one side only is not so reliable.  Then you need to put the antenna on both sides of the track, so that they ‚Äúlight‚Äù on each other.  This already requires the construction of a frame over the route, along which RF cables will be laid, and even in such a configuration, the problem of the width of the route remains.  It so happens that the track is 8-10 meters wide, and taking into account the stock for the installation of tripods, it can turn out to be 12-13 meters.  Reading at such a distance can easily happen. </p><br><p>  The second option, motosponder and xsr-moto tested over many years, is to install antennas on the frame above the track and direct them down.  Tags need to glue on the helmets of racers or the upper torso.  The result is that the distance from the antenna to the mark will always be no more than 1.5 meters (the height of the frame is 3 meters, but the driver rarely passes the finish line with the helmet at ground level).  A large width of the route can be slightly trimmed by the frame itself. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/434/9ef/c50/4349efc5060b1ee25eeec40eb8a155d1.jpg" alt="_rfid_frame" width="824" height="552"></p><br><p>  At the moment I use a frame with a width of 6 meters with three antennas, its width can be increased by an additional section up to 8-9 meters.  After that, 4 antennas will already be needed, located slightly wider.  According to the experience of two races in 2018, a width of 6 meters is enough if you set the frame on the slow track.  It also increases the likelihood of reading tags - we kill two birds with one stone. </p><br><h1>  Notice time </h1><br><p>  After everything became more or less clear with the iron, the time had come to actually count the circles.  At first glance, everything is simple: create a table where each rider is assigned a tag identifier and write down each signal from the reader. </p><br><p>  Almost so, but the signals from the reader must be filtered, because when the label is in the reader‚Äôs field of view, it is read up to fifty times per second.  It should also be noted that in rare cases the tags are still not readable, therefore the serif program should be able to receive real-time data from the reader, from the operator who enters the numbers manually and allow editing marks after the end of the race. </p><br><p>  The data that the reader and the operator give pass through the deduplication filter and turns into a track of numbers.  This is a one-dimensional array of numbers of riders, in the order in which they crossed the finish line.  For example: [1, 2, 3, 2, 3, 1].  From this track you can see that the riders completed two laps, on the first lap the riders' positions were 1, 2, 3. But on the second lap, the number of the first one had a problem and it ended up at the end.  In the end, he won number two, followed by number three and then number one.  To calculate the finishing protocol, it is the order that is used, not the time stamps.  This is done for compatibility with the classic manual timekeeping, when judges record a track of numbers in a notebook.  Although there is no such function yet, it is easy to implement the loading of a track of numbers from an additional judge.  As a result of the calculation, the following table is obtained: <br><br><img width="1035" height="406" src="https://habrastorage.org/getpro/habr/post_images/572/eda/e3c/572edae3c2caf31dc9555940200cb28a.png" alt="_session_rating"></p><br><h1>  Conclusion </h1><br><p>  This article describes only a small piece of experience that I have gained over the past 1.5 years.  Then I would like to talk about creating a site for registering riders and publishing results in Live mode, developing a second version of the hardware complex serifs based on the Chinese RFID module and Orange Pi, the process of preparing the route, organizing a mass event and many other things.  If the topic is interesting, leave comments. </p><br><p>  The project is open, a significant part of the code is published on <a href="https://github.com/maxbl4">github.com/maxbl4, the</a> rest will also be soon, you just need to clean the passwords and API keys from the code :-) If you are interested in helping the development of the project, learn something new, for example, learn how to drive motorcycles on .Net Core and Angular, contact.  Stack of technologies at the moment .Net 4.7, .Net Core 2.2, Docker, Angular 7.1, MySql 10.3 </p><br><p>  At the moment, in open access all the code to work with two types of RFID readers that I use: <a href="https://github.com/maxbl4/RfidDotNet">github.com/maxbl4/RfidDotNet</a> <br>  .Net Standard 2.0 library, full implementation of protocols, external dependency on SerialPorlStream only for working with a serial port on Linux. <br></p><br><p>  You can view the system in action, socialize and have a great time at the sports motor festival on February 16 near Sergiev Posad <a href="https://vk.com/event74123582">vk.com/event74123582</a> at this event I provide timekeeping </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/435338/">https://habr.com/ru/post/435338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435328/index.html">How to work with Shader Graph in Unity3D</a></li>
<li><a href="../435330/index.html">Cisco DevNet as a learning platform, opportunities for developers and engineers</a></li>
<li><a href="../435332/index.html">I hate the keyboard</a></li>
<li><a href="../435334/index.html">Reaction to cold letters</a></li>
<li><a href="../435336/index.html">Something found: reports from Elasticsearch Moscow meetup in OZON</a></li>
<li><a href="../435340/index.html">Researcher posted an example of a working worm code for Facebook</a></li>
<li><a href="../435342/index.html">Homemade BadUSB on Arduino Pro Micro or Leonardo</a></li>
<li><a href="../435344/index.html">Amazon unveiled Showroom, or why we will soon be buying all the furniture online.</a></li>
<li><a href="../435346/index.html">Subscribe to Kafka via HTTP or how to simplify your own web-hooks</a></li>
<li><a href="../435348/index.html">Simple MCerver - a small shell for Minecraft server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>