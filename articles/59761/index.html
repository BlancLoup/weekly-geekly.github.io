<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Listen to function calls in Javascript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many people know about the mechanism of Event-Dispatcher-Listener'ov, implemented in many programming languages. I will create a similar mechanism not...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Listen to function calls in Javascript</h1><div class="post__text post__text-html js-mediator-article">  Many people know about the mechanism of Event-Dispatcher-Listener'ov, implemented in many programming languages.  I will create a similar mechanism not for Event'ov, but for any <em>method</em> of the JavaScript object - Object. <br>  I do not pretend to originality, no.  The main purpose of the article is to consider interesting prototyping mechanisms in JavaScript, the creation of decorators and, in fact, try to at least a little to reveal the power and flexibility of this wonderful language that is so often offended and underestimated. <br><br>  <strong>UPD1: a</strong> summary: <br>  1. Creating a JavaScript <em>Decorator</em> <br>  2. Creation of the Function call listener mechanism using <em>decorators</em> <br><br>  <strong>UPD2:</strong> 06/09/2009 <br>  At the end of the article, I added the <strong>Update: Decorator Mark II</strong> section.  In it - corrections and improvements (I didn‚Äôt redraw the whole article because of this) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, the first (and hopefully not the last) recipe in my JavaScript cookbook. <br><a name="habracut"></a><br><h2>  Dish </h2><br>  <strong>Function Call Listener</strong> , stuffed ( <em>multifunctional</em> ), baked in its own juice ( <em>without using any libraries, in pure JavaScript</em> ). <br><br><h2>  Ingredients </h2><br>  1. Understanding JavaScript Prototyping <br>  2. Understanding JavaScript Anonymous Functions <br>  3. Approximate knowledge <em>of the</em> <code>Function</code> <em>class</em> <br><br>  Do not worry, I will describe the ingredients in more detail. <br><br><h2>  Recipe </h2><br><h3>  We dive a couple of meters deep </h3><br>  So let's get started.  First, we will borrow a small assistant from <a title="John Resig's blog" href="http://ejohn.org/">John Resig</a> 's (from his book): <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">Function.prototype.method = <font color="#0000ff">function</font> (methodName, f) { <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> .prototype[methodName] = f; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br> </blockquote><br>  What does this method do?  Literally: it allows you to easily add a new method to the prototype of the current function. <br>  As you know, a function in JavaScript is also a <em>class</em> and <em>constructor of a class</em> (do not hit, I give up - there are no <em>classes</em> in JavaScript <em>,</em> in the usual sense). <br><br>  The following is also true: the <em>constructor of</em> any <em>class</em> is a function (or, in a scientific way, an instance <em>of the</em> <code>Function</code> <em>class</em> ). <br>  Based on the principles of prototyping - after adding a new method <code>method(...)</code> to the prototype <em>of the</em> <code>Function</code> <em>class</em> , all instances <em>of the</em> <code>Function</code> <em>class have</em> a new <code>method(...)</code> (but remember: there are no <em>methods</em> in JavaScript, Neo). <br><br>  Any <em>class</em> - <code>Object</code> , <code>Array</code> , <code>Number</code> , <code>YourClassName</code> - is an <em>instance of the</em> <code>Function</code> <em>class</em> , i.e.  just a function.  So we got: <code>Object.method(...)</code> , <code>Array.method(...)</code> , <code>YourClassNam.method(...)</code> <br><br>  If we assume that the function is a <em>familiar class</em> , then we essentially <em>added a static method</em> to all-all <em>classes</em> (JavaScript actually inserts :-)). <br><br><h3>  We build a decorator </h3><br>  Okay, enough about the genius.  We now turn to my code: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">Function.method( <font color="#A31515">"decorate"</font> , <font color="#0000ff">function</font> (f) { <br> <font color="#0000ff">var</font> oldMe = <font color="#0000ff">this</font> ; <br> <font color="#0000ff">var</font> newMe = f; <br> newMe.old = oldMe; <br> <font color="#0000ff">return</font> newMe; <br> })</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Voila!  As I said, <em>the</em> <code>Function</code> <em>class</em> itself is a function, or an <em>instance of the</em> <code>Function</code> <em>class</em> (aaa :-)) <br>  So, as soon as we added: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">Function.prototype.method = <font color="#0000ff">function</font> (...) {}</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  We immediately appeared <code>Function. <strong>method</strong> (...)</code>  <code>Function. <strong>method</strong> (...)</code> (no longer in the prototype, but <strong>in an instance</strong> <em>of the</em> <code>Function</code> <em>class</em> ) <br><br>  After executing the code above, we will have a new method <code>Function.prototype. <strong>decorate</strong> (...)</code>  <code>Function.prototype. <strong>decorate</strong> (...)</code> .  And again, the method appeared in the prototype <code>Function</code> , and therefore in all-all-all <em>classes</em> .  But here it‚Äôs just not important to me, and what matters is the presence of the <code>decorate(...)</code> method for all functions. <br><br>  What does the <code><strong>decorate</strong> (...)</code> method do? <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//   </font> <br> <font color="#0000ff">var</font> oldMe = <font color="#0000ff">this</font> ; <br> <br> <font color="#008000">//      ,  " "  .</font> <br> <font color="#0000ff">var</font> newMe = f; <br> newMe.old = oldMe; <br> <font color="#0000ff">return</font> newMe;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Of course, this code can be greatly reduced, but so - more clearly. <br><br>  But this is not all, the most interesting - in front.  You think I for nothing called my method - decorate?  No, not for nothing!  This is the familiar <em>decorator</em> . <br><br><h3>  Decoration example </h3><br>  Let's create a simple <em>class</em> : <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -,  </font> <br> <font color="#0000ff">function</font> MyCoolNumber(initNumber) { <br> <font color="#0000ff">this</font> .value = initNumber; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  But is it a number?  Of course not.  I can pass there anything. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">new</font> MyCoolNumber( <font color="#A31515">' '</font> ) <font color="#008000">//  " "</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  But what to do?  I absolutely do not want to change the <em>designer</em> .  There is a way out: we will write a <em>decorator</em> to limit the passed parameters and apply it to our <em>class</em> . <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> strictArgs() { <font color="#008000">//     ,     </font> <br> <font color="#0000ff">var</font> types = arguments; <font color="#008000">//  </font> <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#0000ff">if</font> ( <font color="#0000ff">params</font> .length != types.length) <br> <font color="#0000ff">throw</font> <font color="#A31515">"!  "</font> + types.length + <font color="#A31515">" (),   "</font> + <font color="#0000ff">params</font> .length; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i=0, l= <font color="#0000ff">params</font> .length; i &lt; l; i++) { <br> <font color="#0000ff">if</font> (!( <font color="#0000ff">params</font> [i] instanceof types[i]) &amp;&amp; !( <font color="#0000ff">params</font> [i].constructor == types[i])) <br> <font color="#0000ff">throw</font> <font color="#A31515">"!  #"</font> + (i+1) + <font color="#A31515">"   "</font> + types[i].name; <br> } <br> arguments.callee.old.apply( <font color="#0000ff">this</font> , arguments); <font color="#008000">// ,  "" </font> <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Let's return to our experimental: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> MyCoolNumber(initNumber) { <br> <font color="#0000ff">this</font> .value = initNumber; <br> } <br> MyCoolNumber = MyCoolNumber.decorate(strictArgs(Number)) <br> <br> <font color="#0000ff">new</font> MyCoolNumber(); <font color="#008000">// !  1 (),   0</font> <br> <font color="#0000ff">new</font> MyCoolNumber(1, 2, 3); <font color="#008000">// !  1 (),   3</font> <br> <font color="#0000ff">new</font> MyCoolNumber( <font color="#A31515">""</font> ); <font color="#008000">// !  #1   Number</font> <br> <font color="#0000ff">var</font> x = <font color="#0000ff">new</font> MyCoolNumber(6); <font color="#008000">// OK!</font> <br> alert(x.value) <font color="#008000">// 6,    ,    .</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Consider all this ugliness more closely.  Let's start with the application of the decorator. <br><ol><li>  f-tion <code>strictArgs</code> with one argument is called - <code>Number</code> </li><li> <code><font color="#0000ff">var</font> types = arguments; <font color="#008000">//      strictArgs(...)   types,      [Number] -   1 -:  Number.    Arguments -   ,     ,     </font></code> </li> <li>  <code>strictArgs(...)</code> returns a new <code>strictArgs(...)</code> , inside of which: <br><ol><li> <code><font color="#0000ff">var</font> params = arguments; <font color="#008000">//       ,   <strong>,      MyCoolNumber;</strong></font></code> </li> <li>  We begin to compare these 2 arrays for the coincidence of dimensions and types </li></ol><br></li><li>  we decorate the <code>MyCoolNumber</code> that returned from <code>strictArgs(...)</code> <br>  <strong>Note: the</strong> connection of the original f-tion with the decorator is done through <code>arguments.callee.old.apply(this, arguments)</code> : <br><ul><li>  <code>arguments</code> - the standard object for describing the arguments of the function being called. </li><li>  <code>arguments.callee</code> - the decorator function itself </li><li>  <code>arguments.callee.old</code> - remember, what is - old?  When we pass a decoder function to the decorate (...) method, it adds the old attribute to this function, which refers to the ‚Äúold‚Äù function. </li><li>  <code>arguments.callee.old.apply(...)</code> is the standard method of the Function class.  I will not be about him, let me just say that he calls the function with the given scope and arguments </li><li>  <code>arguments.callee.old.apply(this, arguments)</code> - actually, a confirmation of the above </li></ul><br></li></ol><br>  So, it seems, I focused on the main points. <br>  Oh yeah, I forgot!  How to "throw off" the <em>decorator</em> from the function and return the old one?  There is nothing easier: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">Function.method( <font color="#A31515">"recover"</font> , <font color="#0000ff">function</font> () { <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> .old || <font color="#0000ff">this</font> ; <br> })</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Now let's continue! <br><br><h3>  We look at the object, listen to the methods </h3><br>  We smoothly come to the end of my recipe.  Just a little bit of spice, and you can go into the furnace ... ugh, into the oven!  :) <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">Object.method( <font color="#A31515">'before'</font> , <font color="#0000ff">function</font> (methodName, f){ <br> <font color="#0000ff">var</font> method = listenerInit.call( <font color="#0000ff">this</font> , methodName); <br> <font color="#0000ff">if</font> (method) <br> method.listenersBefore.push(f); <br> }) <br> <br> Object.method( <font color="#A31515">'after'</font> , <font color="#0000ff">function</font> (methodName, f){ <br> <font color="#0000ff">var</font> method = listenerInit.call( <font color="#0000ff">this</font> , methodName); <br> <font color="#0000ff">if</font> (method) <br> method.listenersAfter.push(f); <br> })</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  As you might guess, all the most important things happen inside a certain function <code>listenerInit(...)</code> , but about it later.  For now, just believe that she makes all the necessary preparations. <br>  How to add a listener is understandable.  Now we need the ability to "remove": <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">Object.method( <font color="#A31515">'removeBefore'</font> , <font color="#0000ff">function</font> (methodName, f){ <br> <font color="#0000ff">var</font> method = listenerInit.call( <font color="#0000ff">this</font> , methodName); <br> <font color="#0000ff">if</font> (method) { <br> <font color="#0000ff">var</font> _nl = []; <br> <font color="#0000ff">while</font> (method.listenersBefore.length) { <br> <font color="#0000ff">var</font> _f = method.listenersBefore.shift(); <br> <font color="#0000ff">if</font> (_f != f) <br> _nl.push(_f); <br> } <br> method.listenersBefore = _nl; <br> } <br> }) <br> <br> Object.method( <font color="#A31515">'removeAfter'</font> , <font color="#0000ff">function</font> (methodName, f){ <br> <font color="#0000ff">var</font> method = listenerInit.call( <font color="#0000ff">this</font> , methodName); <br> <font color="#0000ff">if</font> (method) { <br> <font color="#0000ff">var</font> _nl = []; <br> <font color="#0000ff">while</font> (method.listenersAfter.length) { <br> <font color="#0000ff">var</font> _f = method.listenersAfter.shift(); <br> <font color="#0000ff">if</font> (_f != f) <br> _nl.push(_f); <br> } <br> method.listenersAfter = _nl; <br> } <br> })</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Maybe this method is not optimal, I just took the first out of my head. <br>  Finally, the crown of this recipe, the connection of the <em>decorator</em> and the <em>event-listener of the schema</em> is the same function as <code>listenerInit</code> : <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> listenerInit(methodName) { <br> <br> <font color="#0000ff">var</font> method = <font color="#0000ff">this</font> [methodName]; <br> <font color="#0000ff">if</font> ( <font color="#0000ff">typeof</font> method != <font color="#A31515">"function"</font> ) <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> <br> <font color="#008000">// ,   ?</font> <br> <font color="#0000ff">if</font> (!method.listenable) { <br> <font color="#0000ff">this</font> [methodName] = method.decorate( <font color="#0000ff">function</font> (){ <br> <font color="#0000ff">var</font> decorator = arguments.callee; <br> decorator.listenable = <font color="#0000ff">true</font> ; <br> <br> <font color="#0000ff">var</font> list = decorator.listenersBefore; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i = 0, l = list.length; i &lt; l; i++) { <br> <font color="#0000ff">if</font> ( <font color="#0000ff">typeof</font> list[i] == <font color="#A31515">"function"</font> &amp;&amp; list[i].apply( <font color="#0000ff">this</font> , arguments) === <font color="#0000ff">false</font> ) <br> <font color="#0000ff">return</font> ; <br> } <br> <br> <font color="#0000ff">var</font> ret = decorator.old.apply( <font color="#0000ff">this</font> , arguments); <br> list = decorator.listenersAfter; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i = 0, l = list.length; i &lt; l; i++) <br> list[i].apply( <font color="#0000ff">this</font> , arguments); <br> <br> <font color="#0000ff">return</font> ret; <br> }); <br> method = <font color="#0000ff">this</font> [methodName]; <br> } <br> <br> method.listenersBefore = method.listenersBefore instanceof Array ? method.listenersBefore : []; <br> method.listenersAfter = method.listenersAfter instanceof Array ? method.listenersAfter : []; <br> <br> <font color="#0000ff">return</font> method; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  This function can be divided into blocks. <br><br>  <strong>Block 1:</strong> check - do they not deceive us? Is there such a method in this object? <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">var</font> method = <font color="#0000ff">this</font> [methodName]; <br> <font color="#0000ff">if</font> ( <font color="#0000ff">typeof</font> method != <font color="#A31515">"function"</font> ) <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  And at the end we see: the <code>return method</code> , i.e.  <code>listenerInit(...)</code> returns either <code>false</code> or the already ‚Äúdecorated‚Äù method. <br><br>  <strong>Block 2:</strong> creating the appropriate decorator, if one is not yet defined. <br>  What about this decorator? <br><ol><li>  We start all listeners from the <code>listenersBefore</code> array.  If at least 1 of them returns a <code>Boolean false</code> , stop execution. </li><li>  Calling the base method </li><li>  We start all listeners from the <code>listenersAfter</code> array </li><li>  The decorator returns the value returned by the base method. </li></ol><br>  <strong>Block 3:</strong> initialization of the arrays <code>method.listenersBefore</code> and <code>method.listenersAfter</code> . <br><br><h3>  Buns </h3><br>  <strong>Modification 1:</strong> hide the <code>listenerInit</code> out of sight.  To do this, use the JavaScript closure: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">( <font color="#0000ff">function</font> (){ <br> <font color="#008000">// listenerInit(...)  --</font> <br> <font color="#008000">// .....</font> <br> })()</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  <strong>Modification 2:</strong> contaminating standard classes like <code>Object</code> is very bad, so you can modify your particular class: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">YourClass.method( <font color="#A31515">'before'</font> , <font color="#0000ff">function</font> (methodName, f){ <br> <font color="#0000ff">var</font> method = listenerInit.call( <font color="#0000ff">this</font> , methodName); <br> <font color="#0000ff">if</font> (method) <br> method.listenersBefore.push(f); <br> })</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Well, and so on.  As they say - there is no limit to perfection! <br><br>  Everything!  The cake is molded, now in the oven (that is, in your brain) for half an hour, and - ready.  Enjoy your meal! <br><br><h3>  How it is </h3><br>  Well, a specific example of use: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//   </font> <br> <font color="#0000ff">var</font> Num = <font color="#0000ff">function</font> (x) { <br> <font color="#0000ff">this</font> .x = x; <br> } <br> <font color="#008000">//  </font> <br> Num.prototype.x = <font color="#0000ff">null</font> ; <br> Num.prototype.getX = <font color="#0000ff">function</font> () { <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> .x; <br> }; <br> Num.prototype.setX = <font color="#0000ff">function</font> (x) { <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> .x = x; <br> } <br> <br> <font color="#008000">//  </font> <br> <font color="#0000ff">var</font> t = <font color="#0000ff">new</font> Num(6); <br> <br> <font color="#008000">//   after</font> <br> t.after( <font color="#A31515">"getX"</font> , <font color="#0000ff">function</font> (){ <br> alert( <font color="#A31515">'!  X == '</font> + <font color="#0000ff">this</font> .x + <font color="#A31515">'!'</font> ); <br> }) <br> <br> <font color="#008000">//   after</font> <br> t.after( <font color="#A31515">"getX"</font> , <font color="#0000ff">function</font> (){ <br> alert( <font color="#A31515">'   !'</font> ); <br> }) <br> <br> <font color="#008000">//   before,  </font> <br> <font color="#0000ff">var</font> f = <font color="#0000ff">function</font> (x){ <br> <font color="#0000ff">if</font> (x &lt; 0 || x &gt; 10) { <br> alert( <font color="#A31515">'!      [0, 10]'</font> ); <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> } <br> t.before( <font color="#A31515">"setX"</font> , f) <br> <br> <font color="#008000">// :</font> <br> t.getX(); <font color="#008000">// !  X == 6! -&gt; '   ! -&gt;   getX(...)</font> <br> t.setX(100); <font color="#008000">// !      [0, 10] -&gt;  setX(100) -  </font> <br> alert(tx); <font color="#008000">// 6</font> <br> t.setX(4); <font color="#008000">//  ,    setX(4)</font> <br> alert(tx); <font color="#008000">// 4</font> <br> t.removeBefore( <font color="#A31515">"setX"</font> , f) <font color="#008000">//    f(...)</font> <br> t.setX(100); <font color="#008000">//  ,   setX(100)</font> <br> alert(tx); <font color="#008000">// 100</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  By the way, all the above code is cross-browser, this is my principle of operation. <br><br><h2>  Conclusion </h2><br>  I hope you enjoyed my cooking.  Write, I will be glad to answer questions.  And believe me - JavaScript is really a very powerful, flexible and very cool programming language, albeit a script one. <br><br><h2>  Update: Decorator Mark II </h2><br>  <strong>UPD:</strong> 06/09/2009 <br>  Elapsed time since writing the article and I found in my implementation errors and shortcomings.  But I do not want to redraw the article, and do not want to create a new one.  So meet here and now: Decorator Mark II! <br><br>  1. Improved <code><strong>Function.method(...)</strong></code> <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//      ,    </font> <br> Function.prototype.method = <font color="#0000ff">function</font> (methodName, f) { <br> <font color="#0000ff">if</font> ( <font color="#0000ff">typeof</font> f != <font color="#A31515">"undefined"</font> ) <br> <font color="#0000ff">this</font> .prototype[methodName] = f; <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> .prototype[methodName]; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  2. Improved <code><strong>restore(...)</strong></code> method <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//       "" -,      </font> <br> Function.method( <font color="#A31515">"restore"</font> , <font color="#0000ff">function</font> (fullRestore){ <br> <font color="#0000ff">var</font> ret = <font color="#0000ff">this</font> .old || <font color="#0000ff">this</font> ; <br> <font color="#0000ff">while</font> (fullRestore &amp;&amp; ret.old) { <br> ret = ret.old; <br> } <br> <font color="#0000ff">return</font> ret; <br> })</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  3. Added <code><strong>decorateMethod(...)</strong></code> method <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//    </font> <br> Function.method( <font color="#A31515">"decorateMethod"</font> , <font color="#0000ff">function</font> (methodName, decorator){ <br> <font color="#0000ff">var</font> f = <font color="#0000ff">this</font> .method(methodName); <br> <font color="#0000ff">if</font> (!f) <br> <font color="#0000ff">return</font> <font color="#0000ff">null</font> ; <br> f.name = methodName; <br> f = f.decorate(decorator); <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> .method(methodName, f); <br> })</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  4. ( <font color="red">important!</font> ) Fixed / changed method <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <strong>decorate(...)</strong> <br> <font color="black">Function.method( <font color="#A31515">"decorate"</font> , <font color="#0000ff">function</font> (decorator){ <br> <font color="#008000">//   </font> <br> <font color="#0000ff">var</font> oldFunc = <font color="#0000ff">this</font> ; <br> <font color="#008000">// !    -     .</font> <br> <font color="#008000">//         ,      -.</font> <br> <font color="#008000">//          ,</font> <br> <font color="#008000">//   -- original: oldFunc ()  decoratorInstance: f ( )</font> <br> <font color="#0000ff">var</font> f = <font color="#0000ff">function</font> (){ <br> <font color="#0000ff">return</font> decorator.apply( <font color="#0000ff">this</font> , [{original: oldFunc, decoratorInstance: f}].concat([].slice.apply(arguments))) <br> } <br> <font color="#008000">//   - -  decoratorInstance f</font> <br> f.old = oldFunc; <br> <font color="#008000">//     -.</font> <br> <font color="#008000">//     -  .</font> <br> f.prototype = <font color="#0000ff">this</font> .prototype; <br> f.prototype.constructor = f; <br> <font color="#008000">//   -.    ?   .</font> <br> <font color="#008000">// . ,   decorateMethod:    .</font> <br> f.name = oldFunc.name; <br> <font color="#008000">//  </font> <br> <font color="#0000ff">return</font> f; <br> })</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br> <br>       (   <strong>decorate(...)</strong> ),         . <br>  : <br> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -</font> <br> <font color="#0000ff">function</font> strictArgs() { <br> <font color="#0000ff">var</font> types = arguments; <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#008000">//...</font> <br> <font color="#0000ff">return</font> arguments.callee.old.apply( <font color="#0000ff">this</font> , arguments); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br>   : <br> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -</font> <br> <font color="#0000ff">function</font> strictArgs() { <br> <font color="#0000ff">var</font> types = arguments; <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> (dScope) { <br> <font color="#0000ff">var</font> original = arguments[0].original; <font color="#008000">//   dScope.original</font> <br> <font color="#0000ff">var</font> arguments = Array.prototype.slice.call(arguments, 1); <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#008000">//...</font> <br> <font color="#0000ff">return</font> original.apply( <font color="#0000ff">this</font> , arguments); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br> <br>  ,     :) <br> <br></code></code> <blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <strong>decorate(...)</strong> <br> <font color="black">Function.method( <font color="#A31515">"decorate"</font> , <font color="#0000ff">function</font> (decorator){ <br> <font color="#008000">//   </font> <br> <font color="#0000ff">var</font> oldFunc = <font color="#0000ff">this</font> ; <br> <font color="#008000">// !    -     .</font> <br> <font color="#008000">//         ,      -.</font> <br> <font color="#008000">//          ,</font> <br> <font color="#008000">//   -- original: oldFunc ()  decoratorInstance: f ( )</font> <br> <font color="#0000ff">var</font> f = <font color="#0000ff">function</font> (){ <br> <font color="#0000ff">return</font> decorator.apply( <font color="#0000ff">this</font> , [{original: oldFunc, decoratorInstance: f}].concat([].slice.apply(arguments))) <br> } <br> <font color="#008000">//   - -  decoratorInstance f</font> <br> f.old = oldFunc; <br> <font color="#008000">//     -.</font> <br> <font color="#008000">//     -  .</font> <br> f.prototype = <font color="#0000ff">this</font> .prototype; <br> f.prototype.constructor = f; <br> <font color="#008000">//   -.    ?   .</font> <br> <font color="#008000">// . ,   decorateMethod:    .</font> <br> f.name = oldFunc.name; <br> <font color="#008000">//  </font> <br> <font color="#0000ff">return</font> f; <br> })</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br> <br>       (   <strong>decorate(...)</strong> ),         . <br>  : <br> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -</font> <br> <font color="#0000ff">function</font> strictArgs() { <br> <font color="#0000ff">var</font> types = arguments; <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#008000">//...</font> <br> <font color="#0000ff">return</font> arguments.callee.old.apply( <font color="#0000ff">this</font> , arguments); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br>   : <br> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -</font> <br> <font color="#0000ff">function</font> strictArgs() { <br> <font color="#0000ff">var</font> types = arguments; <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> (dScope) { <br> <font color="#0000ff">var</font> original = arguments[0].original; <font color="#008000">//   dScope.original</font> <br> <font color="#0000ff">var</font> arguments = Array.prototype.slice.call(arguments, 1); <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#008000">//...</font> <br> <font color="#0000ff">return</font> original.apply( <font color="#0000ff">this</font> , arguments); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br> <br>  ,     :) <br> <br></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <strong>decorate(...)</strong> <br> <font color="black">Function.method( <font color="#A31515">"decorate"</font> , <font color="#0000ff">function</font> (decorator){ <br> <font color="#008000">//   </font> <br> <font color="#0000ff">var</font> oldFunc = <font color="#0000ff">this</font> ; <br> <font color="#008000">// !    -     .</font> <br> <font color="#008000">//         ,      -.</font> <br> <font color="#008000">//          ,</font> <br> <font color="#008000">//   -- original: oldFunc ()  decoratorInstance: f ( )</font> <br> <font color="#0000ff">var</font> f = <font color="#0000ff">function</font> (){ <br> <font color="#0000ff">return</font> decorator.apply( <font color="#0000ff">this</font> , [{original: oldFunc, decoratorInstance: f}].concat([].slice.apply(arguments))) <br> } <br> <font color="#008000">//   - -  decoratorInstance f</font> <br> f.old = oldFunc; <br> <font color="#008000">//     -.</font> <br> <font color="#008000">//     -  .</font> <br> f.prototype = <font color="#0000ff">this</font> .prototype; <br> f.prototype.constructor = f; <br> <font color="#008000">//   -.    ?   .</font> <br> <font color="#008000">// . ,   decorateMethod:    .</font> <br> f.name = oldFunc.name; <br> <font color="#008000">//  </font> <br> <font color="#0000ff">return</font> f; <br> })</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br> <br>       (   <strong>decorate(...)</strong> ),         . <br>  : <br> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -</font> <br> <font color="#0000ff">function</font> strictArgs() { <br> <font color="#0000ff">var</font> types = arguments; <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#008000">//...</font> <br> <font color="#0000ff">return</font> arguments.callee.old.apply( <font color="#0000ff">this</font> , arguments); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br>   : <br> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -</font> <br> <font color="#0000ff">function</font> strictArgs() { <br> <font color="#0000ff">var</font> types = arguments; <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> (dScope) { <br> <font color="#0000ff">var</font> original = arguments[0].original; <font color="#008000">//   dScope.original</font> <br> <font color="#0000ff">var</font> arguments = Array.prototype.slice.call(arguments, 1); <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#008000">//...</font> <br> <font color="#0000ff">return</font> original.apply( <font color="#0000ff">this</font> , arguments); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br> <br>  ,     :) <br> <br></code> <blockquote> <code><code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <strong>decorate(...)</strong> <br> <font color="black">Function.method( <font color="#A31515">"decorate"</font> , <font color="#0000ff">function</font> (decorator){ <br> <font color="#008000">//   </font> <br> <font color="#0000ff">var</font> oldFunc = <font color="#0000ff">this</font> ; <br> <font color="#008000">// !    -     .</font> <br> <font color="#008000">//         ,      -.</font> <br> <font color="#008000">//          ,</font> <br> <font color="#008000">//   -- original: oldFunc ()  decoratorInstance: f ( )</font> <br> <font color="#0000ff">var</font> f = <font color="#0000ff">function</font> (){ <br> <font color="#0000ff">return</font> decorator.apply( <font color="#0000ff">this</font> , [{original: oldFunc, decoratorInstance: f}].concat([].slice.apply(arguments))) <br> } <br> <font color="#008000">//   - -  decoratorInstance f</font> <br> f.old = oldFunc; <br> <font color="#008000">//     -.</font> <br> <font color="#008000">//     -  .</font> <br> f.prototype = <font color="#0000ff">this</font> .prototype; <br> f.prototype.constructor = f; <br> <font color="#008000">//   -.    ?   .</font> <br> <font color="#008000">// . ,   decorateMethod:    .</font> <br> f.name = oldFunc.name; <br> <font color="#008000">//  </font> <br> <font color="#0000ff">return</font> f; <br> })</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br> <br>       (   <strong>decorate(...)</strong> ),         . <br>  : <br> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -</font> <br> <font color="#0000ff">function</font> strictArgs() { <br> <font color="#0000ff">var</font> types = arguments; <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#008000">//...</font> <br> <font color="#0000ff">return</font> arguments.callee.old.apply( <font color="#0000ff">this</font> , arguments); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br>   : <br> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -</font> <br> <font color="#0000ff">function</font> strictArgs() { <br> <font color="#0000ff">var</font> types = arguments; <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> (dScope) { <br> <font color="#0000ff">var</font> original = arguments[0].original; <font color="#008000">//   dScope.original</font> <br> <font color="#0000ff">var</font> arguments = Array.prototype.slice.call(arguments, 1); <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#008000">//...</font> <br> <font color="#0000ff">return</font> original.apply( <font color="#0000ff">this</font> , arguments); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br> <br>  ,     :) <br> <br></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <strong>decorate(...)</strong> <br> <font color="black">Function.method( <font color="#A31515">"decorate"</font> , <font color="#0000ff">function</font> (decorator){ <br> <font color="#008000">//   </font> <br> <font color="#0000ff">var</font> oldFunc = <font color="#0000ff">this</font> ; <br> <font color="#008000">// !    -     .</font> <br> <font color="#008000">//         ,      -.</font> <br> <font color="#008000">//          ,</font> <br> <font color="#008000">//   -- original: oldFunc ()  decoratorInstance: f ( )</font> <br> <font color="#0000ff">var</font> f = <font color="#0000ff">function</font> (){ <br> <font color="#0000ff">return</font> decorator.apply( <font color="#0000ff">this</font> , [{original: oldFunc, decoratorInstance: f}].concat([].slice.apply(arguments))) <br> } <br> <font color="#008000">//   - -  decoratorInstance f</font> <br> f.old = oldFunc; <br> <font color="#008000">//     -.</font> <br> <font color="#008000">//     -  .</font> <br> f.prototype = <font color="#0000ff">this</font> .prototype; <br> f.prototype.constructor = f; <br> <font color="#008000">//   -.    ?   .</font> <br> <font color="#008000">// . ,   decorateMethod:    .</font> <br> f.name = oldFunc.name; <br> <font color="#008000">//  </font> <br> <font color="#0000ff">return</font> f; <br> })</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br> <br>       (   <strong>decorate(...)</strong> ),         . <br>  : <br> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -</font> <br> <font color="#0000ff">function</font> strictArgs() { <br> <font color="#0000ff">var</font> types = arguments; <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#008000">//...</font> <br> <font color="#0000ff">return</font> arguments.callee.old.apply( <font color="#0000ff">this</font> , arguments); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br>   : <br> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -</font> <br> <font color="#0000ff">function</font> strictArgs() { <br> <font color="#0000ff">var</font> types = arguments; <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> (dScope) { <br> <font color="#0000ff">var</font> original = arguments[0].original; <font color="#008000">//   dScope.original</font> <br> <font color="#0000ff">var</font> arguments = Array.prototype.slice.call(arguments, 1); <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#008000">//...</font> <br> <font color="#0000ff">return</font> original.apply( <font color="#0000ff">this</font> , arguments); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br> <br>  ,     :) <br> <br></code> <blockquote> <code><code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <strong>decorate(...)</strong> <br> <font color="black">Function.method( <font color="#A31515">"decorate"</font> , <font color="#0000ff">function</font> (decorator){ <br> <font color="#008000">//   </font> <br> <font color="#0000ff">var</font> oldFunc = <font color="#0000ff">this</font> ; <br> <font color="#008000">// !    -     .</font> <br> <font color="#008000">//         ,      -.</font> <br> <font color="#008000">//          ,</font> <br> <font color="#008000">//   -- original: oldFunc ()  decoratorInstance: f ( )</font> <br> <font color="#0000ff">var</font> f = <font color="#0000ff">function</font> (){ <br> <font color="#0000ff">return</font> decorator.apply( <font color="#0000ff">this</font> , [{original: oldFunc, decoratorInstance: f}].concat([].slice.apply(arguments))) <br> } <br> <font color="#008000">//   - -  decoratorInstance f</font> <br> f.old = oldFunc; <br> <font color="#008000">//     -.</font> <br> <font color="#008000">//     -  .</font> <br> f.prototype = <font color="#0000ff">this</font> .prototype; <br> f.prototype.constructor = f; <br> <font color="#008000">//   -.    ?   .</font> <br> <font color="#008000">// . ,   decorateMethod:    .</font> <br> f.name = oldFunc.name; <br> <font color="#008000">//  </font> <br> <font color="#0000ff">return</font> f; <br> })</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br> <br>       (   <strong>decorate(...)</strong> ),         . <br>  : <br> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -</font> <br> <font color="#0000ff">function</font> strictArgs() { <br> <font color="#0000ff">var</font> types = arguments; <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#008000">//...</font> <br> <font color="#0000ff">return</font> arguments.callee.old.apply( <font color="#0000ff">this</font> , arguments); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br>   : <br> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -</font> <br> <font color="#0000ff">function</font> strictArgs() { <br> <font color="#0000ff">var</font> types = arguments; <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> (dScope) { <br> <font color="#0000ff">var</font> original = arguments[0].original; <font color="#008000">//   dScope.original</font> <br> <font color="#0000ff">var</font> arguments = Array.prototype.slice.call(arguments, 1); <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#008000">//...</font> <br> <font color="#0000ff">return</font> original.apply( <font color="#0000ff">this</font> , arguments); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br> <br>  ,     :) <br> <br></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <strong>decorate(...)</strong> <br> <font color="black">Function.method( <font color="#A31515">"decorate"</font> , <font color="#0000ff">function</font> (decorator){ <br> <font color="#008000">//   </font> <br> <font color="#0000ff">var</font> oldFunc = <font color="#0000ff">this</font> ; <br> <font color="#008000">// !    -     .</font> <br> <font color="#008000">//         ,      -.</font> <br> <font color="#008000">//          ,</font> <br> <font color="#008000">//   -- original: oldFunc ()  decoratorInstance: f ( )</font> <br> <font color="#0000ff">var</font> f = <font color="#0000ff">function</font> (){ <br> <font color="#0000ff">return</font> decorator.apply( <font color="#0000ff">this</font> , [{original: oldFunc, decoratorInstance: f}].concat([].slice.apply(arguments))) <br> } <br> <font color="#008000">//   - -  decoratorInstance f</font> <br> f.old = oldFunc; <br> <font color="#008000">//     -.</font> <br> <font color="#008000">//     -  .</font> <br> f.prototype = <font color="#0000ff">this</font> .prototype; <br> f.prototype.constructor = f; <br> <font color="#008000">//   -.    ?   .</font> <br> <font color="#008000">// . ,   decorateMethod:    .</font> <br> f.name = oldFunc.name; <br> <font color="#008000">//  </font> <br> <font color="#0000ff">return</font> f; <br> })</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br> <br>       (   <strong>decorate(...)</strong> ),         . <br>  : <br> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -</font> <br> <font color="#0000ff">function</font> strictArgs() { <br> <font color="#0000ff">var</font> types = arguments; <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#008000">//...</font> <br> <font color="#0000ff">return</font> arguments.callee.old.apply( <font color="#0000ff">this</font> , arguments); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br>   : <br> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// -</font> <br> <font color="#0000ff">function</font> strictArgs() { <br> <font color="#0000ff">var</font> types = arguments; <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> (dScope) { <br> <font color="#0000ff">var</font> original = arguments[0].original; <font color="#008000">//   dScope.original</font> <br> <font color="#0000ff">var</font> arguments = Array.prototype.slice.call(arguments, 1); <br> <font color="#0000ff">var</font> <font color="#0000ff">params</font> = arguments; <br> <font color="#008000">//...</font> <br> <font color="#0000ff">return</font> original.apply( <font color="#0000ff">this</font> , arguments); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br> <br>  ,     :) <br> <br></code> </div><p>Source: <a href="https://habr.com/ru/post/59761/">https://habr.com/ru/post/59761/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../59754/index.html">The structure of the company</a></li>
<li><a href="../59756/index.html">Wolfram Alpha started work</a></li>
<li><a href="../59758/index.html">Call of Duty 6 has not yet been released, and Call of Duty 8 is already in development.</a></li>
<li><a href="../59759/index.html">Sorry NPW</a></li>
<li><a href="../59760/index.html">Germany through the eyes of a Belarusian student</a></li>
<li><a href="../59762/index.html">What the fuck: social media?</a></li>
<li><a href="../59765/index.html">Caster - indie third-person shooter game</a></li>
<li><a href="../59766/index.html">Task Management in MLO</a></li>
<li><a href="../59767/index.html">New KDE4: NEPOMUK</a></li>
<li><a href="../59768/index.html">IT emigration to Cyprus: personal experience</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>