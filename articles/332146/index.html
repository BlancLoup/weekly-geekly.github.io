<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Redux business logic</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once in the Telegram-chat React_JS (by the way, the Russian-language chat, join) discussed the question: "where in the React-application should be loc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Redux business logic</h1><div class="post__text post__text-html js-mediator-article"><p>  Once in the Telegram-chat React_JS (by the way, the Russian-language chat, join) discussed the question: "where in the React-application should be located the code responsible for the business logic."  There are several options, opinions are divided.  Well, I decided to record a <a href="http://5minreact.ru/13-redux-business-logic/">podcast</a> (by <a href="https://twitter.com/PetrMyazin">@PetrMyazin</a> ). <a name="habracut"></a></p><br><p>  Consider a particular example of business logic exclusively on the client.  Application "loan calculator".  The user enters into the form the initial data: amount, term of the loan, some other parameters;  and on the fly gets the result, for example, the amount of overpayment.  The whole cunning algorithm for calculating the amount of overpayment is known and already implemented as a JS function, let's call it f, which takes several parameters - the same data from the form, let it be abcd, and this function returns a numerical result (the amount of overpayment, we denote it as x) - this is our business logic. </p><br><p>  Please note that the function is clean.  Its result depends only on the input parameters.  It does not produce any side effects, does not read from global variables.  Also, this function can be called independent of the framework, because it will work equally in React-application, and in Angular, and in Ember, and in jQuery, and even on VanillaJS. </p><br><p>  But we decided to build an interface on React + Redux, so now the question has arisen: "at what moment to start the calculation of our business logic."  Once again I will emphasize that in this podcast we will consider only a simplified example - all calculations on the client, no requests to the server.  In a real application, we will probably have some of the logic tied up to communicate with the server, but there will also be a part that can be completely calculated on the client from the data already available.  So all further reasoning is applicable to the second part - calculations on the client. </p><br><p>  Well, take a look at the form.  It consists of: a pair of text fields, sliders, drop-down lists, checkboxes.  The values ‚Äã‚Äãof these fields entered by the user will become input parameters to the function f.  The first question: "where and how will we store field values".  There are only two options: either in the local state of the components themselves (checkboxes, sliders, and the like), or in the Redux-store. </p><br><p>  A local state, spread over several components, is inconvenient in this case, since  we finally need to get all the values ‚Äã‚Äãat the same time to pass them abcd parameters to the business logic function.  We would like to store everything in one place: either in a certain common ancestor (remember the <a href="https://facebook.github.io/react/docs/lifting-state-up.html">lifting state up</a> ) or in the Redux-store.  Since the topic of this podcast is a review of business logic in a Redux application, we will store it in Redux. </p><br><p>  Let's go through the steps of the whole chain of events and try to estimate at what point it is best to call the function of business logic f. </p><br><p>  So, the user changes something on the form, enters a new number into the text input field, or moves the slider.  A handleChange handler is running - this is the first place to invoke business logic.  But in the handleChange handler, we can read only the value of the currently modified input field from event.target.value, and the rest of these forms are not yet available to us.  Let me remind you, the function f is pure, it does not read any data from global variables.  It only takes the abcd parameters, and returns the result x.  This means that the handleChange handler is not suitable by itself. </p><br><p>  The next step is the action-creator function.  Here, using <a href="https://github.com/gaearon/redux-thunk">Redux-thunk</a> , we can get the entire state object, i.e.  get abcd to call f.  Action-creator is a good challenger, remember it. </p><br><p>  Go ahead.  The flow of execution proceeds to the launch of all reducer functions.  Reducers can be implemented in different ways.  For example, we will prepare four separate functions for the field a, for the field b, for the field c and for the field d.  In this case, each of the reducers has access to the previous state of its input field and to the action object.  We, to start the function f, need all the abcd values ‚Äã‚Äãat the same time.  With such an organization of redirectors, the only chance is if we forward all four abcd values ‚Äã‚Äãinside the action object.  In fact, we thus transfer to the action object an almost complete copy of the store.  It does not sound very much, I do not want to do that. </p><br><p>  Another way of organizing a reducer is a single reducer that will update all form fields at once, a kind of formData reducer.  It takes the previous state of the form fields as an object containing abcd, updates the changed value, and then starts the business logic function f.  But wait, but where will we add the result of the calculations, that same amount of overpayment x?  Being inside the formData-reducer, the only place where we can save x is to the same object, which now we will have five fields: abcd and x.  It is just right to rename this reducer into formDataAndResult-reducer.  He does everything: he remembers the change of form, and remembers the result of the calculation of business logic.  All in one large object of five fields.  It does not sound too.  Too fat reducer, too much of everything.  Redux sets us up on functional approaches, on the composition of the reducer.  And here we are writing one big function to control everything at once. </p><br><p>  Next, we run selectors in container components.  Selectors are functions in mapStateToProps.  We are interested in the selector for the component that displays the final result x.  Yes, here you can make a call to the business logic function, since  the selector has access to the entire state, and to the already updated state with fresh abcd values ‚Äã‚Äã(I‚Äôll make a slight emphasis on this);  and the result of calculating the function f, called inside the selector, falls into the props component, which represents the amount of overpayment, which is a working solution. </p><br><p>  If not in the selector, then the last chance to call the business logic is to call the function f directly in the render method of the x component, the one that displays the overpayment amount.  To do this, in props you have to drop all four required abcd values.  In my opinion this is a less elegant solution than the previous one.  Selectors appear to be the more appropriate place to run calculations, and pass an already prepared x for display. </p><br><p>  We considered all the options.  Well, almost everything.  It was possible to discuss dumb methods, such as launching calculations in the component will receive props, or even think of something else.  But let's not waste time. </p><br><p>  So, we have two obvious candidates for launching business logic - this is the action creator and the component selector x. </p><br><p>  Take a look at the action creator for details.  First, we will answer the question: "we will have one action creator for all fields of the form, or a separate function for each of the fields".  If we make separate functions, we get four action creaters: changeA, changeB, changeC and changeD;  which will actually resemble each other like two drops of water.  If we want to call the function f inside the action creator, these calls will have to copy all four functions into the code.  A lot of copy-paste.  Although, who works closely with Redux, the boilerplate code is not afraid.  Here you can create a factory - create action creator, to avoid copying the code. </p><br><p>  But I propose not to go into this direction, let's describe one action creator function better, it will accept fieldName and newValue.  fieldName is a string variable denoting the input field into which the user has entered something.  Using Redux-thunk, we can access the entire current state inside our action creator, which we need to call the function f. </p><br><p>  But note that the f function should get the latest abcd values, and the state that we get thanks to Redux-thunk is already an outdated state.  One of the fields has the old meaning.  Before calling the function f, we need to understand exactly which parameter to substitute with newValue.  From the point of view of JS-syntax, you can come up with a dozen elegant and not very solutions.  But the fact remains that if we want to call f inside the action creator, we need to take the current state, i.e.  already a bit outdated, and merge it with the newValue just arrived.  Does this not remind us of a reducer function that does exactly the same thing?  It turns out that we have to duplicate the logic of the reducer inside the action creater to form the latest abcd values. </p><br><p>  Further more.  Suppose we get the result of calling the business logic function inside the action creater, but now we need to bring the resulting value of x to the component that represents the amount of the overpayment.  We'll have to forward through the Redux store, writing the appropriate reducer and selector.  Having done this, note that the store now stores both the abcd form data and the result of the x calculation at the same time.  Store turned out to be redundant.  In addition to the original data, it also has the result of derived calculations.  This is not good for many reasons.  Some of them we discussed in previous releases.  Conclusion: the action creator is a poor choice for calling a business logic function. </p><br><p>  We proceed to the variant with calling the business logic function from the selector.  I already mentioned his mechanics above.  The component selector that displays the overpayment amount has access to the entire store.  And to the most current values ‚Äã‚Äãof abcd.  No duplication of the reducer code.  Having abcd inside the selector, we call f, and pass the result x as props to the component that represents the overpayment amount.  Simple, logical, without duplication of code and without redundant state.  A selector is a great place to call a business logic function, which is represented by a pure function of data. </p><br><p>  Focusing on the last phrase that we considered only the calculation on the client.  If your business logic is not a pure function, but a whole process, with a trip to the server, i.e.  with some side effects, this is a topic for another conversation.  Here you just need to pay attention to the action creator, and the middleware.  But let's discuss it another time. </p><br><p>  Write on React and prosper! </p><br><p>  PS There are sharp questions, <a href="https://youtu.be/ST_0yLXXQeo">answers in the next podcast</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/332146/">https://habr.com/ru/post/332146/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332134/index.html">One bit broke, another lost: data transfer task</a></li>
<li><a href="../332138/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ269 (June 26 - July 2, 2017)</a></li>
<li><a href="../332140/index.html">Konstantin Krivopustov and Alexey Stukalov about the CUBA Platform on jug.msk.ru</a></li>
<li><a href="../332142/index.html">Game control models in the context of incomplete information</a></li>
<li><a href="../332144/index.html">LibGDX + Scene2d (we program on Kotlin). Part 0</a></li>
<li><a href="../332160/index.html">Docker 17.06 and Kubernetes 1.7: key innovations</a></li>
<li><a href="../332162/index.html">FinWin-2017: competition fintech projects and the latest trends in the banking sector</a></li>
<li><a href="../332164/index.html">Introduction to procedural animation</a></li>
<li><a href="../332166/index.html">We simulate device control with actor</a></li>
<li><a href="../332168/index.html">Three years of successful provision of public rental services of virtual machines with Apache CloudStack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>