<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About RecyclerView and item selection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi% username%! 
 In this article I want to tell a little about the new widget in the Android SDK - RecyclerView, about the implementation of selection...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About RecyclerView and item selection</h1><div class="post__text post__text-html js-mediator-article">  Hi% username%! <br>  In this article I want to tell a little about the new widget in the Android SDK - RecyclerView, about the implementation of selection of elements and several useful "recipes" when working with it. <div style="text-align:center;"><img src="https://habrastorage.org/files/ec1/52f/468/ec152f4680354ceebf397c0775fdaaeb.png"></div><a name="habracut"></a><br><br><h1>  Content </h1><br><ol><li>  <a href="https://habr.com/ru/post/258195/">A bit about ViewHolder'ah</a> </li><li>  <a href="https://habr.com/ru/post/258195/">Briefly about RecyclerView</a> </li><li>  <a href="https://habr.com/ru/post/258195/">Select items</a> </li><li>  <a href="https://habr.com/ru/post/258195/">Conclusion + Bonus</a> </li><li>  <a href="https://habr.com/ru/post/258195/">useful links</a> </li></ol><br><a name="aricle1"></a><h1>  1. A bit of ViewHolder </h1><br>  Before the release of the <a href="https://developer.android.com/about/versions/lollipop.html">Android SDK 5.0 Lollipop,</a> <a href="https://developer.android.com/reference/android/widget/ListView.html">ListView</a> and <a href="https://developer.android.com/reference/android/widget/GridView.html">GridView</a> widgets were used to display lists and tables.  A general recommendation when working with this widget was to use the ViewHolder pattern.  The essence of the pattern is that for each element of the list an object is created that stores references to individual views inside the element.  Thus, you have to perform a rather expensive call <a href="http://developer.android.com/reference/android/view/View.html">findViewById (int)</a> only once when creating an item. <br><br>  An example of a typical ViewHolder straight from <a href="http://developer.android.com/training/improving-layouts/smooth-scrolling.html">Google‚Äôs guides</a> : <pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class"> </span></span>{ TextView text; TextView timestamp; ImageView icon; ProgressBar progress; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> position; }</code> </pre> <br>  The link to such a holder for each element is stored in the root layout using the <a href="http://developer.android.com/reference/android/view/View.html">setTag (int, Object)</a> method (from my point of view, it is also a crutch). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="article2"></a><h1>  2. Briefly about RecyclerView </h1><br>  By the release of Android SDK 5.0, Google‚Äôs Lollipop developer finally dawned that the two widgets listed above are outdated and need to be replaced with something more stylish, fashionable and youthful.  It was decided not to redo old widgets, but to write a new one.  This is how <a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.html">RecyclerView</a> came into being.  So what are its differences, you ask? <br><br>  I will give a brief basic, but for a more complete disclosure I advise you to read <a href="http://habrahabr.ru/post/237101/">this article on Habr√©</a> .  So: <ol><li>  The widget itself no longer takes the responsibility of placing the elements.  For this appeared <a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.LayoutManager.html">LayoutManager'y</a> . </li><li>  The <a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.ViewHolder.html">ViewHolder</a> pattern <a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.ViewHolder.html">has</a> become mandatory.  Moreover, the widget has learned to re-use already created ViewHolders and to delete those that are no longer used (hence the name), which favorably affects the speed and size of the used memory. </li><li>  New, convenient way to work with animation. </li></ol><br>  I tried it and the widget left me with mixed impressions.  On the one hand, yes, it's great that now the use of the ViewHolder is mandatory, it seems to work faster too, it eats less memory.  On the other hand, there are problems with the complexity and unfinishedness of the widget. <br><br>  What do I mean by complexity?  If something didn‚Äôt work in ListView (or didn‚Äôt work as planned), you could always get into the sources, figure out what the error was, fix it, tuck the crutches here and there and everything would start working.  RecyclerView is much more difficult in terms of the logic of the work, you break the brain until you figure it out.  I tried, but abandoned, too much time and effort is needed for this. <br><br>  The second problem is the banal lack of functionality that was present in the ListView and GridView.  You don‚Äôt need to go far for examples - the standard functionality of selecting elements (the further topic of this article), the indents between the elements.  Previously, in order to add all this, you had to write literally a couple of lines of code, now dozens of lines will go to this.  There are animations, but only for adding / deleting / editing an element.  If you want, for example, to animate a partial change of an element, then a bird of oblomingo is already knocking on your door.  The widget does not support animation of a part of the element, and if you animate an element from the outside (from the adapter, for example), then it is better not to do this - such manipulations leave the widget elements (those ViewHolders) in an undefined state, which leads to a completely fantastic behavior of your list. <br><br>  Summarizing - if you have old widgets in your project and you are not using animations, then it is best to leave everything as it is and wait until the widget is filled with missing functionality.  If you want simple animations and at the same time user interaction with the widget implies a simple one - try RecyclerView, suddenly like it. <br><br><a name="article3"></a><h1>  3. Select items </h1><br>  So, let's move on to the main point - to the technical part of the article.  Talk about how to select items in RecyclerView.  At once I will make a reservation - the idea of ‚Äã‚Äãimplementation is drawn from the wonderful series of Bill Phillips articles on RecyclerView ( <a href="https://habr.com/ru/post/258195/">links at the end</a> ), so that all of the following can be considered a free brief retelling. <br>  In ListView, the <a href="https://developer.android.com/reference/android/widget/AbsListView.html">setChoiceMode (int)</a> method was used to select elements, <a href="https://developer.android.com/reference/android/widget/AbsListView.html">but</a> RecyclerView has no idea that elements can be allocated, so we need to teach our adapter to do this. <br><br>  The scheme is as follows: <img src="https://habrastorage.org/files/f14/62d/04a/f1462d04ab594cf996150148fb37ee79.png"><br>  In the diagram, I schematically outlined the connections between objects.  Dotted arrows - links, the rest - calls to methods.  In green, I marked the objects that directly implement the selection logic. <br><br>  The principle of operation is as follows: <ol><li>  ViewHolderWrapper sets itself as a ClickListener for the ViewHolder root view and begins to receive onClick and onLongClick events.  Depending on the implementation, it can simply proxy these events in HolderClickObservable (ViewHolderClickWrapper), or, based on the current status of the <a href="">SelectionHelper,</a> select an item with a call to setItemSelected (ViewHolder, boolean) (ViewHolderMultiSelectionWrapper). </li><li>  SelectionHelper saves information about selected items and notifies listeners ( <a href="">SelectionObserver</a> ) about changes to the selection. </li><li>  The listener (in our case, the adapter) is responsible for the visual display of the selection of the element, as well as the interaction with it (in the diagram, call the startActionMode of the <a href="https://developer.android.com/reference/android/app/Activity.html">Activity</a> ). </li></ol><br>  In the adapter itself, you must make the following changes: <br><br>  1. Create a SelectionHelper and register listeners (in this case, the adapter itself, but it could be an Activity, for example) <pre> <code class="java hljs">mSelectionHelper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SelectionHelper(mHolderTracker); mSelectionHelper.registerSelectionObserver(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre> <br>  2. Wrap the created ViewHolders in the ViewHolderWrapper of the desired type. <pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup viewGroup, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ LayoutInflater inflater = LayoutInflater.from(viewGroup.getContext()); ImageViewHolder holder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImageViewHolder( inflater.inflate(R.layout.gallery_item, viewGroup, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mSelectionHelper.wrapSelectable(holder); }</code> </pre>  The wrapSelectable (ViewHolder) method of SelectionHelper: <pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;H extends RecyclerView.ViewHolder&gt; <span class="hljs-function"><span class="hljs-function">H </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapSelectable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(H holder)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewHolderMultiSelectionWrapper(holder); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> holder; }</code> </pre> <br>  3. Do not forget to attach our ViewHolder to the SelectionHelper in the <a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.Adapter.html">adapter's onBindViewHolder (ViewHolder, int)</a> method! <pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder viewHolder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ Image image = mDataSet.getItem(position); ImageViewHolder imageViewHolder = (ImageViewHolder) viewHolder; imageViewHolder.bindInfo(image); Checkable view = (Checkable) viewHolder.itemView; view.setChecked(mSelectionHelper.isItemSelected(position)); mHolderTracker.bindHolder(imageViewHolder, position); }</code> </pre> <br>  This is necessary because there is no other way to get a list of currently used ViewHolders from RecyclerView.  If you do not keep their records, if necessary, update the selection of the selection of all selected elements (the user closed the ActionMode, for example), SelectionHelper simply can not do this.  The views will remain highlighted when, in fact, they are not. <br><br>  You may ask - ‚ÄúWhy not just remember the allocated ViewHolders in the setItemSelected (ViewHolder, boolean) method?‚Äù.  This is where the RecyclerView feature affects - it uses the newly created ViewHolder's. <br><br>  It looks like this: <ol><li>  Open the application.  On the screen 10 elements - 10 ViewHolder'ov created for them. </li><li>  We start ActionMode, we start to select elements - 1,2,3. </li><li>  Scroll the view down, we see elements from 10 to 20. Do you think that 20 ViewHolders hang in memory now?  No matter how!  For a piece of data, RecyclerView will create new ViewHolders, and for the other, re-use existing ones.  And it is not known in what order. </li><li>  Now, if we scroll the view back up, some of our 10 ViewHolders will be destroyed, new ones will be created instead.  The rest will be used again and is not necessary for the same items. </li><li>  Cancel the ActionMode.  SelectionHelper should scroll notifications to listeners about the changed selection on elements indicating ViewHolder for each element, but it no longer owns the actual data, all Holder's have changed! </li></ol><br>  As a result, this will cause some elements to remain displayed with a selection. <br><br>  And here another important point becomes obvious - you can‚Äôt keep strong references to ViewHolders!  They can be removed from the RecyclerView depending on the phase of the moon and the desire of the left heel of Larry Page.  In this case, if we keep strict references to them, a memory leak will occur.  Therefore, only <a href="http://developer.android.com/reference/java/lang/ref/WeakReference.html">WeakReference is</a> used to store references in ViewHolderWrapper and <a href="http://developer.android.com/reference/java/lang/ref/WeakReference.html">WeakHolderTracker</a> . <pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolderWrapper</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">android</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnClickListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> WeakReference&lt;RecyclerView.ViewHolder&gt; mWrappedHolderRef; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ViewHolderWrapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder)</span></span></span><span class="hljs-function"> </span></span>{ mWrappedHolderRef = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WeakReference&lt;&gt;(holder); } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">WeakHolderTracker</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WeakHolderTracker</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SparseArray&lt;WeakReference&lt;RecyclerView.ViewHolder&gt;&gt; mHoldersByPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SparseArray&lt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bindHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ mHoldersByPosition.put(position, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WeakReference&lt;&gt;(holder)); } <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ WeakReference&lt;RecyclerView.ViewHolder&gt; holderRef = mHoldersByPosition.get(position); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (holderRef == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { mHoldersByPosition.remove(position); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } RecyclerView.ViewHolder holder = holderRef.get(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (holder == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || (holder.getAdapterPosition() != position &amp;&amp; holder.getAdapterPosition() != RecyclerView.NO_POSITION)) { mHoldersByPosition.remove(position); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> holder; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;RecyclerView.ViewHolder&gt; getTrackedHolders() { List&lt;RecyclerView.ViewHolder&gt; holders = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; mHoldersByPosition.size(); i++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> key = mHoldersByPosition.keyAt(i); RecyclerView.ViewHolder holder = getHolder(key); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (holder != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { holders.add(holder); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> holders; } }</code> </pre> </div></div><br>  4. It is also important not to forget in onBindViewHolder (ViewHolder, int) to visually display the selection if it is (if not, do not forget to remove it!).  You remember that for a non-selected item, the ViewHolder that was previously used for a non-selected item and vice versa can be used? <br>  I implemented it as follows: <br><br>  4.1.  SelectableRecyclerViewAdapter.onBindViewHolder (ViewHolder, int) <pre> <code class="java hljs">Checkable view = (Checkable) viewHolder.itemView; view.setChecked(mSelectionHelper.isItemSelected(position));</code> </pre> <br>  4.2.  element layout file <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">com.bejibx.android.recyclerview.example.ui.widget.CheckableAutofitHeightFrameLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"80dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"80dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#AAA"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:foreground</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/gallery_item_foreground"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:ignore</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ContentDescription,RtlHardcoded"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">com.bejibx.android.recyclerview.example.ui.widget.CheckableAutofitHeightFrameLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">4.3.</b>  <b class="spoiler_title">CheckableAutofitHeightFrameLayout widget</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CheckableAutofitHeightFrameLayout</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FrameLayout</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Checkable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] CHECKED_STATE_SET = {android.R.attr.state_checked}; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> mIsChecked; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> mIsCheckable; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckableAutofitHeightFrameLayout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckableAutofitHeightFrameLayout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AttributeSet attrs)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, attrs); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckableAutofitHeightFrameLayout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AttributeSet attrs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> defStyleAttr)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, attrs, defStyleAttr); } <span class="hljs-meta"><span class="hljs-meta">@TargetApi</span></span>(Build.VERSION_CODES.LOLLIPOP) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckableAutofitHeightFrameLayout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AttributeSet attrs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> defStyleAttr, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> defStyleRes)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, attrs, defStyleAttr, defStyleRes); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] onCreateDrawableState(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> extraSpace) { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] drawableState = <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreateDrawableState(extraSpace + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isChecked()) { mergeDrawableStates(drawableState, CHECKED_STATE_SET); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> drawableState; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isCheckable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mIsCheckable; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCheckable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isCheckable)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> wasCheckable = isCheckable(); mIsCheckable = isCheckable; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isCheckable &amp;&amp; isChecked()) { setChecked(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (wasCheckable ^ mIsCheckable) { refreshDrawableState(); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setChecked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isChecked)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> wasChecked = isChecked(); mIsChecked = isCheckable() &amp;&amp; isChecked; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (wasChecked ^ mIsChecked) { refreshDrawableState(); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isChecked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mIsChecked; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toggle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ setChecked(!mIsChecked); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMeasure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> widthMeasureSpec, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> heightMeasureSpec)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//noinspection SuspiciousNameCombination super.onMeasure(widthMeasureSpec, widthMeasureSpec); } }</span></span></code> </pre> </div></div><br>  CheckableAutofitHeightFrameLayout adds only 2 things to <a href="http://developer.android.com/reference/android/widget/FrameLayout.html">FrameLayout</a> : first, it is always square (see onMeasure (int, int)) and, second, it adds state_checked to DrawableStates (those used in xml).  As a result, you can use <a href="http://developer.android.com/reference/android/graphics/drawable/StateListDrawable.html">StateListDrawable</a> on something like this to display the selection of such a layout: <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">selector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:state_pressed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shape</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stroke</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@color/accent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1dp"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shape</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:state_checked</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shape</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:shape</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rectangle"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stroke</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@color/accent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1dp"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">solid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@color/accent_alpha"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shape</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:drawable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:color/transparent"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">selector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  and all the details of the display crawl into the xml-ki, in Java only need to set the appropriate state. <br><br>  5. Send the onSelectableChanged (boolean) event to the Activity and start the ActionMode: <br><br>  In Adapter <pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSelectableChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isSelectable)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isSelectable) { mActivity.startActionMode(); } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Running ActionMode in Activity</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GalleryActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ActionModeCallback mActionModeCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActionModeCallback(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SelectableRecyclerViewAdapter mAdapter; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); RecyclerView recyclerView = (RecyclerView) findViewById(R.id.gallery); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> columnWidth = getResources().getDimensionPixelSize(R.dimen.column_width); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vSpacing = getResources().getDimensionPixelSize(R.dimen.grid_spacing_vertical); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hSpacing = getResources().getDimensionPixelSize(R.dimen.grid_spacing_horizontal); recyclerView.setLayoutManager(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GridAutofitLayoutManager(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, columnWidth)); recyclerView.addItemDecoration(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GridSimpleSpacingDecoration(hSpacing, vSpacing)); DataSet&lt;Image&gt; dataSet = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DummyImagesDataSet(); mAdapter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SelectableRecyclerViewAdapter(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, dataSet); recyclerView.setAdapter(mAdapter); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startActionMode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ startActionMode(mActionModeCallback); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionModeCallback</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionMode</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Callback</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SelectionObserver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ActionMode mActionMode; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPrepareActionMode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActionMode actionMode, Menu menu)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDestroyActionMode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActionMode actionMode)</span></span></span><span class="hljs-function"> </span></span>{ SelectionHelper selectionHelper = mAdapter.getSelectionHelper(); selectionHelper.unregisterSelectionObserver(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); mActionMode = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; selectionHelper.setSelectable(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateActionMode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActionMode actionMode, Menu menu)</span></span></span><span class="hljs-function"> </span></span>{ mActionMode = actionMode; mActionMode.getMenuInflater().inflate(R.menu.gallery_selection, menu); mAdapter.getSelectionHelper().registerSelectionObserver(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActionItemClicked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActionMode actionMode, MenuItem menuItem)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (menuItem.getItemId()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> R.id.menu_toast: Toast.makeText(GalleryActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, R.string.text_simple_toast, Toast.LENGTH_SHORT).show(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSelectedChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isSelected)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mActionMode != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> checkedImagesCount = mAdapter.getSelectionHelper().getSelectedItemsCount(); mActionMode.setTitle(String.valueOf(checkedImagesCount)); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSelectableChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isSelectable)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isSelectable) { mActionMode.finish(); } } } }</code> </pre> </div></div><br>  As you can see, when you launch the ActionMode, it registers itself as a SelectionObserver.  Thus, it is possible to update the number of selected items in the header.  Remember to call unregisterSelectionObserver (SelectionObserver) when closing! <br><br><a name="article4"></a><h1>  4. Conclusion + Bonus </h1><br>  Seems to have sorted it out.  The entire source code can also be viewed on <a href="https://github.com/bejibx/android-recyclerview-example">GitHub</a> . <br><br>  In conclusion, I will briefly give a few more chips for working with RecyclerView, which you can find in the example. <br><br>  1. If you do not need to select elements, but you just need to handle clicks, instead of the ViewHolderMultiSelectionWrapper, wrap the elements in ViewHolderClickWrapper using the wrapClickable (ViewHolder) method.  The adapter itself in this case will look something like this: <div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SelectableRecyclerViewAdapter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Adapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SelectionObserver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SelectionHelper mSelectionHelper; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SelectableRecyclerViewAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mSelectionHelper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SelectionHelper(); mSelectionHelper.registerSelectionObserver(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SelectionHelper </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSelectionHelper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mSelectionHelper; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup viewGroup, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ LayoutInflater inflater = LayoutInflater.from(viewGroup.getContext()); ImageViewHolder holder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImageViewHolder( inflater.inflate(R.layout.gallery_item, viewGroup, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mSelectionHelper.wrapClickable(holder); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onHolderClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder holder)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// perform item click } @Override public boolean onHolderLongClick(RecyclerView.ViewHolder holder) { // perform item long click return false; } //... }</span></span></code> </pre> </div></div><br>  2. <a href="https://developer.android.com/reference/android/support/v7/widget/GridLayoutManager.html">GridLayoutManager</a> can not automatically select the number of columns depending on the width of the content.  I added this functionality to <div class="spoiler">  <b class="spoiler_title">GridAutofitLayoutManager</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GridAutofitLayoutManager</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GridLayoutManager</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mColumnWidth; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> mColumnWidthChanged = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GridAutofitLayoutManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> columnWidth)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* Initially set spanCount to 1, will be changed automatically later. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, <span class="hljs-number"><span class="hljs-number">1</span></span>); setColumnWidth(checkedColumnWidth(context, columnWidth)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GridAutofitLayoutManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> columnWidth, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> orientation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reverseLayout)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* Initially set spanCount to 1, will be changed automatically later. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, <span class="hljs-number"><span class="hljs-number">1</span></span>, orientation, reverseLayout); setColumnWidth(checkedColumnWidth(context, columnWidth)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkedColumnWidth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> columnWidth)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (columnWidth &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { context.getResources().getDimensionPixelSize(R.dimen.rv_def_column_width); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> columnWidth; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setColumnWidth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newColumnWidth)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newColumnWidth &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; newColumnWidth != mColumnWidth) { mColumnWidth = newColumnWidth; mColumnWidthChanged = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">/* I don't actually remember why I choose to set span count in onLayoutChildren, I wrote this class some time ago. But the point is we need to do so after view get measured, so we can get its height and width. */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLayoutChildren</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.Recycler recycler, RecyclerView.State state)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mColumnWidthChanged &amp;&amp; mColumnWidth &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> totalSpace; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getOrientation() == VERTICAL) { totalSpace = getWidth() - getPaddingRight() - getPaddingLeft(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { totalSpace = getHeight() - getPaddingTop() - getPaddingBottom(); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> spanCount = Math.max(<span class="hljs-number"><span class="hljs-number">1</span></span>, totalSpace / mColumnWidth); setSpanCount(spanCount); mColumnWidthChanged = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onLayoutChildren(recycler, state); } }</code> </pre> </div></div><br>  The widget adjusts the width of the columns depending on the columnWidth parameter.  An important point: if the available width is 330 pixels, and we pass the desired width to 100, the table will end up with 3 columns of 110 pixels each and the elements will be that width.  That is why I also made CheckableAutofitHeightFrameLayout automatically changing its height depending on the width. <br><br>  3. To add padding between elements, you can set paddingTop / Left on the RecyclerView and marginRight / Bottom on the elements, however it looks like a crutch.  The recommended way is to add an <a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.ItemDecoration.html">ItemDecoration</a> to the RecyclerView.  In the example you can find a few.  To add indents to the usual GridLayoutManager (by ‚Äúnormal‚Äù I mean the GridLayoutManager with the standard <a href="https://developer.android.com/reference/android/support/v7/widget/GridLayoutManager.SpanSizeLookup.html">SpanSizeLookup</a> , in it each element takes 1 span) can be used <div class="spoiler">  <b class="spoiler_title">GridSimpleSpacingDecoration</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GalleryActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ActionModeCallback mActionModeCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActionModeCallback(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SelectableRecyclerViewAdapter mAdapter; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); RecyclerView recyclerView = (RecyclerView) findViewById(R.id.gallery); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> columnWidth = getResources().getDimensionPixelSize(R.dimen.column_width); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vSpacing = getResources().getDimensionPixelSize(R.dimen.grid_spacing_vertical); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hSpacing = getResources().getDimensionPixelSize(R.dimen.grid_spacing_horizontal); recyclerView.setLayoutManager(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GridAutofitLayoutManager(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, columnWidth)); recyclerView.addItemDecoration(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GridSimpleSpacingDecoration(hSpacing, vSpacing)); DataSet&lt;Image&gt; dataSet = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DummyImagesDataSet(); mAdapter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SelectableRecyclerViewAdapter(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, dataSet); recyclerView.setAdapter(mAdapter); } <span class="hljs-comment"><span class="hljs-comment">//...</span></span></code> </pre> </div></div><br>  That seems to be all.  Thank you for your attention and for your lists to never slow down! <br><a name="references"></a><br><h1>  5. Useful links </h1><br><ol><li>  <a href="https://www.bignerdranch.com/blog/recyclerview-part-1-fundamentals-for-listview-experts/">The first part of Bill Phillips' article on RecyclerView.</a>  <a href="https://www.bignerdranch.com/blog/recyclerview-part-1-fundamentals-for-listview-experts/">Basic Information (in English)</a> </li><li>  <a href="https://www.bignerdranch.com/blog/recyclerview-part-2-choice-modes/">The second part of Bill Phillips' article on RecyclerView.</a>  <a href="https://www.bignerdranch.com/blog/recyclerview-part-2-choice-modes/">About highlighting items (in English)</a> </li><li>  <a href="https://www.grokkingandroid.com/first-glance-androids-recyclerview/">Review article about RecyclerView (in English)</a> </li><li>  <a href="http://developer.android.com/training/improving-layouts/smooth-scrolling.html">ViewHolder Pattern Information for ListView (in English)</a> </li><li>  <a href="http://habrahabr.ru/company/etransport/blog/250689/">Make the parallax header in RecyclerView</a> </li><li>  <a href="http://habrahabr.ru/post/237101/">Basic information about RecyclerView and CardView</a> </li><li>  <a href="http://habrahabr.ru/company/surfingbird/blog/244387/">About switching to RecyclerView</a> </li><li>  <a href="http://habrahabr.ru/post/169883/">Java Link Types</a> </li><li>  <a href="https://github.com/lucasr/twoway-view">Useful library for working with RecyclerView</a> (thanks to user <a href="https://habrahabr.ru/users/artemgapchenko/" class="user_link">artemgapchenko</a> ) </li></ol><br>  Ps.  I express <a href="https://habrahabr.ru/users/qayatri/" class="user_link">my deep</a> gratitude to the user <a href="https://habrahabr.ru/users/qayatri/" class="user_link">Qayatri</a> for help in preparing the publication!  Also, once again, thank <a href="https://habrahabr.ru/users/artemgapchenko/" class="user_link">artemgapchenko</a> for a valuable comment! </div><p>Source: <a href="https://habr.com/ru/post/258195/">https://habr.com/ru/post/258195/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258181/index.html">Minim bitcoin with paper and pen</a></li>
<li><a href="../258183/index.html">Certificate Authority AD + Smart Card = Authorization of the user in the domain</a></li>
<li><a href="../258185/index.html">About transferring a project from Objective-C to Swift</a></li>
<li><a href="../258189/index.html">The history and future of special features</a></li>
<li><a href="../258193/index.html">nanoCAD Plus 7: the development of CAD platform a year-long</a></li>
<li><a href="../258197/index.html">With enough money, all the mistakes come to the surface.</a></li>
<li><a href="../258199/index.html">ntfsclone - will create an image as others can not afford</a></li>
<li><a href="../258201/index.html">Discounts on upgrades to ReSharper Ultimate</a></li>
<li><a href="../258205/index.html">Elasticsearch - sort the issue by hand</a></li>
<li><a href="../258209/index.html">New PyCharm 4.5 brought together all the tools to work with Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>