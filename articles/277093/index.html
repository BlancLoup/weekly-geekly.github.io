<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Working with USB devices in Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In a recent article on Geektimes in the comments there was a question about support in the Android OS of peripherals connected to the USB bus. Indeed,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Working with USB devices in Android</h1><div class="post__text post__text-html js-mediator-article">  In a recent article on Geektimes in the comments there was a question about support in the Android OS of peripherals connected to the USB bus.  Indeed, most vendor software, for example, to work with printers and multifunction devices, only supports network connectivity.  However, this does not mean that in the Android OS itself there is no such possibility - it only means that most devices do not have a full-fledged USB host, and not all have OTG support.  On the same network can work absolutely all without exception. <br><a name="habracut"></a><br>  Most Android devices, with an OTG port, support the following device classes at the system level (Linux kernels or standard Android components): <br><br><ul><li>  Input Devices - Keyboards, Mouse, Joysticks (HID) </li><li>  Mass Storage </li></ul><br>  Somewhat less: <br><br><ul><li>  Cell modems </li><li>  Network adapters </li><li>  Webcams </li></ul><br>  Hubs are supported with full host ports, but not supported on OTG ports. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A more detailed list of devices supported at the Linux kernel level can be obtained from sysfs: <br><br> <code>$ ls /sys/bus/usb/drivers <br></code> <br>  If the module is in principle available in the source code of the Linux kernel, but is not included in Android - you should not expect that it will be possible to assemble and place it on all target systems. <br><br>  However, starting with Android 3.1 (API 12), the system contains enough tools to support any USB peripherals at the application level.  These tools are described in the <a href="http://developer.android.com/intl/ru/guide/topics/connectivity/usb/host.html">USB Host</a> section of the Android API manual.  Here I want to give examples of real work with some types of devices. <br><br><h4>  Access rights </h4><br>  As with other actions, Android requires the application to receive permission to access USB peripherals.  There are 2 ways to get this permission: <br><br><ul><li>  Declare a list of devices in AndroidManifest </li><li>  Explicitly show the user the ‚Äúallow‚Äù dialog </li></ul><br>  Since for my tasks extra questions to the user were undesirable, I used the first method. <br><br>  So, we need to add the following to the manifest: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.hardware.usb.action.USB_DEVICE_ATTACHED"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.hardware.usb.action.USB_DEVICE_ATTACHED"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:resource</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@xml/device_filter"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-feature</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.hardware.usb.host"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-sdk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minSdkVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"12"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  And in res / xml / device_filter.xml enter the following: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Serial converters --&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- 0x0403 / 0x6001: FTDI FT232R UART --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">usb-device</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vendor-id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1027"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">product-id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"24577"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- ‚Ä¶ more devices ‚Ä¶ --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  I note that although it is generally accepted to specify the VID: PID in hexadecimal notation, here they must be specified in decimal.  The documentation states that it is possible to specify only a class, without a VID and PID, but this did not work for me. <br><br><h4>  Printers </h4><br>  Using the printer as an example, I will show how to directly use the android.hardware.usb API.  At the data transfer level, all printers support the standard class of USB devices: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> UsbConstants.USB_CLASS_PRINTER = <span class="hljs-number"><span class="hljs-number">7</span></span>;</code> </pre><br>  The class is extremely simple.  Within this class, the device must support: <br><br><ul><li>  Required bulk out endpoind to send data to the printer </li><li>  Optional bulk in endpoind to get printer status </li><li>  3 managing requests </li></ul><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> GET_DEVICE_ID = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> GET_PORT_STATUS = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SOFT_RESET = <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><br>  The code below provides functionality similar to / dev / usb / lp on Linux.  Next, we need a filter that converts the original document into a data packet, understandable to a specific printer model.  But this is the topic of another article.  As one of the options, you can build ghostscript using the NDK. <br><br>  To work with the device, we first need: <br><br>  1. Find a device.  In the example for the sake of simplicity, I am looking for the first available <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">UsbDevice </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findDevice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (UsbDevice usbDevice: mUsbManager.getDeviceList().values()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (usbDevice.getDeviceClass() == UsbConstants.USB_CLASS_PRINTER) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> usbDevice; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { UsbInterface usbInterface = findInterface(usbDevice); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (usbInterface != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> usbDevice; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-function"><span class="hljs-function">UsbInterface </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findInterface</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UsbDevice usbDevice)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nIf = <span class="hljs-number"><span class="hljs-number">0</span></span>; nIf &lt; usbDevice.getInterfaceCount(); nIf++) { UsbInterface usbInterface = usbDevice.getInterface(nIf); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (usbInterface.getInterfaceClass() == UsbConstants.USB_CLASS_PRINTER) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> usbInterface; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } UsbDevice mUsbDevice = findDevice(); UsbInterface mUsbInterface = findInterface(mUsbDevice);</code> </pre><br>  2. Get endpoints: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nEp = <span class="hljs-number"><span class="hljs-number">0</span></span>; nEp &lt; mUsbInterface.getEndpointCount(); nEp++) { UsbEndpoint tmpEndpoint = mUsbInterface.getEndpoint(nEp); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tmpEndpoint.getType() != UsbConstants.USB_ENDPOINT_XFER_BULK) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((mOutEndpoint == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) &amp;&amp; (tmpEndpoint.getDirection() == UsbConstants.USB_DIR_OUT)) { mOutEndpoint = tmpEndpoint; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((mInEndpoint == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) &amp;&amp; (tmpEndpoint.getDirection() == UsbConstants.USB_DIR_IN)) { mInEndpoint = tmpEndpoint; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mOutEndpoint == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IOException(<span class="hljs-string"><span class="hljs-string">"No write endpoint: "</span></span> + deviceName);</code> </pre><br>  3. Directly open the device: <br><br><pre> <code class="java hljs">mConnection = mUsbManager.openDevice(mUsbDevice); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mConnection == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IOException(<span class="hljs-string"><span class="hljs-string">"Can't open USB connection:"</span></span> + deviceName); mConnection.claimInterface (mUsbInterface, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre><br>  4. After this we can read and write to the device: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = Math.min(data.length, mInEndpoint.getMaxPacketSize()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mConnection.bulkTransfer(mInEndpoint, data, size, getReadTimeout()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> length)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> offset = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (offset &lt; length) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = Math.min(length - offset, mInEndpoint.getMaxPacketSize()); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bytesWritten = mConnection.bulkTransfer(mOutEndpoint, Arrays.copyOfRange(data, offset, offset + size), size, getWriteTimeout()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytesWritten &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IOException(<span class="hljs-string"><span class="hljs-string">"None written"</span></span>); offset += bytesWritten; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> offset; }</code> </pre><br>  5. Upon completion of the work - close the device: <br><br><pre> <code class="java hljs">mConnection.close();</code> </pre><br><h4>  USB Serial Converters </h4><br>  Unlike printers, USB-Serial converters are much less standardized.  There are several common chips for which the setting of the parameters of the serial port ‚Äî bit rate, parity, and so on ‚Äî differs significantly.  Fortunately, there is a <a href="https://github.com/mik3y/usb-serial-for-android">github.com/mik3y/usb-serial-for-android</a> library that supports almost all existing chips.  The library completely hides the USB API, minimizing all the necessary actions to a minimum of calls with a minimum of parameters. <br><br>  1. Find and open the device: <br><br><pre> <code class="java hljs">UsbSerialPort mUsbSerialPort; UsbManager mUsbManager = (UsbManager) DEVICE.getSystemService(Context.USB_SERVICE); String type = ‚ÄúFTDI‚Äù; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (UsbDevice usbDevice: mUsbManager.getDeviceList().values()) { UsbSerialDriver usbSerialDriver = UsbSerialProber.probeSingleDevice(usbDevice); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (usbSerialDriver == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!type.equals(usbSerialDriver.getShortDeviceName())) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; mUsbSerialPort = usbSerialDriver.getPort(<span class="hljs-number"><span class="hljs-number">0</span></span>); mUsbSerialPort.open(mUsbManager); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre><br>  2. Set the parameters of the serial port: <br><br><pre> <code class="java hljs">mUsbSerialPort.setParameters(baudRate, dataBits, stopBits, parity);</code> </pre><br>  3. Read and write to port: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mUsbSerialPort.read(data, getReadTimeout()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> length)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mUsbSerialPort.write(data, length, getWriteTimeout()); }</code> </pre><br>  4. Upon completion of work - close the port: <br><br><pre> <code class="java hljs">mUsbSerialPort.close();</code> </pre><br><h4>  Summary </h4><br>  I hope that I managed to show that working with USB peripherals is quite simple and logical.  Of course, the implementation of the protocols of some specific devices does not shine with simplicity - but it will manifest itself in any system to the same extent. <br><br>  I took all the above examples from the real project, only eliminated the obvious checks, leaving only the key lines. </div><p>Source: <a href="https://habr.com/ru/post/277093/">https://habr.com/ru/post/277093/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277081/index.html">From FineReader to data entry solutions: how the direction of DataCapture in ABBYY began</a></li>
<li><a href="../277085/index.html">CodingFuture + Puppet. Part I: network and network filter (cfnetwork + cffirehol)</a></li>
<li><a href="../277087/index.html">Angular 1.5: Components</a></li>
<li><a href="../277089/index.html">Google refuses to flash in advertising</a></li>
<li><a href="../277091/index.html">Security Week 06: bank robbery on the stream, breaking the grid, Poseidon / Amebey / Kianokhet</a></li>
<li><a href="../277097/index.html">UFCS in the programming language D</a></li>
<li><a href="../277099/index.html">Katya, Go, Dcoin and Android</a></li>
<li><a href="../277101/index.html">Fix MySQL dump (in less than 30 lines)</a></li>
<li><a href="../277103/index.html">Machine Learning Revolution: General Principles and Effects on SEO</a></li>
<li><a href="../277105/index.html">Bear, the dismemberment and February 14</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>