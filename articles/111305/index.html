<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Receiving and processing SMS messages on a Linux machine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In one of our recent projects, the development team was tasked to collect the most realistic contact information about the users of our site. Hot disc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Receiving and processing SMS messages on a Linux machine</h1><div class="post__text post__text-html js-mediator-article">  In one of our recent projects, the development team was tasked to collect the most <i>realistic</i> contact information about the users of our site.  Hot discussion of the correct and irregular registration forms, one- and two-step, the addition of information as far as using the site ... It seemed that the flow of ideas would not stop.  However, none of them guaranteed that as a result we would not get a bunch of useless data.  Validate?  It is possible, but does everything provide?  Account activation via mailbox for its validation?  But a bunch of services like <i>10 Minute Mail</i> negate the effect.  In addition, the specifics of the project did not allow too stretching the registration process.  It was decided that the user should log in, do his own thing, and then activate his account or not.  In the end, the phrase <i>"And let's activate by SMS!"</i> .  The search for providers, the study of price lists and the refusal of the idea to charge SMS processing to a third-party office ... It became clear that they would have to accept and process them themselves. <br><a name="habracut"></a><br>  There was a modest experience with VOIP / Asterisk and equipment selection for the VOIP gateway.  Climbed on the old links to the Chinese brothers to search for SMS-gateway.  But firstly, time was running out, secondly, because of the experience of working with them, something rarely comes out from the first time, so it became interesting if a normal USB GSM modem can handle it.  And, looking ahead, I will say that this decision was the right one.  At least at this stage. <br><br><h4>  Server Tuning </h4><br>  So, the Huawei E1750 modem (HSPA USB Stick) with my contract fell into my hands.  The first thing that a person who will undertake a similar task will face is that all new models of GSM modems, for the sake of Windows users, are recognized in the system as a storage device (SCSI CD-ROM) first.  It runs autorun, which installs the driver and switches the modem to modem mode (oh, how!).  As soon as I learned this, I decided to "come."  However, another half an hour, and the <i>usb_modeswitch</i> utility was found, which performs modem mode switching.  Only after that the modem will work for its intended purpose.  It is launched and configured simply, there is nothing special to write here. <br><br>  Well, with god!  Information at this point has already been dug not to say so much, but enough to dig in the right direction.  The existing solutions were filtered by the feature ‚Äúworks like a demon‚Äù, and as a result there was only one candidate left - SMS Server Tools.  It should be noted that the <a href="http://stefanfrings.de/smstools/index-en.html">original package is</a> no longer being developed, but its continuation <a href="http://smstools3.kekekasvi.com/">SMS Server Tools 3 is</a> not only developing, but is also well supported by its creator Mr.  Keijo "Keke" Kasvi. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Unfortunately, my favorite Gentoo did not have an ebuild for the latest version, the latest version available is 2.2.20.  But, not long googling, I found an already ready ebuild for the 3rd version, which I compiled after a small edit.  At the moment I have installed and stable version 3.1.14. <br><br>  As it turned out, setting up smstools is so simple that almost with the initial config you can already begin to receive messages.  No, well, of course, if your SIM card is locked with a pin-code, you will have to add it to the configuration, but this is done very simply. <br><br>  The structure of the configuration file is also understandable to ugliness (viva unix-way!).  At the beginning of the file we set the global settings of the daemon, and then in the sections we describe the settings of our devices: <br> <code>#    <br> ... <br> ... <br> <br> #      <br> [Huawei E1750 ] <br> ... <br> <br> #    ,     ,    <br> [AnotherModem] <br> ... <br></code> <br><br><h5>  Global settings </h5><br>  The most important parameter is which devices the daemon will poll for new messages.  If you have only one device, like mine, just list <code>devices = HuaweiE1750</code> , if you have several, list them here separated by commas. <br><br>  Two more important parameters are <code>user = smsd</code> and <code>group = sms</code> .  People familiar with Linux, to explain their value is not necessary, I restrict myself to just a reminder of the correct rights to all the resources to which the demon must have access.  Well, I will mention about such instructions as <code>pidfile = /var/run/smsd/smsd.pid</code> , <code>logfile = /var/log/smsd/smsd.log</code> , the meaning of which should also be clear.  By the way, at the time of debugging, I recommend inserting the <code>loglevel = 7</code> instruction into the configuration, this will allow you to keep track of what happens inside the daemon.  Later I set <code>loglevel = 5</code> . <br><br><h5>  Modem settings </h5><br>  In principle, here too, as promised, everything is simple.  However, I ran into some problems because of which I actually decided to share information with you. <br><br>  One problem was the burning desire of the modem all the time to jump off on a new device.  Once it was defined as <code>/dev/ttyUSB0</code> , another time under a different number.  This state of affairs did not suit me.  Therefore, I began to look for how to write <i>udev</i> rules for devices.  However, when I was ready to make my changes, it turned out that ebuild <i>usb_modeswitch</i> had already done this for me by adding the <code>/lib64/udev/rules.d/40-usb_modeswitch.rules</code> file to the system, according to which the system appeared a symlink to the device at <code>/dev/gsmmodem</code> .  We will write it in the configuration. <br><br>  The second problem was the hang of the modem from time to time.  Unfortunately, there was no time to read the materiel, and Google gave so many options that it did not make sense to try them all.  Therefore, not counting on help, I crawled to the smstools3 forum.  What were my surprise and joy when keke responded to my post after a miserable 2-3 hours.  No, he did not give an exact solution, but two lines that he recommended adding to the config once and for all saved me from freezing.  For me, it still remains a mystery where to take values ‚Äã‚Äãfor them, I did not find technical documentation on the modem: <br> <code>check_memory_method = 1 <br> memory_start = 0</code> <br> <br>  Well, the third problem, because of which all the fuss was started, was the writing of an SMS handler.  To do this, the <code>eventhandler = /usr/local/scripts/activate</code> instruction was added to the config, inside which a request to activate the account was sent to the project server.  <a href="http://snipt.org/wkzp">The script</a> receives two parameters - the type of event and the message file.  Pulls out the data we need, and sends it to the server. <br><br>  So, we got such a short config: <br> <code>devices = Huawei <br> loglevel = 5 <br> <br> user = smsd <br> group = sms <br> logfile = /var/log/smsd/smsd.log <br> infofile = /var/run/smsd/smsd.running <br> pidfile = /var/run/smsd/smsd.pid <br> <br> alarmlevel = 7 <br> alarmhandler = /usr/local/scripts/activate/smsd-alarm <br> <br> [Huawei] <br> device = /dev/gsmmodem <br> baudrate = 115200 <br> pin = 1111 <br> incoming = high <br> cmgl_value = 0 <br> check_memory_method = 1 <br> memory_start = 0 <br> eventhandler = /usr/local/scripts/activate</code> <br> <br><h4>  Unexpected profit </h4><br>  Initially, the registration form contained the <i>Mobile phone</i> field - this was in the project requirements.  The incoming SMS should have been sent from the specified phone, and the account with this phone was activated.  However, as it turned out, users are at a standstill when they do not need to write anything in the message.  At first, after registration, the instruction appeared ‚ÄúSend a message with the text‚Äú F ‚Äùto number 12345678‚Äù.  Then another, ingenious idea seemed to be born: the <i>Mobile phone</i> field was removed from the form, after a short registration (First Name, Last Name, E-mail / login, Password), the user is given a code that he should send to the specified number.  This code is an account, and the phone from which the SMS came from is recorded in the user profile.  Voila, we have a user, there is his real phone, there is an opportunity to add a bunch of phones to your profile, and change the phone number in the profile in case of loss of the old one, by sending another SMS and deleting the old number. <br><br><h4>  Results </h4><br><ul><li>  Almost received free SMS processing system </li><li>  Accelerated the process of registering users on the site </li><li>  Received real user data (it remains to think of sending scans of passports to us) </li><li>  Gained an experience that I already wanted to apply for sending notifications about some events on the servers (sending in the considered case was not considered, but I think there will be no problems) </li><li>  Implemented everything in a very short time (ehhh, if it were not for the problem with the hang of the modem) </li></ul></div><p>Source: <a href="https://habr.com/ru/post/111305/">https://habr.com/ru/post/111305/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111300/index.html">FuelPHP - full tank framework</a></li>
<li><a href="../111301/index.html">About how Yandex "set us up"</a></li>
<li><a href="../111302/index.html">We accept calls from a mobile phone on the air of a student radio station</a></li>
<li><a href="../111303/index.html">New features in Visual Studio 2012</a></li>
<li><a href="../111304/index.html">What is the crop factor</a></li>
<li><a href="../111306/index.html">We use Python in our program</a></li>
<li><a href="../111308/index.html">CANVAS step by step: Basics</a></li>
<li><a href="../111309/index.html">Sony Ericsson XPeria Arc - the most stylish Android smartphone</a></li>
<li><a href="../111311/index.html">Server rental experience in Germany with Server4you</a></li>
<li><a href="../111312/index.html">Netgear WNR3500L: Turning a router into a NAS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>