<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Disks, Controllers, OS and Advanced Format</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It would seem that everything about the Advanced Format disks over the past 4 years has been learned. There are indeed a lot of publications, but it i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Disks, Controllers, OS and Advanced Format</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/bed/4a5/718/bed4a571881ccaa6eec8b4211927b749.png" alt="image" align="left">  It would seem that everything about the Advanced Format disks over the past 4 years has been learned.  There are indeed a lot of publications, but it is time to review all the technical details and pitfalls in one big article.  It's about using AF-drives in servers, and I noticed that for most administrators, even in large companies, knowledge of the subject in most cases comes down to ‚Äúthis is somehow related to modern drives, but everything works for me‚Äù. <br><a name="habracut"></a><br><h2>  What is Advanced Format </h2><br>  Advanced Format is a new sector layout format used in some hard drives.  Instead of the traditional 512-byte sector, 4096 bytes are used.  Some SCSI / SAS / FC disks may use 520-byte and 528-byte thick sectors for <a href="http://en.wikipedia.org/wiki/Data_Integrity_Field">additional control of data integrity</a> , but this is not the topic of this article. <br><br>  The increase in the size of the sector by 8 times is due to the need to improve the efficiency of data placement on modern disks.  The overhead costs associated with 512-byte markup, begin to interfere with further increase in HDD capacity.  In addition to service fields, there is a field with an error correction code (ECC) of 50 bytes in each 512-byte sector.  In the 4096-byte sector, the length of the ECC-field is 100 bytes.  The overall storage efficiency was improved by about 10%. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d5/c03/dee/6d5c03dee3b2189dd7f1dabf807c6f39.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Naturally, support for non-standard sectors is required on the part of disk controllers and operating systems.  To solve compatibility problems, an additional standard <i>512E</i> was introduced, which designates disks with a physical sector size of 4096 bytes, but at the same time emulating the usual sector size of 512 bytes.  Advanced Format disks without emulation are designated <i>4KN</i> .  Thus, now there are three options for markup: <br><table border="1"><tbody><tr><td>  <b>Format</b> <br></td><td>  <b>Logical sector size</b> <br></td><td>  <b>Physical sector size</b> <br></td></tr><tr><td>  <b><nobr>512N</nobr></b> <br></td><td>  512 bytes <br></td><td>  512 bytes <br></td></tr><tr><td>  <b><nobr>512E</nobr></b> <br></td><td>  512 bytes <br></td><td>  4096 bytes (4KiB) <br></td></tr><tr><td>  <b><nobr>4KN</nobr></b> <br></td><td>  4096 bytes (4KiB) <br></td><td>  4096 bytes (4KiB) <br></td></tr></tbody></table><h2>  Compatibility </h2><br><h3>  Operating Systems </h3><br>  At first glance, it seems that the use of emulation of the 512-byte sector removes all compatibility problems, but it is not.  First, a performance problem immediately arises.  What happens when writing a block of 512 bytes in size to a disk with a sector size of 4096 bytes (even if it emulates the presence of 512 byte sectors)?  There will be a classic process of read-modify-write, instead of one operation you will need two: read the sector 4096 bytes, change 512 bytes in it (the block to be written) and write 4096 bytes back.  A similar problem manifests itself also in the absence of alignment, when the recorded data block can be quite large and even a multiple of 4096 bytes, but at the same time it is shifted relative to the boundaries of real sectors: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cad/b98/940/cadb989404ad757c83fc72356e7f763b.png"><br><br>  In modern conditions, write operations with blocks of less than 4096 bytes are extremely rare, but the problem with alignment remains.  For example, in older Windows (before Windows Server 2008) during installation, the boot partition is created with an offset of 63 sectors.  This has historically happened since the time when the BIOS used real disk geometry instead of LBA.  Of course, the offset in 63x512 is not divided by 4096, which leads to a violation of alignment for all subsequent sections and a decrease in performance.  For the first time, this problem was noticed due to the use of RAID controllers and the need to align sections on stripe boundaries and it was solved in Windows Vista / Windows Server 2008 (and at about the same time in other operating systems) by introducing alignment on 1024KiB boundaries ( 1MB) i.e.  The first partition is created with an offset of 2048 512-byte sectors. <br><br>  Why precisely 1MB if a smaller offset is appropriate (the main thing is to divide by 4096 bytes)?  Just because you need a reserve, because in addition to the physical disk, volumes on RAID controllers (with a default stripe size, for example, Adaptec 256KiB), SSD (with a large page size) or disk images can be used as a block device , The recommended NTFS cluster size for SQL or Exchange is 64KiB, etc. <br><br>  Problem number two - possible data loss for scenarios with synchronous recording.  For situations with a block record less than 4096 bytes or an unaligned block of synchronous recording in fact will not work.  It remains to ‚Äúteach‚Äù the OS not to use blocks less than 4096 bytes on 512E disks when writing, but there are certain problems with this. <br><h4>  Microsoft </h4><br>  For Microsoft OS, there is the following official ( <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/hh848035(v%3Dvs.85).aspx">primary</a> ) data: <br><table border="1"><tbody><tr><td>  <b>Format</b> <br></td><td>  <b>Logical sector size</b> <br></td><td>  <b>Physical sector size</b> <br></td><td>  <b>Compatible OS</b> <br></td></tr><tr><td>  <b><nobr>512E</nobr></b> <br></td><td>  512 bytes <br></td><td>  4096 bytes (4KiB) <br></td><td><ul><li>  Windows 8, 8.1 </li><li>  Windows Server 2012, 2012 R2 </li><li>  Windows 7 w / MS KB 982018 </li><li>  Windows 7 SP1 </li><li>  Windows Server 2008 R2 w / MS KB 982018 </li><li>  Windows Server 2008 R2 SP1 </li><li>  Windows Vista w / MS KB 2553708 </li><li>  Windows Server 2008 w / MS KB 2553708 </li></ul><br></td></tr><tr><td>  <b><nobr>4KN</nobr></b> <br></td><td>  4096 bytes (4KiB) <br></td><td>  4096 bytes (4KiB) <br></td><td><ul><li>  Windows 8, 8.1 </li><li>  Windows Server 2012, 2012 R2 </li></ul><br></td></tr></tbody></table>  Note the additional reminder that Windows Server 2003 R2, Windows XP, and other operating systems based on XP code base (for example, Windows Home Server 1.0, Windows Small Business Server 2003, 2003 R2), although they can function in conjunction with 512E disks, but Microsoft warns against using such disks: if the alignment problem can still be solved, then <b>performance problems</b> or <b><a href="http://i.dell.com/sites/doccontent/shared-content/data-sheets/en/Documents/4K_Sector_FAQ_template.pdf">potential data loss in</a></b> case of power loss during read-modify-write cannot be bypassed. <br><br>  You can check the alignment of existing partitions and set the offset for new partitions in Windows using diskpart.  Example (partition on disk 0 with an offset of 1024KiB or 2048 512-byte sectors): <br><br><pre>	 select disk 0
	 create partition primary align = 1024
	</pre>  The easiest way to check is through WMI (example): <br><br><pre>	 wmic partition get Blocksize, StartingOffset, Name
	 BlockSize Name StartingOffset
	 512 Disk # 0, section # 0 1048576
	 512 Disk # 0, section # 1 368050176
	 512 Disk # 2, section # 0 135266304
	 512 Disk # 1, section # 0 1048576 </pre><br>  In the StartingOffset column, there should be 1024KiB for the first partition, for the rest it should be divided into 1024KiB, this means that everything will be divided into 4096 bytes and all other ‚Äúgood numbers‚Äù (sizes of stripes and NTFS clusters). <br><br>  Let me remind you that in modern Windows, the offset to 1024KiB is already used by default, so you only need to check / set it manually for the OS from the ‚Äú63-sector‚Äù era.  When automatically creating GPT markup (via Disk Management) on a 512N or 512E disk, you will see an offset for the first partition at 17KiB.  This is not a cause for alarm, as this is the service section of the <i>MSR</i> .  The first standard section will be created with an offset of 135266304 bytes (129MiB) - perfectly divided into any of our "good numbers". <br><h4>  Linux </h4><br>  Linux compatibility table (only common server distributions are listed): <br><table border="1"><tbody><tr><td>  <b>Format</b> <br></td><td>  <b>Logical sector size</b> <br></td><td>  <b>Physical sector size</b> <br></td><td>  <b>Compatible OS</b> <br></td></tr><tr><td>  <b><nobr>512E</nobr></b> <br></td><td>  512 bytes <br></td><td>  4096 bytes (4KiB) <br></td><td><ul><li>  RHEL 6.1 </li><li>  SLES 11 SP2 </li><li>  Ubuntu 13.10 </li><li>  Ubuntu 04/12/4 </li></ul><br></td></tr><tr><td>  <b><nobr>4KN</nobr></b> <br></td><td>  4096 bytes (4KiB) <br></td><td>  4096 bytes (4KiB) <br></td><td><ul><li>  RHEL 6.1 </li><li>  SLES 11 SP2 </li><li>  Ubuntu 13.10 </li><li>  Ubuntu 04/12/4 </li></ul><br></td></tr></tbody></table>  For other distributions, you can focus on the kernel version (&gt; 2.6.31) and the version of the disk partitioning tools: GNU Fdisk&gt; 1.2.3 or GNU Parted&gt; 2.1 <br><br>  You can see the sizes of the physical and logical blocks in / sys / block / sdX / queue / physical_block_size and in / sys / block / sdX / queue / logical_block_size, respectively. <br>  GNU Fdisk will automatically use an offset of 1MiB when started with the -c and -u keys (disable DOS compatibility mode and use the sector as the unit of measurement).  Normal Fdisk does not know how to work with GPT, so it is useless for disks&gt; 2TiB, and you need to use Parted or <a href="http://sourceforge.net/projects/gptfdisk/">GPT Fdisk</a> .  The latter uses by default for 512N / 512E disks an offset of 2048 sectors we need: <br><br><pre>	 Disk / dev / sde: 7814037168 sectors, 3.6 TiB
	 Logical sector size: 512 bytes
	 Disk identifier (GUID): BE7D7D71-F6ED-4371-ACFE-B04819A4DDC2
	 Partition table holds up to 128 entries
	 First usable sector is 34, last usable sector is 7814037134
	 Partitions will be aligned on 2048-sector boundaries
	 Total free space is 7814037101 sectors (3.6 TiB) </pre><br>  Example for GNU Parted (for 512N / 512E disks): <br><br><pre>	 # create new GPT markup
	 mklabel gpt
	 # create a partition for all free space with an offset of 2048 sectors
	 (parted) mkpart part1 2048s 100%
	 (parted) print
	 Model: ATA WDC WD40EFRX-68W (scsi)
	 Disk / dev / sde: 7814037168s
	 Sector size (logical / physical): 512B / 4096B
	 Partition Table: gpt

	 Number Start End Size File System Name Flags
	 1 2048s 7814035455s 7814033408s part1 </pre><br>  In LVM, everything is fine: the default offset is 1MiB and the size of PE (physical extent) is a multiple of 1MiB. <br><br><pre>	 # check offset
	 #pvs / dev / sde -o + pe_start
	 PV VG Fmt Attr PSize PFree 1st PE
	 / dev / sde VolRed lvm2 a-- 3.64t 3.64t 1.00m

	 # check PE size
	 #pvdisplay / dev / sde
	 --- Physical volume ---
	 PV Name / dev / sde
	 VG Name VolRed
	 PV Size 3.64 TiB / not usable 3.84 MiB
	 Allocateable yes
	 PE Size 4.00 MiB
	 Total PE 953861
	 Free PE 953861
	 Allocated PE 0
	 PV UUID 9AfJr9-OOtC-PB34-dUnq-kCDK-L1fN-aTAxus </pre><br><br><h4>  VMware </h4><br>  <a href="http://kb.vmware.com/kb/2091600">An article in the VMware Knowledge Base</a> states that neither 512E nor 4KN disks are supported.  4KN disk support is claimed in vSphere 6.0. <br><br>  With the advent of VMFS-5, we got a single block size - 1MiB and the correct 1MiB offset for the first partition.  Previously, not always suitable offset was used in 64KiB.  But all this does not cancel VMware‚Äôs claims that 512E drives are not supported.  Apparently, this is due to the fact that the VMDK format stores data with a granularity of 512 bytes. <br><br><h4>  Other OS </h4><br>  Mac OSX supports Advanced Format since Tiger.  FreeBSD and other * BSD, Oracle Solaris, and many other operating systems remain, but a detailed discussion of the situation with Advanced Format disks in them is beyond the scope of this article. <br><br><h3>  Microsoft services </h3><br><h4>  Hyper-v </h4><br>  Despite the fact that 512E drives are supported in Windows Server 2008 and 2008 R2 (see the table of requirements for installed KB), the following problem appears in Hyper-V: VHD virtual disk file format uses 512-byte structures for dynamic (‚Äúthin‚Äù) and differential VHD, which naturally leads to regular read-modify-write.  The situation is aggravated by the fact that for a guest OS a virtual disk looks like having 512 bytes of physical sectors.  Use fixed VHDs, but if possible, do not use 512E drives to place VHD files. <br>  In Windows Server 2012, the VHDX format appeared, which does not have the problems described above (you can create it in any form - 512N / 512E / 4KN). <br><h4>  Exchange server </h4><br>  There are features associated with replication in DAG: <br><ul><li>  All disks used in the Exchange Availability Group (DAG) Exchange for storing databases and logs must use the same <b>physical</b> sector size. </li><li>  4KN discs are not supported. </li><li>  512E drives supported starting with Exchange 2010 Service Pack 2 </li></ul><br><h4>  SQL Server </h4><br>  The situation is the same as for Exchange Server - in fault tolerant configurations for databases and logs on all nodes disks with the same physical sector size should be used. <br>  When using Storage Spaces, an interesting situation arises: the presented size of the physical sector turns out to be 4KiB regardless of which disks the Storage Spaces are assembled from (the Storage Spaces volume can be created from different disks - 512N and 512E, naturally cannot be mixed with 4KN, except for using tiering with SSD).  VHDX (virtual disk) format is created by default as 512E.  You can verify this by running fsutil fsinfo ntfsinfo &lt;disk name&gt;: <br><br><pre>	 Bytes Per Sector: 512
	 Bytes Per Physical Sector: 4096 </pre><br>  When using VHDX on a Storage Spaces volume (or hardware RAID) consisting of 4KN disks, VHDX itself is also advisable to make 4KN: <br><pre>       New-VHD -Path D: \ image4kn.vhdx -Fixed -SizeBytes 500GB -LogicalSectorSizeBytes 4096 -PhysicalSectorSizeBytes 4096
       </pre><br>  <a href="http://blogs.msdn.com/b/psssql/archive/2013/05/15/sql-server-storage-spaces-vhdx-and-4k-sector-size.aspx">Is it safe for SQL</a> and other applications using synchronous recording?  The answer is yes, since the large granularity of the storage does not violate the integrity of the data, this also does not affect the performance, since 4096 is divided by 512. <br><br><h4>  Services using ESENT </h4><br>  Not quite relevant problem in Windows Server 2008. Services that use the Extensible Storage Engine API (AD, WINS, DHCP) in work can fall when the size of the physical sector changes (for example, when migrating from a 512N disk to 512E).  Detailed description and hotfix see <a href="http://support.microsoft.com/kb/2470478/en-us">here</a> . <br><br><h3>  Other software </h3><br>  Obviously, software designed to manage partitions (cloning, moving, resizing) and to automate backups must take into account the peculiarities of working with Advanced Format disks.  Here is the situation: <br><ul><li>  <a href="https://kb.acronis.com/content/16200">Acronis products</a> . </li><li>  <a href="http//www.symantec.com/business/support/index%3Fpage%3Dcontent%26id%3DTECH215007">Symantec Backup Exec</a> supports Advanced Format disks (512E and 4KN) since version 2012 revision 1798 Service Pack 2. Earlier releases may work with 512E disks, but Symantec claims that this combination is not officially supported. </li><li>  <a href="http://www.symantec.com/business/support/index%3Fpage%3Dcontent%26id%3DTECH143669">Symantec Norton Ghost</a> does not support 4KN discs. </li></ul><br><br><h3>  Controllers </h3><br>  Universal rules for all controllers: <br><ul><li>  The 4KN and 512N / 512E disks cannot be mixed in one array. </li><li>  With Adaptec and LSI controllers, the metadata is placed at the end of the disk, user space is available with LBA0.  This means that there will be no alignment problems for 512E disks. </li><li>  An array of 4KN disks will also have a physical / logical sector size of 4KiB, i.e.  GPT and UEFI are needed to boot from them. </li><li>  Do not forget to update the management utilities and drivers with the firmware. </li><li>  How will the LUN created on 512E disks - 512N or 512E be presented?  From what has been verified: the LSI 9260 controllers, the 6th series Adaptec, the Infortrend ESDS data storage systems report 512N (logical / physical blocks 512 bytes), i.e.  The problem with synchronous recording remains.  Be sure to use write-back cache (of course, with protection) and UPS.  Moreover, it is possible that when changing the firmware, the storage system and controller may suddenly behave ‚Äúcorrectly‚Äù, and LUNs will turn into 512E with all the ensuing consequences for compatibility. </li></ul><br><h4>  Adaptec by PMC </h4><br><ul><li>  SAS HBA series 5 and 6: support 512E, do not support 4KN </li><li>  SAS HBA 6H and 7H series: support 512E, 4KN - starting with firmware 10467. </li><li>  RAID controllers of series 7 and 8: support 512E, 4KN - starting with firmware 30862. </li></ul><br>  <a href="http://www.adaptec.com/en-us/_common/compatibility/">Compatibility lists for Adaptec controllers</a> . <br><h4>  LSI / Avago </h4><br>  LSI chip controllers use Dell, IBM, Lenovo, Fujitsu, Intel and Supermicro.  The correspondence between the models from LSI and OEM-options can be installed on the chip. <br><ul><li>  Older controllers based on LSI1078: do not support Advanced Format disks at all </li><li>  <strike>LSI 3ware series 9750 based on LSI2108 and earlier 3ware: do not support Advanced Format disks at all.</strike> </li><li>  LSISAS2108 (LSI 9260/61/80): support 512E since firmware MR4.8, 4KN do not support.  <a href="http://www.lsi.com/downloads/Public/RAID%2520Controllers/RAID%2520Controllers%2520Common%2520Files/MegaRAID_Value_Feature_Interop_List_SAS2.pdf">Compatibility list</a> (4KN disks are present, but apparently refer to LSI 2208, see below). </li><li>  LSISAS2208 (LSI 9265/66/71/85/86): support 512E since firmware MR5.5, support 4KN since firmware MR5.8.  <a href="http://www.lsi.com/downloads/Public/RAID%2520Controllers/RAID%2520Controllers%2520Common%2520Files/MegaRAID_Value_Feature_Interop_List_SAS2.pdf">Compatibility list</a> . </li><li>  LSISAS3108 (LSI 9361/80): support 512E and 4KN.  <a href="http://www.lsi.com/downloads/Public/RAID%2520Controllers/RAID%2520Controllers%2520Common%2520Files/MegaRAID_SAS3_936x-938x_Compatibility_List.pdf">Compatibility list</a> . </li><li>  SAS HBA based on LSISAS2008 and LSISAS2308 (LSI 9211/9200/9207): support 512E and 4KN.  <a href="http://www.lsi.com/downloads/Public/Host%2520Bus%2520Adapters/Host%2520Bus%2520Adapters%2520Common%2520Files/LSI_6Gb_SAS_SATA_HBA_Compatibility_List.pdf">Compatibility list</a> . </li><li>  SAS HBA based on LSISAS3008 (LSI 9311/9300): support 512E and 4KN.  <a href="http://www.lsi.com/downloads/Public/Host%2520Bus%2520Adapters/Host%2520Bus%2520Adapters%2520Common%2520Files/LSI_12Gb_SAS_SATA_HBA_Compatibility_List.pdf">Compatibility list</a> . </li><li>  RAID based on LSISAS2008 (LSI 9240, iMR firmware): support 512E, 4KN do not support.  <a href="http://www.lsi.com/downloads/Public/RAID%2520Controllers/RAID%2520Controllers%2520Common%2520Files/MegaRAID_Entry_Interop_List_SAS2.pdf">Compatibility list</a> . </li><li>  RAID based on LSISAS3008 (LSI 9340, iMR firmware): support 512E, 4KN do not support.  <a href="http://www.lsi.com/downloads/Public/RAID%2520Controllers/RAID%2520Controllers%2520Common%2520Files/MegaRAID_SAS3_934x_Compatibility_List.pdf">Compatibility list</a> . </li></ul><br>  <b>Update 03/25/2015: The</b> latest 3108-based LSI MegaRAID RAID controllers have a poorly documented volume (VD) feature called <i>Emulation Type</i> .  In the controller BIOS, the possible values ‚Äã‚Äãare Default, Disabled, and Forced.  You can also switch via MSM or StorCLI: <br><pre>  storcli / cx / vx set emulationType = 0 | 1 | 2 </pre><br>  This property is responsible for the block sizes presented to the host: <br>  Default (0): if there are 512E disks in the volume, it is presented as 512E.  If all the disks are 512N, then the volume will be presented as 512N <br>  Disabled (1): Tom always presents as 512N despite the presence of 512E disks <br>  Forced (2): Tom always presents as 512E even in the absence of 512E disks <br><br>  <i>The emulation type</i> was ported to SAS2 controllers (LSI 2108/2208), but without the Forced value (2). <br><br><h4>  Software RAID in Intel Chipsets (RST / RSTe) </h4><br>  4KN is not supported at all, Intel RST on 512E drives <a href="http://www.intel.com/support/chipsets/imsm/sb/CS-031502.htm">requires fresh drivers</a> . <br><br><h2>  Advanced Format in enterprise-class drives.  What awaits us? </h2><br>  It's about corporate-class last episodes.  Desktop HDD and positioned for NAS or video surveillance did not get here. <br><table border="1"><tbody><tr><td width="70">  <b>Vendor</b> </td><td>  <b>Series</b> </td><td>  <b>Form factor</b> </td><td>  <b>Interfaces</b> </td><td>  <b>Spindle rotation speed, rpm</b> </td><td>  <b><nobr>512N</nobr></b> </td><td>  <b><nobr>512E</nobr></b> </td><td>  <b><nobr>4KN</nobr></b> </td><td>  <b>Additionally</b> </td></tr><tr><td>  Seagate </td><td>  <a href="http://www.seagate.com/www-content/product-content/enterprise-performance-savvio-fam/enterprise-performance-10k-hdd/ent-perf-10k-v8/en-us/docs/enterprise-performance-10k-hdd-ds1785-2-1409us.pdf">Enterprise Performance 10K HDD (10k.8)</a> </td><td>  2.5 " </td><td>  SAS </td><td>  10,000 </td><td>  <b>Y</b> </td><td>  <b>Y</b> </td><td>  <b>Y</b> </td><td>  for 512N capacity is limited: 600 / 1200GB </td></tr><tr><td>  Seagate </td><td>  <a href="http://www.seagate.com/www-content/product-content/enterprise-performance-savvio-fam/enterprise-performance-15k-hdd/ent-perf-15k-5/en-us/docs/enterprise-performance-15k-hdd-ds1797-3m-1409us.pdf">Enterprise Performance 15K HDD (15k.5)</a> </td><td>  2.5 " </td><td>  SAS </td><td>  15,000 </td><td>  <b>Y</b> </td><td>  <b>Y</b> </td><td>  <b>Y</b> </td><td>  32GB of integrated SSD cache </td></tr><tr><td>  Seagate </td><td>  <a href="http://www.seagate.com/www-content/product-content/enterprise-hdd-fam/enterprise-capacity-2-5-hdd/en-us/docs/enterprise-capacity-2-5-hdd-ds1719-5-1409us.pdf">Enterprise Capacity 2.5 HDD (V.3)</a> </td><td>  2.5 " </td><td>  SAS, SATA </td><td>  7200 </td><td></td><td>  <b>Y</b> </td><td>  <b>Y</b> </td><td></td></tr><tr><td>  Seagate </td><td>  <a href="http://www.seagate.com/www-content/product-content/enterprise-hdd-fam/enterprise-capacity-3-5-hdd/constellation-es-4/en-us/docs/enterprise-capacity-3-5-hdd-ds1791-4-1404us.pdf">Enterprise Capacity 3.5 HDD (V.4)</a> </td><td>  3.5 " </td><td>  SAS, SATA </td><td>  7200 </td><td></td><td>  <b>Y</b> </td><td>  <b>Y</b> </td><td></td></tr><tr><td>  Seagate </td><td>  <a href="http://www.seagate.com/www-content/product-content/hdd-fam/seagate-archive-hdd/en-us/docs/archive-hdd-dS1834-3-1411us.pdf">Archive hdd</a> </td><td>  3.5 " </td><td>  SATA </td><td>  7200 </td><td></td><td></td><td>  <b>Y</b> </td><td>  Positioned for archival use, less MTBF and worse BER </td></tr><tr><td>  Seagate </td><td>  <a href="http://www.seagate.com/www-content/product-content/constellation-fam/constellation-cs/en-us/docs/terascale-hdd-data-sheet-ds1793-1-1306us.pdf">Terascale hdd</a> </td><td>  3.5 " </td><td>  SATA </td><td>  5900/7200 </td><td></td><td>  <b>Y</b> </td><td></td><td>  Positioned for cloud use, less MTBF and worse BER </td></tr><tr><td>  Hgst </td><td>  <a href="http://www.hgst.com/tech/techlib.nsf/techdocs/8DC6F1614158BC6588257D060060438C/%24file/usc10k1800_ds.pdf">Ultrastar C10K1800</a> </td><td>  2.5 " </td><td>  SAS </td><td>  10,000 </td><td>  <b>Y</b> </td><td>  <b>Y</b> </td><td>  <b>Y</b> </td><td>  for 512N capacity is limited: 300/600/900 / 1200GB </td></tr><tr><td>  Hgst </td><td>  <a href="http://www.hgst.com/tech/techlib.nsf/techdocs/9BE7CF207FA522FD88257C77007A7950/%24file/USC15K600_ds.pdf">Ultrastar C15K600</a> </td><td>  2.5 " </td><td>  SAS </td><td>  15,000 </td><td>  <b>Y</b> </td><td>  <b>Y</b> </td><td>  <b>Y</b> </td><td></td></tr><tr><td>  Hgst </td><td>  <a href="http://www.hgst.com/tech/techlib.nsf/techdocs/2D8F1E494D989B5688257C130000C36B/%24file/USC7K1000_ds.pdf">Ultrastar C7K1000</a> </td><td>  2.5 " </td><td>  SAS </td><td>  7200 </td><td>  <b>Y</b> </td><td></td><td></td><td></td></tr><tr><td>  Hgst </td><td>  <a href="http://www.hgst.com/tech/techlib.nsf/techdocs/A0D354B4B5D8FD6B88257D41000CC19C/%24file/Ultrastar-He8-DS.pdf">Ultrastar He <sup>8</sup></a> </td><td>  3.5 " </td><td>  SAS, SATA </td><td>  7200 </td><td></td><td>  <b>Y</b> </td><td>  <b>Y</b> </td><td></td></tr><tr><td>  Hgst </td><td>  <a href="http://www.hgst.com/tech/techlib.nsf/techdocs/83F507776F03BE7C88257C37000AED30/%24file/USHe6_ds.pdf">Ultrastar He <sup>6</sup></a> </td><td>  3.5 " </td><td>  SAS, SATA </td><td>  7200 </td><td>  <b>Y</b> </td><td></td><td></td><td></td></tr><tr><td>  Hgst </td><td>  <a href="http://www.hgst.com/tech/techlib.nsf/techdocs/29C9312E3B7D10CE88257D41000D8D16/%24file/Ultrastar-7K6000-DS.pdf">Ultrastar 7K6000</a> </td><td>  3.5 " </td><td>  SAS, SATA </td><td>  7200 </td><td></td><td>  <b>Y</b> </td><td>  <b>Y</b> </td><td></td></tr><tr><td>  Hgst </td><td>  <a href="http://www.hgst.com/tech/techlib.nsf/techdocs/7FC7DE7FF932191A88257C040028AAEB/%24file/MS4000.B_final_ds.pdf">MegaScale DC 4000.B</a> </td><td>  3.5 " </td><td>  SATA </td><td>  5400 </td><td></td><td>  <b>Y</b> </td><td></td><td>  Positioned for cloud use, less MTBF and worse BER </td></tr><tr><td>  Wd </td><td>  <a href="http://www.wdc.com/wdproducts/library/SpecSheet/ENG/2879-771429.pdf">Xe</a> </td><td>  2.5 "/3.5" </td><td>  SAS </td><td>  10,000 </td><td>  <b>Y</b> </td><td></td><td></td><td></td></tr><tr><td>  Wd </td><td>  <a href="http://www.wdc.com/wdproducts/library/SpecSheet/ENG/2879-771444.pdf">Re</a> </td><td>  3.5 " </td><td>  SATA </td><td>  7200 </td><td>  <b>Y</b> </td><td></td><td></td><td></td></tr><tr><td>  Wd </td><td>  <a href="http://www.wdc.com/wdproducts/library/SpecSheet/ENG/2879-771475.pdf">Se</a> </td><td>  3.5 " </td><td>  SATA </td><td>  7200 </td><td></td><td>  <b>Y</b> </td><td></td><td>  Positioned for cloud use, less MTBF and worse BER </td></tr><tr><td>  Wd </td><td>  <a href="http://www.wdc.com/wdproducts/library/AAG/ENG/2178-800087.pdf">Ae</a> </td><td>  3.5 " </td><td>  SATA </td><td>  5760 </td><td></td><td>  <b>Y</b> </td><td>  <b>?</b> </td><td>  Positioned for archival use, less MTBF and worse BER </td></tr><tr><td>  Toshiba </td><td>  <a href="http://storage.toshiba.com/ProductDatasheet.aspx%3Fproduct%3DAL13SE">AL13SE</a> </td><td>  2.5 " </td><td>  SAS </td><td>  10,000 </td><td>  <b>Y</b> </td><td></td><td></td><td></td></tr><tr><td>  Toshiba </td><td>  <a href="http://storage.toshiba.com/ProductDatasheet.aspx%3Fproduct%3DAL13SX">AL13SX</a> </td><td>  2.5 " </td><td>  SAS </td><td>  15,000 </td><td>  <b>Y</b> </td><td></td><td></td><td></td></tr><tr><td>  Toshiba </td><td>  <a href="http://storage.toshiba.com/ProductDatasheet.aspx%3Fproduct%3DAL13SEL">AL13SEL</a> </td><td>  3.5 " </td><td>  SAS </td><td>  10,000 </td><td>  <b>Y</b> </td><td></td><td></td><td></td></tr><tr><td>  Toshiba </td><td>  <a href="http://storage.toshiba.com/ProductDatasheet.aspx%3Fproduct%3DMG03ACA">MG03ACA / MG03SCA</a> </td><td>  3.5 " </td><td>  SAS, SATA </td><td>  7200 </td><td>  <b>Y</b> </td><td></td><td></td><td></td></tr><tr><td>  Toshiba </td><td>  <a href="http://storage.toshiba.com/ProductDatasheet.aspx%3Fproduct%3DMG04ACA">MG04ACA</a> </td><td>  3.5 " </td><td>  SATA </td><td>  7200 </td><td></td><td>  <b>Y</b> </td><td>  <b>Y</b> </td><td></td></tr><tr><td>  Toshiba </td><td>  <a href="http://storage.toshiba.com/ProductDatasheet.aspx%3Fproduct%3DMG04SCA">MG04SCA</a> </td><td>  3.5 " </td><td>  SAS </td><td>  7200 </td><td></td><td>  <b>Y</b> </td><td>  <b>Y</b> </td><td></td></tr><tr><td>  Toshiba </td><td>  <a href="http://storage.toshiba.com/ProductDatasheet.aspx%3Fproduct%3DMC04ACA">MC04ACA</a> </td><td>  3.5 " </td><td>  SATA </td><td>  7200 </td><td></td><td>  <b>Y</b> </td><td></td><td>  Positioned for cloud use, less MTBF and worse BER </td></tr></tbody></table>  You see the trend yourself - Advanced Format has finally penetrated from the desktop segment into the corporate one.  Fast SAS 10/15 kpm drives are still available in the 512N version, but the density increase forces manufacturers to use 4KiB sectors: Seagate 10k.8 and HGST Ultrastar C10K1800 with a capacity of 1800GB are available only in versions 512E and 4KN.  All drives larger than 5TB with the exception of HGST Ultrastar He <sup>6</sup> - only Advanced Format. <br><br><h3>  SSD </h3><br>  SSD have their own characteristics.  You can read and write data with pages that are 2‚Äì4‚Äì8‚Äì16KiB depending on the SSD architecture.  At the same time, for recording, it is necessary to pre-erase cells, which is carried out not page by page, but in blocks of several hundred pages.  For example, Samsung 840 EVO has blocks of 2Mb, each of which consists of 256 pages of 8kb.  In this case, of course, any block size presented to the host - 512 or 4096 bytes - will be an abstraction. <br><br>  Some of the current SAS / SATA SSDs emulate a 512E drive, but most of the compatibility considerations are 512N.  There is no need to take any special measures in this regard, as in the enterprise-class SSD the contents of the cache are necessarily protected from power loss.  Enough to ensure the alignment of the page size. <br>  Some PCI-E SSDs, for example, produced by Fusion IO, allow using proprietary utilities to change the size of the logical sector during formatting, i.e.  Switch between 512E and 4KN modes.  For some SSDs with a SAS interface, this is also possible, for example, the Seagate 1200 supports resizing the sector with the usual sg_format.  Transition to the 4KiB sector <a href="http://www.percona.com/blog/2011/01/03/effect-from-innodb-log-block-size-4096-bytes/">in some scenarios</a> can significantly improve performance. <br><br><h2>  findings </h2><br><ol><li>  512E drives are not suitable for use in servers with outdated OSes that ignore the size of the physical sector.  In desktop applications, it does not matter much, as no one usually uses synchronous recording. </li><li>  Carefully study your infrastructure: OS, used services, controllers, storage systems, caching modes on controllers and storage systems.  If there are potential problems with performance and / or data integrity, take appropriate action. </li><li>  Problems with outdated operating systems can be circumvented using virtualization, but still need to pay attention to the alignment of partitions. </li></ol><br><h2>  Links </h2><br><ul><li>  <a href="http://www.ibm.com/developerworks/library/l-linux-on-4kb-sector-disks/index.html">IBM DeveloperWorks: Linux on 4 KB sector disks: Practical advice</a> </li><li>  <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html-single/Storage_Administration_Guide/">RHEL6 Documentation: IO limits and IO hints in Linux</a> </li><li>  <a href="http://www.thomas-krenn.com/en/wiki/Partition_Alignment">Alignment in fdisk, LVM and MD</a> </li><li>  <a href="http://technet.microsoft.com/en-us/library/hh831459">Support for disks with a large sector size in Hyper-V</a> </li><li>  <a href="http://blogs.technet.com/b/exchange/archive/2013/04/24/exchange-2010-database-availability-groups-and-disk-sector-sizes.aspx">Exchange Server 2010 availability groups and sector size</a> </li><li>  <a href="http://support.microsoft.com/kb/2515143">Using Hyper-V on drives with a large sector size in Windows Server 2008 and 2008 R2</a> </li><li>  <a href="http://blogs.msdn.com/b/psssql/archive/2011/01/13/sql-server-new-drives-use-4k-sector-size.aspx">SQL Server and new 4K sector disks</a> </li><li>  <a href="http://support.microsoft.com/kb/2466753/en-us">Error ‚ÄúWindows Setup could not configure Windows on this computer's hardware‚Äù when installing Windows 7 or Windows Server 2008 R2</a> </li><li>  <a href="http://support.microsoft.com/kb/2466753/en-us">Problems in applications using the Extensible Storage Engine API (ESENT) when resizing a physical sector</a> </li><li>  <a href="http://www.databasejournal.com/features/oracle/article.php/3922826/Understanding-4KB-Sector-Support-for-Oracle-Files.htm">Understanding 4KB Sector Support for Oracle Files</a> </li><li>  <a href="http://www.percona.com/blog/2011/01/03/effect-from-innodb-log-block-size-4096-bytes/">Effect from innodb log block size 4096 bytes</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/245085/">https://habr.com/ru/post/245085/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245073/index.html">GitHub unlocked again</a></li>
<li><a href="../245075/index.html">DFS Replication and "temporary" files</a></li>
<li><a href="../245079/index.html">Digital actors</a></li>
<li><a href="../245081/index.html">Self-study for CCNP exams (personal experience)</a></li>
<li><a href="../245083/index.html">Does your mobile ad work?</a></li>
<li><a href="../245087/index.html">How to organize sending push-notifications on iPhone</a></li>
<li><a href="../245089/index.html">Azure RemoteApp comes out of beta testing</a></li>
<li><a href="../245093/index.html">DOMPDF - export data from PHP to PDF</a></li>
<li><a href="../245095/index.html">We work with the Control button in Visual Studio + Resharper</a></li>
<li><a href="../245097/index.html">Tests that test tests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>