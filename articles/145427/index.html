<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An example of working with getUserMedia and <canvas> in the Zen Framework based on the ‚ÄúHTML5 Exploding Camera Demo‚Äù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Starting with version 2012.1, the embedded canvas <canvas> ZEN component has appeared in Cach√© DBMS. 
 Note: you can download the free single-user ver...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An example of working with getUserMedia and <canvas> in the Zen Framework based on the ‚ÄúHTML5 Exploding Camera Demo‚Äù</h1><div class="post__text post__text-html js-mediator-article"><img src="http://devfiles.myopera.com/articles/6452/html5-exploding-camera.jpg"><br><br>  Starting with version 2012.1, the embedded <a href="">canvas &lt;canvas&gt;</a> ZEN component has appeared in Cach√© DBMS. <br><blockquote>  Note: you can download the free single-user version of the Cach√© DBMS <a href="http://intersystems.ru/cache/downloads/index.html">here</a> . </blockquote><br>  And in the latest release of <a href="http://www.opera.com/docs/changelogs/windows/1200/">Opera 12</a> , built-in support for the <i>getUserMedia</i> function ( <a href="http://www.w3.org/TR/webrtc/">WebRTC 1.0</a> : Real-time Communication Between Browsers) appeared, which makes it possible to access devices that generate a media stream, such as a webcam. <br><blockquote>  Note: Support <a href="http://caniuse.com/stream">table of</a> getUserMedia / Stream API in desktop and mobile browsers. </blockquote><br>  To demonstrate both of these features, using the <a href="http://intersystems.ru/cache/technology/components/zen/index.html">ZEN</a> framework built into the Cach√© DBMS, the demo was chosen as the basis: <a href="http://dev.opera.com/articles/view/playing-with-html5-video-and-getusermedia-support/">HTML5 Exploding Camera Demo</a> . <br><a name="habracut"></a><blockquote>  Note: The original demo is <a href="http://people.opera.com/danield/html5/explode/">online</a> . </blockquote><br>  Also, four filters were added to the code to the output video from the webcam to demonstrate how to work with individual pixels of the <b>&lt;canvas&gt;</b> component. <br><br>  The code was tested on: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Cach√© 2012.2 Release Candidate (Unicode, x64); </li><li>  Opera 12.00 Release; </li><li>  Chrome 21 beta. </li></ol><br><blockquote>  Note: WebRTC can be enabled in Chrome 18.0.1008 and later versions on the <b>about: flags</b> or <b>chrome: // flags</b> page <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f20/998/23f/f2099823f24289889f3bfdda3d11d44b.png"></blockquote><br><div class="spoiler">  <b class="spoiler_title">ZEN page class code</b> <div class="spoiler_text"> <font color="#000080">Class demo.camcanvas Extends% ZEN.Component.page</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br><br></font>  <font color="#000080">Parameter</font> <font color="#000000">JSINCLUDES</font> <font color="#000080">As</font> <font color="#000000">STRING =</font> <font color="#800080">"zenCSLM.js"</font> <font color="#000000">;</font> <font color="#000000"><br><br></font>  <font color="#000080">/// This Style block defines the CSS style for the page.</font> <font color="#000080"><br></font>  <font color="#000080">XData</font> <font color="#000000">Style</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">style</font> <font color="#800000">type</font> <font color="#000000">=</font> <font color="#008000">"text / css"</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">* {</font> <font color="#000000"><br></font>  <font color="#000000">margin: 0;</font> <font color="#000000"><br></font>  <font color="#000000">padding: 0;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">a {</font> <font color="#000000"><br></font>  <font color="#000000">color: # 99f;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">#page {</font> <font color="#000000"><br></font>  <font color="#000000">background: # 000;</font> <font color="#000000"><br></font>  <font color="#000000">color: #fff;</font> <font color="#000000"><br></font>  <font color="#000000">font-family: 'Helvetica Neue', 'Free Sans', 'Deja Vu Sans', Arial, Helvetica, sans-serif;</font> <font color="#000000"><br></font>  <font color="#000000">margin: 0px;</font> <font color="#000000"><br></font>  <font color="#000000">padding: 0px;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">#main {</font> <font color="#000000"><br></font>  <font color="#000000">color: #fff;</font> <font color="#000000"><br></font>  <font color="#000000">border: solid 2px # c00;</font> <font color="#000000"><br></font>  <font color="#000000">border-radius: 1em;</font> <font color="#000000"><br></font>  <font color="#000000">line-height: 1.5;</font> <font color="#000000"><br></font>  <font color="#000000">margin: 2em auto;</font> <font color="#000000"><br></font>  <font color="#000000">padding: 1em;</font> <font color="#000000"><br></font>  <font color="#000000">width: 50%;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">#rs {</font> <font color="#000000"><br></font>  <font color="#000000">background: # 3af;</font> <font color="#000000"><br></font>  <font color="#000000">color: # 777;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">&lt;/</font> <font color="#000080">style</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">XData</font> <font color="#000000">Contents [</font> <font color="#000080">XMLNamespace</font> <font color="#000000">=</font> <font color="#800080">" <a href="http://www.intersystems.com/zen%2522%25C2%25A0">www.intersystems.com/zen"</a></font> <font color="#000000">]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">page</font> <font color="#800000">xmlns</font> <font color="#000000">=</font> <font color="#008000">" <a href="http://www.intersystems.com/zen%2522%25C2%25A0">www.intersystems.com/zen"</a></font> <font color="#800000">title</font> <font color="#000000">=</font> <font color="#008000">"HTML5 Demo &amp; quot; Exploding Camera &amp; quot;"</font>  <font color="#800000">id</font> <font color="#000000">=</font> <font color="#008000">"page"</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">timer</font> <font color="#000080"><br></font>  <font color="#800000">id</font> <font color="#000000">=</font> <font color="#008000">"timer"</font> <font color="#008000"><br></font>  <font color="#800000">timeout</font> <font color="#000000">=</font> <font color="#008000">"0"</font> <font color="#008000"><br></font>  <font color="#800000">ontimeout</font> <font color="#000000">=</font> <font color="#008000">"zenPage.processFrame ();"</font> <font color="#008000"><br></font>  <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">html</font> <font color="#000080"><br></font>  <font color="#800000">id</font> <font color="#000000">=</font> <font color="#008000">"main"</font> <font color="#008000"><br></font>  <font color="#800000">align</font> <font color="#000000">=</font> <font color="#008000">"center"</font> <font color="#008000"><br></font>  <font color="#800000">hidden</font> <font color="#000000">=</font> <font color="#008000">"true"</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">video</font> <font color="#000080"><br></font>  <font color="#800000">id</font> <font color="#000000">=</font> <font color="#008000">"sourcevid"</font> <font color="#008000"><br></font>  <font color="#800000">autoplay</font> <font color="#000000">=</font> <font color="#008000">"autoplay"</font> <font color="#008000"><br></font>  <font color="#800000">hidden</font> <font color="#000000">=</font> <font color="#008000">"true"</font> <font color="#008000"><br></font>  <font color="#000000">&gt; Sorry, your browser does not support the</font> <font color="#800080">&amp; lt;</font>  <font color="#000000">video</font> <font color="#800080">&amp; gt;</font>  <font color="#000000">.</font>  <font color="#000000">Please try</font> <font color="#008000"><a href="http://ru.opera.com/download/%2522">&lt;a</a></font> <font color="#800000">href</font> <font color="#000000">=</font> <font color="#008000"><a href="http://ru.opera.com/download/%2522">"ru.opera.com/download/"&gt;</a></font> <font color="#000000">Opera &lt;/</font> <font color="#000080">a</font> <font color="#000000">&gt;. &lt;/</font> <font color="#000080">Video</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;/</font> <font color="#000080">html</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">radioSet</font> <font color="#000080"><br></font>  <font color="#800000">id</font> <font color="#000000">=</font> <font color="#008000">"rs"</font> <font color="#008000"><br></font>  <font color="#800000">align</font> <font color="#000000">=</font> <font color="#008000">"center"</font> <font color="#008000"><br></font>  <font color="#800000">hidden</font> <font color="#000000">=</font> <font color="#008000">"true"</font> <font color="#008000"><br></font>  <font color="#800000">displayList</font> <font color="#000000">=</font> <font color="#008000">"Normal, Embossed, Red, Inverse, Monochrome"</font> <font color="#008000"><br></font>  <font color="#800000">valueList</font> <font color="#000000">=</font> <font color="#008000">"filterNormal, filterEmboss, filterRed, filterInversed, filterGrayscale"</font> <font color="#008000"><br></font>  <font color="#800000">value</font> <font color="#000000">=</font> <font color="#008000">"filterNormal"</font> <font color="#008000"><br></font>  <font color="#800000">onchange</font> <font color="#000000">=</font> <font color="#008000">"zenPage.changeFilter (zenThis.getValue ());"</font> <font color="#008000"><br></font>  <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">canvas</font> <font color="#800000">id</font> <font color="#000000">=</font> <font color="#008000">"output"</font> <font color="#800000">hidden</font> <font color="#000000">=</font> <font color="#008000">"true"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">canvas</font> <font color="#800000">id</font> <font color="#000000">=</font> <font color="#008000">"sourcecopy"</font> <font color="#800000">hidden</font> <font color="#000000">=</font> <font color="#008000">"true"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;/</font> <font color="#000080">page</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">changeFilter (</font> <font color="#ff00ff">strFunction</font> <font color="#000000">) [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">eval (</font> <font color="#800000">"filter = 'this."</font> <font color="#000080">+</font> <font color="#000000">strFunction</font> <font color="#000080">+</font> <font color="#800000">"();'"</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">filterNormal () [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">filterInversed () [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br><br></font>  <font color="#008080">var</font> <font color="#000000">imageData</font> <font color="#000080">=</font> <font color="#000000">copy.getImageData (</font> <font color="#000080">0</font> <font color="#000000">,</font> <font color="#000080">0</font> <font color="#000000">, copycanvas.width, copycanvas.height);</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">data</font> <font color="#000080">=</font> <font color="#000000">imageData.data;</font> <font color="#000000"><br><br></font>  <font color="#008080">var</font> <font color="#000000">media</font> <font color="#000080">=</font> <font color="#000000">(data [</font> <font color="#000080">0</font> <font color="#000000">]</font> <font color="#000080">+</font> <font color="#000000">data [</font> <font color="#000080">1</font> <font color="#000000">]</font> <font color="#000080">+</font> <font color="#000000">data [</font> <font color="#000080">2</font> <font color="#000000">])</font> <font color="#000080">/ 3 &gt;&gt; 0</font> <font color="#000000">;</font> <font color="#000000"><br><br></font>  <font color="#000000">data [</font> <font color="#000080">0</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br></font>  <font color="#000000">data [</font> <font color="#000080">1</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br></font>  <font color="#000000">data [</font> <font color="#000080">2</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br><br></font>  <font color="#008000">for</font> <font color="#000000">(</font> <font color="#008000">var</font> <font color="#000000">i</font> <font color="#000080">= 4</font> <font color="#000000">, len</font> <font color="#000080">=</font> <font color="#000000">data.length; i</font> <font color="#000080">&lt;</font> <font color="#000000">len; i</font> <font color="#000080">+ = 4</font> <font color="#000000">) {</font> <font color="#000000"><br></font>  <font color="#000000">media</font> <font color="#000080">= 255-</font> <font color="#000000">(data [i]</font> <font color="#000080">+</font> <font color="#000000">data [i</font> <font color="#000080">+1</font> <font color="#000000">]</font> <font color="#000080">+</font> <font color="#000000">data [i</font> <font color="#000080">+ 2</font> <font color="#000000">])</font> <font color="#000080">/ 3 &gt;&gt; 0</font> <font color="#000000">;</font> <font color="#000000"><br><br></font>  <font color="#000000">data [i]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br></font>  <font color="#000000">data [i</font> <font color="#000080">+1</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br></font>  <font color="#000000">data [i</font> <font color="#000080">+2</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">copy.putImageData (imageData,</font> <font color="#000080">0</font> <font color="#000000">,</font> <font color="#000080">0</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">filterGrayscale () [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br><br></font>  <font color="#008080">var</font> <font color="#000000">imageData</font> <font color="#000080">=</font> <font color="#000000">copy.getImageData (</font> <font color="#000080">0</font> <font color="#000000">,</font> <font color="#000080">0</font> <font color="#000000">, copycanvas.width, copycanvas.height);</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">data</font> <font color="#000080">=</font> <font color="#000000">imageData.data;</font> <font color="#000000"><br><br></font>  <font color="#008000">for</font> <font color="#000000">(</font> <font color="#008000">var</font> <font color="#000000">i</font> <font color="#000080">= 0</font> <font color="#000000">, len</font> <font color="#000080">=</font> <font color="#000000">data.length; i</font> <font color="#000080">&lt;</font> <font color="#000000">len; i</font> <font color="#000080">+ = 4</font> <font color="#000000">) {</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">media</font> <font color="#000080">=</font> <font color="#000000">(data [i]</font> <font color="#000080">+</font> <font color="#000000">data [i</font> <font color="#000080">+1</font> <font color="#000000">]</font> <font color="#000080">+</font> <font color="#000000">data [i</font> <font color="#000080">+ 2</font> <font color="#000000">])</font> <font color="#000080">/ 3 &gt;&gt; 0</font> <font color="#000000">;</font> <font color="#000000"><br><br></font>  <font color="#000000">data [i]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br></font>  <font color="#000000">data [i</font> <font color="#000080">+1</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br></font>  <font color="#000000">data [i</font> <font color="#000080">+2</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">copy.putImageData (imageData,</font> <font color="#000080">0</font> <font color="#000000">,</font> <font color="#000080">0</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">filterRed () [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br><br></font>  <font color="#008080">var</font> <font color="#000000">imageData</font> <font color="#000080">=</font> <font color="#000000">copy.getImageData (</font> <font color="#000080">0</font> <font color="#000000">,</font> <font color="#000080">0</font> <font color="#000000">, copycanvas.width, copycanvas.height);</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">data</font> <font color="#000080">=</font> <font color="#000000">imageData.data;</font> <font color="#000000"><br><br></font>  <font color="#008000">for</font> <font color="#000000">(</font> <font color="#008000">var</font> <font color="#000000">i</font> <font color="#000080">= 0</font> <font color="#000000">, len</font> <font color="#000080">=</font> <font color="#000000">data.length; i</font> <font color="#000080">&lt;</font> <font color="#000000">len; i</font> <font color="#000080">+ = 4</font> <font color="#000000">) {</font> <font color="#000000"><br></font>  <font color="#000000">data [i</font> <font color="#000080">+1</font> <font color="#000000">]</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">data [i</font> <font color="#000080">+2</font> <font color="#000000">]</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">copy.putImageData (imageData,</font> <font color="#000080">0</font> <font color="#000000">,</font> <font color="#000080">0</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">filterEmboss () [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">imageData</font> <font color="#000080">=</font> <font color="#000000">copy.getImageData (</font> <font color="#000080">0</font> <font color="#000000">,</font> <font color="#000080">0</font> <font color="#000000">, copycanvas.width, copycanvas.height);</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">data</font> <font color="#000080">=</font> <font color="#000000">imageData.data;</font> <font color="#000000"><br><br></font>  <font color="#008080">var</font> <font color="#000000">media</font> <font color="#000080">=</font> <font color="#000000">(data [</font> <font color="#000080">0</font> <font color="#000000">]</font> <font color="#000080">+</font> <font color="#000000">data [</font> <font color="#000080">1</font> <font color="#000000">]</font> <font color="#000080">+</font> <font color="#000000">data [</font> <font color="#000080">2</font> <font color="#000000">])</font> <font color="#000080">/ 3 &gt;&gt; 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">data [</font> <font color="#000080">0</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br></font>  <font color="#000000">data [</font> <font color="#000080">1</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br></font>  <font color="#000000">data [</font> <font color="#000080">2</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br><br></font>  <font color="#000000">media</font> <font color="#000080">=</font> <font color="#000000">(data [</font> <font color="#000080">4</font> <font color="#000000">]</font> <font color="#000080">+</font> <font color="#000000">data [</font> <font color="#000080">5</font> <font color="#000000">]</font> <font color="#000080">+</font> <font color="#000000">data [</font> <font color="#000080">6</font> <font color="#000000">])</font> <font color="#000080">/ 3 &gt;&gt; 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">data [</font> <font color="#000080">4</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br></font>  <font color="#000000">data [</font> <font color="#000080">5</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br></font>  <font color="#000000">data [</font> <font color="#000080">6</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br><br></font>  <font color="#008000">for</font> <font color="#000000">(</font> <font color="#008000">var</font> <font color="#000000">i</font> <font color="#000080">= 8</font> <font color="#000000">, len</font> <font color="#000080">=</font> <font color="#000000">data.length; i</font> <font color="#000080">&lt;</font> <font color="#000000">len; i</font> <font color="#000080">+ = 4</font> <font color="#000000">) {</font> <font color="#000000"><br></font>  <font color="#000000">media</font> <font color="#000080">=</font> <font color="#000000">(data [i]</font> <font color="#000080">+</font> <font color="#000000">data [i</font> <font color="#000080">+1</font> <font color="#000000">]</font> <font color="#000080">+</font> <font color="#000000">data [i</font> <font color="#000080">+ 2</font> <font color="#000000">])</font> <font color="#000080">/ 3 &gt;&gt; 0</font> <font color="#000000">;</font> <font color="#000000"><br><br></font>  <font color="#000000">data [i]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br></font>  <font color="#000000">data [i</font> <font color="#000080">+1</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br></font>  <font color="#000000">data [i</font> <font color="#000080">+2</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">media;</font> <font color="#000000"><br><br></font>  <font color="#000000">data [i</font> <font color="#000080">-8</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">(data [i</font> <font color="#000080">-8</font> <font color="#000000">]</font> <font color="#000080">+ 255-</font> <font color="#000000">media)</font> <font color="#000080">/ 2 &gt;&gt; 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">data [i</font> <font color="#000080">-7</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">(data [i</font> <font color="#000080">-7</font> <font color="#000000">]</font> <font color="#000080">+ 255-</font> <font color="#000000">media)</font> <font color="#000080">/ 2 &gt;&gt; 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">data [i</font> <font color="#000080">-6</font> <font color="#000000">]</font> <font color="#000080">=</font> <font color="#000000">(data [i</font> <font color="#000080">-6</font> <font color="#000000">]</font> <font color="#000080">+ 255-</font> <font color="#000000">media)</font> <font color="#000080">/ 2 &gt;&gt; 0</font> <font color="#000000">;</font> <font color="#000000"><br><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">copy.putImageData (imageData,</font> <font color="#000080">0</font> <font color="#000000">,</font> <font color="#000080">0</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">processFrame () [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008000">if</font> <font color="#000000">(</font> <font color="#000080">!</font> <font color="#000000">isNaN (video.duration)) {</font> <font color="#000000"><br></font>  <font color="#008000">if</font> <font color="#000000">(SOURCERECT.width</font> <font color="#000080">== 0</font> <font color="#000000">) {</font> <font color="#000000"><br></font>  <font color="#000000">SOURCERECT</font> <font color="#000080">=</font> <font color="#000000">{x:</font> <font color="#000080">0</font> <font color="#000000">, y:</font> <font color="#000080">0</font> <font color="#000000">, width: video.videoWidth, height: video.videoHeight};</font> <font color="#000000"><br></font>  <font color="#000000">copycanvas.width</font> <font color="#000080">=</font> <font color="#000000">video.videoWidth;</font> <font color="#000000"><br></font>  <font color="#000000">copycanvas.height</font> <font color="#000080">=</font> <font color="#000000">video.videoHeight;</font> <font color="#000000"><br><br><br></font>  <font color="#000000">TILE_WIDTH</font> <font color="#000080">=</font> <font color="#000000">copycanvas.width</font> <font color="#000080">/ 16</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">TILE_HEIGHT</font> <font color="#000080">=</font> <font color="#000000">copycanvas.height</font> <font color="#000080">/ 16</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">TILE_CENTER_WIDTH</font> <font color="#000080">=</font> <font color="#000000">TILE_WIDTH</font> <font color="#000080">/ 2 &gt;&gt; 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">TILE_CENTER_HEIGHT</font> <font color="#000080">=</font> <font color="#000000">TILE_HEIGHT</font> <font color="#000080">/ 2 &gt;&gt; 0</font> <font color="#000000">;</font> <font color="#000000"><br><br></font>  <font color="#800000">this</font> <font color="#000000">.createTiles ();</font> <font color="#000000"><br></font>  <font color="#000000">zenSetProp (</font> <font color="#800000">'output'</font> <font color="#000000">,</font> <font color="#800000">'hidden'</font> <font color="#000000">, false);</font> <font color="#000000"><br></font>  <font color="#000000">zenSetProp (</font> <font color="#800000">'rs'</font> <font color="#000000">,</font> <font color="#800000">'hidden'</font> <font color="#000000">, false);</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#008000">// copy tiles</font> <font color="#008000"><br></font>  <font color="#000000">copy.drawImage (video,</font> <font color="#000080">0</font> <font color="#000000">,</font> <font color="#000080">0</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">eval (filter);</font> <font color="#000000"><br></font>  <font color="#000000">draw.clearRect (PAINTX, PAINTY, PAINTWIDTH, PAINTHEIGHT);</font> <font color="#000000"><br><br></font>  <font color="#008000">for</font> <font color="#000000">(</font> <font color="#008000">var</font> <font color="#000000">i</font> <font color="#000080">= 0</font> <font color="#000000">, len</font> <font color="#000080">=</font> <font color="#000000">tiles.length; i</font> <font color="#000080">&lt;</font> <font color="#000000">len; i</font> <font color="#000080">++</font> <font color="#000000">) {</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">tile</font> <font color="#000080">=</font> <font color="#000000">tiles [i];</font> <font color="#000000"><br></font>  <font color="#008000">if</font> <font color="#000000">(tile.force</font> <font color="#000080">&gt;</font> <font color="#008080">0.0001</font> <font color="#000000">) {</font> <font color="#000000"><br></font>  <font color="#008000">//expansion</font> <font color="#008000"><br></font>  <font color="#008080">var</font> <font color="#000000">force</font> <font color="#000080">=</font> <font color="#000000">tile.force;</font> <font color="#000000"><br></font>  <font color="#000000">tile.moveX</font> <font color="#000080">* =</font> <font color="#000000">force;</font> <font color="#000000"><br></font>  <font color="#000000">tile.moveY</font> <font color="#000080">* =</font> <font color="#000000">force;</font> <font color="#000000"><br></font>  <font color="#000000">tile.moveRotation</font> <font color="#000080">* =</font> <font color="#000000">force;</font> <font color="#000000"><br></font>  <font color="#000000">tile.currentX</font> <font color="#000080">+ =</font> <font color="#000000">tile.moveX;</font> <font color="#000000"><br></font>  <font color="#000000">tile.currentY</font> <font color="#000080">+ =</font> <font color="#000000">tile.moveY;</font> <font color="#000000"><br></font>  <font color="#000000">tile.rotation</font> <font color="#000080">+ =</font> <font color="#000000">tile.moveRotation;</font> <font color="#000000"><br></font>  <font color="#000000">tile.rotation</font> <font color="#000080">% = 360</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">tile.force</font> <font color="#000080">* =</font> <font color="#008080">0.9</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#008000">if</font> <font color="#000000">(tile.currentX</font> <font color="#000080">&lt;= 0 ||</font> <font color="#000000">tile.currentX</font> <font color="#000080">&gt; =</font> <font color="#000000">PAINTWIDTH) {</font> <font color="#000000"><br></font>  <font color="#000000">tile.moveX</font> <font color="#000080">* = -1</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#008000">if</font> <font color="#000000">(tile.currentY</font> <font color="#000080">&lt;= 0 ||</font> <font color="#000000">tile.currentY</font> <font color="#000080">&gt; =</font> <font color="#000000">PAINTHEIGHT) {</font> <font color="#000000"><br></font>  <font color="#000000">tile.moveY</font> <font color="#000080">* = -1</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#008000">else if</font> <font color="#000000">(tile.rotation</font> <font color="#000080">! = 0 ||</font> <font color="#000000">tile.currentX</font> <font color="#000080">! =</font> <font color="#000000">tile.originX</font> <font color="#000080">||</font> <font color="#000000">tile.currentY</font> <font color="#000080">! =</font> <font color="#000000">tile.originY) {</font> <font color="#000000"><br></font>  <font color="#008000">// collapse</font> <font color="#008000"><br></font>  <font color="#008080">var</font> <font color="#000000">diffx</font> <font color="#000080">=</font> <font color="#000000">(tile.originX</font> <font color="#000080">-</font> <font color="#000000">tile.currentX)</font> <font color="#000080">*</font> <font color="#008080">0.2</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">diffy</font> <font color="#000080">=</font> <font color="#000000">(tile.originY</font> <font color="#000080">-</font> <font color="#000000">tile.currentY)</font> <font color="#000080">*</font> <font color="#008080">0.2</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">diffRot</font> <font color="#000080">=</font> <font color="#000000">(</font> <font color="#000080">0-</font> <font color="#000000">tile.rotation)</font> <font color="#000080">*</font> <font color="#008080">0.2</font> <font color="#000000">;</font> <font color="#000000"><br><br></font>  <font color="#008000">if</font> <font color="#000000">(</font> <font color="#800000">this</font> <font color="#000000">.absolute (diffx)</font> <font color="#000080">&lt;</font> <font color="#008080">0.5</font> <font color="#000000">) {</font> <font color="#000000"><br></font>  <font color="#000000">tile.currentX</font> <font color="#000080">=</font> <font color="#000000">tile.originX;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#008000">else</font> <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">tile.currentX</font> <font color="#000080">+ =</font> <font color="#000000">diffx;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#008000">if</font> <font color="#000000">(</font> <font color="#800000">this</font> <font color="#000000">.absolute (diffy)</font> <font color="#000080">&lt;</font> <font color="#008080">0.5</font> <font color="#000000">) {</font> <font color="#000000"><br></font>  <font color="#000000">tile.currentY</font> <font color="#000080">=</font> <font color="#000000">tile.originY;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#008000">else</font> <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">tile.currentY</font> <font color="#000080">+ =</font> <font color="#000000">diffy;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#008000">if</font> <font color="#000000">(</font> <font color="#800000">this</font> <font color="#000000">.absolute (diffRot)</font> <font color="#000080">&lt;</font> <font color="#008080">0.5</font> <font color="#000000">) {</font> <font color="#000000"><br></font>  <font color="#000000">tile.rotation</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#008000">else</font> <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">tile.rotation</font> <font color="#000080">+ =</font> <font color="#000000">diffRot;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#008000">else</font> <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">tile.force</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">draw.save ();</font> <font color="#000000"><br></font>  <font color="#000000">draw.translate (tile.currentX, tile.currentY);</font> <font color="#000000"><br></font>  <font color="#000000">draw.rotate (tile.rotation</font> <font color="#000080">*</font> <font color="#000000">RAD);</font> <font color="#000000"><br></font>  <font color="#000000">draw.drawImage (copycanvas, tile.videoX, tile.videoY, TILE_WIDTH, TILE_HEIGHT,</font> <font color="#000080">-</font> <font color="#000000">TILE_CENTER_WIDTH,</font> <font color="#000080">-</font> <font color="#000000">TILE_CENTER_HEIGHT, TILE_WIDTH, TILE_HEIGHT);</font> <font color="#000000"><br></font>  <font color="#000000">draw.restore ();</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">zen (</font> <font color="#800000">'timer'</font> <font color="#000000">) .startTimer ();</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">successCallback (</font> <font color="#ff00ff">stream</font> <font color="#000000">) [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008000">// Replacing the source of the video element with camera stream</font> <font color="#008000"><br></font>  <font color="#000000">video.src</font> <font color="#000080">=</font> <font color="#000000">window.URL.createObjectURL (stream)</font> <font color="#000080">||</font>  <font color="#000000">stream;</font> <font color="#000000"><br></font>  <font color="#000000">video.play ();</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">errorCallback (</font> <font color="#ff00ff">error</font> <font color="#000000">) [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">/// Constructor for individual tiles</font> <font color="#000080"><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">Tile () [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#800000">this</font> <font color="#000000">.originX</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#800000">this</font> <font color="#000000">.originY</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#800000">this</font> <font color="#000000">.currentX</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#800000">this</font> <font color="#000000">.currentY</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#800000">this</font> <font color="#000000">.rotation</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#800000">this</font> <font color="#000000">.force</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#800000">this</font> <font color="#000000">.z</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#800000">this</font> <font color="#000000">.moveX</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#800000">this</font> <font color="#000000">.moveY</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#800000">this</font> <font color="#000000">.moveRotation</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#800000">this</font> <font color="#000000">.videoX</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#800000">this</font> <font color="#000000">.videoY</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">/// Faster than Math.abs</font> <font color="#000080"><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">absolute (</font> <font color="#ff00ff">x</font> <font color="#000000">) [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008000">return</font> <font color="#000000">(x</font> <font color="#000080">&lt;0? -</font> <font color="#000000">x</font> <font color="#000080">:</font> <font color="#000000">x);</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">zindexSort (</font> <font color="#000000"><br></font>  <font color="#ff00ff">a</font> <font color="#000000">,</font> <font color="#000000"><br></font>  <font color="#ff00ff">b</font> <font color="#000000">) [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008000">return</font> <font color="#000000">(a.force</font> <font color="#000080">-</font> <font color="#000000">b.force);</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">/// Get the coordinates of the click / mouse for the explosion of the canvas</font> <font color="#000080"><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">dropBomb (</font> <font color="#000000"><br></font>  <font color="#ff00ff">event</font> <font color="#000000">,</font> <font color="#000000"><br></font>  <font color="#ff00ff">obj</font> <font color="#000000">) [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">event.preventDefault ();</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">posx</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">posy</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">e</font> <font color="#000080">=</font> <font color="#000000">event</font> <font color="#000080">||</font>  <font color="#000000">window.event;</font> <font color="#000000"><br><br></font>  <font color="#008000">if</font> <font color="#000000">(e.touches) {</font> <font color="#000000"><br></font>  <font color="#000000">posx</font> <font color="#000080">=</font> <font color="#000000">event.touches [</font> <font color="#000080">0</font> <font color="#000000">] .pageX;</font> <font color="#000000"><br></font>  <font color="#000000">posy</font> <font color="#000080">=</font> <font color="#000000">event.touches [</font> <font color="#000080">0</font> <font color="#000000">] .pageY;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#008000">else if</font> <font color="#000000">(e.pageX</font> <font color="#000080">||</font> <font color="#000000">e.pageY) {</font> <font color="#000000"><br></font>  <font color="#000000">posx</font> <font color="#000080">=</font> <font color="#000000">e.pageX;</font> <font color="#000000"><br></font>  <font color="#000000">posy</font> <font color="#000080">=</font> <font color="#000000">e.pageY;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#008000">else if</font> <font color="#000000">(e.clientX</font> <font color="#000080">||</font> <font color="#000000">e.clientY) {</font> <font color="#000000"><br></font>  <font color="#000000">posx</font> <font color="#000080">=</font> <font color="#000000">e.clientX</font> <font color="#000080">+</font> <font color="#000000">ZLM.getPageXOffset ()</font> <font color="#000080">+</font> <font color="#000000">document.documentElement.scrollLeft;</font> <font color="#000000"><br></font>  <font color="#000000">posy</font> <font color="#000080">=</font> <font color="#000000">e.clientY</font> <font color="#000080">+</font> <font color="#000000">ZLM.getPageYOffset ()</font> <font color="#000080">+</font> <font color="#000000">document.documentElement.scrollTop;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">canvasX</font> <font color="#000080">=</font> <font color="#000000">posx</font> <font color="#000080">-</font> <font color="#000000">obj.offsetLeft;</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">canvasY</font> <font color="#000080">=</font> <font color="#000000">posy</font> <font color="#000080">-</font> <font color="#000000">obj.offsetTop;</font> <font color="#000000"><br></font>  <font color="#800000">this</font> <font color="#000000">.explode (canvasX, canvasY);</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">explode (</font> <font color="#000000"><br></font>  <font color="#ff00ff">x</font> <font color="#000000">,</font> <font color="#000000"><br></font>  <font color="#ff00ff">y</font> <font color="#000000">) [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008000">for</font> <font color="#000000">(</font> <font color="#008000">var</font> <font color="#000000">i</font> <font color="#000080">= 0</font> <font color="#000000">, len</font> <font color="#000080">=</font> <font color="#000000">tiles.length; i</font> <font color="#000080">&lt;</font> <font color="#000000">len; i</font> <font color="#000080">++</font> <font color="#000000">) {</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">tile</font> <font color="#000080">=</font> <font color="#000000">tiles [i];</font> <font color="#000000"><br><br></font>  <font color="#008080">var</font> <font color="#000000">xdiff</font> <font color="#000080">=</font> <font color="#000000">tile.currentX</font> <font color="#000080">-</font> <font color="#000000">x;</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">ydiff</font> <font color="#000080">=</font> <font color="#000000">tile.currentY</font> <font color="#000080">-</font> <font color="#000000">y;</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">dist</font> <font color="#000080">=</font> <font color="#000000">Math.sqrt (xdiff</font> <font color="#000080">*</font> <font color="#000000">xdiff</font> <font color="#000080">+</font> <font color="#000000">ydiff</font> <font color="#000080">*</font> <font color="#000000">ydiff);</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">rnd</font> <font color="#000080">=</font> <font color="#000000">Math.random ();</font> <font color="#000000"><br><br></font>  <font color="#008080">var</font> <font color="#000000">randRange</font> <font color="#000080">= 180+</font> <font color="#000000">(rnd</font> <font color="#000080">* 10</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">range</font> <font color="#000080">=</font> <font color="#000000">randRange</font> <font color="#000080">-</font> <font color="#000000">dist;</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">force</font> <font color="#000080">= 3 *</font> <font color="#000000">(range</font> <font color="#000080">/</font> <font color="#000000">randRange);</font> <font color="#000000"><br></font>  <font color="#008000">if</font> <font color="#000000">(force</font> <font color="#000080">&gt;</font> <font color="#000000">tile.force) {</font> <font color="#000000"><br></font>  <font color="#000000">tile.force</font> <font color="#000080">=</font> <font color="#000000">force;</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">radians</font> <font color="#000080">=</font> <font color="#000000">Math.atan2 (ydiff, xdiff);</font> <font color="#000000"><br></font>  <font color="#000000">tile.moveX</font> <font color="#000080">=</font> <font color="#000000">Math.cos (radians);</font> <font color="#000000"><br></font>  <font color="#000000">tile.moveY</font> <font color="#000080">=</font> <font color="#000000">Math.sin (radians);</font> <font color="#000000"><br></font>  <font color="#000000">tile.moveRotation</font> <font color="#000080">=</font> <font color="#008080">0.5</font> <font color="#000080">-</font> <font color="#000000">rnd;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">tiles.sort (zindexSort);</font> <font color="#000000"><br></font>  <font color="#800000">this</font> <font color="#000000">.processFrame ();</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">createTiles () [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">offsetX</font> <font color="#000080">=</font> <font color="#000000">(TILE_CENTER_WIDTH</font> <font color="#000080">+</font> <font color="#000000">(PAINTWIDTH</font> <font color="#000080">-</font> <font color="#000000">SOURCERECT.width)</font> <font color="#000080">/ 2 &gt;&gt; 0</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">offsetY</font> <font color="#000080">=</font> <font color="#000000">(TILE_CENTER_HEIGHT</font> <font color="#000080">+</font> <font color="#000000">(PAINTHEIGHT</font> <font color="#000080">-</font> <font color="#000000">SOURCERECT.height)</font> <font color="#000080">/ 2 &gt;&gt; 0</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">y</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#008000">while</font> <font color="#000000">(y</font> <font color="#000080">&lt;</font> <font color="#000000">SOURCERECT.height) {</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">x</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#008000">while</font> <font color="#000000">(x</font> <font color="#000080">&lt;</font> <font color="#000000">SOURCERECT.width) {</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">tile</font> <font color="#000080">=</font> <font color="#800000">new this</font> <font color="#000000">.Tile ();</font> <font color="#000000"><br></font>  <font color="#000000">tile.videoX</font> <font color="#000080">=</font> <font color="#000000">x;</font> <font color="#000000"><br></font>  <font color="#000000">tile.videoY</font> <font color="#000080">=</font> <font color="#000000">y;</font> <font color="#000000"><br></font>  <font color="#000000">tile.originX</font> <font color="#000080">=</font> <font color="#000000">offsetX</font> <font color="#000080">+</font> <font color="#000000">x;</font> <font color="#000000"><br></font>  <font color="#000000">tile.originY</font> <font color="#000080">=</font> <font color="#000000">offsetY</font> <font color="#000080">+</font> <font color="#000000">y;</font> <font color="#000000"><br></font>  <font color="#000000">tile.currentX</font> <font color="#000080">=</font> <font color="#000000">tile.originX;</font> <font color="#000000"><br></font>  <font color="#000000">tile.currentY</font> <font color="#000080">=</font> <font color="#000000">tile.originY;</font> <font color="#000000"><br></font>  <font color="#000000">tiles.push (tile);</font> <font color="#000000"><br></font>  <font color="#000000">x</font> <font color="#000080">+ =</font> <font color="#000000">TILE_WIDTH;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">y</font> <font color="#000080">+ =</font> <font color="#000000">TILE_HEIGHT;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">onloadHandler () [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">TILE_WIDTH</font> <font color="#000080">= 32</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">TILE_HEIGHT</font> <font color="#000080">= 24</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">TILE_CENTER_WIDTH</font> <font color="#000080">=</font> <font color="#000000">TILE_WIDTH</font> <font color="#000080">/ 2</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">TILE_CENTER_HEIGHT</font> <font color="#000080">=</font> <font color="#000000">TILE_HEIGHT</font> <font color="#000080">/ 2</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">SOURCERECT</font> <font color="#000080">=</font> <font color="#000000">{x:</font> <font color="#000080">0</font> <font color="#000000">, y:</font> <font color="#000080">0</font> <font color="#000000">, width:</font> <font color="#000080">0</font> <font color="#000000">, height:</font> <font color="#000080">0</font> <font color="#000000">};</font> <font color="#000000"><br></font>  <font color="#000000">PAINTX</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">PAINTY</font> <font color="#000080">= 0</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">PAINTWIDTH</font> <font color="#000080">=</font> <font color="#000000">ZLM.getViewportWidth ();</font> <font color="#000000"><br></font>  <font color="#000000">PAINTHEIGHT</font> <font color="#000080">=</font> <font color="#000000">ZLM.getViewportHeight ();</font> <font color="#000000"><br><br></font>  <font color="#000000">RAD</font> <font color="#000080">=</font> <font color="#000000">Math.PI</font> <font color="#000080">/ 180</font> <font color="#000000">;</font> <font color="#000000"><br><br></font>  <font color="#000000">tiles</font> <font color="#000080">=</font> <font color="#000000">[];</font> <font color="#000000"><br></font>  <font color="#000000">filter</font> <font color="#000080">=</font> <font color="#800000">'this.filterNormal ();'</font>  <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#000000">video</font> <font color="#000080">=</font> <font color="#000000">document.getElementById (</font> <font color="#800000">'sourcevid'</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">copycanvas</font> <font color="#000080">=</font> <font color="#000000">zen (</font> <font color="#800000">'sourcecopy'</font> <font color="#000000">) .findElement (</font> <font color="#800000">'canvas'</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">copy</font> <font color="#000080">=</font> <font color="#000000">zen (</font> <font color="#800000">'sourcecopy'</font> <font color="#000000">) .getContext ();</font> <font color="#000000"><br><br></font>  <font color="#008080">var</font> <font color="#000000">outputcanvas</font> <font color="#000080">=</font> <font color="#000000">zen (</font> <font color="#800000">'output'</font> <font color="#000000">) .findElement (</font> <font color="#800000">'canvas'</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">draw</font> <font color="#000080">=</font> <font color="#000000">zen (</font> <font color="#800000">'output'</font> <font color="#000000">) .getContext ();</font> <font color="#000000"><br></font>  <font color="#000000">outputcanvas.width</font> <font color="#000080">=</font> <font color="#000000">PAINTWIDTH;</font> <font color="#000000"><br></font>  <font color="#000000">outputcanvas.height</font> <font color="#000080">=</font> <font color="#000000">PAINTHEIGHT</font> <font color="#000080">-20</font> <font color="#000000">;</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">mouse_down</font> <font color="#000080">=</font> <font color="#000000">(</font> <font color="#800000">'createTouch'</font> <font color="#000080">in</font> <font color="#000000">document</font> <font color="#000080">?</font> <font color="#800000">'ontouchstart'</font> <font color="#000080">:</font> <font color="#800000">'onmousedown'</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">outputcanvas [mouse_down]</font> <font color="#000080">=</font> <font color="#008080">function</font> <font color="#000000">(event) {</font> <font color="#000000"><br></font>  <font color="#000000">zenPage.dropBomb (event,</font> <font color="#800000">this</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">};</font> <font color="#000000"><br><br></font>  <font color="#008000">// Get the stream from the camera using the getUserMedia function</font> <font color="#008000"><br></font>  <font color="#000000">navigator.getUserMedia</font> <font color="#000080">=</font> <font color="#000000">navigator.getUserMedia</font> <font color="#000080">||</font>  <font color="#000000">navigator.webkitGetUserMedia</font> <font color="#000080">||</font>  <font color="#000000">navigator.mozGetUserMedia</font> <font color="#000080">||</font>  <font color="#000000">navigator.msGetUserMedia;</font> <font color="#000000"><br></font>  <font color="#000000">window.URL</font> <font color="#000080">=</font> <font color="#000000">window.URL</font> <font color="#000080">||</font>  <font color="#000000">window.webkitURL</font> <font color="#000080">||</font>  <font color="#000000">window.mozURL</font> <font color="#000080">||</font>  <font color="#000000">window.msURL;</font> <font color="#000000"><br></font>  <font color="#008000">if</font> <font color="#000000">(navigator.getUserMedia) {</font> <font color="#000000"><br></font>  <font color="#008000">// This is a hack for the options is from @kanasansoft:</font> <font color="#008000"><br></font>  <font color="#008000">// http://www.kanasansoft.com/weblab/2012/06/arguments_of_getusermedia.html</font> <font color="#008000"><br></font>  <font color="#008080">var</font> <font color="#000000">gumOptions</font> <font color="#000080">=</font> <font color="#000000">{video: true, toString:</font> <font color="#008080">function</font> <font color="#000000">() {</font> <font color="#008000">return</font> <font color="#800000">'video'</font> <font color="#000000">;}};</font> <font color="#000000"><br></font>  <font color="#000000">navigator.getUserMedia (gumOptions,</font> <font color="#800000">this</font> <font color="#000000">.successCallback,</font> <font color="#800000">this</font> <font color="#000000">.errorCallback);</font> <font color="#000000"><br><br></font>  <font color="#000000">zen (</font> <font color="#800000">'timer'</font> <font color="#000000">) .setProperty (</font> <font color="#800000">'timeout'</font> <font color="#000000">,</font> <font color="#000080">33</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">zen (</font> <font color="#800000">'timer'</font> <font color="#000000">) .startTimer ();</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#008000">else</font> <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">zenSetProp (</font> <font color="#800000">'main'</font> <font color="#000000">,</font> <font color="#800000">'content'</font> <font color="#000000">,</font> <font color="#800000">'Oh, it seems your browser does not support the getUserMedia function. &lt;br&gt; Please try &lt;a href="http://rupera.ru/download/"&gt; a browser that has such support &lt;/a&gt;. '</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">zenSetProp (</font> <font color="#800000">'main'</font> <font color="#000000">,</font> <font color="#800000">'hidden'</font> <font color="#000000">, false);</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000000">}</font> </div></div><br>  <a href="http://db.tt/na7oe3Ah">Sources</a> class <b>demo.camcanvas</b> . <br><br><h4>  Import source code, compile it and run the example </h4><br>  Importing source code (project, classes, data, etc.) can be done using: <br><br><ul><li>  <a href="">Cach√© Terminal</a> ; </li><li>  <a href="">System Management Portal</a> ; </li><li>  <a href="">Cach√© Studio</a> . </li></ul><br>  All of these tools are available from the <a href="">Cach√© Launcher</a> menu. <br><br>  For the convenience of running the example, use <b>Cach√© Studio</b> . <br><blockquote>  Note: all the above tools support the Russian interface, but later in the description of the menu items their English version will be used. </blockquote><br>  So: <br><br><ol><li>  open <b>Cach√© Studio</b> ; </li><li>  select the ‚ÄúUSER‚Äù area: <font color="green"><b>File‚Äì&gt; Change Namespace</b></font> or (F4); </li><li>  run the file import wizard: <font color="green"><b>Tools‚Äì&gt; Import Local</b></font> or (Ctrl + I); </li><li>  select the file ‚Äúsources.xml‚Äù; </li><li>  check the <font color="green"><b>Compile Imported Items</b></font> box and click <font color="green"><b>OK</b></font> ; </li><li>  open the source code of our <b>demo.camcanvas</b> class from the class tree; <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c83/135/cbd/c83135cbd095a1208c5045ed6f3bf4d0.png"><br>  <a href=""><sup>to increase</sup></a> <br><br></li><li>  Open the webpage: <font color="green"><b>View-&gt; Web Page</b></font> or (F5). </li></ol><br>  By default, the link to our page will look like this: <br><pre>  http: // localhost: xxxx / csp / user / demo.camcanvas.cls </pre>  where <i>xxxx</i> is the port number that we specified when installing the Cach√© DBMS, which will run the <a href="">Apache embedded web server</a> . <br><br>  PS: <b>demo.camcanvas</b> class <b>will</b> not be difficult to remake under <a href="http://intersystems.ru/cache/technology/components/csp/index.html">CSP</a> technology (Cach√© Server Pages). </div><p>Source: <a href="https://habr.com/ru/post/145427/">https://habr.com/ru/post/145427/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145421/index.html">How many habrazhiteli served in the army?</a></li>
<li><a href="../145422/index.html">New versions of Windows Azure tools released, Python support added</a></li>
<li><a href="../145423/index.html">M2M Control Center</a></li>
<li><a href="../145424/index.html">Triple Play: how do telephone, TV and Internet get along in a single IP environment?</a></li>
<li><a href="../145425/index.html">ANSI Tattoo Girl</a></li>
<li><a href="../145428/index.html">Autostart and auto power off VM in VmWare ESXi 5.0 Update 1</a></li>
<li><a href="../145430/index.html">ActiveCloud cloud launched in Europe!</a></li>
<li><a href="../145431/index.html">100 programs on a smartphone or operating system logic?</a></li>
<li><a href="../145432/index.html">Free soup will no longer be</a></li>
<li><a href="../145435/index.html">Electric gearshift for bicycle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>