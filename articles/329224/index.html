<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>zetcd from CoreOS: Replacing ZooKeeper with ... storage etcd</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last week, CoreOS was pleased with another open source project - zetcd . In fact, it was known about him since last year, but now the first release to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>zetcd from CoreOS: Replacing ZooKeeper with ... storage etcd</h1><div class="post__text post__text-html js-mediator-article">  Last week, CoreOS was <a href="https://www.nixp.ru/news/14040.html">pleased with</a> another open source project - <a href="https://coreos.com/blog/introducing-zetcd">zetcd</a> .  In fact, it was known about him since last year, but now the first release took place, which translated the product into beta testing status - declared the product is ready for serious tests before being released into the world of production.  The authors have positioned zetcd as a ready-made replacement for ZooKeeper within such distributed / cluster solutions as Mesos, Apache Kafka and Apache Drill.  Even the fact that etcd offers a ‚Äúflat‚Äù key-value storage against the competitor‚Äôs hierarchical approach does not hinder their attitude.  How did they come to this? <br><img src="https://habrastorage.org/web/046/39e/9d7/04639e9d7dc24af0b72b68ea8159f46e.png"><br><a name="habracut"></a><br><h2>  Background: Apache ZooKeeper </h2><br>  <a href="https://zookeeper.apache.org/">Apache ZooKeeper</a> is unlikely to need a special presentation, but nonetheless: it is a key-value keystore (KV) written in Java.  It is characterized by a hierarchical namespace and is focused on application in distributed applications, where it acts as a centralized service for storing configurations and other service information. <br><br>  According to the authors of ZooKeeper, this project appeared (initially, by the way, inside Hadoop) as a response to repeated attempts of developers of distributed systems to create their own repositories, which invariably led to new challenges and difficulties in support.  And I must admit that in the ten years of its existence, ZooKeeper has managed to gain a foothold in the market, becoming an important component for such open source projects as Apache Drill, Apache Hadoop YARN, Apache HBase, Apache Kafka, Apache Solr, Mesos, Norbert.  <i>(By the way, there are examples of those who eventually abandoned ZooKeeper: Juju and <a href="http://www.rene-pickhardt.de/michael-hunger-talks-about-high-availability-of-neo4j-built-on-paxos-in-the-graphdevroom-fosdem/">Neo4j</a> .)</i> Of course, some developers of closed systems and applications that required distributed KV storage also chose ZooKeeper.  Finally, this solution has become popular in the world of microservices, where it is also used as a <a href="http://blog.arungupta.me/zookeeper-microservice-registration-discovery/">service discovery service</a> , although there <a href="https://tech.knewton.com/blog/2014/12/eureka-shouldnt-use-zookeeper-service-discovery/">is no problem without it</a> . <br><br><h2>  And here etcd? </h2><br>  Of course, Apache ZooKeeper is not the only solution in its niche.  There are, for example, <a href="https://www.consul.io/">Consul</a> , offering KV-storage and placing particular emphasis on the mentioned Service Discovery, as well as <a href="https://github.com/ha/doozerd">Doozer</a> , focused on high availability (to the detriment of scalability and performance), and the main ‚Äúcharacter‚Äù of this article - <a href="https://coreos.com/etcd">etcd</a> .  <i>(For those interested in the difference of these solutions, the articles ‚Äú <a href="https://www.consul.io/intro/vs/zookeeper.html">Consul vs. ZooKeeper, doozerd, etcd</a> ‚Äù according to HashiCorp, ‚Äú <a href="https://coreos.com/blog/performance-of-etcd.html">Exploring Performance of etcd, Zookeeper and Consul Consistent Key-value Datastores</a> ‚Äù according to CoreOS may be useful.)</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The etcd storage was created in CoreOS for critical data in distributed systems, written in the Go language and seeks to provide: a) simplicity (simple API, accessible through gRPC), b) security (automatic TLS), c) performance (the authors promise 10,000 operations records per second), d) reliability (thanks to the <a href="https://raft.github.io/">Raft</a> consensus algorithm).  All this, seasoned with the interests and enthusiasm of CoreOS, allowed the new solution to gain some weight: it suffices to mention that etcd became a <a href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/">permanent repository</a> of REST API objects in Kubernetes. <br><br>  The further move of CoreOS is not surprising: if many people in the world use ZooKeeper, and the company has an interest in promoting its competing product, then why not make the migration as simple as possible ... And since the data model and client protocol etcd differ from that used in ZooKeeper and will not change for the sake of this compatibility, the solution is obvious - release a layer that will redirect all application requests that are addressed to ZooKeeper, in the cluster etcd.  Fortunately, ‚Äúa rather expressive API in etcd v3 allowed to emulate the ZooKeeper data model on the client side using a normal proxy‚Äù.  Convenience for developers is that there is no need to modify applications at all: it is enough to replace the ZooKeeper installation with etcd and add a new proxy server in front of it - the same zetcd. <br><br><h2>  Basics of zetcd </h2><br>  Understand its device will help the <a href="https://coreos.com/blog/introducing-zetcd">project announcement</a> and small practical experiments.  So, zetcd (written in the Go language, as well as etcd) was created in order to receive application requests sent to ZooKeeper, and convert them into operations corresponding to the etcd data model and executed in this repository. <br><br><img src="https://habrastorage.org/web/58a/410/4a8/58a4104a807643eda05f8ecc44a6e542.png"><br><br>  To run zetcd, only the Go compiler is required.  Installing etcd and zetcd: <br><br><pre><code class="bash hljs">$ go get github.com/coreos/etcd/cmd/etcd $ go get github.com/coreos/zetcd/cmd/zetcd</code> </pre> <br>  <i><b>Note</b> : According to the experience of installations on different versions of Ubuntu, it is best (to install the latest versions of all applications from the CoreOS Git repositories) to have Go 1.8 installed, which for 16.04 can be taken from ppa: longsleep / golang-backports.</i> <br><br>  Run etcd (by default it will bind to localhost: 2379) and zetcd: <br><br><pre> <code class="bash hljs">$ etcd &amp; $ zetcd -zkaddr localhost:2181 -endpoints localhost:2379 &amp;</code> </pre><br>  Installing zkctl (CLI utility for simple operations in ZooKeeper) and test commands: <br><br><pre> <code class="bash hljs">$ go install github.com/coreos/zetcd/cmd/zkctl $ zkctl watch / &amp; $ zkctl create /abc <span class="hljs-string"><span class="hljs-string">"test"</span></span> $ zkctl get /abc 2017/05/23 21:57:44 Connected to 127.0.0.1:2181 2017/05/23 21:57:44 Authenticated: id=7587822333160445481, timeout=1000 [116 101 115 116] Stat: &amp;{Czxid:3 Mzxid:14 Ctime:1495550621626193 Mtime:1495551461984432 Version:1 Cversion:1 Aversion:0 EphemeralOwner:0 DataLength:4 NumChildren:1 Pzxid:7}</code> </pre><br>  Obviously, a new node was created in the root of the ZooKeeper tree ( <code>abc</code> ), with which the <code>test</code> string was associated (116,111,115,116 ‚Äî numbers of unicode characters confirming what happened).  But this is the terminology of ZooKeeper, and what happened in etcd? <br><br><h2>  Internal zetcd device </h2><br>  To answer this question, you need to better understand how zetcd transforms the ZooKeeper hierarchical data model into a format that is understandable to etcd.  The ZooKeeper tree structure fits into a flat KV-space in such a way that for each record KV-pairs are created with metadata, the keys of which are the full path that also contains the name of the parameter and the nesting level: <code>/zk/[param]/[depth]/[full path]</code> .  Thus, viewing the keys by directories in ZooKeeper ( <code>getChildren</code> ) corresponds to viewing the list of keys by interval in etcd ( <code>Range</code> ), and inside the etcd itself there is additional information that forms the complete ZNode view: <br><br><img src="https://habrastorage.org/web/a58/649/944/a58649944259451cb25f3b6f21ca062d.png"><br><br>  That is, for each key from ZooKeeper, metadata about its revision, version and access rights is stored.  They are simplified compared to the original ZNode due to the specifics of etcd (lack of directories in the tree per se, role-based authentication instead of an ACL, etc.), but fully describe the node.  For example: <br><br><ul><li>  <code>/zk/key/001/abc</code> - stores the value of the <code>/abc</code> key (the first level of nesting in the ZooKeeper tree); </li><li>  <code>/zk/mtime/002/abc/xyz</code> - modification time of the <code>/abc/xyz</code> key (second level of nesting). </li></ul><br>  You can check the physical organization of the data in action using the etcdctl console client: <br><br><pre> <code class="bash hljs">$ go get github.com/coreos/etcd/etcdctl $ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ETCDCTL_API=3 $ etcdctl get --prefix /zk /zk/acl/001/abc       -  ACL  PermsScheme ID   &gt;worldanyone /zk/count/001/abc /zk/ctime/001/abc ﬁÑ      /zk/cver/001/ /zk/cver/001/abc /zk/err-node 1 /zk/key/001/abc <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> /zk/mtime/001/abc ﬁÑ      /zk/ver/001/abc</code> </pre><br>  <i><b>Note</b> : if you want to repeat the last operation, to see with your own eyes how ZNode data is stored in etcd, then you need to collect zetcd with <code>-tags path_debug</code> (i.e. <code>go get -u -v -tags path_debug github.com/coreos/zetcd/cmd/zetcd</code> ), and you also need a version from the Git repository, which incorporates a fresh <a href="https://github.com/coreos/zetcd/pull/54">Pull Request # 54</a> , created as a result of my curiosity in <a href="https://github.com/coreos/zetcd/issues/52">Issue # 52</a> ).</i> <br><br><h2>  Performance zetcd </h2><br>  Considering the performance is not the first necessity, but an important component of success for zetcd, the developers took care of creating a simple benchmark utility - <a href="https://github.com/coreos/zetcd/tree/master/cmd/zkboom">zkboom</a> .  CoreOS compared ZooKeeper 3.4.10 and dev-branches etcd with writing and reading 128-byte KV-pairs, limiting the number of requests to 2500 per second and increasing the number of simultaneous clients.  All this was done on ‚Äútwo modern Linux machines connected by a gigabit switch;  one was running proxy and server software, and the other generated client requests. ‚Äù <br><br><img src="https://habrastorage.org/web/a6b/f13/c7e/a6bf13c7e1434d53b299cad31ecd85d9.png"><br><br>  As you can see, in the creation of keys, the delay in zetcd reaches ~ 2-3 times worse values ‚Äã‚Äãthan in ZooKeeper, and in reading - ~ 1.5 times.  This is not to say that these are grandiose results (rather, they are quite understandable, given the need to work with a lot of additional keys to emulate ZNode metadata), but you can‚Äôt call them very bad, given the specifics of the proxy server's purpose. <br><br>  <i>By the way, other utilities created for testing the performance of ZooKeeper itself should already work with a bunch of etcd and zetcd, which opens up a large field for independent experiments and conclusions.</i> <br><br><h2>  Conclusion </h2><br>  The first public release of zetcd - v0.0.1 - took place last week.  According to the authors, even though there is still room for improvements in the performance of zetcd, soon the product can become a ready replacement for ZooKeeper in various applications, which in addition to well-known projects include in-house development categories, the authors of which want to - or for reasons to leave ZooKeeper and make it a "little blood".  Finally, an interesting feature of this replacement appears in the context of the use of <a href="https://habrahabr.ru/company/flant/blog/326414/">etcd Operator for Kubernetes</a> , which adds automated updates, backups and other features to this ZooKeeper compatible repository. </div><p>Source: <a href="https://habr.com/ru/post/329224/">https://habr.com/ru/post/329224/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329214/index.html">Korean colleagues: understand and forgive</a></li>
<li><a href="../329216/index.html">The reverse side of recruitment: what HR technologies have changed for candidates</a></li>
<li><a href="../329218/index.html">Beyond the clouds: what is serverless and why do we misunderstand it?</a></li>
<li><a href="../329220/index.html">How to become a Data Science Specialist: results of an open seminar at ITMO University</a></li>
<li><a href="../329222/index.html">10 ways to achieve HighLoad and BigData on level ground</a></li>
<li><a href="../329226/index.html">Looking for dopamine to develop or rid ourselves of the routine</a></li>
<li><a href="../329228/index.html">Creating data models for QComboBox</a></li>
<li><a href="../329230/index.html">Library for visualizing sports seasons</a></li>
<li><a href="../329232/index.html">How cloud can help future technology</a></li>
<li><a href="../329234/index.html">8 skills required in the profession of Data Scientist</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>