<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing your autocompletions for Shell. Part 1: zsh</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="These articles (I decided that thematically it is better to break into two parts) describe some of the basics of creating auto-completion files for yo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing your autocompletions for Shell. Part 1: zsh</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/getpro/habr/post_images/1ff/ece/11b/1ffece11b63ae0c70703d4546a42e704.png"><br>  These articles (I decided that thematically it is better to break into two parts) describe some of the basics of creating auto-completion files for your own program. <br><ul><li>  <i>Part 1: zsh</i> </li><li>  <a href="http://habrahabr.ru/post/230425/">Part 2: bash</a> </li></ul><br><br><h5>  Preamble </h5><br>  In the process of developing one of your projects, there was a desire to add also auto-completion files (just don‚Äôt ask why).  Fortunately, I somehow took it upon myself to write such things, but then I was too lazy to read anything, and did not master it. <br><br><h5>  Introduction </h5><br>  There are several options for writing an autocomplete file for zsh.  In the case of this article, I will focus only on one of them, which provides great opportunities and does not require large expenditures (for example, working with regular expressions). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  Consider the example of my own application, part of the help for which looks like this: <br><br><pre><code class="bash hljs">proga [ -h | --<span class="hljs-built_in"><span class="hljs-built_in">help</span></span> ] [ -e ESSID | --essid ESSID ] [ - FILE | --config FILE ] [ -o PROFILE | --open PROFILE ] [ -t NUM | --tab NUM ] [ --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-opts OPTIONS ]</code> </pre> <br>  List of flags: <br><ul><li>  flags <code>-h</code> and <code>--help</code> do not require arguments; </li><li>  the <code>-e</code> and <code>--essid</code> require an argument as a string, without autocompletion; </li><li>  flags <code>-c</code> and <code>--config</code> require an argument as a string, a file with an arbitrary location; </li><li>  the <code>-o</code> and <code>--open</code> require an argument as a string, autocompletion on files from a specific directory; </li><li>  the <code>-t</code> and <code>--tab</code> require an argument as a string, autocompletion from the specified array; </li><li>  The <code>--set-opts</code> requires an argument as a string, auto-completion from the specified array, separated by commas; </li></ul><br><br><h5>  File structure </h5><br>  The header should indicate that it is an auto-completion file and for which applications it serves (as a string, if the file contains auto-completion for several commands): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#compdef proga</span></span></code> </pre><br>  Next comes a description of the flags, auxiliary functions and variables.  Note that the functions and variables that will be used for autocompletion <b>should return arrays</b> , not strings.  In my case, the scheme looks like this (all functions and variables in this chapter are intentionally left empty): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># variables _proga_arglist=() _proga_settings=() _proga_tabs=() _proga_profiles() {}</span></span></code> </pre><br>  Then come the main functions that will be called for autocompletion for a particular command.  In my case, the command is one, and the function is one: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># work block _proga() {}</span></span></code> </pre><br>  Then, <b>without allocating to a separate function, there</b> is a slight shamanism associated with the correlation of the application, which was declared in the first line, with the function in the script body: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$service</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> proga) _proga <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$@</span></span></span><span class="hljs-string">"</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 0 ;; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span></code> </pre><br><br><h5>  Flags </h5><br>  As I said in the introduction, there are several ways to create such files.  In particular, they differ in the declaration of flags and their further processing.  In this case, I will use the <code>_arguments</code> command, which requires a specific variable format.  It looks like this: <br><br><pre> <code class="bash hljs">[]::</code> </pre><br>  The last two fields are optional and, as you will see below, are not needed at all in some places.  If you envisage two flags (short and long format) for one action, then the format is slightly more complicated: <br><br><pre> <code class="bash hljs">{(_2)_1,(_1)_2}[]::</code> </pre><br>  I note that if you want to autocomplete for two types of flags, but some flags do not have a second entry, then you need to duplicate it this way: <br><br><pre> <code class="bash hljs">{,}[]::</code> </pre><br>  <code></code> - the message to be shown, <code></code> - the action to be performed after this flag.  In the case of this tutorial, <code></code> will look like <code>-&gt;</code> . <br><br>  So, according to our requirements, this declaration of arguments is obtained: <br><br><pre> <code class="bash hljs">_proga_arglist=( {<span class="hljs-string"><span class="hljs-string">'(--help)-h'</span></span>,<span class="hljs-string"><span class="hljs-string">'(-h)--help'</span></span>}<span class="hljs-string"><span class="hljs-string">'[show help and exit]'</span></span> {<span class="hljs-string"><span class="hljs-string">'(--essid)-e'</span></span>,<span class="hljs-string"><span class="hljs-string">'(-e)--essid'</span></span>}<span class="hljs-string"><span class="hljs-string">'[select ESSID]:type ESSID:-&gt;essid'</span></span> {<span class="hljs-string"><span class="hljs-string">'(--config)-c'</span></span>,<span class="hljs-string"><span class="hljs-string">'(-c)--config'</span></span>}<span class="hljs-string"><span class="hljs-string">'[read configuration from this file]:select file:-&gt;files'</span></span> {<span class="hljs-string"><span class="hljs-string">'(--open)-o'</span></span>,<span class="hljs-string"><span class="hljs-string">'(-o)--open'</span></span>}<span class="hljs-string"><span class="hljs-string">'[open profile]:select profile:-&gt;profiles'</span></span> {<span class="hljs-string"><span class="hljs-string">'(--tab)-t'</span></span>,<span class="hljs-string"><span class="hljs-string">'(-t)--tab'</span></span>}<span class="hljs-string"><span class="hljs-string">'[open a tab with specified number]:select tab:-&gt;tab'</span></span> {<span class="hljs-string"><span class="hljs-string">'--set-opts'</span></span>,<span class="hljs-string"><span class="hljs-string">'--set-opts'</span></span>}<span class="hljs-string"><span class="hljs-string">'[set options for this run, comma separated]:comma separated:-&gt;settings'</span></span> )</code> </pre><br><br><h5>  Variable arrays </h5><br>  In our case there are two static arrays (they will not change either now or in five minutes) (the arrays are intentionally reduced): <br><br><pre> <code class="bash hljs">_proga_settings=( <span class="hljs-string"><span class="hljs-string">'CTRL_DIR'</span></span> <span class="hljs-string"><span class="hljs-string">'CTRL_GROUP'</span></span> ) _proga_tabs=( <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-string"><span class="hljs-string">'2'</span></span> )</code> </pre><br>  And there is a dynamic array that should be generated each time.  It contains, in this case, files in the specified directory (this can be done using zsh, by the way): <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_proga_profiles</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span> $(find /some/path -maxdepth 1 -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -<span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> <span class="hljs-string"><span class="hljs-string">"%f\n"</span></span>) }</code> </pre><br><br><h4>  Body function </h4><br>  Remember, there was something higher about the condition?  It is stored in the <code>$state</code> variable, and a check is made in the function body for what it is equal to in order to select the appropriate actions.  At the beginning also need not forget to call <code>_arguments</code> with our flags. <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_proga</span></span></span></span>() { _arguments <span class="hljs-variable"><span class="hljs-variable">$_proga_gui_arglist</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$state</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> essid) <span class="hljs-comment"><span class="hljs-comment">#   ,    ;; files) #     _files ;; profiles) #    #    #     _values 'profiles' $(_proga_profiles) ;; tab) #    _values 'tab' $_proga_tabs ;; settings) #    #  -s      _values -s ',' 'settings' $_proga_settings ;; esac }</span></span></code> </pre><br><br><h4>  Conclusion </h4><br>  The file is stored in the <code>/usr/share/zsh/site-functions/</code> directory with an arbitrary, in general, name with the prefix <code>_</code> .  The example file can be fully found <a href="https://raw.githubusercontent.com/arcan1s/netctl-gui/master/sources/gui/zsh-completions">in my repository</a> (do not count for advertising, I specifically raised all the names). <br><br>  Additional information can be found in the <a href="https://github.com/zsh-users/zsh-completions">zsh-completions</a> repository.  For example, there is such a <a href="">How-To</a> .  And there are many examples there. </div><p>Source: <a href="https://habr.com/ru/post/230421/">https://habr.com/ru/post/230421/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230407/index.html">London is now available in 3D on Google Maps</a></li>
<li><a href="../230409/index.html">The United Arab Emirates announced the creation of its own space agency and a flight to Mars in 2021</a></li>
<li><a href="../230413/index.html">Skip Lists: A Probabilistic Alternative to Balanced Trees</a></li>
<li><a href="../230415/index.html">Hackathon FabLab: two days and consequences. How it was</a></li>
<li><a href="../230417/index.html">Using the principles of gestalt psychology to increase the conversion of sites. Part 3: Cost Benefit Analysis</a></li>
<li><a href="../230425/index.html">Writing your autocompletions for Shell. Part 2: bash</a></li>
<li><a href="../230427/index.html">Indie games are like indie games only.</a></li>
<li><a href="../230431/index.html">Using elements as background images with -moz-element</a></li>
<li><a href="../230435/index.html">About QML and the new Yandex.Disk REST API</a></li>
<li><a href="../230439/index.html">How to create clear logical (L3) network diagrams</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>