<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Let's fix NAs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quite often there are incomplete data sets in which some variables are not defined. In the R language, the contents of such variables are specified as...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Let's fix NAs</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/34c/5c0/b05/34c5c0b05b5e8e31bb1578a141c30b4e.jpg">  Quite often there are incomplete data sets in which some variables are not defined.  In the R language, the contents of such variables are specified as ‚ÄúNot Available‚Äù ‚Äîor abbreviated as NA.  Accordingly, the question arises as to how to deal with uncertain values: should they be ignored or corrected in any way? <br><a name="habracut"></a><br>  Let us examine some aspects of this problem using the example of a practically classic data set taken from the <a href="http://www.kaggle.com/c/titanic-gettingStarted/data">Titanic: Machine Learning from Disaster</a> competition.  The necessary data can be downloaded manually from the Kaggle website or using the same R tools (running under Linux): <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre><code class="hljs pgsql">download.file("https://bitbucket.org/kailexx/fixnas/raw/ae65f7939974e709f10aa50c96c368120487a7f2/train.csv", destfile="train.csv", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span>= "wget") train &lt;- <span class="hljs-keyword"><span class="hljs-keyword">read</span></span>.csv("train.csv", na.strings = c(NA, ""))</code> </pre> <br></div></div><br>  Let's see what the contents of the file are: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs ruby">str(train) <span class="hljs-string"><span class="hljs-string">'data.frame'</span></span>: <span class="hljs-number"><span class="hljs-number">891</span></span> obs. of <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-symbol"><span class="hljs-symbol">variables:</span></span> $ <span class="hljs-symbol"><span class="hljs-symbol">PassengerId:</span></span> int <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> ... $ Survived : int <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ... $ Pclass : int <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ... $ Name : Factor w/ <span class="hljs-number"><span class="hljs-number">891</span></span> levels <span class="hljs-string"><span class="hljs-string">"Abbing, Mr. Anthony"</span></span>,..: <span class="hljs-number"><span class="hljs-number">109</span></span> <span class="hljs-number"><span class="hljs-number">191</span></span> <span class="hljs-number"><span class="hljs-number">358</span></span> <span class="hljs-number"><span class="hljs-number">277</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">559</span></span> <span class="hljs-number"><span class="hljs-number">520</span></span> <span class="hljs-number"><span class="hljs-number">629</span></span> <span class="hljs-number"><span class="hljs-number">416</span></span> <span class="hljs-number"><span class="hljs-number">581</span></span> ... $ Sex : Factor w/ <span class="hljs-number"><span class="hljs-number">2</span></span> levels <span class="hljs-string"><span class="hljs-string">"female"</span></span>,<span class="hljs-string"><span class="hljs-string">"male"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ... $ Age : num <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> NA <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> ... $ SibSp : int <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ... $ Parch : int <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ... $ Ticket : Factor w/ <span class="hljs-number"><span class="hljs-number">681</span></span> levels <span class="hljs-string"><span class="hljs-string">"110152"</span></span>,<span class="hljs-string"><span class="hljs-string">"110413"</span></span>,..: <span class="hljs-number"><span class="hljs-number">525</span></span> <span class="hljs-number"><span class="hljs-number">596</span></span> <span class="hljs-number"><span class="hljs-number">662</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">473</span></span> <span class="hljs-number"><span class="hljs-number">276</span></span> <span class="hljs-number"><span class="hljs-number">86</span></span> <span class="hljs-number"><span class="hljs-number">396</span></span> <span class="hljs-number"><span class="hljs-number">345</span></span> <span class="hljs-number"><span class="hljs-number">133</span></span> ... $ Fare : num <span class="hljs-number"><span class="hljs-number">7.25</span></span> <span class="hljs-number"><span class="hljs-number">71.28</span></span> <span class="hljs-number"><span class="hljs-number">7.92</span></span> <span class="hljs-number"><span class="hljs-number">53.1</span></span> <span class="hljs-number"><span class="hljs-number">8.05</span></span> ... $ Cabin : Factor w/ <span class="hljs-number"><span class="hljs-number">147</span></span> levels <span class="hljs-string"><span class="hljs-string">"A10"</span></span>,<span class="hljs-string"><span class="hljs-string">"A14"</span></span>,<span class="hljs-string"><span class="hljs-string">"A16"</span></span>,..: NA <span class="hljs-number"><span class="hljs-number">82</span></span> NA <span class="hljs-number"><span class="hljs-number">56</span></span> NA NA <span class="hljs-number"><span class="hljs-number">130</span></span> NA NA NA ... $ Embarked : Factor w/ <span class="hljs-number"><span class="hljs-number">3</span></span> levels <span class="hljs-string"><span class="hljs-string">"C"</span></span>,<span class="hljs-string"><span class="hljs-string">"Q"</span></span>,<span class="hljs-string"><span class="hljs-string">"S"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ... sum(is.na(train)) [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-number"><span class="hljs-number">866</span></span></code> </pre><br></div></div><br>  In the set there are 891 lines and as many as 866 undefined variables, which is clearly shown by the following graph: <br><img src="https://habrastorage.org/getpro/habr/post_images/ce6/aab/70c/ce6aab70c9f03b752a3841e838f85ddc.png"><br><br><h4>  Two easy solutions </h4><br>  The first solution is for the lazy: there‚Äôs practically nothing to do, since  many functions in R have the argument na.rm, setting its value to TRUE, we will make R just delete NA before doing something with this.  Other functions have the na.action parameter, which can have the following values: <br>  na.fail - return an error if the data contains NA. <br>  na.omit, na.exclude - delete all variables with the value NA. <br>  na.pass - leave the data as it is. <br>  Actually, if we need to calculate the median age of the passengers of the Titanic, then we can do this: <br><pre> <code class="hljs perl">median(train$Age, na.rm=T) [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-number"><span class="hljs-number">28</span></span></code> </pre><br>  The second solution, in general, follows from the first - to clear the data of all uncertain values ‚Äã‚Äãin advance and not think about them any more: <br><pre> <code class="hljs pgsql">train.nopain &lt;- na.omit(train) nrow(train.nopain) [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-number"><span class="hljs-number">183</span></span> sum(<span class="hljs-keyword"><span class="hljs-keyword">is</span></span>.na(train.nopain)) [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-number"><span class="hljs-number">0</span></span> median(train.nopain$Age) [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-number"><span class="hljs-number">36</span></span></code> </pre><br>  As you can see, 708 lines have disappeared with NA.  It is not scary if we are not particularly interested in the result, but it is worth considering other options. <br><br><h4>  We use the means at hand </h4><br>  An acceptable option is to replace the NA with some preselected value;  usually it is mean or median.  To do this, we write a simple function: <br><pre> <code class="hljs php">simpleFix &lt;- <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, imputeFn=mean)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(ifelse(is.na(x), imputeFn(x, na.rm=<span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>), x)) } train.median &lt;- train nas.idx &lt;- which(is.na(train.median$Age)) train.median$Age &lt;- simpleFix(train.median$Age, median)</code> </pre><br><pre> <code class="hljs perl">head(train.median$Age[nas.idx]) [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span></code> </pre><br>  All undefined Age values ‚Äã‚Äãare now replaced by the median.  Sometimes it makes sense to calculate the mean or median with some condition.  For example, if we adjust the NA of the Age field of a male passenger who occupies a first-class cabin, then the average should be calculated taking this circumstance into account: <br><pre> <code class="hljs php">fixAge &lt;- <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tdf, imputeFn=mean)</span></span></span><span class="hljs-function"> </span></span>{ tdf$Age[is.na(tdf$Age)] &lt;- sapply(which(is.na(tdf$Age)), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imputeFn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tdf$Age[tdf$Pclass == tdf$Pclass[i] &amp; tdf$Sex == tdf$Sex[i]], na.rm=T)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tdf)</span></span></span><span class="hljs-function"> } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">idx</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">which</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(is.na</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(train$Age)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">train</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cond</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fixAge</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(train, median)</span></span></span></span></code> </pre><br><pre> <code class="hljs perl">head(train.cond$Age[nas.idx]) [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-number"><span class="hljs-number">25.0</span></span> <span class="hljs-number"><span class="hljs-number">30.0</span></span> <span class="hljs-number"><span class="hljs-number">21.5</span></span> <span class="hljs-number"><span class="hljs-number">25.0</span></span> <span class="hljs-number"><span class="hljs-number">21.5</span></span> <span class="hljs-number"><span class="hljs-number">25.0</span></span></code> </pre><br>  It is worth noting that replacing uncertain values ‚Äã‚Äãwith the mean or median leads to a decrease in the variance of the data.  This method can be slightly improved (and complicated) by using <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D0%25BD%25D0%25B3%25D1%2583%25D0%25BB%25D1%258F%25D1%2580%25D0%25BD%25D0%25BE%25D0%25B5_%25D1%2580%25D0%25B0%25D0%25B7%25D0%25BB%25D0%25BE%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5">singular value decomposition (SVD)</a> and <a href="https://inst.eecs.berkeley.edu/~ee127a/book/login/l_svd_low_rank.html">approximation by a matrix of lower rank</a> .  In this case, the undefined values ‚Äã‚Äãare first replaced by the average, then the original matrix is ‚Äã‚Äãapproximated by a matrix of lower rank, and the undefined values ‚Äã‚Äãthat have been replaced by the average are replaced by the values ‚Äã‚Äãtaken from the decomposition.  The procedure of approximation is repeated several times;  for this we need to pre-set the approximation rank and the number of steps.  Consider a somewhat <i>spherical</i> example with a 10x10 matrix of random numbers with 15 undefined values. <br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">k</span></span> &lt;- <span class="hljs-number"><span class="hljs-number">6</span></span> #    n.iters &lt;- <span class="hljs-number"><span class="hljs-number">10</span></span> nrows &lt;- <span class="hljs-number"><span class="hljs-number">10</span></span> set.seed(<span class="hljs-number"><span class="hljs-number">100500</span></span>) train.mat &lt;- runif(nrows * nrows) train.mat[sample(<span class="hljs-number"><span class="hljs-number">1</span></span>:length(train.mat), <span class="hljs-number"><span class="hljs-number">15</span></span>)] &lt;- <span class="hljs-type"><span class="hljs-type">NA</span></span> train.mat &lt;- matrix(train.mat, nrows) #     <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-type"><span class="hljs-type">NA</span></span>  nas.idx &lt;- which(is.na(train.mat)) train.svd &lt;- train.mat train.svd &lt;- apply(train.svd, <span class="hljs-number"><span class="hljs-number">2</span></span>, simpleFix) #  <span class="hljs-type"><span class="hljs-type">NA</span></span>     for (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:n.iters){ s &lt;- svd(train.svd, k, k) train.svd[nas.idx] &lt;- (s$u %*% diag(s$d[<span class="hljs-number"><span class="hljs-number">1</span></span>:k], nrow=k, ncol=k) %*% t(s$v))[nas.idx] }</code> </pre><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">head</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">train</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.svd</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[nas.idx]</span></span>) <span class="hljs-selector-attr"><span class="hljs-selector-attr">[1]</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.3020229</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.4475467</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.3114711</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.7161445</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.4379184</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.6734933</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  What to do with non-numeric values </h4><br>  If you carefully examine the <code>Embarked</code> field, then there are 2 undefined values.  One of the processing options is based on <a href="https://en.wikipedia.org/wiki/Sampling_%2528statistics%2529">sampling</a> : <br><pre> <code class="hljs matlab">fixSample &lt;- <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[is.na(x)]</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, sum(is.na(x)</span></span></span><span class="hljs-function">), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replace</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function"> } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(111)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">idx</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">which</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(is.na(train.cond$Embarked)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">train</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cond</span></span></span><span class="hljs-function">$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Embarked</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fixSample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(train.cond$Embarked)</span></span></span></span></code> </pre><br><pre> <code class="hljs pgsql">train.cond$Embarked[nas.idx] [<span class="hljs-number"><span class="hljs-number">1</span></span>] SC Levels: CQS sum(<span class="hljs-keyword"><span class="hljs-keyword">is</span></span>.na(train.cond$Embarked)) [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  Actually, sampling is a fairly common method, and is very popular with modern statisticians. <br><br><h4>  More universal approach </h4><br>  R has developed tools for building various models - from simple linear regression to the 3B technique (bagging, boosting, blending).  Let's write a function that uses RandomForest to calculate undefined variables;  we also remove some PassengerId, Name, Ticket, Cabin variables (I, frankly, have not found a worthy use for them, and there are so many undefined values ‚Äã‚Äãin the Cabin field that the ‚Äúprecomputation‚Äù makes no sense).  If the randomForest package is not installed, then the <code>install.packages("randomForest")</code> R command will install it from CRAN. <br><pre> <code class="hljs php">fixNA &lt;- <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(y, x)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(randomForest) fixer &lt;- randomForest(x[!is.na(y), ], y[!is.na(y)]) y[is.na(y)] &lt;- predict(fixer, x[is.na(y), ]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(y) } set.seed(<span class="hljs-number"><span class="hljs-number">111</span></span>) train.rf &lt;- subset(train, select=-c(PassengerId, Name, Ticket, Cabin)) ageNA.idx &lt;- which(is.na(train.rf$Age)) embNA.idx &lt;- which(is.na(train.rf$Embarked)) sum(is.na(train.rf)) train.rf$Age &lt;- fixNA(train.rf$Age, cbind(train.rf$Pclass, train.rf$Sex, train.rf$Parch)) train.rf$Embarked &lt;- fixNA(train.rf$Embarked, cbind(train.rf$Pclass, train.rf$Sex, train.rf$Parch))</code> </pre><br><pre> <code class="hljs erlang"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(train.rf$Age[ageNA.idx])</span></span></span><span class="hljs-function"> [1] 29.65873 31.67546 26.64918 29.65873 26.64918 29.65873 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(train.rf$Embarked[embNA.idx])</span></span></span><span class="hljs-function"> [1] SS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(is.na(train.rf))</span></span></span><span class="hljs-function"> [1] 0</span></span></code> </pre><br>  In this form, the data is almost ready for a more detailed analysis. <br><br><h4>  Conclusion </h4><br>  There are many approaches and methods for working with incomplete data - the problem is far from trivial.  In CRAN, in particular, there are specialized packages for handling NA values ‚Äã‚Äã(for example, <code>Amelia</code> , <code>imputation</code> ), and packages that among other things allow you to manipulate NA ( <code>impute</code> functions in the <code>Hmisc</code> package, <code>rfImpute</code> in <code>randomForest</code> ).  Separate consideration is required by the method based on the <a href="http://www.r-bloggers.com/imputing-missing-data-with-expectation-maximization/">Expectation Maximization</a> algorithm. <br><br><h4>  References and literature </h4><br>  1. <a href="http://pandas.pydata.org/pandas-docs/dev/missing_data.html">Working with missing data</a> <br>  2. <a href="http://www.r-bloggers.com/data-imputation-i/">Data Imputation</a> <br>  3. Missing Data &amp; Small-Area Estimation: Modern Analytical Equipment for the Survey Statistician.  Nicholas T. Longford. </div><p>Source: <a href="https://habr.com/ru/post/207750/">https://habr.com/ru/post/207750/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../207740/index.html">Bresenham algorithm in real-time applications - part two</a></li>
<li><a href="../207742/index.html">First text message transmission using odor</a></li>
<li><a href="../207744/index.html">HD video from a private satellite SkySat</a></li>
<li><a href="../207746/index.html">0day * vulnerability to the New Year: ICQ, Ebay, Forbes, PayPal and AVG</a></li>
<li><a href="../207748/index.html">FaceRig - character animation in real time</a></li>
<li><a href="../207752/index.html">The digest of interesting materials from the world of web development and IT for the last week No. 89 (December 22 - 28, 2013)</a></li>
<li><a href="../207754/index.html">Microsoft's long arithmetic</a></li>
<li><a href="../207756/index.html">Elections OS</a></li>
<li><a href="../207758/index.html">NSA does not cope with traffic volumes</a></li>
<li><a href="../207760/index.html">How freshman Cauchy's definition has reduced</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>