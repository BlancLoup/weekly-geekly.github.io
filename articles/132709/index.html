<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development add-on for MODx Revolution. Part 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the translation of the third part of the lesson . As I wrote in the previous article , there is no sense to translate the second part, because...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development add-on for MODx Revolution. Part 3</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/807949ed/025308c2/34239fc0/ebea32c9.png"><br><br>  This is the translation of the <a href="http://rtfm.modx.com/display/revolution20/Developing%2Ban%2BExtra%2Bin%2BMODX%2BRevolution%252C%2BPart%2BIII">third part of the lesson</a> .  As I wrote in the <a href="http://habrahabr.ru/blogs/modx/127722/">previous article</a> , there is no sense to translate the second part, because  There is already enough information in Russian to create a component page.  So I jumped to the third. <br><br>  In this lesson you will learn how to pack an add-on into a <a href="http://rtfm.modx.com/display/revolution20/Transport%2BPackages">transport package</a> , which can then be easily installed through Package Management.  We will pack everything that relates to the addition developed by us: a snippet;  files from core / components / and assets / components /;  actions;  menu item and namespace of our CMP (component pages);  default values ‚Äã‚Äãfor snippet with internationalization support (i18n).  And also add a resolver that will create user tables in the database. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Reference: <br>  For packing simple add-ons, you can use <a href="http://rtfm.modx.com/display/ADDON/PackMan">PackMan</a> .  But in this case, we want to do it on our own and fully understand what the transport package is. <br><br><h4>  Setting the build directory </h4><br><br>  At the end of the lesson, the _build directory will look like this: <br><br><img src="https://habrastorage.org/storage1/d141559a/3cf204b4/cba496be/fddaa1b6.png"><br><br>  We are already familiar with the <b>build.config.php</b> and <b>build.schema.php files</b> from the first part of the tutorial, but for now let's just look at the other parts: <br><br>  <b>data</b> - Here we are going to put all our scripts to pack the package data. <br>  <b>resolvers</b> - The folder contains <a href="http://rtfm.modx.com/display/revolution20/Transport%2BPackages">resolvers</a> for the transport packet. <br>  <b>build.transport.php</b> - This is the main wrapper script that will need to be run to create the package. <br>  <b>setup.options.php</b> - Installer settings.  A brief look at what is needed later. <br><br><h4>  Creating a wrapper script </h4><br><br>  Create a file <b>/www/doodles/_build/build.transport.php</b> with the following contents: <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $tstart = explode(<span class="hljs-string"><span class="hljs-string">' '</span></span>, microtime()); $tstart = $tstart[<span class="hljs-number"><span class="hljs-number">1</span></span>] + $tstart[<span class="hljs-number"><span class="hljs-number">0</span></span>]; set_time_limit(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> define(<span class="hljs-string"><span class="hljs-string">'PKG_NAME'</span></span>,<span class="hljs-string"><span class="hljs-string">'Doodles'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'PKG_NAME_LOWER'</span></span>,<span class="hljs-string"><span class="hljs-string">'doodles'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'PKG_VERSION'</span></span>,<span class="hljs-string"><span class="hljs-string">'1.0'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'PKG_RELEASE'</span></span>,<span class="hljs-string"><span class="hljs-string">'rc1'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> $root = dirname(dirname(<span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span>)).<span class="hljs-string"><span class="hljs-string">'/'</span></span>; $sources = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'root'</span></span> =&gt; $root, <span class="hljs-string"><span class="hljs-string">'build'</span></span> =&gt; $root . <span class="hljs-string"><span class="hljs-string">'_build/'</span></span>, <span class="hljs-string"><span class="hljs-string">'data'</span></span> =&gt; $root . <span class="hljs-string"><span class="hljs-string">'_build/data/'</span></span>, <span class="hljs-string"><span class="hljs-string">'resolvers'</span></span> =&gt; $root . <span class="hljs-string"><span class="hljs-string">'_build/resolvers/'</span></span>, <span class="hljs-string"><span class="hljs-string">'chunks'</span></span> =&gt; $root.<span class="hljs-string"><span class="hljs-string">'core/components/'</span></span>.PKG_NAME_LOWER.<span class="hljs-string"><span class="hljs-string">'/chunks/'</span></span>, <span class="hljs-string"><span class="hljs-string">'lexicon'</span></span> =&gt; $root . <span class="hljs-string"><span class="hljs-string">'core/components/'</span></span>.PKG_NAME_LOWER.<span class="hljs-string"><span class="hljs-string">'/lexicon/'</span></span>, <span class="hljs-string"><span class="hljs-string">'docs'</span></span> =&gt; $root.<span class="hljs-string"><span class="hljs-string">'core/components/'</span></span>.PKG_NAME_LOWER.<span class="hljs-string"><span class="hljs-string">'/docs/'</span></span>, <span class="hljs-string"><span class="hljs-string">'elements'</span></span> =&gt; $root.<span class="hljs-string"><span class="hljs-string">'core/components/'</span></span>.PKG_NAME_LOWER.<span class="hljs-string"><span class="hljs-string">'/elements/'</span></span>, <span class="hljs-string"><span class="hljs-string">'source_assets'</span></span> =&gt; $root.<span class="hljs-string"><span class="hljs-string">'assets/components/'</span></span>.PKG_NAME_LOWER, <span class="hljs-string"><span class="hljs-string">'source_core'</span></span> =&gt; $root.<span class="hljs-string"><span class="hljs-string">'core/components/'</span></span>.PKG_NAME_LOWER, ); <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>($root); <span class="hljs-comment"><span class="hljs-comment">/* override with your own defines here (see build.config.sample.php) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> $sources[<span class="hljs-string"><span class="hljs-string">'build'</span></span>] . <span class="hljs-string"><span class="hljs-string">'build.config.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> MODX_CORE_PATH . <span class="hljs-string"><span class="hljs-string">'model/modx/modx.class.php'</span></span>; $modx= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> modX(); $modx-&gt;initialize(<span class="hljs-string"><span class="hljs-string">'mgr'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;pre&gt;'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* used for nice formatting of log messages */</span></span> $modx-&gt;setLogLevel(modX::LOG_LEVEL_INFO); $modx-&gt;setLogTarget(<span class="hljs-string"><span class="hljs-string">'ECHO'</span></span>); $modx-&gt;loadClass(<span class="hljs-string"><span class="hljs-string">'transport.modPackageBuilder'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> modPackageBuilder($modx); $builder-&gt;createPackage(PKG_NAME_LOWER,PKG_VERSION,PKG_RELEASE); $builder-&gt;registerNamespace(PKG_NAME_LOWER,<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>,<span class="hljs-string"><span class="hljs-string">'{core_path}components/'</span></span>.PKG_NAME_LOWER.<span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* zip up package */</span></span> $modx-&gt;log(modX::LOG_LEVEL_INFO,<span class="hljs-string"><span class="hljs-string">'Packing up transport package zip...'</span></span>); $builder-&gt;pack(); $tend= explode(<span class="hljs-string"><span class="hljs-string">" "</span></span>, microtime()); $tend= $tend[<span class="hljs-number"><span class="hljs-number">1</span></span>] + $tend[<span class="hljs-number"><span class="hljs-number">0</span></span>]; $totalTime= sprintf(<span class="hljs-string"><span class="hljs-string">"%2.4f s"</span></span>,($tend - $tstart)); $modx-&gt;log(modX::LOG_LEVEL_INFO,<span class="hljs-string"><span class="hljs-string">"\n&lt;br /&gt;Package Built.&lt;br /&gt;\nExecution time: {$totalTime}\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> ();</code> </pre> <br><br>  There are quite a lot of things, but note that this is all that is needed to pack our namespace and create the transport package file ‚Äúdoodles-1.0-rc1.zip‚Äù (only the base).  We will analyze in detail. <br><br><pre> <code class="php hljs">$tstart = explode(<span class="hljs-string"><span class="hljs-string">' '</span></span>, microtime()); $tstart = $tstart[<span class="hljs-number"><span class="hljs-number">1</span></span>] + $tstart[<span class="hljs-number"><span class="hljs-number">0</span></span>]; set_time_limit(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> define(<span class="hljs-string"><span class="hljs-string">'PKG_NAME'</span></span>,<span class="hljs-string"><span class="hljs-string">'Doodles'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'PKG_NAME_LOWER'</span></span>,<span class="hljs-string"><span class="hljs-string">'doodles'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'PKG_VERSION'</span></span>,<span class="hljs-string"><span class="hljs-string">'1.0'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'PKG_RELEASE'</span></span>,<span class="hljs-string"><span class="hljs-string">'rc1'</span></span>);</code> </pre> <br><br>  First, we are going to get the start time of the assembly, so that at the end it will take how much time it took to assemble.  It is not necessary at all, just useful information.  Then we specify the name, version and release type.  Further: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> $root = dirname(dirname(<span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span>)).<span class="hljs-string"><span class="hljs-string">'/'</span></span>; $sources = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'root'</span></span> =&gt; $root, <span class="hljs-string"><span class="hljs-string">'build'</span></span> =&gt; $root . <span class="hljs-string"><span class="hljs-string">'_build/'</span></span>, <span class="hljs-string"><span class="hljs-string">'data'</span></span> =&gt; $root . <span class="hljs-string"><span class="hljs-string">'_build/data/'</span></span>, <span class="hljs-string"><span class="hljs-string">'resolvers'</span></span> =&gt; $root . <span class="hljs-string"><span class="hljs-string">'_build/resolvers/'</span></span>, <span class="hljs-string"><span class="hljs-string">'chunks'</span></span> =&gt; $root.<span class="hljs-string"><span class="hljs-string">'core/components/'</span></span>.PKG_NAME_LOWER.<span class="hljs-string"><span class="hljs-string">'/chunks/'</span></span>, <span class="hljs-string"><span class="hljs-string">'lexicon'</span></span> =&gt; $root . <span class="hljs-string"><span class="hljs-string">'core/components/'</span></span>.PKG_NAME_LOWER.<span class="hljs-string"><span class="hljs-string">'/lexicon/'</span></span>, <span class="hljs-string"><span class="hljs-string">'docs'</span></span> =&gt; $root.<span class="hljs-string"><span class="hljs-string">'core/components/'</span></span>.PKG_NAME_LOWER.<span class="hljs-string"><span class="hljs-string">'/docs/'</span></span>, <span class="hljs-string"><span class="hljs-string">'elements'</span></span> =&gt; $root.<span class="hljs-string"><span class="hljs-string">'core/components/'</span></span>.PKG_NAME_LOWER.<span class="hljs-string"><span class="hljs-string">'/elements/'</span></span>, <span class="hljs-string"><span class="hljs-string">'source_assets'</span></span> =&gt; $root.<span class="hljs-string"><span class="hljs-string">'assets/components/'</span></span>.PKG_NAME_LOWER, <span class="hljs-string"><span class="hljs-string">'source_core'</span></span> =&gt; $root.<span class="hljs-string"><span class="hljs-string">'core/components/'</span></span>.PKG_NAME_LOWER, ); <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>($root); <span class="hljs-comment"><span class="hljs-comment">/* override with your own defines here (see build.config.sample.php) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> $sources[<span class="hljs-string"><span class="hljs-string">'build'</span></span>] . <span class="hljs-string"><span class="hljs-string">'build.config.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> MODX_CORE_PATH . <span class="hljs-string"><span class="hljs-string">'model/modx/modx.class.php'</span></span>;</code> </pre> <br><br>  Here we define ways where to find all parts of our package for packaging. <br><br>  Finally, we connected the <b>build.config.php</b> file and the MODx class.  Now it's time to load the MODx object: <br><br><pre> <code class="php hljs">$modx = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> modX(); $modx-&gt;initialize(<span class="hljs-string"><span class="hljs-string">'mgr'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;pre&gt;'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* used for nice formatting of log messages */</span></span> $modx-&gt;setLogLevel(modX::LOG_LEVEL_INFO); $modx-&gt;setLogTarget(<span class="hljs-string"><span class="hljs-string">'ECHO'</span></span>); $modx-&gt;loadClass(<span class="hljs-string"><span class="hljs-string">'transport.modPackageBuilder'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> modPackageBuilder($modx); $builder-&gt;createPackage(PKG_NAME_LOWER,PKG_VERSION,PKG_RELEASE); $builder-&gt;registerNamespace(PKG_NAME_LOWER,<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>,<span class="hljs-string"><span class="hljs-string">'{core_path}components/'</span></span>.PKG_NAME_LOWER.<span class="hljs-string"><span class="hljs-string">'/'</span></span>);</code> </pre><br><br>  Here we create a modX object and initialize the context ‚Äúmgr‚Äù.  Next, we ask MODX to be more verbose in his error messages while running our script.  Please display messages on the screen. <br><br>  Then we load the ‚ÄúmodPackageBuilder‚Äù class and get two useful methods createPackage and registerNamespace. <br><br><pre> <code class="hljs php">$modx-&gt;createPackage(key,version,release)</code> </pre> <br><br>  Here we give the name of our package (it should be in lower case and should not contain a period or hyphen), version and release type.  Now modPackageBuilder will automatically pack our namespace: <br><br><pre> <code class="hljs php">$builder-&gt;registerNamespace(namespace_name,autoincludes,packageNamespace,namespacePath)</code> </pre> <br><br>  The first parameter is the namespace name ("doodles" in our case).  The second is an array of classes associated with our namespace (we don‚Äôt need it, so we set it to false).  By the third parameter, we say that we want to pack the namespace into a package (set to true).  And the third parameter is the path to our namespace.  This last parameter is key.  Pay attention to the placeholder "{core_path}", it will be replaced with the actual path during the package installation, which will make the package more flexible.  No need to point the way hard. <br><br>  And here are the last few lines of our packer: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/* zip up package */</span></span> $modx-&gt;log(modX::LOG_LEVEL_INFO,<span class="hljs-string"><span class="hljs-string">'Packing up transport package zip...'</span></span>); $builder-&gt;pack(); $tend= explode(<span class="hljs-string"><span class="hljs-string">" "</span></span>, microtime()); $tend= $tend[<span class="hljs-number"><span class="hljs-number">1</span></span>] + $tend[<span class="hljs-number"><span class="hljs-number">0</span></span>]; $totalTime= sprintf(<span class="hljs-string"><span class="hljs-string">"%2.4f s"</span></span>,($tend - $tstart)); $modx-&gt;log(modX::LOG_LEVEL_INFO,<span class="hljs-string"><span class="hljs-string">"\n&lt;br /&gt;Package Built.&lt;br /&gt;\nExecution time: {$totalTime}\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> ();</code> </pre> <br><br>  The pack () method tells MODX to create a zip file for the transport package.  The remaining lines simply output the time it took to assemble.  That's all.  If you run <br>  this is in the browser (I have the address http: //localhost/doodles/_build/build.transport.php), you will get debug information in the <b>core / packages /</b> folder as well: <br><br><img src="https://habrastorage.org/storage1/72fd761d/c5f74651/67ee0814/50adfff2.png"><br><br>  This is our transport package!  However, this is not enough for our supplement. <br><br><h4>  Adding data </h4><br><br>  We want to add our snippet to the package in a separate category ‚ÄúDoodles‚Äù.  In the <b>build.transport.php</b> file <b>,</b> add the following code to registerNamespace below: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $category= $modx-&gt;newObject(<span class="hljs-string"><span class="hljs-string">'modCategory'</span></span>); $category-&gt;set(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); $category-&gt;set(<span class="hljs-string"><span class="hljs-string">'category'</span></span>,PKG_NAME); <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-comment"><span class="hljs-comment">//$modx-&gt;log(modX::LOG_LEVEL_INFO,'Packaging in snippets...'); //$snippets = include $sources['data'].'transport.snippets.php'; //if (empty($snippets)) $modx-&gt;log(modX::LOG_LEVEL_ERROR,'Could not package in snippets.'); //$category-&gt;addMany($snippets); /* create category vehicle */ $attr = array( xPDOTransport::UNIQUE_KEY =&gt; 'category', xPDOTransport::PRESERVE_KEYS =&gt; false, xPDOTransport::UPDATE_OBJECT =&gt; true, xPDOTransport::RELATED_OBJECTS =&gt; true, xPDOTransport::RELATED_OBJECT_ATTRIBUTES =&gt; array ( 'Snippets' =&gt; array( xPDOTransport::PRESERVE_KEYS =&gt; false, xPDOTransport::UPDATE_OBJECT =&gt; true, xPDOTransport::UNIQUE_KEY =&gt; 'name', ), ), ); $vehicle = $builder-&gt;createVehicle($category,$attr); $builder-&gt;putVehicle($vehicle);</span></span></code> </pre> <br><br>  First, we create a modCategory (category) object named ‚ÄúDoodles‚Äù.  Please note that we do not save -&gt; save (), but only create an object.  Next, we have code for snipet packaging, but for the time being we ignore it, we will return to it later. <br><br>  Then we created a large array of attribute attributes of the vehicle (Vehicle) category.  What kind of vehicle?  Well, this is the vehicle that carries the object to the transport package.  Each object (snippet, menu item, category, etc.) must have a vehicle for "transportation" in the transport package.  Thus, we created one of them, but initially assigned several attributes that tell MODX how this vehicle should behave when the user installs a package. <br><br><ul><li>  <b>xPDOTransport :: UNIQUE_KEY =&gt; 'category'</b> - here we say MODX, that the ‚Äúcategory‚Äù field is a unique key for this category. </li><li>  <b>xPDOTransport :: PRESERVE_KEYS =&gt; false</b> - sometimes we want the primary key of our object to be ‚Äúsaved‚Äù.  This is useful for non-auto-incrementing keys (PKs), such as on the menu, which we will get later.  Our category does not need this, so we set it to false. </li><li>  <b>xPDOTransport :: UPDATE_OBJECT =&gt; true</b> - this tells MODX that if a category already exists, you need to update it with our version.  If set to false, MODX will just skip the category if it finds it.  We want the category to be updated. </li><li>  <b>xPDOTransport :: RELATED_OBJECTS =&gt; true</b> - this indicates related objects (we specify the object of the snippet).  Our case is a good example.  Any snippets to be installed will be placed in the category. </li><li>  <b>xPDOTransport :: RELATED_OBJECT_ATTRIBUTES</b> - This is an associative array with attributes of related objects.  In our case, this is only a snippet, but it can be plug-ins, TV-parameters (additional fields), chunks, etc. </li></ul><br><br>  Set properties for the snippet object: <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'Snippets'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( xPDOTransport::PRESERVE_KEYS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, xPDOTransport::UPDATE_OBJECT =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::UNIQUE_KEY =&gt; <span class="hljs-string"><span class="hljs-string">'name'</span></span>, ),</code> </pre> <br><br>  Here we say that saving the primary key is not required (similar to the category).  Then we want to update the object if it already exists.  Finally, we say MODX that the ‚Äúname‚Äù field is the primary key. <br><br>  Next, do this: <br><br><pre> <code class="php hljs">$vehicle = $builder-&gt;createVehicle($category,$attr); $builder-&gt;putVehicle($vehicle);</code> </pre> <br><br>  It packs our category object into a small vehicle with the attributes that we have just defined.  This adds it to the transport package.  Done!  Our category is packed.  Now add a snippet to it. <br><br><h4>  Add snippet </h4><br><br>  Go ahead and create the folder <b>/ www / doodles / _build / data /</b> .  Now we create the file <b>/www/doodles/_build/data/transport.snippets.php</b> in it.  Put this code in it: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSnippetContent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($filename)</span></span></span><span class="hljs-function"> </span></span>{ $o = file_get_contents($filename); $o = trim(str_replace(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'&lt;?php'</span></span>,<span class="hljs-string"><span class="hljs-string">'?&gt;'</span></span>),<span class="hljs-string"><span class="hljs-string">''</span></span>,$o)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $o; } $snippets = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $snippets[<span class="hljs-number"><span class="hljs-number">1</span></span>]= $modx-&gt;newObject(<span class="hljs-string"><span class="hljs-string">'modSnippet'</span></span>); $snippets[<span class="hljs-number"><span class="hljs-number">1</span></span>]-&gt;fromArray(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Doodles'</span></span>, <span class="hljs-string"><span class="hljs-string">'description'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Displays a list of Doodles.'</span></span>, <span class="hljs-string"><span class="hljs-string">'snippet'</span></span> =&gt; getSnippetContent($sources[<span class="hljs-string"><span class="hljs-string">'elements'</span></span>].<span class="hljs-string"><span class="hljs-string">'snippets/snippet.doodles.php'</span></span>), ),<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $properties = <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $sources[<span class="hljs-string"><span class="hljs-string">'data'</span></span>].<span class="hljs-string"><span class="hljs-string">'properties/properties.doodles.php'</span></span>; $snippets[<span class="hljs-number"><span class="hljs-number">1</span></span>]-&gt;setProperties($properties); <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>($properties); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $snippets;</code> </pre> <br><br>  First, we created a small helper method that will capture our pieces of code from files and remove the "&lt;? Php" tags from it.  Then we create a snippet object.  Remember: do not need to save, just create.  It's time to go back to the $ snippets array.  Remember the commented part from the <b>build.transport.php</b> file?  Here is this part: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> $modx-&gt;log(modX::LOG_LEVEL_INFO,<span class="hljs-string"><span class="hljs-string">'Packaging in snippets...'</span></span>); $snippets = <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $sources[<span class="hljs-string"><span class="hljs-string">'data'</span></span>].<span class="hljs-string"><span class="hljs-string">'transport.snippets.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($snippets)) $modx-&gt;log(modX::LOG_LEVEL_ERROR,<span class="hljs-string"><span class="hljs-string">'Could not package in snippets.'</span></span>); $category-&gt;addMany($snippets);</code> </pre> <br><br>  We remove commenting.  Now our snippet is loaded into the vehicle category.  Now add the properties we mentioned earlier. <br><br><h4>  Adding Snippet Properties </h4><br><br>  Create a file <b>/www/doodles/_build/data/properties/properties.doodles.php</b> with the following content: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $properties = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'tpl'</span></span>, <span class="hljs-string"><span class="hljs-string">'desc'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'prop_doodles.tpl_desc'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'textfield'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'rowTpl'</span></span>, <span class="hljs-string"><span class="hljs-string">'lexicon'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'doodles:properties'</span></span>, ), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'sort'</span></span>, <span class="hljs-string"><span class="hljs-string">'desc'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'prop_doodles.sort_desc'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'textfield'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'lexicon'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'doodles:properties'</span></span>, ), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dir'</span></span>, <span class="hljs-string"><span class="hljs-string">'desc'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'prop_doodles.dir_desc'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'list'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'text'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'prop_doodles.ascending'</span></span>,<span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'ASC'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'text'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'prop_doodles.descending'</span></span>,<span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'DESC'</span></span>), ), <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'DESC'</span></span>, <span class="hljs-string"><span class="hljs-string">'lexicon'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'doodles:properties'</span></span>, ), ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $properties;</code> </pre> <br><br>  This is the PHP representation of the default properties (parameters) of the snippet.  Let's look at all his keys: <br><br><ul><li>  <b>name</b> is the name of the snippet.  This name is indicated in the call: <br><br><pre> <code class="hljs lua"><span class="hljs-string"><span class="hljs-string">[[Doodles? &amp;tpl=`rowTpl`]]</span></span></code> </pre> <br></li><li>  <b>desc</b> - snippet description. </li><li>  <b>type</b> is the 'xtype' property field.  Currently four types are available: ‚Äútextfield‚Äù (text field), ‚Äútextarea‚Äù, ‚Äúcombo-boolean‚Äù (drop-down list ‚ÄúYes / No‚Äù) and ‚Äúlist‚Äù (list of values). </li><li>  <b>options</b> - used only for a list of values.  This is an array of arrays.  Each of them has two values: 'text' (text) and 'value' (value).  The text is displayed to the user in the list, and the value is saved in the database.  Text can be a key from the lexicon. </li><li>  <b>value</b> is the default property value. </li><li>  <b>lexicon</b> - If desired, properties may be i18n-compatible.  Just enter the name of the lexicon and MODX does the rest. </li></ul><br><br>  So, we have properties.  But as you can see, we made a link to the new section of the lexicon "doodles: properties"  Let's create a lexicon file <b>/www/doodles/core/components/doodles/lexicon/en/properties.inc.php</b> with this content: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $_lang[<span class="hljs-string"><span class="hljs-string">'prop_doodles.ascending'</span></span>] = <span class="hljs-string"><span class="hljs-string">'Ascending'</span></span>; $_lang[<span class="hljs-string"><span class="hljs-string">'prop_doodles.descending'</span></span>] = <span class="hljs-string"><span class="hljs-string">'Descending'</span></span>; $_lang[<span class="hljs-string"><span class="hljs-string">'prop_doodles.dir_desc'</span></span>] = <span class="hljs-string"><span class="hljs-string">'The direction to sort by.'</span></span>; $_lang[<span class="hljs-string"><span class="hljs-string">'prop_doodles.sort_desc'</span></span>] = <span class="hljs-string"><span class="hljs-string">'The field to sort by.'</span></span>; $_lang[<span class="hljs-string"><span class="hljs-string">'prop_doodles.tpl_desc'</span></span>] = <span class="hljs-string"><span class="hljs-string">'The chunk for displaying each row.'</span></span>;</code> </pre> <br><br>  As you can see here the content is similar to the ‚Äúdefault‚Äù section. <br><br>  If you run the script now, then our category and snippet with its properties will be packaged in some sort.  Fine!  But we missed our add-on files themselves.  Let's fix it. <br><br><h4>  Adding file resolvers (Resolvers) </h4><br><br>  Let's add folders <b>/ www / doodles / core / components / doodles /</b> and <b>/ www / doodles / assets / components / doodles / of</b> our add-on to the package.  We will add files to our vehicle categories using so-called.  file resolvers. <br><br>  So, in <b>build.transport.php</b> immediately after adding a vehicle category: <br><br><pre> <code class="php hljs">$vehicle = $builder-&gt;createVehicle($category,$attr);</code> </pre> <br><br>  add this: <br><br><pre> <code class="php hljs">$modx-&gt;log(modX::LOG_LEVEL_INFO,<span class="hljs-string"><span class="hljs-string">'Adding file resolvers to category...'</span></span>); $vehicle-&gt;resolve(<span class="hljs-string"><span class="hljs-string">'file'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'source'</span></span> =&gt; $sources[<span class="hljs-string"><span class="hljs-string">'source_assets'</span></span>], <span class="hljs-string"><span class="hljs-string">'target'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"return MODX_ASSETS_PATH . 'components/';"</span></span>, )); $vehicle-&gt;resolve(<span class="hljs-string"><span class="hljs-string">'file'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'source'</span></span> =&gt; $sources[<span class="hljs-string"><span class="hljs-string">'source_core'</span></span>], <span class="hljs-string"><span class="hljs-string">'target'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"return MODX_CORE_PATH . 'components/';"</span></span>, ));</code> </pre> <br><br>  It is worth analyzing two attributes: <br><br>  <b>source</b> is the way to find files.  We use our source_assets and source_core, which were defined by us earlier. <br><br>  <b>target</b> is an eval-string that returns the path where the files of our add-on will be located. <br><br>  The first parameter in resolve () tells MODX that this is a file resolver.  We will take a closer look at resolvers later in this lesson. <br><br>  If you run the packer now, it will pack the <b>doodles / core /</b> and <b>doodles / assets /</b> folders. <br><br><h4>  Add menu item and action </h4><br><br>  Now let's add a menu item and an action for the component page that we made earlier. <br><br>  Add this code: <br><br><pre> <code class="php hljs">$modx-&gt;log(modX::LOG_LEVEL_INFO,<span class="hljs-string"><span class="hljs-string">'Packaging in menu...'</span></span>); $menu = <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $sources[<span class="hljs-string"><span class="hljs-string">'data'</span></span>].<span class="hljs-string"><span class="hljs-string">'transport.menu.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($menu)) $modx-&gt;log(modX::LOG_LEVEL_ERROR,<span class="hljs-string"><span class="hljs-string">'Could not package in menu.'</span></span>); $vehicle= $builder-&gt;createVehicle($menu,<span class="hljs-keyword"><span class="hljs-keyword">array</span></span> ( xPDOTransport::PRESERVE_KEYS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::UPDATE_OBJECT =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::UNIQUE_KEY =&gt; <span class="hljs-string"><span class="hljs-string">'text'</span></span>, xPDOTransport::RELATED_OBJECTS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::RELATED_OBJECT_ATTRIBUTES =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> ( <span class="hljs-string"><span class="hljs-string">'Action'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> ( xPDOTransport::PRESERVE_KEYS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, xPDOTransport::UPDATE_OBJECT =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::UNIQUE_KEY =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> (<span class="hljs-string"><span class="hljs-string">'namespace'</span></span>,<span class="hljs-string"><span class="hljs-string">'controller'</span></span>), ), ), )); $modx-&gt;log(modX::LOG_LEVEL_INFO,<span class="hljs-string"><span class="hljs-string">'Adding in PHP resolvers...'</span></span>); $builder-&gt;putVehicle($vehicle); <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>($vehicle,$menu);</code> </pre> <br><br>  Everything is similar to the vehicle category.  A menu object and an associated action object are created. <br><ul><li>  <b>PRESERVE_KEYS is</b> set to true, because  The menus have unique keys and we want to keep the key of our menu item. </li><li>  <b>The UNIQUE_KEY of the</b> associated action object is an array.  This tells MODX to look for a modAction object that has a namespace of 'namespace' =&gt; 'doodles' and a controller of controllers / index. </li></ul><br><br>  As you probably guessed, we need to add the file <b>transport.menu.php</b> .  Create it <b>/www/doodles/_build/data/transport.menu.php</b> : <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $action= $modx-&gt;newObject(<span class="hljs-string"><span class="hljs-string">'modAction'</span></span>); $action-&gt;fromArray(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'namespace'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'doodles'</span></span>, <span class="hljs-string"><span class="hljs-string">'parent'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'controller'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'controllers/index'</span></span>, <span class="hljs-string"><span class="hljs-string">'haslayout'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'lang_topics'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'doodles:default'</span></span>, <span class="hljs-string"><span class="hljs-string">'assets'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, ),<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $menu= $modx-&gt;newObject(<span class="hljs-string"><span class="hljs-string">'modMenu'</span></span>); $menu-&gt;fromArray(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'text'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'doodles'</span></span>, <span class="hljs-string"><span class="hljs-string">'parent'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'components'</span></span>, <span class="hljs-string"><span class="hljs-string">'description'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'doodles.desc'</span></span>, <span class="hljs-string"><span class="hljs-string">'icon'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'images/icons/plugin.gif'</span></span>, <span class="hljs-string"><span class="hljs-string">'menuindex'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'params'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'handler'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, ),<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $menu-&gt;addOne($action); <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>($menus); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $menu;</code> </pre> <br><br>  Everything is similar to <b>transport.snippets.php</b> , except for calling the menu object's addOne () method.  Please note that all the elements of the array fromArray () correspond to the fields in the database tables. <br><br>  So, the menu item and action are packed. <br><br><h4>  Add resolver </h4><br><br>  When we install our add-on in the system, we will encounter one problem - the modx_doodles database tables will not exist.  Let's write a PHP resolver that will run after a transport vehicle.  Add this resolver to our vehicle menu.  Immediately after <b>$ vehicle = $ builder-&gt; createVehicle ($ menu),</b> add the following code: <br><br><pre> <code class="php hljs">$modx-&gt;log(modX::LOG_LEVEL_INFO,<span class="hljs-string"><span class="hljs-string">'Adding in PHP resolvers...'</span></span>); $vehicle-&gt;resolve(<span class="hljs-string"><span class="hljs-string">'php'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'source'</span></span> =&gt; $sources[<span class="hljs-string"><span class="hljs-string">'resolvers'</span></span>] . <span class="hljs-string"><span class="hljs-string">'resolve.tables.php'</span></span>, ));</code> </pre> <br><br>  Create a file <b>/www/doodles/_build/resolvers/resolve.tables.php</b> with the following content: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($object-&gt;xpdo) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ($options[xPDOTransport::PACKAGE_ACTION]) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> xPDOTransport::ACTION_INSTALL: $modx =&amp; $object-&gt;xpdo; $modelPath = $modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'doodles.core_path'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>,$modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'core_path'</span></span>).<span class="hljs-string"><span class="hljs-string">'components/doodles/'</span></span>).<span class="hljs-string"><span class="hljs-string">'model/'</span></span>; $modx-&gt;addPackage(<span class="hljs-string"><span class="hljs-string">'doodles'</span></span>,$modelPath); $manager = $modx-&gt;getManager(); $manager-&gt;createObjectContainer(<span class="hljs-string"><span class="hljs-string">'Doodle'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> xPDOTransport::ACTION_UPGRADE: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>;</code> </pre> <br><br>  Fine.  I think everything is clear.  We have a switch construction, thanks to which we can perform tasks depending on the current action.  We specify the path to our model and call the <b>addPackage ()</b> method, which adds our xpdo scheme (remember from the first lesson?).  Finally, we run <b>$ modx-&gt; getManager ()</b> and then <b>$ manager-&gt; createObjectContainer ('Doodle')</b> .  This method gives the MODX command to run SQL and create a table in the database for our Doodle class.  Now you can remove the check for the existence of a database table, as we did in the first part (using a resolver is not necessary, but it is convenient).  And at the end we will return true, so that MODX knew that everything went smoothly. <br><br>  Now when installing the package, a table of our addition to the database will be created. <br><br><h4>  Adding files cangelog, readme, license and installation parameters </h4><br><br>  Let's create a <b>readme.txt file</b> in the <b>docs /</b> folder with the following contents: <br><br><pre> <code class="hljs dos">-------------------- Extra: Doodles -------------------- Version: <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> A simple demo extra <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> creating robust <span class="hljs-number"><span class="hljs-number">3</span></span><span class="hljs-built_in"><span class="hljs-built_in">rd</span></span>-Party Components <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> MODx Revolution.</code> </pre> <br><br>  Also, create the <b>license.txt</b> files (contains a description of the license) and <b>changelog.txt</b> (change log) if they are not already there. <br><br>  Now let's go back to the <b>build.transport.php</b> script and add the following lines in front of <b>$ builder-&gt; pack ()</b> : <br><br><pre> <code class="php hljs">$modx-&gt;log(modX::LOG_LEVEL_INFO,<span class="hljs-string"><span class="hljs-string">'Adding package attributes and setup options...'</span></span>); $builder-&gt;setPackageAttributes(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'license'</span></span> =&gt; file_get_contents($sources[<span class="hljs-string"><span class="hljs-string">'docs'</span></span>] . <span class="hljs-string"><span class="hljs-string">'license.txt'</span></span>), <span class="hljs-string"><span class="hljs-string">'readme'</span></span> =&gt; file_get_contents($sources[<span class="hljs-string"><span class="hljs-string">'docs'</span></span>] . <span class="hljs-string"><span class="hljs-string">'readme.txt'</span></span>), <span class="hljs-string"><span class="hljs-string">'changelog'</span></span> =&gt; file_get_contents($sources[<span class="hljs-string"><span class="hljs-string">'docs'</span></span>] . <span class="hljs-string"><span class="hljs-string">'changelog.txt'</span></span>), <span class="hljs-string"><span class="hljs-string">'setup-options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'source'</span></span> =&gt; $sources[<span class="hljs-string"><span class="hljs-string">'build'</span></span>].<span class="hljs-string"><span class="hljs-string">'setup.options.php'</span></span>, ), ));</code> </pre> <br><br>  As you can see, the <b>setPackageAttributes ()</b> method is <b>called</b> , which sets the attributes for our packer.  Also here is a new for us array 'setup-options'.  This array has an element with the key 'source' - the path to the PHP file (like a resolver). <br><br>  Create a file <b>/www/doodles/_build/setup.options.php</b> with the following content: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $output = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ($options[xPDOTransport::PACKAGE_ACTION]) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> xPDOTransport::ACTION_INSTALL: $output = <span class="hljs-string"><span class="hljs-string">'&lt;h2&gt;Doodles Installer&lt;/h2&gt; &lt;p&gt;Thanks for installing Doodles! Please review the setup options below before proceeding.&lt;/p&gt;&lt;br /&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> xPDOTransport::ACTION_UPGRADE: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> xPDOTransport::ACTION_UNINSTALL: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $output;</code> </pre> <br><br>  Familiar looks, yes?  This piece of code allows us to display the "Installation Options" when the user installs the package.  Now we are just displaying a message to say ‚ÄúThank you‚Äù to people for installing our add-on. <br><br>  Here you can add form elements that will be displayed when the package is installed and further processed by the installer.  An example can be seen in the Quip component: <a href="https://github.com/splittingred/Quip/blob/develop/_build/resolvers/setupoptions.resolver.php">github.com/splittingred/Quip/blob/develop/_build/resolvers/setupoptions.resolver.php</a> . <br><br>  That's all.  Run the packer (http: //localhost/doodles/_build/build.transport.php) and the file <b>‚Äúdoodles-1.0-rc1.zip‚Äù</b> will appear in the <b>core / packages /</b> folder.  This file can be downloaded to <a href="http://modx.com/extras/">the MODX add-ons repository</a> and then it can be installed via <a href="http://rtfm.modx.com/display/revolution20/Package%2BManagement">Package Management</a> . <br><br><img src="http://habrastorage.org/storage1/1c2987a0/e766f3ab/e24f4568/5abca7b1.png"><br><br>  All files created by us, the packer can be found here: <a href="https://github.com/splittingred/Doodles/tree/develop/_build">github.com/splittingred/Doodles/tree/develop/_build</a> . </div><p>Source: <a href="https://habr.com/ru/post/132709/">https://habr.com/ru/post/132709/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132700/index.html">IPod nano replacement program (1st generation)</a></li>
<li><a href="../132702/index.html">Analog computer on operational amplifiers</a></li>
<li><a href="../132703/index.html">JDK Secrets</a></li>
<li><a href="../132707/index.html">Implementing and receiving payment in linkCharge</a></li>
<li><a href="../132708/index.html">XP Days in Ukraine</a></li>
<li><a href="../132710/index.html">Government communication based on Asterisk!</a></li>
<li><a href="../132712/index.html">Conference DrupalConf - December 3 in Moscow!</a></li>
<li><a href="../132713/index.html">Google has opened a Google API Plus to six third-party developers.</a></li>
<li><a href="../132714/index.html">Droider Chart. Release 78, active</a></li>
<li><a href="../132715/index.html">Developers updated Twitter interface</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>