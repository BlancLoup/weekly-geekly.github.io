<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How did I connect Wii-nunchak to HoloLens, or why virtual objects need real buttons</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Our entire team was looking forward to delivering the long-awaited HoloLens, it had to be ordered through friends overseas and kept fists, so that cus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How did I connect Wii-nunchak to HoloLens, or why virtual objects need real buttons</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/bef/b20/a91/befb20a91bcd4bed958d8e2a92904fb7.jpg" alt="Watch out, Pokemon, now I call everyone!"><br><br>  Our entire team was looking forward to delivering the long-awaited HoloLens, it had to be ordered through friends overseas and kept fists, so that customs would not become interested in WiFi certified for Europe.  Finally, in early September, the coveted oval case came to us.  We open, charge, put on the head - this is the gate to the virtual world.  The truth is asking for a pass at the gate - you need to log in with a password from Microsoft.  Yes, by the way, it is long crypt-resistant, with special characters and in different registers.  While our pioneer of virtual worlds, tweaking the air with an air-tap gesture, stuffed something like Opa on a keyboard floating in space, opa # 00FF00 ograd @ !, the rest had time to think about how we are going to control this 3D. <br><a name="habracut"></a><br><h2>  Problem </h2><br>  On desktops, and with some reservations on tablets and mobile phones, we have two types of input devices.  Mouse - you can specify any of a million pixels.  Fast, but inaccurate.  Keyboard - press one or several buttons from a much smaller range (&lt;100), but it works very reliably and even blindly.  Special buttons like Escape are pressed almost without errors, you will not confuse. <br><br>  In HoloLens, the mouse analogue is the point of the cursor hanging in front of the nose.  The air-tap pinch is not as convenient as clicking a mouse button, but the attached one-button Clicker controller helps.  It is easy to select the desired projected button and give the command ‚Äúgo‚Äù, but with the cancellation of the action there are serious problems - there is a catastrophic lack of Escape.  For example, in Galaxy Explorer it is easy to show on the planet and call up detailed information, but attempts to return to the galaxy map or simply change the scale strongly resemble dancing with a tambourine, especially if you look at a person wearing glasses from the side. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Microsoft recommends giving teams by voice, through Cortana, but have you tried to do it at least five of us in the same room?  Hi cubicles and Open Space.  When using a working conveyor, as in our case, external noise interferes.  In addition, looking at the screen, the user with the mouse immediately sees the available buttons and hyperlinks, and on the physical keyboard you can even touch the possible choices.  But here in front of me is a microphone, how, looking at him, understand which commands are supported?  It is not clear even what language to speak with him, not to mention the fact that our team is international and native language and the pronunciation of each is different. <br><br><div class="spoiler">  <b class="spoiler_title">Voice Interface Problems</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/Q3bdXctq7DM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br><h2>  Idea </h2><br>  So the idea was born to fasten a nunchuck from Wii to HoloLens.  Two high-quality, hardware buttons with anti-debugging, joystick, plus, in perspective, the ability to use the accelerometer.  The device is compact, mobile, durable and cheap.  Moreover, the Wii remote is recognized via Bluetooth as a HID input device, what could be simpler? <br><br>  The first disappointment was waiting for me here - to connect, the controller from Nintendo asks for a PIN, which is the device‚Äôs address that is written down the other way around.  For example, my controller has the address 00: 1E: A9: 5D: A6: BC and you need to somehow enter a string of 5 characters with the codes BC, A6,5D, A9,1E, and at the end the final 00. Maybe someone and I was lucky with the controller's address, but I had all the available addresses in the range of non-printable characters. <br><br>  Nunchuk gives out data on the I2C bus and from the microcontroller it is easy to interrogate the state of the buttons and accelerometer.  I decided to transfer data to HoloLens via <a href="https://learn.adafruit.com/introducing-bluefruit-ez-key-diy-bluetooth-hid-keyboard/overview">Bluefruit EZ-Key</a> - this is a ready-made HID keyboard controller, capable of sending an arbitrary combination of up to 6 keys pressed simultaneously. <br><br>  It turned out this architecture: <br><br><img src="https://habrastorage.org/files/866/d2c/d81/866d2cd81e1d4cbd93b8a46be813f5db.png"><br><br><h2>  Arduino, as without her </h2><br>  Logic from the microcontroller requires a minimum - read your data from I2C, and send the corresponding USB HID code <a href="http://www.freebsddiary.org/APC/usb_hid_usages.php">from the table</a> .  A ready-made library for the Arduino was found for reading, and he took it, specifically the choice fell on a miniature <a href="https://www.arduino.cc/en/Main/ArduinoBoardProMini">Arduino Pro Mini</a> at 8MHz with 3.3 V power supply. handle and the microcontroller for a couple of kopecks. <br><br>  We put together a prototype on a breadboard, run on HoloLens Internet Explorer as the simplest replacement for Notepad and ... hurray!  Earned!  When you click the buttons in the address bar of the browser letters appear! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ff1/979/347/ff1979347fa4424c814c07938a75846c.jpg"></div><br><br><h2>  First com clod </h2><br>  When debugging the code for Arduino, he stepped on a rake - suddenly Bluefruit stopped sending codes, although Bluetooth was fine and the device was still defined by HoloLens as a keyboard.  The Arduino Mini is programmed with an FTDI cable or another Arduino, and the next time the prototype was reworked, Bluefruit wasn‚Äôt powered.  Arduino, on the other hand, got the current from the computer through the programmer cable, and the program that started up started to honestly transmit the codes of the buttons.  3.3 volts attached to the input of the de-energized board burned the input RX-pin of the serial interface on the side of the Bluetooth module.  And after all, I once read <a href="http://easyelectronics.ru/parazitnoe-pitanie.html">an article</a> on Easyelectronics <a href="http://easyelectronics.ru/parazitnoe-pitanie.html">why you can't do this</a> ! <br><br>  Fortunately, after replacing the Bluefruit with a new one, it went further.  The connection scheme is very simple - no active elements, you only need to connect the pins to each other. <br><br><img src="https://habrastorage.org/files/00d/a8d/c6e/00da8dc6e1bf468f91b951c6af5ba606.png"><br><br>  For power left nunchak cable and soldered USB-A plug.  The Arduino stabilizer converts 5 volts from USB to 3.3, which feed the nunchuk and Bluefruit EZ-Key logic.  At the end of the cable brought the Pair button from Bluetooth.  Unusually, according to the instructions, this button should be connected to the power bus, and not to the ground, like all other buttons on the Bluefruit. <br><br><h2>  Programming and assembly </h2><br>  The program executed on the Arduino is very simple - 20 times per second to interrogate the pressed buttons, add their USB HID codes to the buffer (several presses are possible at the same time) and send them via a serial interface to the Bluetooth module.  The only feature - it is important to correctly specify the type of Arduino in the IDE.  My model works at 8 MHz, and not at the standard for Arduino 16, so at first the serial interface worked at half speed and gave the data at 4800 baud instead of the expected 9200. <br><br><img src="https://habrastorage.org/files/a4d/c27/397/a4dc27397194471bad3a2d3081fbe641.png" alt="Correct settings"><br><br>  All source codes and other files are laid out under the MIT-license <a href="https://github.com/cazacov/HoloControl">on GitHub</a> . <br><br>  Arduino Mini and Bluefroot have similar sizes, and for compactness, I soldered them together in such a sandwich: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2af/c64/ea4/2afc64ea4f8845a0b2309a20246f01dd.jpg"></div><br>  For isolation between the boards, a U-shaped plastic insert is made, which also protects the screen of the Bluetooth module from being squeezed.  Cutting the cable, soldered to the nunchuk logic. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d97/60a/1bf/d9760a1bf032472ca8a0286ac0979bab.jpg"></div><br>  In general, it turned out quite a compact design, even fit inside the body.  It was necessary to cut only some stiffeners. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/70b/dd0/c44/70bdd0c4443843bb8f200729e1edcc16.jpg"></div><br>  The whole construction assembly.  At the end of the cable is a power plug and a Bluetooth connection button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d2f/582/efb/d2f582efb44d48d0a2edd4db4dc6a56f.jpg"></div><br><h2>  Unity </h2><br>  From the point of view of HoloLens, my controller is a simple keyboard whose support has been built since the beginning of time.  No external dependencies or third-party libraries are needed. <br><br>  The directions of the joystick turn into ASDW, the ‚ÄúZ‚Äù button into Enter, and the ‚ÄúC‚Äù into Escape. <br><br><pre><code class="hljs ruby"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (UnityEngine.Input.GetKey(KeyCode.A)) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Joystick left ... } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (UnityEngine.Input.GetKey(KeyCode.D)) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Joystick right ... }</code> </pre> <br>  This code is very convenient to debug by running the HoloLens emulator on the desktop, you can simply press the buttons on the keyboard and, from the point of view of the application, there is no difference. <br><br>  The result is this: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/75GZE48Ib2U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Video shot directly from points through the built-in function Mixed Reality Capture.  Sources of the demo are also on Github. <br><br><h2>  What's next? </h2><br>  Power Bank is easy to put in your pocket and powered by USB does not greatly reduce mobility, but you want a fully autonomous device.  I think to fasten the lithium-ion jar 18650 and the charging controller from Micro-USB.  Arduino can be supplied with any voltage from 3.3 to 8 volts, so additional stabilization is not needed.  Alas, the battery does not fit in the case, you will have to print your own on a 3D printer. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d32/430/46f/d3243046fee34cfbaff0115a8b85611d.jpg" alt="Charger"></div><br>  In nunchuk there is also an accelerometer, which I have not yet engaged.  In principle, it can be used to simulate a mouse, but we have not yet figured out how to use it sensibly.  HoloLens is planned to be used not sitting at a table in a quiet office, but on the go and in a noisy warehouse.  The user will not be able to hold his hand horizontally, tilting the controller with precise movements, but clearly recognizable button presses are the thing. <br><br>  Maybe someone of genius will invent a system of commands and gestures suitable for glasses, but for now the control of the keyboard and mouse is something that users are well aware of and developers are well able to program. <br><br>  <a href="https://forums.hololens.com/categories/questions-and-answers">At the support forum,</a> people demand new gestures <s>and circuses</s> , let's see what else Microsoft is inventing. </div><p>Source: <a href="https://habr.com/ru/post/397813/">https://habr.com/ru/post/397813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../397803/index.html">Education Minister promised to return astronomy to school curriculum</a></li>
<li><a href="../397805/index.html">How to find out your real zodiac sign</a></li>
<li><a href="../397807/index.html">Superbright LED dimmable "fingers" X-Flash TC</a></li>
<li><a href="../397809/index.html">S7 Airlines bought Sea Launch</a></li>
<li><a href="../397811/index.html">Teflon coatings on the pans and the myths around them</a></li>
<li><a href="../397815/index.html">From St. Petersburg to Moscow: we keep in touch all the way</a></li>
<li><a href="../397817/index.html">Socket for ESP8266 ESP-12</a></li>
<li><a href="../397819/index.html">Who technology has taken work</a></li>
<li><a href="../397821/index.html">Detector of authenticity of excise stamps and securities</a></li>
<li><a href="../397823/index.html">Association of mobile operators, users, services on one technological platform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>