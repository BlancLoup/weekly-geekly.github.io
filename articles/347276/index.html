<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Smart search: how artificial intelligence hh.ru selects jobs to resume</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="More than half of the applicants are not looking for anything, but create a resume and just wait for them to be invited for an interview, or at least ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Smart search: how artificial intelligence hh.ru selects jobs to resume</h1><div class="post__text post__text-html js-mediator-article">  More than half of the applicants are not looking for anything, but create a resume and just wait for them to be invited for an interview, or at least send a suitable vacancy.  When we thought about how a job search site should look for them, we realized that they only needed one button. <br><br><img src="https://habrastorage.org/webt/a3/qp/lp/a3qplpkpryb2x5k5c6cpllzwuki.png"><br><br>  We started to make such a system a year and a half ago - we decided to build an algorithm for machine learning that would choose the jobs that suit the user.  But we understood very quickly that vacancies similar to resumes and vacancies to which the resume owner would like to respond are not the same thing. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article I will describe how we did a smart search - with all the problems, subtleties and compromises that we had to go to. <br><br><h2>  Started with a recommendation system </h2><br>  On hh.ru there are mailings with suitable vacancies.  We took up with them in the first place: we began with the creation of a recommendation system that will bring suitable vacancies to candidates. <br><br>  To understand the question, we made a log of what vacancies are shown to users and what users do with them further.  We developed a system of a / b-tests, infrastructure in order to predict the likelihood of response for a couple of "resume / vacancy" using machine learning. <br><br>  In production, we added the calculation of static features for indexing and consistent application of several filtering models for resumes with increasing resource intensity, and then the models for the final ranking. <br><br><img src="https://habrastorage.org/webt/sg/jg/hx/sgjghxme_trzwspryrktln6qu20.png"><br><br>  The system began to bring us about 1.2 million additional responses per month, which is about 120 thousand invited for an interview and 20 thousand hired.  The vacancies selected by the recommendatory system come by mail, are shown in the ‚ÄúWe recommend you personally‚Äù block on the main hh.ru and in suitable vacancies for resumes. <br><br>  But even a relatively small improvement in the search is more profitable than a large one in the recommendation system.  Therefore, the next step was the use of machine learning in the search. <br><br><h2>  Search by empty query </h2><br>  We began by analyzing search queries.  It turned out that in 35% of requests, users who have a resume leave the search box empty.  If we count and anonymous queries, then the number of empty search queries reaches 50%. <br><br>  For cases where the user has a summary, we decided to apply a recommender system: replace the rank by textual match with the rank from the recommender system.  It did not require big changes and it turned out to be done pretty quickly. <br><br>  The use of rank from the recommender system gave several thousand additional responses per day.  But the effect was less than expected.  Since users view, on average, only the first one and a half pages of issue, in large cities the changes concerned, in fact, only premium vacancies.  The system showed suitable Premiums at the top, and then inappropriate, even if there were more suitable jobs like ‚ÄúStandard‚Äù, ‚ÄúStandard +‚Äù and free ones. <br><br>  Therefore, we decided to try to make sure that the vacancies were divided into two groups: ‚ÄúPremiums‚Äù, ‚ÄúStandard +‚Äù and ‚ÄúStandard‚Äù went first, and free ones, for which the predicted response probability is more than a certain value, and then all the others are in the same order. <br><br>  Since we absolutely needed that current vacancies for our clients-employers not to work worse, we very carefully approached these changes, even the experiment by 5% was supported by calculations and justifications.  As a result, we did an experiment and saw an increase in responses for all types of vacancies. <br><br><h2>  System performance </h2><br>  Before applying the model, you need to count on the summary and on the vacancy signs, and then - the pair for their combination.  In the recommender system, the load on which was not so high, static signs for vacancies were already considered when they were indexed and placed in a special index, and resumes and pairs were considered at the time of processing the request. <br><br>  Since we understood that when you turn on search by an empty query, the load on the search engine will increase by about 6 times, we needed to cache attributes for resumes.  First we tried to count the tags for the resume and put them in Cassandra.  But to achieve the desired performance from her failed.  Therefore, everything was decided by the table in PostgreSQL. <br><br>  What had to be added to achieve the desired performance from the system: <br><br><ol><li>  Recalculation cache when changing signs.  For users who have not updated their resumes and have not visited the site for more than two years, the cache is not considered, and the distribution of recommended jobs goes according to textual correspondence.  If you come so-so suitable jobs, it may be this: you just need to update your resume. </li><li>  We noticed that if each server with a basic search continues to index all the objects for the indices that it has (vacancies, resumes, companies) separately, then we will not have enough servers ordered.  Therefore, we redid the system of vacancy indexing and resumes from ‚Äúevery basic master to himself‚Äù to ‚Äúmain master - spare master - basic searches that collect index segments‚Äù, where only masters are engaged in indexing, with optimization and sequential pumping of the entire base every night (Moscow time). time) to reduce the amount of indexes. </li><li>  Did failfast - the http 500 quick response to basic searches if an error occurred while processing the request.  With machine learning, the response time in some cases is greatly increased, and instead of filing such requests in a queue, the basic search gives the average meta-search a quick answer of http 500, after which the average meta-search manages to make a second request and in most cases give the user results.  After this, we did a speculative retry: if there is no more than 2/3 timeout response from the basic search, then the average meta-search refers in advance to another basic search. </li></ol><br>  Simplistically, in terms of components and data flows between them, the recommender search engine is designed like this. <br><br><img src="https://habrastorage.org/webt/en/f_/qk/enf_qk6oclup6ldbp9eqaun-ewy.png"><br><br>  Data streams in the system: <br><br><ul><li>  red arrows, (1) - (15) - contour of the response to a search query, starts automatically with each search query; </li><li>  blue arrows, (16) - (24) - contour of indexation, starts automatically when vacancies, resumes, companies change; </li><li>  green arrows, (25) - (33) - machine learning contour, started manually with each change of models (changes in linguistics, vectorization, signs, objective functions, models, just re-training of models using more relevant data); </li><li>  purple arrows (34) - (36) - contour for calculating metrics in A / B tests and business metrics (it starts automatically, once a day). </li></ul><br>  In the process, we needed to add about 10 servers to the cluster, more powerful than those that have been there until now.  It was necessary to rationally use their power.  Increased the likelihood that some of the servers will be unavailable.  Therefore, we redesigned balancing on meta from a simple, unconditional round-robin, so that it takes into account the response time and the number of non-responses and sends more requests to those servers where they are less. <br><br>  In addition to the use of new servers, it also made it possible to experience a sudden failure of 20% of the cluster without visible effects to users. <br><br>  Simply, in terms of architecture layers and component instances in them, the system is structured as follows: <br><br><img src="https://habrastorage.org/webt/90/_n/ff/90_nffocmq9kmuymddyxt05fzmw.png"><br><br>  The balancing described above works between the average metasearch (meta) and the basic search (basesearch). <br><br>  At the same time, we, without ceasing, worked on the recommender system.  Included signs by text interactions, graded target function, signs by ‚Äúraw‚Äù svd-vectors by texts, meta-signs by linear regression over tf / idf-vectors.  There was another improvement: we repeated the unloading, cleaning and combining the initial data for machine learning from the logs and the database and made it so that it could be started with a single command. <br><br><h2>  Search for non-empty query: machine learning </h2><br>  Almost simultaneously, we began to do a search for a non-empty query. <br><br>  First, we tried to apply to vacancies with words from a search query that Lucene gives out, filters and rankings from a recommender system.  This did not result in statistically significant improvements.  Therefore, we made a special upload ‚Äúrequest - resume - vacancy - action‚Äù and taught two models: <br><br><ol><li>  linear: used to quickly and with low resource consumption to separate suitable vacancies from inappropriate and roughly rank inappropriate; </li><li>  XGBoost: used to more accurately rank suitable ones. </li></ol><br><br><img src="https://habrastorage.org/webt/ty/qw/sr/tyqwsrddfuai81fvmscdlk6pscm.png"><br><br>  We reused signs from the recommender system: static (calculated before the query was executed), text, numeric and categorical, as well as dynamic, which are considered when processing the query.  Added to the usual signs of signs that compare the text, taking into account textual interactions. <br><br>  Schematically, the work of machine learning can be represented as: <br><br><img src="https://habrastorage.org/webt/lr/gc/jh/lrgcjhu11b5xkftk4-zfhsybcoq.png"><br><br>  When calculating the recommended vacancies and processing search queries, only the green part is performed, when models change (changes in linguistics, vectorization, signs, objective functions, models, just retraining models with more relevant data) - both green and blue. <br><br>  Since there are a lot of signs and the code for calculating them when training models and processing requests had to be added to different places, it took a long time and led to errors.  Therefore, we decided to make for them a framework, feature group.  It‚Äôs not the first time to make this framework convenient, it even increased the project timeline a little. <br><br>  We made a measurement of the quality of the models by selecting the local ndcg and map metrics for all volumes, @ 10, @ 20, using kfold by users and time-based-validation.  Indeed, if, without time-based-validation, an increase in the complexity of models (for example, the number of trees) showed an improvement in local metrics, then it became clear to him that overfitting took place, which allowed us to select reasonable hyperparameters. <br><br>  We first tried to teach a linear model to predict the likelihood of response for individual combinations of "request - resume - vacancy", but it turned out that the result in a / b tests is better when the linear model compares the probabilities for two vacancies.  In this configuration, some experiments have already yielded statistically significant positive results.  But still less than expected. <br><br>  We added separate thresholds for suitable regular jobs, suitable ClickMe advertising jobs, to calculate the xgboost ranking model, as well as for the number of trees from the ensemble to be counted in production.  We understood that there was not enough time to check all the options, so we took the most high-frequency queries, reformulated them, and checked the quality of the issue with different settings for applicants with a typical resume in the relevant professions, marking the vacancies. <br><br>  To mark which vacancies are well suited for them, which are medium and which are not very good, I had to study the specifics of the professions quite deeply.  There was very little time left, so we rolled out the settings that showed the best for markup, and a few more options by 5%, leaving only the control split without machine learning. <br><br>  It turned out that it was not for good reason that the option included on the majority of users really showed itself best! <br><br><h2>  New interface and advertising </h2><br>  Users usually do not very well notice the changes in the ranking - to make a noticeable launch, you need to change the interface.  In these changes, the negative effect of novelty is strongly manifested; improvements must be very strong in order to defeat it.  For example, you need to make the first screen much more useful.  We made a new graphic design, in which space from above horizontally and to the right vertically was not occupied by advertising. <br><br>  Advertising can be treated differently, but it gives HeadHunter a substantial part of the profit.  In order to share less of this profit with other advertising networks, HeadHunter made its network - ClickMe.  Advertising that is in it can be divided into advertising vacancies and non-vacancies.  In the new design, using the same technologies and models that are used in the search and recommendation system, we began to show instead of the top block of advertising several suitable advertised vacancies. <br><br><img src="https://habrastorage.org/webt/ti/8z/r1/ti8zr1_a7qtzbqoit6lsmeloiww.jpeg"><br><br>  We made changes in design in very small parts in order to run experiments and understand in time if something we do causes a negative effect. <br><br><h2>  Finally </h2><br>  We are still measuring the effect of launching a smart search, but it is clear that in the first week after launch, the success of the search sessions of applicants reached a historical maximum.  It was one of the fastest and quietest projects to launch systems of this class - at least in my experience.  Largely due to the best team. <br><br>  Unfortunately, it is impossible to make the search engine once and for all so that it is perfectly looking for something that is constantly changing, and itself was completely unchanged.  Therefore, we continue to improve the search on HeadHunter to make users better.  In addition, there are many more areas in HeadHunter where ML, search technologies, as well as metrics and a / b tests will be useful. <br><br>  If you know how to search technology, machine learning and work with your hands - join.  We hire, see <a href="https://hh.ru/employer/1455">our vacancies</a> . </div><p>Source: <a href="https://habr.com/ru/post/347276/">https://habr.com/ru/post/347276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347264/index.html">ATM Security: Application Control Application Difficulties</a></li>
<li><a href="../347266/index.html">Making games in Python 3 and Pygame: Part 4</a></li>
<li><a href="../347268/index.html">As we inventories reduced. 500 million</a></li>
<li><a href="../347272/index.html">I hate constants in ruby</a></li>
<li><a href="../347274/index.html">Own DBMS for 3 weeks. You just need a little time every day ...</a></li>
<li><a href="../347278/index.html">Learning online programming - is everything as simple as it seems?</a></li>
<li><a href="../347280/index.html">[DotNetBook] Stack stream. Its editing and stream cloning</a></li>
<li><a href="../347282/index.html">How to write a diploma using three open projects</a></li>
<li><a href="../347284/index.html">About errors and exceptions</a></li>
<li><a href="../347286/index.html">Making games in Python 3 and Pygame: Part 5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>