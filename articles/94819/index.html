<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Nginx + IPv6</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently wrote a topic about IPv6 support in Windows 7 / Vista / XP (this is here ). I wanted to do IPv6 support on my server, where sites are hosted,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Nginx + IPv6</h1><div class="post__text post__text-html js-mediator-article">  Recently wrote a topic about IPv6 support in Windows 7 / Vista / XP (this is <a href="http://devosx.habrahabr.ru/blog/94774/">here</a> ).  I wanted to do IPv6 support on my server, where sites are hosted, in the end, that's what happened. <br><a name="habracut"></a><br>  I have a server under FreeBSD, used <a href="http://he.net/">HE.net</a> to get an IPv6 address on the server, here is the config for configuring this tunnel in <b>/etc/rc.conf</b> : <br><br><pre><code class="hljs objectivec">ipv6_gateway_enable=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> ipv6_enable=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> gif_interfaces=<span class="hljs-string"><span class="hljs-string">"gif0"</span></span> gifconfig_gif0=<span class="hljs-string"><span class="hljs-string">"_IP_ 72.52.104.74"</span></span> ipv6_ifconfig_gif0=<span class="hljs-string"><span class="hljs-string">"2001:470:1f04:***::2"</span></span> <span class="hljs-meta"><span class="hljs-meta">#  IPv6 ipv6_defaultrouter=</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"2001:470:1f04:***::1"</span></span></span><span class="hljs-meta"> #   HE.net  IPv6.</span></span></code> </pre> <br>  Now there was a question about web server support, IPv6 addressing.  I use a bunch of nginx + apache 2.2, here's an excerpt of the server in the nginx config: <br><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> default; <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> [::]:<span class="hljs-number"><span class="hljs-number">80</span></span> default; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> _; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /nginx_status { <span class="hljs-attribute"><span class="hljs-attribute">stub_status</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">access_log</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">allow</span></span> all; } <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://127.0.0.1:81; <span class="hljs-attribute"><span class="hljs-attribute">proxy_redirect</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Real-IP <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Forwarded-For <span class="hljs-variable"><span class="hljs-variable">$proxy_add_x_forwarded_for</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">client_max_body_size</span></span> <span class="hljs-number"><span class="hljs-number">10m</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">client_body_buffer_size</span></span> <span class="hljs-number"><span class="hljs-number">128k</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_connect_timeout</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_send_timeout</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_read_timeout</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_send_lowat</span></span> <span class="hljs-number"><span class="hljs-number">12000</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_buffer_size</span></span> <span class="hljs-number"><span class="hljs-number">4k</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_buffers</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">32k</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_busy_buffers_size</span></span> <span class="hljs-number"><span class="hljs-number">64k</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_temp_file_write_size</span></span> <span class="hljs-number"><span class="hljs-number">64k</span></span>; } <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~* \.(jpeg|jpg|gif|png|css|js|pdf|txt|tar|tar.gz|zip|ico|swf|rss)$</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">root</span></span> /usr/local/www/static/<span class="hljs-variable"><span class="hljs-variable">$host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">access_log</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">expires</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; } }</code> </pre><br>  As you can see, the <b>listen [::]</b> line has been added <b>: 80 default;</b>  .  This will enable your nginx to listen to all IPv6 addresses. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      By default, such an entry can be added to one server section.  The implication is probably the fact that in IPv6 each site will be on its IPv6 address. <br><br>  In order for each server {} to have its own IPv6 address, add the <b>listen [2001: 470: 1f04: *** :: 3]: 80</b> .  Naturally, such addresses should be alias for your main interface. <br><br>  Then you need to make an entry in the DNS of your domains that are hosted. <br><br>  I made a record like this: <br><br><pre> <code class="hljs css">* <span class="hljs-selector-tag"><span class="hljs-selector-tag">IN</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AAAA</span></span> 2001<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:470</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1f04</span></span>:***<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::2</span></span></code> </pre><br>  Because  I have all the domains on the same server and I didn‚Äôt bother with the issue of each IPv6 site, I just made: <br><br>  IPv6 Network -----------&gt; IPv6 ServerIP ---------&gt; proxying to 127.0.0.1 IPv4 (where Apache is spinning with the usual settings for IPv4). <br><br>  Total, having registered it, I received availability of all my domains from an IPv6 network. <br><br>  For each domain in the ServerAlias ‚Äã‚Äãapache I have assigned a subdomain ipv6.name_domera.ru.  Well, I created symbolic links for the domain in my design (see root / usr / local / www / static / $ host;).  In this folder I have symbolic links for all domains and subdomains on my server. <br><br>  PS Hurry many hosting providers and hosting panels began to support IPv6 out of the box.  Most domains could work there and there, then the transition to IPv6 would not be so painful. <br><br>  PS IPv6 traffic appeared on sites, probably due to the addition of sites that support IPv6 to directories. </div><p>Source: <a href="https://habr.com/ru/post/94819/">https://habr.com/ru/post/94819/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../94809/index.html">1972 Hydrogen Gremlin</a></li>
<li><a href="../94810/index.html">Software CPU Overclocking on Apple iPhone and iPod</a></li>
<li><a href="../94814/index.html">Evernote Web Client supports drag and drop files in Chrome and Safari</a></li>
<li><a href="../94816/index.html">I want a website or 5 steps of knowledge of Tao</a></li>
<li><a href="../94818/index.html">Office MFP - not just a free printer</a></li>
<li><a href="../94820/index.html">Show your best</a></li>
<li><a href="../94821/index.html">New ULV processors</a></li>
<li><a href="../94825/index.html">Opera mobile report: CIS statistics</a></li>
<li><a href="../94827/index.html">(Without) Competent newsletter</a></li>
<li><a href="../94831/index.html">Apple programmers are also no stranger to humor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>