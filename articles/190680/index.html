<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Airi - the cloud for the site</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, we launched a new service - a cloud for the site, iri.org . The cloud for a site is when the whole site is light, transparent, airy and fast...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Airi - the cloud for the site</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://xn--80aqc2a.xn--p1ai/"><img src="https://habrastorage.org/getpro/habr/post_images/183/29c/43c/18329c43c098c328de098522de65dd56.png" align="right"></a> <br>  Recently, we launched a new service - a cloud for the site, <a href="http://xn--80aqc2a.xn--p1ai/">iri.org</a> .  The cloud for a site is when the whole site is light, transparent, airy and fast.  No pictures, scripts, complex server logic, databases and no DDoS can drop it.  This is when the site flies.  We have realized our dream - now any site, regardless of the platform, internal features or client logic, can be put into the cloud.  And it will work faster and more reliably on all devices and for all users.  And it is available for both the smallest sites, and for the largest. <br><br>  Yes, it looks like western CloudFlare.  And we have the same original model.  But only in the open spaces of Russia, according to its geography.  And we plan to develop differently. <br><br>  PS Now <a href="http://xn--80aqc2a.xn--p1ai/">Airi is</a> in beta stage, we are <a href="http://xn--80aqc2a.xn--p1ai/cost">actively recruiting the first users</a> , although the service has already moved into commercial operation, and reliability is a priority. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h2>  Architecture </h2><br>  Initially, we planned to make several components of the service, maximally dividing the levels of responsibility.  But later, due to various restrictions on data integrity and system resiliency, we got to the following architecture: <br><br>  The entire service is divided into geographically independent nodes, users are directed to a particular node, depending on the IP address and DNS record.  DNS records are geo-balanced (if any node fails, we can redirect local users to another node for a short period of time). <br><ol><li>  DNS layer.  Each node is a pair of servers configured with LVS for maximum resiliency.  Additionally, zones on different DNS servers respond differently for different regions, creating geo-balancing. </li><li>  Balancing Layer (LVS).  The main machines that take on all the load.  They are also intended to connect to DDoS protection and redistribute requests to different FEO-CDN servers, depending on the site domain. </li><li>  FEO-CDN layer (from Front-End Optimization and Content Delivery Network).  Each node is a caching and optimizing cluster of proxy servers.  Over the architecture of this layer, we thought for a long time, and we continue to think about how to optimize as much as possible the work of the site and the load on the servers.  Currently we have 4 levels of caching and proxying: <br><ol><li>  Front-end level, only compresses (via gzip) content and caches the final HTML pages of the site, if necessary.  If the query is not in the cache, then proxy them further.  Collects statistics on the given content. </li><li>  Optimizing level.  <a href="https://github.com/pagespeed/ngx_pagespeed" rel="nofolllow">Page Speed ‚Äã‚Äãis</a> deployed here with some of our improvements in deferred loading and dynamic page caching.  The most difficult level in terms of the algorithms used.  All non-cache requests are sent to a lower level. </li><li>  Caching level  Caches all static and, if possible, dynamic.  Returns everything from the cache, if it can.  If not, it requests the source site.  It also logs low-level queries and provides unpacking (unzip) of data from the source site. </li></ol></li></ol><br><br><h2>  Balancing and failover </h2><br>  During the implementation, we considered several failure scenarios of the service (or site).  I will give some basic ones: <br><ol><li>  The DNS layer of a host fails - the second one of the LVS pair is connected.  If both servers fail, then DNS queries (exactly the same content) begin to respond to the DNS layers of the other nodes. </li><li>  Both servers fail to LVS-pair balancing layer of any node.  In this case, requests for DNS balancing are automatically sent to other nodes. </li><li>  Fails (overloaded) FEO-CDN layer - automatically connect additional spare servers on this layer.  If there are no servers available, then we act according to the previous scenario - we transfer sites to another node. </li><li>  The channel (DDoS) is overloaded on one or several nodes - we automatically connect <a href="http://qrator.net/">QRator</a> for ‚Äúproblem‚Äù balancing layers. </li><li>  Source site fails (becomes unavailable).  If the site is cached and the period of inaccessibility is less than the lifetime of the cache, then users do not notice anything.  If the period of unavailability is less than a day, then we continue to issue the site pages from the cache.  For dynamic sites, an individual policy (stub pages, cached content, or redirection). </li></ol><br>  The main problem areas and risks are eliminated by the architecture, so we can talk about fault tolerance of 99.9%. <br><br><h2>  How acceleration works </h2><br>  The most difficult and interesting is how acceleration works.  We analyzed the available Page Speed ‚Äã‚Äãfilters, collected several options from them that are suitable for most sites.  And they called the acceleration levels accordingly: Safe (when no harm is guaranteed to the site), Minimal (when there are minimal risks to harm the site), Optimal (suitable for most sites, provides significant acceleration, but potentially dangerous) and Maximum (the most risky and the most effective option).  In addition, we also offer manual configuration of all parameters, if necessary (in full accordance with the existing policy of setting up our product - <a href="http://www.webogroup.com/ru/home/site-speedup/">WEBO Site SpeedUp</a> ). <br><br>  I emphasize that by default all static site objects are permanently cached, and all text objects are reliably archived.  In addition, file merging, inclusion of small objects in page content, delayed loading logic and Local Storage, as well as the use of multiple domains and data: URI for images are available.  In general, full stuffing for those who want to customize everything.  And a guaranteed level of speed and reliability of the site for everyone else. <br><br>  In conjunction with geo-balancing requests (site visitors receive site objects from the server closest to them), we solve all problems with the site speed ‚Äúin one click‚Äù. <br><br><h2>  Tariffs </h2><br>  We are as friendly as possible to users - and we offer tariffs from free (included 50 GB of outgoing traffic per month) to maximum (from 50 thousand rubles).  The average site can connect for 1000-2000 rubles per month (this includes 100-250 GB of traffic per month, up to 100 thousand users per month is enough). <br><br><h2>  Connection </h2><br>  There are two main types of connections: through changing DNS servers and via CNAME, a synonym for www.  In the first case, we connect domains that are accessible only without www (for example, iri.rf) - you need to delegate the domain to our servers so that we can fully manage geo-balancing. <br><br>  The second type of connection is suitable for sites that are accessible only through www or both.  In the latter case, you need to redirect from the site without www to the site with www and create a DNS record for the site <br><pre>  www IN CNAME cloud.airee.ru. </pre><br>  After that, the site will be served through the cloud. <br><br>  Of course, all these actions need to be performed <a href="http://xn--80aqc2a.xn--p1ai/cost">after sending the application</a> .  We do not serve all domains of the Runet yet :) <br><br>  In the very near future, a personal account will appear for managing the cloud. <br><br>  I will be glad to questions and comments.  Our goal is to make <a href="http://xn--80aqc2a.xn--p1ai/">Airi a</a> de facto standard when hosting websites on the Runet. </div><p>Source: <a href="https://habr.com/ru/post/190680/">https://habr.com/ru/post/190680/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../190666/index.html">PRIMERGY RX900 S2: Fujitsu monolithic 8-processor server</a></li>
<li><a href="../190668/index.html">Android Intents Library</a></li>
<li><a href="../190672/index.html">Everything I need to know to be a good programmer, I learned in kindergarten</a></li>
<li><a href="../190674/index.html">In the incubator, the story of a startup</a></li>
<li><a href="../190676/index.html">BMW Concept i8 Laser Lights</a></li>
<li><a href="../190682/index.html">Deobfuscation of one malicious code</a></li>
<li><a href="../190690/index.html">Checklist for overcoming the CAP-theorem</a></li>
<li><a href="../190692/index.html">Microsoft integrates Skype with Outlook.com</a></li>
<li><a href="../190694/index.html">Ways to present dictionaries for automatic text processing</a></li>
<li><a href="../190700/index.html">YAMD: another bike to describe modules in JS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>