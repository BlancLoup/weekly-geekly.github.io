<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Command infrastructure for the user to invoke actions in the MVVM pattern</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imagine a typical user interface. There are several controls that run some repeated (during the life of the application) actions of varying complexity...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Command infrastructure for the user to invoke actions in the MVVM pattern</h1><div class="post__text post__text-html js-mediator-article">  Imagine a typical user interface.  There are several controls that run some repeated (during the life of the application) actions of varying complexity.  In order for complex actions, such as accessing various media, accessing the network, or complex computation, to reduce the responsiveness of the interface, they must be asynchronous.  Additionally, there may be controls that cancel an asynchronously started action.  The action has a state property (inactive, started, completed successfully, completed with an error, canceled), which is somehow displayed to the user.  The <a href="http://ru.wikipedia.org/wiki/Model-View-ViewModel">MVVM</a> design pattern adopted in WPF, Silverlight and WinPhone dictates that such an ‚Äúaction‚Äù be part of the presentation model, making it possible to invoke model services from the user interface without creating a hard link between them.  Unfortunately, this "action" in the base class library is not implemented.  The closest entities in the library, such as <b>System.Threading.Tasks.Task</b> tasks, <b>System.Windows.Input.ICommand</b> commands and <b>System.Delegate</b> delegates, are not suitable: tasks are always one-time and cannot represent a repeatable action, delegates and commands do not support cancellation and do not contain state properties, and commands in general cannot be asynchronous.  Next, I propose a solution in the form of a small class library, making it possible to easily use the described "actions" in your applications. <br><a name="habracut"></a><br>  To begin with, we summarize our requirements. <br><br>  User Requirements: <br><ul><li>  No running action (as well as canceling an action) blocks the user interface. </li><li>  Long-running action can be undone. </li><li>  Actions can be mutually exclusive (for example: loading and saving).  For such actions, only one of the group can be started. </li><li>  For a group of actions, a single user interface element can be used to cancel them, which will cancel everything that is running from the group. </li><li>  User interface elements for starting and canceling actions display the availability of the corresponding operations, preventing the restart of the running or canceling of the not running action. </li></ul><br>  Application Developer Requirements: <br><ul><li>  Starting and canceling actions should be represented by <b>ICommand</b> commands for linking to user interface elements. </li><li>  The context action must allow binding to many user interface elements (for example, one context menu is called for many list items).  For this action must take a context parameter that is specified in relation to the elements of the user interface. </li><li>  Actions should receive a Cancel request token parameter ( <b>CancellationToken</b> ) that allows them to respond to cancellation requests. </li></ul><br>  Common MVVM design pattern requirements: <br><ul><li>  A view consists of XAML only and does not contain code. </li><li>  In the view model, there are no references to the view and the classes that are specific to the view. </li></ul><br>  None of the solutions found on the Internet satisfies all the listed requirements.  View <a href="http://habrahabr.ru/post/196960/">Commands in MVVM</a> , <a href="http://brettedotnet.wordpress.com/2011/11/28/relaycommand-yes-another-one/">RelayCommand Yes Another One!</a>  , <a href="http://www.codeproject.com/Articles/320762/Asynchronous-WPF-Command">Asynchronous WPF Command</a> , <a href="http://cisart.wordpress.com/2013/10/10/wpf-commands-and-async-commands/">WPF Commands and Async Commands</a> and the closest one for the requirements. <a href="http://msdn.microsoft.com/ru-ru/magazine/dn630647.aspx">Templates for asynchronous MVVM applications: commands</a> .  Interestingly, all the solutions found have the same illogicality: they are centered around commands, adding a completely alien asynchrony to the <b>ICommand</b> interface.  From my point of view, it is much more logical to push off from tasks (Task), making them repeatable and adding to them the necessary commands, such as ‚Äústart‚Äù, ‚Äúcancel‚Äù or ‚Äúpause‚Äù. <br><br>  The following entities are implemented in my library.  The <a href="">RepeatableTask</a> class is a repeatable task that is self-contained and in no way associated with the MVVM template, or in general with the user interface.  The RepeatableTask constructor specifies a synchronous or asynchronous method that will be executed when the task is started.  The purpose of the Start () and Cancel () methods is obvious.  The TaskStarting, TaskStarted, and TaskEnded events allow you to set event-life event handlers for the task to be repeated. <pre><code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> RepeatableTask : IDisposable { //    RepeatableTask   //     . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> RepeatableTask (Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, CancellationToken, Task&gt; taskFactory); //    RepeatableTask   //     . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> RepeatableTask (Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, CancellationToken&gt; taskAction, TaskScheduler taskScheduler = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); //  <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>      ,  <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> IsRunning { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } //      . //    . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> state); //     . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> Cancel (); //    . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> Dispose (); //    . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> event EventHandler&lt;DataEventArgs&lt;CompletedTaskData&gt;&gt; TaskEnded; //    . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> event EventHandler&lt;DataEventArgs&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;&gt; TaskStarted; //   ,   . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> event EventHandler&lt;TaskStartingEventArgs&gt; TaskStarting; }</code> </pre> <br>  In the <a href="">CommandedRepeatableTask</a> class inherited from RepeatableTask, start and cancel commands are added that can be used to bind to the user interface. <pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> CommandedRepeatableTask : RepeatableTask, INotifyPropertyChanged { //    CommandedRepeatableTask //       . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> CommandedRepeatableTask (Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, CancellationToken, Task&gt; taskFactory); //    CommandedRepeatableTask //       . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> CommandedRepeatableTask (Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, CancellationToken&gt; taskAction, TaskScheduler taskScheduler); //    . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ChainedRelayCommand&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; StartCommand { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } //    . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ChainedRelayCommand StopCommand { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } //    . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> event PropertyChangedEventHandler PropertyChanged; //          . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> CommandedRepeatableTask CreateLinked (Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, CancellationToken, Task&gt; taskFactory); //          . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> CommandedRepeatableTask CreateLinked (Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, CancellationToken&gt; taskAction, TaskScheduler taskScheduler); }</code> </pre> <br>  <a href="">ChainedRelayCommand</a> commands <a href="">are</a> based on the widespread <a href="http://msdn.microsoft.com/ru-ru/magazine/dd419663.aspx">RelayCommand</a> and are supplemented by support for <a href="http://msdn.microsoft.com/ru-ru/magazine/dd419663.aspx">chaining</a> to form groups of interrelated (in terms of user interface) actions. <pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ChainedRelayCommand : ICommand { //     ChainedRelayCommand //         //       . //        . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ChainedRelayCommand (Action <span class="hljs-keyword"><span class="hljs-keyword">execute</span></span>, Func&lt;<span class="hljs-type"><span class="hljs-type">bool</span></span>&gt; canExecute = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); //     ChainedRelayCommand //     ,   //         //      . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ChainedRelayCommand (CommandChain commandChain, Action <span class="hljs-keyword"><span class="hljs-keyword">execute</span></span>, Func&lt;<span class="hljs-type"><span class="hljs-type">bool</span></span>&gt; canExecute = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); //    ,    . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> CommandChain Chain { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } //      . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> parameter); //             <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> CanExecute (<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> parameter); //   CanExecuteChanged     . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> RaiseCanExecuteChanged (); //    ,      . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> event EventHandler CanExecuteChanged; }</code> </pre> <br>  The <a href="">CommandChain</a> class contains a list of combined commands and parameters for their joint execution. <pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> CommandChain { //     RelayCommandChain //       . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> CommandChain (<span class="hljs-type"><span class="hljs-type">bool</span></span> executionChained, ExecutionAbilityChainBehavior canExecuteChainBehavior); //      //       . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ExecutionAbilityChainBehavior ExecutionAbilityChainBehavior { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } //         . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> ExecutionChained { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } //       . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> SingleLinkedListNode&lt;ChainedCommandBase&gt; FirstCommand { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } //     . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Add</span></span> (ChainedCommandBase command); //  . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> Clear (); }</code> </pre> <br>  It is easy to use the described entities, especially for those who work with the MVVM pattern and are already familiar with the RelayCommand.  To create simple actions that do not need to be performed asynchronously (for example, sorting a list by clicking on its header), use the ChainedRelayCommand as well as the RelayCommand.  Create a command by specifying the method of the model that performs the sort.  You expose the command as a property of the view model. <pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AppViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ChainedRelayCommand&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; _sortListCommand; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ChainedRelayCommand&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; SortListCommand { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _sortListCommand; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AppViewModel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _sortListCommand = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChainedRelayCommand&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; (arg =&gt; SortList ((<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)arg)); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SortList</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> column</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//      column }</span></span></code> </pre> <br>  In the view for the desired control for the Command property, specify a binding to the created property of the view model.  For the mentioned case of sorting by clicking on the header of the list, it makes sense for each column to specify the same command, but apart from the Command, specify the property CommandParameter with the value by which to do the sorting. <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListView</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListView.View</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GridView</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GridView.Columns</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GridViewColumn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GridViewColumnHeader</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding SortListCommand}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CommandParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ID"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ID"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GridViewColumn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GridViewColumn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GridViewColumnHeader</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding SortListCommand}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CommandParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GridViewColumn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GridView.Columns</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GridView</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListView.View</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListView</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  For an action that requires asynchronous execution, create a RepeatatableTask repeatable task, specifying the model method.  The task is set as a property of the view model.  If actions form a mutually exclusive group, after creating the first action, the second and subsequent actions are not created through the constructor, but through a call to the CreateLinked method of the first action.  Actions in a group (chain) use as well as single.  At the same time, the availability of a start command (StartCommand) of each action will depend on the status of other actions of the group.  And the cancellation command (StopCommand) of any of them will behave in the same way (cancel any of the running actions of the group). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AppViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> CommandedRepeatableTask _workTask1; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> CommandedRepeatableTask _workTask2; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> CommandedRepeatableTask _workTask3; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> BusinessLogicService _businessLogicService; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CommandedRepeatableTask WorkTask1 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _workTask1; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CommandedRepeatableTask WorkTask2 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _workTask2; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CommandedRepeatableTask WorkTask3 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _workTask3; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AppViewModel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BusinessLogicService businessLogicService</span></span></span><span class="hljs-function">)</span></span> { _businessLogicService = businessLogicService; _workTask1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CommandedRepeatableTask (_businessLogicService.Work1, TaskScheduler.Default); _workTask2 = _workTask1.CreateLinked (_businessLogicService.Work2, TaskScheduler.Default); _workTask3 = _workTask1.CreateLinked (_businessLogicService.Work3, TaskScheduler.Default); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BusinessLogicService</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Work1</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> state, CancellationToken cancellationToken</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Work2</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> state, CancellationToken cancellationToken</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Work3</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> state, CancellationToken cancellationToken</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre><br><br>  In the view, you bind the properties of the StartCommand and StopCommand tasks to the corresponding controls. <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding WorkTask1.StartCommand}"</span></span></span><span class="hljs-tag">&gt;</span></span>Work1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding WorkTask2.StartCommand}"</span></span></span><span class="hljs-tag">&gt;</span></span>Work2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding WorkTask3.StartCommand}"</span></span></span><span class="hljs-tag">&gt;</span></span>Work3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding WorkTask1.StopCommand}"</span></span></span><span class="hljs-tag">&gt;</span></span>Cancel<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Summarize.  The created CommandedRepeatableTask class satisfies all the listed requirements for ‚Äúactions‚Äù and additionally provides the following amenities: <br><ul><li>  It is constructed on the basis of methods in both simple synchronous syntax and in async / await syntax. </li><li>  When running synchronous methods asynchronously, they can be executed in the desired execution thread or synchronization context.  For example, actions with a shell (Shell) or clipboard (Clipboard) usually require execution in a stream with ApartmentState.STA. </li><li>  Cancellation request tokens are created automatically for each launch of each action. </li><li>  The provided cancel command initiates a cancel request for the token with which the action is started. </li><li>  The provided start and cancel commands reflect the status of the action in the <b>ICommand</b> method.  <b>CanExecute ()</b> and <b>ICommand</b> events are automatically generated.  <b>CanExecuteChanged</b> when the state of the action changes. </li><li>  Allows you to assign preventive measures that may cancel the launch of the action or provide an additional parameter for it (for example, ask for confirmation before the responsible action or request the name of the file with which the action will work).  In order to be able to create new views, a precautionary event is performed in the same thread (context) from which the launch of the action is initiated. </li><li>  Allows you to assign preparatory activities that will be launched before the start of the action.  In order to be able to create new views (for example, the progress window), the preparatory event is performed in the same thread (context) from which the launch of the action was initiated. </li><li>  Allows you to assign logging events that will run after the action is completed, even if it is canceled or caused an exception.  The logging event receives the status of the action and an exception with the argument.  To be able to create new views (for example, an action error window), the recording event is performed in the same thread (context) from which the launch of the action was initiated. </li></ul><br>  The library is created as a Portable Class Library Profile259 (.NET Framework 4.5, Windows 8, Windows Phone 8.1, Windows Phone Silverlight 8).  For building under the .NET Framework 4 a separate project has been added, which consists only of references to the source code of the main one.  The example project shows various ways to use the library in a WPF application: in the toolbar buttons, in the main menu items, in the context menu items of the list entries, and in the list headers (to sort it).  The solution with all the projects listed is uploaded to the <a href="https://github.com/novar0/RepeatableTask">public repository on github</a> .  The assembly ready for use is laid out in the form of a <a href="https://www.nuget.org/packages/RepeatableTask">nuget-package</a> .  Happy programming! </div><p>Source: <a href="https://habr.com/ru/post/242073/">https://habr.com/ru/post/242073/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242063/index.html">The White House is thinking about choosing a new data center for its infrastructure</a></li>
<li><a href="../242065/index.html">Organization of cellular communication in the subway - the experience of St. Petersburg</a></li>
<li><a href="../242067/index.html">Localized date formatting in Laravel</a></li>
<li><a href="../242069/index.html">Binary Serialization in Unity 3D / Visual Studio Application</a></li>
<li><a href="../242071/index.html">Runet in pictures XVIII. Bank cards in Russia and the world</a></li>
<li><a href="../242075/index.html">How to deploy web sites in Microsoft Azure?</a></li>
<li><a href="../242077/index.html">Query Builder library for working with SphinxQL</a></li>
<li><a href="../242079/index.html">Professional Invisibility: A fun way to get covered with moss from boredom</a></li>
<li><a href="../242081/index.html">Terrasoft CRM: Developer's Guide</a></li>
<li><a href="../242083/index.html">Amazon + Ansible</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>