<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic fluid interface and ArrayIterator in PHP models</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This method does not claim originality, but it seems to me that it can be useful in understanding the principles of operation of such systems (see, fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic fluid interface and ArrayIterator in PHP models</h1><div class="post__text post__text-html js-mediator-article">  This method does not claim originality, but it seems to me that it can be useful in understanding the principles of operation of such systems (see, for example, <a href="http://docs.magentocommerce.com/Varien/Varien_Object/Varien_Object.html">Varien_Object</a> , written by the Magento developers, the idea was taken primarily from there) and may be useful in projects where I do not really want to connect heavy frameworks, but I need to somehow systematize the code. <br><br>  It is difficult to imagine a fairly large project in which there would be no work with data models.  I will say more: in my experience, about three-quarters of the entire code is creating, loading, modifying, saving or deleting records.  Whether it is a user registration, the conclusion of the last ten articles or work with the admin - all this is minor work with the basic operations of the models.  And, accordingly, such code should be written and read quickly and should not clog the programmer‚Äôs head with technical details: he (the programmer) should think about the logic of the application, and not about the next UPDATE request. <br><a name="habracut"></a><br><h4>  Instead of the preface </h4><br>  In my opinion, to make the code easy to read, it (besides, of course, the coding standards and the understandability of algorithms) should be as close as possible to natural language.  Download this product, set this name for it, set such a price, save it.  In addition, if it is possible to avoid repetition in the code, be it a piece of code or just the name of a variable (when working with one object), then it should be avoided.  In my case, the ‚Äúflowing interface‚Äù saved me from constantly tedious copying of the variable name. <br><br><h4>  Fluid interface </h4><br>  It would be logical to separate flies from cutlets and bring the ‚Äúflowing interface‚Äù into a separate class, in case it needs to be used not only in models: <br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Core_Fluent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayObject</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Before starting to write, I decided how I want to see the final code that I will use.  It turned out this: <br><pre> <code class="php hljs">$instance-&gt;load($entity_id) -&gt;setName(<span class="hljs-string"><span class="hljs-string">'Foo'</span></span>) -&gt;setDescription(<span class="hljs-string"><span class="hljs-string">'Bar'</span></span>) -&gt;setBasePrice(<span class="hljs-number"><span class="hljs-number">250</span></span>) -&gt;save();</code> </pre><br>  At the same time, I wanted the data to be stored with keys of the form ‚Äúname‚Äù, ‚Äúdescription‚Äù, ‚Äúbase_price‚Äù (this would make it much easier to implement interaction with the database, and my coding standard would require it). <br><br>  In order not to write the same type methods in each model, you should use ‚ÄúMagic Methods‚Äù ( <a href="http://php.net/manual/ru/language.oop5.magic.php">Magic Methods</a> ), in particular, the <a href="http://www.php.net/manual/ru/language.oop5.overloading.php">__call ()</a> method.  You could also use the <a href="http://www.php.net/manual/ru/language.oop5.overloading.php">__get ()</a> and <a href="http://www.php.net/manual/ru/language.oop5.overloading.php">__set ()</a> methods, but I went through using the <a href="http://www.php.net/manual/ru/class.arrayiterator.php">ArrayIterator</a> . <br><br>  So, the <b>__call</b> method, which will determine what was caused and what to do next: <br><pre> <code class="php hljs">... <span class="hljs-comment"><span class="hljs-comment">//     CamelCase  __ //      StackOverflow,       const PREG_CAMEL_CASE = '/(?&lt;=[AZ])(?=[AZ][az])|(?&lt;=[^AZ])(?=[AZ])|(?&lt;=[A-Za-z])(?=[^A-Za-z])/'; //      protected $_data = array(); public function __call($method_name, array $arguments = array()) { //   ,    ,      //        (setBasePrice    set  BasePrice) if(!preg_match('/^(get|set|isset|unset)([A-Za-z0-9]+)$/', $method_name, $data)) { //    ,    throw new Core_Exception('Method '.get_called_class().'::'.$method_name.' was not found'); } //        (BasePrice =&gt; base_price)    $property $property = strtolower(preg_replace(self::PREG_CAMEL_CASE, '_$0', $data[2])); //   ,      switch($data[1]) { case 'get': { // $object-&gt;getBasePrice():    return $this-&gt;get($property); } break; case 'set': { // $object-&gt;setBasePrice():    return $this-&gt;set($property, $arguments[0]); } break; case 'unset': { // $object-&gt;getBasePrice():     return $this-&gt;_unset($property); } break; case 'isset': { // $object-&gt;getBasePrice(): ,       return $this-&gt;_isset($property); } break; default: { } } // ,    ,   ,    " " return $this; } ...</span></span></code> </pre><br><br><h4>  <b>Get</b> , <b>set</b> , <b>_isset,</b> and <b>_unset methods</b> </h4><br>  The implementation of these methods is not difficult, their action is obvious from the name: <br><pre> <code class="php hljs">... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($code)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_isset($code)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_data[$code]; } <span class="hljs-comment"><span class="hljs-comment">//     ,      NULL return NULL; } public function set($code, $value) { $this-&gt;_data[$code] = $value; return $this; } public function _unset($code) { unset($this-&gt;_data[$code]); return $this; } public function _isset($code) { return isset($this-&gt;_data[$code]); } ...</span></span></code> </pre><br><br><h4>  ArrayIterator </h4><br>  In addition to the above-mentioned approach, I decided to add the ability to work with an object as with a normal associative (and not only, but this is another story) array: for this there is an <a href="http://www.php.net/manual/ru/class.arrayiterator.php">ArrayIterator</a> .  Of course, it was more correct to call the methods described in the previous section, so that it would not have to be duplicated, but, first, there was already a need to think about backward compatibility, because there was code using these methods directly and there was quite a lot of it, but second, in my opinion, one thing is the implementation of the ArrayIterator, and the other is the implementation of the fluid interface. <br><br><pre> <code class="php hljs">... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetExists</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_isset($offset); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetUnset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_unset($offset); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetGet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get($offset); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset, $value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;set($offset, $value); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIterator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Core_Fluent_Iterator(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_data); } ...</code> </pre><br>  And, accordingly, the class <b>Core_Fluent_Iterator</b> : <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Core_Fluent_Iterator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayIterator</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br><br>  Everything.  Now with any class inherited from Core_Fluent such manipulations are available: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Some_Class</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Core_Fluent</span></span></span><span class="hljs-class"> </span></span>{} $instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Some_Class(); $instance-&gt;set(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'Foo'</span></span>)-&gt;setDescription(<span class="hljs-string"><span class="hljs-string">'Bar'</span></span>)-&gt;setBasePrice(<span class="hljs-number"><span class="hljs-number">32.95</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $instance-&gt;getDescription(), PHP_EOL; <span class="hljs-comment"><span class="hljs-comment">// Bar echo $instance['base_price'], PHP_EOL; // 32.95 echo $instance-&gt;get('name'), PHP_EOL; // Foo // name =&gt; Foo // description =&gt; Bar // base_price =&gt; 32.95 foreach($instance as $key =&gt; $value) { echo $key, ' =&gt; ', $value, PHP_EOL; } var_dump($instance-&gt;issetBasePrice()); // true var_dump($instance-&gt;issetFinalPrice()); // false var_dump($instance-&gt;unsetBasePrice()-&gt;issetBasePrice()); // false</span></span></code> </pre><br><br><h4>  Model </h4><br>  Now the model itself, a special case of application of the above mechanism. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Core_Model_Abstract</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Core_Fluent</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br><br>  First you need to add the basis for CRUD (create, load, modify and delete).  The logic (work with the database, files and anything else) will be lower in the hierarchy, here you need to do only the most basic: <br><br><pre> <code class="php hljs">... <span class="hljs-comment"><span class="hljs-comment">//   ,    protected $_changed_properties = array(); // .   save()        //      ,     //     (   ) public function create() { return $this; } //  public function load($id) { $this-&gt;_changed_properties = array(); return $this; } //    public function loadFromArray(array $array = array()) { $this-&gt;_data = $array; return $this; } //  public function save() { $this-&gt;_changed_properties = array(); return $this; } //  public function remove() { return $this-&gt;unload(); } //    public function unload() { $this-&gt;_changed_properties = array(); $this-&gt;_data = array(); return $this; } //     public function toArray() { return $this-&gt;_data; } ...</span></span></code> </pre><br>  Finally, override <b>set ()</b> by adding an array of changed properties. <br><pre> <code class="php hljs">... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($code, $value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_changed_properties[] = $code; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::set($code, $value); } ...</code> </pre><br>  Now from this class you can inherit various adapters to databases, files or APIs, from which, in turn, inherit the already final data models. <br><br>  The full code of all three files under the spoiler. <br><div class="spoiler">  <b class="spoiler_title">Full code of all three files</b> <div class="spoiler_text">  <b>Core / Fluent.php</b> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Core_Fluent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayObject</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PREG_CAMEL_CASE = <span class="hljs-string"><span class="hljs-string">'/(?&lt;=[AZ])(?=[AZ][az])|(?&lt;=[^AZ])(?=[AZ])|(?&lt;=[A-Za-z])(?=[^A-Za-z])/'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_data = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($method_name, array $arguments = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!preg_match(<span class="hljs-string"><span class="hljs-string">'/^(get|set|isset|unset)([A-Za-z0-9]+)$/'</span></span>, $method_name, $data)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Core_Exception(<span class="hljs-string"><span class="hljs-string">'Method '</span></span>.get_called_class().<span class="hljs-string"><span class="hljs-string">'::'</span></span>.$method_name.<span class="hljs-string"><span class="hljs-string">' was not found'</span></span>); } $property = strtolower(preg_replace(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::PREG_CAMEL_CASE, <span class="hljs-string"><span class="hljs-string">'_$0'</span></span>, $data[<span class="hljs-number"><span class="hljs-number">2</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>($data[<span class="hljs-number"><span class="hljs-number">1</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'get'</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get($property); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'set'</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;set($property, $arguments[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'unset'</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_unset($property); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'isset'</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_isset($property); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: { } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($code)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_isset($code)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_data[$code]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($code, $value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_data[$code] = $value; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_unset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($code)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_data[$code]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_isset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($code)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_data[$code]); } <span class="hljs-comment"><span class="hljs-comment">/** * Implementation of ArrayIterator */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetExists</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_isset($offset); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetUnset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_unset($offset); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetGet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get($offset); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset, $value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;set($offset, $value); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIterator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Core_Fluent_Iterator(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_data); } } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  <b>Core / Fluent / Iterator.php</b> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Core_Fluent_Iterator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayIterator</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  <b>Core / Model / Abstract.php</b> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Core_Model_Abstract</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Core_Fluent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_changed_properties = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($code, $value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_changed_properties[] = $code; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::set($code, $value); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_changed_properties = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadFromArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $array = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_data = $array; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_changed_properties = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;unload(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_changed_properties = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_data = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_data; } } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br></div></div><br><br><h4>  Instead of conclusion </h4><br>  It turned out quite voluminous, but mainly because of the code.  If this topic is interesting, then I can describe the implementation of the collection (some sort of record array with the ability to load with filtering and collective (batch) actions) on the same mechanism.  Both collections, and these models are taken from the framework I am developing, therefore, it is more correct to consider them in a complex, but I did not overload the already voluminous article. <br>  Of course, I will be glad to hear your opinion or reasoned criticism. </div><p>Source: <a href="https://habr.com/ru/post/185896/">https://habr.com/ru/post/185896/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../185882/index.html">More about the evolution of racing cars</a></li>
<li><a href="../185886/index.html">NAT traversal with IPv6 & CloudFlare</a></li>
<li><a href="../185888/index.html">Reliable (non-extreme) overclocking of the processor and memory for ASUS motherboards with an i7 processor</a></li>
<li><a href="../185890/index.html">Multi-file storage of Java objects in xml format</a></li>
<li><a href="../185894/index.html">mogenerator for Core Data you need to know about</a></li>
<li><a href="../185898/index.html">Sip via Wi-Fi + UniFi. Experience of use and modernization</a></li>
<li><a href="../185900/index.html">Obesity on the web. A little bit personal about browser development trends.</a></li>
<li><a href="../185902/index.html">Microsoft released another set of updates, July 2013</a></li>
<li><a href="../185904/index.html">Vacation in Cyprus and great things</a></li>
<li><a href="../185906/index.html">Launch vehicle launch statistics in the USSR and the Russian Federation: part two. East</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>