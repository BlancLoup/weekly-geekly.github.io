<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>$ mol_app_calc: Spreadsheet Party</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, my name is Dmitry Karlovsky and I ... I love math. Once I couldn‚Äôt sleep and I filed a service for the same repulsed as I - lightweight spreads...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>$ mol_app_calc: Spreadsheet Party</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello, my name is Dmitry Karlovsky and I ... I love math.  Once I couldn‚Äôt sleep and I filed a service for the same repulsed as I - <a href="http://mol.js.org/app/calc/">lightweight spreadsheet with custom formulas, sharing and downloading</a> . </p><br><p>  A live example with the calculation of the loan: </p><br><p> <a href="http://mol.js.org/app/calc/"><img src="https://habrastorage.org/webt/59/cb/32/59cb32b6067dc169333525.png" alt="Credit calculator"></a> </p><br><p>  And then I'll tell you how to create the same for the evening using the <a href="https://github.com/eigenmethod/mol">$ mol framework</a> ... </p><a name="habracut"></a><br><h1 id="eto-chto-za-pokemon">  What is this pokemon? </h1><br><p>  <a href="https://github.com/eigenmethod/mol">$ mol</a> is a modern framework for quickly creating cross-platform responsive web applications.  It is based on the <a href="https://github.com/eigenmethod/mam">MAM</a> architecture setting the following rules for all modules: </p><br><ul><li>  A module is a directory containing source codes. </li><li>  Source codes can be in a variety of languages. </li><li>  All languages ‚Äã‚Äãare equal within the module. </li><li>  Modules can form a hierarchy. </li><li>  The module name strictly corresponds to the path to it in the file system. </li><li>  There may be dependencies between modules. </li><li>  Information about the dependencies of the module is obtained by static analysis of its source codes. </li><li>  Any module can be assembled as a set of independent bundles in different languages ‚Äã‚Äã(js, css, tree ...). </li><li>  Only those modules that are actually used fall into the bundles. </li><li>  All source codes of the module are included in the bundle. </li><li>  Modules have no versions - the actual code is always used. </li><li>  The module interface should be open for expansion, but closed for modification. </li><li> If you need a different interface, you need to create a new module.  For example, <code>/my/file/</code> and <code>/my/file2/</code> .  This allows you to use both interfaces without confusing them. </li></ul><br><h1 id="rabochee-okruzhenie">  Work environment </h1><br><p>  Starting $ mol is easy.  Once you unfold the working environment and then rivet the applications / libraries like patties. </p><br><p>  First you need to install: </p><br><ul><li>  <a href="https://git-scm.com/">Git</a> </li><li>  <a href="https://nodejs.org/en/">Nodejs</a> </li><li>  Any editor.  Recommended: <a href="https://code.visualstudio.com/">VSCode</a> </li><li>  <a href="">Editor plugin for highlighting tree syntax.</a> </li><li>  Editor plugin to support <a href="http://editorconfig.org/">EditorConfig</a> . </li></ul><br><p>  If you are working under Windows, then you should configure GIT so that it does not change the line ends in your source code: </p><br><pre> <code class="hljs lua">git <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> <span class="hljs-comment"><span class="hljs-comment">--global core.autocrlf input</span></span></code> </pre> <br><p>  Now you need to deploy a MAM project that will automatically bring you a development server: </p><br><pre> <code class="hljs sql">git clone https://github.com/eigenmethod/mam.git cd mam npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> npm <span class="hljs-keyword"><span class="hljs-keyword">start</span></span></code> </pre> <br><p>  Everything, the developer's server is running, you can open the editor.  Please note that in the editor you need to open the MAM project directory, and not the project of a specific application or your company. </p><br><p>  As you can see, it‚Äôs very easy to start developing at $ mol.  The basic principle of MAM architecture - out of the box everything should work as it should, and not require a long tedious setting. </p><br><h1 id="karkas-prilozheniya">  Application framework </h1><br><p>  For conspiracy, our application will have the call sign <code>$mol_app_calc</code> .  According to the MAM rules, it should be placed in the <code>/mol/app/calc/</code> directory, respectively.  All the files in the future we will create there. </p><br><p>  First, create an entry point ‚Äî a simple <code>index.html</code> : </p><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"height:100%"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewport"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width=device-width, height=device-height, initial-scale=1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-/web.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mol_view_root</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$mol_app_calc"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-/web.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Nothing special, except that we have specified the mount point of the application with the special attribute <code>mol_view_root</code> in which it was <code>mol_view_root</code> that it is necessary to mount our application.  The $ mol architecture is such that any component can act as the root of the application.  Conversely, any $ mol application is nothing more than a regular component and can be easily used inside another application.  For example, in the <a href="http://mol.js.org/">gallery of applications</a> . </p><br><p>  Please note that we have already registered the paths to the scripts and styles - these bundles will be built automatically for our application and include only those source codes that are really necessary for it.  Looking ahead, it is worth noting that the total volume of the application will be some 36KB without minification, but with ziping: </p><br><p><img src="https://habrastorage.org/web/981/54e/a2f/98154ea2f7dc4db599934b38db37fa8a.png" alt="Network timeline"></p><br><p>  So, to declare a component that will be our application, we need to create a file <code>calc.view.tree</code> , the simplest content of which consists of just one line: </p><br><pre> <code class="hljs perl">$mol_app_calc $mol_page</code> </pre> <br><p>  The second word is the name of the base component, and the first is the name of ours, which will be inherited from the base one.  Thus, each component is the successor to any other.  The most basic component from which all the others come is <a href="https://github.com/eigenmethod/mol/tree/master/view">$ mol_view</a> .  It gives all components only the most basic styles and behavior.  In our case, the base component will be the <a href="https://github.com/eigenmethod/mol/tree/master/page">$ mol_page</a> component, <a href="https://github.com/eigenmethod/mol/tree/master/page">which</a> is a page with a header, body and basement. </p><br><p>  The <code>calc.view.tree</code> class of the component will be automatically generated from <code>calc.view.tree</code> and placed in <code>-view.tree/calc.view.tree.ts</code> so that the development environment can pick it up: </p><br><pre> <code class="hljs scala">namespace $ { export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">$mol_app_calc</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">$mol_page</span></span></span><span class="hljs-class"> </span></span>{ } }</code> </pre> <br><p>  Actually, now the application can already be opened at <code>http://localhost:8080/mol/app/calc/</code> and see the empty page with the callsign as the title: </p><br><p><img src="https://habrastorage.org/web/a64/79e/9ed/a6479e9edc07426b897ff273560faa8a.png" alt="$ Mol_page is empty"></p><br><p>  <a href="https://github.com/eigenmethod/mol/tree/master/view">The view.tree syntax is</a> rather unusual, but it is simple and concise.  Let me quote one of the reviews about him: </p><br><blockquote>  The syntax of a tree is very easy to read, but you need to get used to it a bit and do not drop everything ahead of time.  My brain digested and resented for about a week, and then enlightenment comes and you understand how much this framework simplifies the development process.  ¬© Vitaly Makeev </blockquote><p>  So don't get scared, but dive!  And let's start with the general layout of the page - it will consist of a header, a panel for editing the current cell and the actual data table. </p><br><p>  Each component has a <code>sub()</code> property that returns a list of what should be rendered directly inside the component.  At $ mol_page, the values ‚Äã‚Äãof the <code>Head()</code> , <code>Body()</code> and <code>Foot()</code> properties are rendered, which return the appropriate subcomponents: </p><br><pre> <code class="hljs mel">$mol_page $mol_view sub / &lt;= Head $mol_view &lt;= Body $mol_scroll &lt;= Foot $mol_view</code> </pre> <br><p>  In this code, the implementation details of the subcomponent are omitted so that the essence is visible.  When declaring a subcomponent (aka ‚ÄúElement‚Äù in BEM terminology), we indicate its name in the context of our component and the name of the class to be instantiated.  An instance of the component created in this way will be cached and accessible through the property of the same name.  For example, <code>this.Body()</code> in the context of our application will return a customized instance of <a href="https://github.com/eigenmethod/mol/tree/master/scroll">$ mol_scroll</a> .  Speaking of patterns, the <code>Body()</code> property acts as a local lazy factory. </p><br><p>  Let's preset the <code>sub()</code> property so that it returns the components we need: </p><br><pre> <code class="hljs mel">$mol_app_calc $mol_page sub / &lt;= Head - &lt;= Current $mol_bar &lt;= Body $mol_grid</code> </pre> <br><p>  Here we left the cap from $ mol_page, added <a href="https://github.com/eigenmethod/mol/tree/master/bar">$ mol_bar</a> as the editing pane for the current cell, used <a href="https://github.com/eigenmethod/mol/tree/master/grid">$ mol_grid</a> , the component for drawing virtual tables, as the page body, and removed the basement, since we did not need it. </p><br><p>  Let's take a look at how the generated class has changed: </p><br><pre> <code class="hljs scala">namespace $ { export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">$mol_app_calc</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">$mol_page</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/// sub / /// &lt;= Head - /// &lt;= Current - /// &lt;= Body - sub() { return [].concat( this.Head() , this.Current() , this.Body() ) } /// Current $mol_bar @ $mol_mem Current() { return new this.$.$mol_bar } /// Body $mol_grid @ $mol_mem Body() { return new this.$.$mol_grid } } }</span></span></code> </pre> <br><p>  The $ mol business card is a very ‚Äúreadable‚Äù code.  This concerns not only the generated code, but also the code of the $ mol modules itself, and the application code of the applications created on its base. </p><br><p>  Perhaps you noticed that objects are not created by direct instantiation by the name of the class <code>new $mol_grid</code> , but through <code>this.$</code> .  The <code>$</code> field is in any component and returns a global context or registry, using patterns.  A distinctive feature of accessing global values ‚Äã‚Äãthrough the <code>$</code> field is the ability for any component to redefine the context for all components nested at any depth.  Thus, $ mol in an extremely practical and unobtrusive form implements an <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D0%25B2%25D0%25B5%25D1%2580%25D1%2581%25D0%25B8%25D1%258F_%25D1%2583%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F">inversion of control</a> , allowing to substitute the implementations used somewhere in the depth of the reusable component. </p><br><h1 id="formirovanie-tablicy">  Table formation </h1><br><p>  Well, let's increase a little meat and adjust the embedded components for ourselves: the grid needs to explain which column identifiers we have, which row identifiers, as well as the lists of cells in the header and body of the table. </p><br><pre> <code class="hljs django"><span class="xml"><span class="xml">Body $mol_grid col_ids </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">col_ids</span></span></span></span><span class="xml"><span class="hljs-tag"> / </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">row_ids</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">row_ids</span></span></span></span><span class="xml"><span class="hljs-tag"> / </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">head_cells</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">head_cells</span></span></span></span><span class="xml"><span class="hljs-tag"> / </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cells</span></span></span></span><span class="xml"><span class="hljs-tag">!</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">row</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">cells!row</span></span></span></span><span class="xml"><span class="hljs-tag"> /</span></span></span></span></code> </pre> <br><p>  The generated class will expand with the following description: </p><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Body $mol_grid /<span class="hljs-regexp"><span class="hljs-regexp">//</span></span> col_ids &lt;= col_ids - <span class="hljs-regexp"><span class="hljs-regexp">//</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ row_ids &lt;= row_ids - /</span></span><span class="hljs-regexp"><span class="hljs-regexp">//</span></span> head_cells &lt;= head_cells - <span class="hljs-regexp"><span class="hljs-regexp">//</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ cells!row &lt;= cells!row - @ $mol_mem Body() { const obj = new this.$.$mol_grid obj.col_ids = () =&gt; this.col_ids() obj.row_ids = () =&gt; this.row_ids() obj.head_cells = () =&gt; this.head_cells() obj.cells = ( row ) =&gt; this.cells( row ) return obj }</span></span></code> </pre> <br><p>  As you can see, we simply redefined the corresponding properties of the nested component to our implementations.  This is a very simple, but at the same time powerful technique that allows you to reactively link components together.  The syntax <code>view.tree</code> supports 3 types of binding: </p><br><ul><li>  Left-sided (as in the code above), when we indicate to the nested component which value its property should return. </li><li>  Right-handedly, when we create a property that acts as an alias for the property of the nested component. </li><li>  Bilateral, when we specify the embedded component to read from and write to our property, thinking that it works with its own. </li></ul><br><p>  To illustrate the two-way binding, let's detail the editing pane of the current cell: </p><br><pre> <code class="hljs php">Current $mol_bar sub / &lt;= Pos $mol_string enabled <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> value &lt;= pos \ &lt;= Edit $mol_string hint \= value?val &lt;=&gt; formula_current?val \</code> </pre> <br><p>  As you can see, it will consist of two input fields: </p><br><ul><li>  Cell coordinates.  For now, we will not allow them to be changed via the <code>enabled</code> property - we will leave this functionality for the future. </li><li>  Formula entry field.  Here we already bind the <code>value</code> property of the input field and our property of the <code>formula_current</code> , which we declare right away, specifying the default value - an empty string. </li></ul><br><p>  The code for the <code>Edit</code> and <code>formula_current</code> will be generated like this: </p><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Edit $mol_string /<span class="hljs-regexp"><span class="hljs-regexp">//</span></span> hint \= <span class="hljs-regexp"><span class="hljs-regexp">//</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ value?val &lt;=&gt; formula_current?val - @ $mol_mem Edit() { const obj = new this.$.$mol_string obj.hint = () =&gt; "=" obj.value = ( val? ) =&gt; this.formula_current( val ) return obj } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">//</span></span> formula_current?val \ @ $mol_mem formula_current( val? : string , force? : $mol_atom_force ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( val !== undefined ) ? val : <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre> <br><p>  Thanks to the <a href="https://github.com/eigenmethod/mol/tree/master/mem">reactive memoizing decorator $ mol_mem</a> , the value returned by the <code>formula_current</code> method is cached until someone needs it. </p><br><p>  So far, we only had a declarative description of the composition of the component.  Before we begin to describe the logic of work, let's immediately declare how our cells will look like: </p><br><pre> <code class="hljs objectivec">Col_head!<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> $mol_float dom_name \th horizontal <span class="hljs-literal"><span class="hljs-literal">false</span></span> sub / &lt;= col_title!<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> \ - Row_head!<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> $mol_float dom_name \th vertical <span class="hljs-literal"><span class="hljs-literal">false</span></span> sub / &lt;= row_title!<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> \ - Cell!<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> $mol_app_calc_cell value &lt;= result!<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> \ selected?val &lt;=&gt; selected!<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>?val <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><p>  The row and column headers will be floating, so we use the <a href="https://github.com/eigenmethod/mol/tree/master/float">$ mol_float</a> component for them, which tracks the scrolling position provided by the <a href="https://github.com/eigenmethod/mol/tree/master/scroll">$ mol_scroll</a> component through the context and shifts the component so that it is always in the visible area.  And for the cell, we have a separate component <code>$mol_app_calc_cell</code> : </p><br><pre> <code class="hljs cs">$mol_app_calc_cell $mol_button dom_name \td sub / &lt;= <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> \ attr * ^ mol_app_calc_cell_selected &lt;= selected?val <span class="hljs-literal"><span class="hljs-literal">false</span></span> mol_app_calc_cell_type &lt;= type?val \ event_click?<span class="hljs-keyword"><span class="hljs-keyword">event</span></span> &lt;=&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>?<span class="hljs-keyword"><span class="hljs-keyword">event</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span></code> </pre> <br><p>  This component will be clickable, so we inherit it from <a href="https://github.com/eigenmethod/mol/tree/master/button">$ mol_button</a> .  Click events are sent to the <code>select</code> property, which we will later switch the cell editor to the one we clicked.  In addition, we add a couple of attributes here in order to stylize the selected cell in a special way and to provide the cells of the numeric type with right alignment.  Running over the line, we will have simple cell styles: </p><br><pre> <code class="css hljs"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[mol_app_calc_cell]</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">user-select</span></span>: text; <span class="hljs-comment"><span class="hljs-comment">/*   $mol_button   */</span></span> <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--mol_skin_card); <span class="hljs-comment"><span class="hljs-comment">/*  css-variables  post-css */</span></span> } <span class="hljs-selector-attr"><span class="hljs-selector-attr">[mol_app_calc_cell_selected]</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">box-shadow</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--mol_skin_focus_outline); <span class="hljs-attribute"><span class="hljs-attribute">z-index</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-selector-attr"><span class="hljs-selector-attr">[mol_app_calc_cell_type="number"]</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">text-align</span></span>: right; }</code> </pre> <br><p>  Pay attention to the selector component of the same name <code>[mol_app_calc_cell]</code> - the corresponding attribute is added to the dom node automatically, completely saving the programmer from manual work on the placement of css-classes.  This simplifies development and ensures consistency of naming. </p><br><p>  Finally, to add our own logic, we create <code>calc.view.ts</code> , where we create a class in the <code>$.$$</code> namespace, which we inherit from the automatically generated class of the same name from the <code>$</code> namespace: </p><br><pre> <code class="hljs scala">namespace $.$$ { export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">$mol_app_calc_cell</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">$</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">$mol_app_calc_cell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre> <br><p>  During execution, both namespaces will point to the same object, which means our logic class will simply take its place after it is inherited from the autogenerated class.  Due to such cunning manipulation, adding a class with logic remains optional, and is applied only when the declarative description is not enough.  For example, override the <code>select()</code> property so that when you try to write an event object to it, it changes the <code>selected()</code> property to <code>true</code> : </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>? : Event ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.selected( <span class="hljs-literal"><span class="hljs-literal">true</span></span> ) }</code> </pre> <br><p>  And the <code>type()</code> property will return the cell type by analyzing the <code>value()</code> property: </p><br><pre> <code class="hljs cs">type() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isNaN( Number( <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ) ) ? <span class="hljs-string"><span class="hljs-string">'string'</span></span> : <span class="hljs-string"><span class="hljs-string">'number'</span></span> }</code> </pre> <br><p>  But let's go back to the table.  Similarly, we add logic to the <code>$mol_app_calc</code> component: </p><br><pre> <code class="hljs scala">export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">$mol_app_calc</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">$</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">$mol_app_calc</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br><p>  First we need to create lists of <code>row_ids()</code> row identifiers and <code>row_ids()</code> columns: </p><br><pre> <code class="hljs javascript">@ $mol_mem col_ids() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dimensions().cols ).join(<span class="hljs-string"><span class="hljs-string">' '</span></span>).split(<span class="hljs-string"><span class="hljs-string">' '</span></span>).map( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> _ , i </span></span></span><span class="hljs-function">)=&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.number2string( i ) ) } @ $mol_mem row_ids() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dimensions().rows ).join(<span class="hljs-string"><span class="hljs-string">' '</span></span>).split(<span class="hljs-string"><span class="hljs-string">' '</span></span>).map( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> _ , i </span></span></span><span class="hljs-function">)=&gt;</span></span> i + <span class="hljs-number"><span class="hljs-number">1</span></span> ) }</code> </pre> <br><p>  They depend on the <code>dimensions()</code> property, which we will calculate based on the occupancy of the cells, so that any filled cell has at least two more empty ones to the right and below: </p><br><pre> <code class="hljs javascript">@ $mol_mem dimensions() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dims = { <span class="hljs-attr"><span class="hljs-attr">rows</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span> , <span class="hljs-attr"><span class="hljs-attr">cols</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span> , } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.formulas() ) ) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> parsed = <span class="hljs-regexp"><span class="hljs-regexp">/^([AZ]+)(\d+)$/</span></span>.exec( key ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rows = <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>( parsed[<span class="hljs-number"><span class="hljs-number">2</span></span>] ) + <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cols = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.string2number( parsed[<span class="hljs-number"><span class="hljs-number">1</span></span>] ) + <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( rows &gt; dims.rows ) dims.rows = rows <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( cols &gt; dims.cols ) dims.cols = cols } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dims }</code> </pre> <br><p>  The <code>string2number()</code> and <code>number2string()</code> methods simply convert the literal coordinates of columns to numeric and vice versa: </p><br><pre> <code class="hljs rust">number2string( numb : number ) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> letters = <span class="hljs-symbol"><span class="hljs-symbol">'ABCDEFGHIJKLMNOPQRSTUVWXYZ</span></span>' <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">str</span></span> = '' <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">str</span></span> = letters[ numb % <span class="hljs-number"><span class="hljs-number">26</span></span> ] + <span class="hljs-built_in"><span class="hljs-built_in">str</span></span> numb = Math.floor( numb / <span class="hljs-number"><span class="hljs-number">26</span></span> ) } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ( numb ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">str</span></span> } string2number( <span class="hljs-built_in"><span class="hljs-built_in">str</span></span> : string ) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> numb = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> symb of <span class="hljs-built_in"><span class="hljs-built_in">str</span></span>.split( '' ) ) { numb = numb * <span class="hljs-number"><span class="hljs-number">26</span></span> numb += symb.charCodeAt( <span class="hljs-number"><span class="hljs-number">0</span></span> ) - <span class="hljs-number"><span class="hljs-number">65</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> numb }</code> </pre> <br><p>  We calculate the dimension of the table based on the formula registry, which we take from the <code>formulas()</code> property.  It should return json of the form: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"A1"</span></span> : <span class="hljs-string"><span class="hljs-string">"12"</span></span> , <span class="hljs-attr"><span class="hljs-attr">"B1"</span></span> : <span class="hljs-string"><span class="hljs-string">"=A1*2"</span></span> }</code> </pre> <br><p>  And we will take the formulas themselves and address strings of the form <code>#A1=12/B1=%3DA1*2</code> : </p><br><pre> <code class="hljs javascript">@ $mol_mem formulas( next? : { [ key : string ] : string } ) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> formulas : <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> next = {} <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> args = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$.$mol_state_arg.dict() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( next ) args = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$.$mol_state_arg.dict({ ... args , ... next }) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ids = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys( args ).filter( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">param</span></span></span><span class="hljs-function"> =&gt;</span></span> /^[AZ]+\d+$/.test( param ) ) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> id <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> ids ) formulas[ id ] = args[ id ] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> formulas }</code> </pre> <br><p>  As you can see, the <code>formulas()</code> property is changeable, that is, we can both read formulas for the cells and write the update in the address bar.  For example, if you execute: <code>this.formulas({ 'B1' : '24' })</code> , then in the address bar we will see <code>#A1=12/B1=24</code> . </p><br><h1 id="adresnaya-stroka">  Address bar </h1><br><p>  The <a href="https://github.com/eigenmethod/mol/tree/master/state/arg">$ mol_state_arg</a> cross-platform module allows us to work with application parameters as a dictionary, but as a rule, it is more convenient to receive and write a specific parameter by name.  For example, let the user change the name of our table, which we will again save in the address bar: </p><br><pre> <code class="hljs javascript">title( next? : string ) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> title = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$.$mol_state_arg.value( <span class="hljs-string"><span class="hljs-string">`title`</span></span> , next ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> title == <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.title() : title }</code> </pre> <br><p>  As you can see, if the name of the table is not specified in the address bar, the name specified in the parent class that is generated from <code>calc.view.tree</code> , which we will update by adding the header I / O field to the header instead of simple header output, will be taken: </p><br><pre> <code class="hljs scala">head / &lt;= <span class="hljs-type"><span class="hljs-type">Title_edit</span></span> $mol_string value?<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> &lt;=&gt; title?<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> @ \<span class="hljs-type"><span class="hljs-type">Spreedsheet</span></span> &lt;= <span class="hljs-type"><span class="hljs-type">Tools</span></span> -</code> </pre> <br><p>  <code>head()</code> is a property from $ mol_page that returns a list of what should be rendered inside the <code>Head()</code> subcomponent.  This is a typical pattern in $ mol - to call an embedded component and its contents in the same word, with the only difference that the name of the component is written with a capital letter. </p><br><p>  <code>Tools()</code> - toolbar from $ mol_page displayed on the right side of the header.  Let's fill it right away by placing a table download button in the form of a CSV file: </p><br><pre> <code class="hljs django"><span class="xml"><span class="xml">tools / </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Download</span></span></span></span><span class="xml"><span class="hljs-tag"> $</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">mol_link</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">hint</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">download_hint</span></span></span></span><span class="xml"><span class="hljs-tag"> @ \</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Download</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">file_name</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">download_file</span></span></span></span><span class="xml"><span class="hljs-tag"> \ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">download_uri?val</span></span></span></span><span class="xml"><span class="hljs-tag"> \ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span></span><span class="xml"><span class="hljs-tag">?</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">event</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;=&gt;</span></span></span><span class="xml"> download_generate?event null sub / </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Download_icon</span></span></span></span><span class="xml"><span class="hljs-tag"> $</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">mol_icon_load</span></span></span></span></span></span></code> </pre> <br><p>  <a href="https://github.com/eigenmethod/mol/tree/master/link">$ mol_link</a> - component for forming links.  If you specify <code>file_name()</code> , then on click it will offer to download the file by reference, saving it under the specified name.  Let's immediately form this name based on the table name: </p><br><pre> <code class="hljs kotlin">download_file() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> `${ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.title() }.csv` }</code> </pre> <br><h1 id="lokalizaciya">  Localization </h1><br><p>  Note the dog character before the default in English: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">download_hint</span></span> @ \Download</code> </pre> <br><p>  Inserting this symbol is all you need to add localization support to your application.  In the generated class there will be no "Download" line - there will only be a query for localized text: </p><br><pre> <code class="hljs bash">/// download_hint @ \Download <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">download_hint</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-variable"><span class="hljs-variable">$mol_locale</span></span>.text( <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$mol_app_calc_download_hint</span></span></span><span class="hljs-string">"</span></span> ) }</code> </pre> <br><p>  And the English texts themselves will be automatically moved to a separate file <code>-view.tree/calc.view.tree.locale=en.json</code> : </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"$mol_app_calc_title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Spreedsheet"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"$mol_app_calc_download_hint"</span></span>: <span class="hljs-string"><span class="hljs-string">"Download"</span></span> }</code> </pre> <br><p>  As you can see, unique human-readable keys were formed for the texts.  You can give this file to translators and translate them from them into files of the form <code>*.locale=*.json</code> .  For example, add our component translations into Russian in the file <code>calc.locale=ru.json</code> : </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"$mol_app_calc_title"</span></span> : <span class="hljs-string"><span class="hljs-string">" "</span></span> , <span class="hljs-attr"><span class="hljs-attr">"$mol_app_calc_download_hint"</span></span> : <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre> <br><p>  Now, if you have Russian as the main language in the browser, then when the application starts, a bundle with Russian texts will be loaded asynchronously <code>-/web.locale=ru.json</code> .  In the meantime, the components depending on the translations will automatically show the loading indicator. </p><br><h1 id="zapolnyaem-yacheyki">  Fill the cells </h1><br><p>  So, we have row and column identifiers.  Let's create lists of cells.  First column headings: </p><br><pre> <code class="hljs kotlin">@ $mol_mem head_cells() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Col_head( <span class="hljs-string"><span class="hljs-string">''</span></span> ) , ... <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.col_ids().map( colId =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Col_head( colId ) ) ] }</code> </pre> <br><p>  Please note that we added an extra column at the beginning, since we will have row headers in it.  And here are the cells for the rows: </p><br><pre> <code class="hljs kotlin">cells( row_id : number ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Row_head( row_id ) , ... <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.col_ids().map( col_id =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Cell({ row : row_id , col : col_id }) ) ] }</code> </pre> <br><p>  Next, we recall the properties that we knit for the cells: </p><br><pre> <code class="hljs objectivec">Cell!<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> $mol_app_calc_cell value &lt;= result!<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> \ selected?val &lt;=&gt; selected!<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>?val <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><p>  In a cell, these are just ordinary properties, but here they take a key - a cell identifier. </p><br><p>  Let's enter the <code>current()</code> property which will store the identifier of the current cell: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">current</span></span>?val * <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> col \A</code> </pre> <br><p>  And in the implementation of <code>selected()</code> we will simply compare the cell by the passed identifier and the current one: </p><br><pre> <code class="hljs kotlin">@ $mol_mem_key selected( id : { row : number , col : string } , next? : boolean ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Cell( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.current( next ? id : undefined ) ) === <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Cell( id ) }</code> </pre> <br><p>  Of course, if <code>true</code> passed to <code>selected()</code> , then the new identifier will be set as the current identifier and the comparison of the cells will also give <code>true</code> . </p><br><p>  The final touch - when choosing a cell, it would not be a bad thing to transfer the focus from itself to the value editor: </p><br><pre> <code class="hljs ruby">@ $mol_mem current( <span class="hljs-keyword"><span class="hljs-keyword">next</span></span>? : { row : number , col : string } ) { new $mol_defer( ()=&gt; this.Edit().focused( <span class="hljs-literal"><span class="hljs-literal">true</span></span> ) ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-params"><span class="hljs-params">||</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.current() }</code> </pre> <br><p>  Here we use <a href="https://github.com/eigenmethod/mol/tree/master/defer">$ mol_defer to</a> set a deferred task to shift the focus to the editor whenever the current cell ID changes.  Deferred tasks are performed in the same animation frame, which means that the user will not see any flickering from refocusing.  If we moved the focus right away, we would subscribe to the state of focus of the editor and when moving the focus, the current cell ID would also be reset, which of course we don‚Äôt need. </p><br><h1 id="klaviaturnaya-navigaciya">  Keyboard navigation </h1><br><p>  Constantly poking the mouse into the cells to move between them is not very convenient.  The arrows on the keyboard would be faster.  Traditionally, spreadsheets have two modes: navigation mode and editing mode.  Constantly switching between them is also annoying.  Therefore, we will make a knight's move and combine editing and navigation.  The focus will always remain on the cell editing panel, but when the Alt key is held down, pressing the arrows will change the edited cell to one of its neighbors.  For such frills, there is a special component <a href="https://github.com/eigenmethod/mol/tree/master/nav">$ mol_nav</a> , which is a plugin component. </p><br><p>  There are 3 types of components in $ mol: </p><br><ol><li>  Common components that create a dom node and control its state. </li><li>  <a href="https://github.com/eigenmethod/mol/tree/master/ghost">Ghost components</a> that do not create dom-nodes, but use the dom-node of the component passed to them to add behavior / display. </li><li>  <a href="https://github.com/eigenmethod/mol/tree/master/plugin">Plug-in components</a> that also do not create dom-nodes, but use the owner component's dom-node to add behavior / display. </li></ol><br><p>     <code>plugins()</code> . ,     : </p><br><pre> <code class="hljs scala">plugins / &lt;= <span class="hljs-type"><span class="hljs-type">Nav</span></span> $mol_nav mod_alt <span class="hljs-literal"><span class="hljs-literal">true</span></span> keys_x &lt;= col_ids / keys_y &lt;= row_ids / current_x?<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> &lt;=&gt; current_col?<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> \<span class="hljs-type"><span class="hljs-type">A</span></span> current_y?<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> &lt;=&gt; current_row?<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p>   ,         ,     , .        <code>current_col()</code>  <code>current_row()</code> ,      <code>current()</code> : </p><br><pre> <code class="hljs kotlin">current_row( next? : number ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.current( next === undefined ? undefined : { ... <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.current() , row : next } ).row } current_col( next? : number ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.current( next === undefined ? undefined : { ... <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.current() , col : next } ).col }</code> </pre> <br><p> ,   <code>Alt+Right</code> , ,       ,         . </p><br><h1 id="kopirovanie-i-vstavka">    </h1><br><p>         ,   <code>td</code> dom-,       .     <code>ctrl</code> ,        .        ,  <a href="https://ru.wikipedia.org/wiki/TSV">Tab Separated Values</a> ,     .        : </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">event</span></span> * paste?<span class="hljs-keyword"><span class="hljs-keyword">event</span></span> &lt;=&gt; paste?<span class="hljs-keyword"><span class="hljs-keyword">event</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span></code> </pre> <br><p>    : </p><br><pre> <code class="hljs markdown">paste( event? : ClipboardEvent ) { const table = event.clipboardData.getData( 'text/plain' ).trim().split( '\n' ).map( row =&gt; row.split( '\t' ) ) as string[<span class="hljs-string"></span><span class="hljs-string"></span>][<span class="hljs-symbol"></span><span class="hljs-symbol"></span>] if( table.length === 1 &amp;&amp; table[<span class="hljs-string"><span class="hljs-string">0</span></span>].length === 1 ) return const anchor = this.current() const row<span class="hljs-emphasis"><span class="hljs-emphasis">_start = anchor.row const col_</span></span>start = this.string2number( anchor.col ) const patch = {} for( let row in table ) { for( let col in table[<span class="hljs-string"><span class="hljs-string"> row </span></span>] ) { const id = <span class="hljs-code"><span class="hljs-code">`${ this.number2string( col_start + Number( col ) ) }${ row_start + Number( row ) }`</span></span> patch[<span class="hljs-string"><span class="hljs-string"> id </span></span>] = table[<span class="hljs-string"><span class="hljs-string"> row </span></span>][<span class="hljs-symbol"><span class="hljs-symbol"> col </span></span>] } } this.formulas( patch ) event.preventDefault() }</code> </pre> <br><p> ,           ‚Äî           ,   Microsoft Excel  LibreOffice Calc. </p><br><h1 id="vygruzka-fayla">   </h1><br><p>   ‚Äî    .     .       .    data-uri  <code>data:text/csv;charset=utf-8,{'url-  }</code> .  CSV    Microsoft Excel    : </p><br><ol><li>      . </li><li>    . </li></ol><br><pre> <code class="hljs javascript">download_generate( event? : Event ) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> table : string[][] = [] <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dims = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dimensions() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> row = <span class="hljs-number"><span class="hljs-number">1</span></span> ; row &lt; dims.rows ; ++ row ) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> row_data = [] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> any[] table.push( row_data ) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> col = <span class="hljs-number"><span class="hljs-number">0</span></span> ; col &lt; dims.cols ; ++ col ) { row_data[ col ] = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.result({ row , <span class="hljs-attr"><span class="hljs-attr">col</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.number2string( col ) }) ) } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> content = table.map( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">row</span></span></span><span class="hljs-function"> =&gt;</span></span> row.map( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">`"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${ val.replace( </span></span><span class="hljs-regexp"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-regexp">/"/g</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> , </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'""'</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> ) }</span></span></span><span class="hljs-string">"`</span></span> ).join( <span class="hljs-string"><span class="hljs-string">','</span></span> ) ).join( <span class="hljs-string"><span class="hljs-string">'\n'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.download_uri( <span class="hljs-string"><span class="hljs-string">`data:text/csv;charset=utf-8,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${ </span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">encodeURIComponent</span></span></span></span><span class="hljs-string"><span class="hljs-subst">( content ) }</span></span></span><span class="hljs-string">`</span></span> ) $mol_defer.run() }</code> </pre> <br><p>    ,     ,     dom-      .    ,     ,       . </p><br><h1 id="formuly">  Formulas </h1><br><p>      ‚Äî   ,  ,          .          ,            . </p><br><p>        .      ‚Äî     ,   .         <code>=</code> ,        ,   ,     . </p><br><p>      ‚Äî   ,     ,          JavaScript      JS . ,        ,  - ,       <a href="https://github.com/eigenmethod/mol/tree/master/func/sandbox">$mol_func_sandbox</a> ,    JavaScript    : </p><br><pre> <code class="hljs kotlin">@ $mol_mem sandbox() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> new $mol_func_sandbox( Math , { <span class="hljs-string"><span class="hljs-string">'formula'</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.formula.bind( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ) , <span class="hljs-string"><span class="hljs-string">'result'</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.result.bind( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ) , } ) }</code> </pre> <br><p>  ,        ,     :           . </p><br><p>          ,    . </p><br><pre> <code class="hljs kotlin">@ $mol_mem_key func( id : { row : number , col : string } ) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> formula = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.formula( id ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( formula[<span class="hljs-number"><span class="hljs-number">0</span></span>] !== <span class="hljs-string"><span class="hljs-string">'='</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ()=&gt; formula <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> code = <span class="hljs-string"><span class="hljs-string">'return '</span></span> + formula.slice( <span class="hljs-number"><span class="hljs-number">1</span></span> ) .replace( /@([AZ]+)([<span class="hljs-number"><span class="hljs-number">0</span></span>-<span class="hljs-number"><span class="hljs-number">9</span></span>]+)\b/g , <span class="hljs-string"><span class="hljs-string">'formula({ row : $2 , col : "$1" })'</span></span> ) .replace( /\b([AZ]+)([<span class="hljs-number"><span class="hljs-number">0</span></span>-<span class="hljs-number"><span class="hljs-number">9</span></span>]+)\b/g , <span class="hljs-string"><span class="hljs-string">'result({ row : $2 , col : "$1" })'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sandbox().eval( code ) }</code> </pre> <br><p>      <code>result</code>  ‚Äî  .      ,   ,       <code>AB34</code> ,      <code>result</code> . ,  ,      ,   : <code>@AB34</code> .    ‚Äî  ,         ,   ,         . </p><br><p>     ‚Äî   <code>result()</code>     : </p><br><pre> <code class="hljs kotlin">@ $mol_mem_key result( id : { row : number , col : string } ) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.func( id ).call() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( res === undefined ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( res === <span class="hljs-string"><span class="hljs-string">''</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( isNaN( res ) ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Number( res ) }</code> </pre> <br><p>       <code>undefined</code> ,            . </p><br><h1 id="finalnyy-akkord">  Final chord </h1><br><p>         . <a href="https://github.com/eigenmethod/mol/tree/master/app/calc">   $mol_app_calc   .</a>      .     <a href="http://mol.js.org/app/calc/"> </a>         - .          .  So... </p><br><p> <a href="http://mol.js.org/app/calc/"><img src="https://habrastorage.org/webt/59/cb/4f/59cb4ff184d88099352124.png" alt="Evaluation of the further development of $ mol_app_calc"></a> </p><br><p> <a href="http://mol.js.org/app/calc/"><img src="https://habrastorage.org/webt/59/cb/32/59cb32b6067dc169333525.png" alt="Credit calculator"></a> </p><br><p> <a href="http://mol.js.org/app/calc/"><img src="https://habrastorage.org/web/884/8fb/059/8848fb0592dd4b39a3110c8e67a5ffa6.png" alt="a * x ** 2 + b * x + c = 0"></a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/338804/">https://habr.com/ru/post/338804/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338788/index.html">"Enterprise shame" or how to drive the developer crazy at the interview</a></li>
<li><a href="../338796/index.html">Illusion of movement</a></li>
<li><a href="../338798/index.html">20 useful services for product managers</a></li>
<li><a href="../338800/index.html">SAP is looking for future specialists to work with data science and machine learning</a></li>
<li><a href="../338802/index.html">Dangerous game. Should I rely on a team of juniors</a></li>
<li><a href="../338806/index.html">Loading OS on ARM</a></li>
<li><a href="../338808/index.html">Review of music software code defects. Part 1. MuseScore</a></li>
<li><a href="../338810/index.html">"Kings of Mathematics": Big Data Analytics in a bank. Project GAUSS in VTB</a></li>
<li><a href="../338812/index.html">How can a never called function be called?</a></li>
<li><a href="../338814/index.html">We translate interfaces into fifty languages. Sketch</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>