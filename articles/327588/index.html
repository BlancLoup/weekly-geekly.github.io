<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We are testing a new line of SSD VPS + a little insider from the life of a hoster</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A month ago, we at Unihost conducted a full upgrade of the KVM VPS structure from HDD to modern and high-speed SSD VPS. The nerves of the managers sub...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We are testing a new line of SSD VPS + a little insider from the life of a hoster</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://trello-attachments.s3.amazonaws.com/58d3ccb0d0b0255bd1b81750/58e732404cd55279a1754dd3/235ab1ad712876e86d452c3cb86c4d91/unihab-vps_ssd.jpg" alt="image"></p><br><p>  A month ago, we at Unihost conducted a full upgrade of the KVM VPS structure from HDD to modern and high-speed SSD VPS.  The nerves of the managers subsided, the admins have played enough with the settings, which means it's time to take stock and share the experience gained. </p><br><p>  This article does not claim to be innovative or deeply technical.  Rather the opposite.  We are fully aware that we have been delayed with the upgrade of the year, that is, at least 3 times.  Nevertheless, we hope that we will help determine the choice of those who are still considering the acquisition of a virtual server and will save hosting providers who have not yet passed our way from possible errors. </p><br><p>  Below you will find insider information about our hosting company: what problems you encountered as an international provider;  how we managed to eliminate spamming by 100% and see comparative testing of the minimum tariff plans of the old and the new KVM VPS lines. </p><br><a name="habracut"></a><br><h2 id="nemnogo-istorii">  A bit of history </h2><br><p>  Many operate on the principle of "Works - do not touch."  If the client is satisfied with everything and he brings money every month, why change something?  For a long time, and so we looked at our old VPS structure with HDD. </p><br><p>  Until mid-March 2017, all KVM VPS worked on hardware with SATA 6Gb / s hard drives in RAID1, Xeon¬Æ E3-1231 v3 processors and 32 GB of RAM for each physical server.  Virtual machines were not the fastest, but they did what was expected of them.  If the client needed hosting faster, we offered a low-cost dedicated server.  Everything is logical. </p><br><p>  Sales went, servers filled, the company expanded and entered the European and Asian markets, and with it came new problems that weren't working purely in the CIS. </p><br><p>  Having connected the international processing of cards and PayPal, the popular Bitcoin and other international payments, we came across the concepts of Anti-Fraud, AML (Anti Money Laundering) and Chargeback.  In addition, it‚Äôs not that news, but surprised by the number of people willing to host malicious and fraudulent sites, spam mailings, bot nets and more on servers.  This inevitably led to receiving abuses (complaints) and, as a result, blocking individual IP addresses and even completely subnets.  Unable to withstand the influx of "bad" users, we had to abandon the instant activation and issuance of ordered VPS.  We have implemented a difficult verification system, starting with the project description and the goals of the web resource owner, ending with voice confirmations of orders, verification of documents and payment cards on scans / photos. </p><br><p>  Naturally, this led to a decrease in new orders and an increase in negativity on the part of bona fide users, who also fell victim to new verification policies.  And the structure of the VPS itself has become obsolete and cannot withstand fierce competition in the market. </p><br><p>  Therefore, we decided not to continue in the same spirit.  Spent a brainstorm.  Tried the method of Kipling and synectic.  Arranged an independent vote and came to the following conclusions: </p><br><ul><li>  You need to create a product that will meet modern requirements (HDD is old, SSD is new and popular); </li><li>  Provide the most seamless transition for current customers who are satisfied with the fact that there is and will not want to move to a new structure; </li><li>  Solve problems with old VPS: <br>  - complex customer verification; <br>  - problems due to spam and other bullying projects; <br>  - infections by viruses, shell, backdoors and other client sites and the consequences of this. </li></ul><br><h2 id="period-just-ship-it">  ‚ÄúJust ship it‚Äù period </h2><br><p>  It all started with the selection of iron for the new VPS.  The best in terms of price and performance for us are servers with two Xeon¬Æ E5-2630v3 CPUs, 128GB DDR4 ECC 2133 MHz RAM, 4x800GB SSD from Samsung and Mega Raid with Fast Path technology.  The servers are located in the European data center and are connected to the network at a speed of 1 Gbit / s with no traffic restrictions. </p><br><p>  Thanks to the new equipment, it was possible to update the tariff line with an increase in the resources provided by 1.5-2 times (not counting the amount of disk space) and a rise in prices by 1.5 times.  In addition, together with the SSD VPS, ISPmanager 5 Lite control panel is now provided free of charge, which in retail costs up to 4 euro / month. </p><br><h3 id="uproschaem-verifikaciyu-zakaza">  Simplify order verification </h3><br><p>  As mentioned above, verification before activating a VPS is needed not only to verify payments and prevent unwanted returns, but also to minimize the risks of unfair use of our services.  Completely get rid of the verification of payments is difficult - the world arena dictates its tough conditions.  Nevertheless, we returned the instant activation of the VPS, and now the client has 3 working days to complete the payment information verification.  Here it is standard: when paying with a bank card or PayPal, we request a scan or photo of the document confirming the identity and photo of the payment card (we recommend hiding the series / number of the document, as well as part of the card number and cvv).  We practice a simplified check by phone or a simple clarification of the subject of the project.  Naturally, verification is not required for existing customers with repeated orders. </p><br><p>  <strong>Pros:</strong> </p><br><ul><li>  Each client receives the ordered VPS within a few seconds after receiving the payment; </li><li>  The percentage of fraudulent payments has been significantly reduced and, as a result, the undesirable use of our service has decreased. </li></ul><br><p>  <strong>Minuses:</strong> </p><br><ul><li>  Time costs from our side, as well as from customers for payment verification; </li><li>  Reduced customer anonymity.  In fact, this is not a minus, because  we do not provide anonymous or bulletproof services. </li></ul><br><h3 id="isklyuchaem-veroyatnost-rassylki-spama">  Eliminate the likelihood of spam </h3><br><p>  Spam - the most common and undesirable type of activity on servers <br>  Wiki: Spam (eng. Spam) - mass mailing of commercial and other advertising or similar commercial types of messages to persons who did not express the desire to receive them. </p><br><p>  Spam should not be underestimated.  The problem is global in nature and every hoster has encountered it without exception.  Even the bulletproof providers, who are ready to host any projects and content on their servers, have one exception - spamming. </p><br><p>  Why is spam mailing so dislike hosters?  The answer is simple - IP addresses from which mass mailing is conducted and to which spam complaints come are blacklisted.  As a result, servers with these addresses are no longer suitable for further use - even for sending legal mail.  All popular mail services will automatically perceive mail from ‚Äúblackened‚Äù IP as spam and block it without additional checks. </p><br><p>  <strong>How do providers solve this problem?</strong> </p><br><ol><li>  Call center or large cloud services use specialized and expensive equipment to filter traffic. </li><li>  Hosters at various levels simply block port 25, which opens only after checking the client's web resource. </li></ol><br><p>  The second option we shallow immediately, because our goal - the most convenient and simple service.  The first method is used at the level of our data center in Europe, where we place server equipment.  However, this does not provide the solution we need, since  there is a blocking of the same 25 port on the server from which there is a mass mailing - not necessarily spam. </p><br><p>  <strong>Decision</strong> </p><br><p>  There is nothing secret or super-complex.  The e-mail is sent through port 25 - specialized equipment filters exactly it.  We will redirect all email traffic from VPS via port 2525 to a separate server - relay (relay) with installed software: eFa (email Filter application).  This software adjusts outgoing mail filtering by specified algorithms, adds addresses to the white or black lists, and trains the program itself to work effectively. </p><br><p>  <strong>Pros:</strong> </p><br><ul><li>  Users do not have any problems sending their email - they don‚Äôt even need to change their email server settings.  Everything happens automatically on our side; </li><li>  We have completely protected clients from spam mailings, which can be conducted from servers without their knowledge after hacking access or injections into the code; </li><li>  We stopped the attempts of fraudsters to use our servers for their own purposes. </li></ul><br><p>  <strong>Minuses:</strong> </p><br><ul><li>  Unable to deploy bulk email service to multiple IP.  But our VPS and are not designed for this.  For such needs, we provide dedicated servers. </li></ul><br><h2 id="avtomatiziruem-antivirusnuyu-zaschitu">  We automate anti-virus protection </h2><br><p>  Habr is a popular IT resource.  Here it is hardly necessary to talk about the need to protect data, the use of complex passwords, software updates, etc.  However, not every hosting client cares to prevent hacking attempts or infecting its site.  In this case, the violation of the integrity of the code can be considered the most innocuous, because it can be cured by a simple recovery from backup. </p><br><p> Much worse when, after hacking the site, Trojans or botnets are poured onto it, which lead to undesirable consequences: the ill-fated spamming, phishing pages, participation in DDoS attacks, etc. This inevitably results in Abusa and the risk of being left without VPS. </p><br><p>  To minimize such effects, we implemented automatic scanning on the shell, backdoor and other malicious scripts.  As of March 2017, there are 500,000 known viruses and trojans in our database.  Self scanning takes place without affecting the work of VPS with user projects. </p><br><p>  With a given periodicity (once every 2 days), our script creates copies of the LVM volumes of the client VPS and prepares the appropriate sections for mounting on a separate dedicated server.  After mounting, the entire file system is scanned.  Having detected a malicious code, the script automatically finds the registration data of the VPS owner and a letter notification is sent to the contact email when a problem is detected.  At the same time, in our ticket system, in the Abuse section, a reminder is created about the need to check the client‚Äôs actions on cleaning his VPS. </p><br><p>  One may ask, why do we not automatically cure viruses?  The answer is simple and lies in the principle of providing VPS.  A virtual server is a copy of a dedicated server, with root access and isolated resources.  This means that in order to make any changes, our employees must also have root access to the client‚Äôs server.  And this is contrary to the security policy and our principle - no interventions in the client code without his knowledge (request or consent).  In order to simplify the work on the removal of malicious scripts from the site, we provide complete information in our knowledge base.  And of course, if the user desires, we assist in troubleshooting problems on the servers within the administration package. </p><br><p>  <strong>Pros:</strong> </p><br><ul><li>  Preventing malicious and unwanted activity before it becomes a problem for us or the customers; </li><li>  Fully automated scanning process and notifying users, without interfering with the work of the VPS. <br>  Minuses: </li><li>  Given the specifics of providing VPS, not detected. </li></ul><br><p>  <strong><em>Small retreat</em></strong> </p><br><p>  We plan to write detailed articles on legal, technical and other aspects of the implementation of the three solutions: verification, anti-spam and anti-virus scanning.  If you have questions or requests, write them in the comments below.  We will try to answer in new articles. </p><br><p>  Now let's move on to comparing the old and the new KVM VPS structures </p><br><h2 id="provodim-testirovanie">  We are testing </h2><br><p>  We decided not to reinvent the wheel and took testvps sample scripts.  For comparison, we chose two minimum tariffs - the old KVM-384 (1 cpu 3.4 GHz, 768 MB DDR3, 30 GB HDD) and the new KVM-1 (2 cpu 2.4 GHz, 1500 MB DDR4 ECC, 15 GB SSD). </p><br><p>  <strong>Disclaimer</strong>  Testing indicators were conducted on servers that are under normal workload in a specific period of time.  Indicators do not claim to be true, and may differ when re-testing. </p><br><h3 id="test-benchmark--obschaya-proizvoditelnost-processornyh-yunitov">  Test Benchmark - overall processor unit performance </h3><br><table><thead><tr><th>  Type </th><th>  KVM-384 (old) </th><th>  KVM-1 (new) </th></tr></thead><tbody><tr><td>  Dhrystone 2 using register variables </td><td>  3681.5 </td><td>  6501.6 </td></tr><tr><td>  Double-Precision Whetstone </td><td>  700.1 </td><td>  1690.2 </td></tr><tr><td>  Execl throughput </td><td>  1326.5 </td><td>  2203.4 </td></tr><tr><td>  Pipe throughput </td><td>  2561.2 </td><td>  4191.4 </td></tr><tr><td>  Pipe-based Context Switching </td><td>  913.2 </td><td>  1538.3 </td></tr><tr><td>  Process Creation </td><td>  1082.2 </td><td>  1932.2 </td></tr><tr><td>  Shell Scripts (1 concurrent) </td><td>  2432.5 </td><td>  4649.4 </td></tr><tr><td>  Shell Scripts (8 concurrent) </td><td>  2250.6 </td><td>  4335.2 </td></tr><tr><td>  System Benchmarks Index Score </td><td>  2076.9 </td><td>  2895.4 </td></tr></tbody></table><br><p>  <strong>Pros:</strong> </p><br><ul><li>  Overall assessment of system indicators increased by 40% </li><li>  The increase in most indicators, including the execution of shell scripts has increased almost 2 times. </li></ul><br><p>  <strong>Minuses:</strong> </p><br><ul><li>  not found </li></ul><br><h2 id="test-disk--osnovnye-pokazateli-proizvoditelnosti-diskovoy-podsistemy">  Test Disk - the main performance indicators of the disk subsystem </h2><br><table><thead><tr><th>  Type </th><th>  KVM-384 </th><th>  KVM-1 </th></tr></thead><tbody><tr><td>  3221225472 bytes written in / seconds: </td><td>  50.91 </td><td>  6.94 </td></tr><tr><td>  on speed: </td><td>  60.34 MiB / sec </td><td>  442.72 MiB / sec </td></tr><tr><td>  File operations: </td><td></td></tr><tr><td>  reads / s: </td><td>  170.15 </td><td>  5630.07 </td></tr><tr><td>  writes / s: </td><td>  113.43 </td><td>  3753.05 </td></tr><tr><td>  fsyncs / s: </td><td>  357.51 </td><td>  12005.27 </td></tr><tr><td>  8.6 GB, 8.0 GiB copied / s </td><td>  144,183 </td><td>  11.9649 </td></tr><tr><td>  8.6 GB, 8.0 GiB copied, Mb / s </td><td>  59.6 </td><td>  718 </td></tr><tr><td>  Throughput: </td><td></td></tr><tr><td>  Read, MiB / s: </td><td>  2.66 </td><td>  87.97 </td></tr><tr><td>  written, MiB / s: </td><td>  1.77 </td><td>  58.64 </td></tr></tbody></table><br><p>  <strong>Pros:</strong> </p><br><ul><li>  The speed of writing many small files increased 7 times, and one large file 12 times. </li><li>  The read / write throughput increased about 33 times! </li><li>  We also came to the conclusion that the use of the hardware raid of the controller instead of the software positively affected the performance.  Additionally, the read speed has increased: when a hardware raid is running, 4 bytes are read by 1 byte from each disk.  And when a software raid is running, reading occurs 2 bytes only from the main pair. </li></ul><br><p>  <strong>Minuses:</strong> </p><br><ul><li>  Using RAID 10 does not provide the maximum speed that RAID 0 would give. We chose the best data security in the event of equipment failure, and minimizing downtime. </li></ul><br><p>  How do you feel about the fact that some hosters offer exactly RAID 0 to increase the speed of the VPS, but at the same time allow it to be idle when recovering user data up to 12 hours or more?  What is your priority? </p><br><h2 id="test-skorosti-raboty-cms-wordpress-bez-dopolnitelnoy-optimizacii">  Test the speed of CMS Wordpress without additional optimization </h2><br><table><thead><tr><th>  Type </th><th>  KVM-384 </th><th>  KVM-1 </th></tr></thead><tbody><tr><td>  Load time ms </td><td>  1810 </td><td>  903.7 </td></tr><tr><td>  Number of requests / min, </td><td>  1492 </td><td>  6331 </td></tr><tr><td>  read speed mb </td><td>  80.14 </td><td>  337.23 </td></tr><tr><td>  Requests / sec: </td><td>  24.62 </td><td>  105.41 </td></tr><tr><td>  Transfer / sec: </td><td>  1.32 </td><td>  5.61 </td></tr></tbody></table><br><p>  <strong>Pros:</strong> </p><br><ul><li>  Almost all indicators increased 4 times </li><li>  Site loading time decreased by 2 times. </li></ul><br><p>  <strong>Minuses:</strong> </p><br><ul><li>  not detected </li></ul><br><h3 id="podvedem-itogi-sravneniya">  Let's sum up the comparison </h3><br><p>  Got the result that was expected.  The new structure by all indicators exceeds the old one at times, and the read / write performance of the disk subsystem on the SSD is 33 times higher than the HDD. </p><br><h2 id="perenos-klientov-na-novye-vps">  Transfer customers to new VPS </h2><br><p>  Launch a new line of VPS is one thing.  The next stage seemed to be more difficult - the transfer of current customers. </p><br><p>  To ensure a smooth move without unnecessary downtime and haste, we decided that we would support the old structure for another 3 months.  This means that customers have enough time to decide whether to switch to a new SSD VPS or look for other accommodation options.  If so, then we offer a dedicated server :). </p><br><p>  We were worried that the new tariff plans had less disk space.  At the minimum tariff, the difference was only 5 GB, and at the older tariffs, the difference was more than 2 times.  We carried out a simple analysis and saw that no client used the space provided 100% on the old VPS.  This means that there will be no problems with resizing volumes during transfer. </p><br><p>  Marketers prepared a newsletter with the news and, fingers crossed, sent it to customers. </p><br><p><img src="https://media.giphy.com/media/12hhLP67q6PqCs/giphy.gif" alt="image"></p><br><p>  Surprisingly, our fears were not justified - users responded positively.  Many of them have been waiting for the transition of VPS to SSD from us.  Now servers are filled with virtual servers of both current clients and new ones.  We managed to bring our plans to life. </p><br><h2 id="feedback-matters">  Feedback matters </h2><br><p>  We create a service based on the needs of current and potential customers.  Therefore, we will be glad to your questions, advice and comments. </p><br><p>  In the coming months, we will update the current hosting structure and make the company site more pleasant and easier to use.  About all the nuances of this work, we will certainly share with you.  Stay tuned for blog updates! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/327588/">https://habr.com/ru/post/327588/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327578/index.html">How three schoolchildren hacked the source code of Final Fantasy V to localize it</a></li>
<li><a href="../327580/index.html">Microsoft itself</a></li>
<li><a href="../327582/index.html">How does the testing of the developers KOMPAS-3D</a></li>
<li><a href="../327584/index.html">Development: technical task on the site or concept?</a></li>
<li><a href="../327586/index.html">Cheeky telegram bot</a></li>
<li><a href="../327590/index.html">Gixy - open source from Yandex, which will make configuring Nginx safe</a></li>
<li><a href="../327592/index.html">Results of the third round of the Russian Code Cup 2017</a></li>
<li><a href="../327594/index.html">How to use the HTTP API to send emails</a></li>
<li><a href="../327596/index.html">Tale of creating a classic RTS at home from scratch (Part 2: "Resurrection")</a></li>
<li><a href="../327598/index.html">Security Week 17: DoublePulsar broke free, a hundred thousand Linksys found holes, SMSVova expelled from Google Play</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>