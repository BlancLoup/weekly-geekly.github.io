<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing a social network on MODx Revolution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="MODx is developing at a rapid pace, and I decided to try to make a social network on this wonderful engine. After all, it has long been possible to wo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing a social network on MODx Revolution</h1><div class="post__text post__text-html js-mediator-article">  MODx is developing at a rapid pace, and I decided to try to make a social network on this wonderful engine.  After all, it has long been possible <a href="http://modx.com/extras/package/login">to work with users</a> (registration, authorization, etc.), the built-in mechanism of <a href="http://habrahabr.ru/post/132802/">user messages</a> , he knows how <a href="http://modx.com/extras/package/phpthumbof">to work with images</a> and much more. <br><br>  To begin, let's deal with users, give them the opportunity to write articles, for example, or add their own events. <a name="habracut"></a><br><br><h4>  User registration </h4><br>  For registration, we will use the <a href="http://modx.com/extras/package/login">Login</a> snippet. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="html hljs xml">[[!Register? &amp;postHooks=`addUser` &amp;usergroups=`Users` &amp;submittedResourceId=`9` &amp;activationResourceId=`11` &amp;activationEmailSubject=`   ` &amp;validate=`email:email:required`]]</code> </pre> <br>  Much has already been written about the snippet, I‚Äôll show what our <b>addUser</b> hook <b>does</b> : <br><br><div class="spoiler">  <b class="spoiler_title">AddUser snippet</b> <div class="spoiler_text"><h6>  AddUser snippet </h6><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $output = <span class="hljs-string"><span class="hljs-string">""</span></span>; $parent = <span class="hljs-number"><span class="hljs-number">2</span></span>; $template = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     (  ) if ($id = $modx-&gt;runSnippet('addResource', array( 'pagetitle' =&gt; $hook-&gt;getValue('username'), 'parent' =&gt; $parent, 'template' =&gt; $template, 'isfolder' =&gt; 1, 'published' =&gt; 1, 'hidemenu' =&gt; 1 ))) { //  id     website // (     User Extended) $userId = $hook-&gt;getValue('register.user')-&gt;get('id'); $user = $modx-&gt;getObject('modUserProfile', array('id' =&gt; $userId)); $user-&gt;set('website',$id); $user-&gt;save(); //       TV-,   id  $modx-&gt;runSnippet('tv', array('id' =&gt; $id, 'tv' =&gt; 1, 'value' =&gt; $userId)); $modx-&gt;cacheManager-&gt;refresh(); $output = $id; } else { print '&lt;h1&gt;Can not to create the new user&lt;/h1&gt;&lt;p&gt;Please, tell us about this&lt;/p&gt;&lt;h2&gt;Contacts&lt;/h2&gt;&lt;p&gt;E-mail: &lt;a href="mailto:admin@site.ru"&gt;admin@site.ru&lt;/a&gt;&lt;/p&gt;'; die(); } return $output;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Snippet addResource</b> <div class="spoiler_text"><h6>  Snippet addResource </h6><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//        POST if (!$pagetitle) $pagetitle = $_POST['title']; if (!$longtitle) $longtitle = $_POST['longtitle']; if (!$content) $content = $_POST['content']; if (!$introtext) $introtext = $_POST['introtext']; if (!$description) $description = $_POST['description']; if (!$parent) $parent = $_POST['parent']; if (!$isfolder) $isfolder = $_POST['isfolder']; if (!$hidemenu) $hidemenu = $_POST['hidemenu']; if (!$template) $template = $_POST['template']; if (!$menutitle) $menutitle = $_POST['menutitle']; if (!$published) $published = $_POST['published']; if (!$publishedon) $publishedon = date('Ymd H:i:s'); //      , //      if (!$parent) $parent = 1; if (!$template) $template = 1; //     switch ($template) { case 1: $prefix = "art"; break; //  case 2: $prefix = "id"; break; //  case 3: $prefix = "id"; break; //  case 4: $prefix = "event"; break; //  case 5: $prefix = "animal"; break; //   default: $prefix = "id"; break; } //   $newResource = $modx-&gt;newObject('modResource'); //    $newResource-&gt;set('pagetitle',$pagetitle); $newResource-&gt;set('longtitle',$longtitle); $newResource-&gt;set('description',$description); $newResource-&gt;set('introtext',$introtext); $newResource-&gt;set('content',$content); $newResource-&gt;set('menutitle',$menutitle); $newResource-&gt;set('template',$template); $newResource-&gt;set('isfolder',$isfolder); $newResource-&gt;set('hidemenu',$hidemenu); $newResource-&gt;set('parent',$parent); $newResource-&gt;set('published',$published); $newResource-&gt;set('alias',$parent.date('YmdHis')); if ($published) $newResource-&gt;set('publishedon',$publishedon); //   if ($newResource-&gt;save()) { $id = $newResource-&gt;get('id'); $newResource-&gt;set('alias',$prefix.$id); $newResource-&gt;save(); //  ,      $modx-&gt;cacheManager-&gt;refresh(); return $id; } return false;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Snippet tv</b> <div class="spoiler_text"><h6>  Snippet tv </h6><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($input) { <span class="hljs-comment"><span class="hljs-comment">//    TV  id  $q = $modx-&gt;newQuery('modTemplateVarResource'); $q-&gt;select(array('value', 'tmplvarid', 'contentid'))-&gt;where(array('tmplvarid'=&gt;$options, 'contentid'=&gt;$input)); $r = $modx-&gt;getObject('modTemplateVarResource', $q); return $r-&gt;value; } else { //    TV if (!$id) {$id = $_POST['id'];} if (!$tv) $tv = $_POST['tv']; if (!$value) $value = $_POST['value']; if ($value == ' ') $value = ''; if ($modx-&gt;getObject('modTemplateVarResource', array('contentid' =&gt; $id, 'tmplvarid' =&gt; $tv))) { $tvar = $modx-&gt;getObject('modTemplateVarResource', array('contentid' =&gt; $id, 'tmplvarid' =&gt; $tv)); } else { $tvar = $modx-&gt;newObject('modTemplateVarResource'); $tvar-&gt;set('contentid', $id); $tvar-&gt;set('tmplvarid', $tv); } $tvar-&gt;set('value', $value); $tvar-&gt;save(); }</span></span></code> </pre><br></div></div><br><br>  After the user has confirmed his e-mail, we send it to the edit information page about yourself: <br><br><pre> <code class="html hljs xml">[[!FormIt? &amp;hooks=`editUserPage` &amp;successMessage=` `]] [[$editPage]]</code> </pre><br>  Respectively, the <b>editUserPage</b> snippet <br><div class="spoiler">  <b class="spoiler_title">Snippet editUserPage</b> <div class="spoiler_text"><h6>  Snippet editUserPage </h6><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//  id     $id = $modx-&gt;user-&gt;getOne('Profile')-&gt;get('website'); $name = $_POST['name']; if ($name == '') $name = ' '; //      if ($modx-&gt;runSnippet('editResource',array('resId' =&gt; $id, 'pagetitle' =&gt; $name, 'longtitle' =&gt; $name, 'menutitle' =&gt; $name, 'hidemenu' =&gt; 'show'))) { foreach ($_POST as $key =&gt; $value) { switch ($key) { case 'com_address': $tv = 2; break; case 'com_egrul': $tv = 5; break; case 'com_email': $tv = 9; break; case 'com_federate': $tv = 4; break; case 'com_head': $tv = 10; break; case 'com_inn': $tv = 6; break; case 'com_kpp': $tv = 7; break; case 'com_phone': $tv = 3; break; case 'com_regon': $tv = 8; break; default: $tv = 0; break; } if (!$value) $value = ' '; if ($tv) $modx-&gt;runSnippet('tv', array('id' =&gt; $id, 'tv' =&gt; $tv, 'value' =&gt; $value)); } //  ,      $modx-&gt;cacheManager-&gt;refresh(); return true; }</span></span></code> </pre><br></div></div><br><br><h4>  Create articles or user events </h4><br>  Let our users can add upcoming and past events to their page: <br><br><pre> <code class="html hljs xml">[[!FormIt? &amp;hooks=`addEvent` &amp;successMessage=` ` &amp;submitVar=`addEvent`]] [[$addEventForm]]</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">AddEvent snippet</b> <div class="spoiler_text"><h6>  AddEvent snippet </h6><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//       $parent = $modx-&gt;user-&gt;getOne('Profile')-&gt;get('website'); $name = $_POST['name']; $date = explode('.',$_POST['event_date']); $publishedon = $date[2]."-".$date[1]."-".$date[0]." 10:00:00"; $introtext = $_POST['description']; if ($id = $modx-&gt;runSnippet('addResource',array('pagetitle' =&gt; $name, 'longtitle' =&gt; $name, 'introtext' =&gt; $introtext, 'menutitle' =&gt; $name, 'published' =&gt; 1, 'publishedon' =&gt; $publishedon, 'parent' =&gt; $parent, 'template' =&gt; 4, 'isfolder' =&gt; 1))) { //    ,    foreach ($_POST as $key =&gt; $value) { switch ($key) { case 'event_address': $tv = 14; break; case 'event_type': $tv = 12; break; case 'event_org': $tv = 34; break; case 'event_peoples': $tv = 24; break; default: $tv = 0; break; } if (!$value) $value = ' '; if ($tv) $modx-&gt;runSnippet('tv', array('id' =&gt; $id, 'tv' =&gt; $tv, 'value' =&gt; $value)); } $modx-&gt;cacheManager-&gt;refresh(); //     $url = "/companies/id".$parent."/event".$id; header('location: '.$url); exit; return true; }</span></span></code> </pre><br></div></div><br><br><h5>  Eventually </h5><br>  On our site, users can register, post information about themselves, create events or write articles. <br><br><h5>  What do I plan to do with it </h5><br>  Next, I plan to make it possible for users to upload photos, add functionality for sending and reading private messages, as <a href="http://habrahabr.ru/users/goobs/" class="user_link">Goobs</a> <a href="http://habrahabr.ru/post/132802/">wrote</a> about this, as well as the ability of users to register for favorite events. </div><p>Source: <a href="https://habr.com/ru/post/148876/">https://habr.com/ru/post/148876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148871/index.html">Where can google glass lead us ...</a></li>
<li><a href="../148872/index.html">Blue Map of Germany</a></li>
<li><a href="../148873/index.html">Portrait of a lawyer against the background of technological progress</a></li>
<li><a href="../148874/index.html">12 more ‚ÄúMySQL recipes‚Äù in Bitrix24</a></li>
<li><a href="../148875/index.html">Display of dependent data on the example of cascading drop-down lists</a></li>
<li><a href="../148879/index.html">‚ÄúSimple Business‚Äù - Organization management complex. Version 1.6.6.0</a></li>
<li><a href="../148880/index.html">Moving Google Chrome profile to another folder, nuances</a></li>
<li><a href="../148881/index.html">How to speed up the scheduling algorithm</a></li>
<li><a href="../148882/index.html">ASCII StreetView</a></li>
<li><a href="../148883/index.html">How to cheat the Corporation of Good or buy Nexus 7 in Russia without Google Play Store</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>