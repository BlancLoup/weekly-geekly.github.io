<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hint glider in PostgreSQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is known that SQL is a declarative language that indicates ‚Äúwhat‚Äù we want to choose from the base, and ‚Äúhow‚Äù to do this - the DBMS itself decides. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hint glider in PostgreSQL</h1><div class="post__text post__text-html js-mediator-article">  It is known that SQL is a declarative language that indicates ‚Äúwhat‚Äù we want to choose from the base, and ‚Äúhow‚Äù to do this - the DBMS itself decides.  The task of selecting a specific query for the SQL query (plan) is solved by the query planner, which is available in almost any DBMS.  But sometimes he chooses not the best plan.  Many commercial DBMSs provide ‚Äúhints‚Äù for this case, which allow you to manually tell the database how best to execute the query.  There was no such mechanism in the Open Source DBMS PostgreSQL. <br><br>  And finally, something happened that many dreamed of and were already tired of waiting, while others were afraid.  Japanese <a href="https://www.oss.ecl.ntt.co.jp/ossc/">NTT</a> developers implemented PostgreSQL hints.  Moreover, they managed to do this without changing the kernel, as a separate <a href="http://en.sourceforge.jp/projects/pghintplan/">pg_hint_plan</a> module that supports PostgreSQL versions 9.1 and 9.2.  The module implements hints, allowing you to set methods for scanning and joining tables, setting GUC values.  For details of the installation and use, welcome under cat. <br><br><a name="habracut"></a><br>  From the site you can download the source archives separately for versions 9.1 and 9.2, which, however, do not differ absolutely nothing and are equally collected under both versions.  Anyway.  Assembling and installing the module does not cause problems: make &amp;&amp; make install.  The build will require a PostgreSQL dev package from your favorite distribution.  In order for PostgreSQL to pick up the module, no SQL is needed, just add pg_hint_plan to the shared_preload_libraries variable in the postgresql.conf file (instead, you can load the module into each session, where necessary, with the LOAD command).  After restarting the server, three new GUC variables will be available: pg_hint_plan.enable_hint, pg_hint_plan.debug_print, pg_hint_plan.parse_messages.  The first of them is responsible for the availability of hints (enabled by default), the remaining two are for logging. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Hints are specified in the comments to the query, decorated with / * and * /.  In order for a comment to be interpreted as a hint, it must have a + sign at the beginning, for example, / * + SeqScan (t1) * /.  Hints are of the following types. <br><br>  <b>Hints that are responsible for the table scan method</b> <br><br><ul><li>  SeqScan (table name) </li><li>  TidScan (table name) </li><li>  IndexScan (table name [index name]) </li><li>  IndexOnlyScan (table name [index name]) </li><li>  BitmapScan (table name [index name]) </li><li>  NoSeqScan (table name) </li><li>  NoTidScan (table name) </li><li>  NoIndexScan (table name) </li><li>  NoIndexOnlyScan (table name) </li><li>  NoBitmapScan (table name) </li></ul><br>  As the name of the table, you can specify both the name of the table itself and its alias in the query. <br><br>  <b>Hints that are responsible for the method of joining tables</b> <br><br><ul><li>  NestLoop (list of table names) </li><li>  HashJoin (list of table names) </li><li>  MergeJoin (list of table names) </li><li>  NoNestLoop (list of table names) </li><li>  NoHashJoin (list of table names) </li><li>  NoMergeJoin (list of table names) </li></ul><br>  The list of table names is separated by a space.  It is sensitive to order, that is, the connection is made exactly in the order in which the tables are listed. <br><br>  Also, two hints are highlighted: <br><ul><li>  Leading (list of table names) - establishes the order of joining tables without specifying a specific joining method </li><li>  Set (GUC value) - sets the GUC value of the variable for the duration of the query.  In general, it does not carry any new functionality, GUC and so it could be installed, just hint allows you to do it more succinctly (and quickly?). </li></ul><br>  It is time to try all this in action.  Let's create test tables, indexes, collect statistics. <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> test1 <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, (random()*<span class="hljs-number"><span class="hljs-number">1000</span></span>)::<span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> id_2, random() <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> value1, random() <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> value2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> generate_series(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1000000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> test2 <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, random() <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> generate_series(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> test1_id_idx <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> test1 (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> test1_id_2_idx <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> test1 (id_2); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> test1_value1_idx <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> test1 (value1); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> test1_value2_idx <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> test1 (value2); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> test2_id_idx <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> test2 (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> test2_value_idx <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> test2 (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); VACUUM <span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>;</code> </pre> <br><br>  Suppose we have a query that filters data by the values ‚Äã‚Äãof two fields. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> value1 <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">0.505</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> value2 <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">0.6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">0.61</span></span>;</code> </pre><br><br>  The glider decides to combine the index scan results for each of the fields using Bitmap Scan. <br><pre> <code class="sql hljs"> QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------- Bitmap Heap Scan on test1 (cost=319.82..514.76 rows=52 width=24) (actual time=9.575..9.736 rows=59 loops=1) Recheck Cond: ((value1 &gt;= 0.5::double precision) AND (value1 &lt;= 0.505::double precision) AND (value2 &gt;= 0.6::double precision) AND (value2 &lt;= 0.61::double precision)) -&gt; BitmapAnd (cost=319.82..319.82 rows=52 width=0) (actual time=9.529..9.529 rows=0 loops=1) -&gt; Bitmap Index Scan on test1_value1_idx (cost=0.00..113.54 rows=5318 width=0) (actual time=2.839..2.839 rows=5072 loops=1) Index Cond: ((value1 &gt;= 0.5::double precision) AND (value1 &lt;= 0.505::double precision)) -&gt; Bitmap Index Scan on test1_value2_idx (cost=0.00..206.00 rows=9764 width=0) (actual time=5.385..5.385 rows=10070 loops=1) Index Cond: ((value2 &gt;= 0.6::double precision) AND (value2 &lt;= 0.61::double precision)) Total runtime: 9.805 ms</span></span></code> </pre><br><br>  However, we can force it to use the usual Index Scan. <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*+ IndexScan(test1) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> value1 <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">0.505</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> value2 <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">0.6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">0.61</span></span>;</code> </pre><br><br><pre> <code class="sql hljs"> QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">-------------------------------------------------------------------------------------------------------------------------------- Index Scan using test1_value1_idx on test1 (cost=0.00..15198.71 rows=52 width=24) (actual time=0.124..10.704 rows=59 loops=1) Index Cond: ((value1 &gt;= 0.5::double precision) AND (value1 &lt;= 0.505::double precision)) Filter: ((value2 &gt;= 0.6::double precision) AND (value2 &lt;= 0.61::double precision)) Total runtime: 10.776 ms</span></span></code> </pre><br><br>  And even force it to use another index. <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*+ IndexScan(test1 test1_value2_idx) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> value1 <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">0.505</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> value2 <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">0.6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">0.61</span></span>;</code> </pre><br><br><pre> <code class="sql hljs"> QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">-------------------------------------------------------------------------------------------------------------------------------- Index Scan using test1_value2_idx on test1 (cost=0.00..22463.60 rows=52 width=24) (actual time=0.787..15.757 rows=59 loops=1) Index Cond: ((value2 &gt;= 0.6::double precision) AND (value2 &lt;= 0.61::double precision)) Filter: ((value1 &gt;= 0.5::double precision) AND (value1 &lt;= 0.505::double precision)) Total runtime: 15.816 ms (4 rows)</span></span></code> </pre><br><br>  The example is more complicated.  Connection of two tables with filtering by field of one table, sorting by field of another and LIMIT. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test1 t1 <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> test2 t2 <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> t1.id_2 = t2.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t2.value <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">0.51</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> t1.value1 <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre><br><br>  The glider selects a plan with an Index Scan for test1_value1_idx and Nested Loop. <br><pre> <code class="sql hljs"> QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">------------------------------------------------------------------------------------------------------------------------------------------------------- Limit (cost=4.33..2149.77 rows=100 width=36) (actual time=0.274..34.784 rows=100 loops=1) -&gt; Nested Loop (cost=4.33..171467.82 rows=7992 width=36) (actual time=0.271..34.753 rows=100 loops=1) Join Filter: (t1.id_2 = t2.id) -&gt; Index Scan using test1_value1_idx on test1 t1 (cost=0.00..51457.05 rows=1000000 width=24) (actual time=0.022..10.338 rows=11873 loops=1) -&gt; Materialize (cost=4.33..10.80 rows=8 width=12) (actual time=0.000..0.001 rows=8 loops=11873) -&gt; Bitmap Heap Scan on test2 t2 (cost=4.33..10.76 rows=8 width=12) (actual time=0.035..0.046 rows=8 loops=1) Recheck Cond: ((value &gt;= 0.5::double precision) AND (value &lt;= 0.51::double precision)) -&gt; Bitmap Index Scan on test2_value_idx (cost=0.00..4.33 rows=8 width=0) (actual time=0.026..0.026 rows=8 loops=1) Index Cond: ((value &gt;= 0.5::double precision) AND (value &lt;= 0.51::double precision)) Total runtime: 34.870 ms</span></span></code> </pre><br><br>  Suppose we want to use a different type of table join: HashJoin. <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*+ HashJoin(t1 t2) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test1 t1 <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> test2 t2 <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> t1.id_2 = t2.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t2.value <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">0.51</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> t1.value1 <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre><br><br>  Glider to submit, adding inside Bitmap Index Scan on test2, and outside - sorting with Limit. <br><pre> <code class="sql hljs"> QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">------------------------------------------------------------------------------------------------------------------------------------------------ Limit (cost=20516.23..20516.48 rows=100 width=36) (actual time=156.219..156.230 rows=100 loops=1) -&gt; Sort (cost=20516.23..20536.21 rows=7992 width=36) (actual time=156.217..156.225 rows=100 loops=1) Sort Key: t1.value1 Sort Method: top-N heapsort Memory: 32kB -&gt; Hash Join (cost=10.86..20210.78 rows=7992 width=36) (actual time=0.248..154.286 rows=7889 loops=1) Hash Cond: (t1.id_2 = t2.id) -&gt; Seq Scan on test1 t1 (cost=0.00..16370.00 rows=1000000 width=24) (actual time=0.013..63.210 rows=1000000 loops=1) -&gt; Hash (cost=10.76..10.76 rows=8 width=12) (actual time=0.066..0.066 rows=8 loops=1) Buckets: 1024 Batches: 1 Memory Usage: 1kB -&gt; Bitmap Heap Scan on test2 t2 (cost=4.33..10.76 rows=8 width=12) (actual time=0.044..0.057 rows=8 loops=1) Recheck Cond: ((value &gt;= 0.5::double precision) AND (value &lt;= 0.51::double precision)) -&gt; Bitmap Index Scan on test2_value_idx (cost=0.00..4.33 rows=8 width=0) (actual time=0.034..0.034 rows=8 loops=1) Index Cond: ((value &gt;= 0.5::double precision) AND (value &lt;= 0.51::double precision)) Total runtime: 156.335 ms</span></span></code> </pre><br><br>  If, for example, you specify the MergeJoin and IndexScan connection type by the test2_value_idx index, the glider, again, adds the necessary sorts and Limit. <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*+ MergeJoin(t1 t2) IndexScan (t2 test2_value_idx) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test1 t1 <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> test2 t2 <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> t1.id_2 = t2.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t2.value <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">0.51</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> t1.value1 <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre><br><br><pre> <code class="sql hljs"> QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">------------------------------------------------------------------------------------------------------------------------------------------------------------- Limit (cost=54410.09..54410.34 rows=100 width=36) (actual time=446.031..446.041 rows=100 loops=1) -&gt; Sort (cost=54410.09..54430.07 rows=7992 width=36) (actual time=446.029..446.032 rows=100 loops=1) Sort Key: t1.value1 Sort Method: top-N heapsort Memory: 32kB -&gt; Merge Join (cost=71.79..54104.65 rows=7992 width=36) (actual time=12.501..444.501 rows=7889 loops=1) Merge Cond: (t1.id_2 = t2.id) -&gt; Index Scan using test1_id_2_idx on test1 t1 (cost=0.00..51460.24 rows=1000000 width=24) (actual time=0.033..377.392 rows=900401 loops=1) -&gt; Sort (cost=24.52..24.54 rows=8 width=12) (actual time=0.074..0.545 rows=6927 loops=1) Sort Key: t2.id Sort Method: quicksort Memory: 25kB -&gt; Index Scan using test2_value_idx on test2 t2 (cost=0.00..24.40 rows=8 width=12) (actual time=0.026..0.047 rows=8 loops=1) Index Cond: ((value &gt;= 0.5::double precision) AND (value &lt;= 0.51::double precision)) Total runtime: 446.182 ms</span></span></code> </pre><br><br>  It can be noted that in all the examples cited, the situation only worsened from the use of hints.  With this I wanted to hint at what is worth thinking twice before using hints in real projects.  Even if you have a plan that is faster in this particular case, ask yourself the following questions: <br><ul><li>  Did you configure the airframe parameters * _cost, effective_cache_size, geqo *, etc.  in accordance with the available server resources? </li><li>  What data do you get a plan that runs faster?  Is there a production distribution like that?  Are you ready to rewrite hints when data distribution changes? </li><li>  The plan was executed faster when all that was needed was cached?  And at the time of the execution of this request on the production, everything will also be in the cache? </li></ul><br>  Still, hints are very useful in at least two situations: <br><ul><li>  I would like to understand more deeply the work of the airframe / executer, to get answers to the questions ‚ÄúWhat would happen if?‚Äù. </li><li>  Sometimes the glider is still very wrong.  For example, when there is a strong correlation between the fields of the table, which he does not know how to take into account.  Because of this, an incorrect assessment of the selectivity of the condition is obtained, and there may be a bad plan. </li></ul><br>  PS Thanks to Oleg Bartunov (aka <a href="http://habrahabr.ru/users/zen/" class="user_link">zen</a> ) for the tip-off on the module! </div><p>Source: <a href="https://habr.com/ru/post/169751/">https://habr.com/ru/post/169751/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169737/index.html">Donat, Liters and copyright. Total</a></li>
<li><a href="../169739/index.html">How to become a leading developer. Part 1</a></li>
<li><a href="../169743/index.html">Interactive Git Branching Tutor</a></li>
<li><a href="../169747/index.html">Project manager: how to make friends with a designer and not lose a client (or investor)</a></li>
<li><a href="../169749/index.html">Update Meizu MX and Meizu MX2 to Flyme 2.1.1</a></li>
<li><a href="../169761/index.html">Quotes in the clouds</a></li>
<li><a href="../169765/index.html">How did regular expressions appear</a></li>
<li><a href="../169767/index.html">Modification of Android applications from beginner and for beginners</a></li>
<li><a href="../169771/index.html">Solving problems on determining a fake coin by weighing</a></li>
<li><a href="../169773/index.html">PayOnline in Silicon Valley - or how we studied at Founders Bootcamp Silicon Valley</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>