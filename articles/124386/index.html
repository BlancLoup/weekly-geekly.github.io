<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Inventory of computers in the domain. Laziness is the engine of progress</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All welcome. 
 Recently, the authorities asked me to think about the issue of collecting information on the configuration of computers in our domain. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Inventory of computers in the domain. Laziness is the engine of progress</h1><div class="post__text post__text-html js-mediator-article"> All welcome. <br>  Recently, the authorities asked me to think about the issue of collecting information on the configuration of computers in our domain.  At first, the request was only on account of memory processors and hard drives.  The first thought is to go through the departments and please release the computer for a moment.  In the case of 1 computer is not difficult, but if they are 1500. Thoughts were directed towards PowerShell. <br><a name="habracut"></a><br>  First, it was necessary to extract a list of all computers in the domain.  In this example, my domain is Test.lan.  We import this entire list into the AllComputers.csv file. <br>  To do this, do not forget to add the module HELL for PS.  In my workplace, he is registered in the profile, and I advise you to do the same: <br><br> <code>import-module activedirectory <br> get-ADcomputer -Filter * | <br> Where-Object {$a=$_.name; $_.DistinguishedName -ne "CN=$a,OU=Disable,DC=Test,DC=lan"} | <br> Sort-Object name | Select-Object name | Export-csv C:\Invent\AllComputers.csv -NoTypeInformation <br></code> <br><br>  Here it is necessary to clarify that in my domain there is a Disable folder, where the accounts of all the disabled computers are located.  If they are disabled, then what's the point to knock on them.  Therefore, we exclude this folder from the search. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is clear to everyone that not all computers that are in the domain are turned on, work, or even have a place to be.  By this, before proceeding to the test, we check the connection with it.  Of course, you can not do this if you have 100 computers.  And if you have 2,000 computers, the loss of time with the number of turned off computers of the order of 800 will eat you a long time.  It is also worth remembering immediately the computers to which we do not have access.  It also makes no sense to knock on their door. <br><br> <code>import-csv c:\Invent\AllComputers.csv | foreach { <br> $a=$_.name <br> if ((Test-connection $a -count 2 -quiet) -eq "True") <br> { <br> if ((Get-WmiObject -computername $a Win32_OperatingSystem) -eq $null) <br> { <br></code> <br><br>  Many may argue: <br>  ‚ÄúWhy such difficulties?  Why first make a list and then import it.  Isn't it easier right away? ‚Äù <br>  I agree, it is easier.  But it‚Äôs nice to have a list of computers before your eyes.  In addition, the list is numbered.  And you always know how many computers you have in AD. <br><br>  For the connection test, I selected cmdlet Test-connection with the -quiet parameter, so that we would not get lines with different information, but simply give the answer: True or False.  At what we reduce the number of requests from 2 to 4. <br>  If we knock on a computer with a WMI request, and we don‚Äôt have rights to do so, we‚Äôll get a bunch of red lines with errors.  So we immediately filter such computers with a trial WMI request. <br><br>  Any information (probably almost any) can be found out if you get into WMI objects, and PS allows you to do it with a bang.  So I immediately went deeper into finding the right WMI objects. <br>  <a href="http://msdn.microsoft.com/en-us/library/aa394084(v%3DVS.85).aspx">Here</a> you can look at all the classes with their attributes. <br>  Making sure that the computer is online, that we have access to it, we look at its insides: <br><br> <code>Write-Host "  " -ForeGroundColor Green $a <br> "" | out-file c:\Invent\Comp\$a.txt <br> Get-WmiObject -computername $a Win32_OperatingSystem | <br> select-object csname, caption, Serialnumber, csdVersion | <br> ft @{Label=" "; Expression={$_.CSname}}, <br> @{label=""; Expression={$_.caption}}, <br> @{label=""; Expression={$_.csdVersion}}, <br> @{label=" "; Expression={$_.SerialNumber}} -auto -wrap | <br> out-file c:\Invent\Comp\$a.txt -append <br> Get-WmiObject -computername $a Win32_ComputerSystemProduct | select-object UUID | <br> ft UUID -autosize | out-file c:\Invent\Comp\$a.txt -append <br> "" | out-file c:\Invent\Comp\$a.txt -append <br> Get-WmiObject -computername $a Win32_Processor | select-object name, SocketDesignation, Description | <br> ft @{label=""; Expression={$_.name}}, <br> @{label=""; Expression={$_.SocketDesignation}}, <br> @{label=""; Expression={$_.Description}} -auto -wrap | out-file c:\Invent\Comp\$a.txt -append <br> " " | out-file c:\Invent\Comp\$a.txt -append <br> Get-WmiObject -computername $a Win32_BaseBoard | select-object Manufacturer, Product, SerialNumber | <br> ft @{label=""; Expression={$_.manufacturer}}, <br> @{label=""; Expression={$_.Product}}, <br> @{label=" "; Expression={$_.SerialNumber}} -auto -wrap | <br> out-file c:\Invent\Comp\$a.txt -append <br> " " | out-file c:\Invent\Comp\$a.txt -append <br> Get-WmiObject -computername $a Win32_DiskDrive | select-object Model, Partitions, Size, interfacetype | <br> ft @{Label=""; Expression={$_.Model}}, <br> @{Label=" "; Expression={$_.Partitions}}, <br> @{Label=" ()"; Expression={($_.Size/1GB).tostring("F00")}}, <br> @{Label=""; Expression={$_.interfaceType}} -auto -wrap | <br> out-file c:\Invent\Comp\$a.txt -append <br> " " | out-file c:\Invent\Comp\$a.txt -append <br> Get-WmiObject -computername $a Win32_LogicalDisk -Filter "DriveType=3" | select-object DeviceID, FileSystem, Size, FreeSpace | <br> ft @{Label=""; Expression={$_.DeviceID}}, <br> @{Label=" "; Expression={$_.FileSystem}}, <br> @{Label=" ()"; Expression={($_.Size/1GB).tostring("F00")}}, <br> @{Label="  ()"; Expression={($_.FreeSpace/1GB).tostring("F00")}} -auto -wrap | <br> out-file c:\Invent\Comp\$a.txt -append <br> " " | out-file c:\Invent\Comp\$a.txt -append <br> Get-WmiObject -computername $a Win32_Physicalmemory | Select-Object capacity, DeviceLocator | <br> ft @{Label=" ()"; Expression={($_.capacity/1MB).tostring("F00")}}, <br> @{Label=""; Expression={$_.DeviceLocator}} -auto -wrap | <br> out-file c:\Invent\Comp\$a.txt -append <br> "" | out-file c:\Invent\Comp\$a.txt -append <br> Get-WmiObject -computername $a Win32_videoController | <br> Select-Object name, AdapterRAM, VideoProcessor | <br> ft @{Label=""; Expression={$_.name}}, <br> @{Label="  ()"; Expression={($_.AdapterRAM/1MB).tostring("F00")}}, <br> @{Label=""; Expression={$_.VideoProcessor}} -auto -wrap | <br> out-file c:\Invent\Comp\$a.txt -append <br> " " | out-file c:\Invent\Comp\$a.txt -append <br> $OS=Get-WmiObject -computername $a Win32_OperatingSystem | foreach {$_.caption} <br> if ($OS -eq "Microsoft Windows 2000 Professional") <br> { <br> Get-WmiObject -computername $a Win32_NetworkAdapterConfiguration -Filter "DHCPEnabled=True" | <br> Select-Object caption,MACaddress | <br> ft @{Label=""; Expression={$_.caption}}, <br> @{Label="MAC "; Expression={$_.MACAddress}} -auto -wrap | <br> out-file c:\Invent\Comp\$a.txt -append <br> } <br> else <br> { <br> Get-WmiObject -computername $a Win32_NetworkAdapter -Filter "NetConnectionStatus&gt;0" | <br> Select-Object name, AdapterType, MACAddress | <br> ft @{Label=""; Expression={$_.name}}, <br> @{Label="MAC "; Expression={$_.MACAddress}}, <br> @{Label=""; Expression={$_.AdapterType}} -auto -wrap | <br> out-file c:\Invent\Comp\$a.txt -append <br> } <br> } <br></code> <br><br>  All information about the computer falls into a text file. <br>  Here it is worthwhile to pay attention to 2 points. <br>  First, the <code>Write-Host "  " -ForeGroundColor Green $a</code> I did exclusively for myself, for it is nice to know what PowerShell is doing at the moment. <br>  Secondly, why we check the OS before checking the network card. <br>  Unfortunately, Windows 2000 does not respond to the Win32_NetworkAdapter request, so we apply the Win32_NetworkAdapterConfiguration request to it.  Why not just leave the last one?  You can leave it, but the Win32_NetworkAdapter returns an attribute such as Name, when its analog is Caption only.  Trifle, but nice. <br>  You can also see that when checking a network card, we check it for operability, otherwise we will get a list of several more cards that you are not currently interested in.  Do you need this? <br><br>  That's basically it. <br>  The script can be customized to your needs. <br>  So now the bosses are unlikely to scare you inventory of computers. </div><p>Source: <a href="https://habr.com/ru/post/124386/">https://habr.com/ru/post/124386/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../124380/index.html">Personal data protection - implementation experience</a></li>
<li><a href="../124382/index.html">Helping people instead of business: Google‚Äôs actions after the Japan earthquake</a></li>
<li><a href="../124383/index.html">Open Science and Open Education</a></li>
<li><a href="../124384/index.html">New in Ext GWT 3.0</a></li>
<li><a href="../124385/index.html">Physical Standby DB for Oracle SE</a></li>
<li><a href="../124387/index.html">FAQ on the leak of SMS texts from the MegaFon website</a></li>
<li><a href="../124388/index.html">Acceleration of Python code using the language itself</a></li>
<li><a href="../124389/index.html">Electrodnevnik</a></li>
<li><a href="../124392/index.html">Windows 8 system requirements will not differ from Windows 7</a></li>
<li><a href="../124394/index.html">Errors and errors of customers in the development of a corporate website</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>