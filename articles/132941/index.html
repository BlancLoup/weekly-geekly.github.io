<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Highstock: monitoring Runet Premium</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For a long time in my projects I used Flash-graphics, instead of ordinary images. They are both prettier and more functional, and the server does not ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Highstock: monitoring Runet Premium</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/2b64261c/3d31ff27/189296f1/cd0858bd.jpg" align="left">  For a long time in my projects I used Flash-graphics, instead of ordinary images.  They are both prettier and more functional, and the server does not need to strain to generate images.  But due to the fact that some firms are not very friendly with Flash, I had to look for a replacement without using Flash. <br><br>  Before that, I used AmCharts, first of all I looked at their website, they already released the JS version of their charts, but somehow they didn‚Äôt like it, it felt damp.  After a brief googling, Highstock, from the authors Highcharts JS, was found.  It differs primarily in the ability to display graphs tied to time, with a large number of points, scaling, easy navigation.  Yes, and superficially liked more AmCharts. <a name="habracut"></a><br><br><h4>  Data collection </h4><br>  For training, so that it was not too boring, I decided to make a simple page with monitoring the results of the popular vote of the Runet Prize.  So you can practice with the schedule, and see if there will be anomalous behavior on the ballot (usually talking about cheating). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Especially I will not paint training, in general.  Since I don‚Äôt have anything to do with the award itself, I simply wrote a PHP script that downloads the main page, parses it with regulars, and then puts the number of votes and positions in the database.  The script is hung on crowns and runs every 5 minutes. <br><br><h4>  Data preparation </h4><br>  So, there is data, now you need to think about how to display them.  Since the sites participating in the voting of 50 pieces, plus the gaps between the sites are 2 orders of magnitude, it does not make sense to display all the sites together.  Having a little thought, I stopped at the following output options: <br><ol><li>  By default, the first 3 positions are displayed. </li><li>  The ranges of 10 positions (1-10,11-20, etc.). </li><li>  Selection of specific sites (1,3,10). </li><li>  If only one site is selected, then its closest competitors are also shown, one to the position above, the other to the position below. </li></ol>  Next you need to decide on the format of the generated data.  In Highstock understands 3 options. <br><ol><li>  A simple array with values ‚Äã‚Äãfor the Y axis; in such cases, the X values ‚Äã‚Äãare calculated automatically in accordance with the specified rules. <br><pre><code class="javascript hljs">data: [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code> </pre> </li><li>  An array containing the X, Y values. <br><pre> <code class="javascript hljs">data: [[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>], [<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>], [<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>]]</code> </pre> </li><li>  An array of objects is the most advanced option, allowing at least every point to adjust. <br><pre> <code class="javascript hljs">data: [{ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">' 1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">'#00FF00'</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">' 2'</span></span>, <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">'#FF00FF'</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> }]</code> </pre> <br></li></ol>  I chose the second option, since the first did not fit due to the fact that the bonus is periodically in Dauna and there are ‚Äúholes‚Äù in the chart, and in the third there is redundant functionality that is not needed in this case. <br><br>  Also, since I need to display several graphs, I decided to get rid of the duplication of time.  As a result, the PHP script generates data in JSON format: <br><pre> <code class="javascript hljs">data: [ [<span class="hljs-number"><span class="hljs-number">1</span></span>, id1val, id2val,‚Ä¶,idNval], <span class="hljs-comment"><span class="hljs-comment">//   [2, id1val, id2val,‚Ä¶,idNval], //   ‚Ä¶ ]</span></span></code> </pre> <br>  Where the first value means time (timestamp is divided into 300 seconds and the starting time is taken away).  To convert data into separate arrays for each graph, we write the function <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     var c = info.data.length; //   for(var i = 0, l = info.title.length; i &lt; l; i++){ seriesOptions[i] = { name: info.title[i], //   data: [] //     }; for(var j = 0; j &lt; c; j++){ //   timestamp      seriesOptions[i].data.push([(info.data[j][0] + 4404683) * 300000, info.data[j][i+1]]); } }</span></span></code> </pre> <br><h4>  Customize the look of graphics </h4><br>  To begin with, we will translate the displayed inscriptions into Russian, change the thousands separator, and make sure that the time is not displayed in UTC, but in the user's local time. <br><pre> <code class="javascript hljs">Highcharts.setOptions({ <span class="hljs-attr"><span class="hljs-attr">lang</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rangeSelectorZoom</span></span>: <span class="hljs-string"><span class="hljs-string">'c'</span></span>, <span class="hljs-attr"><span class="hljs-attr">rangeSelectorFrom</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">rangeSelectorTo</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">thousandsSep</span></span>: <span class="hljs-string"><span class="hljs-string">' '</span></span> }, <span class="hljs-attr"><span class="hljs-attr">global</span></span>: { <span class="hljs-attr"><span class="hljs-attr">useUTC</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } });</code> </pre> <br>  Next, customize the appearance with the help of the options object.  First general options. <br><pre> <code class="javascript hljs">chart: { <span class="hljs-attr"><span class="hljs-attr">renderTo</span></span>: <span class="hljs-string"><span class="hljs-string">'chart'</span></span>, <span class="hljs-comment"><span class="hljs-comment">// DIV       zoomType: 'x', //     X backgroundColor: '#f9f9f9' //     }</span></span></code> </pre> <br>  Setting the buttons for selecting time intervals. <br><pre> <code class="javascript hljs">rangeSelector: { <span class="hljs-attr"><span class="hljs-attr">buttons</span></span>: [{ <span class="hljs-comment"><span class="hljs-comment">//       type: 'hour', //  : 'millisecond', 'second', 'minute', 'day', 'week', 'month', 'ytd' ( ), 'year' and 'all' count: 3, //     type text: '3 ' }, { type: 'all', text: '' }], inputDateFormat: '%d.%m.%Y', //          inputEditDateFormat: '%d.%m.%Y', buttonTheme: { width: 60 //    }, selected: 2 //      }</span></span></code> </pre> <br>  Now let's take a pop up hint (displayed when hovering over the chart) <br><pre> <code class="javascript hljs">tooltip: { <span class="hljs-attr"><span class="hljs-attr">backgroundColor</span></span>: <span class="hljs-string"><span class="hljs-string">'rgba(250, 250, 250, .85)'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//    borderColor: 'rgba(100, 100, 100, .90)', //   (   ) xDateFormat: '%d.%m.%Y %H:%M', //    //      headerFormat: '&lt;span style="font-size: 12px"&gt;{point.key}&lt;/span&gt;&lt;br/&gt;', //    ,   ,    pointFormat: '&lt;span style="color:{series.color}"&gt;{series.name}&lt;/span&gt;: &lt;b&gt;{point.y}&lt;/b&gt;&lt;br/&gt;' }</span></span></code> </pre> <br>  Turn on and customize the legend (by default it is turned off).  Brought up as the output <br>  under the chart, while it works clumsily (superimposed on the time scale), as well as the output on the side (long names are not cut correctly) <br><pre> <code class="javascript hljs">legend: { <span class="hljs-attr"><span class="hljs-attr">enabled</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">align</span></span>: <span class="hljs-string"><span class="hljs-string">'center'</span></span>, <span class="hljs-attr"><span class="hljs-attr">itemWidth</span></span>:<span class="hljs-number"><span class="hljs-number">234</span></span>, <span class="hljs-comment"><span class="hljs-comment">//  ,     4  verticalAlign: 'top' }</span></span></code> </pre> <br><br><h4>  Result </h4><br>  After all gathered in a heap, we add for convenience buttons of a choice of sites.  And watch the "battle of the titans." <br><br>  <a href="http://f1p.net/premia/"><b>This is how it looks like</b></a> : <br><img src="http://habrastorage.org/storage1/33b60dbc/83e46e70/82e2b7ab/436dd2d2.jpg"><br>  In the near future, I also want to tighten the auto-update so that every 5 minutes only new points are downloaded and added to the schedule.  But there are still quite a few glitches in the library, with not very standard actions. <br><br>  And finally, some links: <br>  <a href="http://www.highcharts.com/">Highcharts and Highstock official website</a> <br>  <a href="http://www.highcharts.com/stock/ref/">Docs on Highstock API</a> <br>  <a href="http://www.amcharts.com/">The official website amCharts</a> </div><p>Source: <a href="https://habr.com/ru/post/132941/">https://habr.com/ru/post/132941/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132933/index.html">Work the right job right, and the money will find you</a></li>
<li><a href="../132935/index.html">Codeforces: Unknown Language Round # 4</a></li>
<li><a href="../132936/index.html">A quick start in developing Firefox add-ons</a></li>
<li><a href="../132937/index.html">Gyazo on your own server</a></li>
<li><a href="../132938/index.html">Tactoom. New opportunities</a></li>
<li><a href="../132942/index.html">Fast encryption of your messages</a></li>
<li><a href="../132943/index.html">Getting to translate tutorials on Max / MSP</a></li>
<li><a href="../132944/index.html">New Russian music service zvooq.ru</a></li>
<li><a href="../132946/index.html">Sergey Brin donated $ 500 thousand to Wikimedia</a></li>
<li><a href="../132947/index.html">jQuery Mobile 1.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>