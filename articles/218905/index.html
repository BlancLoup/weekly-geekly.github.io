<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing Photo Frames for Yandex.Disk for Android and Windows</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In e-Legion, we try to keep track of everything that happens in the development world, and constantly try out different solutions for our projects. Fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing Photo Frames for Yandex.Disk for Android and Windows</h1><div class="post__text post__text-html js-mediator-article">  In <a href="http://e-legion.ru/">e-Legion,</a> we try to keep track of everything that happens in the development world, and constantly try out different solutions for our projects.  For 8 years on the application development market, we took on a variety of projects for various platforms and tried to tell about the most interesting cases in Habr√©. <br><br>  We have been working with Yandex for more than 3 years and during this time i have been imbued with services and the entire ecosystem of the main search of the country.  Therefore, when the SDK for Yandex.Disk was introduced last October, we wondered what it could do, and we decided to develop a simple Photo Frame application for Android and Windows. <br><br> <a href="http://www.e-legion.ru/portfolio/projects/fotoramka"><img src="https://habrastorage.org/getpro/habr/post_images/e81/573/17c/e8157317ccd8909c7dba4dcd76ea3dc6.jpg"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The idea of ‚Äã‚Äãthe application is simple: you upload photos to Yandex.Disk, synchronize the application with your account and get a slide show.  To share photos with friends and parents, you just need to configure the application on their devices and share the folder with photos on Yandex.Disk to their accounts.  Photos will automatically appear in the "Photo Frame" on other devices.  In general, it is easier <a href="http://www.e-legion.ru/portfolio/projects/fotoramka">to try</a> once. <br><a name="habracut"></a><br><br>  Our goal was to make a simple and convenient application for easy sharing of new photos with friends and family, so the program interface was made as simple and clear as possible.  At initial start-up, a wizard is shown where the user can select a directory for synchronization and change some default settings.  After selecting a folder for synchronization, ‚ÄúPhoto Frame‚Äù recursively scans the entire directory structure.  Next, the files are filtered, and only image files are loaded into the cache on the user's device. <br><br>  After the synchronization operation is completed, PhotoFrame periodically polls the server to view changes in the directory structure or files.  When a change is detected, the synchronization mechanism is restarted.  If the user does not have an Internet connection, the PhotoFrame works in offline mode - all functions except for synchronization with the server remain in operation.  By the way, the Windows application has a nice bonus: the ability to customize the screensaver and the automatic change of desktop wallpaper.  This is easily implemented by changing several parameters in the registry and calling the WinAPI function. <br><br><h4>  Windows </h4><br>  The Windows version of Photoframe was written in C # on the .NET Framework 4.0.  The choice is not the latest version of the .NET Framework due to the support of Windows XP. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f24/f8c/713/f24f8c7134ade7537c2182877b57be78.png"><br><br>  The client application is built on the basis of the Windows Presentation Foundation (WPF), using the MVVM design pattern.  The ‚ÄúPhoto Frames‚Äù installer is written using the Windows Installer Xml (WiX) toolkits. <br><br><h4>  Android </h4><br>  Android application works on versions starting from 2.3.  While developing the PhotoFrame application, we decided to try implementing a ‚Äúslideshow‚Äù for the screen, the so-called Immersive mode, which was introduced in Android 4.4 (for more information about it you can read here <a href="http://habrahabr.ru/post/200874/">habrahabr.ru/post/200874</a> ).  But our goal was to make an application that would work skillfully not only with version 4.4.  You could hide both the statusbar and the on-screen buttons on previous versions of Android 4.x (as it was implemented in the YouTube app 4.3).  With active Immersive Mode on version 4.4, tapE causes TouchEvent on the screen, while in fullscreen mode on version 4.3, the first tap is exited, and only the second tap goes to the view that was clicked.  Our task was to catch tap across the screen and show an additional layer on top of the image, and therefore it was necessary to catch this first tap. <br>  To find out about the exit from full-screen mode on 4.3, you had to call getWindow (). GetDecorView () from the activation and from the resulting view, put the listener setOnSystemUiVisibilityChangeListener (...). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/050/3d5/1ec/0503d51ec0dbaad858d880af3781fd23.png"><br><br>  But this was not all that smooth.  The onSystemUiVisibilityChange method was called only a full second after we tapped and exited full-screen mode.  Thus, I had to abandon this idea completely and hide the on-screen buttons on devices with versions up to 4.4.  As a result, on the fours we set the fullscreen and low_profile flags, and on the other devices with 2.3 or 3.x - just fullscreen. <br><br><h4>  Yandex.Disk SDK </h4><br>  The Windows SDK is written in C # under .NET 4.0 and represents several Visual Studio projects.  Among these projects there are examples of implementing your own application for each of the platforms.  SDK without changes is connected to the development on Windows Phone 7.5 and higher, Windows Store and Silverlight 4 and higher applications.  Looking at the example of a project under Windows, it was not difficult for us to build the entire logic of the Photoframe with Yandex.Disk. <br><br>  User authentication is performed via OAuth protocol or using Basic authentication to choose from.  To synchronize with the server, we used GetListAsync and DownloadFileAsync.  It is seen that all methods are asynchronous, and this is undoubtedly a plus. <br><br>  While working with the Windows SDK, we discovered a small error.  If there is a file larger than two gigabytes on Yandex.Disk, then the GetListAsync method will not be able to return a list of files from this directory.  The source code of the SDK quickly managed to detect the problem: the maximum permissible value for Int32 was exceeded.  As a result, the decision took no more than five minutes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/da6/63b/c54/da663bc54abfd49be3c57f83f65cbac5.png"><br><br>  Under the Android SDK is a plug-in library.  All its features are discussed in detail in the sample application, which is distributed with the SDK in the GitHub repository.  It also shows the most optimal way of how to implement authorization in an application: first, an existing Yandex account is searched for the device, which the user logged in through any of the official Yandex applications, and if there is one, then the input occurs through it.  If not, then you should send the user to the browser to the login page of the account. <br><br>  First you need to create an OAuth application on the <a href="https://oauth.yandex.ru/client/new">appropriate page</a> .  In the same place, fill in the "Callback URI" field with some url, the return to which we will later catch in our application via intent-filter Authorization Activity.  Thus, we get access_token, which is required for working with the SDK. <br>  To upload images in the PhotoFrame, it was necessary to use the API method that allows you to receive images in the required reduced resolution corresponding to the screen size.  Unfortunately, access to this method in the current version of the SDK has not yet been implemented, so I had to tweak the method a bit to upload files and add the ability to pass an additional parameter ‚Äúsize‚Äù to it. <br><br>  The source code for the SDK can be downloaded from GitHub using the links <a href="https%253A%252F%252Fgithub.com%252Fyandex-disk%252Fyandex-disk-sdk-csharp%26sa%3DD%26sntz%3D1%26usg%3DAFQjCNF2jxCWf2e_X_xG2fe3BrhSqjcfGQ">for Windows</a> and <a href="http://api.yandex.ru/disk/sdk/">for Android</a> . <br><br><h4>  Conclusion </h4><br>  All development took a little more than a month.  As a result, we got a simple application that will help you quickly make a slideshow of your photos and share it with your family and friends. <br><br>  The application has already been released, you can download it from the links on <a href="http://www.e-legion.ru/portfolio/projects/fotoramka">the project description page</a> . <br><br>  We will be glad to your feedback and questions. </div><p>Source: <a href="https://habr.com/ru/post/218905/">https://habr.com/ru/post/218905/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../218893/index.html">IT subsystems of the sports center: pre-reality, security, medicine, point accounting, etc.</a></li>
<li><a href="../218895/index.html">(For) what is feeding and watering developers in the office ?!</a></li>
<li><a href="../218897/index.html">Quadcopter control using Oculus Rift</a></li>
<li><a href="../218899/index.html">Yandex investigated how the Internet developed in the regions of Russia in 2013</a></li>
<li><a href="../218903/index.html">Open Terminal Client OTC-110 - we are already selling</a></li>
<li><a href="../218907/index.html">Heartbleed vulnerability: our recommendations to users</a></li>
<li><a href="../218911/index.html">The book "Linux. System Programming. 2nd ed. "</a></li>
<li><a href="../218913/index.html">Why, after the discovery of Heartbleed, we do not offer Mail.Ru Mail users to change passwords</a></li>
<li><a href="../218915/index.html">Rip windows xp</a></li>
<li><a href="../218917/index.html">Survey on different moments of security in a web studio / agency</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>