<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to optimize a site on Magento</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Magento is slow. Sometimes very slowly. In this article, we have compiled a translation of two articles on the consistent acceleration of an online st...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to optimize a site on Magento</h1><div class="post__text post__text-html js-mediator-article"><img alt="0bbc5c5a3b67408cb9b0b8cf75cd9139.gif" src="https://habrastorage.org/files/0bb/c5c/5a3/0bbc5c5a3b67408cb9b0b8cf75cd9139.gif"><br><p><br></p><br><p>  Magento is slow.  Sometimes very slowly.  In this article, we have compiled a translation of two articles on the consistent acceleration of an online store based on Magento: from the first to the last byte. </p><br><p>  Accelerating the loading of pages simply consists of two components: ‚Äútime to the first byte sent‚Äù (TTFB - time to first byte) and rendering time in the browser.  Before proceeding to optimize the frontend, you need to try to improve the TTFB. </p><br><a name="habracut"></a><br><h2>  TTFB optimization </h2><br><p>  First of all, we need to understand what happens inside Magento.  For this we use an excellent built-in tool - Magento Profiler.  It will show a list of internal calls to Magento and the corresponding duration of the work. </p><br><p><img alt="b68c3daa912b4ccb9c774cad738eb3f4.png" src="https://habrastorage.org/files/b68/c3d/aa9/b68c3daa912b4ccb9c774cad738eb3f4.png"></p><br><p>  You can also put Profiler calls within your code to measure performance and identify bottlenecks. </p><br><h2>  How to enable Magento Profiler </h2><br><p>  In the Magento admin area, go to System&gt; Configuration&gt; Advanced&gt; Developer&gt; Debug&gt; Profiler and switch there to ‚ÄúYes‚Äù. </p><br><p><img alt="6cad79edeaae4892a3d62e6d9d1bd0a9.png" src="https://habrastorage.org/files/6ca/d79/ede/6cad79edeaae4892a3d62e6d9d1bd0a9.png"></p><br><p>  In the index.php file you need to make the following commented line active: </p><br><pre> Varien_Profiler :: enable ();

 ... </pre><br><br><p>  Make sure you reset your cache in Magento to access Profiler. </p><br><h3>  How to use profiler in your code </h3><br><p>  You need to add the lines Varien_Profiler :: start ('any_name') and Varien_Profiler :: stop ('any_name') to the block of code to which you want to apply the Profiler. </p><br><blockquote><pre> Varien_Profiler :: start ('any_name_here');

 .... The code block on Magento, which is too slow ...;

 Varien_Profiler :: end ('any_name_here');

 ... </pre></blockquote><br><h3>  What profiler issues </h3><br><p>  <em>Code Profiler</em> - the identifier that you used in the calls <em>Varien_Profiler :: start</em> and <em>Varien_Profiler :: stop</em> </p><br><p>  <em>Time</em> - the time in seconds that the code takes between <em>Varien_Profiler :: start</em> and <em>Varien_Profiler :: stop</em> </p><br><p>  <em>Cnt</em> - the number of times this block of code was launched during page loading </p><br><p>  <em>Emalloc</em> is the amount of memory allocated to the PHP process while this section of code is running via the <em>emalloc</em> system call </p><br><p>  RealMem is the amount of physical memory allocated to the PHP process while this section of code is running. </p><br><h2>  Disable unnecessary modules </h2><br><p>  Go to the page of your site and see what Profiler shows.  First find the lines with the word OBSERVER.  These are observation modules that are most likely to be launched each time the page is accessed.  Some of them can be disabled.  For example, if you do not use testimonials or sales rule settings, you can disable the corresponding Mage_Review and Mage_SalesRule modules. </p><br><p>  Here is a rough list of the default Magento extensions that you may not need: </p><br><ul><li>  Mage_Reviews </li><li>  Mage_SalesRule </li><li>  Mage_Wishlist </li><li>  Mage_Bundle </li><li>  Mage_Downloadable </li><li>  Mage_Paypal </li><li>  Mage_Log </li></ul><br><p>  You may also have additional extensions installed that you no longer need, but which launch their frontend monitoring module each time the page loads.  It slows down your site. </p><br><h3>  Optimize code in .phtml theme files </h3><br><p>  PHP code in the theme files can be optimized.  Here is an example: </p><br><blockquote><pre> &lt;? php $ _collection = $ this-&gt; getLoadedProductCollection ();  ?&gt;

 &lt;? php &lt;strong&gt; foreach &lt;/ strong&gt; ($ _ collection &lt;strong&gt; as &lt;/ strong&gt; $ _product):?&gt;

  &lt;? php $ _product = Mage :: getModel ('catalog / product') -&gt; load ($ _ product-&gt; getId ())?&gt;

 &lt;? php echo $ _product-&gt; getSku ()?&gt;

 &lt;? php &lt;strong&gt; endforeach &lt;/ strong&gt;;  ?&gt; </pre></blockquote><p>  You do not need to load the model from catalog / product in each foreach cycle, because the $ _product variable already defines the model from catalog / product.  If the set of goods is large enough, you may have many, many unnecessary hits. </p><br><p>  This is just one of the examples of how non-optimized php code can be. </p><br><p>  To reduce the time to send the first byte and speed up your site, you need to view all the .phtml files and audit the code in them.  Particular attention is paid to the structures of cycles. </p><br><h3>  Update Magento to the latest version. </h3><br><p>  The Magento team is constantly working to improve its product.  If you have an older version of Magento, please upgrade.  New releases contain changes to the code in many kernel files, which is aimed at improving the internal logic of Magento. </p><br><h2>  Frontend Optimization </h2><br><p>  Now we will look at how to speed up rendering in the browser with a real example. </p><br><h3>  1. Category page </h3><br><p>  Initially, Google Page Speed ‚Äã‚Äãshows 68/100. </p><br><p><img alt="6be07336add449e68c2d4e81228aa432.png" src="https://habrastorage.org/files/6be/073/36a/6be07336add449e68c2d4e81228aa432.png">  First of all, we need to postpone loading of JS, that is, ‚Äúremove the blocking rendering of Javascript and CSS in the content that is visible on the screen immediately (above-the-fold - ATF)‚Äù. </p><br><p>  <strong>Remove blocking rendering</strong> <strong>JS / CSS</strong> </p><br><p>  How to do it?  It is necessary to select internal Javascript and place it in one function.  Then access this function at the end of the download and process the entire external JS. </p><br><p>  <strong>Shorten</strong> <strong>JS / CSS</strong> </p><br><p>  Compressing and shortening JS / CSS files is available as separate extensions for Magento. </p><br><p>  <strong>Provide priority</strong> <strong>CSS</strong> <strong>for immediately visible content.</strong> </p><br><p><img alt="ee3486f92a164e6698e4664c8bf4e3a3.png" src="https://habrastorage.org/files/ee3/486/f92/ee3486f92a164e6698e4664c8bf4e3a3.png">  This means that we have too much content placed in the part of the page that is visible on the screen immediately (ATF).  Therefore, you need to determine the most important CSS that is needed to render this content and include it inside the file, the rest of the CSS should be loaded asynchronously. </p><br><p>  By doing this, we get the following result: </p><br><p><img alt="9e02aa67e25045bc878b9b936dcd3390.png" src="https://habrastorage.org/files/9e0/2aa/67e/9e02aa67e25045bc878b9b936dcd3390.png">  As we can see, the tab with the filter is open by default, and this leads to the fact that all the html-content associated with the filter must be loaded. </p><br><p><img alt="e5597bf6889b46efab3e4c2c75bea0a3.png" src="https://habrastorage.org/files/e55/97b/f68/e5597bf6889b46efab3e4c2c75bea0a3.png"></p><br><p>  You can make the bookmark with the filter invisible by default by adding ‚Äúdisplay: none‚Äù to the corresponding CSS <a href="https://habrahabr.ru/users/media/" class="user_link">media</a> request. </p><br><p>  Now we got a speed estimate of 100/100! </p><br><p><img alt="dc29823478f34945822b348f5af94094.png" src="https://habrastorage.org/files/dc2/982/347/dc29823478f34945822b348f5af94094.png"></p><br><h3>  2. Other pages </h3><br><p>  Now that we have already done the work on TTFB and on JS and CSS deferred loading, all we have to do is to go through the remaining pages and work on the immediately visible content (ATF). </p><br><p>  Here are the results that were achieved for the product card, the page with the cart and the typical site page: </p><br><p><img alt="d91c67f0d5384e96b976d948a6a6eee9.png" src="https://habrastorage.org/files/d91/c67/f0d/d91c67f0d5384e96b976d948a6a6eee9.png">  <em>Score by</em> <em>Google</em> <em>PageSpeed</em> <em>typical site page</em> </p><br><p><img alt="3a49fee946d24cb0bd06831f5ba86da0.png" src="https://habrastorage.org/files/3a4/9fe/e94/3a49fee946d24cb0bd06831f5ba86da0.png">  <em>Score by</em> <em>Google</em> <em>PageSpeed</em> <em>Item Cards</em> </p><br><p><img alt="0bbc5c5a3b67408cb9b0b8cf75cd9139.gif" src="https://habrastorage.org/files/0bb/c5c/5a3/0bbc5c5a3b67408cb9b0b8cf75cd9139.gif">  <em>Score by</em> <em>Google</em> <em>PageSpeed</em> <em>basket page</em> </p><br><p>  Thus, we managed to get a 100/100 speed estimate for almost all pages of the site. </p><br><p>  In conclusion, we note that the work on the acceleration of the site can be difficult and monotonous, but the results will please you.  Pages of your site will load much faster even without a cache.  Cache! = Performance.  Therefore, first of all you need to optimize the TTFB that you receive on your Magento-site, and then optimize the frontend display. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/323632/">https://habr.com/ru/post/323632/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323622/index.html">Developing the mechanics of the game Bounce from Nokia JavaScript</a></li>
<li><a href="../323624/index.html">Memory models underlying programming languages</a></li>
<li><a href="../323626/index.html">Intel Software Guard Extensions Extensions Tutorial. Part 6, two branches of code</a></li>
<li><a href="../323628/index.html">Testing Conference Heisenbag: Video recordings of reports-2016 and work on the bugs in 2017</a></li>
<li><a href="../323630/index.html">Videos: February TechLeads Mitap at Badoo</a></li>
<li><a href="../323634/index.html">Stacker: what's new?</a></li>
<li><a href="../323636/index.html">Top 10 errors in open projects With ++ for 2016</a></li>
<li><a href="../323638/index.html">Direction Finder on Augmented Reality</a></li>
<li><a href="../323640/index.html">Hacker put up for sale 640 thousand stolen user accounts PlayStation</a></li>
<li><a href="../323644/index.html">Another new feature pg_filedump: restore the PostgreSQL directory</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>