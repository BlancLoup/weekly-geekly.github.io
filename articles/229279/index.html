<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How the SMSDirect system works</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 After reading here about the comparison of SMS services for mailings , we decided to tell you about our experience in building such a system...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How the SMSDirect system works</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/702/b22/2b0/702b222b07cc8247cb63576f34f8c371.png" alt="image" align="left"><br><br>  Hello! <br><br>  After reading here about the <a href="http://habrahabr.ru/company/bankfilter/blog/227305/">comparison of SMS services for mailings</a> , we decided to tell you about our experience in building such a system, which faithfully and faithfully serves us for several years and is constantly being improved and improved.  We hope our experience will be useful to you.  In general, those who are interested, please under the cat. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  What is our SMS messaging system? </h4><br>  The main task of the SMSDirect system is to send or send single SMS messages. <br><br>  <b>Frontend</b> <br>  The service represents the whole complex, the tip of the iceberg of which is the client part - the site.  This is the entry point to the system.  There is a personal account (if you want to download mailing lists manually), as well as a set of API methods for creating mailings and sending messages. <br>  To log in, the client must register, and then use either a set of API methods or a personal account interface.  Here, the following functions are implemented: loading and storing customer client databases (subscriber lists), as well as creating and managing mailings for these lists (or manually entered numbers). <br><br>  <b>Backend</b> <br>  Compounding systems: a solution capable of processing a large amount of data of the same type and forming mailings from them and a reliable mechanism linking our system with operators.  The principal task here is to store a huge amount of user databases, their quick processing and access to them. <br><br>  <b>Routing</b> <br>  Since we have a very large amount of data, we had to decide how to process them, divide and route them. <br>  After we divided the entire volume of data across several internal connections, we needed to ensure that each message got into the necessary gateway.  Accordingly, messages need to be distributed in a certain way to the operators.  Such distribution is carried out in the complex routing, which is a system of applications that is engaged in the direction of millions of messages on a particular gateway.  The division is based on the analysis of the message attributes: the subscriber‚Äôs belonging to one or another operator (not just by code, but by the serving operator), message text, sender number, that is, message properties are fully analyzed and processed.  Thus, we solve the problem of message distribution: the distribution seems to be one, and the messages are distributed and go in different ways depending on their operator (subscriber number) and, for example, the sender's number.  Routing traffic is handled by several dedicated servers, representing part of the infrastructure outside the UI and backend. <br><br><h4>  Internal architecture </h4><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a95/6e3/1fa/a956e31fab1580c077898ed496f0ce8f.jpg"><br><br>  The web server that handles user access to the UI and API requests is nginx. <br>  This solution is a classic, almost universal for such problems.  Lower level, it would be logical to deploy an Apache web server, but we decided not to use them, thus saving resources (we don‚Äôt need all the functionality, and it‚Äôs not advisable to pay the full price for the 1% of our capabilities we need), and created our own Perl core .  This is what, in fact, is the basis of the system. <br><br>  <b>Why Perl?</b> <br>  Short answer: <s>So it</s> happened. Historically. <br>  Long answer: This is a holivarny question, in fact there is no particular reason to use this or that language.  The key issue in a large and complex project is a well-designed architecture, not a language.  We have specialists who know and love different languages, the story has turned out that when developing this project, the specialists who know Perl showed the greatest zeal :) At the same time, since Perl was finally chosen, we can note the advantages of this language, the most important of which Undoubtedly, there are CPAN (read - ready-made solutions for any task) and maturity of the language (read - guaranteed performance of the code during updates (here pin to PHP)). <br><br>  <b>Core</b> <br>  The kernel interacts with the web server via the FastCGI interface, which, firstly, serves to forward the request that came to us and the received nginx to our kernel, secondly, FastCGI and its associated modules represent the kernel launching mechanism in the form of several ‚Äúdaemons‚Äù, There is always a kernel running. <br><br>  The core itself is divided into several separate "demons", each of which is responsible for its own part of the processes.  The most important of them are a site with a personal account, a set of API, functionality that is responsible for downloading files from the user (subscriber bases), and the core also includes a service part that does not interact with external data and is focused exclusively on internal (service) processes.  By itself, this part is divided into several low-level functions.  For example, when a user has downloaded a subscriber database, at first the system sees it as just a certain file with data that is not suitable for work.  After the file is loaded, it is processed - the subscriber numbers are checked for correct length and prefixes, empty and too short numbers are discarded, that is, the raw file is converted into some standard internal structure containing subscriber numbers, ID, region identifier and some other service parameters . <br><br>  <b>Database</b> <br>  The databases loaded by the user are saved to disk and lie in the file system, but after we have run through our service scripts, the necessary descriptive information is retrieved from them, which is stored in the database.  This information is structured, in it you can make queries with filters for each attribute. <br>  When processing databases and allocating some necessary entities from them, or when processing the received statistics, sorting takes up a huge amount.  Conventional sorters are unsuitable for such a volume and complexity of sorting, so for this we use MSORT. <br><br>  <b>File system</b> <br>  As the user loads us with large subscriber lists, they need to be stored somewhere, plus each mailing generates a huge amount of own service data: a block of generated messages for the mailing list, statuses received for these blocks, as well as a final file for export.  Intermediate files are deleted after the broadcast is complete.  For example, sending out 10 million messages causes 3-5 signals for each of them, and this is already 30-50 million records to a file.  In general, we generate billions of records that we should not lose, because at any moment the client may need to understand the details.  To do this, a separate file storage is connected to our kernel. <br>  In some cases, there is an urgent need to find some specific record in a particular file, be it a base of numbers or some other statistics.  Reading it from start to finish is long and expensive, so in a number of processes we use the forgotten tool by many - Berkeley DB (BDB).  This kind of hash on the disk, which contains a certain identifier, which indicates the offset in the file from which you want to read the necessary information. <br><br>  <b>Routing and delivery of information to operators</b> <br>  The kernel interacts with the internal routing system that sends SMS messages to operators.  This part was developed by i-Free and supported by the company's infrastructure. <br>  We are connected to the operators, and send messages (SMS messages) using native tools.  As a rule, this is SMPP, which the operator assigns to its suppliers. </div><p>Source: <a href="https://habr.com/ru/post/229279/">https://habr.com/ru/post/229279/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229261/index.html">GUI in the game World of Tanks. Part Two: GUI Structure Overview and Future Plans</a></li>
<li><a href="../229263/index.html">Login to a web application using face recognition</a></li>
<li><a href="../229267/index.html">JBrainfuck - Writing a Brainfuck compiler for Java VM</a></li>
<li><a href="../229269/index.html">The evolution of extension language: the story of Lua</a></li>
<li><a href="../229273/index.html">Tarantool User Group Meetup in Moscow</a></li>
<li><a href="../229285/index.html">IBM Watson will help cooks to create new recipes using the new application</a></li>
<li><a href="../229287/index.html">Theme for night reading Habrahabr</a></li>
<li><a href="../229289/index.html">The mode of resetting the smartphone to the factory state is not a guarantee of deleting personal information</a></li>
<li><a href="../229291/index.html">HTML element <time></a></li>
<li><a href="../229293/index.html">Chrome Remote Desktop extension now supported in Ubuntu and Debian</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>