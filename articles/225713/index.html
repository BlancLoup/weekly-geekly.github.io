<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>One successful iBeacon implementation: 200 beacons for RIF + CIB 2014</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="According to the original idea, the article was supposed to be called ‚ÄúEasy way to leave to sleep‚Äù, but who will surprise you now? So, under the cut a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>One successful iBeacon implementation: 200 beacons for RIF + CIB 2014</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/150/ff9/c81/150ff9c814530eb6225ad09c50685971.png" align="left">  According to the original idea, the article was supposed to be called ‚ÄúEasy way to leave to sleep‚Äù, but who will surprise you now?  So, under the cut a small story awaits you about how our team introduced indoor navigation through iBeacon on the territory of RIF + KIB 2014, as well as about all the packs and other adventures we encountered along the way. <br><a name="habracut"></a><br><h5>  Foreword </h5><br>  In a nutshell, it‚Äôs worth talking about technology.  iBeacon is a small bluetooth beacon that can transmit information about its identifiers (UUID, major, minor) to surrounding devices.  A person with an installed application comes up to the beacon, the smartphone receives data about it and sends it to us to the server.  We find this beacon in our database and send the user coordinates on the ground.  Naturally, if the user is in sight of two or three beacons, we can determine his location more precisely. <br><br>  All of the above is very convenient indoors - where GPS can not provide a sufficiently high accuracy for navigation. <br>  Of course, this technology opens up a lot of amazing opportunities, and our team with great enthusiasm took up the development of a platform and a mobile SDK for working with beacons. <br><br><h5>  Part 1. Preparation </h5><br>  Having played enough with several test samples of beacons, having prepared the first versions of the configuration service and the iOS SDK, we felt the strength to do something more.  It was the end of February, the RIF + CIB conference looked like an excellent option for the first major launch: it was two months before it, and this hoo, anything can be done in such a time frame, right? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It was necessary to have time: <br><ul><li>  understand how many beacons you need, purchase and receive them; </li><li>  find or prepare some kind of tool that will allow you to batchly set up a whole bunch of beacons (give them the correct identifiers, indicate the power and frequency); </li><li>  develop an iOS application for conference participants; </li><li>  substantially complete the web platform; </li><li>  and a trifle - to come to the place and set the correct beacons at the correct points. </li></ul><br><br>  The test copies of the beacons that were at our disposal were far from being as good as those about which they now write so much on the net: they beat at a distance of 5-10 meters, and not at all at 50, while they all worked a little differently and not very stable.  But their low cost and our optimism were decisive factors - it was decided to order them for the conference. <br><br>  Having received from the organizers an approximate map of the exhibition, as well as a small piece of the architectural plan with indicated dimensions, we began to think over the optimal location of the beacons. <br><br>  The problems began when it was discovered that the architectural plan, the drawn map of the event and the view of the same place on google maps resemble each other only in separate places.  The contours, proportions and sizes of buildings were obviously different. <br>  Get a more accurate map was not possible. <br><br>  Of course, the best solution would be to go there about a month before the conference and independently figure out the scale, manually correct the map, think over the best points to place the beacons.  But at that moment we decided to calculate the required number of beacons approximately and throw something ‚Äúon top‚Äù in some way. <br><br>  Another major difficulty was setting beacons.  The fact is that for the devices we chose there was an iOS application that allows you to see all the available beacons and set up each one by typing them manually using the on-screen keyboard in the form of hexadecimal values.  It was absolutely not suitable for setting up two hundred beacons.  In this regard, one of our developers took up the creation of a tool that allows you to get the entire list of visible beacons, specify the necessary settings and relax, watching how the beacons get these settings and have a funny wink at the blue diode.  It was March and everything went according to plan. <br><br>  The preparation of the mobile application itself and the web interface for navigation control on the RIF went perfectly until the last moment. <br><br><h5>  Part 2. RIF + CIB </h5><br>  After our arrival in Moscow 2 days before the event, events developed rapidly, each few hours revealing new unforeseen circumstances. <br><br><h6>  Circumstance 1 </h6><br>  It turned out that it is difficult to assemble beacons from parts, and when there are 200 of them it is even more difficult.  Parts of the case do not fit together well; printed circuit boards do not quite fit the lid into which they need to be inserted. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/404/391/d1b/404391d1b56ce50124ce1bc306d72fa3.jpg"><br><br>  In general, for a couple of hours we looked like inexperienced employees of an underground Chinese factory.  But the deed was done: the batteries were inserted, the printed circuit boards were securely driven into the enclosures, and the front and back covers were connected as much as possible.  Victory. <br><br><h6>  Circumstance 2 </h6><br>  Contrary to our hopes, it turned out that the program for batch tuning of the heap of beacons works stably only if the heap size is &lt;= 10 pcs.  But we were not going to give up. <br><br>  It was only necessary to think of a way to somehow get rid of the signal of the extra 190 beacons when setting up the next batch: everything got lost if the program cut more beacons than was required. <br><br>  Remembering that the range of the beacons is not so great, we just carried the bag with them to the next room and ... were shocked to find that the current party worked much better than the one we had a month ago.  The signal remained excellent anywhere in the apartment. <br><br>  I did not want to remove the batteries: too much irreplaceable effort was invested in the assembly.  One absolutely reliable shielding method was experimentally developed: a bag of beacons was placed in a thick-walled cauldron and closed with a lid, and the cauldron was placed on the bottom of a cast-iron bath. <br><br>  Having run all night with a bunch of beacons in the bathroom and back, by 5 am we finished setting up. <br><br><img src="//habrastorage.org/files/cf1/7c4/a48/cf17c4a48213477587813bfe90f54bad.JPG"><br><br><h6>  Circumstance 3, climax </h6><br>  Despite minor technical difficulties, the installation of beacons on the territory of the future exhibition was very cheerful.  We arranged them according to a previously prepared plan, and practically did not have to move away from it. <br><br>  Having installed about 100 pieces, we decided to check the navigation.  While the person with the bag of beacons ran off for several tens of meters from the hull (the cauldron and the shielding bath were not at hand), the other had to walk along the hull with the phone and follow the navigation in the application. <br><br>  The result was terrifying.  The application showed that the user is marking time all the time somewhere in the northern part of the building.  This corresponded to an error of 5-10 meters and it was unacceptable. <br><br>  A couple more experiments - the same result. <br><br>  This panic is experienced by a student who pulled out an unfamiliar ticket on an important exam.  So feel in the face of almost imminent failure.  We settled in some empty room and began to think.  One of the developers ( <a href="http://habrahabr.ru/users/grohman/" class="user_link">grohman</a> ) <a href="http://habrahabr.ru/users/grohman/" class="user_link">turned</a> circles around the hall, from time to time glancing at the application, until he noticed a simple thing that for some reason did not immediately occur to us.  The coordinates of the location were calculated correctly, but the map itself was shifted south of the real coordinates, which gave such a distortion in the location map. <br><br>  With the good old method ‚Äúby eye‚Äù we selected an amendment for all coordinates transmitted to the application.  Everything fell into place. <br><br><h6>  Circumstance 4 </h6><br>  Soon we were replaced by another part of the team ( <a href="http://habrahabr.ru/users/itruf/" class="user_link">itruf</a> , <a href="http://habrahabr.ru/users/suprum/" class="user_link">suprum</a> ).  Having sent us to rest, they were going to place the remaining beacons and finally to start everything.  After an hour and a half later, they called with bad news: the location does not work again, and this time the distortions appear and disappear suddenly, the error amounts to several tens of meters.  Being on our feet for almost two days, we stared at the monitor frantically, watching fantastic throwing ‚Äúpins‚Äù of location on the map. <br><br>  Analyzing tons of logs, we managed to find an amazing thing: in the list of beacons visible to the device, from time to time came across the beacon # 68, which in that place should not be visible.  Soon the true suspicion crept in, and we asked the guys to go to the place where that beacon should be installed and see what happened to it.  Naturally, he was not there. <br><br>  Someone peeled off # 68 from the wall and walked with it in his pocket, from time to time creating a kind of ‚Äúpresence effect‚Äù for the system. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/431/97c/dcc/43197cdcc55c6876bb46f4b69c0471f6.png"><br><br>  Turning off data processing from this beacon, we again received decent data on the location, but we were faced with the question of how to deal with such situations the next time. <br><br>  The following solution was implemented: each beacon has ‚Äúneighbors‚Äù - other beacons located at a distance &lt;= N.  When the user sends us data about visible beacons and signal level (rssi), we select the beacons with the largest rssi and check whether the other beacons are their neighbors.  If we find a beacon, which obviously should not be a neighbor here, we exclude it from the calculation of the location.  The location worked well again. <br><br><h5>  Total </h5><br>  Then there were some more urgent bug fixes, three days of the conference, a lot of interesting people and events.  Despite all the passions in the last days of preparation, we were able to launch indoor navigation with the help of BLE beacons, demonstrated (yes, we were convinced ourselves) that it works.  For ourselves, we were able to draw several conclusions: <br><br><ul><li>  Testing "in miniature" will never replace testing in combat conditions.  Check navigation on several beacons even in a spacious room - not enough to be sure that navigation will work with two hundred beacons per 1000 square meters </li><li>  saving time and effort on planning is a very bad saving option.  If we paid more attention to the accuracy of the map from the very beginning, we would not have to adjust the coordinates manually on the last evening. </li><li>  to attach beacons to double-sided tape - not reliably </li><li>  several sleepless nights are not so big a payment for the opportunity to realize the first in the country so large-scale project of navigation on BLE beacons  We got an interesting and unusual experience and we hope that we will soon tell you about new projects introducing indoor navigation and more. </li></ul><br><br>  In the comments we will be happy to answer questions about the implementation details. </div><p>Source: <a href="https://habr.com/ru/post/225713/">https://habr.com/ru/post/225713/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../225703/index.html">Google plans to indicate in the issue that the results have been deleted by the demand of the search query figurant</a></li>
<li><a href="../225705/index.html">K2: Kepler's Second Light</a></li>
<li><a href="../225707/index.html">Detained hackers who used stolen Apple IDs to block iDevice</a></li>
<li><a href="../225709/index.html">Mobile version of Habr: version 2.0</a></li>
<li><a href="../22571/index.html">Instant eyedropper</a></li>
<li><a href="../225715/index.html">Mobile banking development for RaiffeisenBank</a></li>
<li><a href="../225719/index.html">Disaster Recovery Planning. Part one</a></li>
<li><a href="../22572/index.html">"Living Shield" at the behest of the traffic police</a></li>
<li><a href="../225721/index.html">What nobody told you about z-index in the article ‚ÄúWhat nobody told you about z-index‚Äù</a></li>
<li><a href="../225723/index.html">How to use Tomita-parser in your projects. Practical course</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>