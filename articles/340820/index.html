<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We configure Windows Server so that you have everything, while you had nothing for it</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Parallels Parallels Remote Application Server (RAS) is a RDP with a human face, but some of its chips must be configured on the Windows Server side (o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We configure Windows Server so that you have everything, while you had nothing for it</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/59/ef/0a/59ef0a928d569476905420.png"><br>  <a href="https://habrahabr.ru/company/parallels/blog/332766/">Parallels Parallels Remote Application Server</a> (RAS) is a <a href="https://ru.wikipedia.org/wiki/Remote_Desktop_Protocol">RDP</a> with a human face, but some of its chips must be configured on the Windows Server side (or in the virtual machines that you use).  Under the recommendations of Matthew Korovin from Parallels technical support team about Windows Server settings when using RAS. <a name="habracut"></a><br><br>  Below are group policies that can make your Parallels RAS (or just a terminal server) more convenient and secure.  For a more targeted use of the following configurations, we recommend creating a separate Parallels RAS user group and applying group policies to it. <br><br><img src="https://habrastorage.org/webt/59/ef/10/59ef10dbe81b8083919057.png"><br><h3>  <font color="#cc0000">Part one.</font>  <font color="#cc0000">"Prohibition"</font> </h3><br>  <b>Hiding elements of the explorer (Disks, "Start" button, etc.)</b> <br>  By default, when connected to a terminal server \ virtual machine, a user added to the "Remote Desktop Users" group will see a fully functional desktop. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Local drives will be visible to him and often available.  Agree, this is a good security hole, if the user even with his limited rights will be able to access local disks and files on a remote server. <br><br>  Even if you establish the correct access control and thereby protect yourself, the shy juzver will still confuse the disks of the terminal server with his local disks and call those support in horror.  The best solution to this situation is to hide the local disks of the terminal server from the inquiring gaze and user. <br><br>  Group Policy Location: <br><br>  <b><i>User Configuration \ Policies \ Administrative Templates \ Windows Components \ Windows Explorer</i></b> <b><br></b> <br>  And change the value of the following options: <br><br>  ‚Ä¢ <b>By</b> changing the value of this option, you can remove the mention of specific drives from the computer menu and all related menus, but this does not prevent access to the drives.  If the user sets the absolute address of the disk, it will open. <br>  ‚Ä¢ <b>Prevent access to drives from My Computer</b> - block access to specific drives.  When this option is enabled, disk access will be limited, but disks will be displayed in file explorer. <br><br>  What else can be hidden from the user using this group policy: <br><br>  ‚Ä¢ <b>Remove Run menu from Start Menu</b> - when activated, removes the "Start" button from the menu <br>  ‚Ä¢ <b>Remove Search button from Windows Explorer</b> - everything is simple here: search in the explorer will be unavailable <br>  ‚Ä¢ <b>Disable Windows Explorer's default context menu</b> - this function makes it impossible for the user to call up the menu by right-clicking the mouse (you can buy old mice from the poppy and save on one button) <br><br>  After writing this part, the deputy's passion for bans woke up.  Against this background, it is worth telling you how you can ban everything from the user. <br><br>  And so it went: <br><br>  <b>We prohibit the use of the command line</b> (even if the user can open the CMD, he will just have to admire the black window with the access denied notification) <br><br>  Group Policy Location: <br><br>  <b>User Configuration ‚Üí Policies ‚Üí System ‚Üí System ‚Üí Prevent access to the command promt</b> . <br><br>  Change the value to <b>enabled</b> . <br><br>  The <b>Disable the command prompt script processing also</b> prevents the user from running scripts. <br><br>  There is one caveat: if you have logon scripts configured when you enable this option, they will not be executed. <br><br>  <b>We remove the off / reboot / sleep buttons</b> (it will be a shame if a remote user accidentally turns off the terminal server) <br><br>  Group Policy Location: <br><br>  <b>Shut Down, Restart, Sleep, and Hibernate Commands ‚Üí Configuration Menu ‚Üí Administrative Templates ‚Üí Start Menu and Taskbar</b> <br><br>  When this option is enabled, the user can only block or log out of the session. <br><br>  <b>Forbid Autostart "Server Management" at login</b> <br>  Group Policy Location: <br><br>  <b>Computer Configuration ‚Üí Policies ‚Üí Administrative Templates ‚Üí System ‚Üí Server Manager ‚Üí Do not display Server Manager automatically at logon</b> <br><br>  Change the value to <b>enabled</b> . <br><br>  <b>Forbidding the launch of PowerShell</b> <br>  Group Policy Location: <br><br>  <b>User Configuration ‚Üí Policies ‚Üí Administrative Templates ‚Üí System ‚Üí Windows Run</b> <br><br>  We enable this policy and add the following applications there. <br>  <b>powershell.exe and powershell_ise.exe</b> <br><br>  <i>This policy can prevent the launch of any installed (and not installed) applications.</i> <br><br>  <b>Hide control panel items</b> <br>  Group Policy Location: <br><br>  <b>User Configuration ‚Üí Administrative Templates ‚Üí Control Panel ‚Üí Show only specified Control Panel items.</b> <br><br>  <i>When this policy is enabled, all control panel items will be hidden from the user.</i>  <i>If any items should be available to the user, add them to the exceptions.</i> <br><br>  <b>We prohibit the launch of the registry editor</b> <br>  Group Policy Location: <br><br>  <b>User Configuration ‚Üí Policies ‚Üí Administrative Templates ‚Üí System ‚Üí Registry Tools</b> <br><br>  <i>Change the value to <b>enabled</b> .</i> <br><br>  <b>Ban all</b> <br>  The logical conclusion of this part of the article will be a story about how to prohibit all users.  There is an opinion that the user should connect to a remote desktop, look at it and, after being convinced of the triumph of technical progress, disconnect. <br><br>  To achieve this goal, we need to create a group policy for adding additional keys in the Windows registry: <br><br>  Group Policy Location: <br><br>  <b>User Configuration \ Preferences \ Windows Settings \ Registry</b> <b><br></b>  <b>Click the right mouse button on the Registry then New then the Registry item</b> <br><br>  Add a new <b>REG_DWORD RestrictRun parameter</b> with a value of 1 to the registry key <br>  <b>HKCU \ Software \ Microsoft \ Windows \ CurrentVersion \ Policies \ Explorer \</b> <br><br>  Now the user is not allowed to run any applications other than the system ones. <br><br>  How to prevent him from using <b>CMD and Power Shell is</b> described above. <br><br>  If you still decide (solely out of the goodness of your heart) to allow users to launch any applications, they will need to be added to the ‚Äúallow list‚Äù by creating in the key <br><br>  <b>HKCU \ Software \ Microsoft \ Windows \ CurrentVersion \ Policies \ Explorer \ RestrictRun</b> <br><br>  By the value of the string type, using the sequence number of the program being resolved as a name (numbering, as it is not strange, starts with 1), and the name of the program being resolved as a value. <br><br>  Example: <br><br>  <b>HKCU \ Software \ Microsoft \ Windows \ CurrentVersion \ Policies \ Explorer \ RestrictRun]</b> <b><br></b>  <b>String Name: "1" = "notepad.exe"</b> <b><br></b>  <b>String Name "2" = "calc.exe"</b> <br><br>  With this configuration, the user can only run a notepad and calculator. <br><br>  At this point I want to finish the ‚ÄúProhibition‚Äù part.  Of course, you can mention a certain amount of ‚ÄúLow‚Äù, but all this is configured through the Parallels Client and the built-in policies of Parallels RAS. <br><br><img src="https://habrastorage.org/webt/59/ef/12/59ef1218e09e3639769513.png"><br><br><h3>  <font color="#cc0000">Part two.</font>  <font color="#cc0000">‚ÄúTime and Other Romance‚Äù</font> </h3><br>  <b>Setting time limits for remote sessions</b> <br><br>  It happens that the user runs the application in the background and may not even use it.  If it is not scary for ordinary applications, then a published application / desktop running in the background is licensed, and licenses, no matter how crazy it sounds for Russia, cost money. <br><br>  To address this issue, smart people from Microsoft have come up with various terminal session statuses and time limits for them. <br><br>  What are the statuses of terminal sessions: <br><br>  <b>Active</b> - the session is active and something happens in it.  The user moves the mouse, presses the buttons and creates an imitation of violent activity <br>  <b>IDLE</b> - there is a connection, the session is running, the application is running, but the user does not show activity <br>  <b>Disconnected</b> - the user pressed the cross and disconnected.  Explain to the end user what kind of animal the logof and what it eats is useless. <br><br>  It is most advisable to set a time frame for IDLE and Disconnected sessions. <br>  Nothing happens in them, and licenses are involved. <br><br>  We can achieve this again using group policies. <br><br>  Group Policy Location: <br><br>  <b>User Configuration ‚Üí Policies ‚Üí Administrative Templates Administrative Templates ‚Üí Windows Components ‚Üí Remote Desktop Services ‚Üí Remote Desktop Session Host ‚Üí Session Time Limits</b> <br><br>  There are several options in this thread.  Let's break them all down: <br><br>  <b>Remote Desktop Services Services</b> <br><br>  Maximum work time for <b>Active</b> sessions. <br><br>  <b>Remote Desktop Services sessions</b> <br><br>  Maximum running time for <b>IDLE</b> sessions. <br><br>  <b>Set time limit for disconnected sessions</b> <br><br>  Maximum running time for <b>disconnected</b> sessions. <br><br>  <b>End session when time limits are reached</b> <br><br>  If you set this policy to <b>Enabled</b> status, then upon reaching the time limit of the session will be completed, and not disabled. <br><br>  Setting time limits is an important step to optimize server operation and optimize software costs. <br><br>  <b>Setting login time for users or say no to rework</b> <br>  Each of us has a working day, as well as morning, evening and night.  But British (or Maltese) scientists recently found out that from work, it turns out, you can get sick or even die.  Work is a very strong and dangerous drug, so in the ardent care of your favorite users, we must limit the time for them to log in to the server.  And then they will also decide to work from home, holidays and on weekends.  And not group politicians will help us in this.  Setting the runtime is in the user properties.  Somewhere far at the beginning of this article, I mentioned that it is better to perform all manipulations with a specially created group of Parallels RAS users, so, using this group as an example, we will discuss how to set up working hours. <br><br>  Go to the lower left corner of our screen, press the start button and print <b>dsa.msc</b> <br>  Open your favorite snap-in <b>Active Directory Users and Computers</b> . <br><br>  Find the Parallels RAS user group you created, right-click on it and go to properties.  In the Account tab there will be an option Logon Hours in which you need to select the allowed and prohibited hours for the group. <br><br>  The result of this section: <br><br>  1. You are great <br>  2. The lives of users saved from recycling <br><br><img src="https://habrastorage.org/webt/59/ef/12/59ef129c85d8f217983865.jpeg"><br><br><h3>  <font color="#cc0000">Part Three</font>  <font color="#cc0000">"Interactive"</font> </h3><br>  Using published resources, it is often necessary not only to prohibit everything on the server, but also to redirect local resources to a remote session.  And if there are no difficulties with printers, scanners, disks, sound and COM ports, Parallels RAS perfectly redirects them without additional settings from Windows, then redirection of USB devices and webcams is not so simple. <br><br>  To redirect this type of equipment, it is necessary for the stars to come together in the correct order not only on the server, but also on the client machine: <br><br>  On the user's computer, change the following group policy: <br><br>  <b>Computer Configuration ‚Üí Administrative Templates ‚Üí Windows Components ‚Üí Remote Desktop Services ‚Üí Remote Desktop Connection Client ‚Üí RemoteFX USB Device Redirection</b> <br>  Set it to <b>Enabled</b> <br><br>  Now in the properties of the Parallels client ( <b>Connection Properties ‚Üí Local Resources</b> ) you can choose which of the connected USB devices should be redirected to the server. <br><br>  <i>Note: USB device can be used either in a published application or on a local computer, but not at the same time there and there.</i> <br><br>  On the server side, you need to install drivers and all the necessary software to operate the USB device.  Unfortunately, humanity has not yet invented a universal driver for everything. <br><br>  This is how I would like to complete an overview of the Windows settings that will be important for the operation of Parallels RAS. <br><br><img src="https://habrastorage.org/webt/59/ef/26/59ef26953aa4b002985306.png"><br><br>  <b>ZY</b>  Such long texts have not been written for a long time, hence the huge thanks to all those who mastered this article. </div><p>Source: <a href="https://habr.com/ru/post/340820/">https://habr.com/ru/post/340820/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340806/index.html">‚ÄúThe main challenge is personnel shortage‚Äù is a panel discussion about the selection of data teams. Data Science Week 2017</a></li>
<li><a href="../340808/index.html">Fantastic processors and where they live - the juice from the new lines of HPE, Dell EMC and Lenovo</a></li>
<li><a href="../340810/index.html">Dragging music from VK without public music API</a></li>
<li><a href="../340816/index.html">The main legal errors of web studios</a></li>
<li><a href="../340818/index.html">VSHB Business Games Festival</a></li>
<li><a href="../340822/index.html">SQL Server supports regular expressions when checking constraints, triggers are not always needed</a></li>
<li><a href="../340824/index.html">Kali Linux: package modification</a></li>
<li><a href="../340826/index.html">The book "Angular for professionals"</a></li>
<li><a href="../340828/index.html">Live Rup #RuPostgres: questions and answers with Avito experts</a></li>
<li><a href="../340830/index.html">DockStation. Why we decided to make this project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>