<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>[UPD] Programming 1986E91T microcontrollers in Qt Creator</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to show how you can write code and collect hex files for domestic Milandr microcontrollers in a convenient Qt Creator environment. Usually othe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>[UPD] Programming 1986E91T microcontrollers in Qt Creator</h1><div class="post__text post__text-html js-mediator-article">  I want to show how you can write code and collect hex files for domestic Milandr microcontrollers in a convenient Qt Creator environment.  Usually other development environments are used for these tools, but with the advent of QBS, things have changed somewhat. <br><a name="habracut"></a><br>  In order for everything to work, it is enough to download the environment and the compiler.  Compiler - GCC;  Wednesday, as the title says - Qt Creator. <br><br><h4>  Downloading necessary </h4><br>  - Qt Creator can be downloaded from the <a href="http://www.qt.io/ru/download/">official Qt website</a> and installed without any problems both in Windows and Linux.  You can put anywhere; <br>  - Then download GCC for ARM.  I took links <a href="http://code.google.com/p/uos-embedded/wiki/gcc_arm_ru">from here</a> .  We unpack in a place convenient for you, preferably not far from the root of the disk; <br>  - Download CMSIS and SPL libraries from <a href="http://milandr.ru/index.php%3Fpage%3Dprogrammnoe-obespech">Milandra</a> site.  Unpack anywhere.  Or you can take the template that I posted at the end of the article here, and use the libraries from there.  But when you want to poke around further, you will have to add more library files.  Them can be found on the official website. <br><br>  Anything more, we do not need anything. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Creating a template </h4><br>  So, after you have installed and unpacked everything you need, you can start creating a project and writing code.  Written here is true for both Windows and Linux (the project build was tested on Ubuntu). <br><br>  Let's start: <br><br>  - Open Qt Creator and create a new project with the QBS build system.  Let's call it, for example, ‚ÄúHabr‚Äù. <br><br><img src="https://habrastorage.org/files/2c3/c74/e98/2c3c74e98d3b478b926c55ba987cb5e5.png"><br><br><img src="https://habrastorage.org/files/62a/8a7/313/62a8a731390c42eb9730872ae9b2b3f4.png"><br><br>  We get a simple Hello World.  Then from the main.c file we delete everything and leave an empty file.  We will return to it a little later. <br><br>  - Open the file Habr.qbs and similarly clean out everything, leaving a void.  Then we write the following code there: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> qbs Project { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"simple"</span></span> Product { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"micro"</span></span> type: <span class="hljs-string"><span class="hljs-string">"hex"</span></span> Group { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"sources"</span></span> files: [<span class="hljs-string"><span class="hljs-string">"main.c"</span></span>, <span class="hljs-string"><span class="hljs-string">"system_MDR32F9Qx.c"</span></span>, <span class="hljs-string"><span class="hljs-string">"startup_Cortex_M3.c"</span></span>] fileTags: [<span class="hljs-string"><span class="hljs-string">'c'</span></span>] } Rule { <span class="hljs-attr"><span class="hljs-attr">inputs</span></span>: [<span class="hljs-string"><span class="hljs-string">"c"</span></span>] Artifact { <span class="hljs-attr"><span class="hljs-attr">fileTags</span></span>: [<span class="hljs-string"><span class="hljs-string">'obj'</span></span>] filePath: input.fileName + <span class="hljs-string"><span class="hljs-string">'.o'</span></span> } prepare: { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> args = []; args.push(<span class="hljs-string"><span class="hljs-string">"-mcpu=cortex-m3"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-mthumb"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-g"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-ffunction-sections"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-O0"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-Wall"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-Wunused"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-DM3"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">'-c'</span></span>); args.push(input.filePath); args.push(<span class="hljs-string"><span class="hljs-string">'-o'</span></span>); args.push(output.filePath); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> compilerPath = <span class="hljs-string"><span class="hljs-string">"C:/4.9_2014q4/bin/arm-none-eabi-gcc.exe"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Command(compilerPath, args); cmd.description = <span class="hljs-string"><span class="hljs-string">'compiling '</span></span> + input.fileName; cmd.highlight = <span class="hljs-string"><span class="hljs-string">'compiler'</span></span>; cmd.silent = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmd; } } Rule{ <span class="hljs-attr"><span class="hljs-attr">multiplex</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> inputs: [<span class="hljs-string"><span class="hljs-string">'obj'</span></span>] Artifact{ <span class="hljs-attr"><span class="hljs-attr">fileTags</span></span>:[<span class="hljs-string"><span class="hljs-string">'elf'</span></span>] filePath: project.name + <span class="hljs-string"><span class="hljs-string">'.elf'</span></span> } prepare:{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> args = [] args.push(<span class="hljs-string"><span class="hljs-string">"-mcpu=cortex-m3"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-mthumb"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-g"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-nostartfiles"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-O0"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-Wl,--gc-sections"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> inputs[<span class="hljs-string"><span class="hljs-string">'obj'</span></span>]) args.push(inputs[<span class="hljs-string"><span class="hljs-string">"obj"</span></span>][i].filePath); args.push(<span class="hljs-string"><span class="hljs-string">"-TC:/Source/Qt/ARM_Test_QBS/arm-gcc-link.ld"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">'-o'</span></span>); args.push(output.filePath); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> compilerPath = <span class="hljs-string"><span class="hljs-string">"C:/4.9_2014q4/bin/arm-none-eabi-gcc.exe"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Command(compilerPath,args); cmd.description = <span class="hljs-string"><span class="hljs-string">"linking"</span></span>+project.name <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmd; } } Rule{ <span class="hljs-attr"><span class="hljs-attr">inputs</span></span>: [<span class="hljs-string"><span class="hljs-string">'elf'</span></span>] Artifact{ <span class="hljs-attr"><span class="hljs-attr">fileTags</span></span>:[<span class="hljs-string"><span class="hljs-string">'hex'</span></span>] filePath: project.name + <span class="hljs-string"><span class="hljs-string">'.hex'</span></span> } prepare:{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> args = [] args.push(<span class="hljs-string"><span class="hljs-string">"-O"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"ihex"</span></span>) args.push(input.filePath) args.push(output.filePath) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hexcreator = <span class="hljs-string"><span class="hljs-string">"C:/4.9_2014q4/bin/arm-none-eabi-objcopy.exe"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Command(hexcreator,args); cmd.description = <span class="hljs-string"><span class="hljs-string">'create_hex'</span></span>+project.name <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmd; } } } }</code> </pre> <br>  In this code, the compiler, linker and creator of the hex file with their parameters are called in turn. <br><br>  Sure to!  Add the path to your compiler, linker, and gcc-objcopy to the CompilerPath variable. <br><br>  After that we add files for cmsis and spl, as well as the linker script to the source folder.  It should look like this: <br><br><img src="https://habrastorage.org/files/60e/6da/d23/60e6dad23b064975bd084f052a9be0df.JPG"><br><br>  In the main.c file, which stands and waits while we write something there, we insert the following: <br><br><pre> <code class="hljs erlang-repl">#include <span class="hljs-string"><span class="hljs-string">"MDR32F9x.h"</span></span> //     #include <span class="hljs-string"><span class="hljs-string">"system_MDR32F9Qx.h"</span></span> //     long check = <span class="hljs-number"><span class="hljs-number">0</span></span>; void InitPortLED(void)//   { MDR_PORTD-&gt;FUNC &amp;= ~((<span class="hljs-number"><span class="hljs-number">0</span></span>x3FF &lt;&lt; (<span class="hljs-number"><span class="hljs-number">10</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>))); MDR_PORTD-&gt;ANALOG |= (<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">14</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">13</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">12</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">11</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">10</span></span>); MDR_PORTD-&gt;PWR |= (<span class="hljs-number"><span class="hljs-number">0</span></span>x155 &lt;&lt; (<span class="hljs-number"><span class="hljs-number">10</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>)); MDR_PORTD-&gt;RXTX &amp;= ~(<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">14</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">13</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">12</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">11</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">10</span></span>); MDR_PORTD-&gt;OE |= (<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">14</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">13</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">12</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">11</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">10</span></span>); } int main() { SystemInit();// ,     InitPortLED(); while(<span class="hljs-number"><span class="hljs-number">1</span></span>)//  { check++; if(check == <span class="hljs-number"><span class="hljs-number">1000</span></span>) MDR_PORTD-&gt;RXTX |= <span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">14</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">10</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">12</span></span>;//vkl diod if(check == <span class="hljs-number"><span class="hljs-number">4000</span></span>) { check = <span class="hljs-number"><span class="hljs-number">0</span></span>; MDR_PORTD-&gt;RXTX &amp;= (<span class="hljs-number"><span class="hljs-number">0</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">11</span></span>|<span class="hljs-number"><span class="hljs-number">0</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">13</span></span>); } } }</code> </pre><br>  The choice of ports is due to the work with the Milandra debug board. <br><br>  After we run the compilation and make sure that everything compiles and we become the owners of the hex file. <br><br><img src="https://habrastorage.org/files/14a/60b/e28/14a60be28fcc459281a08e7a647ec965.JPG"><br><br>  Everything is fine, now this file can be flashed to the controller and enjoy the flashing diodes. <br><br>  As I said, I post the template with the <a href="http://www.dropbox.com/sh/rriqh6jlzk8dgqd/AADPYX1f3Kt9BcP9hCjkdvFoa%3Fdl%3D0">sources</a> . <br><br>  That's all, thank you for your attention! <br><br>  UPD: I posted a template on <a href="https://github.com/Akscan/1986VE91T-for-Qt-Creator">GitHub</a> </div><p>Source: <a href="https://habr.com/ru/post/259269/">https://habr.com/ru/post/259269/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259257/index.html">Record of the webinar "What's new in Kerio Connect 8.5"</a></li>
<li><a href="../259259/index.html">The largest small polyhedra: new solutions in combinatorial geometry</a></li>
<li><a href="../259261/index.html">Metalworking - 2015, part one: electro-erosion, water-jet, presses, lasers and router</a></li>
<li><a href="../259263/index.html">Questions to meet with Opera Software in Petersburg</a></li>
<li><a href="../259265/index.html">Lua, OOP and nothing more</a></li>
<li><a href="../259271/index.html">PVS-Studio - we invite you to listen and watch</a></li>
<li><a href="../259273/index.html">Sales funnel in CRM: do not be gadgets, analyze losses</a></li>
<li><a href="../259275/index.html">Problems caused by defining tuples as functors</a></li>
<li><a href="../259277/index.html">Eight different types of programmers</a></li>
<li><a href="../259279/index.html">Looking for the perfect javascript framework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>