<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We disassemble iPhone Core Data Recipes. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 The purpose of this article is to help a novice iOS developer to understand how to work correctly with a SQLite database using Core Dat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We disassemble iPhone Core Data Recipes. Part 1</h1><div class="post__text post__text-html js-mediator-article"><h4>  <b>Introduction</b> </h4><br>  The purpose of this article is to help a novice iOS developer to understand how to work correctly with a SQLite database using Core Data using the example of iPhone Core Data Recipes.  In the first part of a series of articles, the interaction of the application and the database will be discussed, as well as work with related records (Relationships). <br><br><h4>  <b>Prerequisites</b> </h4><br>  For self-study of the source code of this application, you need a standard set of tools: <br><ul><li>  Mac os x </li><li>  Xcode </li></ul><br><br>  This set will allow you to view, change and run the application on the simulator.  In case, if you want to try to run it on a real iPhone, participation in the iOS Developer Program is required. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And also, which is quite important, you need a basic understanding of the structure of the Objective-C language and the application. <br><br>  Links to the materials and tools used are provided in the References section. <br><br><h5>  <b>What is iPhone Core Data Recipes?</b> </h5><br>  Xcode is a project from Apple developers that gives you a general idea of ‚Äã‚Äãhow to use view controllers, table views and Core Data in iPhone applications.  Of course, this project is also relevant for the iPad, but it is necessary to make interface changes to it for correct display on the iPad. <br><br><h5>  <b>iPhone Core Data Recipes Screenshots</b> </h5><br>  The screenshots below give an overview of the application interface.  In the main window "Recipes" - lists the finished products.  Clicking on one of them, the application displays information on how to prepare this product, its category, how much time it takes, what ingredients are needed and in what quantity, as well as a button that displays text cooking instructions (the screenshot is not shown).  Also in the application there is the possibility of converting values ‚Äã‚Äãbetween grams, pounds and ounces, as well as a table of correspondence of temperatures (celsius and fahrenheit). <br><a name="habracut"></a><br><img src="https://habrastorage.org/storage2/b59/37b/54f/b5937b54f4672dfa5d02c15fd4c841f9.png"><img src="https://habrastorage.org/storage2/c5e/892/e4a/c5e892e4af42d6858db93e69e833cab9.png"><br><br><h4>  <b>Database structure</b> </h4><br>  A general idea of ‚Äã‚Äãthe structure of the database can be obtained from the screenshot below: <br><img src="https://habrastorage.org/storage2/ef4/198/801/ef41988012c0797ea50c38b891f57ca6.png"><br>  More structurally, the structure can be studied by opening the Recipes.xcdatamodel file in Xcode. <br><br><h5>  <b>Description of the tables</b> </h5><br>  The Recipe table contains the following attributes: <br><ul><li>  String type instructions </li><li>  name of type String </li><li>  String type overview </li><li>  String type prepTime </li><li>  thumbnailImage type Transformable </li></ul><br>  The Ingredient table contains the following attributes: <br><ul><li>  amount of type String </li><li>  displayOrder of type Integer 16 </li><li>  name of type String </li></ul><br>  The RecipeType table contains the following attributes: <br><ul><li>  name of type String </li></ul><br>  The Image table contains the following attributes: <br><ul><li>  Transformable type image </li></ul><br>  I think with standard types everything is clear.  But what kind of Transformable?  Core Data supports a variety of standard types, such as string, date, or number.  But sometimes it is necessary to create an attribute whose value is not directly supported.  For example, store a picture or color that are instances of the NSImage and NSColor classes.  To do this, you need a type of Transformable, a detailed description of this type, you can read on the iOS Developer Library website in the Non-Standard Persistent Attributes section (see the link in the References section). <br><br><h5>  <b>Relationships between tables (Relationships)</b> </h5><br>  In the database structure, there is the main Recipe table, which has links of various types, with three others.  For example, the Recipe table has a one-to-many relationship with the Ingredient table.  The type and direction of communication can be understood by the arrows and their number.  For example, the Recipe table has a one-to-one relationship with the RecipeType table, but the RecipeType table has a one-to-many relationship with the Recipe table, i.e.  two-way communication is not of the same type.  This means that a record from the Recipe table can be associated with only one record from the RecipeType table, but a record from the RecipeType table can be associated with many records in the Recipe table.  In this particular example, to put it in simple terms, we can say that the product can only be in one category, while different products can also be in the same category, for example, in the Dessert category. <br><br>  Core Data automatically manages connections, i.e.  you only need to build them correctly in your model. <br><br>  The type of relationship is specified in the Relationship properties in the Data Model Inspector (see example below). <br><img src="https://habrastorage.org/storage2/4d1/3f1/1d2/4d13f11d271c32dd499eb161fa2a009c.png"><br>  When designing the structure of your database, it is important not to forget about the Delete Rule in the connection properties.  In this example, removing the product removes all of its ingredients. <br><br><h5>  <b>Classes</b> </h5><br>  After you have completed the database design, you need to generate Objective-C classes for your model.  In our case, we have classes for the Recipe and Ingredient tables. <br><br>  <b>Recipe.h</b> <br><pre><code class="hljs objectivec"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImageToDataTransformer</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSValueTransformer</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Recipe</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSManagedObject</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *instructions; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *name; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *overview; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *prepTime; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSSet</span></span> *ingredients; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">UIImage</span></span> *thumbnailImage; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSManagedObject</span></span> *image; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSManagedObject</span></span> *type; <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Recipe</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoreDataGeneratedAccessors</span></span></span><span class="hljs-class">) - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addIngredientsObject</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSManagedObject</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">removeIngredientsObject</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSManagedObject</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addIngredients</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSSet</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">removeIngredients</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSSet</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><br>  <b>Ingredient.h</b> <br><pre> <code class="hljs objectivec"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Recipe</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ingredient</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSManagedObject</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *name; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *amount; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) Recipe *recipe; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSNumber</span></span> *displayOrder; <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span></code> </pre> <br><h4>  <b>Source code</b> </h4><br>  We start to study the source when the interaction of the application and database. <br><br>  The <b>RecipesAppDelegate.h</b> file contains declarations of the NSManagedObjectModel, NSManagedObjectContext and NSPersistentStoreCoordinator properties required for working with the database: <br><pre> <code class="hljs objectivec"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecipeListTableViewController</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecipesAppDelegate</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIApplicationDelegate</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">NSManagedObjectModel</span></span> *managedObjectModel; <span class="hljs-built_in"><span class="hljs-built_in">NSManagedObjectContext</span></span> *managedObjectContext; <span class="hljs-built_in"><span class="hljs-built_in">NSPersistentStoreCoordinator</span></span> *persistentStoreCoordinator; } <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSManagedObjectModel</span></span> *managedObjectModel; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSManagedObjectContext</span></span> *managedObjectContext; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSPersistentStoreCoordinator</span></span> *persistentStoreCoordinator; - (<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)applicationDocumentsDirectory; <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span></code> </pre> <br><br>  The <b>RecipesAppDelegate.m</b> file controls these properties and also ensures that the data is consistent. <br><pre> <code class="hljs python"><span class="hljs-meta"><span class="hljs-meta">... </span></span>- (void)applicationDidFinishLaunching:(UIApplication *)application { recipeListController.managedObjectContext = self.managedObjectContext; ... } //   ,  ,    - (void)applicationWillTerminate:(UIApplication *)application { NSError *error; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (managedObjectContext != nil) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([managedObjectContext hasChanges] &amp;&amp; ![managedObjectContext save:&amp;error]) { NSLog(@<span class="hljs-string"><span class="hljs-string">"Unresolved error %@, %@"</span></span>, error, [error userInfo]); abort(); } } } //  NSManagedObjectContext,      - (NSManagedObjectContext *)managedObjectContext { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (managedObjectContext != nil) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> managedObjectContext; } NSPersistentStoreCoordinator *coordinator = [self persistentStoreCoordinator]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (coordinator != nil) { managedObjectContext = [NSManagedObjectContext new]; [managedObjectContext setPersistentStoreCoordinator: coordinator]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> managedObjectContext; } //  NSManagedObjectModel,      - (NSManagedObjectModel *)managedObjectModel { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (managedObjectModel != nil) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> managedObjectModel; } managedObjectModel = [[NSManagedObjectModel mergedModelFromBundles:nil] retain]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> managedObjectModel; } //   NSPersistentStoreCoordinator,     . NSPersistentStoreCoordinator       - (NSPersistentStoreCoordinator *)persistentStoreCoordinator { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (persistentStoreCoordinator != nil) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> persistentStoreCoordinator; } NSString *storePath = [[self applicationDocumentsDirectory] stringByAppendingPathComponent:@<span class="hljs-string"><span class="hljs-string">"Recipes.sqlite"</span></span>]; /*        ,  ,     .        . */ NSFileManager *fileManager = [NSFileManager defaultManager]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (![fileManager fileExistsAtPath:storePath]) { NSString *defaultStorePath = [[NSBundle mainBundle] pathForResource:@<span class="hljs-string"><span class="hljs-string">"Recipes"</span></span> ofType:@<span class="hljs-string"><span class="hljs-string">"sqlite"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (defaultStorePath) { [fileManager copyItemAtPath:defaultStorePath toPath:storePath error:NULL]; } } NSURL *storeUrl = [NSURL fileURLWithPath:storePath]; NSError *error; persistentStoreCoordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel: [self managedObjectModel]]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (![persistentStoreCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:storeUrl options:nil error:&amp;error]) { NSLog(@<span class="hljs-string"><span class="hljs-string">"Unresolved error %@, %@"</span></span>, error, [error userInfo]); abort(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> persistentStoreCoordinator; } //    Documents  - (NSString *)applicationDocumentsDirectory { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) lastObject]; } ...</code> </pre><br><br>  Now, we need to display a list of products in the main application window.  The <b>RecipeListTableViewController.m</b> file <b>(RecipeListTableViewController interface)</b> contains the necessary code <br><pre> <code class="hljs smalltalk">... //     <span class="hljs-type"><span class="hljs-type">Recipe</span></span> - (<span class="hljs-type"><span class="hljs-type">NSFetchedResultsController</span></span> *)fetchedResultsController { if (fetchedResultsController == <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>) { <span class="hljs-type"><span class="hljs-type">NSFetchRequest</span></span> *fetchRequest = [[<span class="hljs-type"><span class="hljs-type">NSFetchRequest</span></span> alloc] init]; <span class="hljs-type"><span class="hljs-type">NSEntityDescription</span></span> *entity = [<span class="hljs-type"><span class="hljs-type">NSEntityDescription</span></span> entityForName:@<span class="hljs-comment"><span class="hljs-comment">"Recipe"</span></span> inManagedObjectContext:managedObjectContext]; [fetchRequest setEntity:entity]; //     <span class="hljs-type"><span class="hljs-type">NSSortDescriptor</span></span> *sortDescriptor = [[<span class="hljs-type"><span class="hljs-type">NSSortDescriptor</span></span> alloc] initWithKey:@<span class="hljs-comment"><span class="hljs-comment">"name"</span></span> ascending:<span class="hljs-type"><span class="hljs-type">YES</span></span>]; <span class="hljs-type"><span class="hljs-type">NSArray</span></span> *sortDescriptors = [[<span class="hljs-type"><span class="hljs-type">NSArray</span></span> alloc] initWithObjects:sortDescriptor, <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>]; [fetchRequest setSortDescriptors:sortDescriptors]; <span class="hljs-type"><span class="hljs-type">NSFetchedResultsController</span></span> *aFetchedResultsController = [[<span class="hljs-type"><span class="hljs-type">NSFetchedResultsController</span></span> alloc] initWithFetchRequest:fetchRequest managedObjectContext:managedObjectContext sectionNameKeyPath:<span class="hljs-keyword"><span class="hljs-keyword">nil</span></span> cacheName:@<span class="hljs-comment"><span class="hljs-comment">"Root"</span></span>]; aFetchedResultsController.delegate = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.fetchedResultsController = aFetchedResultsController; [aFetchedResultsController release]; [fetchRequest release]; [sortDescriptor release]; [sortDescriptors release]; } return fetchedResultsController; } ... - (<span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span> *)tableView:(<span class="hljs-type"><span class="hljs-type">UITableView</span></span> *)tableView cellForRowAtIndexPath:(<span class="hljs-type"><span class="hljs-type">NSIndexPath</span></span> *)indexPath { //  <span class="hljs-type"><span class="hljs-type">RecipeTableViewCell</span></span>      . <span class="hljs-type"><span class="hljs-type">RecipeTableViewCell</span></span>      <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span> static <span class="hljs-type"><span class="hljs-type">NSString</span></span> *<span class="hljs-type"><span class="hljs-type">RecipeCellIdentifier</span></span> = @<span class="hljs-comment"><span class="hljs-comment">"RecipeCellIdentifier"</span></span>; <span class="hljs-type"><span class="hljs-type">RecipeTableViewCell</span></span> *recipeCell = (<span class="hljs-type"><span class="hljs-type">RecipeTableViewCell</span></span> *)[tableView dequeueReusableCellWithIdentifier:<span class="hljs-type"><span class="hljs-type">RecipeCellIdentifier</span></span>]; if (recipeCell == <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>) { recipeCell = [[[<span class="hljs-type"><span class="hljs-type">RecipeTableViewCell</span></span> alloc] initWithStyle:<span class="hljs-type"><span class="hljs-type">UITableViewCellStyleDefault</span></span> reuseIdentifier:<span class="hljs-type"><span class="hljs-type">RecipeCellIdentifier</span></span>] autorelease]; recipeCell.accessoryType = <span class="hljs-type"><span class="hljs-type">UITableViewCellAccessoryDisclosureIndicator</span></span>; } [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> configureCell:recipeCell atIndexPath:indexPath]; return recipeCell; } - (void)configureCell:(<span class="hljs-type"><span class="hljs-type">RecipeTableViewCell</span></span> *)cell atIndexPath:(<span class="hljs-type"><span class="hljs-type">NSIndexPath</span></span> *)indexPath { //   <span class="hljs-type"><span class="hljs-type">Recipe</span></span> *recipe = (<span class="hljs-type"><span class="hljs-type">Recipe</span></span> *)[fetchedResultsController objectAtIndexPath:indexPath]; cell.recipe = recipe; } ...</code> </pre><br>  All this code is enough to display a list of products in the main window.  Of course, we should not forget that here I did not bring all the code, but only excerpts from it.  For example, by opening the RecipeListTableViewController.m file, you can learn how the application monitors changes (didChangeSection, didChangeObject, controllerWillChangeContent, commitEditingStyle, etc.). <br><br>  We proceed to display the list of ingredients.  To do this, we have the RecipeDetailViewController interface, which, in turn, has the following properties <br><br><pre> <code class="hljs objectivec">Recipe *recipe; <span class="hljs-built_in"><span class="hljs-built_in">NSMutableArray</span></span> *ingredients; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) Recipe *recipe; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSMutableArray</span></span> *ingredients;</code> </pre><br><br>  Passing the current recipe from the RecipeListTableViewController interface to the RecipeDetailViewController interface <br><pre> <code class="hljs markdown">... //    - (void)tableView:(UITableView <span class="hljs-emphasis"><span class="hljs-emphasis">*)tableView didSelectRowAtIndexPath:(NSIndexPath *</span></span>)indexPath { Recipe <span class="hljs-emphasis"><span class="hljs-emphasis">*recipe = (Recipe *</span></span>)[fetchedResultsController objectAtIndexPath:indexPath]; [self showRecipe:recipe animated:YES]; } ... - (void)showRecipe:(Recipe <span class="hljs-emphasis"><span class="hljs-emphasis">*)recipe animated:(BOOL)animated { RecipeDetailViewController *</span></span>detailViewController = [[RecipeDetailViewController alloc] initWithStyle:UITableViewStyleGrouped]; //  detailViewController.recipe = recipe; [self.navigationController pushViewController:detailViewController animated:animated]; [detailViewController release]; } ...</code> </pre><br><br>  Recruit a recipe <br><pre> <code class="hljs pgsql">- (<span class="hljs-type"><span class="hljs-type">void</span></span>)viewWillAppear:(<span class="hljs-type"><span class="hljs-type">BOOL</span></span>)animated { [super viewWillAppear:animated]; [photoButton setImage:recipe.thumbnailImage forState:UIControlStateNormal]; self.navigationItem.title = recipe.name; nameTextField.text = recipe.name; overviewTextField.text = recipe.overview; prepTimeTextField.text = recipe.prepTime; [self updatePhotoButton]; //  NSSortDescriptor *sortDescriptor = [[NSSortDescriptor alloc] initWithKey:@"displayOrder" ascending:YES]; NSArray *sortDescriptors = [[NSArray alloc] initWithObjects:&amp;sortDescriptor count:<span class="hljs-number"><span class="hljs-number">1</span></span>]; NSMutableArray *sortedIngredients = [[NSMutableArray alloc] initWithArray:[recipe.ingredients allObjects]]; [sortedIngredients sortUsingDescriptors:sortDescriptors]; self.ingredients = sortedIngredients; [sortDescriptor <span class="hljs-keyword"><span class="hljs-keyword">release</span></span>]; [sortDescriptors <span class="hljs-keyword"><span class="hljs-keyword">release</span></span>]; [sortedIngredients <span class="hljs-keyword"><span class="hljs-keyword">release</span></span>]; [self.tableView reloadData]; }</code> </pre><br><br>  In tableView cellForRowAtIndexPath create a cell to display the recipe <br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *IngredientsCellIdentifier = <span class="hljs-string"><span class="hljs-string">@"IngredientsCell"</span></span>; cell = [tableView dequeueReusableCellWithIdentifier:IngredientsCellIdentifier]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell == <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { cell = [[[<span class="hljs-built_in"><span class="hljs-built_in">UITableViewCell</span></span> alloc] initWithStyle:<span class="hljs-built_in"><span class="hljs-built_in">UITableViewCellStyleSubtitle</span></span> reuseIdentifier:IngredientsCellIdentifier] autorelease]; cell.accessoryType = <span class="hljs-built_in"><span class="hljs-built_in">UITableViewCellAccessoryNone</span></span>; }</code> </pre><br>  All this code is enough to display a list of ingredients.  Its meaning is that from the main window, we pass a Recipe object, to the window that displays the list of ingredients.  At the same time, in order to get the list of ingredients from the database, you do not need to create a new NSEntityDescription, simply call the property recipe.ingredients and Core Data will automatically return the necessary ingredients from the database. <br><br><h4>  <b>Conclusion</b> </h4><br>  Of course, this article is not a complete description of this project.  If it will be interesting to you, dear readers, I am ready to continue a series of articles and, for example, in the following, describe how objects in the database are added, deleted and modified in this project.  Thank you all for your attention and for your patience. <br><br><h4>  <b>References</b> </h4><br><ul><li>  <a href="http://www.apple.com/macosx/">Mac os x</a> </li><li>  <a href="http://developer.apple.com/xcode/">Xcode</a> </li><li>  <a href="http://developer.apple.com/programs/ios/">iOS Developer Program</a> </li><li>  <a href="https://developer.apple.com/library/ios/">iPhone Core Data Recipes</a> </li><li>  <a href="http://developer.apple.com/library/ios/">Non-Standard Persistent Attributes</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/136319/">https://habr.com/ru/post/136319/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136314/index.html">Install, configure and use WPKG</a></li>
<li><a href="../136315/index.html">How a web programming company should work</a></li>
<li><a href="../136316/index.html">Neural network in scheme</a></li>
<li><a href="../136317/index.html">LTE: Inside Look</a></li>
<li><a href="../136318/index.html">TV / PC video band problem</a></li>
<li><a href="../136321/index.html">Biosensors, or the Sixth Sense</a></li>
<li><a href="../136322/index.html">Competition for developers of Windows Phone 7</a></li>
<li><a href="../136323/index.html">5 basic anti-patterns of system administration</a></li>
<li><a href="../136324/index.html">RAW vs DNG</a></li>
<li><a href="../136326/index.html">Talking machine from the old cell phone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>