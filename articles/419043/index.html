<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The elusive problem of frame timing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Technical director of Croteam Alain Ladavach, who participated in the development of Serious Sam and Talos Principle, tells how he managed to find the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">ğŸ”</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">ğŸ“œ</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">â¬†ï¸</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">â¬‡ï¸</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The elusive problem of frame timing</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/4s/tv/5e/4stv5eksxnrwmno6lurqqmrxgnm.png"></div><br>  <i>Technical director of Croteam Alain Ladavach, who participated in the development of Serious Sam and Talos Principle, tells how he managed to find the reason for the inhibition of graphics even on the most powerful machines.</i> <br><br>  Finally, an explanation has appeared of why some games slow down on your PC (and a ray of hope that they will stop slowing down in the near future). <br><br><h4>  Tt-brakes </h4><br>  You were looking forward to the next part of your favorite PC video game series and it finally came out.  This time you want to enjoy it in its entirety, so you spent money and time on thorough preparation.  You replaced the processor, installed a state-of-the-art video card, added more RAM â€” damn it, even bought a RAID on the SSD.  The game should be smooth with the screen saver. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Pre-order is finally unlocked and you have just completed the installation.  In a nervous anticipation, you start the game for the first time.  So far so good - it works at 60 frames per second.  Or, at least, this is what the GPU tuner frame counter reports.  But something is wrong.  You make the mouse sharp, chaotic movement.  Straight left-right, and then the game ... begins to slow down!  Damn, how is this possible?  How can she slow down at 60 frames per second? <br><br>  If this has never happened to you, it may seem ridiculous.  But if you have experienced them, you will most likely hate brakes with all your heart.  Brakes in games.  This is not the good old "lag".  Not a low frame rate.  These are just â€œbrakesâ€ occurring at high frame rates on ideal, super-fast machines.  What is it, where did they come from and how to get rid of them?  Let me tell you a story ... <br><a name="habracut"></a><br><h4>  Brakes, smoothness, speed ... are they the same thing? </h4><br>  Video games have operated at 60 fps since the days of the <a href="https://en.wikipedia.org/wiki/Pong">first arcade machines</a> in the 70s.  Usually it is expected that the game works with the same frequency that is used by the display.  This was the case before the popularization of 3D-games, in which for the first time reduced frame rates became permissible.  In the 90s, when <em>3D maps</em> (as we called them before they became â€œ <em>GPUs</em> â€) began to replace software rendering, people played games at 20 fps, and 35 fps was considered a decent value for serious network battles.  <a href="https://www.soldcentralfl.com/quakecoop/compare1.htm">I'm not joking</a> . <br><br>  Today we have super-fast cars and "of <em>course, they can work at 60 fps</em> ."  However, the number of users disappointed with the speed of games is greater than ever.  How is this possible?  The problem is not that games can not work fast enough, but that they slow down, <em>even when they can work fast</em> ! <br><br>  If you read different game forums, you will surely find similar messages: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bab/6f2/560/bab6f2560eb7ffb5bb89fd46e065e051.png" alt="image"></div><br>  You might think that this is a single problem, but look at the statistics of Google search queries: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/930/330/bf7/930330bf767e1542102ade668511c972.png" alt="image"></div><br>  <i>Over the past five years, brakes (stutter) have become (relatively) more serious problem than speed!</i> <br><br>  (Note that these are relative values. They do not mean that, in general, people ask for braking more than about frame rates. They mean that requests for frame rate remain at the same level, and the number of requests for brakes is growing especially lately.) <br><br><h4>  Ten years of searching for the cause of unexplained brakes </h4><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15d/106/bb9/15d106bb9a35611bd5bf1ab7a7382c30.png" alt="image"></div><br>  <i>The patient is more alive than dead, just slows down a little more than necessary.</i> <br><br>  I first encountered this problem around 2003.  We worked on <a href="https://store.steampowered.com/app/204340/Serious_Sam_2/">Serious Sam 2</a> , and users began to send us reports that they were testing something at an empty level, and the movements of the mouse were not smooth.  This was accompanied by a very characteristic pattern on the frame rate graph, which we called the "cardiogram". <br><br>  We thought that there was a bug somewhere in the code, but we could not find it.  It seemed that the problem appeared and disappeared randomly - after the application was restarted, the machine was restarted ... and then the player changed some speed option and it disappeared.  Then the player turned on this option again, but the problem did not return.  She looked like a ghost. <br><br>  Obviously, this problem arose not only in our country.  Watching the same problems in other games, we began to think that the drivers were to blame.  But this happened on video cards from different manufacturers.  Even on different APIs (OpenGL, DirectX 9, DirectX 11 ...) - the only common thing they had was that they appeared on different machines, in some scenes ... sometimes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4f6/4de/9a2/4f64de9a21552a65a237b75e37ccf6f0.png" alt="image"></div><br>  <i>Nessie, Bigfoot ... almost as elusive as the problem with the cardiogram.</i> <br><br>  We released a few more games, but this strange behavior still appeared and disappeared.  It irritated some users, and we recommended them to change the speed options - sometimes it helped, sometimes it did not.  Such is life, isn't it? <br><br>  But one day, on a great winter day at the beginning of 2013, my colleague Dean called me to see another example of this problem, which he at that time could reproduce relatively stably.  This time the problem arose at the level of <a href="https://store.steampowered.com/app/41070/Serious_Sam_3_BFE/">Serious Sam 3</a> .  We experimented with options in this scene, until it suddenly came to me.  I understood what was the reason!  And she was very simple - no wonder she escaped everyone for a decade. <br><br>  By changing just <em>one</em> very simple game engine option, we were able to make this problem appear and disappear in this particular scene.  But it became immediately obvious to us that much better efforts would be required for its high-quality solution.  Efforts not only from our side, but also the entire PC gaming ecosystem â€” programmers for GPU drivers, API developers, OS vendors â€” everyone. <br><br>  Let me explain. <br><br><h4>  What was the reason all this time </h4><br>  I would like to show you on the example of a scene from Serious Sam 3, which Dean and I explored five years ago.  Or even better - using the example of a test scene from Serious Sam 2, in which we first saw it.  But, unfortunately, after replacing the â€œironâ€, this elusive beast may move to another scene.  I have a scene from <a href="https://store.steampowered.com/app/257510/The_Talos_Principle/">The Talos Principle</a> , in which I recently managed to reproduce this problem, and I filmed several videos that made it possible to analyze it in more detail. <br><br>  But before we start, make sure you actually watch the video at 60 fps.  To view the examples below, switch to 1080p60, as shown in the picture: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8bf/807/def/8bf807defdd7dc1a385ae1bbc3f8c611.png" alt="image"></div><br>  <i>To watch videos at 60 fps, switch to YouTube at 1080p60.</i> <br><br>  If you do it right, and your computer and web browser are capable of showing video at 60 fps, then the video below should be played smoothly and without any brakes.  If this is not the case, then this is why we are talking about this â€” many other applications also demonstrate this behavior, not just games.  For now, I can only recommend that you try to watch the video on some other machine, or just read the text. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/uTWKhvNCzMw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>Check, check, one, two, three ... You should see this video in smooth 60 fps.</i> <br><br>  And now let's get down to business.  If you encounter brakes, then most likely it looks like this: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/IwGCPBC1rRI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<i>   Â«  60 fpsÂ».     Â«Â».</i><br>
<br>
,    Â«Â»,      60 fps.     -     ,   ,  Â«  Â».  ,      ( ,     - Â«Â»  ).   Â« Â»,   ,   -         ,       .         60 fps,   Â« Â». (  ,        ,     .)<br>
<br>
       (Â«Â»),         YouTube  <code>.</code> (),      .  ,        . , ,  â€¦<br>
<br>
<hr><br>
 , ? ? ,   ?..<br>
<br>
<blockquote>   ,      ,    , <strong> </strong>!</blockquote><br>
<h4>   ?</h4><br>
    .            <em>Â«Â»</em>,   1/20   ,      :<br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Q2KnqY4Iihk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<i>    60 fps,  Â«Â».    20 .</i><br>
<br>
   : -,       â€”     ,     . -,   -    - â€”   Â«Â»   ,    ,   .<br>
<br>
        :  â€”  â€”  â€”   Â«Â»â€¦    Â«Â» . , ?<br>
<br>
          (,          (  1/10 000 ),      :     ,  â€¦<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/524/723/568/5247235688665ace327344a2cafc8514.png" alt="image"></div><br>
<i>          .  â€” ,  â€”  <em>Â«Â»</em>.</i><br>
<br>
â€¦    ,    Â«Â»   <strong></strong>      ( ).   ,    , ,    ( ).<br>
<br>
â€¦   Â«Â»,    Â«  Â»,      ?<br>
<br>
   ,   ,              . (      ,       ,     ,         .)<br>
<br>
<h4>   </h4><br>
-,  - â€¦     ,       ,    .   NTSC,     60 ,   60 fps,   PAL/SECAM,     50 ,   50 fps.        -  Â« Â».<br>
<br>
       ,     â€”    ,   "<a href="https://en.wikipedia.org/wiki/Home_computer"> </a>",  <em>ZX Spectrum</em>, <em>C64</em>, <em>Atari ST</em>, <em>Amstrad CPC 464</em>, <em>Amiga</em>  ..  ,   ,           ,    100% ,       .<br>
<br>
      Â«Â».  ,    <em>  </em>   ,    <em>  </em>. ,   <a href="https://en.wikipedia.org/wiki/Sonic_the_Hedgehog_%25281991_video_game%2529">Sonic The Hedgehog</a>  Sega Genesis  , ,   <a href="http://tasvideos.org/GameResources/Genesis/SonicTheHedgehog.html">16   </a>.          PAL  NTSC,        50 fps  60 fps.  ,         .<br>
<br>
        â€”  ,  PC     Â«Â» â€”     ,        .    ,       .       3D-,    ,     . ,        â€”     ,  â€¦    .       ,     .<br>
<br>
    ,       . ( ,     Â«Â» - ,         .)<br>
<br>
     ,       ,              .     1/60  (16,67 ),      10 /,        1/6 .      1/60 ,       1/30  (33,33 ),       1/3  (   Â«Â»)  ,          .<br>
<br>
    ?         ,        .    ,     .   ,  <em></em> .  90- (  Â«35 fps       Â»   ),      .     <em> </em> ( ,      <em>GPU</em>)   Â«Â»  Â«Â»,         .      3D-,      .    ,     .<br>
<br>
<h4>  </h4><br>
       GPU,        "<a href="https://en.wikipedia.org/wiki/Asynchronous_system"></a>".  ,     GPU   -  ,  GPU      ,     ,  GPU  .      ,     GPU,  Â«  Â», GPU        .        -  .      â€”   -       .     ,    ,    .<br>
<br>
     ,      ,   ,  â€¦  .        .     ,     :<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b6e/030/d9e/b6e030d9ec8cad0a39faa28aa0553b07.png" alt="image"></div><br>
<i>          .  â€” ,  â€”  <em>Â«Â»</em>.</i><br>
<br>
  ,       .        16,67  (  1/60 ),           ,  ,   .    ()  ,     24,8  (  1/60 ),   ,          â€¦   ,  ,       10,7 ,      ,    - . (      .)<br>
<br>
  :   ,   <em></em>   ,         ,      ,  PC.      <em></em>,     60 fps,   <em>- </em>   ,     .  -    GPU     <em></em>  60 fps <em>     </em>.<br>
<br>
<blockquote>      â€” ,      (Â«Â»)         .</blockquote><br>
 ,  ,     â€”  <em></em>  ,      .<br>
<br>
      .     (  ,    â€”      , ?),      :<br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/If60k3CTWxU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<i>   Â«Â»,     ,    .</i><br>
<br>
            <em>Â«Â»</em>.    Â«Â» ,      !<br>
<br>
     ?  <em>Serious Engine</em>    <code>sim_fSyncRate=60</code>.    ,    Â«        ,      60 fpsÂ».       â€”  ,  <strong>    !</strong>  ,      â€”   ,   .<br>
<br>
   ?       ?<br>
<br>
<h4>   ?</h4><br>
  â€” .     .             ,     60,    <em></em>  60 â€”   PC     <strong></strong>      :   -  ,        GPU/â€¦   â€”   .<br>
<br>
,     ,   ,   â€”    -   .    ?<br>
<br>
    ,    /  ,      .<br>
<br>
<blockquote>    ,       ?   ,   â€”       !</blockquote><br>
 ,  .   ,       API.  ,        ,  ,    .        ,      ,   API     ,  :       ,   <em>  </em>   .   ,    ,      .<br>
<br>
<h4> ?</h4><br>
  ,    .       <a href="https://twitter.com/Plagman2/status/974370471394201603"></a>         API.  <a href="https://en.wikipedia.org/wiki/Vulkan_%2528API%2529">Vulkan API</a>      <code>VK_GOOGLE_display_timing</code>,  <a href="https://www.phoronix.com/scan.php%3Fpage%3Dnews_item%26amp%3Bpx%3DGDC-Vulkan-Stutter-Frames"></a>     proof of concept.        ,    Android  Linux.<br>
<br>
              API.   ?  ,          .<br>
<br>
   ,  Croteam    ,        ,           .<br>
<br>
         ,    ,    The Talos Principle    .<br>
<br>
<h3>    </h3><br>
      .   Â« Â»,         . ,    ,    ,       ,     .<br>
<br>
<h4>Â«Â»</h4><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9de/03c/edc/9de03cedc4a39825834a03b32b1b28e1.png" alt="image"></div><br>
<i>  ? ,      .  - , ?</i><br>
<br>
         <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BC%25D0%25BF%25D0%25BE%25D0%25B7%25D0%25B8%25D1%2582%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BC%25D0%25B5%25D0%25BD%25D0%25B5%25D0%25B4%25D0%25B6%25D0%25B5%25D1%2580_%25D0%25BE%25D0%25BA%25D0%25BE%25D0%25BD">Â«  Â»</a>,  <em></em>.  ,     ,     ,   , ,    Skype  ..       3D.             ,     ,       .     .<br>
<br>
        .     ,      â€”         ?<br>
<br>
<h4>      </h4><br>
   ,     GPU     ,   ,         .      ,  GPU         .   ,      ,          .   ,         .<br>
<br>
<h4>     â€¦</h4><br>
  . :)    GPU    .         ,       GPU         .           ,     .</div><p>Source: <a href="https://habr.com/ru/post/419043/">https://habr.com/ru/post/419043/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../419033/index.html">A quick note on running vue.js in the kubernetes cluster</a></li>
<li><a href="../419035/index.html">The book "Head First Agile. Flexible project management Â»</a></li>
<li><a href="../419037/index.html">PPPOS implementation on stm32f4-discovery</a></li>
<li><a href="../419039/index.html">"Sberbank" presented a virtual woman and a contactless beer tap</a></li>
<li><a href="../419041/index.html">Nine Elasticsearch rakes that I stepped on</a></li>
<li><a href="../419045/index.html">Yandex reopens the set in the Interface Development School. Examples of lectures and homework from the previous set</a></li>
<li><a href="../419047/index.html">Reddit hacked, database with passwords and email for 2005-2007 leaked</a></li>
<li><a href="../419049/index.html">GeekBrains launches free online educational marathon "Find Yourself in Digital"</a></li>
<li><a href="../419051/index.html">How "Flant" helps newcomers</a></li>
<li><a href="../419053/index.html">Testing Adaptec RAID Caching Technology</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>