<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pdmenu or how not to give a novice a mistake</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 Many system administrators probably had cases when access to the server had to be provided to an inexperienced or unverified person. Obse...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pdmenu or how not to give a novice a mistake</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="http://k.min.us/iddQ2c.png" alt="image"></div><br>  Hi, Habr! <br><br>  Many system administrators probably had cases when access to the server had to be provided to an inexperienced or unverified person.  Observing the precautions it is possible to protect themselves from problems, but what to do if a person is not familiar with the console at all? <br><br>  ‚ÄúCategorically refuse!‚Äù - you will say and you will be right.  But what to do if this person is your boss? <br><a name="habracut"></a><br><h4>  How it all began </h4><br>  Access to the control panel of the company for which I work is limited not only by password, but also by IP.  Since the boss began to actively travel, it has also been necessary to actively update the IP addresses in the access list.  So active that calls and requests on this topic are fed up both to him and to me. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since the person is absolutely not familiar with unix-systems and console management, it was necessary to find the simplest and most secure solution.  And it was found: <b>pdmenu</b> ! <br><br><h4>  To business </h4><br>  In order not to bore the reader with the specifics of the work of a particular system, in order to demonstrate the potential of pdmenu we will take some more or less common task.  Let's say that access to the FTP server ‚Äúoutside‚Äù is closed by a firewall for everyone except for the IPs that suit us. <br><br>  <u>Objective</u> : to give a completely inexperienced person the opportunity to open FTP access for new addresses. <br><br>  In our case, CentOS is installed on the server, but there should be no problems with pdmenu on other unix systems.  Search and installation takes a few minutes, so we proceed immediately to the setting. <br><br><h4>  System preparation </h4><br>  In the operating system, we create a separate user, through sudo we allow him to run only iptables and add the following to ~ / .bash_profile: <br><br> <code>#       : <br> ip=`set | /bin/grep SSH_CLIENT | /bin/cut -d\' -f2 | /bin/awk '{print $1}' | /bin/awk '/[0-9]/ {print}'` <br> date=`/bin/date +'%d.%m.%G %H:%M:%S'` <br> echo "${date} | ${ip} | ---Logged into the shell menu---" &gt;&gt; /var/log/pdmenu.log <br> # pdmenu <br> /usr/local/pdmenu/bin/pdmenu <br> exit <br> #  ,    pdmenu <br> logout</code> <br> <br>  Thus, the user needs to learn in putty (or any other SSH client) to open a connection and enter a password.  Next starts a convenient and intuitive menu. <br><br><h4>  Now pdmenu </h4><br>  The entire configuration is stored in the pdmenurc file.  I have it located here: <i>/ usr / local / pdmenu / etc / pdmenurc</i> <br><br>  We create the main menu, for this we write the following in pdmenurc: <br><br> <code>menu:main:Main menu: <br> show:--------------------------:: <br> nop <br> show:System tools::system <br> nop <br> show::: <br> exit:Exit <br> show:--------------------------:: <br></code> <br>  We get: <br><img src="http://k.min.us/icBv42.JPG" alt="image"><br><br>  Now we describe the System tools submenu.  To do this, add to pdmenurc: <br><br> <code>menu:system:System tools <br> show:-------------------------------:: <br> nop <br> exec:Open FTP access:pause:ip=`set | /bin/grep SSH_CLIENT | /bin/cut -d\' -f2 | /bin/awk '{print $1}' | /bin/awk '/[0-9]/ {print}'`; date=`/bin/date +'%d.%m.%G %H:%M:%S'`; echo "${date} | ${ip} | Open FTP access" &gt;&gt; /var/log/pdmenu.log &amp;&amp; /bin/sh /home/shellmenu/bin/openftp.sh <br> nop <br> exit:Main menu <br> show:-------------------------------:: <br></code> <br>  In the fourth line, everything that starts with " <i>ip =</i> " up to " <i>&amp;&amp;</i> " is a log entry.  If the recording was successful, then a shell script is launched, which will open access. <br><br>  It will look like this: <br><img src="http://k.min.us/iyqGc.JPG" alt="image"><br><br>  And here is the shell script <i>openftp.sh</i> which does all the dirty work: <br><br> <code>#!/bin/sh <br> printf '\n---------------------\n\033[1;32m Open FTP connection\033[0m\n---------------------\n\n' <br> printf 'Enter the IP address you wish to provide FTP access: \033[1;32m' <br> read ip <br> if [ $ip ] <br> then <br> printf '\n\033[0mOk, you are going to allow FTP connections to the following IP: \033[1;31m%s\033[0m' ${ip} <br> printf '\n\nAre you sure? [y/n] \033[1;32m' <br> read wish <br> if [ $wish -a $wish == y ] <br> then <br> /usr/bin/sudo /sbin/iptables -I INPUT -s ${ip} -p tcp -m tcp --dport 20 -j ACCEPT <br> /usr/bin/sudo /sbin/iptables -I INPUT -s ${ip} -p tcp -m tcp --dport 21 -j ACCEPT <br> /etc/init.d/iptables save <br> printf '\n\033[0m--------------------------------------------' <br> printf '\n The FTP access to \033[1;32m' <br> /bin/echo -n ${ip} <br> printf '\033[0m has been \033[1;31mgranted\033[0m'; <br> printf '\033[0m\n--------------------------------------------\n\n' <br> else <br> printf '\033[0m\nExiting...\n\n' <br> fi <br> else <br> printf '\033[0m\nExiting...\n\n' <br> fi</code> <br> <br><h4>  Result </h4><br>  Here is what we just did: <br><br><img src="http://k.min.us/icZ8dU.gif" alt="image"><br><br>  Thus, any person who is able to enter a password, use the cursor keys and the Enter button, can quite safely perform some actions on the server. <br>  Whether: restarting services, running scripts that generate content, viewing logs, editing files, etc.  etc. <br><br>  The main thing: do not forget to protect yourself with logs and necessary restrictions in sudo. <br><br>  <b>PS</b> nuances of setting up sudo, creating users, etc.  did not describe, so as not to inflate the article. <br>  There is enough documentation and descriptions on this topic on the Internet, unlike the description of <b>Pdmenu</b> . <br><br>  <b>Upd:</b> as suggested by the respected <a href="https://habrahabr.ru/users/shadowalone/" class="user_link">shadowalone</a> , <a href="http://kitenet.net/~joey/code/pdmenu/">you can</a> download and install Pdmenu <a href="http://kitenet.net/~joey/code/pdmenu/">here</a> <br>  <b>Upd2:</b> as suggested by the distinguished <a href="https://habrahabr.ru/users/lorc/" class="user_link">lorc</a> , when writing shell scripts for pdmenu (and not only), be sure to check what the user enters </div><p>Source: <a href="https://habr.com/ru/post/120824/">https://habr.com/ru/post/120824/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../120815/index.html">Non-blocking TCP server without undocumented features</a></li>
<li><a href="../120816/index.html">Droider Chart 55. Hit parade of Android applications</a></li>
<li><a href="../120818/index.html">May: RIF + CIB, Labor Day and early successes</a></li>
<li><a href="../120819/index.html">Gold rush startups</a></li>
<li><a href="../120821/index.html">cPanel and Parallels Plesk Panel from the point of view of a hoster. Part one</a></li>
<li><a href="../120825/index.html">Rambler Cashier. Movie tickets</a></li>
<li><a href="../120828/index.html">Communication near field - to the masses!</a></li>
<li><a href="../120829/index.html">iOS 5 is already jailbroken</a></li>
<li><a href="../120831/index.html">Statistics of users and companies of Russia in Europe</a></li>
<li><a href="../120832/index.html">Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification W3C Recommendation 07 June 2011!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>