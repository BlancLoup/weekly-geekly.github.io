<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How did I count the time of arrival by the Monte Carlo method</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Easy and "semi-festive" post. All involved in the holiday :) 

 One of the most exciting things in the eighties was software modeling for solving some...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How did I count the time of arrival by the Monte Carlo method</h1><div class="post__text post__text-html js-mediator-article">  <i>Easy and "semi-festive" post.</i>  <i>All involved in the holiday :)</i> <br><br>  One of the most exciting things in the eighties was software modeling for solving some complicated analytical problems and one of the most used techniques was the Monte Carlo method.  It lies in the fact that it starts modeling a large number of times to get more and more reliable results. <br><br>  Despite the fact that PHP is not a scientific language and is rarely used for research purposes, the Monte Carlo method can easily be implemented on it.  And in this article I will show how to do it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Real life challenge </h5><br>  A couple of days ago I should have a meeting at 9 am, 100 miles from my house.  At 6:30 in the morning I woke up, got dressed, and while I was having breakfast, I began to figure out the next couple of hours in my notebook.  I, as usual, wanted to arrive on time, so I started throwing a route: leaving the city, a country road, then north, east across the state, a local road to the east, driving through the city, then north again and arriving in the city.  It all looked something like this: <br><br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/3ae/f5b/d96/3aef5bd96d90c085e58cd36416c3dee1.png" alt="image"><br><br>  My wife filled the tank last night and I could safely ride along the country road.  The tires seemed fine when I looked at them, but the thought of whether or not to stop for 10 minutes to check their pressure didn‚Äôt bother me.  After all, if I stop and check them, I will be confident in their pressure, because now I was not sure about it, and tire pressure can affect my movement and speed ... <br><br>  I can leave earlier, for example, at 6.40, but then my wife will have to take her daughter to school herself, instead of going straight to work.  If I wait another 10 minutes, then I can be at the school just at the moment when they just open their doors, thereby saving my wife from inconvenience, especially since the school is on the way to leaving the city and it did not delay me much . <br><br>  I went back to what I was painting and added the following: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/56c/798/273/56c7982734f111a259eff11be8c1e686.png" alt="image"><br><br>  Drinking a second cup of coffee, I stood by the window.  The clear morning sky, the light morning breeze confirmed the good forecast on my smartphone and I thought that the trip would be quick this time.  Finishing my planning, I drew an approximate time for each stage, which I drew earlier: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/00f/055/8e5/00f0558e5dde2a816973289c5bcef9d9.png" alt="image"><br><br>  The expected trip time was 115 minutes (1 hour and 55 minutes), if I can move without unnecessary stops.  I expected to arrive at 8.35, if I go at once, or at 8.55, if I have to take my daughter with me, to send her to school and check the tires at the same time. <br><br>  But any planning ceases to be perfect after it collides with reality!  For some unknown reason, many parents decide to leave their children at school earlier than usual, so I lost more than 5 minutes compared to what I had planned for my quick trip.  Realizing that I was a little late, I decided not to check tire pressure and go right away. <br><br>  I got to the exit from the city 5 minutes earlier than I had planned in the worst case scenario and everything went well evenly until somewhere between points B and C in my plan I didn‚Äôt stumble upon a fog that had a strong effect on visibility on road.  Has the mist lowered my average speed?  and it also made it difficult to overtake slow but long trucks.  I overcame the city traffic much easier than usual and it did not take more than 10 minutes.  After a few miles on the southern road, the fog dropped and I could safely ride at the permitted speed.  But when I was approaching my goal, I realized that road works were ahead and this again would take away my scheduled time.  In general, I spent another 10 extra minutes on my journey and in the end I was late. <br><br><h5>  Simulate the journey </h5><br>  I understand that most of the work with PHP is directed to all sorts of online shopping and other websites.  But PHP can be a great tool for scientific research, because it‚Äôs easy to train non-professional programmers, such as <i>engineers</i> and scientists, unlike my favorite Python. <br><br>  Let's write a small code that will help me understand how sooner or later I can arrive at the meeting if a couple of stages of my journey depart a little from the intended path.  To begin with, you can describe our way as it is: <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTrip</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $departureTime; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $meetingTime; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $travelTimes; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setDepartureTime(<span class="hljs-string"><span class="hljs-string">'0640'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setMeetingTime(<span class="hljs-string"><span class="hljs-string">'0900'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//       $this-&gt;setTravelTimes(array( 'AB' =&gt; 17, 'BC' =&gt; 17, 'CD' =&gt; 36, 'DE' =&gt; 9, 'EF' =&gt; 15, 'FG' =&gt; 15, 'GH' =&gt; 6 )); } //       protected static function convertToMinutes($timeStr) { return substr($timeStr, 0, 2) * 60 + substr($timeStr, 2, 2); } public function setDepartureTime($timeStr) { $this-&gt;departureTime = self::convertToMinutes($timeStr); } public function setMeetingTime($timeStr) { $this-&gt;meetingTime = self::convertToMinutes($timeStr); } public function setTravelTimes(array $travelTimes) { $this-&gt;travelTimes = $travelTimes; } public checkPlan($stopAtSchool = true, $checkTires = true) { // ... } }</span></span></code> </pre> <br><br>  The plan must be a feasible and suitable criterion for determining this to be such that the sum of all the times plus the early departure time must be less than or equal to the time that my meeting is scheduled for.  Actually this is what determines the checkPlan () method: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> checkPlan($stopAtSchool = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, $checkTires = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//       $travelTime = array_sum($this-&gt;travelTimes); //  ,        $schoolDelay = ($stopAtSchool) ? 10 : 0; //       $tiresDelay = ($checkTires) ? 10 : 0; //     $meetingArriveTime = $this-&gt;departureTime + $travelTime + $schoolDelay + $tiresDelay; //    ? $arriveOnTime = $meetingArriveTime &lt;= $this-&gt;meetingTime; return array($meetingArriveTime, $this-&gt;meetingTime, $arriveOnTime); }</span></span></code> </pre><br><br>  Everything, we need only to make an instance of this class and check: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $trip = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyTrip(); print_r($trip-&gt;checkPlan());</code> </pre><br><br>  Taking into account the default settings, the output will be as follows: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">535</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">540</span></span> [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> )</code> </pre><br><br>  I have to arrive at 535 minutes, and the meeting is scheduled for 540 minutes.  If translated into hours, I will arrive at 8.45, 15 minutes ahead of schedule. <br><br>  But what about the possible delays?  How to foresee and calculate them? <br><br><h5>  Monte Carlo method or add randomness </h5><br>  In the simplest form, we can define a certain safe gap for each event and say that it can happen 10% earlier and 25% later than the specified time.  These gaps can be randomly added to the initial delays (daughter, pressure) and the time between stages of multiplying each factor by rand (90,125) / 100. <br>  You can also assign a 50% chance to two solutions ‚Äî take your daughter to school and check tires.  Here rand () will help again: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;checkTires = rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">50</span></span>;</code> </pre><br><br>  By combining all this together, you can define the checkPlanRisk () method to calculate the decision whether I will arrive on time or not, taking into account the different situation on the way: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkPlanRisk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    $travelTime = 0; foreach ($this-&gt;travelTimes as $t) { $travelTime += $t * rand(90, 125) / 100; } //      $schoolDelay = 0; if (rand(1, 100) &gt; 50) { $schoolDelay = 10 * rand(90, 125) / 100; } //    $tiresDelay = 0; if (rand(1, 100) &gt; 50) { $tiresDelay = 10 * rand(90, 125) / 100; } //    $meetingArriveTime = $this-&gt;departureTime + $travelTime + $schoolDelay + $tiresDelay; //    ? $arriveOnTime = $meetingArriveTime &lt;= $this-&gt;meetingTime; return array($schoolDelay, $tiresDelay, $meetingArriveTime, $this-&gt;meetingTime, $arriveOnTime); }</span></span></code> </pre><br><br>  Now the question is, will I arrive on time, taking into account all possible delays?  The Monte Carlo method allows to solve this issue by running a large number of times of a given task and calculating the ‚Äúconfidence level‚Äù as the ratio of the arrival time in time to the total number of task launches. <br><br>  If you run this a sufficient number of times and write down how often I arrive on time, then I will be able to determine some probability that I will arrive as planned. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runCheckPlanRisk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($numTrials)</span></span></span><span class="hljs-function"> </span></span>{ $arriveOnTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">1</span></span>; $i &lt;= $numTrials; $i++) { $result = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;checkPlanRisk(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($result[<span class="hljs-number"><span class="hljs-number">4</span></span>]) { $arriveOnTime++; } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">": "</span></span> . $i; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">" : "</span></span> . $result[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">" : "</span></span> . $result[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"  : "</span></span> . $result[<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($result[<span class="hljs-number"><span class="hljs-number">4</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">" -- "</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">" -- "</span></span>; } $confidence = $arriveOnTime / $i; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">" : $confidencen"</span></span>; } }</code> </pre><br><br>  Create a new instance and do 1000 calculations one after the other: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $trip = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyTrip(); $trip-&gt;runCheckPlanRisk(<span class="hljs-number"><span class="hljs-number">1000</span></span>);</code> </pre><br><br>  After completion we will receive the forecast: <br><br><pre> <code class="php hljs">: <span class="hljs-number"><span class="hljs-number">1000</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> : <span class="hljs-number"><span class="hljs-number">11.3</span></span>  : <span class="hljs-number"><span class="hljs-number">530.44</span></span> --   : <span class="hljs-number"><span class="hljs-number">0.716</span></span></code> </pre><br><br>  With the current parameters, as you can see, I have a 72% chance to arrive at the meeting on time.  Of course, this is just an average value, but it also has the right to life. <br><br>  From myself: the article most likely carries absolutely nothing new, the title is a bit yellowish, but this article seemed funny to me.  Read a long time, and remembered with the appearance of the <a href="http://habrahabr.ru/post/192272/">article</a> on the Habr√© about Monte Carlo.  Maybe someone will come in handy. </div><p>Source: <a href="https://habr.com/ru/post/192448/">https://habr.com/ru/post/192448/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192436/index.html">Android 4.4 got the name Kit Kat (+1 billion activated devices)</a></li>
<li><a href="../192440/index.html">GitHub adds two-factor authentication</a></li>
<li><a href="../192442/index.html">Survey: Do you have a 3D printer and would you like to print for others?</a></li>
<li><a href="../192444/index.html">Happy end of my story with a script for comfortable reading Habr</a></li>
<li><a href="../192446/index.html">Its Certificate Authority - in 5 OpenSSL teams</a></li>
<li><a href="../192450/index.html">Runetology (207): Timofey Gorshkov, co-founder of inSales</a></li>
<li><a href="../192454/index.html">Having bought Nokia for 7.17 billion dollars, Microsoft leads the Trojan horse home</a></li>
<li><a href="../192456/index.html">RosSpam.org or how to complain about SMS spam in a couple of clicks</a></li>
<li><a href="../192458/index.html">[Poll] Saving vision from the computer</a></li>
<li><a href="../192460/index.html">We work with mail through Emacs and Wanderlust: several accounts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>