<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development of interactive systems on OpenFrameworks: Interactive Sound</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We recently talked about setting up and visualizing music using openFrameworks. Unfortunately, the Russian-language information on the OpenFrameworks ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development of interactive systems on OpenFrameworks: Interactive Sound</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  We <a href="http://habrahabr.ru/post/244265/">recently talked</a> about setting up and visualizing music using openFrameworks.  Unfortunately, the Russian-language information on the OpenFrameworks framework is rather small.  To fill this vacuum - we begin a series of publications of lectures that were given in Yekaterinburg at the Institute of Mathematics and Mechanics.  N.N. Krasovsky (UB RAS) Denis Perevalov. <br><br>  In this lecture, the theoretical fundamentals of digital sound will be explained, and an example of creating an interactive application for generating sound based on camera image capture will be shown. </blockquote><br>  <b>What is digital sound, and sound in general?</b> <br><br><img src="https://habrastorage.org/files/bbf/08b/720/bbf08b720c2c43229255baaf48ba3fba.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Sound, <i>in a broad sense</i> - elastic waves, longitudinally propagating in the medium and creating mechanical vibrations in it; <br>  <i>in the narrow sense</i> - the subjective perception of these fluctuations by special organs of sense of animals or humans.  Like any wave, the sound is characterized by amplitude and frequency. <br><br><a name="habracut"></a><br><h5>  <b>Presentation of sound in digital form</b> </h5><br>  The real sound is captured by the microphone, then subjected to analog-to-digital conversion. <br><br>  It is characterized <br>  time resolution - <b>sampling rate</b> , <i>[procedure - discretization]</i> <br>  resolution in amplitude - <b>bit</b> .  <i>[procedure - quantization]</i> <br><br><img src="https://habrastorage.org/files/a3e/580/be4/a3e580be488340e5bae6cf6155e8acd9.png"><br><br>  <b>Sampling frequency</b> <br>  8 000 Hz - phone, enough for speech. <br>  11,025 Hz - games, samples for electronic music. <br>  <b>22,050</b> Hz - the same as 11,025 Hz. <br>  <b>44 100</b> Hz - many synthesizers and libraries of samples.  Audio CD. <br>  48 000 Hz - recording studios, live instruments, vocals.  DVD. <br>  96,000 Hz - DVD-Audio (MLP 5.1). <br>  192,000 Hz - DVD-Audio (MLP 2.0). <br><br>  <b>Digit</b> <br>  The bit width is the number of bits used to represent the signal samples in quantization (in our case, in the amplitude quantization). <br><br>  8 bit electronic music samples. <br>  12 bit studio sound effects. <br>  <b>16</b> bit computer games, players, samples, Audio CD.18 bit studio sound effects <br>  24 bit live sounds, vocals, DVD-Audio <br>  <b>32</b> bits is a floating point representation, so accuracy is not lost for quiet sounds, so it is used for internal sound processing. <br>  64 bit also floating point, sound processing. <br><br>  <b>Representation of sound in memory</b> <br>  <b>Example</b> <br>  1 second of 16-bit audio with a sampling rate of 44100 Hz can be represented as a vector <br>  X = (x _1, x _2, ..., ..., x _44100), <br>  where 0 &lt;= x _i &lt;= 2 ^ 16-1 = 65535. <br>  The representation of sounds in such a way - using a vector - is called <b>PCM</b> (Pulse Code Modulation). <br>  It is the most common and similar to the pixel representation of images. <br><br>  <b>The fundamental difference between sound and images</b> <br>  It is very convenient to work with images at the level of pixels.  In particular: <br>  1. we consider two images identical if their pixel values ‚Äã‚Äãare close. <br>  2. You can change the image based on the assignment of neighboring pixels (for example, the smoothing operation). <br><br>  For audio in PCM format, both possibilities are <b>not applicable</b> , we will show it with an example: <br><br><img src="https://habrastorage.org/files/4ba/a96/cb2/4baa96cb25f74051b3e3bc9a5009ba0e.jpg"><br><br>  The last two sounds sound the same.  And their amplitude functions are significantly different.  Thus, the human ear perceives the spectrum of sound, that is, the composition of its frequencies, and not the amplitude representation of sound. <br><br>  <b>What is easy / hard to do ‚Äústraight‚Äù with PCM sound</b> <br><br>  <i><b>Easy</b></i> : <br>  Changing and rearranging individual samples, excluding neighbors <br>  - rearrange the pieces, <br>  - change the volume of the pieces, <br>  - do reverse - flip the sound from the end to the beginning, <br>  - mix several sounds, <br>  - mix and change stereo channels, <br>  - do the simplest compression, <br>  - add the simplest echo. <br><br>  <i>Samplers, portas and studio programs do it masterly.</i> <br><br>  <i><b>Hard</b></i> : <br>  Counting neighboring counts <br>  - compare two sounds for similarity, <br>  - suppress low or high frequencies, <br>  - add reverb. <br><br>  <i>This is usually done not directly in PCM, but through the spectral representation of the sound (window Fourier transform).</i> <br><br>  <b>Audio storage formats</b> <br>  <b>Wav</b> <br>  wav = Header + PCM bytes Keeps sound without loss of quality <br>  <i>(analog in images - bmp)</i> <br><br>  <b>MP3</b> <br>  Data lossy, good for storing music. <br>  <i>(analog in images - jpg)</i> <br><br>  <b>AMR</b> <br>  Data lossy, is designed to store speech. Used in mobile telephony (2011). <br>  <i>(analog in images - png)</i> <br><br><h5>  <b>Ways to generate digital sound</b> </h5><br>  There are the following ways to build a PCM representation of some sound or music: <br><br>  1. Sampling <br>  Used to produce all the music.  Devices - samplers <br><br>  2. (Subtractive) Synthesis <br>  Used primarily for modern electronic music.  Devices - synthesizers. <br><br>  3. FM synthesis <br>  4. Additive synthesis <br>  5. Granular synthesis <br>  6. S &amp; S - Sample &amp; Synthesis - sampling, analysis, subsequent synthesis - today one of the best technologies for playing "live" instruments. <br><br>  Consider three ways to generate sound: sampling, subtractive, and additive synthesis. <br><br>  <b>Sampling</b> <br>  Record: "Live sound" - microphone - ADC - PCM-format. <br><br>  Reproduction: PCM-format - DAC - speaker. <br><br>  <i>Additional features: you can change the playback speed, then the tone and speed of the sample will increase.</i> <i><br></i>  <i>Modern algorithms also allow you to change the tone of the sample without changing its speed, and vice versa.</i> <br><br>  Akai MPC1000 Sampler: <br><img src="https://habrastorage.org/files/1e4/e1d/398/1e4e1d398dc745cdbb281f73b67411a5.jpg"><br><br>  <b>Subtractive Synthesis</b> <br>  In pre-computer time: <br>  several simple waves (rectangular, sinusoidal, triangular) were processed by a set of filters (LF, HF, cutting the desired frequency).  The resulting sound went to the speakers. <br><br>  Now: <br>  done digitally. <br>  There are difficulties - you need to carefully take into account the known problems associated with the digital representation of sound ("aliasing"). <br><br>  Minimoog Synthesizer: <br><img src="https://habrastorage.org/files/f73/ff4/e0d/f73ff4e0d2cb4bb0be0ea57e6181daeb.jpg"><br><br>  <b>Additive synthesis</b> <br>  Additive synthesis is based on the construction of sound by summing up the set of harmonics (ie, sinusoids of different frequencies) with varying loudness. <br><br>  <i>Any sound can be represented with arbitrary accuracy as the sum of a large number of harmonics with varying volume.</i>  <i>But in practice, working with a large number of harmonics requires large computational resources.</i>  <i>Although, at present there are several hardware and software additive synthesizers.</i> <br><br><h4>  <b>OpenFrameworks project examples</b> </h4><br>  About the installation, configuration of the framework, and the IDE for building projects, you can <a href="http://habrahabr.ru/post/244265/">read here</a> . <br><br><h5>  <b>Playing samples in openFrameworks - the project ‚Äúsound landscape‚Äù</b> </h5><br>  The essence of the project: the user pokes the mouse in different parts of the screen and starts to hear <a href="http://www.freesound.org/samplesViewSingle.php%3Fid%3D221">some sound</a> <br><br><img src="https://habrastorage.org/files/40c/349/b38/40c349b386c941308f656391f20eb2a3.jpg"><br><br><pre><code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/  ofSoundPlayer sample; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  ofPoint p; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   -    float rad; void testApp::setup(){ sample.loadSound("sound.wav"); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    bin/data</span></span> sample.setVolume(<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span>f); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>, [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>] sample.setMultiPlay(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    ofSetFrameRate( <span class="hljs-number"><span class="hljs-number">60</span></span> ); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   ofSetBackgroundAuto( <span class="hljs-literal"><span class="hljs-literal">false</span></span> ); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   ofBackground(<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>); } void testApp::update(){ ofSoundUpdate(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    } void testApp::draw(){ <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  ,    ofEnableAlphaBlending(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sample.getIsPlaying()) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  ofSetColor(ofRandom(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>), ofRandom(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>), ofRandom(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>), <span class="hljs-number"><span class="hljs-number">20</span></span>); ofCircle( px, py, rad ); } ofDisableAlphaBlending(); } /<span class="hljs-regexp"><span class="hljs-regexp">/  void testApp::mousePressed(int x, int y, int button){ float h = ofGetHeight(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    , /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  1.0 -     float speed = (h - y) /</span></span> h * <span class="hljs-number"><span class="hljs-number">3.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( speed &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { sample.play(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   sample.setSpeed( speed ); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   /<span class="hljs-regexp"><span class="hljs-regexp">/       p = ofPoint( x, y ); rad = (3 - speed); rad = 20 * rad * rad; } }</span></span></code> </pre> <br><br><h5>  <b>Scenario of the project "Additive synthesizer"</b> </h5><br>  The essence of the project: the user on a white background waving his hands in front of the camera.  There are <b>n</b> harmonics.  The screen is divided by <b>n</b> <br>  vertical bars, each is the number of pixels whose brightness is less than a certain threshold.  This number determines the volume of the corresponding harmonics. <br><br>  We use <b>n = 20</b> sinusoidal harmonics, with frequencies <br>  100 Hz <br>  200 Hz <br>  ... <br>  2000 Hz <br><br>  Harmonics are played with looped samples that simply change the volume. <br><br>  Project Source Code: <br><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/  /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/-  ""  ofVideoGrabber grabber; int w; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  int h; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  const int n = 20; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  ofSoundPlayer sample[ n ]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  float volume[ n ]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  int N[ n ]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ ,     ofSoundPlayer sampleLoop; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ void testApp::setup(){ w = 320; h = 240; grabber.initGrabber(w, h); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   for (int i=0; i&lt;n; i++) { int freq = (i+1) * 100; sample[ i ].loadSound( ofToString(freq) + ".wav"); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  100.wav,... sample[ i ].setVolume(0.0); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ sample[ i ].setLoop(true); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  sample[ i ].play(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  } } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  void testApp::update(){ grabber.grabFrame(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  if (grabber.isFrameNew()){ /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    for (int i=0; i&lt;n; i++) { volume[i] = 0; N[i] = 0; } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ un signed char * input = grabber.getPixels(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   for (int y=0; y&lt;h; y++) {for (int x=0; x&lt;w; x++) { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  (x, y): int r = input[ 3 * (x + w * y) + 0 ]; int g = input[ 3 * (x + w * y) + 1 ]; int b = input[ 3 * (x + w * y) + 2 ]; int result = (r + g + b &gt; 400 ) ? 0 : 1; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  int i = (x * n /</span></span> w);<span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     volume[ i ] += result; N[ i ]++; } } /<span class="hljs-regexp"><span class="hljs-regexp">/    for (int i=0; i&lt;n; i++) { if ( N[ i ] &gt; 0 ) { volume[ i ] /</span></span>= N[ i ]; } /<span class="hljs-regexp"><span class="hljs-regexp">/   [0, 1] sample[ i ].setVolume( volume[ i ] /</span></span> n ); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>. /<span class="hljs-regexp"><span class="hljs-regexp">/  n,      } } ofSoundUpdate();/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ void testApp::draw() { ofBackground(255,255,255); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   float w = ofGetWidth(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    float h = ofGetHeight(); ofSetColor( 255, 255, 255 ); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     grabber.draw(0, 0, w, h); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  ofEnableAlphaBlending(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  ofSetColor( 0, 0, 255, 80 ); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    80 for (int i=0; i&lt;n; i++) { float harmH = volume[i] * h;/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   i ofRect( i * w /</span></span> n, h - harmH, w / n, harmH ); } ofDisableAlphaBlending(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  }</code> </pre><br><br>  Here's what happened: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/y70Oxk1RAOM%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhjNLc64h_OT-8bsIaB4sESrDdD3MA" frameborder="0" allowfullscreen=""></iframe><br><br>  If you are interested in the subject of interactive systems, and openFrameworks in particular, then we invite you to the <a href="https://groups.google.com/forum/">Russian group on openFrameworks</a> . </div><p>Source: <a href="https://habr.com/ru/post/245481/">https://habr.com/ru/post/245481/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245469/index.html">Rovio fires employees, tanks are out for Android, women with children shop more often - and other news of the week for a mobile developer</a></li>
<li><a href="../245471/index.html">How the Cowboy web server and the Kato messenger help each other: A little about Erlang and open source</a></li>
<li><a href="../245473/index.html">About creating platformer on Unity. Part 4.1, the villainous</a></li>
<li><a href="../245475/index.html">ASUS ESC4000 G2S - the most efficient supercomputer in the world</a></li>
<li><a href="../245477/index.html">Keeping independent time on android device</a></li>
<li><a href="../245485/index.html">Microsoft and Adobe released a set of updates, December 2014</a></li>
<li><a href="../245487/index.html">Simple event system - non-standard approach</a></li>
<li><a href="../245489/index.html">Occlusion Culling and LOD for Unity Indie</a></li>
<li><a href="../245491/index.html">Python Memory and Numbers</a></li>
<li><a href="../245493/index.html">SED: There are contraindications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>