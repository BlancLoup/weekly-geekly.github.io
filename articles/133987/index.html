<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Choosing a distributed file system for Linux. A few words about Ceph and the rest</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are several dozen file systems, all of which provide user interfaces for storing data. Each system is good in its own way. However, in our age o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Choosing a distributed file system for Linux. A few words about Ceph and the rest</h1><div class="post__text post__text-html js-mediator-article">  There are several dozen file systems, all of which provide user interfaces for storing data.  Each system is good in its own way.  However, in our age of high loads and petabytes of data for processing, it turned out to be quite difficult to find what you need, you just have to think about distributed data, distributed loads, multiple mount rw and other cluster charms. <br><a name="habracut"></a><br><br>  <b>Task: organize distributed file storage</b> <br>  - without self-assembled cores, modules, patches, <br>  - with the possibility of multiple mount mode rw, <br>  - POSIX compatibility, <br>  - fault tolerance, <br>  - compatibility with already used technologies, <br>  - reasonable overhead of I / O operations compared to local file systems, <br>  - easy configuration, maintenance and administration. <br><br>  We use <a href="http://proxmox.org/">Proxmox</a> and <a href="http://wiki.openvz.org/Main_Page">OpenVZ</a> container virtualization in our work.  It is convenient, it flies, this solution has more advantages than similar products.  At least for our projects and in our realities. <br>  Storage itself is mounted everywhere on FC. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  OCFS2 </h5><br>  We had a successful experience using this file system, we decided to try it first.  Proxmox has recently switched to the Redchat core, with support for ocfs2 turned off.  There is a module in the kernel, but on the openvz and proxmox forums, it is <a href="http://forum.proxmox.com/threads/7247-New-2.6.32-Kernel-%2528pvetest%2529%3Fp%3D41283">not recommended</a> to use it.  We tried and rebuilt the kernel.  Module version 1.5.0, a cluster of 4 iron machines based on debian squeeze, proxmox 2.0beta3, kernel 2.6.32-6-pve.  For tests used stress.  The problems over the years remained the same.  Everything started, setting up this bundle takes half an hour from the force.  However, under load, the cluster may spontaneously collapse, which leads to a total kernel panic on all servers at once.  During the day of the test machine rebooted a total of five times.  It is treated, but to bring such a system to working condition is quite difficult.  I also had to rebuild the kernel and turn on ocfs2.  Minus. <br><br><h5>  Gfs2 </h5><br>  Although the core is Redhat, the module is turned on by default, we could not start here either.  It's all about proxmox, which from the second version came up with <a href="http://pve.proxmox.com/wiki/Proxmox_VE_2.0_Cluster">its cluster</a> with chess and poetess to store their configs.  There cman, corosync and other packages from gfs2-tools, only all rebuilt specifically for pve.  The snap-in for gfs2, therefore, isn‚Äôt just put out of packages, as it offers to demolish the entire proxmox first, which we could not do.  For three hours, the dependencies managed to be defeated, but the kernel panic ended again.  An attempt to adapt proxmox packages for solving our problems was not successful, after two hours it was decided to abandon this idea. <br><br><h5>  CEPH </h5><br>  We stopped while on it. <br><br>  POSIX compatible, high speed, excellent scalability, several bold and interesting approaches to implementation. <br><br>  The file system consists of the following components: <br><img src="https://habrastorage.org/getpro/habr/post_images/e59/d41/079/e59d41079e4902be1477b5eb41e81c1a.gif" alt="image"><br><br>  1. Customers.  Data users. <br>  2. Server metadata.  Cache and synchronize distributed metadata.  With the help of metadata, the client at any time knows where the data he needs is located.  Also, metadata servers perform the distribution of new data. <br>  3. Cluster storage of objects.  Here both data and metadata are stored as objects. <br>  4. Cluster monitors.  Monitor the health of the entire system as a whole. <br><br>  Actual file I / O occurs between the client and the object storage cluster.  Thus, the high-level POSIX functions (opening, closing, and renaming) are managed using metadata servers, and the usual POSIX functions (read and write) are managed directly through the object storage cluster. <br><br>  Any components may be several, depending on the tasks of the administrator. <br><br>  The file system can be connected either directly using the kernel module or via FUSE.  From the user's point of view, the Ceph file system is transparent.  They simply have access to a huge data storage system and are not aware of the metadata servers used for this, the monitors, and the individual devices that make up the massive storage pool.  Users simply see a mount point at which standard file I / O operations can be performed.  From the point of view of the administrator, it is possible to expand the cluster transparently by adding as many components as necessary, monitors, storages, and metadata servers. <br><br>  The developers proudly call the Ceph ecosystem. <br><img src="https://habrastorage.org/getpro/habr/post_images/23d/248/3fe/23d2483fe88c17aed3e8a842e24be163.gif" alt="image"><br><br>  We did not consider GPFS, Luster and other file systems, as well as add-ins, this time, they are either very difficult to set up, or they do not develop, or are not suitable for the task. <br><br><h5>  Configuration and Testing </h5><br>  The configuration is standard, everything is taken from the Ceph wiki.  In general, the file system has left a pleasant impression.  An array of 2TB is assembled, in half from SAS and SATA disks (block device export by FC), partitions to ext3. <br>  Ceph storage is mounted inside 12 virtual machines at 4 hardware nodes, read-write from all mount points is performed.  The fourth day of stress tests are normal, I / O is issued on average 75 mb / s.  on record by peak. <br><br>  We have not yet considered the remaining functions of Ceph (and there are still quite a lot of them), there are also problems with FUSE.  But although the developers warn that the system is experimental, that it should not be used in production, we believe that if you really want, you can -_- <br><br>  I ask all those interested, as well as all sympathizers, in a personal.  The topic is very interesting, we are looking for like-minded people to discuss the problems that have arisen and find ways to solve them. <br><br>  References: <br>  - <a href="http://ru.wikipedia.org/wiki/Ceph">http://en.wikipedia.org/wiki/Ceph</a> <br>  - <a href="http://ceph.newdream.net/">project site</a> <br>  - a <a href="http://www.ibm.com/developerworks/linux/library/l-ceph/index.html">brief overview</a> used when writing this article </div><p>Source: <a href="https://habr.com/ru/post/133987/">https://habr.com/ru/post/133987/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133980/index.html">JSF GUI Development Experience</a></li>
<li><a href="../133981/index.html">Memory model in the examples and not only</a></li>
<li><a href="../133982/index.html">Habrahabr - winner ROTOR 2011</a></li>
<li><a href="../133983/index.html">Impressive Solids: making a game in C # under OpenGL, part I</a></li>
<li><a href="../133984/index.html">Setting up a proxy on the firmware Tomato</a></li>
<li><a href="../133988/index.html">Gingerbread holds 50.51% of the market for Android smartphones</a></li>
<li><a href="../133989/index.html">System of settings and change of versions of programs: evolution of viable forms</a></li>
<li><a href="../133990/index.html">OpenOffice COM Automation: Reading Clipboard Content</a></li>
<li><a href="../133991/index.html">US court rejected Apple‚Äôs claim against Samsung</a></li>
<li><a href="../133992/index.html">Droider Show # 18. "Apple" is not passed!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>