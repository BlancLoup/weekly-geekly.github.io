<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Virtual Reality on Windows Phone using Unity3d</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Virtual Reality on Windows Phone using Unity3d 

 At the last Game Developer Conference there was a lot of news related to virtual reality. This and n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Virtual Reality on Windows Phone using Unity3d</h1><div class="post__text post__text-html js-mediator-article"><h4>  Virtual Reality on Windows Phone using Unity3d </h4><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c07/021/357/c07021357757a12be24f1c2820371f94.png" align="left">  At the last Game Developer Conference there was a lot of news related to virtual reality.  This and new devices, such as Microsoft HoloLens, the struggle for recognition between the Oculus Rift and Project Morfeus, the announcement of SteamVR.  All this suggests that the topic is very interesting and hot.  Although the concept of virtual reality includes a lot of things, technologically it is primarily glasses or a helmet that show a stereoscopic image and react to movement.  Many of us would like to experiment in this area, but without a device, for example, the Oculus Rift is difficult.  Fortunately, there are technologies that can turn your Windows Phone into a virtual reality helmet. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Where to begin </h3><br>  The most important thing is of course the helmet, or, if you like, glasses.  They must be made so that they allow you to hold the phone before your eyes.  You can use <a href="http://habrahabr.ru/post/227641/">Google Cardboard</a> or make them yourself from <a href="http://habrahabr.ru/company/mailru/blog/232489/">cardboard, acrylic and plastic</a> . <br>  After you make glasses, or a helmet, in general, what will keep your phone in front of your eyes, the question arises as to what needs to be done to plunge into that very virtual reality: <br><ol><li>  Create stereoscopic image </li><li>  Change it depending on the position of the head </li><li>  Interact with the virtual world </li></ol>  Unity3d 4.6 and Windows Phone will be used to create our application.  In the <a href="http://1drv.ms/1bg8PzR">finished example</a> , all the settings have already been made and I would like to highlight the most important points in the article. <br><h4>  We create the Unity3d project </h4><br>  Create an empty Unity3d project and <a href="http://docs.unity3d.com/ru/current/Manual/BuildingScenes.html">create</a> some 3D objects to taste, add lighting.  On the other hand, you can use the <a href="https://www.assetstore.unity3d.com/en/">ready-made</a> free Medieval Home package, import it and open the scene example (Scene / Sample Scene). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f5e/443/8e9/f5e4438e9becdbf6134265b78d07d117.png"><br>  Next, configure the export project.  To do this, go to the <b>Edit</b> / <b>Project</b> <b>Settings</b> / <b>Player</b> menu and select the Windows Store icon. <br><img src="https://habrastorage.org/getpro/habr/post_images/322/efe/147/322efe147800421c67ce4f772da8e240.png"><br><br>  The most important point is the ‚ÄúTestCertificate‚Äù button.  Click on the Create button and create a new one.  Unfortunately, there is a small bug in Unity, due to the fact that the Create dialog does not work in some cases.  To work around this problem, launch Visual Studio 2013, create a new Windows Phone 8.1 project, open the folder where this project is located and locate the * .PFX file.  Rename it to WSATestCertificate.pfx and copy the current Unity project into the Assets folder. <br>  Next, configure the build.  Go to the <b>File</b> / <b>Build</b> <b>Settings</b> menu and select the following values ‚Äã‚Äãfor the Windows Store: <br><img src="https://habrastorage.org/getpro/habr/post_images/df3/fc2/7bd/df3fc27bd710de056ad65af7995b2f9f.png"><br><br>  Do not forget to save the current scene in advance ( <b>File</b> / <b>Save</b> <b>Scene</b> ) and click the ‚Äú <b>Add</b> <b>Current</b> ‚Äù button in this dialog box so that the starting scene appears in the resulting project.  After clicking on the <b>Build</b> button, a Visual Studio 2013 project will be created which should be opened in Visual Studio for verification, compiled and run on the device. <br><h4>  Create a stereoscopic image </h4><br>  The first thing to do in the project is to create a stereoscopic image.  And this is very easy to do as we have a three-dimensional scene that can be calculated for each eye. <br>  Find the project First Person Controller and duplicate the main camera (right mouse button, Duplicate). <br>  You should have the following: <br><img src="https://habrastorage.org/getpro/habr/post_images/d00/a14/494/d00a14494ea4617af0379568079fa42a.png"><br>  Further, in the properties for each camera, it is necessary to indicate that the image is rendered only at half of the so-called <i>port</i> <i>(</i> <i>viewport</i> <i>)</i> .  For the left and right eyes, respectively, at the beginning of the screen, and in its second half: <br><img src="https://habrastorage.org/getpro/habr/post_images/006/80b/779/00680b779d3773cd9e4b650b9d2d8f59.png"><br>  But this is not all, of course, the stereo image is not so received, the pictures that are now displayed by these cameras are the same. <br>  In order for the stereo effect to appear, it is necessary to introduce <i>parallax</i> between these cameras. <br>  Add a new C # script to the project: <br><img src="https://habrastorage.org/getpro/habr/post_images/0f6/71e/388/0f671e388a857423a0107e12870fbcdf.png"><br>  Call it FPSVRBehavior.cs and after it is created, drag it with the mouse to the ‚ÄúFirst Person Controller‚Äù.  The created script will be connected to this object. <br><img src="https://habrastorage.org/getpro/habr/post_images/9e5/369/372/9e5369372bf10070aebf1358a4989ccb.png"><br>  Now you can proceed to the task of creating parallax between cameras.  In the Start () method of the FPSVRBehavior class, we simply set the ‚Äúleft eye‚Äù offset from the main ‚Äúparent‚Äù object by a small amount: <br><pre><code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leftEye = <span class="hljs-type"><span class="hljs-type">GameObject</span></span>.<span class="hljs-type"><span class="hljs-type">Find</span></span>(<span class="hljs-string"><span class="hljs-string">"LeftEye"</span></span>); leftEye.transform.<span class="hljs-type"><span class="hljs-type">Translate</span></span>(<span class="hljs-type"><span class="hljs-type">Vector3</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">left</span></span> * <span class="hljs-number"><span class="hljs-number">0</span></span>.1f);</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/d84/286/7e7/d842867e793ab1aca67809c19748bb87.png"><br>  The stereo image is ready, create a new build, publish it to your phone and enjoy the stereo image in your virtual glasses!  True, the image is static, and in these helmets the position of the head is tracked and depending on it the image on the screen changes. <br><br><h3>  We consider the position of the head </h3><br>  Windows Phone phones have a gyroscope sensor.  It can be used for our purposes.  It remains only to learn how to use the data that returns this sensor. <br><br><h4>  Some digression from the main theme, we are writing a plugin for Unity. </h4><br>  Unity3d is known to be a cross-platform application creation tool.  For all its versatility, some narrow points and device-specific APIs are not available.  In order for us to get to the values ‚Äã‚Äãof the gyroscope sensor data, we have to prepare a plugin.  Without going into details, a plugin is two DLLs with the same name that are located in the <b>Assets</b> <b>/</b> <b>Plugins</b> and <b>Assets</b> <b>/</b> <b>Plugins</b> <b>/</b> <b>Metro</b> catalogs. <br><img src="https://habrastorage.org/getpro/habr/post_images/673/f86/9e0/673f869e0e20c9a26d2bb024f7ec27b9.png"><br>  The WindowsPhoneVRController.dll file which is located in the <b>/</b> <b>Assets</b> <b>/</b> <b>Plugins</b> directory is a standard .NET Framework 3.5 build that is designed to work during the Unity Designer. <br>  A similar file located in the <b>/</b> <b>Assets</b> <b>/</b> <b>Plugins</b> <b>/</b> <b>Metro</b> directory is the Windows Store 8.1 Class Library, and it is used by the Unity environment to create the Visual Studio solution so that our project on the target platform will get the functions you need.  More details on how <a href="http://blogs.msdn.com/b/dmandreev/archive/2013/10/01/how-to-create-unity3d-winrt-plugin.aspx">to create plugins</a> can be found in my blog. <br>  The source code for both DLLs is the same: <br><pre> <code class="hljs kotlin">#<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> NETFX_CORE using System.Threading.Tasks; using Windows.Devices.Sensors; #endif namespace WindowsPhoneVRController { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> NETFX_CORE Gyrometer gyro; #endif <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Controller() { #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> NETFX_CORE gyro=Gyrometer.GetDefault(); #endif } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> static void Vibrate() { Vibrate(<span class="hljs-number"><span class="hljs-number">8</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> double AngularVelocityX { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> NETFX_CORE <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gyro.GetCurrentReading().AngularVelocityX; #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; #endif } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> double AngularVelocityY { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> NETFX_CORE <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gyro.GetCurrentReading().AngularVelocityY; #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; #endif } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> double AngularVelocityZ { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> NETFX_CORE <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gyro.GetCurrentReading().AngularVelocityZ; #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; #endif } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> static void Vibrate(int _milliseconds) { #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> NETFX_CORE <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vibrationDevice = Windows.Phone.Devices.Notification.VibrationDevice.GetDefault(); vibrationDevice.Vibrate(TimeSpan.FromMilliseconds(_milliseconds)); #endif } } }</code> </pre><br><br>  Depending on #CONDITION, when compiling for the .NET Framework 3.5, we get a ‚Äústub‚Äù, and when compiling for the Windows Store, we get the working logic.  In the finished example, the link to which is at the bottom, a Visual Studio solution is prepared that compiles both DLLs and decomposes them into the corresponding <b>Assets</b> <b>/</b> <b>Plugins</b> directories <b>.</b> <br><br><h4>  Consider the sensor values </h4><br><br>  As it becomes clear from the source code, working with the gyro sensor is very simple.  We survey the values ‚Äã‚Äãof the acceleration of the rotation of the phone and then it remains only to affect the image on the screen with the help of this data. <br>  To do this, again open the FPSVRBehavior.cs file and add the following code in the Update method: <br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Update</span></span> () { <span class="hljs-type"><span class="hljs-type">float</span></span> vertical_angle_delta = (<span class="hljs-type"><span class="hljs-type">float</span></span>)gyroscopePlugin.AngularVelocityY * <span class="hljs-number"><span class="hljs-number">0.05</span></span>f; <span class="hljs-type"><span class="hljs-type">float</span></span> horisontal_angle_delta = (<span class="hljs-type"><span class="hljs-type">float</span></span>)gyroscopePlugin.AngularVelocityX * <span class="hljs-number"><span class="hljs-number">0.05</span></span>f; <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.localEulerAngles = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Vector3(<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.localEulerAngles.x+vertical_angle_delta , <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.localEulerAngles.y-horisontal_angle_delta, <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.localEulerAngles.z); }</code> </pre><br><br>  gyroscopePlugin is an instance of our plugin, do not forget to declare a variable in this class and create this object in the Start () method; <br>  As it became clear from the code, we simply query the sensor data, and change the position of the object - in our case, this is the First Person Controller.  The magic coefficient 0.05f influences how fast the image will react to the rotation of the phone. <br>  After you build the build and run the application on your phone, the camera will come to life and will now track your head position! <br><br><h4>  Movement is life </h4><br><br>  Now we have a practically full-fledged virtual reality application, but in this virtual reality we can only rotate our heads for now.  In order to move forward, it is necessary to provide some kind of mechanism.  Touching the screen is not possible (the phone is in front of our eyes), connecting additional devices to the phone is difficult, and not convenient.  Therefore, we will provide an elegant and easy way for us to walk inside our virtual world. <br>  This method is very simple - if you tilt your head a little (the phone), so that the virtual camera looks at the floor, it moves forward at a certain angle.  Naturally, given the collisions in our virtual world, so as not to pass through walls. <br>  Add the following code to the Update method of the FPSVRBehavior class: <br><pre> <code class="hljs pgsql">var motor = GetComponent&lt;CharacterMotor&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.localEulerAngles.x &gt; <span class="hljs-number"><span class="hljs-number">30</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.localEulerAngles.x &lt; <span class="hljs-number"><span class="hljs-number">40</span></span>) { motor.inputMoveDirection = <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.rotation*(Vector3.forward * <span class="hljs-number"><span class="hljs-number">0.1</span></span>f); WindowsPhoneVRController.Controller.Vibrate(); }</code> </pre><br>  The code is self-evident - if we bow our head, then somewhere between 30 and 40% there is a zone that leads to the forward movement.  In order to ‚Äúfeel‚Äù where this zone is, we help the user by vibrating the phone. <br>  <a href="http://1drv.ms/1bg8PzR">Download the finished project</a> and immerse yourself in virtual reality! </div><p>Source: <a href="https://habr.com/ru/post/253489/">https://habr.com/ru/post/253489/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../253473/index.html">Product Design Digest February 2015</a></li>
<li><a href="../253477/index.html">Conferences for developers with video presentations</a></li>
<li><a href="../253479/index.html">Creating semantic sites using web components and JSON-LD</a></li>
<li><a href="../253481/index.html">As I did from the physical server virtual</a></li>
<li><a href="../253485/index.html">Without cuts. Cashback service Kubyshka third month in Russia: regular results of the month</a></li>
<li><a href="../253493/index.html">Analyzing the attendance of employees according to the access control</a></li>
<li><a href="../253495/index.html">The engineering device data center level TIER III, standing on four trunk lines</a></li>
<li><a href="../253497/index.html">Quick server setup with PowerShell Desired State Configuration</a></li>
<li><a href="../253501/index.html">The domain zone .com is 30 years old</a></li>
<li><a href="../253503/index.html">Architectural visualization in Unreal Engine 4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>