<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Add the right Firefox for an hour</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many probably faced with the fact that your favorite browser does not know how to do something very simple, but absolutely necessary. I want to tell y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Add the right Firefox for an hour</h1><div class="post__text post__text-html js-mediator-article">  Many probably faced with the fact that your favorite browser does not know how to do something very simple, but absolutely necessary.  I want to tell you how you can train FF4 in an hour on your knee.  Writing extensions is a very simple and sometimes pleasant process, but, unfortunately, the documentation is not always easy to find, how-to are scattered around different corners of the MDN site, I could not find any clear recommendations either ... It all spawns (at least in my the head gave rise to the myth that this is a labor-intensive process, accessible only to the gurus.  This is the myth that this article is intended to dispel.  We will write an extension that will edit the typography in the input fields, asking for help from the <a href="http://www.artlebedev.ru/tools/typograf/">Typographer</a> service. <br><br><img src="https://habrastorage.org/storage/habraeffect/f7/f9/f7f98483155b4b829798ee0cd110e5c7.png"><br><a name="habracut"></a><br><h2>  Low start </h2><br>  Just want to make a reservation: all of the following will work only in FF4.  Colleagues from Mozilla reworked the API so that it is easier to create two extensions for both versions of the browser than to write the <a href="">recommended</a> noodles like <code>appversion&gt;=4.0</code> . <br>  So. <br>  To begin with, we create the skeleton of our future expansion.  We were taken care of, so just enough to <a href="https://addons.mozilla.org/en-US/developers/tools/builder">ask for help</a> .  Fill in a simple mold - and download the finished skeleton.  For our example, we chose the extension without the configuration dialog, with only one button on the toolbar.  This is what the generator did for us: <br><br><img src="https://habrastorage.org/storage/habraeffect/8c/45/8c456b3b23ed918b0fb14eb85ea80c3f.png" alt="Project file tree">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I don‚Äôt know how to draw icons, so we‚Äôll borrow it from the service that will do the main work for us (in the screenshot above, I‚Äôve already added it to the <code>skin</code> folder).  So what to do next with this set of files? <br>  First, let's fix the inscription on the button and the tooltip in the <code>/chrome/locale/en-US/overlay.dtd</code> file: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">!ENTITY</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">typographToolbarButton.label</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Typo</span></span></span><span class="hljs-tag">!"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">!ENTITY</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">typographToolbarButton.tooltip</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Proceed</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">typography</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selected</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">text</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">against</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Lebedev</span></span></span><span class="hljs-tag">'</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">s</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tool</span></span></span><span class="hljs-tag">"&gt;</span></span></code> </pre><br>  Then we substitute our icon instead of the one that rolled over to us by default: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">pushd</span></span> chrome/skin &amp;&amp; mv favicon.png toolbar-button.png &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">popd</span></span></code> </pre> <br>  Now it remains only to rewrite the response to pressing. <br><h2>  Some code </h2><br>  It is convenient for me to use the typographer as follows: if the focus is in the input field ( <code>textarea</code> ) and a piece of text is highlighted there, then we type it.  If the text is not selected - typography the contents of the clipboard.  Well, if the focus is somewhere else - we do nothing :-).  Therefore, we need to learn to work with the clipboard (this is the most non-trivial part). <br>  Well, let's get started.  All these edits will go to the file <code>/chrome/content/overlay.js</code> . <br>  I dug up this magic somewhere in the <a href="https://developer.mozilla.org/en/using_the_clipboard">depths of MDN</a> : <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getClipboard = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">flavor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!flavor || flavor == <span class="hljs-string"><span class="hljs-string">""</span></span>) flavor = <span class="hljs-string"><span class="hljs-string">"text/unicode"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> trans = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/widget/transferable;1"</span></span>] .createInstance(Components.interfaces.nsITransferable); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> clip = Components.classes[<span class="hljs-string"><span class="hljs-string">"@mozilla.org/widget/clipboard;1"</span></span>] .getService(Components.interfaces.nsIClipboard); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!clip || !trans) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; trans.addDataFlavor(flavor); clip.getData(trans, clip.kGlobalClipboard); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> str = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> strLength = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { trans.getTransferData(flavor, str, strLength); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str) str = str.value.QueryInterface(Components.interfaces.nsISupportsString); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { <span class="hljs-comment"><span class="hljs-comment">// it's OK, skipping str = null; } return str ? str.data.substring(0, strLength.value / 2) : ''; }</span></span></code> </pre><br>  Return the contents of the clipboard, or an empty string.  There is nothing to comment here. <br>  We also need to catch the input focus (I will leave this code due to its triviality behind the scenes). <br>  And finally, the text must be sent to the printing service: <br><pre> <code class="javascript hljs">typo : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> focused = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.commandDispatcher.focusedElement; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!focused || focused.tagName.toLowerCase() != <span class="hljs-string"><span class="hljs-string">'textarea'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (focused.selectionStart != focused.selectionEnd ) { text = focused.value.substring(focused.selectionStart, focused.selectionEnd); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { text = getClipboard(); } text = text.replace (<span class="hljs-regexp"><span class="hljs-regexp">/&amp;/g</span></span>, <span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>); text = text.replace (<span class="hljs-regexp"><span class="hljs-regexp">/&lt;/g</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;'</span></span>); text = text.replace (<span class="hljs-regexp"><span class="hljs-regexp">/&gt;/g</span></span>, <span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xmlRequest = <span class="hljs-string"><span class="hljs-string">'&lt;?xml version="1.0" encoding="UTF-8"?&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" '</span></span> + <span class="hljs-string"><span class="hljs-string">'xmlns:xsd="http://www.w3.org/2001/XMLSchema" '</span></span> + <span class="hljs-string"><span class="hljs-string">'xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;soap:Body&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;ProcessText xmlns="http://typograf.artlebedev.ru/webservices/"&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;text&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/text&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;entityType&gt;'</span></span> + <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;/entityType&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;useBr&gt;'</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;/useBr&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;useP&gt;'</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;/useP&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;/ProcessText&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;/soap:Body&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;/soap:Envelope&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> req = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); req.open(<span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://typograf.artlebedev.ru/webservices/typograf.asmx'</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); req.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">aEvt</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (req.readyState == <span class="hljs-number"><span class="hljs-number">4</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (req.status == <span class="hljs-number"><span class="hljs-number">200</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = req.responseText; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> re = <span class="hljs-regexp"><span class="hljs-regexp">/&lt;ProcessTextResult&gt;\s*((.|\n)*?)\s*&lt;\/ProcessTextResult&gt;/m</span></span>; response = re.exec (response); response = <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>.$<span class="hljs-number"><span class="hljs-number">1</span></span>; response = response.replace (<span class="hljs-regexp"><span class="hljs-regexp">/&gt;/g</span></span>, <span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>); response = response.replace (<span class="hljs-regexp"><span class="hljs-regexp">/&lt;/g</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;'</span></span>); response = response.replace (<span class="hljs-regexp"><span class="hljs-regexp">/&amp;/g</span></span>, <span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>); insertText(response, focused); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// smth went wrong ‚Äî just skip it } } }; req.send(xmlRequest); }</span></span></code> </pre><br>  That's all.  It remains to call the <code>typo</code> function from the button- <code>typo</code> event handler: <br><pre> <code class="javascript hljs">onToolbarButtonCommand: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ typograph.typo(); }</code> </pre><br>  And pack all this stuff into our archive: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash if [ -e build ]; then rm -rf build; fi mkdir -p build cp -r install.rdf chrome.manifest chrome defaults build pushd build/chrome &gt;/dev/null &amp;&amp; zip -r typograph.jar content/* skin/* locale/* &amp;&amp; popd &gt;/dev/null || echo 'Unable to produce jar :-(\n' pushd build &amp;&amp; zip -r typograph-4.0.xpi install.rdf chrome.manifest chrome/* defaults/* &amp;&amp; popd &gt;/dev/null || echo 'Unable to produce .xpi :-(\n' if [ -e dist ]; then rm -rf dist; fi mkdir -p dist cp build/typograph-4.0.xpi dist/</span></span></code> </pre><br><br>  All example code and the resulting extension can be taken on the <a href="http://narod.ru/disk/6651300001/typograph-4.0.xpi.html">people</a> .  XPI is an extension file, if you unzip it with a zip, the code itself will be inside. </div><p>Source: <a href="https://habr.com/ru/post/114754/">https://habr.com/ru/post/114754/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../114749/index.html">Introduction to Cappuccino</a></li>
<li><a href="../114750/index.html">Congratulate your friend hoster!</a></li>
<li><a href="../114751/index.html">How the payment reception companies in Ukraine work</a></li>
<li><a href="../114752/index.html">Apple Magic Trackpad in the office and at home</a></li>
<li><a href="../114753/index.html">Process tracking and error handling, part 2</a></li>
<li><a href="../114755/index.html">25 frame at Freeman</a></li>
<li><a href="../114756/index.html">Startup: how to cross mobile and social networks, stop worrying and learn to attract people</a></li>
<li><a href="../114759/index.html">How not to create a dealer company</a></li>
<li><a href="../114760/index.html">If programming languages ‚Äã‚Äãwere women</a></li>
<li><a href="../114761/index.html">Choosing a launcher for Android phones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>