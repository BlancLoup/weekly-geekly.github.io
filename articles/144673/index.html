<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing iOS Applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to talk about testing iOS applications and a small automation of this process. 
 Under the cat will be considered tools for mod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing iOS Applications</h1><div class="post__text post__text-html js-mediator-article">  In this article I want to talk about testing iOS applications and a small automation of this process. <br>  Under the cat will be considered tools for modular and functional testing and give simple examples. <br><a name="habracut"></a><br><h4>  Test application </h4><br>  As an example, I decided to write a simple calculator.  This application has no practical use and has very poor functionality, but in my opinion it is quite enough to give a start to writing tests. <br><br>  For convenience, I <a href="https://github.com/AlexDenisov/tdd_calc">laid out the</a> finished application on the githab. <br><br><h4>  Unit Tests </h4><br>  For writing unit tests I use a wonderful tool - <a href="https://github.com/pivotal/cedar">Cedar</a> . <br>  It allows you to write tests in the style of <a href="http://rspec.info/">RSpec</a> , which improves the structure and readability of the code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      On the githaba, a fairly complete description of how to build the framework was given, but when the build issue came up on several machines, a simple <a href="https://github.com/AlexDenisov/Cedar-installer">script</a> was written on bash that performed this whole routine. <br><br>  To install, you need to clone the project and run the install.sh script, Cedar will be installed in / opt / cedar and symbolic links will be added to the user's home directory (for more convenience when connecting to projects). <br><br>  After Cedar is assembled, you need to set up a test target. <br><ol><li>  Add to your project a new target (Empty Application), I called it UnitTests. </li><li>  Link Cedar to Target (Link Binary With Libraries) </li><li>  Add to Other Linker Flags -ObjC -all_load -lstdc ++ </li><li>  Remove AppDelegate.  This can not be done, but we do not need it. </li><li>  Edit main.m as shown below. </li></ol><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *argv[])</span></span></span><span class="hljs-function"> </span></span>{ @autoreleasepool{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UIApplicationMain(argc, argv, nil, @<span class="hljs-string"><span class="hljs-string">"CedarApplicationDelegate"</span></span>); } }</code> </pre> <br>  Let's write the first test. <br>  Create a FooBar.mm file in the UnitTests target with the following content: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Cedar-iOS/SpecHelper.h&gt; using namespace Cedar::Matchers; SPEC_BEGIN(FooSpec) beforeEach(^{ NSLog(@"before each"); }); afterEach(^{ NSLog(@"after each"); }); describe(@"Foo", ^{ it(@"YES should be YES", ^{ YES should equal(YES); }); }); SPEC_END</span></span></span></span></code> </pre> <br><br>  Now you can launch a target for tests, if everything is set up correctly, a simulator will start with a table, in the cells of which your tests will be described. <br><br>  Let's return to the calculator.  Suppose we have some singleton class that will do the calculations, let's call it CalculationManager.  It should have a method that should return the instance of this class, let's call it sharedInstance. <br>  Let's write a test for this case. <br>  Create an empty CalculationManager class in your main target and add another test file (for example, CalculationManager.mm) with the following contents: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// CalculationManagerSpecs.mm #import &lt;Cedar-iOS/SpecHelper.h&gt; using namespace Cedar::Matchers; #import "CalculationManager.h" SPEC_BEGIN(CalculationManagerSpecs) describe(@"CalculationManager", ^{ it(@"sharedInstance should not return nil", ^{ id instance = [CalculationManager sharedInstance]; instance should_not be_nil; }); }); SPEC_END</span></span></code> </pre><br><br>  At start it is visible that the test falls. <br>  Add the implementation so that the test passes successfully and continue. <br><br>  Add a couple of tests for addition and subtraction operations. <br><br><pre> <code class="cpp hljs">describe(@<span class="hljs-string"><span class="hljs-string">"calculations should be correct"</span></span>, ^{ CalculationManager *manager = [CalculationManager sharedInstance]; it(@<span class="hljs-string"><span class="hljs-string">"addition should be correct"</span></span>, ^{ NSInteger left = <span class="hljs-number"><span class="hljs-number">5</span></span>; NSInteger right = <span class="hljs-number"><span class="hljs-number">37</span></span>; NSInteger etalonResult = <span class="hljs-number"><span class="hljs-number">42</span></span>; NSInteger realResult = [manager add:left with:right]; realResult should equal(etalonResult); }); it(@<span class="hljs-string"><span class="hljs-string">"subtract should be correct"</span></span>, ^{ NSInteger left = <span class="hljs-number"><span class="hljs-number">14</span></span>; NSInteger right = <span class="hljs-number"><span class="hljs-number">12</span></span>; NSInteger etalonResult = <span class="hljs-number"><span class="hljs-number">2</span></span>; NSInteger realResult = [manager subtract:right from:left]; realResult should equal(etalonResult); }); });</code> </pre> <br><br>  That's all, we will assume that the application is sufficiently covered by unit tests, and proceed to interface testing. <br><br><h4>  Interface testing </h4><br>  There are a lot of tools for testing iOS applications, but I want to talk about those that I use myself, namely <a href="https://github.com/calabash/calabash-ios">Calabash-iOS</a> and <a href="https://github.com/moredip/Frank">Frank</a> . <br><br>  These tools are very similar, they both allow you to write tests on <a href="http://cukes.info/">Cucumber</a> and both are implemented in Ruby, the only difference is in functionality. <br>  In one of the projects I had to migrate from Frank, I just ran tests using Calabash and they all went almost immediately, I only had to change a few steps a little. <br><br>  Now I stopped at Calabash.  I think that many iOS developers are not familiar with Cucumber, therefore I want to tell a little how it works and how to write tests. <br><br><h5>  Cucumber </h5><br>  In no case do I pretend to be true to this description, I‚Äôll just describe how I understand his work, and I hope this description will bring some clarity and help those who still have not decided to use it. <br><br>  So, in Cucumber there are several main ‚Äúentities‚Äù: <br><br>  A feature is a set of several logic-related scripts (or not related, as the programmer decides).  It consists of a title and a brief, informative description.  For example: <br><br><pre> <code class="ruby hljs"><span class="hljs-symbol"><span class="hljs-symbol">Feature:</span></span> Manage Orders As a User I should be able to manage Orders through iOS application</code> </pre> <br>  Scenario is a specific scenario describing some use case.  It consists of a name and a set of steps. <br><br><pre> <code class="ruby hljs"><span class="hljs-symbol"><span class="hljs-symbol">Scenario:</span></span> Create Order <span class="hljs-comment"><span class="hljs-comment">#steps</span></span></code> </pre> <br>  Step - description of a specific user action (click on a button / link, enter text, svayp itp). <br><br><pre> <code class="ruby hljs">When I fill <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">"Title"</span></span> with <span class="hljs-string"><span class="hljs-string">"FuuBar"</span></span> And I touch <span class="hljs-string"><span class="hljs-string">"Save"</span></span> button Then I should see alert view titled <span class="hljs-string"><span class="hljs-string">"Saved successully"</span></span></code> </pre> <br>  Step definition - implementation of a specific user action.  It looks like this: <br><br><pre> <code class="ruby hljs">When /^I touch <span class="hljs-string"><span class="hljs-string">"([^"</span></span>]*)<span class="hljs-string"><span class="hljs-string">" button$/ do |button_text| touch("</span></span>button <span class="hljs-symbol"><span class="hljs-symbol">marked:</span></span><span class="hljs-comment"><span class="hljs-comment">#{button_text}") end</span></span></code> </pre> <br><br>  When running tests, Cucumber takes one step and searches for the desired implementation using a regular expression, runs this implementation and takes the next step.  Not sure that this is completely true, but I hope the essence is clear. <br><br>  Let's add Calabash to our project. <br>  Go to the directory with the project and run the following commands: <br><br><pre> <code class="bash hljs">[sudo] gem install calabash-cucumber calabash-ios setup calabash-ios gen</code> </pre> <br>  Calabash added another target to our project, by default it has a project_name-cal template.  We need to do a build for this purpose. <br>  Now we are almost ready to run the tests. <br>  After generation, a hint is displayed. How to run tests. <br><br><pre> <code class="bash hljs">DEVICE=iphone OS=ios5 cucumber</code> </pre> <br><br>  but on the execution of this command, everything falls, because  calabash does not know where our application is.  To do this, you need to specify another variable - APP_BUNDLE_PATH.  By default, Xcode 4.x stores applications at <br><br> <code>~/Library/Application\ Support/iPhone\ Simulator/xx/Applications/hash/app_name.app <br></code> <br>  where xx is the iOS version, and hash is the unique key generated by Xcode for the application. <br>  Try to find your .app and do the following <br><br><pre> <code class="bash hljs">APP_BUNDLE_PATH=<span class="hljs-string"><span class="hljs-string">'~/Library/Application\ Support/iPhone\ Simulator/xx/Applications/hash/your_app-cal.app'</span></span> DEVICE=iphone OS=ios5 cucumber</code> </pre><br>  Now everything should go well. <br><br><h5>  Guard </h5><br>  This method is not very convenient, but it is quite justified, because  calabash cannot know where our app is.  And here comes to the aid of the Guard. <br>  Guard is a gem that monitors the file system and when it changes files it monitors for performing any operations.  <a href="https://github.com/guard/guard/wiki/List-of-available-Guards">The list of guards is</a> quite extensive, but we need <a href="https://github.com/AlexDenisov/guard-calabash-ios">guard-calabash-ios</a> . <br><br>  To install and use it, do the following: <br><br><pre> <code class="bash hljs">gem install guard-calabash-ios guard init calabash-ios</code> </pre> <br>  This will create a Guardfile - a file which describes the properties needed by the guard and the files that you need to monitor.  ( <i>Detailed settings can be found on <a href="https://github.com/AlexDenisov/guard-calabash-ios">github</a> .</i> ) <br>  The final touch is to open the Xcode settings and set Derived Data as Relative.  Now Xcode will store the builds in the project directory, which will allow the guard-calabash-ios script to find the APP_BUNDLE_PATH we need automatically. <br>  Now to run the tests you need to do the following in the project folder. <br><br><pre> <code class="bash hljs">guard</code> </pre> <br><br><h5>  We write tests </h5><br>  Now that everything works more conveniently, we can start writing our UI tests. <br><br>  Calabash has created a features folder that contains our scripts and steps implementation. <br>  Let's make sure that our calculator will allow the user to add or subtract two numbers, and show the correct result in the alert view. <br><br>  Edit my_first.feature <br><br><pre> <code class="ruby hljs"><span class="hljs-symbol"><span class="hljs-symbol">Feature:</span></span> Add numbers As a User I should be able to perform calculations <span class="hljs-symbol"><span class="hljs-symbol">Scenario:</span></span> Add numbers When I fill <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">"left"</span></span> with <span class="hljs-string"><span class="hljs-string">"15"</span></span> And I fill <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">"right"</span></span> with <span class="hljs-string"><span class="hljs-string">"10"</span></span> And I touch <span class="hljs-string"><span class="hljs-string">"add"</span></span> Then I should see <span class="hljs-string"><span class="hljs-string">"25"</span></span></code> </pre> <br>  If you still have guard running, then when you save the file, it will automatically run tests, and only the modified file will be tested.  This is very convenient if you have several feature files, since  it is not necessary to wait after each line until all the tests are run. <br><br>  So, all the tests failed, which is logical. <br><br>  Let's add a UI. <br><br>  To access calabash controls, you need to set their accessibility label.  In addition, buttons can be accessed by writing on them, and text fields by placeholder. <br><br>  I made a primitive interface: two text fields and two buttons in the navigation bar, "+" and "-". <br>  After we added controls to our screen, we need to do the following: <br><br>  1. Add outlets for buttons and text fields. <br>  2. Set the placeholders to our ‚Äúleft‚Äù and ‚Äúright‚Äù text fields <br>  3. Set accessibility labels for buttons <br><br><pre> <code class="cpp hljs">self.addButton.accessibilityLabel = @<span class="hljs-string"><span class="hljs-string">"add"</span></span>; self.subtractButton.accessibilityLabel = @<span class="hljs-string"><span class="hljs-string">"subtract"</span></span>;</code> </pre> <br>  4. Hang handlers on our buttons. <br><br><pre> <code class="cpp hljs">- (IBAction)addButtonTapped:(id)sender { CalculationManager *calculationManager = [CalculationManager sharedInstance]; NSInteger left = [self.leftTextField.text integerValue]; NSInteger right = [self.rightTextField.text integerValue]; [self showResult:[calculationManager add:left with:right]]; } - (IBAction)subtractButtonTapped:(id)sender { CalculationManager *calculationManager = [CalculationManager sharedInstance]; NSInteger left = [self.leftTextField.text integerValue]; NSInteger right = [self.rightTextField.text integerValue]; [self showResult:[calculationManager subtract:right from:left]]; }</code> </pre> <br><br>  5. Add a method to display the result <br><br><pre> <code class="cpp hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)showResult:(NSInteger)result { NSString *resultString = [NSString stringWithFormat:@<span class="hljs-string"><span class="hljs-string">"%d"</span></span>, result]; [[[[UIAlertView alloc] initWithTitle:@<span class="hljs-string"><span class="hljs-string">"Result"</span></span> message:resultString delegate:nil cancelButtonTitle:@<span class="hljs-string"><span class="hljs-string">"OK"</span></span> otherButtonTitles:nil] autorelease] show]; }</code> </pre> <br><br>  6. Go to the terminal with running guard and press Enter, this will launch all your scripts, we have one and if you did everything correctly, then the tests will pass successfully. <br><br>  Now we will write the test for subtraction. <br><br><pre> <code class="ruby hljs"><span class="hljs-symbol"><span class="hljs-symbol">Scenario:</span></span> Subtract numbers When I subtract <span class="hljs-number"><span class="hljs-number">15</span></span> from <span class="hljs-number"><span class="hljs-number">38</span></span> Then I should see <span class="hljs-string"><span class="hljs-string">"23"</span></span> as result</code> </pre> <br>  After launch, Cucumber will report that it does not know such steps, and will offer to implement them. <br>  Copy and edit a little what he put in the file calabash_steps.rb (project_dir / features / steps_definitions /) <br><br><pre> <code class="ruby hljs">When /^I subtract (\d+) from (\d+)$/ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|subtrahend, minuend|</span></span> step <span class="hljs-string"><span class="hljs-string">%{I fill in "left" with "</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{minuend.to_s}</span></span></span><span class="hljs-string">"}</span></span> step <span class="hljs-string"><span class="hljs-string">%{I fill in "right" with "</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{subtrahend.to_s}</span></span></span><span class="hljs-string">"}</span></span> step <span class="hljs-string"><span class="hljs-string">%{I touch "subtract"}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> Then /^I should see <span class="hljs-string"><span class="hljs-string">"(.*?)"</span></span> as result$/ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|result|</span></span> res = query(<span class="hljs-string"><span class="hljs-string">"view:'UIAlertView'"</span></span>, <span class="hljs-string"><span class="hljs-string">"message"</span></span>).first res.should == result <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><br>  In real life, we would most likely use the same methods as in the first scenario, but here I wanted to show how step definitions look, how to call other steps from the implementation of steps (step% {}), how to get to any value (query) and how to write assert (should). <br><br>  On this test all. <br><br><h4>  Conclusion </h4><br>  The described tests and the application look completely ridiculous, but I set my goal to describe with this example the main features that will allow you to immediately start using TDD / BDD, I hope that this came out for me and would be useful for the article. <br><br>  As a logical conclusion I will cite the links again: <br><ul><li>  <a href="http://rspec.info/">RSpec</a> </li><li>  <a href="http://cukes.info/">Cucumber</a> </li><li>  <a href="https://github.com/AlexDenisov/tdd_calc">Code used in the article application</a> </li><li>  <a href="https://github.com/AlexDenisov/Cedar-installer">Script to build Cedar</a> </li><li>  <a href="https://github.com/pivotal/cedar">Cedar</a> </li><li>  <a href="https://github.com/calabash/calabash-ios">Calabash-iOS</a> </li><li>  <a href="https://github.com/AlexDenisov/guard-calabash-ios">Guard Calabash-iOS</a> </li><li>  <a href="https://github.com/moredip/Frank">Frank</a> </li><li>  <a href="https://github.com/AlexDenisov/guard-frank">Guard frank</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/144673/">https://habr.com/ru/post/144673/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144667/index.html">Results of the week. Issue 7 - with Igor Belkin</a></li>
<li><a href="../144668/index.html">Microsoft Xbox 360 may prohibit selling in the United States</a></li>
<li><a href="../144670/index.html">Creating flexible profiles in Drupal 7</a></li>
<li><a href="../144671/index.html">Mechanical display on the AVR from scratch. Part 0: Programmer (s)</a></li>
<li><a href="../144672/index.html">Debugging Native Android NDK Code on Windows</a></li>
<li><a href="../144674/index.html">Roaming Guide 2012: choose fares for travel</a></li>
<li><a href="../144675/index.html">Install and configure OSM-based tile generator in Ubuntu or Debian</a></li>
<li><a href="../144678/index.html">Apple patent application: Safari 3D interface</a></li>
<li><a href="../144679/index.html">Subtleties advancement in FaceBook</a></li>
<li><a href="../144680/index.html">Modern home network and cinema on the couch + Update (about transcoding)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>