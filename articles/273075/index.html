<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Xamarin and Xamarin.Forms - cactus in chocolate. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We are in Contour. Elbe love mobile applications. We already had experience writing an application for iOS, as well as developing and further supporti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Xamarin and Xamarin.Forms - cactus in chocolate. Part 1</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/post/273075/"><img width="500" align="right" src="https://habrastorage.org/files/0ed/e29/2e8/0ede292e89d6495aa250e276947e4bfd.jpg"></a>  We are in Contour. Elbe love mobile applications.  We already had experience writing an application for iOS, as well as developing and further supporting an <a href="http://habrahabr.ru/company/skbkontur/blog/234241/">application for Android</a> .  This year we have released a new <a href="https://itunes.apple.com/us/app/kontur.el-ba/id1004954700">version for iOS</a> , but this time based on <b>Xamarin</b> and <b>Xamarin.Forms</b> , and we are eager to share our experience.  So far, we have managed to consider development only for iOS, but the impressions are already a sea, and a couple of words about Android are definitely going to say. <br><a name="habracut"></a><br><h2>  What is Xamarin </h2><br>  The framework for cross-platform development of mobile applications based on <b>.NET</b> (more precisely, on the implementation of <b>Mono</b> ), supports all major operating systems - Android, iOS and Windows Phone.  More on Habr√© <a href="http://habrahabr.ru/post/188130/">was written</a> <a href="http://habrahabr.ru/company/icl_services/blog/270051/%255D">repeatedly</a> , there is no need to repeat. <br><br><h2>  What is Xamarin.Forms </h2><br>  A framework that allows you to develop a single interface layout immediately under several of the above platforms.  The idea is this: you make the layout once on the basis of the Xamarin components, and on the target platform, for each component, the code renderer is called, which draws already the native components.  The layout itself can be prepared both in code and in XAML format.  The UI utilities for layout and previews of the resulting interface, <a href="http://habrahabr.ru/post/233395/">as a year ago</a> , are still not there, so we chose the option to create a UI from code. <br><br><h2>  Why did we choose Xamarin + Xamarin.Forms? </h2><br>  There were several reasons. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  We use .NET and C # on the server, so it‚Äôs quite convenient to use one language and a platform for three applications (server, iOS, Android) - there is no need to switch from one language to another, the ability to use familiar patterns, it is easy to select common fragments into libraries, and .P. </li><li>  Of the available frameworks, Xamarin looked the most advanced. </li><li>  We did not consider the option of creating an HTML5 application: many forms were planned in the application, and the native components in this plan work noticeably more predictably and faster.  Especially true for low-cost Android-smartphones. </li><li>  Xamarin.Forms was pleased with the potential opportunity to make a common interface for Android and iOS with minimal tillers, and also brought a number of advantages, for example, the block layout model on iOS, which is usual for us. </li></ol><br><h2>  First blood </h2><br>  The beginning of communication from the paid version began with the activation system jamb: in the personal account on the Xamarin website it was already clear that payment ( <b>$ 999</b> or <b>$ 799</b> <a href="https://xamarin.com/msdn">for MSDN subscribers</a> ) was made, but Xamarin.Studio stubbornly refused to build the application, because  ‚ÄúPaid version is not activated‚Äù.  Only manual activation of payment by Xamarin technical support helped.  They responded quickly, but in any case this is a great start, which set the tone for the subsequent project. <br><br>  By the way, the free trial version does not allow building an application larger than 64 kilobytes for the compiled code.  That is, we connect, say, the same json serializer (Newtonsoft) - and the application can no longer be assembled.  Nicely. <br><br><h2>  IDE issues </h2><br>  Xamarin provides its own IDE Xamarin.Studio, based on <a href="http://www.monodevelop.com/">MonoDevelop</a> .  Unfortunately, this IDE has several problems: <br><br><ol><li>  Instability.  For example, the chance of a deadlock is very high when trying to interrupt the application build. </li><li>  The backlight or autocomplete breaks down periodically. </li><li>  Autocompletion does not know how to look for classes that are not included in the current namespace, although it can prescribe the required <b>using the</b> fully written reference to the class. </li><li>  There are clearly not enough opportunities for refactoring, it is far from Resharper in this respect. </li><li>  Integration with the XIB editor (layout files for iOS) breaks down periodically.  If you use the layout through XIB or Storyboard, then Xcode opens for editing, and upon closing it, auto-generated classes related to UI are updated.  But not always.  Sometimes the environment basically stops calling Xcode for some or all of the files.  It is treated by clearing the studio cache (by deleting the contents of the <b>~ / Library / Caches / XamarinStudio-5.0</b> directory). </li></ol><br>  But there is good news too!  At the business rate there is an integration with Visual Studio, which allows you to write code there.  It works very well, with some of the problems, <a href="http://habrahabr.ru/company/icl_services/blog/270051/">for example</a> , we did not encounter <a href="http://habrahabr.ru/company/icl_services/blog/270051/">such</a> problems, apparently because we have not worked with Android and XAML yet.  But then faced with others. <br><br>  The fact is, to build an iOS application, you need a computer or a virtual machine with Mac OS X. And here you have two options: <br><br><ul><li>  build and debug an application from Xamarin Studio running on a Mac; </li><li>  use the plugin to integrate between Visual Studio and the Mac (build host), then the build and launch process on the simulator can be started from VS, and debugged there.  But the simulator picture, if you run the application on it, it is still drawn only on the Mac, so you will have to sit next to two PCs at once, testing the application on one and working in the debugger on the other. </li></ul><br>  Moreover, the plugin for integration worked for a long time unstable.  We occasionally had this situation: three developers, all of them have the same version of the OS, studio, Xamarin, and so on.  They are connected in turn to the same Maca.  As a result, everything works fine for one, break points are ignored for the second one, and not for the third one. <br><br>  Technical support advised to try the latest 4 versions for Mac and Windows, ‚Äúmaybe some combination will work‚Äù.  Installation takes 20-30 minutes, because  the installer downloads even those components (for example, the Android SDK library) that you already downloaded last time.  Think about it ... <br><br>  But even if the plugin works fine, the next time you open the project in Visual Studio, you will have the network turned off or, for example, the Mac is turned off - the plugin will with some probability be hung on searching for the buildhost.  And the ‚Äúcancellation‚Äù does not always work, once I had to go to the registry and delete the saved build-host parameters there. <br><br>  Therefore, we have worked for a long time like this: <br><br><ol><li>  The code lies in the network folder available on the Mac and in the Parallels virtual machine running on Windows running on it; </li><li>  The main part of the code is written in Visual Studio under Windows inside this virtual machine; </li><li>  Debugging or building the final version takes place in Xamarin.Studio on Mac OS X, but not through the plugin, but by manually opening the same code in the shared folder. </li></ol><br>  Well, and from minor troubles: every time you open a project with iOS, the plugin will offer to connect to the build.host, blocking further project download until the answer to the question. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/be8/c2f/d7c/be8c2fd7caed4495ae026ac2138b021f.png" title="This infection even standard Enter / Escape does not understand!" alt="This infection even standard Enter / Escape does not understand!"></div><br><br>  Fortunately, after many months of torment, the Xamarin team took pity on us.  The last Xamarin.Studio update solved this problem - now in the connection window to the remote Mac there appeared a tick ‚Äúnot to show the connection window‚Äù. <br><br>  Oh, and the remote build now does not through its own Xamarin utility, but through ordinary remote users on Mac OS X: <br><br><img src="https://habrastorage.org/files/644/f1f/2a4/644f1f2a402e4c34a15a036c7de9da5f.png"><br><br>  As a result, the connection became quite stable and debugging normally starts in 8 cases out of 10. But in any case, the simulator runs on another PC, i.e.  Debug is on your machine, and the application is running somewhere there, the picture is not displayed on your PC.  You can open a remote session or keep a second computer on the same table. <br><br>  The solution still remains somewhat crutch, but it allows you to completely abandon the use of Xamarin Studio!  Believe me, after several months of life we ‚Äã‚Äãcan say for sure: it is worth it. <br><br>  There are problems with profiling.  <a href="https://xamarin.com/profiler">Xamarin.Profiler</a> (GUI wrapper over <a href="http://www.mono-project.com/docs/debug%2Bprofile/profile/profiler/">Mono log profiler</a> ) for iOS applications did not show the names of the classes you wrote for a long time, there was only information that such native objects take up CPU time and memory, but how do you compare them with the classes you wrote - not a drop not obvious.  Now things are better with this - the written classes have finally appeared on the list. <br><br>  Also, under the profiler, the application is much slower, and, as a result, it can sometimes just not be in time for the launch time to show the first screen, and iOS will nail it.  And if the application does launch, it can fly out in the process of working on the simulator under the profiler.  As a weak excuse, it can be noted that the profiler has long been at the alpha version stage, and over the last year has not been able to reach even the ‚Äústable beta‚Äù stage - at least for iOS. <br><br><img src="https://habrastorage.org/files/be6/dbd/da7/be6dbdda78944322a79dcf3fb18fcbc6.png"><br><br><h2>  Problems with cross-platform code </h2><br>  We are offered to write a cross-platform code in one of two ways: <br><br><ol><li>  <a href="https://developer.xamarin.com/guides/cross-platform/application_fundamentals/shared_projects/">Shared Project</a> .  The code in this project is not compiled into a separate assembly, but simply includes itself as part of several projects at once.  A sort of symlink project. </li><li>  <a href="https://developer.xamarin.com/guides/cross-platform/application_fundamentals/pcl/introduction_to_portable_class_libraries/">PCL Library</a> .  (Portable Class Library) Cross-Platform Library. </li></ol><br>  In theory, you are invited to choose one thing.  In practice, we used both of these methods. <br><br>  In the PCL project, we wrote all the business logic, work with the database, network, etc.  The main advantage is that PCL will not allow the use of any system class that is not implemented on one of the platforms.  So the code written and compiled within PCL is guaranteed to run on all selected platforms. <br><br>  The downside is that the PCL library is written based on the intersection of the capabilities of all selected operating systems, not allowing to use what is missing in one of them.  Ie, if we plan to use only iOS and Android, and there is no necessary feature in Windows Phone, we will not be able to use it.  At the same time, there is a set of ‚Äúprofiles‚Äù for PCL, defining supported platforms, but at the time of this writing, it‚Äôs impossible to select the option ‚ÄúiOS and Android only, without Windows Phone and Windows‚Äù. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/fa3/56a/233/fa356a23311f444dabb446515ff33115.png"></div><br>  As a result, we put in the shared-assembly code, guaranteed to work on iOS and Android, but not able to assemble under PCL.  For example, support for gzip-responses and other specifics of working with a network or database got there. <br><br>  In PCL there may be no trivial things, like working with files, etc.  - in this case, it is assumed that there will be interfaces in the PCL assembly, and the implementations will already be in the project for a specific OS.  In our case, some of these implementations just fell into the shared-assembly. <br><br>  By the way, if you choose a profile for PCL - we advise you to choose <b>profile 259</b> .  Best suited for the available opportunities.  We started on another, not having in its composition, for example, mutexes or thread-safe dictionaries - you can write with your hands, but why?  I also note that the choice of a profile is much more convenient and clearer done in Xamarin.Studio, and not in Visual Studio: <br><br><img src="https://habrastorage.org/files/a36/212/176/a3621217636f4ec4b73178450faa26cc.png"><br><br>  Well, for a snack - another PCL feature: you cannot add another PCL library with a different profile depending on one PCL library.  More precisely, you can add it, but not any profile will get along with anyone.  In general, the idea of ‚Äã‚ÄãPCL is generally usable, but in particular it can be white-hot. <br><br><h2>  Binding issues to native platform capabilities </h2><br>  The basic idea behind Xamarin is that you can write code using the same classes, methods, and structures that you would use when writing native code, it‚Äôs just now written in C #.  But there are nuances ... <br><br>  In the case of iOS, there is a rather interesting bugfich with delegates.  Here, for example, component <b>UIScrollView</b> .  You can assign it a delegate to handle certain events, or you can subscribe to these events directly. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scrollView = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UIScrollView(); <span class="hljs-comment"><span class="hljs-comment">// 1 class UIScrollViewDelegate1: UIScrollViewDelegate { public override void ScrollAnimationEnded(UIScrollView scrollView) { base.ScrollAnimationEnded(scrollView); Debug.WriteLine("Yes, animation ended"); } } scrollView.Delegate = new UIScrollViewDelegate1(); // 2 scrollView.ScrolledToTop += (_, __) =&gt; { Debug.WriteLine("Yes, scrolled to top"); }; scrollView.ScrollAnimationEnded += (_, __) =&gt; { Debug.WriteLine("Yes, animation ended"); };</span></span></code> </pre> <br>  Moreover, when subscribing to a <b>ScrollAnimationEnded</b> event, the <b>delegate</b> is automatically replaced with an internal Xamarin.  And the subscription to the <b>ScrolledToTop</b> event will be lost.  It would seem - what's the problem?  Just don't mix event subscriptions and delegates in the same code!  But sometimes there are problem situations: <br><br><ol><li>  The component does not have the required event, although it is present in the delegate. </li><li>  In a component, Xamarin itself may already have its own delegate with some handlers. </li></ol><br>  Or, for example, in Xamarin.iOS, the single class <b>UITableViewSource</b> class is used, replacing the <b>two</b> iOS protocols <b>UITableViewDataSource</b> and <b>UITableViewDelegate</b> .  This can be confusing. <br><br>  Also, the signatures of methods and classes sometimes change, the same iOS constructor <b>fileURLWithPath</b> turned into Xamarin into <a href="https://developer.xamarin.com/api/member/Foundation.NSUrl.CreateFileUrl/p/System.String/Foundation.NSUrl/">CreateFileUrl</a> . <br><br>  A similar situation occurs in Android - for example, the original <b>GONE</b> constant is in the <b>View</b> class, and in the Xamarin version for the same purpose, we have the <b>enum ViewStates</b> with the <b>Gone</b> value.  A similar problem exists with some other methods and constants, which causes some confusion when switching from a native platform. <br><br><h2>  Lack of abstractions over platform features </h2><br>  For complete happiness, the framework does not hide from you some of the features of a particular OS.  For example - background work with the network: <br><br><ol><li>  In Android, you can simply generate a new stream for working with a network or a background network service, if your application is minimized or the phone is locked, the work will not be interrupted. </li><li>  In iOS, when the application is minimized, it stops, and if you want to do something with the network, you need to use another option, for example, the Background-Safe Task, which stops a few minutes after the minimization. </li></ol><br>  You will say - it's just the features of a particular platform?  Exactly.  But no one from the developer hides these features under abstractions, so we repeat, we will have <b>to study each of the platforms</b> . <br><br><h2>  Lack of third-party components </h2><br>  At the moment, <a href="https://components.xamarin.com/">many components</a> have already been written under Xamarin, but under iOS and Android, more are written.  If necessary, it is theoretically possible to connect a binary library written in <b>Object-C</b> or <b>Java</b> , but you have to write a binding project for the connection between the native library and the Xamarin application.  For iOS, the <a href="https://developer.xamarin.com/guides/ios/advanced_topics/binding_objective-c/objective_sharpie/">Objective Sharpie</a> utility, which can independently generate such a project, will help, but it does not always work 100% exactly, sometimes you have to edit the result of such a generation with your hands, and sometimes even think about whether you need this library at all. <br><br>  In addition, the authors often update such components with a delay, compared with the native version of the library.  We were confronted with the situation when the <b>TestFairy</b> plugin was a couple of months behind the native version.  The TestFairy tech support question was answered to us that everything is fine, you are not losing anything, except for a couple of small features.  But with the release of the new version of Xamarin, a problem arose: applications with this library collected in this version of Xamarin began to fall in real-time. <br><br><h2>  findings </h2><br>  After studying the subtleties of the framework, the conclusions suggest themselves. <br><br><ul><li>  Xamarin allows you to conveniently (with some reservations) use C # and. NET for development for mobile platforms. </li><li>  Xamarin, despite its age, is quite a raw product. </li><li>  Xamarin will not save you from having to carefully study the features of each of the mobile platforms. </li></ul><br>  The article also planned a story about <b>Xamarin.Forms</b> , but that section was so stretched that we decided to allocate it in a separate article.  In it, we‚Äôll tell you about the various problems of the XAmarin.Forms UI framework and how we solved them.  <s>In the meantime - like and subscribe to the blog!</s>  <i>Although no, what for stamp ...</i> <br><br>  <b>Update.</b>  <a href="http://habrahabr.ru/company/skbkontur/blog/273161/">Link to the second part.</a> </div><p>Source: <a href="https://habr.com/ru/post/273075/">https://habr.com/ru/post/273075/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273065/index.html">The problem of the effectiveness of small data centers or "why super-modern DCs Google and Facebook do not solve anything"</a></li>
<li><a href="../273067/index.html">Receptions work in Blender. Part 1</a></li>
<li><a href="../273069/index.html">Experience Evaluation of Diplomas in the USA (WES)</a></li>
<li><a href="../273071/index.html">Web without a mouse</a></li>
<li><a href="../273073/index.html">Free tools for database developers</a></li>
<li><a href="../273077/index.html">Software multitasking timer on the MK</a></li>
<li><a href="../273081/index.html">Changes in RAD Studio 10 Seattle Update 1</a></li>
<li><a href="../273083/index.html">Manage Drones with Intel RealSense SDK Speech Recognition Applications</a></li>
<li><a href="../273087/index.html">The button bar in the elevator: the door, do not rush to close</a></li>
<li><a href="../273089/index.html">Selenium for Python. Chapter 5. Expectations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>