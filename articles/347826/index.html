<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Chromium typos</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We bring to your attention a series of articles devoted to recommendations for writing high-quality code using the example of errors found in the Chro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Chromium typos</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb3/fa0/fef/cb3fa0fef11cb4706f5ce52d238363da.png" alt="Typos"></div>  We bring to your attention a series of articles devoted to recommendations for writing high-quality code using the example of errors found in the Chromium project.  This is the fourth part, which will be devoted to the problem of typos and writing code using the "Copy-Paste method." <br><br>  No one is insured against typos in the code.  Mistakes can be found in the code of the most qualified programmers.  Qualification and experience, unfortunately, do not protect against confusing the variable name or forgetting to write something.  Therefore, typos were, is and will be. <br><a name="habracut"></a><br>  The appearance of additional errors provokes the method of writing code using Copy-Paste.  Unfortunately, copying code is an effective method and nothing can be done about it.  It is much faster to copy a few lines and fix something in them than to write a code fragment again.  I will not even try to dissuade from this method, since I myself am a sinner and use copying code.  The unpleasant side effect of copying is that they forget to change something in the copied code snippet.  In some sense, these mistakes are also misprints: due to carelessness, they forgot to change something in the text or changed it incorrectly. <br><br>  Let's see what typos I noticed during the analysis of the report issued by PVS-Studio.  As I wrote in the <a href="https://habrahabr.ru/company/pvs-studio/blog/347536/">introductory article</a> , the report was reviewed quite briefly, so there may be other errors that I have not noticed.  This article focuses on the most stupid and simple mistakes.  But from the fact that mistakes are stupid, they do not cease to be mistakes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Null pointer dereference </h2><br>  According to the Common Weakness Enumeration, null pointer dereference errors can be classified as <a href="https://cwe.mitre.org/data/definitions/476.html">CWE-476</a> . <br><br>  The following errors refer to the Chromium project code. <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Display</span></span></span><span class="hljs-class"> :</span></span> .... { .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;FocusController&gt; focus_controller_; .... } Display::~Display() { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!focus_controller_) { focus_controller_-&gt;RemoveObserver(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); focus_controller_.reset(); } .... }</code> </pre> <br>  Incorrectly written condition.  The pointer is dereferenced if it is null.  The '!'  here is clearly superfluous. <br><br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v522/">warning</a> : <a href="https://www.viva64.com/ru/w/v522/">V522</a> CWE-476 Dereferencing of the null pointer 'focus_controller_' might take place.  display.cc 52 <br><br>  The next mistake is worthy of the title of "Classic Classics." <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AppViewGuest::CreateWebContents(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!guest_extension || !guest_extension-&gt;is_platform_app() || !embedder_extension | !embedder_extension-&gt;is_platform_app()) { callback.Run(<span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } .... }</code> </pre> <br>  A typo.  Instead of the operator '||'  accidentally wrote the operator '|'.  As a result, the <i>embedder_extension</i> pointer <i>is</i> dereferenced regardless of whether it is null or not. <br><br>  <b>Note.</b>  If the article is read by someone who is not very familiar with the C ++ language, then I suggest reading the article " <a href="https://en.wikipedia.org/wiki/Short-circuit_evaluation">Short-circuit evaluation</a> " to understand what is the matter. <br><br>  PVS-Studio warning: V522 CWE-476 Dereferencing of the null pointer 'embedder_extension' might take place.  Check the bitwise operation.  app_view_guest.cc 186 <br><br>  The next error is due to the fact that the code is not added.  I think this can also be considered a typo.  Should have assigned some value to a smart pointer, but forgot. <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;base::ListValue&gt; NetworkingPrivateServiceClient::GetEnabledNetworkTypes() { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;base::ListValue&gt; network_list; network_list-&gt;AppendString(::onc::network_type::kWiFi); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> network_list; }</code> </pre> <br>  The smart pointer defaults to zero.  Since this pointer does not change after creation, then the null pointer dereference will occur. <br><br>  PVS-Studio warning: V522 CWE-476 Dereferencing of the null pointer 'network_list' might take place.  networking_private_service_client.cc 351 <br><br>  Let's study some more complicated case now. <br><br><pre> <code class="cpp hljs">Response CSSAgent::getMatchedStylesForNode(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> node_id, Maybe&lt;CSS::CSSStyle&gt;* inline_style) { UIElement* ui_element = dom_agent_-&gt;GetElementFromNodeId(node_id); *inline_style = GetStylesForUIElement(ui_element); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!inline_style) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NodeNotFoundError(node_id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response::OK(); }</code> </pre> <br>  PVS-Studio Warning: <a href="https://www.viva64.com/ru/w/v595/">V595</a> CWE-476 The 'inline_style' pointer was used against nullptr.  Check lines: 142, 143. css_agent.cc 142 <br><br>  The <i>inline_style</i> pointer is dereferenceed before checking for equality to <i>nullptr</i> .  It seems to me that this is a consequence of a typo: here we simply missed the asterisk '*' symbol.  In this case, the correct code should look like this: <br><br><pre> <code class="cpp hljs">*inline_style = GetStylesForUIElement(ui_element); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!*inline_style) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NodeNotFoundError(node_id);</code> </pre> <br>  However, perhaps they wanted to check the <i>inline_style</i> pointer.  In this case, this is not a typo, but an error in the logic of the function.  Then, in order to fix the code, you need to move the check above, before calling the <i>GetStylesForUIElement</i> function.  Then the function should be: <br><br><pre> <code class="cpp hljs">Response CSSAgent::getMatchedStylesForNode(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> node_id, Maybe&lt;CSS::CSSStyle&gt;* inline_style) { UIElement* ui_element = dom_agent_-&gt;GetElementFromNodeId(node_id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!inline_style) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NodeNotFoundError(node_id); *inline_style = GetStylesForUIElement(ui_element); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response::OK(); }</code> </pre> <br>  I‚Äôve run out of null pointer dereference errors related to the Chromium code, but there is one more that I noticed in the V8 engine. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Object::IsSmi() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HAS_SMI_TAG(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IC::IsHandler(Object* object) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (object-&gt;IsSmi() &amp;&amp; (object != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>)) || object-&gt;IsDataHandler() || object-&gt;IsWeakCell() || object-&gt;IsCode(); }</code> </pre> <br>  The <i>object</i> pointer is first dereferenced, and only then checked for equality <i>nullptr</i> .  And in general, the expression looks somehow suspicious.  Very similar to a typo in hasty programming: first we wrote <i>object-&gt; IsSmi ()</i> , then we remembered that we need to check the <i>object</i> pointer for equality to <i>nullptr</i> and add a check.  And forget to think :). <br><br>  The PVS-Studio analyzer generates two warnings here at once: <br><br><ul><li>  V522 CWE-628 Dereferencing of the null pointer 'object' might take place.  The null pointer is passed into the 'IsHandler' function.  Inspect the first argument.  Check lines: 'ic-inl.h: 44', 'stub-cache.cc:19'.  ic-inl.h 44 </li><li>  <a href="https://www.viva64.com/ru/w/v713/">V713</a> CWE-476  ic-inl.h 44 </li></ul><br><h2>  Copy paste </h2><br>  It is not possible to classify errors made due to Copy-Paste, according to the Common Weakness Enumeration.  There is no defect like Copy-Paste :).  Different typos will cause different types of defects.  Next, I will show errors that can be classified as: <br><br><ul><li>  <a href="https://cwe.mitre.org/data/definitions/563.html">CWE-563</a> : Assignment to Variable without Use </li><li>  <a href="https://cwe.mitre.org/data/definitions/570.html">CWE-570</a> : Expression is Always False </li><li>  <a href="https://cwe.mitre.org/data/definitions/571.html">CWE-571</a> : Expression is Always True </li><li>  <a href="https://cwe.mitre.org/data/definitions/682.html">CWE-682</a> : Incorrect Calculation </li><li>  <a href="https://cwe.mitre.org/data/definitions/691.html">CWE-691</a> : Insufficient Control Flow Management </li></ul><br>  Let's start again with a code directly related to the Chromium project. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ProfileSyncService::OnEngineInitialized(....) { .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> signin_scoped_device_id; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsLocalSyncEnabled()) { signin_scoped_device_id = <span class="hljs-string"><span class="hljs-string">"local_device"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { SigninClient* signin_client = ....; DCHECK(signin_client); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> signin_scoped_device_id = <span class="hljs-comment"><span class="hljs-comment">// &lt;= signin_client-&gt;GetSigninScopedDeviceId(); } .... }</span></span></code> </pre> <br>  I just feel like the programmer was too lazy to type the variable name <i>signin_scoped_device_id again</i> .  And he decided to copy this name.  However, by chance, along with the name, he copied the type <i>std :: string</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> signin_scoped_device_id</code> </pre> <br>  The consequence of laziness is that the value returned by the <i>GetSigninScopedDeviceId</i> function will be placed in a temporary variable, which will immediately be destroyed. <br><br>  PVS_Studio Warning: <a href="https://www.viva64.com/ru/w/v561/">V561</a> CWE-563 It‚Äôs variable to indicate it declare it anew.  Previous declaration: profile_sync_service.cc, line 900. profile_sync_service.cc 906 <br><br>  The following error I met in the V8 engine, which is used in Chromium. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> LinkageLocation </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ForSavedCallerReturnAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ForCalleeFrameSlot( (StandardFrameConstants::kCallerPCOffset - StandardFrameConstants::kCallerPCOffset) / kPointerSize, MachineType::Pointer()); }</code> </pre> <br>  Most likely the programmer copied <i>StandardFrameConstants :: kCallerPCOffset</i> and wanted to change the name of a constant, but forgot to do it.  Therefore, in the code, the constant is subtracted from itself, with the result that it is 0. Then this 0 is divided by <i>kPointerSize</i> , but it no longer has any meaning.  It will still be 0. <br><br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v501/">warning</a> : <a href="https://www.viva64.com/ru/w/v501/">V501</a> There are "standardFrameConstants :: kCallerPCOffset" there are correct.  linkage.h 66 <br><br>  Another suspicious code snippet seen in V8: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> JSObject::JSObjectShortPrint(StringStream* accumulator) { .... accumulator-&gt;Add(global_object ? <span class="hljs-string"><span class="hljs-string">"&lt;RemoteObject&gt;"</span></span> : <span class="hljs-string"><span class="hljs-string">"&lt;RemoteObject&gt;"</span></span>); .... }</code> </pre> <br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v583/">warning</a> : <a href="https://www.viva64.com/ru/w/v583/">V583</a> CWE-783 The '?:' Operator, regardless of its conditional expression, "&lt;RemoteObject&gt;".  objects.cc 2993 <br><br>  Now let's take a look at the PDFium project. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FXSYS_iswalpha</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">wchar_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> wch)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FXSYS_isupper(wch) || FXSYS_islower(wch); } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CPDF_TextPage::IsHyphen(<span class="hljs-keyword"><span class="hljs-keyword">wchar_t</span></span> curChar) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { WideStringView curText = m_TempTextBuf.AsStringView(); .... <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> iter = curText.rbegin(); .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((iter + <span class="hljs-number"><span class="hljs-number">1</span></span>) != curText.rend()) { iter++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FXSYS_iswalpha(*iter) &amp;&amp; FXSYS_iswalpha(*iter)) <span class="hljs-comment"><span class="hljs-comment">// &lt;= return true; } .... }</span></span></code> </pre> <br>  Copied <i>FXSYS_iswalpha (* iter)</i> .  And ... And they forgot to change something in the second part of the conditions. <br><br>  PVS-Studio warning: V501 CWE-571 There are identical sub-expressions 'FXSYS_iswalpha (* iter)' operator.  cpdf_textpage.cpp 1218 <br><br>  A similar mistake when writing an expression can be found in the Protocol buffers library. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsMap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> google::protobuf::Field&amp; field, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> google::protobuf::Type&amp; type)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> field.cardinality() == google::protobuf::Field_Cardinality_CARDINALITY_REPEATED &amp;&amp; (GetBoolOptionOrDefault(type.options(), <span class="hljs-string"><span class="hljs-string">"map_entry"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) || GetBoolOptionOrDefault(type.options(), <span class="hljs-string"><span class="hljs-string">"google.protobuf.MessageOptions.map_entry"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) || <span class="hljs-comment"><span class="hljs-comment">// &lt;= GetBoolOptionOrDefault(type.options(), "google.protobuf.MessageOptions.map_entry", false)); // &lt;= }</span></span></code> </pre> <br>  The code is clearly written using Copy-Paste.  No one will re-type such a long line :). <br><br>  PVS-Studio Warning: V501 CWE-570 |||  operator.  utility.cc 351 <br><br>  By the way, there is one more such error next to each other: V501 CWE-570  operator.  utility.cc 360 <br><br>  In the following code snippet from the SwiftShader library, my favorite ‚Äú <a href="https://www.viva64.com/ru/b/0260/">last line effect</a> ‚Äù is waiting for us.  Beautiful bug!  I love these. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> TextureCubeMap::updateBorders(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> level) { egl::Image *posX = image[CubeFaceIndex(..._POSITIVE_X)][level]; egl::Image *negX = image[CubeFaceIndex(..._NEGATIVE_X)][level]; egl::Image *posY = image[CubeFaceIndex(..._POSITIVE_Y)][level]; egl::Image *negY = image[CubeFaceIndex(..._NEGATIVE_Y)][level]; egl::Image *posZ = image[CubeFaceIndex(..._POSITIVE_Z)][level]; egl::Image *negZ = image[CubeFaceIndex(..._NEGATIVE_Z)][level]; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!posX-&gt;hasDirtyContents() || !posY-&gt;hasDirtyContents() || !posZ-&gt;hasDirtyContents() || !negX-&gt;hasDirtyContents() || !negY-&gt;hasDirtyContents() || <span class="hljs-comment"><span class="hljs-comment">// &lt;= !negY-&gt;hasDirtyContents()) // &lt;= { return; } .... }</span></span></code> </pre> <br>  At the very end of the condition, it was necessary to use not the <i>negY</i> pointer, but the <i>negZ</i> pointer.  Obviously, we deal with Copy-Paste lines of code and loss of attention at the very end. <br><br>  PVS-Studio Warning: V501 CWE-570 There are identical sub-expressions'! NegY-&gt; hasDirtyContents () '||'  operator.  texture.cpp 1268 <br><br>  The WebKit engine is also pleased with a beautiful bug: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> final </span></span>{ OptionalRotation inherited_rotation = GetRotation(*state.ParentStyle()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inherited_rotation_.IsNone() || inherited_rotation.IsNone()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> inherited_rotation.IsNone() == inherited_rotation.IsNone(); .... }</code> </pre> <br>  PVS-Studio warning: V501 CWE-571 There are identical sub-expressions' inherited_rotation.IsNone () '==' operator.  cssrotateinterpolationtype.cpp 166 <br><br>  Copied <i>inherited_rotation.IsNone ()</i> and forgot to add the underscore character '_'.  The correct option is: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> inherited_rotation_.IsNone() == inherited_rotation.IsNone();</code> </pre> <br>  Let's look again at the Protocol buffers library. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPrimitiveVariables</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...., </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">map</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;* variables)</span></span></span><span class="hljs-function"> </span></span>{ .... (*variables)[<span class="hljs-string"><span class="hljs-string">"set_has_field_bit_message"</span></span>] = <span class="hljs-string"><span class="hljs-string">""</span></span>; (*variables)[<span class="hljs-string"><span class="hljs-string">"set_has_field_bit_message"</span></span>] = <span class="hljs-string"><span class="hljs-string">""</span></span>; (*variables)[<span class="hljs-string"><span class="hljs-string">"clear_has_field_bit_message"</span></span>] = <span class="hljs-string"><span class="hljs-string">""</span></span>; .... }</code> </pre> <br>  Explanations are superfluous.  Copy-Paste in its purest form.  PVS-Studio <a href="https://www.viva64.com/ru/w/v519/">warning</a> : <a href="https://www.viva64.com/ru/w/v519/">V519</a> CWE-563 The variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 149, 150. java_primitive_field_lite.cc 150 <br><br>  We continue.  Programmers need to know how cunning copy-paste is.  Read and be terrified.  Before us is a function taken from WebRTC. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> WebRtcSpl_FilterAR(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; state_length - x_length; i++) { state[i] = state[i + x_length]; state_low[i] = state_low[i + x_length]; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; x_length; i++) { state[state_length - x_length + i] = filtered[i]; state[state_length - x_length + i] = filtered_low[i]; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } .... }</span></span></code> </pre> <br>  Yes, again the effects of Copy-Paste.  Copy the line: <br><br><pre> <code class="cpp hljs">state[state_length - x_length + i] = filtered[i];</code> </pre> <br>  Replaced it <i>filtered</i> to <i>filtered_low</i> .  But <i>they</i> forgot to replace <i>state</i> with <i>state_low</i> .  As a result, some elements of the <i>state_low</i> array remain uninitialized. <br><br>  Are you tired of reading?  Imagine how tired I am to write this!  Let's take a break and drink coffee. <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9c2/5f4/8ae/9c25f48ae66915ffdbdc04d3646ea209.gif" alt="Picture 3"></p><br><br>  PAUSE. <br><br>  I hope you have regained your strength and are ready to continue enjoying the 50 shades of Copy-Paste.  Here is what you can see in the PDFium library. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CPWL_EditImpl::Backspace(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bAddUndo, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bPaint) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_wpCaret.nSecIndex != m_wpOldCaret.nSecIndex) { AddEditUndoItem(pdfium::MakeUnique&lt;CFXEU_Backspace&gt;( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, m_wpOldCaret, m_wpCaret, word.Word, word.nCharset)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddEditUndoItem(pdfium::MakeUnique&lt;CFXEU_Backspace&gt;( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, m_wpOldCaret, m_wpCaret, word.Word, word.nCharset)); } .... }</code> </pre> <br>  Regardless of the condition, the same action is performed.  Most likely, there is an unsuccessful Copy-Paste.  The programmer copied the fragment, then got distracted and forgot to correct the else-branch. <br><br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v523/">Alerts</a> : <a href="https://www.viva64.com/ru/w/v523/">V523</a> CWE-691 The 'then' statement is equivalent to the 'else' statement.  cpwl_edit_impl.cpp 1580 <br><br>  There are three more places like this.  I will regret the reader and give only the analyzer messages: <br><br><ul><li>  V523 CWE-691 The 'then' statement is equivalent to the 'else' statement.  cpwl_edit_impl.cpp 1616 </li><li>  V523 CWE-691 The 'then' statement is equivalent to the 'else' statement.  cpdf_formfield.cpp 172 </li><li>  V523 CWE-691 The 'then' statement is equivalent to the 'else' statement.  cjs_field.cpp 2323 </li></ul><br>  Skia Library. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> SkPathRef::isValid() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-literal"><span class="hljs-literal">nullptr</span></span> == fPoints &amp;&amp; <span class="hljs-number"><span class="hljs-number">0</span></span> != fFreeSpace) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-literal"><span class="hljs-literal">nullptr</span></span> == fPoints &amp;&amp; <span class="hljs-number"><span class="hljs-number">0</span></span> != fFreeSpace) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } .... }</code> </pre> <br>  The same check is performed twice.  The second check is superfluous.  Or forgot to check something else.  The analyzer signals the suspicion of this code at once with two warnings: <br><br><ul><li>  <a href="https://www.viva64.com/ru/w/v581/">V581</a> The conditional expressions of the statement "if" statements followed alongside each other are identical.  Check lines: 758, 761. skpathref.cpp 761 </li><li>  <a href="https://www.viva64.com/ru/w/v649/">V649</a> CWE-561 There are two 'if' statements with identical conditional expressions.  The first 'if' statement contains function return.  This means that the statement is senseless.  Check lines: 758, 761. skpathref.cpp 761 </li></ul><br>  And another mistake in the Skia library. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">can_blit_framebuffer_for_copy_surface</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> GrSurface* dst, GrSurfaceOrigin dstOrigin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> GrSurface* src, GrSurfaceOrigin srcOrigin, ....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GrGLTexture* dstTex = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GrGLTexture*&gt;(dst-&gt;asTexture()); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GrGLTexture* srcTex = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GrGLTexture*&gt;(dst-&gt;asTexture()); <span class="hljs-comment"><span class="hljs-comment">// &lt;= const GrRenderTarget* dstRT = dst-&gt;asRenderTarget(); const GrRenderTarget* srcRT = src-&gt;asRenderTarget(); if (dstTex &amp;&amp; dstTex-&gt;target() != GR_GL_TEXTURE_2D) { return false; } if (srcTex &amp;&amp; srcTex-&gt;target() != GR_GL_TEXTURE_2D) { return false; } .... }</span></span></code> </pre> <br>  PVS-Studio Warning: <a href="https://www.viva64.com/ru/w/v656/">V656</a> Variables 'dstTex', 'srcTex' are initialized through the call to the same function.  It's probably not an error or un-optimized code.  Check lines: 3312, 3313. grglgpu.cpp 3313 <br><br>  After Copy-Paste, they forgot to replace <i>dst</i> with <i>src</i> .  It should be written: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GrGLTexture* srcTex = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GrGLTexture*&gt;(src-&gt;asTexture());</code> </pre> <br>  HarfBuzz Library. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_kerning</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">hb_codepoint_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> left, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">hb_codepoint_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> right, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *end)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> l = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>+leftClassTable).get_class (left); <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>+leftClassTable).get_class (left); <span class="hljs-comment"><span class="hljs-comment">// &lt;= unsigned int offset = l * rowWidth + r * sizeof (FWORD); .... }</span></span></code> </pre> <br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v751/">warning</a> : <a href="https://www.viva64.com/ru/w/v751/">V751</a> Parameter 'right' is not used inside function body.  hb-ot-kern-table.hh 115 <br><br>  Beautiful mistake.  They copied the line, but forgot to change the <i>left</i> to <i>right</i> two times.  It should be: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> l = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>+leftClassTable).get_class (left); <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>+rightClassTable).get_class (right);</code> </pre> <br>  SwiftShader library.  I am sure these code fragments of the same type were written using Copy-Paste: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ELFObjectWriter</span></span></span><span class="hljs-class"> {</span></span> .... ELFStringTableSection *ShStrTab; ELFSymbolTableSection *SymTab; ELFStringTableSection *StrTab; .... }; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ELFObjectWriter::assignSectionNumbersInfo( SectionList &amp;AllSections) { .... ShStrTab-&gt;setNumber(CurSectionNumber++); ShStrTab-&gt;setNameStrIndex(ShStrTab-&gt;getIndex(ShStrTab-&gt;getName())); AllSections.push_back(ShStrTab); SymTab-&gt;setNumber(CurSectionNumber++); SymTab-&gt;setNameStrIndex(ShStrTab-&gt;getIndex(SymTab-&gt;getName())); AllSections.push_back(SymTab); StrTab-&gt;setNumber(CurSectionNumber++); StrTab-&gt;setNameStrIndex(ShStrTab-&gt;getIndex(StrTab-&gt;getName())); AllSections.push_back(StrTab); .... }</code> </pre> <br>  The programmer was inattentive.  In the second block of text, he forgot to replace <i>hStrTab-&gt; getIndex</i> with <i>SymTab-&gt; getIndex</i> , and in the third block he did not replace <i>hStrTab-&gt; getIndex</i> with <i>StrTab-&gt; getIndex</i> . <br><br>  PVS-Studio warning: V778 CWE-682 Two code fragments were found.  Perhaps this is a typo and 'SymTab' variable should not be used instead of 'ShStrTab'.  iceelfobjectwriter.cpp 194 <br><br>  The following error is due to an incorrect calculation of the size of the rectangle in the WebKit library.  Code "tear out the eye."  Weak to notice the error? <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> NGFragmentBuilder::ComputeInlineContainerFragments(....) { .... value.start_fragment_union_rect.size.width = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::max(descendant.offset_to_container_box.left + descendant.fragment-&gt;Size().width - value.start_fragment_union_rect.offset.left, value.start_fragment_union_rect.size.width); value.start_fragment_union_rect.size.height = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::max(descendant.offset_to_container_box.top + descendant.fragment-&gt;Size().height - value.start_fragment_union_rect.offset.top, value.start_fragment_union_rect.size.width); .... }</code> </pre> <br>  At the very end, they forgot to replace <i>width</i> with <i>height</i> in the copied block. <br><br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v778/">warning</a> : <a href="https://www.viva64.com/ru/w/v778/">V778</a> CWE-682 Two code fragments were found.  Perhaps this is a typo and 'height' variable should be used instead of 'width'.  ng_fragment_builder.cc 326 <br><br>  Whew ... We are finishing.  The last code snippet in this section is taken from the PDFium library. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sycc420_to_rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">opj_image_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* img)</span></span></span><span class="hljs-function"> </span></span>{ .... opj_image_data_free(img-&gt;comps[<span class="hljs-number"><span class="hljs-number">0</span></span>].data); opj_image_data_free(img-&gt;comps[<span class="hljs-number"><span class="hljs-number">1</span></span>].data); opj_image_data_free(img-&gt;comps[<span class="hljs-number"><span class="hljs-number">2</span></span>].data); img-&gt;comps[<span class="hljs-number"><span class="hljs-number">0</span></span>].data = d0; img-&gt;comps[<span class="hljs-number"><span class="hljs-number">1</span></span>].data = d1; img-&gt;comps[<span class="hljs-number"><span class="hljs-number">2</span></span>].data = d2; img-&gt;comps[<span class="hljs-number"><span class="hljs-number">1</span></span>].w = yw; <span class="hljs-comment"><span class="hljs-comment">// 1 img-&gt;comps[1].h = yh; // 1 img-&gt;comps[2].w = yw; // 1 img-&gt;comps[2].h = yh; // 1 img-&gt;comps[1].w = yw; // 2 img-&gt;comps[1].h = yh; // 2 img-&gt;comps[2].w = yw; // 2 img-&gt;comps[2].h = yh; // 2 img-&gt;comps[1].dx = img-&gt;comps[0].dx; img-&gt;comps[2].dx = img-&gt;comps[0].dx; img-&gt;comps[1].dy = img-&gt;comps[0].dy; img-&gt;comps[2].dy = img-&gt;comps[0].dy; }</span></span></code> </pre> <br>  Duplicate assignment block.  PVS-Studio warning: V760 Two blocks of text were found.  The second block begins from line 420. fx_codec_jpx_opj.cpp 416 <br><br>  No, I lied to you.  Another Copy-Paste from PDFium met.  I had to add to the article. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Transform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* x1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* res_x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* res_y)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*res_x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; *res_x &gt; -kBase) *res_x = kBase + *res_x; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*res_y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; *res_x &gt; -kBase) *res_y = kBase + *res_y; } }</code> </pre> <br>  PVS-Studio warning: V778 CWE-682 Two code fragments were found.  Perhaps this is a typo and 'res_y' variable should be used instead of 'res_x'.  cfx_imagetransformer.cpp 201 <br><br>  The line was copied: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*res_x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; *res_x &gt; -kBase)</code> </pre> <br>  One variable name <i>res_x was</i> replaced by <i>res_y</i> , and the second was forgotten.  As a result, the function <i>does</i> not check the condition <i>* res_y&gt; -kBase</i> . <br><br><h2>  Other typos </h2><br>  If typos like ‚Äúnull pointers‚Äù and ‚ÄúCopy-Paste‚Äù somehow stood out by themselves, then the remaining errors are quite heterogeneous.  I did not try to classify them somehow and just gathered them in this section of the article. <br><br>  Let's start with a snippet of code related to the Chromium project.  I'm not sure this is a mistake.  However, this place is clearly worth checking out to developers. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> cellular_apn { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> kAccessPointName[] = <span class="hljs-string"><span class="hljs-string">"AccessPointName"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> kName[] = <span class="hljs-string"><span class="hljs-string">"Name"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> kUsername[] = <span class="hljs-string"><span class="hljs-string">"Username"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> kPassword[] = <span class="hljs-string"><span class="hljs-string">"Password"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> kLocalizedName[] = <span class="hljs-string"><span class="hljs-string">"LocalizedName"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> kLanguage[] = <span class="hljs-string"><span class="hljs-string">"LocalizedName"</span></span>; }</code> </pre> <br>  Suspiciously, the <i>kLocalizedName</i> and <i>kLanguage constants</i> contain the same string.  I would venture to suggest that it should be written like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> kLanguage[] = <span class="hljs-string"><span class="hljs-string">"Language"</span></span>;</code> </pre> <br>  However, I am not sure. <br><br>  The PVS-Studio analyzer issues a warning here: <a href="https://www.viva64.com/ru/w/v691/">V691</a> Empirical analysis.  It is possible that a typo is present inside the string literal: ‚ÄúLocalizedName‚Äù.  The 'Localized' word is suspicious.  onc_constants.cc 162 <br><br>  The next mistake in the Skia library is simply beautiful and refers to the article ‚Äú <a href="https://www.viva64.com/ru/b/0509/">Evil lives in comparison functions</a> ‚Äù. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>==(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SkPDFCanon::BitmapGlyphKey&amp; u, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SkPDFCanon::BitmapGlyphKey&amp; v) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(&amp;u, &amp;u, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(SkPDFCanon::BitmapGlyphKey)) == <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  Because of a typo, the <i>u</i> object is compared to itself.  It turns out that <i>operator ==</i> considers any two objects to be the same. <br><br>  PVS-Studio Warning: <a href="https://www.viva64.com/ru/w/v549/">V549</a> CWE-688 The first argument of 'memcmp' function is equal to the second argument.  skpdfcanon.h 67 <br><br>  The following typo in the Skia library leads to the fact that the function does not print out all the elements of the array, but repeatedly displays information about the first element.  However, the error is not a bad thing, since the function is intended for debugging purposes. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">SkString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dumpInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> override </span></span>{ SkString str; str.appendf(<span class="hljs-string"><span class="hljs-string">"# combined: %d\n"</span></span>, fRects.count()); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; fRects.count(); ++i) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> RectInfo&amp; geo = fRects[<span class="hljs-number"><span class="hljs-number">0</span></span>]; str.appendf(<span class="hljs-string"><span class="hljs-string">"%d: Color: 0x%08x, "</span></span> <span class="hljs-string"><span class="hljs-string">"Rect [L: %.2f, T: %.2f, R: %.2f, B: %.2f]\n"</span></span>, i, geo.fColor, geo.fRect.fLeft, geo.fRect.fTop, geo.fRect.fRight, geo.fRect.fBottom); } str += fHelper.dumpInfo(); str += INHERITED::dumpInfo(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; }</code> </pre> <br>  Instead of <i>fRects [0]</i> , <i>fRects [i]</i> should be written.  PVS-Studio warning: V767 Suspicious access to the element of 'fRects' array by a constant index inside a loop.  grnonaafillrectop.cpp 276 <br><br>  A typo in the SwiftShader project causes the <i>assert</i> macro to check not everything that is required. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Value *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createArithmetic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Ice::InstArithmetic::OpKind op, Value *lhs, Value *rhs)</span></span></span><span class="hljs-function"> </span></span>{ assert(lhs-&gt;getType() == rhs-&gt;getType() || (llvm::isa&lt;Ice::Constant&gt;(rhs) &amp;&amp; (op == Ice::InstArithmetic::Shl || Ice::InstArithmetic::Lshr || Ice::InstArithmetic::Ashr))); .... }</code> </pre> <br>  Two times forgot to write "op ==".  As a result, the condition is part of the constants <i>Ice :: InstArithmetic :: Lshr</i> and <i>Ice :: InstArithmetic :: Ashr</i> , which are not compared with anything.  This is an obvious mistake, because of which part of the condition is always true. <br><br>  It should actually be written here: <br><br><pre> <code class="cpp hljs">assert(lhs-&gt;getType() == rhs-&gt;getType() || (llvm::isa&lt;Ice::Constant&gt;(rhs) &amp;&amp; (op == Ice::InstArithmetic::Shl || op == Ice::InstArithmetic::Lshr || op == Ice::InstArithmetic::Ashr)));</code> </pre> <br>  The PVS-Studio analyzer generates two warnings: <ul><li>  <a href="https://www.viva64.com/ru/w/v768/">V768</a> CWE-571 The enumeration constant 'Lshr' is used as a variable of a Boolean-type.  subzeroreactor.cpp 712 </li><li>  V768 CWE-571 The Enumeration Constant 'Ashr' is used as a variable of a Boolean-type.  subzeroreactor.cpp 712 </li></ul><br>  By the way, there are such code fragments that are not in themselves an error or a typo.  But they provoke typos in the future.  For example, these are unsuccessful names for global variables. <br><br>  We can observe one of these variables in the Yasm library: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-comment"><span class="hljs-comment">/* The t_type of tokval */</span></span></code> </pre> <br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v707/">warning</a> : <a href="https://www.viva64.com/ru/w/v707/">V707</a> Giving short names for global variables.  It is suggested to be rename 'i' variable.  nasm-eval.c 29 <br><br>  Yes, this is not a mistake.  But it is very easy to forget somewhere to declare a local variable <i>i</i> and use the global one.  And the code will be compiled, but how the program will work after that is a big mystery.  In general, it is better to give global variables some more unique names. <br><br>  I hope I was able to convey the seriousness of the errors that occur because of typos! <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c45/4df/db7/c454dfdb78c711bfab39b48b69efb3cf.gif" alt="Picture 1"></p><br><br>  Finally, I suggest to get acquainted with a beautiful typo in the Protocol buffers library, which I described in a separate note - " <a href="https://www.viva64.com/ru/b/0550/">February 31</a> ". <br><br><h2>  Recommendations </h2><br>  I apologize, this time I will let you down with the "recommendations" section.  It is very difficult to give some clear universal tips to avoid the mistakes discussed in the article.  It is human nature to make such mistakes, and that's it. <br><br>  Nevertheless, I still try to somehow help to reduce the number of typos in the programs. <br><br><ol><li>  Use the "tabular design" of complex conditions.  I described this technology in detail in the mini-book ‚Äú <a href="https://www.viva64.com/ru/b/0391/">The Main Question of Programming, Refactoring and All That</a> ‚Äù.  See tip N13 - Align code of the same type with a ‚Äútable‚Äù.  By the way, this year I plan to write an extended version of this book.  It will not include 42, but 50 recommendations.  Plus, some old chapters need updating and refinement. </li><li>  When focusing on Copy-Paste, focus at the end of your work.  This is due to the ‚Äú <a href="https://www.viva64.com/ru/b/0260/">last line effect</a> ‚Äù, when at the end of writing the same type of text blocks a person relaxes and makes mistakes.  If you want to read something more scientific on this topic, then I suggest the article " <a href="https://www.viva64.com/ru/b/0485/">Explanation of the effect of the last line</a> ." </li><li>  Be careful when writing functions that compare objects.  These functions are deceptively simple and provoke a large number of typos.  Details: " <a href="https://www.viva64.com/ru/b/0509/">Evil lives in comparison functions</a> ." </li><li>  If the code is hard to read, then it is difficult to notice an error in it.  So try to write the code as clearly as possible and easily read.  Unfortunately, it is difficult to formally formulate, especially briefly.  Many wonderful books are devoted to this topic, for example, such as The Perfect Code written by Steve McConnell.  From a practical point of view, I recommend paying attention to the coding standard in your company and not be lazy to replenish it with good practitioners that you have learned somewhere.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And in general, C ++ is developing rapidly, so it makes sense to regularly audit the standard and update it. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regularly use the PVS-Studio static code analyzer. </font><font style="vertical-align: inherit;">In the end, all the typos described in this article were found precisely with the help of PVS-Studio. </font><font style="vertical-align: inherit;">Download and try the analyzer </font></font><a href="https://www.viva64.com/ru/pvs-studio/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thank you all for your attention, but I'm not saying goodbye yet. </font><font style="vertical-align: inherit;">Soon there will be another article.</font></font><br><br><div style="text-align:center;"> <a href="https://www.viva64.com/en/b/0556/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Karpov. <a href="https://www.viva64.com/en/b/0556/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chromium: Typos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div><p>Source: <a href="https://habr.com/ru/post/347826/">https://habr.com/ru/post/347826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347812/index.html">For your attention - Webpack 4</a></li>
<li><a href="../347816/index.html">Learning the Spring Framework is 100% through practice. Active Tutorials and KML Markup Language. Project KciTasks (beta)</a></li>
<li><a href="../347820/index.html">Direct SQL in EntityFramework. Now with strong typing</a></li>
<li><a href="../347822/index.html">Phone Keyboard vs. Keyword Algorithms vs. Protection of personal information</a></li>
<li><a href="../347824/index.html">Actions on Google: Start developing applications for Google Assistant, which will soon be launched in Russia</a></li>
<li><a href="../347828/index.html">IOS App Development: Start Your Career</a></li>
<li><a href="../347830/index.html">100 interviews per hour, virtual space and 23 million rubles: the results of the pilots in the MEGA Accelerator 2017</a></li>
<li><a href="../347832/index.html">How multichannel phone numbers work</a></li>
<li><a href="../347834/index.html">Anatomy of a thousand fonts</a></li>
<li><a href="../347836/index.html">Object in a case or Optional in Java 8 and Java 9. Part 4: ‚ÄúHow to close a hole in Java with a double bottom case‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>