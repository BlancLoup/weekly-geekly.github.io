<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Correction and modification of MySQL encodings</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Due to the fact that quite a lot of people are asking to help fix the problem with MySQL encodings, I decided to write an article describing how to ‚Äúc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Correction and modification of MySQL encodings</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/f0e8c75a/1fc33887/6bd4914f/7207b6dd.png" align="left" alt="We fight with krakozabrami">  Due to the fact that quite a lot of people are asking to help fix the problem with MySQL encodings, I decided to write an article describing how to ‚Äúcure‚Äù the most frequent cases. <br><br>  The article does not describe how to properly configure MySQL encodings (quite a lot has already been written about this), but about cases when there are rather large tables with incorrect encodings and you need to fix everything. <br><br>  The worst thing about incorrectly configured encodings is that the problem is often difficult to detect, and at first glance it may seem that the site is working properly and there are no problems. <br><a name="habracut"></a><br><h4>  A small digression.  Sypex viewer </h4><br>  At some point I got tired of sending people to the cumbersome phpMyAdmin, and the tiny utility <a href="http://sypex.net/ru/products/browser/">Sypex Viewer</a> was written.  It is a single PHP file, uses modern Web 2.0 technologies AJAX, JSON and others.  The main tasks that were set during creation were the minimum weight, and the maximum convenience and speed of work.  Later in the examples there will be screenshots from it, but all the same actions can be done in phpMyAdmin. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Data in cp1251 table in latin1 </h4><br>  Probably the most popular problem.  When the data is encoded in cp1251 (Windows-1251), and the tables have the default encoding latin1.  Such situations arise in the following cases: <br><ul><li>  with illiterate upgrades from MySQL version less than 4.1 to newer ones; </li><li>  very often occurs in ‚Äúbourgeois‚Äù scripts, which are completely satisfied with the default encoding, and they ‚Äúforget‚Äù that it would be nice to specify the encoding of both tables and joins; </li><li>  there are also cases when moving from one server (which has the default cp1251 encoding installed, in particular, is done in Denver) to another (which has the standard latin1 encoding). </li></ul><br>  As a result, the site seems to be all right, but if you look in the Sypex Viewer, the Russian characters will look like ‚Äúkrakozyabry‚Äù (as users usually call them). <br><br><img src="https://habrastorage.org/storage1/6d172076/0ac2567f/dc8d354a/111e0236.png"><br><br>  In the article, I will consider one of the options for converting encodings using the free <a href="http://sypex.net/">Sypx Dumper</a> php script as a ready-made solution. <br><ol><li>  On the "Export" tab, select the desired table. </li><li>  The encoding should be auto (the remaining parameters are unimportant, you can add a comment, for example, ‚ÄúDump before correcting the encoding‚Äù). </li><li>  Click Run.  Now we have a backup (in any case, it is desirable to do it with any database transformations). </li><li>  Go to the tab "Import" </li><li>  Select the backup file you just made. </li><li>  Select cp1251 encoding and mark the "Encoding correction" option. </li><li>  Click Run. </li><li>  That's all we go in Sypex Viewer, to make sure that the Russian characters are displayed correctly. </li></ol><br><img src="https://habrastorage.org/storage1/492d2304/d5aabc86/7efb45c2/2ee1797d.png"><br><br><h4>  Data and tables in utf8, but the connection encoding is latin1 </h4><br>  Now consider the more advanced case.  Gaining popularity in recent times, in connection with the craze UTF-8.  The creators of the software began to translate their offspring to UTF-8, but even here everything is not as smooth as we would like. <br><br>  The problem arises mainly when the tables have the UTF-8 encoding, the data are in UTF-8, but the connection encoding is set to latin1 by default (a typical example, vBulletin 4, although there is a connection encoding setting in configs, but it is commented out default). <br><br>  As a result, MySQL sends data to UTF-8, but since the encoding is latin1, MySQL tries to convert the data from latin1 to UTF-8.  As a result, Russian characters look like this: <br><br><img src="https://habrastorage.org/storage1/2a512b07/140110f9/da09845e/80b64bde.png"><br><br>  The situation is more advanced, but the problem is corrected almost as in the first case, only in clause 2 you need to select the latin1 encoding, and in clause 6 you need to select the utf8 encoding. <br><br><h4>  Change encoding </h4><br>  Also a common problem is the conversion of encoding from cp1251 to UTF-8.  Before performing this step, make sure that your Russian characters are correctly displayed in Sypex Viewer or phpMyAdmin, if this is not the case, then first correct the encoding. <br>  So, again we go into Sypex Dumper. <br><ol><li>  In the "Export" tab, select the desired table. </li><li>  Set the encoding to which you want to convert the tables, in this case utf8. </li><li>  Click Run. </li><li>  Then go to the "Import" and select the desired file. </li><li>  We set the utf8 encoding and the "Encoding correction" option. </li><li>  Click Run. </li><li>  That's all the tables in UTF-8.  Do not forget that you need to set the connection encoding, convert your scripts and templates to UTF-8, set the correct encoding in the headers. </li></ol><br><br><h4>  Connection encoding </h4><br>  Do not forget that after coding corrections, you need to make sure that your scripts use the correct encoding of the connection (in principle, this will be immediately visible, they will incorrectly show Russian characters without the necessary encoding of the connection).  For some, it is set in the settings, in some you have to add it yourself. <br><br>  For what it is enough to go through the file search, and find where the function mysql_connect (or mysqli_connect) is called.  After this line you need to add a line that indicates the encoding of the connection. <br><br><pre><code class="php hljs">mysql_query(<span class="hljs-string"><span class="hljs-string">"SET NAMES 'cp1251'"</span></span>);</code> </pre> <br><br>  Where instead of cp1251, specify the desired encoding of the connection. <br><br>  <b>Do not forget to make a backup before converting encodings, here as with condoms, it is better to have it and not be needed than when it is needed - it will not be.</b> <br><br>  PS Thank you <a href="http://shortiki.com/">Shorts</a> for fun content for examples. </div><p>Source: <a href="https://habr.com/ru/post/131869/">https://habr.com/ru/post/131869/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131863/index.html">.NET: Creating an extensible plug-in system to monitor and manage servers</a></li>
<li><a href="../131865/index.html">HP competition - part two, positive</a></li>
<li><a href="../131866/index.html">Sergey Arkhipenkov - Theory and Practice of Adaptive Project Management</a></li>
<li><a href="../131867/index.html">Providers appointed extreme</a></li>
<li><a href="../131868/index.html">Owners of Wi-Fi equipment are charged with GLONASS</a></li>
<li><a href="../131871/index.html">Wire Metaboard, or Arduino Skeleton</a></li>
<li><a href="../131876/index.html">End of an era: IE‚Äôs share has fallen below 50%</a></li>
<li><a href="../131880/index.html">Another joke from Google</a></li>
<li><a href="../131881/index.html">Raspberry Pi will start selling in December</a></li>
<li><a href="../131882/index.html">Review CUDA debugger "NVIDIA Parallel Nsight 2.0"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>