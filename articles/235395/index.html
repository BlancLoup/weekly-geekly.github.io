<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making Angular.js a website accessible to robots. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear habrovchane. 

 Many of you, I am sure, have encountered a problem more than once when a website that works entirely on JS, for example, a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making Angular.js a website accessible to robots. Part 1</h1><div class="post__text post__text-html js-mediator-article"> Hello, dear habrovchane. <br><br>  Many of you, I am sure, have encountered a problem more than once when a website that works entirely on JS, for example, a bunch of Angular.js + UI-router, is available for robots from the outside (Google indexer, Facebook crawler or Twitter). in the very wrong way. <br><br>  In a few articles I will try to tell you how, with the help of simple tricks, you can still reject ‚Äúnon-SEO-friendly‚Äù as a reason not to develop, taking into account trends in the world of web development. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this part, I will try to describe how I fought Facebook and Twitter crawlers, so that my links in posts on these social networks looked attractive and people stopped by. <br><br>  If this topic is interesting to you, please under cat. <br><a name="habracut"></a><br>  Of course, you saw big and eye-catching messages in your Facebook feed, and you really wanted to.  Like these: <br><br><img src="https://habrastorage.org/files/51a/9a7/eba/51a9a7eba6a1446f8b6702cdbdc5ffa5.png"><br><br>  The unfriendliness of SEO to JavaScript often pushes developers away from developing a site that uses the full power of JavaScript as it is.  Using the HTML5 History API, following links without reloading the page, and so on, and so on, remains only for web applications. <br><br>  It is a pity, but there is such a tendency that sites tied to JavaScript are not suitable for resources that depend on SEO quite strongly, such as: online stores, news, information resources, and so on. <br><br>  Why it happens? <br>  Because <u>robots do not execute javascript</u> . <br>  That is, by feeding the link to the page on our website to the Facebook crawler, we will get the same result as for the index.html itself, which lies at the root. <br><br>  Suppose you, like me, decided to create on Angular.js using ui-router something like a blog.  Suppose, in addition, we want only the browser to know that your site is navigated using AJAX and enable the so-called HTML5 Mode for <code>ui-router</code> .  What would <code>index.html</code> look like in that case?  Yes something like that: <br><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"no-js"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">base</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ui-view</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--      javascript  --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  To work with the HTML5 History API, you need to specify this when configuring the main application module: <br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'app'</span></span>, [ ... <span class="hljs-string"><span class="hljs-string">'ui.router'</span></span>, ... ]) .config(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$locationProvider</span></span></span><span class="hljs-function">) </span></span>{ ... $locationProvider.html5Mode(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); ... })</code> </pre><br>  Getting started. <br><br>  For debugging, we can use ready-made tools: <br><ul><li>  <a href="https://developers.facebook.com/tools/debug">Facebook debugger</a> </li><li>  <a href="http://dev.twitter.com/docs/cards/validation/validator">Twitter card validator</a> </li></ul><br>  We are trying to feed any Facebook page to a debugger and we understand that after all yes, JS is not executed. <br>  How to be? <br><br>  The first thing that comes to mind is a redirect.  Social network crawlers have their User-Agents, which we will be able to use to redirect to _cooking_ page.  Those.  we need to render the page not at the client, but on the server, and not all, but only those that are important for us, in the case of a blog - these are posts.  In this case, PHP will help us. <br><br>  To do this, we will write a kind of proxy, call it <code>crawler_proxy.php</code> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $SITE_ROOT = <span class="hljs-string"><span class="hljs-string">"http://example.com/"</span></span>; $jsonData = getData($SITE_ROOT); makePage($jsonData, $SITE_ROOT); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($siteRoot)</span></span></span><span class="hljs-function"> </span></span>{ $id = ctype_digit($_GET[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]) ? $_GET[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] : <span class="hljs-number"><span class="hljs-number">1</span></span>; $rawData = file_get_contents($siteRoot.<span class="hljs-string"><span class="hljs-string">'blog/api/get_post/?id='</span></span>.$id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json_decode($rawData); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makePage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $siteRoot)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta property=<span class="hljs-string"><span class="hljs-string">"og:title"</span></span> content=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo $data-&gt;post-&gt;title; ?&gt;"</span></span> /&gt; &lt;meta property=<span class="hljs-string"><span class="hljs-string">"og:description"</span></span> content=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo strip_tags($data-&gt;post-&gt;excerpt); ?&gt;"</span></span> /&gt; &lt;meta property=<span class="hljs-string"><span class="hljs-string">"og:image"</span></span> content=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo $data-&gt;post-&gt;attachments[0]-&gt;images-&gt;full-&gt;url; ?&gt;"</span></span> /&gt; &lt;meta property=<span class="hljs-string"><span class="hljs-string">"og:site_name"</span></span> content=<span class="hljs-string"><span class="hljs-string">"My Blog"</span></span>/&gt; &lt;meta property=<span class="hljs-string"><span class="hljs-string">"og:url"</span></span> content=<span class="hljs-string"><span class="hljs-string">"http://example.com/posts/&lt;?php echo $data-&gt;post-&gt;id ?&gt;"</span></span> /&gt; &lt;meta property=<span class="hljs-string"><span class="hljs-string">"og:type"</span></span> content=<span class="hljs-string"><span class="hljs-string">"article"</span></span>/&gt; &lt;!-- etc. --&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $data-&gt;post-&gt;title; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/h1&gt; &lt;p&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $data-&gt;post-&gt;content; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/p&gt; &lt;img src=<span class="hljs-string"><span class="hljs-string">""</span></span>&gt; &lt;/body&gt; &lt;/html&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  Meta tags are written in the body of the <code>head</code> tag with the <a href="http://opengraphprotocol.org/">Open Graph</a> 'a property. <br><br>  Open Graph is a protocol, a set of rules by which a social network can build a social graph, determine who the author of the article is, and so on.  You can read more on the website of <a href="http://opengraphprotocol.org/">Open Graph</a> itself. <br><br>  So, in my case, the web server is Apache, so we can simply list the User-Agents and send along with the ID of the post to our proxy, which will return us to the ‚Äúdry‚Äù page. <br><br>  In the configuration we write the following: <br><br><pre> <code class="apache hljs"><span class="hljs-comment"><span class="hljs-comment"># ------------------------------------------------------------------------------ # | Redirect crawlers to PHP proxy | # ------------------------------------------------------------------------------ &lt;IfModule mod_rewrite.c&gt; RewriteEngine On # redirect crawlers RewriteCond %{HTTP_USER_AGENT} (Facebot|Google.*snippet|Twitterbot|facebookexternalhit/*) RewriteRule posts/(\d+)$ /crawler_proxy.php?id=$1 [L] &lt;/IfModule&gt;</span></span></code> </pre><br><br>  So, after this, try again our link with the post to send the debugger to Facebook. <br><br>  You can see any warnings and fix them, or, if everything went like clockwork, see how your link will look like on Facebook posts. <br><br>  In the case of Twitter, it‚Äôs just necessary to describe additional meta tags.  Their list can be found on the page of the validator: <a href="http://dev.twitter.com/docs/cards/validation/validator">Twitter Card validator</a> . <br><br>  If the topic turns out to be interesting - in the next part I will talk about indexing a site written in JavaScript. </div><p>Source: <a href="https://habr.com/ru/post/235395/">https://habr.com/ru/post/235395/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../235375/index.html">Emojli: how we accidentally made the application and why we no longer want to do it</a></li>
<li><a href="../235377/index.html">Increase Conversion: 10 Ways to Reduce Your Website's Bounce</a></li>
<li><a href="../235387/index.html">Curah! or self curator</a></li>
<li><a href="../235389/index.html">Photos from the KAI Engineering Festival in Kazan</a></li>
<li><a href="../235391/index.html">Parallel bubble sorting on CUDA</a></li>
<li><a href="../235399/index.html">In the psychophysiology laboratory of Moscow State University: EEG as a tool for reverse engineering of the brain and brain-computer interface</a></li>
<li><a href="../235401/index.html">Small ‚Äúvillages‚Äù inside big cities</a></li>
<li><a href="../235405/index.html">Orbios - personal cloud. Running a beta version</a></li>
<li><a href="../235407/index.html">Insanity is getting stronger?</a></li>
<li><a href="../235409/index.html">Read XLSX on Android with Apache POI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>