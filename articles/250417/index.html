<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The controller for an aquarium without Arduino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My father asked me to make an automatic aquarium feeder. He didn‚Äôt want to go home every day in summer in order to feed the fish. At first I went with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The controller for an aquarium without Arduino</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/d2b/ecc/a51/d2becca513bf4c76a80c72330f9aa8d6.jpg" alt="image"><br><br>  My father asked me to make an automatic aquarium feeder.  He didn‚Äôt want to go home every day in summer in order to feed the fish.  At first I went with him to Chinese shops, there you can buy such a thing for $ 10, but he didn‚Äôt choose anything and had to do the feeding itself. <br><a name="habracut"></a><br>  It was assumed that the fish need to be fed twice a day - at 7 and 16 hours.  Once you need to know the time, you need to make a clock, in the end I applied the RTC DS1302 module.  Food needs to somehow pour in certain doses, then I chose a unipolar stepping motor and Darlington assembly ULN2003 to twist it.  To control had to connect the display and keyboard.  Later, I wanted to implement a thermostat, for which the DS18B20 sensor was purchased.  To save pins, I slapped another shift register 74HC595N through which I connected the LCD display. <br><br>  I was a little misleading, having used the words ‚Äúwithout arduino‚Äù in the title of the topic, in fact, I collected a mock-up on it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/796/b72/caf/796b72caf51f4909a29a90dc0287b647.jpg"><br><br>  Thus, I tested the basic functionality of the program. <br><br><div class="spoiler">  <b class="spoiler_title">listing</b> <div class="spoiler_text"> #include &lt;Stepper.h&gt; <br>  #include &lt;EEPROM.h&gt; <br>  #include &lt;MenuSystem.h&gt; <br>  #include &lt;LiquidCrystal595.h&gt; <br>  #include &lt;DS1302.h&gt; <br>  #include &lt;OneWire.h&gt; <br><br>  #define SECS_PER_MIN (60UL) <br>  #define SECS_PER_HOUR (3600UL) <br>  #define SECS_PER_DAY (SECS_PER_HOUR * 24UL) <br>  #define DAYS_PER_WEEK (7UL) <br>  #define SECS_PER_WEEK (SECS_PER_DAY * DAYS_PER_WEEK) <br>  #define SECS_PER_YEAR (SECS_PER_WEEK * 52UL) <br>  #define SECS_YR_2000 (946684800UL) // the time at the start of y2k <br>  #define LEAP_YEAR (Y) (((1970 + Y)&gt; 0) &amp;&amp;! ((1970 + Y)% 4) &amp;&amp; (((1970 + Y)% 100) ||! ((1970 + Y)% 400) )) <br>  static const uint8_t monthDays [] = {31,28,31,30,31,30,31,31,30,31,30,31};  // API starts <br><br>  // Initialization of clock pins <br>  DS1302 rtc (2, 3, 4); <br><br>  //temperature sensor <br>  OneWire ds (5); <br><br>  // Initialize screen pins <br>  LiquidCrystal595 lcd (6,7,8); <br><br>  // pins of a stepper motor <br>  const int Step1Pin = 9; <br>  const int Step2Pin = 10; <br>  const int Step3Pin = 11; <br>  const int Step4Pin = 12; <br><br>  Stepper motor (100, Step1Pin, Step2Pin, Step3Pin, Step4Pin); <br><br>  int key = 0; <br>  int show_time = 1; <br>  int CurS = 0;  // current tunable parameter (hour / min / sec) <br>  long timestamp; <br>  long timestamp_eeprom; <br>  char k; <br>  int ArrT [3];  // time <br>  int ArrD [3];  // date <br>  Time t; <br>  int counter1 = 100; <br>  int counter2 = 1; <br>  int counter3 = 300; <br>  int counter4 = 30;  // backlight off counter <br>  int temp1 = 0; <br>  int ttemp = 0; <br>  byte thermostat = 0; <br>  byte i; <br>  byte data [12]; <br>  byte present = 0; <br>  float celsius = 0; <br><br>  // menu <br>  MenuSystem ms; <br>  Menu mm ("------ Menu ------"); <br>  MenuItem mm_mi1 ("Feed Now"); <br>  MenuItem mm_mi2 ("Time Setup"); <br>  MenuItem mm_mi3 ("Date Setup"); <br>  MenuItem mm_mi4 ("Thermostat Setup"); <br><br>  void setup () <br>  { <br>  // buttons <br>  pinMode (A0, INPUT); <br><br>  // step <br>  pinMode (Step1Pin, OUTPUT); <br>  pinMode (Step2Pin, OUTPUT); <br>  pinMode (Step3Pin, OUTPUT); <br>  pinMode (Step4Pin, OUTPUT); <br>  motor.setSpeed ‚Äã‚Äã(40); <br><br>  // Run the clock <br>  rtc.halt (false); <br>  rtc.writeProtect (false); <br><br>  // read the temperature settings from the EEPROM <br>  int TEMP_EEPROM = 0; <br>  TEMP_EEPROM = EEPROM_int_read (4); <br>  if ((TEMP_EEPROM&gt; = 0) &amp;&amp; (TEMP_EEPROM &lt;= 100)) { <br>  temp1 = TEMP_EEPROM; <br>  } <br><br>  // Launch the screen with the number of characters and lines <br>  lcd.setLED2Pin (HIGH); <br>  lcd.begin (16, 2); <br>  lcd.clear (); <br><br>  mm.add_item (&amp; mm_mi1, &amp; feed_now_selected); <br>  mm.add_item (&amp; mm_mi2, &amp; time_setup_selected); <br>  mm.add_item (&amp; mm_mi3, &amp; date_setup_selected); <br>  mm.add_item (&amp; mm_mi4, &amp; thermostat_setup_selected); <br>  // mm.add_menu (&amp; mu1); <br>  // mu1.add_item (&amp; mu1_mi1, &amp; on_item3_selected); <br>  ms.set_root_menu (&amp; mm); <br>  } <br><br>  void loop () { <br>  // read the temperature <br>  byte addr [8]; <br>  if (ds.search (addr)) { <br>  ds.reset (); <br>  ds.select (addr); <br>  ds.write (0x44, 1);  // start conversion, with parasite power on at the end <br>  delay (1); // 1000 <br>  present = ds.reset (); <br>  ds.select (addr); <br>  ds.write (0xBE);  // Read Scratchpad <br><br>  for (i = 0; i &lt;9; i ++) {// we need 9 bytes <br>  data [i] = ds.read (); <br>  } <br>  int16_t raw = (data [1] &lt;&lt; 8) |  data [0]; <br>  byte cfg = (data [4] &amp; 0x60); <br>  // at the lower bits <br>  if (cfg == 0x00) raw = raw &amp; ~ 7;  // 9 bit resolution, 93.75 ms <br>  else if (cfg == 0x20) raw = raw &amp; ~ 3;  // 10 bit res, 187.5 ms <br>  else if (cfg == 0x40) raw = raw &amp; ~ 1;  // 11 bit res, 375 ms <br>  // default is 12 bit resolution, 750 ms conversion time <br>  celsius = (float) raw / 16.0; <br>  } <br><br>  if (show_time == 1) { <br>  //lcd.clear (); <br>  counter2--; <br>  if (counter2 == 0) { <br>  if (counter4&gt; 0) { <br>  counter4--; <br>  lcd.setLED2Pin (HIGH); <br>  } else { <br>  lcd.setLED2Pin (LOW); <br>  } <br><br>  counter2 = 10; <br>  lcd.setCursor (0, 0);  // Set the cursor to print the time in the top row <br>  lcd.print (rtc.getTimeStr ());  // Print time <br>  lcd.setCursor (9.0); <br><br>  lcd.print (celsius); <br>  lcd.print ((char) 223);  // celsius simvol <br>  // lcd.print ("C"); <br>  lcd.setCursor (3, 1); <br><br>  // timestamp = getEpochTime (rtc.getTime ()); <br>  //lcd.print (timestamp); <br>  lcd.print (rtc.getDateStr ());  // Print the date <br>  } <br>  } <br><br>  // check once per ... seconds <br>  counter1--; <br>  if (counter1 == 0) { <br>  counter1 = 100; <br><br>  // thermostat <br>  if (temp1&gt; 0 &amp;&amp; celsius&gt; 0) {// if the settings are not 0 and the sensor outputs more than 0 <br>  if (thermostat == 0) { <br>  if (celsius &lt;temp1-1) { <br>  thermostat = 1; <br>  lcd.setLED1Pin (LOW);  // on <br>  } <br>  } else { <br>  if (celsius&gt; temp1 + 1) { <br>  thermostat = 0; <br>  lcd.setLED1Pin (HIGH);  // off <br>  } <br>  } <br>  } <br><br>  // feeder <br>  t = rtc.getTime (); <br>  int H = t.hour; <br>  if ((H == 0) || (H == 8) || (H == 16)) { <br><br>  timestamp_eeprom = EEPROMReadlong (0); <br>  timestamp = getEpochTime (t); <br><br>  if (timestamp_eeprom + 3600 &lt;timestamp) { <br>  lcd.clear (); <br>  lcd.setCursor (4,0); <br>  lcd.print ("Feed Now!"); <br>  EEPROMWritelong (0, timestamp); <br>  motor.step (100); <br>  motor_stop (); <br>  lcd.clear (); <br>  } <br>  } <br>  } <br><br>  if (keyboard ()! = 0) { <br>  show_time = 0; <br>  } <br><br>  menu (); <br>  delay (100);  // Pause and everything is new! <br>  } <br><br>  void motor_stop () { <br>  digitalWrite (Step1Pin, 0); <br>  digitalWrite (Step2Pin, 0); <br>  digitalWrite (Step3Pin, 0); <br>  digitalWrite (Step4Pin, 0); <br>  } <br><br>  // display menu function <br>  void displayMenu () { <br>  lcd.clear (); <br>  lcd.setCursor (0,0); <br>  // Display the menu <br>  Menu const * cp_menu = ms.get_current_menu (); <br><br>  //lcd.print(Current menu name: ‚Äû); <br>  lcd.print (cp_menu-&gt; get_name ()); <br>  lcd.setCursor (0,1); <br>  lcd.print (cp_menu-&gt; get_selected () -&gt; get_name ()); <br>  delay (100); <br>  } <br><br>  char keyboard () { <br>  key = analogRead (0); <br><br>  // debug <br>  //lcd.setCursor (10, 1); <br>  //lcd.print (key); <br><br>  // Esc / Cancel <br>  if ((key&gt; 350) &amp;&amp; (key &lt;360)) { <br>  return 'c'; <br>  } <br>  // up <br>  if ((key&gt; 210) &amp;&amp; (key &lt;230)) { <br>  return 'u'; <br>  } <br>  // right <br>  if ((key&gt; 560) &amp;&amp; (key &lt;590)) { <br>  return 'r'; <br>  } <br>  // down <br>  if ((key&gt; 510) &amp;&amp; (key &lt;540)) { <br>  return 'd'; <br>  } <br>  // left <br>  if ((key&gt; 440) &amp;&amp; (key &lt;470)) { <br>  return 'l'; <br>  } <br>  // Enter <br>  if (key &lt;20) { <br>  return 'e'; <br>  } <br>  return 0; <br>  } <br><br>  void menu () { <br>  k = keyboard (); <br>  if (k == 0) { <br>  counter3--; <br>  if (counter3 == 0) { <br>  counter3 = 300; <br>  k = 'c'; <br>  } <br>  } else { <br>  lcd.setLED2Pin (HIGH); <br>  counter4 = 30; <br>  } <br><br>  switch (k) { <br>  case 'c': <br>  ms.back (); <br>  lcd.clear (); <br>  show_time = 1; <br>  break; <br>  case 'u': <br>  ms.prev (); <br>  displayMenu (); <br>  break; <br><br>  case 'd': <br>  ms.next (); <br>  displayMenu (); <br>  break; <br>  case 'e': <br>  ms.select (); <br>  displayMenu (); <br>  break; <br>  } <br>  } <br><br>  // feed now <br>  void feed_now_selected (MenuItem * p_menu_item) <br>  { <br>  lcd.clear (); <br>  lcd.setCursor (4,0); <br>  lcd.print (‚ÄúFeed Now!‚Äù); <br>  motor.step (100); <br>  motor_stop (); <br>  lcd.clear (); <br>  } <br><br>  void thermostat_setup_selected (MenuItem * p_menu_item) <br>  { <br>  lcd.clear (); <br>  lcd.setCursor (0,0); <br>  lcd.print ("Temperature:"); <br>  ttemp = temp1; <br>  delay (300); <br>  while (k! = 'c') { <br>  delay (1); <br>  k = keyboard (); <br><br>  if (k == 'e') { <br>  temp1 = ttemp; <br>  EEPROM_int_write (4, temp1); <br>  k = 'c';  //output <br>  } <br><br>  if (k == 'u') {incrTemp ();} <br>  if (k == 'd') {decrTemp ();} <br>  lcd.setCursor (0,1); <br>  lcd.print (ttemp); <br>  lcd.print (""); <br>  } <br>  } <br><br>  // function increases temp1 <br>  void incrTemp () { <br>  if (ttemp &lt;30) { <br>  ttemp ++; <br>  } <br>  delay (200); <br>  } <br>  void decrTemp () { <br>  if (ttemp&gt; 0) { <br>  ttemp--; <br>  } <br>  delay (200); <br>  } <br><br>  // Date setup <br>  void date_setup_selected (MenuItem * p_menu_item) <br>  { <br>  lcd.clear (); <br>  lcd.setCursor (0,0); <br>  lcd.print ("Date setup"); <br>  delay (300); <br>  int Flash = 0;  // or draw numbers or spaces, blinking the selected item <br>  int FC = 0;  // counter for flash <br>  t = rtc.getTime (); <br>  ArrD [0] = t.date; <br>  ArrD [1] = t.mon; <br>  ArrD [2] = t.year; <br>  while (k! = 'c') { <br>  delay (1); <br>  k = keyboard (); <br>  // flash <br>  FC ++; <br>  if (fc == 30) { <br>  if (Flash == 0) { <br>  Flash = 1; <br>  } else { <br>  Flash = 0; <br>  } <br>  FC = 0; <br>  } <br>  if (k! = 0) { <br>  Flash = 1; <br>  } <br><br>  // end flash <br>  lcd.setCursor (0,1); <br>  flashPrintDate (Flash, 0); <br>  lcd.print ('.'); <br>  flashPrintDate (Flash, 1); <br>  lcd.print ('.'); <br>  flashPrintDate (Flash, 2); <br><br>  if (k == 'u') {incrD ();} <br>  if (k == 'd') {decrD ();} <br><br>  if (k == 'r') { <br>  if (CurS &lt;2) { <br>  CurS ++; <br>  } else { <br>  CurS = 0; <br>  } <br>  delay (300); <br>  } <br>  if (k == 'l') { <br>  if (CurS&gt; 0) { <br>  CurS--; <br>  } else { <br>  CurS = 2; <br>  } <br>  delay (300); <br>  } <br>  if (k == 'e') { <br>  rtc.setDate (ArrD [0], ArrD [1], ArrD [2]);  // Date. <br>  k = 'c';  //output <br>  } <br>  } <br>  } <br><br>  // Time setup <br>  void time_setup_selected (MenuItem * p_menu_item) <br>  { <br><br>  lcd.clear (); <br>  lcd.setCursor (0,0); <br>  lcd.print ("Time setup"); <br>  delay (300); <br>  int Flash = 0;  // or draw numbers or spaces, blinking the selected item <br>  int FC = 0;  // counter for flash <br><br>  t = rtc.getTime (); <br>  ArrT [0] = t.hour; <br>  ArrT [1] = t.min; <br>  ArrT [2] = t.sec; <br><br>  while (k! = 'c') { <br>  delay (1); <br>  k = keyboard (); <br><br>  // flash <br>  FC ++; <br>  if (fc == 30) { <br>  if (Flash == 0) { <br>  Flash = 1; <br>  } else { <br>  Flash = 0; <br>  } <br>  FC = 0; <br>  } <br>  if (k! = 0) { <br>  Flash = 1; <br>  } <br>  // end flash <br><br>  lcd.setCursor (0,1); <br>  flashPrint (Flash, 0); <br>  lcd.print (':'); <br>  flashPrint (Flash, 1); <br>  lcd.print (':'); <br>  flashPrint (Flash, 2); <br><br>  // change the value <br>  if (k == 'u') {incr ();} <br>  if (k == 'd') {decr ();} <br>  if (k == 'r') { <br>  if (CurS &lt;2) { <br>  CurS ++; <br>  } else { <br>  CurS = 0; <br>  } <br>  delay (300); <br>  } <br>  if (k == 'l') { <br>  if (CurS&gt; 0) { <br>  CurS--; <br>  } else { <br>  CurS = 2; <br>  } <br>  delay (300); <br>  } <br><br>  if (k == 'e') { <br>  rtc.setTime (ArrT [0], ArrT [1], ArrT [2]);  // Hours, minutes, seconds 24-hour format. <br>  k = 'c';  //output <br>  } <br><br>  } <br>  } <br><br>  // function displays hh or mm or cc <br>  void flashPrint (int Flash, int CT) { <br>  if ((CurS == CT) &amp;&amp; (Flash == 0)) { <br>  lcd.print (""); <br>  } else { <br>  if (ArrT [CT] &lt;10) { <br>  lcd.print ('0'); <br>  } <br>  lcd.print (ArrT [CT]); <br>  } <br>  } <br>  // function displays day, month or year <br>  void flashPrintDate (int Flash, int CT) { <br>  if ((CurS == CT) &amp;&amp; (Flash == 0)) { <br>  if (CurS == 2) { <br>  lcd.print (""); <br>  } else { <br>  lcd.print (""); <br>  } <br>  } else { <br>  if (ArrD [CT] &lt;10) { <br>  lcd.print ('0'); <br>  } <br>  lcd.print (ArrD [CT]); <br>  } <br>  } <br><br>  // function increments selected item by 1 <br>  void incr () { <br>  int limit = 59; <br>  if (CurS == 0) { <br>  limit = 23; <br>  } <br><br>  if (ArrT [CurS] &lt;limit) { <br>  ArrT [CurS] ++; <br>  } else { <br>  ArrT [CurS] = 0; <br>  } <br>  delay (200); <br>  } <br>  // function reduces the selected item by 1 for the date <br>  void decr () { <br>  int limit = 59; <br>  if (CurS == 0) { <br>  limit = 23; <br>  } <br>  if (ArrT [CurS]&gt; 0) { <br>  ArrT [CurS] -; <br>  } else { <br>  ArrT [CurS] = limit; <br>  } <br>  delay (200); <br>  } <br><br>  // function increments selected item by 1 for date <br>  void incrD () { <br>  int limit = 31; <br>  if (CurS == 1) { <br>  limit = 12; <br>  } <br>  if (CurS == 2) { <br>  limit = 5079; <br>  } <br><br>  if (ArrD [CurS] &lt;limit) { <br>  ArrD [CurS] ++; <br>  } else { <br>  ArrD [CurS] = 1; <br>  } <br>  delay (200); <br>  } <br>  // function reduces the selected item by 1 for the date <br>  void decrD () { <br>  int limit = 31; <br>  if (CurS == 1) { <br>  limit = 12; <br>  } <br>  if (CurS == 2) { <br>  limit = 5079; <br>  } <br>  if (ArrD [CurS]&gt; 1) { <br>  ArrD [CurS] -; <br>  } else { <br>  ArrD [CurS] = limit; <br>  } <br>  delay (200); <br>  } <br><br>  // timestamp <br>  uint32_t getEpochTime (Time tm) { <br>  int i; <br>  uint32_t seconds; <br>  int year = tm.year - 1970; <br><br>  // seconds from 1970 till 1 jan 00:00:00 of the given year <br>  seconds = year * (SECS_PER_DAY * 365); <br>  for (i = 0; i &lt;year; i ++) { <br>  if (LEAP_YEAR (i)) { <br>  seconds + = SECS_PER_DAY;  // add extra days for leap years <br>  } <br>  } <br><br>  // add days for this year, months start from 1 <br>  for (i = 1; i &lt;tm.mon; i ++) { <br>  if ((i == 2) &amp;&amp; LEAP_YEAR (year)) { <br>  seconds + = SECS_PER_DAY * 29; <br>  } else { <br>  seconds + = SECS_PER_DAY * monthDays [i-1];  // monthDay array starts from 0 <br>  } <br>  } <br>  seconds + = (tm.date-1) * SECS_PER_DAY; <br>  seconds + = tm.hour * SECS_PER_HOUR; <br>  seconds + = tm.min * SECS_PER_MIN; <br>  seconds + = tm.sec; <br>  return seconds; <br>  } <br><br>  // eeprom int <br>  void EEPROM_int_write (int p_address, int p_value) <br>  { <br>  byte lowByte = ((p_value &gt;&gt; 0) &amp; 0xFF); <br>  byte highByte = ((p_value &gt;&gt; 8) &amp; 0xFF); <br><br>  EEPROM.write (p_address, lowByte); <br>  EEPROM.write (p_address + 1, highByte); <br>  } <br><br>  unsigned int EEPROM_int_read (int p_address) <br>  { <br>  byte lowByte = EEPROM.read (p_address); <br>  byte highByte = EEPROM.read (p_address + 1); <br>  return ((lowByte &lt;&lt; 0) &amp; 0xFF) + ((highByte &lt;&lt; 8) &amp; 0xFF00); <br>  } <br><br>  // eeprom long int <br>  void EEPROMWritelong (int address, long value) <br>  { <br>  // Decomposition from a long to 4 bytes by using bitshift. <br>  // One = Most significant -&gt; Four = Least significant byte <br>  byte four = (value &amp; 0xFF); <br>  byte three = ((value &gt;&gt; 8) &amp; 0xFF); <br>  byte two = ((value &gt;&gt; 16) &amp; 0xFF); <br>  byte one = ((value &gt;&gt; 24) &amp; 0xFF); <br><br>  // Write the 4 bytes into the eeprom memory. <br>  EEPROM.write (address, four); <br>  EEPROM.write (address + 1, three); <br>  EEPROM.write (address + 2, two); <br>  EEPROM.write (address + 3, one); <br>  } <br><br>  long EEPROMReadlong (long address) <br>  { <br>  // Read the 4 bytes from the eeprom memory. <br>  long four = EEPROM.read (address); <br>  long three = EEPROM.read (address + 1); <br>  long two = EEPROM.read (address + 2); <br>  long one = EEPROM.read (address + 3); <br><br>  // Return the recomposed long by using bitshift. <br>  return ((four &lt;&lt; 0) &amp; 0xFF) + ((three &lt;&lt; 8) &amp; 0xFFFF) + ((two &lt;&lt; 16) &amp; 0xFFFFFF) + ((one &lt;&lt; 24) &amp; 0xFFFFFFFF); <br>  } <br><br>  I am not a programmer, so don‚Äôt blame the program very much, I know myself that there is a jamb on the joint. <br></div></div><br><br>  But Arduino UNO itself is a big fee, besides its a pity.  It was decided to make a feeder on a clean Atmega328.  As a result, I developed a board in Sprint-Layout: <br><br><img src="https://habrastorage.org/files/8ae/241/b6d/8ae241b6d0d7499190876002b4ff2569.gif" width="400"><br><br>  In this version of the board, the DS1302 watch is already divorced right on the board, as well as minor errors have been fixed. <br><br><div class="spoiler">  <b class="spoiler_title">Printed circuit board manufactured by LUT method and tinned with Rose alloy</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/fce/f06/1e6/fcef061e616240a589b500a03b3c5e38.jpg"><br><br>  The keyboard board was also made, it can be seen on the photo of the layout. <br></div></div><br>  Then he soldered all the details: <br><br><img src="https://habrastorage.org/files/7a2/a28/43c/7a2a2843c8864e62baa3e1836352e53a.jpg"><br><br>  I have no interface for programming, so I upload all changes to the Arduino, and then simply rearrange the controller in the socket on the board. <br><br><div class="spoiler">  <b class="spoiler_title">The body painted in OpenSCAD and printed on a 3D printer</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d56/d75/f3f/d56d75f3fad046fcbc1b559054b99bf0.png"><br><img src="https://habrastorage.org/files/e38/dc5/b84/e38dc5b84833410585b5ec589996c28f.png"><br><br>  On the housing cover there are two ears, in case someone wants to fix it directly on the glass of the aquarium. <br><br><img src="https://habrastorage.org/files/265/37f/684/26537f6847d741d887343943ee72d213.png"><br><img src="https://habrastorage.org/files/327/39b/497/32739b4975bb49929a57866cf3f1373b.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">I also painted and printed out the hull for the trough itself.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/56d/3fa/a57/56d3faa5730f4e88ba45c4d56071c9a8.png"><br><br>  Inside this thing should spin such a cylinder with slots: <br><br><img src="https://habrastorage.org/files/999/ee6/b12/999ee6b123834942b89fc4f43432c534.png"><br></div></div><br>  Keyboard and watch module fixed with hot melt: <br><br><img src="https://habrastorage.org/files/4e4/b4e/a59/4e4b4ea594f24af08e8cf691fe6d3698.jpg"><br><br>  And he collected everything to the heap: <br><br><img src="https://habrastorage.org/files/e52/7b8/88f/e527b888f7e3480194421c135c772c04.jpg"><br><br>  Here you can see the result of the work: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Qrm3kbzSChg%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhi1NG47EKNEyKXWZe6l3Czhrh7NDw" frameborder="0" allowfullscreen=""></iframe><br><br>  I tried, everything works.  I gave the device to my father for testing.  Surely there will be shortcomings when we test - accomplish your goal. <br>  about results and corrections. <br><br>  After everything was done, I drew a diagram: <br><br><div class="spoiler">  <b class="spoiler_title">Do not kick the very first time using the Eagle</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/234/7eb/640/2347eb640b0d4f509ab02005e6607e8d.png"><br></div></div><br>  R1, R2 - 10 kOhm, R3 - 3 kOhm, resistors on the buttons of 2.2 kOhm, C1, C2 - 20 pF, the electrolyte C3 is 5 ŒºF, the electrolyte also costs about 1000 microfarads.  Quartz for the microcontroller 16 MHz, any npn transistor. <br><br><h4>  According to the results, you can estimate the estimate: </h4><br>  1. Atmega328 microcontroller - $ 1.8; <br>  2. 16x2 LCD screen - $ 2.3; <br>  3. Thermal sensor DS18B20 - $ 3; <br>  4. The RTC DS1302 clock module is $ 3.5; <br>  5. ABS plastic for 3d printing 84g.  - $ 2.5 <br>  6. Stepper motor, quartz, resistors, Conder, textolite, etc. - $ 1, as if such a good enough. <br>  <b>Total: ~ $ 14</b> . <br><br><h4>  What I would like to do in the future </h4><br>  1. Russify the interface.  To do this, you need to deal with the LiquidCrystal595Rus.h library; <br>  2. Make a setting for adjusting the dose of feed; <br>  3. Make the setting for selecting the feeding time; <br>  4. You can control the light and the compressor, for this there are free pins and legs ULN2003; <br>  5. If the motor is switched to analog pins, then there will be a place to connect the Wi-Fi module, thus it can be linked to OpenHAB to see temperature graphs and always know if the device is working, even when abroad. <br><br>  In conclusion, I want to add that all the source code is uploaded to <a href="https://github.com/speccyfan/aquafeeder">github</a> . <br>  There are also boards in layout, and openscad, stl, source program files. <br><br>  That's all, thank you for your attention. </div><p>Source: <a href="https://habr.com/ru/post/250417/">https://habr.com/ru/post/250417/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250403/index.html">Vulnerabilities and backdoors in Grandstream phones</a></li>
<li><a href="../250407/index.html">UX-strategy in practice. Part 2 - Grocery Designer</a></li>
<li><a href="../250409/index.html">Apple's Android application, interactive cinema, Rovio's Match3 and other news of the week for a mobile developer</a></li>
<li><a href="../250413/index.html">How Elasticsearch can help you find suspicious site activity</a></li>
<li><a href="../250415/index.html">Writing a plugin for October CMS</a></li>
<li><a href="../250419/index.html">ASP.NET Day: Announcement of Reports</a></li>
<li><a href="../250421/index.html">Interview with Olga Pavlova: ‚ÄúThe crisis has not affected the site building industry yet. You can work "</a></li>
<li><a href="../250423/index.html">How I created a mobile fighting game for iOS</a></li>
<li><a href="../250427/index.html">How-to: How the API improves the hosting provider infrastructure</a></li>
<li><a href="../250429/index.html">Parsim Lostfilm.tv RSS or Another bike</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>