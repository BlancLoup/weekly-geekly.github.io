<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dynamic code analysis with Iroh.js</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vladislav Vlasov, a software engineer at Developer Soft and a teacher of Netology , wrote a series of articles on EcmaScript6 for his blog, in the fir...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dynamic code analysis with Iroh.js</h1><div class="post__text post__text-html js-mediator-article">  <i>Vladislav Vlasov, a software engineer at <a href="http://www.developersoft.ru/">Developer Soft</a> and a teacher of <a href="https://netology.ru/%3Futm_source%3Dblog%26utm_medium%3D747%26utm_campaign%3Dhabr">Netology</a> , wrote a series of articles on EcmaScript6 for his blog, in the first part of which he reviewed using examples of dynamic code analysis in EcmaScript using Iroh.js.</i> <br><br><h2>  Static and dynamic code analysis </h2><br>  Code analysis tools are a useful tool for detecting and detecting errors and features in code operation.  Code analysis is static and dynamic.  In the first case, the source code is parsed and analyzed without its execution, in the second, execution takes place in a controlled sandboxing environment (sandboxing), which provides meta information about the elements of the application during its execution. <br><br><img src="https://habrastorage.org/webt/8n/zx/4s/8nzx4sszxb-cvcmvkwyahdhsysc.jpeg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In EcmaScript, which has <a href="https://ru.wikipedia.org/wiki/%25D0%25A3%25D1%2582%25D0%25B8%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25B8%25D0%25B7%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">duck typing</a> (duck-typing), static analysis tools are often used to detect potentially dangerous situations in the code without executing: inconsistencies between the types and arguments passed, incorrect operations with variables of inconsistent types, non-executable code sections, and so on.  The most popular solutions are <a href="https://github.com/Microsoft/TypeScript">Typescript</a> and <a href="https://github.com/facebook/flow">Flow</a> , based on the extension of the language with a special syntax. <a name="habracut"></a><br><br>  Unlike programming languages, in which a strict type system is an integral part of them, and, accordingly, descriptions of types of variables and objects are already incorporated in the source code, EcmaScript, on the contrary, requires a manual description, moreover, dependent and different for individual static typing tools.  This entails the <b>following disadvantages</b> : <br><br><ul><li>  the static typing tool introduces a set of synthetic instructions into the language, so the source code must necessarily be processed with a transpiler (transpiler), such as a cable with the appropriate plug-ins, or a TypeScript compiler, respectively; <br></li><li>  EcmaScript is dynamic in nature, and in many cases static typing is simply not applicable: for any objects received from the external environment, the data type will be string or any. <br></li></ul><br><h2>  Iroh.js - solution for dynamic analysis of EcmaScript applications </h2><br>  The solution that eliminates the above disadvantages is the <a href="https://github.com/maierfelix/Iroh">Iroh.js EcmaScript code dynamic analyzer</a> .  Iroh.js allows you to perform code analysis and manipulation during execution, without having to modify the source code or annotate it, as is the case with static typing tools. <br><br>  Iroh.js allows you to record the execution scheme of the code in real time, get information about the state of objects and the call stack, as well as control the behavior of the program on the fly. <br><blockquote>  Iroh.js can be used to obtain information on the following aspects of the runtime: the function call tree, the actual data types of objects and variables, implicit conversions to an object, and the primitive type (boxing / unboxing), including conversions to a string. </blockquote>  Iroh.js functions due to preliminary correction of the code in such a way as to record the events taking place without changing the logic and scheme of the source program execution.  This provides the ability to add listeners to follow up and respond to actions.  Iroh.js allows not only to monitor the behavior of the code in the execution mode, but also to modify it, intercepting the call of certain functions, setting the overlapping value for variables and so on. <br><br>  Iroh.js tracks the call stack only for the modified code and cannot provide meta information or modification on the fly for native runtime functions or imported library elements.  As a rule, it is not necessary to analyze and modify the behavior of the library code, but if necessary it is also possible - the scope of Iroh.js is determined by the code that was added to the sandbox of Iroh.js execution by means of prior patching. <br><br>  Iroh.js can be added to the node.js application as an <a href="https://www.npmjs.com/package/iroh">npm package</a> , and launched directly in the <a href="">browser</a> , which can be useful for dynamic analysis of small independent code fragments or creating demo examples. <br><br><h3>  Example 1. Analysis of the call graph for the function calculating Fibonacci numbers </h3><br>  As the simplest example, we can consider two implementations of the Fibonacci number calculation function ‚Äî a naive version with a full recursive tree, and an optimized solution with memorability of previous results.  The source code of the proposed functions is presented below: <br><br><pre><code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fibonacciNaive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function"> {  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n &lt;= 0)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> 0;  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fibonacciNaive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n - 1)</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fibonacciNaive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n - 2)</span></span></span><span class="hljs-function">; };</span></span></code> </pre> <br><pre> <code class="hljs actionscript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fibonacciMemoized</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n, x1 = 0, x2 = 1)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(n &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x1; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fibonacciMemoized(n - <span class="hljs-number"><span class="hljs-number">1</span></span>, x2, x1 + x2); };</code> </pre> <br>  Now you can make a dynamic analysis of these functions.  Of course, both implementations provide the correct result, but <code>fibonacciMemoized</code> runs much faster than <code>fibonacciNaive</code> , and also consumes less memory. <br><br>  Obviously, the point is to save intermediate calculations and optimize tail recursion.  <a href="https://maierfelix.github.io/Iroh/examples/execution-path/">The</a> execution flow <a href="https://maierfelix.github.io/Iroh/examples/execution-path/">analyzer</a> based on Iroh.js allows you to see this clearly: <br><table><tbody><tr><td><img src="https://habrastorage.org/webt/lo/cq/wm/locqwmxydfm-8tbhbeiyafd6mkg.png"><br></td><td><img src="https://habrastorage.org/webt/ev/vy/rx/evvyrx6g2b9b11trjkxccx7dpu0.png"><br></td></tr></tbody></table>  The dynamic analyzer allows you to easily find out that in the first, non-optimal case, for calculating the 6th Fibonacci number, the number of recursive calls reaches 41, while in the second - only 7. With the number of the calculated number increasing, in the first case the growth of recursive calls will be exponential, and in the second - linear. <br><br>  Although the task of calculating Fibonacci numbers is extremely simple, and the optimization presented is trivial and widely known, Iroh.js allows you to track the graph of function calls and find redundant or incorrect calls. <br><br>  By displaying the actual values ‚Äã‚Äãof the arguments and variables, the code can be debugged during execution without adding synthetic <code>console.log</code> instructions. <br><br><h3>  Example 2. Modifying objects and variables on the fly </h3><br>  In the process of analyzing the behavior of an application with potentially complex and non-linear logic, it may be necessary to track the moment when the value of a particular variable or object has changed, or, conversely, to initiate changes of the current value to a special one at a certain moment.  All this can be done by means of Iroh.js. <br><br>  As a simple example, consider the code of a web page that executes AJAX requests to several web resources, but for debugging purposes, it is necessary to intercept calls to some of them by replacing the URL address with a debugging stub.  A simplified fragment of the source code might look like this: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> urlAddresses = [<span class="hljs-string"><span class="hljs-string">'ADDR1'</span></span>, <span class="hljs-string"><span class="hljs-string">'ADDR2'</span></span>, <span class="hljs-string"><span class="hljs-string">'ADDR3'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> resultPromise = <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.all(urlAddresses.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">addr</span></span></span><span class="hljs-function"> =&gt;</span></span> fetch(addr).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> res.text()).catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(err)))); resultPromise.then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(result))</code> </pre> <br>  Suppose you need to replace the <code>ADDR3</code> with <code>ADDR3-test</code> .  Using Iroh.js, the corresponding operation can be performed as follows: <br><br><pre> <code class="hljs pgsql">const stage = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Iroh.Stage(code); // code -      const listener = stage.addListener(Iroh.<span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span>); const originalFetch = <span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span>; listener.<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>("before", <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (e) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> === <span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span>) {   e.<span class="hljs-keyword"><span class="hljs-keyword">call</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (url) {     const targetUrl = url === <span class="hljs-string"><span class="hljs-string">'ADDR3'</span></span> ? <span class="hljs-string"><span class="hljs-string">'ADDR3-test'</span></span> : url;     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> originalFetch.<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, [targetUrl].concat(arguments.<span class="hljs-keyword"><span class="hljs-keyword">slice</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>)))   }); } }); eval(stage.script);</code> </pre> <br>  Iroh.js allows you to analyze and intercept function calls and the allocation of variables, providing the possibility of modifying their values ‚Äã‚Äãand behavior on the fly.  More examples can be found <a href="https://maierfelix.github.io/Iroh/examples/exploit-runtime/">here</a> . <br><br><h2>  findings </h2><br>  Iroh.js is a powerful and functional tool for dynamic code analysis in EcmaScript.  This tool can be used both for code analysis, including constructing a call graph, displaying actual types and values ‚Äã‚Äãin variables and objects, and for modifying code on the fly, including code corrections based on events. <br><br>  Dynamic analysis is a rather complicated method, but for EcmaScript, taking into account duck typing, the presence of host objects and native functions that allow you to change the behavior of the code on the fly, this is the only way to analyze and debug the code during execution. <br><br>  Iroh.js can also use code to create functional tests without having to pre-modify it to export values.  Based on Iroh.js, you can <a href="https://maierfelix.github.io/Iroh/examples/measure-performance/">measure the performance of</a> problem areas of the code and even implement an online IDE development environment with the possibility of <a href="https://maierfelix.github.io/Iroh/examples/step-by-step/">step-by-step debugging</a> and time-traveling debug, that is, executing the code in the reverse order to search for expressions that were the source of error or incorrect calculations. <br><br><h2>  From the Editor </h2><br>  Courses "Netology" on the topic: <br><br><ul><li>  Profession " <a href="https://netology.ru/programs/front-end%3Futm_source%3Dblog%26utm_medium%3D747%26utm_campaign%3Dhabr">Frontend-developer</a> "; <br></li><li>  profession " <a href="https://netology.ru/programs/web-developer%3Futm_source%3Dblog%26utm_medium%3D747%26utm_campaign%3Dhabr">Web developer</a> "; <br></li><li>  online program " <a href="https://netology.ru/programs/javascript%3Futm_source%3Dblog%26utm_medium%3D747%26utm_campaign%3Dhabr">Basic course on JavaScript</a> "; <br></li><li>  online program " <a href="https://netology.ru/programs/node%3Futm_source%3Dblog%26utm_medium%3D747%26utm_campaign%3Dhabr">Node, AngularJS and MongoDB: development of full-fledged web applications</a> "; <br></li><li>  online program " <a href="https://netology.ru/programs/html-javascript%3Futm_source%3Dblog%26utm_medium%3D747%26utm_campaign%3Dhabr">JavaScript in the browser: we create interactive web pages</a> ". <br></li></ul></div><p>Source: <a href="https://habr.com/ru/post/347516/">https://habr.com/ru/post/347516/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347506/index.html">From philosophy to science: how Stephen Hawking and the COSMOS center will use HPE Superdome Flex</a></li>
<li><a href="../347508/index.html">Happy Birthday, Vivaldi !.</a></li>
<li><a href="../347510/index.html">Some aspects of the quality of training sequences</a></li>
<li><a href="../347512/index.html">I modeled the bitcoin price for the entire 2018. You will not believe in the result (approx. Translation. And you will be right)</a></li>
<li><a href="../347514/index.html">GR8 CUL8R - WTF?!?! Understand popular abbreviations in English</a></li>
<li><a href="../347518/index.html">Death of microservice madness in 2018</a></li>
<li><a href="../347520/index.html">The book "Programming for children. Learning to create websites, applications and games. HTML, CSS and JavaScript ¬ª</a></li>
<li><a href="../347522/index.html">Dependencies between SQL objects: use regular expressions and small algorithmic focus</a></li>
<li><a href="../347524/index.html">Major advances in natural language processing in 2017</a></li>
<li><a href="../347526/index.html">Telegram-bot for Redmine. How to simplify the life of yourself and people</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>